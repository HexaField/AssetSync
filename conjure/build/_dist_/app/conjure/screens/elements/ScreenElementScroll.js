import"https://cdn.skypack.dev/pin/three@v0.117.1-NetLzdTnw9ga3y6o633U/min/three.js";import{easyPlane as s}from"../../util/MeshTemplates.js";import r from"./ScreenElementBase.js";import"./ScreenElementButton.js";export default class h extends r{constructor(t,e,i={}){super(t,e,i);this.background=s({width:this.width,height:this.height},{color:2524671,transparent:!0,opacity:0}),this.group.add(this.background),this.frameBorder=i.frameBorder||.05,this.onScrollerCallback=i.onScrollerCallback,this.scroller=s({width:.05,height:.1},{color:2524671,transparent:!0,opacity:.5}),this.scroller.position.set((i.scrollSide==="left"?-1:1)*(this.width/2-this.frameBorder),this.height/2-this.frameBorder,0),this.group.add(this.scroller),this.scrollerTarget=s({width:.05,height:this.height-this.frameBorder-this.frameBorder},{color:2524671,transparent:!0,opacity:.1}),this.scrollerTarget.position.set((i.scrollSide==="left"?-1:1)*(this.width/2-this.frameBorder),0,0),this.group.add(this.scrollerTarget),this.items=[],this.scrollerClicked=!1,this.itemsHeight=.1,this.itemsGap=.05,this.scrollPercent=0,this.y=0,this.nestedElements=i.nestedElements}registerItem(t){this.items.push(t),this.registerElement(t)}addItem(t){this.items.push(t)}updateItems(t){if(t!==void 0&&(this.scrollPercent=t),this.y=this.height/2-this.frameBorder*2+this.scrollPercent*this.items.length*(this.itemsHeight+this.itemsGap),this.nestedElements)this.updateItemsRecursive(this.items);else for(let e of this.items)e.group.position.setY(this.y),e.setHidden(this.y>this.height/2||this.y<-this.height/2),this.y-=e.height+this.itemsGap}updateItemsRecursive(t){for(let e of t)e.hidden||(e.group.position.setY(this.y),e.setHidden(this.y>this.height/2||this.y<-this.height/2),this.y-=e.height+this.itemsGap,e.items&&this.updateItemsRecursive(e.items))}unSelectAll(){for(let t of this.items)t.setSelected(!1)}removeAllItems(){for(let t of this.items)t.destroy(),this.removeElement(t),this.group.remove(t.group);this.items=[]}removeItem(t){for(let e in this.items)if(this.items[e]===t){this.removeElement(this.items[e]),this.group.remove(this.items[e].group),this.items.splice(e,1);return}}setActive(t){super.setActive(t),t&&this.updateItems()}scrollerClick(t){this.scroller.position.setY(t.y),t.y>this.height/2-this.frameBorder&&this.scroller.position.setY(this.height/2-this.frameBorder),t.y<-this.height/2+this.frameBorder&&this.scroller.position.setY(-this.height/2+this.frameBorder);let e=this.height-this.frameBorder-this.scroller.position.y-(this.height+this.frameBorder)/2;this.updateItems(e),this.onScrollerCallback&&this.onScrollerCallback()}scrollerScroll(t){if(t>0&&this.scroller.position.y>this.height/2-this.frameBorder)return;if(t<0&&this.scroller.position.y<-this.height/2+this.frameBorder)return;this.scroller.position.setY(this.scroller.position.y+t*.05),this.scroller.position.y>this.height/2-this.frameBorder&&this.scroller.position.setY(this.height/2-this.frameBorder),this.scroller.position.y<-this.height/2+this.frameBorder&&this.scroller.position.setY(-this.height/2+this.frameBorder);let e=this.height-this.frameBorder-this.scroller.position.y-(this.height+this.frameBorder)/2;this.updateItems(e),this.onScrollerCallback&&this.onScrollerCallback()}update(t){super.update(t);let e=t.mouseRaycaster.intersectObject(this.background,!1);e.length>0&&(t.input.scroll&&this.scrollerScroll(t.input.scroll*2),this.scrollerClicked&&this.scrollerClick(this.group.worldToLocal(e[0].point))),e=t.mouseRaycaster.intersectObject(this.scrollerTarget,!1),e.length>0&&(t.input.isDown("MOUSELEFT",!0)?this.scrollerClick(this.group.worldToLocal(e[0].point)):t.input.isPressed("MOUSELEFT",!0)&&(this.scrollerClicked=!0)),this.scrollerClicked&&t.input.isReleased("MOUSELEFT",!0)&&(this.scrollerClicked=!1)}}
