import{D as k}from"../../../common/LoadingManager-49ee99a5.js";const y={enabled:!1,files:{},add:function(e,d){if(this.enabled===!1)return;this.files[e]=d},get:function(e){return this.enabled===!1?void 0:this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function g(e){this.manager=e!==void 0?e:k,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(g.prototype,{load:function(){},loadAsync:function(e,d){const l=this;return new Promise(function(h,n){l.load(e,h,d,n)})},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});const c={};function b(e){g.call(this,e)}b.prototype=Object.assign(Object.create(g.prototype),{constructor:b,load:function(e,d,l,h){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const n=this,m=y.get(e);if(m!==void 0)return n.manager.itemStart(e),setTimeout(function(){d&&d(m),n.manager.itemEnd(e)},0),m;if(c[e]!==void 0){c[e].push({onLoad:d,onProgress:l,onError:h});return}const E=/^data:(.*?)(;base64)?,(.*)$/,p=e.match(E);let r;if(p){const o=p[1],a=!!p[2];let t=p[3];t=decodeURIComponent(t),a&&(t=atob(t));try{let s;const i=(this.responseType||"").toLowerCase();switch(i){case"arraybuffer":case"blob":const f=new Uint8Array(t.length);for(let u=0;u<t.length;u++)f[u]=t.charCodeAt(u);i==="blob"?s=new Blob([f.buffer],{type:o}):s=f.buffer;break;case"document":const T=new DOMParser;s=T.parseFromString(t,o);break;case"json":s=JSON.parse(t);break;default:s=t;break}setTimeout(function(){d&&d(s),n.manager.itemEnd(e)},0)}catch(s){setTimeout(function(){h&&h(s),n.manager.itemError(e),n.manager.itemEnd(e)},0)}}else{c[e]=[],c[e].push({onLoad:d,onProgress:l,onError:h}),r=new XMLHttpRequest,r.open("GET",e,!0),r.addEventListener("load",function(o){const a=this.response,t=c[e];if(delete c[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),y.add(e,a);for(let s=0,i=t.length;s<i;s++){const f=t[s];f.onLoad&&f.onLoad(a)}n.manager.itemEnd(e)}else{for(let s=0,i=t.length;s<i;s++){const f=t[s];f.onError&&f.onError(o)}n.manager.itemError(e),n.manager.itemEnd(e)}},!1),r.addEventListener("progress",function(o){const a=c[e];for(let t=0,s=a.length;t<s;t++){const i=a[t];i.onProgress&&i.onProgress(o)}},!1),r.addEventListener("error",function(o){const a=c[e];delete c[e];for(let t=0,s=a.length;t<s;t++){const i=a[t];i.onError&&i.onError(o)}n.manager.itemError(e),n.manager.itemEnd(e)},!1),r.addEventListener("abort",function(o){const a=c[e];delete c[e];for(let t=0,s=a.length;t<s;t++){const i=a[t];i.onError&&i.onError(o)}n.manager.itemError(e),n.manager.itemEnd(e)},!1),this.responseType!==void 0&&(r.responseType=this.responseType),this.withCredentials!==void 0&&(r.withCredentials=this.withCredentials),r.overrideMimeType&&r.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const o in this.requestHeader)r.setRequestHeader(o,this.requestHeader[o]);r.send(null)}return n.manager.itemStart(e),r},setResponseType:function(e){return this.responseType=e,this},setMimeType:function(e){return this.mimeType=e,this}});export{b as FileLoader};
