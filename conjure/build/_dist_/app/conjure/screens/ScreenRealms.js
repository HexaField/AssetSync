import a from"./ScreenBase.js";import n from"./elements/ScreenElementButton.js";import r from"./elements/ScreenElementBase.js";import o from"./elements/ScreenElementTextBox.js";import m from"./elements/ScreenElementScroll.js";import c from"../world/realm/RealmData.js";import l from"./elements/ScreenElementSprite.js";export default class d extends a{constructor(e,t){super(e,t);this.buttonWidth=.4,this.buttonHeight=.1,this.background.visible=!0,this.group.add(this.background),this.createRealm=this.createRealm.bind(this),this.pin=this.pin.bind(this),this.joinRealm=this.joinRealm.bind(this),this.realms=[],this.joinButton=new n(this,this,{x:-this.width/4,y:this.height/2-.1,width:this.buttonWidth,height:this.buttonHeight,text:"Join Realm"}),this.joinButton.setOnClickCallback(this.joinRealm),this.registerElement(this.joinButton),this.discordIdTextbox=new o(this,this,{x:this.width/4,y:this.height/2-.1,width:this.buttonWidth,height:this.buttonHeight}),this.discordIdTextbox.setValue(""),this.registerElement(this.discordIdTextbox),this.scrollPanel=new m(this,this,{width:this.width,height:this.height-.4}),this.registerElement(this.scrollPanel),this.createButton=new n(this,this,{y:-this.height/2+.2,width:this.buttonWidth,height:this.buttonHeight,text:"Create Realm"}),this.createButton.setOnClickCallback(this.createRealm),this.registerElement(this.createButton),this.getRealms()}showScreen(e){super.showScreen(e),this.scrollPanel.setActive(e),e&&this.getRealms()}async getRealms(){this.realms=await this.screenManager.conjure.getWorld().getRealmsAndPinned(),this.displayRealms()}createRealm(){this.screenManager.showScreen(this.screenManager.screenRealmSettings,{isCreating:!0})}displayRealms(){this.scrollPanel.removeAllItems();for(let e of this.realms){let t=new r(this,this.scrollPanel,{z:.025,width:this.buttonWidth*2,height:this.buttonHeight}),s=new n(this,t,{width:this.buttonWidth,height:this.buttonHeight});s.setOnClickCallback(this.joinRealm,e.realmData.id),s.setValue(e.realmData.name),t.registerElement(s);let h=new l(this,t,{x:-this.buttonWidth*.5,width:this.buttonHeight,height:this.buttonHeight});h.load(e.realmData.iconURL?e.realmData.iconURL:"default_realm"),t.registerElement(h);let i=new l(this,t,{x:this.buttonWidth*.5,width:this.buttonHeight,height:this.buttonHeight});i.load(e.pinned==="global"?"global_icon":e.pinned?"pin_full":"pin_empty"),i.setIconScale(.75),i.setOnClickCallback(this.pin,e),t.registerElement(i),this.scrollPanel.registerItem(t)}this.scrollPanel.updateItems(0)}async pin(e){for(let t of await this.screenManager.conjure.getRealms())if(t.id===e.realmData.id){await this.screenManager.conjure.pinRealm(e.realmData,!e.pinned),this.getRealms();return}}async joinRealm(e){let t=await this.screenManager.conjure.getWorld().getRealm(e||this.discordIdTextbox.getValue());t?(this.screenManager.conjure.getWorld().joinRealm(new c(t)),this.screenManager.hideAllScreens()):console.log("Could not find realm with id",e||this.discordIdTextbox.getValue())}update(e){super.update(e)}}
