import*as o from" https://cdn.skypack.dev/pin/three@v0.123.0-STd7XeVUbImsNuMmqKGL/min/three.js";export class AudioManager{constructor(){this.buffers={},this.sounds=[],this.sources=[],this.camera=new o.Camera}getSources(){return this.sources}getAudioContext(){return this.audioListener.context}getHasContext(){return this.audioListener!==void 0}setCameraPosition(t){this.camera.position.copy(t)}setCameraArguments(t){}async create(){if(this.getHasContext())return;this.audioListener=new o.AudioListener,await this.audioListener.context.resume(),this.camera.add(this.audioListener),this.setMasterVolume(1),this.audioLoader=new o.AudioLoader}async load(t,s){if(this.buffers[t])return;if(!s)return;await new Promise((e,i)=>{this.audioLoader.load(s,r=>(this.buffers[t]=r,e()))})}createFromMediaSource(t,s,e={}){if(!this.audioListener)return;let i=e.positional?new o.PositionalAudio(this.audioListener):new o.Audio(this.audioListener);i.setMediaElementSource(t),i.setVolume(e.volume===void 0?1:e.volume),i.setRefDistance(e.refDistance===void 0?20:e.refDistance)}play(t,s={}){if(!this.audioListener||!this.buffers[t])return;let e=s.positional?new o.PositionalAudio(this.audioListener):new o.Audio(this.audioListener);return e.setBuffer(this.buffers[t]),e.setLoop(Boolean(s.loop)),e.setVolume(s.volume===void 0?1:s.volume),s.positional&&e.setRefDistance(s.refDistance===void 0?20:s.refDistance),e.play(),e.onEnded=()=>{for(let i in this.sounds)e===this.sounds[i]&&this.sounds.slice(i,1)},this.sounds.push(e),e}setMasterVolume(t){if(!this.audioListener)return;this.audioListener.setMasterVolume(t),this.updateSources()}async toggleMute(){return this.audioListener||await this.create(!1),this.audioListener.setMasterVolume(this.audioListener.getMasterVolume()===0?1:0),this.updateSources(),this.audioListener.getMasterVolume()}updateSources(){for(let t of this.sources)t.userData.media.volume=this.audioListener.getMasterVolume()}}
