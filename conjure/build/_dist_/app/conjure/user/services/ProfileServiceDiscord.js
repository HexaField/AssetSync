import t from"./discord/DiscordHandler.js";import e from"./ProfileService.js";export default class r extends e{constructor(i){super(i,"Discord");this.link=this.link.bind(this),this.isLinked=!1,this.discordHandler=new t(this)}async initialise(){await super.initialise(),await this.discordHandler.tryConnect()}getSchema(){return{linkButton:{type:"button",buttonText:this.getIsLinked()?"Unlink":"Link",ignoreLabel:!0,callback:this.link}}}link(){this.getIsLinked()?this.discordHandler.logOut():this.discordHandler.logInToDiscord()}getIsLinked(){return this.isLinked}setLinked(i){this.isLinked=i,i||(this.data={}),this.profile.refreshServices()}toJson(){return this.isLinked?this.data:super.toJson()}readFromJson(i){}async getGuilds(){return this.isLinked?await this.discordHandler.getUserGuilds():[]}async getRealmsIDs(){this.guilds||(this.guilds=await this.getGuilds());let i=JSON.parse(JSON.stringify(this.guilds));for(let s of i)s.iconURL="https://cdn.discordapp.com/icons/"+s.id+"/"+s.icon+".png",s.id=this.getName()+"-"+s.id;return i}}
