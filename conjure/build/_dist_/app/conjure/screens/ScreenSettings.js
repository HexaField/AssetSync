import*as i from"https://cdn.skypack.dev/pin/three@v0.117.1-NetLzdTnw9ga3y6o633U/min/three.js";import n from"./ScreenBase.js";import s from"./elements/ScreenElementButton.js";import"./elements/ScreenElementSprite.js";import{easyPlane as a}from"../util/MeshTemplates.js";export default class o extends n{constructor(e,t){super(e,t);this.group.add(this.background),this.toggleCam=this.toggleCam.bind(this),this.toggleFeeds=this.toggleFeeds.bind(this),this.getCamButton=new s(this,this,{y:this.height/2-.1,width:this.buttonWidth,height:this.buttonHeight,text:"Enable Camera and Microphone"}),this.getCamButton.setOnClickCallback(this.toggleCam),this.registerElement(this.getCamButton),this.allowCamButton=new s(this,this,{y:this.height/2-.25,width:this.buttonWidth,height:this.buttonHeight,text:"Allow Incoming Streams"}),this.allowCamButton.setOnClickCallback(this.toggleFeeds),this.registerElement(this.allowCamButton),this.camPreview=a({width:this.buttonWidth*1.2,height:this.buttonWidth,material:new i.MeshBasicMaterial({side:i.DoubleSide})}),this.camPreview.position.set(0,this.height/2-.55,.1),this.group.add(this.camPreview)}async toggleCam(){await this.conjure.toggleMediaStream();const e=this.conjure.userMediaStream!==void 0;if(this.getCamButton.setText(e?"Disable Camera and Microphone":"Enable Camera and Microphone"),e){const t=document.createElement("video");this.camPreview.material.map=new i.VideoTexture(t),"srcObject"in t?t.srcObject=this.conjure.userMediaStream:t.src=window.URL.createObjectURL(this.conjure.userMediaStream),t.play(),t.volume=0,this.camPreview.material.needsUpdate=!0}else this.camPreview.material.map=void 0}async toggleFeeds(){this.conjure.allowIncomingFeeds=!this.conjure.allowIncomingFeeds,await this.conjure.updateIngoingMediaStream(),this.allowCamButton.setText(this.conjure.allowIncomingFeeds?"Block Incoming Streams":"Allow Incoming Streams")}showScreen(e){super.showScreen(e)}update(e){super.update(e)}}
