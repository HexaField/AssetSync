import*as n from" https://cdn.skypack.dev/pin/three@v0.123.0-STd7XeVUbImsNuMmqKGL/min/three.js";import{easyPlane as l,easyLine as o}from"../util/MeshTemplates.js";import a from"./text/TextRenderer3D.js";import{number as r}from"../util/number.js";export default class u{constructor(e,t={}){this.screenManager=e,this.conjure=e.conjure,this.camera=this.conjure.camera,this.world=this.conjure.getWorld(),this.id=this.screenManager.screens===void 0?-1:this.screenManager.screens.length,this.screenName=t.name||"",this.anchor=Boolean(t.anchor),this.x=r(t.x),this.y=r(t.y),this.width=r(t.width),this.height=r(t.height),this.pauses=t.pauses,this.buttonWidth=.4,this.buttonHeight=.1,this.defaultColour=2524671,this.defaultColour2=1993420,this.defaultColour3=1594787,this.defaultOpacity=.85,this.background=l({width:this.width,height:this.height},{color:this.defaultColour3,transparent:!0,opacity:this.defaultOpacity}),this.background.receiveShadow=!1,this.aspectRatio=1,this.vec=new n.Vector3,this.group=new n.Group,this.screenManager.conjure.cameraScreenAttach.add(this.group),this.screenTitle=new a(this.screenManager.conjure,this.group,{string:this.screenName}),this.screenTitle.group.position.set(0,this.height/2+.1,.1),this.active=!1,this.elements=[],this.debugLines=this.addDebugGrid(),this.debugLines.visible=!1,this.group.add(this.debugLines),this.mouseOver=!1,this.activeTextBox=void 0,this.htmlObjects=[],this.draggingElement=void 0}addHTML(e){this.htmlObjects.push(e),e.show(!1)}setHTMLActive(e){for(let t=0;t<this.elements.length;t++)this.elements[t].setHTMLActive(e);for(let t=0;t<this.htmlObjects.length;t++)this.htmlObjects[t].show(e)}setTextBox(e){this.activeTextBox=e}registerElement(e){this.elements.push(e)}getElementByName(e){for(let t=0;t<this.elements.length;t++)if(this.elements[t].name===e)return this.elements[t]}removeElementByName(e){for(let t=0;t<this.elements.length;t++)this.elements[t].name===e&&this.elements.splice(t,1)}removeElement(e){for(let t=0;t<this.elements.length;t++)this.elements[t]===e&&this.elements.splice(t,1)}showScreen(e,t={}){this.active=e,this.group.visible=e;for(let i=0;i<this.elements.length;i++)this.elements[i].setActive(e),this.elements[i].setHTMLActive(e);this.setHTMLActive(e)}addDebugGrid(){let e=new n.Group;return e.add(this.lines(!1)),e.add(this.lines(!0)),e}lines(e){const t=2,i=new n.Group,h=1;for(let s=-t;s<=t;s++)i.add(o({points:[new n.Vector3(e?-t:s*h,e?s*h:-t,0),new n.Vector3(e?t:s*h,e?s*h:t,0)]},{color:16777215}));return i}getAllElements(){let e=[];for(let t of this.elements){for(let i of t.getAllElements())e.push(i);e.push(t)}return e}update(e){let t=e.mouseRaycaster.intersectObject(this.background,!1);if(this.draggingElementOriginator&&(t.length>0&&(e.input.isReleased("MOUSELEFT",!0)&&(this.draggingElementOriginator.endDrag&&this.draggingElementOriginator.endDrag(this.getAllElements()),this.draggingElementOriginator=void 0))),t.length>0&&this.active?this.mouseOver=!0:this.mouseOver=!1,this.activeTextBox)this.activeTextBox.update(e);else{e.input.isPressed("k",!0,!0)&&(this.debugLines.visible=!this.debugLines.visible);for(let i=0;i<this.elements.length;i++)this.elements[i].update(e);for(let i=0;i<this.htmlObjects.length;i++)this.htmlObjects[i].update()}}resizeScreen(e){this.aspectRatio=e,this.anchor&&this.group.position.setX(this.x*e);for(let t of this.elements)t.resizeAnchor(e)}}
