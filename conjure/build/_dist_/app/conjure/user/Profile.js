import{generateUUID as t}from"../../../../web_modules/@AssetSync/common.js";import i from"./services/ServiceManager.js";export default class s{constructor(e){this.conjure=e,this.isLoaded=!1,this.profileData={},this.makeDefaultProfile(),this.serviceManager=new i(e)}makeDefaultProfile(){this.profileData={id:t(),username:"New User "+Math.round(Math.random()*1e4)}}getServiceManager(){return this.serviceManager}getProfile(){return this.profileData}getID(){return this.profileData.id}getUsername(){return this.profileData.username}setUsername(e){this.profileData.username=e}createProfile(){if(this.isLoaded)return;this.saveProfile(),this.setProfileLoaded(!0)}removeProfile(){if(!this.isLoaded)return;this.makeDefaultProfile(),this.setProfileLoaded(!1)}async loadFromDatabase(){let e;try{e=JSON.parse(await window.clientDatastore.get("profile"))}catch(r){console.log(r)}if(console.log(e),!e)return;e.profile&&this.setProfileFromDatabase(e.profile),e.services&&this.getServiceManager().setServicesFromDatabase(e.services)}saveProfile(){window.clientDatastore.put("profile",JSON.stringify({profile:this.profileData,services:this.getServiceManager().getServiceAsJson()}))}setProfileFromDatabase(e){this.profileData=e,this.setProfileLoaded(!0),this.conjure.getGlobalHUD().log("Successfully loaded profile!")}setProfileLoaded(e){this.conjure.getScreens().screenProfile.setProfileLoaded(e),this.isLoaded=e,e&&this.conjure.getScreens().screenProfile.setProfileName(this.getUsername())}}
