import{c as oe}from"./common/_commonjsHelpers-c99fd594.js";var ie=oe(function(se,$){function te(e,t,r,u){var a=0,u=u===void 0?{}:u,m=u.loop===void 0?null:u.loop,g=u.palette===void 0?null:u.palette;if(t<=0||r<=0||t>65535||r>65535)throw new Error("Width/Height invalid.");function k(s){var o=s.length;if(o<2||o>256||o&o-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return o}e[a++]=71,e[a++]=73,e[a++]=70,e[a++]=56,e[a++]=57,e[a++]=97;var h=0,c=0;if(g!==null){for(var l=k(g);l>>=1;)++h;if(l=1<<h,--h,u.background!==void 0){if(c=u.background,c>=l)throw new Error("Background index out of range.");if(c===0)throw new Error("Background index explicitly passed as 0.")}}if(e[a++]=t&255,e[a++]=t>>8&255,e[a++]=r&255,e[a++]=r>>8&255,e[a++]=(g!==null?128:0)|h,e[a++]=c,e[a++]=0,g!==null)for(var p=0,x=g.length;p<x;++p){var b=g[p];e[a++]=b>>16&255,e[a++]=b>>8&255,e[a++]=b&255}if(m!==null){if(m<0||m>65535)throw new Error("Loop count invalid.");e[a++]=33,e[a++]=255,e[a++]=11,e[a++]=78,e[a++]=69,e[a++]=84,e[a++]=83,e[a++]=67,e[a++]=65,e[a++]=80,e[a++]=69,e[a++]=50,e[a++]=46,e[a++]=48,e[a++]=3,e[a++]=1,e[a++]=m&255,e[a++]=m>>8&255,e[a++]=0}var f=!1;this.addFrame=function(s,o,n,y,w,d){if(f===!0&&(--a,f=!1),d=d===void 0?{}:d,s<0||o<0||s>65535||o>65535)throw new Error("x/y invalid.");if(n<=0||y<=0||n>65535||y>65535)throw new Error("Width/Height invalid.");if(w.length<n*y)throw new Error("Not enough pixels for the frame size.");var T=!0,_=d.palette;if(_==null&&(T=!1,_=g),_==null)throw new Error("Must supply either a local or global palette.");for(var O=k(_),S=0;O>>=1;)++S;O=1<<S;var H=d.delay===void 0?0:d.delay,R=d.disposal===void 0?0:d.disposal;if(R<0||R>3)throw new Error("Disposal out of range.");var L=!1,C=0;if(d.transparent!==void 0&&d.transparent!==null&&(L=!0,C=d.transparent,C<0||C>=O))throw new Error("Transparent color index.");if((R!==0||L||H!==0)&&(e[a++]=33,e[a++]=249,e[a++]=4,e[a++]=R<<2|(L===!0?1:0),e[a++]=H&255,e[a++]=H>>8&255,e[a++]=C,e[a++]=0),e[a++]=44,e[a++]=s&255,e[a++]=s>>8&255,e[a++]=o&255,e[a++]=o>>8&255,e[a++]=n&255,e[a++]=n>>8&255,e[a++]=y&255,e[a++]=y>>8&255,e[a++]=T===!0?128|S-1:0,T===!0)for(var P=0,K=_.length;P<K;++P){var U=_[P];e[a++]=U>>16&255,e[a++]=U>>8&255,e[a++]=U&255}return a=ae(e,a,S<2?2:S,w),a},this.end=function(){return f===!1&&(e[a++]=59,f=!0),a},this.getOutputBuffer=function(){return e},this.setOutputBuffer=function(s){e=s},this.getOutputBufferPosition=function(){return a},this.setOutputBufferPosition=function(s){a=s}}function ae(e,t,r,u){e[t++]=r;var a=t++,m=1<<r,g=m-1,k=m+1,h=k+1,c=r+1,l=0,p=0;function x(T){for(;l>=T;)e[t++]=p&255,p>>=8,l-=8,t===a+256&&(e[a]=255,a=t++)}function b(T){p|=T<<l,l+=c,x(8)}var f=u[0]&g,s={};b(m);for(var o=1,n=u.length;o<n;++o){var y=u[o]&g,w=f<<8|y,d=s[w];if(d===void 0){for(p|=f<<l,l+=c;l>=8;)e[t++]=p&255,p>>=8,l-=8,t===a+256&&(e[a]=255,a=t++);h===4096?(b(m),h=k+1,c=r+1,s={}):(h>=1<<c&&++c,s[w]=h++),f=y}else f=d}return b(f),b(k),x(1),a+1===t?e[a]=0:(e[a]=t-a-1,e[t++]=0),t}function re(e){var t=0;if(e[t++]!==71||e[t++]!==73||e[t++]!==70||e[t++]!==56||(e[t++]+1&253)!==56||e[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var r=e[t++]|e[t++]<<8,u=e[t++]|e[t++]<<8,a=e[t++],m=a>>7,g=a&7,k=1<<g+1,h=e[t++];e[t++];var c=null,l=null;m&&(c=t,l=k,t+=k*3);var p=!0,x=[],b=0,f=null,s=0,o=null;for(this.width=r,this.height=u;p&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(e[t]!==11||e[t+1]==78&&e[t+2]==69&&e[t+3]==84&&e[t+4]==83&&e[t+5]==67&&e[t+6]==65&&e[t+7]==80&&e[t+8]==69&&e[t+9]==50&&e[t+10]==46&&e[t+11]==48&&e[t+12]==3&&e[t+13]==1&&e[t+16]==0)t+=14,o=e[t++]|e[t++]<<8,t++;else for(t+=12;;){var n=e[t++];if(!(n>=0))throw Error("Invalid block size");if(n===0)break;t+=n}break;case 249:if(e[t++]!==4||e[t+4]!==0)throw new Error("Invalid graphics extension block.");var y=e[t++];b=e[t++]|e[t++]<<8,f=e[t++],(y&1)===0&&(f=null),s=y>>2&7,t++;break;case 254:for(;;){var n=e[t++];if(!(n>=0))throw Error("Invalid block size");if(n===0)break;t+=n}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var w=e[t++]|e[t++]<<8,d=e[t++]|e[t++]<<8,T=e[t++]|e[t++]<<8,_=e[t++]|e[t++]<<8,O=e[t++],S=O>>7,H=O>>6&1,R=O&7,L=1<<R+1,C=c,P=l,K=!1;if(S){var K=!0;C=t,P=L,t+=L*3}var U=t;for(t++;;){var n=e[t++];if(!(n>=0))throw Error("Invalid block size");if(n===0)break;t+=n}x.push({x:w,y:d,width:T,height:_,has_local_palette:K,palette_offset:C,palette_size:P,data_offset:U,data_length:t-U,transparent_index:f,interlaced:!!H,delay:b,disposal:s});break;case 59:p=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return x.length},this.loopCount=function(){return o},this.frameInfo=function(N){if(N<0||N>=x.length)throw new Error("Frame index out of range.");return x[N]},this.decodeAndBlitFrameBGRA=function(N,A){var i=this.frameInfo(N),M=i.width*i.height,W=new Uint8Array(M);ee(e,i.data_offset,W,M);var B=i.palette_offset,z=i.transparent_index;z===null&&(z=256);var E=i.width,F=r-E,G=E,Z=(i.y*r+i.x)*4,Q=((i.y+i.height)*r+i.x)*4,v=Z,D=F*4;i.interlaced===!0&&(D+=r*4*7);for(var j=8,q=0,J=W.length;q<J;++q){var I=W[q];if(G===0&&(v+=D,G=E,v>=Q&&(D=F*4+r*4*(j-1),v=Z+(E+F)*(j<<1),j>>=1)),I===z)v+=4;else{var V=e[B+I*3],X=e[B+I*3+1],Y=e[B+I*3+2];A[v++]=Y,A[v++]=X,A[v++]=V,A[v++]=255}--G}},this.decodeAndBlitFrameRGBA=function(N,A){var i=this.frameInfo(N),M=i.width*i.height,W=new Uint8Array(M);ee(e,i.data_offset,W,M);var B=i.palette_offset,z=i.transparent_index;z===null&&(z=256);var E=i.width,F=r-E,G=E,Z=(i.y*r+i.x)*4,Q=((i.y+i.height)*r+i.x)*4,v=Z,D=F*4;i.interlaced===!0&&(D+=r*4*7);for(var j=8,q=0,J=W.length;q<J;++q){var I=W[q];if(G===0&&(v+=D,G=E,v>=Q&&(D=F*4+r*4*(j-1),v=Z+(E+F)*(j<<1),j>>=1)),I===z)v+=4;else{var V=e[B+I*3],X=e[B+I*3+1],Y=e[B+I*3+2];A[v++]=V,A[v++]=X,A[v++]=Y,A[v++]=255}--G}}}function ee(e,t,r,u){for(var a=e[t++],m=1<<a,g=m+1,k=g+1,h=a+1,c=(1<<h)-1,l=0,p=0,x=0,b=e[t++],f=new Int32Array(4096),s=null;;){for(;l<16&&!(b===0);)p|=e[t++]<<l,l+=8,b===1?b=e[t++]:--b;if(l<h)break;var o=p&c;if(p>>=h,l-=h,o===m){k=g+1,h=a+1,c=(1<<h)-1,s=null;continue}else if(o===g)break;for(var n=o<k?o:s,y=0,w=n;w>m;)w=f[w]>>8,++y;var d=w,T=x+y+(n!==o?1:0);if(T>u){console.log("Warning, gif stream longer than expected.");return}r[x++]=d,x+=y;var _=x;for(n!==o&&(r[x++]=d),w=n;y--;)w=f[w],r[--_]=w&255,w>>=8;s!==null&&k<4096&&(f[k++]=s<<8|d,k>=c+1&&h<12&&(++h,c=c<<1|1)),s=o}return x!==u&&console.log("Warning, gif stream shorter than expected."),r}try{$.GifWriter=te,$.GifReader=re}catch(e){}}),ne=ie.GifReader;export{ne as GifReader};
