import h from"./ScreenBase.js";import n from"./elements/ScreenElementButton.js";import r from"./elements/ScreenElementBase.js";import o from"./elements/ScreenElementTextBox.js";import m from"./elements/ScreenElementScroll.js";import c from"../../backend/realm/RealmData.js";import a from"./elements/ScreenElementSprite.js";export default class d extends h{constructor(e,t){super(e,t);this.buttonWidth=.4,this.buttonHeight=.1,this.background.visible=!0,this.group.add(this.background),this.createRealm=this.createRealm.bind(this),this.forgetRealm=this.forgetRealm.bind(this),this.joinRealm=this.joinRealm.bind(this),this.realms=[],this.joinButton=new n(this,this,{x:-this.width/4,y:this.height/2-.1,width:this.buttonWidth,height:this.buttonHeight,text:"Join Realm"}),this.joinButton.setOnClickCallback(this.joinRealm),this.registerElement(this.joinButton),this.discordIdTextbox=new o(this,this,{x:this.width/4,y:this.height/2-.1,width:this.buttonWidth,height:this.buttonHeight}),this.discordIdTextbox.setValue(""),this.registerElement(this.discordIdTextbox),this.scrollPanel=new m(this,this,{width:this.width,height:this.height-.4}),this.registerElement(this.scrollPanel),this.createButton=new n(this,this,{y:-this.height/2+.2,width:this.buttonWidth,height:this.buttonHeight,text:"Create Realm"}),this.createButton.setOnClickCallback(this.createRealm),this.registerElement(this.createButton),this.getRealms()}showScreen(e){super.showScreen(e),this.scrollPanel.setActive(e),e&&this.getRealms()}async getRealms(){this.realms=await this.screenManager.conjure.getWorld().getRealms(),console.log(this.realms),this.displayRealms()}createRealm(){this.screenManager.showScreen(this.screenManager.screenRealmSettings,{isCreating:!0})}displayRealms(){this.scrollPanel.removeAllItems();for(let e of this.realms){let t=new r(this,this.scrollPanel,{z:.025,width:this.buttonWidth*2,height:this.buttonHeight}),s=new n(this,t,{width:this.buttonWidth,height:this.buttonHeight});s.setOnClickCallback(this.joinRealm,e.id),s.setValue(e.name),t.registerElement(s);let l=new a(this,t,{x:-this.buttonWidth*.5,width:this.buttonHeight,height:this.buttonHeight});l.load(e.iconURL?e.iconURL:"default_realm"),t.registerElement(l);let i=new a(this,t,{x:this.buttonWidth*.5,width:this.buttonHeight,height:this.buttonHeight});i.load(e.global==="global"?"global_icon":"pin_full"),i.setIconScale(.75),e.global||i.setOnClickCallback(this.forgetRealm,e),t.registerElement(i),this.scrollPanel.registerItem(t)}this.scrollPanel.updateItems(0)}async forgetRealm(e){for(let t of await this.screenManager.conjure.getRealms())t.id===e.realmData.id}async joinRealm(e){let t=await this.screenManager.conjure.getWorld().getRealm(e||this.discordIdTextbox.getValue());t?(this.screenManager.conjure.getWorld().joinRealm(new c(t)),this.screenManager.hideAllScreens()):console.log("Could not find realm with id",e||this.discordIdTextbox.getValue())}update(e){super.update(e)}}
