import{BoxBufferGeometry as U,BufferGeometry as we,Color as le,CylinderBufferGeometry as A,DoubleSide as ye,Euler as Me,Float32BufferAttribute as ve,Line as h,LineBasicMaterial as xe,Matrix4 as be,Mesh as o,MeshBasicMaterial as ge,Object3D as B,OctahedronBufferGeometry as H,PlaneBufferGeometry as K,Quaternion as Q,Raycaster as Pe,SphereBufferGeometry as Ye,TorusBufferGeometry as ce,Vector3 as u}from" https://cdn.skypack.dev/pin/three@v0.123.0-STd7XeVUbImsNuMmqKGL/min/three.js";var de=function(x,c){c===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),c=document),this.objects=[],B.call(this),this.visible=!1,this.domElement=c;var p=new ue;this.add(p);var v=new pe;this.add(v);var l=this;a("camera",x),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);var y={type:"change"},z={type:"mouseDown"},b={type:"mouseUp",mode:l.mode},W={type:"objectChange"},k=new Pe;function D(t,i,s){for(var n=i.intersectObject(t,!0),e=n.length;e--;)if(n[e].object.visible||s)return n[e];return!1}var I=new u,S=new u,G=new Q,V={X:new u(1,0,0),Y:new u(0,1,0),Z:new u(0,0,1)},g=new u,M=new u,d=new u,T=new u,L=new u,F=new u,w=0,f=new u,R=new Q,he=new u,fe=new u,ne=new Q,ee=new Q,te=new u,J=new u,re=new Q,me=new u,$=new u,_=new Q,P=new Q,ie=new u,E=new u,m=new u,q=new Q,oe=new u;a("worldPosition",$),a("worldPositionStart",J),a("worldQuaternion",_),a("worldQuaternionStart",re),a("cameraPosition",f),a("cameraQuaternion",R),a("pointStart",g),a("pointEnd",M),a("rotationAxis",T),a("rotationAngle",w),a("eye",E),c.addEventListener("mousedown",C,!1),c.addEventListener("touchstart",C,!1),c.addEventListener("mousemove",N,!1),c.addEventListener("touchmove",N,!1),c.addEventListener("touchmove",X,!1),document.addEventListener("mouseup",Y,!1),c.addEventListener("touchend",Y,!1),c.addEventListener("touchcancel",Y,!1),c.addEventListener("touchleave",Y,!1),this.dispose=function(){c.removeEventListener("mousedown",C),c.removeEventListener("touchstart",C),c.removeEventListener("mousemove",N),document.removeEventListener("mousemove",X),c.removeEventListener("touchmove",N),c.removeEventListener("touchmove",X),document.removeEventListener("mouseup",Y),c.removeEventListener("touchend",Y),c.removeEventListener("touchcancel",Y),c.removeEventListener("touchleave",Y),this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})},this.hasAnyAttached=function(){return this.objects.length>0},this.getIndex=function(t){for(let i=0;i<this.objects.length;i++)if(this.objects[i]===t)return i;return-1},this.isAttached=function(t){for(let i of this.objects)if(i.uuid===t.uuid)return!0;return!1},this.attach=function(t){return this.isAttached(t)?void 0:(this.objects.push(t),this.visible=!0,this)},this.detachAll=function(){this.objects=[],this.visible=!1,this.axis=null;return},this.detach=function(t){if(this.isAttached(t)){let i=this.getIndex(t);return this.objects.splice(i,1),this.objects.length===0&&(this.visible=!1,this.axis=null),this}return};function a(t,i){var s=i;Object.defineProperty(l,t,{get:function(){return s!==void 0?s:i},set:function(n){s!==n&&(s=n,v[t]=n,p[t]=n,l.dispatchEvent({type:t+"-changed",value:n}),l.dispatchEvent(y))}}),l[t]=i,v[t]=i,p[t]=i}this.updateMatrixWorld=function(){for(let t of this.objects)t!==void 0&&(t.updateMatrixWorld(),t.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):t.parent.matrixWorld.decompose(fe,ne,te),t.matrixWorld.decompose($,_,ie),ee.copy(ne).invert(),P.copy(_).invert());this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(f,R,he),E.copy(f).sub($).normalize(),B.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(t){if(this.objects.length===0||this.dragging===!0||t.button!==void 0&&t.button!==0)return;k.setFromCamera(t,this.camera);var i=D(p.picker[this.mode],k);i?this.axis=i.object.name:this.axis=null},this.pointerDown=function(t){if(this.objects.length===0||this.dragging===!0||t.button!==void 0&&t.button!==0)return;if((t.button===0||t.button===void 0)&&this.axis!==null){k.setFromCamera(t,this.camera);var i=D(v,k,!0);if(i){var s=this.space;this.mode==="scale"?s="local":(this.axis==="E"||this.axis==="XYZE"||this.axis==="XYZ")&&(s="world");for(let e of this.objects){if(s==="local"&&this.mode==="rotate"){var n=this.rotationSnap;this.axis==="X"&&n&&(e.rotation.x=Math.round(e.rotation.x/n)*n),this.axis==="Y"&&n&&(e.rotation.y=Math.round(e.rotation.y/n)*n),this.axis==="Z"&&n&&(e.rotation.z=Math.round(e.rotation.z/n)*n)}e.updateMatrixWorld(),e.parent.updateMatrixWorld(),m.copy(e.position),q.copy(e.quaternion),oe.copy(e.scale),e.matrixWorld.decompose(J,re,me),g.copy(i.point).sub(J)}}this.dragging=!0,z.mode=this.mode,this.dispatchEvent(z)}},this.updateObjectMatrixWorld=function(t){t.updateMatrixWorld()},this.pointerMove=function(t){for(let r of this.objects){var i=this.axis,s=this.mode,n=this.space;if(s==="scale"?n="local":(i==="E"||i==="XYZE"||i==="XYZ")&&(n="world"),r===void 0||i===null||this.dragging===!1||t.button!==void 0&&t.button!==0)return;k.setFromCamera(t,this.camera);var e=D(v,k,!0);if(!e)return;if(M.copy(e.point).sub(J),s==="translate")d.copy(M).sub(g),n==="local"&&i!=="XYZ"&&d.applyQuaternion(P),i.indexOf("X")===-1&&(d.x=0),i.indexOf("Y")===-1&&(d.y=0),i.indexOf("Z")===-1&&(d.z=0),n==="local"&&i!=="XYZ"?d.applyQuaternion(q).divide(te):d.applyQuaternion(ee).divide(te),r.position.copy(d).add(m),this.translationSnap&&(n==="local"&&(r.position.applyQuaternion(G.copy(q).invert()),i.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(q)),n==="world"&&(r.parent&&r.position.add(I.setFromMatrixPosition(r.parent.matrixWorld)),i.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(I.setFromMatrixPosition(r.parent.matrixWorld))));else if(s==="scale"){if(i.search("XYZ")!==-1){var Z=M.length()/g.length();M.dot(g)<0&&(Z*=-1),S.set(Z,Z,Z)}else I.copy(g),S.copy(M),I.applyQuaternion(P),S.applyQuaternion(P),S.divide(I),i.search("X")===-1&&(S.x=1),i.search("Y")===-1&&(S.y=1),i.search("Z")===-1&&(S.z=1);r.scale.copy(oe).multiply(S),this.scaleSnap&&(i.search("X")!==-1&&(r.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){d.copy(M).sub(g);var j=20/$.distanceTo(I.setFromMatrixPosition(this.camera.matrixWorld));i==="E"?(T.copy(E),w=M.angleTo(g),L.copy(g).normalize(),F.copy(M).normalize(),w*=F.cross(L).dot(E)<0?1:-1):i==="XYZE"?(T.copy(d).cross(E).normalize(),w=d.dot(I.copy(T).cross(this.eye))*j):(i==="X"||i==="Y"||i==="Z")&&(T.copy(V[i]),I.copy(V[i]),n==="local"&&I.applyQuaternion(_),w=d.dot(I.cross(E).normalize())*j),this.rotationSnap&&(w=Math.round(w/this.rotationSnap)*this.rotationSnap),this.rotationAngle=w,n==="local"&&i!=="E"&&i!=="XYZE"?(r.quaternion.copy(q),r.quaternion.multiply(G.setFromAxisAngle(T,w)).normalize()):(T.applyQuaternion(ee),r.quaternion.copy(G.setFromAxisAngle(T,w)),r.quaternion.multiply(q).normalize())}}this.dispatchEvent(y),this.dispatchEvent(W)},this.pointerUp=function(t){if(t.button!==void 0&&t.button!==0)return;this.dragging&&this.axis!==null&&(b.mode=this.mode,this.dispatchEvent(b)),this.dragging=!1,t.button===void 0&&(this.axis=null)};function O(t){if(document.pointerLockElement)return{x:0,y:0,button:t.button};var i=t.changedTouches?t.changedTouches[0]:t,s=c.getBoundingClientRect();return{x:(i.clientX-s.left)/s.width*2-1,y:-(i.clientY-s.top)/s.height*2+1,button:t.button}}function N(t){if(!l.enabled)return;l.pointerHover(O(t))}function C(t){if(!l.enabled)return;document.addEventListener("mousemove",X,!1),l.pointerHover(O(t)),l.pointerDown(O(t))}function X(t){if(!l.enabled)return;l.pointerMove(O(t))}function Y(t){if(!l.enabled)return;document.removeEventListener("mousemove",X,!1),l.pointerUp(O(t))}this.getMode=function(){return l.mode},this.setMode=function(t){l.mode=t},this.setTranslationSnap=function(t){l.translationSnap=t},this.setRotationSnap=function(t){l.rotationSnap=t},this.setScaleSnap=function(t){l.scaleSnap=t},this.setSize=function(t){l.size=t},this.setSpace=function(t){l.space=t},this.update=function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}};de.prototype=Object.assign(Object.create(B.prototype),{constructor:de,isTransformControls:!0});var ue=function(){B.call(this),this.type="TransformControlsGizmo";var x=new ge({depthTest:!1,depthWrite:!1,transparent:!0,side:ye,fog:!1}),c=new xe({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),p=x.clone();p.opacity=.15;var v=x.clone();v.opacity=.33;var l=x.clone();l.color.set(16711680);var y=x.clone();y.color.set(65280);var z=x.clone();z.color.set(255);var b=x.clone();b.opacity=.25;var W=b.clone();W.color.set(16776960);var k=b.clone();k.color.set(65535);var D=b.clone();D.color.set(16711935);var I=x.clone();I.color.set(16776960);var S=c.clone();S.color.set(16711680);var G=c.clone();G.color.set(65280);var V=c.clone();V.color.set(255);var g=c.clone();g.color.set(65535);var M=c.clone();M.color.set(16711935);var d=c.clone();d.color.set(16776960);var T=c.clone();T.color.set(7895160);var L=d.clone();L.opacity=.25;var F=new A(0,.05,.2,12,1,!1),w=new U(.125,.125,.125),f=new we;f.setAttribute("position",new ve([0,0,0,1,0,0],3));var R=function(t,i){for(var s=new we,n=[],e=0;e<=64*i;++e)n.push(0,Math.cos(e/32*Math.PI)*t,Math.sin(e/32*Math.PI)*t);return s.setAttribute("position",new ve(n,3)),s},he=function(){var t=new we;return t.setAttribute("position",new ve([0,0,0,1,1,1],3)),t},fe={X:[[new o(F,l),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new o(F,l),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new h(f,S)]],Y:[[new o(F,y),[0,1,0],null,null,"fwd"],[new o(F,y),[0,1,0],[Math.PI,0,0],null,"bwd"],[new h(f,G),null,[0,0,Math.PI/2]]],Z:[[new o(F,z),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new o(F,z),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new h(f,V),null,[0,-Math.PI/2,0]]],XYZ:[[new o(new H(.1,0),b.clone()),[0,0,0],[0,0,0]]],XY:[[new o(new K(.295,.295),W.clone()),[.15,.15,0]],[new h(f,d),[.18,.3,0],null,[.125,1,1]],[new h(f,d),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new o(new K(.295,.295),k.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new h(f,g),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new h(f,g),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new o(new K(.295,.295),D.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new h(f,M),[.18,0,.3],null,[.125,1,1]],[new h(f,M),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},ne={X:[[new o(new A(.2,0,1,4,1,!1),p),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new o(new A(.2,0,1,4,1,!1),p),[0,.6,0]]],Z:[[new o(new A(.2,0,1,4,1,!1),p),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new o(new H(.2,0),p)]],XY:[[new o(new K(.4,.4),p),[.2,.2,0]]],YZ:[[new o(new K(.4,.4),p),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new o(new K(.4,.4),p),[.2,0,.2],[-Math.PI/2,0,0]]]},ee={START:[[new o(new H(.01,2),v),null,null,null,"helper"]],END:[[new o(new H(.01,2),v),null,null,null,"helper"]],DELTA:[[new h(he(),v),null,null,null,"helper"]],X:[[new h(f,v.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new h(f,v.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new h(f,v.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},te={X:[[new h(R(1,.5),S)],[new o(new H(.04,0),l),[0,0,.99],null,[1,3,1]]],Y:[[new h(R(1,.5),G),null,[0,0,-Math.PI/2]],[new o(new H(.04,0),y),[0,0,.99],null,[3,1,1]]],Z:[[new h(R(1,.5),V),null,[0,Math.PI/2,0]],[new o(new H(.04,0),z),[.99,0,0],null,[1,3,1]]],E:[[new h(R(1.25,1),L),null,[0,Math.PI/2,0]],[new o(new A(.03,0,.15,4,1,!1),L),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new o(new A(.03,0,.15,4,1,!1),L),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new o(new A(.03,0,.15,4,1,!1),L),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new o(new A(.03,0,.15,4,1,!1),L),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new h(R(1,1),T),null,[0,Math.PI/2,0]]]},J={AXIS:[[new h(f,v.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},re={X:[[new o(new ce(1,.1,4,24),p),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new o(new ce(1,.1,4,24),p),[0,0,0],[Math.PI/2,0,0]]],Z:[[new o(new ce(1,.1,4,24),p),[0,0,0],[0,0,-Math.PI/2]]],E:[[new o(new ce(1.25,.1,2,24),p)]],XYZE:[[new o(new Ye(.7,10,8),p)]]},me={X:[[new o(w,l),[.8,0,0],[0,0,-Math.PI/2]],[new h(f,S),null,null,[.8,1,1]]],Y:[[new o(w,y),[0,.8,0]],[new h(f,G),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new o(w,z),[0,0,.8],[Math.PI/2,0,0]],[new h(f,V),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new o(w,W),[.85,.85,0],null,[2,2,.2]],[new h(f,d),[.855,.98,0],null,[.125,1,1]],[new h(f,d),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new o(w,k),[0,.85,.85],null,[.2,2,2]],[new h(f,g),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new h(f,g),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new o(w,D),[.85,0,.85],null,[2,.2,2]],[new h(f,M),[.855,0,.98],null,[.125,1,1]],[new h(f,M),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new o(new U(.125,.125,.125),b.clone()),[1.1,0,0]]],XYZY:[[new o(new U(.125,.125,.125),b.clone()),[0,1.1,0]]],XYZZ:[[new o(new U(.125,.125,.125),b.clone()),[0,0,1.1]]]},$={X:[[new o(new A(.2,0,.8,4,1,!1),p),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new o(new A(.2,0,.8,4,1,!1),p),[0,.5,0]]],Z:[[new o(new A(.2,0,.8,4,1,!1),p),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new o(w,p),[.85,.85,0],null,[3,3,.2]]],YZ:[[new o(w,p),[0,.85,.85],null,[.2,3,3]]],XZ:[[new o(w,p),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new o(new U(.2,.2,.2),p),[1.1,0,0]]],XYZY:[[new o(new U(.2,.2,.2),p),[0,1.1,0]]],XYZZ:[[new o(new U(.2,.2,.2),p),[0,0,1.1]]]},_={X:[[new h(f,v.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new h(f,v.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new h(f,v.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},P=function(t){var i=new B;for(var s in t)for(var n=t[s].length;n--;){var e=t[s][n][0].clone(),Z=t[s][n][1],j=t[s][n][2],r=t[s][n][3],ae=t[s][n][4];e.name=s,e.tag=ae,Z&&e.position.set(Z[0],Z[1],Z[2]),j&&e.rotation.set(j[0],j[1],j[2]),r&&e.scale.set(r[0],r[1],r[2]),e.updateMatrix();var se=e.geometry.clone();se.applyMatrix4(e.matrix),e.geometry=se,e.renderOrder=Infinity,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1),i.add(e)}return i},ie=new u(0,0,0),E=new Me,m=new u(0,1,0),q=new u(0,0,0),oe=new be,a=new Q,O=new Q,N=new Q,C=new u(1,0,0),X=new u(0,1,0),Y=new u(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=P(fe)),this.add(this.gizmo.rotate=P(te)),this.add(this.gizmo.scale=P(me)),this.add(this.picker.translate=P(ne)),this.add(this.picker.rotate=P(re)),this.add(this.picker.scale=P($)),this.add(this.helper.translate=P(ee)),this.add(this.helper.rotate=P(J)),this.add(this.helper.scale=P(_)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var t=this.space;this.mode==="scale"&&(t="local");var i=t==="local"?this.worldQuaternion:N;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";var s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(var n=0;n<s.length;n++){var e=s[n];e.visible=!0,e.rotation.set(0,0,0),e.position.copy(this.worldPosition);var Z;if(this.camera.isOrthographicCamera?Z=(this.camera.top-this.camera.bottom)/this.camera.zoom:Z=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),e.scale.set(1,1,1).multiplyScalar(Z*this.size/7),e.tag==="helper"){e.visible=!1,e.name==="AXIS"?(e.position.copy(this.worldPositionStart),e.visible=!!this.axis,this.axis==="X"&&(a.setFromEuler(E.set(0,0,0)),e.quaternion.copy(i).multiply(a),Math.abs(m.copy(C).applyQuaternion(i).dot(this.eye))>.9&&(e.visible=!1)),this.axis==="Y"&&(a.setFromEuler(E.set(0,0,Math.PI/2)),e.quaternion.copy(i).multiply(a),Math.abs(m.copy(X).applyQuaternion(i).dot(this.eye))>.9&&(e.visible=!1)),this.axis==="Z"&&(a.setFromEuler(E.set(0,Math.PI/2,0)),e.quaternion.copy(i).multiply(a),Math.abs(m.copy(Y).applyQuaternion(i).dot(this.eye))>.9&&(e.visible=!1)),this.axis==="XYZE"&&(a.setFromEuler(E.set(0,Math.PI/2,0)),m.copy(this.rotationAxis),e.quaternion.setFromRotationMatrix(oe.lookAt(q,m,X)),e.quaternion.multiply(a),e.visible=this.dragging),this.axis==="E"&&(e.visible=!1)):e.name==="START"?(e.position.copy(this.worldPositionStart),e.visible=this.dragging):e.name==="END"?(e.position.copy(this.worldPosition),e.visible=this.dragging):e.name==="DELTA"?(e.position.copy(this.worldPositionStart),e.quaternion.copy(this.worldQuaternionStart),ie.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),ie.applyQuaternion(this.worldQuaternionStart.clone().invert()),e.scale.copy(ie),e.visible=this.dragging):(e.quaternion.copy(i),this.dragging?e.position.copy(this.worldPositionStart):e.position.copy(this.worldPosition),this.axis&&(e.visible=this.axis.search(e.name)!==-1));continue}if(e.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"){var j=.99,r=.2,ae=0;(e.name==="X"||e.name==="XYZX")&&(Math.abs(m.copy(C).applyQuaternion(i).dot(this.eye))>j&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)),(e.name==="Y"||e.name==="XYZY")&&(Math.abs(m.copy(X).applyQuaternion(i).dot(this.eye))>j&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)),(e.name==="Z"||e.name==="XYZZ")&&(Math.abs(m.copy(Y).applyQuaternion(i).dot(this.eye))>j&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)),e.name==="XY"&&(Math.abs(m.copy(Y).applyQuaternion(i).dot(this.eye))<r&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)),e.name==="YZ"&&(Math.abs(m.copy(C).applyQuaternion(i).dot(this.eye))<r&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)),e.name==="XZ"&&(Math.abs(m.copy(X).applyQuaternion(i).dot(this.eye))<r&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)),e.name.search("X")!==-1&&(m.copy(C).applyQuaternion(i).dot(this.eye)<ae?e.tag==="fwd"?e.visible=!1:e.scale.x*=-1:e.tag==="bwd"&&(e.visible=!1)),e.name.search("Y")!==-1&&(m.copy(X).applyQuaternion(i).dot(this.eye)<ae?e.tag==="fwd"?e.visible=!1:e.scale.y*=-1:e.tag==="bwd"&&(e.visible=!1)),e.name.search("Z")!==-1&&(m.copy(Y).applyQuaternion(i).dot(this.eye)<ae?e.tag==="fwd"?e.visible=!1:e.scale.z*=-1:e.tag==="bwd"&&(e.visible=!1))}else this.mode==="rotate"&&(O.copy(i),m.copy(this.eye).applyQuaternion(a.copy(i).invert()),e.name.search("E")!==-1&&e.quaternion.setFromRotationMatrix(oe.lookAt(this.eye,q,X)),e.name==="X"&&(a.setFromAxisAngle(C,Math.atan2(-m.y,m.z)),a.multiplyQuaternions(O,a),e.quaternion.copy(a)),e.name==="Y"&&(a.setFromAxisAngle(X,Math.atan2(m.x,m.z)),a.multiplyQuaternions(O,a),e.quaternion.copy(a)),e.name==="Z"&&(a.setFromAxisAngle(Y,Math.atan2(m.y,m.x)),a.multiplyQuaternions(O,a),e.quaternion.copy(a)));e.visible=e.visible&&(e.name.indexOf("X")===-1||this.showX),e.visible=e.visible&&(e.name.indexOf("Y")===-1||this.showY),e.visible=e.visible&&(e.name.indexOf("Z")===-1||this.showZ),e.visible=e.visible&&(e.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),e.material._opacity=e.material._opacity||e.material.opacity,e.material._color=e.material._color||e.material.color.clone(),e.material.color.copy(e.material._color),e.material.opacity=e.material._opacity,this.enabled?this.axis&&(e.name===this.axis?(e.material.opacity=1,e.material.color.lerp(new le(1,1,1),.5)):this.axis.split("").some(function(se){return e.name===se})?(e.material.opacity=1,e.material.color.lerp(new le(1,1,1),.5)):(e.material.opacity*=.25,e.material.color.lerp(new le(1,1,1),.5))):(e.material.opacity*=.5,e.material.color.lerp(new le(1,1,1),.5))}B.prototype.updateMatrixWorld.call(this)}};ue.prototype=Object.assign(Object.create(B.prototype),{constructor:ue,isTransformControlsGizmo:!0});var pe=function(){o.call(this,new K(1e5,1e5,2,2),new ge({visible:!1,wireframe:!0,side:ye,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var x=new u(1,0,0),c=new u(0,1,0),p=new u(0,0,1),v=new u,l=new u,y=new u,z=new be,b=new Q;this.updateMatrixWorld=function(){var W=this.space;this.position.copy(this.worldPosition),this.mode==="scale"&&(W="local"),x.set(1,0,0).applyQuaternion(W==="local"?this.worldQuaternion:b),c.set(0,1,0).applyQuaternion(W==="local"?this.worldQuaternion:b),p.set(0,0,1).applyQuaternion(W==="local"?this.worldQuaternion:b),y.copy(c);switch(this.mode){case"translate":case"scale":switch(this.axis){case"X":y.copy(this.eye).cross(x),l.copy(x).cross(y);break;case"Y":y.copy(this.eye).cross(c),l.copy(c).cross(y);break;case"Z":y.copy(this.eye).cross(p),l.copy(p).cross(y);break;case"XY":l.copy(p);break;case"YZ":l.copy(x);break;case"XZ":y.copy(p),l.copy(c);break;case"XYZ":case"E":l.set(0,0,0);break}break;case"rotate":default:l.set(0,0,0)}l.length()===0?this.quaternion.copy(this.cameraQuaternion):(z.lookAt(v.set(0,0,0),l,y),this.quaternion.setFromRotationMatrix(z)),B.prototype.updateMatrixWorld.call(this)}};pe.prototype=Object.assign(Object.create(o.prototype),{constructor:pe,isTransformControlsPlane:!0});export{de as TransformControls,ue as TransformControlsGizmo,pe as TransformControlsPlane};
