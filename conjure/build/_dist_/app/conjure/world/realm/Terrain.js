import*as o from" https://cdn.skypack.dev/pin/three@v0.123.0-STd7XeVUbImsNuMmqKGL/min/three.js";import{ImprovedNoise as g}from"../../../../../web_modules/three/examples/jsm/math/ImprovedNoise.js";import{POSTPROCESSING as b}from"../../PostProcessing.js";import{createGeometry as v,createMaterial as j}from"../../util/wireframe/index.js";export default class f{constructor(s,m,p){let l=Date.now();this.conjure=s,this.terrainObject=new o.Group,this.parentGroup=m,this.vec3=new o.Vector3,this.grid_size=32,this.grid_scale=2;var n=j({thickness:.01},!0),r=new o.BufferGeometry,i=[],a=[];let t=0;var e=this.grid_size,h=this.grid_size,u=this.generateHeight(this.grid_size,this.grid_size,.25);for(let d=0;d<e;d++)for(let c=0;c<h;c++)i.push(d*this.grid_scale,0,c*this.grid_scale),d<e-1&&c<h-1&&(a.push(t,t+e+1,t+e),a.push(t+e+1,t,t+1)),t++;r.setAttribute("position",new o.BufferAttribute(new Float32Array(i),3)),r.setIndex(a),r=r.toNonIndexed(),r.computeVertexNormals(),v(r,!0,!0),this.mesh=new o.Mesh(r,n),this.terrainObject.add(this.mesh),this.mesh.layers.enable(b.BLOOM_SCENE),this.terrainObject.name="platform",this.terrainObject.receiveShadow=!0,this.terrainObject.position.set(-this.grid_scale*this.grid_size*.5,-2,-this.grid_scale*this.grid_size*.5),this.parentGroup.add(this.terrainObject),this.conjure.physics.add.existing(this.terrainObject,{shape:"concaveMesh",mass:0}),this.terrainObject.body.setAngularFactor(0,0,0),this.terrainObject.body.setLinearFactor(0,0,0)}generateHeight(s,m,p){var l=s*m;let n=new Uint8Array(l),r=new g,i=1,a=0;for(var t=0;t<4;t++){for(var e=0;e<l;e++){var h=e%s,u=~~(e/s);n[e]+=Math.abs(r.noise(h/i,u/i,a)*i*1.75*p)}i*=3}return n}destroy(){this.terrainObject.body&&this.conjure.physics.destroy(this.terrainObject.body),this.parentGroup.remove(this.terrainObject)}}
