import{p as fe}from"./process-e9e98960.js";import"./EventDispatcher-68e7f1a9.js";import{b as ea}from"./buffer-es6-e6024076.js";import{b as Q,s as Qr,a as me,m as Gg,k as Vg,c as sd,d as ao,i as nr,f as U,o as ad,e as ta,r as Hg}from"./index-41b3486d.js";import{e as F,c as Yr,s as Rc}from"./index-39e7ae42.js";import{g as Oe,v as ie,f as Tn,h as ir,i as Dr,k as od,s as zg}from"./datastore-utils-f1365abf.js";import{c as ee,a as se,g as Wg,d as Kg,b as Xg}from"./_commonjsHelpers-c99fd594.js";import"./constants-83de7adf.js";import{f as qe}from"./from-string-5d106fde.js";import{t as ae}from"./to-string-b6e14ed9.js";import{e as It}from"./events-18451fd5.js";import{r as ai}from"./__node-resolve:empty-8495aa00.js";import"./util-17dff6c2.js";import{a as ra}from"./url-8d978716.js";import{n as kc}from"./empty-add391ca.js";import{p as Qg}from"./path-d977e441.js";import{r as Yg}from"./_node-fetch_commonjs-proxy-271b4446.js";import{a as cd,b as Wt,s as Rt,B as ht,c as Je,d as na,e as sr,h as Jg,r as Pc,p as Zg,f as ey,g as ld,j as ty}from"./index-3b8c5d36.js";import{d as ry}from"./dhtConfig-73de4e98.js";(function(){if(typeof globalThis=="object")return;Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__})();var An=globalThis;const ny=async t=>{const e=[];for await(const r of t)e.push(r);return e};var ud=ny;class dd extends Error{constructor(t){super(t||"Promise was canceled");this.name="CancelError"}get isCanceled(){return!0}}class Nc{static fn(t){return(...e)=>new Nc((r,n,i)=>{e.push(i),t(...e).then(r,n)})}constructor(t){this._cancelHandlers=[],this._isPending=!0,this._isCanceled=!1,this._rejectOnCancel=!0,this._promise=new Promise((e,r)=>{this._reject=r;const n=a=>{this._isPending=!1,e(a)},i=a=>{this._isPending=!1,r(a)},s=a=>{if(!this._isPending)throw new Error("The `onCancel` handler was attached after the promise settled.");this._cancelHandlers.push(a)};return Object.defineProperties(s,{shouldReject:{get:()=>this._rejectOnCancel,set:a=>{this._rejectOnCancel=a}}}),t(n,i,s)})}then(t,e){return this._promise.then(t,e)}catch(t){return this._promise.catch(t)}finally(t){return this._promise.finally(t)}cancel(t){if(!this._isPending||this._isCanceled)return;if(this._cancelHandlers.length>0)try{for(const e of this._cancelHandlers)e()}catch(e){this._reject(e)}this._isCanceled=!0,this._rejectOnCancel&&this._reject(new dd(t))}get isCanceled(){return this._isCanceled}}Object.setPrototypeOf(Nc.prototype,Promise.prototype);var Oc=Nc,iy=dd;Oc.CancelError=iy;class pd extends Error{}const sy=(t,e)=>new Oc((r,n,i)=>{const{count:s,filter:a=()=>!0}=e;if(!Number.isFinite(s)){n(new TypeError(`Expected a finite number, got ${typeof e.count}`));return}const c=[],o=[];let l=0,u=!1;const h=new Set,S=()=>(c.length===s&&(r(c),u=!0),l-o.length<s&&(n(new cd(o)),u=!0),u),p=()=>{for(const C of t)!h.has(C)&&typeof C.cancel=="function"&&C.cancel()};i(p);for(const C of t)l++,(async()=>{try{const T=await C;if(u)return;if(!a(T))throw new pd("Value does not satisfy filter");c.push(T)}catch(T){o.push(T)}finally{h.add(C),!u&&S()&&p()}})();s>l&&(n(new RangeError(`Expected input to contain at least ${e.count} items, but contains ${l} items`)),p())});var oo=sy,ay=cd,oy=pd;oo.AggregateError=ay,oo.FilterError=oy;var ia=(t,e)=>{const r=oo(t,{...e,count:1});return Oc.fn(async n=>{n(()=>{r.cancel()});const[i]=await r;return i})()},cy=oo.AggregateError;ia.AggregateError=cy;const Ui=new Map,ly=()=>`${Date.now()}:${Math.floor(Math.random()*1e6)}`;async function uy(t,e,r){for(;Ui.get(r);){try{await t()}catch(n){setTimeout(()=>{throw n},1);break}if(!Ui.get(r))break;await new Promise(n=>{const i=setTimeout(n,e);Ui.set(r,i)})}}function dy(t,e,r){r=r||e;const n=ly(),i=setTimeout(()=>{uy(t,e,n)},r);return Ui.set(n,i),n}function py(t){const e=Ui.get(t);e&&(clearTimeout(e),Ui.delete(t))}var hd={setDelayedInterval:dy,clearDelayedInterval:py};const hy=Object.assign(Q("libp2p:peer-routing"),{error:Q("libp2p:peer-routing:err")}),{setDelayedInterval:fy,clearDelayedInterval:my}=hd;class gy{constructor(t){this._peerId=t.peerId,this._peerStore=t.peerStore,this._routers=t._modules.peerRouting||[],t._dht&&this._routers.unshift(t._dht),this._refreshManagerOptions=t._options.peerRouting.refreshManager,this._findClosestPeersTask=this._findClosestPeersTask.bind(this)}start(){if(!this._routers.length||this._timeoutId||!this._refreshManagerOptions.enabled)return;this._timeoutId=fy(this._findClosestPeersTask,this._refreshManagerOptions.interval,this._refreshManagerOptions.bootDelay)}async _findClosestPeersTask(){try{for await(const{id:t,multiaddrs:e}of this.getClosestPeers(this._peerId.id))this._peerStore.addressBook.add(t,e)}catch(t){hy.error(t)}}stop(){my(this._timeoutId)}async findPeer(t,e){if(!this._routers.length)throw F(new Error("No peer routers available"),"NO_ROUTERS_AVAILABLE");return ia(this._routers.map(async r=>{const n=await r.findPeer(t,e);if(!n||Object.keys(n).length===0)throw F(new Error("not found"),"NOT_FOUND");return n}))}async*getClosestPeers(t,e={timeout:3e4}){if(!this._routers.length)throw F(new Error("No peer routers available"),"NO_ROUTERS_AVAILABLE");const r=await ia(this._routers.map(async n=>{const i=await ud(n.getClosestPeers(t,e));if(!i||!i.length)throw F(new Error("not found"),"NOT_FOUND");return i}));for(const n of r)yield n}}var yy=gy,by={NOT_STARTED_YET:"The libp2p node is not started yet",DHT_DISABLED:"DHT is not available",CONN_ENCRYPTION_REQUIRED:"At least one connection encryption module is required"},vy={DHT_DISABLED:"ERR_DHT_DISABLED",PUBSUB_NOT_STARTED:"ERR_PUBSUB_NOT_STARTED",DHT_NOT_STARTED:"ERR_DHT_NOT_STARTED",CONN_ENCRYPTION_REQUIRED:"ERR_CONN_ENCRYPTION_REQUIRED",ERR_CONNECTION_ENDED:"ERR_CONNECTION_ENDED",ERR_CONNECTION_FAILED:"ERR_CONNECTION_FAILED",ERR_NODE_NOT_STARTED:"ERR_NODE_NOT_STARTED",ERR_ALREADY_ABORTED:"ERR_ALREADY_ABORTED",ERR_NO_VALID_ADDRESSES:"ERR_NO_VALID_ADDRESSES",ERR_DIALED_SELF:"ERR_DIALED_SELF",ERR_DISCOVERED_SELF:"ERR_DISCOVERED_SELF",ERR_DUPLICATE_TRANSPORT:"ERR_DUPLICATE_TRANSPORT",ERR_ENCRYPTION_FAILED:"ERR_ENCRYPTION_FAILED",ERR_HOP_REQUEST_FAILED:"ERR_HOP_REQUEST_FAILED",ERR_INVALID_KEY:"ERR_INVALID_KEY",ERR_INVALID_MESSAGE:"ERR_INVALID_MESSAGE",ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS",ERR_INVALID_PEER:"ERR_INVALID_PEER",ERR_MUXER_UNAVAILABLE:"ERR_MUXER_UNAVAILABLE",ERR_TIMEOUT:"ERR_TIMEOUT",ERR_TRANSPORT_UNAVAILABLE:"ERR_TRANSPORT_UNAVAILABLE",ERR_TRANSPORT_DIAL_FAILED:"ERR_TRANSPORT_DIAL_FAILED",ERR_UNSUPPORTED_PROTOCOL:"ERR_UNSUPPORTED_PROTOCOL",ERR_INVALID_MULTIADDR:"ERR_INVALID_MULTIADDR",ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"},ft={messages:by,codes:vy};const{messages:Mc,codes:Dc}=ft;class wy{constructor(t){this.libp2p=t,this.routers=t._modules.contentRouting||[],this.dht=t._dht,this.dht&&this.routers.unshift(this.dht)}async*findProviders(t,e){if(!this.routers.length)throw F(new Error("No content this.routers available"),"NO_ROUTERS_AVAILABLE");const r=await ia(this.routers.map(async n=>{const i=await ud(n.findProviders(t,e));if(!i||!i.length)throw F(new Error("not found"),"NOT_FOUND");return i}));for(const n of r)yield n}async provide(t){if(!this.routers.length)throw F(new Error("No content routers available"),"NO_ROUTERS_AVAILABLE");await Promise.all(this.routers.map(e=>e.provide(t)))}put(t,e,r){if(!this.libp2p.isStarted()||!this.dht.isStarted)throw F(new Error(Mc.NOT_STARTED_YET),Dc.DHT_NOT_STARTED);return this.dht.put(t,e,r)}get(t,e){if(!this.libp2p.isStarted()||!this.dht.isStarted)throw F(new Error(Mc.NOT_STARTED_YET),Dc.DHT_NOT_STARTED);return this.dht.get(t,e)}async getMany(t,e,r){if(!this.libp2p.isStarted()||!this.dht.isStarted)throw F(new Error(Mc.NOT_STARTED_YET),Dc.DHT_NOT_STARTED);return this.dht.getMany(t,e,r)}}var Sy=wy;const _y=Wt,xc=Wt.v4,fd=Wt.v6,md=function(t,e,r){r=~~r;var n;if(xc(t))n=e||new Uint8Array(r+4),t.split(/\./g).map(function(u){n[r++]=parseInt(u,10)&255});else if(fd(t)){var i=t.split(":",8),s;for(s=0;s<i.length;s++){var a=xc(i[s]),c;a&&(c=md(i[s]),i[s]=ae(c.slice(0,2),"base16")),c&&++s<8&&i.splice(s,0,ae(c.slice(2,4),"base16"))}if(i[0]==="")for(;i.length<8;)i.unshift("0");else if(i[i.length-1]==="")for(;i.length<8;)i.push("0");else if(i.length<8){for(s=0;s<i.length&&i[s]!=="";s++);var o=[s,"1"];for(s=9-i.length;s>0;s--)o.push("0");i.splice.apply(i,o)}for(n=e||new Uint8Array(r+16),s=0;s<i.length;s++){var l=parseInt(i[s],16);n[r++]=l>>8&255,n[r++]=l&255}}if(!n)throw Error("Invalid ip address: "+t);return n},Ey=function(t,e,r){e=~~e,r=r||t.length-e;var n=[],i;const s=new DataView(t.buffer);if(r===4){for(let a=0;a<r;a++)n.push(t[e+a]);i=n.join(".")}else if(r===16){for(let a=0;a<r;a+=2)n.push(s.getUint16(e+a).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i};var co={isIP:_y,isV4:xc,isV6:fd,toBytes:md,toString:Ey};function Lt(t){if(typeof t=="number"){if(Lt.codes[t])return Lt.codes[t];throw new Error("no protocol with code: "+t)}else if(typeof t=="string"||t instanceof String){if(Lt.names[t])return Lt.names[t];throw new Error("no protocol with name: "+t)}throw new Error("invalid protocol id type: "+t)}const ar=-1;Lt.lengthPrefixedVarSize=ar,Lt.V=ar,Lt.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,ar,"ip6zone"],[53,ar,"dns","resolvable"],[54,ar,"dns4","resolvable"],[55,ar,"dns6","resolvable"],[56,ar,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,ar,"unix",!1,"path"],[421,ar,"ipfs"],[421,ar,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,ar,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,ar,"memory"]],Lt.names={},Lt.codes={},Lt.table.map(t=>{const e=gd.apply(null,t);Lt.codes[e.code]=e,Lt.names[e.name]=e}),Lt.object=gd;function gd(t,e,r,n,i){return{code:t,size:e,name:r,resolvable:Boolean(n),path:Boolean(i)}}var br=Lt,yd=sa;function sa(t,e){return e instanceof Uint8Array?sa.toString(t,e):sa.toBytes(t,e)}sa.toString=function(e,r){e=br(e);switch(e.code){case 4:case 41:return Ty(r);case 6:case 273:case 33:case 132:return vd(r);case 53:case 54:case 55:case 56:case 400:case 777:return Cy(r);case 421:return Ry(r);case 444:return wd(r);case 445:return wd(r);default:return ae(r,"base16")}},sa.toBytes=function(e,r){e=br(e);switch(e.code){case 4:return bd(r);case 41:return bd(r);case 6:case 273:case 33:case 132:return Lc(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return Ay(r);case 421:return Iy(r);case 444:return ky(r);case 445:return Py(r);default:return qe(r,"base16")}};function bd(t){if(!co.isIP(t))throw new Error("invalid ip address");return co.toBytes(t)}function Ty(t){const e=co.toString(t);if(!e||!co.isIP(e))throw new Error("invalid ip address");return e}function Lc(t){const e=new ArrayBuffer(2),r=new DataView(e);return r.setUint16(0,t),new Uint8Array(e)}function vd(t){const e=new DataView(t.buffer);return e.getUint16(0)}function Ay(t){const e=qe(t),r=Uint8Array.from(ie.encode(e.length));return Oe([r,e],r.length+e.length)}function Cy(t){const e=ie.decode(t);if(t=t.slice(ie.decode.bytes),t.length!==e)throw new Error("inconsistent lengths");return ae(t)}function Iy(t){const e=new Qr(t).multihash,r=Uint8Array.from(ie.encode(e.length));return Oe([r,e],r.length+e.length)}function Ry(t){const e=ie.decode(t),r=t.slice(ie.decode.bytes);if(r.length!==e)throw new Error("inconsistent lengths");return ae(r,"base58btc")}function ky(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==16)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion address.");const r=Tn.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Lc(n);return Oe([r,i],r.length+i.length)}function Py(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==56)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion3 address.");const r=Tn.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Lc(n);return Oe([r,i],r.length+i.length)}function wd(t){const e=t.slice(0,t.length-2),r=t.slice(t.length-2),n=ae(e,"base32"),i=vd(r);return n+":"+i}var vr={stringToStringTuples:Sd,stringTuplesToString:_d,tuplesToStringTuples:Td,stringTuplesToTuples:Ed,bytesToTuples:Bc,tuplesToBytes:Ad,bytesToString:Ny,stringToBytes:Id,fromString:Oy,fromBytes:Rd,validateBytes:jc,isValidBytes:My,cleanPath:lo,ParseError:Uc,protoFromTuple:aa,sizeForAddr:Cd};function Sd(t){const e=[],r=t.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let n=0;n<r.length;n++){const i=r[n],s=br(i);if(s.size===0){e.push([i]);continue}if(n++,n>=r.length)throw Uc("invalid address: "+t);if(s.path){e.push([i,lo(r.slice(n).join("/"))]);break}e.push([i,r[n]])}return e}function _d(t){const e=[];return t.map(r=>{const n=aa(r);e.push(n.name),r.length>1&&e.push(r[1])}),lo(e.join("/"))}function Ed(t){return t.map(e=>{Array.isArray(e)||(e=[e]);const r=aa(e);return e.length>1?[r.code,yd.toBytes(r.code,e[1])]:[r.code]})}function Td(t){return t.map(e=>{const r=aa(e);return e.length>1?[r.code,yd.toString(r.code,e[1])]:[r.code]})}function Ad(t){return Rd(Oe(t.map(e=>{const r=aa(e);let n=Uint8Array.from(ie.encode(r.code));return e.length>1&&(n=Oe([n,e[1]])),n})))}function Cd(t,e){if(t.size>0)return t.size/8;if(t.size===0)return 0;{const r=ie.decode(e);return r+ie.decode.bytes}}function Bc(t){const e=[];let r=0;for(;r<t.length;){const n=ie.decode(t,r),i=ie.decode.bytes,s=br(n),a=Cd(s,t.slice(r+i));if(a===0){e.push([n]),r+=i;continue}const c=t.slice(r+i,r+i+a);if(r+=a+i,r>t.length)throw Uc("Invalid address Uint8Array: "+ae(t,"base16"));e.push([n,c])}return e}function Ny(t){const e=Bc(t),r=Td(e);return _d(r)}function Id(t){t=lo(t);const e=Sd(t),r=Ed(e);return Ad(r)}function Oy(t){return Id(t)}function Rd(t){const e=jc(t);if(e)throw e;return Uint8Array.from(t)}function jc(t){try{Bc(t)}catch(e){return e}}function My(t){return jc(t)===void 0}function lo(t){return"/"+t.trim().split("/").filter(e=>e).join("/")}function Uc(t){return new Error("Error parsing address: "+t)}function aa(t){const e=br(t[0]);return e}var ze=ee(function(t,e){const r=Symbol.for("nodejs.util.inspect.custom"),n=new Map,i=Yr.proto(function(s){if(!(this instanceof i))return new i(s);if(s==null&&(s=""),s instanceof Uint8Array)this.bytes=vr.fromBytes(s);else if(typeof s=="string"||s instanceof String){if(s.length>0&&s.charAt(0)!=="/")throw new Error(`multiaddr "${s}" must start with a "/"`);this.bytes=vr.fromString(s)}else if(s.bytes&&s.protos&&s.protoCodes)this.bytes=vr.fromBytes(s.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});i.prototype.toString=function(){return vr.bytesToString(this.bytes)},i.prototype.toJSON=i.prototype.toString,i.prototype.toOptions=function(){const a={},c=this.toString().split("/");return a.family=c[1]==="ip4"?"ipv4":"ipv6",a.host=c[2],a.transport=c[3],a.port=parseInt(c[4]),a},i.prototype[r]=function(){return"<Multiaddr "+ae(this.bytes,"base16")+" - "+vr.bytesToString(this.bytes)+">"},i.prototype.inspect=function(){return"<Multiaddr "+ae(this.bytes,"base16")+" - "+vr.bytesToString(this.bytes)+">"},i.prototype.protos=function(){return this.protoCodes().map(a=>Object.assign({},br(a)))},i.prototype.protoCodes=function(){const a=[],c=this.bytes;let o=0;for(;o<c.length;){const l=ie.decode(c,o),u=ie.decode.bytes,h=br(l),S=vr.sizeForAddr(h,c.slice(o+u));o+=S+u,a.push(l)}return a},i.prototype.protoNames=function(){return this.protos().map(a=>a.name)},i.prototype.tuples=function(){return vr.bytesToTuples(this.bytes)},i.prototype.stringTuples=function(){const a=vr.bytesToTuples(this.bytes);return vr.tuplesToStringTuples(a)},i.prototype.encapsulate=function(a){return a=i(a),i(this.toString()+a.toString())},i.prototype.decapsulate=function(a){a=a.toString();const c=this.toString(),o=c.lastIndexOf(a);if(o<0)throw new Error("Address "+this+" does not contain subaddress: "+a);return i(c.slice(0,o))},i.prototype.decapsulateCode=function(a){const c=this.tuples();for(let o=c.length-1;o>=0;o--)if(c[o][0]===a)return i(vr.tuplesToBytes(c.slice(0,o)));return this},i.prototype.getPeerId=function(){let a=null;try{const c=this.stringTuples().filter(o=>{if(o[0]===br.names.ipfs.code)return!0});a=c.pop()[1],a=ae(new Qr(a).multihash,"base58btc")}catch(c){a=null}return a},i.prototype.getPath=function(){let a=null;try{a=this.stringTuples().filter(c=>{const o=br(c[0]);if(o.path)return!0})[0][1]}catch(c){a=null}return a},i.prototype.equals=function(a){return ir(this.bytes,a.bytes)},i.prototype.resolve=async function(){const a=this.protos().find(l=>l.resolvable);if(!a)return[this];const c=n.get(a.name);if(!c)throw F(new Error(`no available resolver for ${a.name}`),"ERR_NO_AVAILABLE_RESOLVER");const o=await c(this);return o.map(l=>i(l))},i.prototype.nodeAddress=function(){const a=this.protoCodes(),c=this.protoNames(),o=this.toString().split("/").slice(1);if(o.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(a[0]!==4&&a[0]!==41&&a[0]!==54&&a[0]!==55)throw new Error(`no protocol with name: "'${c[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(o[2]!=="tcp"&&o[2]!=="udp")throw new Error(`no protocol with name: "'${c[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:a[0]===41||a[0]===55?6:4,address:o[1],port:parseInt(o[3])}},i.fromNodeAddress=function(a,c){if(!a)throw new Error("requires node address object");if(!c)throw new Error("requires transport protocol");let o;switch(a.family){case"IPv4":o="ip4";break;case"IPv6":o="ip6";break;default:throw Error(`Invalid addr family. Got '${a.family}' instead of 'IPv4' or 'IPv6'`)}return i("/"+[o,a.address,c,a.port].join("/"))},i.prototype.isThinWaistAddress=function(a){const c=(a||this).protos();return c.length!==2||c[0].code!==4&&c[0].code!==41?!1:!(c[1].code!==6&&c[1].code!==273)},i.protocols=br,i.isName=function(a){return i.isMultiaddr(a)?a.protos().some(c=>c.resolvable):!1},i.resolve=function(a){return!i.isMultiaddr(a)||!i.isName(a)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},i.resolvers=n,e=t.exports=i});const{codes:Dy}=ft;function xy(t){typeof t=="string"&&(t=ze(t));let e;if(ze.isMultiaddr(t)){e=t;try{t=me.createFromB58String(t.getPeerId())}catch(r){throw F(new Error(`${t} is not a valid peer type`),Dy.ERR_INVALID_MULTIADDR)}}return{id:t,multiaddrs:e?[e]:void 0}}var uo=xy,Ly=kd,Cn=kd.prototype,By=new Date%1e9;function jy(){return(Math.random()*1e9>>>0)+By++}function kd(t){t=t||{},this.id=t.id||jy(),this.max=t.max||Infinity,this.items=t.items||[],this._lookup={},this.size=this.items.length,this.lastModified=new Date(t.lastModified||new Date);for(var e,r,n=this.items.length;n--;)e=this.items[n],r=new Date(e.expires)-new Date,this._lookup[e.key]=e,r>0?this.expire(e.key,r):r<=0&&this.delete(e.key)}Cn.has=function(t){return t in this._lookup},Cn.get=function(t){if(!this.has(t))return null;var e=this._lookup[t];return e.refresh&&this.expire(t,e.refresh),this.items.splice(this.items.indexOf(e),1),this.items.push(e),e.value},Cn.meta=function(t){if(!this.has(t))return null;var e=this._lookup[t];return"meta"in e?e.meta:null},Cn.set=function(t,e,r){var n=this._lookup[t],i=this._lookup[t]={key:t,value:e};return this.lastModified=new Date,n?(clearTimeout(n.timeout),this.items.splice(this.items.indexOf(n),1,i)):(this.size>=this.max&&this.delete(this.items[0].key),this.items.push(i),this.size++),r&&("ttl"in r&&this.expire(t,r.ttl),"meta"in r&&(i.meta=r.meta),r.refresh&&(i.refresh=r.ttl)),this},Cn.delete=function(t){var e=this._lookup[t];return e?(this.lastModified=new Date,this.items.splice(this.items.indexOf(e),1),clearTimeout(e.timeout),delete this._lookup[t],this.size--,this):!1},Cn.expire=function(t,e){var r=e||0,n=this._lookup[t];if(!n)return this;if(typeof r=="string"&&(r=Gg(e)),typeof r!="number")throw new TypeError("Expiration time must be a string or number.");return clearTimeout(n.timeout),n.timeout=setTimeout(this.delete.bind(this,n.key),r),n.expires=Number(new Date)+r,this},Cn.clear=function(){for(var t=this.items.length;t--;)this.delete(this.items[t].key);return this},Cn.toJSON=function(){for(var t=new Array(this.items.length),e,r=t.length;r--;)e=this.items[r],t[r]={key:e.key,meta:e.meta,value:e.value,expires:e.expires,refresh:e.refresh};return{id:this.id,max:isFinite(this.max)?this.max:void 0,lastModified:this.lastModified,items:t}};var Pd=Object.prototype.toString,Nd=function(e){var r=Pd.call(e),n=r==="[object Arguments]";return n||(n=r!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Pd.call(e.callee)==="[object Function]"),n},Od;if(!Object.keys){var po=Object.prototype.hasOwnProperty,Md=Object.prototype.toString,Uy=Nd,Dd=Object.prototype.propertyIsEnumerable,Fy=!Dd.call({toString:null},"toString"),$y=Dd.call(function(){},"prototype"),ho=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Fc=function(t){var e=t.constructor;return e&&e.prototype===t},qy={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Gy=function(){if(typeof window=="undefined")return!1;for(var t in window)try{if(!qy["$"+t]&&po.call(window,t)&&window[t]!==null&&typeof window[t]=="object")try{Fc(window[t])}catch(e){return!0}}catch(e){return!0}return!1}(),Vy=function(t){if(typeof window=="undefined"||!Gy)return Fc(t);try{return Fc(t)}catch(e){return!1}};Od=function(e){var r=e!==null&&typeof e=="object",n=Md.call(e)==="[object Function]",i=Uy(e),s=r&&Md.call(e)==="[object String]",a=[];if(!r&&!n&&!i)throw new TypeError("Object.keys called on a non-object");var c=$y&&n;if(s&&e.length>0&&!po.call(e,0))for(var o=0;o<e.length;++o)a.push(String(o));if(i&&e.length>0)for(var l=0;l<e.length;++l)a.push(String(l));else for(var u in e)!(c&&u==="prototype")&&po.call(e,u)&&a.push(String(u));if(Fy)for(var h=Vy(e),S=0;S<ho.length;++S)!(h&&ho[S]==="constructor")&&po.call(e,ho[S])&&a.push(ho[S]);return a}}var Hy=Od,zy=Array.prototype.slice,xd=Object.keys,fo=xd?function(e){return xd(e)}:Hy,Ld=Object.keys;fo.shim=function(){if(Object.keys){var e=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);e||(Object.keys=function(n){return Nd(n)?Ld(zy.call(n)):Ld(n)})}else Object.keys=fo;return Object.keys||fo};var Wy=fo,Ky=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",Xy=Object.prototype.toString,Qy=Array.prototype.concat,$c=Object.defineProperty,Yy=function(t){return typeof t=="function"&&Xy.call(t)==="[object Function]"},Jy=function(){var t={};try{$c(t,"x",{enumerable:!1,value:t});for(var e in t)return!1;return t.x===t}catch(r){return!1}},Bd=$c&&Jy(),Zy=function(t,e,r,n){if(e in t&&(!Yy(n)||!n()))return;Bd?$c(t,e,{configurable:!0,enumerable:!1,value:r,writable:!0}):t[e]=r},jd=function(t,e){var r=arguments.length>2?arguments[2]:{},n=Wy(e);Ky&&(n=Qy.call(n,Object.getOwnPropertySymbols(e)));for(var i=0;i<n.length;i+=1)Zy(t,n[i],e[n[i]],r[n[i]])};jd.supportsDescriptors=!!Bd;var Ud=jd,Fd=ee(function(t){typeof self!="undefined"?t.exports=self:typeof window!="undefined"?t.exports=window:t.exports=Function("return this")()}),qc=function(){return typeof se!="object"||!se||se.Math!==Math||se.Array!==Array?Fd:se},eb=function(){var e=qc();if(Ud.supportsDescriptors){var r=Object.getOwnPropertyDescriptor(e,"globalThis");(!r||r.configurable&&(r.enumerable||r.writable||globalThis!==e))&&Object.defineProperty(e,"globalThis",{configurable:!0,enumerable:!1,value:e,writable:!1})}else(typeof globalThis!="object"||globalThis!==e)&&(e.globalThis=e);return e},tb=qc(),$d=function(){return tb};Ud($d,{getPolyfill:qc,implementation:Fd,shim:eb});var rb=$d,nb=ee(function(t){const e=rb();e.fetch&&e.Headers&&e.Request&&e.Response?(t.exports=function(...n){return e.fetch(...n)},t.exports.Headers=e.Headers,t.exports.Request=e.Request,t.exports.Response=e.Response,t.exports.default=t.exports):t.exports=Yg});const{default:ib,Headers:sb}=nb;function ab({serverResolver:t,hostname:e,recordType:r}){return`${t}?name=${e}&type=${r}`}var ob=ab;function cb(t){return ib(t,{headers:new sb({accept:"application/dns-json"})})}var lb=cb;function ub(t,e){return`${e}_${t}`}var db=ub,pb={buildResource:ob,fetch:lb,getCacheKey:db};const mo=Q("dns-over-http-resolver");mo.error=Q("dns-over-http-resolver:error");const{buildResource:Gc,fetch:Vc,getCacheKey:Fi}=pb;class Hc{constructor({maxCache:t=100}={}){this._cache=new Ly({max:t}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"]}getServers(){return this._servers}_getShuffledServers(){const t=[].concat(this._servers);for(let e=t.length-1;e>0;e--){const r=Math.floor(Math.random()*e),n=t[e];t[e]=t[r],t[r]=n}return t}setServers(t){this._servers=t}resolve(t,e="A"){switch(e){case"A":return this.resolve4(t);case"AAAA":return this.resolve6(t);case"TXT":return this.resolveTxt(t);default:throw new Error(`${e} is not supported`)}}async resolve4(t){const e="A",r=this._cache.get(Fi(t,e));if(r)return r;for(const n of this._getShuffledServers())try{const i=await Vc(Gc({serverResolver:n,hostname:t,recordType:e})),s=await i.json(),a=s.Answer.map(o=>o.data),c=Math.min(s.Answer.map(o=>o.TTL));return this._cache.set(Fi(t,e),a,{ttl:c}),a}catch(i){mo.error(`${n} could not resolve ${t} record ${e}`)}throw new Error(`Could not resolve ${t} record ${e}`)}async resolve6(t){const e="AAAA",r=this._cache.get(Fi(t,e));if(r)return r;for(const n of this._getShuffledServers())try{const i=await Vc(Gc({serverResolver:n,hostname:t,recordType:e})),s=await i.json(),a=s.Answer.map(o=>o.data),c=Math.min(s.Answer.map(o=>o.TTL));return this._cache.set(Fi(t,e),a,{ttl:c}),a}catch(i){mo.error(`${n} could not resolve ${t} record ${e}`)}throw new Error(`Could not resolve ${t} record ${e}`)}async resolveTxt(t){const e="TXT",r=this._cache.get(Fi(t,e));if(r)return r;for(const n of this._getShuffledServers())try{const i=await Vc(Gc({serverResolver:n,hostname:t,recordType:e})),s=await i.json(),a=s.Answer.map(o=>[o.data.replace(/['"]+/g,"")]),c=Math.min(s.Answer.map(o=>o.TTL));return this._cache.set(Fi(t,e),a,{ttl:c}),a}catch(i){mo.error(`${n} could not resolve ${t} record ${e}`)}throw new Error(`Could not resolve ${t} record ${e}`)}}Hc.Resolver=Hc;var hb=Hc;let go;try{if(go=kc.promises,!go)throw new Error("no dns available")}catch(t){go=hb}var fb=go;const{code:mb}=br("dnsaddr");async function gb(t){const{Resolver:e}=fb,r=new e,n=t.getPeerId(),[,i]=t.stringTuples().find(([c])=>c===mb)||[],s=await r.resolveTxt(`_dnsaddr.${i}`);let a=s.flat().map(c=>c.split("=")[1]);return n&&(a=a.filter(c=>c.includes(n))),a}var yb={dnsaddrResolver:gb},oa={DIAL_TIMEOUT:3e4,MAX_PARALLEL_DIALS:100,MAX_PER_PEER_DIALS:4,METRICS:{computeThrottleMaxQueueSize:1e3,computeThrottleTimeout:2e3,movingAverageIntervals:[60*1e3,5*60*1e3,15*60*1e3],maxOldPeersRetention:50}};const bb="libp2p",vb="0.30.0",wb="JavaScript implementation of libp2p, a modular peer to peer network stack",Sb="Jacob Heun <jacobheun@gmail.com>",_b="src/index.js",Eb="dist/src/index.d.ts",Tb={"*":{"src/*":["dist/src/*","dist/src/*/index"]}},Ab=["dist","src"],Cb={lint:"aegir lint",build:"aegir build",test:"npm run test:node && npm run test:browser","test:node":'aegir test -t node -f "./test/**/*.{node,spec}.js"',"test:browser":"aegir test -t browser","test:examples":"cd examples && npm run test:all",release:"aegir release -t node -t browser","release-minor":"aegir release --type minor -t node -t browser","release-major":"aegir release --type major -t node -t browser",coverage:"nyc --reporter=text --reporter=lcov npm run test:node"},Ib={type:"git",url:"https://github.com/libp2p/js-libp2p.git"},Rb=["libp2p","network","p2p","peer","peer-to-peer","IPFS"],kb={url:"https://github.com/libp2p/js-libp2p/issues"},Pb="https://libp2p.io",Nb="MIT",Ob={node:">=12.0.0",npm:">=6.0.0"},Mb={"abort-controller":"^3.0.0","aggregate-error":"^3.0.1","any-signal":"^1.1.0","bignumber.js":"^9.0.0",cids:"^1.0.0","class-is":"^1.1.0",debug:"^4.1.1","err-code":"^2.0.0",events:"^3.1.0",hashlru:"^2.3.0","interface-datastore":"^2.0.0","ipfs-utils":"^5.0.1","it-all":"^1.0.1","it-buffer":"^0.1.2","it-handshake":"^1.0.1","it-length-prefixed":"^3.0.1","it-pipe":"^1.1.0","it-protocol-buffers":"^0.2.0","libp2p-crypto":"^0.18.0","libp2p-interfaces":"^0.8.1","libp2p-utils":"^0.2.2",mafmt:"^8.0.0","merge-options":"^2.0.0","moving-average":"^1.0.0",multiaddr:"^8.1.0",multicodec:"^2.0.0","multihashing-async":"^2.0.1","multistream-select":"^1.0.0","mutable-proxy":"^1.0.0","node-forge":"^0.9.1","p-any":"^3.0.0","p-fifo":"^1.0.0","p-settle":"^4.0.1","peer-id":"^0.14.2",protons:"^2.0.0",retimer:"^2.0.0","sanitize-filename":"^1.6.3","set-delayed-interval":"^1.0.0","streaming-iterables":"^5.0.2","timeout-abort-controller":"^1.1.1",varint:"^5.0.0",xsalsa20:"^1.0.2"},Db={"@nodeutils/defaults-deep":"^1.1.0","abortable-iterator":"^3.0.0",aegir:"^29.2.0","chai-bytes":"^0.1.2","chai-string":"^1.5.0",delay:"^4.3.0","interop-libp2p":"^0.3.0","into-stream":"^6.0.0","ipfs-http-client":"^47.0.1","it-concat":"^1.0.0","it-pair":"^1.0.0","it-pushable":"^1.4.0",libp2p:".","libp2p-bootstrap":"^0.12.0","libp2p-delegated-content-routing":"^0.8.0","libp2p-delegated-peer-routing":"^0.8.0","libp2p-floodsub":"^0.24.0","libp2p-gossipsub":"^0.7.0","libp2p-kad-dht":"^0.20.0","libp2p-mdns":"^0.15.0","libp2p-mplex":"^0.10.1","libp2p-noise":"^2.0.0","libp2p-secio":"^0.13.1","libp2p-tcp":"^0.15.1","libp2p-webrtc-star":"^0.20.0","libp2p-websockets":"^0.15.0",multihashes:"^3.0.1",nock:"^13.0.3","p-defer":"^3.0.0","p-times":"^3.0.0","p-wait-for":"^3.1.0","promisify-es6":"^1.0.3",rimraf:"^3.0.2",sinon:"^9.0.2",uint8arrays:"^1.1.0"},xb=["David Dias <daviddias.p@gmail.com>","Jacob Heun <jacobheun@gmail.com>","Vasco Santos <vasco.santos@moxy.studio>","Alan Shaw <alan@tableflip.io>","Alex Potsides <alex@achingbrain.net>","Cayman <caymannava@gmail.com>","Pedro Teixeira <i@pgte.me>","Friedel Ziegelmayer <dignifiedquire@gmail.com>","Maciej Kr\xFCger <mkg20001@gmail.com>","Hugo Dias <mail@hugodias.me>","dirkmc <dirkmdev@gmail.com>","Volker Mische <volker.mische@gmail.com>","Richard Littauer <richard.littauer@gmail.com>","a1300 <matthias-knopp@gmx.net>","Elven <mon.samuel@qq.com>","Andrew Nesbitt <andrewnez@gmail.com>","Giovanni T. Parra <fiatjaf@gmail.com>","Ryan Bell <ryan@piing.net>","Thomas Eizinger <thomas@eizinger.io>","\u1D20\u026A\u1D04\u1D1B\u1D0F\u0280 \u0299\u1D0A\u1D07\u029F\u1D0B\u029C\u1D0F\u029F\u1D0D <victorbjelkholm@gmail.com>","Didrik Nordstr\xF6m <didrik@betamos.se>","Irakli Gozalishvili <rfobic@gmail.com>","Ethan Lam <elmemphis2000@gmail.com>","Joel Gustafson <joelg@mit.edu>","Julien Bouquillon <contact@revolunet.com>","Kevin Kwok <antimatter15@gmail.com>","Nuno Nogueira <nunofmn@gmail.com>","Dmitriy Ryajov <dryajov@gmail.com>","RasmusErik Voel Jensen <github@solsort.com>","Diogo Silva <fsdiogo@gmail.com>","Samlior <samlior@foxmail.com>","Smite Chow <xiaopengyou@live.com>","Soeren <nikorpoulsen@gmail.com>","S\xF6nke Hahn <soenkehahn@gmail.com>","robertkiel <robert.kiel@validitylabs.org>","Tiago Alves <alvesjtiago@gmail.com>","Daijiro Wachi <daijiro.wachi@gmail.com>","Yusef Napora <yusef@napora.org>","Zane Starr <zcstarr@gmail.com>","Cindy Wu <ciindy.wu@gmail.com>","Chris Bratlien <chrisbratlien@gmail.com>","ebinks <elizabethjbinks@gmail.com>","Bernd Strehl <bernd.strehl@gmail.com>","Florian-Merle <florian.david.merle@gmail.com>","Francis Gulotta <wizard@roborooter.com>","Felipe Martins <felipebrasil93@gmail.com>","isan_rivkin <isanrivkin@gmail.com>","Henrique Dias <hacdias@gmail.com>","Fei Liu <liu.feiwood@gmail.com>"];var Lb={name:bb,version:vb,description:wb,leadMaintainer:Sb,main:_b,types:Eb,typesVersions:Tb,files:Ab,scripts:Cb,repository:Ib,keywords:Rb,bugs:kb,homepage:Pb,license:Nb,engines:Ob,dependencies:Mb,devDependencies:Db,contributors:xb};const Bb=Lb.version;var jb="ipfs/0.1.0",Ub=`js-libp2p/${Bb}`,Fb="/ipfs/id/1.0.0",$b="/ipfs/id/push/1.0.0",qd={PROTOCOL_VERSION:jb,AGENT_VERSION:Ub,MULTICODEC_IDENTIFY:Fb,MULTICODEC_IDENTIFY_PUSH:$b};const Gd=60*1e3;var yo={ADVERTISE_BOOT_DELAY:15*Gd,ADVERTISE_TTL:30*Gd,CIRCUIT_PROTO_CODE:290,HOP_METADATA_KEY:"hop_relay",HOP_METADATA_VALUE:"true",RELAY_RENDEZVOUS_NS:"/libp2p/relay"},qb=ee(function(t,e){(function(){var r,n,i;i=function(s){var a,c,o,l;return a=(s&255<<24)>>>24,c=(s&255<<16)>>>16,o=(s&255<<8)>>>8,l=s&255,[a,c,o,l].join(".")},n=function(s){var a,c,o,l,u;if(a=(s+"").split("."),a.length===0||a.length>4)throw new Error("Invalid IP");for(o=l=0,u=a.length;l<u;o=++l){if(c=a[o],isNaN(parseInt(c,10)))throw new Error("Invalid byte: "+c);if(c<0||c>255)throw new Error("Invalid byte: "+c)}return((a[0]||0)<<24|(a[1]||0)<<16|(a[2]||0)<<8|(a[3]||0))>>>0},r=function(){function s(a,c){var o,l,u;if(typeof a!="string")throw new Error("Missing `net' parameter");if(c||(u=a.split("/",2),a=u[0],c=u[1]),!c)switch(a.split(".").length){case 1:c=8;break;case 2:c=16;break;case 3:c=24;break;case 4:c=32;break;default:throw new Error("Invalid net address: "+a)}if(typeof c=="string"&&c.indexOf(".")>-1){try{this.maskLong=n(c)}catch(h){throw new Error("Invalid mask: "+c)}for(o=l=32;l>=0;o=--l)if(this.maskLong===4294967295<<32-o>>>0){this.bitmask=o;break}}else if(c)this.bitmask=parseInt(c,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(n(a)&this.maskLong)>>>0}catch(h){throw new Error("Invalid net address: "+a)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+c);this.size=Math.pow(2,32-this.bitmask),this.base=i(this.netLong),this.mask=i(this.maskLong),this.hostmask=i(~this.maskLong),this.first=this.bitmask<=30?i(this.netLong+1):this.base,this.last=this.bitmask<=30?i(this.netLong+this.size-2):i(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?i(this.netLong+this.size-1):void 0}return s.prototype.contains=function(a){return typeof a=="string"&&(a.indexOf("/")>0||a.split(".").length!==4)&&(a=new s(a)),a instanceof s?this.contains(a.base)&&this.contains(a.broadcast||a.last):(n(a)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},s.prototype.next=function(a){return a==null&&(a=1),new s(i(this.netLong+this.size*a),this.mask)},s.prototype.forEach=function(a){var c,o,l,u,h,S,p,C;for(h=function(){p=[];for(var T=S=n(this.first),E=n(this.last);S<=E?T<=E:T>=E;S<=E?T++:T--)p.push(T);return p}.apply(this),C=[],c=o=0,l=h.length;o<l;c=++o)u=h[c],C.push(a(i(u),u,c));return C},s.prototype.toString=function(){return this.base+"/"+this.bitmask},s}(),e.ip2long=n,e.long2ip=i,e.Netmask=r}).call(se)}),Gb=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var r=qb.Netmask;function n(s){var a=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"].map(function(p){return new r(p)}),c=!0,o=!1,l=void 0;try{for(var u=a[Symbol.iterator](),h;!(c=(h=u.next()).done);c=!0){var S=h.value;if(S.contains(s))return!0}}catch(p){o=!0,l=p}finally{try{!c&&u.return&&u.return()}finally{if(o)throw l}}return!1}function i(s){return/^::$/.test(s)||/^::1$/.test(s)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(s)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(s)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(s)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(s)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(s)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(s)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(s)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(s)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(s)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(s)||/^ff([0-9a-fA-F]{2,2}):/i.test(s)}e.default=function(s){return Wt.v4(s)||s.startsWith("0")?n(s):i(s)}}),Vb=Gb.default;function Hb(t){const{address:e}=t.nodeAddress();return Vb(e)}var Vd=Hb;function zb(t,e){const r=Vd(t.multiaddr),n=Vd(e.multiaddr);return r&&!n?1:!r&&n||t.isCertified&&!e.isCertified?-1:!t.isCertified&&e.isCertified?1:0}function Wb(t){return[...t].sort(zb)}var Kb=Wb,Hd={publicAddressesFirst:Kb};const zd=async t=>{try{const e=await t;return{isFulfilled:!0,isRejected:!1,value:e}}catch(e){return{isFulfilled:!1,isRejected:!0,reason:e}}};var bo=zd,Xb=zd;bo.default=Xb;const Wd=(t,...e)=>new Promise(r=>{r(t(...e))});var Kd=Wd,Qb=Wd;Kd.default=Qb;const Xd=t=>{if(!((Number.isInteger(t)||t===Infinity)&&t>0))return Promise.reject(new TypeError("Expected `concurrency` to be a number from 1 and up"));const e=[];let r=0;const n=()=>{r--,e.length>0&&e.shift()()},i=(c,o,...l)=>{r++;const u=Kd(c,...l);o(u),u.then(n,n)},s=(c,o,...l)=>{r<t?i(c,o,...l):e.push(i.bind(null,c,o,...l))},a=(c,...o)=>new Promise(l=>s(c,l,...o));return Object.defineProperties(a,{activeCount:{get:()=>r},pendingCount:{get:()=>e.length},clearQueue:{value:()=>{e.length=0}}}),a};var Qd=Xd,Yb=Xd;Qd.default=Yb;var Jb=async(t,e={})=>{const{concurrency:r=Infinity}=e,n=Qd(r);return Promise.all(t.map(i=>i&&typeof i.then=="function"?bo(i):typeof i=="function"?bo(n(()=>i())):bo(Promise.resolve(i))))},Yd=Dr(`
message Envelope {
  // public_key is the public key of the keypair the enclosed payload was
  // signed with.
  bytes public_key = 1;

  // payload_type encodes the type of payload, so that it can be deserialized
  // deterministically.
  bytes payload_type = 2;

  // payload is the actual payload carried inside this envelope.
  bytes payload = 3;

  // signature is the signature produced by the private key corresponding to
  // the enclosed public key, over the payload, prefixing a domain string for
  // additional security.
  bytes signature = 5;
}
`);const{codes:Zb}=ft;class oi{constructor({peerId:t,payloadType:e,payload:r,signature:n}){this.peerId=t,this.payloadType=e,this.payload=r,this.signature=n,this._marshal=void 0}marshal(){if(this._marshal)return this._marshal;const t=Vg.marshalPublicKey(this.peerId.pubKey);return this._marshal=Yd.Envelope.encode({public_key:t,payload_type:this.payloadType,payload:this.payload,signature:this.signature}),this._marshal}equals(t){return ir(this.peerId.pubKey.bytes,t.peerId.pubKey.bytes)&&ir(this.payloadType,t.payloadType)&&ir(this.payload,t.payload)&&ir(this.signature,t.signature)}validate(t){const e=Jd(t,this.payloadType,this.payload);return this.peerId.pubKey.verify(e,this.signature)}}const Jd=(t,e,r)=>{const n=qe(t),i=ie.encode(n.byteLength),s=ie.encode(e.length),a=ie.encode(r.length);return Oe([new Uint8Array(i),n,new Uint8Array(s),e,new Uint8Array(a),r])};oi.createFromProtobuf=async t=>{const e=Yd.Envelope.decode(t),r=await me.createFromPubKey(e.public_key);return new oi({peerId:r,payloadType:e.payload_type,payload:e.payload,signature:e.signature})},oi.seal=async(t,e)=>{const r=t.domain,n=t.codec,i=t.marshal(),s=Jd(r,n,i),a=await e.privKey.sign(s);return new oi({peerId:e,payloadType:n,payload:i,signature:a})},oi.openAndCertify=async(t,e)=>{const r=await oi.createFromProtobuf(t),n=await r.validate(e);if(!n)throw F(new Error("envelope signature is not valid for the given domain"),Zb.ERR_SIGNATURE_NOT_VALID);return r};var ca=oi;function ev(t,e){return t.length===e.length&&e.sort()&&t.sort().every((r,n)=>e[n].equals(r))}var tv=ev,Zd=Dr(`
message PeerRecord {
    // AddressInfo is a wrapper around a binary multiaddr. It is defined as a
    // separate message to allow us to add per-address metadata in the future.
    message AddressInfo {
        bytes multiaddr = 1;
    }

    // peer_id contains a libp2p peer id in its binary representation.
    bytes peer_id = 1;

    // seq contains a monotonically-increasing sequence counter to order PeerRecords in time.
    uint64 seq = 2;

    // addresses is a list of public listen addresses for the peer.
    repeated AddressInfo addresses = 3;
}
`);const rv=sd.getName(sd.LIBP2P_PEER_RECORD)||"libp2p-peer-record",nv=Uint8Array.from([3,1]);var iv={ENVELOPE_DOMAIN_PEER_RECORD:rv,ENVELOPE_PAYLOAD_TYPE_PEER_RECORD:nv};const{ENVELOPE_DOMAIN_PEER_RECORD:ep,ENVELOPE_PAYLOAD_TYPE_PEER_RECORD:sv}=iv;class la{constructor({peerId:t,multiaddrs:e=[],seqNumber:r=Date.now()}){this.domain=ep,this.codec=sv,this.peerId=t,this.multiaddrs=e,this.seqNumber=r,this._marshal=void 0}marshal(){return this._marshal?this._marshal:(this._marshal=Zd.PeerRecord.encode({peer_id:this.peerId.toBytes(),seq:this.seqNumber,addresses:this.multiaddrs.map(t=>({multiaddr:t.bytes}))}),this._marshal)}equals(t){return t instanceof la&&this.peerId.equals(t.peerId)?this.seqNumber!==t.seqNumber?!1:!!tv(this.multiaddrs,t.multiaddrs):!1}}la.createFromProtobuf=t=>{const e=Zd.PeerRecord.decode(t),r=me.createFromBytes(e.peer_id),n=(e.addresses||[]).map(s=>ze(s.multiaddr)),i=e.seq;return new la({peerId:r,multiaddrs:n,seqNumber:i})},la.DOMAIN=ep;var vo=la;async function av(t){const e=new vo({peerId:t.peerId,multiaddrs:t.multiaddrs}),r=await ca.seal(e,t.peerId);t.peerStore.addressBook.consumePeerRecord(r)}var ov=av,cv={updateSelfPeerRecord:ov};const ci=Object.assign(Q("libp2p:transports"),{error:Q("libp2p:transports:err")}),{codes:$i}=ft,{updateSelfPeerRecord:tp}=cv;class rp{constructor({libp2p:t,upgrader:e,faultTolerance:r=zc.FATAL_ALL}){this.libp2p=t,this.upgrader=e,this._transports=new Map,this._listeners=new Map,this._listenerOptions=new Map,this.faultTolerance=r}add(t,e,r={}){if(ci("adding %s",t),!t)throw F(new Error(`Transport must have a valid key, was given '${t}'`),$i.ERR_INVALID_KEY);if(this._transports.has(t))throw F(new Error("There is already a transport with this key"),$i.ERR_DUPLICATE_TRANSPORT);const n=new e({...r,libp2p:this.libp2p,upgrader:this.upgrader});this._transports.set(t,n),this._listenerOptions.set(t,r.listenerOptions||{}),this._listeners.has(t)||this._listeners.set(t,[])}async close(){const t=[];for(const[e,r]of this._listeners)for(ci("closing listeners for %s",e);r.length;){const n=r.pop();n.removeAllListeners("listening"),n.removeAllListeners("close"),t.push(n.close())}await Promise.all(t),ci("all listeners closed");for(const e of this._listeners.keys())this._listeners.set(e,[])}async dial(t,e){const r=this.transportForMultiaddr(t);if(!r)throw F(new Error(`No transport available for address ${String(t)}`),$i.ERR_TRANSPORT_UNAVAILABLE);try{return await r.dial(t,e)}catch(n){throw n.code||(n.code=$i.ERR_TRANSPORT_DIAL_FAILED),n}}getAddrs(){let t=[];for(const e of this._listeners.values())for(const r of e)t=[...t,...r.getAddrs()];return t}getTransports(){return this._transports.values()}transportForMultiaddr(t){for(const e of this._transports.values()){const r=e.filter([t]);if(r.length)return e}return null}async listen(t){if(!t||t.length===0){ci("no addresses were provided for listening, this node is dial only");return}const e=[];for(const[r,n]of this._transports.entries()){const i=n.filter(t),s=[];for(const o of i){ci("creating listener for %s on %s",r,o);const l=n.createListener(this._listenerOptions.get(r));this._listeners.get(r).push(l),l.on("listening",()=>tp(this.libp2p)),l.on("close",()=>tp(this.libp2p)),s.push(l.listen(o))}if(s.length===0){e.push(r);continue}const a=await Jb(s),c=a.find(o=>o.isFulfilled===!0);if(!c)throw F(new Error(`Transport (${r}) could not listen on any available address`),$i.ERR_NO_VALID_ADDRESSES)}if(e.length===this._transports.size){const r=`no valid addresses were provided for transports [${e}]`;if(this.faultTolerance===zc.FATAL_ALL)throw F(new Error(r),$i.ERR_NO_VALID_ADDRESSES);ci(`libp2p in dial mode only: ${r}`)}}async remove(t){if(ci("removing %s",t),this._listeners.has(t))for(const e of this._listeners.get(t))e.removeAllListeners("listening"),e.removeAllListeners("close"),await e.close();this._transports.delete(t),this._listeners.delete(t)}async removeAll(){const t=[];for(const e of this._transports.keys())t.push(this.remove(e));await Promise.all(t)}}const zc={FATAL_ALL:0,NO_FATAL:1};rp.FaultTolerance=zc;var np=rp;const{dnsaddrResolver:lv}=yb,{AGENT_VERSION:uv}=qd,{publicAddressesFirst:dv}=Hd,{FaultTolerance:pv}=np,hv={addresses:{listen:[],announce:[],noAnnounce:[]},connectionManager:{minConnections:25},transportManager:{faultTolerance:pv.FATAL_ALL},dialer:{maxParallelDials:oa.MAX_PARALLEL_DIALS,maxDialsPerPeer:oa.MAX_PER_PEER_DIALS,dialTimeout:oa.DIAL_TIMEOUT,resolvers:{dnsaddr:lv},addressSorter:dv},host:{agentVersion:uv},metrics:{enabled:!1},peerStore:{persistence:!1,threshold:5},peerRouting:{refreshManager:{enabled:!0,interval:6e5,bootDelay:1e4}},config:{dht:{enabled:!1,kBucketSize:20,randomWalk:{enabled:!1,queriesPerPeriod:1,interval:3e5,timeout:1e4}},peerDiscovery:{autoDial:!0},pubsub:{enabled:!0},relay:{enabled:!0,advertise:{bootDelay:yo.ADVERTISE_BOOT_DELAY,enabled:!1,ttl:yo.ADVERTISE_TTL},hop:{enabled:!1,active:!1},autoRelay:{enabled:!1,maxListeners:2}},transport:{}}};var fv=t=>{if(t=ao(hv,t),t.modules.transport.length<1)throw new Error("'options.modules.transport' must contain at least 1 transport");return t},mv={validate:fv};class gv{constructor({listen:t=[],announce:e=[]}={}){this.listen=new Set(t),this.announce=new Set(e)}getListenAddrs(){return Array.from(this.listen).map(t=>ze(t))}getAnnounceAddrs(){return Array.from(this.announce).map(t=>ze(t))}}var yv=gv;const{EventEmitter:bv}=It,Wc=Q("latency-monitor:VisibilityChangeEmitter");class vv extends bv{constructor(){super();if(typeof document=="undefined"){Wc('This is not a browser, no "document" found. Stopping.');return}this._initializeVisibilityVarNames(),this._addVisibilityChangeListener()}_initializeVisibilityVarNames(){let t,e;typeof document.hidden!="undefined"?(t="hidden",e="visibilitychange"):typeof document.mozHidden!="undefined"?(t="mozHidden",e="mozvisibilitychange"):typeof document.msHidden!="undefined"?(t="msHidden",e="msvisibilitychange"):typeof document.webkitHidden!="undefined"&&(t="webkitHidden",e="webkitvisibilitychange"),this._hidden=t,this._visibilityChange=e}_addVisibilityChangeListener(){typeof document.addEventListener=="undefined"||typeof document[this._hidden]=="undefined"?Wc("Checking page visibility requires a browser that supports the Page Visibility API."):document.addEventListener(this._visibilityChange,this._handleVisibilityChange.bind(this),!1)}isVisible(){return this._hidden===void 0||document[this._hidden]===void 0?void 0:!document[this._hidden]}_handleVisibilityChange(){const t=!document[this._hidden];Wc(t?"Page Visible":"Page Hidden"),this.emit("visibilityChange",t)}}var wv=vv;const{EventEmitter:Sv}=It,Jr=Q("latency-monitor:LatencyMonitor");class _v extends Sv{constructor({latencyCheckIntervalMs:t,dataEmitIntervalMs:e,asyncTestFn:r,latencyRandomPercentage:n}={}){super();const i=this;i.latencyCheckIntervalMs=t||500,i.latencyRandomPercentage=n||10,i._latecyCheckMultiply=2*(i.latencyRandomPercentage/100)*i.latencyCheckIntervalMs,i._latecyCheckSubtract=i._latecyCheckMultiply/2,i.dataEmitIntervalMs=e===null||e===0?void 0:e||5*1e3,Jr("latencyCheckIntervalMs: %s dataEmitIntervalMs: %s",i.latencyCheckIntervalMs,i.dataEmitIntervalMs),i.dataEmitIntervalMs?Jr("Expecting ~%s events per summary",i.latencyCheckIntervalMs/i.dataEmitIntervalMs):Jr("Not emitting summaries"),i.asyncTestFn=r,An.process&&An.process.hrtime?(Jr("Using process.hrtime for timing"),i.now=An.process.hrtime,i.getDeltaMS=s=>{const a=i.now(s);return a[0]*1e3+a[1]/1e6}):typeof window!="undefined"&&window.performance&&window.performance.now?(Jr("Using performance.now for timing"),i.now=window.performance.now.bind(window.performance),i.getDeltaMS=s=>Math.round(i.now()-s)):(Jr("Using Date.now for timing"),i.now=Date.now,i.getDeltaMS=s=>i.now()-s),i._latencyData=i._initLatencyData(),Ev()&&(i._visibilityChangeEmitter=new wv,i._visibilityChangeEmitter.on("visibilityChange",s=>{s?i._startTimers():(i._emitSummary(),i._stopTimers())})),(!i._visibilityChangeEmitter||i._visibilityChangeEmitter.isVisible())&&i._startTimers()}_startTimers(){if(this._checkLatencyID)return;this._checkLatency(),this.dataEmitIntervalMs&&(this._emitIntervalID=setInterval(()=>this._emitSummary(),this.dataEmitIntervalMs),typeof this._emitIntervalID.unref=="function"&&this._emitIntervalID.unref())}_stopTimers(){this._checkLatencyID&&(clearTimeout(this._checkLatencyID),this._checkLatencyID=void 0),this._emitIntervalID&&(clearInterval(this._emitIntervalID),this._emitIntervalID=void 0)}_emitSummary(){const t=this.getSummary();t.events>0&&this.emit("data",t)}getSummary(){const t={events:this._latencyData.events,minMs:this._latencyData.minMs,maxMs:this._latencyData.maxMs,avgMs:this._latencyData.events?this._latencyData.totalMs/this._latencyData.events:Number.POSITIVE_INFINITY,lengthMs:this.getDeltaMS(this._latencyData.startTime)};return this._latencyData=this._initLatencyData(),Jr("Summary: %O",t),t}_checkLatency(){const t=this,e=Math.random()*t._latecyCheckMultiply-t._latecyCheckSubtract,r={deltaOffset:Math.ceil(t.latencyCheckIntervalMs+e),startTime:t.now()},n=()=>{if(!this._checkLatencyID)return;const i=t.getDeltaMS(r.startTime)-r.deltaOffset;t._checkLatency(),t._latencyData.events++,t._latencyData.minMs=Math.min(t._latencyData.minMs,i),t._latencyData.maxMs=Math.max(t._latencyData.maxMs,i),t._latencyData.totalMs+=i,Jr("MS: %s Data: %O",i,t._latencyData)};Jr("localData: %O",r),this._checkLatencyID=setTimeout(()=>{t.asyncTestFn?(r.deltaOffset=0,r.startTime=t.now(),t.asyncTestFn(n)):(r.deltaOffset-=1,n())},r.deltaOffset),typeof this._checkLatencyID.unref=="function"&&this._checkLatencyID.unref()}_initLatencyData(){return{startTime:this.now(),minMs:Number.POSITIVE_INFINITY,maxMs:Number.NEGATIVE_INFINITY,events:0,totalMs:0}}}function Ev(){return typeof window!="undefined"}var Tv=_v,Kc=function(){return Date.now()};function Xc(t,e,r){var n=this;this._started=Kc(),this._rescheduled=0,this._scheduled=e,this._args=r,this._timer=setTimeout(i,e);function i(){n._rescheduled>0?(n._scheduled=n._rescheduled-(Kc()-n._started),n._timer=setTimeout(i,n._scheduled),n._rescheduled=0):t.apply(null,n._args)}}Xc.prototype.reschedule=function(t){var e=Kc();return e+t-(this._started+this._scheduled)<0?!1:(this._started=e,this._rescheduled=t,!0)},Xc.prototype.clear=function(){clearTimeout(this._timer)};function Av(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("timeout needed");var t;if(arguments.length>0){t=new Array(arguments.length-2);for(var e=0;e<t.length;e++)t[e]=arguments[e+2]}return new Xc(arguments[0],arguments[1],t)}var li=Av;const wr=Object.assign(Q("libp2p:connection-manager"),{error:Q("libp2p:connection-manager:err")}),{EventEmitter:Cv}=It,{codes:{ERR_INVALID_PARAMETERS:ip}}=ft,Iv={maxConnections:Infinity,minConnections:0,maxData:Infinity,maxSentData:Infinity,maxReceivedData:Infinity,maxEventLoopDelay:Infinity,pollInterval:2e3,autoDialInterval:1e4,movingAverageInterval:6e4,defaultPeerValue:1};class Rv extends Cv{constructor(t,e={}){super();if(this._libp2p=t,this._peerId=t.peerId.toB58String(),this._options=ao.call({ignoreUndefined:!0},Iv,e),this._options.maxConnections<this._options.minConnections)throw F(new Error("Connection Manager maxConnections must be greater than minConnections"),ip);wr("options: %j",this._options),this._peerValues=new Map,this.connections=new Map,this._started=!1,this._timer=null,this._autoDialTimeout=null,this._checkMetrics=this._checkMetrics.bind(this),this._autoDial=this._autoDial.bind(this)}get size(){return Array.from(this.connections.values()).reduce((t,e)=>t+e.length,0)}start(){this._libp2p.metrics&&(this._timer=this._timer||li(this._checkMetrics,this._options.pollInterval)),this._latencyMonitor=new Tv({latencyCheckIntervalMs:this._options.pollInterval,dataEmitIntervalMs:this._options.pollInterval}),this._onLatencyMeasure=this._onLatencyMeasure.bind(this),this._latencyMonitor.on("data",this._onLatencyMeasure),this._started=!0,wr("started"),this._options.autoDial&&this._autoDial()}async stop(){this._autoDialTimeout&&this._autoDialTimeout.clear(),this._timer&&this._timer.clear(),this._latencyMonitor&&this._latencyMonitor.removeListener("data",this._onLatencyMeasure),this._started=!1,await this._close(),wr("stopped")}async _close(){const t=[];for(const e of this.connections.values())for(const r of e)t.push(r.close());await t,this.connections.clear()}setPeerValue(t,e){if(e<0||e>1)throw new Error("value should be a number between 0 and 1");this._peerValues.set(t.toB58String(),e)}_checkMetrics(){if(this._libp2p.metrics){const t=this._libp2p.metrics.global.movingAverages,e=t.dataReceived[this._options.movingAverageInterval].movingAverage();this._checkMaxLimit("maxReceivedData",e);const r=t.dataSent[this._options.movingAverageInterval].movingAverage();this._checkMaxLimit("maxSentData",r);const n=e+r;this._checkMaxLimit("maxData",n),wr("metrics update",n),this._timer=li(this._checkMetrics,this._options.pollInterval)}}onConnect(t){const e=t.remotePeer,r=e.toB58String(),n=this.connections.get(r);this.emit("peer:connect",t),n?n.push(t):this.connections.set(r,[t]),this._libp2p.peerStore.keyBook.set(e,e.pubKey),this._peerValues.has(r)||this._peerValues.set(r,this._options.defaultPeerValue),this._checkMaxLimit("maxConnections",this.size)}onDisconnect(t){const e=t.remotePeer.toB58String();let r=this.connections.get(e);r&&r.length>1?(r=r.filter(n=>n.id!==t.id),this.connections.set(e,r)):r&&(this.connections.delete(e),this._peerValues.delete(t.remotePeer.toB58String()),this.emit("peer:disconnect",t))}get(t){const e=this.getAll(t);return e.length?e[0]:null}getAll(t){if(!me.isPeerId(t))throw F(new Error("peerId must be an instance of peer-id"),ip);const e=t.toB58String(),r=this.connections.get(e);return r?r.filter(n=>n.stat.status==="open"):[]}_onLatencyMeasure(t){this._checkMaxLimit("maxEventLoopDelay",t.avgMs)}_checkMaxLimit(t,e){const r=this._options[t];wr("checking limit of %s. current value: %d of %d",t,e,r),e>r&&(wr("%s: limit exceeded: %s, %d",this._peerId,t,e),this._maybeDisconnectOne())}async _autoDial(){const t=this._options.minConnections;if(this.size>=t){this._autoDialTimeout=li(this._autoDial,this._options.autoDialInterval);return}const e=Array.from(this._libp2p.peerStore.peers.values()).sort((r,n)=>n.protocols&&n.protocols.length&&(!r.protocols||!r.protocols.length)||n.id.pubKey&&!r.id.pubKey?1:-1);for(let r=0;r<e.length&&this.size<t;r++)if(!this.get(e[r].id)){wr("connecting to a peerStore stored peer %s",e[r].id.toB58String());try{if(await this._libp2p.dialer.connectToPeer(e[r].id),!this._started)return}catch(n){wr.error("could not connect to peerStore stored peer",n)}}this._autoDialTimeout=li(this._autoDial,this._options.autoDialInterval)}_maybeDisconnectOne(){if(this._options.minConnections<this.connections.size){const t=Array.from(this._peerValues).sort(Pv);wr("%s: sorted peer values: %j",this._peerId,t);const e=t[0];if(e){const r=e[0];wr("%s: lowest value peer is %s",this._peerId,r),wr("%s: closing a connection to %j",this._peerId,r);for(const n of this.connections.values())if(n[0].remotePeer.toB58String()===r){n[0].close();break}}}}}var kv=Rv;function Pv(t,e){return t[1]-e[1]}const sp=pe("dns4"),ap=pe("dns6"),qi=wt(pe("dns"),pe("dnsaddr"),sp,ap),ua=wt(pe("ip4"),pe("ip6")),Gi=wt(_e(ua,pe("tcp")),_e(qi,pe("tcp"))),op=_e(ua,pe("udp")),cp=_e(op,pe("utp")),Vi=wt(_e(Gi,pe("ws")),_e(qi,pe("ws"))),Hi=wt(_e(Gi,pe("wss")),_e(qi,pe("wss"))),Qc=wt(_e(Gi,pe("http")),_e(ua,pe("http")),_e(qi,pe("http"))),Yc=wt(_e(Gi,pe("https")),_e(ua,pe("https")),_e(qi,pe("https"))),Jc=wt(_e(Vi,pe("p2p-webrtc-star"),pe("p2p")),_e(Hi,pe("p2p-webrtc-star"),pe("p2p")),_e(Vi,pe("p2p-webrtc-star")),_e(Hi,pe("p2p-webrtc-star"))),Nv=wt(_e(Vi,pe("p2p-websocket-star"),pe("p2p")),_e(Hi,pe("p2p-websocket-star"),pe("p2p")),_e(Vi,pe("p2p-websocket-star")),_e(Hi,pe("p2p-websocket-star"))),lp=wt(_e(Qc,pe("p2p-webrtc-direct")),_e(Yc,pe("p2p-webrtc-direct"))),zi=wt(Vi,Hi,Qc,Yc,Jc,lp,Gi,cp),Ov=wt(_e(zi,pe("p2p-stardust"),pe("p2p")),_e(zi,pe("p2p-stardust"))),In=wt(_e(zi,pe("p2p")),Jc,pe("p2p")),up=wt(_e(In,pe("p2p-circuit"),In),_e(In,pe("p2p-circuit")),_e(pe("p2p-circuit"),In),_e(zi,pe("p2p-circuit")),_e(pe("p2p-circuit"),zi),pe("p2p-circuit")),dp=()=>wt(_e(up,dp),up),Wi=dp(),pp=wt(_e(Wi,In,Wi),_e(In,Wi),_e(Wi,In),Wi,In);var Mv=qi,Dv=sp,xv=ap,Lv=ua,Bv=Gi,jv=op,Uv=cp,Fv=Qc,$v=Yc,qv=Vi,Gv=Hi,Vv=Nv,Hv=Jc,zv=lp,Wv=zi,Kv=Ov,Xv=Wi,Qv=pp,Yv=pp;function hp(t){return function(r){if(!Rt.isMultiaddr(r))try{r=Rt(r)}catch(i){return!1}const n=t(r.protoNames());return n===null?!1:n.length===0}}function _e(){const t=Array.from(arguments);function e(r){return r.length<t.length?null:(t.some(n=>{if(r=typeof n=="function"?n().partialMatch(r):n.partialMatch(r),r===null)return!0}),r)}return{toString:function(){return"{ "+t.join(" ")+" }"},input:t,matches:hp(e),partialMatch:e}}function wt(){const t=Array.from(arguments);function e(n){let i=null;return t.some(s=>{const a=typeof s=="function"?s().partialMatch(n):s.partialMatch(n);if(a)return i=a,!0}),i}const r={toString:function(){return"{ "+t.join(" ")+" }"},input:t,matches:hp(e),partialMatch:e};return r}function pe(t){const e=t;function r(i){if(typeof i=="string")try{i=Rt(i)}catch(a){return!1}const s=i.protoNames();return s.length===1&&s[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:r,partialMatch:n}}var Zc={DNS:Mv,DNS4:Dv,DNS6:xv,IP:Lv,TCP:Bv,UDP:jv,UTP:Uv,HTTP:Fv,HTTPS:$v,WebSockets:qv,WebSocketsSecure:Gv,WebSocketStar:Vv,WebRTCStar:Hv,WebRTCDirect:zv,Reliable:Wv,Stardust:Kv,Circuit:Xv,P2P:Qv,IPFS:Yv},da=Dr(`
message CircuitRelay {

  enum Status {
    SUCCESS                    = 100;
    HOP_SRC_ADDR_TOO_LONG      = 220;
    HOP_DST_ADDR_TOO_LONG      = 221;
    HOP_SRC_MULTIADDR_INVALID  = 250;
    HOP_DST_MULTIADDR_INVALID  = 251;
    HOP_NO_CONN_TO_DST         = 260;
    HOP_CANT_DIAL_DST          = 261;
    HOP_CANT_OPEN_DST_STREAM   = 262;
    HOP_CANT_SPEAK_RELAY       = 270;
    HOP_CANT_RELAY_TO_SELF     = 280;
    STOP_SRC_ADDR_TOO_LONG     = 320;
    STOP_DST_ADDR_TOO_LONG     = 321;
    STOP_SRC_MULTIADDR_INVALID = 350;
    STOP_DST_MULTIADDR_INVALID = 351;
    STOP_RELAY_REFUSED         = 390;
    MALFORMED_MESSAGE          = 400;
  }

  enum Type { // RPC identifier, either HOP, STOP or STATUS
    HOP = 1;
    STOP = 2;
    STATUS = 3;
    CAN_HOP = 4;
  }

  message Peer {
    required bytes id = 1;    // peer id
    repeated bytes addrs = 2; // peer's known addresses
  }

  optional Type type = 1;     // Type of the message

  optional Peer srcPeer = 2;  // srcPeer and dstPeer are used when Type is HOP or STATUS
  optional Peer dstPeer = 3;

  optional Status code = 4;   // Status code, used when Type is STATUS
}
`),el=function(e){if(e){if(typeof e[Symbol.iterator]=="function")return e[Symbol.iterator]();if(typeof e[Symbol.asyncIterator]=="function")return e[Symbol.asyncIterator]();if(typeof e.next=="function")return e}throw new Error("argument is not an iterator or iterable")},tl=class extends Error{constructor(e,r){super(e||"The operation was aborted");this.type="aborted",this.code=r||"ABORT_ERR"}};const fp=(t,e,r)=>rl(t,Array.isArray(e)?e:[{signal:e,options:r}]),rl=(t,e)=>{t=el(t),e=e.map(({signal:n,options:i})=>({signal:n,options:i||{}}));async function*r(){let n;const i=()=>{n&&n()};for(const{signal:s}of e)s.addEventListener("abort",i);for(;;){let s;try{for(const{signal:c,options:o}of e)if(c.aborted){const{abortMessage:l,abortCode:u}=o;throw new tl(l,u)}const a=new Promise((c,o)=>{n=()=>{const{options:l}=e.find(({signal:S})=>S.aborted),{abortMessage:u,abortCode:h}=l;o(new tl(u,h))}});s=await Promise.race([a,t.next()]),n=null}catch(a){for(const{signal:l}of e)l.removeEventListener("abort",i);const c=e.find(({signal:l})=>l.aborted),o=a.type==="aborted"&&c;if(o&&c.options.onAbort&&await c.options.onAbort(t),typeof t.return=="function"&&await t.return(),o&&c.options.returnOnAbort)return;throw a}if(s.done)break;yield s.value}for(const{signal:s}of e)s.removeEventListener("abort",i)}return r()},mp=(t,e,r)=>gp(t,Array.isArray(e)?e:[{signal:e,options:r}]),gp=(t,e)=>r=>t(rl(r,e)),Jv=(t,e,r)=>Zv(t,Array.isArray(e)?e:[{signal:e,options:r}]),Zv=(t,e)=>({sink:gp(t.sink,e),source:rl(t.source,e)});var nt=fp,e0=tl,t0=fp,r0=mp,n0=mp,i0=Jv;nt.AbortError=e0,nt.source=t0,nt.sink=r0,nt.transform=n0,nt.duplex=i0;const s0=Q("libp2p:stream:converter");function a0({stream:t,remoteAddr:e,localAddr:r},n={}){const{sink:i,source:s}=t,a={async sink(o){n.signal&&(o=nt(o,n.signal));try{await i(o)}catch(l){l.type!=="aborted"&&s0(l)}c()},source:n.signal?nt(s,n.signal):s,conn:t,localAddr:r,remoteAddr:e,timeline:{open:Date.now()},close(){i([]),c()}};function c(){a.timeline.close||(a.timeline.close=Date.now())}return a}var yp=a0,pa={relay:"/libp2p/circuit/relay/0.1.0"};const{EventEmitter:o0}=It;var c0=t=>{const e=new Map;async function r(s){const a=String(s).split("/p2p-circuit").find(l=>l!==""),c=await t.dial(ze(a)),o=c.remoteAddr.encapsulate("/p2p-circuit");e.set(c.remotePeer.toB58String(),o),i.emit("listening")}function n(){const s=[];for(const a of e.values())s.push(a);return s}const i=Object.assign(new o0,{close:()=>Promise.resolve(),listen:r,getAddrs:n});return t.connectionManager.on("peer:disconnect",s=>{const a=e.delete(s.remotePeer.toB58String());a&&i.emit("close")}),i};const{CircuitRelay:ui}=da;function bp(t,e){t.write({type:ui.Type.STATUS,code:e})}function l0(t,e){try{t.dstPeer.addrs.forEach(r=>ze(r))}catch(r){throw bp(e,t.type===ui.Type.HOP?ui.Status.HOP_DST_MULTIADDR_INVALID:ui.Status.STOP_DST_MULTIADDR_INVALID),r}try{t.srcPeer.addrs.forEach(r=>ze(r))}catch(r){throw bp(e,t.type===ui.Type.HOP?ui.Status.HOP_SRC_MULTIADDR_INVALID:ui.Status.STOP_SRC_MULTIADDR_INVALID),r}}var vp={validateAddrs:l0},wp=t=>{const e=async function*(){let r=yield,n=new ht;for await(const i of t){if(!r){r=yield n.append(i),n=new ht;continue}for(n.append(i);n.length>=r;){const s=n.shallowSlice(0,r);if(n.consume(r),r=yield s,!r){n.length&&(r=yield n,n=new ht);break}}}if(r)throw Object.assign(new Error(`stream ended before ${r} bytes became available`),{code:"ERR_UNDER_READ",buffer:n})}();return e.next(),e},Sp=class{constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];return e===void 0?void 0:(this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e)}isEmpty(){return this.buffer[this.btm]===void 0}},ha=class{constructor(e){this.hwm=e||16,this.head=new Sp(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){const r=this.head;this.head=r.next=new Sp(2*this.head.buffer.length),this.head.push(e)}}shift(){const e=this.tail.shift();if(e===void 0&&this.tail.next){const r=this.tail.next;return this.tail.next=null,this.tail=r,this.tail.shift()}return e}isEmpty(){return this.head.isEmpty()}},wo=t=>{t=t||{};let e;typeof t=="function"?(e=t,t={}):e=t.onEnd;let r=new ha,n,i,s;const a=()=>{if(!r.isEmpty()){if(t.writev){let T;const E=[];for(;!r.isEmpty();){if(T=r.shift(),T.error)throw T.error;E.push(T.value)}return{done:T.done,value:E}}const C=r.shift();if(C.error)throw C.error;return C}return s?{done:!0}:new Promise((C,T)=>{i=E=>(i=null,E.error?T(E.error):t.writev&&!E.done?C({done:E.done,value:[E.value]}):C(E),n)})},c=C=>i?i(C):(r.push(C),n),o=C=>(r=new ha,i?i({error:C}):(r.push({error:C}),n)),l=C=>s?n:c({done:!1,value:C}),u=C=>s?n:(s=!0,C?o(C):c({done:!0})),h=()=>(r=new ha,u(),{done:!0}),S=C=>(u(C),{done:!0});if(n={[Symbol.asyncIterator](){return this},next:a,return:h,throw:S,push:l,end:u},!e)return n;const p=n;return n={[Symbol.asyncIterator](){return this},next(){return p.next()},throw(C){return p.throw(C),e&&(e(C),e=null),{done:!0}},return(){return p.return(),e&&(e(),e=null),{done:!0}},push:l,end(C){return p.end(C),e&&(e(C),e=null),n}},n};const u0=()=>{const t={};return t.promise=new Promise((e,r)=>{t.resolve=e,t.reject=r}),t};var So=u0,fa=t=>{const e=wo(),r=wp(t.source),n=So();let i;const s=t.sink(async function*(){yield*e;const c=await n.promise;yield*c}());s.catch(c=>{i=c});const a={sink:c=>i?Promise.reject(i):(n.resolve(c),s),source:r};return{reader:r,writer:e,stream:a,rest:()=>e.end(),write:e.push,read:async()=>(await r.next()).value}};const _o=Object.assign(Q("libp2p:circuit:stream-handler"),{error:Q("libp2p:circuit:stream-handler:err")}),{CircuitRelay:_p}=da;class d0{constructor({stream:t,maxLength:e=4096}){this.stream=t,this.shake=fa(this.stream),this.decoder=Je.decode.fromReader(this.shake.reader,{maxDataLength:e})}async read(){const t=await this.decoder.next();if(t.value){const e=_p.decode(t.value.slice());return _o("read message type",e.type),e}_o("read received no value, closing stream"),this.close()}write(t){_o("write message type %s",t.type),this.shake.write(Je.encode.single(_p.encode(t)))}rest(){return this.shake.rest(),this.shake.stream}end(t){this.write(t),this.close()}close(){_o("closing the stream"),this.rest().sink([])}}var Eo=d0;const ma=Object.assign(Q("libp2p:circuit:stop"),{error:Q("libp2p:circuit:stop:err")}),{CircuitRelay:nl}=da,{validateAddrs:p0}=vp;var h0=function({connection:e,request:r,streamHandler:n}){try{p0(r,n)}catch(i){return ma.error("invalid stop request via peer %s",e.remotePeer.toB58String(),i)}return ma("stop request is valid"),n.write({type:nl.Type.STATUS,code:nl.Status.SUCCESS}),n.rest()},f0=async function({connection:e,request:r}){const{stream:n}=await e.newStream([pa.relay]);ma("starting stop request to %s",e.remotePeer.toB58String());const i=new Eo({stream:n});i.write(r);const s=await i.read();if(s.code===nl.Status.SUCCESS)return ma("stop request to %s was successful",e.remotePeer.toB58String()),i.rest();ma("stop request failed with code %d",s.code),i.close()},Ep={handleStop:h0,stop:f0};const Rn=Object.assign(Q("libp2p:circuit:hop"),{error:Q("libp2p:circuit:hop:err")}),{validateAddrs:m0}=vp,{CircuitRelay:Kt}=da,{pipe:g0}=nr,{codes:y0}=ft,{stop:b0}=Ep;async function v0({connection:t,request:e,streamHandler:r,circuit:n}){if(!n._options.hop.enabled)return Rn("HOP request received but we are not acting as a relay"),r.end({type:Kt.Type.STATUS,code:Kt.Status.HOP_CANT_SPEAK_RELAY});try{m0(e,r)}catch(l){return Rn.error("invalid hop request via peer %s",t.remotePeer.toB58String(),l)}const i=new me(e.dstPeer.id),s=n._connectionManager.get(i);if(!s&&!n._options.hop.active)return Rn("HOP request received but we are not connected to the destination peer"),r.end({type:Kt.Type.STATUS,code:Kt.Status.HOP_NO_CONN_TO_DST});if(!s)return;const a={type:Kt.Type.STOP,dstPeer:e.dstPeer,srcPeer:e.srcPeer};let c;try{c=await b0({connection:s,request:a})}catch(l){return Rn.error(l)}Rn("hop request from %s is valid",t.remotePeer.toB58String()),r.write({type:Kt.Type.STATUS,code:Kt.Status.SUCCESS});const o=r.rest();return g0(o,c,o)}async function w0({connection:t,request:e}){const{stream:r}=await t.newStream([pa.relay]),n=new Eo({stream:r});n.write(e);const i=await n.read();if(i.code===Kt.Status.SUCCESS)return Rn("hop request was successful"),n.rest();throw Rn("hop request failed with code %d, closing stream",i.code),n.close(),F(new Error(`HOP request failed with code ${i.code}`),y0.ERR_HOP_REQUEST_FAILED)}async function S0({connection:t}){const{stream:e}=await t.newStream([pa.relay]),r=new Eo({stream:e});r.write({type:Kt.Type.CAN_HOP});const n=await r.read();return await r.close(),!(n.code!==Kt.Status.SUCCESS)}function _0({connection:t,streamHandler:e,circuit:r}){const n=r._options.hop.enabled;Rn("can hop (%s) request from %s",n,t.remotePeer.toB58String()),e.end({type:Kt.Type.STATUS,code:n?Kt.Status.SUCCESS:Kt.Status.HOP_CANT_SPEAK_RELAY})}var Tp={handleHop:v0,hop:w0,canHop:S0,handleCanHop:_0};const kn=Object.assign(Q("libp2p:circuit"),{error:Q("libp2p:circuit:err")}),{CircuitRelay:ga}=da,{relay:E0}=pa,{handleCanHop:T0,handleHop:A0,hop:C0}=Tp,{handleStop:I0}=Ep,R0=Symbol.for("@libp2p/js-libp2p-circuit/circuit");class k0{constructor({libp2p:t,upgrader:e}){this._dialer=t.dialer,this._registrar=t.registrar,this._connectionManager=t.connectionManager,this._upgrader=e,this._options=t._config.relay,this._libp2p=t,this.peerId=t.peerId,this._registrar.handle(E0,this._onProtocol.bind(this))}async _onProtocol({connection:t,stream:e}){const r=new Eo({stream:e}),n=await r.read();if(!n)return;const i=this;let s;switch(n.type){case ga.Type.CAN_HOP:{kn("received CAN_HOP request from %s",t.remotePeer.toB58String()),await T0({circuit:i,connection:t,streamHandler:r});break}case ga.Type.HOP:{kn("received HOP request from %s",t.remotePeer.toB58String()),s=await A0({connection:t,request:n,streamHandler:r,circuit:i});break}case ga.Type.STOP:{kn("received STOP request from %s",t.remotePeer.toB58String()),s=await I0({connection:t,request:n,streamHandler:r});break}default:kn("Request of type %s not supported",n.type)}if(s){const a=ze(n.dstPeer.addrs[0]),c=ze(n.srcPeer.addrs[0]),o=yp({stream:s,remoteAddr:a,localAddr:c}),l=n.type===ga.Type.HOP?"relay":"inbound";kn("new %s connection %s",l,o.remoteAddr);const u=await this._upgrader.upgradeInbound(o);kn("%s connection %s upgraded",l,o.remoteAddr),this.handler&&this.handler(u)}}async dial(t,e){const r=t.toString().split("/p2p-circuit"),n=ze(r[0]),i=ze(r[r.length-1]),s=me.createFromCID(n.getPeerId()),a=me.createFromCID(i.getPeerId());let c=!1,o=this._connectionManager.get(s);o||(o=await this._dialer.connectToPeer(n,e),c=!0);try{const l=await C0({connection:o,request:{type:ga.Type.HOP,srcPeer:{id:this.peerId.toBytes(),addrs:this._libp2p.multiaddrs.map(S=>S.bytes)},dstPeer:{id:a.toBytes(),addrs:[ze(i).bytes]}}}),u=n.encapsulate(`/p2p-circuit/p2p/${this.peerId.toB58String()}`),h=yp({stream:l,remoteAddr:t,localAddr:u});return kn("new outbound connection %s",h.remoteAddr),this._upgrader.upgradeOutbound(h)}catch(l){throw kn.error("Circuit relay dial failed",l),c&&await o.close(),l}}createListener(t,e){return typeof t=="function"&&(e=t,t={}),this.handler=e,c0(this._libp2p)}filter(t){return t=Array.isArray(t)?t:[t],t.filter(e=>Zc.Circuit.matches(e))}get[Symbol.toStringTag](){return"Circuit"}static isTransport(t){return Boolean(t&&t[R0])}}var Ap=k0,P0=An.TextEncoder,N0=async t=>{const e=new P0("utf8").encode(t),r=await od(e,"sha2-256");return new Qr(r)},Cp={namespaceToCid:N0};const To=Object.assign(Q("libp2p:auto-relay"),{error:Q("libp2p:auto-relay:err")}),{relay:O0}=pa,{canHop:M0}=Tp,{namespaceToCid:D0}=Cp,{CIRCUIT_PROTO_CODE:x0,HOP_METADATA_KEY:Ip,HOP_METADATA_VALUE:Rp,RELAY_RENDEZVOUS_NS:L0}=yo;class B0{constructor({libp2p:t,maxListeners:e=1}){this._libp2p=t,this._peerId=t.peerId,this._peerStore=t.peerStore,this._connectionManager=t.connectionManager,this._transportManager=t.transportManager,this._addressSorter=t.dialer.addressSorter,this.maxListeners=e,this._listenRelays=new Set,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this),this._peerStore.on("change:protocols",this._onProtocolChange),this._connectionManager.on("peer:disconnect",this._onPeerDisconnected)}async _onProtocolChange({peerId:t,protocols:e}){const r=t.toB58String(),n=e.find(i=>i===O0);if(!n&&this._listenRelays.has(r)){this._removeListenRelay(r);return}else if(!n||this._listenRelays.has(r))return;try{const i=this._connectionManager.get(t);if(!i)return;if(i.remoteAddr.protoCodes().includes(x0)){To(`relayed connection to ${r} will not be used to hop on`);return}const s=await M0({connection:i});s&&(this._peerStore.metadataBook.set(t,Ip,qe(Rp)),await this._addListenRelay(i,r))}catch(i){To.error(i)}}_onPeerDisconnected(t){const e=t.remotePeer,r=e.toB58String();if(!this._listenRelays.has(r))return;this._removeListenRelay(r)}async _addListenRelay(t,e){if(this._listenRelays.size>=this.maxListeners)return;const r=this._peerStore.addressBook.getMultiaddrsForPeer(t.remotePeer,this._addressSorter);if(!r||!r.length)return;const n=`${r[0].toString()}/p2p-circuit`;this._listenRelays.add(e);try{await this._transportManager.listen([ze(n)])}catch(i){To.error(i),this._listenRelays.delete(e)}}_removeListenRelay(t){this._listenRelays.delete(t)&&this._listenOnAvailableHopRelays([t])}async _listenOnAvailableHopRelays(t=[]){if(this._listenRelays.size>=this.maxListeners)return;const e=[];for(const[r,n]of this._peerStore.metadataBook.data.entries()){if(this._listenRelays.has(r)||t.includes(r))continue;const i=n.get(Ip);if(!i||ae(i)!==Rp)continue;const s=me.createFromCID(r),a=this._connectionManager.get(s);if(!a){e.push(s);continue}if(await this._addListenRelay(a,r),this._listenRelays.size>=this.maxListeners)return}for(const r of e){const n=await this._libp2p.dial(r);if(await this._addListenRelay(n,r.toB58String()),this._listenRelays.size>=this.maxListeners)return}try{const r=await D0(L0);for await(const n of this._libp2p.contentRouting.findProviders(r)){if(!n.multiaddrs.length)continue;const i=n.id;this._peerStore.addressBook.add(i,n.multiaddrs);const s=await this._libp2p.dial(i);if(await this._addListenRelay(s,i.toB58String()),this._listenRelays.size>=this.maxListeners)return}}catch(r){To.error(r)}}}var j0=B0;const kp=Object.assign(Q("libp2p:relay"),{error:Q("libp2p:relay:err")}),{setDelayedInterval:U0,clearDelayedInterval:F0}=hd,{namespaceToCid:$0}=Cp,{ADVERTISE_BOOT_DELAY:q0,ADVERTISE_TTL:G0,RELAY_RENDEZVOUS_NS:V0}=yo;class H0{constructor(t){this._libp2p=t,this._options={advertise:{bootDelay:q0,enabled:!0,ttl:G0,...t._config.relay.advertise},...t._config.relay},this._autoRelay=this._options.autoRelay.enabled&&new j0({libp2p:t,...this._options.autoRelay}),this._advertiseService=this._advertiseService.bind(this)}start(){const t=this._options.hop.enabled;t&&this._options.advertise.enabled&&(this._timeout=U0(this._advertiseService,this._options.advertise.ttl,this._options.advertise.bootDelay))}stop(){F0(this._timeout)}async _advertiseService(){try{const t=await $0(V0);await this._libp2p.contentRouting.provide(t)}catch(t){t.code==="NO_ROUTERS_AVAILABLE"?(kp.error("a content router, such as a DHT, must be provided in order to advertise the relay service",t),this.stop()):kp.error(t)}}}var z0=H0;const{AbortController:W0}=typeof self!="undefined"?self:typeof window!="undefined"?window:na;class il extends W0{constructor(t){super();this._ms=t,this._timer=li(()=>this.abort(),t),Object.setPrototypeOf(this,il.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=li(()=>this.abort(),this._ms)}}var Pp=il,K0=il;Pp.TimeoutController=K0;var X0=AbortController;function Np(t){const e=new X0;function r(){e.abort();for(const n of t){if(!n||!n.removeEventListener)continue;n.removeEventListener("abort",r)}}for(const n of t){if(!n||!n.addEventListener)continue;if(n.aborted){r();break}n.addEventListener("abort",r)}return e.signal}var sl=Np,Q0=Np;sl.anySignal=Q0;var Y0=class{constructor(){this._buffer=new ha,this._waitingConsumers=new ha}push(e){const{promise:r,resolve:n}=So();return this._buffer.push({chunk:e,resolve:n}),this._consume(),r}_consume(){for(;!this._waitingConsumers.isEmpty()&&!this._buffer.isEmpty();){const e=this._waitingConsumers.shift(),r=this._buffer.shift();e.resolve(r.chunk),r.resolve()}}shift(){const{promise:e,resolve:r}=So();return this._waitingConsumers.push({resolve:r}),this._consume(),e}isEmpty(){return this._buffer.isEmpty()}};const J0=na.default;class Z0{constructor({addrs:t,dialAction:e,dialer:r}){this.addrs=t,this.dialer=r,this.dialAction=e}async run(t={}){const e=this.dialer.getTokens(this.addrs.length);if(e.length<1)throw F(new Error("No dial tokens available"),"ERR_NO_DIAL_TOKENS");const r=new Y0;e.forEach(s=>r.push(s));const n=this.addrs.map(()=>new J0);let i=0;try{return await ia(this.addrs.map(async(s,a)=>{const c=await r.shift();let o;try{const l=n[a].signal;o=await this.dialAction(s,{...t,signal:sl([l,t.signal])}),n.splice(a,1)}finally{i++,this.addrs.length-i>=e.length?r.push(c):this.dialer.releaseToken(e.splice(e.indexOf(c),1)[0])}return o}))}finally{n.map(s=>s.abort()),e.forEach(s=>this.dialer.releaseToken(s))}}}var ew=Z0;const Ki=Object.assign(Q("libp2p:dialer"),{error:Q("libp2p:dialer:err")}),{publicAddressesFirst:tw}=Hd,{codes:al}=ft,{DIAL_TIMEOUT:rw,MAX_PARALLEL_DIALS:nw,MAX_PER_PEER_DIALS:iw}=oa;class sw{constructor({transportManager:t,peerStore:e,addressSorter:r=tw,concurrency:n=nw,timeout:i=rw,perPeerLimit:s=iw,resolvers:a={}}){this.transportManager=t,this.peerStore=e,this.addressSorter=r,this.concurrency=n,this.timeout=i,this.perPeerLimit=s,this.tokens=[...new Array(n)].map((c,o)=>o),this._pendingDials=new Map;for(const[c,o]of Object.entries(a))ze.resolvers.set(c,o)}destroy(){for(const t of this._pendingDials.values())try{t.controller.abort()}catch(e){Ki.error(e)}this._pendingDials.clear()}async connectToPeer(t,e={}){const r=await this._createDialTarget(t);if(!r.addrs.length)throw F(new Error("The dial request has no addresses"),al.ERR_NO_VALID_ADDRESSES);const n=this._pendingDials.get(r.id)||this._createPendingDial(r,e);try{const i=await n.promise;return Ki("dial succeeded to %s",r.id),i}catch(i){throw n.controller.signal.aborted&&(i.code=al.ERR_TIMEOUT),Ki.error(i),i}finally{n.destroy()}}async _createDialTarget(t){const{id:e,multiaddrs:r}=uo(t);r&&this.peerStore.addressBook.add(e,r);let n=this.peerStore.addressBook.getMultiaddrsForPeer(e,this.addressSorter)||[];ze.isMultiaddr(t)&&(n=n.filter(s=>!t.equals(s)),n.unshift(t));const i=[];for(const s of n){const a=await this._resolve(s);a.forEach(c=>i.push(c))}return{id:e.toB58String(),addrs:i}}_createPendingDial(t,e={}){const r=(o,l)=>{if(l.signal.aborted)throw F(new Error("already aborted"),al.ERR_ALREADY_ABORTED);return this.transportManager.dial(o,l)},n=new ew({addrs:t.addrs,dialAction:r,dialer:this}),i=new Pp(this.timeout),s=[i.signal];e.signal&&s.push(e.signal);const a=sl(s),c={dialRequest:n,controller:i,promise:n.run({...e,signal:a}),destroy:()=>{i.clear(),this._pendingDials.delete(t.id)}};return this._pendingDials.set(t.id,c),c}getTokens(t){const e=Math.min(t,this.perPeerLimit,this.tokens.length),r=this.tokens.splice(0,e);return Ki("%d tokens request, returning %d, %d remaining",t,e,this.tokens.length),r}releaseToken(t){if(this.tokens.indexOf(t)>-1)return;Ki("token %d released",t),this.tokens.push(t)}async _resolve(t){const e=t.protoNames().includes("dnsaddr");if(!e)return[t];const r=await this._resolveRecord(t),n=await Promise.all(r.map(s=>this._resolve(s))),i=n.flat();return i.reduce((s,a)=>(s.find(c=>c.equals(a))||s.push(a),s),[])}async _resolveRecord(t){try{t=ze(t.toString());const e=await t.resolve();return e}catch(e){return Ki.error(`multiaddr ${t} could not be resolved`),[]}}}var aw=sw;function ow(t){return t>=55296&&t<=56319}function cw(t){return t>=56320&&t<=57343}var lw=function(e,r,n){if(typeof r!="string")throw new Error("Input must be string");for(var i=r.length,s=0,a,c,o=0;o<i;o+=1){if(a=r.charCodeAt(o),c=r[o],ow(a)&&cw(r.charCodeAt(o+1))&&(o+=1,c+=r[o]),s+=e(c),s===n)return r.slice(0,o+1);if(s>n)return r.slice(0,o-c.length+1)}return r};function uw(t){return t>=55296&&t<=56319}function dw(t){return t>=56320&&t<=57343}var pw=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var r=e.length,n=0,i=null,s=null,a=0;a<r;a++)i=e.charCodeAt(a),dw(i)?s!=null&&uw(s)?n+=1:n+=3:i<=127?n+=1:i>=128&&i<=2047?n+=2:i>=2048&&i<=65535&&(n+=3),s=i;return n},hw=lw.bind(null,pw),fw=/[\/\?<>\\:\*\|"]/g,mw=/[\x00-\x1f\x80-\x9f]/g,gw=/^\.+$/,yw=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,bw=/[\. ]+$/;function Op(t,e){if(typeof t!="string")throw new Error("Input must be string");var r=t.replace(fw,e).replace(mw,e).replace(gw,e).replace(yw,e).replace(bw,e);return hw(r,255)}var vw=function(t,e){var r=e&&e.replacement||"",n=Op(t,r);return r===""?n:Op(n,"")},$N=ee(function(t){var e=U.asn1,r=t.exports=U.pkcs7asn1=U.pkcs7asn1||{};U.pkcs7=U.pkcs7||{},U.pkcs7.asn1=r;var n={name:"ContentInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};r.contentInfoValidator=n;var i={name:"EncryptedContentInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:e.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};r.envelopedDataValidator={name:"EnvelopedData",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(i)},r.encryptedDataValidator={name:"EncryptedData",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"}].concat(i)};var s={name:"SignerInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:e.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};r.signedDataValidator={name:"SignedData",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},n,{name:"SignedData.Certificates",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,capture:"signerInfos",optional:!0,value:[s]}]},r.recipientInfoValidator={name:"RecipientInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:e.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter"}]},{name:"RecipientInfo.encryptedKey",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}}),qN=ee(function(t){U.mgf=U.mgf||{};var e=t.exports=U.mgf.mgf1=U.mgf1=U.mgf1||{};e.create=function(r){var n={generate:function(i,s){for(var a=new U.util.ByteBuffer,c=Math.ceil(s/r.digestLength),o=0;o<c;o++){var l=new U.util.ByteBuffer;l.putInt32(o),r.start(),r.update(i+l.getBytes()),a.putBuffer(r.digest())}return a.truncate(a.length()-s),a.getBytes()}};return n}}),GN=U.mgf=U.mgf||{};U.mgf.mgf1=U.mgf1;var VN=ee(function(t){var e=t.exports=U.pss=U.pss||{};e.create=function(r){arguments.length===3&&(r={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var n=r.md,i=r.mgf,s=n.digestLength,a=r.salt||null;typeof a=="string"&&(a=U.util.createBuffer(a));var c;if("saltLength"in r)c=r.saltLength;else if(a!==null)c=a.length();else throw new Error("Salt length not specified or specific salt not given.");if(a!==null&&a.length()!==c)throw new Error("Given salt length does not match length of given salt.");var o=r.prng||U.random,l={};return l.encode=function(u,h){var S,p=h-1,C=Math.ceil(p/8),T=u.digest().getBytes();if(C<s+c+2)throw new Error("Message is too long to encrypt.");var E;a===null?E=o.getBytesSync(c):E=a.bytes();var I=new U.util.ByteBuffer;I.fillWithByte(0,8),I.putBytes(T),I.putBytes(E),n.start(),n.update(I.getBytes());var x=n.digest().getBytes(),q=new U.util.ByteBuffer;q.fillWithByte(0,C-c-s-2),q.putByte(1),q.putBytes(E);var m=q.getBytes(),b=C-s-1,A=i.generate(x,b),d="";for(S=0;S<b;S++)d+=String.fromCharCode(m.charCodeAt(S)^A.charCodeAt(S));var f=65280>>8*C-p&255;return d=String.fromCharCode(d.charCodeAt(0)&~f)+d.substr(1),d+x+String.fromCharCode(188)},l.verify=function(u,h,S){var p,C=S-1,T=Math.ceil(C/8);if(h=h.substr(-T),T<s+c+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(h.charCodeAt(T-1)!==188)throw new Error("Encoded message does not end in 0xBC.");var E=T-s-1,I=h.substr(0,E),x=h.substr(E,s),q=65280>>8*T-C&255;if((I.charCodeAt(0)&q)!==0)throw new Error("Bits beyond keysize not zero as expected.");var m=i.generate(x,E),b="";for(p=0;p<E;p++)b+=String.fromCharCode(I.charCodeAt(p)^m.charCodeAt(p));b=String.fromCharCode(b.charCodeAt(0)&~q)+b.substr(1);var A=T-s-c-2;for(p=0;p<A;p++)if(b.charCodeAt(p)!==0)throw new Error("Leftmost octets not zero as expected");if(b.charCodeAt(A)!==1)throw new Error("Inconsistent PSS signature, 0x01 marker not found");var d=b.substr(-c),f=new U.util.ByteBuffer;f.fillWithByte(0,8),f.putBytes(u),f.putBytes(d),n.start(),n.update(f.getBytes());var _=n.digest().getBytes();return x===_},l}}),HN=ee(function(t){var e=U.asn1,r=t.exports=U.pki=U.pki||{},n=r.oids,i={};i.CN=n.commonName,i.commonName="CN",i.C=n.countryName,i.countryName="C",i.L=n.localityName,i.localityName="L",i.ST=n.stateOrProvinceName,i.stateOrProvinceName="ST",i.O=n.organizationName,i.organizationName="O",i.OU=n.organizationalUnitName,i.organizationalUnitName="OU",i.E=n.emailAddress,i.emailAddress="E";var s=U.pki.rsa.publicKeyValidator,a={name:"Certificate",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:e.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:e.Class.UNIVERSAL,type:e.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:e.Class.UNIVERSAL,type:e.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:e.Class.UNIVERSAL,type:e.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:e.Class.UNIVERSAL,type:e.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},s,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:e.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:e.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:e.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},c={name:"rsapss",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:e.Class.UNIVERSAL,type:e.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:e.Class.UNIVERSAL,type:e.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:e.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:e.Class.UNIVERSAL,type:e.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:e.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:e.Class.UNIVERSAL,type:e.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},o={name:"CertificationRequestInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},s,{name:"CertificationRequestInfo.attributes",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,constructed:!0}]}]}]},l={name:"CertificationRequest",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[o,{name:"CertificationRequest.signatureAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:e.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};r.RDNAttributesAsArray=function(m,b){for(var A=[],d,f,_,y=0;y<m.value.length;++y){d=m.value[y];for(var k=0;k<d.value.length;++k)_={},f=d.value[k],_.type=e.derToOid(f.value[0].value),_.value=f.value[1].value,_.valueTagClass=f.value[1].type,_.type in n&&(_.name=n[_.type],_.name in i&&(_.shortName=i[_.name])),b&&(b.update(_.type),b.update(_.value)),A.push(_)}return A},r.CRIAttributesAsArray=function(m){for(var b=[],A=0;A<m.length;++A)for(var d=m[A],f=e.derToOid(d.value[0].value),_=d.value[1].value,y=0;y<_.length;++y){var k={};if(k.type=f,k.value=_[y].value,k.valueTagClass=_[y].type,k.type in n&&(k.name=n[k.type],k.name in i&&(k.shortName=i[k.name])),k.type===n.extensionRequest){k.extensions=[];for(var N=0;N<k.value.length;++N)k.extensions.push(r.certificateExtensionFromAsn1(k.value[N]))}b.push(k)}return b};function u(m,b){typeof b=="string"&&(b={shortName:b});for(var A=null,d,f=0;A===null&&f<m.attributes.length;++f)d=m.attributes[f],(b.type&&b.type===d.type||(b.name&&b.name===d.name||b.shortName&&b.shortName===d.shortName))&&(A=d);return A}var h=function(m,b,A){var d={};if(m!==n["RSASSA-PSS"])return d;A&&(d={hash:{algorithmOid:n.sha1},mgf:{algorithmOid:n.mgf1,hash:{algorithmOid:n.sha1}},saltLength:20});var f={},_=[];if(!e.validate(b,c,f,_)){var y=new Error("Cannot read RSASSA-PSS parameter block.");throw y.errors=_,y}return f.hashOid!==void 0&&(d.hash=d.hash||{},d.hash.algorithmOid=e.derToOid(f.hashOid)),f.maskGenOid!==void 0&&(d.mgf=d.mgf||{},d.mgf.algorithmOid=e.derToOid(f.maskGenOid),d.mgf.hash=d.mgf.hash||{},d.mgf.hash.algorithmOid=e.derToOid(f.maskGenHashOid)),f.saltLength!==void 0&&(d.saltLength=f.saltLength.charCodeAt(0)),d};r.certificateFromPem=function(m,b,A){var d=U.pem.decode(m)[0];if(d.type!=="CERTIFICATE"&&d.type!=="X509 CERTIFICATE"&&d.type!=="TRUSTED CERTIFICATE"){var f=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw f.headerType=d.type,f}if(d.procType&&d.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var _=e.fromDer(d.body,A);return r.certificateFromAsn1(_,b)},r.certificateToPem=function(m,b){var A={type:"CERTIFICATE",body:e.toDer(r.certificateToAsn1(m)).getBytes()};return U.pem.encode(A,{maxline:b})},r.publicKeyFromPem=function(m){var b=U.pem.decode(m)[0];if(b.type!=="PUBLIC KEY"&&b.type!=="RSA PUBLIC KEY"){var A=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw A.headerType=b.type,A}if(b.procType&&b.procType.type==="ENCRYPTED")throw new Error("Could not convert public key from PEM; PEM is encrypted.");var d=e.fromDer(b.body);return r.publicKeyFromAsn1(d)},r.publicKeyToPem=function(m,b){var A={type:"PUBLIC KEY",body:e.toDer(r.publicKeyToAsn1(m)).getBytes()};return U.pem.encode(A,{maxline:b})},r.publicKeyToRSAPublicKeyPem=function(m,b){var A={type:"RSA PUBLIC KEY",body:e.toDer(r.publicKeyToRSAPublicKey(m)).getBytes()};return U.pem.encode(A,{maxline:b})},r.getPublicKeyFingerprint=function(m,b){b=b||{};var A=b.md||U.md.sha1.create(),d=b.type||"RSAPublicKey",f;switch(d){case"RSAPublicKey":f=e.toDer(r.publicKeyToRSAPublicKey(m)).getBytes();break;case"SubjectPublicKeyInfo":f=e.toDer(r.publicKeyToAsn1(m)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+b.type+'".')}A.start(),A.update(f);var _=A.digest();if(b.encoding==="hex"){var y=_.toHex();return b.delimiter?y.match(/.{2}/g).join(b.delimiter):y}else{if(b.encoding==="binary")return _.getBytes();if(b.encoding)throw new Error('Unknown encoding "'+b.encoding+'".')}return _},r.certificationRequestFromPem=function(m,b,A){var d=U.pem.decode(m)[0];if(d.type!=="CERTIFICATE REQUEST"){var f=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw f.headerType=d.type,f}if(d.procType&&d.procType.type==="ENCRYPTED")throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var _=e.fromDer(d.body,A);return r.certificationRequestFromAsn1(_,b)},r.certificationRequestToPem=function(m,b){var A={type:"CERTIFICATE REQUEST",body:e.toDer(r.certificationRequestToAsn1(m)).getBytes()};return U.pem.encode(A,{maxline:b})},r.createCertificate=function(){var m={};return m.version=2,m.serialNumber="00",m.signatureOid=null,m.signature=null,m.siginfo={},m.siginfo.algorithmOid=null,m.validity={},m.validity.notBefore=new Date,m.validity.notAfter=new Date,m.issuer={},m.issuer.getField=function(b){return u(m.issuer,b)},m.issuer.addField=function(b){p([b]),m.issuer.attributes.push(b)},m.issuer.attributes=[],m.issuer.hash=null,m.subject={},m.subject.getField=function(b){return u(m.subject,b)},m.subject.addField=function(b){p([b]),m.subject.attributes.push(b)},m.subject.attributes=[],m.subject.hash=null,m.extensions=[],m.publicKey=null,m.md=null,m.setSubject=function(b,A){p(b),m.subject.attributes=b,delete m.subject.uniqueId,A&&(m.subject.uniqueId=A),m.subject.hash=null},m.setIssuer=function(b,A){p(b),m.issuer.attributes=b,delete m.issuer.uniqueId,A&&(m.issuer.uniqueId=A),m.issuer.hash=null},m.setExtensions=function(b){for(var A=0;A<b.length;++A)C(b[A],{cert:m});m.extensions=b},m.getExtension=function(b){typeof b=="string"&&(b={name:b});for(var A=null,d,f=0;A===null&&f<m.extensions.length;++f)d=m.extensions[f],(b.id&&d.id===b.id||b.name&&d.name===b.name)&&(A=d);return A},m.sign=function(b,A){m.md=A||U.md.sha1.create();var d=n[m.md.algorithm+"WithRSAEncryption"];if(!d){var f=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw f.algorithm=m.md.algorithm,f}m.signatureOid=m.siginfo.algorithmOid=d,m.tbsCertificate=r.getTBSCertificate(m);var _=e.toDer(m.tbsCertificate);m.md.update(_.getBytes()),m.signature=b.sign(m.md)},m.verify=function(b){var A=!1;if(!m.issued(b)){var d=b.issuer,f=m.subject,_=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw _.expectedIssuer=d.attributes,_.actualIssuer=f.attributes,_}var y=b.md;if(y===null){if(b.signatureOid in n){var k=n[b.signatureOid];switch(k){case"sha1WithRSAEncryption":y=U.md.sha1.create();break;case"md5WithRSAEncryption":y=U.md.md5.create();break;case"sha256WithRSAEncryption":y=U.md.sha256.create();break;case"sha384WithRSAEncryption":y=U.md.sha384.create();break;case"sha512WithRSAEncryption":y=U.md.sha512.create();break;case"RSASSA-PSS":y=U.md.sha256.create();break}}if(y===null){var _=new Error("Could not compute certificate digest. Unknown signature OID.");throw _.signatureOid=b.signatureOid,_}var N=b.tbsCertificate||r.getTBSCertificate(b),D=e.toDer(N);y.update(D.getBytes())}if(y!==null){var M;switch(b.signatureOid){case n.sha1WithRSAEncryption:M=void 0;break;case n["RSASSA-PSS"]:var L,$;if(L=n[b.signatureParameters.mgf.hash.algorithmOid],L===void 0||U.md[L]===void 0){var _=new Error("Unsupported MGF hash function.");throw _.oid=b.signatureParameters.mgf.hash.algorithmOid,_.name=L,_}if($=n[b.signatureParameters.mgf.algorithmOid],$===void 0||U.mgf[$]===void 0){var _=new Error("Unsupported MGF function.");throw _.oid=b.signatureParameters.mgf.algorithmOid,_.name=$,_}if($=U.mgf[$].create(U.md[L].create()),L=n[b.signatureParameters.hash.algorithmOid],L===void 0||U.md[L]===void 0)throw{message:"Unsupported RSASSA-PSS hash function.",oid:b.signatureParameters.hash.algorithmOid,name:L};M=U.pss.create(U.md[L].create(),$,b.signatureParameters.saltLength);break}A=m.publicKey.verify(y.digest().getBytes(),b.signature,M)}return A},m.isIssuer=function(b){var A=!1,d=m.issuer,f=b.subject;if(d.hash&&f.hash)A=d.hash===f.hash;else if(d.attributes.length===f.attributes.length){A=!0;for(var _,y,k=0;A&&k<d.attributes.length;++k)_=d.attributes[k],y=f.attributes[k],(_.type!==y.type||_.value!==y.value)&&(A=!1)}return A},m.issued=function(b){return b.isIssuer(m)},m.generateSubjectKeyIdentifier=function(){return r.getPublicKeyFingerprint(m.publicKey,{type:"RSAPublicKey"})},m.verifySubjectKeyIdentifier=function(){for(var b=n.subjectKeyIdentifier,A=0;A<m.extensions.length;++A){var d=m.extensions[A];if(d.id===b){var f=m.generateSubjectKeyIdentifier().getBytes();return U.util.hexToBytes(d.subjectKeyIdentifier)===f}}return!1},m},r.certificateFromAsn1=function(m,b){var A={},d=[];if(!e.validate(m,a,A,d)){var f=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw f.errors=d,f}var _=e.derToOid(A.publicKeyOid);if(_!==r.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var y=r.createCertificate();y.version=A.certVersion?A.certVersion.charCodeAt(0):0;var k=U.util.createBuffer(A.certSerialNumber);y.serialNumber=k.toHex(),y.signatureOid=U.asn1.derToOid(A.certSignatureOid),y.signatureParameters=h(y.signatureOid,A.certSignatureParams,!0),y.siginfo.algorithmOid=U.asn1.derToOid(A.certinfoSignatureOid),y.siginfo.parameters=h(y.siginfo.algorithmOid,A.certinfoSignatureParams,!1),y.signature=A.certSignature;var N=[];if(A.certValidity1UTCTime!==void 0&&N.push(e.utcTimeToDate(A.certValidity1UTCTime)),A.certValidity2GeneralizedTime!==void 0&&N.push(e.generalizedTimeToDate(A.certValidity2GeneralizedTime)),A.certValidity3UTCTime!==void 0&&N.push(e.utcTimeToDate(A.certValidity3UTCTime)),A.certValidity4GeneralizedTime!==void 0&&N.push(e.generalizedTimeToDate(A.certValidity4GeneralizedTime)),N.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(N.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(y.validity.notBefore=N[0],y.validity.notAfter=N[1],y.tbsCertificate=A.tbsCertificate,b){if(y.md=null,y.signatureOid in n){var _=n[y.signatureOid];switch(_){case"sha1WithRSAEncryption":y.md=U.md.sha1.create();break;case"md5WithRSAEncryption":y.md=U.md.md5.create();break;case"sha256WithRSAEncryption":y.md=U.md.sha256.create();break;case"sha384WithRSAEncryption":y.md=U.md.sha384.create();break;case"sha512WithRSAEncryption":y.md=U.md.sha512.create();break;case"RSASSA-PSS":y.md=U.md.sha256.create();break}}if(y.md===null){var f=new Error("Could not compute certificate digest. Unknown signature OID.");throw f.signatureOid=y.signatureOid,f}var D=e.toDer(y.tbsCertificate);y.md.update(D.getBytes())}var M=U.md.sha1.create();y.issuer.getField=function($){return u(y.issuer,$)},y.issuer.addField=function($){p([$]),y.issuer.attributes.push($)},y.issuer.attributes=r.RDNAttributesAsArray(A.certIssuer,M),A.certIssuerUniqueId&&(y.issuer.uniqueId=A.certIssuerUniqueId),y.issuer.hash=M.digest().toHex();var L=U.md.sha1.create();return y.subject.getField=function($){return u(y.subject,$)},y.subject.addField=function($){p([$]),y.subject.attributes.push($)},y.subject.attributes=r.RDNAttributesAsArray(A.certSubject,L),A.certSubjectUniqueId&&(y.subject.uniqueId=A.certSubjectUniqueId),y.subject.hash=L.digest().toHex(),A.certExtensions?y.extensions=r.certificateExtensionsFromAsn1(A.certExtensions):y.extensions=[],y.publicKey=r.publicKeyFromAsn1(A.subjectPublicKeyInfo),y},r.certificateExtensionsFromAsn1=function(m){for(var b=[],A=0;A<m.value.length;++A)for(var d=m.value[A],f=0;f<d.value.length;++f)b.push(r.certificateExtensionFromAsn1(d.value[f]));return b},r.certificateExtensionFromAsn1=function(m){var b={};if(b.id=e.derToOid(m.value[0].value),b.critical=!1,m.value[1].type===e.Type.BOOLEAN?(b.critical=m.value[1].value.charCodeAt(0)!==0,b.value=m.value[2].value):b.value=m.value[1].value,b.id in n){if(b.name=n[b.id],b.name==="keyUsage"){var A=e.fromDer(b.value),d=0,f=0;A.value.length>1&&(d=A.value.charCodeAt(1),f=A.value.length>2?A.value.charCodeAt(2):0),b.digitalSignature=(d&128)===128,b.nonRepudiation=(d&64)===64,b.keyEncipherment=(d&32)===32,b.dataEncipherment=(d&16)===16,b.keyAgreement=(d&8)===8,b.keyCertSign=(d&4)===4,b.cRLSign=(d&2)===2,b.encipherOnly=(d&1)===1,b.decipherOnly=(f&128)===128}else if(b.name==="basicConstraints"){var A=e.fromDer(b.value);A.value.length>0&&A.value[0].type===e.Type.BOOLEAN?b.cA=A.value[0].value.charCodeAt(0)!==0:b.cA=!1;var _=null;A.value.length>0&&A.value[0].type===e.Type.INTEGER?_=A.value[0].value:A.value.length>1&&(_=A.value[1].value),_!==null&&(b.pathLenConstraint=e.derToInteger(_))}else if(b.name==="extKeyUsage")for(var A=e.fromDer(b.value),y=0;y<A.value.length;++y){var k=e.derToOid(A.value[y].value);k in n?b[n[k]]=!0:b[k]=!0}else if(b.name==="nsCertType"){var A=e.fromDer(b.value),d=0;A.value.length>1&&(d=A.value.charCodeAt(1)),b.client=(d&128)===128,b.server=(d&64)===64,b.email=(d&32)===32,b.objsign=(d&16)===16,b.reserved=(d&8)===8,b.sslCA=(d&4)===4,b.emailCA=(d&2)===2,b.objCA=(d&1)===1}else if(b.name==="subjectAltName"||b.name==="issuerAltName"){b.altNames=[];for(var N,A=e.fromDer(b.value),D=0;D<A.value.length;++D){N=A.value[D];var M={type:N.type,value:N.value};b.altNames.push(M);switch(N.type){case 1:case 2:case 6:break;case 7:M.ip=U.util.bytesToIP(N.value);break;case 8:M.oid=e.derToOid(N.value);break}}}else if(b.name==="subjectKeyIdentifier"){var A=e.fromDer(b.value);b.subjectKeyIdentifier=U.util.bytesToHex(A.value)}}return b},r.certificationRequestFromAsn1=function(m,b){var A={},d=[];if(!e.validate(m,l,A,d)){var f=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw f.errors=d,f}var _=e.derToOid(A.publicKeyOid);if(_!==r.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var y=r.createCertificationRequest();if(y.version=A.csrVersion?A.csrVersion.charCodeAt(0):0,y.signatureOid=U.asn1.derToOid(A.csrSignatureOid),y.signatureParameters=h(y.signatureOid,A.csrSignatureParams,!0),y.siginfo.algorithmOid=U.asn1.derToOid(A.csrSignatureOid),y.siginfo.parameters=h(y.siginfo.algorithmOid,A.csrSignatureParams,!1),y.signature=A.csrSignature,y.certificationRequestInfo=A.certificationRequestInfo,b){if(y.md=null,y.signatureOid in n){var _=n[y.signatureOid];switch(_){case"sha1WithRSAEncryption":y.md=U.md.sha1.create();break;case"md5WithRSAEncryption":y.md=U.md.md5.create();break;case"sha256WithRSAEncryption":y.md=U.md.sha256.create();break;case"sha384WithRSAEncryption":y.md=U.md.sha384.create();break;case"sha512WithRSAEncryption":y.md=U.md.sha512.create();break;case"RSASSA-PSS":y.md=U.md.sha256.create();break}}if(y.md===null){var f=new Error("Could not compute certification request digest. Unknown signature OID.");throw f.signatureOid=y.signatureOid,f}var k=e.toDer(y.certificationRequestInfo);y.md.update(k.getBytes())}var N=U.md.sha1.create();return y.subject.getField=function(D){return u(y.subject,D)},y.subject.addField=function(D){p([D]),y.subject.attributes.push(D)},y.subject.attributes=r.RDNAttributesAsArray(A.certificationRequestInfoSubject,N),y.subject.hash=N.digest().toHex(),y.publicKey=r.publicKeyFromAsn1(A.subjectPublicKeyInfo),y.getAttribute=function(D){return u(y,D)},y.addAttribute=function(D){p([D]),y.attributes.push(D)},y.attributes=r.CRIAttributesAsArray(A.certificationRequestInfoAttributes||[]),y},r.createCertificationRequest=function(){var m={};return m.version=0,m.signatureOid=null,m.signature=null,m.siginfo={},m.siginfo.algorithmOid=null,m.subject={},m.subject.getField=function(b){return u(m.subject,b)},m.subject.addField=function(b){p([b]),m.subject.attributes.push(b)},m.subject.attributes=[],m.subject.hash=null,m.publicKey=null,m.attributes=[],m.getAttribute=function(b){return u(m,b)},m.addAttribute=function(b){p([b]),m.attributes.push(b)},m.md=null,m.setSubject=function(b){p(b),m.subject.attributes=b,m.subject.hash=null},m.setAttributes=function(b){p(b),m.attributes=b},m.sign=function(b,A){m.md=A||U.md.sha1.create();var d=n[m.md.algorithm+"WithRSAEncryption"];if(!d){var f=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw f.algorithm=m.md.algorithm,f}m.signatureOid=m.siginfo.algorithmOid=d,m.certificationRequestInfo=r.getCertificationRequestInfo(m);var _=e.toDer(m.certificationRequestInfo);m.md.update(_.getBytes()),m.signature=b.sign(m.md)},m.verify=function(){var b=!1,A=m.md;if(A===null){if(m.signatureOid in n){var d=n[m.signatureOid];switch(d){case"sha1WithRSAEncryption":A=U.md.sha1.create();break;case"md5WithRSAEncryption":A=U.md.md5.create();break;case"sha256WithRSAEncryption":A=U.md.sha256.create();break;case"sha384WithRSAEncryption":A=U.md.sha384.create();break;case"sha512WithRSAEncryption":A=U.md.sha512.create();break;case"RSASSA-PSS":A=U.md.sha256.create();break}}if(A===null){var f=new Error("Could not compute certification request digest. Unknown signature OID.");throw f.signatureOid=m.signatureOid,f}var _=m.certificationRequestInfo||r.getCertificationRequestInfo(m),y=e.toDer(_);A.update(y.getBytes())}if(A!==null){var k;switch(m.signatureOid){case n.sha1WithRSAEncryption:break;case n["RSASSA-PSS"]:var N,D;if(N=n[m.signatureParameters.mgf.hash.algorithmOid],N===void 0||U.md[N]===void 0){var f=new Error("Unsupported MGF hash function.");throw f.oid=m.signatureParameters.mgf.hash.algorithmOid,f.name=N,f}if(D=n[m.signatureParameters.mgf.algorithmOid],D===void 0||U.mgf[D]===void 0){var f=new Error("Unsupported MGF function.");throw f.oid=m.signatureParameters.mgf.algorithmOid,f.name=D,f}if(D=U.mgf[D].create(U.md[N].create()),N=n[m.signatureParameters.hash.algorithmOid],N===void 0||U.md[N]===void 0){var f=new Error("Unsupported RSASSA-PSS hash function.");throw f.oid=m.signatureParameters.hash.algorithmOid,f.name=N,f}k=U.pss.create(U.md[N].create(),D,m.signatureParameters.saltLength);break}b=m.publicKey.verify(A.digest().getBytes(),m.signature,k)}return b},m};function S(m){for(var b=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]),A,d,f=m.attributes,_=0;_<f.length;++_){A=f[_];var y=A.value,k=e.Type.PRINTABLESTRING;"valueTagClass"in A&&(k=A.valueTagClass,k===e.Type.UTF8&&(y=U.util.encodeUtf8(y))),d=e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(A.type).getBytes()),e.create(e.Class.UNIVERSAL,k,!1,y)])]),b.value.push(d)}return b}function p(m){for(var b,A=0;A<m.length;++A){if(b=m[A],typeof b.name=="undefined"&&(b.type&&b.type in r.oids?b.name=r.oids[b.type]:b.shortName&&b.shortName in i&&(b.name=r.oids[i[b.shortName]])),typeof b.type=="undefined")if(b.name&&b.name in r.oids)b.type=r.oids[b.name];else{var d=new Error("Attribute type not specified.");throw d.attribute=b,d}if(typeof b.shortName=="undefined"&&(b.name&&b.name in i&&(b.shortName=i[b.name])),b.type===n.extensionRequest&&(b.valueConstructed=!0,b.valueTagClass=e.Type.SEQUENCE,!b.value&&b.extensions)){b.value=[];for(var f=0;f<b.extensions.length;++f)b.value.push(r.certificateExtensionToAsn1(C(b.extensions[f])))}if(typeof b.value=="undefined"){var d=new Error("Attribute value not specified.");throw d.attribute=b,d}}}function C(m,b){if(b=b||{},typeof m.name=="undefined"&&(m.id&&m.id in r.oids&&(m.name=r.oids[m.id])),typeof m.id=="undefined")if(m.name&&m.name in r.oids)m.id=r.oids[m.name];else{var A=new Error("Extension ID not specified.");throw A.extension=m,A}if(typeof m.value!="undefined")return m;if(m.name==="keyUsage"){var d=0,f=0,_=0;m.digitalSignature&&(f|=128,d=7),m.nonRepudiation&&(f|=64,d=6),m.keyEncipherment&&(f|=32,d=5),m.dataEncipherment&&(f|=16,d=4),m.keyAgreement&&(f|=8,d=3),m.keyCertSign&&(f|=4,d=2),m.cRLSign&&(f|=2,d=1),m.encipherOnly&&(f|=1,d=0),m.decipherOnly&&(_|=128,d=7);var y=String.fromCharCode(d);_!==0?y+=String.fromCharCode(f)+String.fromCharCode(_):f!==0&&(y+=String.fromCharCode(f)),m.value=e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,y)}else if(m.name==="basicConstraints")m.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]),m.cA&&m.value.value.push(e.create(e.Class.UNIVERSAL,e.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in m&&m.value.value.push(e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(m.pathLenConstraint).getBytes()));else if(m.name==="extKeyUsage"){m.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);var k=m.value.value;for(var N in m){if(m[N]!==!0)continue;N in n?k.push(e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(n[N]).getBytes())):N.indexOf(".")!==-1&&k.push(e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(N).getBytes()))}}else if(m.name==="nsCertType"){var d=0,f=0;m.client&&(f|=128,d=7),m.server&&(f|=64,d=6),m.email&&(f|=32,d=5),m.objsign&&(f|=16,d=4),m.reserved&&(f|=8,d=3),m.sslCA&&(f|=4,d=2),m.emailCA&&(f|=2,d=1),m.objCA&&(f|=1,d=0);var y=String.fromCharCode(d);f!==0&&(y+=String.fromCharCode(f)),m.value=e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,y)}else if(m.name==="subjectAltName"||m.name==="issuerAltName"){m.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);for(var D,M=0;M<m.altNames.length;++M){D=m.altNames[M];var y=D.value;if(D.type===7&&D.ip){if(y=U.util.bytesFromIP(D.ip),y===null){var A=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw A.extension=m,A}}else D.type===8&&(D.oid?y=e.oidToDer(e.oidToDer(D.oid)):y=e.oidToDer(y));m.value.value.push(e.create(e.Class.CONTEXT_SPECIFIC,D.type,!1,y))}}else if(m.name==="nsComment"&&b.cert){if(!/^[\x00-\x7F]*$/.test(m.comment)||m.comment.length<1||m.comment.length>128)throw new Error('Invalid "nsComment" content.');m.value=e.create(e.Class.UNIVERSAL,e.Type.IA5STRING,!1,m.comment)}else if(m.name==="subjectKeyIdentifier"&&b.cert){var L=b.cert.generateSubjectKeyIdentifier();m.subjectKeyIdentifier=L.toHex(),m.value=e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,L.getBytes())}else if(m.name==="authorityKeyIdentifier"&&b.cert){m.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);var k=m.value.value;if(m.keyIdentifier){var $=m.keyIdentifier===!0?b.cert.generateSubjectKeyIdentifier().getBytes():m.keyIdentifier;k.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!1,$))}if(m.authorityCertIssuer){var G=[e.create(e.Class.CONTEXT_SPECIFIC,4,!0,[S(m.authorityCertIssuer===!0?b.cert.issuer:m.authorityCertIssuer)])];k.push(e.create(e.Class.CONTEXT_SPECIFIC,1,!0,G))}if(m.serialNumber){var z=U.util.hexToBytes(m.serialNumber===!0?b.cert.serialNumber:m.serialNumber);k.push(e.create(e.Class.CONTEXT_SPECIFIC,2,!1,z))}}else if(m.name==="cRLDistributionPoints"){m.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);for(var k=m.value.value,te=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]),Z=e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[]),D,M=0;M<m.altNames.length;++M){D=m.altNames[M];var y=D.value;if(D.type===7&&D.ip){if(y=U.util.bytesFromIP(D.ip),y===null){var A=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw A.extension=m,A}}else D.type===8&&(D.oid?y=e.oidToDer(e.oidToDer(D.oid)):y=e.oidToDer(y));Z.value.push(e.create(e.Class.CONTEXT_SPECIFIC,D.type,!1,y))}te.value.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[Z])),k.push(te)}if(typeof m.value=="undefined"){var A=new Error("Extension value not specified.");throw A.extension=m,A}return m}function T(m,b){switch(m){case n["RSASSA-PSS"]:var A=[];return b.hash.algorithmOid!==void 0&&A.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(b.hash.algorithmOid).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")])])),b.mgf.algorithmOid!==void 0&&A.push(e.create(e.Class.CONTEXT_SPECIFIC,1,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(b.mgf.algorithmOid).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(b.mgf.hash.algorithmOid).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")])])])),b.saltLength!==void 0&&A.push(e.create(e.Class.CONTEXT_SPECIFIC,2,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(b.saltLength).getBytes())])),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,A);default:return e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")}}function E(m){var b=e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[]);if(m.attributes.length===0)return b;for(var A=m.attributes,d=0;d<A.length;++d){var f=A[d],_=f.value,y=e.Type.UTF8;"valueTagClass"in f&&(y=f.valueTagClass),y===e.Type.UTF8&&(_=U.util.encodeUtf8(_));var k=!1;"valueConstructed"in f&&(k=f.valueConstructed);var N=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(f.type).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[e.create(e.Class.UNIVERSAL,y,k,_)])]);b.value.push(N)}return b}var I=new Date("1950-01-01T00:00:00Z"),x=new Date("2050-01-01T00:00:00Z");function q(m){return m>=I&&m<x?e.create(e.Class.UNIVERSAL,e.Type.UTCTIME,!1,e.dateToUtcTime(m)):e.create(e.Class.UNIVERSAL,e.Type.GENERALIZEDTIME,!1,e.dateToGeneralizedTime(m))}r.getTBSCertificate=function(m){var b=q(m.validity.notBefore),A=q(m.validity.notAfter),d=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(m.version).getBytes())]),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,U.util.hexToBytes(m.serialNumber)),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(m.siginfo.algorithmOid).getBytes()),T(m.siginfo.algorithmOid,m.siginfo.parameters)]),S(m.issuer),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[b,A]),S(m.subject),r.publicKeyToAsn1(m.publicKey)]);return m.issuer.uniqueId&&d.value.push(e.create(e.Class.CONTEXT_SPECIFIC,1,!0,[e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,String.fromCharCode(0)+m.issuer.uniqueId)])),m.subject.uniqueId&&d.value.push(e.create(e.Class.CONTEXT_SPECIFIC,2,!0,[e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,String.fromCharCode(0)+m.subject.uniqueId)])),m.extensions.length>0&&d.value.push(r.certificateExtensionsToAsn1(m.extensions)),d},r.getCertificationRequestInfo=function(m){var b=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(m.version).getBytes()),S(m.subject),r.publicKeyToAsn1(m.publicKey),E(m)]);return b},r.distinguishedNameToAsn1=function(m){return S(m)},r.certificateToAsn1=function(m){var b=m.tbsCertificate||r.getTBSCertificate(m);return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[b,e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(m.signatureOid).getBytes()),T(m.signatureOid,m.signatureParameters)]),e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,String.fromCharCode(0)+m.signature)])},r.certificateExtensionsToAsn1=function(m){var b=e.create(e.Class.CONTEXT_SPECIFIC,3,!0,[]),A=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);b.value.push(A);for(var d=0;d<m.length;++d)A.value.push(r.certificateExtensionToAsn1(m[d]));return b},r.certificateExtensionToAsn1=function(m){var b=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);b.value.push(e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(m.id).getBytes())),m.critical&&b.value.push(e.create(e.Class.UNIVERSAL,e.Type.BOOLEAN,!1,String.fromCharCode(255)));var A=m.value;return typeof m.value!="string"&&(A=e.toDer(A).getBytes()),b.value.push(e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,A)),b},r.certificationRequestToAsn1=function(m){var b=m.certificationRequestInfo||r.getCertificationRequestInfo(m);return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[b,e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(m.signatureOid).getBytes()),T(m.signatureOid,m.signatureParameters)]),e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,String.fromCharCode(0)+m.signature)])},r.createCaStore=function(m){var b={certs:{}};b.getIssuer=function(y){var k=A(y.issuer);return k},b.addCertificate=function(y){if(typeof y=="string"&&(y=U.pki.certificateFromPem(y)),d(y.subject),!b.hasCertificate(y))if(y.subject.hash in b.certs){var k=b.certs[y.subject.hash];U.util.isArray(k)||(k=[k]),k.push(y),b.certs[y.subject.hash]=k}else b.certs[y.subject.hash]=y},b.hasCertificate=function(y){typeof y=="string"&&(y=U.pki.certificateFromPem(y));var k=A(y.subject);if(!k)return!1;U.util.isArray(k)||(k=[k]);for(var N=e.toDer(r.certificateToAsn1(y)).getBytes(),D=0;D<k.length;++D){var M=e.toDer(r.certificateToAsn1(k[D])).getBytes();if(N===M)return!0}return!1},b.listAllCertificates=function(){var y=[];for(var k in b.certs)if(b.certs.hasOwnProperty(k)){var N=b.certs[k];if(!U.util.isArray(N))y.push(N);else for(var D=0;D<N.length;++D)y.push(N[D])}return y},b.removeCertificate=function(y){var k;if(typeof y=="string"&&(y=U.pki.certificateFromPem(y)),d(y.subject),!b.hasCertificate(y))return null;var N=A(y.subject);if(!U.util.isArray(N))return k=b.certs[y.subject.hash],delete b.certs[y.subject.hash],k;for(var D=e.toDer(r.certificateToAsn1(y)).getBytes(),M=0;M<N.length;++M){var L=e.toDer(r.certificateToAsn1(N[M])).getBytes();D===L&&(k=N[M],N.splice(M,1))}return N.length===0&&delete b.certs[y.subject.hash],k};function A(y){return d(y),b.certs[y.hash]||null}function d(y){if(!y.hash){var k=U.md.sha1.create();y.attributes=r.RDNAttributesAsArray(S(y),k),y.hash=k.digest().toHex()}}if(m)for(var f=0;f<m.length;++f){var _=m[f];b.addCertificate(_)}return b},r.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},r.verifyCertificateChain=function(m,b,A){typeof A=="function"&&(A={verify:A}),A=A||{},b=b.slice(0);var d=b.slice(0),f=A.validityCheckDate;typeof f=="undefined"&&(f=new Date);var _=!0,y=null,k=0;do{var N=b.shift(),D=null,M=!1;if(f&&((f<N.validity.notBefore||f>N.validity.notAfter)&&(y={message:"Certificate is not valid yet or has expired.",error:r.certificateError.certificate_expired,notBefore:N.validity.notBefore,notAfter:N.validity.notAfter,now:f})),y===null){if(D=b[0]||m.getIssuer(N),D===null&&(N.isIssuer(N)&&(M=!0,D=N)),D){var L=D;U.util.isArray(L)||(L=[L]);for(var $=!1;!$&&L.length>0;){D=L.shift();try{$=D.verify(N)}catch(Te){}}$||(y={message:"Certificate signature is invalid.",error:r.certificateError.bad_certificate})}y===null&&(!D||M)&&!m.hasCertificate(N)&&(y={message:"Certificate is not trusted.",error:r.certificateError.unknown_ca})}if(y===null&&D&&!N.isIssuer(D)&&(y={message:"Certificate issuer is invalid.",error:r.certificateError.bad_certificate}),y===null)for(var G={keyUsage:!0,basicConstraints:!0},z=0;y===null&&z<N.extensions.length;++z){var te=N.extensions[z];te.critical&&!(te.name in G)&&(y={message:"Certificate has an unsupported critical extension.",error:r.certificateError.unsupported_certificate})}if(y===null&&(!_||b.length===0&&(!D||M))){var Z=N.getExtension("basicConstraints"),ye=N.getExtension("keyUsage");if(ye!==null&&((!ye.keyCertSign||Z===null)&&(y={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:r.certificateError.bad_certificate})),y===null&&Z!==null&&!Z.cA&&(y={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:r.certificateError.bad_certificate}),y===null&&ye!==null&&"pathLenConstraint"in Z){var we=k-1;we>Z.pathLenConstraint&&(y={message:"Certificate basicConstraints pathLenConstraint violated.",error:r.certificateError.bad_certificate})}}var oe=y===null?!0:y.error,ce=A.verify?A.verify(oe,k,d):oe;if(ce===!0)y=null;else throw oe===!0&&(y={message:"The application rejected the certificate.",error:r.certificateError.bad_certificate}),(ce||ce===0)&&(typeof ce=="object"&&!U.util.isArray(ce)?(ce.message&&(y.message=ce.message),ce.error&&(y.error=ce.error)):typeof ce=="string"&&(y.error=ce)),y;_=!1,++k}while(b.length>0);return!0}}),zN=ee(function(t){var e=U.asn1,r=t.exports=U.pkcs7=U.pkcs7||{};r.messageFromPem=function(p){var C=U.pem.decode(p)[0];if(C.type!=="PKCS7"){var T=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw T.headerType=C.type,T}if(C.procType&&C.procType.type==="ENCRYPTED")throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var E=e.fromDer(C.body);return r.messageFromAsn1(E)},r.messageToPem=function(p,C){var T={type:"PKCS7",body:e.toDer(p.toAsn1()).getBytes()};return U.pem.encode(T,{maxline:C})},r.messageFromAsn1=function(p){var C={},T=[];if(!e.validate(p,r.asn1.contentInfoValidator,C,T)){var E=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw E.errors=T,E}var I=e.derToOid(C.contentType),x;switch(I){case U.pki.oids.envelopedData:x=r.createEnvelopedData();break;case U.pki.oids.encryptedData:x=r.createEncryptedData();break;case U.pki.oids.signedData:x=r.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+I+" is not (yet) supported.")}return x.fromAsn1(C.content.value[0]),x},r.createSignedData=function(){var p=null;return p={type:U.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(E){if(h(p,E,r.asn1.signedDataValidator),p.certificates=[],p.crls=[],p.digestAlgorithmIdentifiers=[],p.contentInfo=null,p.signerInfos=[],p.rawCapture.certificates)for(var I=p.rawCapture.certificates.value,x=0;x<I.length;++x)p.certificates.push(U.pki.certificateFromAsn1(I[x]))},toAsn1:function(){p.contentInfo||p.sign();for(var E=[],I=0;I<p.certificates.length;++I)E.push(U.pki.certificateToAsn1(p.certificates[I]));var x=[],q=e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(p.version).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,p.digestAlgorithmIdentifiers),p.contentInfo])]);return E.length>0&&q.value[0].value.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!0,E)),x.length>0&&q.value[0].value.push(e.create(e.Class.CONTEXT_SPECIFIC,1,!0,x)),q.value[0].value.push(e.create(e.Class.UNIVERSAL,e.Type.SET,!0,p.signerInfos)),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.type).getBytes()),q])},addSigner:function(E){var I=E.issuer,x=E.serialNumber;if(E.certificate){var q=E.certificate;typeof q=="string"&&(q=U.pki.certificateFromPem(q)),I=q.issuer.attributes,x=q.serialNumber}var m=E.key;if(!m)throw new Error("Could not add PKCS#7 signer; no private key specified.");typeof m=="string"&&(m=U.pki.privateKeyFromPem(m));var b=E.digestAlgorithm||U.pki.oids.sha1;switch(b){case U.pki.oids.sha1:case U.pki.oids.sha256:case U.pki.oids.sha384:case U.pki.oids.sha512:case U.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+b)}var A=E.authenticatedAttributes||[];if(A.length>0){for(var d=!1,f=!1,_=0;_<A.length;++_){var y=A[_];if(!d&&y.type===U.pki.oids.contentType){if(d=!0,f)break;continue}if(!f&&y.type===U.pki.oids.messageDigest){if(f=!0,d)break;continue}}if(!d||!f)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}p.signers.push({key:m,version:1,issuer:I,serialNumber:x,digestAlgorithm:b,signatureAlgorithm:U.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:A,unauthenticatedAttributes:[]})},sign:function(E){if(E=E||{},(typeof p.content!="object"||p.contentInfo===null)&&(p.contentInfo=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(U.pki.oids.data).getBytes())]),"content"in p)){var I;p.content instanceof U.util.ByteBuffer?I=p.content.bytes():typeof p.content=="string"&&(I=U.util.encodeUtf8(p.content)),E.detached?p.detachedContent=e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,I):p.contentInfo.value.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,I)]))}if(p.signers.length===0)return;var x=C();T(x)},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(E){typeof E=="string"&&(E=U.pki.certificateFromPem(E)),p.certificates.push(E)},addCertificateRevokationList:function(E){throw new Error("PKCS#7 CRL support not yet implemented.")}},p;function C(){for(var E={},I=0;I<p.signers.length;++I){var x=p.signers[I],q=x.digestAlgorithm;q in E||(E[q]=U.md[U.pki.oids[q]].create()),x.authenticatedAttributes.length===0?x.md=E[q]:x.md=U.md[U.pki.oids[q]].create()}p.digestAlgorithmIdentifiers=[];for(var q in E)p.digestAlgorithmIdentifiers.push(e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(q).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")]));return E}function T(E){var I;if(p.detachedContent?I=p.detachedContent:(I=p.contentInfo.value[1],I=I.value[0]),!I)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var x=e.derToOid(p.contentInfo.value[0].value),q=e.toDer(I);q.getByte(),e.getBerValueLength(q),q=q.getBytes();for(var m in E)E[m].start().update(q);for(var b=new Date,A=0;A<p.signers.length;++A){var d=p.signers[A];if(d.authenticatedAttributes.length===0){if(x!==U.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{d.authenticatedAttributesAsn1=e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var f=e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[]),_=0;_<d.authenticatedAttributes.length;++_){var y=d.authenticatedAttributes[_];y.type===U.pki.oids.messageDigest?y.value=E[d.digestAlgorithm].digest():y.type===U.pki.oids.signingTime&&(y.value||(y.value=b)),f.value.push(l(y)),d.authenticatedAttributesAsn1.value.push(l(y))}q=e.toDer(f).getBytes(),d.md.start().update(q)}d.signature=d.key.sign(d.md,"RSASSA-PKCS1-V1_5")}p.signerInfos=o(p.signers)}},r.createEncryptedData=function(){var p=null;return p={type:U.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:U.pki.oids["aes256-CBC"]},fromAsn1:function(C){h(p,C,r.asn1.encryptedDataValidator)},decrypt:function(C){C!==void 0&&(p.encryptedContent.key=C),S(p)}},p},r.createEnvelopedData=function(){var p=null;return p={type:U.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:U.pki.oids["aes256-CBC"]},fromAsn1:function(C){var T=h(p,C,r.asn1.envelopedDataValidator);p.recipients=s(T.recipientInfos.value)},toAsn1:function(){return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.type).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(p.version).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,a(p.recipients)),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,u(p.encryptedContent))])])])},findRecipient:function(C){for(var T=C.issuer.attributes,E=0;E<p.recipients.length;++E){var I=p.recipients[E],x=I.issuer;if(I.serialNumber!==C.serialNumber)continue;if(x.length!==T.length)continue;for(var q=!0,m=0;m<T.length;++m)if(x[m].type!==T[m].type||x[m].value!==T[m].value){q=!1;break}if(q)return I}return null},decrypt:function(C,T){if(p.encryptedContent.key===void 0&&C!==void 0&&T!==void 0)switch(C.encryptedContent.algorithm){case U.pki.oids.rsaEncryption:case U.pki.oids.desCBC:var E=T.decrypt(C.encryptedContent.content);p.encryptedContent.key=U.util.createBuffer(E);break;default:throw new Error("Unsupported asymmetric cipher, OID "+C.encryptedContent.algorithm)}S(p)},addRecipient:function(C){p.recipients.push({version:0,issuer:C.issuer.attributes,serialNumber:C.serialNumber,encryptedContent:{algorithm:U.pki.oids.rsaEncryption,key:C.publicKey}})},encrypt:function(C,T){if(p.encryptedContent.content===void 0){T=T||p.encryptedContent.algorithm,C=C||p.encryptedContent.key;var E,I,x;switch(T){case U.pki.oids["aes128-CBC"]:E=16,I=16,x=U.aes.createEncryptionCipher;break;case U.pki.oids["aes192-CBC"]:E=24,I=16,x=U.aes.createEncryptionCipher;break;case U.pki.oids["aes256-CBC"]:E=32,I=16,x=U.aes.createEncryptionCipher;break;case U.pki.oids["des-EDE3-CBC"]:E=24,I=8,x=U.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+T)}if(C===void 0)C=U.util.createBuffer(U.random.getBytes(E));else if(C.length()!=E)throw new Error("Symmetric key has wrong length; got "+C.length()+" bytes, expected "+E+".");p.encryptedContent.algorithm=T,p.encryptedContent.key=C,p.encryptedContent.parameter=U.util.createBuffer(U.random.getBytes(I));var q=x(C);if(q.start(p.encryptedContent.parameter.copy()),q.update(p.content),!q.finish())throw new Error("Symmetric encryption failed.");p.encryptedContent.content=q.output}for(var m=0;m<p.recipients.length;++m){var b=p.recipients[m];if(b.encryptedContent.content!==void 0)continue;switch(b.encryptedContent.algorithm){case U.pki.oids.rsaEncryption:b.encryptedContent.content=b.encryptedContent.key.encrypt(p.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+b.encryptedContent.algorithm)}}}},p};function n(p){var C={},T=[];if(!e.validate(p,r.asn1.recipientInfoValidator,C,T)){var E=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw E.errors=T,E}return{version:C.version.charCodeAt(0),issuer:U.pki.RDNAttributesAsArray(C.issuer),serialNumber:U.util.createBuffer(C.serial).toHex(),encryptedContent:{algorithm:e.derToOid(C.encAlgorithm),parameter:C.encParameter.value,content:C.encKey}}}function i(p){return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(p.version).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[U.pki.distinguishedNameToAsn1({attributes:p.issuer}),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,U.util.hexToBytes(p.serialNumber))]),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.encryptedContent.algorithm).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")]),e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.encryptedContent.content)])}function s(p){for(var C=[],T=0;T<p.length;++T)C.push(n(p[T]));return C}function a(p){for(var C=[],T=0;T<p.length;++T)C.push(i(p[T]));return C}function c(p){var C=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(p.version).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[U.pki.distinguishedNameToAsn1({attributes:p.issuer}),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,U.util.hexToBytes(p.serialNumber))]),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.digestAlgorithm).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")])]);if(p.authenticatedAttributesAsn1&&C.value.push(p.authenticatedAttributesAsn1),C.value.push(e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.signatureAlgorithm).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")])),C.value.push(e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.signature)),p.unauthenticatedAttributes.length>0){for(var T=e.create(e.Class.CONTEXT_SPECIFIC,1,!0,[]),E=0;E<p.unauthenticatedAttributes.length;++E){var I=p.unauthenticatedAttributes[E];T.values.push(l(I))}C.value.push(T)}return C}function o(p){for(var C=[],T=0;T<p.length;++T)C.push(c(p[T]));return C}function l(p){var C;if(p.type===U.pki.oids.contentType)C=e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.value).getBytes());else if(p.type===U.pki.oids.messageDigest)C=e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.value.bytes());else if(p.type===U.pki.oids.signingTime){var T=new Date("1950-01-01T00:00:00Z"),E=new Date("2050-01-01T00:00:00Z"),I=p.value;if(typeof I=="string"){var x=Date.parse(I);isNaN(x)?I.length===13?I=e.utcTimeToDate(I):I=e.generalizedTimeToDate(I):I=new Date(x)}I>=T&&I<E?C=e.create(e.Class.UNIVERSAL,e.Type.UTCTIME,!1,e.dateToUtcTime(I)):C=e.create(e.Class.UNIVERSAL,e.Type.GENERALIZEDTIME,!1,e.dateToGeneralizedTime(I))}return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.type).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[C])])}function u(p){return[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(U.pki.oids.data).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.algorithm).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.parameter.getBytes())]),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.content.getBytes())])]}function h(p,C,T){var E={},I=[];if(!e.validate(C,T,E,I)){var x=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw x.errors=x,x}var q=e.derToOid(E.contentType);if(q!==U.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(E.encryptedContent){var m="";if(U.util.isArray(E.encryptedContent))for(var b=0;b<E.encryptedContent.length;++b){if(E.encryptedContent[b].type!==e.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");m+=E.encryptedContent[b].value}else m=E.encryptedContent;p.encryptedContent={algorithm:e.derToOid(E.encAlgorithm),parameter:U.util.createBuffer(E.encParameter.value),content:U.util.createBuffer(m)}}if(E.content){var m="";if(U.util.isArray(E.content))for(var b=0;b<E.content.length;++b){if(E.content[b].type!==e.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");m+=E.content[b].value}else m=E.content;p.content=U.util.createBuffer(m)}return p.version=E.version.charCodeAt(0),p.rawCapture=E,E}function S(p){if(p.encryptedContent.key===void 0)throw new Error("Symmetric key not available.");if(p.content===void 0){var C;switch(p.encryptedContent.algorithm){case U.pki.oids["aes128-CBC"]:case U.pki.oids["aes192-CBC"]:case U.pki.oids["aes256-CBC"]:C=U.aes.createDecryptionCipher(p.encryptedContent.key);break;case U.pki.oids.desCBC:case U.pki.oids["des-EDE3-CBC"]:C=U.des.createDecryptionCipher(p.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+p.encryptedContent.algorithm)}if(C.start(p.encryptedContent.parameter),C.update(p.encryptedContent.content),!C.finish())throw new Error("Symmetric decryption failed.");p.content=C.output}}}),ww=ee(function(t,e){const r=U.pki;e=t.exports,e.certificateForKey=(i,s)=>{const a=r.setRsaPublicKey(s.n,s.e),c=r.createCertificate();c.publicKey=a,c.serialNumber="01",c.validity.notBefore=new Date,c.validity.notAfter=new Date,c.validity.notAfter.setFullYear(c.validity.notBefore.getFullYear()+10);const o=[{name:"organizationName",value:"ipfs"},{shortName:"OU",value:"keystore"},{name:"commonName",value:i.id}];return c.setSubject(o),c.setIssuer(o),c.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"extKeyUsage",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:"nsCertType",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),c.sign(s),c};async function n(i,s){const a=i.map(s),c=await Promise.all(a),o=c.findIndex(l=>l);return i[o]}t.exports.findAsync=n});const{certificateForKey:Sw,findAsync:_w}=ww,ol=new WeakMap;class Ew{constructor(t,e){if(!t)throw F(new Error("keychain is required"),"ERR_KEYCHAIN_REQUIRED");this.keychain=t,ol.set(this,{dek:e})}async encrypt(t,e){if(!(e instanceof Uint8Array))throw F(new Error("Plain data must be a Uint8Array"),"ERR_INVALID_PARAMS");const r=await this.keychain.findKeyByName(t),n=await this.keychain._getPrivateKey(t),i=ol.get(this).dek,s=U.pki.decryptRsaPrivateKey(n,i),a=await Sw(r,s),c=U.pkcs7.createEnvelopedData();c.addRecipient(a),c.content=U.util.createBuffer(e),c.encrypt();const o=U.asn1.toDer(c.toAsn1()).getBytes();return qe(o,"ascii")}async decrypt(t){if(!(t instanceof Uint8Array))throw F(new Error("CMS data is required"),"ERR_INVALID_PARAMS");let e;try{const o=U.util.createBuffer(ae(t,"ascii")),l=U.asn1.fromDer(o);e=U.pkcs7.messageFromAsn1(l)}catch(o){throw F(new Error("Invalid CMS: "+o.message),"ERR_INVALID_CMS")}const r=e.recipients.filter(o=>o.issuer.find(l=>l.shortName==="O"&&l.value==="ipfs")).filter(o=>o.issuer.find(l=>l.shortName==="CN")).map(o=>({recipient:o,keyId:o.issuer.find(l=>l.shortName==="CN").value})),n=await _w(r,async o=>{try{const l=await this.keychain.findKeyById(o.keyId);if(l)return!0}catch(l){return!1}return!1});if(!n){const o=r.map(l=>l.keyId);throw F(new Error("Decryption needs one of the key(s): "+o.join(", ")),"ERR_MISSING_KEYS",{missingKeys:o})}const i=await this.keychain.findKeyById(n.keyId);if(!i)throw F(new Error("No key available to decrypto"),"ERR_NO_KEY");const s=await this.keychain._getPrivateKey(i.name),a=ol.get(this).dek,c=U.pki.decryptRsaPrivateKey(s,a);return e.decrypt(n.recipient,c),qe(e.content.getBytes(),"ascii")}}var Tw=Ew;const{Number:Aw}=An,Cw="/pkcs8/",Mp="/info/",Xi=new WeakMap,di={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},cl={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function Zr(t){return t?typeof t!="string"?!1:t===vw(t.trim()):!1}async function je(t){const e=200,r=1e3,n=Math.random()*(r-e)+e;throw await new Promise(i=>setTimeout(i,n)),t}function Pn(t){return new Rc.Key(Cw+t)}function pi(t){return new Rc.Key(Mp+t)}class Iw{constructor(t,e){if(!t)throw new Error("store is required");if(this.store=t,this.opts=ao(cl,e),this.opts.passPhrase&&this.opts.passPhrase.length<20)throw new Error("passPhrase must be least 20 characters");if(this.opts.dek.keyLength<di.minKeyLength)throw new Error(`dek.keyLength must be least ${di.minKeyLength} bytes`);if(this.opts.dek.salt.length<di.minSaltLength)throw new Error(`dek.saltLength must be least ${di.minSaltLength} bytes`);if(this.opts.dek.iterationCount<di.minIterationCount)throw new Error(`dek.iterationCount must be least ${di.minIterationCount}`);const r=this.opts.passPhrase?sr.pbkdf2(this.opts.passPhrase,this.opts.dek.salt,this.opts.dek.iterationCount,this.opts.dek.keyLength,this.opts.dek.hash):"";Xi.set(this,{dek:r})}get cms(){return new Tw(this,Xi.get(this).dek)}static generateOptions(){const t=Object.assign({},cl),e=Math.ceil(di.minSaltLength/3)*3;return t.dek.salt=ae(sr.randomBytes(e),"base64"),t}static get options(){return cl}async createKey(t,e,r=2048){const n=this;if(!Zr(t)||t==="self")return je(F(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));if(typeof e!="string")return je(F(new Error(`Invalid key type '${e}'`),"ERR_INVALID_KEY_TYPE"));const i=Pn(t),s=await n.store.has(i);if(s)return je(F(new Error(`Key '${t}' already exists`),"ERR_KEY_ALREADY_EXISTS"));switch(e.toLowerCase()){case"rsa":if(!Aw.isSafeInteger(r)||r<2048)return je(F(new Error(`Invalid RSA key size ${r}`),"ERR_INVALID_KEY_SIZE"));break}let a;try{const c=await sr.keys.generateKeyPair(e,r),o=await c.id(),l=Xi.get(this).dek,u=await c.export(l);a={name:t,id:o};const h=n.store.batch();h.put(i,qe(u)),h.put(pi(t),qe(JSON.stringify(a))),await h.commit()}catch(c){return je(c)}return a}async listKeys(){const t=this,e={prefix:Mp},r=[];for await(const n of t.store.query(e))r.push(JSON.parse(ae(n.value)));return r}async findKeyById(t){try{const e=await this.listKeys();return e.find(r=>r.id===t)}catch(e){return je(e)}}async findKeyByName(t){if(!Zr(t))return je(F(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));const e=pi(t);try{const r=await this.store.get(e);return JSON.parse(ae(r))}catch(r){return je(F(new Error(`Key '${t}' does not exist. ${r.message}`),"ERR_KEY_NOT_FOUND"))}}async removeKey(t){const e=this;if(!Zr(t)||t==="self")return je(F(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));const r=Pn(t),n=await e.findKeyByName(t),i=e.store.batch();return i.delete(r),i.delete(pi(t)),await i.commit(),n}async renameKey(t,e){const r=this;if(!Zr(t)||t==="self")return je(F(new Error(`Invalid old key name '${t}'`),"ERR_OLD_KEY_NAME_INVALID"));if(!Zr(e)||e==="self")return je(F(new Error(`Invalid new key name '${e}'`),"ERR_NEW_KEY_NAME_INVALID"));const n=Pn(t),i=Pn(e),s=pi(t),a=pi(e),c=await r.store.has(i);if(c)return je(F(new Error(`Key '${e}' already exists`),"ERR_KEY_ALREADY_EXISTS"));try{const o=await r.store.get(n),l=await r.store.get(s),u=JSON.parse(ae(l));u.name=e;const h=r.store.batch();return h.put(i,o),h.put(a,qe(JSON.stringify(u))),h.delete(n),h.delete(s),await h.commit(),u}catch(o){return je(o)}}async exportKey(t,e){if(!Zr(t))return je(F(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));if(!e)return je(F(new Error("Password is required"),"ERR_PASSWORD_REQUIRED"));const r=Pn(t);try{const n=await this.store.get(r),i=ae(n),s=Xi.get(this).dek,a=await sr.keys.import(i,s);return a.export(e)}catch(n){return je(n)}}async importKey(t,e,r){const n=this;if(!Zr(t)||t==="self")return je(F(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));if(!e)return je(F(new Error("PEM encoded key is required"),"ERR_PEM_REQUIRED"));const i=Pn(t),s=await n.store.has(i);if(s)return je(F(new Error(`Key '${t}' already exists`),"ERR_KEY_ALREADY_EXISTS"));let a;try{a=await sr.keys.import(e,r)}catch(u){return je(F(new Error("Cannot read the key, most likely the password is wrong"),"ERR_CANNOT_READ_KEY"))}let c;try{c=await a.id();const u=Xi.get(this).dek;e=await a.export(u)}catch(u){return je(u)}const o={name:t,id:c},l=n.store.batch();return l.put(i,qe(e)),l.put(pi(t),qe(JSON.stringify(o))),await l.commit(),o}async importPeer(t,e){const r=this;if(!Zr(t))return je(F(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));if(!e||!e.privKey)return je(F(new Error("Peer.privKey is required"),"ERR_MISSING_PRIVATE_KEY"));const n=e.privKey,i=Pn(t),s=await r.store.has(i);if(s)return je(F(new Error(`Key '${t}' already exists`),"ERR_KEY_ALREADY_EXISTS"));try{const a=await n.id(),c=Xi.get(this).dek,o=await n.export(c),l={name:t,id:a},u=r.store.batch();return u.put(i,qe(o)),u.put(pi(t),qe(JSON.stringify(l))),await u.commit(),l}catch(a){return je(a)}}async _getPrivateKey(t){if(!Zr(t))return je(F(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));try{const e=Pn(t),r=await this.store.get(e);return ae(r)}catch(e){return je(F(new Error(`Key '${t}' does not exist. ${e.message}`),"ERR_KEY_NOT_FOUND"))}}}var Dp=Iw,Rw=t=>{const e=Jg(t);return e.delete=e.remove,e},kw=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,ll=Math.ceil,xr=Math.floor,Bt="[BigNumber Error] ",xp=Bt+"Number primitive has more than 15 significant digits: ",Sr=1e14,ge=14,ul=9007199254740991,dl=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Nn=1e7,lt=1e9;function Lp(t){var e,r,n,i=I.prototype={constructor:I,toString:null,valueOf:null},s=new I(1),a=20,c=4,o=-7,l=21,u=-1e7,h=1e7,S=!1,p=1,C=0,T={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},E="0123456789abcdefghijklmnopqrstuvwxyz";function I(d,f){var _,y,k,N,D,M,L,$,G=this;if(!(G instanceof I))return new I(d,f);if(f==null){if(d&&d._isBigNumber===!0){G.s=d.s,!d.c||d.e>h?G.c=G.e=null:d.e<u?G.c=[G.e=0]:(G.e=d.e,G.c=d.c.slice());return}if((M=typeof d=="number")&&d*0==0){if(G.s=1/d<0?(d=-d,-1):1,d===~~d){for(N=0,D=d;D>=10;D/=10,N++);N>h?G.c=G.e=null:(G.e=N,G.c=[d]);return}$=String(d)}else{if(!kw.test($=String(d)))return n(G,$,M);G.s=$.charCodeAt(0)==45?($=$.slice(1),-1):1}(N=$.indexOf("."))>-1&&($=$.replace(".","")),(D=$.search(/e/i))>0?(N<0&&(N=D),N+=+$.slice(D+1),$=$.substring(0,D)):N<0&&(N=$.length)}else{if(He(f,2,E.length,"Base"),f==10)return G=new I(d),b(G,a+G.e+1,c);if($=String(d),M=typeof d=="number"){if(d*0!=0)return n(G,$,M,f);if(G.s=1/d<0?($=$.slice(1),-1):1,I.DEBUG&&$.replace(/^0\.0*|\./,"").length>15)throw Error(xp+d)}else G.s=$.charCodeAt(0)===45?($=$.slice(1),-1):1;for(_=E.slice(0,f),N=D=0,L=$.length;D<L;D++)if(_.indexOf(y=$.charAt(D))<0){if(y=="."){if(D>N){N=L;continue}}else if(!k&&($==$.toUpperCase()&&($=$.toLowerCase())||$==$.toLowerCase()&&($=$.toUpperCase()))){k=!0,D=-1,N=0;continue}return n(G,String(d),M,f)}M=!1,$=r($,f,10,G.s),(N=$.indexOf("."))>-1?$=$.replace(".",""):N=$.length}for(D=0;$.charCodeAt(D)===48;D++);for(L=$.length;$.charCodeAt(--L)===48;);if($=$.slice(D,++L)){if(L-=D,M&&I.DEBUG&&L>15&&(d>ul||d!==xr(d)))throw Error(xp+G.s*d);if((N=N-D-1)>h)G.c=G.e=null;else if(N<u)G.c=[G.e=0];else{if(G.e=N,G.c=[],D=(N+1)%ge,N<0&&(D+=ge),D<L){for(D&&G.c.push(+$.slice(0,D)),L-=ge;D<L;)G.c.push(+$.slice(D,D+=ge));D=ge-($=$.slice(D)).length}else D-=L;for(;D--;$+="0");G.c.push(+$)}}else G.c=[G.e=0]}I.clone=Lp,I.ROUND_UP=0,I.ROUND_DOWN=1,I.ROUND_CEIL=2,I.ROUND_FLOOR=3,I.ROUND_HALF_UP=4,I.ROUND_HALF_DOWN=5,I.ROUND_HALF_EVEN=6,I.ROUND_HALF_CEIL=7,I.ROUND_HALF_FLOOR=8,I.EUCLID=9,I.config=I.set=function(d){var f,_;if(d!=null)if(typeof d=="object"){if(d.hasOwnProperty(f="DECIMAL_PLACES")&&(_=d[f],He(_,0,lt,f),a=_),d.hasOwnProperty(f="ROUNDING_MODE")&&(_=d[f],He(_,0,8,f),c=_),d.hasOwnProperty(f="EXPONENTIAL_AT")&&(_=d[f],_&&_.pop?(He(_[0],-lt,0,f),He(_[1],0,lt,f),o=_[0],l=_[1]):(He(_,-lt,lt,f),o=-(l=_<0?-_:_))),d.hasOwnProperty(f="RANGE"))if(_=d[f],_&&_.pop)He(_[0],-lt,-1,f),He(_[1],1,lt,f),u=_[0],h=_[1];else if(He(_,-lt,lt,f),_)u=-(h=_<0?-_:_);else throw Error(Bt+f+" cannot be zero: "+_);if(d.hasOwnProperty(f="CRYPTO"))if(_=d[f],_===!!_)if(_)if(typeof crypto!="undefined"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))S=_;else throw S=!_,Error(Bt+"crypto unavailable");else S=_;else throw Error(Bt+f+" not true or false: "+_);if(d.hasOwnProperty(f="MODULO_MODE")&&(_=d[f],He(_,0,9,f),p=_),d.hasOwnProperty(f="POW_PRECISION")&&(_=d[f],He(_,0,lt,f),C=_),d.hasOwnProperty(f="FORMAT"))if(_=d[f],typeof _=="object")T=_;else throw Error(Bt+f+" not an object: "+_);if(d.hasOwnProperty(f="ALPHABET"))if(_=d[f],typeof _=="string"&&!/^.$|[+-.\s]|(.).*\1/.test(_))E=_;else throw Error(Bt+f+" invalid: "+_)}else throw Error(Bt+"Object expected: "+d);return{DECIMAL_PLACES:a,ROUNDING_MODE:c,EXPONENTIAL_AT:[o,l],RANGE:[u,h],CRYPTO:S,MODULO_MODE:p,POW_PRECISION:C,FORMAT:T,ALPHABET:E}},I.isBigNumber=function(d){if(!d||d._isBigNumber!==!0)return!1;if(!I.DEBUG)return!0;var f,_,y=d.c,k=d.e,N=d.s;e:if({}.toString.call(y)=="[object Array]"){if((N===1||N===-1)&&k>=-lt&&k<=lt&&k===xr(k)){if(y[0]===0){if(k===0&&y.length===1)return!0;break e}if(f=(k+1)%ge,f<1&&(f+=ge),String(y[0]).length==f){for(f=0;f<y.length;f++)if(_=y[f],_<0||_>=Sr||_!==xr(_))break e;if(_!==0)return!0}}}else if(y===null&&k===null&&(N===null||N===1||N===-1))return!0;throw Error(Bt+"Invalid BigNumber: "+d)},I.maximum=I.max=function(){return q(arguments,i.lt)},I.minimum=I.min=function(){return q(arguments,i.gt)},I.random=function(){var d=9007199254740992,f=Math.random()*d&2097151?function(){return xr(Math.random()*d)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(_){var y,k,N,D,M,L=0,$=[],G=new I(s);if(_==null?_=a:He(_,0,lt),D=ll(_/ge),S)if(crypto.getRandomValues){for(y=crypto.getRandomValues(new Uint32Array(D*=2));L<D;)M=y[L]*131072+(y[L+1]>>>11),M>=9e15?(k=crypto.getRandomValues(new Uint32Array(2)),y[L]=k[0],y[L+1]=k[1]):($.push(M%1e14),L+=2);L=D/2}else if(crypto.randomBytes){for(y=crypto.randomBytes(D*=7);L<D;)M=(y[L]&31)*281474976710656+y[L+1]*1099511627776+y[L+2]*4294967296+y[L+3]*16777216+(y[L+4]<<16)+(y[L+5]<<8)+y[L+6],M>=9e15?crypto.randomBytes(7).copy(y,L):($.push(M%1e14),L+=7);L=D/7}else throw S=!1,Error(Bt+"crypto unavailable");if(!S)for(;L<D;)M=f(),M<9e15&&($[L++]=M%1e14);for(D=$[--L],_%=ge,D&&_&&(M=dl[ge-_],$[L]=xr(D/M)*M);$[L]===0;$.pop(),L--);if(L<0)$=[N=0];else{for(N=-1;$[0]===0;$.splice(0,1),N-=ge);for(L=1,M=$[0];M>=10;M/=10,L++);L<ge&&(N-=ge-L)}return G.e=N,G.c=$,G}}(),I.sum=function(){for(var d=1,f=arguments,_=new I(f[0]);d<f.length;)_=_.plus(f[d++]);return _},r=function(){var d="0123456789";function f(_,y,k,N){for(var D,M=[0],L,$=0,G=_.length;$<G;){for(L=M.length;L--;M[L]*=y);for(M[0]+=N.indexOf(_.charAt($++)),D=0;D<M.length;D++)M[D]>k-1&&(M[D+1]==null&&(M[D+1]=0),M[D+1]+=M[D]/k|0,M[D]%=k)}return M.reverse()}return function(_,y,k,N,D){var M,L,$,G,z,te,Z,ye,we=_.indexOf("."),oe=a,ce=c;for(we>=0&&(G=C,C=0,_=_.replace(".",""),ye=new I(y),te=ye.pow(_.length-we),C=G,ye.c=f(en(cr(te.c),te.e,"0"),10,k,d),ye.e=ye.c.length),Z=f(_,y,k,D?(M=E,d):(M=d,E)),$=G=Z.length;Z[--G]==0;Z.pop());if(!Z[0])return M.charAt(0);if(we<0?--$:(te.c=Z,te.e=$,te.s=N,te=e(te,ye,oe,ce,k),Z=te.c,z=te.r,$=te.e),L=$+oe+1,we=Z[L],G=k/2,z=z||L<0||Z[L+1]!=null,z=ce<4?(we!=null||z)&&(ce==0||ce==(te.s<0?3:2)):we>G||we==G&&(ce==4||z||ce==6&&Z[L-1]&1||ce==(te.s<0?8:7)),L<1||!Z[0])_=z?en(M.charAt(1),-oe,M.charAt(0)):M.charAt(0);else{if(Z.length=L,z)for(--k;++Z[--L]>k;)Z[L]=0,L||(++$,Z=[1].concat(Z));for(G=Z.length;!Z[--G];);for(we=0,_="";we<=G;_+=M.charAt(Z[we++]));_=en(_,$,M.charAt(0))}return _}}(),e=function(){function d(y,k,N){var D,M,L,$,G=0,z=y.length,te=k%Nn,Z=k/Nn|0;for(y=y.slice();z--;)L=y[z]%Nn,$=y[z]/Nn|0,D=Z*L+$*te,M=te*L+D%Nn*Nn+G,G=(M/N|0)+(D/Nn|0)+Z*$,y[z]=M%N;return G&&(y=[G].concat(y)),y}function f(y,k,N,D){var M,L;if(N!=D)L=N>D?1:-1;else for(M=L=0;M<N;M++)if(y[M]!=k[M]){L=y[M]>k[M]?1:-1;break}return L}function _(y,k,N,D){for(var M=0;N--;)y[N]-=M,M=y[N]<k[N]?1:0,y[N]=M*D+y[N]-k[N];for(;!y[0]&&y.length>1;y.splice(0,1));}return function(y,k,N,D,M){var L,$,G,z,te,Z,ye,we,oe,ce,Te,Ue,mr,qt,gt,at,Qt,et=y.s==k.s?1:-1,Xe=y.c,le=k.c;if(!Xe||!Xe[0]||!le||!le[0])return new I(!y.s||!k.s||(Xe?le&&Xe[0]==le[0]:!le)?NaN:Xe&&Xe[0]==0||!le?et*0:et/0);for(we=new I(et),oe=we.c=[],$=y.e-k.e,et=N+$+1,M||(M=Sr,$=or(y.e/ge)-or(k.e/ge),et=et/ge|0),G=0;le[G]==(Xe[G]||0);G++);if(le[G]>(Xe[G]||0)&&$--,et<0)oe.push(1),z=!0;else{for(qt=Xe.length,at=le.length,G=0,et+=2,te=xr(M/(le[0]+1)),te>1&&(le=d(le,te,M),Xe=d(Xe,te,M),at=le.length,qt=Xe.length),mr=at,ce=Xe.slice(0,at),Te=ce.length;Te<at;ce[Te++]=0);Qt=le.slice(),Qt=[0].concat(Qt),gt=le[0],le[1]>=M/2&&gt++;do{if(te=0,L=f(le,ce,at,Te),L<0){if(Ue=ce[0],at!=Te&&(Ue=Ue*M+(ce[1]||0)),te=xr(Ue/gt),te>1)for(te>=M&&(te=M-1),Z=d(le,te,M),ye=Z.length,Te=ce.length;f(Z,ce,ye,Te)==1;)te--,_(Z,at<ye?Qt:le,ye,M),ye=Z.length,L=1;else te==0&&(L=te=1),Z=le.slice(),ye=Z.length;if(ye<Te&&(Z=[0].concat(Z)),_(ce,Z,Te,M),Te=ce.length,L==-1)for(;f(le,ce,at,Te)<1;)te++,_(ce,at<Te?Qt:le,Te,M),Te=ce.length}else L===0&&(te++,ce=[0]);oe[G++]=te,ce[0]?ce[Te++]=Xe[mr]||0:(ce=[Xe[mr]],Te=1)}while((mr++<qt||ce[0]!=null)&&et--);z=ce[0]!=null,oe[0]||oe.splice(0,1)}if(M==Sr){for(G=1,et=oe[0];et>=10;et/=10,G++);b(we,N+(we.e=G+$*ge-1)+1,D,z)}else we.e=$,we.r=+z;return we}}();function x(d,f,_,y){var k,N,D,M,L;if(_==null?_=c:He(_,0,8),!d.c)return d.toString();if(k=d.c[0],D=d.e,f==null)L=cr(d.c),L=y==1||y==2&&(D<=o||D>=l)?Co(L,D):en(L,D,"0");else if(d=b(new I(d),f,_),N=d.e,L=cr(d.c),M=L.length,y==1||y==2&&(f<=N||N<=o)){for(;M<f;L+="0",M++);L=Co(L,N)}else if(f-=D,L=en(L,N,"0"),N+1>M){if(--f>0)for(L+=".";f--;L+="0");}else if(f+=N-M,f>0)for(N+1==M&&(L+=".");f--;L+="0");return d.s<0&&k?"-"+L:L}function q(d,f){for(var _,y=1,k=new I(d[0]);y<d.length;y++)if(_=new I(d[y]),_.s)f.call(k,_)&&(k=_);else{k=_;break}return k}function m(d,f,_){for(var y=1,k=f.length;!f[--k];f.pop());for(k=f[0];k>=10;k/=10,y++);return(_=y+_*ge-1)>h?d.c=d.e=null:_<u?d.c=[d.e=0]:(d.e=_,d.c=f),d}n=function(){var d=/^(-?)0([xbo])(?=\w[\w.]*$)/i,f=/^([^.]+)\.$/,_=/^\.([^.]+)$/,y=/^-?(Infinity|NaN)$/,k=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(N,D,M,L){var $,G=M?D:D.replace(k,"");if(y.test(G))N.s=isNaN(G)?null:G<0?-1:1;else{if(!M&&(G=G.replace(d,function(z,te,Z){return $=(Z=Z.toLowerCase())=="x"?16:Z=="b"?2:8,!L||L==$?te:z}),L&&($=L,G=G.replace(f,"$1").replace(_,"0.$1")),D!=G))return new I(G,$);if(I.DEBUG)throw Error(Bt+"Not a"+(L?" base "+L:"")+" number: "+D);N.s=null}N.c=N.e=null}}();function b(d,f,_,y){var k,N,D,M,L,$,G,z=d.c,te=dl;if(z){e:{for(k=1,M=z[0];M>=10;M/=10,k++);if(N=f-k,N<0)N+=ge,D=f,L=z[$=0],G=L/te[k-D-1]%10|0;else if($=ll((N+1)/ge),$>=z.length)if(y){for(;z.length<=$;z.push(0));L=G=0,k=1,N%=ge,D=N-ge+1}else break e;else{for(L=M=z[$],k=1;M>=10;M/=10,k++);N%=ge,D=N-ge+k,G=D<0?0:L/te[k-D-1]%10|0}if(y=y||f<0||z[$+1]!=null||(D<0?L:L%te[k-D-1]),y=_<4?(G||y)&&(_==0||_==(d.s<0?3:2)):G>5||G==5&&(_==4||y||_==6&&(N>0?D>0?L/te[k-D]:0:z[$-1])%10&1||_==(d.s<0?8:7)),f<1||!z[0])return z.length=0,y?(f-=d.e+1,z[0]=te[(ge-f%ge)%ge],d.e=-f||0):z[0]=d.e=0,d;if(N==0?(z.length=$,M=1,$--):(z.length=$+1,M=te[ge-N],z[$]=D>0?xr(L/te[k-D]%te[D])*M:0),y)for(;;)if($==0){for(N=1,D=z[0];D>=10;D/=10,N++);for(D=z[0]+=M,M=1;D>=10;D/=10,M++);N!=M&&(d.e++,z[0]==Sr&&(z[0]=1));break}else{if(z[$]+=M,z[$]!=Sr)break;z[$--]=0,M=1}for(N=z.length;z[--N]===0;z.pop());}d.e>h?d.c=d.e=null:d.e<u&&(d.c=[d.e=0])}return d}function A(d){var f,_=d.e;return _===null?d.toString():(f=cr(d.c),f=_<=o||_>=l?Co(f,_):en(f,_,"0"),d.s<0?"-"+f:f)}return i.absoluteValue=i.abs=function(){var d=new I(this);return d.s<0&&(d.s=1),d},i.comparedTo=function(d,f){return Qi(this,new I(d,f))},i.decimalPlaces=i.dp=function(d,f){var _,y,k,N=this;if(d!=null)return He(d,0,lt),f==null?f=c:He(f,0,8),b(new I(N),d+N.e+1,f);if(!(_=N.c))return null;if(y=((k=_.length-1)-or(this.e/ge))*ge,k=_[k])for(;k%10==0;k/=10,y--);return y<0&&(y=0),y},i.dividedBy=i.div=function(d,f){return e(this,new I(d,f),a,c)},i.dividedToIntegerBy=i.idiv=function(d,f){return e(this,new I(d,f),0,1)},i.exponentiatedBy=i.pow=function(d,f){var _,y,k,N,D,M,L,$,G,z=this;if(d=new I(d),d.c&&!d.isInteger())throw Error(Bt+"Exponent not an integer: "+A(d));if(f!=null&&(f=new I(f)),M=d.e>14,!z.c||!z.c[0]||z.c[0]==1&&!z.e&&z.c.length==1||!d.c||!d.c[0])return G=new I(Math.pow(+A(z),M?2-Ao(d):+A(d))),f?G.mod(f):G;if(L=d.s<0,f){if(f.c?!f.c[0]:!f.s)return new I(NaN);y=!L&&z.isInteger()&&f.isInteger(),y&&(z=z.mod(f))}else{if(d.e>9&&(z.e>0||z.e<-1||(z.e==0?z.c[0]>1||M&&z.c[1]>=24e7:z.c[0]<8e13||M&&z.c[0]<=9999975e7)))return N=(z.s<0&&Ao(d),-0),z.e>-1&&(N=1/N),new I(L?1/N:N);C&&(N=ll(C/ge+2))}for(M?(_=new I(.5),L&&(d.s=1),$=Ao(d)):(k=Math.abs(+A(d)),$=k%2),G=new I(s);;){if($){if(G=G.times(z),!G.c)break;N?G.c.length>N&&(G.c.length=N):y&&(G=G.mod(f))}if(k){if(k=xr(k/2),k===0)break;$=k%2}else if(d=d.times(_),b(d,d.e+1,1),d.e>14)$=Ao(d);else{if(k=+A(d),k===0)break;$=k%2}z=z.times(z),N?z.c&&z.c.length>N&&(z.c.length=N):y&&(z=z.mod(f))}return y?G:(L&&(G=s.div(G)),f?G.mod(f):N?b(G,C,c,D):G)},i.integerValue=function(d){var f=new I(this);return d==null?d=c:He(d,0,8),b(f,f.e+1,d)},i.isEqualTo=i.eq=function(d,f){return Qi(this,new I(d,f))===0},i.isFinite=function(){return!!this.c},i.isGreaterThan=i.gt=function(d,f){return Qi(this,new I(d,f))>0},i.isGreaterThanOrEqualTo=i.gte=function(d,f){return(f=Qi(this,new I(d,f)))===1||f===0},i.isInteger=function(){return!!this.c&&or(this.e/ge)>this.c.length-2},i.isLessThan=i.lt=function(d,f){return Qi(this,new I(d,f))<0},i.isLessThanOrEqualTo=i.lte=function(d,f){return(f=Qi(this,new I(d,f)))===-1||f===0},i.isNaN=function(){return!this.s},i.isNegative=function(){return this.s<0},i.isPositive=function(){return this.s>0},i.isZero=function(){return!!this.c&&this.c[0]==0},i.minus=function(d,f){var _,y,k,N,D=this,M=D.s;if(d=new I(d,f),f=d.s,!M||!f)return new I(NaN);if(M!=f)return d.s=-f,D.plus(d);var L=D.e/ge,$=d.e/ge,G=D.c,z=d.c;if(!L||!$){if(!G||!z)return G?(d.s=-f,d):new I(z?D:NaN);if(!G[0]||!z[0])return z[0]?(d.s=-f,d):new I(G[0]?D:(c==3,-0))}if(L=or(L),$=or($),G=G.slice(),M=L-$){for((N=M<0)?(M=-M,k=G):($=L,k=z),k.reverse(),f=M;f--;k.push(0));k.reverse()}else for(y=(N=(M=G.length)<(f=z.length))?M:f,M=f=0;f<y;f++)if(G[f]!=z[f]){N=G[f]<z[f];break}if(N&&(k=G,G=z,z=k,d.s=-d.s),f=(y=z.length)-(_=G.length),f>0)for(;f--;G[_++]=0);for(f=Sr-1;y>M;){if(G[--y]<z[y]){for(_=y;_&&!G[--_];G[_]=f);--G[_],G[y]+=Sr}G[y]-=z[y]}for(;G[0]==0;G.splice(0,1),--$);return G[0]?m(d,G,$):(d.s=c==3?-1:1,d.c=[d.e=0],d)},i.modulo=i.mod=function(d,f){var _,y,k=this;return d=new I(d,f),!k.c||!d.s||d.c&&!d.c[0]?new I(NaN):!d.c||k.c&&!k.c[0]?new I(k):(p==9?(y=d.s,d.s=1,_=e(k,d,0,3),d.s=y,_.s*=y):_=e(k,d,0,p),d=k.minus(_.times(d)),!d.c[0]&&p==1&&(d.s=k.s),d)},i.multipliedBy=i.times=function(d,f){var _,y,k,N,D,M,L,$,G,z,te,Z,ye,we,oe,ce=this,Te=ce.c,Ue=(d=new I(d,f)).c;if(!Te||!Ue||!Te[0]||!Ue[0])return!ce.s||!d.s||Te&&!Te[0]&&!Ue||Ue&&!Ue[0]&&!Te?d.c=d.e=d.s=null:(d.s*=ce.s,!Te||!Ue?d.c=d.e=null:(d.c=[0],d.e=0)),d;for(y=or(ce.e/ge)+or(d.e/ge),d.s*=ce.s,L=Te.length,z=Ue.length,L<z&&(ye=Te,Te=Ue,Ue=ye,k=L,L=z,z=k),k=L+z,ye=[];k--;ye.push(0));for(we=Sr,oe=Nn,k=z;--k>=0;){for(_=0,te=Ue[k]%oe,Z=Ue[k]/oe|0,D=L,N=k+D;N>k;)$=Te[--D]%oe,G=Te[D]/oe|0,M=Z*$+G*te,$=te*$+M%oe*oe+ye[N]+_,_=($/we|0)+(M/oe|0)+Z*G,ye[N--]=$%we;ye[N]=_}return _?++y:ye.splice(0,1),m(d,ye,y)},i.negated=function(){var d=new I(this);return d.s=-d.s||null,d},i.plus=function(d,f){var _,y=this,k=y.s;if(d=new I(d,f),f=d.s,!k||!f)return new I(NaN);if(k!=f)return d.s=-f,y.minus(d);var N=y.e/ge,D=d.e/ge,M=y.c,L=d.c;if(!N||!D){if(!M||!L)return new I(k/0);if(!M[0]||!L[0])return L[0]?d:new I(M[0]?y:k*0)}if(N=or(N),D=or(D),M=M.slice(),k=N-D){for(k>0?(D=N,_=L):(k=-k,_=M),_.reverse();k--;_.push(0));_.reverse()}for(k=M.length,f=L.length,k-f<0&&(_=L,L=M,M=_,f=k),k=0;f;)k=(M[--f]=M[f]+L[f]+k)/Sr|0,M[f]=Sr===M[f]?0:M[f]%Sr;return k&&(M=[k].concat(M),++D),m(d,M,D)},i.precision=i.sd=function(d,f){var _,y,k,N=this;if(d!=null&&d!==!!d)return He(d,1,lt),f==null?f=c:He(f,0,8),b(new I(N),d,f);if(!(_=N.c))return null;if(k=_.length-1,y=k*ge+1,k=_[k]){for(;k%10==0;k/=10,y--);for(k=_[0];k>=10;k/=10,y++);}return d&&N.e+1>y&&(y=N.e+1),y},i.shiftedBy=function(d){return He(d,-ul,ul),this.times("1e"+d)},i.squareRoot=i.sqrt=function(){var d,f,_,y,k,N=this,D=N.c,M=N.s,L=N.e,$=a+4,G=new I("0.5");if(M!==1||!D||!D[0])return new I(!M||M<0&&(!D||D[0])?NaN:D?N:1/0);if(M=Math.sqrt(+A(N)),M==0||M==1/0?(f=cr(D),(f.length+L)%2==0&&(f+="0"),M=Math.sqrt(+f),L=or((L+1)/2)-(L<0||L%2),M==1/0?f="5e"+L:(f=M.toExponential(),f=f.slice(0,f.indexOf("e")+1)+L),_=new I(f)):_=new I(M+""),_.c[0]){for(L=_.e,M=L+$,M<3&&(M=0);;)if(k=_,_=G.times(k.plus(e(N,k,$,1))),cr(k.c).slice(0,M)===(f=cr(_.c)).slice(0,M))if(_.e<L&&--M,f=f.slice(M-3,M+1),f=="9999"||!y&&f=="4999"){if(!y&&(b(k,k.e+a+2,0),k.times(k).eq(N))){_=k;break}$+=4,M+=4,y=1}else{(!+f||!+f.slice(1)&&f.charAt(0)=="5")&&(b(_,_.e+a+2,1),d=!_.times(_).eq(N));break}}return b(_,_.e+a+1,c,d)},i.toExponential=function(d,f){return d!=null&&(He(d,0,lt),d++),x(this,d,f,1)},i.toFixed=function(d,f){return d!=null&&(He(d,0,lt),d=d+this.e+1),x(this,d,f)},i.toFormat=function(d,f,_){var y,k=this;if(_==null)d!=null&&f&&typeof f=="object"?(_=f,f=null):d&&typeof d=="object"?(_=d,d=f=null):_=T;else if(typeof _!="object")throw Error(Bt+"Argument not an object: "+_);if(y=k.toFixed(d,f),k.c){var N,D=y.split("."),M=+_.groupSize,L=+_.secondaryGroupSize,$=_.groupSeparator||"",G=D[0],z=D[1],te=k.s<0,Z=te?G.slice(1):G,ye=Z.length;if(L&&(N=M,M=L,L=N,ye-=N),M>0&&ye>0){for(N=ye%M||M,G=Z.substr(0,N);N<ye;N+=M)G+=$+Z.substr(N,M);L>0&&(G+=$+Z.slice(N)),te&&(G="-"+G)}y=z?G+(_.decimalSeparator||"")+((L=+_.fractionGroupSize)?z.replace(new RegExp("\\d{"+L+"}\\B","g"),"$&"+(_.fractionGroupSeparator||"")):z):G}return(_.prefix||"")+y+(_.suffix||"")},i.toFraction=function(d){var f,_,y,k,N,D,M,L,$,G,z,te,Z=this,ye=Z.c;if(d!=null&&(M=new I(d),!M.isInteger()&&(M.c||M.s!==1)||M.lt(s)))throw Error(Bt+"Argument "+(M.isInteger()?"out of range: ":"not an integer: ")+A(M));if(!ye)return new I(Z);for(f=new I(s),$=_=new I(s),y=L=new I(s),te=cr(ye),N=f.e=te.length-Z.e-1,f.c[0]=dl[(D=N%ge)<0?ge+D:D],d=!d||M.comparedTo(f)>0?N>0?f:$:M,D=h,h=1/0,M=new I(te),L.c[0]=0;!(G=e(M,f,0,1),k=_.plus(G.times(y)),k.comparedTo(d)==1);)_=y,y=k,$=L.plus(G.times(k=$)),L=k,f=M.minus(G.times(k=f)),M=k;return k=e(d.minus(_),y,0,1),L=L.plus(k.times($)),_=_.plus(k.times(y)),L.s=$.s=Z.s,N=N*2,z=e($,y,N,c).minus(Z).abs().comparedTo(e(L,_,N,c).minus(Z).abs())<1?[$,y]:[L,_],h=D,z},i.toNumber=function(){return+A(this)},i.toPrecision=function(d,f){return d!=null&&He(d,1,lt),x(this,d,f,2)},i.toString=function(d){var f,_=this,y=_.s,k=_.e;return k===null?y?(f="Infinity",y<0&&(f="-"+f)):f="NaN":(d==null?f=k<=o||k>=l?Co(cr(_.c),k):en(cr(_.c),k,"0"):d===10?(_=b(new I(_),a+k+1,c),f=en(cr(_.c),_.e,"0")):(He(d,2,E.length,"Base"),f=r(en(cr(_.c),k,"0"),10,d,y,!0)),y<0&&_.c[0]&&(f="-"+f)),f},i.valueOf=i.toJSON=function(){return A(this)},i._isBigNumber=!0,i[Symbol.toStringTag]="BigNumber",i[Symbol.for("nodejs.util.inspect.custom")]=i.valueOf,t!=null&&I.set(t),I}function or(t){var e=t|0;return t>0||t===e?e:e-1}function cr(t){for(var e,r,n=1,i=t.length,s=t[0]+"";n<i;){for(e=t[n++]+"",r=ge-e.length;r--;e="0"+e);s+=e}for(i=s.length;s.charCodeAt(--i)===48;);return s.slice(0,i+1||1)}function Qi(t,e){var r,n,i=t.c,s=e.c,a=t.s,c=e.s,o=t.e,l=e.e;if(!a||!c)return null;if(r=i&&!i[0],n=s&&!s[0],r||n)return r?n?0:-c:a;if(a!=c)return a;if(r=a<0,n=o==l,!i||!s)return n?0:!i^r?1:-1;if(!n)return o>l^r?1:-1;for(c=(o=i.length)<(l=s.length)?o:l,a=0;a<c;a++)if(i[a]!=s[a])return i[a]>s[a]^r?1:-1;return o==l?0:o>l^r?1:-1}function He(t,e,r,n){if(t<e||t>r||t!==xr(t))throw Error(Bt+(n||"Argument")+(typeof t=="number"?t<e||t>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(t))}function Ao(t){var e=t.c.length-1;return or(t.e/ge)==e&&t.c[e]%2!=0}function Co(t,e){return(t.length>1?t.charAt(0)+"."+t.slice(1):t)+(e<0?"e":"e+")+e}function en(t,e,r){var n,i;if(e<0){for(i=r+".";++e;i+=r);t=i+t}else if(n=t.length,++e>n){for(i=r,e-=n;--e;i+=r);t+=i}else e<n&&(t=t.slice(0,e)+"."+t.slice(e));return t}var Bp=Lp(),Pw=Object.freeze({__proto__:null,BigNumber:Bp,default:Bp}),jp=ee(function(t,e){const r=Math.exp;e=t.exports=function(i){if(typeof i!="number")throw new Error("must provide a timespan to the moving average constructor");if(i<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let s,a=0,c=0,o=0,l,u={};function h(S,p){return 1-r(-(S-p)/i)}return u.push=function(p,C){if(l){const T=h(p,l),E=C-s,I=T*E;s=T*C+(1-T)*s,a=(1-T)*(a+E*I),c=Math.sqrt(a),o=s+T*E}else s=C;l=p},u.movingAverage=function(){return s},u.variance=function(){return a},u.deviation=function(){return c},u.forecast=function(){return o},u}}),Up=Wg(Pw);const{EventEmitter:Nw}=It;class Ow extends Nw{constructor(t,e){super();this._options=e,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this);const r=this._options.movingAverageIntervals;for(var n=0;n<t.length;n++){var i=t[n];this._stats[i]=Up(0),this._movingAverages[i]={};for(var s=0;s<r.length;s++){var a=r[s],c=this._movingAverages[i][a]=jp(a);c.push(this._frequencyLastTime,0)}}}start(){this._queue.length&&this._resetComputeTimeout()}stop(){this._timeout&&(this._timeout.clear(),this._timeout=null)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}toJSON(){const t=this.snapshot,e=this.movingAverages,r={dataReceived:t.dataReceived.toString(),dataSent:t.dataSent.toString(),movingAverages:{}},n=Object.keys(e);for(const i of n){r.movingAverages[i]={};for(const s of Object.keys(e[i]))r.movingAverages[i][s]=e[i][s].movingAverage()}return r}push(t,e){this._queue.push([t,e,Date.now()]),this._resetComputeTimeout()}_resetComputeTimeout(){this._timeout=li(this._update,this._nextTimeout())}_nextTimeout(){const t=this._queue.length/this._options.computeThrottleMaxQueueSize,e=Math.max(this._options.computeThrottleTimeout*(1-t),0);return e}_update(){if(this._timeout=null,this._queue.length){let t;for(t of this._queue)this._applyOp(t);this._queue=[],this._updateFrequency(t[2]),this.emit("update",this._stats)}}_updateFrequency(t){const e=t-this._frequencyLastTime;Object.keys(this._stats).forEach(r=>{this._updateFrequencyFor(r,e,t)}),this._frequencyLastTime=t}_updateFrequencyFor(t,e,r){const n=this._frequencyAccumulators[t]||0;this._frequencyAccumulators[t]=0;const i=e||1,s=n/i*1e3;let a=this._movingAverages[t];a||(a=this._movingAverages[t]={});const c=this._options.movingAverageIntervals;for(var o=0;o<c.length;o++){var l=c[o],u=a[l];u||(u=a[l]=jp(l)),u.push(r,s)}}_applyOp(t){const e=t[0],r=t[1];if(typeof r!="number")throw new Error(`invalid increment number: ${r}`);let n;Object.prototype.hasOwnProperty.call(this._stats,e)?n=this._stats[e]:n=this._stats[e]=Up(0),this._stats[e]=n.plus(r),this._frequencyAccumulators[e]||(this._frequencyAccumulators[e]=0),this._frequencyAccumulators[e]+=r}}var pl=Ow;const{pipe:Mw}=nr,{tap:Fp}=Pc,{METRICS:Dw}=oa,hl=["dataReceived","dataSent"],xw={in:"dataReceived",out:"dataSent"};class $p{constructor(t){this._options=ao(Dw,t),this._globalStats=new pl(hl,this._options),this._peerStats=new Map,this._protocolStats=new Map,this._oldPeers=Rw(this._options.maxOldPeersRetention),this._running=!1,this._onMessage=this._onMessage.bind(this),this._connectionManager=t.connectionManager,this._connectionManager.on("peer:disconnect",e=>{this.onPeerDisconnected(e.remotePeer)})}start(){this._running=!0}stop(){this._running=!1,this._globalStats.stop();for(const t of this._peerStats.values())t.stop();for(const t of this._protocolStats.values())t.stop()}get global(){return this._globalStats}get peers(){return Array.from(this._peerStats.keys())}forPeer(t){const e=t.toB58String();return this._peerStats.get(e)||this._oldPeers.get(e)}get protocols(){return Array.from(this._protocolStats.keys())}forProtocol(t){return this._protocolStats.get(t)}onPeerDisconnected(t){const e=t.toB58String(),r=this._peerStats.get(e);r&&(r.stop(),this._peerStats.delete(e),this._oldPeers.set(e,r))}_onMessage({remotePeer:t,protocol:e,direction:r,dataLength:n}){if(!this._running)return;const i=xw[r];let s=this.forPeer(t);if(s||(s=new pl(hl,this._options),this._peerStats.set(t.toB58String(),s)),s.push(i,n),this._globalStats.push(i,n),e){let a=this.forProtocol(e);a||(a=new pl(hl,this._options),this._protocolStats.set(e,a)),a.push(i,n)}}updatePlaceholder(t,e){if(!this._running)return;const r=this.forPeer(t),n=e.toB58String(),i=this.forPeer(e);let s=r;i&&(s=$p.mergeStats(i,s),this._oldPeers.delete(n)),this._peerStats.delete(t.toB58String()),this._peerStats.set(n,s),s.start()}trackStream({stream:t,remotePeer:e,protocol:r}){const n=this,i=t.source;t.source=Fp(a=>n._onMessage({remotePeer:e,protocol:r,direction:"in",dataLength:a.length}))(i);const s=t.sink;return t.sink=a=>Mw(a,Fp(c=>n._onMessage({remotePeer:e,protocol:r,direction:"out",dataLength:c.length})),s),t}static mergeStats(t,e){return t.stop(),e.stop(),t._queue=[...t._queue,...e._queue],t}}var Lw=$p,jt=ee(function(t,e){const r=qe(`
`);async function n(i){for await(const s of i)return s}e.encode=i=>Je.encode.single(new ht([i,r])),e.write=(i,s)=>i.push(e.encode(s)),e.writeAll=(i,s)=>{i.push(s.reduce((a,c)=>a.append(e.encode(c)),new ht))},e.read=async i=>{let s=1;const a={[Symbol.asyncIterator](){return this},next:()=>i.next(s)},c=l=>{s=l},o=await nr(a,Je.decode({onLength:c}),n);if(o.get(o.length-1)!==r[0])throw F(new Error("missing newline"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return o.shallowSlice(0,-1)}});const Yi=Q("mss:select");var qp=async(t,e,r)=>{e=Array.isArray(e)?[...e]:[e];const{reader:n,writer:i,rest:s,stream:a}=fa(t),c=e.shift();r?(Yi('select: write ["%s", "%s"]',r,c),jt.writeAll(i,[r,c])):(Yi('select: write "%s"',c),jt.write(i,c));let o=(await jt.read(n)).toString();if(Yi('select: read "%s"',o),o===r&&(o=(await jt.read(n)).toString(),Yi('select: read "%s"',o)),o===c)return s(),{stream:a,protocol:c};for(const l of e){Yi('select: write "%s"',l),jt.write(i,l);const u=(await jt.read(n)).toString();if(Yi('select: read "%s" for "%s"',u,l),u===l)return s(),{stream:a,protocol:l}}throw s(),F(new Error("protocol selection failed"),"ERR_UNSUPPORTED_PROTOCOL")},Bw="/multistream/1.0.0",Gp={PROTOCOL_ID:Bw};const ya=Q("mss:handle"),{PROTOCOL_ID:fl}=Gp;var jw=async(t,e)=>{e=Array.isArray(e)?e:[e];const{writer:r,reader:n,rest:i,stream:s}=fa(t);for(;;){const a=(await jt.read(n)).toString();if(ya('read "%s"',a),a===fl){ya('respond with "%s" for "%s"',fl,a),jt.write(r,fl);continue}if(e.includes(a))return jt.write(r,a),ya('respond with "%s" for "%s"',a,a),i(),{stream:s,protocol:a};if(a==="ls"){jt.write(r,new ht(e.map(c=>jt.encode(c)))),ya('respond with "%s" for %s',e,a);continue}jt.write(r,"na"),ya('respond with "na" for "%s"',a)}};const Uw=Q("it-multistream-select:ls");var Fw=async t=>{const{reader:e,writer:r,rest:n,stream:i}=fa(t);Uw('write "ls"'),jt.write(r,"ls"),n();const s=await jt.read(e),a=wp([s]),c=[];return await nr(a,Je.decode(),async o=>{for await(const l of o)c.push(l.shallowSlice(0,-1).toString())}),{stream:i,protocols:c}};const{PROTOCOL_ID:ml}=Gp;var $w=ml;class Vp{constructor(t){this._stream=t,this._shaken=!1}async _handshake(){if(this._shaken)return;const{stream:t}=await qp(this._stream,ml);this._stream=t,this._shaken=!0}}class qw extends Vp{select(t){return qp(this._stream,t,this._shaken?null:ml)}async ls(){await this._handshake();const{stream:t,protocols:e}=await Fw(this._stream);return this._stream=t,e}}var Gw=qw;class Vw extends Vp{handle(t){return jw(this._stream,t)}}var Hw=Vw,Ji={PROTOCOL_ID:$w,Dialer:Gw,Listener:Hw};const zw=Wt,gl=Wt.v4,Hp=Wt.v6,zp=function(t,e,r){r=~~r;var n;if(gl(t))n=e||new Uint8Array(r+4),t.split(/\./g).map(function(u){n[r++]=parseInt(u,10)&255});else if(Hp(t)){var i=t.split(":",8),s;for(s=0;s<i.length;s++){var a=gl(i[s]),c;a&&(c=zp(i[s]),i[s]=ae(c.slice(0,2),"base16")),c&&++s<8&&i.splice(s,0,ae(c.slice(2,4),"base16"))}if(i[0]==="")for(;i.length<8;)i.unshift("0");else if(i[i.length-1]==="")for(;i.length<8;)i.push("0");else if(i.length<8){for(s=0;s<i.length&&i[s]!=="";s++);var o=[s,"1"];for(s=9-i.length;s>0;s--)o.push("0");i.splice.apply(i,o)}for(n=e||new Uint8Array(r+16),s=0;s<i.length;s++){var l=parseInt(i[s],16);n[r++]=l>>8&255,n[r++]=l&255}}if(!n)throw Error("Invalid ip address: "+t);return n},Ww=function(t,e,r){e=~~e,r=r||t.length-e;var n=[],i;const s=new DataView(t.buffer);if(r===4){for(let a=0;a<r;a++)n.push(t[e+a]);i=n.join(".")}else if(r===16){for(let a=0;a<r;a+=2)n.push(s.getUint16(e+a).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i};var Io={isIP:zw,isV4:gl,isV6:Hp,toBytes:zp,toString:Ww};function Ut(t){if(typeof t=="number"){if(Ut.codes[t])return Ut.codes[t];throw new Error("no protocol with code: "+t)}else if(typeof t=="string"||t instanceof String){if(Ut.names[t])return Ut.names[t];throw new Error("no protocol with name: "+t)}throw new Error("invalid protocol id type: "+t)}const lr=-1;Ut.lengthPrefixedVarSize=lr,Ut.V=lr,Ut.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,lr,"ip6zone"],[53,lr,"dns","resolvable"],[54,lr,"dns4","resolvable"],[55,lr,"dns6","resolvable"],[56,lr,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,lr,"unix",!1,"path"],[421,lr,"ipfs"],[421,lr,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,lr,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,lr,"memory"]],Ut.names={},Ut.codes={},Ut.table.map(t=>{const e=Wp.apply(null,t);Ut.codes[e.code]=e,Ut.names[e.name]=e}),Ut.object=Wp;function Wp(t,e,r,n,i){return{code:t,size:e,name:r,resolvable:Boolean(n),path:Boolean(i)}}var Lr=Ut,Kp=ba;function ba(t,e){return e instanceof Uint8Array?ba.toString(t,e):ba.toBytes(t,e)}ba.toString=function(e,r){e=Lr(e);switch(e.code){case 4:case 41:return Kw(r);case 6:case 273:case 33:case 132:return Qp(r);case 53:case 54:case 55:case 56:case 400:case 777:return Qw(r);case 421:return Jw(r);case 444:return Yp(r);case 445:return Yp(r);default:return ae(r,"base16")}},ba.toBytes=function(e,r){e=Lr(e);switch(e.code){case 4:return Xp(r);case 41:return Xp(r);case 6:case 273:case 33:case 132:return yl(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return Xw(r);case 421:return Yw(r);case 444:return Zw(r);case 445:return eS(r);default:return qe(r,"base16")}};function Xp(t){if(!Io.isIP(t))throw new Error("invalid ip address");return Io.toBytes(t)}function Kw(t){const e=Io.toString(t);if(!e||!Io.isIP(e))throw new Error("invalid ip address");return e}function yl(t){const e=new ArrayBuffer(2),r=new DataView(e);return r.setUint16(0,t),new Uint8Array(e)}function Qp(t){const e=new DataView(t.buffer);return e.getUint16(0)}function Xw(t){const e=qe(t),r=Uint8Array.from(ie.encode(e.length));return Oe([r,e],r.length+e.length)}function Qw(t){const e=ie.decode(t);if(t=t.slice(ie.decode.bytes),t.length!==e)throw new Error("inconsistent lengths");return ae(t)}function Yw(t){const e=new Qr(t).multihash,r=Uint8Array.from(ie.encode(e.length));return Oe([r,e],r.length+e.length)}function Jw(t){const e=ie.decode(t),r=t.slice(ie.decode.bytes);if(r.length!==e)throw new Error("inconsistent lengths");return ae(r,"base58btc")}function Zw(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==16)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion address.");const r=Tn.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=yl(n);return Oe([r,i],r.length+i.length)}function eS(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==56)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion3 address.");const r=Tn.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=yl(n);return Oe([r,i],r.length+i.length)}function Yp(t){const e=t.slice(0,t.length-2),r=t.slice(t.length-2),n=ae(e,"base32"),i=Qp(r);return n+":"+i}var _r={stringToStringTuples:Jp,stringTuplesToString:Zp,tuplesToStringTuples:th,stringTuplesToTuples:eh,bytesToTuples:bl,tuplesToBytes:rh,bytesToString:tS,stringToBytes:ih,fromString:rS,fromBytes:sh,validateBytes:vl,isValidBytes:nS,cleanPath:Ro,ParseError:wl,protoFromTuple:va,sizeForAddr:nh};function Jp(t){const e=[],r=t.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let n=0;n<r.length;n++){const i=r[n],s=Lr(i);if(s.size===0){e.push([i]);continue}if(n++,n>=r.length)throw wl("invalid address: "+t);if(s.path){e.push([i,Ro(r.slice(n).join("/"))]);break}e.push([i,r[n]])}return e}function Zp(t){const e=[];return t.map(r=>{const n=va(r);e.push(n.name),r.length>1&&e.push(r[1])}),Ro(e.join("/"))}function eh(t){return t.map(e=>{Array.isArray(e)||(e=[e]);const r=va(e);return e.length>1?[r.code,Kp.toBytes(r.code,e[1])]:[r.code]})}function th(t){return t.map(e=>{const r=va(e);return e.length>1?[r.code,Kp.toString(r.code,e[1])]:[r.code]})}function rh(t){return sh(Oe(t.map(e=>{const r=va(e);let n=Uint8Array.from(ie.encode(r.code));return e.length>1&&(n=Oe([n,e[1]])),n})))}function nh(t,e){if(t.size>0)return t.size/8;if(t.size===0)return 0;{const r=ie.decode(e);return r+ie.decode.bytes}}function bl(t){const e=[];let r=0;for(;r<t.length;){const n=ie.decode(t,r),i=ie.decode.bytes,s=Lr(n),a=nh(s,t.slice(r+i));if(a===0){e.push([n]),r+=i;continue}const c=t.slice(r+i,r+i+a);if(r+=a+i,r>t.length)throw wl("Invalid address Uint8Array: "+ae(t,"base16"));e.push([n,c])}return e}function tS(t){const e=bl(t),r=th(e);return Zp(r)}function ih(t){t=Ro(t);const e=Jp(t),r=eh(e);return rh(r)}function rS(t){return ih(t)}function sh(t){const e=vl(t);if(e)throw e;return Uint8Array.from(t)}function vl(t){try{bl(t)}catch(e){return e}}function nS(t){return vl(t)===void 0}function Ro(t){return"/"+t.trim().split("/").filter(e=>e).join("/")}function wl(t){return new Error("Error parsing address: "+t)}function va(t){const e=Lr(t[0]);return e}var iS=ee(function(t,e){const r=Symbol.for("nodejs.util.inspect.custom"),n=Yr.proto(function(i){if(!(this instanceof n))return new n(i);if(i==null&&(i=""),i instanceof Uint8Array)this.bytes=_r.fromBytes(i);else if(typeof i=="string"||i instanceof String){if(i.length>0&&i.charAt(0)!=="/")throw new Error(`multiaddr "${i}" must start with a "/"`);this.bytes=_r.fromString(i)}else if(i.bytes&&i.protos&&i.protoCodes)this.bytes=_r.fromBytes(i.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});n.prototype.toString=function(){return _r.bytesToString(this.bytes)},n.prototype.toJSON=n.prototype.toString,n.prototype.toOptions=function(){const s={},a=this.toString().split("/");return s.family=a[1]==="ip4"?"ipv4":"ipv6",s.host=a[2],s.transport=a[3],s.port=parseInt(a[4]),s},n.prototype[r]=function(){return"<Multiaddr "+ae(this.bytes,"base16")+" - "+_r.bytesToString(this.bytes)+">"},n.prototype.inspect=function(){return"<Multiaddr "+ae(this.bytes,"base16")+" - "+_r.bytesToString(this.bytes)+">"},n.prototype.protos=function(){return this.protoCodes().map(s=>Object.assign({},Lr(s)))},n.prototype.protoCodes=function(){const s=[],a=this.bytes;let c=0;for(;c<a.length;){const o=ie.decode(a,c),l=ie.decode.bytes,u=Lr(o),h=_r.sizeForAddr(u,a.slice(c+l));c+=h+l,s.push(o)}return s},n.prototype.protoNames=function(){return this.protos().map(s=>s.name)},n.prototype.tuples=function(){return _r.bytesToTuples(this.bytes)},n.prototype.stringTuples=function(){const s=_r.bytesToTuples(this.bytes);return _r.tuplesToStringTuples(s)},n.prototype.encapsulate=function(s){return s=n(s),n(this.toString()+s.toString())},n.prototype.decapsulate=function(s){s=s.toString();const a=this.toString(),c=a.lastIndexOf(s);if(c<0)throw new Error("Address "+this+" does not contain subaddress: "+s);return n(a.slice(0,c))},n.prototype.decapsulateCode=function(s){const a=this.tuples();for(let c=a.length-1;c>=0;c--)if(a[c][0]===s)return n(_r.tuplesToBytes(a.slice(0,c)));return this},n.prototype.getPeerId=function(){let s=null;try{const a=this.stringTuples().filter(c=>{if(c[0]===Lr.names.ipfs.code)return!0});s=a.pop()[1],s=ae(new Qr(s).multihash,"base58btc")}catch(a){s=null}return s},n.prototype.getPath=function(){let s=null;try{s=this.stringTuples().filter(a=>{const c=Lr(a[0]);if(c.path)return!0})[0][1]}catch(a){s=null}return s},n.prototype.equals=function(s){return ir(this.bytes,s.bytes)},n.prototype.nodeAddress=function(){const s=this.protoCodes(),a=this.protoNames(),c=this.toString().split("/").slice(1);if(c.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(s[0]!==4&&s[0]!==41&&s[0]!==54&&s[0]!==55)throw new Error(`no protocol with name: "'${a[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(c[2]!=="tcp"&&c[2]!=="udp")throw new Error(`no protocol with name: "'${a[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:s[0]===41||s[0]===55?6:4,address:c[1],port:parseInt(c[3])}},n.fromNodeAddress=function(s,a){if(!s)throw new Error("requires node address object");if(!a)throw new Error("requires transport protocol");let c;switch(s.family){case"IPv4":c="ip4";break;case"IPv6":c="ip6";break;default:throw Error(`Invalid addr family. Got '${s.family}' instead of 'IPv4' or 'IPv6'`)}return n("/"+[c,s.address,a,s.port].join("/"))},n.prototype.isThinWaistAddress=function(s){const a=(s||this).protos();return a.length!==2||a[0].code!==4&&a[0].code!==41?!1:!(a[1].code!==6&&a[1].code!==273)},n.protocols=Lr,n.isName=function(s){return n.isMultiaddr(s)?s.protos().some(a=>a.resolvable):!1},n.resolve=function(s){return!n.isMultiaddr(s)||!n.isName(s)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},e=t.exports=n});const sS={OPEN:"open",CLOSING:"closing",CLOSED:"closed"};var aS=sS;const{OPEN:oS,CLOSING:ah,CLOSED:Sl}=aS,oh=Symbol.for("@libp2p/interface-connection/connection");class cS{constructor({localAddr:t,remoteAddr:e,localPeer:r,remotePeer:n,newStream:i,close:s,getStreams:a,stat:c}){uS(t,r,n,i,s,a,c),this.id=parseInt(String(Math.random()*1e9)).toString(36)+Date.now(),this.localAddr=t,this.remoteAddr=e,this.localPeer=r,this.remotePeer=n,this._stat={...c,status:oS},this._newStream=i,this._close=s,this._getStreams=a,this.registry=new Map,this.tags=[]}get[Symbol.toStringTag](){return"Connection"}get[oh](){return!0}static isConnection(t){return Boolean(t&&t[oh])}get stat(){return this._stat}get streams(){return this._getStreams()}async newStream(t){if(this.stat.status===ah)throw F(new Error("the connection is being closed"),"ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===Sl)throw F(new Error("the connection is closed"),"ERR_CONNECTION_CLOSED");Array.isArray(t)||(t=[t]);const{stream:e,protocol:r}=await this._newStream(t);return this.addStream(e,{protocol:r}),{stream:e,protocol:r}}addStream(t,{protocol:e,metadata:r={}}){this.registry.set(t.id,{protocol:e,...r})}removeStream(t){this.registry.delete(t)}async close(){if(this.stat.status===Sl)return;if(this._closing)return this._closing;this.stat.status=ah,this._closing=await this._close(),this._stat.timeline.close=Date.now(),this.stat.status=Sl}}var lS=cS;function uS(t,e,r,n,i,s,a){if(t&&!iS.isMultiaddr(t))throw F(new Error("localAddr must be an instance of multiaddr"),"ERR_INVALID_PARAMETERS");if(!me.isPeerId(e))throw F(new Error("localPeer must be an instance of peer-id"),"ERR_INVALID_PARAMETERS");if(!me.isPeerId(r))throw F(new Error("remotePeer must be an instance of peer-id"),"ERR_INVALID_PARAMETERS");if(typeof n!="function")throw F(new Error("new stream must be a function"),"ERR_INVALID_PARAMETERS");if(typeof i!="function")throw F(new Error("close must be a function"),"ERR_INVALID_PARAMETERS");if(typeof s!="function")throw F(new Error("getStreams must be a function"),"ERR_INVALID_PARAMETERS");if(!a)throw F(new Error("connection metadata object must be provided"),"ERR_INVALID_PARAMETERS");if(a.direction!=="inbound"&&a.direction!=="outbound")throw F(new Error('direction must be "inbound" or "outbound"'),"ERR_INVALID_PARAMETERS");if(!a.timeline)throw F(new Error("connection timeline object must be provided in the stat object"),"ERR_INVALID_PARAMETERS");if(!a.timeline.open)throw F(new Error("connection open timestamp must be provided"),"ERR_INVALID_PARAMETERS");if(!a.timeline.upgraded)throw F(new Error("connection upgraded timestamp must be provided"),"ERR_INVALID_PARAMETERS")}var dS=lS,pS={Connection:dS};function hS(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}else return Array.from(t)}var ch=function(e){var r=void 0,n=void 0;function i(c){if(!(c instanceof Object))throw new Error('Target "'+c+'" is not an object');n=c}function s(c){Object.keys(c).forEach(function(o){var l=c[o];if(typeof l!="function")throw new Error('Trap "'+o+": "+l+'" is not a function');if(!Reflect[o])throw new Error('Trap "'+o+": "+l+'" is not a valid trap')}),r=c}i(function(){}),e&&i(e),s(Reflect);var a=new Proxy({},{get:function(o,l){return function(){for(var u=arguments.length,h=Array(u),S=0;S<u;S++)h[S]=arguments[S];return r[l].apply(null,[n].concat(hS(h.slice(1))))}}});return{setTarget:i,setHandler:s,getTarget:function(){return n},getHandler:function(){return r},proxy:new Proxy(n,a)}};const it=Object.assign(Q("libp2p:upgrader"),{error:Q("libp2p:upgrader:err")}),{Connection:fS}=pS,{pipe:mS}=nr,{codes:wa}=ft;class gS{constructor({localPeer:t,metrics:e,cryptos:r=new Map,muxers:n=new Map,onConnectionEnd:i=()=>{},onConnection:s=()=>{}}){this.localPeer=t,this.metrics=e,this.cryptos=r,this.muxers=n,this.protector=null,this.protocols=new Map,this.onConnection=s,this.onConnectionEnd=i}async upgradeInbound(t){let e,r,n,i,s,a,c;if(this.metrics){({setTarget:a,proxy:c}=ch());const l=(Math.random()*1e9).toString(36)+Date.now();a({toB58String:()=>l}),t=this.metrics.trackStream({stream:t,remotePeer:c})}it("Starting the inbound connection upgrade");let o=t;this.protector&&(o=await this.protector.protect(t));try{({conn:e,remotePeer:r,protocol:s}=await this._encryptInbound(this.localPeer,o,this.cryptos)),this.muxers.size?{stream:n,Muxer:i}=await this._multiplexInbound(e,this.muxers):n=e}catch(l){throw it.error("Failed to upgrade inbound connection",l),await t.close(l),l}return this.metrics&&(this.metrics.updatePlaceholder(c,r),a(r)),it("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:s,direction:"inbound",maConn:t,upgradedConn:n,Muxer:i,remotePeer:r})}async upgradeOutbound(t){const e=me.createFromB58String(t.remoteAddr.getPeerId());let r,n,i,s,a,c,o;if(this.metrics){({setTarget:c,proxy:o}=ch());const u=(Math.random()*1e9).toString(36)+Date.now();c({toB58String:()=>u}),t=this.metrics.trackStream({stream:t,remotePeer:o})}it("Starting the outbound connection upgrade");let l=t;this.protector&&(l=await this.protector.protect(t));try{({conn:r,remotePeer:n,protocol:s}=await this._encryptOutbound(this.localPeer,l,e,this.cryptos)),this.muxers.size?{stream:i,Muxer:a}=await this._multiplexOutbound(r,this.muxers):i=r}catch(u){throw it.error("Failed to upgrade outbound connection",u),await t.close(u),u}return this.metrics&&(this.metrics.updatePlaceholder(o,n),c(n)),it("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:s,direction:"outbound",maConn:t,upgradedConn:i,Muxer:a,remotePeer:n})}_createConnection({cryptoProtocol:t,direction:e,maConn:r,upgradedConn:n,Muxer:i,remotePeer:s}){let a,c,o;i&&(a=new i({onStream:async h=>{const S=new Ji.Listener(h);try{const{stream:p,protocol:C}=await S.handle(Array.from(this.protocols.keys()));it("%s: incoming stream opened on %s",e,C),this.metrics&&this.metrics.trackStream({stream:p,remotePeer:s,protocol:C}),o.addStream(h,{protocol:C}),this._onStream({connection:o,stream:{...h,...p},protocol:C})}catch(p){it.error(p)}},onStreamEnd:h=>{o.removeStream(h.id)}}),c=async h=>{it("%s: starting new stream on %s",e,h);const S=a.newStream(),p=new Ji.Dialer(S);try{const{stream:C,protocol:T}=await p.select(h);return this.metrics&&this.metrics.trackStream({stream:C,remotePeer:s,protocol:T}),{stream:{...S,...C},protocol:T}}catch(C){throw it.error("could not create new stream",C),F(C,wa.ERR_UNSUPPORTED_PROTOCOL)}},mS(n,a,n).catch(it.error));const l=r.timeline;r.timeline=new Proxy(l,{set:(...h)=>(o&&h[1]==="close"&&h[2]&&!l.close&&(async()=>{try{o.stat.status==="open"&&await o.close()}catch(S){it.error(S)}finally{this.onConnectionEnd(o)}})(),Reflect.set(...h))}),r.timeline.upgraded=Date.now();const u=()=>{throw F(new Error("connection is not multiplexed"),"ERR_CONNECTION_NOT_MULTIPLEXED")};return o=new fS({localAddr:r.localAddr,remoteAddr:r.remoteAddr,localPeer:this.localPeer,remotePeer:s,stat:{direction:e,timeline:r.timeline,multiplexer:i&&i.multicodec,encryption:t},newStream:c||u,getStreams:()=>a?a.streams:u,close:async h=>{await r.close(h),a&&a.streams.map(S=>S.abort(h))}}),this.onConnection(o),o}_onStream({connection:t,stream:e,protocol:r}){const n=this.protocols.get(r);n({connection:t,stream:e,protocol:r})}async _encryptInbound(t,e,r){const n=new Ji.Listener(e),i=Array.from(r.keys());it("handling inbound crypto protocol selection",i);try{const{stream:s,protocol:a}=await n.handle(i),c=r.get(a);if(it("encrypting inbound connection..."),!c)throw new Error(`no crypto module found for ${a}`);return{...await c.secureInbound(t,s),protocol:a}}catch(s){throw F(s,wa.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(t,e,r,n){const i=new Ji.Dialer(e),s=Array.from(n.keys());it("selecting outbound crypto protocol",s);try{const{stream:a,protocol:c}=await i.select(s),o=n.get(c);if(it("encrypting outbound connection to %j",r),!o)throw new Error(`no crypto module found for ${c}`);return{...await o.secureOutbound(t,a,r),protocol:c}}catch(a){throw F(a,wa.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(t,e){const r=new Ji.Dialer(t),n=Array.from(e.keys());it("outbound selecting muxer %s",n);try{const{stream:i,protocol:s}=await r.select(n);it("%s selected as muxer protocol",s);const a=e.get(s);return{stream:i,Muxer:a}}catch(i){throw F(i,wa.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(t,e){const r=new Ji.Listener(t),n=Array.from(e.keys());it("inbound handling muxers %s",n);try{const{stream:i,protocol:s}=await r.handle(n),a=e.get(s);return{stream:i,Muxer:a}}catch(i){throw F(i,wa.ERR_MUXER_UNAVAILABLE)}}}var yS=gS;const{codes:{ERR_INVALID_PARAMETERS:lh}}=ft,bS=t=>t;class vS{constructor({peerStore:t,eventName:e,eventProperty:r,eventTransformer:n=bS}){this._ps=t,this.eventName=e,this.eventProperty=r,this.eventTransformer=n,this.data=new Map}set(t,e){throw F(new Error("set must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}_setData(t,e,{emit:r=!0}={}){const n=t.toB58String();this.data.set(n,e),r&&this._emit(t,e)}_emit(t,e){this._ps.emit(this.eventName,{peerId:t,[this.eventProperty]:this.eventTransformer(e)})}get(t){if(!me.isPeerId(t))throw F(new Error("peerId must be an instance of peer-id"),lh);const e=this.data.get(t.toB58String());return e?[...e]:void 0}delete(t){if(!me.isPeerId(t))throw F(new Error("peerId must be an instance of peer-id"),lh);return this.data.delete(t.toB58String())?(this._emit(t,[]),!0):!1}}var ko=vS;const Er=Object.assign(Q("libp2p:peer-store:address-book"),{error:Q("libp2p:peer-store:address-book:err")}),{codes:{ERR_INVALID_PARAMETERS:Zi}}=ft;class wS extends ko{constructor(t){super({peerStore:t,eventName:"change:multiaddrs",eventProperty:"multiaddrs",eventTransformer:e=>e.addresses?e.addresses.map(r=>r.multiaddr):[]});this.data=new Map}consumePeerRecord(t){let e;try{e=vo.createFromProtobuf(t.payload)}catch(c){return Er.error("invalid peer record received"),!1}if(!e.peerId.equals(t.peerId))return Er("signing key does not match PeerId in the PeerRecord"),!1;if(!e.multiaddrs||!e.multiaddrs.length)return!1;const r=e.peerId,n=r.toB58String(),i=this.data.get(n)||{record:void 0},s=i.record;if(s&&s.seqNumber>=e.seqNumber)return!1;const a=this._toAddresses(e.multiaddrs,!0);return this._setData(r,{addresses:a,record:{raw:t.marshal(),seqNumber:e.seqNumber}}),Er(`stored provided peer record for ${n}`),!0}getRawEnvelope(t){const e=this.data.get(t.toB58String());return!e||!e.record||!e.record.raw?void 0:e.record.raw}getPeerRecord(t){const e=this.getRawEnvelope(t);return e?ca.createFromProtobuf(e):void 0}set(t,e){if(!me.isPeerId(t))throw Er.error("peerId must be an instance of peer-id to store data"),F(new Error("peerId must be an instance of peer-id"),Zi);const r=this._toAddresses(e);if(!r.length)return this;const n=t.toB58String(),i=this.data.get(n);if(i&&i.addresses&&i.addresses.length===r.length){const s=i.addresses.filter(a=>r.some(c=>a.multiaddr.equals(c.multiaddr)));if(s.length===i.addresses.length)return Er(`the addresses provided to store are equal to the already stored for ${n}`),this}return this._setData(t,{addresses:r,record:i&&i.record}),Er(`stored provided multiaddrs for ${n}`),i||this._ps.emit("peer",t),this}add(t,e){if(!me.isPeerId(t))throw Er.error("peerId must be an instance of peer-id to store data"),F(new Error("peerId must be an instance of peer-id"),Zi);const r=this._toAddresses(e),n=t.toB58String(),i=this.data.get(n);return i&&i.addresses&&(i.addresses.forEach(s=>{r.find(a=>a.multiaddr.equals(s.multiaddr))||r.push(s)}),i.addresses.length===r.length)?(Er(`the addresses provided to store are already stored for ${n}`),this):(this._setData(t,{addresses:r,record:i&&i.record}),Er(`added provided multiaddrs for ${n}`),i&&i.addresses||this._ps.emit("peer",t),this)}get(t){if(!me.isPeerId(t))throw F(new Error("peerId must be an instance of peer-id"),Zi);const e=this.data.get(t.toB58String());return e&&e.addresses?[...e.addresses]:void 0}_toAddresses(t,e=!1){if(!t)throw Er.error("multiaddrs must be provided to store data"),F(new Error("multiaddrs must be provided"),Zi);const r=[];return t.forEach(n=>{if(!ze.isMultiaddr(n))throw Er.error(`multiaddr ${n} must be an instance of multiaddr`),F(new Error(`multiaddr ${n} must be an instance of multiaddr`),Zi);r.push({multiaddr:n,isCertified:e})}),r}getMultiaddrsForPeer(t,e=r=>r){if(!me.isPeerId(t))throw F(new Error("peerId must be an instance of peer-id"),Zi);const r=this.data.get(t.toB58String());return!r||!r.addresses?void 0:e(r.addresses||[]).map(n=>{const i=n.multiaddr,s=i.getPeerId();return s&&s===t.toB58String()?i:i.encapsulate(`/p2p/${t.toB58String()}`)})}}var SS=wS;const uh=Object.assign(Q("libp2p:peer-store:key-book"),{error:Q("libp2p:peer-store:key-book:err")}),{codes:{ERR_INVALID_PARAMETERS:dh}}=ft;class _S extends ko{constructor(t){super({peerStore:t,eventName:"change:pubkey",eventProperty:"pubkey",eventTransformer:e=>e.pubKey});this.data=new Map}set(t,e){if(!me.isPeerId(t))throw uh.error("peerId must be an instance of peer-id to store data"),F(new Error("peerId must be an instance of peer-id"),dh);const r=t.toB58String(),n=this.data.get(r);return!n&&e&&(t.pubKey=e,this._setData(t,t),uh(`stored provided public key for ${r}`)),this}get(t){if(!me.isPeerId(t))throw F(new Error("peerId must be an instance of peer-id"),dh);const e=this.data.get(t.toB58String());return e?e.pubKey:void 0}}var ES=_S;const _l=Object.assign(Q("libp2p:peer-store:proto-book"),{error:Q("libp2p:peer-store:proto-book:err")}),{codes:{ERR_INVALID_PARAMETERS:es}}=ft;class TS extends ko{constructor(t){super({peerStore:t,eventName:"change:metadata",eventProperty:"metadata"});this.data=new Map}set(t,e,r){if(!me.isPeerId(t))throw _l.error("peerId must be an instance of peer-id to store data"),F(new Error("peerId must be an instance of peer-id"),es);if(typeof e!="string"||!(r instanceof Uint8Array))throw _l.error("valid key and value must be provided to store data"),F(new Error("valid key and value must be provided"),es);return this._setValue(t,e,r),this}_setValue(t,e,r,{emit:n=!0}={}){const i=t.toB58String(),s=this.data.get(i)||new Map,a=s.get(e);if(a&&ir(r,a)){_l(`the metadata provided to store is equal to the already stored for ${i} on ${e}`);return}s.set(e,r),this.data.set(i,s),n&&this._emit(t,e)}get(t){if(!me.isPeerId(t))throw F(new Error("peerId must be an instance of peer-id"),es);return this.data.get(t.toB58String())}getValue(t,e){if(!me.isPeerId(t))throw F(new Error("peerId must be an instance of peer-id"),es);const r=this.data.get(t.toB58String());return r&&r.get(e)}delete(t){if(!me.isPeerId(t))throw F(new Error("peerId must be an instance of peer-id"),es);return this.data.delete(t.toB58String())?(this._emit(t),!0):!1}deleteValue(t,e){if(!me.isPeerId(t))throw F(new Error("peerId must be an instance of peer-id"),es);const r=this.data.get(t.toB58String());return!r||!r.delete(e)?!1:(this._emit(t,e),!0)}}var AS=TS;const Tr=Object.assign(Q("libp2p:peer-store:proto-book"),{error:Q("libp2p:peer-store:proto-book:err")}),{codes:{ERR_INVALID_PARAMETERS:ts}}=ft;class CS extends ko{constructor(t){super({peerStore:t,eventName:"change:protocols",eventProperty:"protocols",eventTransformer:e=>Array.from(e)});this.data=new Map}set(t,e){if(!me.isPeerId(t))throw Tr.error("peerId must be an instance of peer-id to store data"),F(new Error("peerId must be an instance of peer-id"),ts);if(!e)throw Tr.error("protocols must be provided to store data"),F(new Error("protocols must be provided"),ts);const r=t.toB58String(),n=this.data.get(r),i=new Set(e),s=(a,c)=>a.size===c.size&&[...a].every(o=>c.has(o));return n&&s(n,i)?(Tr(`the protocols provided to store are equal to the already stored for ${r}`),this):(this._setData(t,i),Tr(`stored provided protocols for ${r}`),this)}add(t,e){if(!me.isPeerId(t))throw Tr.error("peerId must be an instance of peer-id to store data"),F(new Error("peerId must be an instance of peer-id"),ts);if(!e)throw Tr.error("protocols must be provided to store data"),F(new Error("protocols must be provided"),ts);const r=t.toB58String(),n=this.data.get(r)||new Set,i=new Set([...n,...e]);return n.size===i.size?(Tr(`the protocols provided to store are already stored for ${r}`),this):(this._setData(t,i),Tr(`added provided protocols for ${r}`),this)}remove(t,e){if(!me.isPeerId(t))throw Tr.error("peerId must be an instance of peer-id to store data"),F(new Error("peerId must be an instance of peer-id"),ts);if(!e)throw Tr.error("protocols must be provided to store data"),F(new Error("protocols must be provided"),ts);const r=t.toB58String(),n=this.data.get(r);if(n){const i=new Set([...n].filter(s=>!e.includes(s)));if(n.size===i.size)return this;this._setData(t,i),Tr(`removed provided protocols for ${r}`)}return this}}var IS=CS;const{EventEmitter:RS}=It,{codes:{ERR_INVALID_PARAMETERS:kS}}=ft;class PS extends RS{constructor({peerId:t}){super();this._peerId=t,this.addressBook=new SS(this),this.keyBook=new ES(this),this.metadataBook=new AS(this),this.protoBook=new IS(this)}start(){}stop(){}get peers(){const t=new Set([...this.addressBook.data.keys(),...this.keyBook.data.keys(),...this.protoBook.data.keys(),...this.metadataBook.data.keys()]);this._peerId&&t.delete(this._peerId.toB58String());const e=new Map;return t.forEach(r=>{e.set(r,this.get(me.createFromCID(r)))}),e}delete(t){const e=this.addressBook.delete(t),r=this.keyBook.delete(t),n=this.protoBook.delete(t),i=this.metadataBook.delete(t);return e||r||n||i}get(t){if(!me.isPeerId(t))throw F(new Error("peerId must be an instance of peer-id"),kS);const e=this.keyBook.data.get(t.toB58String()),r=this.addressBook.get(t),n=this.metadataBook.get(t),i=this.protoBook.get(t);return!e&&!r&&!n&&!i?void 0:{id:e||t,addresses:r||[],protocols:i||[],metadata:n}}}var ph=PS;function NS(t,e,r){const n=new t(e,r);n._subscribeAdapter=n.subscribe,n._unsubscribeAdapter=n.unsubscribe;function i(a,c){c&&n.on(a,c),n._subscribeAdapter(a)}function s(a,c){c?n.removeListener(a,c):n.removeAllListeners(a),n.listenerCount(a)===0&&n._unsubscribeAdapter(a)}return n.subscribe=i,n.unsubscribe=s,n}var OS=NS,MS="/peers/",DS="/peers/addrs/",xS="/peers/keys/",LS="/peers/metadata/",BS="/peers/protos/",jS={NAMESPACE_COMMON:MS,NAMESPACE_ADDRESS:DS,NAMESPACE_KEYS:xS,NAMESPACE_METADATA:LS,NAMESPACE_PROTOCOL:BS};const US=`
message Addresses {
  // Address represents a single multiaddr.
  message Address {
    required bytes multiaddr = 1;

    // Flag to indicate if the address comes from a certified source.
    optional bool isCertified = 2;
  }

  // CertifiedRecord contains a serialized signed PeerRecord used to
  // populate the signedAddrs list.
  message CertifiedRecord {
    // The Seq counter from the signed PeerRecord envelope
    uint64 seq = 1;

    // The serialized bytes of the SignedEnvelope containing the PeerRecord.
    bytes raw = 2;
  }

  // The known multiaddrs.
  repeated Address addrs = 1;

  // The most recently received signed PeerRecord.
  CertifiedRecord certified_record = 2;
}
`;var hh=Dr(US).Addresses;const FS=`
message Protocols {
  repeated string protocols = 1;
}
`;var fh=Dr(FS).Protocols;const ut=Object.assign(Q("libp2p:persistent-peer-store"),{error:Q("libp2p:persistent-peer-store:err")}),{Key:Po}=Rc,{NAMESPACE_ADDRESS:$S,NAMESPACE_COMMON:qS,NAMESPACE_KEYS:GS,NAMESPACE_METADATA:VS,NAMESPACE_PROTOCOL:HS}=jS;class zS extends ph{constructor({peerId:t,datastore:e,threshold:r=5}){super({peerId:t});this._datastore=e,this._dirtyPeers=new Set,this._dirtyMetadata=new Map,this.threshold=r,this._addDirtyPeer=this._addDirtyPeer.bind(this)}async start(){ut("PeerStore is starting"),this.on("change:protocols",this._addDirtyPeer),this.on("change:multiaddrs",this._addDirtyPeer),this.on("change:pubkey",this._addDirtyPeerKey),this.on("change:metadata",this._addDirtyPeerMetadata);for await(const t of this._datastore.query({prefix:qS}))await this._processDatastoreEntry(t);ut("PeerStore started")}async stop(){ut("PeerStore is stopping"),this.removeAllListeners(),await this._commitData(),ut("PeerStore stopped")}_addDirtyPeer({peerId:t}){const e=t.toB58String();ut("add dirty peer",e),this._dirtyPeers.add(e),this._dirtyPeers.size>=this.threshold&&this._commitData().catch(r=>{ut.error("error committing data",r)})}_addDirtyPeerKey({peerId:t}){if(t.hasInlinePublicKey())return;const e=t.toB58String();ut("add dirty peer key",e),this._dirtyPeers.add(e),this._dirtyPeers.size>=this.threshold&&this._commitData().catch(r=>{ut.error("error committing data",r)})}_addDirtyPeerMetadata({peerId:t,metadata:e}){const r=t.toB58String();ut("add dirty metadata peer",r),this._dirtyPeers.add(r);const n=this._dirtyMetadata.get(r)||new Set;n.add(e),this._dirtyMetadata.set(r,n),this._dirtyPeers.size>=this.threshold&&this._commitData().catch(i=>{ut.error("error committing data",i)})}async _commitData(){const t=Array.from(this._dirtyPeers);if(!t.length)return;this._dirtyPeers.clear(),ut("create batch commit");const e=this._datastore.batch();for(const r of t){const n=this.keyBook.data.get(r)||me.createFromCID(r);this._batchAddressBook(n,e),!n.hasInlinePublicKey()&&this._batchKeyBook(n,e),this._batchMetadataBook(n,e),this._batchProtoBook(n,e)}await e.commit(),ut("batch committed")}_batchAddressBook(t,e){const r=t.toString(),n=new Po(`${$S}${r}`),i=this.addressBook.data.get(t.toB58String());try{if(!i){e.delete(n);return}const s=hh.encode({addrs:i.addresses.map(a=>({multiaddr:a.multiaddr.bytes,isCertified:a.isCertified})),certified_record:i.record?{seq:i.record.seqNumber,raw:i.record.raw}:void 0});e.put(n,s)}catch(s){ut.error(s)}}_batchKeyBook(t,e){const r=t.toString(),n=new Po(`${GS}${r}`);try{if(!t.pubKey){e.delete(n);return}const i=t.marshalPubKey();e.put(n,i)}catch(i){ut.error(i)}}_batchMetadataBook(t,e){const r=t.toString(),n=this._dirtyMetadata.get(t.toB58String())||[];try{n.forEach(i=>{const s=new Po(`${VS}${r}/${i}`),a=this.metadataBook.getValue(t,i);a?e.put(s,a):e.delete(s)})}catch(i){ut.error(i)}}_batchProtoBook(t,e){const r=t.toString(),n=new Po(`${HS}${r}`),i=this.protoBook.get(t);try{if(!i){e.delete(n);return}const s=fh.encode({protocols:i});e.put(n,s)}catch(s){ut.error(s)}}async _processDatastoreEntry({key:t,value:e}){try{const r=t.toString().split("/"),n=me.createFromCID(r[3]);let i;switch(r[2]){case"addrs":i=hh.decode(e),this.addressBook._setData(n,{addresses:i.addrs.map(s=>({multiaddr:ze(s.multiaddr),isCertified:Boolean(s.isCertified)})),record:i.certified_record?{raw:i.certified_record.raw,seqNumber:i.certified_record.seq}:void 0},{emit:!1});break;case"keys":i=await me.createFromPubKey(e),this.keyBook._setData(i,i,{emit:!1});break;case"metadata":this.metadataBook._setValue(n,r[4],e,{emit:!1});break;case"protos":i=fh.decode(e),this.protoBook._setData(n,new Set(i.protocols),{emit:!1});break;default:ut("invalid data persisted for: ",t.toString())}}catch(r){ut.error(r)}}}var WS=zS;const mh=()=>{},gh=Symbol.for("@libp2p/js-interfaces/topology");class KS{constructor({min:t=0,max:e=Infinity,handlers:r={}}){this.min=t,this.max=e,this._onConnect=r.onConnect||mh,this._onDisconnect=r.onDisconnect||mh,this.peers=new Set}get[Symbol.toStringTag](){return"Topology"}get[gh](){return!0}static isTopology(t){return Boolean(t&&t[gh])}set registrar(t){this._registrar=t}disconnect(t){this._onDisconnect(t)}}var XS=KS;const QS=Object.assign(Q("libp2p:peer-store"),{error:Q("libp2p:peer-store:err")}),{codes:{ERR_INVALID_PARAMETERS:YS}}=ft;class JS{constructor({peerStore:t,connectionManager:e}){this.peerStore=t,this.connectionManager=e,this.topologies=new Map,this._handle=void 0,this._onDisconnect=this._onDisconnect.bind(this),this.connectionManager.on("peer:disconnect",this._onDisconnect)}get handle(){return this._handle}set handle(t){this._handle=t}getConnection(t){return this.connectionManager.get(t)}register(t){if(!XS.isTopology(t))throw QS.error("topology must be an instance of interfaces/topology"),F(new Error("topology must be an instance of interfaces/topology"),YS);const e=(Math.random()*1e9).toString(36)+Date.now();return this.topologies.set(e,t),t.registrar=this,e}unregister(t){return this.topologies.delete(t)}_onDisconnect(t,e){for(const[,r]of this.topologies)r.disconnect(t.remotePeer,e)}}var ZS=JS,El=ee(function(t){const{Buffer:e}=ea;t.exports=async function*(r){for await(const n of r)e.isBuffer(n)?yield n:ht.isBufferList(n)?yield n.slice():yield e.from(n)},t.exports.toBuffer=t.exports,t.exports.toList=async function*(r){for await(const n of r)e.isBuffer(n)?yield new ht().append(n):ht.isBufferList(n)?yield n:yield new ht().append(e.from(n))}}),e_={PROTOCOL:"/ipfs/ping/1.0.0",PING_LENGTH:32},No=ee(function(t,e){const r=Object.assign(Q("libp2p:ping"),{error:Q("libp2p:ping:err")}),{pipe:n}=nr,{toBuffer:i}=El,{collect:s,take:a}=Pc,{PROTOCOL:c,PING_LENGTH:o}=e_;async function l(S,p){r("dialing %s to %s",c,p.toB58String?p.toB58String():p);const{stream:C}=await S.dialProtocol(p,c),T=Date.now(),E=sr.randomBytes(o),[I]=await n([E],C,q=>a(1,q),i,s),x=Date.now();if(!ir(E,I))throw F(new Error("Received wrong ping ack"),"ERR_WRONG_PING_ACK");return x-T}function u(S){S.handle(c,({stream:p})=>n(p,p))}function h(S){S.unhandle(c)}e=t.exports=l,e.mount=u,e.unmount=h}),t_=t=>e=>async function*(){for await(const r of e)yield t.encode(r)}(),r_=t=>e=>async function*(){for await(const r of e)yield t.decode(r)}(),Tl={encode:t_,decode:r_},n_=t=>e=>Je.encode()(Tl.encode(t)(e)),i_=t=>e=>Tl.decode(t)(El(Je.decode()(e))),s_=Tl,a_={encode:n_,decode:i_,it:s_};const o_=`
message Identify {
  // protocolVersion determines compatibility between peers
  optional string protocolVersion = 5; // e.g. ipfs/1.0.0

  // agentVersion is like a UserAgent string in browsers, or client version in bittorrent
  // includes the client name and client.
  optional string agentVersion = 6; // e.g. go-ipfs/0.1.0

  // publicKey is this node's public key (which also gives its node.ID)
  // - may not need to be sent, as secure channel implies it has been sent.
  // - then again, if we change / disable secure channel, may still want it.
  optional bytes publicKey = 1;

  // listenAddrs are the multiaddrs the sender node listens for open connections on
  repeated bytes listenAddrs = 2;

  // oservedAddr is the multiaddr of the remote endpoint that the sender node perceives
  // this is useful information to convey to the other side, as it helps the remote endpoint
  // determine whether its connection to the local peer goes through NAT.
  optional bytes observedAddr = 4;

  repeated string protocols = 3;

  // signedPeerRecord contains a serialized SignedEnvelope containing a PeerRecord,
  // signed by the sending node. It contains the same addresses as the listenAddrs field, but
  // in a form that lets us share authenticated addrs with other peers.
  optional bytes signedPeerRecord = 8;
}
`;var Sa=Dr(o_).Identify;const Br=Object.assign(Q("libp2p:identify"),{error:Q("libp2p:identify:err")}),{pipe:Oo}=nr,{collect:yh,take:bh,consume:vh}=Pc,{toBuffer:wh}=El,{MULTICODEC_IDENTIFY:Al,MULTICODEC_IDENTIFY_PUSH:Mo,AGENT_VERSION:c_,PROTOCOL_VERSION:l_}=qd,{codes:Cl}=ft;class Do{constructor({libp2p:t}){this._libp2p=t,this.peerStore=t.peerStore,this.connectionManager=t.connectionManager,this.peerId=t.peerId,this.handleMessage=this.handleMessage.bind(this),this._host={agentVersion:c_,protocolVersion:l_,...t._options.host},this.peerStore.metadataBook.set(this.peerId,"AgentVersion",qe(this._host.agentVersion)),this.peerStore.metadataBook.set(this.peerId,"ProtocolVersion",qe(this._host.protocolVersion)),this.connectionManager.on("peer:connect",e=>{this.identify(e).catch(Br.error)}),this.peerStore.on("change:multiaddrs",({peerId:e})=>{e.toString()===this.peerId.toString()&&this.pushToPeerStore()}),this.peerStore.on("change:protocols",({peerId:e})=>{e.toString()===this.peerId.toString()&&this.pushToPeerStore()})}async push(t){const e=await this.peerStore.addressBook.getRawEnvelope(this.peerId),r=this._libp2p.multiaddrs.map(s=>s.bytes),n=this.peerStore.protoBook.get(this.peerId)||[],i=t.map(async s=>{try{const{stream:a}=await s.newStream(Mo);await Oo([{listenAddrs:r,signedPeerRecord:e,protocols:n}],a_.encode(Sa),a,vh)}catch(a){Br.error("could not push identify update to peer",a)}});return Promise.all(i)}pushToPeerStore(){if(!this._libp2p.isStarted())return;const t=[];let e;for(const r of this.peerStore.peers.values())r.protocols.includes(Mo)&&(e=this.connectionManager.get(r.id))&&t.push(e);this.push(t)}async identify(t){const{stream:e}=await t.newStream(Al),[r]=await Oo([],e,Je.decode(),bh(1),wh,yh);if(!r)throw F(new Error("No data could be retrieved"),Cl.ERR_CONNECTION_ENDED);let n;try{n=Sa.decode(r)}catch(u){throw F(u,Cl.ERR_INVALID_MESSAGE)}let{publicKey:i,listenAddrs:s,protocols:a,observedAddr:c,signedPeerRecord:o}=n;const l=await me.createFromPubKey(i);if(t.remotePeer.toB58String()!==l.toB58String())throw F(new Error("identified peer does not match the expected peer"),Cl.ERR_INVALID_PEER);c=Do.getCleanMultiaddr(c);try{const u=await ca.openAndCertify(o,vo.DOMAIN);if(this.peerStore.addressBook.consumePeerRecord(u)){this.peerStore.protoBook.set(l,a);return}}catch(u){Br("received invalid envelope, discard it and fallback to listenAddrs is available",u)}try{this.peerStore.addressBook.set(l,s.map(u=>ze(u)))}catch(u){Br.error("received invalid addrs",u)}this.peerStore.protoBook.set(l,a),this.peerStore.metadataBook.set(l,"AgentVersion",qe(n.agentVersion)),Br("received observed address of %s",c)}handleMessage({connection:t,stream:e,protocol:r}){switch(r){case Al:return this._handleIdentify({connection:t,stream:e});case Mo:return this._handlePush({connection:t,stream:e});default:Br.error("cannot handle unknown protocol %s",r)}}async _handleIdentify({connection:t,stream:e}){let r=new Uint8Array(0);this.peerId.pubKey&&(r=this.peerId.pubKey.bytes);const n=await this.peerStore.addressBook.getRawEnvelope(this.peerId),i=this.peerStore.protoBook.get(this.peerId)||[],s=Sa.encode({protocolVersion:this._host.protocolVersion,agentVersion:this._host.agentVersion,publicKey:r,listenAddrs:this._libp2p.multiaddrs.map(a=>a.bytes),signedPeerRecord:n,observedAddr:t.remoteAddr.bytes,protocols:i});try{await Oo([s],Je.encode(),e,vh)}catch(a){Br.error("could not respond to identify request",a)}}async _handlePush({connection:t,stream:e}){let r;try{const[i]=await Oo([],e,Je.decode(),bh(1),wh,yh);r=Sa.decode(i)}catch(i){return Br.error("received invalid message",i)}const n=t.remotePeer;try{const i=await ca.openAndCertify(r.signedPeerRecord,vo.DOMAIN);if(this.peerStore.addressBook.consumePeerRecord(i)){this.peerStore.protoBook.set(n,r.protocols);return}}catch(i){Br("received invalid envelope, discard it and fallback to listenAddrs is available",i)}try{this.peerStore.addressBook.set(n,r.listenAddrs.map(i=>ze(i)))}catch(i){Br.error("received invalid addrs",i)}this.peerStore.protoBook.set(n,r.protocols)}static getCleanMultiaddr(t){if(t&&t.length>0)try{return ze(t)}catch(e){return null}return null}}const u_={IDENTIFY:Al,IDENTIFY_PUSH:Mo};Do.multicodecs=u_,Do.Messsage=Sa;var Sh=Do;const ur=Object.assign(Q("libp2p"),{error:Q("libp2p:err")}),{EventEmitter:d_}=It,{validate:p_}=mv,{codes:Il,messages:h_}=ft,f_=Sh.multicodecs;class Rl extends d_{static async create(t){if(t.peerId)return new Rl(t);const e=await me.create();return t.peerId=e,new Rl(t)}constructor(t){super();if(this._options=p_(t),this.peerId=this._options.peerId,this.datastore=this._options.datastore,this.peerStore=this.datastore&&this._options.peerStore.persistence?new WS({peerId:this.peerId,datastore:this.datastore,...this._options.peerStore}):new ph({peerId:this.peerId}),this.addresses=this._options.addresses,this.addressManager=new yv(this._options.addresses),this._modules=this._options.modules,this._config=this._options.config,this._transport=[],this._discovery=new Map,this._options.connectionManager.minPeers&&(this._options.connectionManager.minConnections=this._options.connectionManager.minPeers),this.connectionManager=new kv(this,{autoDial:this._config.peerDiscovery.autoDial,...this._options.connectionManager}),this._options.metrics.enabled&&(this.metrics=new Lw({...this._options.metrics,connectionManager:this.connectionManager})),this._options.keychain&&this._options.keychain.datastore){ur("creating keychain");const r=Dp.generateOptions();this.keychain=new Dp(this._options.keychain.datastore,{passPhrase:this._options.keychain.pass,...r,...this._options.keychain}),ur("keychain constructed")}if(this.upgrader=new yS({localPeer:this.peerId,metrics:this.metrics,onConnection:r=>this.connectionManager.onConnect(r),onConnectionEnd:r=>this.connectionManager.onDisconnect(r)}),this.transportManager=new np({libp2p:this,upgrader:this.upgrader,faultTolerance:this._options.transportManager.faultTolerance}),this.registrar=new ZS({peerStore:this.peerStore,connectionManager:this.connectionManager}),this.handle=this.handle.bind(this),this.registrar.handle=this.handle,!this._modules.connEncryption||!this._modules.connEncryption.length)throw F(new Error(h_.CONN_ENCRYPTION_REQUIRED),Il.CONN_ENCRYPTION_REQUIRED);const e=this._modules.connEncryption;if(e.forEach(r=>{this.upgrader.cryptos.set(r.protocol,r)}),this.dialer=new aw({transportManager:this.transportManager,peerStore:this.peerStore,concurrency:this._options.dialer.maxParallelDials,perPeerLimit:this._options.dialer.maxDialsPerPeer,timeout:this._options.dialer.dialTimeout,resolvers:this._options.dialer.resolvers,addressSorter:this._options.dialer.addressSorter}),this._modules.transport.forEach(r=>{const n=r.prototype[Symbol.toStringTag],i=this._config.transport[n];this.transportManager.add(n,r,i)}),this._config.relay.enabled&&(this.transportManager.add(Ap.prototype[Symbol.toStringTag],Ap),this.relay=new z0(this)),this._modules.streamMuxer){const r=this._modules.streamMuxer;r.forEach(n=>{this.upgrader.muxers.set(n.multicodec,n)}),this.identifyService=new Sh({libp2p:this}),this.handle(Object.values(f_),this.identifyService.handleMessage)}if(this._modules.connProtector)this.upgrader.protector=this._modules.connProtector;else if(An.process!==void 0&&An.process.env&&An.process.env.LIBP2P_FORCE_PNET)throw new Error("Private network is enforced, but no protector was provided");if(this._modules.dht){const r=this._modules.dht;this._dht=new r({libp2p:this,dialer:this.dialer,peerId:this.peerId,peerStore:this.peerStore,registrar:this.registrar,datastore:this.datastore,...this._config.dht})}if(this._modules.pubsub){const r=this._modules.pubsub;this.pubsub=OS(r,this,this._config.pubsub)}this.peerRouting=new yy(this),this.contentRouting=new Sy(this),No.mount(this),this._onDiscoveryPeer=this._onDiscoveryPeer.bind(this)}emit(t,...e){return t==="error"&&!this._events.error?(ur.error(e),!1):super.emit(t,...e)}async start(){ur("libp2p is starting");try{await this._onStarting(),await this._onDidStart(),ur("libp2p has started")}catch(t){throw this.emit("error",t),ur.error("An error occurred starting libp2p",t),await this.stop(),t}}async stop(){ur("libp2p is stopping");try{this._isStarted=!1,this.relay&&this.relay.stop(),this.peerRouting.stop();for(const t of this._discovery.values())t.removeListener("peer",this._onDiscoveryPeer);await Promise.all(Array.from(this._discovery.values(),t=>t.stop())),this._discovery=new Map,await this.peerStore.stop(),await this.connectionManager.stop(),await Promise.all([this.pubsub&&this.pubsub.stop(),this._dht&&this._dht.stop(),this.metrics&&this.metrics.stop()]),await this.transportManager.close(),No.unmount(this),this.dialer.destroy()}catch(t){t&&(ur.error(t),this.emit("error",t))}ur("libp2p has stopped")}async loadKeychain(){if(!this.keychain)return;try{await this.keychain.findKeyByName("self")}catch(t){await this.keychain.importPeer("self",this.peerId)}}isStarted(){return this._isStarted}get connections(){return this.connectionManager.connections}dial(t,e){return this.dialProtocol(t,[],e)}async dialProtocol(t,e,r){const{id:n,multiaddrs:i}=uo(t);if(n.equals(this.peerId))throw F(new Error("Cannot dial self"),Il.ERR_DIALED_SELF);let s=this.connectionManager.get(n);return s?i&&this.peerStore.addressBook.add(n,i):s=await this.dialer.connectToPeer(t,r),e&&e.length?s.newStream(e):s}get multiaddrs(){const t=this.addressManager.getAnnounceAddrs();if(t.length)return t;const e=this._options.addresses.announceFilter||(r=>r);return e(this.transportManager.getAddrs())}async hangUp(t){const{id:e}=uo(t),r=this.connectionManager.connections.get(e.toB58String());if(!r)return;await Promise.all(r.map(n=>n.close()))}ping(t){const{id:e,multiaddrs:r}=uo(t);return r?No(this,r[0]):No(this,e)}handle(t,e){t=Array.isArray(t)?t:[t],t.forEach(r=>{this.upgrader.protocols.set(r,e)}),this.peerStore.protoBook.add(this.peerId,t)}unhandle(t){t=Array.isArray(t)?t:[t],t.forEach(e=>{this.upgrader.protocols.delete(e)}),this.peerStore.protoBook.remove(this.peerId,t)}async _onStarting(){const t=this.addressManager.getListenAddrs();await this.transportManager.listen(t),await this.peerStore.start(),this._config.pubsub.enabled&&(this.pubsub&&this.pubsub.start()),this._config.dht.enabled&&(this._dht&&this._dht.start(),this._dht.on("peer",this._onDiscoveryPeer)),this.metrics&&this.metrics.start()}async _onDidStart(){this._isStarted=!0,this.peerStore.on("peer",t=>{this.emit("peer:discovery",t),this._maybeConnect(t)});for(const t of this.peerStore.peers.values())this.emit("peer:discovery",t.id);this.connectionManager.start(),await this._setupPeerDiscovery(),this.relay&&this.relay.start(),this.peerRouting.start()}_onDiscoveryPeer(t){if(t.id.toB58String()===this.peerId.toB58String()){ur.error(new Error(Il.ERR_DISCOVERED_SELF));return}t.multiaddrs&&this.peerStore.addressBook.add(t.id,t.multiaddrs),t.protocols&&this.peerStore.protoBook.set(t.id,t.protocols)}async _maybeConnect(t){if(this._config.peerDiscovery.autoDial===!0&&!this.connectionManager.get(t)){const e=this._options.connectionManager.minConnections||0;if(e>this.connectionManager.size){ur("connecting to discovered peer %s",t.toB58String());try{await this.dialer.connectToPeer(t)}catch(r){ur.error("could not connect to discovered peer",r)}}}}async _setupPeerDiscovery(){const t=e=>{let r={enabled:!0};if(e.tag&&this._config.peerDiscovery&&this._config.peerDiscovery[e.tag]&&(r={...r,...this._config.peerDiscovery[e.tag]}),r.enabled&&!this._discovery.has(e.tag)){let n;typeof e=="function"?n=new e(Object.assign({},r,{peerId:this.peerId,libp2p:this})):n=e,n.on("peer",this._onDiscoveryPeer),this._discovery.set(e.tag,n)}};for(const e of this._modules.peerDiscovery||[])t(e);for(const e of this.transportManager.getTransports())e.discovery&&t(e.discovery);await Promise.all(Array.from(this._discovery.values(),e=>e.start()))}}var m_=Rl,g_=typeof WebSocket=="undefined"?ai:WebSocket,kl=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(i){if(this.isStopped)return;const s={value:i,done:!1};if(this.pullQueue.length){const a=this.pullQueue.shift();a&&a.resolve(s)}else this.pushQueue.push(Promise.resolve(s)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(this.isStopped)return;this.isStopped=!0,this.remove();for(const i of this.pullQueue)i.resolve({value:void 0,done:!0});this.pullQueue.length=0}fail(i){if(this.isStopped)return;if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const s of this.pullQueue)s.reject(i);this.pullQueue.length=0}else{const s=Promise.reject(i);s.catch(()=>{}),this.pushQueue.push(s)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:i=>{const s=this.pushQueue.shift();return s?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),s):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((a,c)=>{this.pullQueue.push({resolve:a,reject:c})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class n{constructor(i,{highWaterMark:s=100,lowWaterMark:a=1}={}){const c=new r;c.highWaterMark=s,c.lowWaterMark=a,c.removeCallback=i({push:o=>c.push(o),stop:()=>c.stop(),fail:o=>c.fail(o),on:(o,l)=>{c.eventHandlers[o]=l}})||(()=>{}),this[Symbol.asyncIterator]=()=>c[Symbol.asyncIterator](),Object.freeze(this)}}e.EventIterator=n,e.default=n}),y_=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.EventIterator=kl.EventIterator;function r(n,i,s){return new kl.EventIterator(({push:a})=>(this.addEventListener(n,a,i),()=>this.removeEventListener(n,a,i)),s)}e.subscribe=r,e.default=kl.EventIterator});const{Buffer:b_}=ea,{EventIterator:v_}=y_;function w_(t){return t instanceof ArrayBuffer||t!=null&&t.constructor!=null&&t.constructor.name==="ArrayBuffer"&&typeof t.byteLength=="number"}var _h=t=>{const e=t.removeEventListener||t.removeListener,r=async function*(){const s=new v_(({push:a,stop:c,fail:o})=>(t.addEventListener("message",a),t.addEventListener("error",o),t.addEventListener("close",c),()=>{e.call(t,"message",a),e.call(t,"error",o),e.call(t,"close",c)}),{highWaterMark:Infinity});for await(const{data:a}of s)yield w_(a)?b_.from(a):a}();let n=t.readyState===1,i;return t.addEventListener("open",()=>{n=!0,i=null}),t.addEventListener("close",()=>{n=!1,i=null}),t.addEventListener("error",s=>{n||(i=s)}),r.connected=()=>new Promise((s,a)=>{if(n)return s();if(i)return a(i);const c=u=>{e.call(t,"open",o),e.call(t,"error",l),u()},o=()=>c(s),l=u=>c(()=>a(u));t.addEventListener("open",o),t.addEventListener("error",l)}),r},S_=async t=>{if(t.readyState>=2)throw new Error("socket closed");return t.readyState===1?void 0:new Promise((e,r)=>{const n=t&&(t.removeEventListener||t.removeListener);function i(){typeof n=="function"&&(n.call(t,"open",s),n.call(t,"error",a))}function s(){i(),e()}function a(c){i(),r(c)}t.addEventListener("open",s),t.addEventListener("error",a)})},Eh=(t,e)=>(e=e||{},e.closeOnEnd=e.closeOnEnd!==!1,async r=>{for await(const n of r){try{await S_(t)}catch(i){if(i.message==="socket closed")break;throw i}t.send(n)}if(e.closeOnEnd&&t.readyState<=1)return new Promise((n,i)=>{t.addEventListener("close",s=>{if(s.wasClean||s.code===1006)n();else{const a=Object.assign(new Error("ws error"),{event:s});i(a)}}),setTimeout(()=>t.close())})}),Th=(t,e)=>{e=e||{},e.binaryType?t.binaryType=e.binaryType:e.binary&&(t.binaryType="arraybuffer");const r={sink:Eh(t,e),source:_h(t),connected:()=>r.source.connected()};return r},__=function(t,e,r,n){r=r||{};var t=ra.parse(t,!1,!0),i;return t.protocol?i=t.protocol:(i=e.protocol?e.protocol.replace(/:$/,""):"http",i=(r[i]||n||i)+":"),t.host&&t.host[0]===":"&&(t.host=null),t.hostname?ra.format({protocol:i,slashes:!0,hostname:t.hostname,port:t.port,pathname:t.pathname,search:t.search}):(t.host=e.host,t.port?ra.format({protocol:i,slashes:!0,host:e.hostname+":"+t.port,port:t.port,pathname:t.pathname,search:t.search}):t.pathname?ra.format({protocol:i,slashes:!0,host:t.host,pathname:t.pathname,search:t.search}):(t.pathname=e.pathname,t.search?ra.format({protocol:i,slashes:!0,host:t.host,pathname:t.pathname,search:t.search}):(t.search=e.search,t.format(t))))};const E_={http:"ws",https:"wss"},T_="ws";var A_=(t,e)=>__(t,e,E_,T_),Ah=ee(function(t){t.exports=function(e,r={}){const n=typeof window=="undefined"?{}:window.location,i=A_(e,n),s=new g_(i,r.websocket),a=Th(s,r);return a.remoteAddress=i,a.close=()=>new Promise((c,o)=>{s.addEventListener("close",c),s.close()}),a.destroy=()=>{s.terminate?s.terminate():s.close()},a.socket=s,a},t.exports.connect=t.exports});const xo=(t,e)=>e,C_=(t,e,r,n)=>{if(n&&n.assumeHttp===!1)return`tcp://${t}:${e}`;let i="tcp",s=`:${e}`;const a=r[r.length-1];return a.protocol==="tcp"&&(i=e==="443"?"https":"http",s=e==="443"||e==="80"?"":s),`${i}://${t}${s}`},I_={ip4:xo,ip6:(t,e,r,n)=>n.length===1&&n[0].protocol==="ip6"?e:`[${e}]`,tcp:(t,e,r,n,i)=>n.some(s=>["http","https","ws","wss"].includes(s.protocol))?`${t}:${e}`:C_(t,e,n,i),udp:(t,e)=>`udp://${t}:${e}`,dnsaddr:xo,dns4:xo,dns6:xo,ipfs:(t,e)=>`${t}/ipfs/${e}`,p2p:(t,e)=>`${t}/p2p/${e}`,http:t=>`http://${t}`,https:t=>`https://${t}`,ws:t=>`ws://${t}`,wss:t=>`wss://${t}`,"p2p-websocket-star":t=>`${t}/p2p-websocket-star`,"p2p-webrtc-star":t=>`${t}/p2p-webrtc-star`,"p2p-webrtc-direct":t=>`${t}/p2p-webrtc-direct`};var R_=(t,e)=>{const r=Rt(t),n=t.toString().split("/").slice(1);return r.tuples().map(i=>({protocol:n.shift(),content:i[1]?n.shift():null})).reduce((i,s,a,c)=>{const o=I_[s.protocol];if(!o)throw new Error(`Unsupported protocol ${s.protocol}`);return o(i,s.content,a,c,e)},"")};function k_(){return typeof window!="undefined"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof fe!="undefined"&&typeof fe.versions=="object"&&!!fe.versions.electron?!0:typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0}var P_=k_;const Lo=typeof window=="object"&&typeof document=="object"&&document.nodeType===9,_a=P_(),N_=Lo&&!_a,O_=_a&&!Lo,M_=_a&&Lo,D_=typeof Kg=="function"&&typeof fe!="undefined"&&typeof fe.release!="undefined"&&fe.release.name==="node"&&!_a,x_=typeof importScripts=="function"&&typeof self!="undefined"&&typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope,L_=typeof fe!="undefined"&&typeof fe.env!="undefined"&&!1;var Ch={isTest:L_,isElectron:_a,isElectronMain:O_,isElectronRenderer:M_,isNode:D_,isBrowser:N_,isWebWorker:x_,isEnvWithDom:Lo};const B_=Wt,Pl=Wt.v4,Ih=Wt.v6,Rh=function(t,e,r){r=~~r;var n;if(Pl(t))n=e||new Uint8Array(r+4),t.split(/\./g).map(function(u){n[r++]=parseInt(u,10)&255});else if(Ih(t)){var i=t.split(":",8),s;for(s=0;s<i.length;s++){var a=Pl(i[s]),c;a&&(c=Rh(i[s]),i[s]=ae(c.slice(0,2),"base16")),c&&++s<8&&i.splice(s,0,ae(c.slice(2,4),"base16"))}if(i[0]==="")for(;i.length<8;)i.unshift("0");else if(i[i.length-1]==="")for(;i.length<8;)i.push("0");else if(i.length<8){for(s=0;s<i.length&&i[s]!=="";s++);var o=[s,"1"];for(s=9-i.length;s>0;s--)o.push("0");i.splice.apply(i,o)}for(n=e||new Uint8Array(r+16),s=0;s<i.length;s++){var l=parseInt(i[s],16);n[r++]=l>>8&255,n[r++]=l&255}}if(!n)throw Error("Invalid ip address: "+t);return n},j_=function(t,e,r){e=~~e,r=r||t.length-e;var n=[],i;const s=new DataView(t.buffer);if(r===4){for(let a=0;a<r;a++)n.push(t[e+a]);i=n.join(".")}else if(r===16){for(let a=0;a<r;a+=2)n.push(s.getUint16(e+a).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i};var Bo={isIP:B_,isV4:Pl,isV6:Ih,toBytes:Rh,toString:j_};function Ft(t){if(typeof t=="number"){if(Ft.codes[t])return Ft.codes[t];throw new Error("no protocol with code: "+t)}else if(typeof t=="string"||t instanceof String){if(Ft.names[t])return Ft.names[t];throw new Error("no protocol with name: "+t)}throw new Error("invalid protocol id type: "+t)}const dr=-1;Ft.lengthPrefixedVarSize=dr,Ft.V=dr,Ft.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,dr,"ip6zone"],[53,dr,"dns","resolvable"],[54,dr,"dns4","resolvable"],[55,dr,"dns6","resolvable"],[56,dr,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,dr,"unix",!1,"path"],[421,dr,"ipfs"],[421,dr,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,dr,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,dr,"memory"]],Ft.names={},Ft.codes={},Ft.table.map(t=>{const e=kh.apply(null,t);Ft.codes[e.code]=e,Ft.names[e.name]=e}),Ft.object=kh;function kh(t,e,r,n,i){return{code:t,size:e,name:r,resolvable:Boolean(n),path:Boolean(i)}}var jr=Ft,Ph=Ea;function Ea(t,e){return e instanceof Uint8Array?Ea.toString(t,e):Ea.toBytes(t,e)}Ea.toString=function(e,r){e=jr(e);switch(e.code){case 4:case 41:return U_(r);case 6:case 273:case 33:case 132:return Oh(r);case 53:case 54:case 55:case 56:case 400:case 777:return $_(r);case 421:return G_(r);case 444:return Mh(r);case 445:return Mh(r);default:return ae(r,"base16")}},Ea.toBytes=function(e,r){e=jr(e);switch(e.code){case 4:return Nh(r);case 41:return Nh(r);case 6:case 273:case 33:case 132:return Nl(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return F_(r);case 421:return q_(r);case 444:return V_(r);case 445:return H_(r);default:return qe(r,"base16")}};function Nh(t){if(!Bo.isIP(t))throw new Error("invalid ip address");return Bo.toBytes(t)}function U_(t){const e=Bo.toString(t);if(!e||!Bo.isIP(e))throw new Error("invalid ip address");return e}function Nl(t){const e=new ArrayBuffer(2),r=new DataView(e);return r.setUint16(0,t),new Uint8Array(e)}function Oh(t){const e=new DataView(t.buffer);return e.getUint16(0)}function F_(t){const e=qe(t),r=Uint8Array.from(ie.encode(e.length));return Oe([r,e],r.length+e.length)}function $_(t){const e=ie.decode(t);if(t=t.slice(ie.decode.bytes),t.length!==e)throw new Error("inconsistent lengths");return ae(t)}function q_(t){const e=new Qr(t).multihash,r=Uint8Array.from(ie.encode(e.length));return Oe([r,e],r.length+e.length)}function G_(t){const e=ie.decode(t),r=t.slice(ie.decode.bytes);if(r.length!==e)throw new Error("inconsistent lengths");return ae(r,"base58btc")}function V_(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==16)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion address.");const r=Tn.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Nl(n);return Oe([r,i],r.length+i.length)}function H_(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==56)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion3 address.");const r=Tn.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Nl(n);return Oe([r,i],r.length+i.length)}function Mh(t){const e=t.slice(0,t.length-2),r=t.slice(t.length-2),n=ae(e,"base32"),i=Oh(r);return n+":"+i}var Ar={stringToStringTuples:Dh,stringTuplesToString:xh,tuplesToStringTuples:Bh,stringTuplesToTuples:Lh,bytesToTuples:Ol,tuplesToBytes:jh,bytesToString:z_,stringToBytes:Fh,fromString:W_,fromBytes:$h,validateBytes:Ml,isValidBytes:K_,cleanPath:jo,ParseError:Dl,protoFromTuple:Ta,sizeForAddr:Uh};function Dh(t){const e=[],r=t.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let n=0;n<r.length;n++){const i=r[n],s=jr(i);if(s.size===0){e.push([i]);continue}if(n++,n>=r.length)throw Dl("invalid address: "+t);if(s.path){e.push([i,jo(r.slice(n).join("/"))]);break}e.push([i,r[n]])}return e}function xh(t){const e=[];return t.map(r=>{const n=Ta(r);e.push(n.name),r.length>1&&e.push(r[1])}),jo(e.join("/"))}function Lh(t){return t.map(e=>{Array.isArray(e)||(e=[e]);const r=Ta(e);return e.length>1?[r.code,Ph.toBytes(r.code,e[1])]:[r.code]})}function Bh(t){return t.map(e=>{const r=Ta(e);return e.length>1?[r.code,Ph.toString(r.code,e[1])]:[r.code]})}function jh(t){return $h(Oe(t.map(e=>{const r=Ta(e);let n=Uint8Array.from(ie.encode(r.code));return e.length>1&&(n=Oe([n,e[1]])),n})))}function Uh(t,e){if(t.size>0)return t.size/8;if(t.size===0)return 0;{const r=ie.decode(e);return r+ie.decode.bytes}}function Ol(t){const e=[];let r=0;for(;r<t.length;){const n=ie.decode(t,r),i=ie.decode.bytes,s=jr(n),a=Uh(s,t.slice(r+i));if(a===0){e.push([n]),r+=i;continue}const c=t.slice(r+i,r+i+a);if(r+=a+i,r>t.length)throw Dl("Invalid address Uint8Array: "+ae(t,"base16"));e.push([n,c])}return e}function z_(t){const e=Ol(t),r=Bh(e);return xh(r)}function Fh(t){t=jo(t);const e=Dh(t),r=Lh(e);return jh(r)}function W_(t){return Fh(t)}function $h(t){const e=Ml(t);if(e)throw e;return Uint8Array.from(t)}function Ml(t){try{Ol(t)}catch(e){return e}}function K_(t){return Ml(t)===void 0}function jo(t){return"/"+t.trim().split("/").filter(e=>e).join("/")}function Dl(t){return new Error("Error parsing address: "+t)}function Ta(t){const e=jr(t[0]);return e}var X_=ee(function(t,e){const r=Symbol.for("nodejs.util.inspect.custom"),n=new Map,i=Yr.proto(function(s){if(!(this instanceof i))return new i(s);if(s==null&&(s=""),s instanceof Uint8Array)this.bytes=Ar.fromBytes(s);else if(typeof s=="string"||s instanceof String){if(s.length>0&&s.charAt(0)!=="/")throw new Error(`multiaddr "${s}" must start with a "/"`);this.bytes=Ar.fromString(s)}else if(s.bytes&&s.protos&&s.protoCodes)this.bytes=Ar.fromBytes(s.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});i.prototype.toString=function(){return Ar.bytesToString(this.bytes)},i.prototype.toJSON=i.prototype.toString,i.prototype.toOptions=function(){const a={},c=this.toString().split("/");return a.family=c[1]==="ip4"?"ipv4":"ipv6",a.host=c[2],a.transport=c[3],a.port=parseInt(c[4]),a},i.prototype[r]=function(){return"<Multiaddr "+ae(this.bytes,"base16")+" - "+Ar.bytesToString(this.bytes)+">"},i.prototype.inspect=function(){return"<Multiaddr "+ae(this.bytes,"base16")+" - "+Ar.bytesToString(this.bytes)+">"},i.prototype.protos=function(){return this.protoCodes().map(a=>Object.assign({},jr(a)))},i.prototype.protoCodes=function(){const a=[],c=this.bytes;let o=0;for(;o<c.length;){const l=ie.decode(c,o),u=ie.decode.bytes,h=jr(l),S=Ar.sizeForAddr(h,c.slice(o+u));o+=S+u,a.push(l)}return a},i.prototype.protoNames=function(){return this.protos().map(a=>a.name)},i.prototype.tuples=function(){return Ar.bytesToTuples(this.bytes)},i.prototype.stringTuples=function(){const a=Ar.bytesToTuples(this.bytes);return Ar.tuplesToStringTuples(a)},i.prototype.encapsulate=function(a){return a=i(a),i(this.toString()+a.toString())},i.prototype.decapsulate=function(a){a=a.toString();const c=this.toString(),o=c.lastIndexOf(a);if(o<0)throw new Error("Address "+this+" does not contain subaddress: "+a);return i(c.slice(0,o))},i.prototype.decapsulateCode=function(a){const c=this.tuples();for(let o=c.length-1;o>=0;o--)if(c[o][0]===a)return i(Ar.tuplesToBytes(c.slice(0,o)));return this},i.prototype.getPeerId=function(){let a=null;try{const c=this.stringTuples().filter(o=>{if(o[0]===jr.names.ipfs.code)return!0});a=c.pop()[1],a=ae(new Qr(a).multihash,"base58btc")}catch(c){a=null}return a},i.prototype.getPath=function(){let a=null;try{a=this.stringTuples().filter(c=>{const o=jr(c[0]);if(o.path)return!0})[0][1]}catch(c){a=null}return a},i.prototype.equals=function(a){return ir(this.bytes,a.bytes)},i.prototype.resolve=async function(){const a=this.protos().find(l=>l.resolvable);if(!a)return[this];const c=n.get(a.name);if(!c)throw F(new Error(`no available resolver for ${a.name}`),"ERR_NO_AVAILABLE_RESOLVER");const o=await c(this);return o.map(l=>i(l))},i.prototype.nodeAddress=function(){const a=this.protoCodes(),c=this.protoNames(),o=this.toString().split("/").slice(1);if(o.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(a[0]!==4&&a[0]!==41&&a[0]!==54&&a[0]!==55)throw new Error(`no protocol with name: "'${c[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(o[2]!=="tcp"&&o[2]!=="udp")throw new Error(`no protocol with name: "'${c[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:a[0]===41||a[0]===55?6:4,address:o[1],port:parseInt(o[3])}},i.fromNodeAddress=function(a,c){if(!a)throw new Error("requires node address object");if(!c)throw new Error("requires transport protocol");let o;switch(a.family){case"IPv4":o="ip4";break;case"IPv6":o="ip6";break;default:throw Error(`Invalid addr family. Got '${a.family}' instead of 'IPv4' or 'IPv6'`)}return i("/"+[o,a.address,c,a.port].join("/"))},i.prototype.isThinWaistAddress=function(a){const c=(a||this).protos();return c.length!==2||c[0].code!==4&&c[0].code!==41?!1:!(c[1].code!==6&&c[1].code!==273)},i.protocols=jr,i.isName=function(a){return i.isMultiaddr(a)?a.protos().some(c=>c.resolvable):!1},i.resolve=function(a){return!i.isMultiaddr(a)||!i.isName(a)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},i.resolvers=n,e=t.exports=i}),Q_=ee(function(t,e){e=t.exports=Th,e.source=_h,e.sink=Eh,e.createServer=ai,e.connect=Ah}),Y_=421,J_=290,Z_=6,eE=477,tE=478,rE=2e3,qh={CODE_P2P:Y_,CODE_CIRCUIT:J_,CODE_TCP:Z_,CODE_WS:eE,CODE_WSS:tE,CLOSE_TIMEOUT:rE},Gh=ee(function(t,e){(function(){var r,n=244837814094590,i=(n&16777215)==15715070;function s(g,w,R){g!=null&&(typeof g=="number"?this.fromNumber(g,w,R):w==null&&typeof g!="string"?this.fromString(g,256):this.fromString(g,w))}function a(){return new s(null)}function c(g,w,R,B,W,K){for(;--K>=0;){var Y=w*this[g++]+R[B]+W;W=Math.floor(Y/67108864),R[B++]=Y&67108863}return W}function o(g,w,R,B,W,K){for(var Y=w&32767,J=w>>15;--K>=0;){var Ie=this[g]&32767,Ve=this[g++]>>15,tt=J*Ie+Ve*Y;Ie=Y*Ie+((tt&32767)<<15)+R[B]+(W&1073741823),W=(Ie>>>30)+(tt>>>15)+J*Ve+(W>>>30),R[B++]=Ie&1073741823}return W}function l(g,w,R,B,W,K){for(var Y=w&16383,J=w>>14;--K>=0;){var Ie=this[g]&16383,Ve=this[g++]>>14,tt=J*Ie+Ve*Y;Ie=Y*Ie+((tt&16383)<<14)+R[B]+W,W=(Ie>>28)+(tt>>14)+J*Ve,R[B++]=Ie&268435455}return W}var u=typeof navigator!="undefined";u&&i&&navigator.appName=="Microsoft Internet Explorer"?(s.prototype.am=o,r=30):u&&i&&navigator.appName!="Netscape"?(s.prototype.am=c,r=26):(s.prototype.am=l,r=28),s.prototype.DB=r,s.prototype.DM=(1<<r)-1,s.prototype.DV=1<<r;var h=52;s.prototype.FV=Math.pow(2,h),s.prototype.F1=h-r,s.prototype.F2=2*r-h;var S="0123456789abcdefghijklmnopqrstuvwxyz",p=new Array,C,T;for(C="0".charCodeAt(0),T=0;T<=9;++T)p[C++]=T;for(C="a".charCodeAt(0),T=10;T<36;++T)p[C++]=T;for(C="A".charCodeAt(0),T=10;T<36;++T)p[C++]=T;function E(g){return S.charAt(g)}function I(g,w){var R=p[g.charCodeAt(w)];return R??-1}function x(g){for(var w=this.t-1;w>=0;--w)g[w]=this[w];g.t=this.t,g.s=this.s}function q(g){this.t=1,this.s=g<0?-1:0,g>0?this[0]=g:g<-1?this[0]=g+this.DV:this.t=0}function m(g){var w=a();return w.fromInt(g),w}function b(g,w){var R;if(w==16)R=4;else if(w==8)R=3;else if(w==256)R=8;else if(w==2)R=1;else if(w==32)R=5;else if(w==4)R=2;else{this.fromRadix(g,w);return}this.t=0,this.s=0;for(var B=g.length,W=!1,K=0;--B>=0;){var Y=R==8?g[B]&255:I(g,B);if(Y<0){g.charAt(B)=="-"&&(W=!0);continue}W=!1,K==0?this[this.t++]=Y:K+R>this.DB?(this[this.t-1]|=(Y&(1<<this.DB-K)-1)<<K,this[this.t++]=Y>>this.DB-K):this[this.t-1]|=Y<<K,K+=R,K>=this.DB&&(K-=this.DB)}R==8&&(g[0]&128)!=0&&(this.s=-1,K>0&&(this[this.t-1]|=(1<<this.DB-K)-1<<K)),this.clamp(),W&&s.ZERO.subTo(this,this)}function A(){for(var g=this.s&this.DM;this.t>0&&this[this.t-1]==g;)--this.t}function d(g){if(this.s<0)return"-"+this.negate().toString(g);var w;if(g==16)w=4;else if(g==8)w=3;else if(g==2)w=1;else if(g==32)w=5;else if(g==4)w=2;else return this.toRadix(g);var R=(1<<w)-1,B,W=!1,K="",Y=this.t,J=this.DB-Y*this.DB%w;if(Y-- >0)for(J<this.DB&&(B=this[Y]>>J)>0&&(W=!0,K=E(B));Y>=0;)J<w?(B=(this[Y]&(1<<J)-1)<<w-J,B|=this[--Y]>>(J+=this.DB-w)):(B=this[Y]>>(J-=w)&R,J<=0&&(J+=this.DB,--Y)),B>0&&(W=!0),W&&(K+=E(B));return W?K:"0"}function f(){var g=a();return s.ZERO.subTo(this,g),g}function _(){return this.s<0?this.negate():this}function y(g){var w=this.s-g.s;if(w!=0)return w;var R=this.t;if(w=R-g.t,w!=0)return this.s<0?-w:w;for(;--R>=0;)if((w=this[R]-g[R])!=0)return w;return 0}function k(g){var w=1,R;return(R=g>>>16)!=0&&(g=R,w+=16),(R=g>>8)!=0&&(g=R,w+=8),(R=g>>4)!=0&&(g=R,w+=4),(R=g>>2)!=0&&(g=R,w+=2),(R=g>>1)!=0&&(g=R,w+=1),w}function N(){return this.t<=0?0:this.DB*(this.t-1)+k(this[this.t-1]^this.s&this.DM)}function D(g,w){var R;for(R=this.t-1;R>=0;--R)w[R+g]=this[R];for(R=g-1;R>=0;--R)w[R]=0;w.t=this.t+g,w.s=this.s}function M(g,w){for(var R=g;R<this.t;++R)w[R-g]=this[R];w.t=Math.max(this.t-g,0),w.s=this.s}function L(g,w){var R=g%this.DB,B=this.DB-R,W=(1<<B)-1,K=Math.floor(g/this.DB),Y=this.s<<R&this.DM,J;for(J=this.t-1;J>=0;--J)w[J+K+1]=this[J]>>B|Y,Y=(this[J]&W)<<R;for(J=K-1;J>=0;--J)w[J]=0;w[K]=Y,w.t=this.t+K+1,w.s=this.s,w.clamp()}function $(g,w){w.s=this.s;var R=Math.floor(g/this.DB);if(R>=this.t){w.t=0;return}var B=g%this.DB,W=this.DB-B,K=(1<<B)-1;w[0]=this[R]>>B;for(var Y=R+1;Y<this.t;++Y)w[Y-R-1]|=(this[Y]&K)<<W,w[Y-R]=this[Y]>>B;B>0&&(w[this.t-R-1]|=(this.s&K)<<W),w.t=this.t-R,w.clamp()}function G(g,w){for(var R=0,B=0,W=Math.min(g.t,this.t);R<W;)B+=this[R]-g[R],w[R++]=B&this.DM,B>>=this.DB;if(g.t<this.t){for(B-=g.s;R<this.t;)B+=this[R],w[R++]=B&this.DM,B>>=this.DB;B+=this.s}else{for(B+=this.s;R<g.t;)B-=g[R],w[R++]=B&this.DM,B>>=this.DB;B-=g.s}w.s=B<0?-1:0,B<-1?w[R++]=this.DV+B:B>0&&(w[R++]=B),w.t=R,w.clamp()}function z(g,w){var R=this.abs(),B=g.abs(),W=R.t;for(w.t=W+B.t;--W>=0;)w[W]=0;for(W=0;W<B.t;++W)w[W+R.t]=R.am(0,B[W],w,W,0,R.t);w.s=0,w.clamp(),this.s!=g.s&&s.ZERO.subTo(w,w)}function te(g){for(var w=this.abs(),R=g.t=2*w.t;--R>=0;)g[R]=0;for(R=0;R<w.t-1;++R){var B=w.am(R,w[R],g,2*R,0,1);(g[R+w.t]+=w.am(R+1,2*w[R],g,2*R+1,B,w.t-R-1))>=w.DV&&(g[R+w.t]-=w.DV,g[R+w.t+1]=1)}g.t>0&&(g[g.t-1]+=w.am(R,w[R],g,2*R,0,1)),g.s=0,g.clamp()}function Z(g,w,R){var B=g.abs();if(B.t<=0)return;var W=this.abs();if(W.t<B.t){w!=null&&w.fromInt(0),R!=null&&this.copyTo(R);return}R==null&&(R=a());var K=a(),Y=this.s,J=g.s,Ie=this.DB-k(B[B.t-1]);Ie>0?(B.lShiftTo(Ie,K),W.lShiftTo(Ie,R)):(B.copyTo(K),W.copyTo(R));var Ve=K.t,tt=K[Ve-1];if(tt==0)return;var pt=tt*(1<<this.F1)+(Ve>1?K[Ve-2]>>this.F2:0),Dt=this.FV/pt,zt=(1<<this.F1)/pt,bt=1<<this.F2,Fe=R.t,rt=Fe-Ve,er=w??a();for(K.dlShiftTo(rt,er),R.compareTo(er)>=0&&(R[R.t++]=1,R.subTo(er,R)),s.ONE.dlShiftTo(Ve,er),er.subTo(K,K);K.t<Ve;)K[K.t++]=0;for(;--rt>=0;){var Kr=R[--Fe]==tt?this.DM:Math.floor(R[Fe]*Dt+(R[Fe-1]+bt)*zt);if((R[Fe]+=K.am(0,Kr,R,rt,0,Ve))<Kr)for(K.dlShiftTo(rt,er),R.subTo(er,R);R[Fe]<--Kr;)R.subTo(er,R)}w!=null&&(R.drShiftTo(Ve,w),Y!=J&&s.ZERO.subTo(w,w)),R.t=Ve,R.clamp(),Ie>0&&R.rShiftTo(Ie,R),Y<0&&s.ZERO.subTo(R,R)}function ye(g){var w=a();return this.abs().divRemTo(g,null,w),this.s<0&&w.compareTo(s.ZERO)>0&&g.subTo(w,w),w}function we(g){this.m=g}function oe(g){return g.s<0||g.compareTo(this.m)>=0?g.mod(this.m):g}function ce(g){return g}function Te(g){g.divRemTo(this.m,null,g)}function Ue(g,w,R){g.multiplyTo(w,R),this.reduce(R)}function mr(g,w){g.squareTo(w),this.reduce(w)}we.prototype.convert=oe,we.prototype.revert=ce,we.prototype.reduce=Te,we.prototype.mulTo=Ue,we.prototype.sqrTo=mr;function qt(){if(this.t<1)return 0;var g=this[0];if((g&1)==0)return 0;var w=g&3;return w=w*(2-(g&15)*w)&15,w=w*(2-(g&255)*w)&255,w=w*(2-((g&65535)*w&65535))&65535,w=w*(2-g*w%this.DV)%this.DV,w>0?this.DV-w:-w}function gt(g){this.m=g,this.mp=g.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<g.DB-15)-1,this.mt2=2*g.t}function at(g){var w=a();return g.abs().dlShiftTo(this.m.t,w),w.divRemTo(this.m,null,w),g.s<0&&w.compareTo(s.ZERO)>0&&this.m.subTo(w,w),w}function Qt(g){var w=a();return g.copyTo(w),this.reduce(w),w}function et(g){for(;g.t<=this.mt2;)g[g.t++]=0;for(var w=0;w<this.m.t;++w){var R=g[w]&32767,B=R*this.mpl+((R*this.mph+(g[w]>>15)*this.mpl&this.um)<<15)&g.DM;for(R=w+this.m.t,g[R]+=this.m.am(0,B,g,w,0,this.m.t);g[R]>=g.DV;)g[R]-=g.DV,g[++R]++}g.clamp(),g.drShiftTo(this.m.t,g),g.compareTo(this.m)>=0&&g.subTo(this.m,g)}function Xe(g,w){g.squareTo(w),this.reduce(w)}function le(g,w,R){g.multiplyTo(w,R),this.reduce(R)}gt.prototype.convert=at,gt.prototype.revert=Qt,gt.prototype.reduce=et,gt.prototype.mulTo=le,gt.prototype.sqrTo=Xe;function Is(){return(this.t>0?this[0]&1:this.s)==0}function Ci(g,w){if(g>4294967295||g<1)return s.ONE;var R=a(),B=a(),W=w.convert(this),K=k(g)-1;for(W.copyTo(R);--K>=0;)if(w.sqrTo(R,B),(g&1<<K)>0)w.mulTo(B,W,R);else{var Y=R;R=B,B=Y}return w.revert(R)}function Rs(g,w){var R;return g<256||w.isEven()?R=new we(w):R=new gt(w),this.exp(g,R)}s.prototype.copyTo=x,s.prototype.fromInt=q,s.prototype.fromString=b,s.prototype.clamp=A,s.prototype.dlShiftTo=D,s.prototype.drShiftTo=M,s.prototype.lShiftTo=L,s.prototype.rShiftTo=$,s.prototype.subTo=G,s.prototype.multiplyTo=z,s.prototype.squareTo=te,s.prototype.divRemTo=Z,s.prototype.invDigit=qt,s.prototype.isEven=Is,s.prototype.exp=Ci,s.prototype.toString=d,s.prototype.negate=f,s.prototype.abs=_,s.prototype.compareTo=y,s.prototype.bitLength=N,s.prototype.mod=ye,s.prototype.modPowInt=Rs,s.ZERO=m(0),s.ONE=m(1);function Yt(){var g=a();return this.copyTo(g),g}function Ii(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function Gr(){return this.t==0?this.s:this[0]<<24>>24}function Hn(){return this.t==0?this.s:this[0]<<16>>16}function Vr(g){return Math.floor(Math.LN2*this.DB/Math.log(g))}function Nt(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function zn(g){if(g==null&&(g=10),this.signum()==0||g<2||g>36)return"0";var w=this.chunkSize(g),R=Math.pow(g,w),B=m(R),W=a(),K=a(),Y="";for(this.divRemTo(B,W,K);W.signum()>0;)Y=(R+K.intValue()).toString(g).substr(1)+Y,W.divRemTo(B,W,K);return K.intValue().toString(g)+Y}function Ri(g,w){this.fromInt(0),w==null&&(w=10);for(var R=this.chunkSize(w),B=Math.pow(w,R),W=!1,K=0,Y=0,J=0;J<g.length;++J){var Ie=I(g,J);if(Ie<0){g.charAt(J)=="-"&&this.signum()==0&&(W=!0);continue}Y=w*Y+Ie,++K>=R&&(this.dMultiply(B),this.dAddOffset(Y,0),K=0,Y=0)}K>0&&(this.dMultiply(Math.pow(w,K)),this.dAddOffset(Y,0)),W&&s.ZERO.subTo(this,this)}function ks(g,w,R){if(typeof w=="number")if(g<2)this.fromInt(1);else for(this.fromNumber(g,R),this.testBit(g-1)||this.bitwiseTo(s.ONE.shiftLeft(g-1),Wn,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(w);)this.dAddOffset(2,0),this.bitLength()>g&&this.subTo(s.ONE.shiftLeft(g-1),this);else{var B=new Array,W=g&7;B.length=(g>>3)+1,w.nextBytes(B),W>0?B[0]&=(1<<W)-1:B[0]=0,this.fromString(B,256)}}function Ps(){var g=this.t,w=new Array;w[0]=this.s;var R=this.DB-g*this.DB%8,B,W=0;if(g-- >0)for(R<this.DB&&(B=this[g]>>R)!=(this.s&this.DM)>>R&&(w[W++]=B|this.s<<this.DB-R);g>=0;)R<8?(B=(this[g]&(1<<R)-1)<<8-R,B|=this[--g]>>(R+=this.DB-8)):(B=this[g]>>(R-=8)&255,R<=0&&(R+=this.DB,--g)),(B&128)!=0&&(B|=-256),W==0&&(this.s&128)!=(B&128)&&++W,(W>0||B!=this.s)&&(w[W++]=B);return w}function dn(g){return this.compareTo(g)==0}function ki(g){return this.compareTo(g)<0?this:g}function Pi(g){return this.compareTo(g)>0?this:g}function pn(g,w,R){var B,W,K=Math.min(g.t,this.t);for(B=0;B<K;++B)R[B]=w(this[B],g[B]);if(g.t<this.t){for(W=g.s&this.DM,B=K;B<this.t;++B)R[B]=w(this[B],W);R.t=this.t}else{for(W=this.s&this.DM,B=K;B<g.t;++B)R[B]=w(W,g[B]);R.t=g.t}R.s=w(this.s,g.s),R.clamp()}function Ni(g,w){return g&w}function Oi(g){var w=a();return this.bitwiseTo(g,Ni,w),w}function Wn(g,w){return g|w}function Ns(g){var w=a();return this.bitwiseTo(g,Wn,w),w}function Jt(g,w){return g^w}function gr(g){var w=a();return this.bitwiseTo(g,Jt,w),w}function hn(g,w){return g&~w}function Kn(g){var w=a();return this.bitwiseTo(g,hn,w),w}function Mi(){for(var g=a(),w=0;w<this.t;++w)g[w]=this.DM&~this[w];return g.t=this.t,g.s=~this.s,g}function Ot(g){var w=a();return g<0?this.rShiftTo(-g,w):this.lShiftTo(g,w),w}function Mt(g){var w=a();return g<0?this.lShiftTo(-g,w):this.rShiftTo(g,w),w}function Os(g){if(g==0)return-1;var w=0;return(g&65535)==0&&(g>>=16,w+=16),(g&255)==0&&(g>>=8,w+=8),(g&15)==0&&(g>>=4,w+=4),(g&3)==0&&(g>>=2,w+=2),(g&1)==0&&++w,w}function Zt(){for(var g=0;g<this.t;++g)if(this[g]!=0)return g*this.DB+Os(this[g]);return this.s<0?this.t*this.DB:-1}function Di(g){for(var w=0;g!=0;)g&=g-1,++w;return w}function Ms(){for(var g=0,w=this.s&this.DM,R=0;R<this.t;++R)g+=Di(this[R]^w);return g}function Ds(g){var w=Math.floor(g/this.DB);return w>=this.t?this.s!=0:(this[w]&1<<g%this.DB)!=0}function xs(g,w){var R=s.ONE.shiftLeft(g);return this.bitwiseTo(R,w,R),R}function Ls(g){return this.changeBit(g,Wn)}function Et(g){return this.changeBit(g,hn)}function Hr(g){return this.changeBit(g,Jt)}function Xn(g,w){for(var R=0,B=0,W=Math.min(g.t,this.t);R<W;)B+=this[R]+g[R],w[R++]=B&this.DM,B>>=this.DB;if(g.t<this.t){for(B+=g.s;R<this.t;)B+=this[R],w[R++]=B&this.DM,B>>=this.DB;B+=this.s}else{for(B+=this.s;R<g.t;)B+=g[R],w[R++]=B&this.DM,B>>=this.DB;B+=g.s}w.s=B<0?-1:0,B>0?w[R++]=B:B<-1&&(w[R++]=this.DV+B),w.t=R,w.clamp()}function Qn(g){var w=a();return this.addTo(g,w),w}function Yn(g){var w=a();return this.subTo(g,w),w}function zr(g){var w=a();return this.multiplyTo(g,w),w}function Or(){var g=a();return this.squareTo(g),g}function Bs(g){var w=a();return this.divRemTo(g,w,null),w}function js(g){var w=a();return this.divRemTo(g,null,w),w}function Us(g){var w=a(),R=a();return this.divRemTo(g,w,R),new Array(w,R)}function Fs(g){this[this.t]=this.am(0,g-1,this,0,0,this.t),++this.t,this.clamp()}function fn(g,w){if(g==0)return;for(;this.t<=w;)this[this.t++]=0;for(this[w]+=g;this[w]>=this.DV;)this[w]-=this.DV,++w>=this.t&&(this[this.t++]=0),++this[w]}function yt(){}function Jn(g){return g}function yr(g,w,R){g.multiplyTo(w,R)}function $s(g,w){g.squareTo(w)}yt.prototype.convert=Jn,yt.prototype.revert=Jn,yt.prototype.mulTo=yr,yt.prototype.sqrTo=$s;function qs(g){return this.exp(g,new yt)}function Gs(g,w,R){var B=Math.min(this.t+g.t,w);for(R.s=0,R.t=B;B>0;)R[--B]=0;var W;for(W=R.t-this.t;B<W;++B)R[B+this.t]=this.am(0,g[B],R,B,0,this.t);for(W=Math.min(g.t,w);B<W;++B)this.am(0,g[B],R,B,0,w-B);R.clamp()}function Vs(g,w,R){--w;var B=R.t=this.t+g.t-w;for(R.s=0;--B>=0;)R[B]=0;for(B=Math.max(w-this.t,0);B<g.t;++B)R[this.t+B-w]=this.am(w-B,g[B],R,0,0,this.t+B-w);R.clamp(),R.drShiftTo(1,R)}function Gt(g){this.r2=a(),this.q3=a(),s.ONE.dlShiftTo(2*g.t,this.r2),this.mu=this.r2.divide(g),this.m=g}function Vt(g){if(g.s<0||g.t>2*this.m.t)return g.mod(this.m);if(g.compareTo(this.m)<0)return g;var w=a();return g.copyTo(w),this.reduce(w),w}function mn(g){return g}function Zn(g){for(g.drShiftTo(this.m.t-1,this.r2),g.t>this.m.t+1&&(g.t=this.m.t+1,g.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);g.compareTo(this.r2)<0;)g.dAddOffset(1,this.m.t+1);for(g.subTo(this.r2,g);g.compareTo(this.m)>=0;)g.subTo(this.m,g)}function Hs(g,w){g.squareTo(w),this.reduce(w)}function gn(g,w,R){g.multiplyTo(w,R),this.reduce(R)}Gt.prototype.convert=Vt,Gt.prototype.revert=mn,Gt.prototype.reduce=Zn,Gt.prototype.mulTo=gn,Gt.prototype.sqrTo=Hs;function xi(g,w){var R=g.bitLength(),B,W=m(1),K;if(R<=0)return W;R<18?B=1:R<48?B=3:R<144?B=4:R<768?B=5:B=6,R<8?K=new we(w):w.isEven()?K=new Gt(w):K=new gt(w);var Y=new Array,J=3,Ie=B-1,Ve=(1<<B)-1;if(Y[1]=K.convert(this),B>1){var tt=a();for(K.sqrTo(Y[1],tt);J<=Ve;)Y[J]=a(),K.mulTo(tt,Y[J-2],Y[J]),J+=2}var pt=g.t-1,Dt,zt=!0,bt=a(),Fe;for(R=k(g[pt])-1;pt>=0;){for(R>=Ie?Dt=g[pt]>>R-Ie&Ve:(Dt=(g[pt]&(1<<R+1)-1)<<Ie-R,pt>0&&(Dt|=g[pt-1]>>this.DB+R-Ie)),J=B;(Dt&1)==0;)Dt>>=1,--J;if((R-=J)<0&&(R+=this.DB,--pt),zt)Y[Dt].copyTo(W),zt=!1;else{for(;J>1;)K.sqrTo(W,bt),K.sqrTo(bt,W),J-=2;J>0?K.sqrTo(W,bt):(Fe=W,W=bt,bt=Fe),K.mulTo(bt,Y[Dt],W)}for(;pt>=0&&(g[pt]&1<<R)==0;)K.sqrTo(W,bt),Fe=W,W=bt,bt=Fe,--R<0&&(R=this.DB-1,--pt)}return K.revert(W)}function Ht(g){var w=this.s<0?this.negate():this.clone(),R=g.s<0?g.negate():g.clone();if(w.compareTo(R)<0){var B=w;w=R,R=B}var W=w.getLowestSetBit(),K=R.getLowestSetBit();if(K<0)return w;for(W<K&&(K=W),K>0&&(w.rShiftTo(K,w),R.rShiftTo(K,R));w.signum()>0;)(W=w.getLowestSetBit())>0&&w.rShiftTo(W,w),(W=R.getLowestSetBit())>0&&R.rShiftTo(W,R),w.compareTo(R)>=0?(w.subTo(R,w),w.rShiftTo(1,w)):(R.subTo(w,R),R.rShiftTo(1,R));return K>0&&R.lShiftTo(K,R),R}function zs(g){if(g<=0)return 0;var w=this.DV%g,R=this.s<0?g-1:0;if(this.t>0)if(w==0)R=this[0]%g;else for(var B=this.t-1;B>=0;--B)R=(w*R+this[B])%g;return R}function Ws(g){var w=g.isEven();if(this.isEven()&&w||g.signum()==0)return s.ZERO;for(var R=g.clone(),B=this.clone(),W=m(1),K=m(0),Y=m(0),J=m(1);R.signum()!=0;){for(;R.isEven();)R.rShiftTo(1,R),w?((!W.isEven()||!K.isEven())&&(W.addTo(this,W),K.subTo(g,K)),W.rShiftTo(1,W)):K.isEven()||K.subTo(g,K),K.rShiftTo(1,K);for(;B.isEven();)B.rShiftTo(1,B),w?((!Y.isEven()||!J.isEven())&&(Y.addTo(this,Y),J.subTo(g,J)),Y.rShiftTo(1,Y)):J.isEven()||J.subTo(g,J),J.rShiftTo(1,J);R.compareTo(B)>=0?(R.subTo(B,R),w&&W.subTo(Y,W),K.subTo(J,K)):(B.subTo(R,B),w&&Y.subTo(W,Y),J.subTo(K,J))}if(B.compareTo(s.ONE)!=0)return s.ZERO;if(J.compareTo(g)>=0)return J.subtract(g);if(J.signum()<0)J.addTo(g,J);else return J;return J.signum()<0?J.add(g):J}var Qe=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Ks=(1<<26)/Qe[Qe.length-1];function Xs(g){var w,R=this.abs();if(R.t==1&&R[0]<=Qe[Qe.length-1]){for(w=0;w<Qe.length;++w)if(R[0]==Qe[w])return!0;return!1}if(R.isEven())return!1;for(w=1;w<Qe.length;){for(var B=Qe[w],W=w+1;W<Qe.length&&B<Ks;)B*=Qe[W++];for(B=R.modInt(B);w<W;)if(B%Qe[w++]==0)return!1}return R.millerRabin(g)}function yn(g){var w=this.subtract(s.ONE),R=w.getLowestSetBit();if(R<=0)return!1;var B=w.shiftRight(R);g=g+1>>1,g>Qe.length&&(g=Qe.length);for(var W=a(),K=0;K<g;++K){W.fromInt(Qe[Math.floor(Math.random()*Qe.length)]);var Y=W.modPow(B,this);if(Y.compareTo(s.ONE)!=0&&Y.compareTo(w)!=0){for(var J=1;J++<R&&Y.compareTo(w)!=0;)if(Y=Y.modPowInt(2,this),Y.compareTo(s.ONE)==0)return!1;if(Y.compareTo(w)!=0)return!1}}return!0}s.prototype.chunkSize=Vr,s.prototype.toRadix=zn,s.prototype.fromRadix=Ri,s.prototype.fromNumber=ks,s.prototype.bitwiseTo=pn,s.prototype.changeBit=xs,s.prototype.addTo=Xn,s.prototype.dMultiply=Fs,s.prototype.dAddOffset=fn,s.prototype.multiplyLowerTo=Gs,s.prototype.multiplyUpperTo=Vs,s.prototype.modInt=zs,s.prototype.millerRabin=yn,s.prototype.clone=Yt,s.prototype.intValue=Ii,s.prototype.byteValue=Gr,s.prototype.shortValue=Hn,s.prototype.signum=Nt,s.prototype.toByteArray=Ps,s.prototype.equals=dn,s.prototype.min=ki,s.prototype.max=Pi,s.prototype.and=Oi,s.prototype.or=Ns,s.prototype.xor=gr,s.prototype.andNot=Kn,s.prototype.not=Mi,s.prototype.shiftLeft=Ot,s.prototype.shiftRight=Mt,s.prototype.getLowestSetBit=Zt,s.prototype.bitCount=Ms,s.prototype.testBit=Ds,s.prototype.setBit=Ls,s.prototype.clearBit=Et,s.prototype.flipBit=Hr,s.prototype.add=Qn,s.prototype.subtract=Yn,s.prototype.multiply=zr,s.prototype.divide=Bs,s.prototype.remainder=js,s.prototype.divideAndRemainder=Us,s.prototype.modPow=xi,s.prototype.modInverse=Ws,s.prototype.pow=qs,s.prototype.gcd=Ht,s.prototype.isProbablePrime=Xs,s.prototype.square=Or,s.prototype.Barrett=Gt;var bn,dt,De;function Qs(g){dt[De++]^=g&255,dt[De++]^=g>>8&255,dt[De++]^=g>>16&255,dt[De++]^=g>>24&255,De>=Sn&&(De-=Sn)}function Li(){Qs(new Date().getTime())}if(dt==null){dt=new Array,De=0;var Tt;if(typeof window!="undefined"&&window.crypto){if(window.crypto.getRandomValues){var Bi=new Uint8Array(32);for(window.crypto.getRandomValues(Bi),Tt=0;Tt<32;++Tt)dt[De++]=Bi[Tt]}else if(navigator.appName=="Netscape"&&navigator.appVersion<"5"){var Wr=window.crypto.random(32);for(Tt=0;Tt<Wr.length;++Tt)dt[De++]=Wr.charCodeAt(Tt)&255}}for(;De<Sn;)Tt=Math.floor(65536*Math.random()),dt[De++]=Tt>>>8,dt[De++]=Tt&255;De=0,Li()}function ei(){if(bn==null){for(Li(),bn=Js(),bn.init(dt),De=0;De<dt.length;++De)dt[De]=0;De=0}return bn.next()}function vn(g){var w;for(w=0;w<g.length;++w)g[w]=ei()}function ti(){}ti.prototype.nextBytes=vn;function wn(){this.i=0,this.j=0,this.S=new Array}function Ys(g){var w,R,B;for(w=0;w<256;++w)this.S[w]=w;for(R=0,w=0;w<256;++w)R=R+this.S[w]+g[w%g.length]&255,B=this.S[w],this.S[w]=this.S[R],this.S[R]=B;this.i=0,this.j=0}function ri(){var g;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,g=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=g,this.S[g+this.S[this.i]&255]}wn.prototype.init=Ys,wn.prototype.next=ri;function Js(){return new wn}var Sn=256;e=t.exports={default:s,BigInteger:s,SecureRandom:ti}}).call(se)}),Cr=ee(function(t,e){var r=e.falseIfInvalid=function(n){return function(){return this.valid?n.apply(this,arguments):!1}};e.isInSubnet=r(function(n){return this.subnetMask<n.subnetMask?!1:this.mask(n.subnetMask)===n.mask()}),e.isCorrect=function(n){return r(function(){return this.addressMinusSuffix!==this.correctForm()?!1:this.subnetMask===n&&!this.parsedSubnet?!0:this.parsedSubnet===String(this.subnetMask)})}}),Aa=ee(function(t,e){!function(){var r={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function n(o){return s(c(o),arguments)}function i(o,l){return n.apply(null,[o].concat(l||[]))}function s(o,l){var u=1,h=o.length,S,p="",C,T,E,I,x,q,m,b;for(C=0;C<h;C++)if(typeof o[C]=="string")p+=o[C];else if(typeof o[C]=="object"){if(E=o[C],E.keys)for(S=l[u],T=0;T<E.keys.length;T++){if(S==null)throw new Error(n('[sprintf] Cannot access property "%s" of undefined value "%s"',E.keys[T],E.keys[T-1]));S=S[E.keys[T]]}else E.param_no?S=l[E.param_no]:S=l[u++];if(r.not_type.test(E.type)&&r.not_primitive.test(E.type)&&S instanceof Function&&(S=S()),r.numeric_arg.test(E.type)&&typeof S!="number"&&isNaN(S))throw new TypeError(n("[sprintf] expecting number but found %T",S));r.number.test(E.type)&&(m=S>=0);switch(E.type){case"b":S=parseInt(S,10).toString(2);break;case"c":S=String.fromCharCode(parseInt(S,10));break;case"d":case"i":S=parseInt(S,10);break;case"j":S=JSON.stringify(S,null,E.width?parseInt(E.width):0);break;case"e":S=E.precision?parseFloat(S).toExponential(E.precision):parseFloat(S).toExponential();break;case"f":S=E.precision?parseFloat(S).toFixed(E.precision):parseFloat(S);break;case"g":S=E.precision?String(Number(S.toPrecision(E.precision))):parseFloat(S);break;case"o":S=(parseInt(S,10)>>>0).toString(8);break;case"s":S=String(S),S=E.precision?S.substring(0,E.precision):S;break;case"t":S=String(!!S),S=E.precision?S.substring(0,E.precision):S;break;case"T":S=Object.prototype.toString.call(S).slice(8,-1).toLowerCase(),S=E.precision?S.substring(0,E.precision):S;break;case"u":S=parseInt(S,10)>>>0;break;case"v":S=S.valueOf(),S=E.precision?S.substring(0,E.precision):S;break;case"x":S=(parseInt(S,10)>>>0).toString(16);break;case"X":S=(parseInt(S,10)>>>0).toString(16).toUpperCase();break}r.json.test(E.type)?p+=S:(r.number.test(E.type)&&(!m||E.sign)?(b=m?"+":"-",S=S.toString().replace(r.sign,"")):b="",x=E.pad_char?E.pad_char==="0"?"0":E.pad_char.charAt(1):" ",q=E.width-(b+S).length,I=E.width&&q>0?x.repeat(q):"",p+=E.align?b+S+I:x==="0"?b+I+S:I+b+S)}return p}var a=Object.create(null);function c(o){if(a[o])return a[o];for(var l=o,u,h=[],S=0;l;){if((u=r.text.exec(l))!==null)h.push(u[0]);else if((u=r.modulo.exec(l))!==null)h.push("%");else if((u=r.placeholder.exec(l))!==null){if(u[2]){S|=1;var p=[],C=u[2],T=[];if((T=r.key.exec(C))!==null)for(p.push(T[1]);(C=C.substring(T[0].length))!=="";)if((T=r.key_access.exec(C))!==null)p.push(T[1]);else if((T=r.index_access.exec(C))!==null)p.push(T[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");u[2]=p}else S|=2;if(S===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");h.push({placeholder:u[0],param_no:u[1],keys:u[2],sign:u[3],pad_char:u[4],align:u[5],width:u[6],precision:u[7],type:u[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");l=l.substring(u[0].length)}return a[o]=h}e.sprintf=n,e.vsprintf=i,typeof window!="undefined"&&(window.sprintf=n,window.vsprintf=i)}()}),xl=1/0,nE=9007199254740991,iE=17976931348623157e292,Vh=0/0,sE="[object Symbol]",aE=/^\s+|\s+$/g,oE=/^[-+]0x[0-9a-f]+$/i,cE=/^0b[01]+$/i,lE=/^0o[0-7]+$/i,Ll="\\ud800-\\udfff",Hh="\\u0300-\\u036f\\ufe20-\\ufe23",zh="\\u20d0-\\u20f0",Wh="\\ufe0e\\ufe0f",uE="["+Ll+"]",Bl="["+Hh+zh+"]",jl="\\ud83c[\\udffb-\\udfff]",dE="(?:"+Bl+"|"+jl+")",Kh="[^"+Ll+"]",Xh="(?:\\ud83c[\\udde6-\\uddff]){2}",Qh="[\\ud800-\\udbff][\\udc00-\\udfff]",Yh="\\u200d",Jh=dE+"?",Zh="["+Wh+"]?",pE="(?:"+Yh+"(?:"+[Kh,Xh,Qh].join("|")+")"+Zh+Jh+")*",hE=Zh+Jh+pE,fE="(?:"+[Kh+Bl+"?",Bl,Xh,Qh,uE].join("|")+")",Ul=RegExp(jl+"(?="+jl+")|"+fE+hE,"g"),mE=RegExp("["+Yh+Ll+Hh+zh+Wh+"]"),gE=parseInt,yE=typeof se=="object"&&se&&se.Object===Object&&se,bE=typeof self=="object"&&self&&self.Object===Object&&self,vE=yE||bE||Function("return this")(),wE=_E("length");function SE(t){return t.split("")}function _E(t){return function(e){return e==null?void 0:e[t]}}function Fl(t){return mE.test(t)}function ef(t){return Fl(t)?TE(t):wE(t)}function EE(t){return Fl(t)?AE(t):SE(t)}function TE(t){for(var e=Ul.lastIndex=0;Ul.test(t);)e++;return e}function AE(t){return t.match(Ul)||[]}var CE=Object.prototype,IE=CE.toString,tf=vE.Symbol,RE=Math.ceil,kE=Math.floor,rf=tf?tf.prototype:void 0,nf=rf?rf.toString:void 0;function sf(t,e){var r="";if(!t||e<1||e>nE)return r;do e%2&&(r+=t),e=kE(e/2),e&&(t+=t);while(e);return r}function PE(t,e,r){var n=-1,i=t.length;e<0&&(e=-e>i?0:i+e),r=r>i?i:r,r<0&&(r+=i),i=e>r?0:r-e>>>0,e>>>=0;for(var s=Array(i);++n<i;)s[n]=t[n+e];return s}function af(t){if(typeof t=="string")return t;if(cf(t))return nf?nf.call(t):"";var e=t+"";return e=="0"&&1/t==-xl?"-0":e}function NE(t,e,r){var n=t.length;return r=r===void 0?n:r,!e&&r>=n?t:PE(t,e,r)}function OE(t,e){e=e===void 0?" ":af(e);var r=e.length;if(r<2)return r?sf(e,t):e;var n=sf(e,RE(t/ef(e)));return Fl(e)?NE(EE(n),0,t).join(""):n.slice(0,t)}function of(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function ME(t){return!!t&&typeof t=="object"}function cf(t){return typeof t=="symbol"||ME(t)&&IE.call(t)==sE}function DE(t){if(!t)return t===0?t:0;if(t=LE(t),t===xl||t===-xl){var e=t<0?-1:1;return e*iE}return t===t?t:0}function xE(t){var e=DE(t),r=e%1;return e===e?r?e-r:e:0}function LE(t){if(typeof t=="number")return t;if(cf(t))return Vh;if(of(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=of(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(aE,"");var r=cE.test(t);return r||lE.test(t)?gE(t.slice(2),r?2:8):oE.test(t)?Vh:+t}function BE(t){return t==null?"":af(t)}function jE(t,e,r){t=BE(t),e=xE(e);var n=e?ef(t):0;return e&&n<e?OE(e-n,r)+t:t}var Ca=jE,$l=1/0,ql=9007199254740991,UE=17976931348623157e292,lf=0/0,FE="[object Function]",$E="[object GeneratorFunction]",qE="[object Symbol]",GE=/^\s+|\s+$/g,VE=/^[-+]0x[0-9a-f]+$/i,HE=/^0b[01]+$/i,zE=/^0o[0-7]+$/i,WE=/^(?:0|[1-9]\d*)$/,KE=parseInt,XE=typeof se=="object"&&se&&se.Object===Object&&se,QE=typeof self=="object"&&self&&self.Object===Object&&self,YE=XE||QE||Function("return this")(),JE=Object.prototype,uf=JE.toString,df=YE.Symbol,ZE=Math.floor,pf=df?df.prototype:void 0,hf=pf?pf.toString:void 0;function eT(t,e){var r="";if(!t||e<1||e>ql)return r;do e%2&&(r+=t),e=ZE(e/2),e&&(t+=t);while(e);return r}function tT(t){if(typeof t=="string")return t;if(ff(t))return hf?hf.call(t):"";var e=t+"";return e=="0"&&1/t==-$l?"-0":e}function rT(t,e){return e=e??ql,!!e&&(typeof t=="number"||WE.test(t))&&(t>-1&&t%1==0)&&t<e}function nT(t,e,r){if(!Uo(r))return!1;var n=typeof e;return(n=="number"?sT(r)&&rT(e,r.length):n=="string"&&e in r)?iT(r[e],t):!1}function iT(t,e){return t===e||t!==t&&e!==e}function sT(t){return t!=null&&oT(t.length)&&!aT(t)}function aT(t){var e=Uo(t)?uf.call(t):"";return e==FE||e==$E}function oT(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=ql}function Uo(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function cT(t){return!!t&&typeof t=="object"}function ff(t){return typeof t=="symbol"||cT(t)&&uf.call(t)==qE}function lT(t){if(!t)return t===0?t:0;if(t=dT(t),t===$l||t===-$l){var e=t<0?-1:1;return e*UE}return t===t?t:0}function uT(t){var e=lT(t),r=e%1;return e===e?r?e-r:e:0}function dT(t){if(typeof t=="number")return t;if(ff(t))return lf;if(Uo(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Uo(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(GE,"");var r=HE.test(t);return r||zE.test(t)?KE(t.slice(2),r?2:8):VE.test(t)?lf:+t}function pT(t){return t==null?"":tT(t)}function hT(t,e,r){return(r?nT(t,e,r):e===void 0)?e=1:e=uT(e),eT(pT(t),e)}var Fo=hT,fT=32,mT=4,gT=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/g,yT=/\/\d{1,2}$/,kt={BITS:fT,GROUPS:mT,RE_ADDRESS:gT,RE_SUBNET_STRING:yT},Ia=Gh.BigInteger,$o=Aa.sprintf;function Me(t){this.valid=!1,this.address=t,this.groups=kt.GROUPS,this.v4=!0,this.subnet="/32",this.subnetMask=32;var e=kt.RE_SUBNET_STRING.exec(t);if(e){if(this.parsedSubnet=e[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,this.subnetMask<0||this.subnetMask>kt.BITS){this.valid=!1,this.error="Invalid subnet mask.";return}t=t.replace(kt.RE_SUBNET_STRING,"")}this.addressMinusSuffix=t,this.parsedAddress=this.parse(t)}Me.prototype.parse=function(t){var e=t.split(".");return t.match(kt.RE_ADDRESS)?this.valid=!0:this.error="Invalid IPv4 address.",e},Me.prototype.isValid=function(){return this.valid},Me.prototype.correctForm=function(){return this.parsedAddress.map(function(t){return parseInt(t,10)}).join(".")},Me.prototype.isCorrect=Cr.isCorrect(kt.BITS),Me.fromHex=function(t){var e=Ca(t.replace(/:/g,""),8,"0"),r=[],n;for(n=0;n<8;n+=2){var i=e.slice(n,n+2);r.push(parseInt(i,16))}return new Me(r.join("."))},Me.fromInteger=function(t){return Me.fromHex(t.toString(16))},Me.prototype.toHex=function(){return this.parsedAddress.map(function(t){return $o("%02x",parseInt(t,10))}).join(":")},Me.prototype.toArray=function(){return this.parsedAddress.map(function(t){return parseInt(t,10)})},Me.prototype.toGroup6=function(){var t=[],e;for(e=0;e<kt.GROUPS;e+=2){var r=$o("%02x%02x",parseInt(this.parsedAddress[e],10),parseInt(this.parsedAddress[e+1],10));t.push($o("%x",parseInt(r,16)))}return t.join(":")},Me.prototype.bigInteger=function(){return this.valid?new Ia(this.parsedAddress.map(function(t){return $o("%02x",parseInt(t,10))}).join(""),16):null},Me.prototype._startAddress=function(){return new Ia(this.mask()+Fo("0",kt.BITS-this.subnetMask),2)},Me.prototype.startAddress=function(){return Me.fromBigInteger(this._startAddress())},Me.prototype.startAddressExclusive=function(){var t=new Ia("1");return Me.fromBigInteger(this._startAddress().add(t))},Me.prototype._endAddress=function(){return new Ia(this.mask()+Fo("1",kt.BITS-this.subnetMask),2)},Me.prototype.endAddress=function(){return Me.fromBigInteger(this._endAddress())},Me.prototype.endAddressExclusive=function(){var t=new Ia("1");return Me.fromBigInteger(this._endAddress().subtract(t))},Me.fromBigInteger=function(t){return Me.fromInteger(parseInt(t.toString(),10))},Me.prototype.mask=function(t){return t===void 0&&(t=this.subnetMask),this.getBitsBase2(0,t)},Me.prototype.getBitsBase2=function(t,e){return this.binaryZeroPad().slice(t,e)},Me.prototype.isInSubnet=Cr.isInSubnet,Me.prototype.isMulticast=function(){return this.isInSubnet(new Me("224.0.0.0/4"))},Me.prototype.binaryZeroPad=function(){return Ca(this.bigInteger().toString(2),kt.BITS,"0")};var hi=Me,Gl=ee(function(t,e){var r=200,n="__lodash_hash_undefined__",i=800,s=16,a=9007199254740991,c="[object Arguments]",o="[object Array]",l="[object AsyncFunction]",u="[object Boolean]",h="[object Date]",S="[object Error]",p="[object Function]",C="[object GeneratorFunction]",T="[object Map]",E="[object Number]",I="[object Null]",x="[object Object]",q="[object Proxy]",m="[object RegExp]",b="[object Set]",A="[object String]",d="[object Undefined]",f="[object WeakMap]",_="[object ArrayBuffer]",y="[object DataView]",k="[object Float32Array]",N="[object Float64Array]",D="[object Int8Array]",M="[object Int16Array]",L="[object Int32Array]",$="[object Uint8Array]",G="[object Uint8ClampedArray]",z="[object Uint16Array]",te="[object Uint32Array]",Z=/[\\^$.*+?()[\]{}|]/g,ye=/^\[object .+?Constructor\]$/,we=/^(?:0|[1-9]\d*)$/,oe={};oe[k]=oe[N]=oe[D]=oe[M]=oe[L]=oe[$]=oe[G]=oe[z]=oe[te]=!0,oe[c]=oe[o]=oe[_]=oe[u]=oe[y]=oe[h]=oe[S]=oe[p]=oe[T]=oe[E]=oe[x]=oe[m]=oe[b]=oe[A]=oe[f]=!1;var ce=typeof se=="object"&&se&&se.Object===Object&&se,Te=typeof self=="object"&&self&&self.Object===Object&&self,Ue=ce||Te||Function("return this")(),mr=e&&!e.nodeType&&e,qt=mr&&!0&&t&&!t.nodeType&&t,gt=qt&&qt.exports===mr,at=gt&&ce.process,Qt=function(){try{var P=qt&&qt.require&&qt.require("util").types;return P||at&&at.binding&&at.binding("util")}catch(j){}}(),et=Qt&&Qt.isTypedArray;function Xe(P,j,V){switch(V.length){case 0:return P.call(j);case 1:return P.call(j,V[0]);case 2:return P.call(j,V[0],V[1]);case 3:return P.call(j,V[0],V[1],V[2])}return P.apply(j,V)}function le(P,j){for(var V=-1,re=Array(P);++V<P;)re[V]=j(V);return re}function Is(P){return function(j){return P(j)}}function Ci(P,j){return P==null?void 0:P[j]}function Rs(P,j){return function(V){return P(j(V))}}var Yt=Array.prototype,Ii=Function.prototype,Gr=Object.prototype,Hn=Ue["__core-js_shared__"],Vr=Ii.toString,Nt=Gr.hasOwnProperty,zn=function(){var P=/[^.]+$/.exec(Hn&&Hn.keys&&Hn.keys.IE_PROTO||"");return P?"Symbol(src)_1."+P:""}(),Ri=Gr.toString,ks=Vr.call(Object),Ps=RegExp("^"+Vr.call(Nt).replace(Z,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),dn=gt?Ue.Buffer:void 0,ki=Ue.Symbol,Pi=Ue.Uint8Array,pn=dn?dn.allocUnsafe:void 0,Ni=Rs(Object.getPrototypeOf,Object),Oi=Object.create,Wn=Gr.propertyIsEnumerable,Ns=Yt.splice,Jt=ki?ki.toStringTag:void 0,gr=function(){try{var P=ei(Object,"defineProperty");return P({},"",{}),P}catch(j){}}(),hn=dn?dn.isBuffer:void 0,Kn=Math.max,Mi=Date.now,Ot=ei(Ue,"Map"),Mt=ei(Object,"create"),Os=function(){function P(){}return function(j){if(!Fe(j))return{};if(Oi)return Oi(j);P.prototype=j;var V=new P;return P.prototype=void 0,V}}();function Zt(P){var j=-1,V=P==null?0:P.length;for(this.clear();++j<V;){var re=P[j];this.set(re[0],re[1])}}function Di(){this.__data__=Mt?Mt(null):{},this.size=0}function Ms(P){var j=this.has(P)&&delete this.__data__[P];return this.size-=j?1:0,j}function Ds(P){var j=this.__data__;if(Mt){var V=j[P];return V===n?void 0:V}return Nt.call(j,P)?j[P]:void 0}function xs(P){var j=this.__data__;return Mt?j[P]!==void 0:Nt.call(j,P)}function Ls(P,j){var V=this.__data__;return this.size+=this.has(P)?0:1,V[P]=Mt&&j===void 0?n:j,this}Zt.prototype.clear=Di,Zt.prototype.delete=Ms,Zt.prototype.get=Ds,Zt.prototype.has=xs,Zt.prototype.set=Ls;function Et(P){var j=-1,V=P==null?0:P.length;for(this.clear();++j<V;){var re=P[j];this.set(re[0],re[1])}}function Hr(){this.__data__=[],this.size=0}function Xn(P){var j=this.__data__,V=mn(j,P);if(V<0)return!1;var re=j.length-1;return V==re?j.pop():Ns.call(j,V,1),--this.size,!0}function Qn(P){var j=this.__data__,V=mn(j,P);return V<0?void 0:j[V][1]}function Yn(P){return mn(this.__data__,P)>-1}function zr(P,j){var V=this.__data__,re=mn(V,P);return re<0?(++this.size,V.push([P,j])):V[re][1]=j,this}Et.prototype.clear=Hr,Et.prototype.delete=Xn,Et.prototype.get=Qn,Et.prototype.has=Yn,Et.prototype.set=zr;function Or(P){var j=-1,V=P==null?0:P.length;for(this.clear();++j<V;){var re=P[j];this.set(re[0],re[1])}}function Bs(){this.size=0,this.__data__={hash:new Zt,map:new(Ot||Et),string:new Zt}}function js(P){var j=Wr(this,P).delete(P);return this.size-=j?1:0,j}function Us(P){return Wr(this,P).get(P)}function Fs(P){return Wr(this,P).has(P)}function fn(P,j){var V=Wr(this,P),re=V.size;return V.set(P,j),this.size+=V.size==re?0:1,this}Or.prototype.clear=Bs,Or.prototype.delete=js,Or.prototype.get=Us,Or.prototype.has=Fs,Or.prototype.set=fn;function yt(P){var j=this.__data__=new Et(P);this.size=j.size}function Jn(){this.__data__=new Et,this.size=0}function yr(P){var j=this.__data__,V=j.delete(P);return this.size=j.size,V}function $s(P){return this.__data__.get(P)}function qs(P){return this.__data__.has(P)}function Gs(P,j){var V=this.__data__;if(V instanceof Et){var re=V.__data__;if(!Ot||re.length<r-1)return re.push([P,j]),this.size=++V.size,this;V=this.__data__=new Or(re)}return V.set(P,j),this.size=V.size,this}yt.prototype.clear=Jn,yt.prototype.delete=yr,yt.prototype.get=$s,yt.prototype.has=qs,yt.prototype.set=Gs;function Vs(P,j){var V=Ve(P),re=!V&&Ie(P),Se=!V&&!re&&Dt(P),Ne=!V&&!re&&!Se&&Kr(P),Be=V||re||Se||Ne,be=Be?le(P.length,String):[],Re=be.length;for(var vt in P)(j||Nt.call(P,vt))&&!(Be&&(vt=="length"||Se&&(vt=="offset"||vt=="parent")||Ne&&(vt=="buffer"||vt=="byteLength"||vt=="byteOffset")||wn(vt,Re)))&&be.push(vt);return be}function Gt(P,j,V){(V!==void 0&&!J(P[j],V)||V===void 0&&!(j in P))&&Zn(P,j,V)}function Vt(P,j,V){var re=P[j];(!(Nt.call(P,j)&&J(re,V))||V===void 0&&!(j in P))&&Zn(P,j,V)}function mn(P,j){for(var V=P.length;V--;)if(J(P[V][0],j))return V;return-1}function Zn(P,j,V){j=="__proto__"&&gr?gr(P,j,{configurable:!0,enumerable:!0,value:V,writable:!0}):P[j]=V}var Hs=Bi();function gn(P){return P==null?P===void 0?d:I:Jt&&Jt in Object(P)?vn(P):w(P)}function xi(P){return rt(P)&&gn(P)==c}function Ht(P){if(!Fe(P)||Js(P))return!1;var j=zt(P)?Ps:ye;return j.test(Y(P))}function zs(P){return rt(P)&&bt(P.length)&&!!oe[gn(P)]}function Ws(P){if(!Fe(P))return g(P);var j=Sn(P),V=[];for(var re in P)re=="constructor"&&(j||!Nt.call(P,re))||V.push(re);return V}function Qe(P,j,V,re,Se){if(P===j)return;Hs(j,function(Ne,Be){if(Se||(Se=new yt),Fe(Ne))Ks(P,j,Be,V,Qe,re,Se);else{var be=re?re(B(P,Be),Ne,Be+"",P,j,Se):void 0;be===void 0&&(be=Ne),Gt(P,Be,be)}},eo)}function Ks(P,j,V,re,Se,Ne,Be){var be=B(P,V),Re=B(j,V),vt=Be.get(Re);if(vt){Gt(P,V,vt);return}var At=Ne?Ne(be,Re,V+"",P,j,Be):void 0,_n=At===void 0;if(_n){var ni=Ve(Re),Mr=!ni&&Dt(Re),ii=!ni&&!Mr&&Kr(Re);At=Re,ni||Mr||ii?Ve(be)?At=be:pt(be)?At=Qs(be):Mr?(_n=!1,At=bn(Re,!0)):ii?(_n=!1,At=De(Re,!0)):At=[]:er(Re)||Ie(Re)?(At=be,Ie(be)?At=ji(be):(!Fe(be)||zt(be))&&(At=ti(Re))):_n=!1}_n&&(Be.set(Re,At),Se(At,Re,re,Ne,Be),Be.delete(Re)),Gt(P,V,At)}function Xs(P,j){return W(R(P,j,Zs),P+"")}var yn=gr?function(P,j){return gr(P,"toString",{configurable:!0,enumerable:!1,value:Ic(j),writable:!0})}:Zs;function bn(P,j){if(j)return P.slice();var V=P.length,re=pn?pn(V):new P.constructor(V);return P.copy(re),re}function dt(P){var j=new P.constructor(P.byteLength);return new Pi(j).set(new Pi(P)),j}function De(P,j){var V=j?dt(P.buffer):P.buffer;return new P.constructor(V,P.byteOffset,P.length)}function Qs(P,j){var V=-1,re=P.length;for(j||(j=Array(re));++V<re;)j[V]=P[V];return j}function Li(P,j,V,re){var Se=!V;V||(V={});for(var Ne=-1,Be=j.length;++Ne<Be;){var be=j[Ne],Re=re?re(V[be],P[be],be,V,P):void 0;Re===void 0&&(Re=P[be]),Se?Zn(V,be,Re):Vt(V,be,Re)}return V}function Tt(P){return Xs(function(j,V){var re=-1,Se=V.length,Ne=Se>1?V[Se-1]:void 0,Be=Se>2?V[2]:void 0;for(Ne=P.length>3&&typeof Ne=="function"?(Se--,Ne):void 0,Be&&Ys(V[0],V[1],Be)&&(Ne=Se<3?void 0:Ne,Se=1),j=Object(j);++re<Se;){var be=V[re];be&&P(j,be,re,Ne)}return j})}function Bi(P){return function(j,V,re){for(var Se=-1,Ne=Object(j),Be=re(j),be=Be.length;be--;){var Re=Be[P?be:++Se];if(V(Ne[Re],Re,Ne)===!1)break}return j}}function Wr(P,j){var V=P.__data__;return ri(j)?V[typeof j=="string"?"string":"hash"]:V.map}function ei(P,j){var V=Ci(P,j);return Ht(V)?V:void 0}function vn(P){var j=Nt.call(P,Jt),V=P[Jt];try{P[Jt]=void 0;var re=!0}catch(Ne){}var Se=Ri.call(P);return re&&(j?P[Jt]=V:delete P[Jt]),Se}function ti(P){return typeof P.constructor=="function"&&!Sn(P)?Os(Ni(P)):{}}function wn(P,j){var V=typeof P;return j=j??a,!!j&&(V=="number"||V!="symbol"&&we.test(P))&&(P>-1&&P%1==0)&&P<j}function Ys(P,j,V){if(!Fe(V))return!1;var re=typeof j;return(re=="number"?tt(V)&&wn(j,V.length):re=="string"&&j in V)?J(V[j],P):!1}function ri(P){var j=typeof P;return j=="string"||j=="number"||j=="symbol"||j=="boolean"?P!=="__proto__":P===null}function Js(P){return!!zn&&zn in P}function Sn(P){var j=P&&P.constructor,V=typeof j=="function"&&j.prototype||Gr;return P===V}function g(P){var j=[];if(P!=null)for(var V in Object(P))j.push(V);return j}function w(P){return Ri.call(P)}function R(P,j,V){return j=Kn(j===void 0?P.length-1:j,0),function(){for(var re=arguments,Se=-1,Ne=Kn(re.length-j,0),Be=Array(Ne);++Se<Ne;)Be[Se]=re[j+Se];Se=-1;for(var be=Array(j+1);++Se<j;)be[Se]=re[Se];return be[j]=V(Be),Xe(P,this,be)}}function B(P,j){return j==="constructor"&&typeof P[j]=="function"||j=="__proto__"?void 0:P[j]}var W=K(yn);function K(P){var j=0,V=0;return function(){var re=Mi(),Se=s-(re-V);if(V=re,Se>0){if(++j>=i)return arguments[0]}else j=0;return P.apply(void 0,arguments)}}function Y(P){if(P!=null){try{return Vr.call(P)}catch(j){}try{return P+""}catch(j){}}return""}function J(P,j){return P===j||P!==P&&j!==j}var Ie=xi(function(){return arguments}())?xi:function(P){return rt(P)&&Nt.call(P,"callee")&&!Wn.call(P,"callee")},Ve=Array.isArray;function tt(P){return P!=null&&bt(P.length)&&!zt(P)}function pt(P){return rt(P)&&tt(P)}var Dt=hn||to;function zt(P){if(!Fe(P))return!1;var j=gn(P);return j==p||j==C||j==l||j==q}function bt(P){return typeof P=="number"&&P>-1&&P%1==0&&P<=a}function Fe(P){var j=typeof P;return P!=null&&(j=="object"||j=="function")}function rt(P){return P!=null&&typeof P=="object"}function er(P){if(!rt(P)||gn(P)!=x)return!1;var j=Ni(P);if(j===null)return!0;var V=Nt.call(j,"constructor")&&j.constructor;return typeof V=="function"&&V instanceof V&&Vr.call(V)==ks}var Kr=et?Is(et):zs;function ji(P){return Li(P,eo(P))}function eo(P){return tt(P)?Vs(P,!0):Ws(P)}var Cc=Tt(function(P,j,V){Qe(P,j,V)});function Ic(P){return function(){return P}}function Zs(P){return P}function to(){return!1}t.exports=Cc}),bT=ee(function(t,e){var r=200,n="Expected a function",i="__lodash_hash_undefined__",s=1,a=2,c=1/0,o=9007199254740991,l=17976931348623157e292,u=0/0,h="[object Arguments]",S="[object Array]",p="[object Boolean]",C="[object Date]",T="[object Error]",E="[object Function]",I="[object GeneratorFunction]",x="[object Map]",q="[object Number]",m="[object Object]",b="[object Promise]",A="[object RegExp]",d="[object Set]",f="[object String]",_="[object Symbol]",y="[object WeakMap]",k="[object ArrayBuffer]",N="[object DataView]",D="[object Float32Array]",M="[object Float64Array]",L="[object Int8Array]",$="[object Int16Array]",G="[object Int32Array]",z="[object Uint8Array]",te="[object Uint8ClampedArray]",Z="[object Uint16Array]",ye="[object Uint32Array]",we=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,oe=/^\w*$/,ce=/^\./,Te=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ue=/[\\^$.*+?()[\]{}|]/g,mr=/^\s+|\s+$/g,qt=/\\(\\)?/g,gt=/^[-+]0x[0-9a-f]+$/i,at=/^0b[01]+$/i,Qt=/^\[object .+?Constructor\]$/,et=/^0o[0-7]+$/i,Xe=/^(?:0|[1-9]\d*)$/,le={};le[D]=le[M]=le[L]=le[$]=le[G]=le[z]=le[te]=le[Z]=le[ye]=!0,le[h]=le[S]=le[k]=le[p]=le[N]=le[C]=le[T]=le[E]=le[x]=le[q]=le[m]=le[A]=le[d]=le[f]=le[y]=!1;var Is=parseInt,Ci=typeof se=="object"&&se&&se.Object===Object&&se,Rs=typeof self=="object"&&self&&self.Object===Object&&self,Yt=Ci||Rs||Function("return this")(),Ii=e&&!e.nodeType&&e,Gr=Ii&&!0&&t&&!t.nodeType&&t,Hn=Gr&&Gr.exports===Ii,Vr=Hn&&Ci.process,Nt=function(){try{return Vr&&Vr.binding("util")}catch(v){}}(),zn=Nt&&Nt.isTypedArray;function Ri(v,O){for(var H=-1,X=v?v.length:0;++H<X;)if(O(v[H],H,v))return!0;return!1}function ks(v,O,H,X){for(var de=v.length,ne=H+(X?1:-1);X?ne--:++ne<de;)if(O(v[ne],ne,v))return ne;return-1}function Ps(v){return function(O){return O==null?void 0:O[v]}}function dn(v,O){for(var H=-1,X=Array(v);++H<v;)X[H]=O(H);return X}function ki(v){return function(O){return v(O)}}function Pi(v,O){return v==null?void 0:v[O]}function pn(v){var O=!1;if(v!=null&&typeof v.toString!="function")try{O=!!(v+"")}catch(H){}return O}function Ni(v){var O=-1,H=Array(v.size);return v.forEach(function(X,de){H[++O]=[de,X]}),H}function Oi(v,O){return function(H){return v(O(H))}}function Wn(v){var O=-1,H=Array(v.size);return v.forEach(function(X){H[++O]=X}),H}var Ns=Array.prototype,Jt=Function.prototype,gr=Object.prototype,hn=Yt["__core-js_shared__"],Kn=function(){var v=/[^.]+$/.exec(hn&&hn.keys&&hn.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),Mi=Jt.toString,Ot=gr.hasOwnProperty,Mt=gr.toString,Os=RegExp("^"+Mi.call(Ot).replace(Ue,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Zt=Yt.Symbol,Di=Yt.Uint8Array,Ms=gr.propertyIsEnumerable,Ds=Ns.splice,xs=Oi(Object.keys,Object),Ls=Math.max,Et=Fe(Yt,"DataView"),Hr=Fe(Yt,"Map"),Xn=Fe(Yt,"Promise"),Qn=Fe(Yt,"Set"),Yn=Fe(Yt,"WeakMap"),zr=Fe(Object,"create"),Or=V(Et),Bs=V(Hr),js=V(Xn),Us=V(Qn),Fs=V(Yn),fn=Zt?Zt.prototype:void 0,yt=fn?fn.valueOf:void 0,Jn=fn?fn.toString:void 0;function yr(v){var O=-1,H=v?v.length:0;for(this.clear();++O<H;){var X=v[O];this.set(X[0],X[1])}}function $s(){this.__data__=zr?zr(null):{}}function qs(v){return this.has(v)&&delete this.__data__[v]}function Gs(v){var O=this.__data__;if(zr){var H=O[v];return H===i?void 0:H}return Ot.call(O,v)?O[v]:void 0}function Vs(v){var O=this.__data__;return zr?O[v]!==void 0:Ot.call(O,v)}function Gt(v,O){var H=this.__data__;return H[v]=zr&&O===void 0?i:O,this}yr.prototype.clear=$s,yr.prototype.delete=qs,yr.prototype.get=Gs,yr.prototype.has=Vs,yr.prototype.set=Gt;function Vt(v){var O=-1,H=v?v.length:0;for(this.clear();++O<H;){var X=v[O];this.set(X[0],X[1])}}function mn(){this.__data__=[]}function Zn(v){var O=this.__data__,H=vn(O,v);if(H<0)return!1;var X=O.length-1;return H==X?O.pop():Ds.call(O,H,1),!0}function Hs(v){var O=this.__data__,H=vn(O,v);return H<0?void 0:O[H][1]}function gn(v){return vn(this.__data__,v)>-1}function xi(v,O){var H=this.__data__,X=vn(H,v);return X<0?H.push([v,O]):H[X][1]=O,this}Vt.prototype.clear=mn,Vt.prototype.delete=Zn,Vt.prototype.get=Hs,Vt.prototype.has=gn,Vt.prototype.set=xi;function Ht(v){var O=-1,H=v?v.length:0;for(this.clear();++O<H;){var X=v[O];this.set(X[0],X[1])}}function zs(){this.__data__={hash:new yr,map:new(Hr||Vt),string:new yr}}function Ws(v){return zt(this,v).delete(v)}function Qe(v){return zt(this,v).get(v)}function Ks(v){return zt(this,v).has(v)}function Xs(v,O){return zt(this,v).set(v,O),this}Ht.prototype.clear=zs,Ht.prototype.delete=Ws,Ht.prototype.get=Qe,Ht.prototype.has=Ks,Ht.prototype.set=Xs;function yn(v){var O=-1,H=v?v.length:0;for(this.__data__=new Ht;++O<H;)this.add(v[O])}function bn(v){return this.__data__.set(v,i),this}function dt(v){return this.__data__.has(v)}yn.prototype.add=yn.prototype.push=bn,yn.prototype.has=dt;function De(v){this.__data__=new Vt(v)}function Qs(){this.__data__=new Vt}function Li(v){return this.__data__.delete(v)}function Tt(v){return this.__data__.get(v)}function Bi(v){return this.__data__.has(v)}function Wr(v,O){var H=this.__data__;if(H instanceof Vt){var X=H.__data__;if(!Hr||X.length<r-1)return X.push([v,O]),this;H=this.__data__=new Ht(X)}return H.set(v,O),this}De.prototype.clear=Qs,De.prototype.delete=Li,De.prototype.get=Tt,De.prototype.has=Bi,De.prototype.set=Wr;function ei(v,O){var H=Re(v)||be(v)?dn(v.length,String):[],X=H.length,de=!!X;for(var ne in v)(O||Ot.call(v,ne))&&!(de&&(ne=="length"||Kr(ne,X)))&&H.push(ne);return H}function vn(v,O){for(var H=v.length;H--;)if(Be(v[H][0],O))return H;return-1}function ti(v,O){O=ji(O,v)?[O]:Ie(O);for(var H=0,X=O.length;v!=null&&H<X;)v=v[j(O[H++])];return H&&H==X?v:void 0}function wn(v){return Mt.call(v)}function Ys(v,O){return v!=null&&O in Object(v)}function ri(v,O,H,X,de){return v===O?!0:v==null||O==null||!Mr(v)&&!ii(O)?v!==v&&O!==O:Js(v,O,ri,H,X,de)}function Js(v,O,H,X,de,ne){var xe=Re(v),$e=Re(O),Ye=S,ot=S;xe||(Ye=rt(v),Ye=Ye==h?m:Ye),$e||(ot=rt(O),ot=ot==h?m:ot);var Ct=Ye==m&&!pn(v),xt=ot==m&&!pn(O),ct=Ye==ot;if(ct&&!Ct)return ne||(ne=new De),xe||Dg(v)?tt(v,O,H,X,de,ne):pt(v,O,Ye,H,X,de,ne);if(!(de&a)){var tr=Ct&&Ot.call(v,"__wrapped__"),rr=xt&&Ot.call(O,"__wrapped__");if(tr||rr){var En=tr?v.value():v,Xr=rr?O.value():O;return ne||(ne=new De),H(En,Xr,X,de,ne)}}return ct?(ne||(ne=new De),Dt(v,O,H,X,de,ne)):!1}function Sn(v,O,H,X){var de=H.length,ne=de,xe=!X;if(v==null)return!ne;for(v=Object(v);de--;){var $e=H[de];if(xe&&$e[2]?$e[1]!==v[$e[0]]:!($e[0]in v))return!1}for(;++de<ne;){$e=H[de];var Ye=$e[0],ot=v[Ye],Ct=$e[1];if(xe&&$e[2]){if(ot===void 0&&!(Ye in v))return!1}else{var xt=new De;if(X)var ct=X(ot,Ct,Ye,v,O,xt);if(!(ct===void 0?ri(Ct,ot,X,s|a,xt):ct))return!1}}return!0}function g(v){if(!Mr(v)||Cc(v))return!1;var O=_n(v)||pn(v)?Os:Qt;return O.test(V(v))}function w(v){return ii(v)&&ni(v.length)&&!!le[Mt.call(v)]}function R(v){return typeof v=="function"?v:v==null?$g:typeof v=="object"?Re(v)?K(v[0],v[1]):W(v):qg(v)}function B(v){if(!Ic(v))return xs(v);var O=[];for(var H in Object(v))Ot.call(v,H)&&H!="constructor"&&O.push(H);return O}function W(v){var O=bt(v);return O.length==1&&O[0][2]?to(O[0][0],O[0][1]):function(H){return H===v||Sn(H,v,O)}}function K(v,O){return ji(v)&&Zs(O)?to(j(v),O):function(H){var X=Ug(H,v);return X===void 0&&X===O?Fg(H,v):ri(O,X,void 0,s|a)}}function Y(v){return function(O){return ti(O,v)}}function J(v){if(typeof v=="string")return v;if(ro(v))return Jn?Jn.call(v):"";var O=v+"";return O=="0"&&1/v==-c?"-0":O}function Ie(v){return Re(v)?v:P(v)}function Ve(v){return function(O,H,X){var de=Object(O);if(!vt(O)){var ne=R(H);O=no(O),H=function($e){return ne(de[$e],$e,de)}}var xe=v(O,H,X);return xe>-1?de[ne?O[xe]:xe]:void 0}}function tt(v,O,H,X,de,ne){var xe=de&a,$e=v.length,Ye=O.length;if($e!=Ye&&!(xe&&Ye>$e))return!1;var ot=ne.get(v);if(ot&&ne.get(O))return ot==O;var Ct=-1,xt=!0,ct=de&s?new yn:void 0;for(ne.set(v,O),ne.set(O,v);++Ct<$e;){var tr=v[Ct],rr=O[Ct];if(X)var En=xe?X(rr,tr,Ct,O,v,ne):X(tr,rr,Ct,v,O,ne);if(En!==void 0){if(En)continue;xt=!1;break}if(ct){if(!Ri(O,function(Xr,si){if(!ct.has(si)&&(tr===Xr||H(tr,Xr,X,de,ne)))return ct.add(si)})){xt=!1;break}}else if(!(tr===rr||H(tr,rr,X,de,ne))){xt=!1;break}}return ne.delete(v),ne.delete(O),xt}function pt(v,O,H,X,de,ne,xe){switch(H){case N:if(v.byteLength!=O.byteLength||v.byteOffset!=O.byteOffset)return!1;v=v.buffer,O=O.buffer;case k:return!(v.byteLength!=O.byteLength||!X(new Di(v),new Di(O)));case p:case C:case q:return Be(+v,+O);case T:return v.name==O.name&&v.message==O.message;case A:case f:return v==O+"";case x:var $e=Ni;case d:var Ye=ne&a;if($e||($e=Wn),v.size!=O.size&&!Ye)return!1;var ot=xe.get(v);if(ot)return ot==O;ne|=s,xe.set(v,O);var Ct=tt($e(v),$e(O),X,de,ne,xe);return xe.delete(v),Ct;case _:if(yt)return yt.call(v)==yt.call(O)}return!1}function Dt(v,O,H,X,de,ne){var xe=de&a,$e=no(v),Ye=$e.length,ot=no(O),Ct=ot.length;if(Ye!=Ct&&!xe)return!1;for(var xt=Ye;xt--;){var ct=$e[xt];if(!(xe?ct in O:Ot.call(O,ct)))return!1}var tr=ne.get(v);if(tr&&ne.get(O))return tr==O;var rr=!0;ne.set(v,O),ne.set(O,v);for(var En=xe;++xt<Ye;){ct=$e[xt];var Xr=v[ct],si=O[ct];if(X)var id=xe?X(si,Xr,ct,O,v,ne):X(Xr,si,ct,v,O,ne);if(!(id===void 0?Xr===si||H(Xr,si,X,de,ne):id)){rr=!1;break}En||(En=ct=="constructor")}if(rr&&!En){var io=v.constructor,so=O.constructor;io!=so&&"constructor"in v&&"constructor"in O&&!(typeof io=="function"&&io instanceof io&&typeof so=="function"&&so instanceof so)&&(rr=!1)}return ne.delete(v),ne.delete(O),rr}function zt(v,O){var H=v.__data__;return eo(O)?H[typeof O=="string"?"string":"hash"]:H.map}function bt(v){for(var O=no(v),H=O.length;H--;){var X=O[H],de=v[X];O[H]=[X,de,Zs(de)]}return O}function Fe(v,O){var H=Pi(v,O);return g(H)?H:void 0}var rt=wn;(Et&&rt(new Et(new ArrayBuffer(1)))!=N||Hr&&rt(new Hr)!=x||Xn&&rt(Xn.resolve())!=b||Qn&&rt(new Qn)!=d||Yn&&rt(new Yn)!=y)&&(rt=function(v){var O=Mt.call(v),H=O==m?v.constructor:void 0,X=H?V(H):void 0;if(X)switch(X){case Or:return N;case Bs:return x;case js:return b;case Us:return d;case Fs:return y}return O});function er(v,O,H){O=ji(O,v)?[O]:Ie(O);for(var X,de=-1,ne=O.length;++de<ne;){var xe=j(O[de]);if(!(X=v!=null&&H(v,xe)))break;v=v[xe]}if(X)return X;var ne=v?v.length:0;return!!ne&&ni(ne)&&Kr(xe,ne)&&(Re(v)||be(v))}function Kr(v,O){return O=O??o,!!O&&(typeof v=="number"||Xe.test(v))&&(v>-1&&v%1==0)&&v<O}function ji(v,O){if(Re(v))return!1;var H=typeof v;return H=="number"||H=="symbol"||H=="boolean"||v==null||ro(v)?!0:oe.test(v)||!we.test(v)||O!=null&&v in Object(O)}function eo(v){var O=typeof v;return O=="string"||O=="number"||O=="symbol"||O=="boolean"?v!=="__proto__":v===null}function Cc(v){return!!Kn&&Kn in v}function Ic(v){var O=v&&v.constructor,H=typeof O=="function"&&O.prototype||gr;return v===H}function Zs(v){return v===v&&!Mr(v)}function to(v,O){return function(H){return H==null?!1:H[v]===O&&(O!==void 0||v in Object(H))}}var P=Ne(function(v){v=jg(v);var O=[];return ce.test(v)&&O.push(""),v.replace(Te,function(H,X,de,ne){O.push(de?ne.replace(qt,"$1"):X||H)}),O});function j(v){if(typeof v=="string"||ro(v))return v;var O=v+"";return O=="0"&&1/v==-c?"-0":O}function V(v){if(v!=null){try{return Mi.call(v)}catch(O){}try{return v+""}catch(O){}}return""}function re(v,O,H){var X=v?v.length:0;if(!X)return-1;var de=H==null?0:Lg(H);return de<0&&(de=Ls(X+de,0)),ks(v,R(O),de)}var Se=Ve(re);function Ne(v,O){if(typeof v!="function"||O&&typeof O!="function")throw new TypeError(n);var H=function(){var X=arguments,de=O?O.apply(this,X):X[0],ne=H.cache;if(ne.has(de))return ne.get(de);var xe=v.apply(this,X);return H.cache=ne.set(de,xe),xe};return H.cache=new(Ne.Cache||Ht),H}Ne.Cache=Ht;function Be(v,O){return v===O||v!==v&&O!==O}function be(v){return At(v)&&Ot.call(v,"callee")&&(!Ms.call(v,"callee")||Mt.call(v)==h)}var Re=Array.isArray;function vt(v){return v!=null&&ni(v.length)&&!_n(v)}function At(v){return ii(v)&&vt(v)}function _n(v){var O=Mr(v)?Mt.call(v):"";return O==E||O==I}function ni(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=o}function Mr(v){var O=typeof v;return!!v&&(O=="object"||O=="function")}function ii(v){return!!v&&typeof v=="object"}function ro(v){return typeof v=="symbol"||ii(v)&&Mt.call(v)==_}var Dg=zn?ki(zn):w;function xg(v){if(!v)return v===0?v:0;if(v=Bg(v),v===c||v===-c){var O=v<0?-1:1;return O*l}return v===v?v:0}function Lg(v){var O=xg(v),H=O%1;return O===O?H?O-H:O:0}function Bg(v){if(typeof v=="number")return v;if(ro(v))return u;if(Mr(v)){var O=typeof v.valueOf=="function"?v.valueOf():v;v=Mr(O)?O+"":O}if(typeof v!="string")return v===0?v:+v;v=v.replace(mr,"");var H=at.test(v);return H||et.test(v)?Is(v.slice(2),H?2:8):gt.test(v)?u:+v}function jg(v){return v==null?"":J(v)}function Ug(v,O,H){var X=v==null?void 0:ti(v,O);return X===void 0?H:X}function Fg(v,O){return v!=null&&er(v,O,Ys)}function no(v){return vt(v)?ei(v):B(v)}function $g(v){return v}function qg(v){return ji(v)?Ps(j(v)):Y(v)}t.exports=Se}),vT="[object Symbol]",wT=Object.prototype,ST=wT.toString;function _T(t,e,r){for(var n=-1,i=t.length;++n<i;){var s=t[n],a=e(s);if(a!=null&&(c===void 0?a===a&&!AT(a):r(a,c)))var c=a,o=s}return o}function ET(t,e){return t>e}function TT(t){return!!t&&typeof t=="object"}function AT(t){return typeof t=="symbol"||TT(t)&&ST.call(t)==vT}function CT(t){return t}function IT(t){return t&&t.length?_T(t,CT,ET):void 0}var RT=IT,kT=128,PT=8,NT={0:"Reserved",1:"Interface local",2:"Link local",4:"Admin local",5:"Site local",8:"Organization local",14:"Global",15:"Reserved"},OT={"ff01::1/128":"Multicast (All nodes on this interface)","ff01::2/128":"Multicast (All routers on this interface)","ff02::1/128":"Multicast (All nodes on this link)","ff02::2/128":"Multicast (All routers on this link)","ff05::2/128":"Multicast (All routers in this site)","ff02::5/128":"Multicast (OSPFv3 AllSPF routers)","ff02::6/128":"Multicast (OSPFv3 AllDR routers)","ff02::9/128":"Multicast (RIP routers)","ff02::a/128":"Multicast (EIGRP routers)","ff02::d/128":"Multicast (PIM routers)","ff02::16/128":"Multicast (MLDv2 reports)","ff01::fb/128":"Multicast (mDNSv6)","ff02::fb/128":"Multicast (mDNSv6)","ff05::fb/128":"Multicast (mDNSv6)","ff02::1:2/128":"Multicast (All DHCP servers and relay agents on this link)","ff05::1:2/128":"Multicast (All DHCP servers and relay agents in this site)","ff02::1:3/128":"Multicast (All DHCP servers on this link)","ff05::1:3/128":"Multicast (All DHCP servers in this site)","::/128":"Unspecified","::1/128":"Loopback","ff00::/8":"Multicast","fe80::/10":"Link-local unicast"},MT=/([^0-9a-f:\/%])/ig,DT=/([0-9a-f]{5,}|:{3,}|[^:]:$|^:[^:]|\/$)/ig,xT=/\/\d{1,3}(?=%|$)/,LT=/%.*$/,BT=new RegExp(/^\[{0,1}([0-9a-f:]+)\]{0,1}/),jT=new RegExp(/\[([0-9a-f:]+)\]:([0-9]{1,5})/),Ge={BITS:kT,GROUPS:PT,SCOPES:NT,TYPES:OT,RE_BAD_CHARACTERS:MT,RE_BAD_ADDRESS:DT,RE_SUBNET_STRING:xT,RE_ZONE_STRING:LT,RE_URL:BT,RE_URL_WITH_PORT:jT},UT=function(){return this.valid},FT=Cr.isInSubnet,$T=Cr.isCorrect(Ge.BITS),qT=Cr.falseIfInvalid(function(){return this.addressMinusSuffix===this.canonicalForm()}),GT=Cr.falseIfInvalid(function(){return this.getBitsBase2(0,64)==="1111111010000000000000000000000000000000000000000000000000000000"}),VT=Cr.falseIfInvalid(function(){return this.getType()==="Multicast"}),HT=Cr.falseIfInvalid(function(){return this.v4}),zT=Cr.falseIfInvalid(function(){return this.isInSubnet(new this.constructor("2001::/32"))}),WT=Cr.falseIfInvalid(function(){return this.isInSubnet(new this.constructor("2002::/16"))}),KT=Cr.falseIfInvalid(function(){return this.getType()==="Loopback"}),XT={isValid:UT,isInSubnet:FT,isCorrect:$T,isCanonical:qT,isLinkLocal:GT,isMulticast:VT,is4:HT,isTeredo:zT,is6to4:WT,isLoopback:KT},qo=ee(function(t,e){var r=Aa.sprintf,n=e.spanAllZeroes=function(s){return s.replace(/(0+)/g,'<span class="zero">$1</span>')};e.spanAll=function(s,a){a===void 0&&(a=0);var c=s.split("");return c.map(function(o,l){return r('<span class="digit value-%s position-%d">%s</span>',o,l+a,n(o))}).join("")};function i(s){return s.replace(/^(0+)/,'<span class="zero">$1</span>')}e.spanLeadingZeroes=function(s){var a=s.split(":");return a.map(function(c){return i(c)}).join(":")},e.simpleGroup=function(s,a){var c=s.split(":");return a||(a=0),c.map(function(o,l){return/group-v4/.test(o)?o:r('<span class="hover-group group-%d">%s</span>',l+a,i(o))}).join(":")}}),fi=Aa.sprintf,QT=function(t){return t===void 0?t="":t=fi(":%s",t),fi("http://[%s]%s/",this.correctForm(),t)},YT=function(t){t||(t={}),t.className===void 0&&(t.className=""),t.prefix===void 0&&(t.prefix="/#address="),t.v4===void 0&&(t.v4=!1);var e=this.correctForm;return t.v4&&(e=this.to4in6),t.className?fi('<a href="%1$s%2$s" class="%3$s">%2$s</a>',t.prefix,e.call(this),t.className):fi('<a href="%1$s%2$s">%2$s</a>',t.prefix,e.call(this))},JT=function(){var t=this.address.match(kt.RE_ADDRESS),e;if(t){var r=t[0].split(".");this.address=this.address.replace(kt.RE_ADDRESS,fi('<span class="hover-group group-v4 group-6">%s</span>.<span class="hover-group group-v4 group-7">%s</span>',r.slice(0,2).join("."),r.slice(2,4).join(".")))}if(this.elidedGroups===0)return qo.simpleGroup(this.address);var n=[],i=this.address.split("::");i[0].length?n.push(qo.simpleGroup(i[0])):n.push("");var s=["hover-group"];for(e=this.elisionBegin;e<this.elisionBegin+this.elidedGroups;e++)s.push(fi("group-%d",e));return n.push(fi('<span class="%s"></span>',s.join(" "))),i[1].length?n.push(qo.simpleGroup(i[1],this.elisionEnd)):n.push(""),n.join(":")},ZT={href:QT,link:YT,group:JT},rs=Aa.sprintf;function Vl(t){return rs("(%s)",t.join("|"))}function Hl(t){return t.length<4?rs("0{0,%d}%s",4-t.length,t):t}var mf="[^A-Fa-f0-9:]";function zl(t){var e=[];t.forEach(function(n,i){var s=parseInt(n,16);s===0&&e.push(i)});var r=e.map(function(n){return t.map(function(i,s){if(s===n){var a=s===0||s===Ge.GROUPS-1?":":"";return Vl([Hl(i),a])}return Hl(i)}).join(":")});return r.push(t.map(Hl).join(":")),Vl(r)}function gf(t,e,r){var n=e?"":":",i=r?"":":",s=[];!e&&!r&&s.push("::"),e&&r&&s.push(""),(r&&!e||!r&&e)&&s.push(":"),s.push(rs("%s(:0{1,4}){1,%d}",n,t-1)),s.push(rs("(0{1,4}:){1,%d}%s",t-1,i)),s.push(rs("(0{1,4}:){%d}0{1,4}",t-1));for(var a=1;a<t-1;a++)for(var c=1;c<t-a;c++)s.push(rs("(0{1,4}:){%d}:(0{1,4}:){%d}0{1,4}",c,t-c-a-1));return Vl(s)}var eA=function(t){t===void 0&&(t=!1);var e=[],r=new this.constructor(this.correctForm());if(r.elidedGroups===0)e.push(zl(r.parsedAddress));else if(r.elidedGroups===Ge.GROUPS)e.push(gf(Ge.GROUPS));else{var n=r.address.split("::");n[0].length&&e.push(zl(n[0].split(":"))),e.push(gf(r.elidedGroups,n[0].length!==0,n[1].length!==0)),n[1].length&&e.push(zl(n[1].split(":"))),e=[e.join(":")]}return t||(e=[].concat("(?=^|",mf,"|[^\\w\\:])(",e,")(?=[^\\w\\:]|",mf,"|$)")),e.join("")},tA=function(t){return new RegExp(this.regularExpressionString(t),"i")},rA={regularExpressionString:eA,regularExpression:tA},Pt=Gh.BigInteger,tn=Aa.sprintf;function nA(t){for(var e=/(\d+)(\d{3})/;e.test(t);)t=t.replace(e,"$1,$2");return t}function iA(t){return t=t.replace(/^(0{1,})([1-9]+)$/,'<span class="parse-error">$1</span>$2'),t=t.replace(/^(0{1,})(0)$/,'<span class="parse-error">$1</span>$2'),t}function ue(t,e){e===void 0?this.groups=Ge.GROUPS:this.groups=e,this.v4=!1,this.subnet="/128",this.subnetMask=128,this.zone="",this.address=t;var r=Ge.RE_SUBNET_STRING.exec(t);if(r){if(this.parsedSubnet=r[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,isNaN(this.subnetMask)||this.subnetMask<0||this.subnetMask>Ge.BITS){this.valid=!1,this.error="Invalid subnet mask.";return}t=t.replace(Ge.RE_SUBNET_STRING,"")}else if(/\//.test(t)){this.valid=!1,this.error="Invalid subnet mask.";return}var n=Ge.RE_ZONE_STRING.exec(t);n&&(this.zone=n[0],t=t.replace(Ge.RE_ZONE_STRING,"")),this.addressMinusSuffix=t,this.parsedAddress=this.parse(this.addressMinusSuffix)}Gl(ue.prototype,XT),Gl(ue.prototype,ZT),Gl(ue.prototype,rA),ue.fromBigInteger=function(t){var e=Ca(t.toString(16),32,"0"),r=[],n;for(n=0;n<Ge.GROUPS;n++)r.push(e.slice(n*4,(n+1)*4));return new ue(r.join(":"))},ue.fromURL=function(t){var e,r,n;if(t.indexOf("[")!==-1&&t.indexOf("]:")!==-1){if(n=Ge.RE_URL_WITH_PORT.exec(t),n===null)return{error:"failed to parse address with port",address:null,port:null};e=n[1],r=n[2]}else if(t.indexOf("/")!==-1){if(t=t.replace(/^[a-z0-9]+:\/\//,""),n=Ge.RE_URL.exec(t),n===null)return{error:"failed to parse address from URL",address:null,port:null};e=n[1]}else e=t;return r?(r=parseInt(r,10),(r<0||r>65536)&&(r=null)):r=null,{address:new ue(e),port:r}},ue.fromAddress4=function(t){var t=new hi(t),e=Ge.BITS-(kt.BITS-t.subnetMask);return new ue("::ffff:"+t.correctForm()+"/"+e)},ue.fromArpa=function(t){var e=t.replace(/(\.ip6\.arpa)?\.$/,""),r=7;if(e.length!==63)return e={error:"Not Valid 'ip6.arpa' form",address:null},e;e=e.split(".").reverse();for(var n=r;n>0;n--){var i=n*4;e.splice(i,0,":")}return e=e.join(""),new ue(e)};function sA(t,e){var r=[],n=[],i;for(i=0;i<t.length;i++)i<e[0]?r.push(t[i]):i>e[1]&&n.push(t[i]);return r.concat(["compact"]).concat(n)}ue.prototype.microsoftTranscription=function(){return tn("%s.ipv6-literal.net",this.correctForm().replace(/:/g,"-"))},ue.prototype.mask=function(t){return t===void 0&&(t=this.subnetMask),this.getBitsBase2(0,t)},ue.prototype.possibleSubnets=function(t){t===void 0&&(t=128);var e=Ge.BITS-this.subnetMask,r=Math.abs(t-Ge.BITS),n=e-r;return n<0?"0":nA(new Pt("2",10).pow(n).toString(10))},ue.prototype._startAddress=function(){return new Pt(this.mask()+Fo("0",Ge.BITS-this.subnetMask),2)},ue.prototype.startAddress=function(){return ue.fromBigInteger(this._startAddress())},ue.prototype.startAddressExclusive=function(){var t=new Pt("1");return ue.fromBigInteger(this._startAddress().add(t))},ue.prototype._endAddress=function(){return new Pt(this.mask()+Fo("1",Ge.BITS-this.subnetMask),2)},ue.prototype.endAddress=function(){return ue.fromBigInteger(this._endAddress())},ue.prototype.endAddressExclusive=function(){var t=new Pt("1");return ue.fromBigInteger(this._endAddress().subtract(t))},ue.prototype.getScope=function(){var t=Ge.SCOPES[this.getBits(12,16)];return this.getType()==="Global unicast"&&t!=="Link local"&&(t="Global"),t},ue.prototype.getType=function(){var t=this;function e(r,n){return t.isInSubnet(new ue(n))}return bT(Ge.TYPES,e)||"Global unicast"},ue.prototype.getBits=function(t,e){return new Pt(this.getBitsBase2(t,e),2)},ue.prototype.getBitsBase2=function(t,e){return this.binaryZeroPad().slice(t,e)},ue.prototype.getBitsBase16=function(t,e){var r=e-t;return r%4!==0?null:Ca(this.getBits(t,e).toString(16),r/4,"0")},ue.prototype.getBitsPastSubnet=function(){return this.getBitsBase2(this.subnetMask,Ge.BITS)},ue.prototype.reverseForm=function(t){t||(t={});var e=Math.floor(this.subnetMask/4),r=this.canonicalForm().replace(/:/g,"").split("").slice(0,e).reverse().join(".");return e>0?t.omitSuffix?r:tn("%s.ip6.arpa.",r):t.omitSuffix?"":"ip6.arpa."},ue.prototype.correctForm=function(){if(!this.parsedAddress)return null;var t,e=[],r=0,n=[];for(t=0;t<this.parsedAddress.length;t++){var i=parseInt(this.parsedAddress[t],16);i===0&&r++,i!==0&&r>0&&(r>1&&n.push([t-r,t-1]),r=0)}r>1&&n.push([this.parsedAddress.length-r,this.parsedAddress.length-1]);var s=n.map(function(o){return o[1]-o[0]+1});if(n.length>0){var a=s.indexOf(RT(s));e=sA(this.parsedAddress,n[a])}else e=this.parsedAddress;for(t=0;t<e.length;t++)e[t]!=="compact"&&(e[t]=parseInt(e[t],16).toString(16));var c=e.join(":");return c=c.replace(/^compact$/,"::"),c=c.replace(/^compact|compact$/,":"),c=c.replace(/compact/,""),c},ue.prototype.binaryZeroPad=function(){return Ca(this.bigInteger().toString(2),Ge.BITS,"0")},ue.prototype.parse4in6=function(t){var e=t.split(":"),r=e.slice(-1)[0],n=r.match(kt.RE_ADDRESS);if(n){for(var i=new hi(n[0]),s=0;s<i.groups;s++)if(/^0[0-9]+/.test(i.parsedAddress[s]))return this.valid=!1,this.error="IPv4 addresses can not have leading zeroes.",this.parseError=t.replace(kt.RE_ADDRESS,i.parsedAddress.map(iA).join(".")),null;this.v4=!0,e[e.length-1]=i.toGroup6(),t=e.join(":")}return t},ue.prototype.parse=function(t){if(t=this.parse4in6(t),this.error)return null;var e=t.match(Ge.RE_BAD_CHARACTERS);if(e)return this.valid=!1,this.error=tn("Bad character%s detected in address: %s",e.length>1?"s":"",e.join("")),this.parseError=t.replace(Ge.RE_BAD_CHARACTERS,'<span class="parse-error">$1</span>'),null;var r=t.match(Ge.RE_BAD_ADDRESS);if(r)return this.valid=!1,this.error=tn("Address failed regex: %s",r.join("")),this.parseError=t.replace(Ge.RE_BAD_ADDRESS,'<span class="parse-error">$1</span>'),null;var n=[],i=t.split("::");if(i.length===2){var s=i[0].split(":"),a=i[1].split(":");s.length===1&&s[0]===""&&(s=[]),a.length===1&&a[0]===""&&(a=[]);var c=this.groups-(s.length+a.length);if(!c)return this.valid=!1,this.error="Error parsing groups",null;this.elidedGroups=c,this.elisionBegin=s.length,this.elisionEnd=s.length+this.elidedGroups,s.forEach(function(l){n.push(l)});for(var o=0;o<c;o++)n.push(0);a.forEach(function(l){n.push(l)})}else if(i.length===1)n=t.split(":"),this.elidedGroups=0;else return this.valid=!1,this.error="Too many :: groups found",null;return n=n.map(function(l){return tn("%x",parseInt(l,16))}),n.length!==this.groups?(this.valid=!1,this.error="Incorrect number of groups found",null):(this.valid=!0,n)};function yf(t){return tn("%04x",parseInt(t,16))}ue.prototype.canonicalForm=function(){return this.valid?this.parsedAddress.map(yf).join(":"):null},ue.prototype.decimal=function(){return this.valid?this.parsedAddress.map(function(t){return tn("%05d",parseInt(t,16))}).join(":"):null},ue.prototype.bigInteger=function(){return this.valid?new Pt(this.parsedAddress.map(yf).join(""),16):null},ue.prototype.to4=function(){var t=this.binaryZeroPad().split("");return hi.fromHex(new Pt(t.slice(96,128).join(""),2).toString(16))},ue.prototype.to4in6=function(){var t=this.to4(),e=new ue(this.parsedAddress.slice(0,6).join(":"),6),r=e.correctForm(),n="";return/:$/.test(r)||(n=":"),e.correctForm()+n+t.address},ue.prototype.inspectTeredo=function(){var t=this.getBitsBase16(0,32),e=this.getBits(80,96).xor(new Pt("ffff",16)).toString(),r=hi.fromHex(this.getBitsBase16(32,64)),n=hi.fromHex(this.getBits(96,128).xor(new Pt("ffffffff",16)).toString(16)),i=this.getBits(64,80),s=this.getBitsBase2(64,80),a=i.testBit(15),c=i.testBit(14),o=i.testBit(8),l=i.testBit(9),u=new Pt(s.slice(2,6)+s.slice(8,16),2).toString(10);return{prefix:tn("%s:%s",t.slice(0,4),t.slice(4,8)),server4:r.address,client4:n.address,flags:s,coneNat:a,microsoft:{reserved:c,universalLocal:l,groupIndividual:o,nonce:u},udpPort:e}},ue.prototype.inspect6to4=function(){var t=this.getBitsBase16(0,16),e=hi.fromHex(this.getBitsBase16(16,48));return{prefix:tn("%s",t.slice(0,4)),gateway:e.address}},ue.prototype.to6to4=function(){if(!this.is4())return null;var t=["2002",this.getBitsBase16(96,112),this.getBitsBase16(112,128),"","/16"].join(":");return new ue(t)},ue.prototype.toByteArray=function(){var t=this.bigInteger().toByteArray();return t.length===17&&t[0]===0?t.slice(1):t};function bf(t){return t&255}ue.prototype.toUnsignedByteArray=function(){return this.toByteArray().map(bf)},ue.fromByteArray=function(t){return this.fromUnsignedByteArray(t.map(bf))},ue.fromUnsignedByteArray=function(t){for(var e=new Pt("256",10),r=new Pt("0",10),n=new Pt("1",10),i=t.length-1;i>=0;i--)r=r.add(n.multiply(new Pt(t[i].toString(10),10))),n=n.multiply(e);return ue.fromBigInteger(r)};var aA=ue,oA=hi,cA=aA,lA={helpers:qo},vf={Address4:oA,Address6:cA,v6:lA};const{Address4:uA,Address6:dA}=vf,Go={ERR_INVALID_IP_PARAMETER:"ERR_INVALID_IP_PARAMETER",ERR_INVALID_PORT_PARAMETER:"ERR_INVALID_PORT_PARAMETER",ERR_INVALID_IP:"ERR_INVALID_IP"};function pA(t,e){if(typeof t!="string")throw F(new Error(`invalid ip provided: ${t}`),Go.ERR_INVALID_IP_PARAMETER);if(e=parseInt(e),isNaN(e))throw F(new Error(`invalid port provided: ${e}`),Go.ERR_INVALID_PORT_PARAMETER);if(new uA(t).isValid())return Rt(`/ip4/${t}/tcp/${e}`);const r=new dA(t);if(r.isValid())return r.is4()?Rt(`/ip4/${r.to4().correctForm()}/tcp/${e}`):Rt(`/ip6/${t}/tcp/${e}`);throw F(new Error(`invalid ip:port for creating a multiaddr: ${t}:${e}`),Go.ERR_INVALID_IP)}var Ra=pA,hA=Go;Ra.Errors=hA;const{CLOSE_TIMEOUT:fA}=qh,Wl=Q("libp2p:websockets:socket");Wl.error=Q("libp2p:websockets:socket:error");var wf=(t,e={})=>{const r={async sink(n){e.signal&&(n=nt(n,e.signal));try{await t.sink(async function*(){for await(const i of n)yield i instanceof Uint8Array?i:i.slice()}())}catch(i){i.type!=="aborted"&&Wl.error(i)}},source:e.signal?nt(t.source,e.signal):t.source,conn:t,localAddr:e.localAddr||(t.localAddress&&t.localPort?Ra(t.localAddress,t.localPort):void 0),remoteAddr:e.remoteAddr||Ra(t.remoteAddress,t.remotePort),timeline:{open:Date.now()},async close(){const n=Date.now();try{await Zg(t.close(),fA)}catch(i){const{host:s,port:a}=r.remoteAddr.toOptions();Wl("timeout closing stream to %s:%s after %dms, destroying it manually",s,a,Date.now()-n),t.destroy()}finally{r.timeline.close=Date.now()}}};return t.socket.once&&t.socket.once("close",()=>{r.timeline.close||(r.timeline.close=Date.now())}),r};const{createServer:mA}=Q_,Vo=Q("libp2p:websockets:listener");Vo.error=Q("libp2p:websockets:listener:error");var gA=({handler:t,upgrader:e},r={})=>{const n=new It,i=mA(r,async a=>{let c,o;try{c=wf(a),Vo("new inbound connection %s",c.remoteAddr),o=await e.upgradeInbound(c)}catch(l){return Vo.error("inbound connection failed to upgrade",l),c&&c.close()}Vo("inbound connection %s upgraded",c.remoteAddr),yA(i,c),t&&t(o),n.emit("connection",o)});i.on("listening",()=>n.emit("listening")).on("error",a=>n.emit("error",a)).on("close",()=>n.emit("close")),i.__connections=[];let s;return n.close=()=>(i.__connections.forEach(a=>a.close()),i.close()),n.listen=a=>(s=a,i.listen(a.toOptions())),n.getAddrs=()=>{const a=[],c=i.address();if(!c)throw new Error("Listener is not ready yet");const o=s.getPeerId();if(s.toString().indexOf("ip4")!==-1){let l=s.decapsulate("tcp");if(l=l.encapsulate("/tcp/"+c.port+"/ws"),s.getPeerId()&&(l=l.encapsulate("/p2p/"+o)),l.toString().indexOf("0.0.0.0")!==-1){const u=ad.networkInterfaces();Object.keys(u).forEach(h=>{u[h].forEach(S=>{S.family==="IPv4"&&a.push(X_(l.toString().replace("0.0.0.0",S.address)))})})}else a.push(l)}return a},n};function yA(t,e){t.__connections.push(e)}const bA=Wt,Kl=Wt.v4,Sf=Wt.v6,_f=function(t,e,r){r=~~r;var n;if(Kl(t))n=e||new Uint8Array(r+4),t.split(/\./g).map(function(u){n[r++]=parseInt(u,10)&255});else if(Sf(t)){var i=t.split(":",8),s;for(s=0;s<i.length;s++){var a=Kl(i[s]),c;a&&(c=_f(i[s]),i[s]=ae(c.slice(0,2),"base16")),c&&++s<8&&i.splice(s,0,ae(c.slice(2,4),"base16"))}if(i[0]==="")for(;i.length<8;)i.unshift("0");else if(i[i.length-1]==="")for(;i.length<8;)i.push("0");else if(i.length<8){for(s=0;s<i.length&&i[s]!=="";s++);var o=[s,"1"];for(s=9-i.length;s>0;s--)o.push("0");i.splice.apply(i,o)}for(n=e||new Uint8Array(r+16),s=0;s<i.length;s++){var l=parseInt(i[s],16);n[r++]=l>>8&255,n[r++]=l&255}}if(!n)throw Error("Invalid ip address: "+t);return n},vA=function(t,e,r){e=~~e,r=r||t.length-e;var n=[],i;const s=new DataView(t.buffer);if(r===4){for(let a=0;a<r;a++)n.push(t[e+a]);i=n.join(".")}else if(r===16){for(let a=0;a<r;a+=2)n.push(s.getUint16(e+a).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i};var Ho={isIP:bA,isV4:Kl,isV6:Sf,toBytes:_f,toString:vA};function $t(t){if(typeof t=="number"){if($t.codes[t])return $t.codes[t];throw new Error("no protocol with code: "+t)}else if(typeof t=="string"||t instanceof String){if($t.names[t])return $t.names[t];throw new Error("no protocol with name: "+t)}throw new Error("invalid protocol id type: "+t)}const pr=-1;$t.lengthPrefixedVarSize=pr,$t.V=pr,$t.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,pr,"ip6zone"],[53,pr,"dns","resolvable"],[54,pr,"dns4","resolvable"],[55,pr,"dns6","resolvable"],[56,pr,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,pr,"unix",!1,"path"],[421,pr,"ipfs"],[421,pr,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,pr,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,pr,"memory"]],$t.names={},$t.codes={},$t.table.map(t=>{const e=Ef.apply(null,t);$t.codes[e.code]=e,$t.names[e.name]=e}),$t.object=Ef;function Ef(t,e,r,n,i){return{code:t,size:e,name:r,resolvable:Boolean(n),path:Boolean(i)}}var Ur=$t,Tf=ka;function ka(t,e){return e instanceof Uint8Array?ka.toString(t,e):ka.toBytes(t,e)}ka.toString=function(e,r){e=Ur(e);switch(e.code){case 4:case 41:return wA(r);case 6:case 273:case 33:case 132:return Cf(r);case 53:case 54:case 55:case 56:case 400:case 777:return _A(r);case 421:return TA(r);case 444:return If(r);case 445:return If(r);default:return ae(r,"base16")}},ka.toBytes=function(e,r){e=Ur(e);switch(e.code){case 4:return Af(r);case 41:return Af(r);case 6:case 273:case 33:case 132:return Xl(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return SA(r);case 421:return EA(r);case 444:return AA(r);case 445:return CA(r);default:return qe(r,"base16")}};function Af(t){if(!Ho.isIP(t))throw new Error("invalid ip address");return Ho.toBytes(t)}function wA(t){const e=Ho.toString(t);if(!e||!Ho.isIP(e))throw new Error("invalid ip address");return e}function Xl(t){const e=new ArrayBuffer(2),r=new DataView(e);return r.setUint16(0,t),new Uint8Array(e)}function Cf(t){const e=new DataView(t.buffer);return e.getUint16(0)}function SA(t){const e=qe(t),r=Uint8Array.from(ie.encode(e.length));return Oe([r,e],r.length+e.length)}function _A(t){const e=ie.decode(t);if(t=t.slice(ie.decode.bytes),t.length!==e)throw new Error("inconsistent lengths");return ae(t)}function EA(t){const e=new Qr(t).multihash,r=Uint8Array.from(ie.encode(e.length));return Oe([r,e],r.length+e.length)}function TA(t){const e=ie.decode(t),r=t.slice(ie.decode.bytes);if(r.length!==e)throw new Error("inconsistent lengths");return ae(r,"base58btc")}function AA(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==16)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion address.");const r=Tn.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Xl(n);return Oe([r,i],r.length+i.length)}function CA(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==56)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion3 address.");const r=Tn.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Xl(n);return Oe([r,i],r.length+i.length)}function If(t){const e=t.slice(0,t.length-2),r=t.slice(t.length-2),n=ae(e,"base32"),i=Cf(r);return n+":"+i}var Ir={stringToStringTuples:Rf,stringTuplesToString:kf,tuplesToStringTuples:Nf,stringTuplesToTuples:Pf,bytesToTuples:Ql,tuplesToBytes:Of,bytesToString:IA,stringToBytes:Df,fromString:RA,fromBytes:xf,validateBytes:Yl,isValidBytes:kA,cleanPath:zo,ParseError:Jl,protoFromTuple:Pa,sizeForAddr:Mf};function Rf(t){const e=[],r=t.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let n=0;n<r.length;n++){const i=r[n],s=Ur(i);if(s.size===0){e.push([i]);continue}if(n++,n>=r.length)throw Jl("invalid address: "+t);if(s.path){e.push([i,zo(r.slice(n).join("/"))]);break}e.push([i,r[n]])}return e}function kf(t){const e=[];return t.map(r=>{const n=Pa(r);e.push(n.name),r.length>1&&e.push(r[1])}),zo(e.join("/"))}function Pf(t){return t.map(e=>{Array.isArray(e)||(e=[e]);const r=Pa(e);return e.length>1?[r.code,Tf.toBytes(r.code,e[1])]:[r.code]})}function Nf(t){return t.map(e=>{const r=Pa(e);return e.length>1?[r.code,Tf.toString(r.code,e[1])]:[r.code]})}function Of(t){return xf(Oe(t.map(e=>{const r=Pa(e);let n=Uint8Array.from(ie.encode(r.code));return e.length>1&&(n=Oe([n,e[1]])),n})))}function Mf(t,e){if(t.size>0)return t.size/8;if(t.size===0)return 0;{const r=ie.decode(e);return r+ie.decode.bytes}}function Ql(t){const e=[];let r=0;for(;r<t.length;){const n=ie.decode(t,r),i=ie.decode.bytes,s=Ur(n),a=Mf(s,t.slice(r+i));if(a===0){e.push([n]),r+=i;continue}const c=t.slice(r+i,r+i+a);if(r+=a+i,r>t.length)throw Jl("Invalid address Uint8Array: "+ae(t,"base16"));e.push([n,c])}return e}function IA(t){const e=Ql(t),r=Nf(e);return kf(r)}function Df(t){t=zo(t);const e=Rf(t),r=Pf(e);return Of(r)}function RA(t){return Df(t)}function xf(t){const e=Yl(t);if(e)throw e;return Uint8Array.from(t)}function Yl(t){try{Ql(t)}catch(e){return e}}function kA(t){return Yl(t)===void 0}function zo(t){return"/"+t.trim().split("/").filter(e=>e).join("/")}function Jl(t){return new Error("Error parsing address: "+t)}function Pa(t){const e=Ur(t[0]);return e}var Zl=ee(function(t,e){const r=Symbol.for("nodejs.util.inspect.custom"),n=Yr.proto(function(i){if(!(this instanceof n))return new n(i);if(i==null&&(i=""),i instanceof Uint8Array)this.bytes=Ir.fromBytes(i);else if(typeof i=="string"||i instanceof String){if(i.length>0&&i.charAt(0)!=="/")throw new Error(`multiaddr "${i}" must start with a "/"`);this.bytes=Ir.fromString(i)}else if(i.bytes&&i.protos&&i.protoCodes)this.bytes=Ir.fromBytes(i.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});n.prototype.toString=function(){return Ir.bytesToString(this.bytes)},n.prototype.toJSON=n.prototype.toString,n.prototype.toOptions=function(){const s={},a=this.toString().split("/");return s.family=a[1]==="ip4"?"ipv4":"ipv6",s.host=a[2],s.transport=a[3],s.port=parseInt(a[4]),s},n.prototype[r]=function(){return"<Multiaddr "+ae(this.bytes,"base16")+" - "+Ir.bytesToString(this.bytes)+">"},n.prototype.inspect=function(){return"<Multiaddr "+ae(this.bytes,"base16")+" - "+Ir.bytesToString(this.bytes)+">"},n.prototype.protos=function(){return this.protoCodes().map(s=>Object.assign({},Ur(s)))},n.prototype.protoCodes=function(){const s=[],a=this.bytes;let c=0;for(;c<a.length;){const o=ie.decode(a,c),l=ie.decode.bytes,u=Ur(o),h=Ir.sizeForAddr(u,a.slice(c+l));c+=h+l,s.push(o)}return s},n.prototype.protoNames=function(){return this.protos().map(s=>s.name)},n.prototype.tuples=function(){return Ir.bytesToTuples(this.bytes)},n.prototype.stringTuples=function(){const s=Ir.bytesToTuples(this.bytes);return Ir.tuplesToStringTuples(s)},n.prototype.encapsulate=function(s){return s=n(s),n(this.toString()+s.toString())},n.prototype.decapsulate=function(s){s=s.toString();const a=this.toString(),c=a.lastIndexOf(s);if(c<0)throw new Error("Address "+this+" does not contain subaddress: "+s);return n(a.slice(0,c))},n.prototype.decapsulateCode=function(s){const a=this.tuples();for(let c=a.length-1;c>=0;c--)if(a[c][0]===s)return n(Ir.tuplesToBytes(a.slice(0,c)));return this},n.prototype.getPeerId=function(){let s=null;try{const a=this.stringTuples().filter(c=>{if(c[0]===Ur.names.ipfs.code)return!0});s=a.pop()[1],s=ae(new Qr(s).multihash,"base58btc")}catch(a){s=null}return s},n.prototype.getPath=function(){let s=null;try{s=this.stringTuples().filter(a=>{const c=Ur(a[0]);if(c.path)return!0})[0][1]}catch(a){s=null}return s},n.prototype.equals=function(s){return ir(this.bytes,s.bytes)},n.prototype.nodeAddress=function(){const s=this.protoCodes(),a=this.protoNames(),c=this.toString().split("/").slice(1);if(c.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(s[0]!==4&&s[0]!==41&&s[0]!==54&&s[0]!==55)throw new Error(`no protocol with name: "'${a[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(c[2]!=="tcp"&&c[2]!=="udp")throw new Error(`no protocol with name: "'${a[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:s[0]===41||s[0]===55?6:4,address:c[1],port:parseInt(c[3])}},n.fromNodeAddress=function(s,a){if(!s)throw new Error("requires node address object");if(!a)throw new Error("requires transport protocol");let c;switch(s.family){case"IPv4":c="ip4";break;case"IPv6":c="ip6";break;default:throw Error(`Invalid addr family. Got '${s.family}' instead of 'IPv4' or 'IPv6'`)}return n("/"+[c,s.address,a,s.port].join("/"))},n.prototype.isThinWaistAddress=function(s){const a=(s||this).protos();return a.length!==2||a[0].code!==4&&a[0].code!==41?!1:!(a[1].code!==6&&a[1].code!==273)},n.protocols=Ur,n.isName=function(s){return n.isMultiaddr(s)?s.protos().some(a=>a.resolvable):!1},n.resolve=function(s){return!n.isMultiaddr(s)||!n.isName(s)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},e=t.exports=n});const Lf=he("dns4"),Bf=he("dns6"),jf=he("dnsaddr"),mi=St(he("dns"),jf,Lf,Bf),Na=St(he("ip4"),he("ip6")),ns=St(Ee(Na,he("tcp")),Ee(mi,he("tcp"))),Uf=Ee(Na,he("udp")),Ff=Ee(Uf,he("utp")),is=St(Ee(ns,he("ws")),Ee(mi,he("ws"))),ss=St(Ee(ns,he("wss")),Ee(mi,he("wss"))),eu=St(Ee(ns,he("http")),Ee(Na,he("http")),Ee(mi,he("http"))),tu=St(Ee(ns,he("https")),Ee(Na,he("https")),Ee(mi,he("https"))),ru=St(Ee(is,he("p2p-webrtc-star"),he("p2p")),Ee(ss,he("p2p-webrtc-star"),he("p2p")),Ee(is,he("p2p-webrtc-star")),Ee(ss,he("p2p-webrtc-star"))),PA=St(Ee(is,he("p2p-websocket-star"),he("p2p")),Ee(ss,he("p2p-websocket-star"),he("p2p")),Ee(is,he("p2p-websocket-star")),Ee(ss,he("p2p-websocket-star"))),$f=St(Ee(eu,he("p2p-webrtc-direct")),Ee(tu,he("p2p-webrtc-direct"))),as=St(is,ss,eu,tu,ru,$f,ns,Ff,mi),NA=St(Ee(as,he("p2p-stardust"),he("p2p")),Ee(as,he("p2p-stardust"))),On=St(Ee(as,he("p2p")),ru,he("p2p")),qf=St(Ee(On,he("p2p-circuit"),On),Ee(On,he("p2p-circuit")),Ee(he("p2p-circuit"),On),Ee(as,he("p2p-circuit")),Ee(he("p2p-circuit"),as),he("p2p-circuit")),Gf=()=>St(Ee(qf,Gf),qf),os=Gf(),Vf=St(Ee(os,On,os),Ee(On,os),Ee(os,On),os,On);var OA=mi,MA=Lf,DA=Bf,xA=jf,LA=Na,BA=ns,jA=Uf,UA=Ff,FA=eu,$A=tu,qA=is,GA=ss,VA=PA,HA=ru,zA=$f,WA=as,KA=NA,XA=os,QA=Vf,YA=Vf;function Hf(t){return function(r){if(!Zl.isMultiaddr(r))try{r=Zl(r)}catch(i){return!1}const n=t(r.protoNames());return n===null?!1:n.length===0}}function Ee(){const t=Array.from(arguments);function e(r){return r.length<t.length?null:(t.some(n=>{if(r=typeof n=="function"?n().partialMatch(r):n.partialMatch(r),r===null)return!0}),r)}return{toString:function(){return"{ "+t.join(" ")+" }"},input:t,matches:Hf(e),partialMatch:e}}function St(){const t=Array.from(arguments);function e(n){let i=null;return t.some(s=>{const a=typeof s=="function"?s().partialMatch(n):s.partialMatch(n);if(a)return i=a,!0}),i}const r={toString:function(){return"{ "+t.join(" ")+" }"},input:t,matches:Hf(e),partialMatch:e};return r}function he(t){const e=t;function r(i){if(typeof i=="string")try{i=Zl(i)}catch(a){return!1}const s=i.protoNames();return s.length===1&&s[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:r,partialMatch:n}}var Mn={DNS:OA,DNS4:MA,DNS6:DA,DNSADDR:xA,IP:LA,TCP:BA,UDP:jA,UTP:UA,HTTP:FA,HTTPS:$A,WebSockets:qA,WebSocketsSecure:GA,WebSocketStar:VA,WebRTCStar:HA,WebRTCDirect:zA,Reliable:WA,Stardust:KA,Circuit:XA,P2P:QA,IPFS:YA};const{CODE_CIRCUIT:nu,CODE_P2P:iu,CODE_TCP:su,CODE_WS:JA,CODE_WSS:zf}=qh;var au={all:t=>t.filter(e=>{if(e.protoCodes().includes(nu))return!1;const r=e.decapsulateCode(iu);return Mn.WebSockets.matches(r)||Mn.WebSocketsSecure.matches(r)}),dnsWss:t=>t.filter(e=>{if(e.protoCodes().includes(nu))return!1;const r=e.decapsulateCode(iu);return Mn.WebSocketsSecure.matches(r)&&Mn.DNS.matches(r.decapsulateCode(su).decapsulateCode(zf))}),dnsWsOrWss:t=>t.filter(e=>{if(e.protoCodes().includes(nu))return!1;const r=e.decapsulateCode(iu);return Mn.WebSockets.matches(r)?Mn.DNS.matches(r.decapsulateCode(su).decapsulateCode(JA)):Mn.WebSocketsSecure.matches(r)&&Mn.DNS.matches(r.decapsulateCode(su).decapsulateCode(zf))})};const{AbortError:Wf}=nt,cs=Q("libp2p:websockets");class ZA{constructor({upgrader:t,filter:e}){if(!t)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=t,this._filter=e}async dial(t,e={}){cs("dialing %s",t);const r=await this._connect(t,e),n=wf(r,{remoteAddr:t,signal:e.signal});cs("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return cs("outbound connection %s upgraded",n.remoteAddr),i}async _connect(t,e={}){if(e.signal&&e.signal.aborted)throw new Wf;const r=t.toOptions();cs("dialing %s:%s",r.host,r.port);const n=Ah(R_(t),Object.assign({binary:!0},e));if(!e.signal)return await n.connected(),cs("connected %s",t),n;let i;const s=new Promise((a,c)=>{if(i=()=>{c(new Wf),n.close()},e.signal.aborted)return i();e.signal.addEventListener("abort",i)});try{await Promise.race([s,n.connected()])}finally{e.signal.removeEventListener("abort",i)}return cs("connected %s",t),n}createListener(t={},e){return typeof t=="function"&&(e=t,t={}),gA({handler:e,upgrader:this._upgrader},t)}filter(t){return t=Array.isArray(t)?t:[t],this._filter?this._filter(t):Ch.isBrowser||Ch.isWebWorker?au.dnsWss(t):au.all(t)}}var Kf=Yr(ZA,{className:"WebSockets",symbolName:"@libp2p/js-libp2p-websockets/websockets"}),Xf=function(){if(typeof window=="undefined")return null;var e={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null},gi=It.EventEmitter;function Qf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function e1(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Qf(Object(r),!0).forEach(function(n){t1(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Qf(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function t1(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function r1(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Yf(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n1(t,e,r){return e&&Yf(t.prototype,e),r&&Yf(t,r),t}var Wo=ea.Buffer,ou=ai.inspect,i1=ou&&ou.custom||"inspect";function s1(t,e,r){Wo.prototype.copy.call(t,e,r)}var a1=function(){function t(){r1(this,t),this.head=null,this.tail=null,this.length=0}return n1(t,[{key:"push",value:function(r){var n={data:r,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}},{key:"unshift",value:function(r){var n={data:r,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length}},{key:"shift",value:function(){if(this.length===0)return;var r=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,r}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(r){if(this.length===0)return"";for(var n=this.head,i=""+n.data;n=n.next;)i+=r+n.data;return i}},{key:"concat",value:function(r){if(this.length===0)return Wo.alloc(0);for(var n=Wo.allocUnsafe(r>>>0),i=this.head,s=0;i;)s1(i.data,n,s),s+=i.data.length,i=i.next;return n}},{key:"consume",value:function(r,n){var i;return r<this.head.data.length?(i=this.head.data.slice(0,r),this.head.data=this.head.data.slice(r)):r===this.head.data.length?i=this.shift():i=n?this._getString(r):this._getBuffer(r),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(r){var n=this.head,i=1,s=n.data;for(r-=s.length;n=n.next;){var a=n.data,c=r>a.length?a.length:r;if(c===a.length?s+=a:s+=a.slice(0,r),r-=c,r===0){c===a.length?(++i,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=a.slice(c));break}++i}return this.length-=i,s}},{key:"_getBuffer",value:function(r){var n=Wo.allocUnsafe(r),i=this.head,s=1;for(i.data.copy(n),r-=i.data.length;i=i.next;){var a=i.data,c=r>a.length?a.length:r;if(a.copy(n,n.length-r,0,c),r-=c,r===0){c===a.length?(++s,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=a.slice(c));break}++s}return this.length-=s,n}},{key:i1,value:function(r,n){return ou(this,e1({},n,{depth:0,customInspect:!1}))}}]),t}();function o1(t,e){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,fe.nextTick(cu,this,t)):fe.nextTick(cu,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(s){!e&&s?r._writableState?r._writableState.errorEmitted?fe.nextTick(Ko,r):(r._writableState.errorEmitted=!0,fe.nextTick(Jf,r,s)):fe.nextTick(Jf,r,s):e?(fe.nextTick(Ko,r),e(s)):fe.nextTick(Ko,r)}),this)}function Jf(t,e){cu(t,e),Ko(t)}function Ko(t){if(t._writableState&&!t._writableState.emitClose)return;if(t._readableState&&!t._readableState.emitClose)return;t.emit("close")}function c1(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function cu(t,e){t.emit("error",e)}function l1(t,e){var r=t._readableState,n=t._writableState;r&&r.autoDestroy||n&&n.autoDestroy?t.destroy(e):t.emit("error",e)}var ls={destroy:o1,undestroy:c1,errorOrDestroy:l1};function u1(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var Zf={};function hr(t,e,r){r||(r=Error);function n(s,a,c){return typeof e=="string"?e:e(s,a,c)}var i=function(s){u1(a,s);function a(c,o,l){return s.call(this,n(c,o,l))||this}return a}(r);i.prototype.name=r.name,i.prototype.code=t,Zf[t]=i}function em(t,e){if(Array.isArray(t)){var r=t.length;return t=t.map(function(n){return String(n)}),r>2?"one of ".concat(e," ").concat(t.slice(0,r-1).join(", "),", or ")+t[r-1]:r===2?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}else return"of ".concat(e," ").concat(String(t))}function d1(t,e,r){return t.substr(!r||r<0?0:+r,e.length)===e}function p1(t,e,r){return(r===void 0||r>t.length)&&(r=t.length),t.substring(r-e.length,r)===e}function h1(t,e,r){return typeof r!="number"&&(r=0),r+e.length>t.length?!1:t.indexOf(e,r)!==-1}hr("ERR_INVALID_OPT_VALUE",function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'},TypeError),hr("ERR_INVALID_ARG_TYPE",function(t,e,r){var n;typeof e=="string"&&d1(e,"not ")?(n="must not be",e=e.replace(/^not /,"")):n="must be";var i;if(p1(t," argument"))i="The ".concat(t," ").concat(n," ").concat(em(e,"type"));else{var s=h1(t,".")?"property":"argument";i='The "'.concat(t,'" ').concat(s," ").concat(n," ").concat(em(e,"type"))}return i+=". Received type ".concat(typeof r),i},TypeError),hr("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),hr("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"}),hr("ERR_STREAM_PREMATURE_CLOSE","Premature close"),hr("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"}),hr("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),hr("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),hr("ERR_STREAM_WRITE_AFTER_END","write after end"),hr("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),hr("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError),hr("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");var f1=Zf,us={codes:f1},m1=us.codes.ERR_INVALID_OPT_VALUE;function g1(t,e,r){return t.highWaterMark!=null?t.highWaterMark:e?t[r]:null}function y1(t,e,r,n){var i=g1(e,n,r);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var s=n?r:"highWaterMark";throw new m1(s,i)}return Math.floor(i)}return t.objectMode?16:16*1024}var tm={getHighWaterMark:y1},b1=v1;function v1(t,e){if(lu("noDeprecation"))return t;var r=!1;function n(){if(!r){if(lu("throwDeprecation"))throw new Error(e);lu("traceDeprecation")?console.trace(e):console.warn(e),r=!0}return t.apply(this,arguments)}return n}function lu(t){try{if(!se.localStorage)return!1}catch(r){return!1}var e=se.localStorage[t];return e==null?!1:String(e).toLowerCase()==="true"}var Xo=We;function rm(t){var e=this;this.next=null,this.entry=null,this.finish=function(){H1(e,t)}}var ds;We.WritableState=Oa;var w1={deprecate:b1},Qo=ea.Buffer,S1=se.Uint8Array||function(){};function _1(t){return Qo.from(t)}function E1(t){return Qo.isBuffer(t)||t instanceof S1}var T1=tm.getHighWaterMark,Dn=us.codes,A1=Dn.ERR_INVALID_ARG_TYPE,C1=Dn.ERR_METHOD_NOT_IMPLEMENTED,I1=Dn.ERR_MULTIPLE_CALLBACK,R1=Dn.ERR_STREAM_CANNOT_PIPE,k1=Dn.ERR_STREAM_DESTROYED,P1=Dn.ERR_STREAM_NULL_VALUES,N1=Dn.ERR_STREAM_WRITE_AFTER_END,O1=Dn.ERR_UNKNOWN_ENCODING,ps=ls.errorOrDestroy;ta(We,gi);function M1(){}function Oa(t,e,r){ds=ds||rn,t=t||{},typeof r!="boolean"&&(r=e instanceof ds),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=T1(this,t,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var n=t.decodeStrings===!1;this.decodeStrings=!n,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(i){F1(e,i)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new rm(this)}Oa.prototype.getBuffer=function(){for(var e=this.bufferedRequest,r=[];e;)r.push(e),e=e.next;return r},function(){try{Object.defineProperty(Oa.prototype,"buffer",{get:w1.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}();var Yo;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Yo=Function.prototype[Symbol.hasInstance],Object.defineProperty(We,Symbol.hasInstance,{value:function(e){return Yo.call(this,e)?!0:this!==We?!1:e&&e._writableState instanceof Oa}})):Yo=function(e){return e instanceof this};function We(t){ds=ds||rn;var e=this instanceof ds;if(!e&&!Yo.call(We,this))return new We(t);this._writableState=new Oa(t,this,e),this.writable=!0,t&&(typeof t.write=="function"&&(this._write=t.write),typeof t.writev=="function"&&(this._writev=t.writev),typeof t.destroy=="function"&&(this._destroy=t.destroy),typeof t.final=="function"&&(this._final=t.final)),gi.call(this)}We.prototype.pipe=function(){ps(this,new R1)};function D1(t,e){var r=new N1;ps(t,r),fe.nextTick(e,r)}function x1(t,e,r,n){var i;return r===null?i=new P1:typeof r!="string"&&!e.objectMode&&(i=new A1("chunk",["string","Buffer"],r)),i?(ps(t,i),fe.nextTick(n,i),!1):!0}We.prototype.write=function(t,e,r){var n=this._writableState,i=!1,s=!n.objectMode&&E1(t);return s&&!Qo.isBuffer(t)&&(t=_1(t)),typeof e=="function"&&(r=e,e=null),s?e="buffer":e||(e=n.defaultEncoding),typeof r!="function"&&(r=M1),n.ending?D1(this,r):(s||x1(this,n,t,r))&&(n.pendingcb++,i=B1(this,n,s,t,e,r)),i},We.prototype.cork=function(){this._writableState.corked++},We.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,!t.writing&&!t.corked&&!t.bufferProcessing&&t.bufferedRequest&&im(this,t))},We.prototype.setDefaultEncoding=function(e){if(typeof e=="string"&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new O1(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(We.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function L1(t,e,r){return!t.objectMode&&t.decodeStrings!==!1&&typeof e=="string"&&(e=Qo.from(e,r)),e}Object.defineProperty(We.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function B1(t,e,r,n,i,s){if(!r){var a=L1(e,n,i);n!==a&&(r=!0,i="buffer",n=a)}var c=e.objectMode?1:n.length;e.length+=c;var o=e.length<e.highWaterMark;if(o||(e.needDrain=!0),e.writing||e.corked){var l=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:s,next:null},l?l.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else uu(t,e,!1,c,n,i,s);return o}function uu(t,e,r,n,i,s,a){e.writelen=n,e.writecb=a,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new k1("write")):r?t._writev(i,e.onwrite):t._write(i,s,e.onwrite),e.sync=!1}function j1(t,e,r,n,i){--e.pendingcb,r?(fe.nextTick(i,n),fe.nextTick(Ma,t,e),t._writableState.errorEmitted=!0,ps(t,n)):(i(n),t._writableState.errorEmitted=!0,ps(t,n),Ma(t,e))}function U1(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function F1(t,e){var r=t._writableState,n=r.sync,i=r.writecb;if(typeof i!="function")throw new I1;if(U1(r),e)j1(t,r,n,e,i);else{var s=sm(r)||t.destroyed;!s&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&im(t,r),n?fe.nextTick(nm,t,r,s,i):nm(t,r,s,i)}}function nm(t,e,r,n){r||$1(t,e),e.pendingcb--,n(),Ma(t,e)}function $1(t,e){e.length===0&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function im(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var n=e.bufferedRequestCount,i=new Array(n),s=e.corkedRequestsFree;s.entry=r;for(var a=0,c=!0;r;)i[a]=r,r.isBuf||(c=!1),r=r.next,a+=1;i.allBuffers=c,uu(t,e,!0,e.length,i,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new rm(e),e.bufferedRequestCount=0}else{for(;r;){var o=r.chunk,l=r.encoding,u=r.callback,h=e.objectMode?1:o.length;if(uu(t,e,!1,h,o,l,u),r=r.next,e.bufferedRequestCount--,e.writing)break}r===null&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}We.prototype._write=function(t,e,r){r(new C1("_write()"))},We.prototype._writev=null,We.prototype.end=function(t,e,r){var n=this._writableState;return typeof t=="function"?(r=t,t=null,e=null):typeof e=="function"&&(r=e,e=null),t!=null&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||V1(this,n,r),this},Object.defineProperty(We.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function sm(t){return t.ending&&t.length===0&&t.bufferedRequest===null&&!t.finished&&!t.writing}function q1(t,e){t._final(function(r){e.pendingcb--,r&&ps(t,r),e.prefinished=!0,t.emit("prefinish"),Ma(t,e)})}function G1(t,e){!e.prefinished&&!e.finalCalled&&(typeof t._final=="function"&&!e.destroyed?(e.pendingcb++,e.finalCalled=!0,fe.nextTick(q1,t,e)):(e.prefinished=!0,t.emit("prefinish")))}function Ma(t,e){var r=sm(e);if(r&&(G1(t,e),e.pendingcb===0&&(e.finished=!0,t.emit("finish"),e.autoDestroy))){var n=t._readableState;(!n||n.autoDestroy&&n.endEmitted)&&t.destroy()}return r}function V1(t,e,r){e.ending=!0,Ma(t,e),r&&(e.finished?fe.nextTick(r):t.once("finish",r)),e.ended=!0,t.writable=!1}function H1(t,e,r){var n=t.entry;for(t.entry=null;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree.next=t}Object.defineProperty(We.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(e){if(!this._writableState)return;this._writableState.destroyed=e}}),We.prototype.destroy=ls.destroy,We.prototype._undestroy=ls.undestroy,We.prototype._destroy=function(t,e){e(t)};var z1=Object.keys||function(t){var e=[];for(var r in t)e.push(r);return e},rn=Fr;ta(Fr,yu);for(var am=z1(Xo.prototype),du=0;du<am.length;du++){var pu=am[du];Fr.prototype[pu]||(Fr.prototype[pu]=Xo.prototype[pu])}function Fr(t){if(!(this instanceof Fr))return new Fr(t);yu.call(this,t),Xo.call(this,t),this.allowHalfOpen=!0,t&&(t.readable===!1&&(this.readable=!1),t.writable===!1&&(this.writable=!1),t.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",W1)))}Object.defineProperty(Fr.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(Fr.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(Fr.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function W1(){if(this._writableState.ended)return;fe.nextTick(K1,this)}function K1(t){t.end()}Object.defineProperty(Fr.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(e){if(this._readableState===void 0||this._writableState===void 0)return;this._readableState.destroyed=e,this._writableState.destroyed=e}});var hu=ey.Buffer,om=hu.isEncoding||function(t){t=""+t;switch(t&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function X1(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}function Q1(t){var e=X1(t);if(typeof e!="string"&&(hu.isEncoding===om||!om(t)))throw new Error("Unknown encoding: "+t);return e||t}var Y1=Da;function Da(t){this.encoding=Q1(t);var e;switch(this.encoding){case"utf16le":this.text=nC,this.end=iC,e=4;break;case"utf8":this.fillLast=eC,e=4;break;case"base64":this.text=sC,this.end=aC,e=3;break;default:this.write=oC,this.end=cC;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=hu.allocUnsafe(e)}Da.prototype.write=function(t){if(t.length===0)return"";var e,r;if(this.lastNeed){if(e=this.fillLast(t),e===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""},Da.prototype.end=rC,Da.prototype.text=tC,Da.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length};function fu(t){return t<=127?0:t>>5===6?2:t>>4===14?3:t>>3===30?4:t>>6===2?-1:-2}function J1(t,e,r){var n=e.length-1;if(n<r)return 0;var i=fu(e[n]);return i>=0?(i>0&&(t.lastNeed=i-1),i):--n<r||i===-2?0:(i=fu(e[n]),i>=0?(i>0&&(t.lastNeed=i-2),i):--n<r||i===-2?0:(i=fu(e[n]),i>=0?(i>0&&(i===2?i=0:t.lastNeed=i-3),i):0))}function Z1(t,e,r){if((e[0]&192)!==128)return t.lastNeed=0,"\uFFFD";if(t.lastNeed>1&&e.length>1){if((e[1]&192)!==128)return t.lastNeed=1,"\uFFFD";if(t.lastNeed>2&&e.length>2&&(e[2]&192)!==128)return t.lastNeed=2,"\uFFFD"}}function eC(t){var e=this.lastTotal-this.lastNeed,r=Z1(this,t);if(r!==void 0)return r;if(this.lastNeed<=t.length)return t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,e,0,t.length),this.lastNeed-=t.length}function tC(t,e){var r=J1(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var n=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)}function rC(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"\uFFFD":e}function nC(t,e){if((t.length-e)%2===0){var r=t.toString("utf16le",e);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function iC(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function sC(t,e){var r=(t.length-e)%3;return r===0?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function aC(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function oC(t){return t.toString(this.encoding)}function cC(t){return t&&t.length?this.write(t):""}var cm={StringDecoder:Y1},lm=us.codes.ERR_STREAM_PREMATURE_CLOSE;function lC(t){var e=!1;return function(){if(e)return;e=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];t.apply(this,n)}}function uC(){}function dC(t){return t.setHeader&&typeof t.abort=="function"}function um(t,e,r){if(typeof e=="function")return um(t,null,e);e||(e={}),r=lC(r||uC);var n=e.readable||e.readable!==!1&&t.readable,i=e.writable||e.writable!==!1&&t.writable,s=function(){t.writable||c()},a=t._writableState&&t._writableState.finished,c=function(){i=!1,a=!0,n||r.call(t)},o=t._readableState&&t._readableState.endEmitted,l=function(){n=!1,o=!0,i||r.call(t)},u=function(C){r.call(t,C)},h=function(){var C;if(n&&!o)return(!t._readableState||!t._readableState.ended)&&(C=new lm),r.call(t,C);if(i&&!a)return(!t._writableState||!t._writableState.ended)&&(C=new lm),r.call(t,C)},S=function(){t.req.on("finish",c)};return dC(t)?(t.on("complete",c),t.on("abort",h),t.req?S():t.on("request",S)):i&&!t._writableState&&(t.on("end",s),t.on("close",s)),t.on("end",l),t.on("finish",c),e.error!==!1&&t.on("error",u),t.on("close",h),function(){t.removeListener("complete",c),t.removeListener("abort",h),t.removeListener("request",S),t.req&&t.req.removeListener("finish",c),t.removeListener("end",s),t.removeListener("close",s),t.removeListener("finish",c),t.removeListener("end",l),t.removeListener("error",u),t.removeListener("close",h)}}var mu=um,Jo;function xn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Ln=Symbol("lastResolve"),yi=Symbol("lastReject"),xa=Symbol("error"),Zo=Symbol("ended"),bi=Symbol("lastPromise"),gu=Symbol("handlePromise"),vi=Symbol("stream");function Bn(t,e){return{value:t,done:e}}function pC(t){var e=t[Ln];if(e!==null){var r=t[vi].read();r!==null&&(t[bi]=null,t[Ln]=null,t[yi]=null,e(Bn(r,!1)))}}function hC(t){fe.nextTick(pC,t)}function fC(t,e){return function(r,n){t.then(function(){if(e[Zo]){r(Bn(void 0,!0));return}e[gu](r,n)},n)}}var mC=Object.getPrototypeOf(function(){}),gC=Object.setPrototypeOf((Jo={get stream(){return this[vi]},next:function(){var e=this,r=this[xa];if(r!==null)return Promise.reject(r);if(this[Zo])return Promise.resolve(Bn(void 0,!0));if(this[vi].destroyed)return new Promise(function(a,c){fe.nextTick(function(){e[xa]?c(e[xa]):a(Bn(void 0,!0))})});var n=this[bi],i;if(n)i=new Promise(fC(n,this));else{var s=this[vi].read();if(s!==null)return Promise.resolve(Bn(s,!1));i=new Promise(this[gu])}return this[bi]=i,i}},xn(Jo,Symbol.asyncIterator,function(){return this}),xn(Jo,"return",function(){var e=this;return new Promise(function(r,n){e[vi].destroy(null,function(i){if(i){n(i);return}r(Bn(void 0,!0))})})}),Jo),mC),yC=function(e){var r,n=Object.create(gC,(r={},xn(r,vi,{value:e,writable:!0}),xn(r,Ln,{value:null,writable:!0}),xn(r,yi,{value:null,writable:!0}),xn(r,xa,{value:null,writable:!0}),xn(r,Zo,{value:e._readableState.endEmitted,writable:!0}),xn(r,gu,{value:function(s,a){var c=n[vi].read();c?(n[bi]=null,n[Ln]=null,n[yi]=null,s(Bn(c,!1))):(n[Ln]=s,n[yi]=a)},writable:!0}),r));return n[bi]=null,mu(e,function(i){if(i&&i.code!=="ERR_STREAM_PREMATURE_CLOSE"){var s=n[yi];s!==null&&(n[bi]=null,n[Ln]=null,n[yi]=null,s(i)),n[xa]=i;return}var a=n[Ln];a!==null&&(n[bi]=null,n[Ln]=null,n[yi]=null,a(Bn(void 0,!0))),n[Zo]=!0}),e.on("readable",hC.bind(null,n)),n},bC=yC,vC=function(){throw new Error("Readable.from is not available in the browser")},yu=Ce,hs;Ce.ReadableState=pm;var WN=It.EventEmitter,dm=function(e,r){return e.listeners(r).length},ec=ea.Buffer,wC=se.Uint8Array||function(){};function SC(t){return ec.from(t)}function _C(t){return ec.isBuffer(t)||t instanceof wC}var ve;ai&&ai.debuglog?ve=ai.debuglog("stream"):ve=function(){};var EC=tm.getHighWaterMark,tc=us.codes,TC=tc.ERR_INVALID_ARG_TYPE,AC=tc.ERR_STREAM_PUSH_AFTER_EOF,CC=tc.ERR_METHOD_NOT_IMPLEMENTED,IC=tc.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,fs,bu,vu;ta(Ce,gi);var La=ls.errorOrDestroy,wu=["error","close","destroy","pause","resume"];function RC(t,e,r){if(typeof t.prependListener=="function")return t.prependListener(e,r);!t._events||!t._events[e]?t.on(e,r):Array.isArray(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]}function pm(t,e,r){hs=hs||rn,t=t||{},typeof r!="boolean"&&(r=e instanceof hs),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=EC(this,t,"readableHighWaterMark",r),this.buffer=new a1,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(fs||(fs=cm.StringDecoder),this.decoder=new fs(t.encoding),this.encoding=t.encoding)}function Ce(t){if(hs=hs||rn,!(this instanceof Ce))return new Ce(t);var e=this instanceof hs;this._readableState=new pm(t,this,e),this.readable=!0,t&&(typeof t.read=="function"&&(this._read=t.read),typeof t.destroy=="function"&&(this._destroy=t.destroy)),gi.call(this)}Object.defineProperty(Ce.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(e){if(!this._readableState)return;this._readableState.destroyed=e}}),Ce.prototype.destroy=ls.destroy,Ce.prototype._undestroy=ls.undestroy,Ce.prototype._destroy=function(t,e){e(t)},Ce.prototype.push=function(t,e){var r=this._readableState,n;return r.objectMode?n=!0:typeof t=="string"&&(e=e||r.defaultEncoding,e!==r.encoding&&(t=ec.from(t,e),e=""),n=!0),hm(this,t,e,!1,n)},Ce.prototype.unshift=function(t){return hm(this,t,null,!0,!1)};function hm(t,e,r,n,i){ve("readableAddChunk",e);var s=t._readableState;if(e===null)s.reading=!1,NC(t,s);else{var a;if(i||(a=kC(s,e)),a)La(t,a);else if(s.objectMode||e&&e.length>0)if(typeof e!="string"&&!s.objectMode&&Object.getPrototypeOf(e)!==ec.prototype&&(e=SC(e)),n)s.endEmitted?La(t,new IC):Su(t,s,e,!0);else if(s.ended)La(t,new AC);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!r?(e=s.decoder.write(e),s.objectMode||e.length!==0?Su(t,s,e,!1):_u(t,s)):Su(t,s,e,!1)}else n||(s.reading=!1,_u(t,s))}return!s.ended&&(s.length<s.highWaterMark||s.length===0)}function Su(t,e,r,n){e.flowing&&e.length===0&&!e.sync?(e.awaitDrain=0,t.emit("data",r)):(e.length+=e.objectMode?1:r.length,n?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&rc(t)),_u(t,e)}function kC(t,e){var r;return!_C(e)&&typeof e!="string"&&e!==void 0&&!t.objectMode&&(r=new TC("chunk",["string","Buffer","Uint8Array"],e)),r}Ce.prototype.isPaused=function(){return this._readableState.flowing===!1},Ce.prototype.setEncoding=function(t){fs||(fs=cm.StringDecoder);var e=new fs(t);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";r!==null;)n+=e.write(r.data),r=r.next;return this._readableState.buffer.clear(),n!==""&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var fm=1073741824;function PC(t){return t>=fm?t=fm:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function mm(t,e){return t<=0||e.length===0&&e.ended?0:e.objectMode?1:t!==t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=PC(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}Ce.prototype.read=function(t){ve("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(t!==0&&(e.emittedReadable=!1),t===0&&e.needReadable&&((e.highWaterMark!==0?e.length>=e.highWaterMark:e.length>0)||e.ended))return ve("read: emitReadable",e.length,e.ended),e.length===0&&e.ended?Tu(this):rc(this),null;if(t=mm(t,e),t===0&&e.ended)return e.length===0&&Tu(this),null;var n=e.needReadable;ve("need readable",n),(e.length===0||e.length-t<e.highWaterMark)&&(n=!0,ve("length less than watermark",n)),e.ended||e.reading?(n=!1,ve("reading or ended",n)):n&&(ve("do read"),e.reading=!0,e.sync=!0,e.length===0&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=mm(r,e)));var i;return t>0?i=bm(t,e):i=null,i===null?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.awaitDrain=0),e.length===0&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&Tu(this)),i!==null&&this.emit("data",i),i};function NC(t,e){if(ve("onEofChunk"),e.ended)return;if(e.decoder){var r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,e.sync?rc(t):(e.needReadable=!1,e.emittedReadable||(e.emittedReadable=!0,gm(t)))}function rc(t){var e=t._readableState;ve("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(ve("emitReadable",e.flowing),e.emittedReadable=!0,fe.nextTick(gm,t))}function gm(t){var e=t._readableState;ve("emitReadable_",e.destroyed,e.length,e.ended),!e.destroyed&&(e.length||e.ended)&&(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,Eu(t)}function _u(t,e){e.readingMore||(e.readingMore=!0,fe.nextTick(OC,t,e))}function OC(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&e.length===0);){var r=e.length;if(ve("maybeReadMore read 0"),t.read(0),r===e.length)break}e.readingMore=!1}Ce.prototype._read=function(t){La(this,new CC("_read()"))},Ce.prototype.pipe=function(t,e){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=t;break;case 1:n.pipes=[n.pipes,t];break;default:n.pipes.push(t);break}n.pipesCount+=1,ve("pipe count=%d opts=%j",n.pipesCount,e);var i=(!e||e.end!==!1)&&t!==fe.stdout&&t!==fe.stderr,s=i?c:T;n.endEmitted?fe.nextTick(s):r.once("end",s),t.on("unpipe",a);function a(E,I){ve("onunpipe"),E===r&&(I&&I.hasUnpiped===!1&&(I.hasUnpiped=!0,u()))}function c(){ve("onend"),t.end()}var o=MC(r);t.on("drain",o);var l=!1;function u(){ve("cleanup"),t.removeListener("close",p),t.removeListener("finish",C),t.removeListener("drain",o),t.removeListener("error",S),t.removeListener("unpipe",a),r.removeListener("end",c),r.removeListener("end",T),r.removeListener("data",h),l=!0,n.awaitDrain&&(!t._writableState||t._writableState.needDrain)&&o()}r.on("data",h);function h(E){ve("ondata");var I=t.write(E);ve("dest.write",I),I===!1&&((n.pipesCount===1&&n.pipes===t||n.pipesCount>1&&vm(n.pipes,t)!==-1)&&!l&&(ve("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function S(E){ve("onerror",E),T(),t.removeListener("error",S),dm(t,"error")===0&&La(t,E)}RC(t,"error",S);function p(){t.removeListener("finish",C),T()}t.once("close",p);function C(){ve("onfinish"),t.removeListener("close",p),T()}t.once("finish",C);function T(){ve("unpipe"),r.unpipe(t)}return t.emit("pipe",r),n.flowing||(ve("pipe resume"),r.resume()),t};function MC(t){return function(){var r=t._readableState;ve("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&dm(t,"data")&&(r.flowing=!0,Eu(t))}}Ce.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(e.pipesCount===0)return this;if(e.pipesCount===1)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r),this);if(!t){var n=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<i;s++)n[s].emit("unpipe",this,{hasUnpiped:!1});return this}var a=vm(e.pipes,t);return a===-1?this:(e.pipes.splice(a,1),e.pipesCount-=1,e.pipesCount===1&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r),this)},Ce.prototype.on=function(t,e){var r=gi.prototype.on.call(this,t,e),n=this._readableState;return t==="data"?(n.readableListening=this.listenerCount("readable")>0,n.flowing!==!1&&this.resume()):t==="readable"&&(!n.endEmitted&&!n.readableListening&&(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,ve("on readable",n.length,n.reading),n.length?rc(this):n.reading||fe.nextTick(DC,this))),r},Ce.prototype.addListener=Ce.prototype.on,Ce.prototype.removeListener=function(t,e){var r=gi.prototype.removeListener.call(this,t,e);return t==="readable"&&fe.nextTick(ym,this),r},Ce.prototype.removeAllListeners=function(t){var e=gi.prototype.removeAllListeners.apply(this,arguments);return(t==="readable"||t===void 0)&&fe.nextTick(ym,this),e};function ym(t){var e=t._readableState;e.readableListening=t.listenerCount("readable")>0,e.resumeScheduled&&!e.paused?e.flowing=!0:t.listenerCount("data")>0&&t.resume()}function DC(t){ve("readable nexttick read 0"),t.read(0)}Ce.prototype.resume=function(){var t=this._readableState;return t.flowing||(ve("resume"),t.flowing=!t.readableListening,xC(this,t)),t.paused=!1,this};function xC(t,e){e.resumeScheduled||(e.resumeScheduled=!0,fe.nextTick(LC,t,e))}function LC(t,e){ve("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),Eu(t),e.flowing&&!e.reading&&t.read(0)}Ce.prototype.pause=function(){return ve("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(ve("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Eu(t){var e=t._readableState;for(ve("flow",e.flowing);e.flowing&&t.read()!==null;);}Ce.prototype.wrap=function(t){var e=this,r=this._readableState,n=!1;t.on("end",function(){if(ve("wrapped end"),r.decoder&&!r.ended){var a=r.decoder.end();a&&a.length&&e.push(a)}e.push(null)}),t.on("data",function(a){if(ve("wrapped data"),r.decoder&&(a=r.decoder.write(a)),r.objectMode&&a==null)return;if(!r.objectMode&&(!a||!a.length))return;var c=e.push(a);c||(n=!0,t.pause())});for(var i in t)this[i]===void 0&&typeof t[i]=="function"&&(this[i]=function(c){return function(){return t[c].apply(t,arguments)}}(i));for(var s=0;s<wu.length;s++)t.on(wu[s],this.emit.bind(this,wu[s]));return this._read=function(a){ve("wrapped _read",a),n&&(n=!1,t.resume())},this},typeof Symbol=="function"&&(Ce.prototype[Symbol.asyncIterator]=function(){return bu===void 0&&(bu=bC),bu(this)}),Object.defineProperty(Ce.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(Ce.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(Ce.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),Ce._fromList=bm,Object.defineProperty(Ce.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function bm(t,e){if(e.length===0)return null;var r;return e.objectMode?r=e.buffer.shift():!t||t>=e.length?(e.decoder?r=e.buffer.join(""):e.buffer.length===1?r=e.buffer.first():r=e.buffer.concat(e.length),e.buffer.clear()):r=e.buffer.consume(t,e.decoder),r}function Tu(t){var e=t._readableState;ve("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,fe.nextTick(BC,e,t))}function BC(t,e){if(ve("endReadableNT",t.endEmitted,t.length),!t.endEmitted&&t.length===0&&(t.endEmitted=!0,e.readable=!1,e.emit("end"),t.autoDestroy)){var r=e._writableState;(!r||r.autoDestroy&&r.finished)&&e.destroy()}}typeof Symbol=="function"&&(Ce.from=function(t,e){return vu===void 0&&(vu=vC),vu(Ce,t,e)});function vm(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}var Au=nn,nc=us.codes,jC=nc.ERR_METHOD_NOT_IMPLEMENTED,UC=nc.ERR_MULTIPLE_CALLBACK,FC=nc.ERR_TRANSFORM_ALREADY_TRANSFORMING,$C=nc.ERR_TRANSFORM_WITH_LENGTH_0;ta(nn,rn);function qC(t,e){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(n===null)return this.emit("error",new UC);r.writechunk=null,r.writecb=null,e!=null&&this.push(e),n(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function nn(t){if(!(this instanceof nn))return new nn(t);rn.call(this,t),this._transformState={afterTransform:qC.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",GC)}function GC(){var t=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,r){wm(t,e,r)}):wm(this,null,null)}nn.prototype.push=function(t,e){return this._transformState.needTransform=!1,rn.prototype.push.call(this,t,e)},nn.prototype._transform=function(t,e,r){r(new jC("_transform()"))},nn.prototype._write=function(t,e,r){var n=this._transformState;if(n.writecb=r,n.writechunk=t,n.writeencoding=e,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},nn.prototype._read=function(t){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},nn.prototype._destroy=function(t,e){rn.prototype._destroy.call(this,t,function(r){e(r)})};function wm(t,e,r){if(e)return t.emit("error",e);if(r!=null&&t.push(r),t._writableState.length)throw new $C;if(t._transformState.transforming)throw new FC;return t.push(null)}var VC=Ba;ta(Ba,Au);function Ba(t){if(!(this instanceof Ba))return new Ba(t);Au.call(this,t)}Ba.prototype._transform=function(t,e,r){r(null,t)};var Cu;function HC(t){var e=!1;return function(){if(e)return;e=!0,t.apply(void 0,arguments)}}var Sm=us.codes,zC=Sm.ERR_MISSING_ARGS,WC=Sm.ERR_STREAM_DESTROYED;function _m(t){if(t)throw t}function KC(t){return t.setHeader&&typeof t.abort=="function"}function XC(t,e,r,n){n=HC(n);var i=!1;t.on("close",function(){i=!0}),Cu===void 0&&(Cu=mu),Cu(t,{readable:e,writable:r},function(a){if(a)return n(a);i=!0,n()});var s=!1;return function(a){if(i)return;if(s)return;if(s=!0,KC(t))return t.abort();if(typeof t.destroy=="function")return t.destroy();n(a||new WC("pipe"))}}function Em(t){t()}function QC(t,e){return t.pipe(e)}function YC(t){return t.length?typeof t[t.length-1]!="function"?_m:t.pop():_m}function JC(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=YC(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new zC("streams");var i,s=e.map(function(a,c){var o=c<e.length-1,l=c>0;return XC(a,o,l,function(u){if(i||(i=u),u&&s.forEach(Em),o)return;s.forEach(Em),n(i)})});return e.reduce(QC)}var ZC=JC,eI=ee(function(t,e){e=t.exports=yu,e.Stream=e,e.Readable=e,e.Writable=Xo,e.Duplex=rn,e.Transform=Au,e.PassThrough=VC,e.finished=mu,e.pipeline=ZC});/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let Tm;var Iu=typeof queueMicrotask=="function"?queueMicrotask:t=>(Tm||(Tm=Promise.resolve())).then(t).catch(e=>setTimeout(()=>{throw e},0));/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var tI=Q("simple-peer"),Ru=64*1024,rI=5*1e3,nI=5*1e3;function Am(t){return t.replace(/a=ice-options:trickle\s\n/g,"")}function iI(t){console.warn(t)}class ms extends eI.Duplex{constructor(t){if(t=Object.assign({allowHalfOpen:!1},t),super(t),this._id=ld(4).toString("hex").slice(0,7),this._debug("new peer %o",t),this.channelName=t.initiator?t.channelName||ld(20).toString("hex"):null,this.initiator=t.initiator||!1,this.channelConfig=t.channelConfig||ms.channelConfig,this.negotiated=this.channelConfig.negotiated,this.config=Object.assign({},ms.config,t.config),this.offerOptions=t.offerOptions||{},this.answerOptions=t.answerOptions||{},this.sdpTransform=t.sdpTransform||(e=>e),this.streams=t.streams||(t.stream?[t.stream]:[]),this.trickle=t.trickle!==void 0?t.trickle:!0,this.allowHalfTrickle=t.allowHalfTrickle!==void 0?t.allowHalfTrickle:!1,this.iceCompleteTimeout=t.iceCompleteTimeout||rI,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=t.wrtc&&typeof t.wrtc=="object"?t.wrtc:Xf(),!this._wrtc)throw typeof window=="undefined"?F(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):F(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=this.negotiated?!1:!this.initiator,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._firstStable=!0,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(e){Iu(()=>this.destroy(F(e,"ERR_PC_CONSTRUCTOR")));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=e=>{this._onIceCandidate(e)},this.initiator||this.negotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=e=>{this._setupData(e)},this.streams&&this.streams.forEach(e=>{this.addStream(e)}),this._pc.ontrack=e=>{this._onTrack(e)},this.initiator&&this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(t){if(this.destroyed)throw F(new Error("cannot signal after peer is destroyed"),"ERR_SIGNALING");if(typeof t=="string")try{t=JSON.parse(t)}catch(e){t={}}this._debug("signal()"),t.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),t.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(t.transceiverRequest.kind,t.transceiverRequest.init)),t.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(t.candidate):this._pendingCandidates.push(t.candidate)),t.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(t)).then(()=>{if(this.destroyed)return;this._pendingCandidates.forEach(e=>{this._addIceCandidate(e)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer()}).catch(e=>{this.destroy(F(e,"ERR_SET_REMOTE_DESCRIPTION"))}),!t.sdp&&!t.candidate&&!t.renegotiate&&!t.transceiverRequest&&this.destroy(F(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}_addIceCandidate(t){var e=new this._wrtc.RTCIceCandidate(t);this._pc.addIceCandidate(e).catch(r=>{!e.address||e.address.endsWith(".local")?iI("Ignoring unsupported ICE candidate."):this.destroy(F(r,"ERR_ADD_ICE_CANDIDATE"))})}send(t){this._channel.send(t)}addTransceiver(t,e){if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,e),this._needsNegotiation()}catch(r){this.destroy(F(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{transceiverRequest:{kind:t,init:e}})}addStream(t){this._debug("addStream()"),t.getTracks().forEach(e=>{this.addTrack(e,t)})}addTrack(t,e){this._debug("addTrack()");var r=this._senderMap.get(t)||new Map,n=r.get(e);if(!n)n=this._pc.addTrack(t,e),r.set(e,n),this._senderMap.set(t,r),this._needsNegotiation();else throw n.removed?F(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):F(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(t,e,r){this._debug("replaceTrack()");var n=this._senderMap.get(t),i=n?n.get(r):null;if(!i)throw F(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");e&&this._senderMap.set(e,n),i.replaceTrack!=null?i.replaceTrack(e):this.destroy(F(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(t,e){this._debug("removeSender()");var r=this._senderMap.get(t),n=r?r.get(e):null;if(!n)throw F(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{n.removed=!0,this._pc.removeTrack(n)}catch(i){i.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(n):this.destroy(F(i,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){this._debug("removeSenders()"),t.getTracks().forEach(e=>{this.removeTrack(e,t)})}_needsNegotiation(){if(this._debug("_needsNegotiation"),this._batchedNegotiation)return;this._batchedNegotiation=!0,Iu(()=>{this._batchedNegotiation=!1,this._debug("starting batched negotiation"),this.negotiate()})}negotiate(){this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{renegotiate:!0})),this._isNegotiating=!0}_destroy(t,e){if(this._debug("destroy (error: %s)",t&&(t.message||t)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(r){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(r){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e(t)}_setupData(t){if(!t.channel)return this.destroy(F(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=t.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=Ru),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{this.destroy(F(r,"ERR_DATA_CHANNEL"))};var e=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(e&&this._onChannelClose(),e=!0):e=!1},nI)}_read(){}_write(t,e,r){if(this.destroyed)return r(F(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(t)}catch(n){return this.destroy(F(n,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>Ru?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=t,this._cb=r}_onFinish(){if(this.destroyed)return;const t=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?t():this.once("connect",t)}_startIceCompleteTimeout(){if(this.destroyed)return;if(this._iceCompleteTimer)return;this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout)}_createOffer(){if(this.destroyed)return;this._pc.createOffer(this.offerOptions).then(t=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(t.sdp=Am(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const e=()=>{if(this.destroyed)return;var i=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:i.type,sdp:i.sdp})},r=()=>{if(this._debug("createOffer success"),this.destroyed)return;this.trickle||this._iceComplete?e():this.once("_iceComplete",e)},n=i=>{this.destroy(F(i,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(t).then(r).catch(n)}).catch(t=>{this.destroy(F(t,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(t=>{!t.mid&&t.sender.track&&!t.requested&&(t.requested=!0,this.addTransceiver(t.sender.track.kind))})}_createAnswer(){if(this.destroyed)return;this._pc.createAnswer(this.answerOptions).then(t=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(t.sdp=Am(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const e=()=>{if(this.destroyed)return;var i=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:i.type,sdp:i.sdp}),this.initiator||this._requestMissingTransceivers()},r=()=>{if(this.destroyed)return;this.trickle||this._iceComplete?e():this.once("_iceComplete",e)},n=i=>{this.destroy(F(i,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(t).then(r).catch(n)}).catch(t=>{this.destroy(F(t,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){if(this.destroyed)return;this._pc.connectionState==="failed"&&this.destroy(F(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;var t=this._pc.iceConnectionState,e=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",t,e),this.emit("iceStateChange",t,e),(t==="connected"||t==="completed")&&(this._pcReady=!0,this._maybeReady()),t==="failed"&&this.destroy(F(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),t==="closed"&&this.destroy(F(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(t){const e=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(n=>{Object.assign(r,n)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{var n=[];r.forEach(i=>{n.push(e(i))}),t(null,n)},r=>t(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;var n=[];r.result().forEach(i=>{var s={};i.names().forEach(a=>{s[a]=i.stat(a)}),s.id=i.id,s.type=i.type,s.timestamp=i.timestamp,n.push(e(s))}),t(null,n)},r=>t(r)):t(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const t=()=>{if(this.destroyed)return;this.getStats((e,r)=>{if(this.destroyed)return;e&&(r=[]);var n={},i={},s={},a=!1;r.forEach(l=>{(l.type==="remotecandidate"||l.type==="remote-candidate")&&(n[l.id]=l),(l.type==="localcandidate"||l.type==="local-candidate")&&(i[l.id]=l),(l.type==="candidatepair"||l.type==="candidate-pair")&&(s[l.id]=l)});const c=l=>{a=!0;var u=i[l.localCandidateId];u&&(u.ip||u.address)?(this.localAddress=u.ip||u.address,this.localPort=Number(u.port)):u&&u.ipAddress?(this.localAddress=u.ipAddress,this.localPort=Number(u.portNumber)):typeof l.googLocalAddress=="string"&&(u=l.googLocalAddress.split(":"),this.localAddress=u[0],this.localPort=Number(u[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");var h=n[l.remoteCandidateId];h&&(h.ip||h.address)?(this.remoteAddress=h.ip||h.address,this.remotePort=Number(h.port)):h&&h.ipAddress?(this.remoteAddress=h.ipAddress,this.remotePort=Number(h.portNumber)):typeof l.googRemoteAddress=="string"&&(h=l.googRemoteAddress.split(":"),this.remoteAddress=h[0],this.remotePort=Number(h[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(l=>{l.type==="transport"&&l.selectedCandidatePairId&&c(s[l.selectedCandidatePairId]),(l.type==="googCandidatePair"&&l.googActiveConnection==="true"||(l.type==="candidatepair"||l.type==="candidate-pair")&&l.selected)&&c(l)}),!a&&(!Object.keys(s).length||Object.keys(i).length)){setTimeout(t,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(l){return this.destroy(F(l,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');var o=this._cb;this._cb=null,o(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};t()}_onInterval(){if(!this._cb||!this._channel||this._channel.bufferedAmount>Ru)return;this._onChannelBufferedAmountLow()}_onSignalingStateChange(){if(this.destroyed)return;this._pc.signalingState==="stable"&&!this._firstStable&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(t=>{this._pc.removeTrack(t),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation&&(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()),this._debug("negotiate"),this.emit("negotiate")),this._firstStable=!1,this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState)}_onIceCandidate(t){if(this.destroyed)return;t.candidate&&this.trickle?this.emit("signal",{candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}}):!t.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),t.candidate&&this._startIceCompleteTimeout()}_onChannelMessage(t){if(this.destroyed)return;var e=t.data;e instanceof ArrayBuffer&&(e=new Uint8Array(e)),this.push(e)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var t=this._cb;this._cb=null,t(null)}_onChannelOpen(){if(this._connected||this.destroyed)return;this._debug("on channel open"),this._channelReady=!0,this._maybeReady()}_onChannelClose(){if(this.destroyed)return;this._debug("on channel close"),this.destroy()}_onTrack(t){if(this.destroyed)return;t.streams.forEach(e=>{if(this._debug("on track"),this.emit("track",t.track,e),this._remoteTracks.push({track:t.track,stream:e}),this._remoteStreams.some(r=>r.id===e.id))return;this._remoteStreams.push(e),Iu(()=>{this.emit("stream",e)})})}_debug(){var t=[].slice.call(arguments);t[0]="["+this._id+"] "+t[0],tI.apply(null,t)}}ms.WEBRTC_SUPPORT=!!Xf(),ms.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},ms.channelConfig={};var Cm=ms;(function(){if(typeof globalThis=="object")return;Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__})();var Im=globalThis,sI={supportsFileReader:typeof self!="undefined"&&"FileReader"in self,supportsWebRTC:"RTCPeerConnection"in Im&&(typeof navigator!="undefined"&&typeof navigator.mediaDevices!="undefined")&&"getUserMedia"in navigator.mediaDevices,supportsWebRTCDataChannels:"RTCPeerConnection"in Im},aI=421,oI=290,cI=2e3,ku={CODE_P2P:aI,CODE_CIRCUIT:oI,CLOSE_TIMEOUT:cI},lI=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,uI=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Pu=function(e){var r=e,n=e.indexOf("["),i=e.indexOf("]");n!=-1&&i!=-1&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));for(var s=lI.exec(e||""),a={},c=14;c--;)a[uI[c]]=s[c]||"";return n!=-1&&i!=-1&&(a.source=r,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=dI(a,a.path),a.queryKey=pI(a,a.query),a};function dI(t,e){var r=/\/{2,9}/g,n=e.replace(r,"/").split("/");return(e.substr(0,1)=="/"||e.length===0)&&n.splice(0,1),e.substr(e.length-1,1)=="/"&&n.splice(n.length-1,1),n}function pI(t,e){var r={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,s){i&&(r[i]=s)}),r}var ja=1e3,Ua=ja*60,Fa=Ua*60,$a=Fa*24,hI=$a*365.25,fI=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return mI(t);if(r==="number"&&isNaN(t)===!1)return e.long?yI(t):gI(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function mI(t){if(t=String(t),t.length>100)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*hI;case"days":case"day":case"d":return r*$a;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Fa;case"minutes":case"minute":case"mins":case"min":case"m":return r*Ua;case"seconds":case"second":case"secs":case"sec":case"s":return r*ja;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}function gI(t){return t>=$a?Math.round(t/$a)+"d":t>=Fa?Math.round(t/Fa)+"h":t>=Ua?Math.round(t/Ua)+"m":t>=ja?Math.round(t/ja)+"s":t+"ms"}function yI(t){return ic(t,$a,"day")||ic(t,Fa,"hour")||ic(t,Ua,"minute")||ic(t,ja,"second")||t+" ms"}function ic(t,e,r){return t<e?void 0:t<e*1.5?Math.floor(t/e)+" "+r:Math.ceil(t/e)+" "+r+"s"}var bI=ee(function(t,e){e=t.exports=n.debug=n.default=n,e.coerce=o,e.disable=a,e.enable=s,e.enabled=c,e.humanize=fI,e.instances=[],e.names=[],e.skips=[],e.formatters={};function r(l){var u=0,h;for(h in l)u=(u<<5)-u+l.charCodeAt(h),u|=0;return e.colors[Math.abs(u)%e.colors.length]}function n(l){var u;function h(){if(!h.enabled)return;var S=h,p=+new Date,C=p-(u||p);S.diff=C,S.prev=u,S.curr=p,u=p;for(var T=new Array(arguments.length),E=0;E<T.length;E++)T[E]=arguments[E];T[0]=e.coerce(T[0]),typeof T[0]!="string"&&T.unshift("%O");var I=0;T[0]=T[0].replace(/%([a-zA-Z%])/g,function(q,m){if(q==="%%")return q;I++;var b=e.formatters[m];if(typeof b=="function"){var A=T[I];q=b.call(S,A),T.splice(I,1),I--}return q}),e.formatArgs.call(S,T);var x=h.log||e.log||console.log.bind(console);x.apply(S,T)}return h.namespace=l,h.enabled=e.enabled(l),h.useColors=e.useColors(),h.color=r(l),h.destroy=i,typeof e.init=="function"&&e.init(h),e.instances.push(h),h}function i(){var l=e.instances.indexOf(this);return l!==-1?(e.instances.splice(l,1),!0):!1}function s(l){e.save(l),e.names=[],e.skips=[];var u,h=(typeof l=="string"?l:"").split(/[\s,]+/),S=h.length;for(u=0;u<S;u++){if(!h[u])continue;l=h[u].replace(/\*/g,".*?"),l[0]==="-"?e.skips.push(new RegExp("^"+l.substr(1)+"$")):e.names.push(new RegExp("^"+l+"$"))}for(u=0;u<e.instances.length;u++){var p=e.instances[u];p.enabled=e.enabled(p.namespace)}}function a(){e.enable("")}function c(l){if(l[l.length-1]==="*")return!0;var u,h;for(u=0,h=e.skips.length;u<h;u++)if(e.skips[u].test(l))return!1;for(u=0,h=e.names.length;u<h;u++)if(e.names[u].test(l))return!0;return!1}function o(l){return l instanceof Error?l.stack||l.message:l}}),sc=ee(function(t,e){e=t.exports=bI,e.log=i,e.formatArgs=n,e.save=s,e.load=a,e.useColors=r,e.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:c(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&window.process.type==="renderer"?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}e.formatters.j=function(o){try{return JSON.stringify(o)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}};function n(o){var l=this.useColors;if(o[0]=(l?"%c":"")+this.namespace+(l?" %c":" ")+o[0]+(l?"%c ":" ")+"+"+e.humanize(this.diff),!l)return;var u="color: "+this.color;o.splice(1,0,u,"color: inherit");var h=0,S=0;o[0].replace(/%[a-zA-Z%]/g,function(p){if(p==="%%")return;h++,p==="%c"&&(S=h)}),o.splice(S,0,u)}function i(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(o){try{o==null?e.storage.removeItem("debug"):e.storage.debug=o}catch(l){}}function a(){var o;try{o=e.storage.debug}catch(l){}return!o&&typeof fe!="undefined"&&"env"in fe&&(o=fe.env.DEBUG),o}e.enable(a());function c(){try{return window.localStorage}catch(o){}}}),Rm=sc("socket.io-client:url"),vI=wI;function wI(t,e){var r=t;e=e||typeof location!="undefined"&&location,t==null&&(t=e.protocol+"//"+e.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=e.protocol+t:t=e.host+t),/^(https?|wss?):\/\//.test(t)||(Rm("protocol-less url %s",t),typeof e!="undefined"?t=e.protocol+"//"+t:t="https://"+t),Rm("parse %s",t),r=Pu(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var n=r.host.indexOf(":")!==-1,i=n?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port,r.href=r.protocol+"://"+i+(e&&e.port===r.port?"":":"+r.port),r}var qa=1e3,Ga=qa*60,Va=Ga*60,Ha=Va*24,SI=Ha*365.25,_I=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return EI(t);if(r==="number"&&isNaN(t)===!1)return e.long?AI(t):TI(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function EI(t){if(t=String(t),t.length>100)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*SI;case"days":case"day":case"d":return r*Ha;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Va;case"minutes":case"minute":case"mins":case"min":case"m":return r*Ga;case"seconds":case"second":case"secs":case"sec":case"s":return r*qa;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}function TI(t){return t>=Ha?Math.round(t/Ha)+"d":t>=Va?Math.round(t/Va)+"h":t>=Ga?Math.round(t/Ga)+"m":t>=qa?Math.round(t/qa)+"s":t+"ms"}function AI(t){return ac(t,Ha,"day")||ac(t,Va,"hour")||ac(t,Ga,"minute")||ac(t,qa,"second")||t+" ms"}function ac(t,e,r){return t<e?void 0:t<e*1.5?Math.floor(t/e)+" "+r:Math.ceil(t/e)+" "+r+"s"}var CI=ee(function(t,e){e=t.exports=n.debug=n.default=n,e.coerce=o,e.disable=a,e.enable=s,e.enabled=c,e.humanize=_I,e.instances=[],e.names=[],e.skips=[],e.formatters={};function r(l){var u=0,h;for(h in l)u=(u<<5)-u+l.charCodeAt(h),u|=0;return e.colors[Math.abs(u)%e.colors.length]}function n(l){var u;function h(){if(!h.enabled)return;var S=h,p=+new Date,C=p-(u||p);S.diff=C,S.prev=u,S.curr=p,u=p;for(var T=new Array(arguments.length),E=0;E<T.length;E++)T[E]=arguments[E];T[0]=e.coerce(T[0]),typeof T[0]!="string"&&T.unshift("%O");var I=0;T[0]=T[0].replace(/%([a-zA-Z%])/g,function(q,m){if(q==="%%")return q;I++;var b=e.formatters[m];if(typeof b=="function"){var A=T[I];q=b.call(S,A),T.splice(I,1),I--}return q}),e.formatArgs.call(S,T);var x=h.log||e.log||console.log.bind(console);x.apply(S,T)}return h.namespace=l,h.enabled=e.enabled(l),h.useColors=e.useColors(),h.color=r(l),h.destroy=i,typeof e.init=="function"&&e.init(h),e.instances.push(h),h}function i(){var l=e.instances.indexOf(this);return l!==-1?(e.instances.splice(l,1),!0):!1}function s(l){e.save(l),e.names=[],e.skips=[];var u,h=(typeof l=="string"?l:"").split(/[\s,]+/),S=h.length;for(u=0;u<S;u++){if(!h[u])continue;l=h[u].replace(/\*/g,".*?"),l[0]==="-"?e.skips.push(new RegExp("^"+l.substr(1)+"$")):e.names.push(new RegExp("^"+l+"$"))}for(u=0;u<e.instances.length;u++){var p=e.instances[u];p.enabled=e.enabled(p.namespace)}}function a(){e.enable("")}function c(l){if(l[l.length-1]==="*")return!0;var u,h;for(u=0,h=e.skips.length;u<h;u++)if(e.skips[u].test(l))return!1;for(u=0,h=e.names.length;u<h;u++)if(e.names[u].test(l))return!0;return!1}function o(l){return l instanceof Error?l.stack||l.message:l}}),II=ee(function(t,e){e=t.exports=CI,e.log=i,e.formatArgs=n,e.save=s,e.load=a,e.useColors=r,e.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:c(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&window.process.type==="renderer"?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}e.formatters.j=function(o){try{return JSON.stringify(o)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}};function n(o){var l=this.useColors;if(o[0]=(l?"%c":"")+this.namespace+(l?" %c":" ")+o[0]+(l?"%c ":" ")+"+"+e.humanize(this.diff),!l)return;var u="color: "+this.color;o.splice(1,0,u,"color: inherit");var h=0,S=0;o[0].replace(/%[a-zA-Z%]/g,function(p){if(p==="%%")return;h++,p==="%c"&&(S=h)}),o.splice(S,0,u)}function i(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(o){try{o==null?e.storage.removeItem("debug"):e.storage.debug=o}catch(l){}}function a(){var o;try{o=e.storage.debug}catch(l){}return!o&&typeof fe!="undefined"&&"env"in fe&&(o=fe.env.DEBUG),o}e.enable(a());function c(){try{return window.localStorage}catch(o){}}}),wi=ee(function(t){t.exports=e;function e(n){if(n)return r(n)}function r(n){for(var i in e.prototype)n[i]=e.prototype[i];return n}e.prototype.on=e.prototype.addEventListener=function(n,i){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(i),this},e.prototype.once=function(n,i){function s(){this.off(n,s),i.apply(this,arguments)}return s.fn=i,this.on(n,s),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(n,i){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var s=this._callbacks["$"+n];if(!s)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var a,c=0;c<s.length;c++)if(a=s[c],a===i||a.fn===i){s.splice(c,1);break}return s.length===0&&delete this._callbacks["$"+n],this},e.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var i=new Array(arguments.length-1),s=this._callbacks["$"+n],a=1;a<arguments.length;a++)i[a-1]=arguments[a];if(s){s=s.slice(0);for(var a=0,c=s.length;a<c;++a)s[a].apply(this,i)}return this},e.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]},e.prototype.hasListeners=function(n){return!!this.listeners(n).length}}),RI={}.toString,za=Array.isArray||function(t){return RI.call(t)=="[object Array]"},Nu=OI,kI=typeof Buffer=="function"&&typeof Buffer.isBuffer=="function",PI=typeof ArrayBuffer=="function",NI=function(t){return typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer};function OI(t){return kI&&Buffer.isBuffer(t)||PI&&(t instanceof ArrayBuffer||NI(t))}var km=Object.prototype.toString,MI=typeof Blob=="function"||typeof Blob!="undefined"&&km.call(Blob)==="[object BlobConstructor]",DI=typeof File=="function"||typeof File!="undefined"&&km.call(File)==="[object FileConstructor]",xI=function(t){var e=[],r=t.data,n=t;return n.data=Ou(r,e),n.attachments=e.length,{packet:n,buffers:e}};function Ou(t,e){if(!t)return t;if(Nu(t)){var r={_placeholder:!0,num:e.length};return e.push(t),r}else if(za(t)){for(var n=new Array(t.length),i=0;i<t.length;i++)n[i]=Ou(t[i],e);return n}else if(typeof t=="object"&&!(t instanceof Date)){var n={};for(var s in t)n[s]=Ou(t[s],e);return n}return t}var LI=function(t,e){return t.data=Mu(t.data,e),t.attachments=void 0,t};function Mu(t,e){if(!t)return t;if(t&&t._placeholder)return e[t.num];if(za(t))for(var r=0;r<t.length;r++)t[r]=Mu(t[r],e);else if(typeof t=="object")for(var n in t)t[n]=Mu(t[n],e);return t}var BI=function(t,e){function r(s,a,c){if(!s)return s;if(MI&&s instanceof Blob||DI&&s instanceof File){n++;var o=new FileReader;o.onload=function(){c?c[a]=this.result:i=this.result,--n||e(i)},o.readAsArrayBuffer(s)}else if(za(s))for(var l=0;l<s.length;l++)r(s[l],l,s);else if(typeof s=="object"&&!Nu(s))for(var u in s)r(s[u],u,s)}var n=0,i=t;r(i),n||e(i)},Du={deconstructPacket:xI,reconstructPacket:LI,removeBlobs:BI},mt=ee(function(t,e){var r=II("socket.io-parser");e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=n,e.Decoder=o;function n(){}var i=e.ERROR+'"encode error"';n.prototype.encode=function(p,C){if(r("encoding packet %j",p),e.BINARY_EVENT===p.type||e.BINARY_ACK===p.type)c(p,C);else{var T=s(p);C([T])}};function s(p){var C=""+p.type;if((e.BINARY_EVENT===p.type||e.BINARY_ACK===p.type)&&(C+=p.attachments+"-"),p.nsp&&p.nsp!=="/"&&(C+=p.nsp+","),p.id!=null&&(C+=p.id),p.data!=null){var T=a(p.data);if(T!==!1)C+=T;else return i}return r("encoded %j as %s",p,C),C}function a(p){try{return JSON.stringify(p)}catch(C){return!1}}function c(p,C){function T(E){var I=Du.deconstructPacket(E),x=s(I.packet),q=I.buffers;q.unshift(x),C(q)}Du.removeBlobs(p,T)}function o(){this.reconstructor=null}wi(o.prototype),o.prototype.add=function(p){var C;if(typeof p=="string")C=l(p),e.BINARY_EVENT===C.type||e.BINARY_ACK===C.type?(this.reconstructor=new h(C),this.reconstructor.reconPack.attachments===0&&this.emit("decoded",C)):this.emit("decoded",C);else if(Nu(p)||p.base64)if(this.reconstructor)C=this.reconstructor.takeBinaryData(p),C&&(this.reconstructor=null,this.emit("decoded",C));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+p)};function l(p){var C=0,T={type:Number(p.charAt(0))};if(e.types[T.type]==null)return S("unknown packet type "+T.type);if(e.BINARY_EVENT===T.type||e.BINARY_ACK===T.type){for(var E="";p.charAt(++C)!=="-"&&!(E+=p.charAt(C),C==p.length););if(E!=Number(E)||p.charAt(C)!=="-")throw new Error("Illegal attachments");T.attachments=Number(E)}if(p.charAt(C+1)==="/")for(T.nsp="";++C;){var I=p.charAt(C);if(I===",")break;if(T.nsp+=I,C===p.length)break}else T.nsp="/";var x=p.charAt(C+1);if(x!==""&&Number(x)==x){for(T.id="";++C;){var I=p.charAt(C);if(I==null||Number(I)!=I){--C;break}if(T.id+=p.charAt(C),C===p.length)break}T.id=Number(T.id)}if(p.charAt(++C)){var q=u(p.substr(C)),m=q!==!1&&(T.type===e.ERROR||za(q));if(m)T.data=q;else return S("invalid payload")}return r("decoded %s as %j",p,T),T}function u(p){try{return JSON.parse(p)}catch(C){return!1}}o.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};function h(p){this.reconPack=p,this.buffers=[]}h.prototype.takeBinaryData=function(p){if(this.buffers.push(p),this.buffers.length===this.reconPack.attachments){var C=Du.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),C}return null},h.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]};function S(p){return{type:e.ERROR,data:"parser error: "+p}}}),jI=ee(function(t){try{t.exports=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}}),oc=function(){return typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")()}(),xu=function(t){var e=t.xdomain,r=t.xscheme,n=t.enablesXDR;try{if(typeof XMLHttpRequest!="undefined"&&(!e||jI))return new XMLHttpRequest}catch(i){}try{if(typeof XDomainRequest!="undefined"&&!r&&n)return new XDomainRequest}catch(i){}if(!e)try{return new oc[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(i){}},UI=Object.keys||function(e){var r=[],n=Object.prototype.hasOwnProperty;for(var i in e)n.call(e,i)&&r.push(i);return r},Pm=Object.prototype.toString,FI=typeof Blob=="function"||typeof Blob!="undefined"&&Pm.call(Blob)==="[object BlobConstructor]",$I=typeof File=="function"||typeof File!="undefined"&&Pm.call(File)==="[object FileConstructor]",Lu=cc;function cc(t){if(!t||typeof t!="object")return!1;if(za(t)){for(var e=0,r=t.length;e<r;e++)if(cc(t[e]))return!0;return!1}if(typeof Buffer=="function"&&Buffer.isBuffer&&Buffer.isBuffer(t)||typeof ArrayBuffer=="function"&&t instanceof ArrayBuffer||FI&&t instanceof Blob||$I&&t instanceof File)return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return cc(t.toJSON(),!0);for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&cc(t[n]))return!0;return!1}var lc=function(t,e,r){var n=t.byteLength;if(e=e||0,r=r||n,t.slice)return t.slice(e,r);if(e<0&&(e+=n),r<0&&(r+=n),r>n&&(r=n),e>=n||e>=r||n===0)return new ArrayBuffer(0);for(var i=new Uint8Array(t),s=new Uint8Array(r-e),a=e,c=0;a<r;a++,c++)s[c]=i[a];return s.buffer},qI=GI;function GI(t,e,r){var n=!1;return r=r||VI,i.count=t,t===0?e():i;function i(s,a){if(i.count<=0)throw new Error("after called too many times");--i.count,s?(n=!0,e(s),e=r):i.count===0&&!n&&e(null,a)}}function VI(){}/*! https://mths.be/utf8js v2.1.2 by @mathias */var jn=String.fromCharCode;function Nm(t){for(var e=[],r=0,n=t.length,i,s;r<n;)i=t.charCodeAt(r++),i>=55296&&i<=56319&&r<n?(s=t.charCodeAt(r++),(s&64512)==56320?e.push(((i&1023)<<10)+(s&1023)+65536):(e.push(i),r--)):e.push(i);return e}function HI(t){for(var e=t.length,r=-1,n,i="";++r<e;)n=t[r],n>65535&&(n-=65536,i+=jn(n>>>10&1023|55296),n=56320|n&1023),i+=jn(n);return i}function Om(t,e){if(t>=55296&&t<=57343){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function Bu(t,e){return jn(t>>e&63|128)}function zI(t,e){if((t&4294967168)==0)return jn(t);var r="";return(t&4294965248)==0?r=jn(t>>6&31|192):(t&4294901760)==0?(Om(t,e)||(t=65533),r=jn(t>>12&15|224),r+=Bu(t,6)):(t&4292870144)==0&&(r=jn(t>>18&7|240),r+=Bu(t,12),r+=Bu(t,6)),r+=jn(t&63|128),r}function WI(t,e){e=e||{};for(var r=e.strict!==!1,n=Nm(t),i=n.length,s=-1,a,c="";++s<i;)a=n[s],c+=zI(a,r);return c}function gs(){if(Un>=dc)throw Error("Invalid byte index");var t=uc[Un]&255;if(Un++,(t&192)==128)return t&63;throw Error("Invalid continuation byte")}function KI(t){var e,r,n,i,s;if(Un>dc)throw Error("Invalid byte index");if(Un==dc)return!1;if(e=uc[Un]&255,Un++,(e&128)==0)return e;if((e&224)==192){if(r=gs(),s=(e&31)<<6|r,s>=128)return s;throw Error("Invalid continuation byte")}if((e&240)==224){if(r=gs(),n=gs(),s=(e&15)<<12|r<<6|n,s>=2048)return Om(s,t)?s:65533;throw Error("Invalid continuation byte")}if((e&248)==240&&(r=gs(),n=gs(),i=gs(),s=(e&7)<<18|r<<12|n<<6|i,s>=65536&&s<=1114111))return s;throw Error("Invalid UTF-8 detected")}var uc,dc,Un;function XI(t,e){e=e||{};var r=e.strict!==!1;uc=Nm(t),dc=uc.length,Un=0;for(var n=[],i;(i=KI(r))!==!1;)n.push(i);return HI(n)}var Mm={version:"2.1.2",encode:WI,decode:XI},QI=ee(function(t,e){(function(r){e.encode=function(n){var i=new Uint8Array(n),s,a=i.length,c="";for(s=0;s<a;s+=3)c+=r[i[s]>>2],c+=r[(i[s]&3)<<4|i[s+1]>>4],c+=r[(i[s+1]&15)<<2|i[s+2]>>6],c+=r[i[s+2]&63];return a%3===2?c=c.substring(0,c.length-1)+"=":a%3===1&&(c=c.substring(0,c.length-2)+"=="),c},e.decode=function(n){var i=n.length*.75,s=n.length,a,c=0,o,l,u,h;n[n.length-1]==="="&&(i--,n[n.length-2]==="="&&i--);var S=new ArrayBuffer(i),p=new Uint8Array(S);for(a=0;a<s;a+=4)o=r.indexOf(n[a]),l=r.indexOf(n[a+1]),u=r.indexOf(n[a+2]),h=r.indexOf(n[a+3]),p[c++]=o<<2|l>>4,p[c++]=(l&15)<<4|u>>2,p[c++]=(u&3)<<6|h&63;return S}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")}),ys=typeof ys!="undefined"?ys:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:!1,Dm=function(){try{var t=new Blob(["hi"]);return t.size===2}catch(e){return!1}}(),YI=Dm&&function(){try{var t=new Blob([new Uint8Array([1,2])]);return t.size===2}catch(e){return!1}}(),JI=ys&&ys.prototype.append&&ys.prototype.getBlob;function xm(t){return t.map(function(e){if(e.buffer instanceof ArrayBuffer){var r=e.buffer;if(e.byteLength!==r.byteLength){var n=new Uint8Array(e.byteLength);n.set(new Uint8Array(r,e.byteOffset,e.byteLength)),r=n.buffer}return r}return e})}function Lm(t,e){e=e||{};var r=new ys;return xm(t).forEach(function(n){r.append(n)}),e.type?r.getBlob(e.type):r.getBlob()}function Bm(t,e){return new Blob(xm(t),e||{})}typeof Blob!="undefined"&&(Lm.prototype=Blob.prototype,Bm.prototype=Blob.prototype);var Xt=function(){return Dm?YI?Blob:Bm:JI?Lm:void 0}(),Fn=ee(function(t,e){var r;typeof ArrayBuffer!="undefined"&&(r=QI);var n=typeof navigator!="undefined"&&/Android/i.test(navigator.userAgent),i=typeof navigator!="undefined"&&/PhantomJS/i.test(navigator.userAgent),s=n||i;e.protocol=3;var a=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},c=UI(a),o={type:"error",data:"parser error"};e.encodePacket=function(T,E,I,x){typeof E=="function"&&(x=E,E=!1),typeof I=="function"&&(x=I,I=null);var q=T.data===void 0?void 0:T.data.buffer||T.data;if(typeof ArrayBuffer!="undefined"&&q instanceof ArrayBuffer)return u(T,E,x);if(typeof Xt!="undefined"&&q instanceof Xt)return S(T,E,x);if(q&&q.base64)return l(T,x);var m=a[T.type];return T.data!==void 0&&(m+=I?Mm.encode(String(T.data),{strict:!1}):String(T.data)),x(""+m)};function l(T,E){var I="b"+e.packets[T.type]+T.data.data;return E(I)}function u(T,E,I){if(!E)return e.encodeBase64Packet(T,I);var x=T.data,q=new Uint8Array(x),m=new Uint8Array(1+x.byteLength);m[0]=a[T.type];for(var b=0;b<q.length;b++)m[b+1]=q[b];return I(m.buffer)}function h(T,E,I){if(!E)return e.encodeBase64Packet(T,I);var x=new FileReader;return x.onload=function(){e.encodePacket({type:T.type,data:x.result},E,!0,I)},x.readAsArrayBuffer(T.data)}function S(T,E,I){if(!E)return e.encodeBase64Packet(T,I);if(s)return h(T,E,I);var x=new Uint8Array(1);x[0]=a[T.type];var q=new Xt([x.buffer,T.data]);return I(q)}e.encodeBase64Packet=function(T,E){var I="b"+e.packets[T.type];if(typeof Xt!="undefined"&&T.data instanceof Xt){var x=new FileReader;return x.onload=function(){var d=x.result.split(",")[1];E(I+d)},x.readAsDataURL(T.data)}var q;try{q=String.fromCharCode.apply(null,new Uint8Array(T.data))}catch(d){for(var m=new Uint8Array(T.data),b=new Array(m.length),A=0;A<m.length;A++)b[A]=m[A];q=String.fromCharCode.apply(null,b)}return I+=btoa(q),E(I)},e.decodePacket=function(T,E,I){if(T===void 0)return o;if(typeof T=="string"){if(T.charAt(0)==="b")return e.decodeBase64Packet(T.substr(1),E);if(I&&(T=p(T),T===!1))return o;var q=T.charAt(0);return Number(q)!=q||!c[q]?o:T.length>1?{type:c[q],data:T.substring(1)}:{type:c[q]}}var x=new Uint8Array(T),q=x[0],m=lc(T,1);return Xt&&E==="blob"&&(m=new Xt([m])),{type:c[q],data:m}};function p(T){try{T=Mm.decode(T,{strict:!1})}catch(E){return!1}return T}e.decodeBase64Packet=function(T,E){var I=c[T.charAt(0)];if(!r)return{type:I,data:{base64:!0,data:T.substr(1)}};var x=r.decode(T.substr(1));return E==="blob"&&Xt&&(x=new Xt([x])),{type:I,data:x}},e.encodePayload=function(T,E,I){typeof E=="function"&&(I=E,E=null);var x=Lu(T);if(E&&x)return Xt&&!s?e.encodePayloadAsBlob(T,I):e.encodePayloadAsArrayBuffer(T,I);if(!T.length)return I("0:");function q(b){return b.length+":"+b}function m(b,A){e.encodePacket(b,x?E:!1,!1,function(d){A(null,q(d))})}C(T,m,function(b,A){return I(A.join(""))})};function C(T,E,I){for(var x=new Array(T.length),q=qI(T.length,I),m=function(A,d,f){E(d,function(_,y){x[A]=y,f(_,x)})},b=0;b<T.length;b++)m(b,T[b],q)}e.decodePayload=function(T,E,I){if(typeof T!="string")return e.decodePayloadAsBinary(T,E,I);typeof E=="function"&&(I=E,E=null);var x;if(T==="")return I(o,0,1);for(var q="",m,b,A=0,d=T.length;A<d;A++){var f=T.charAt(A);if(f!==":"){q+=f;continue}if(q===""||q!=(m=Number(q)))return I(o,0,1);if(b=T.substr(A+1,m),q!=b.length)return I(o,0,1);if(b.length){if(x=e.decodePacket(b,E,!1),o.type===x.type&&o.data===x.data)return I(o,0,1);var _=I(x,A+m,d);if(_===!1)return}A+=m,q=""}if(q!=="")return I(o,0,1)},e.encodePayloadAsArrayBuffer=function(T,E){if(!T.length)return E(new ArrayBuffer(0));function I(x,q){e.encodePacket(x,!0,!0,function(m){return q(null,m)})}C(T,I,function(x,q){var m=q.reduce(function(d,f){var _;return typeof f=="string"?_=f.length:_=f.byteLength,d+_.toString().length+_+2},0),b=new Uint8Array(m),A=0;return q.forEach(function(d){var f=typeof d=="string",_=d;if(f){for(var N=new Uint8Array(d.length),y=0;y<d.length;y++)N[y]=d.charCodeAt(y);_=N.buffer}f?b[A++]=0:b[A++]=1;for(var k=_.byteLength.toString(),y=0;y<k.length;y++)b[A++]=parseInt(k[y]);b[A++]=255;for(var N=new Uint8Array(_),y=0;y<N.length;y++)b[A++]=N[y]}),E(b.buffer)})},e.encodePayloadAsBlob=function(T,E){function I(x,q){e.encodePacket(x,!0,!0,function(m){var b=new Uint8Array(1);if(b[0]=1,typeof m=="string"){for(var A=new Uint8Array(m.length),d=0;d<m.length;d++)A[d]=m.charCodeAt(d);m=A.buffer,b[0]=0}for(var f=m instanceof ArrayBuffer?m.byteLength:m.size,_=f.toString(),y=new Uint8Array(_.length+1),d=0;d<_.length;d++)y[d]=parseInt(_[d]);if(y[_.length]=255,Xt){var k=new Xt([b.buffer,y.buffer,m]);q(null,k)}})}C(T,I,function(x,q){return E(new Xt(q))})},e.decodePayloadAsBinary=function(T,E,I){typeof E=="function"&&(I=E,E=null);for(var x=T,q=[];x.byteLength>0;){for(var m=new Uint8Array(x),b=m[0]===0,A="",d=1;!(m[d]===255);d++){if(A.length>310)return I(o,0,1);A+=m[d]}x=lc(x,2+A.length),A=parseInt(A);var f=lc(x,0,A);if(b)try{f=String.fromCharCode.apply(null,new Uint8Array(f))}catch(k){var _=new Uint8Array(f);f="";for(var d=0;d<_.length;d++)f+=String.fromCharCode(_[d])}q.push(f),x=lc(x,A)}var y=q.length;q.forEach(function(k,N){I(e.decodePacket(k,E,!0),N,y)})}}),bs=$r;function $r(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.isReactNative=t.isReactNative,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}wi($r.prototype),$r.prototype.onError=function(t,e){var r=new Error(t);return r.type="TransportError",r.description=e,this.emit("error",r),this},$r.prototype.open=function(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this},$r.prototype.close=function(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this},$r.prototype.send=function(t){if(this.readyState==="open")this.write(t);else throw new Error("Transport not open")},$r.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},$r.prototype.onData=function(t){var e=Fn.decodePacket(t,this.socket.binaryType);this.onPacket(e)},$r.prototype.onPacket=function(t){this.emit("packet",t)},$r.prototype.onClose=function(){this.readyState="closed",this.emit("close")};var ZI=function(t){var e="";for(var r in t)t.hasOwnProperty(r)&&(e.length&&(e+="&"),e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e},eR=function(t){for(var e={},r=t.split("&"),n=0,i=r.length;n<i;n++){var s=r[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e},pc={encode:ZI,decode:eR},hc=function(t,e){var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t},jm="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),fc=64,Um={},Fm=0,$n=0,$m;function ju(t){var e="";do e=jm[t%fc]+e,t=Math.floor(t/fc);while(t>0);return e}function tR(t){var e=0;for($n=0;$n<t.length;$n++)e=e*fc+Um[t.charAt($n)];return e}function Uu(){var t=ju(+new Date);return t!==$m?(Fm=0,$m=t):t+"."+ju(Fm++)}for(;$n<fc;$n++)Um[jm[$n]]=$n;Uu.encode=ju,Uu.decode=tR;var qm=Uu,Wa=1e3,Ka=Wa*60,Xa=Ka*60,Qa=Xa*24,rR=Qa*365.25,nR=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return iR(t);if(r==="number"&&isNaN(t)===!1)return e.long?aR(t):sR(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function iR(t){if(t=String(t),t.length>100)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*rR;case"days":case"day":case"d":return r*Qa;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Xa;case"minutes":case"minute":case"mins":case"min":case"m":return r*Ka;case"seconds":case"second":case"secs":case"sec":case"s":return r*Wa;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}function sR(t){return t>=Qa?Math.round(t/Qa)+"d":t>=Xa?Math.round(t/Xa)+"h":t>=Ka?Math.round(t/Ka)+"m":t>=Wa?Math.round(t/Wa)+"s":t+"ms"}function aR(t){return mc(t,Qa,"day")||mc(t,Xa,"hour")||mc(t,Ka,"minute")||mc(t,Wa,"second")||t+" ms"}function mc(t,e,r){return t<e?void 0:t<e*1.5?Math.floor(t/e)+" "+r:Math.ceil(t/e)+" "+r+"s"}var oR=ee(function(t,e){e=t.exports=n.debug=n.default=n,e.coerce=o,e.disable=a,e.enable=s,e.enabled=c,e.humanize=nR,e.instances=[],e.names=[],e.skips=[],e.formatters={};function r(l){var u=0,h;for(h in l)u=(u<<5)-u+l.charCodeAt(h),u|=0;return e.colors[Math.abs(u)%e.colors.length]}function n(l){var u;function h(){if(!h.enabled)return;var S=h,p=+new Date,C=p-(u||p);S.diff=C,S.prev=u,S.curr=p,u=p;for(var T=new Array(arguments.length),E=0;E<T.length;E++)T[E]=arguments[E];T[0]=e.coerce(T[0]),typeof T[0]!="string"&&T.unshift("%O");var I=0;T[0]=T[0].replace(/%([a-zA-Z%])/g,function(q,m){if(q==="%%")return q;I++;var b=e.formatters[m];if(typeof b=="function"){var A=T[I];q=b.call(S,A),T.splice(I,1),I--}return q}),e.formatArgs.call(S,T);var x=h.log||e.log||console.log.bind(console);x.apply(S,T)}return h.namespace=l,h.enabled=e.enabled(l),h.useColors=e.useColors(),h.color=r(l),h.destroy=i,typeof e.init=="function"&&e.init(h),e.instances.push(h),h}function i(){var l=e.instances.indexOf(this);return l!==-1?(e.instances.splice(l,1),!0):!1}function s(l){e.save(l),e.names=[],e.skips=[];var u,h=(typeof l=="string"?l:"").split(/[\s,]+/),S=h.length;for(u=0;u<S;u++){if(!h[u])continue;l=h[u].replace(/\*/g,".*?"),l[0]==="-"?e.skips.push(new RegExp("^"+l.substr(1)+"$")):e.names.push(new RegExp("^"+l+"$"))}for(u=0;u<e.instances.length;u++){var p=e.instances[u];p.enabled=e.enabled(p.namespace)}}function a(){e.enable("")}function c(l){if(l[l.length-1]==="*")return!0;var u,h;for(u=0,h=e.skips.length;u<h;u++)if(e.skips[u].test(l))return!1;for(u=0,h=e.names.length;u<h;u++)if(e.names[u].test(l))return!0;return!1}function o(l){return l instanceof Error?l.stack||l.message:l}}),gc=ee(function(t,e){e=t.exports=oR,e.log=i,e.formatArgs=n,e.save=s,e.load=a,e.useColors=r,e.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:c(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&window.process.type==="renderer"?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}e.formatters.j=function(o){try{return JSON.stringify(o)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}};function n(o){var l=this.useColors;if(o[0]=(l?"%c":"")+this.namespace+(l?" %c":" ")+o[0]+(l?"%c ":" ")+"+"+e.humanize(this.diff),!l)return;var u="color: "+this.color;o.splice(1,0,u,"color: inherit");var h=0,S=0;o[0].replace(/%[a-zA-Z%]/g,function(p){if(p==="%%")return;h++,p==="%c"&&(S=h)}),o.splice(S,0,u)}function i(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(o){try{o==null?e.storage.removeItem("debug"):e.storage.debug=o}catch(l){}}function a(){var o;try{o=e.storage.debug}catch(l){}return!o&&typeof fe!="undefined"&&"env"in fe&&(o=fe.env.DEBUG),o}e.enable(a());function c(){try{return window.localStorage}catch(o){}}}),Rr=gc("engine.io-client:polling"),Ya=qr,cR=function(){var t=xu,e=new t({xdomain:!1});return e.responseType!=null}();function qr(t){var e=t&&t.forceBase64;(!cR||e)&&(this.supportsBinary=!1),bs.call(this,t)}hc(qr,bs),qr.prototype.name="polling",qr.prototype.doOpen=function(){this.poll()},qr.prototype.pause=function(t){var e=this;this.readyState="pausing";function r(){Rr("paused"),e.readyState="paused",t()}if(this.polling||!this.writable){var n=0;this.polling&&(Rr("we are currently polling - waiting to pause"),n++,this.once("pollComplete",function(){Rr("pre-pause polling complete"),--n||r()})),this.writable||(Rr("we are currently writing - waiting to pause"),n++,this.once("drain",function(){Rr("pre-pause writing complete"),--n||r()}))}else r()},qr.prototype.poll=function(){Rr("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},qr.prototype.onData=function(t){var e=this;Rr("polling got data %s",t);var r=function(n,i,s){if(e.readyState==="opening"&&e.onOpen(),n.type==="close")return e.onClose(),!1;e.onPacket(n)};Fn.decodePayload(t,this.socket.binaryType,r),this.readyState!=="closed"&&(this.polling=!1,this.emit("pollComplete"),this.readyState==="open"?this.poll():Rr('ignoring poll - transport state "%s"',this.readyState))},qr.prototype.doClose=function(){var t=this;function e(){Rr("writing close packet"),t.write([{type:"close"}])}this.readyState==="open"?(Rr("transport open - closing"),e()):(Rr("transport not open - deferring close"),this.once("open",e))},qr.prototype.write=function(t){var e=this;this.writable=!1;var r=function(){e.writable=!0,e.emit("drain")};Fn.encodePayload(t,this.supportsBinary,function(n){e.doWrite(n,r)})},qr.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",r="";this.timestampRequests!==!1&&(t[this.timestampParam]=qm()),!this.supportsBinary&&!t.sid&&(t.b64=1),t=pc.encode(t),this.port&&(e==="https"&&Number(this.port)!==443||e==="http"&&Number(this.port)!==80)&&(r=":"+this.port),t.length&&(t="?"+t);var n=this.hostname.indexOf(":")!==-1;return e+"://"+(n?"["+this.hostname+"]":this.hostname)+r+this.path+t};var Fu=gc("engine.io-client:polling-xhr"),Gm=vs,lR=st;function Vm(){}function vs(t){if(Ya.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,typeof location!="undefined"){var e=location.protocol==="https:",r=location.port;r||(r=e?443:80),this.xd=typeof location!="undefined"&&t.hostname!==location.hostname||r!==t.port,this.xs=t.secure!==e}}hc(vs,Ya),vs.prototype.supportsBinary=!0,vs.prototype.request=function(t){return t=t||{},t.uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.withCredentials=this.withCredentials,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new st(t)},vs.prototype.doWrite=function(t,e){var r=typeof t!="string"&&t!==void 0,n=this.request({method:"POST",data:t,isBinary:r}),i=this;n.on("success",e),n.on("error",function(s){i.onError("xhr post error",s)}),this.sendXhr=n},vs.prototype.doPoll=function(){Fu("xhr poll");var t=this.request(),e=this;t.on("data",function(r){e.onData(r)}),t.on("error",function(r){e.onError("xhr poll error",r)}),this.pollXhr=t};function st(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}if(wi(st.prototype),st.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new xu(t),r=this;try{Fu("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(var n in this.extraHeaders)this.extraHeaders.hasOwnProperty(n)&&e.setRequestHeader(n,this.extraHeaders[n])}}catch(i){}if(this.method==="POST")try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(i){}try{e.setRequestHeader("Accept","*/*")}catch(i){}"withCredentials"in e&&(e.withCredentials=this.withCredentials),this.requestTimeout&&(e.timeout=this.requestTimeout),this.hasXDR()?(e.onload=function(){r.onLoad()},e.onerror=function(){r.onError(e.responseText)}):e.onreadystatechange=function(){if(e.readyState===2)try{var i=e.getResponseHeader("Content-Type");(r.supportsBinary&&i==="application/octet-stream"||i==="application/octet-stream; charset=UTF-8")&&(e.responseType="arraybuffer")}catch(s){}if(e.readyState!==4)return;e.status===200||e.status===1223?r.onLoad():setTimeout(function(){r.onError(typeof e.status=="number"?e.status:0)},0)},Fu("xhr data %s",this.data),e.send(this.data)}catch(i){setTimeout(function(){r.onError(i)},0);return}typeof document!="undefined"&&(this.index=st.requestsCount++,st.requests[this.index]=this)},st.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},st.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},st.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},st.prototype.cleanup=function(t){if(typeof this.xhr=="undefined"||this.xhr===null)return;if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=Vm:this.xhr.onreadystatechange=Vm,t)try{this.xhr.abort()}catch(e){}typeof document!="undefined"&&delete st.requests[this.index],this.xhr=null},st.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(r){}e==="application/octet-stream"||e==="application/octet-stream; charset=UTF-8"?t=this.xhr.response||this.xhr.responseText:t=this.xhr.responseText}catch(r){this.onError(r)}t!=null&&this.onData(t)},st.prototype.hasXDR=function(){return typeof XDomainRequest!="undefined"&&!this.xs&&this.enablesXDR},st.prototype.abort=function(){this.cleanup()},st.requestsCount=0,st.requests={},typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",Hm);else if(typeof addEventListener=="function"){var uR="onpagehide"in oc?"pagehide":"unload";addEventListener(uR,Hm,!1)}}function Hm(){for(var t in st.requests)st.requests.hasOwnProperty(t)&&st.requests[t].abort()}Gm.Request=lR;var dR=ws,pR=/\n/g,hR=/\\n/g,yc;function fR(){}function ws(t){Ya.call(this,t),this.query=this.query||{},yc||(yc=oc.___eio=oc.___eio||[]),this.index=yc.length;var e=this;yc.push(function(r){e.onData(r)}),this.query.j=this.index,typeof addEventListener=="function"&&addEventListener("beforeunload",function(){e.script&&(e.script.onerror=fR)},!1)}hc(ws,Ya),ws.prototype.supportsBinary=!1,ws.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),Ya.prototype.doClose.call(this)},ws.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(i){t.onError("jsonp poll error",i)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(e,r):(document.head||document.body).appendChild(e),this.script=e;var n=typeof navigator!="undefined"&&/gecko/i.test(navigator.userAgent);n&&setTimeout(function(){var i=document.createElement("iframe");document.body.appendChild(i),document.body.removeChild(i)},100)},ws.prototype.doWrite=function(t,e){var r=this;if(!this.form){var n=document.createElement("form"),i=document.createElement("textarea"),s=this.iframeId="eio_iframe_"+this.index,a;n.className="socketio",n.style.position="absolute",n.style.top="-1000px",n.style.left="-1000px",n.target=s,n.method="POST",n.setAttribute("accept-charset","utf-8"),i.name="d",n.appendChild(i),document.body.appendChild(n),this.form=n,this.area=i}this.form.action=this.uri();function c(){o(),e()}function o(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(u){r.onError("jsonp polling iframe removal error",u)}try{var l='<iframe src="javascript:0" name="'+r.iframeId+'">';a=document.createElement(l)}catch(u){a=document.createElement("iframe"),a.name=r.iframeId,a.src="javascript:0"}a.id=r.iframeId,r.form.appendChild(a),r.iframe=a}o(),t=t.replace(hR,`\\
`),this.area.value=t.replace(pR,"\\n");try{this.form.submit()}catch(l){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){r.iframe.readyState==="complete"&&c()}:this.iframe.onload=c};var mR=gc("engine.io-client:websocket"),bc,$u;if(typeof WebSocket!="undefined"?bc=WebSocket:typeof self!="undefined"&&(bc=self.WebSocket||self.MozWebSocket),typeof window=="undefined")try{$u=ai}catch(t){}var Ss=bc||$u,gR=fr;function fr(t){var e=t&&t.forceBase64;e&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=bc&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(Ss=$u),bs.call(this,t)}hc(fr,bs),fr.prototype.name="websocket",fr.prototype.supportsBinary=!0,fr.prototype.doOpen=function(){if(!this.check())return;var t=this.uri(),e=this.protocols,r={};this.isReactNative||(r.agent=this.agent,r.perMessageDeflate=this.perMessageDeflate,r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized),this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?e?new Ss(t,e):new Ss(t):new Ss(t,e,r)}catch(n){return this.emit("error",n)}this.ws.binaryType===void 0&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()},fr.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},fr.prototype.write=function(t){var e=this;this.writable=!1;for(var r=t.length,n=0,i=r;n<i;n++)(function(a){Fn.encodePacket(a,e.supportsBinary,function(c){if(!e.usingBrowserWebSocket){var o={};if(a.options&&(o.compress=a.options.compress),e.perMessageDeflate){var l=typeof c=="string"?Buffer.byteLength(c):c.length;l<e.perMessageDeflate.threshold&&(o.compress=!1)}}try{e.usingBrowserWebSocket?e.ws.send(c):e.ws.send(c,o)}catch(u){mR("websocket closed before onclose event")}--r||s()})})(t[n]);function s(){e.emit("flush"),setTimeout(function(){e.writable=!0,e.emit("drain")},0)}},fr.prototype.onClose=function(){bs.prototype.onClose.call(this)},fr.prototype.doClose=function(){typeof this.ws!="undefined"&&this.ws.close()},fr.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",r="";this.port&&(e==="wss"&&Number(this.port)!==443||e==="ws"&&Number(this.port)!==80)&&(r=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=qm()),this.supportsBinary||(t.b64=1),t=pc.encode(t),t.length&&(t="?"+t);var n=this.hostname.indexOf(":")!==-1;return e+"://"+(n?"["+this.hostname+"]":this.hostname)+r+this.path+t},fr.prototype.check=function(){return!!Ss&&!("__initialize"in Ss&&this.name===fr.prototype.name)};var yR=vR,bR=gR;function vR(t){var e,r=!1,n=!1,i=t.jsonp!==!1;if(typeof location!="undefined"){var s=location.protocol==="https:",a=location.port;a||(a=s?443:80),r=t.hostname!==location.hostname||a!==t.port,n=t.secure!==s}if(t.xdomain=r,t.xscheme=n,e=new xu(t),"open"in e&&!t.forceJSONP)return new Gm(t);if(!i)throw new Error("JSONP disabled");return new dR(t)}var zm={polling:yR,websocket:bR},wR=[].indexOf,qu=function(t,e){if(wR)return t.indexOf(e);for(var r=0;r<t.length;++r)if(t[r]===e)return r;return-1},Ze=gc("engine.io-client:socket"),SR=Ae;function Ae(t,e){if(!(this instanceof Ae))return new Ae(t,e);e=e||{},t&&typeof t=="object"&&(e=t,t=null),t?(t=Pu(t),e.hostname=t.host,e.secure=t.protocol==="https"||t.protocol==="wss",e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=Pu(e.host).host),this.secure=e.secure!=null?e.secure:typeof location!="undefined"&&location.protocol==="https:",e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.agent=e.agent||!1,this.hostname=e.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=e.port||(typeof location!="undefined"&&location.port?location.port:this.secure?443:80),this.query=e.query||{},typeof this.query=="string"&&(this.query=pc.decode(this.query)),this.upgrade=e.upgrade!==!1,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.jsonp=e.jsonp!==!1,this.forceBase64=!!e.forceBase64,this.enablesXDR=!!e.enablesXDR,this.withCredentials=e.withCredentials!==!1,this.timestampParam=e.timestampParam||"t",this.timestampRequests=e.timestampRequests,this.transports=e.transports||["polling","websocket"],this.transportOptions=e.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=e.policyPort||843,this.rememberUpgrade=e.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=e.onlyBinaryUpgrades,this.perMessageDeflate=e.perMessageDeflate!==!1?e.perMessageDeflate||{}:!1,this.perMessageDeflate===!0&&(this.perMessageDeflate={}),this.perMessageDeflate&&this.perMessageDeflate.threshold==null&&(this.perMessageDeflate.threshold=1024),this.pfx=e.pfx||null,this.key=e.key||null,this.passphrase=e.passphrase||null,this.cert=e.cert||null,this.ca=e.ca||null,this.ciphers=e.ciphers||null,this.rejectUnauthorized=e.rejectUnauthorized===void 0?!0:e.rejectUnauthorized,this.forceNode=!!e.forceNode,this.isReactNative=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",(typeof self=="undefined"||this.isReactNative)&&(e.extraHeaders&&Object.keys(e.extraHeaders).length>0&&(this.extraHeaders=e.extraHeaders),e.localAddress&&(this.localAddress=e.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}Ae.priorWebsocketSuccess=!1,wi(Ae.prototype),Ae.protocol=Fn.protocol,Ae.Socket=Ae,Ae.Transport=bs,Ae.transports=zm,Ae.parser=Fn,Ae.prototype.createTransport=function(t){Ze('creating transport "%s"',t);var e=_R(this.query);e.EIO=Fn.protocol,e.transport=t;var r=this.transportOptions[t]||{};this.id&&(e.sid=this.id);var n=new zm[t]({query:e,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,withCredentials:r.withCredentials||this.withCredentials,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0,isReactNative:this.isReactNative});return n};function _R(t){var e={};for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}Ae.prototype.open=function(){var t;if(this.rememberUpgrade&&Ae.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else if(this.transports.length===0){var e=this;setTimeout(function(){e.emit("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch(r){this.transports.shift(),this.open();return}t.open(),this.setTransport(t)},Ae.prototype.setTransport=function(t){Ze("setting transport %s",t.name);var e=this;this.transport&&(Ze("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.onDrain()}).on("packet",function(r){e.onPacket(r)}).on("error",function(r){e.onError(r)}).on("close",function(){e.onClose("transport close")})},Ae.prototype.probe=function(t){Ze('probing transport "%s"',t);var e=this.createTransport(t,{probe:1}),r=!1,n=this;Ae.priorWebsocketSuccess=!1;function i(){if(n.onlyBinaryUpgrades){var h=!this.supportsBinary&&n.transport.supportsBinary;r=r||h}if(r)return;Ze('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",function(S){if(r)return;if(S.type==="pong"&&S.data==="probe"){if(Ze('probe transport "%s" pong',t),n.upgrading=!0,n.emit("upgrading",e),!e)return;Ae.priorWebsocketSuccess=e.name==="websocket",Ze('pausing current transport "%s"',n.transport.name),n.transport.pause(function(){if(r)return;if(n.readyState==="closed")return;Ze("changing transport and sending upgrade packet"),u(),n.setTransport(e),e.send([{type:"upgrade"}]),n.emit("upgrade",e),e=null,n.upgrading=!1,n.flush()})}else{Ze('probe transport "%s" failed',t);var p=new Error("probe error");p.transport=e.name,n.emit("upgradeError",p)}})}function s(){if(r)return;r=!0,u(),e.close(),e=null}function a(h){var S=new Error("probe error: "+h);S.transport=e.name,s(),Ze('probe transport "%s" failed because of error: %s',t,h),n.emit("upgradeError",S)}function c(){a("transport closed")}function o(){a("socket closed")}function l(h){e&&h.name!==e.name&&(Ze('"%s" works - aborting "%s"',h.name,e.name),s())}function u(){e.removeListener("open",i),e.removeListener("error",a),e.removeListener("close",c),n.removeListener("close",o),n.removeListener("upgrading",l)}e.once("open",i),e.once("error",a),e.once("close",c),this.once("close",o),this.once("upgrading",l),e.open()},Ae.prototype.onOpen=function(){if(Ze("socket open"),this.readyState="open",Ae.priorWebsocketSuccess=this.transport.name==="websocket",this.emit("open"),this.flush(),this.readyState==="open"&&this.upgrade&&this.transport.pause){Ze("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},Ae.prototype.onPacket=function(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){Ze('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat");switch(t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data);break}}else Ze('packet received with socket readyState "%s"',this.readyState)},Ae.prototype.onHandshake=function(t){if(this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),this.readyState==="closed")return;this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat)},Ae.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){if(e.readyState==="closed")return;e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)},Ae.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout(function(){Ze("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)},t.pingInterval)},Ae.prototype.ping=function(){var t=this;this.sendPacket("ping",function(){t.emit("ping")})},Ae.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emit("drain"):this.flush()},Ae.prototype.flush=function(){this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(Ze("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Ae.prototype.write=Ae.prototype.send=function(t,e,r){return this.sendPacket("message",t,e,r),this},Ae.prototype.sendPacket=function(t,e,r,n){if(typeof e=="function"&&(n=e,e=void 0),typeof r=="function"&&(n=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;var i={type:t,data:e,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()},Ae.prototype.close=function(){if(this.readyState==="opening"||this.readyState==="open"){this.readyState="closing";var t=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():e()}):this.upgrading?n():e()}function e(){t.onClose("forced close"),Ze("socket closing - telling transport to close"),t.transport.close()}function r(){t.removeListener("upgrade",r),t.removeListener("upgradeError",r),e()}function n(){t.once("upgrade",r),t.once("upgradeError",r)}return this},Ae.prototype.onError=function(t){Ze("socket error %j",t),Ae.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},Ae.prototype.onClose=function(t,e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){Ze('socket close with reason: "%s"',t);var r=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),r.writeBuffer=[],r.prevBufferLen=0}},Ae.prototype.filterUpgrades=function(t){for(var e=[],r=0,n=t.length;r<n;r++)~qu(this.transports,t[r])&&e.push(t[r]);return e};var Wm=SR,ER=Fn;Wm.parser=ER;var Gu=TR;function TR(t,e){var r=[];e=e||0;for(var n=e||0;n<t.length;n++)r[n-e]=t[n];return r}var kr=AR;function AR(t,e,r){return t.on(e,r),{destroy:function(){t.removeListener(e,r)}}}var Km=[].slice,sn=function(t,e){if(typeof e=="string"&&(e=t[e]),typeof e!="function")throw new Error("bind() requires a function");var r=Km.call(arguments,2);return function(){return e.apply(t,r.concat(Km.call(arguments)))}},Xm=ee(function(t,e){var r=sc("socket.io-client:socket");t.exports=e=s;var n={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},i=wi.prototype.emit;function s(a,c,o){this.io=a,this.nsp=c,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},o&&o.query&&(this.query=o.query),this.io.autoConnect&&this.open()}wi(s.prototype),s.prototype.subEvents=function(){if(this.subs)return;var a=this.io;this.subs=[kr(a,"open",sn(this,"onopen")),kr(a,"packet",sn(this,"onpacket")),kr(a,"close",sn(this,"onclose"))]},s.prototype.open=s.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.reconnecting||this.io.open(),this.io.readyState==="open"&&this.onopen(),this.emit("connecting"),this)},s.prototype.send=function(){var a=Gu(arguments);return a.unshift("message"),this.emit.apply(this,a),this},s.prototype.emit=function(a){if(n.hasOwnProperty(a))return i.apply(this,arguments),this;var c=Gu(arguments),o={type:(this.flags.binary!==void 0?this.flags.binary:Lu(c))?mt.BINARY_EVENT:mt.EVENT,data:c};return o.options={},o.options.compress=!this.flags||this.flags.compress!==!1,typeof c[c.length-1]=="function"&&(r("emitting packet with ack id %d",this.ids),this.acks[this.ids]=c.pop(),o.id=this.ids++),this.connected?this.packet(o):this.sendBuffer.push(o),this.flags={},this},s.prototype.packet=function(a){a.nsp=this.nsp,this.io.packet(a)},s.prototype.onopen=function(){if(r("transport is open - connecting"),this.nsp!=="/")if(this.query){var a=typeof this.query=="object"?pc.encode(this.query):this.query;r("sending connect packet with query %s",a),this.packet({type:mt.CONNECT,query:a})}else this.packet({type:mt.CONNECT})},s.prototype.onclose=function(a){r("close (%s)",a),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",a)},s.prototype.onpacket=function(a){var c=a.nsp===this.nsp,o=a.type===mt.ERROR&&a.nsp==="/";if(!c&&!o)return;switch(a.type){case mt.CONNECT:this.onconnect();break;case mt.EVENT:this.onevent(a);break;case mt.BINARY_EVENT:this.onevent(a);break;case mt.ACK:this.onack(a);break;case mt.BINARY_ACK:this.onack(a);break;case mt.DISCONNECT:this.ondisconnect();break;case mt.ERROR:this.emit("error",a.data);break}},s.prototype.onevent=function(a){var c=a.data||[];r("emitting event %j",c),a.id!=null&&(r("attaching ack callback to event"),c.push(this.ack(a.id))),this.connected?i.apply(this,c):this.receiveBuffer.push(c)},s.prototype.ack=function(a){var c=this,o=!1;return function(){if(o)return;o=!0;var l=Gu(arguments);r("sending ack %j",l),c.packet({type:Lu(l)?mt.BINARY_ACK:mt.ACK,id:a,data:l})}},s.prototype.onack=function(a){var c=this.acks[a.id];typeof c=="function"?(r("calling ack %s with %j",a.id,a.data),c.apply(this,a.data),delete this.acks[a.id]):r("bad ack %s",a.id)},s.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},s.prototype.emitBuffered=function(){var a;for(a=0;a<this.receiveBuffer.length;a++)i.apply(this,this.receiveBuffer[a]);for(this.receiveBuffer=[],a=0;a<this.sendBuffer.length;a++)this.packet(this.sendBuffer[a]);this.sendBuffer=[]},s.prototype.ondisconnect=function(){r("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},s.prototype.destroy=function(){if(this.subs){for(var a=0;a<this.subs.length;a++)this.subs[a].destroy();this.subs=null}this.io.destroy(this)},s.prototype.close=s.prototype.disconnect=function(){return this.connected&&(r("performing disconnect (%s)",this.nsp),this.packet({type:mt.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},s.prototype.compress=function(a){return this.flags.compress=a,this},s.prototype.binary=function(a){return this.flags.binary=a,this}}),CR=_s;function _s(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}_s.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),r=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-r:t+r}return Math.min(t,this.max)|0},_s.prototype.reset=function(){this.attempts=0},_s.prototype.setMin=function(t){this.ms=t},_s.prototype.setMax=function(t){this.max=t},_s.prototype.setJitter=function(t){this.jitter=t};var _t=sc("socket.io-client:manager"),Qm=Object.prototype.hasOwnProperty,Vu=ke;function ke(t,e){if(!(this instanceof ke))return new ke(t,e);t&&typeof t=="object"&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||Infinity),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new CR({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(e.timeout==null?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=e.parser||mt;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=e.autoConnect!==!1,this.autoConnect&&this.open()}ke.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var t in this.nsps)Qm.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},ke.prototype.updateSocketIds=function(){for(var t in this.nsps)Qm.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},ke.prototype.generateId=function(t){return(t==="/"?"":t+"#")+this.engine.id},wi(ke.prototype),ke.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},ke.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},ke.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},ke.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},ke.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},ke.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},ke.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()},ke.prototype.open=ke.prototype.connect=function(t,e){if(_t("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;_t("opening %s",this.uri),this.engine=Wm(this.uri,this.opts);var r=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var i=kr(r,"open",function(){n.onopen(),t&&t()}),s=kr(r,"error",function(o){if(_t("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",o),t){var l=new Error("Connection error");l.data=o,t(l)}else n.maybeReconnectOnOpen()});if(this._timeout!==!1){var a=this._timeout;_t("connect attempt will timeout after %d",a),a===0&&i.destroy();var c=setTimeout(function(){_t("connect attempt timed out after %d",a),i.destroy(),r.close(),r.emit("error","timeout"),n.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(c)}})}return this.subs.push(i),this.subs.push(s),this},ke.prototype.onopen=function(){_t("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(kr(t,"data",sn(this,"ondata"))),this.subs.push(kr(t,"ping",sn(this,"onping"))),this.subs.push(kr(t,"pong",sn(this,"onpong"))),this.subs.push(kr(t,"error",sn(this,"onerror"))),this.subs.push(kr(t,"close",sn(this,"onclose"))),this.subs.push(kr(this.decoder,"decoded",sn(this,"ondecoded")))},ke.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},ke.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},ke.prototype.ondata=function(t){this.decoder.add(t)},ke.prototype.ondecoded=function(t){this.emit("packet",t)},ke.prototype.onerror=function(t){_t("error",t),this.emitAll("error",t)},ke.prototype.socket=function(t,e){var r=this.nsps[t];if(!r){r=new Xm(this,t,e),this.nsps[t]=r;var n=this;r.on("connecting",i),r.on("connect",function(){r.id=n.generateId(t)}),this.autoConnect&&i()}function i(){~qu(n.connecting,r)||n.connecting.push(r)}return r},ke.prototype.destroy=function(t){var e=qu(this.connecting,t);if(~e&&this.connecting.splice(e,1),this.connecting.length)return;this.close()},ke.prototype.packet=function(t){_t("writing packet %j",t);var e=this;t.query&&t.type===0&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,function(r){for(var n=0;n<r.length;n++)e.engine.write(r[n],t.options);e.encoding=!1,e.processPacketQueue()}))},ke.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},ke.prototype.cleanup=function(){_t("cleanup");for(var t=this.subs.length,e=0;e<t;e++){var r=this.subs.shift();r.destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},ke.prototype.close=ke.prototype.disconnect=function(){_t("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,this.readyState==="opening"&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},ke.prototype.onclose=function(t){_t("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},ke.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)_t("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();_t("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var r=setTimeout(function(){if(t.skipReconnect)return;if(_t("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect)return;t.open(function(n){n?(_t("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",n.data)):(_t("reconnect success"),t.onreconnect())})},e);this.subs.push({destroy:function(){clearTimeout(r)}})}},ke.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)};var IR=ee(function(t,e){var r=sc("socket.io-client");t.exports=e=i;var n=e.managers={};function i(s,a){typeof s=="object"&&(a=s,s=void 0),a=a||{};var c=vI(s),o=c.source,l=c.id,u=c.path,h=n[l]&&u in n[l].nsps,S=a.forceNew||a["force new connection"]||a.multiplex===!1||h,p;return S?(r("ignoring socket cache for %s",o),p=Vu(o,a)):(n[l]||(r("new io instance for %s",o),n[l]=Vu(o,a)),p=n[l]),c.query&&!a.query&&(a.query=c.query),p.socket(c.path,a)}e.protocol=mt.protocol,e.connect=i,e.Manager=Vu,e.Socket=Xm}),Hu=t=>{if(t[Symbol.asyncIterator])return t;if(t.getReader)return async function*(){const e=t.getReader();try{for(;;){const{done:r,value:n}=await e.read();if(r)return;yield n}}finally{e.releaseLock()}}();throw new Error("unknown stream")},Ym=t=>async e=>{e=el(e);const r=I=>{typeof I.return=="function"&&I.return()};let n=null,i=null;const s=I=>{n=I,i&&i(I),r(e)};let a=null,c=!1;const o=()=>{c=!0,a&&a()};let l=null,u=!1;const h=()=>{u=!0,l&&l()};let S=null;const p=()=>{S&&S()},C=()=>new Promise((I,x)=>{a=S=I,i=x,t.once("drain",p)}),T=()=>(r(e),new Promise((I,x)=>{if(c||u||n)return I();l=a=I,i=x})),E=()=>{t.removeListener("error",s),t.removeListener("close",o),t.removeListener("finish",h),t.removeListener("drain",p)};t.once("error",s),t.once("close",o),t.once("finish",h);try{for await(const I of e){if(!t.writable||t.destroyed||n)break;t.write(I)===!1&&await C()}}catch(I){n||t.destroy(),n=I}try{if(t.writable&&t.end(),await T(),n)throw n}finally{E()}},Jm=t=>({sink:Ym(t),source:Hu(t)}),RR=t=>async function*(e){const r=Jm(t);r.sink(e).catch(n=>{}),yield*r.source},Es=Hu,kR=Hu,PR=Ym,NR=RR,OR=Jm;Es.source=kR,Es.sink=PR,Es.transform=NR,Es.duplex=OR;const{CLOSE_TIMEOUT:MR}=ku,vc=Q("libp2p:webrtc-star:socket");vc.error=Q("libp2p:webrtc-star:socket:error");const Zm=(t,e)=>{if(!t||!e)return;try{return Ra(t,e)}catch(r){return vc.error(r),Ra("0.0.0.0",e)}};var eg=(t,e={})=>{const{sink:r,source:n}=Es.duplex(t),i=e.remoteAddr||Zm(t.remoteAddress,t.remotePort),s=Zm(t.localAddress,t.localPort),a={async sink(c){e.signal&&(c=nt(c,e.signal));try{await r(async function*(){for await(const o of c)yield o instanceof Uint8Array?o:o.slice()}())}catch(o){o.type!=="aborted"&&vc.error(o)}},source:e.signal?nt(n,e.signal):n,conn:t,localAddr:s,remoteAddr:i,timeline:{open:Date.now()},close(){return t.destroyed?void 0:new Promise((c,o)=>{const l=Date.now(),u=setTimeout(()=>{if(a.remoteAddr){const{host:h,port:S}=a.remoteAddr.toOptions();vc("timeout closing socket to %s:%s after %dms, destroying it manually",h,S,Date.now()-l)}t.destroyed||t.destroy()},MR);t.once("close",()=>{c()}),t.end(h=>{if(clearTimeout(u),a.timeline.close=Date.now(),h)return o(h)})})}};return t.once("close",()=>{a.timeline.close||(a.timeline.close=Date.now())}),a},tg=ee(function(t,e){function r(i){const s=i.toString().split("/"),a=i.protos()[1].name,c=i.protos()[2].name,o=i.stringTuples()[1][1];if(a!=="tcp"||c!=="ws"&&c!=="wss")throw new Error("invalid multiaddr: "+i.toString());if(!Rt.isName(i))return"http://"+s[2]+":"+s[4];if(c==="ws")return"http://"+s[2]+(o===80?"":":"+o);if(c==="wss")return"https://"+s[2]+(o===443?"":":"+o)}function n(i){const s="/libp2p-webrtc-star";if(i.indexOf(s)!==-1){i=i.substring(s.length,i.length);let a=Rt(i);const c=a.stringTuples().filter(o=>o[0]===421)[0];a=a.decapsulate("p2p"),a=a.encapsulate("/p2p-webrtc-star"),a=a.encapsulate(`/p2p/${c[1]}`),i=a.toString()}return i}e=t.exports,e.cleanUrlSIO=r,e.cleanMultiaddr=n});const Si=Q("libp2p:webrtc-star:listener");Si.error=Q("libp2p:webrtc-star:listener:error");const{cleanUrlSIO:DR}=tg,{CODE_P2P:rg}=ku,xR={transports:["websocket"],"force new connection":!0};var LR=({handler:t,upgrader:e},r,n={})=>{const i=new It;let s;return i.__connections=[],i.__spChannels=new Map,i.__pendingIntents=new Map,i.listen=a=>{const c=So();s=a,!a.protoCodes().includes(rg)&&e.localPeer?r._signallingAddr=a.encapsulate(`/p2p/${e.localPeer.toB58String()}`):r._signallingAddr=a;const o=DR(a);Si("Dialing to Signalling Server on: "+o),i.io=IR.connect(o,xR);const l=u=>{if(u.answer||u.err||!u.intentId)return;const h=u.intentId;let S=i.__pendingIntents.get(h);S||(S=[],i.__pendingIntents.set(h,S));let p=i.__spChannels.get(h);if(p){p.signal(u.signal);return}else if(u.signal.type!=="offer"){S.push(u);return}const C={trickle:!1,...n};r.wrtc&&(C.wrtc=r.wrtc),p=new Cm(C);const T=E=>{Si.error("incoming connectioned errored",E)};p.on("error",T),p.once("close",(...E)=>{p.removeListener("error",T)}),p.on("signal",E=>{u.signal=E,u.answer=!0,i.io.emit("ss-handshake",u)}),p.signal(u.signal);for(const E of S)p.signal(E.signal);i.__pendingIntents.set(h,[]),p.once("connect",async()=>{const E=eg(p);Si("new inbound connection %s",E.remoteAddr);let I;try{I=await e.upgradeInbound(E)}catch(x){return Si.error("inbound connection failed to upgrade",x),E.close()}if(!I.remoteAddr)try{I.remoteAddr=a.decapsulateCode(rg).encapsulate(`/p2p/${I.remotePeer.toB58String()}`)}catch(x){Si.error("could not determine remote address",x)}Si("inbound connection %s upgraded",E.remoteAddr),BR(i,E,h),i.emit("connection",I),t(I)}),i.__spChannels.set(h,p)};return i.io.once("connect_error",u=>c.reject(u)),i.io.once("error",u=>{i.emit("error",u),i.emit("close")}),i.io.on("ws-handshake",l),i.io.on("ws-peer",r._peerDiscovered),i.io.on("connect",()=>{i.io.emit("ss-join",r._signallingAddr.toString())}),i.io.once("connect",()=>{i.emit("listening"),c.resolve()}),c.promise},i.close=async()=>{i.io&&i.io.emit("ss-leave"),await Promise.all(i.__connections.map(a=>a.close())),i.emit("close")},i.getAddrs=()=>[s],r.listenersRefs[Rt.toString()]=i,i};function BR(t,e,r){t.__connections.push(e);const n=()=>{t.__connections=t.__connections.filter(i=>i!==e),t.__spChannels.delete(r),t.__pendingIntents.delete(r)};e.conn.once("close",n)}const an=Q("libp2p:webrtc-star");an.error=Q("libp2p:webrtc-star:error");const{EventEmitter:jR}=It,{AbortError:ng}=nt,{supportsWebRTCDataChannels:UR}=sI,{CODE_CIRCUIT:FR}=ku,{cleanMultiaddr:$R}=tg;function qR(){}class GR{constructor(t={}){if(!t.upgrader)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=t.upgrader,this._signallingAddr=void 0,this.sioOptions={transports:["websocket"],"force new connection":!0},t.wrtc&&(this.wrtc=t.wrtc),this.listenersRefs={},this.discovery=new jR,this.discovery.tag="webRTCStar",this.discovery._isStarted=!1,this.discovery.start=()=>{this.discovery._isStarted=!0},this.discovery.stop=()=>{this.discovery._isStarted=!1},this._peerDiscovered=this._peerDiscovered.bind(this)}async dial(t,e={}){const r=await this._connect(t,e),n=eg(r,{remoteAddr:t,signal:e.signal});an("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return an("outbound connection %s upgraded",n.remoteAddr),i}_connect(t,e={}){if(e.signal&&e.signal.aborted)throw new ng;const r={initiator:!0,trickle:!1,...e.spOptions||{}};this.wrtc&&(r.wrtc=this.wrtc);const n=t.toOptions(),i=(~~(Math.random()*1e9)).toString(36)+Date.now(),s=this.listenersRefs[Object.keys(this.listenersRefs)[0]].io;return new Promise((a,c)=>{const o=Date.now();let l;an("dialing %s:%s",n.host,n.port);const u=new Cm(r),h=E=>{if(!l){const I=`connection error ${n.host}:${n.port}: ${E.message}`;an.error(I),T(E)}},S=()=>{an("connnection timeout %s:%s",n.host,n.port);const E=F(new Error(`connection timeout after ${Date.now()-o}ms`),"ERR_CONNECT_TIMEOUT");u.emit("error",E)},p=()=>{l=!0,an("connection opened %s:%s",n.host,n.port),T(null)},C=()=>{an.error("connection aborted %s:%s",n.host,n.port),u.destroy(),T(new ng)},T=E=>{u.removeListener("timeout",S),u.removeListener("connect",p),e.signal&&e.signal.removeEventListener("abort",C),E?c(E):a(u)};u.on("error",h),u.once("timeout",S),u.once("connect",p),u.on("close",()=>{u.removeListener("error",h)}),e.signal&&e.signal.addEventListener("abort",C),u.on("signal",E=>{s.emit("ss-handshake",{intentId:i,srcMultiaddr:this._signallingAddr.toString(),dstMultiaddr:t.toString(),signal:E})}),s.on("ws-handshake",E=>{if(E.intentId===i&&E.err&&c(F(E.err instanceof Error?E.err:new Error(E.err),"ERR_SIGNALLING_FAILED")),E.intentId!==i||!E.answer||u.destroyed)return;u.signal(E.signal)})})}createListener(t={},e){if(!UR&&!this.wrtc)throw F(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");return typeof t=="function"&&(e=t,t={}),e=e||qR,LR({handler:e,upgrader:this._upgrader},this,t)}filter(t){return t=Array.isArray(t)?t:[t],t.filter(e=>e.protoCodes().includes(FR)?!1:Zc.WebRTCStar.matches(e))}_peerDiscovered(t){if(!this.discovery._isStarted)return;an("Peer Discovered:",t),t=$R(t);const e=Rt(t),r=me.createFromB58String(e.getPeerId());this.discovery.emit("peer",{id:r,multiaddrs:[e]})}}var ig=Yr(GR,{className:"WebRTCStar",symbolName:"@libp2p/js-libp2p-webrtc-star/webrtcstar"});const{Address4:VR,Address6:HR}=vf,wc={ERR_INVALID_IP_PARAMETER:"ERR_INVALID_IP_PARAMETER",ERR_INVALID_PORT_PARAMETER:"ERR_INVALID_PORT_PARAMETER",ERR_INVALID_IP:"ERR_INVALID_IP"};function zR(t,e){if(typeof t!="string")throw F(new Error(`invalid ip provided: ${t}`),wc.ERR_INVALID_IP_PARAMETER);if(e=parseInt(e),isNaN(e))throw F(new Error(`invalid port provided: ${e}`),wc.ERR_INVALID_PORT_PARAMETER);if(new VR(t).isValid())return Rt(`/ip4/${t}/tcp/${e}`);const r=new HR(t);if(r.isValid())return r.is4()?Rt(`/ip4/${r.to4().correctForm()}/tcp/${e}`):Rt(`/ip6/${t}/tcp/${e}`);throw F(new Error(`invalid ip:port for creating a multiaddr: ${t}:${e}`),wc.ERR_INVALID_IP)}var zu=zR,WR=wc;zu.Errors=WR;var KR=421,XR=290,QR=2e3,Wu={CODE_P2P:KR,CODE_CIRCUIT:XR,CLOSE_TIMEOUT:QR};const Ku=Q("libp2p:tcp:socket"),{CLOSE_TIMEOUT:YR}=Wu;var sg=(t,e)=>{e=e||{},e.listeningAddr&&e.listeningAddr.getPath()&&(e.remoteAddr=e.listeningAddr),e.remoteAddr&&e.remoteAddr.getPath()&&(e.localAddr=e.remoteAddr);const{sink:r,source:n}=Es.duplex(t),i={async sink(s){e.signal&&(s=nt(s,e.signal));try{await r(async function*(){for await(const a of s)yield Buffer.isBuffer(a)?a:a.slice()}())}catch(a){a.type!=="aborted"&&Ku(a)}},source:e.signal?nt(n,e.signal):n,conn:t,localAddr:e.localAddr||zu(t.localAddress,t.localPort),remoteAddr:e.remoteAddr||zu(t.remoteAddress,t.remotePort),timeline:{open:Date.now()},close(){return t.destroyed?void 0:new Promise((s,a)=>{const c=Date.now(),o=setTimeout(()=>{const{host:l,port:u}=i.remoteAddr.toOptions();Ku("timeout closing socket to %s:%s after %dms, destroying it manually",l,u,Date.now()-c),t.destroyed?Ku("%s:%s is already destroyed",l,u):t.destroy(),s()},YR);t.once("close",()=>clearTimeout(o)),t.end(l=>{if(i.timeline.close=Date.now(),l)return a(l);s()})})}};return t.once("close",()=>{i.timeline.close||(i.timeline.close=Date.now())}),i};const{resolve:JR}=Qg,ZR={ip4:"IPv4",ip6:"IPv6"};function ek(t){const e=t.getPath();return e?JR(e):t.toOptions()}function tk(t,e,r){const n=i=>Rt(`/${t}/${i}/tcp/${r}`);return(ag(e)?rk(ZR[t]):[e]).map(n)}function ag(t){return["0.0.0.0","::"].includes(t)}function rk(t){return Object.values(ad.networkInterfaces()).reduce((e,r)=>(r.forEach(n=>{n.family===t&&e.push(n.address)}),e),[])}var og={multiaddrToNetConfig:ek,isAnyAddr:ag,getMultiaddrs:tk};const _i=Q("libp2p:tcp:listener");_i.error=Q("libp2p:tcp:listener:error");const{CODE_P2P:nk}=Wu,{getMultiaddrs:cg,multiaddrToNetConfig:ik}=og;async function lg(t){try{t&&await t.close()}catch(e){_i.error("an error occurred closing the connection",e)}}var sk=({handler:t,upgrader:e},r)=>{const n=new It,i=kc.createServer(async c=>{c.on("error",u=>_i("socket error",u));let o,l;try{o=sg(c,{listeningAddr:a}),_i("new inbound connection %s",o.remoteAddr),l=await e.upgradeInbound(o)}catch(u){return _i.error("inbound connection failed",u),lg(o)}_i("inbound connection %s upgraded",o.remoteAddr),ak(i,o),t&&t(l),n.emit("connection",l)});i.on("listening",()=>n.emit("listening")).on("error",c=>n.emit("error",c)).on("close",()=>n.emit("close")),i.__connections=[],n.close=()=>i.listening?new Promise((c,o)=>{i.__connections.forEach(l=>lg(l)),i.close(l=>l?o(l):c())}):void 0;let s,a;return n.listen=c=>(a=c,s=c.getPeerId(),s&&(a=c.decapsulateCode(nk)),new Promise((o,l)=>{const u=ik(a);i.listen(u,h=>{if(h)return l(h);_i("Listening on %s",i.address()),o()})})),n.getAddrs=()=>{let c=[];const o=i.address();if(!o)throw new Error("Listener is not ready yet");return a.toString().startsWith("/ip4")?c=c.concat(cg("ip4",o.address,o.port)):o.family==="IPv6"&&(c=c.concat(cg("ip6",o.address,o.port))),c.map(l=>s?l.encapsulate(`/p2p/${s}`):l)},n};function ak(t,e){t.__connections.push(e);const r=()=>{t.__connections=t.__connections.filter(n=>n!==e)};e.conn.once("close",r)}const Ts=Q("libp2p:tcp"),{multiaddrToNetConfig:ok}=og,{AbortError:ug}=nt,{CODE_CIRCUIT:ck,CODE_P2P:lk}=Wu;class uk{constructor({upgrader:t}){if(!t)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=t}async dial(t,e){e=e||{};const r=await this._connect(t,e),n=sg(r,{remoteAddr:t,signal:e.signal});Ts("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return Ts("outbound connection %s upgraded",n.remoteAddr),i}_connect(t,e={}){if(e.signal&&e.signal.aborted)throw new ug;return new Promise((r,n)=>{const i=Date.now(),s=ok(t);Ts("dialing %j",s);const a=kc.connect(s),c=S=>{S.message=`connection error ${s.host}:${s.port}: ${S.message}`,h(S)},o=()=>{Ts("connnection timeout %s:%s",s.host,s.port);const S=F(new Error(`connection timeout after ${Date.now()-i}ms`),"ERR_CONNECT_TIMEOUT");a.emit("error",S)},l=()=>{Ts("connection opened %j",s),h()},u=()=>{Ts("connection aborted %j",s),a.destroy(),h(new ug)},h=S=>{if(a.removeListener("error",c),a.removeListener("timeout",o),a.removeListener("connect",l),e.signal&&e.signal.removeEventListener("abort",u),S)return n(S);r(a)};a.on("error",c),a.on("timeout",o),a.on("connect",l),e.signal&&e.signal.addEventListener("abort",u)})}createListener(t,e){return typeof t=="function"&&(e=t,t={}),t=t||{},sk({handler:e,upgrader:this._upgrader})}filter(t){return t=Array.isArray(t)?t:[t],t.filter(e=>e.protoCodes().includes(ck)?!1:Zc.TCP.matches(e.decapsulateCode(lk)))}}var dk=Yr(uk,{className:"TCP",symbolName:"@libp2p/js-libp2p-tcp/tcp"});const Xu=10*1024;class pk{constructor(){this._pool=new Uint8Array(Xu),this._poolOffset=0}write(t){const e=this._pool;let r=this._poolOffset;ie.encode(t.id<<3|t.type,e,r),r+=ie.encode.bytes,ie.encode(t.data?t.data.length:0,e,r),r+=ie.encode.bytes;const n=e.subarray(this._poolOffset,r);return Xu-r<100?(this._pool=new Uint8Array(Xu),this._poolOffset=0):this._poolOffset=r,t.data?[n,t.data]:n}}const dg=new pk;var hk=t=>async function*(){for await(const r of t)Array.isArray(r)?yield new ht(r.map(n=>dg.write(n))):yield new ht(dg.write(r))}(),fk=t=>async function*(){const r=new mk;for await(const n of t){const i=r.write(n);i.length&&(yield i)}}();class mk{constructor(){this._buffer=new ht,this._bufferProxy=new Proxy({},{get:(t,e)=>e[0]==="l"?this._buffer[e]:this._buffer.get(parseInt(e))}),this._headerInfo=null}write(t){if(!t||!t.length)return[];this._buffer.append(t);const e=[];for(;;){if(!this._headerInfo)try{this._headerInfo=this._decodeHeader(this._bufferProxy)}catch(c){break}const{id:r,type:n,length:i,offset:s}=this._headerInfo,a=this._buffer.length-s;if(a<i)break;e.push({id:r,type:n,data:this._buffer.shallowSlice(s,s+i)}),this._buffer.consume(s+i),this._headerInfo=null}return e}_decodeHeader(t){const e=ie.decode(t);let r=ie.decode.bytes;const n=ie.decode(t,r);return r+=ie.decode.bytes,{id:e>>3,type:e&7,offset:r,length:n}}}var gk=hk,yk=fk,pg={encode:gk,decode:yk};const hg=1<<20;var Qu=t=>{t=t||hg;const e=r=>{if(r.data&&r.data.length>t)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"})};return r=>async function*(){for await(const i of r)Array.isArray(i)?i.forEach(e):e(i),yield i}()},bk=hg;Qu.MAX_MSG_SIZE=bk;const on=Object.freeze({NEW_STREAM:0,MESSAGE_RECEIVER:1,MESSAGE_INITIATOR:2,CLOSE_RECEIVER:3,CLOSE_INITIATOR:4,RESET_RECEIVER:5,RESET_INITIATOR:6});var vk=on,wk=Object.freeze({NEW_STREAM:on.NEW_STREAM,MESSAGE:on.MESSAGE_INITIATOR,CLOSE:on.CLOSE_INITIATOR,RESET:on.RESET_INITIATOR}),Sk=Object.freeze({MESSAGE:on.MESSAGE_RECEIVER,CLOSE:on.CLOSE_RECEIVER,RESET:on.RESET_RECEIVER}),_k=Object.freeze(Object.entries(on).reduce((t,e)=>(t[e[1]]=e[0],t),{})),fg={MessageTypes:vk,InitiatorMessageTypes:wk,ReceiverMessageTypes:Sk,MessageTypeNames:_k};const Ja=Q("libp2p:mplex:stream"),{MAX_MSG_SIZE:Ek}=Qu,{InitiatorMessageTypes:Tk,ReceiverMessageTypes:Ak}=fg,Yu="ERR_MPLEX_STREAM_RESET",Ck="ERR_MPLEX_STREAM_ABORT";var Ik=({id:t,name:e,send:r,onEnd:n=()=>{},type:i="initiator",maxMsgSize:s=Ek})=>{const a=new na,c=new na,o=i==="initiator"?Tk:Ak,l=i==="initiator"?`i${t}`:`r${t}`;e=String(e??t);let u=!1,h=!1,S;const p=E=>{if(u)return;u=!0,Ja("%s stream %s source end",i,e,E),E&&!S&&(S=E),h&&(T.timeline.close=Date.now(),n(S))},C=E=>{if(h)return;h=!0,Ja("%s stream %s sink end",i,e,E),E&&!S&&(S=E),u&&(T.timeline.close=Date.now(),n(S))},T={close:()=>T.source.end(),abort:E=>{Ja("%s stream %s abort",i,e,E),T.source.end(E),a.abort(),C(E)},reset:()=>{const E=F(new Error("stream reset"),Yu);c.abort(),T.source.end(E),C(E)},sink:async E=>{E=nt(E,[{signal:a.signal,options:{abortMessage:"stream aborted",abortCode:Ck}},{signal:c.signal,options:{abortMessage:"stream reset",abortCode:Yu}}]),i==="initiator"&&r({id:t,type:o.NEW_STREAM,data:e});try{for await(let I of E)for(;I.length;){if(I.length<=s){r({id:t,type:o.MESSAGE,data:I});break}I=ht.isBufferList(I)?I:new ht(I),r({id:t,type:o.MESSAGE,data:I.shallowSlice(0,s)}),I.consume(s)}}catch(I){return I.code===Yu?Ja("%s stream %s reset",i,e):(Ja("%s stream %s error",i,e,I),r({id:t,type:o.RESET})),T.source.end(I),C(I)}r({id:t,type:o.CLOSE}),C()},source:wo(p),timeline:{open:Date.now(),close:null},id:l};return T};const cn=Q("libp2p:mplex"),{MessageTypes:Ei,MessageTypeNames:mg}=fg;class gg{constructor(t){t=t||{},t=typeof t=="function"?{onStream:t}:t,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._options=t,this.sink=this._createSink(),this.source=this._createSource(),this.onStream=t.onStream,this.onStreamEnd=t.onStreamEnd}get streams(){const t=[];return this._streams.initiators.forEach(e=>{t.push(e)}),this._streams.receivers.forEach(e=>{t.push(e)}),t}newStream(t){const e=this._streamId++;t=t==null?e.toString():String(t);const r=this._streams.initiators;return this._newStream({id:e,name:t,type:"initiator",registry:r})}_newReceiverStream({id:t,name:e}){const r=this._streams.receivers;return this._newStream({id:t,name:e,type:"receiver",registry:r})}_newStream({id:t,name:e,type:r,registry:n}){if(n.has(t))throw new Error(`${r} stream ${t} already exists!`);cn("new %s stream %s %s",r,t,e);const i=c=>(cn.enabled&&cn("%s stream %s %s send",r,t,e,{...c,type:mg[c.type],data:c.data&&c.data.slice()}),this.source.push(c)),s=()=>{cn("%s stream %s %s ended",r,t,e),n.delete(t),this.onStreamEnd&&this.onStreamEnd(a)},a=Ik({id:t,name:e,send:i,type:r,onEnd:s,maxMsgSize:this._options.maxMsgSize});return n.set(t,a),a}_createSink(){return async t=>{this._options.signal&&(t=nt(t,this._options.signal));try{await nr(t,pg.decode,Qu(this._options.maxMsgSize),async e=>{for await(const r of e)for(const n of r)this._handleIncoming(n)})}catch(e){return cn("error in sink",e),this.source.end(e)}this.source.end()}}_createSource(){const t=r=>{const{initiators:n,receivers:i}=this._streams;for(const s of n.values())s.abort(r);for(const s of i.values())s.abort(r)},e=wo({onEnd:t,writev:!0});return Object.assign(pg.encode(e),{push:e.push,end:e.end,return:e.return})}_handleIncoming({id:t,type:e,data:r}){if(cn.enabled&&cn("incoming message",{id:t,type:mg[e],data:r.slice()}),e===Ei.NEW_STREAM&&this.onStream){const s=this._newReceiverStream({id:t,name:r.toString()});return this.onStream(s)}const n=e&1?this._streams.initiators:this._streams.receivers,i=n.get(t);if(!i)return cn("missing stream %s",t);switch(e){case Ei.MESSAGE_INITIATOR:case Ei.MESSAGE_RECEIVER:i.source.push(r);break;case Ei.CLOSE_INITIATOR:case Ei.CLOSE_RECEIVER:i.close();break;case Ei.RESET_INITIATOR:case Ei.RESET_RECEIVER:i.reset();break;default:cn("unknown message type %s",e)}}}gg.multicodec="/mplex/6.7.0";var Rk=gg,kk=Rk,Sc=Dr(`message Propose {
  optional bytes rand = 1;
  optional bytes pubkey = 2;
  optional string exchanges = 3;
  optional string ciphers = 4;
  optional string hashes = 5;
}

message Exchange {
  optional bytes epubkey = 1;
  optional bytes signature = 2;
}`);function Pk(t,e){for(let r=0;r<t.byteLength;r++){if(t[r]<e[r])return-1;if(t[r]>e[r])return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0}var Nk=Pk;class yg extends Error{constructor(t="Unexpected Peer"){super(t);this.code=yg.code}static get code(){return"ERR_UNEXPECTED_PEER"}}class bg extends Error{constructor(t="Invalid crypto exchange"){super(t);this.code=bg.code}static get code(){return"ERR_INVALID_CRYPTO_EXCHANGE"}}class vg extends Error{constructor(t="Invalid crypto transmission"){super(t);this.code=vg.code}static get code(){return"ERR_INVALID_CRYPTO_TRANSMISSION"}}var Ju={UnexpectedPeerError:yg,InvalidCryptoExchangeError:bg,InvalidCryptoTransmissionError:vg},qn=ee(function(t,e){const{InvalidCryptoExchangeError:r}=Ju;e.exchanges=["P-256","P-384","P-521"],e.ciphers=["AES-256","AES-128"],e.hashes=["SHA256","SHA512"],e.theBest=(s,a,c)=>{let o,l;if(s<0)o=c,l=a;else if(s>0)o=a,l=c;else return a[0];for(const u of o)for(const h of l)if(u===h)return u;throw new r("No algorithms in common!")},e.makeMacAndCipher=async s=>{[s.mac,s.cipher]=await Promise.all([n(s.hashT,s.keys.macKey),i(s.cipherT,s.keys.iv,s.keys.cipherKey)])};function n(s,a){return sr.hmac.create(s,a)}function i(s,a,c){if(s==="AES-128"||s==="AES-256")return sr.aes.create(c,a);throw new r(`unrecognized cipher type: ${s}`)}e.selectBest=async(s,a)=>{const c=await e.digest(Oe([a.pubKeyBytes,s.nonce])),o=await e.digest(Oe([s.pubKeyBytes,a.nonce])),l=Nk(c,o);if(l===0)throw new r("you are trying to talk to yourself");return{curveT:e.theBest(l,s.exchanges,a.exchanges),cipherT:e.theBest(l,s.ciphers,a.ciphers),hashT:e.theBest(l,s.hashes,a.hashes),order:l}},e.digest=s=>od.digest(s,"sha2-256",s.length)});const Gn=Q("libp2p:secio");Gn.error=Q("libp2p:secio:error");const{UnexpectedPeerError:Ok}=Ju,Mk=16;var Dk=t=>(t.proposal.out={rand:sr.randomBytes(Mk),pubkey:t.key.local.public.bytes,exchanges:qn.exchanges.join(","),ciphers:qn.ciphers.join(","),hashes:qn.hashes.join(",")},t.proposalEncoded.out=Sc.Propose.encode(t.proposal.out),t.proposalEncoded.out),xk=async t=>{const e=await sr.keys.generateEphemeralKeyPair(t.protocols.local.curveT);t.ephemeralKey.local=e.key,t.shared.generate=e.genSharedKey;const r=Oe([t.proposalEncoded.out,t.proposalEncoded.in,t.ephemeralKey.local]),n=await t.key.local.sign(r);return t.exchange.out={epubkey:t.ephemeralKey.local,signature:n},Sc.Exchange.encode(t.exchange.out)},Lk=async(t,e)=>{Gn("1.1 identify"),t.proposalEncoded.in=e,t.proposal.in=Sc.Propose.decode(e);const r=t.proposal.in.pubkey;t.key.remote=sr.keys.unmarshalPublicKey(r);const n=await me.createFromPubKey(ae(r,"base64pad"));if(t.id.remote){if(t.id.remote.toString()!==n.toString())throw new Ok("Dialed to the wrong peer: IDs do not match!");t.id.remote.pubKey=t.key.remote}else t.id.remote=n;Gn("1.1 identify - %s - identified remote peer as %s",t.id.local.toB58String(),t.id.remote.toB58String())},Bk=async t=>{Gn("1.2 selection");const e={pubKeyBytes:t.key.local.public.bytes,exchanges:qn.exchanges,hashes:qn.hashes,ciphers:qn.ciphers,nonce:t.proposal.out.rand},r={pubKeyBytes:t.proposal.in.pubkey,exchanges:t.proposal.in.exchanges.split(","),hashes:t.proposal.in.hashes.split(","),ciphers:t.proposal.in.ciphers.split(","),nonce:t.proposal.in.rand},n=await qn.selectBest(e,r);t.protocols.remote={order:n.order,curveT:n.curveT,cipherT:n.cipherT,hashT:n.hashT},t.protocols.local={order:n.order,curveT:n.curveT,cipherT:n.cipherT,hashT:n.hashT}},jk=async(t,e)=>{Gn("2.1. verify"),t.exchange.in=Sc.Exchange.decode(e),t.ephemeralKey.remote=t.exchange.in.epubkey;const r=Oe([t.proposalEncoded.in,t.proposalEncoded.out,t.ephemeralKey.remote]),n=await t.key.remote.verify(r,t.exchange.in.signature);if(!n)throw new Error("Bad signature");Gn("2.1. verify - signature verified")},Uk=async t=>{Gn("2.2. keys");const e=await t.shared.generate(t.exchange.in.epubkey);t.shared.secret=e;const r=await sr.keys.keyStretcher(t.protocols.local.cipherT,t.protocols.local.hashT,t.shared.secret);if(t.protocols.local.order>0)t.protocols.local.keys=r.k1,t.protocols.remote.keys=r.k2;else if(t.protocols.local.order<0)t.protocols.local.keys=r.k2,t.protocols.remote.keys=r.k1;else throw new Error("you are trying to talk to yourself");Gn("2.3. mac + cipher"),await Promise.all([t.protocols.local,t.protocols.remote].map(n=>qn.makeMacAndCipher(n)))},Fk=(t,e)=>{const r=t.proposal.out.rand;if(ir(r,e))return;throw new Error(`Failed to read our encrypted nonce: ${ae(r,"base16")} != ${ae(e,"base16")}`)},Ti={createProposal:Dk,createExchange:xk,identify:Lk,selectProtocols:Bk,verify:jk,generateKeys:Uk,verifyNonce:Fk};const{int32BEEncode:$k}=Je,As=Q("libp2p:secio");As.error=Q("libp2p:secio:error");var qk=async function(e,r){As("1. propose - start");const n=Ti.createProposal(e);As("1. propose - writing proposal",n),await r.write(Je.encode.single(n,{lengthEncoder:$k})),As("1. propose - reading proposal");const i=(await r.readLP()).slice();As("1. propose - read proposal",i),await Ti.identify(e,i),await Ti.selectProtocols(e),As("1. propose - finish")};const Za=Q("libp2p:secio");Za.error=Q("libp2p:secio:error");var Gk=async function(e,r){Za("2. exchange - start"),Za("2. exchange - writing exchange");const n=await Ti.createExchange(e);await r.writeLP(n);const i=await r.readLP();Za("2. exchange - reading exchange"),await Ti.verify(e,i.slice()),await Ti.generateKeys(e),Za("2. exchange - finish")},wg=function(){let e,r;const n=async s=>{if(e)throw new Error("already piped");e=el(s),r&&r(e)},i={[Symbol.asyncIterator](){return this},next(){return e?e.next():new Promise(s=>{r=a=>{r=null,s(a.next())}})}};return{sink:n,source:i}},Vk=function(){var t=wg(),e=wg();return[{source:t.source,sink:e.sink},{source:e.source,sink:t.sink}]};/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Hk=function(e){return e!=null&&e.constructor!=null&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)},Sg=(t,e={})=>{const r=fa(t),n=Je.decode.fromReader(r.reader,e),i={read:async s=>{const{value:a,done:c}=await r.reader.next(s);if(c&&a.length<s)throw new Error("Couldn't read enough bytes");if(!a)throw new Error("Value is null");return a},readLP:async()=>{const{value:s,done:a}=await n.next();if(!s)throw new Error("Value is null");return s},readPB:async s=>{const a=await i.readLP();if(!a)throw new Error("Value is null");const c=Hk(a)?a:a.slice();return s.decode(c)},write:s=>{r.writer.push(s)},writeLP:s=>{i.write(Je.encode.single(s,e))},writePB:(s,a)=>{i.writeLP(a.encode(s))},pb:s=>({read:()=>i.readPB(s),write:a=>i.writePB(a,s)}),unwrap:()=>(r.rest(),r.stream)};return i};const{InvalidCryptoTransmissionError:_g}=Ju;var zk=(t,e)=>async function*(r){for await(const n of r){const i=await t.encrypt(ht.isBufferList(n)?n.slice():n),s=await e.digest(i);yield new ht([i,s])}},Wk=(t,e)=>async function*(r){for await(const n of r){const i=n.length,s=e.length;if(i<s)throw new _g(`buffer (${i}) shorter than MAC size (${s})`);const a=i-s,c=n.slice(0,a),o=n.slice(a),l=await e.digest(c);if(!ir(o,l))throw new _g(`MAC Invalid: ${ae(o,"base16")} != ${ae(l,"base16")}`);const u=await t.decrypt(c);yield u}},Eg={createBoxStream:zk,createUnboxStream:Wk};const _c=Q("libp2p:secio");_c.error=Q("libp2p:secio:error");const{int32BEEncode:Kk,int32BEDecode:Xk}=Je,Qk=8388608;var Yk=async function(e,r){_c("3. finish - start");const n=e.protocols,[i,s]=Vk(),a=r.unwrap();nr(i,Eg.createBoxStream(n.local.cipher,n.local.mac),Je.encode({lengthEncoder:Kk}),a,Je.decode({lengthDecoder:Xk,maxDataLength:Qk}),Eg.createUnboxStream(n.remote.cipher,n.remote.mac),i).catch(l=>{_c.error("an error occurred in the crypto stream",l)});const c=Sg(s);c.write(e.proposal.in.rand);const o=await c.read(e.proposal.in.rand.length);Ti.verifyNonce(e,o.slice()),_c("3. finish - finish"),e.secure=c.unwrap()},Jk=async function(e,r){await qk(e,r),await Gk(e,r),await Yk(e,r),e.cleanSecrets()};class Zk{constructor(t,e){this.setup(),this.id.local=t,this.id.remote=e,this.key.local=t.privKey}setup(){this.id={local:null,remote:null},this.key={local:null,remote:null},this.shake=null,this.cleanSecrets()}cleanSecrets(){this.shared={},this.ephemeralKey={local:null,remote:null},this.proposal={in:null,out:null},this.proposalEncoded={in:null,out:null},this.protocols={local:null,remote:null},this.exchange={in:null,out:null}}}var eP=Zk;const tP=Q("libp2p:secio");tP.error=Q("libp2p:secio:error");const{int32BEDecode:rP,int32BEEncode:nP}=Je;async function Tg(t,e,r){if(!t)throw new Error("no local private key provided");if(!e)throw new Error("no connection for the handshake provided");const n=new eP(t,r),i=Sg(e,{lengthDecoder:rP,lengthEncoder:nP});return await Jk(n,i),{conn:n.secure,remotePeer:n.id.remote}}var iP={protocol:"/secio/1.0.0",secureInbound:Tg,secureOutbound:Tg};const Ag=()=>{};class sP{constructor({min:t=0,max:e=Infinity,handlers:r={}}){this.min=t,this.max=e,this._onConnect=r.onConnect||Ag,this._onDisconnect=r.onDisconnect||Ag,this.peers=new Set}set registrar(t){this._registrar=t}disconnect(t){this._onDisconnect(t)}}var aP=Yr(sP,{className:"Topology",symbolName:"@libp2p/js-interfaces/topology"});class oP extends aP{constructor({min:t,max:e,multicodecs:r,handlers:n}){super({min:t,max:e,handlers:n});if(!r)throw new Error("one or more multicodec should be provided");if(!n)throw new Error("the handlers should be provided");if(typeof n.onConnect!="function")throw new Error("the 'onConnect' handler must be provided");if(typeof n.onDisconnect!="function")throw new Error("the 'onDisconnect' handler must be provided");this.multicodecs=Array.isArray(r)?r:[r],this._registrar=void 0,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerConnect=this._onPeerConnect.bind(this)}set registrar(t){this._registrar=t,this._registrar.peerStore.on("change:protocols",this._onProtocolChange),this._registrar.connectionManager.on("peer:connect",this._onPeerConnect),this._updatePeers(this._registrar.peerStore.peers.values())}_updatePeers(t){for(const{id:e,protocols:r}of t)if(this.multicodecs.filter(n=>r.includes(n)).length){this.peers.add(e.toB58String());const n=this._registrar.getConnection(e);n&&this._onConnect(e,n)}else this.peers.delete(e.toB58String())}_onProtocolChange({peerId:t,protocols:e}){const r=this.peers.has(t.toB58String()),n=e.filter(i=>this.multicodecs.includes(i));r&&n.length===0&&this._onDisconnect(t);for(const i of e)if(this.multicodecs.includes(i)){const s=this._registrar.peerStore.get(t);this._updatePeers([s]);return}}_onPeerConnect(t){const e=t.remotePeer,r=this._registrar.peerStore.protoBook.get(e);if(!r)return;this.multicodecs.find(n=>r.includes(n))&&(this.peers.add(e.toB58String()),this._onConnect(e,t))}}var cP=Yr(oP,{className:"MulticodecTopology",symbolName:"@libp2p/js-interfaces/topology/multicodec-topology"}),lP={ERR_INVALID_SIGNATURE_POLICY:"ERR_INVALID_SIGNATURE_POLICY",ERR_UNHANDLED_SIGNATURE_POLICY:"ERR_UNHANDLED_SIGNATURE_POLICY",ERR_MISSING_SIGNATURE:"ERR_MISSING_SIGNATURE",ERR_MISSING_SEQNO:"ERR_MISSING_SEQNO",ERR_INVALID_SIGNATURE:"ERR_INVALID_SIGNATURE",ERR_UNEXPECTED_FROM:"ERR_UNEXPECTED_FROM",ERR_UNEXPECTED_SIGNATURE:"ERR_UNEXPECTED_SIGNATURE",ERR_UNEXPECTED_KEY:"ERR_UNEXPECTED_KEY",ERR_UNEXPECTED_SEQNO:"ERR_UNEXPECTED_SEQNO"},Zu={codes:lP},uP=`
message RPC {
  repeated SubOpts subscriptions = 1;
  repeated Message msgs = 2;

  message SubOpts {
    optional bool subscribe = 1; // subscribe or unsubcribe
    optional string topicID = 2;
  }

  message Message {
    optional bytes from = 1;
    optional bytes data = 2;
    optional bytes seqno = 3;
    repeated string topicIDs = 4;
    optional bytes signature = 5;
    optional bytes key = 6;
  }
}`,dP=`
// topicCID = cid(merkledag_protobuf(topicDescriptor)); (not the topic.name)
message TopicDescriptor {
  optional string name = 1;
  optional AuthOpts auth = 2;
  optional EncOpts enc = 2;

  message AuthOpts {
    optional AuthMode mode = 1;
    repeated bytes keys = 2; // root keys to trust

    enum AuthMode {
      NONE = 0; // no authentication, anyone can publish
      KEY = 1; // only messages signed by keys in the topic descriptor are accepted
      WOT = 2; // web of trust, certificates can allow publisher set to grow
    }
  }

  message EncOpts {
    optional EncMode mode = 1;
    repeated bytes keyHashes = 2; // the hashes of the shared keys used (salted)

    enum EncMode {
      NONE = 0; // no encryption, anyone can read
      SHAREDKEY = 1; // messages are encrypted with shared key
      WOT = 2; // web of trust, certificates can allow publisher set to grow
    }
  }
}`,Ec=ee(function(t,e){const r=Dr(uP),n=r.RPC,i=Dr(dP);e=t.exports,e.rpc=r,e.td=i,e.RPC=n,e.Message=n.Message,e.SubOpts=n.SubOpts});const Cg=Q("libp2p-pubsub:peer-streams");Cg.error=Q("libp2p-pubsub:peer-streams:error");class pP extends It{constructor({id:t,protocol:e}){super();this.id=t,this.protocol=e,this._rawOutboundStream=null,this._rawInboundStream=null,this._inboundAbortController=null,this.outboundStream=null,this.inboundStream=null}get isReadable(){return Boolean(this.inboundStream)}get isWritable(){return Boolean(this.outboundStream)}write(t){if(!this.isWritable){const e=this.id.toB58String();throw new Error("No writable connection to "+e)}this.outboundStream.push(t)}attachInboundStream(t){this._inboundAbortController=new na,this._rawInboundStream=t,this.inboundStream=nt(nr(this._rawInboundStream,Je.decode()),this._inboundAbortController.signal,{returnOnAbort:!0}),this.emit("stream:inbound")}async attachOutboundStream(t){const e=this.outboundStream;e&&await this.outboundStream.end(!1),this._rawOutboundStream=t,this.outboundStream=wo({onEnd:r=>{this._rawOutboundStream.reset&&this._rawOutboundStream.reset(),this._rawOutboundStream=null,this.outboundStream=null,r!==!1&&this.emit("close")}}),nr(this.outboundStream,Je.encode(),this._rawOutboundStream).catch(r=>{Cg.error(r)}),e||this.emit("stream:outbound")}close(){this.outboundStream&&this.outboundStream.end(),this.inboundStream&&this._inboundAbortController.abort(),this._rawOutboundStream=null,this.outboundStream=null,this._rawInboundStream=null,this.inboundStream=null,this.emit("close")}}var hP=pP,fP={StrictSign:"StrictSign",StrictNoSign:"StrictNoSign"},mP={SignaturePolicy:fP},ln=ee(function(t,e){e=t.exports,e.randomSeqno=()=>Hg(8),e.msgId=(r,n)=>{const i=me.createFromB58String(r).id,s=new Uint8Array(i.length+n.length);return s.set(i,0),s.set(n,i.length),s},e.noSignMsgId=r=>zg.encode(r,"sha2-256"),e.anyMatch=(r,n)=>{let i;Array.isArray(n)?i=s=>n.indexOf(s)>-1:i=s=>n.has(s);for(const s of r)if(i(s))return!0;return!1},e.ensureArray=r=>Array.isArray(r)?r:[r],e.normalizeInRpcMessage=(r,n)=>{const i=Object.assign({},r);return r.from instanceof Uint8Array&&(i.from=ae(r.from,"base58btc")),n&&(i.receivedFrom=n),i},e.normalizeOutRpcMessage=r=>{const n=Object.assign({},r);return(typeof r.from=="string"||r.from instanceof String)&&(n.from=qe(r.from,"base58btc")),(typeof r.data=="string"||r.data instanceof String)&&(n.data=qe(r.data)),n}});const{Message:Ig}=Ec,ed=qe("libp2p-pubsub:");async function gP(t,e){const r=Oe([ed,Ig.encode(e)]),n=await t.privKey.sign(r);return{...e,signature:n,key:t.pubKey.bytes}}async function yP(t){const e={...t};delete e.signature,delete e.key,e.from=me.createFromCID(e.from).toBytes();const r=Oe([ed,Ig.encode(e)]),n=await Rg(t);return n.verify(r,t.signature)}async function Rg(t){const e=me.createFromCID(t.from);if(t.key){const r=await me.createFromPubKey(t.key);if(r.isEqual(e))return r.pubKey;throw new Error("Public Key does not match the originator")}else{if(e.pubKey)return e.pubKey;throw new Error("Could not get the public key from the originator id")}}var bP={messagePublicKey:Rg,signMessage:gP,SignPrefix:ed,verifySignature:yP};const{codes:Pr}=Zu,{SignaturePolicy:un}=mP,{signMessage:vP,verifySignature:wP}=bP;class SP extends It{constructor({debugName:t,multicodecs:e,libp2p:r,globalSignaturePolicy:n=un.StrictSign,canRelayMessage:i=!1,emitSelf:s=!1}){if(typeof t!="string")throw new Error("a debugname `string` is required");if(!e)throw new Error("multicodecs are required");if(!r)throw new Error("libp2p is required");super();if(this.log=Q(t),this.log.err=Q(`${t}:error`),this.multicodecs=ln.ensureArray(e),this._libp2p=r,this.registrar=r.registrar,this.peerId=r.peerId,this.started=!1,this.topics=new Map,this.subscriptions=new Set,this.peers=new Map,!un[n])throw F(new Error("Invalid global signature policy"),Pr.ERR_INVALID_SIGUATURE_POLICY);this.globalSignaturePolicy=n,this.canRelayMessage=i,this.emitSelf=s,this.topicValidators=new Map,this._registrarId=void 0,this._onIncomingStream=this._onIncomingStream.bind(this),this._onPeerConnected=this._onPeerConnected.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this)}start(){if(this.started)return;this.log("starting"),this.registrar.handle(this.multicodecs,this._onIncomingStream);const t=new cP({multicodecs:this.multicodecs,handlers:{onConnect:this._onPeerConnected,onDisconnect:this._onPeerDisconnected}});this._registrarId=this.registrar.register(t),this.log("started"),this.started=!0}stop(){if(!this.started)return;this.registrar.unregister(this._registrarId),this.log("stopping"),this.peers.forEach(t=>t.close()),this.peers=new Map,this.subscriptions=new Set,this.started=!1,this.log("stopped")}_onIncomingStream({protocol:t,stream:e,connection:r}){const n=r.remotePeer,i=n.toB58String(),s=this._addPeer(n,t);s.attachInboundStream(e),this._processMessages(i,s.inboundStream,s)}async _onPeerConnected(t,e){const r=t.toB58String();this.log("connected",r);try{const{stream:n,protocol:i}=await e.newStream(this.multicodecs),s=this._addPeer(t,i);await s.attachOutboundStream(n)}catch(n){this.log.err(n)}this._sendSubscriptions(r,Array.from(this.subscriptions),!0)}_onPeerDisconnected(t,e){const r=t.toB58String();this.log("connection ended",r,e?e.message:""),this._removePeer(t)}_addPeer(t,e){const r=t.toB58String(),n=this.peers.get(r);if(n)return n;this.log("new peer",r);const i=new hP({id:t,protocol:e});return this.peers.set(r,i),i.once("close",()=>this._removePeer(t)),i}_removePeer(t){if(!t)return;const e=t.toB58String(),r=this.peers.get(e);if(!r)return;r.removeAllListeners(),r.close(),this.log("delete peer",e),this.peers.delete(e);for(const n of this.topics.values())n.delete(e);return r}async _processMessages(t,e,r){try{await nr(e,async n=>{for await(const i of n){const s=i instanceof Uint8Array?i:i.slice(),a=this._decodeRpc(s);this._processRpc(t,r,a)}})}catch(n){this._onPeerDisconnected(r.id,n)}}_processRpc(t,e,r){this.log("rpc from",t);const n=r.subscriptions,i=r.msgs;return n.length&&(n.forEach(s=>this._processRpcSubOpt(t,s)),this.emit("pubsub:subscription-change",e.id,n)),this._acceptFrom(t)?(i.length&&i.forEach(s=>{if(!(this.canRelayMessage||s.topicIDs.some(c=>this.subscriptions.has(c)))){this.log("received message we didn't subscribe to. Dropping.");return}const a=ln.normalizeInRpcMessage(s,t);this._processRpcMessage(a)}),!0):(this.log("received message from unacceptable peer %s",t),!1)}_processRpcSubOpt(t,e){const r=e.topicID;let n=this.topics.get(r);n||(n=new Set,this.topics.set(r,n)),e.subscribe?n.add(t):n.delete(t)}async _processRpcMessage(t){if(this.peerId.toB58String()===t.from&&!this.emitSelf)return;try{await this.validate(t)}catch(e){this.log("Message is invalid, dropping it. %O",e);return}this._emitMessage(t),this._publish(ln.normalizeOutRpcMessage(t))}_emitMessage(t){t.topicIDs.forEach(e=>{this.subscriptions.has(e)&&this.emit(e,t)})}getMsgId(t){const e=this.globalSignaturePolicy;switch(e){case un.StrictSign:return ln.msgId(t.from,t.seqno);case un.StrictNoSign:return ln.noSignMsgId(t.data);default:throw F(new Error("Cannot get message id: unhandled signature policy: "+e),Pr.ERR_UNHANDLED_SIGNATURE_POLICY)}}_acceptFrom(t){return!0}_decodeRpc(t){return Ec.rpc.RPC.decode(t)}_encodeRpc(t){return Ec.rpc.RPC.encode(t)}_sendRpc(t,e){const r=this.peers.get(t);if(!r||!r.isWritable){const n=`Cannot send RPC to ${t} as there is no open stream to it available`;this.log.err(n);return}r.write(this._encodeRpc(e))}_sendSubscriptions(t,e,r){return this._sendRpc(t,{subscriptions:e.map(n=>({topicID:n,subscribe:r}))})}async validate(t){const e=this.globalSignaturePolicy;switch(e){case un.StrictNoSign:if(t.from)throw F(new Error("StrictNoSigning: from should not be present"),Pr.ERR_UNEXPECTED_FROM);if(t.signature)throw F(new Error("StrictNoSigning: signature should not be present"),Pr.ERR_UNEXPECTED_SIGNATURE);if(t.key)throw F(new Error("StrictNoSigning: key should not be present"),Pr.ERR_UNEXPECTED_KEY);if(t.seqno)throw F(new Error("StrictNoSigning: seqno should not be present"),Pr.ERR_UNEXPECTED_SEQNO);break;case un.StrictSign:if(!t.signature)throw F(new Error("StrictSigning: Signing required and no signature was present"),Pr.ERR_MISSING_SIGNATURE);if(!t.seqno)throw F(new Error("StrictSigning: Signing required and no seqno was present"),Pr.ERR_MISSING_SEQNO);if(!await wP(t))throw F(new Error("StrictSigning: Invalid message signature"),Pr.ERR_INVALID_SIGNATURE);break;default:throw F(new Error("Cannot validate message: unhandled signature policy: "+e),Pr.ERR_UNHANDLED_SIGNATURE_POLICY)}for(const r of t.topicIDs){const n=this.topicValidators.get(r);if(!n)continue;await n(r,t)}}_buildMessage(t){const e=this.globalSignaturePolicy;switch(e){case un.StrictSign:return t.from=this.peerId.toB58String(),t.seqno=ln.randomSeqno(),vP(this.peerId,ln.normalizeOutRpcMessage(t));case un.StrictNoSign:return t;default:throw F(new Error("Cannot build message: unhandled signature policy: "+e),Pr.ERR_UNHANDLED_SIGNATURE_POLICY)}}getSubscribers(t){if(!this.started)throw F(new Error("not started yet"),"ERR_NOT_STARTED_YET");if(!t||typeof t!="string")throw F(new Error("a string topic must be provided"),"ERR_NOT_VALID_TOPIC");const e=this.topics.get(t);return e?Array.from(e):[]}async publish(t,e){if(!this.started)throw new Error("Pubsub has not started");this.log("publish",t,e);const r=this.peerId.toB58String();let n={receivedFrom:r,data:e,topicIDs:[t]};const i=await this._buildMessage(n);n=ln.normalizeInRpcMessage(i),this.emitSelf&&this._emitMessage(n),await this._publish(n)}_publish(t){throw F(new Error("publish must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}subscribe(t){if(!this.started)throw new Error("Pubsub has not started");this.subscriptions.has(t)||(this.subscriptions.add(t),this.peers.forEach((e,r)=>this._sendSubscriptions(r,[t],!0)))}unsubscribe(t){if(!this.started)throw new Error("Pubsub is not started");this.subscriptions.has(t)&&this.listenerCount(t)===0&&(this.subscriptions.delete(t),this.peers.forEach((e,r)=>this._sendSubscriptions(r,[t],!1)))}getTopics(){if(!this.started)throw new Error("Pubsub is not started");return Array.from(this.subscriptions)}}var Tc=SP,_P=Ec,EP=ln,TP=un;Tc.message=_P,Tc.utils=EP,Tc.SignaturePolicy=TP;var AP=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.createGossipRpc=void 0;function r(n=[],i={}){return{subscriptions:[],msgs:n,control:Object.assign({ihave:[],iwant:[],graft:[],prune:[]},i)}}e.createGossipRpc=r}),CP=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.shuffle=void 0;function r(n){if(n.length<=1)return n;const i=()=>Math.floor(Math.random()*Math.floor(n.length));for(let s=0;s<n.length;s++){const a=i(),c=n[s];n[s]=n[a],n[a]=c}return n}e.shuffle=r}),Ai=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ERR_TOPIC_VALIDATOR_IGNORE=e.ERR_TOPIC_VALIDATOR_REJECT=e.TimeCacheDuration=e.GossipsubIWantFollowupTime=e.GossipsubMaxIHaveMessages=e.GossipsubMaxIHaveLength=e.GossipsubGraftFloodThreshold=e.GossipsubOpportunisticGraftPeers=e.GossipsubOpportunisticGraftTicks=e.GossipsubDirectConnectInitialDelay=e.GossipsubDirectConnectTicks=e.GossipsubConnectionTimeout=e.GossipsubMaxPendingConnections=e.GossipsubConnectors=e.GossipsubPruneBackoffTicks=e.GossipsubPruneBackoff=e.GossipsubPrunePeers=e.GossipsubFanoutTTL=e.GossipsubHeartbeatInterval=e.GossipsubHeartbeatInitialDelay=e.GossipsubGossipRetransmission=e.GossipsubGossipFactor=e.GossipsubDlazy=e.GossipsubHistoryGossip=e.GossipsubHistoryLength=e.GossipsubDout=e.GossipsubDscore=e.GossipsubDhi=e.GossipsubDlo=e.GossipsubD=e.GossipsubIDv11=e.GossipsubIDv10=e.FloodsubID=e.minute=e.second=void 0,e.second=1e3,e.minute=60*e.second,e.FloodsubID="/floodsub/1.0.0",e.GossipsubIDv10="/meshsub/1.0.0",e.GossipsubIDv11="/meshsub/1.1.0",e.GossipsubD=6,e.GossipsubDlo=4,e.GossipsubDhi=12,e.GossipsubDscore=4,e.GossipsubDout=2,e.GossipsubHistoryLength=5,e.GossipsubHistoryGossip=3,e.GossipsubDlazy=6,e.GossipsubGossipFactor=.25,e.GossipsubGossipRetransmission=3,e.GossipsubHeartbeatInitialDelay=100,e.GossipsubHeartbeatInterval=e.second,e.GossipsubFanoutTTL=e.minute,e.GossipsubPrunePeers=16,e.GossipsubPruneBackoff=e.minute,e.GossipsubPruneBackoffTicks=15,e.GossipsubConnectors=8,e.GossipsubMaxPendingConnections=128,e.GossipsubConnectionTimeout=30*e.second,e.GossipsubDirectConnectTicks=300,e.GossipsubDirectConnectInitialDelay=e.second,e.GossipsubOpportunisticGraftTicks=60,e.GossipsubOpportunisticGraftPeers=2,e.GossipsubGraftFloodThreshold=10*e.second,e.GossipsubMaxIHaveLength=5e3,e.GossipsubMaxIHaveMessages=10,e.GossipsubIWantFollowupTime=3*e.second,e.TimeCacheDuration=120*1e3,e.ERR_TOPIC_VALIDATOR_REJECT="ERR_TOPIC_VALIDATOR_REJECT",e.ERR_TOPIC_VALIDATOR_IGNORE="ERR_TOPIC_VALIDATOR_IGNORE"}),IP=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.hasGossipProtocol=void 0;function r(n){return n===Ai.GossipsubIDv10||n===Ai.GossipsubIDv11}e.hasGossipProtocol=r}),RP=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.messageIdToString=void 0;function r(n){return ae(n,"base64")}e.messageIdToString=r}),Le=ee(function(t,e){var r=se&&se.__createBinding||(Object.create?function(i,s,a,c){c===void 0&&(c=a),Object.defineProperty(i,c,{enumerable:!0,get:function(){return s[a]}})}:function(i,s,a,c){c===void 0&&(c=a),i[c]=s[a]}),n=se&&se.__exportStar||function(i,s){for(var a in i)a!=="default"&&!s.hasOwnProperty(a)&&r(s,i,a)};Object.defineProperty(e,"__esModule",{value:!0}),n(AP,e),n(CP,e),n(IP,e),n(RP,e)}),kP=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.MessageCache=void 0;class r{constructor(n,i,s){this.msgs=new Map,this.peertx=new Map,this.history=[];for(let a=0;a<i;a++)this.history[a]=[];this.gossip=n,this.msgIdFn=s}put(n){const i=this.getMsgId(n),s=Le.messageIdToString(i);this.msgs.set(s,n),this.history[0].push({msgID:i,topics:n.topicIDs})}getMsgId(n){return this.msgIdFn(n)}get(n){return this.msgs.get(Le.messageIdToString(n))}getForPeer(n,i){const s=Le.messageIdToString(n),a=this.msgs.get(s);if(!a)return[void 0,0];let c=this.peertx.get(s);c||(c=new Map,this.peertx.set(s,c));const o=(c.get(i)||0)+1;return c.set(i,o),[a,o]}getGossipIDs(n){const i=[];for(let s=0;s<this.gossip;s++)this.history[s].forEach(a=>{for(const c of a.topics)if(c===n){i.push(a.msgID);break}});return i}shift(){const n=this.history[this.history.length-1];n.forEach(i=>{const s=Le.messageIdToString(i.msgID);this.msgs.delete(s),this.peertx.delete(s)}),this.history.pop(),this.history.unshift([])}}e.MessageCache=r}),PP=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=`
message RPC {
  repeated SubOpts subscriptions = 1;
  repeated Message msgs = 2;
  optional ControlMessage control = 3;

  message SubOpts {
    optional bool subscribe = 1; // subscribe or unsubcribe
    optional string topicID = 2;
  }

  message Message {
    optional bytes from = 1;
    optional bytes data = 2;
    optional bytes seqno = 3;
    repeated string topicIDs = 4; 
    optional bytes signature = 5;
    optional bytes key = 6;
  }

  message ControlMessage {
    repeated ControlIHave ihave = 1;
    repeated ControlIWant iwant = 2;
    repeated ControlGraft graft = 3;
    repeated ControlPrune prune = 4;
  }

  message ControlIHave {
    optional string topicID = 1;
    repeated bytes messageIDs = 2;
  }

  message ControlIWant {
    repeated bytes messageIDs = 1;  
  }

  message ControlGraft {
    optional string topicID = 1;
  }

  message ControlPrune {
    optional string topicID = 1;
    repeated PeerInfo peers = 2;
    optional uint64 backoff = 3;
  }

  message PeerInfo {
    optional bytes peerID = 1;
    optional bytes signedPeerRecord = 2;
  }
}`}),td=ee(function(t,e){var r=se&&se.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(e,"__esModule",{value:!0}),e.RPCCodec=void 0;const n=r(PP),i=Dr(n.default);e.RPCCodec=i.RPC}),Vn=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getGossipPeers=void 0;function r(n,i,s,a=()=>!0){const c=n.topics.get(i);if(!c)return new Set;let o=[];return c.forEach(l=>{const u=n.peers.get(l);if(!u)return;Le.hasGossipProtocol(u.protocol)&&a(l)&&o.push(l)}),o=Le.shuffle(o),s>0&&o.length>s&&(o=o.slice(0,s)),new Set(o)}e.getGossipPeers=r}),NP=ee(function(t,e){var r=se&&se.__createBinding||(Object.create?function(c,o,l,u){u===void 0&&(u=l),Object.defineProperty(c,u,{enumerable:!0,get:function(){return o[l]}})}:function(c,o,l,u){u===void 0&&(u=l),c[u]=o[l]}),n=se&&se.__setModuleDefault||(Object.create?function(c,o){Object.defineProperty(c,"default",{enumerable:!0,value:o})}:function(c,o){c.default=o}),i=se&&se.__importStar||function(c){if(c&&c.__esModule)return c;var o={};if(c!=null)for(var l in c)l!=="default"&&Object.hasOwnProperty.call(c,l)&&r(o,c,l);return n(o,c),o};Object.defineProperty(e,"__esModule",{value:!0}),e.Heartbeat=void 0;const s=i(Ai);class a{constructor(c){this.gossipsub=c}start(){if(this._heartbeatTimer)return;const c=this._heartbeat.bind(this),o=setTimeout(()=>{c(),this._heartbeatTimer.runPeriodically(c,s.GossipsubHeartbeatInterval)},s.GossipsubHeartbeatInitialDelay);this._heartbeatTimer={_intervalId:void 0,runPeriodically:(l,u)=>{this._heartbeatTimer._intervalId=setInterval(l,u)},cancel:()=>{clearTimeout(o),clearInterval(this._heartbeatTimer._intervalId)}}}stop(){if(!this._heartbeatTimer)return;this._heartbeatTimer.cancel(),this._heartbeatTimer=null}_heartbeat(){const{D:c,Dlo:o,Dhi:l,Dscore:u,Dout:h}=this.gossipsub._options;this.gossipsub.heartbeatTicks++;const S=new Map,p=x=>{let q=S.get(x);return q===void 0&&(q=this.gossipsub.score.score(x),S.set(x,q)),q},C=new Map,T=new Map,E=new Map;this.gossipsub._clearBackoff(),this.gossipsub.peerhave.clear(),this.gossipsub.iasked.clear(),this.gossipsub._applyIwantPenalties(),this.gossipsub._directConnect(),this.gossipsub.mesh.forEach((x,q)=>{const m=A=>{this.gossipsub.log("HEARTBEAT: Remove mesh link to %s in %s",A,q),this.gossipsub.score.prune(A,q),this.gossipsub._addBackoff(A,q),x.delete(A);const d=T.get(A);d?d.push(q):T.set(A,[q])},b=A=>{this.gossipsub.log("HEARTBEAT: Add mesh link to %s in %s",A,q),this.gossipsub.score.graft(A,q),x.add(A);const d=C.get(A);d?d.push(q):C.set(A,[q])};if(x.forEach(A=>{const d=p(A);d<0&&(this.gossipsub.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",A,d,q),m(A),E.set(A,!0))}),x.size<o){const A=this.gossipsub.backoff.get(q),d=c-x.size,f=Vn.getGossipPeers(this.gossipsub,q,d,_=>!x.has(_)&&!this.gossipsub.direct.has(_)&&(!A||!A.has(_))&&p(_)>=0);f.forEach(b)}if(x.size>l){let A=Array.from(x);A.sort((f,_)=>p(_)-p(f)),A=A.slice(0,u).concat(Le.shuffle(A.slice(u)));let d=0;if(A.slice(0,c).forEach(f=>{this.gossipsub.outbound.get(f)&&d++}),d<h){const f=y=>{const k=A[y];for(let N=y;N>0;N--)A[N]=A[N-1];A[0]=k};if(d>0){let y=d;for(let k=1;k<c&&y>0;k++)this.gossipsub.outbound.get(A[k])&&(f(k),y--)}let _=c-d;for(let y=c;y<A.length&&_>0;y++)this.gossipsub.outbound.get(A[y])&&(f(y),_--)}A.slice(c).forEach(m)}if(x.size>=o){let A=0;if(x.forEach(d=>{this.gossipsub.outbound.get(d)&&A++}),A<h){const d=h-A,f=this.gossipsub.backoff.get(q);Vn.getGossipPeers(this.gossipsub,q,d,_=>!x.has(_)&&!this.gossipsub.direct.has(_)&&(!f||!f.has(_))&&p(_)>=0).forEach(b)}}if(this.gossipsub.heartbeatTicks%s.GossipsubOpportunisticGraftTicks===0&&x.size>1){const A=Array.from(x).sort((_,y)=>p(_)-p(y)),d=x.size/2,f=p(A[d]);if(f<this.gossipsub._options.scoreThresholds.opportunisticGraftThreshold){const _=this.gossipsub.backoff.get(q),y=Vn.getGossipPeers(this.gossipsub,q,s.GossipsubOpportunisticGraftPeers,k=>x.has(k)&&!this.gossipsub.direct.has(k)&&(!_||!_.has(k))&&p(k)>f);y.forEach(k=>{this.gossipsub.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",k,q),b(k)})}}this.gossipsub._emitGossip(q,x)});const I=this.gossipsub._now();this.gossipsub.lastpub.forEach((x,q)=>{x+s.GossipsubFanoutTTL<I&&(this.gossipsub.fanout.delete(q),this.gossipsub.lastpub.delete(q))}),this.gossipsub.fanout.forEach((x,q)=>{const m=this.gossipsub.topics.get(q);if(x.forEach(b=>{(!m.has(b)||p(b)<this.gossipsub._options.scoreThresholds.publishThreshold)&&x.delete(b)}),x.size<c){const b=c-x.size,A=Vn.getGossipPeers(this.gossipsub,q,b,d=>!x.has(d)&&!this.gossipsub.direct.has(d)&&p(d)>=this.gossipsub._options.scoreThresholds.publishThreshold);A.forEach(d=>{x.add(d)})}this.gossipsub._emitGossip(q,x)}),this.gossipsub._sendGraftPrune(C,T,E),this.gossipsub._flush(),this.gossipsub.messageCache.shift(),this.gossipsub.emit("gossipsub:heartbeat")}}e.Heartbeat=a}),Pe=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ERR_INVALID_PEER_SCORE_THRESHOLDS=e.ERR_INVALID_PEER_SCORE_PARAMS=void 0,e.ERR_INVALID_PEER_SCORE_PARAMS="ERR_INVALID_PEER_SCORE_PARAMS",e.ERR_INVALID_PEER_SCORE_THRESHOLDS="ERR_INVALID_PEER_SCORE_THRESHOLDS"}),kg=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.validateTopicScoreParams=e.validatePeerScoreParams=e.createTopicScoreParams=e.createPeerScoreParams=e.defaultTopicScoreParams=e.defaultPeerScoreParams=void 0,e.defaultPeerScoreParams={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},e.defaultTopicScoreParams={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function r(a={}){return Object.assign(Object.assign(Object.assign({},e.defaultPeerScoreParams),a),{topics:a.topics?Object.entries(a.topics).reduce((c,[o,l])=>(c[o]=n(l),c),{}):{}})}e.createPeerScoreParams=r;function n(a={}){return Object.assign(Object.assign({},e.defaultTopicScoreParams),a)}e.createTopicScoreParams=n;function i(a){for(const[c,o]of Object.entries(a.topics))try{s(o)}catch(l){throw F(new Error(`invalid score parameters for topic ${c}: ${l.message}`),Pe.ERR_INVALID_PEER_SCORE_PARAMS)}if(a.topicScoreCap<0)throw F(new Error("invalid topic score cap; must be positive (or 0 for no cap)"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.appSpecificScore===null||a.appSpecificScore===void 0)throw F(new Error("missing application specific score function"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.IPColocationFactorWeight>0)throw F(new Error("invalid IPColocationFactorWeight; must be negative (or 0 to disable)"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.IPColocationFactorWeight!==0&&a.IPColocationFactorThreshold<1)throw F(new Error("invalid IPColocationFactorThreshold; must be at least 1"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.behaviourPenaltyWeight>0)throw F(new Error("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.behaviourPenaltyWeight!==0&&(a.behaviourPenaltyDecay<=0||a.behaviourPenaltyDecay>=1))throw F(new Error("invalid BehaviourPenaltyDecay; must be between 0 and 1"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.decayInterval<1e3)throw F(new Error("invalid DecayInterval; must be at least 1s"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.decayToZero<=0||a.decayToZero>=1)throw F(new Error("invalid DecayToZero; must be between 0 and 1"),Pe.ERR_INVALID_PEER_SCORE_PARAMS)}e.validatePeerScoreParams=i;function s(a){if(a.topicWeight<0)throw F(new Error("invalid topic weight; must be >= 0"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.timeInMeshQuantum===0)throw F(new Error("invalid TimeInMeshQuantum; must be non zero"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.timeInMeshWeight<0)throw F(new Error("invalid TimeInMeshWeight; must be positive (or 0 to disable)"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.timeInMeshWeight!==0&&a.timeInMeshQuantum<=0)throw F(new Error("invalid TimeInMeshQuantum; must be positive"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.timeInMeshWeight!==0&&a.timeInMeshCap<=0)throw F(new Error("invalid TimeInMeshCap; must be positive"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.firstMessageDeliveriesWeight<0)throw F(new Error("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.firstMessageDeliveriesWeight!==0&&(a.firstMessageDeliveriesDecay<=0||a.firstMessageDeliveriesDecay>=1))throw F(new Error("invalid FirstMessageDeliveriesDecay; must be between 0 and 1"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.firstMessageDeliveriesWeight!==0&&a.firstMessageDeliveriesCap<=0)throw F(new Error("invalid FirstMessageDeliveriesCap; must be positive"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight>0)throw F(new Error("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight!==0&&(a.meshMessageDeliveriesDecay<=0||a.meshMessageDeliveriesDecay>=1))throw F(new Error("invalid MeshMessageDeliveriesDecay; must be between 0 and 1"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight!==0&&a.meshMessageDeliveriesCap<=0)throw F(new Error("invalid MeshMessageDeliveriesCap; must be positive"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight!==0&&a.meshMessageDeliveriesThreshold<=0)throw F(new Error("invalid MeshMessageDeliveriesThreshold; must be positive"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWindow<0)throw F(new Error("invalid MeshMessageDeliveriesWindow; must be non-negative"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight!==0&&a.meshMessageDeliveriesActivation<1e3)throw F(new Error("invalid MeshMessageDeliveriesActivation; must be at least 1s"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshFailurePenaltyWeight>0)throw F(new Error("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshFailurePenaltyWeight!==0&&(a.meshFailurePenaltyDecay<=0||a.meshFailurePenaltyDecay>=1))throw F(new Error("invalid MeshFailurePenaltyDecay; must be between 0 and 1"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.invalidMessageDeliveriesWeight>0)throw F(new Error("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)"),Pe.ERR_INVALID_PEER_SCORE_PARAMS);if(a.invalidMessageDeliveriesDecay<=0||a.invalidMessageDeliveriesDecay>=1)throw F(new Error("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1"),Pe.ERR_INVALID_PEER_SCORE_PARAMS)}e.validateTopicScoreParams=s}),OP=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.validatePeerScoreThresholds=e.createPeerScoreThresholds=e.defaultPeerScoreThresholds=void 0,e.defaultPeerScoreThresholds={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function r(i={}){return Object.assign(Object.assign({},e.defaultPeerScoreThresholds),i)}e.createPeerScoreThresholds=r;function n(i){if(i.gossipThreshold>0)throw F(new Error("invalid gossip threshold; it must be <= 0"),Pe.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.publishThreshold>0||i.publishThreshold>i.gossipThreshold)throw F(new Error("invalid publish threshold; it must be <= 0 and <= gossip threshold"),Pe.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.graylistThreshold>0||i.graylistThreshold>i.publishThreshold)throw F(new Error("invalid graylist threshold; it must be <= 0 and <= publish threshold"),Pe.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.acceptPXThreshold<0)throw F(new Error("invalid accept PX threshold; it must be >= 0"),Pe.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.opportunisticGraftThreshold<0)throw F(new Error("invalid opportunistic grafting threshold; it must be >= 0"),Pe.ERR_INVALID_PEER_SCORE_THRESHOLDS)}e.validatePeerScoreThresholds=n}),Cs=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ensureTopicStats=e.createTopicStats=e.createPeerStats=void 0;function r(s={}){return Object.assign(Object.assign({connected:!1,expire:0,ips:[],behaviourPenalty:0},s),{topics:s.topics?Object.entries(s.topics).reduce((a,[c,o])=>(a[c]=n(o),a),{}):{}})}e.createPeerStats=r;function n(s={}){return Object.assign({inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},s)}e.createTopicStats=n;function i(s,a,c){let o=a.topics[s];return o||(c.topics[s]?(a.topics[s]=o=n(),o):void 0)}e.ensureTopicStats=i}),MP=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.computeScore=void 0;function r(n,i,s,a){let c=0;Object.entries(i.topics).forEach(([u,h])=>{const S=s.topics[u];if(!S)return;let p=0;if(h.inMesh){let I=h.meshTime/S.timeInMeshQuantum;I>S.timeInMeshCap&&(I=S.timeInMeshCap),p+=I*S.timeInMeshWeight}const C=h.firstMessageDeliveries;if(p+=C*S.firstMessageDeliveriesWeight,h.meshMessageDeliveriesActive&&h.meshMessageDeliveries<S.meshMessageDeliveriesThreshold){const I=S.meshMessageDeliveriesThreshold-h.meshMessageDeliveries,x=I*I;p+=x*S.meshMessageDeliveriesWeight}const T=h.meshFailurePenalty;p+=T*S.meshFailurePenaltyWeight;const E=h.invalidMessageDeliveries*h.invalidMessageDeliveries;p+=E*S.invalidMessageDeliveriesWeight,c+=p*S.topicWeight}),s.topicScoreCap>0&&c>s.topicScoreCap&&(c=s.topicScoreCap);const o=s.appSpecificScore(n);c+=o*s.appSpecificWeight,i.ips.forEach(u=>{if(s.IPColocationFactorWhitelist.has(u))return;const h=a.get(u),S=h?h.size:0;if(S>s.IPColocationFactorThreshold){const p=S-s.IPColocationFactorThreshold,C=p*p;c+=C*s.IPColocationFactorWeight}});const l=i.behaviourPenalty*i.behaviourPenalty;return c+=l*s.behaviourPenaltyWeight,c}e.computeScore=r});function Ke(t){this._head=0,this._tail=0,this._capacityMask=3,this._list=new Array(4),Array.isArray(t)&&this._fromArray(t)}Ke.prototype.peekAt=function(e){var r=e;if(r!==(r|0))return;var n=this.size();return r>=n||r<-n?void 0:(r<0&&(r+=n),r=this._head+r&this._capacityMask,this._list[r])},Ke.prototype.get=function(e){return this.peekAt(e)},Ke.prototype.peek=function(){return this._head===this._tail?void 0:this._list[this._head]},Ke.prototype.peekFront=function(){return this.peek()},Ke.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(Ke.prototype,"length",{get:function(){return this.size()}}),Ke.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},Ke.prototype.unshift=function(e){if(e===void 0)return this.size();var r=this._list.length;return this._head=this._head-1+r&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},Ke.prototype.shift=function(){var e=this._head;if(e===this._tail)return;var r=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),r},Ke.prototype.push=function(e){if(e===void 0)return this.size();var r=this._tail;return this._list[r]=e,this._tail=r+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},Ke.prototype.pop=function(){var e=this._tail;if(e===this._head)return;var r=this._list.length;this._tail=e-1+r&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=r>>>2&&this._shrinkArray(),n},Ke.prototype.removeOne=function(e){var r=e;if(r!==(r|0))return;if(this._head===this._tail)return;var n=this.size(),i=this._list.length;if(r>=n||r<-n)return;r<0&&(r+=n),r=this._head+r&this._capacityMask;var s=this._list[r],a;if(e<n/2){for(a=e;a>0;a--)this._list[r]=this._list[r=r-1+i&this._capacityMask];this._list[r]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(a=n-1-e;a>0;a--)this._list[r]=this._list[r=r+1+i&this._capacityMask];this._list[r]=void 0,this._tail=this._tail-1+i&this._capacityMask}return s},Ke.prototype.remove=function(e,r){var n=e,i,s=r;if(n!==(n|0))return;if(this._head===this._tail)return;var a=this.size(),c=this._list.length;if(n>=a||n<-a||r<1)return;if(n<0&&(n+=a),r===1||!r)return i=new Array(1),i[0]=this.removeOne(n),i;if(n===0&&n+r>=a)return i=this.toArray(),this.clear(),i;n+r>a&&(r=a-n);var o;for(i=new Array(r),o=0;o<r;o++)i[o]=this._list[this._head+n+o&this._capacityMask];if(n=this._head+n&this._capacityMask,e+r===a){for(this._tail=this._tail-r+c&this._capacityMask,o=r;o>0;o--)this._list[n=n+1+c&this._capacityMask]=void 0;return i}if(e===0){for(this._head=this._head+r+c&this._capacityMask,o=r-1;o>0;o--)this._list[n=n+1+c&this._capacityMask]=void 0;return i}if(n<a/2){for(this._head=this._head+e+r+c&this._capacityMask,o=e;o>0;o--)this.unshift(this._list[n=n-1+c&this._capacityMask]);for(n=this._head-1+c&this._capacityMask;s>0;)this._list[n=n-1+c&this._capacityMask]=void 0,s--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+r+c&this._capacityMask,o=a-(r+e);o>0;o--)this.push(this._list[n++]);for(n=this._tail;s>0;)this._list[n=n+1+c&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=c>>>2&&this._shrinkArray(),i},Ke.prototype.splice=function(e,r){var n=e;if(n!==(n|0))return;var i=this.size();if(n<0&&(n+=i),n>i)return;if(arguments.length>2){var s,a,c,o=arguments.length,l=this._list.length,u=2;if(!i||n<i/2){for(a=new Array(n),s=0;s<n;s++)a[s]=this._list[this._head+s&this._capacityMask];for(r===0?(c=[],n>0&&(this._head=this._head+n+l&this._capacityMask)):(c=this.remove(n,r),this._head=this._head+n+l&this._capacityMask);o>u;)this.unshift(arguments[--o]);for(s=n;s>0;s--)this.unshift(a[s-1])}else{a=new Array(i-(n+r));var h=a.length;for(s=0;s<h;s++)a[s]=this._list[this._head+n+r+s&this._capacityMask];for(r===0?(c=[],n!=i&&(this._tail=this._head+n+l&this._capacityMask)):(c=this.remove(n,r),this._tail=this._tail-h+l&this._capacityMask);u<o;)this.push(arguments[u++]);for(s=0;s<h;s++)this.push(a[s])}return c}else return this.remove(n,r)},Ke.prototype.clear=function(){this._head=0,this._tail=0},Ke.prototype.isEmpty=function(){return this._head===this._tail},Ke.prototype.toArray=function(){return this._copyArray(!1)},Ke.prototype._fromArray=function(e){for(var r=0;r<e.length;r++)this.push(e[r])},Ke.prototype._copyArray=function(e){var r=[],n=this._list,i=n.length,s;if(e||this._head>this._tail){for(s=this._head;s<i;s++)r.push(n[s]);for(s=0;s<this._tail;s++)r.push(n[s])}else for(s=this._head;s<this._tail;s++)r.push(n[s]);return r},Ke.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length*=2,this._capacityMask=this._capacityMask<<1|1},Ke.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};var DP=Ke,Nr=ee(function(t,e){var r=se&&se.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(e,"__esModule",{value:!0}),e.MessageDeliveries=e.DeliveryRecordStatus=void 0;const n=r(DP);var i;(function(a){a[a.unknown=0]="unknown",a[a.valid=1]="valid",a[a.invalid=2]="invalid",a[a.ignored=3]="ignored"})(i=e.DeliveryRecordStatus||(e.DeliveryRecordStatus={}));class s{constructor(){this.records=new Map,this.queue=new n.default}ensureRecord(a){const c=Le.messageIdToString(a);let o=this.records.get(c);if(o)return o;o={status:i.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(c,o);const l={msgId:c,expire:Date.now()+Ai.TimeCacheDuration};return this.queue.push(l),o}gc(){const a=Date.now();let c=this.queue.peekFront();for(;c&&c.expire<a;)this.records.delete(c.msgId),this.queue.shift(),c=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}e.MessageDeliveries=s}),xP=ee(function(t,e){var r=se&&se.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(e,"__esModule",{value:!0}),e.PeerScore=void 0;const n=r(me),{ERR_INVALID_SIGNATURE:i,ERR_MISSING_SIGNATURE:s}=Zu.codes,a=Q("libp2p:gossipsub:score");class c{constructor(o,l,u){kg.validatePeerScoreParams(o),this.params=o,this._connectionManager=l,this.peerStats=new Map,this.peerIPs=new Map,this.deliveryRecords=new Nr.MessageDeliveries,this.msgId=u}start(){if(this._backgroundInterval){a("Peer score already running");return}this._backgroundInterval=setInterval(()=>this.background(),this.params.decayInterval),a("started")}stop(){if(!this._backgroundInterval){a("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),a("stopped")}background(){this._refreshScores(),this._updateIPs(),this.deliveryRecords.gc()}_refreshScores(){const o=Date.now(),l=this.params.decayToZero;this.peerStats.forEach((u,h)=>{if(!u.connected){o>u.expire&&(this._removeIPs(h,u.ips),this.peerStats.delete(h));return}Object.entries(u.topics).forEach(([S,p])=>{const C=this.params.topics[S];if(!C)return;p.firstMessageDeliveries*=C.firstMessageDeliveriesDecay,p.firstMessageDeliveries<l&&(p.firstMessageDeliveries=0),p.meshMessageDeliveries*=C.meshMessageDeliveriesDecay,p.meshMessageDeliveries<l&&(p.meshMessageDeliveries=0),p.meshFailurePenalty*=C.meshFailurePenaltyDecay,p.meshFailurePenalty<l&&(p.meshFailurePenalty=0),p.invalidMessageDeliveries*=C.invalidMessageDeliveriesDecay,p.invalidMessageDeliveries<l&&(p.invalidMessageDeliveries=0),p.inMesh&&(p.meshTime=o-p.graftTime,p.meshTime>C.meshMessageDeliveriesActivation&&(p.meshMessageDeliveriesActive=!0))}),u.behaviourPenalty*=this.params.behaviourPenaltyDecay,u.behaviourPenalty<l&&(u.behaviourPenalty=0)})}score(o){const l=this.peerStats.get(o);return l?MP.computeScore(o,l,this.params,this.peerIPs):0}addPenalty(o,l){const u=this.peerStats.get(o);if(!u)return;u.behaviourPenalty+=l}addPeer(o){const l=Cs.createPeerStats({connected:!0});this.peerStats.set(o,l);const u=this._getIPs(o);this._setIPs(o,u,l.ips),l.ips=u}removePeer(o){const l=this.peerStats.get(o);if(!l)return;if(this.score(o)>0){this._removeIPs(o,l.ips),this.peerStats.delete(o);return}Object.entries(l.topics).forEach(([u,h])=>{h.firstMessageDeliveries=0;const S=this.params.topics[u].meshMessageDeliveriesThreshold;if(h.inMesh&&h.meshMessageDeliveriesActive&&h.meshMessageDeliveries<S){const p=S-h.meshMessageDeliveries;h.meshFailurePenalty+=p*p}h.inMesh=!1}),l.connected=!1,l.expire=Date.now()+this.params.retainScore}graft(o,l){const u=this.peerStats.get(o);if(!u)return;const h=Cs.ensureTopicStats(l,u,this.params);if(!h)return;h.inMesh=!0,h.graftTime=Date.now(),h.meshTime=0,h.meshMessageDeliveriesActive=!1}prune(o,l){const u=this.peerStats.get(o);if(!u)return;const h=Cs.ensureTopicStats(l,u,this.params);if(!h)return;const S=this.params.topics[l].meshMessageDeliveriesThreshold;if(h.meshMessageDeliveriesActive&&h.meshMessageDeliveries<S){const p=S-h.meshMessageDeliveries;h.meshFailurePenalty+=p*p}h.inMesh=!1}validateMessage(o){this.deliveryRecords.ensureRecord(this.msgId(o))}deliverMessage(o){const l=o.receivedFrom;this._markFirstMessageDelivery(l,o);const u=this.deliveryRecords.ensureRecord(this.msgId(o)),h=Date.now();if(u.status!==Nr.DeliveryRecordStatus.unknown){a("unexpected delivery: message from %s was first seen %s ago and has delivery status %d",l,h-u.firstSeen,Nr.DeliveryRecordStatus[u.status]);return}u.status=Nr.DeliveryRecordStatus.valid,u.validated=h,u.peers.forEach(S=>{S!==l&&this._markDuplicateMessageDelivery(S,o)})}rejectMessage(o,l){const u=o.receivedFrom;switch(l){case s:case i:this._markInvalidMessageDelivery(u,o);return}const h=this.deliveryRecords.ensureRecord(this.msgId(o));if(h.status!==Nr.DeliveryRecordStatus.unknown){a("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",u,Date.now()-h.firstSeen,Nr.DeliveryRecordStatus[h.status]);return}switch(l){case Ai.ERR_TOPIC_VALIDATOR_IGNORE:h.status=Nr.DeliveryRecordStatus.ignored;return}h.status=Nr.DeliveryRecordStatus.invalid,this._markInvalidMessageDelivery(u,o),h.peers.forEach(S=>{this._markInvalidMessageDelivery(S,o)})}duplicateMessage(o){const l=o.receivedFrom,u=this.deliveryRecords.ensureRecord(this.msgId(o));if(u.peers.has(l))return;switch(u.status){case Nr.DeliveryRecordStatus.unknown:u.peers.add(l);break;case Nr.DeliveryRecordStatus.valid:u.peers.add(l),this._markDuplicateMessageDelivery(l,o,u.validated);break;case Nr.DeliveryRecordStatus.invalid:this._markInvalidMessageDelivery(l,o);break}}_markInvalidMessageDelivery(o,l){const u=this.peerStats.get(o);if(!u)return;l.topicIDs.forEach(h=>{const S=Cs.ensureTopicStats(h,u,this.params);if(!S)return;S.invalidMessageDeliveries+=1})}_markFirstMessageDelivery(o,l){const u=this.peerStats.get(o);if(!u)return;l.topicIDs.forEach(h=>{const S=Cs.ensureTopicStats(h,u,this.params);if(!S)return;let p=this.params.topics[h].firstMessageDeliveriesCap;if(S.firstMessageDeliveries+=1,S.firstMessageDeliveries>p&&(S.firstMessageDeliveries=p),!S.inMesh)return;p=this.params.topics[h].meshMessageDeliveriesCap,S.meshMessageDeliveries+=1,S.meshMessageDeliveries>p&&(S.meshMessageDeliveries=p)})}_markDuplicateMessageDelivery(o,l,u=0){const h=this.peerStats.get(o);if(!h)return;const S=u?Date.now():0;l.topicIDs.forEach(p=>{const C=Cs.ensureTopicStats(p,h,this.params);if(!C)return;if(!C.inMesh)return;const T=this.params.topics[p];if(u&&S>u+T.meshMessageDeliveriesWindow)return;const E=T.meshMessageDeliveriesCap;C.meshMessageDeliveries+=1,C.meshMessageDeliveries>E&&(C.meshMessageDeliveries=E)})}_getIPs(o){return this._connectionManager.getAll(n.default.createFromB58String(o)).map(l=>l.remoteAddr.toOptions().host)}_setIPs(o,l,u){e:for(const h of l){for(const p of u)if(h===p)continue e;let S=this.peerIPs.get(h);S||(S=new Set,this.peerIPs.set(h,S)),S.add(o)}e:for(const h of u){for(const p of l)if(h===p)continue e;const S=this.peerIPs.get(h);if(!S)continue;S.delete(o),S.size||this.peerIPs.delete(h)}}_removeIPs(o,l){l.forEach(u=>{const h=this.peerIPs.get(u);if(!h)return;h.delete(o),h.size||this.peerIPs.delete(u)})}_updateIPs(){this.peerStats.forEach((o,l)=>{const u=this._getIPs(l);this._setIPs(l,u,o.ips),o.ips=u})}}e.PeerScore=c}),rd=ee(function(t,e){var r=se&&se.__createBinding||(Object.create?function(i,s,a,c){c===void 0&&(c=a),Object.defineProperty(i,c,{enumerable:!0,get:function(){return s[a]}})}:function(i,s,a,c){c===void 0&&(c=a),i[c]=s[a]}),n=se&&se.__exportStar||function(i,s){for(var a in i)a!=="default"&&!s.hasOwnProperty(a)&&r(s,i,a)};Object.defineProperty(e,"__esModule",{value:!0}),n(kg,e),n(OP,e),n(xP,e)}),LP=ee(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.IWantTracer=void 0;const{ERR_INVALID_SIGNATURE:r,ERR_MISSING_SIGNATURE:n}=Zu.codes;class i{constructor(s){this.getMsgId=s,this.promises=new Map}addPromise(s,a){const c=Math.floor(Math.random()*a.length),o=a[c],l=Le.messageIdToString(o);let u=this.promises.get(l);u||(u=new Map,this.promises.set(l,u)),u.has(s)||u.set(s,Date.now()+Ai.GossipsubIWantFollowupTime)}getBrokenPromises(){const s=Date.now(),a=new Map;return this.promises.forEach((c,o)=>{c.forEach((l,u)=>{l<s&&(a.set(u,(a.get(u)||0)+1),c.delete(u))}),c.size||this.promises.delete(o)}),a}deliverMessage(s){const a=this.getMsgId(s),c=Le.messageIdToString(a);this.promises.delete(c)}rejectMessage(s,a){switch(a){case r:case n:return}const c=this.getMsgId(s),o=Le.messageIdToString(c);this.promises.delete(o)}clear(){this.promises.clear()}}e.IWantTracer=i}),Pg="Expected a function",Ng=0/0,BP="[object Symbol]",jP=/^\s+|\s+$/g,UP=/^[-+]0x[0-9a-f]+$/i,FP=/^0b[01]+$/i,$P=/^0o[0-7]+$/i,qP=parseInt,GP=typeof se=="object"&&se&&se.Object===Object&&se,VP=typeof self=="object"&&self&&self.Object===Object&&self,HP=GP||VP||Function("return this")(),zP=Object.prototype,WP=zP.toString,KP=Math.max,XP=Math.min,nd=function(){return HP.Date.now()};function QP(t,e,r){var n,i,s,a,c,o,l=0,u=!1,h=!1,S=!0;if(typeof t!="function")throw new TypeError(Pg);e=Og(e)||0,Ac(r)&&(u=!!r.leading,h="maxWait"in r,s=h?KP(Og(r.maxWait)||0,e):s,S="trailing"in r?!!r.trailing:S);function p(A){var d=n,f=i;return n=i=void 0,l=A,a=t.apply(f,d),a}function C(A){return l=A,c=setTimeout(I,e),u?p(A):a}function T(A){var d=A-o,f=A-l,_=e-d;return h?XP(_,s-f):_}function E(A){var d=A-o,f=A-l;return o===void 0||d>=e||d<0||h&&f>=s}function I(){var A=nd();if(E(A))return x(A);c=setTimeout(I,T(A))}function x(A){return c=void 0,S&&n?p(A):(n=i=void 0,a)}function q(){c!==void 0&&clearTimeout(c),l=0,n=o=i=c=void 0}function m(){return c===void 0?a:x(nd())}function b(){var A=nd(),d=E(A);if(n=arguments,i=this,o=A,d){if(c===void 0)return C(o);if(h)return c=setTimeout(I,e),p(o)}return c===void 0&&(c=setTimeout(I,e)),a}return b.cancel=q,b.flush=m,b}function YP(t,e,r){var n=!0,i=!0;if(typeof t!="function")throw new TypeError(Pg);return Ac(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),QP(t,e,{leading:n,maxWait:e,trailing:i})}function Ac(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function JP(t){return!!t&&typeof t=="object"}function ZP(t){return typeof t=="symbol"||JP(t)&&WP.call(t)==BP}function Og(t){if(typeof t=="number")return t;if(ZP(t))return Ng;if(Ac(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Ac(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(jP,"");var r=FP.test(t);return r||$P.test(t)?qP(t.slice(2),r?2:8):UP.test(t)?Ng:+t}var eN=YP,tN=ee(function(t,e){e=t.exports=r;function r(i){if(!(this instanceof r))return new r(i);i=i||{};const s=i.validity||30,a=new Map,c=eN(()=>{a.forEach((o,l)=>{const u=o.validity||s,h=n(o.timestamp);h>u&&a.delete(l)})},200);this.put=(o,l,u)=>{this.has(o)||a.set(o,{value:l,timestamp:new Date,validity:u}),c()},this.get=o=>{if(a.has(o))return a.get(o).value;throw new Error("key does not exist")},this.has=o=>a.has(o)}function n(i){const s=new Date,a=s.getTime()-i.getTime();return Math.floor(a/1e3)}}),rN=ee(function(t){var e=se&&se.__createBinding||(Object.create?function(o,l,u,h){h===void 0&&(h=u),Object.defineProperty(o,h,{enumerable:!0,get:function(){return l[u]}})}:function(o,l,u,h){h===void 0&&(h=u),o[h]=l[u]}),r=se&&se.__setModuleDefault||(Object.create?function(o,l){Object.defineProperty(o,"default",{enumerable:!0,value:l})}:function(o,l){o.default=l}),n=se&&se.__importStar||function(o){if(o&&o.__esModule)return o;var l={};if(o!=null)for(var u in o)u!=="default"&&Object.hasOwnProperty.call(o,u)&&e(l,o,u);return r(l,o),l},i=se&&se.__awaiter||function(o,l,u,h){function S(p){return p instanceof u?p:new u(function(C){C(p)})}return new(u||(u=Promise))(function(p,C){function T(x){try{I(h.next(x))}catch(q){C(q)}}function E(x){try{I(h.throw(x))}catch(q){C(q)}}function I(x){x.done?p(x.value):S(x.value).then(T,E)}I((h=h.apply(o,l||[])).next())})};const s=n(Tc),a=n(Ai);class c extends s.default{constructor(o,l={}){const u=[a.GossipsubIDv11,a.GossipsubIDv10],h=Object.assign(Object.assign({gossipIncoming:!0,fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:a.GossipsubD,Dlo:a.GossipsubDlo,Dhi:a.GossipsubDhi,Dscore:a.GossipsubDscore,Dout:a.GossipsubDout,Dlazy:a.GossipsubDlazy},l),{scoreParams:rd.createPeerScoreParams(l.scoreParams),scoreThresholds:rd.createPeerScoreThresholds(l.scoreThresholds)});h.fallbackToFloodsub&&u.push(a.FloodsubID),super(Object.assign({debugName:"libp2p:gossipsub",multicodecs:u,libp2p:o},h)),this._options=h,this.direct=new Set(h.directPeers.map(S=>S.id.toB58String())),h.directPeers.forEach(S=>{o.peerStore.addressBook.add(S.id,S.addrs)}),this.seenCache=new tN,this.mesh=new Map,this.fanout=new Map,this.lastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.messageCache=l.messageCache||new kP.MessageCache(a.GossipsubHistoryGossip,a.GossipsubHistoryLength,this.getMsgId.bind(this)),this.heartbeat=new NP.Heartbeat(this),this.heartbeatTicks=0,this.gossipTracer=new LP.IWantTracer(this.getMsgId.bind(this)),this._libp2p=o,this.score=new rd.PeerScore(this._options.scoreParams,o.connectionManager,this.getMsgId.bind(this))}_decodeRpc(o){return td.RPCCodec.decode(o)}_encodeRpc(o){return td.RPCCodec.encode(o)}_addPeer(o,l){const u=super._addPeer(o,l);this.score.addPeer(o.toB58String());let h=!1;for(const S of this._libp2p.connectionManager.getAll(o))if(S.stat.direction==="outbound"&&Array.from(S.registry.values()).some(p=>l===p.protocol)){h=!0;break}return this.outbound.set(u.id.toB58String(),h),u}_removePeer(o){const l=super._removePeer(o),u=o.toB58String();for(const h of this.mesh.values())h.delete(u);for(const h of this.fanout.values())h.delete(u);return this.gossip.delete(u),this.control.delete(u),this.outbound.delete(u),this.score.removePeer(u),l}_processRpc(o,l,u){return super._processRpc(o,l,u)?(u.control&&this._processRpcControlMessage(o,u.control),!0):!1}_processRpcControlMessage(o,l){if(!l)return;const u=this._handleIHave(o,l.ihave),h=this._handleIWant(o,l.iwant),S=this._handleGraft(o,l.graft);if(this._handlePrune(o,l.prune),!u.length&&!h.length&&!S.length)return;const p=Le.createGossipRpc(h,{iwant:u,prune:S});this._sendRpc(o,p)}_processRpcMessage(o){const l=Object.create(null,{_processRpcMessage:{get:()=>super._processRpcMessage}});return i(this,void 0,void 0,function*(){const u=this.getMsgId(o),h=Le.messageIdToString(u);if(this.seenCache.has(h)){this.score.duplicateMessage(o);return}this.seenCache.put(h),this.score.validateMessage(o),yield l._processRpcMessage.call(this,o)})}_acceptFrom(o){return this.direct.has(o)||this.score.score(o)>=this._options.scoreThresholds.graylistThreshold}validate(o){const l=Object.create(null,{validate:{get:()=>super.validate}});return i(this,void 0,void 0,function*(){try{yield l.validate.call(this,o)}catch(u){throw this.score.rejectMessage(o,u.code),this.gossipTracer.rejectMessage(o,u.code),u}})}_handleIHave(o,l){if(!l.length)return[];const u=this.score.score(o);if(u<this._options.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",o,u),[];const h=(this.peerhave.get(o)||0)+1;if(this.peerhave.set(o,h),h>a.GossipsubMaxIHaveMessages)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",o,h),[];const S=this.iasked.get(o)||0;if(S>=a.GossipsubMaxIHaveLength)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",o,S),[];const p=new Map;if(l.forEach(({topicID:E,messageIDs:I})=>{if(!E||!this.mesh.has(E))return;I.forEach(x=>{const q=Le.messageIdToString(x);if(this.seenCache.has(q))return;p.set(q,x)})}),!p.size)return[];let C=p.size;C+S>a.GossipsubMaxIHaveLength&&(C=a.GossipsubMaxIHaveLength-S),this.log("IHAVE: Asking for %d out of %d messages from %s",C,p.size,o);let T=Array.from(p.values());return Le.shuffle(T),T=T.slice(0,C),this.iasked.set(o,S+C),this.gossipTracer.addPromise(o,T),[{messageIDs:T}]}_handleIWant(o,l){if(!l.length)return[];const u=this.score.score(o);if(u<this._options.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",o,u),[];const h=new Map;return l.forEach(({messageIDs:S})=>{S.forEach(p=>{const[C,T]=this.messageCache.getForPeer(p,o);if(!C)return;if(T>a.GossipsubGossipRetransmission){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",o,p);return}h.set(Le.messageIdToString(p),C)})}),h.size?(this.log("IWANT: Sending %d messages to %s",h.size,o),Array.from(h.values()).map(s.utils.normalizeOutRpcMessage)):[]}_handleGraft(o,l){const u=[],h=this.score.score(o),S=this._now();let p=this._options.doPX;return l.forEach(({topicID:C})=>{var T;if(!C)return;const E=this.mesh.get(C);if(!E){p=!1;return}if(E.has(o))return;if(this.direct.has(o)){this.log("GRAFT: ignoring request from direct peer %s",o),u.push(C),p=!1;return}const I=(T=this.backoff.get(C))===null||T===void 0?void 0:T.get(o);if(typeof I=="number"&&S<I){this.log("GRAFT: ignoring backed off peer %s",o),this.score.addPenalty(o,1),p=!1;const x=I+a.GossipsubGraftFloodThreshold-a.GossipsubPruneBackoff;S<x&&this.score.addPenalty(o,1),this._addBackoff(o,C),u.push(C);return}if(h<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",o,h,C),u.push(C),p=!1,this._addBackoff(o,C);return}if(E.size>=this._options.Dhi&&!this.outbound.get(o)){u.push(C),this._addBackoff(o,C);return}this.log("GRAFT: Add mesh link from %s in %s",o,C),this.score.graft(o,C),E.add(o)}),u.length?u.map(C=>this._makePrune(o,C,p)):[]}_handlePrune(o,l){const u=this.score.score(o);l.forEach(({topicID:h,backoff:S,peers:p})=>{if(!h)return;const C=this.mesh.get(h);if(!C)return;if(this.log("PRUNE: Remove mesh link to %s in %s",o,h),this.score.prune(o,h),C.delete(o),typeof S=="number"&&S>0?this._doAddBackoff(o,h,S*1e3):this._addBackoff(o,h),p&&p.length){if(u<this._options.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",o,u,h);return}this._pxConnect(p)}})}_addBackoff(o,l){this._doAddBackoff(o,l,a.GossipsubPruneBackoff)}_doAddBackoff(o,l,u){let h=this.backoff.get(l);h||(h=new Map,this.backoff.set(l,h));const S=this._now()+u,p=h.get(o)||0;p<S&&h.set(o,S)}_applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((o,l)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",l,o),this.score.addPenalty(l,o)})}_clearBackoff(){if(this.heartbeatTicks%a.GossipsubPruneBackoffTicks!==0)return;const o=this._now();this.backoff.forEach((l,u)=>{l.forEach((h,S)=>{h<o&&l.delete(S)}),l.size===0&&this.backoff.delete(u)})}_directConnect(){if(this.heartbeatTicks%a.GossipsubDirectConnectTicks!==0)return;const o=[];this.direct.forEach(l=>{const u=this.peers.get(l);(!u||!u.isWritable)&&o.push(l)}),o.length&&o.forEach(l=>{this._connect(l)})}_pxConnect(o){return i(this,void 0,void 0,function*(){o.length>a.GossipsubPrunePeers&&(Le.shuffle(o),o=o.slice(0,a.GossipsubPrunePeers));const l=[];if(yield Promise.all(o.map(u=>i(this,void 0,void 0,function*(){if(!u.peerID)return;const h=me.createFromBytes(u.peerID),S=h.toB58String();if(this.peers.has(S))return;if(!u.signedPeerRecord){l.push(S);return}try{const p=yield ca.openAndCertify(u.signedPeerRecord,"libp2p-peer-record"),C=p.peerId.toB58String();if(S!==C){this.log("bogus peer record obtained through px: peer ID %s doesn't match expected peer %s",C,S);return}if(!this._libp2p.peerStore.addressBook.consumePeerRecord(p)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}l.push(S)}catch(p){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}))),!l.length)return;l.forEach(u=>this._connect(u))})}start(){super.start(),this.heartbeat.start(),this.score.start(),this._directPeerInitial=setTimeout(()=>{this.direct.forEach(o=>{this._connect(o)})},a.GossipsubDirectConnectInitialDelay)}stop(){super.stop(),this.heartbeat.stop(),this.score.stop(),this.mesh=new Map,this.fanout=new Map,this.lastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.gossipTracer.clear(),clearTimeout(this._directPeerInitial)}_connect(o){this.log("Initiating connection with %s",o),this._libp2p.dialProtocol(me.createFromB58String(o),this.multicodecs)}subscribe(o){super.subscribe(o),this.join(o)}unsubscribe(o){super.unsubscribe(o),this.leave(o)}join(o){if(!this.started)throw new Error("Gossipsub has not started");this.log("JOIN %s",o);const l=this.fanout.get(o);if(l)l.forEach(u=>{this.score.score(u)<0&&l.delete(u)}),l.size<this._options.D&&Vn.getGossipPeers(this,o,this._options.D-l.size,u=>!l.has(u)&&!this.direct.has(u)&&this.score.score(u)>=0).forEach(u=>l.add(u)),this.mesh.set(o,l),this.fanout.delete(o),this.lastpub.delete(o);else{const u=Vn.getGossipPeers(this,o,this._options.D,h=>!this.direct.has(h)&&this.score.score(h)>=0);this.mesh.set(o,u)}this.mesh.get(o).forEach(u=>{this.log("JOIN: Add mesh link to %s in %s",u,o),this._sendGraft(u,o)})}leave(o){if(!this.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",o);const l=this.mesh.get(o);l&&(l.forEach(u=>{this.log("LEAVE: Remove mesh link to %s in %s",u,o),this._sendPrune(u,o)}),this.mesh.delete(o))}_publish(o){return i(this,void 0,void 0,function*(){o.receivedFrom!==this.peerId.toB58String()&&(this.score.deliverMessage(o),this.gossipTracer.deliverMessage(o));const l=this.getMsgId(o),u=Le.messageIdToString(l);this.seenCache.put(u),this.messageCache.put(o);const h=new Set;o.topicIDs.forEach(p=>{const C=this.topics.get(p);if(!C)return;if(this._options.floodPublish&&o.from===this.peerId.toB58String())C.forEach(T=>{(this.direct.has(T)||this.score.score(T)>=this._options.scoreThresholds.publishThreshold)&&h.add(T)});else{this.direct.forEach(E=>{h.add(E)}),C.forEach(E=>{const I=this.score.score(E),x=this.peers.get(E);if(!x)return;x.protocol===a.FloodsubID&&I>=this._options.scoreThresholds.publishThreshold&&h.add(E)});let T=this.mesh.get(p);if(!T||!T.size){if(T=this.fanout.get(p),!T){const E=Vn.getGossipPeers(this,p,this._options.D,I=>this.score.score(I)>=this._options.scoreThresholds.publishThreshold);E.size>0?(T=E,this.fanout.set(p,E)):T=new Set}this.lastpub.set(p,this._now())}T.forEach(E=>{h.add(E)})}});const S=Le.createGossipRpc([s.utils.normalizeOutRpcMessage(o)]);h.forEach(p=>{if(p===o.from)return;this._sendRpc(p,S)})})}_sendGraft(o,l){const u=[{topicID:l}],h=Le.createGossipRpc([],{graft:u});this._sendRpc(o,h)}_sendPrune(o,l){const u=[this._makePrune(o,l,this._options.doPX)],h=Le.createGossipRpc([],{prune:u});this._sendRpc(o,h)}_sendRpc(o,l){const u=this.peers.get(o);if(!u||!u.isWritable)return;const h=this.control.get(o);h&&(this._piggybackControl(o,l,h),this.control.delete(o));const S=this.gossip.get(o);S&&(this._piggybackGossip(o,l,S),this.gossip.delete(o)),u.write(td.RPCCodec.encode(l))}_piggybackControl(o,l,u){const h=(u.graft||[]).filter(({topicID:p})=>(p&&this.mesh.get(p)||new Set).has(o)),S=(u.prune||[]).filter(({topicID:p})=>!(p&&this.mesh.get(p)||new Set).has(o));if(!h.length&&!S.length)return;l.control?(l.control.graft=l.control.graft.concat(h),l.control.prune=l.control.prune.concat(S)):l.control={ihave:[],iwant:[],graft:h,prune:S}}_piggybackGossip(o,l,u){l.control||(l.control={ihave:[],iwant:[],graft:[],prune:[]}),l.control.ihave=u}_sendGraftPrune(o,l,u){const h=this._options.doPX;for(const[S,p]of o){const C=p.map(x=>({topicID:x}));let T=[];const E=l.get(S);E&&(T=E.map(x=>this._makePrune(S,x,h&&!u.get(S))),l.delete(S));const I=Le.createGossipRpc([],{graft:C,prune:T});this._sendRpc(S,I)}for(const[S,p]of l){const C=p.map(E=>this._makePrune(S,E,h&&!u.get(S))),T=Le.createGossipRpc([],{prune:C});this._sendRpc(S,T)}}_emitGossip(o,l){const u=this.messageCache.getGossipIDs(o);if(!u.length)return;Le.shuffle(u),u.length>a.GossipsubMaxIHaveLength&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",u.length);const h=[],S=this.topics.get(o);if(!S)return;S.forEach(T=>{const E=this.peers.get(T);if(!E)return;!l.has(T)&&!this.direct.has(T)&&Le.hasGossipProtocol(E.protocol)&&this.score.score(T)>=this._options.scoreThresholds.gossipThreshold&&h.push(T)});let p=this._options.Dlazy;const C=a.GossipsubGossipFactor*h.length;C>p&&(p=C),p>h.length?p=h.length:Le.shuffle(h),h.slice(0,p).forEach(T=>{let E=u;u.length>a.GossipsubMaxIHaveLength&&(E=Le.shuffle(E.slice()).slice(0,a.GossipsubMaxIHaveLength)),this._pushGossip(T,{topicID:o,messageIDs:E})})}_flush(){for(const[o,l]of this.gossip.entries()){this.gossip.delete(o);const u=Le.createGossipRpc([],{ihave:l});this._sendRpc(o,u)}for(const[o,l]of this.control.entries()){this.control.delete(o);const u=Le.createGossipRpc([],{graft:l.graft,prune:l.prune});this._sendRpc(o,u)}}_pushGossip(o,l){this.log("Add gossip to %s",o);const u=this.gossip.get(o)||[];this.gossip.set(o,u.concat(l))}_now(){return Date.now()}_makePrune(o,l,u){if(this.peers.get(o).protocol===a.GossipsubIDv10)return{topicID:l,peers:[]};const h=a.GossipsubPruneBackoff/1e3,S=[];if(u){const p=Vn.getGossipPeers(this,l,a.GossipsubPrunePeers,C=>C!==o&&this.score.score(C)>=0);p.forEach(C=>{const T=me.createFromB58String(C);S.push({peerID:T.toBytes(),signedPeerRecord:this._libp2p.peerStore.addressBook.getRawEnvelope(T)})})}return{topicID:l,peers:S,backoff:h}}}c.multicodec=a.GossipsubIDv11,t.exports=c}),nN=Xg(rN),iN=window.MediaStream,sN=window.MediaStreamTrack,aN=window.RTCDataChannel,oN=window.RTCDataChannelEvent,cN=window.RTCDtlsTransport,lN=window.RTCIceCandidate,uN=window.RTCIceTransport,dN=window.RTCPeerConnection,pN=window.RTCPeerConnectionIceEvent,hN=window.RTCRtpReceiver,fN=window.RTCRtpSender,mN=window.RTCRtpTransceiver,gN=window.RTCSctpTransport,yN=window.RTCSessionDescription,bN=window.getUserMedia,vN=navigator.mediaDevices,wN={MediaStream:iN,MediaStreamTrack:sN,RTCDataChannel:aN,RTCDataChannelEvent:oN,RTCDtlsTransport:cN,RTCIceCandidate:lN,RTCIceTransport:uN,RTCPeerConnection:dN,RTCPeerConnectionIceEvent:pN,RTCRtpReceiver:hN,RTCRtpSender:fN,RTCRtpTransceiver:mN,RTCSctpTransport:gN,RTCSessionDescription:yN,getUserMedia:bN,mediaDevices:vN};function Mg(){return{addresses:{listen:["/dns4/boiling-hamlet-91904.herokuapp.com/tcp/443/wss/p2p-webrtc-star"]},modules:{transport:[dk,Kf,ig],streamMuxer:[kk],connEncryption:[iP],dht:ty,pubsub:nN},config:{transport:{[ig.prototype[Symbol.toStringTag]]:{wrtc:wN},[Kf.prototype[Symbol.toStringTag]]:{filter:au.all}},dht:ry,exposeRawConn:!0}}}async function SN(t){const e=await m_.create(t||Mg());return await e.start(),e}export default SN;export{Mg as defaultNodeConfig};
