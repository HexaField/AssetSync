import{E as m}from"./events-18451fd5.js";import{n as d}from"./process-e9e98960.js";import{B as u}from"./buffer-es6-e6024076.js";import{e as K,i as j,f as Q}from"./util-8448a06b.js";function p(){this.head=null,this.tail=null,this.length=0}p.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},p.prototype.unshift=function(e){var t={data:e,next:this.head};this.length===0&&(this.tail=t),this.head=t,++this.length},p.prototype.shift=function(){if(this.length===0)return;var e=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,e},p.prototype.clear=function(){this.head=this.tail=null,this.length=0},p.prototype.join=function(e){if(this.length===0)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},p.prototype.concat=function(e){if(this.length===0)return u.alloc(0);if(this.length===1)return this.head.data;for(var t=u.allocUnsafe(e>>>0),r=this.head,i=0;r;)r.data.copy(t,i),i+=r.data.length,r=r.next;return t};var Z=u.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function $(e){if(e&&!Z(e))throw new Error("Unknown encoding: "+e)}function y(e){this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),$(e);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=te;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=re;break;default:this.write=ee;return}this.charBuffer=new u(6),this.charReceived=0,this.charLength=0}y.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";e=e.slice(r,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var n=t.charCodeAt(t.length-1);if(n>=55296&&n<=56319){this.charLength+=this.surrogateSize,t="";continue}if(this.charReceived=this.charLength=0,e.length===0)return t;break}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),t+=e.toString(this.encoding,0,i);var i=t.length-1,n=t.charCodeAt(i);if(n>=55296&&n<=56319){var a=this.surrogateSize;return this.charLength+=a,this.charReceived+=a,this.charBuffer.copy(this.charBuffer,a,0,a),e.copy(this.charBuffer,0,0,a),t.substring(0,i)}return t},y.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(t==1&&r>>5==6){this.charLength=2;break}if(t<=2&&r>>4==14){this.charLength=3;break}if(t<=3&&r>>3==30){this.charLength=4;break}}this.charReceived=t},y.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,i=this.charBuffer,n=this.encoding;t+=i.slice(0,r).toString(n)}return t};function ee(e){return e.toString(this.encoding)}function te(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function re(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}h.ReadableState=q;var s=K("stream");j(h,m);function ie(e,t,r){if(typeof e.prependListener=="function")return e.prependListener(t,r);!e._events||!e._events[t]?e.on(t,r):Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]}function ne(e,t){return e.listeners(t).length}function q(e,t){e=e||{},this.objectMode=!!e.objectMode,t instanceof c&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16*1024;this.highWaterMark=r||r===0?r:i,this.highWaterMark=~~this.highWaterMark,this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new y(e.encoding),this.encoding=e.encoding)}function h(e){if(!(this instanceof h))return new h(e);this._readableState=new q(e,this),this.readable=!0,e&&typeof e.read=="function"&&(this._read=e.read),m.call(this)}h.prototype.push=function(e,t){var r=this._readableState;return!r.objectMode&&typeof e=="string"&&(t=t||r.defaultEncoding,t!==r.encoding&&(e=u.from(e,t),t="")),I(this,r,e,t,!1)},h.prototype.unshift=function(e){var t=this._readableState;return I(this,t,e,"",!0)},h.prototype.isPaused=function(){return this._readableState.flowing===!1};function I(e,t,r,i,n){var a=se(t,r);if(a)e.emit("error",a);else if(r===null)t.reading=!1,he(e,t);else if(t.objectMode||r&&r.length>0)if(t.ended&&!n){var o=new Error("stream.push() after EOF");e.emit("error",o)}else if(t.endEmitted&&n){var f=new Error("stream.unshift() after end event");e.emit("error",f)}else{var g;t.decoder&&!n&&!i&&(r=t.decoder.write(r),g=!t.objectMode&&r.length===0),n||(t.reading=!1),g||(t.flowing&&t.length===0&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&k(e))),le(e,t)}else n||(t.reading=!1);return ae(t)}function ae(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||e.length===0)}h.prototype.setEncoding=function(e){return this._readableState.decoder=new y(e),this._readableState.encoding=e,this};var O=8388608;function oe(e){return e>=O?e=O:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function F(e,t){return e<=0||t.length===0&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=oe(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}h.prototype.read=function(e){s("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(e!==0&&(t.emittedReadable=!1),e===0&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return s("read: emitReadable",t.length,t.ended),t.length===0&&t.ended?x(this):k(this),null;if(e=F(e,t),e===0&&t.ended)return t.length===0&&x(this),null;var i=t.needReadable;s("need readable",i),(t.length===0||t.length-e<t.highWaterMark)&&(i=!0,s("length less than watermark",i)),t.ended||t.reading?(i=!1,s("reading or ended",i)):i&&(s("do read"),t.reading=!0,t.sync=!0,t.length===0&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=F(r,t)));var n;return e>0?n=A(e,t):n=null,n===null?(t.needReadable=!0,e=0):t.length-=e,t.length===0&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&x(this)),n!==null&&this.emit("data",n),n};function se(e,t){var r=null;return!u.isBuffer(t)&&typeof t!="string"&&t!==null&&t!==void 0&&!e.objectMode&&(r=new TypeError("Invalid non-string/buffer chunk")),r}function he(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,k(e)}function k(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(s("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?d(U,e):U(e))}function U(e){s("emit readable"),e.emit("readable"),C(e)}function le(e,t){t.readingMore||(t.readingMore=!0,d(fe,e,t))}function fe(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&!(s("maybeReadMore read 0"),e.read(0),r===t.length);)r=t.length;t.readingMore=!1}h.prototype._read=function(e){this.emit("error",new Error("not implemented"))},h.prototype.pipe=function(e,t){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e);break}i.pipesCount+=1,s("pipe count=%d opts=%j",i.pipesCount,t);var n=!t||t.end!==!1,a=n?f:b;i.endEmitted?d(a):r.once("end",a),e.on("unpipe",o);function o(w){s("onunpipe"),w===r&&b()}function f(){s("onend"),e.end()}var g=de(r);e.on("drain",g);var v=!1;function b(){s("cleanup"),e.removeListener("close",_),e.removeListener("finish",M),e.removeListener("drain",g),e.removeListener("error",S),e.removeListener("unpipe",o),r.removeListener("end",f),r.removeListener("end",b),r.removeListener("data",T),v=!0,i.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&g()}var R=!1;r.on("data",T);function T(w){s("ondata"),R=!1;var Y=e.write(w);Y===!1&&!R&&((i.pipesCount===1&&i.pipes===e||i.pipesCount>1&&H(i.pipes,e)!==-1)&&!v&&(s("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,R=!0),r.pause())}function S(w){s("onerror",w),E(),e.removeListener("error",S),ne(e,"error")===0&&e.emit("error",w)}ie(e,"error",S);function _(){e.removeListener("finish",M),E()}e.once("close",_);function M(){s("onfinish"),e.removeListener("close",_),E()}e.once("finish",M);function E(){s("unpipe"),r.unpipe(e)}return e.emit("pipe",r),i.flowing||(s("pipe resume"),r.resume()),e};function de(e){return function(){var t=e._readableState;s("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,t.awaitDrain===0&&e.listeners("data").length&&(t.flowing=!0,C(e))}}h.prototype.unpipe=function(e){var t=this._readableState;if(t.pipesCount===0)return this;if(t.pipesCount===1)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var n=0;n<i;n++)r[n].emit("unpipe",this);return this}var a=H(t.pipes,e);return a===-1?this:(t.pipes.splice(a,1),t.pipesCount-=1,t.pipesCount===1&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},h.prototype.on=function(e,t){var r=m.prototype.on.call(this,e,t);if(e==="data")this._readableState.flowing!==!1&&this.resume();else if(e==="readable"){var i=this._readableState;!i.endEmitted&&!i.readableListening&&(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&k(this):d(ue,this))}return r},h.prototype.addListener=h.prototype.on;function ue(e){s("readable nexttick read 0"),e.read(0)}h.prototype.resume=function(){var e=this._readableState;return e.flowing||(s("resume"),e.flowing=!0,ce(this,e)),this};function ce(e,t){t.resumeScheduled||(t.resumeScheduled=!0,d(ge,e,t))}function ge(e,t){t.reading||(s("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),C(e),t.flowing&&!t.reading&&e.read(0)}h.prototype.pause=function(){return s("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(s("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function C(e){var t=e._readableState;for(s("flow",t.flowing);t.flowing&&e.read()!==null;);}h.prototype.wrap=function(e){var t=this._readableState,r=!1,i=this;e.on("end",function(){if(s("wrapped end"),t.decoder&&!t.ended){var o=t.decoder.end();o&&o.length&&i.push(o)}i.push(null)}),e.on("data",function(o){if(s("wrapped data"),t.decoder&&(o=t.decoder.write(o)),t.objectMode&&o==null)return;if(!t.objectMode&&(!o||!o.length))return;var f=i.push(o);f||(r=!0,e.pause())});for(var n in e)this[n]===void 0&&typeof e[n]=="function"&&(this[n]=function(o){return function(){return e[o].apply(e,arguments)}}(n));var a=["error","close","destroy","pause","resume"];return ye(a,function(o){e.on(o,i.emit.bind(i,o))}),i._read=function(o){s("wrapped _read",o),r&&(r=!1,e.resume())},i},h._fromList=A;function A(e,t){if(t.length===0)return null;var r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(t.decoder?r=t.buffer.join(""):t.buffer.length===1?r=t.buffer.head.data:r=t.buffer.concat(t.length),t.buffer.clear()):r=pe(e,t.buffer,t.decoder),r}function pe(e,t,r){var i;return e<t.head.data.length?(i=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):e===t.head.data.length?i=t.shift():i=r?we(e,t):be(e,t),i}function we(e,t){var r=t.head,i=1,n=r.data;for(e-=n.length;r=r.next;){var a=r.data,o=e>a.length?a.length:e;if(o===a.length?n+=a:n+=a.slice(0,e),e-=o,e===0){o===a.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=a.slice(o));break}++i}return t.length-=i,n}function be(e,t){var r=u.allocUnsafe(e),i=t.head,n=1;for(i.data.copy(r),e-=i.data.length;i=i.next;){var a=i.data,o=e>a.length?a.length:e;if(a.copy(r,r.length-e,0,o),e-=o,e===0){o===a.length?(++n,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=a.slice(o));break}++n}return t.length-=n,r}function x(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,d(me,t,e))}function me(e,t){!e.endEmitted&&e.length===0&&(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function ye(e,t){for(var r=0,i=e.length;r<i;r++)t(e[r],r)}function H(e,t){for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1}l.WritableState=D,j(l,m);function ve(){}function ke(e,t,r){this.chunk=e,this.encoding=t,this.callback=r,this.next=null}function D(e,t){Object.defineProperty(this,"buffer",{get:Q(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),e=e||{},this.objectMode=!!e.objectMode,t instanceof c&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16*1024;this.highWaterMark=r||r===0?r:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var n=e.decodeStrings===!1;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(a){Ce(t,a)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new G(this)}D.prototype.getBuffer=function(){for(var t=this.bufferedRequest,r=[];t;)r.push(t),t=t.next;return r};function l(e){if(!(this instanceof l)&&!(this instanceof c))return new l(e);this._writableState=new D(e,this),this.writable=!0,e&&(typeof e.write=="function"&&(this._write=e.write),typeof e.writev=="function"&&(this._writev=e.writev)),m.call(this)}l.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function Re(e,t){var r=new Error("write after end");e.emit("error",r),d(t,r)}function Se(e,t,r,i){var n=!0,a=!1;return r===null?a=new TypeError("May not write null values to stream"):!u.isBuffer(r)&&typeof r!="string"&&r!==void 0&&!t.objectMode&&(a=new TypeError("Invalid non-string/buffer chunk")),a&&(e.emit("error",a),d(i,a),n=!1),n}l.prototype.write=function(e,t,r){var i=this._writableState,n=!1;return typeof t=="function"&&(r=t,t=null),u.isBuffer(e)?t="buffer":t||(t=i.defaultEncoding),typeof r!="function"&&(r=ve),i.ended?Re(this,r):Se(this,i,e,r)&&(i.pendingcb++,n=Me(this,i,e,t,r)),n},l.prototype.cork=function(){var e=this._writableState;e.corked++},l.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,!e.writing&&!e.corked&&!e.finished&&!e.bufferProcessing&&e.bufferedRequest&&P(this,e))},l.prototype.setDefaultEncoding=function(t){if(typeof t=="string"&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this};function _e(e,t,r){return!e.objectMode&&e.decodeStrings!==!1&&typeof t=="string"&&(t=u.from(t,r)),t}function Me(e,t,r,i,n){r=_e(t,r,i),u.isBuffer(r)&&(i="buffer");var a=t.objectMode?1:r.length;t.length+=a;var o=t.length<t.highWaterMark;if(o||(t.needDrain=!0),t.writing||t.corked){var f=t.lastBufferedRequest;t.lastBufferedRequest=new ke(r,i,n),f?f.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else L(e,t,!1,a,r,i,n);return o}function L(e,t,r,i,n,a,o){t.writelen=i,t.writecb=o,t.writing=!0,t.sync=!0,r?e._writev(n,t.onwrite):e._write(n,a,t.onwrite),t.sync=!1}function Ee(e,t,r,i,n){--t.pendingcb,r?d(n,i):n(i),e._writableState.errorEmitted=!0,e.emit("error",i)}function je(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function Ce(e,t){var r=e._writableState,i=r.sync,n=r.writecb;if(je(r),t)Ee(e,r,i,t,n);else{var a=X(r);!a&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&P(e,r),i?d(N,e,r,a,n):N(e,r,a,n)}}function N(e,t,r,i){r||xe(e,t),t.pendingcb--,i(),J(e,t)}function xe(e,t){t.length===0&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function P(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var i=t.bufferedRequestCount,n=new Array(i),a=t.corkedRequestsFree;a.entry=r;for(var o=0;r;)n[o]=r,r=r.next,o+=1;L(e,t,!0,t.length,n,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new G(t)}else{for(;r;){var f=r.chunk,g=r.encoding,v=r.callback,b=t.objectMode?1:f.length;if(L(e,t,!1,b,f,g,v),r=r.next,t.writing)break}r===null&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=r,t.bufferProcessing=!1}l.prototype._write=function(e,t,r){r(new Error("not implemented"))},l.prototype._writev=null,l.prototype.end=function(e,t,r){var i=this._writableState;typeof e=="function"?(r=e,e=null,t=null):typeof t=="function"&&(r=t,t=null),e!=null&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),!i.ending&&!i.finished&&De(this,i,r)};function X(e){return e.ending&&e.length===0&&e.bufferedRequest===null&&!e.finished&&!e.writing}function z(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function J(e,t){var r=X(t);return r&&(t.pendingcb===0?(z(e,t),t.finished=!0,e.emit("finish")):z(e,t)),r}function De(e,t,r){t.ending=!0,J(e,t),r&&(t.finished?d(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function G(e){var t=this;this.next=null,this.entry=null,this.finish=function(r){var i=t.entry;for(t.entry=null;i;){var n=i.callback;e.pendingcb--,n(r),i=i.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}j(c,h);for(var V=Object.keys(l.prototype),B=0;B<V.length;B++){var W=V[B];c.prototype[W]||(c.prototype[W]=l.prototype[W])}function c(e){if(!(this instanceof c))return new c(e);h.call(this,e),l.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",Le)}function Le(){if(this.allowHalfOpen||this._writableState.ended)return;d(Be,this)}function Be(e){e.end()}export{c as D,h as R,l as W};
