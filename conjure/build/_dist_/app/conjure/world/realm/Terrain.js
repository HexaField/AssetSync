import{THREE as c,ExtendedObject3D as b}from"../../../../../web_modules/enable3d.js";import{ImprovedNoise as g}from"../../../../../web_modules/three/examples/jsm/math/ImprovedNoise.js";import{POSTPROCESSING as j}from"../../PostProcessing.js";import{createGeometry as O,createMaterial as f}from"../../util/wireframe/index.js";export default class v{constructor(s,l,p){let m=Date.now();this.conjure=s,this.terrainObject=new b,this.parentGroup=l,this.vec3=new c.Vector3,this.grid_size=32,this.grid_scale=2;var o=f({thickness:.01},!0),r=new c.BufferGeometry,i=[],a=[];let t=0;var e=this.grid_size,n=this.grid_size,u=this.generateHeight(this.grid_size,this.grid_size,.25);for(let h=0;h<e;h++)for(let d=0;d<n;d++)i.push(h*this.grid_scale,0,d*this.grid_scale),h<e-1&&d<n-1&&(a.push(t,t+e+1,t+e),a.push(t+e+1,t,t+1)),t++;r.setAttribute("position",new c.BufferAttribute(new Float32Array(i),3)),r.setIndex(a),r=r.toNonIndexed(),r.computeVertexNormals(),O(r,!0,!0),this.mesh=new c.Mesh(r,o),this.terrainObject.add(this.mesh),this.mesh.layers.enable(j.BLOOM_SCENE),this.terrainObject.name="platform",this.terrainObject.receiveShadow=!0,this.terrainObject.position.set(-this.grid_scale*this.grid_size*.5,-2,-this.grid_scale*this.grid_size*.5),this.parentGroup.add(this.terrainObject),this.conjure.physics.add.existing(this.terrainObject,{shape:"concaveMesh",mass:0}),this.terrainObject.body.setAngularFactor(0,0,0),this.terrainObject.body.setLinearFactor(0,0,0)}generateHeight(s,l,p){var m=s*l;let o=new Uint8Array(m),r=new g,i=1,a=0;for(var t=0;t<4;t++){for(var e=0;e<m;e++){var n=e%s,u=~~(e/s);o[e]+=Math.abs(r.noise(n/i,u/i,a)*i*1.75*p)}i*=3}return o}destroy(){this.terrainObject.body&&this.conjure.physics.destroy(this.terrainObject.body),this.parentGroup.remove(this.terrainObject)}}
