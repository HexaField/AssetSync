import{CanvasTexture as m}from"../../../../../web_modules/three/src/textures/CanvasTexture.js";export default class d extends m{constructor(e,h,t,a,i,s,r,o,n){super(e,h,t,a,i,s,r,o,n);this.needsUpdate=!1}setReader(e){this.reader=e,this.image=document.createElement("canvas"),this.image.width=e.width,this.image.height=e.height,this.context=this.image.getContext("2d"),this.frameNumber=0,this.previousFrameInfo=null,this.draw()}draw(){if(!this.reader)return;const{reader:e,image:h,context:t}=this,{width:a,height:i}=h,s=++this.frameNumber%e.numFrames(),r=e.frameInfo(s);s===0?t.clearRect(0,0,a,i):this.previousFrameInfo&&this.previousFrameInfo.disposal===2&&t.clearRect(this.previousFrameInfo.x,this.previousFrameInfo.y,this.previousFrameInfo.width,this.previousFrameInfo.height);const o=t.getImageData(0,0,a,i);e.decodeAndBlitFrameRGBA(s,o.data),t.putImageData(o,0,0),this.needsUpdate=!0,this.previousFrameInfo=r,setTimeout(this.draw.bind(this),r.delay*10)}}
