import{b as K,e as i}from"./index-b1567acb.js";import{t as A,i as _,a as d}from"./index-71e9481e.js";(function(){if(typeof globalThis=="object")return;Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__})();var l=globalThis,k=l.TextEncoder,f=l.TextDecoder,C=new k("utf8"),E=new f("utf8"),S=(e,t)=>async function*(){for await(const r of e){const n=await t(r);if(!n)continue;yield r}}(),R=(e,t)=>async function*(){let r=[];for await(const n of e)r.push(n);r=await t(r);for(const n of r)yield n}(),x=(e,t)=>async function*(){if(t<=0)return;let r=0;for await(const n of e)if(yield n,r++,r>=t)return}(),M=(e,t)=>async function*(){for await(const r of e)yield t(r)}(),O=function(e,t){const r=new RegExp("^"+t);return e.replace(r,"")},P=A,u={utf8Encoder:C,utf8Decoder:E,filter:S,sortAll:R,take:x,map:M,replaceStartWith:O,tmpdir:P};const{nanoid:j}=_,{utf8Encoder:m,utf8Decoder:D}=u,a="/",b=m.encode(a),y=b[0];class c{constructor(e,t){if(typeof e=="string")this._buf=m.encode(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==y)throw new Error("Invalid key")}toString(e="utf8"){return e==="utf8"||e==="utf-8"?D.decode(this._buf):new f(e).decode(this._buf)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new s(e.join(a))}static random(){return new s(j().replace(/-/g,""))}clean(){if((!this._buf||this._buf.byteLength===0)&&(this._buf=b),this._buf[0]!==y){const e=new Uint8Array(this._buf.byteLength+1);e.fill(y,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===y;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let n=0;n<t.length;n++){if(r.length<n+1)return!1;const o=t[n],p=r[n];if(o<p)return!0;if(o>p)return!1}return t.length<r.length}reverse(){return c.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(a).slice(1)}type(){return F(this.baseNamespace())}name(){return I(this.baseNamespace())}instance(e){return new s(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(a)||(e+=a),e+=this.type(),new s(e)}parent(){const e=this.list();return e.length===1?new s(a):new s(e.slice(0,-1).join(a))}child(e){return this.toString()===a?e:e.toString()===a?this:new s(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return c.withNamespaces([...this.namespaces(),...J(e.map(t=>t.namespaces()))])}}function F(e){const t=e.split(":");return t.length<2?"":t.slice(0,-1).join(":")}function I(e){const t=e.split(":");return t[t.length-1]}function J(e){return[].concat(...e)}const s=K(c,{className:"Key",symbolName:"@ipfs/interface-datastore/key"});var g=s;const{filter:h,sortAll:T,take:N,map:U}=u;class L{async open(){}async close(){}async put(e,t,r={}){}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield{key:r,value:n}}async get(e,t={}){}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}async has(e){}async delete(e,t={}){}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(r,n){e.push({key:r,value:n})},delete(r){t.push(r)},commit:async r=>{await d(this.putMany(e,r)),e=[],await d(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){}async*query(e,t){let r=this._all(e,t);if(e.prefix!=null&&(r=h(r,n=>n.key.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(r=e.filters.reduce((n,o)=>h(n,o),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((n,o)=>T(n,o),r)),e.offset!=null){let n=0;r=h(r,()=>n++>=e.offset)}e.limit!=null&&(r=N(r,e.limit)),e.keysOnly===!0&&(r=U(r,n=>({key:n.key}))),yield*r}}var w=L,W=e=>(e=e||new Error("Cannot open database"),i(e,"ERR_DB_OPEN_FAILED")),$=e=>(e=e||new Error("Delete failed"),i(e,"ERR_DB_DELETE_FAILED")),q=e=>(e=e||new Error("Write failed"),i(e,"ERR_DB_WRITE_FAILED")),B=e=>(e=e||new Error("Not Found"),i(e,"ERR_NOT_FOUND")),z=e=>(e=e||new Error("Aborted"),i(e,"ERR_ABORTED")),v={dbOpenFailedError:W,dbDeleteFailedError:$,dbWriteFailedError:q,notFoundError:B,abortedError:z};class G extends w{constructor(){super();this.data={}}async put(e,t){this.data[e.toString()]=t}async get(e){const t=await this.has(e);if(!t)throw v.notFoundError();return this.data[e.toString()]}async has(e){return this.data[e.toString()]!==void 0}async delete(e){delete this.data[e.toString()]}*_all(){yield*Object.entries(this.data).map(([e,t])=>({key:new g(e),value:t}))}}var Q=G,V=g,Y=Q,H=u,X=v,Z=w,ee={Key:V,MemoryDatastore:Y,utils:H,Errors:X,Adapter:Z};export{l as g,ee as s};
