import{e as St}from"./events-18451fd5.js";import{e as U,t as se,f as je,c as we,v as J,s as Nr,a as Or,b as Ht,d as tr,g as be,m as Ua,h as Q,i as Mr,j as gt,k as B,l as Lu,n as Eg,o as Bu,p as Xs,r as Sg,q as Tg}from"./index-b1567acb.js";import{p as fe}from"./process-e9e98960.js";import"./EventDispatcher-b8df954c.js";import{b as Qs}from"./buffer-es6-e6024076.js";import{c as te,a as ae,g as Ag,d as Cg,b as Ig}from"./_commonjsHelpers-c99fd594.js";import{d as ji}from"./__node-resolve:empty-d7309c3b.js";import"./util-8448a06b.js";import{a as Ys}from"./url-e7878f21.js";import{n as rc}from"./empty-add391ca.js";import{p as Rg}from"./path-d977e441.js";import"./index-71e9481e.js";import{g as ri,s as nc}from"./index-11133e6d.js";import{b as kg,g as Uu}from"./browser-343ae908.js";import{s as Pg,b as Fu}from"./browser-f3be077b.js";import{r as Ng}from"./_node-fetch_commonjs-proxy-271b4446.js";import{a as $u,b as Tt,s as At,B as ut,c as Je,d as Js,e as rr,h as Og,r as ic,p as Mg,f as Dg,g as xg}from"./index-703d06aa.js";class qu extends Error{constructor(t){super(t||"Promise was canceled");this.name="CancelError"}get isCanceled(){return!0}}class sc{static fn(t){return(...e)=>new sc((r,n,i)=>{e.push(i),t(...e).then(r,n)})}constructor(t){this._cancelHandlers=[],this._isPending=!0,this._isCanceled=!1,this._rejectOnCancel=!0,this._promise=new Promise((e,r)=>{this._reject=r;const n=a=>{this._isPending=!1,e(a)},i=a=>{this._isPending=!1,r(a)},s=a=>{if(!this._isPending)throw new Error("The `onCancel` handler was attached after the promise settled.");this._cancelHandlers.push(a)};return Object.defineProperties(s,{shouldReject:{get:()=>this._rejectOnCancel,set:a=>{this._rejectOnCancel=a}}}),t(n,i,s)})}then(t,e){return this._promise.then(t,e)}catch(t){return this._promise.catch(t)}finally(t){return this._promise.finally(t)}cancel(t){if(!this._isPending||this._isCanceled)return;if(this._cancelHandlers.length>0)try{for(const e of this._cancelHandlers)e()}catch(e){this._reject(e)}this._isCanceled=!0,this._rejectOnCancel&&this._reject(new qu(t))}get isCanceled(){return this._isCanceled}}Object.setPrototypeOf(sc.prototype,Promise.prototype);var ac=sc,jg=qu;ac.CancelError=jg;class Vu extends Error{}const Lg=(t,e)=>new ac((r,n,i)=>{const{count:s,filter:a=()=>!0}=e;if(!Number.isFinite(s)){n(new TypeError(`Expected a finite number, got ${typeof e.count}`));return}const c=[],o=[];let l=0,u=!1;const h=new Set,f=()=>(c.length===s&&(r(c),u=!0),l-o.length<s&&(n(new $u(o)),u=!0),u),p=()=>{for(const S of t)!h.has(S)&&typeof S.cancel=="function"&&S.cancel()};i(p);for(const S of t)l++,(async()=>{try{const M=await S;if(u)return;if(!a(M))throw new Vu("Value does not satisfy filter");c.push(M)}catch(M){o.push(M)}finally{h.add(S),!u&&f()&&p()}})();s>l&&(n(new RangeError(`Expected input to contain at least ${e.count} items, but contains ${l} items`)),p())});var Fa=Lg,Bg=$u,Ug=Vu;Fa.AggregateError=Bg,Fa.FilterError=Ug;var $a=(t,e)=>{const r=Fa(t,{...e,count:1});return ac.fn(async n=>{n(()=>{r.cancel()});const[i]=await r;return i})()},Fg=Fa.AggregateError;$a.AggregateError=Fg;var $g=t=>{const e=t._modules.peerRouting||[];return t._dht&&e.unshift(t._dht),{findPeer:async(r,n)=>{if(!e.length)throw U(new Error("No peer routers available"),"NO_ROUTERS_AVAILABLE");return $a(e.map(async i=>{const s=await i.findPeer(r,n);if(!s||Object.keys(s).length===0)throw U(new Error("not found"),"NOT_FOUND");return s}))}}},qg={NOT_STARTED_YET:"The libp2p node is not started yet",DHT_DISABLED:"DHT is not available",CONN_ENCRYPTION_REQUIRED:"At least one connection encryption module is required"},Vg={DHT_DISABLED:"ERR_DHT_DISABLED",PUBSUB_NOT_STARTED:"ERR_PUBSUB_NOT_STARTED",DHT_NOT_STARTED:"ERR_DHT_NOT_STARTED",CONN_ENCRYPTION_REQUIRED:"ERR_CONN_ENCRYPTION_REQUIRED",ERR_CONNECTION_ENDED:"ERR_CONNECTION_ENDED",ERR_CONNECTION_FAILED:"ERR_CONNECTION_FAILED",ERR_NODE_NOT_STARTED:"ERR_NODE_NOT_STARTED",ERR_ALREADY_ABORTED:"ERR_ALREADY_ABORTED",ERR_NO_VALID_ADDRESSES:"ERR_NO_VALID_ADDRESSES",ERR_DIALED_SELF:"ERR_DIALED_SELF",ERR_DISCOVERED_SELF:"ERR_DISCOVERED_SELF",ERR_DUPLICATE_TRANSPORT:"ERR_DUPLICATE_TRANSPORT",ERR_ENCRYPTION_FAILED:"ERR_ENCRYPTION_FAILED",ERR_HOP_REQUEST_FAILED:"ERR_HOP_REQUEST_FAILED",ERR_INVALID_KEY:"ERR_INVALID_KEY",ERR_INVALID_MESSAGE:"ERR_INVALID_MESSAGE",ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS",ERR_INVALID_PEER:"ERR_INVALID_PEER",ERR_MUXER_UNAVAILABLE:"ERR_MUXER_UNAVAILABLE",ERR_TIMEOUT:"ERR_TIMEOUT",ERR_TRANSPORT_UNAVAILABLE:"ERR_TRANSPORT_UNAVAILABLE",ERR_TRANSPORT_DIAL_FAILED:"ERR_TRANSPORT_DIAL_FAILED",ERR_UNSUPPORTED_PROTOCOL:"ERR_UNSUPPORTED_PROTOCOL",ERR_INVALID_MULTIADDR:"ERR_INVALID_MULTIADDR",ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"},dt={messages:qg,codes:Vg};const Gg=async t=>{const e=[];for await(const r of t)e.push(r);return e};var zg=Gg;const{messages:oc,codes:cc}=dt;var Hg=t=>{const e=t._modules.contentRouting||[],r=t._dht;return r&&e.unshift(r),{async*findProviders(n,i){if(!e.length)throw U(new Error("No content routers available"),"NO_ROUTERS_AVAILABLE");const s=await $a(e.map(async a=>{const c=await zg(a.findProviders(n,i));if(!c||!c.length)throw U(new Error("not found"),"NOT_FOUND");return c}));for(const a of s)yield a},async provide(n){if(!e.length)throw U(new Error("No content routers available"),"NO_ROUTERS_AVAILABLE");return Promise.all(e.map(i=>i.provide(n)))},async put(n,i,s){if(!t.isStarted()||!r.isStarted)throw U(new Error(oc.NOT_STARTED_YET),cc.DHT_NOT_STARTED);return r.put(n,i,s)},async get(n,i){if(!t.isStarted()||!r.isStarted)throw U(new Error(oc.NOT_STARTED_YET),cc.DHT_NOT_STARTED);return r.get(n,i)},async getMany(n,i,s){if(!t.isStarted()||!r.isStarted)throw U(new Error(oc.NOT_STARTED_YET),cc.DHT_NOT_STARTED);return r.getMany(n,i,s)}}};const Wg=Tt,lc=Tt.v4,Gu=Tt.v6,zu=function(t,e,r){r=~~r;var n;if(lc(t))n=e||new Uint8Array(r+4),t.split(/\./g).map(function(u){n[r++]=parseInt(u,10)&255});else if(Gu(t)){var i=t.split(":",8),s;for(s=0;s<i.length;s++){var a=lc(i[s]),c;a&&(c=zu(i[s]),i[s]=se(c.slice(0,2),"base16")),c&&++s<8&&i.splice(s,0,se(c.slice(2,4),"base16"))}if(i[0]==="")for(;i.length<8;)i.unshift("0");else if(i[i.length-1]==="")for(;i.length<8;)i.push("0");else if(i.length<8){for(s=0;s<i.length&&i[s]!=="";s++);var o=[s,"1"];for(s=9-i.length;s>0;s--)o.push("0");i.splice.apply(i,o)}for(n=e||new Uint8Array(r+16),s=0;s<i.length;s++){var l=parseInt(i[s],16);n[r++]=l>>8&255,n[r++]=l&255}}if(!n)throw Error("Invalid ip address: "+t);return n},Kg=function(t,e,r){e=~~e,r=r||t.length-e;var n=[],i;const s=new DataView(t.buffer);if(r===4){for(let a=0;a<r;a++)n.push(t[e+a]);i=n.join(".")}else if(r===16){for(let a=0;a<r;a+=2)n.push(s.getUint16(e+a).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i};var qa={isIP:Wg,isV4:lc,isV6:Gu,toBytes:zu,toString:Kg};function Mt(t){if(typeof t=="number"){if(Mt.codes[t])return Mt.codes[t];throw new Error("no protocol with code: "+t)}else if(typeof t=="string"||t instanceof String){if(Mt.names[t])return Mt.names[t];throw new Error("no protocol with name: "+t)}throw new Error("invalid protocol id type: "+t)}const nr=-1;Mt.lengthPrefixedVarSize=nr,Mt.V=nr,Mt.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,nr,"ip6zone"],[53,nr,"dns","resolvable"],[54,nr,"dns4","resolvable"],[55,nr,"dns6","resolvable"],[56,nr,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,nr,"unix",!1,"path"],[421,nr,"ipfs"],[421,nr,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,nr,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,nr,"memory"]],Mt.names={},Mt.codes={},Mt.table.map(t=>{const e=Hu.apply(null,t);Mt.codes[e.code]=e,Mt.names[e.name]=e}),Mt.object=Hu;function Hu(t,e,r,n,i){return{code:t,size:e,name:r,resolvable:Boolean(n),path:Boolean(i)}}var br=Mt,Wu=Zs;function Zs(t,e){return e instanceof Uint8Array?Zs.toString(t,e):Zs.toBytes(t,e)}Zs.toString=function(e,r){e=br(e);switch(e.code){case 4:case 41:return Xg(r);case 6:case 273:case 33:case 132:return Xu(r);case 53:case 54:case 55:case 56:case 400:case 777:return Yg(r);case 421:return Zg(r);case 444:return Qu(r);case 445:return Qu(r);default:return se(r,"base16")}},Zs.toBytes=function(e,r){e=br(e);switch(e.code){case 4:return Ku(r);case 41:return Ku(r);case 6:case 273:case 33:case 132:return uc(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return Qg(r);case 421:return Jg(r);case 444:return eb(r);case 445:return tb(r);default:return je(r,"base16")}};function Ku(t){if(!qa.isIP(t))throw new Error("invalid ip address");return qa.toBytes(t)}function Xg(t){const e=qa.toString(t);if(!e||!qa.isIP(e))throw new Error("invalid ip address");return e}function uc(t){const e=new ArrayBuffer(2),r=new DataView(e);return r.setUint16(0,t),new Uint8Array(e)}function Xu(t){const e=new DataView(t.buffer);return e.getUint16(0)}function Qg(t){const e=je(t),r=Uint8Array.from(J.encode(e.length));return we([r,e],r.length+e.length)}function Yg(t){const e=J.decode(t);if(t=t.slice(J.decode.bytes),t.length!==e)throw new Error("inconsistent lengths");return se(t)}function Jg(t){const e=new Nr(t).multihash,r=Uint8Array.from(J.encode(e.length));return we([r,e],r.length+e.length)}function Zg(t){const e=J.decode(t),r=t.slice(J.decode.bytes);if(r.length!==e)throw new Error("inconsistent lengths");return se(r,"base58btc")}function eb(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==16)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion address.");const r=Or.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=uc(n);return we([r,i],r.length+i.length)}function tb(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==56)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion3 address.");const r=Or.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=uc(n);return we([r,i],r.length+i.length)}function Qu(t){const e=t.slice(0,t.length-2),r=t.slice(t.length-2),n=se(e,"base32"),i=Xu(r);return n+":"+i}var yr={stringToStringTuples:Yu,stringTuplesToString:Ju,tuplesToStringTuples:ed,stringTuplesToTuples:Zu,bytesToTuples:dc,tuplesToBytes:td,bytesToString:rb,stringToBytes:nd,fromString:nb,fromBytes:id,validateBytes:hc,isValidBytes:ib,cleanPath:Va,ParseError:pc,protoFromTuple:ea,sizeForAddr:rd};function Yu(t){const e=[],r=t.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let n=0;n<r.length;n++){const i=r[n],s=br(i);if(s.size===0){e.push([i]);continue}if(n++,n>=r.length)throw pc("invalid address: "+t);if(s.path){e.push([i,Va(r.slice(n).join("/"))]);break}e.push([i,r[n]])}return e}function Ju(t){const e=[];return t.map(r=>{const n=ea(r);e.push(n.name),r.length>1&&e.push(r[1])}),Va(e.join("/"))}function Zu(t){return t.map(e=>{Array.isArray(e)||(e=[e]);const r=ea(e);return e.length>1?[r.code,Wu.toBytes(r.code,e[1])]:[r.code]})}function ed(t){return t.map(e=>{const r=ea(e);return e.length>1?[r.code,Wu.toString(r.code,e[1])]:[r.code]})}function td(t){return id(we(t.map(e=>{const r=ea(e);let n=Uint8Array.from(J.encode(r.code));return e.length>1&&(n=we([n,e[1]])),n})))}function rd(t,e){if(t.size>0)return t.size/8;if(t.size===0)return 0;{const r=J.decode(e);return r+J.decode.bytes}}function dc(t){const e=[];let r=0;for(;r<t.length;){const n=J.decode(t,r),i=J.decode.bytes,s=br(n),a=rd(s,t.slice(r+i));if(a===0){e.push([n]),r+=i;continue}const c=t.slice(r+i,r+i+a);if(r+=a+i,r>t.length)throw pc("Invalid address Uint8Array: "+se(t,"base16"));e.push([n,c])}return e}function rb(t){const e=dc(t),r=ed(e);return Ju(r)}function nd(t){t=Va(t);const e=Yu(t),r=Zu(e);return td(r)}function nb(t){return nd(t)}function id(t){const e=hc(t);if(e)throw e;return Uint8Array.from(t)}function hc(t){try{dc(t)}catch(e){return e}}function ib(t){return hc(t)===void 0}function Va(t){return"/"+t.trim().split("/").filter(e=>e).join("/")}function pc(t){return new Error("Error parsing address: "+t)}function ea(t){const e=br(t[0]);return e}var Ge=te(function(t,e){const r=Symbol.for("nodejs.util.inspect.custom"),n=new Map,i=Ht.proto(function(s){if(!(this instanceof i))return new i(s);if(s==null&&(s=""),s instanceof Uint8Array)this.bytes=yr.fromBytes(s);else if(typeof s=="string"||s instanceof String){if(s.length>0&&s.charAt(0)!=="/")throw new Error(`multiaddr "${s}" must start with a "/"`);this.bytes=yr.fromString(s)}else if(s.bytes&&s.protos&&s.protoCodes)this.bytes=yr.fromBytes(s.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});i.prototype.toString=function(){return yr.bytesToString(this.bytes)},i.prototype.toJSON=i.prototype.toString,i.prototype.toOptions=function(){const a={},c=this.toString().split("/");return a.family=c[1]==="ip4"?"ipv4":"ipv6",a.host=c[2],a.transport=c[3],a.port=parseInt(c[4]),a},i.prototype[r]=function(){return"<Multiaddr "+se(this.bytes,"base16")+" - "+yr.bytesToString(this.bytes)+">"},i.prototype.inspect=function(){return"<Multiaddr "+se(this.bytes,"base16")+" - "+yr.bytesToString(this.bytes)+">"},i.prototype.protos=function(){return this.protoCodes().map(a=>Object.assign({},br(a)))},i.prototype.protoCodes=function(){const a=[],c=this.bytes;let o=0;for(;o<c.length;){const l=J.decode(c,o),u=J.decode.bytes,h=br(l),f=yr.sizeForAddr(h,c.slice(o+u));o+=f+u,a.push(l)}return a},i.prototype.protoNames=function(){return this.protos().map(a=>a.name)},i.prototype.tuples=function(){return yr.bytesToTuples(this.bytes)},i.prototype.stringTuples=function(){const a=yr.bytesToTuples(this.bytes);return yr.tuplesToStringTuples(a)},i.prototype.encapsulate=function(a){return a=i(a),i(this.toString()+a.toString())},i.prototype.decapsulate=function(a){a=a.toString();const c=this.toString(),o=c.lastIndexOf(a);if(o<0)throw new Error("Address "+this+" does not contain subaddress: "+a);return i(c.slice(0,o))},i.prototype.decapsulateCode=function(a){const c=this.tuples();for(let o=c.length-1;o>=0;o--)if(c[o][0]===a)return i(yr.tuplesToBytes(c.slice(0,o)));return this},i.prototype.getPeerId=function(){let a=null;try{const c=this.stringTuples().filter(o=>{if(o[0]===br.names.ipfs.code)return!0});a=c.pop()[1],a=se(new Nr(a).multihash,"base58btc")}catch(c){a=null}return a},i.prototype.getPath=function(){let a=null;try{a=this.stringTuples().filter(c=>{const o=br(c[0]);if(o.path)return!0})[0][1]}catch(c){a=null}return a},i.prototype.equals=function(a){return tr(this.bytes,a.bytes)},i.prototype.resolve=async function(){const a=this.protos().find(l=>l.resolvable);if(!a)return[this];const c=n.get(a.name);if(!c)throw U(new Error(`no available resolver for ${a.name}`),"ERR_NO_AVAILABLE_RESOLVER");const o=await c(this);return o.map(l=>i(l))},i.prototype.nodeAddress=function(){const a=this.protoCodes(),c=this.protoNames(),o=this.toString().split("/").slice(1);if(o.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(a[0]!==4&&a[0]!==41&&a[0]!==54&&a[0]!==55)throw new Error(`no protocol with name: "'${c[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(o[2]!=="tcp"&&o[2]!=="udp")throw new Error(`no protocol with name: "'${c[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:a[0]===41||a[0]===55?6:4,address:o[1],port:parseInt(o[3])}},i.fromNodeAddress=function(a,c){if(!a)throw new Error("requires node address object");if(!c)throw new Error("requires transport protocol");let o;switch(a.family){case"IPv4":o="ip4";break;case"IPv6":o="ip6";break;default:throw Error(`Invalid addr family. Got '${a.family}' instead of 'IPv4' or 'IPv6'`)}return i("/"+[o,a.address,c,a.port].join("/"))},i.prototype.isThinWaistAddress=function(a){const c=(a||this).protos();return c.length!==2||c[0].code!==4&&c[0].code!==41?!1:!(c[1].code!==6&&c[1].code!==273)},i.protocols=br,i.isName=function(a){return i.isMultiaddr(a)?a.protos().some(c=>c.resolvable):!1},i.resolve=function(a){return!i.isMultiaddr(a)||!i.isName(a)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},i.resolvers=n,e=t.exports=i});const{codes:sb}=dt;function ab(t){typeof t=="string"&&(t=Ge(t));let e;if(Ge.isMultiaddr(t)){e=t;try{t=be.createFromB58String(t.getPeerId())}catch(r){throw U(new Error(`${t} is not a valid peer type`),sb.ERR_INVALID_MULTIADDR)}}return{id:t,multiaddrs:e?[e]:void 0}}var Ga=ab,za=t=>{if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype};const{hasOwnProperty:sd}=Object.prototype,{propertyIsEnumerable:ob}=Object,Li=(t,e,r)=>Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0}),cb=ae,ad={concatArrays:!1,ignoreUndefined:!1},Ha=t=>{const e=[];for(const r in t)sd.call(t,r)&&e.push(r);if(Object.getOwnPropertySymbols){const r=Object.getOwnPropertySymbols(t);for(const n of r)ob.call(t,n)&&e.push(n)}return e};function Bi(t){return Array.isArray(t)?lb(t):za(t)?ub(t):t}function lb(t){const e=t.slice(0,0);return Ha(t).forEach(r=>{Li(e,r,Bi(t[r]))}),e}function ub(t){const e=Object.getPrototypeOf(t)===null?Object.create(null):{};return Ha(t).forEach(r=>{Li(e,r,Bi(t[r]))}),e}const od=(t,e,r,n)=>(r.forEach(i=>{if(typeof e[i]=="undefined"&&n.ignoreUndefined)return;i in t&&t[i]!==Object.getPrototypeOf(t)?Li(t,i,fc(t[i],e[i],n)):Li(t,i,Bi(e[i]))}),t),db=(t,e,r)=>{let n=t.slice(0,0),i=0;return[t,e].forEach(s=>{const a=[];for(let c=0;c<s.length;c++){if(!sd.call(s,c))continue;a.push(String(c)),s===t?Li(n,i++,s[c]):Li(n,i++,Bi(s[c]))}n=od(n,s,Ha(s).filter(c=>!a.includes(c)),r)}),n};function fc(t,e,r){return r.concatArrays&&Array.isArray(t)&&Array.isArray(e)?db(t,e,r):!za(e)||!za(t)?Bi(e):od(t,e,Ha(e),r)}var Wa=function(...t){const e=fc(Bi(ad),this!==cb&&this||{},ad);let r={_:{}};for(const n of t){if(n===void 0)continue;if(!za(n))throw new TypeError("`"+n+"` is not an Option Object");r=fc(r,{_:n},e)}return r._},hb=cd,Tn=cd.prototype,pb=new Date%1e9;function fb(){return(Math.random()*1e9>>>0)+pb++}function cd(t){t=t||{},this.id=t.id||fb(),this.max=t.max||Infinity,this.items=t.items||[],this._lookup={},this.size=this.items.length,this.lastModified=new Date(t.lastModified||new Date);for(var e,r,n=this.items.length;n--;)e=this.items[n],r=new Date(e.expires)-new Date,this._lookup[e.key]=e,r>0?this.expire(e.key,r):r<=0&&this.delete(e.key)}Tn.has=function(t){return t in this._lookup},Tn.get=function(t){if(!this.has(t))return null;var e=this._lookup[t];return e.refresh&&this.expire(t,e.refresh),this.items.splice(this.items.indexOf(e),1),this.items.push(e),e.value},Tn.meta=function(t){if(!this.has(t))return null;var e=this._lookup[t];return"meta"in e?e.meta:null},Tn.set=function(t,e,r){var n=this._lookup[t],i=this._lookup[t]={key:t,value:e};return this.lastModified=new Date,n?(clearTimeout(n.timeout),this.items.splice(this.items.indexOf(n),1,i)):(this.size>=this.max&&this.delete(this.items[0].key),this.items.push(i),this.size++),r&&("ttl"in r&&this.expire(t,r.ttl),"meta"in r&&(i.meta=r.meta),r.refresh&&(i.refresh=r.ttl)),this},Tn.delete=function(t){var e=this._lookup[t];return e?(this.lastModified=new Date,this.items.splice(this.items.indexOf(e),1),clearTimeout(e.timeout),delete this._lookup[t],this.size--,this):!1},Tn.expire=function(t,e){var r=e||0,n=this._lookup[t];if(!n)return this;if(typeof r=="string"&&(r=Ua(e)),typeof r!="number")throw new TypeError("Expiration time must be a string or number.");return clearTimeout(n.timeout),n.timeout=setTimeout(this.delete.bind(this,n.key),r),n.expires=Number(new Date)+r,this},Tn.clear=function(){for(var t=this.items.length;t--;)this.delete(this.items[t].key);return this},Tn.toJSON=function(){for(var t=new Array(this.items.length),e,r=t.length;r--;)e=this.items[r],t[r]={key:e.key,meta:e.meta,value:e.value,expires:e.expires,refresh:e.refresh};return{id:this.id,max:isFinite(this.max)?this.max:void 0,lastModified:this.lastModified,items:t}};var ld=Object.prototype.toString,ud=function(e){var r=ld.call(e),n=r==="[object Arguments]";return n||(n=r!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&ld.call(e.callee)==="[object Function]"),n},dd;if(!Object.keys){var Ka=Object.prototype.hasOwnProperty,hd=Object.prototype.toString,mb=ud,pd=Object.prototype.propertyIsEnumerable,gb=!pd.call({toString:null},"toString"),bb=pd.call(function(){},"prototype"),Xa=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],mc=function(t){var e=t.constructor;return e&&e.prototype===t},yb={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},vb=function(){if(typeof window=="undefined")return!1;for(var t in window)try{if(!yb["$"+t]&&Ka.call(window,t)&&window[t]!==null&&typeof window[t]=="object")try{mc(window[t])}catch(e){return!0}}catch(e){return!0}return!1}(),wb=function(t){if(typeof window=="undefined"||!vb)return mc(t);try{return mc(t)}catch(e){return!1}};dd=function(e){var r=e!==null&&typeof e=="object",n=hd.call(e)==="[object Function]",i=mb(e),s=r&&hd.call(e)==="[object String]",a=[];if(!r&&!n&&!i)throw new TypeError("Object.keys called on a non-object");var c=bb&&n;if(s&&e.length>0&&!Ka.call(e,0))for(var o=0;o<e.length;++o)a.push(String(o));if(i&&e.length>0)for(var l=0;l<e.length;++l)a.push(String(l));else for(var u in e)!(c&&u==="prototype")&&Ka.call(e,u)&&a.push(String(u));if(gb)for(var h=wb(e),f=0;f<Xa.length;++f)!(h&&Xa[f]==="constructor")&&Ka.call(e,Xa[f])&&a.push(Xa[f]);return a}}var _b=dd,Eb=Array.prototype.slice,fd=Object.keys,Qa=fd?function(e){return fd(e)}:_b,md=Object.keys;Qa.shim=function(){if(Object.keys){var e=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);e||(Object.keys=function(n){return ud(n)?md(Eb.call(n)):md(n)})}else Object.keys=Qa;return Object.keys||Qa};var Sb=Qa,Tb=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",Ab=Object.prototype.toString,Cb=Array.prototype.concat,gc=Object.defineProperty,Ib=function(t){return typeof t=="function"&&Ab.call(t)==="[object Function]"},Rb=function(){var t={};try{gc(t,"x",{enumerable:!1,value:t});for(var e in t)return!1;return t.x===t}catch(r){return!1}},gd=gc&&Rb(),kb=function(t,e,r,n){if(e in t&&(!Ib(n)||!n()))return;gd?gc(t,e,{configurable:!0,enumerable:!1,value:r,writable:!0}):t[e]=r},bd=function(t,e){var r=arguments.length>2?arguments[2]:{},n=Sb(e);Tb&&(n=Cb.call(n,Object.getOwnPropertySymbols(e)));for(var i=0;i<n.length;i+=1)kb(t,n[i],e[n[i]],r[n[i]])};bd.supportsDescriptors=!!gd;var yd=bd,vd=te(function(t){typeof self!="undefined"?t.exports=self:typeof window!="undefined"?t.exports=window:t.exports=Function("return this")()}),bc=function(){return typeof ae!="object"||!ae||ae.Math!==Math||ae.Array!==Array?vd:ae},Pb=function(){var e=bc();if(yd.supportsDescriptors){var r=Object.getOwnPropertyDescriptor(e,"globalThis");(!r||r.configurable&&(r.enumerable||r.writable||globalThis!==e))&&Object.defineProperty(e,"globalThis",{configurable:!0,enumerable:!1,value:e,writable:!1})}else(typeof globalThis!="object"||globalThis!==e)&&(e.globalThis=e);return e},Nb=bc(),wd=function(){return Nb};yd(wd,{getPolyfill:bc,implementation:vd,shim:Pb});var Ob=wd,Mb=te(function(t){const e=Ob();e.fetch&&e.Headers&&e.Request&&e.Response?(t.exports=function(...n){return e.fetch(...n)},t.exports.Headers=e.Headers,t.exports.Request=e.Request,t.exports.Response=e.Response,t.exports.default=t.exports):t.exports=Ng});const{default:Db,Headers:xb}=Mb;function jb({serverResolver:t,hostname:e,recordType:r}){return`${t}?name=${e}&type=${r}`}var Lb=jb;function Bb(t){return Db(t,{headers:new xb({accept:"application/dns-json"})})}var Ub=Bb;function Fb(t,e){return`${e}_${t}`}var $b=Fb,qb={buildResource:Lb,fetch:Ub,getCacheKey:$b};const Ya=Q("dns-over-http-resolver");Ya.error=Q("dns-over-http-resolver:error");const{buildResource:yc,fetch:vc,getCacheKey:Ui}=qb;class wc{constructor({maxCache:t=100}={}){this._cache=new hb({max:t}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"]}getServers(){return this._servers}_getShuffledServers(){const t=[].concat(this._servers);for(let e=t.length-1;e>0;e--){const r=Math.floor(Math.random()*e),n=t[e];t[e]=t[r],t[r]=n}return t}setServers(t){this._servers=t}resolve(t,e="A"){switch(e){case"A":return this.resolve4(t);case"AAAA":return this.resolve6(t);case"TXT":return this.resolveTxt(t);default:throw new Error(`${e} is not supported`)}}async resolve4(t){const e="A",r=this._cache.get(Ui(t,e));if(r)return r;for(const n of this._getShuffledServers())try{const i=await vc(yc({serverResolver:n,hostname:t,recordType:e})),s=await i.json(),a=s.Answer.map(o=>o.data),c=Math.min(s.Answer.map(o=>o.TTL));return this._cache.set(Ui(t,e),a,{ttl:c}),a}catch(i){Ya.error(`${n} could not resolve ${t} record ${e}`)}throw new Error(`Could not resolve ${t} record ${e}`)}async resolve6(t){const e="AAAA",r=this._cache.get(Ui(t,e));if(r)return r;for(const n of this._getShuffledServers())try{const i=await vc(yc({serverResolver:n,hostname:t,recordType:e})),s=await i.json(),a=s.Answer.map(o=>o.data),c=Math.min(s.Answer.map(o=>o.TTL));return this._cache.set(Ui(t,e),a,{ttl:c}),a}catch(i){Ya.error(`${n} could not resolve ${t} record ${e}`)}throw new Error(`Could not resolve ${t} record ${e}`)}async resolveTxt(t){const e="TXT",r=this._cache.get(Ui(t,e));if(r)return r;for(const n of this._getShuffledServers())try{const i=await vc(yc({serverResolver:n,hostname:t,recordType:e})),s=await i.json(),a=s.Answer.map(o=>[o.data.replace(/['"]+/g,"")]),c=Math.min(s.Answer.map(o=>o.TTL));return this._cache.set(Ui(t,e),a,{ttl:c}),a}catch(i){Ya.error(`${n} could not resolve ${t} record ${e}`)}throw new Error(`Could not resolve ${t} record ${e}`)}}wc.Resolver=wc;var Vb=wc;let Ja;try{if(Ja=rc.promises,!Ja)throw new Error("no dns available")}catch(t){Ja=Vb}var Gb=Ja;const{code:zb}=br("dnsaddr");async function Hb(t){const{Resolver:e}=Gb,r=new e,n=t.getPeerId(),[,i]=t.stringTuples().find(([c])=>c===zb)||[],s=await r.resolveTxt(`_dnsaddr.${i}`);let a=s.flat().map(c=>c.split("=")[1]);return n&&(a=a.filter(c=>c.includes(n))),a}var Wb={dnsaddrResolver:Hb},ta={DIAL_TIMEOUT:3e4,MAX_PARALLEL_DIALS:100,MAX_PER_PEER_DIALS:4,METRICS:{computeThrottleMaxQueueSize:1e3,computeThrottleTimeout:2e3,movingAverageIntervals:[60*1e3,5*60*1e3,15*60*1e3],maxOldPeersRetention:50}};const Kb="libp2p",Xb="0.29.4",Qb="JavaScript implementation of libp2p, a modular peer to peer network stack",Yb="Jacob Heun <jacobheun@gmail.com>",Jb="src/index.js",Zb=["dist","src"],ey={lint:"aegir lint",build:"aegir build",test:"npm run test:node && npm run test:browser","test:node":'aegir test -t node -f "./test/**/*.{node,spec}.js"',"test:browser":"aegir test -t browser",release:"aegir release -t node -t browser","release-minor":"aegir release --type minor -t node -t browser","release-major":"aegir release --type major -t node -t browser",coverage:"nyc --reporter=text --reporter=lcov npm run test:node"},ty={type:"git",url:"https://github.com/libp2p/js-libp2p.git"},ry=["libp2p","network","p2p","peer","peer-to-peer","IPFS"],ny={url:"https://github.com/libp2p/js-libp2p/issues"},iy="https://libp2p.io",sy="MIT",ay={node:">=12.0.0",npm:">=6.0.0"},oy={"abort-controller":"^3.0.0","aggregate-error":"^3.0.1","any-signal":"^1.1.0","bignumber.js":"^9.0.0","class-is":"^1.1.0",debug:"^4.1.1","err-code":"^2.0.0",events:"^3.1.0",hashlru:"^2.3.0","interface-datastore":"^2.0.0","ipfs-utils":"^2.2.0","it-all":"^1.0.1","it-buffer":"^0.1.2","it-handshake":"^1.0.1","it-length-prefixed":"^3.0.1","it-pipe":"^1.1.0","it-protocol-buffers":"^0.2.0","libp2p-crypto":"^0.18.0","libp2p-interfaces":"^0.5.1","libp2p-utils":"^0.2.0",mafmt:"^8.0.0","merge-options":"^2.0.0","moving-average":"^1.0.0",multiaddr:"^8.1.0",multicodec:"^2.0.0","multistream-select":"^1.0.0","mutable-proxy":"^1.0.0","node-forge":"^0.9.1","p-any":"^3.0.0","p-fifo":"^1.0.0","p-settle":"^4.0.1","peer-id":"^0.14.2",protons:"^2.0.0",retimer:"^2.0.0","sanitize-filename":"^1.6.3","streaming-iterables":"^5.0.2","timeout-abort-controller":"^1.1.1",varint:"^5.0.0",xsalsa20:"^1.0.2"},cy={"@nodeutils/defaults-deep":"^1.1.0","abortable-iterator":"^3.0.0",aegir:"^27.0.0",chai:"^4.2.0","chai-as-promised":"^7.1.1","chai-bytes":"^0.1.2","chai-string":"^1.5.0",cids:"^1.0.0",delay:"^4.3.0","dirty-chai":"^2.0.1","interop-libp2p":"^0.3.0","ipfs-http-client":"^47.0.1","it-concat":"^1.0.0","it-pair":"^1.0.0","it-pushable":"^1.4.0",libp2p:".","libp2p-bootstrap":"^0.12.0","libp2p-delegated-content-routing":"^0.7.0","libp2p-delegated-peer-routing":"^0.7.0","libp2p-floodsub":"^0.23.0","libp2p-gossipsub":"^0.6.0","libp2p-kad-dht":"^0.20.0","libp2p-mdns":"^0.15.0","libp2p-mplex":"^0.10.1","libp2p-noise":"^2.0.0","libp2p-secio":"^0.13.1","libp2p-tcp":"^0.15.1","libp2p-webrtc-star":"^0.20.0","libp2p-websockets":"^0.14.0",multihashes:"^3.0.1",nock:"^13.0.3","p-defer":"^3.0.0","p-times":"^3.0.0","p-wait-for":"^3.1.0","promisify-es6":"^1.0.3",rimraf:"^3.0.2",sinon:"^9.0.2",uint8arrays:"^1.1.0"},ly=["David Dias <daviddias.p@gmail.com>","Jacob Heun <jacobheun@gmail.com>","Vasco Santos <vasco.santos@moxy.studio>","Alan Shaw <alan@tableflip.io>","Alex Potsides <alex@achingbrain.net>","Cayman <caymannava@gmail.com>","Pedro Teixeira <i@pgte.me>","Friedel Ziegelmayer <dignifiedquire@gmail.com>","Maciej Kr\xFCger <mkg20001@gmail.com>","Hugo Dias <mail@hugodias.me>","dirkmc <dirkmdev@gmail.com>","Volker Mische <volker.mische@gmail.com>","Richard Littauer <richard.littauer@gmail.com>","a1300 <matthias-knopp@gmx.net>","Elven <mon.samuel@qq.com>","Andrew Nesbitt <andrewnez@gmail.com>","Giovanni T. Parra <fiatjaf@gmail.com>","Ryan Bell <ryan@piing.net>","Thomas Eizinger <thomas@eizinger.io>","\u1D20\u026A\u1D04\u1D1B\u1D0F\u0280 \u0299\u1D0A\u1D07\u029F\u1D0B\u029C\u1D0F\u029F\u1D0D <victorbjelkholm@gmail.com>","Didrik Nordstr\xF6m <didrik@betamos.se>","Irakli Gozalishvili <rfobic@gmail.com>","Ethan Lam <elmemphis2000@gmail.com>","Joel Gustafson <joelg@mit.edu>","Julien Bouquillon <contact@revolunet.com>","Kevin Kwok <antimatter15@gmail.com>","Nuno Nogueira <nunofmn@gmail.com>","Dmitriy Ryajov <dryajov@gmail.com>","RasmusErik Voel Jensen <github@solsort.com>","Diogo Silva <fsdiogo@gmail.com>","Samlior <samlior@foxmail.com>","Smite Chow <xiaopengyou@live.com>","Soeren <nikorpoulsen@gmail.com>","S\xF6nke Hahn <soenkehahn@gmail.com>","robertkiel <robert.kiel@validitylabs.org>","Tiago Alves <alvesjtiago@gmail.com>","Daijiro Wachi <daijiro.wachi@gmail.com>","Yusef Napora <yusef@napora.org>","Zane Starr <zcstarr@gmail.com>","Cindy Wu <ciindy.wu@gmail.com>","Chris Bratlien <chrisbratlien@gmail.com>","ebinks <elizabethjbinks@gmail.com>","Bernd Strehl <bernd.strehl@gmail.com>","Florian-Merle <florian.david.merle@gmail.com>","Francis Gulotta <wizard@roborooter.com>","Felipe Martins <felipebrasil93@gmail.com>","isan_rivkin <isanrivkin@gmail.com>","Henrique Dias <hacdias@gmail.com>","Fei Liu <liu.feiwood@gmail.com>"];var uy={name:Kb,version:Xb,description:Qb,leadMaintainer:Yb,main:Jb,files:Zb,scripts:ey,repository:ty,keywords:ry,bugs:ny,homepage:iy,license:sy,engines:ay,dependencies:oy,devDependencies:cy,contributors:ly};const dy=uy.version;var hy="ipfs/0.1.0",py=`js-libp2p/${dy}`,fy="/ipfs/id/1.0.0",my="/ipfs/id/push/1.0.0",_d={PROTOCOL_VERSION:hy,AGENT_VERSION:py,MULTICODEC_IDENTIFY:fy,MULTICODEC_IDENTIFY_PUSH:my};const Ed=async t=>{try{const e=await t;return{isFulfilled:!0,isRejected:!1,value:e}}catch(e){return{isFulfilled:!1,isRejected:!0,reason:e}}};var Za=Ed,gy=Ed;Za.default=gy;const Sd=(t,...e)=>new Promise(r=>{r(t(...e))});var Td=Sd,by=Sd;Td.default=by;const Ad=t=>{if(!((Number.isInteger(t)||t===Infinity)&&t>0))return Promise.reject(new TypeError("Expected `concurrency` to be a number from 1 and up"));const e=[];let r=0;const n=()=>{r--,e.length>0&&e.shift()()},i=(c,o,...l)=>{r++;const u=Td(c,...l);o(u),u.then(n,n)},s=(c,o,...l)=>{r<t?i(c,o,...l):e.push(i.bind(null,c,o,...l))},a=(c,...o)=>new Promise(l=>s(c,l,...o));return Object.defineProperties(a,{activeCount:{get:()=>r},pendingCount:{get:()=>e.length},clearQueue:{value:()=>{e.length=0}}}),a};var Cd=Ad,yy=Ad;Cd.default=yy;var vy=async(t,e={})=>{const{concurrency:r=Infinity}=e,n=Cd(r);return Promise.all(t.map(i=>i&&typeof i.then=="function"?Za(i):typeof i=="function"?Za(n(()=>i())):Za(Promise.resolve(i))))};const{codes:Fi}=dt,An=Q("libp2p:transports");An.error=Q("libp2p:transports:error");class Id{constructor({libp2p:t,upgrader:e,faultTolerance:r=_c.FATAL_ALL}){this.libp2p=t,this.upgrader=e,this._transports=new Map,this._listeners=new Map,this._listenerOptions=new Map,this.faultTolerance=r}add(t,e,r={}){if(An("adding %s",t),!t)throw U(new Error(`Transport must have a valid key, was given '${t}'`),Fi.ERR_INVALID_KEY);if(this._transports.has(t))throw U(new Error("There is already a transport with this key"),Fi.ERR_DUPLICATE_TRANSPORT);const n=new e({...r,libp2p:this.libp2p,upgrader:this.upgrader});this._transports.set(t,n),this._listenerOptions.set(t,r.listenerOptions||{}),this._listeners.has(t)||this._listeners.set(t,[])}async close(){const t=[];for(const[e,r]of this._listeners)for(An("closing listeners for %s",e);r.length;){const n=r.pop();t.push(n.close())}await Promise.all(t),An("all listeners closed");for(const e of this._listeners.keys())this._listeners.set(e,[])}async dial(t,e){const r=this.transportForMultiaddr(t);if(!r)throw U(new Error(`No transport available for address ${String(t)}`),Fi.ERR_TRANSPORT_UNAVAILABLE);try{return await r.dial(t,e)}catch(n){throw n.code||(n.code=Fi.ERR_TRANSPORT_DIAL_FAILED),n}}getAddrs(){let t=[];for(const e of this._listeners.values())for(const r of e)t=[...t,...r.getAddrs()];return t}getTransports(){return this._transports.values()}transportForMultiaddr(t){for(const e of this._transports.values()){const r=e.filter([t]);if(r.length)return e}return null}async listen(){const t=this.libp2p.addressManager.getListenAddrs();if(t.length===0){An("no addresses were provided for listening, this node is dial only");return}const e=[];for(const[r,n]of this._transports.entries()){const i=n.filter(t),s=[];for(const o of i){An("creating listener for %s on %s",r,o);const l=n.createListener(this._listenerOptions.get(r),this.onConnection);this._listeners.get(r).push(l),s.push(l.listen(o))}if(s.length===0){e.push(r);continue}const a=await vy(s),c=a.find(o=>o.isFulfilled===!0);if(!c)throw U(new Error(`Transport (${r}) could not listen on any available address`),Fi.ERR_NO_VALID_ADDRESSES)}if(e.length===this._transports.size){const r=`no valid addresses were provided for transports [${e}]`;if(this.faultTolerance===_c.FATAL_ALL)throw U(new Error(r),Fi.ERR_NO_VALID_ADDRESSES);An(`libp2p in dial mode only: ${r}`)}}async remove(t){if(An("removing %s",t),this._listeners.has(t))for(const e of this._listeners.get(t))await e.close();this._transports.delete(t),this._listeners.delete(t)}async removeAll(){const t=[];for(const e of this._transports.keys())t.push(this.remove(e));await Promise.all(t)}}const _c={FATAL_ALL:0,NO_FATAL:1};Id.FaultTolerance=_c;var Rd=Id;const{dnsaddrResolver:wy}=Wb,{AGENT_VERSION:_y}=_d,{FaultTolerance:Ey}=Rd,Sy={addresses:{listen:[],announce:[],noAnnounce:[]},connectionManager:{minConnections:25},transportManager:{faultTolerance:Ey.FATAL_ALL},dialer:{maxParallelDials:ta.MAX_PARALLEL_DIALS,maxDialsPerPeer:ta.MAX_PER_PEER_DIALS,dialTimeout:ta.DIAL_TIMEOUT,resolvers:{dnsaddr:wy}},host:{agentVersion:_y},metrics:{enabled:!1},peerStore:{persistence:!1,threshold:5},config:{dht:{enabled:!1,kBucketSize:20,randomWalk:{enabled:!1,queriesPerPeriod:1,interval:3e5,timeout:1e4}},peerDiscovery:{autoDial:!0},pubsub:{enabled:!0,emitSelf:!0,signMessages:!0,strictSigning:!0},relay:{enabled:!0,hop:{enabled:!1,active:!1}},transport:{}}};var Ty=t=>{if(t=Wa(Sy,t),t.modules.transport.length<1)throw new Error("'options.modules.transport' must contain at least 1 transport");return t},Ay={validate:Ty};const Cy=Q("libp2p:addresses");Cy.error=Q("libp2p:addresses:error");class Iy{constructor({listen:t=[],announce:e=[],noAnnounce:r=[]}={}){this.listen=new Set(t),this.announce=new Set(e),this.noAnnounce=new Set(r)}getListenAddrs(){return Array.from(this.listen).map(t=>Ge(t))}getAnnounceAddrs(){return Array.from(this.announce).map(t=>Ge(t))}getNoAnnounceAddrs(){return Array.from(this.noAnnounce).map(t=>Ge(t))}}var Ry=Iy;const Ec=Q("latency-monitor:VisibilityChangeEmitter");var ky=class extends St{constructor(){super();if(typeof document=="undefined"){Ec('This is not a browser, no "document" found. Stopping.');return}this._initializeVisibilityVarNames(),this._addVisibilityChangeListener()}_initializeVisibilityVarNames(){let e,r;typeof document.hidden!="undefined"?(e="hidden",r="visibilitychange"):typeof document.mozHidden!="undefined"?(e="mozHidden",r="mozvisibilitychange"):typeof document.msHidden!="undefined"?(e="msHidden",r="msvisibilitychange"):typeof document.webkitHidden!="undefined"&&(e="webkitHidden",r="webkitvisibilitychange"),this._hidden=e,this._visibilityChange=r}_addVisibilityChangeListener(){typeof document.addEventListener=="undefined"||typeof document[this._hidden]=="undefined"?Ec("Checking page visibility requires a browser that supports the Page Visibility API."):document.addEventListener(this._visibilityChange,this._handleVisibilityChange.bind(this),!1)}isVisible(){return this._hidden===void 0||document[this._hidden]===void 0?void 0:!document[this._hidden]}_handleVisibilityChange(){const e=!document[this._hidden];Ec(e?"Page Visible":"Page Hidden"),this.emit("visibilityChange",e)}};const Qr=Q("latency-monitor:LatencyMonitor");class Py extends St{constructor({latencyCheckIntervalMs:t,dataEmitIntervalMs:e,asyncTestFn:r,latencyRandomPercentage:n}={}){super();const i=this;i.latencyCheckIntervalMs=t||500,i.latencyRandomPercentage=n||10,i._latecyCheckMultiply=2*(i.latencyRandomPercentage/100)*i.latencyCheckIntervalMs,i._latecyCheckSubtract=i._latecyCheckMultiply/2,i.dataEmitIntervalMs=e===null||e===0?void 0:e||5*1e3,Qr("latencyCheckIntervalMs: %s dataEmitIntervalMs: %s",i.latencyCheckIntervalMs,i.dataEmitIntervalMs),i.dataEmitIntervalMs?Qr("Expecting ~%s events per summary",i.latencyCheckIntervalMs/i.dataEmitIntervalMs):Qr("Not emitting summaries"),i.asyncTestFn=r,ri.process&&ri.process.hrtime?(Qr("Using process.hrtime for timing"),i.now=ri.process.hrtime,i.getDeltaMS=s=>{const a=i.now(s);return a[0]*1e3+a[1]/1e6}):typeof window!="undefined"&&window.performance&&window.performance.now?(Qr("Using performance.now for timing"),i.now=window.performance.now.bind(window.performance),i.getDeltaMS=s=>Math.round(i.now()-s)):(Qr("Using Date.now for timing"),i.now=Date.now,i.getDeltaMS=s=>i.now()-s),i._latencyData=i._initLatencyData(),Ny()&&(i._visibilityChangeEmitter=new ky,i._visibilityChangeEmitter.on("visibilityChange",s=>{s?i._startTimers():(i._emitSummary(),i._stopTimers())})),(!i._visibilityChangeEmitter||i._visibilityChangeEmitter.isVisible())&&i._startTimers()}_startTimers(){if(this._checkLatencyID)return;this._checkLatency(),this.dataEmitIntervalMs&&(this._emitIntervalID=setInterval(()=>this._emitSummary(),this.dataEmitIntervalMs),typeof this._emitIntervalID.unref=="function"&&this._emitIntervalID.unref())}_stopTimers(){this._checkLatencyID&&(clearTimeout(this._checkLatencyID),this._checkLatencyID=void 0),this._emitIntervalID&&(clearInterval(this._emitIntervalID),this._emitIntervalID=void 0)}_emitSummary(){const t=this.getSummary();t.events>0&&this.emit("data",t)}getSummary(){const t={events:this._latencyData.events,minMs:this._latencyData.minMs,maxMs:this._latencyData.maxMs,avgMs:this._latencyData.events?this._latencyData.totalMs/this._latencyData.events:Number.POSITIVE_INFINITY,lengthMs:this.getDeltaMS(this._latencyData.startTime)};return this._latencyData=this._initLatencyData(),Qr("Summary: %O",t),t}_checkLatency(){const t=this,e=Math.random()*t._latecyCheckMultiply-t._latecyCheckSubtract,r={deltaOffset:Math.ceil(t.latencyCheckIntervalMs+e),startTime:t.now()},n=()=>{if(!this._checkLatencyID)return;const i=t.getDeltaMS(r.startTime)-r.deltaOffset;t._checkLatency(),t._latencyData.events++,t._latencyData.minMs=Math.min(t._latencyData.minMs,i),t._latencyData.maxMs=Math.max(t._latencyData.maxMs,i),t._latencyData.totalMs+=i,Qr("MS: %s Data: %O",i,t._latencyData)};Qr("localData: %O",r),this._checkLatencyID=setTimeout(()=>{t.asyncTestFn?(r.deltaOffset=0,r.startTime=t.now(),t.asyncTestFn(n)):(r.deltaOffset-=1,n())},r.deltaOffset),typeof this._checkLatencyID.unref=="function"&&this._checkLatencyID.unref()}_initLatencyData(){return{startTime:this.now(),minMs:Number.POSITIVE_INFINITY,maxMs:Number.NEGATIVE_INFINITY,events:0,totalMs:0}}}function Ny(){return typeof window!="undefined"}var Oy=Py,Sc=function(){return Date.now()};function Tc(t,e,r){var n=this;this._started=Sc(),this._rescheduled=0,this._scheduled=e,this._args=r,this._timer=setTimeout(i,e);function i(){n._rescheduled>0?(n._scheduled=n._rescheduled-(Sc()-n._started),n._timer=setTimeout(i,n._scheduled),n._rescheduled=0):t.apply(null,n._args)}}Tc.prototype.reschedule=function(t){var e=Sc();return e+t-(this._started+this._scheduled)<0?!1:(this._started=e,this._rescheduled=t,!0)},Tc.prototype.clear=function(){clearTimeout(this._timer)};function My(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("timeout needed");var t;if(arguments.length>0){t=new Array(arguments.length-2);for(var e=0;e<t.length;e++)t[e]=arguments[e+2]}return new Tc(arguments[0],arguments[1],t)}var ni=My;const ir=Q("libp2p:connection-manager");ir.error=Q("libp2p:connection-manager:error");const{EventEmitter:Dy}=St,{ERR_INVALID_PARAMETERS:kd}=dt,xy={maxConnections:Infinity,minConnections:0,maxData:Infinity,maxSentData:Infinity,maxReceivedData:Infinity,maxEventLoopDelay:Infinity,pollInterval:2e3,autoDialInterval:1e4,movingAverageInterval:6e4,defaultPeerValue:1};class jy extends Dy{constructor(t,e){super();if(this._libp2p=t,this._peerId=t.peerId.toB58String(),this._options=Wa.call({ignoreUndefined:!0},xy,e),this._options.maxConnections<this._options.minConnections)throw U(new Error("Connection Manager maxConnections must be greater than minConnections"),kd);ir("options: %j",this._options),this._libp2p=t,this._peerValues=new Map,this.connections=new Map,this._started=!1,this._timer=null,this._autoDialTimeout=null,this._checkMetrics=this._checkMetrics.bind(this),this._autoDial=this._autoDial.bind(this)}get size(){return Array.from(this.connections.values()).reduce((t,e)=>t+e.length,0)}start(){this._libp2p.metrics&&(this._timer=this._timer||ni(this._checkMetrics,this._options.pollInterval)),this._latencyMonitor=new Oy({latencyCheckIntervalMs:this._options.pollInterval,dataEmitIntervalMs:this._options.pollInterval}),this._onLatencyMeasure=this._onLatencyMeasure.bind(this),this._latencyMonitor.on("data",this._onLatencyMeasure),this._started=!0,ir("started"),this._options.autoDial&&this._autoDial()}async stop(){this._autoDialTimeout&&this._autoDialTimeout.clear(),this._timer&&this._timer.clear(),this._latencyMonitor&&this._latencyMonitor.removeListener("data",this._onLatencyMeasure),this._started=!1,await this._close(),ir("stopped")}async _close(){const t=[];for(const e of this.connections.values())for(const r of e)t.push(r.close());await t,this.connections.clear()}setPeerValue(t,e){if(e<0||e>1)throw new Error("value should be a number between 0 and 1");t.toB58String&&(t=t.toB58String()),this._peerValues.set(t,e)}_checkMetrics(){const t=this._libp2p.metrics.global.movingAverages,e=t.dataReceived[this._options.movingAverageInterval].movingAverage();this._checkMaxLimit("maxReceivedData",e);const r=t.dataSent[this._options.movingAverageInterval].movingAverage();this._checkMaxLimit("maxSentData",r);const n=e+r;this._checkMaxLimit("maxData",n),ir("metrics update",n),this._timer=ni(this._checkMetrics,this._options.pollInterval)}onConnect(t){const e=t.remotePeer,r=e.toB58String(),n=this.connections.get(r);this.emit("peer:connect",t),n?n.push(t):this.connections.set(r,[t]),this._libp2p.peerStore.keyBook.set(e,e.pubKey),this._peerValues.has(r)||this._peerValues.set(r,this._options.defaultPeerValue),this._checkMaxLimit("maxConnections",this.size)}onDisconnect(t){const e=t.remotePeer.toB58String();let r=this.connections.get(e);r&&r.length>1?(r=r.filter(n=>n.id!==t.id),this.connections.set(e,r)):r&&(this.connections.delete(e),this._peerValues.delete(t.remotePeer.toB58String()),this.emit("peer:disconnect",t))}get(t){const e=this.getAll(t);return e.length?e[0]:null}getAll(t){if(!be.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),kd);const e=t.toB58String(),r=this.connections.get(e);return r?r.filter(n=>n.stat.status==="open"):[]}_onLatencyMeasure(t){this._checkMaxLimit("maxEventLoopDelay",t.avgMs)}_checkMaxLimit(t,e){const r=this._options[t];ir("checking limit of %s. current value: %d of %d",t,e,r),e>r&&(ir("%s: limit exceeded: %s, %d",this._peerId,t,e),this._maybeDisconnectOne())}async _autoDial(){const t=this._options.minConnections;if(this.size>=t){this._autoDialTimeout=ni(this._autoDial,this._options.autoDialInterval);return}const e=Array.from(this._libp2p.peerStore.peers.values()).sort((r,n)=>n.protocols&&n.protocols.length&&(!r.protocols||!r.protocols.length)||n.id.pubKey&&!r.id.pubKey?1:-1);for(let r=0;r<e.length&&this.size<t;r++)if(!this.get(e[r].id)){ir("connecting to a peerStore stored peer %s",e[r].id.toB58String());try{if(await this._libp2p.dialer.connectToPeer(e[r].id),!this._started)return}catch(n){ir.error("could not connect to peerStore stored peer",n)}}this._autoDialTimeout=ni(this._autoDial,this._options.autoDialInterval)}_maybeDisconnectOne(){if(this._options.minConnections<this.connections.size){const t=Array.from(this._peerValues).sort(By);ir("%s: sorted peer values: %j",this._peerId,t);const e=t[0];if(e){const r=e[0];ir("%s: lowest value peer is %s",this._peerId,r),ir("%s: closing a connection to %j",this._peerId,r);for(const n of this.connections.values())if(n[0].remotePeer.toB58String()===r){n[0].close();break}}}}}var Ly=jy;function By(t,e){return t[1]-e[1]}const Pd=he("dns4"),Nd=he("dns6"),$i=bt(he("dns"),he("dnsaddr"),Pd,Nd),ra=bt(he("ip4"),he("ip6")),qi=bt(Se(ra,he("tcp")),Se($i,he("tcp"))),Od=Se(ra,he("udp")),Md=Se(Od,he("utp")),Vi=bt(Se(qi,he("ws")),Se($i,he("ws"))),Gi=bt(Se(qi,he("wss")),Se($i,he("wss"))),Ac=bt(Se(qi,he("http")),Se(ra,he("http")),Se($i,he("http"))),Cc=bt(Se(qi,he("https")),Se(ra,he("https")),Se($i,he("https"))),Ic=bt(Se(Vi,he("p2p-webrtc-star"),he("p2p")),Se(Gi,he("p2p-webrtc-star"),he("p2p")),Se(Vi,he("p2p-webrtc-star")),Se(Gi,he("p2p-webrtc-star"))),Uy=bt(Se(Vi,he("p2p-websocket-star"),he("p2p")),Se(Gi,he("p2p-websocket-star"),he("p2p")),Se(Vi,he("p2p-websocket-star")),Se(Gi,he("p2p-websocket-star"))),Dd=bt(Se(Ac,he("p2p-webrtc-direct")),Se(Cc,he("p2p-webrtc-direct"))),zi=bt(Vi,Gi,Ac,Cc,Ic,Dd,qi,Md),Fy=bt(Se(zi,he("p2p-stardust"),he("p2p")),Se(zi,he("p2p-stardust"))),Cn=bt(Se(zi,he("p2p")),Ic,he("p2p")),xd=bt(Se(Cn,he("p2p-circuit"),Cn),Se(Cn,he("p2p-circuit")),Se(he("p2p-circuit"),Cn),Se(zi,he("p2p-circuit")),Se(he("p2p-circuit"),zi),he("p2p-circuit")),jd=()=>bt(Se(xd,jd),xd),Hi=jd(),Ld=bt(Se(Hi,Cn,Hi),Se(Cn,Hi),Se(Hi,Cn),Hi,Cn);var $y=$i,qy=Pd,Vy=Nd,Gy=ra,zy=qi,Hy=Od,Wy=Md,Ky=Ac,Xy=Cc,Qy=Vi,Yy=Gi,Jy=Uy,Zy=Ic,ev=Dd,tv=zi,rv=Fy,nv=Hi,iv=Ld,sv=Ld;function Bd(t){return function(r){if(!At.isMultiaddr(r))try{r=At(r)}catch(i){return!1}const n=t(r.protoNames());return n===null?!1:n.length===0}}function Se(){const t=Array.from(arguments);function e(r){return r.length<t.length?null:(t.some(n=>{if(r=typeof n=="function"?n().partialMatch(r):n.partialMatch(r),r===null)return!0}),r)}return{toString:function(){return"{ "+t.join(" ")+" }"},input:t,matches:Bd(e),partialMatch:e}}function bt(){const t=Array.from(arguments);function e(n){let i=null;return t.some(s=>{const a=typeof s=="function"?s().partialMatch(n):s.partialMatch(n);if(a)return i=a,!0}),i}const r={toString:function(){return"{ "+t.join(" ")+" }"},input:t,matches:Bd(e),partialMatch:e};return r}function he(t){const e=t;function r(i){if(typeof i=="string")try{i=At(i)}catch(a){return!1}const s=i.protoNames();return s.length===1&&s[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:r,partialMatch:n}}var Rc={DNS:$y,DNS4:qy,DNS6:Vy,IP:Gy,TCP:zy,UDP:Hy,UTP:Wy,HTTP:Ky,HTTPS:Xy,WebSockets:Qy,WebSocketsSecure:Yy,WebSocketStar:Jy,WebRTCStar:Zy,WebRTCDirect:ev,Reliable:tv,Stardust:rv,Circuit:nv,P2P:iv,IPFS:sv},na=Mr(`
message CircuitRelay {

  enum Status {
    SUCCESS                    = 100;
    HOP_SRC_ADDR_TOO_LONG      = 220;
    HOP_DST_ADDR_TOO_LONG      = 221;
    HOP_SRC_MULTIADDR_INVALID  = 250;
    HOP_DST_MULTIADDR_INVALID  = 251;
    HOP_NO_CONN_TO_DST         = 260;
    HOP_CANT_DIAL_DST          = 261;
    HOP_CANT_OPEN_DST_STREAM   = 262;
    HOP_CANT_SPEAK_RELAY       = 270;
    HOP_CANT_RELAY_TO_SELF     = 280;
    STOP_SRC_ADDR_TOO_LONG     = 320;
    STOP_DST_ADDR_TOO_LONG     = 321;
    STOP_SRC_MULTIADDR_INVALID = 350;
    STOP_DST_MULTIADDR_INVALID = 351;
    STOP_RELAY_REFUSED         = 390;
    MALFORMED_MESSAGE          = 400;
  }

  enum Type { // RPC identifier, either HOP, STOP or STATUS
    HOP = 1;
    STOP = 2;
    STATUS = 3;
    CAN_HOP = 4;
  }

  message Peer {
    required bytes id = 1;    // peer id
    repeated bytes addrs = 2; // peer's known addresses
  }

  optional Type type = 1;     // Type of the message

  optional Peer srcPeer = 2;  // srcPeer and dstPeer are used when Type is HOP or STATUS
  optional Peer dstPeer = 3;

  optional Status code = 4;   // Status code, used when Type is STATUS
}
`),kc=function(e){if(e){if(typeof e[Symbol.iterator]=="function")return e[Symbol.iterator]();if(typeof e[Symbol.asyncIterator]=="function")return e[Symbol.asyncIterator]();if(typeof e.next=="function")return e}throw new Error("argument is not an iterator or iterable")},Pc=class extends Error{constructor(e,r){super(e||"The operation was aborted");this.type="aborted",this.code=r||"ABORT_ERR"}};const Ud=(t,e,r)=>Nc(t,Array.isArray(e)?e:[{signal:e,options:r}]),Nc=(t,e)=>{t=kc(t),e=e.map(({signal:n,options:i})=>({signal:n,options:i||{}}));async function*r(){let n;const i=()=>{n&&n()};for(const{signal:s}of e)s.addEventListener("abort",i);for(;;){let s;try{for(const{signal:c,options:o}of e)if(c.aborted){const{abortMessage:l,abortCode:u}=o;throw new Pc(l,u)}const a=new Promise((c,o)=>{n=()=>{const{options:l}=e.find(({signal:f})=>f.aborted),{abortMessage:u,abortCode:h}=l;o(new Pc(u,h))}});s=await Promise.race([a,t.next()]),n=null}catch(a){for(const{signal:l}of e)l.removeEventListener("abort",i);const c=e.find(({signal:l})=>l.aborted),o=a.type==="aborted"&&c;if(o&&c.options.onAbort&&await c.options.onAbort(t),typeof t.return=="function"&&await t.return(),o&&c.options.returnOnAbort)return;throw a}if(s.done)break;yield s.value}for(const{signal:s}of e)s.removeEventListener("abort",i)}return r()},Fd=(t,e,r)=>$d(t,Array.isArray(e)?e:[{signal:e,options:r}]),$d=(t,e)=>r=>t(Nc(r,e)),av=(t,e,r)=>ov(t,Array.isArray(e)?e:[{signal:e,options:r}]),ov=(t,e)=>({sink:$d(t.sink,e),source:Nc(t.source,e)});var rt=Ud,cv=Pc,lv=Ud,uv=Fd,dv=Fd,hv=av;rt.AbortError=cv,rt.source=lv,rt.sink=uv,rt.transform=dv,rt.duplex=hv;const pv=Q("libp2p:stream:converter");function fv({stream:t,remoteAddr:e,localAddr:r},n={}){const{sink:i,source:s}=t,a={async sink(o){n.signal&&(o=rt(o,n.signal));try{await i(o)}catch(l){l.type!=="aborted"&&pv(l)}c()},source:n.signal?rt(s,n.signal):s,conn:t,localAddr:r,remoteAddr:e,timeline:{open:Date.now()},close(){i([]),c()}};function c(){a.timeline.close||(a.timeline.close=Date.now())}return a}var qd=fv,Oc={relay:"/libp2p/circuit/relay/0.1.0"};const mv=Q("libp2p:circuit:listener");mv.err=Q("libp2p:circuit:error:listener");var gv=t=>{const e=new St,r=new Map;return e.listen=async n=>{const i=String(n).split("/p2p-circuit").find(c=>c!==""),s=await t._dialer.connectToPeer(Ge(i)),a=s.remoteAddr.encapsulate("/p2p-circuit");r.set(s.remotePeer.toB58String(),a),e.emit("listening")},e.close=()=>{},e.getAddrs=()=>{const n=[];for(const i of r.values())n.push(i);return n},e};const{CircuitRelay:ii}=na;function Vd(t,e){t.write({type:ii.Type.STATUS,code:e})}function bv(t,e){try{t.dstPeer.addrs.forEach(r=>Ge(r))}catch(r){throw Vd(e,t.type===ii.Type.HOP?ii.Status.HOP_DST_MULTIADDR_INVALID:ii.Status.STOP_DST_MULTIADDR_INVALID),r}try{t.srcPeer.addrs.forEach(r=>Ge(r))}catch(r){throw Vd(e,t.type===ii.Type.HOP?ii.Status.HOP_SRC_MULTIADDR_INVALID:ii.Status.STOP_SRC_MULTIADDR_INVALID),r}}var Gd={validateAddrs:bv},zd=t=>{const e=async function*(){let r=yield,n=new ut;for await(const i of t){if(!r){r=yield n.append(i),n=new ut;continue}for(n.append(i);n.length>=r;){const s=n.shallowSlice(0,r);if(n.consume(r),r=yield s,!r){n.length&&(r=yield n,n=new ut);break}}}if(r)throw Object.assign(new Error(`stream ended before ${r} bytes became available`),{code:"ERR_UNDER_READ",buffer:n})}();return e.next(),e},Hd=class{constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];return e===void 0?void 0:(this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e)}isEmpty(){return this.buffer[this.btm]===void 0}},ia=class{constructor(e){this.hwm=e||16,this.head=new Hd(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){const r=this.head;this.head=r.next=new Hd(2*this.head.buffer.length),this.head.push(e)}}shift(){const e=this.tail.shift();if(e===void 0&&this.tail.next){const r=this.tail.next;return this.tail.next=null,this.tail=r,this.tail.shift()}return e}isEmpty(){return this.head.isEmpty()}},eo=t=>{t=t||{};let e;typeof t=="function"?(e=t,t={}):e=t.onEnd;let r=new ia,n,i,s;const a=()=>{if(!r.isEmpty()){if(t.writev){let M;const I=[];for(;!r.isEmpty();){if(M=r.shift(),M.error)throw M.error;I.push(M.value)}return{done:M.done,value:I}}const S=r.shift();if(S.error)throw S.error;return S}return s?{done:!0}:new Promise((S,M)=>{i=I=>(i=null,I.error?M(I.error):t.writev&&!I.done?S({done:I.done,value:[I.value]}):S(I),n)})},c=S=>i?i(S):(r.push(S),n),o=S=>(r=new ia,i?i({error:S}):(r.push({error:S}),n)),l=S=>s?n:c({done:!1,value:S}),u=S=>s?n:(s=!0,S?o(S):c({done:!0})),h=()=>(r=new ia,u(),{done:!0}),f=S=>(u(S),{done:!0});if(n={[Symbol.asyncIterator](){return this},next:a,return:h,throw:f,push:l,end:u},!e)return n;const p=n;return n={[Symbol.asyncIterator](){return this},next(){return p.next()},throw(S){return p.throw(S),e&&(e(S),e=null),{done:!0}},return(){return p.return(),e&&(e(),e=null),{done:!0}},push:l,end(S){return p.end(S),e&&(e(S),e=null),n}},n};const yv=()=>{const t={};return t.promise=new Promise((e,r)=>{t.resolve=e,t.reject=r}),t};var to=yv,sa=t=>{const e=eo(),r=zd(t.source),n=to();let i;const s=t.sink(async function*(){yield*e;const c=await n.promise;yield*c}());s.catch(c=>{i=c});const a={sink:c=>i?Promise.reject(i):(n.resolve(c),s),source:r};return{reader:r,writer:e,stream:a,rest:()=>e.end(),write:e.push,read:async()=>(await r.next()).value}};const{CircuitRelay:Wd}=na,aa=Q("libp2p:circuit:stream-handler");aa.error=Q("libp2p:circuit:stream-handler:error");class vv{constructor({stream:t,maxLength:e=4096}){this.stream=t,this.shake=sa(this.stream),this.decoder=Je.decode.fromReader(this.shake.reader,{maxDataLength:e})}async read(){const t=await this.decoder.next();if(t.value){const e=Wd.decode(t.value.slice());return aa("read message type",e.type),e}aa("read received no value, closing stream"),this.close()}write(t){aa("write message type %s",t.type),this.shake.write(Je.encode.single(Wd.encode(t)))}rest(){return this.shake.rest(),this.shake.stream}end(t){this.write(t),this.close()}close(){aa("closing the stream"),this.rest().sink([])}}var Mc=vv;const{CircuitRelay:Dc}=na,{validateAddrs:wv}=Gd,Wi=Q("libp2p:circuit:stop");Wi.error=Q("libp2p:circuit:stop:error");var _v=function({connection:e,request:r,streamHandler:n}){try{wv(r,n)}catch(i){return Wi.error("invalid stop request via peer %s",e.remotePeer.toB58String(),i)}return Wi("stop request is valid"),n.write({type:Dc.Type.STATUS,code:Dc.Status.SUCCESS}),n.rest()},Ev=async function({connection:e,request:r}){const{stream:n}=await e.newStream([Oc.relay]);Wi("starting stop request to %s",e.remotePeer.toB58String());const i=new Mc({stream:n});i.write(r);const s=await i.read();if(s.code===Dc.Status.SUCCESS)return Wi("stop request to %s was successful",e.remotePeer.toB58String()),i.rest();Wi("stop request failed with code %d",s.code),i.close()},Kd={handleStop:_v,stop:Ev};const Yr=Q("libp2p:circuit:hop");Yr.error=Q("libp2p:circuit:hop:error");const{validateAddrs:Sv}=Gd,{CircuitRelay:vr}=na,{codes:Tv}=dt,{stop:Av}=Kd;var Cv=async function({connection:e,request:r,streamHandler:n,circuit:i}){if(!i._options.hop.enabled)return Yr("HOP request received but we are not acting as a relay"),n.end({type:vr.Type.STATUS,code:vr.Status.HOP_CANT_SPEAK_RELAY});try{Sv(r,n)}catch(u){return Yr.error("invalid hop request via peer %s",e.remotePeer.toB58String(),u)}const s=new be(r.dstPeer.id),a=i._connectionManager.get(s);if(!a&&!i._options.hop.active)return Yr("HOP request received but we are not connected to the destination peer"),n.end({type:vr.Type.STATUS,code:vr.Status.HOP_NO_CONN_TO_DST});const c={type:vr.Type.STOP,dstPeer:r.dstPeer,srcPeer:r.srcPeer};let o;try{o=await Av({connection:a,request:c,circuit:i})}catch(u){return Yr.error(u)}Yr("hop request from %s is valid",e.remotePeer.toB58String()),n.write({type:vr.Type.STATUS,code:vr.Status.SUCCESS});const l=n.rest();return gt(l,o,l)},Iv=async function({connection:e,request:r}){const{stream:n}=await e.newStream([Oc.relay]),i=new Mc({stream:n});i.write(r);const s=await i.read();if(s.code===vr.Status.SUCCESS)return Yr("hop request was successful"),i.rest();throw Yr("hop request failed with code %d, closing stream",s.code),i.close(),U(new Error(`HOP request failed with code ${s.code}`),Tv.ERR_HOP_REQUEST_FAILED)},Rv=function({connection:e,streamHandler:r,circuit:n}){const i=n._options.hop.enabled;Yr("can hop (%s) request from %s",i,e.remotePeer.toB58String()),r.end({type:vr.Type.STATUS,code:i?vr.Status.SUCCESS:vr.Status.HOP_CANT_SPEAK_RELAY})},kv={handleHop:Cv,hop:Iv,handleCanHop:Rv};const{CircuitRelay:Ki}=na,Jr=Q("libp2p:circuit");Jr.error=Q("libp2p:circuit:error");const{relay:Pv}=Oc,{handleCanHop:Nv,handleHop:Ov,hop:Mv}=kv,{handleStop:Dv}=Kd;class xv{constructor({libp2p:t,upgrader:e}){this._dialer=t.dialer,this._registrar=t.registrar,this._connectionManager=t.connectionManager,this._upgrader=e,this._options=t._config.relay,this._libp2p=t,this.peerId=t.peerId,this._registrar.handle(Pv,this._onProtocol.bind(this))}async _onProtocol({connection:t,stream:e,protocol:r}){const n=new Mc({stream:e}),i=await n.read(),s=this;let a;switch(i.type){case Ki.Type.CAN_HOP:{Jr("received CAN_HOP request from %s",t.remotePeer.toB58String()),await Nv({circuit:s,connection:t,streamHandler:n});break}case Ki.Type.HOP:{Jr("received HOP request from %s",t.remotePeer.toB58String()),a=await Ov({connection:t,request:i,streamHandler:n,circuit:s});break}case Ki.Type.STOP:{Jr("received STOP request from %s",t.remotePeer.toB58String()),a=await Dv({connection:t,request:i,streamHandler:n,circuit:s});break}default:Jr("Request of type %s not supported",i.type)}if(a){const c=Ge(i.dstPeer.addrs[0]),o=Ge(i.srcPeer.addrs[0]),l=qd({stream:a,remoteAddr:c,localAddr:o}),u=Ki.Type===Ki.Type.HOP?"relay":"inbound";Jr("new %s connection %s",u,l.remoteAddr);const h=await this._upgrader.upgradeInbound(l);Jr("%s connection %s upgraded",u,l.remoteAddr),this.handler&&this.handler(h)}}async dial(t,e){const r=t.toString().split("/p2p-circuit"),n=Ge(r[0]),i=Ge(r[r.length-1]),s=be.createFromCID(n.getPeerId()),a=be.createFromCID(i.getPeerId());let c=!1,o=this._connectionManager.get(s);o||(o=await this._dialer.connectToPeer(n,e),c=!0);try{const l=await Mv({connection:o,circuit:this,request:{type:Ki.Type.HOP,srcPeer:{id:this.peerId.toBytes(),addrs:this._libp2p.multiaddrs.map(f=>f.bytes)},dstPeer:{id:a.toBytes(),addrs:[Ge(i).bytes]}}}),u=n.encapsulate(`/p2p-circuit/p2p/${this.peerId.toB58String()}`),h=qd({stream:l,remoteAddr:t,localAddr:u});return Jr("new outbound connection %s",h.remoteAddr),this._upgrader.upgradeOutbound(h)}catch(l){throw Jr.error("Circuit relay dial failed",l),c&&await o.close(),l}}createListener(t,e){return typeof t=="function"&&(e=t,t={}),this.handler=e,gv(this)}filter(t){return t=Array.isArray(t)?t:[t],t.filter(e=>Rc.Circuit.matches(e))}}var Xd=Ht(xv,{className:"Circuit",symbolName:"@libp2p/js-libp2p-circuit/circuit"});const{AbortController:jv}=typeof self!="undefined"?self:typeof window!="undefined"?window:Js;class xc extends jv{constructor(t){super();this._ms=t,this._timer=ni(()=>this.abort(),t),Object.setPrototypeOf(this,xc.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=ni(()=>this.abort(),this._ms)}}var Qd=xc,Lv=xc;Qd.TimeoutController=Lv;var Bv=AbortController;function Yd(t){const e=new Bv;function r(){e.abort();for(const n of t){if(!n||!n.removeEventListener)continue;n.removeEventListener("abort",r)}}for(const n of t){if(!n||!n.addEventListener)continue;if(n.aborted){r();break}n.addEventListener("abort",r)}return e.signal}var jc=Yd,Uv=Yd;jc.anySignal=Uv;var Fv=class{constructor(){this._buffer=new ia,this._waitingConsumers=new ia}push(e){const{promise:r,resolve:n}=to();return this._buffer.push({chunk:e,resolve:n}),this._consume(),r}_consume(){for(;!this._waitingConsumers.isEmpty()&&!this._buffer.isEmpty();){const e=this._waitingConsumers.shift(),r=this._buffer.shift();e.resolve(r.chunk),r.resolve()}}shift(){const{promise:e,resolve:r}=to();return this._waitingConsumers.push({resolve:r}),this._consume(),e}isEmpty(){return this._buffer.isEmpty()}};const $v=Q("libp2p:dialer:request");$v.error=Q("libp2p:dialer:request:error");class qv{constructor({addrs:t,dialAction:e,dialer:r}){this.addrs=t,this.dialer=r,this.dialAction=e}async run(t){const e=this.dialer.getTokens(this.addrs.length);if(e.length<1)throw U(new Error("No dial tokens available"),"ERR_NO_DIAL_TOKENS");const r=new Fv;e.forEach(s=>r.push(s));const n=this.addrs.map(()=>new Js);let i=0;try{return await $a(this.addrs.map(async(s,a)=>{const c=await r.shift();let o;try{const l=n[a].signal;o=await this.dialAction(s,{...t,signal:jc([l,t.signal])}),n.splice(a,1)}finally{i++,this.addrs.length-i>=e.length?r.push(c):this.dialer.releaseToken(e.splice(e.indexOf(c),1)[0])}return o}))}finally{n.map(s=>s.abort()),e.forEach(s=>this.dialer.releaseToken(s))}}}var Vv=qv,Gv={DialRequest:Vv};const si=Q("libp2p:dialer");si.error=Q("libp2p:dialer:error");const{DialRequest:zv}=Gv,{codes:Lc}=dt,{DIAL_TIMEOUT:Hv,MAX_PARALLEL_DIALS:Wv,MAX_PER_PEER_DIALS:Kv}=ta;class Xv{constructor({transportManager:t,peerStore:e,concurrency:r=Wv,timeout:n=Hv,perPeerLimit:i=Kv,resolvers:s={}}){this.transportManager=t,this.peerStore=e,this.concurrency=r,this.timeout=n,this.perPeerLimit=i,this.tokens=[...new Array(r)].map((a,c)=>c),this._pendingDials=new Map;for(const[a,c]of Object.entries(s))Ge.resolvers.set(a,c)}destroy(){for(const t of this._pendingDials.values())try{t.controller.abort()}catch(e){si.error(e)}this._pendingDials.clear()}async connectToPeer(t,e={}){const r=await this._createDialTarget(t);if(!r.addrs.length)throw U(new Error("The dial request has no addresses"),Lc.ERR_NO_VALID_ADDRESSES);const n=this._pendingDials.get(r.id)||this._createPendingDial(r,e);try{const i=await n.promise;return si("dial succeeded to %s",r.id),i}catch(i){throw n.controller.signal.aborted&&(i.code=Lc.ERR_TIMEOUT),si.error(i),i}finally{n.destroy()}}async _createDialTarget(t){const{id:e,multiaddrs:r}=Ga(t);r&&this.peerStore.addressBook.add(e,r);let n=this.peerStore.addressBook.getMultiaddrsForPeer(e)||[];Ge.isMultiaddr(t)&&(n=n.filter(s=>!t.equals(s)),n.unshift(t));const i=[];for(const s of n){const a=await this._resolve(s);a.forEach(c=>i.push(c))}return{id:e.toB58String(),addrs:i}}_createPendingDial(t,e){const r=(o,l)=>{if(l.signal.aborted)throw U(new Error("already aborted"),Lc.ERR_ALREADY_ABORTED);return this.transportManager.dial(o,l)},n=new zv({addrs:t.addrs,dialAction:r,dialer:this}),i=new Qd(this.timeout),s=[i.signal];e.signal&&s.push(e.signal);const a=jc(s),c={dialRequest:n,controller:i,promise:n.run({...e,signal:a}),destroy:()=>{i.clear(),this._pendingDials.delete(t.id)}};return this._pendingDials.set(t.id,c),c}getTokens(t){const e=Math.min(t,this.perPeerLimit,this.tokens.length),r=this.tokens.splice(0,e);return si("%d tokens request, returning %d, %d remaining",t,e,this.tokens.length),r}releaseToken(t){if(this.tokens.indexOf(t)>-1)return;si("token %d released",t),this.tokens.push(t)}async _resolve(t){const e=t.protoNames().includes("dnsaddr");if(!e)return[t];const r=await this._resolveRecord(t),n=await Promise.all(r.map(i=>this._resolve(i)));return n.flat().reduce((i,s)=>(i.find(a=>a.equals(s))||i.push(s),i),[])}async _resolveRecord(t){try{t=Ge(t.toString());const e=await t.resolve();return e}catch(e){return si.error(`multiaddr ${t} could not be resolved`),[]}}}var Qv=Xv;function Yv(t){return t>=55296&&t<=56319}function Jv(t){return t>=56320&&t<=57343}var Zv=function(e,r,n){if(typeof r!="string")throw new Error("Input must be string");for(var i=r.length,s=0,a,c,o=0;o<i;o+=1){if(a=r.charCodeAt(o),c=r[o],Yv(a)&&Jv(r.charCodeAt(o+1))&&(o+=1,c+=r[o]),s+=e(c),s===n)return r.slice(0,o+1);if(s>n)return r.slice(0,o-c.length+1)}return r};function e0(t){return t>=55296&&t<=56319}function t0(t){return t>=56320&&t<=57343}var r0=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var r=e.length,n=0,i=null,s=null,a=0;a<r;a++)i=e.charCodeAt(a),t0(i)?s!=null&&e0(s)?n+=1:n+=3:i<=127?n+=1:i>=128&&i<=2047?n+=2:i>=2048&&i<=65535&&(n+=3),s=i;return n},n0=Zv.bind(null,r0),i0=/[\/\?<>\\:\*\|"]/g,s0=/[\x00-\x1f\x80-\x9f]/g,a0=/^\.+$/,o0=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,c0=/[\. ]+$/;function Jd(t,e){if(typeof t!="string")throw new Error("Input must be string");var r=t.replace(i0,e).replace(s0,e).replace(a0,e).replace(o0,e).replace(c0,e);return n0(r,255)}var l0=function(t,e){var r=e&&e.replacement||"",n=Jd(t,r);return r===""?n:Jd(n,"")},BP=te(function(t){var e=B.asn1,r=t.exports=B.pkcs7asn1=B.pkcs7asn1||{};B.pkcs7=B.pkcs7||{},B.pkcs7.asn1=r;var n={name:"ContentInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};r.contentInfoValidator=n;var i={name:"EncryptedContentInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:e.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};r.envelopedDataValidator={name:"EnvelopedData",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(i)},r.encryptedDataValidator={name:"EncryptedData",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"}].concat(i)};var s={name:"SignerInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:e.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};r.signedDataValidator={name:"SignedData",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},n,{name:"SignedData.Certificates",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,capture:"signerInfos",optional:!0,value:[s]}]},r.recipientInfoValidator={name:"RecipientInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:e.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter"}]},{name:"RecipientInfo.encryptedKey",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}}),UP=te(function(t){B.mgf=B.mgf||{};var e=t.exports=B.mgf.mgf1=B.mgf1=B.mgf1||{};e.create=function(r){var n={generate:function(i,s){for(var a=new B.util.ByteBuffer,c=Math.ceil(s/r.digestLength),o=0;o<c;o++){var l=new B.util.ByteBuffer;l.putInt32(o),r.start(),r.update(i+l.getBytes()),a.putBuffer(r.digest())}return a.truncate(a.length()-s),a.getBytes()}};return n}}),FP=B.mgf=B.mgf||{};B.mgf.mgf1=B.mgf1;var $P=te(function(t){var e=t.exports=B.pss=B.pss||{};e.create=function(r){arguments.length===3&&(r={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var n=r.md,i=r.mgf,s=n.digestLength,a=r.salt||null;typeof a=="string"&&(a=B.util.createBuffer(a));var c;if("saltLength"in r)c=r.saltLength;else if(a!==null)c=a.length();else throw new Error("Salt length not specified or specific salt not given.");if(a!==null&&a.length()!==c)throw new Error("Given salt length does not match length of given salt.");var o=r.prng||B.random,l={};return l.encode=function(u,h){var f,p=h-1,S=Math.ceil(p/8),M=u.digest().getBytes();if(S<s+c+2)throw new Error("Message is too long to encrypt.");var I;a===null?I=o.getBytesSync(c):I=a.bytes();var k=new B.util.ByteBuffer;k.fillWithByte(0,8),k.putBytes(M),k.putBytes(I),n.start(),n.update(k.getBytes());var V=n.digest().getBytes(),z=new B.util.ByteBuffer;z.fillWithByte(0,S-c-s-2),z.putByte(1),z.putBytes(I);var v=z.getBytes(),_=S-s-1,A=i.generate(V,_),d="";for(f=0;f<_;f++)d+=String.fromCharCode(v.charCodeAt(f)^A.charCodeAt(f));var g=65280>>8*S-p&255;return d=String.fromCharCode(d.charCodeAt(0)&~g)+d.substr(1),d+V+String.fromCharCode(188)},l.verify=function(u,h,f){var p,S=f-1,M=Math.ceil(S/8);if(h=h.substr(-M),M<s+c+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(h.charCodeAt(M-1)!==188)throw new Error("Encoded message does not end in 0xBC.");var I=M-s-1,k=h.substr(0,I),V=h.substr(I,s),z=65280>>8*M-S&255;if((k.charCodeAt(0)&z)!==0)throw new Error("Bits beyond keysize not zero as expected.");var v=i.generate(V,I),_="";for(p=0;p<I;p++)_+=String.fromCharCode(k.charCodeAt(p)^v.charCodeAt(p));_=String.fromCharCode(_.charCodeAt(0)&~z)+_.substr(1);var A=M-s-c-2;for(p=0;p<A;p++)if(_.charCodeAt(p)!==0)throw new Error("Leftmost octets not zero as expected");if(_.charCodeAt(A)!==1)throw new Error("Inconsistent PSS signature, 0x01 marker not found");var d=_.substr(-c),g=new B.util.ByteBuffer;g.fillWithByte(0,8),g.putBytes(u),g.putBytes(d),n.start(),n.update(g.getBytes());var E=n.digest().getBytes();return V===E},l}}),qP=te(function(t){var e=B.asn1,r=t.exports=B.pki=B.pki||{},n=r.oids,i={};i.CN=n.commonName,i.commonName="CN",i.C=n.countryName,i.countryName="C",i.L=n.localityName,i.localityName="L",i.ST=n.stateOrProvinceName,i.stateOrProvinceName="ST",i.O=n.organizationName,i.organizationName="O",i.OU=n.organizationalUnitName,i.organizationalUnitName="OU",i.E=n.emailAddress,i.emailAddress="E";var s=B.pki.rsa.publicKeyValidator,a={name:"Certificate",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:e.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:e.Class.UNIVERSAL,type:e.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:e.Class.UNIVERSAL,type:e.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:e.Class.UNIVERSAL,type:e.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:e.Class.UNIVERSAL,type:e.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},s,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:e.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:e.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:e.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},c={name:"rsapss",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:e.Class.UNIVERSAL,type:e.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:e.Class.UNIVERSAL,type:e.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:e.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:e.Class.UNIVERSAL,type:e.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:e.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:e.Class.UNIVERSAL,type:e.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},o={name:"CertificationRequestInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},s,{name:"CertificationRequestInfo.attributes",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,constructed:!0}]}]}]},l={name:"CertificationRequest",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[o,{name:"CertificationRequest.signatureAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:e.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};r.RDNAttributesAsArray=function(v,_){for(var A=[],d,g,E,b=0;b<v.value.length;++b){d=v.value[b];for(var C=0;C<d.value.length;++C)E={},g=d.value[C],E.type=e.derToOid(g.value[0].value),E.value=g.value[1].value,E.valueTagClass=g.value[1].type,E.type in n&&(E.name=n[E.type],E.name in i&&(E.shortName=i[E.name])),_&&(_.update(E.type),_.update(E.value)),A.push(E)}return A},r.CRIAttributesAsArray=function(v){for(var _=[],A=0;A<v.length;++A)for(var d=v[A],g=e.derToOid(d.value[0].value),E=d.value[1].value,b=0;b<E.length;++b){var C={};if(C.type=g,C.value=E[b].value,C.valueTagClass=E[b].type,C.type in n&&(C.name=n[C.type],C.name in i&&(C.shortName=i[C.name])),C.type===n.extensionRequest){C.extensions=[];for(var P=0;P<C.value.length;++P)C.extensions.push(r.certificateExtensionFromAsn1(C.value[P]))}_.push(C)}return _};function u(v,_){typeof _=="string"&&(_={shortName:_});for(var A=null,d,g=0;A===null&&g<v.attributes.length;++g)d=v.attributes[g],(_.type&&_.type===d.type||(_.name&&_.name===d.name||_.shortName&&_.shortName===d.shortName))&&(A=d);return A}var h=function(v,_,A){var d={};if(v!==n["RSASSA-PSS"])return d;A&&(d={hash:{algorithmOid:n.sha1},mgf:{algorithmOid:n.mgf1,hash:{algorithmOid:n.sha1}},saltLength:20});var g={},E=[];if(!e.validate(_,c,g,E)){var b=new Error("Cannot read RSASSA-PSS parameter block.");throw b.errors=E,b}return g.hashOid!==void 0&&(d.hash=d.hash||{},d.hash.algorithmOid=e.derToOid(g.hashOid)),g.maskGenOid!==void 0&&(d.mgf=d.mgf||{},d.mgf.algorithmOid=e.derToOid(g.maskGenOid),d.mgf.hash=d.mgf.hash||{},d.mgf.hash.algorithmOid=e.derToOid(g.maskGenHashOid)),g.saltLength!==void 0&&(d.saltLength=g.saltLength.charCodeAt(0)),d};r.certificateFromPem=function(v,_,A){var d=B.pem.decode(v)[0];if(d.type!=="CERTIFICATE"&&d.type!=="X509 CERTIFICATE"&&d.type!=="TRUSTED CERTIFICATE"){var g=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw g.headerType=d.type,g}if(d.procType&&d.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var E=e.fromDer(d.body,A);return r.certificateFromAsn1(E,_)},r.certificateToPem=function(v,_){var A={type:"CERTIFICATE",body:e.toDer(r.certificateToAsn1(v)).getBytes()};return B.pem.encode(A,{maxline:_})},r.publicKeyFromPem=function(v){var _=B.pem.decode(v)[0];if(_.type!=="PUBLIC KEY"&&_.type!=="RSA PUBLIC KEY"){var A=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw A.headerType=_.type,A}if(_.procType&&_.procType.type==="ENCRYPTED")throw new Error("Could not convert public key from PEM; PEM is encrypted.");var d=e.fromDer(_.body);return r.publicKeyFromAsn1(d)},r.publicKeyToPem=function(v,_){var A={type:"PUBLIC KEY",body:e.toDer(r.publicKeyToAsn1(v)).getBytes()};return B.pem.encode(A,{maxline:_})},r.publicKeyToRSAPublicKeyPem=function(v,_){var A={type:"RSA PUBLIC KEY",body:e.toDer(r.publicKeyToRSAPublicKey(v)).getBytes()};return B.pem.encode(A,{maxline:_})},r.getPublicKeyFingerprint=function(v,_){_=_||{};var A=_.md||B.md.sha1.create(),d=_.type||"RSAPublicKey",g;switch(d){case"RSAPublicKey":g=e.toDer(r.publicKeyToRSAPublicKey(v)).getBytes();break;case"SubjectPublicKeyInfo":g=e.toDer(r.publicKeyToAsn1(v)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+_.type+'".')}A.start(),A.update(g);var E=A.digest();if(_.encoding==="hex"){var b=E.toHex();return _.delimiter?b.match(/.{2}/g).join(_.delimiter):b}else{if(_.encoding==="binary")return E.getBytes();if(_.encoding)throw new Error('Unknown encoding "'+_.encoding+'".')}return E},r.certificationRequestFromPem=function(v,_,A){var d=B.pem.decode(v)[0];if(d.type!=="CERTIFICATE REQUEST"){var g=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw g.headerType=d.type,g}if(d.procType&&d.procType.type==="ENCRYPTED")throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var E=e.fromDer(d.body,A);return r.certificationRequestFromAsn1(E,_)},r.certificationRequestToPem=function(v,_){var A={type:"CERTIFICATE REQUEST",body:e.toDer(r.certificationRequestToAsn1(v)).getBytes()};return B.pem.encode(A,{maxline:_})},r.createCertificate=function(){var v={};return v.version=2,v.serialNumber="00",v.signatureOid=null,v.signature=null,v.siginfo={},v.siginfo.algorithmOid=null,v.validity={},v.validity.notBefore=new Date,v.validity.notAfter=new Date,v.issuer={},v.issuer.getField=function(_){return u(v.issuer,_)},v.issuer.addField=function(_){p([_]),v.issuer.attributes.push(_)},v.issuer.attributes=[],v.issuer.hash=null,v.subject={},v.subject.getField=function(_){return u(v.subject,_)},v.subject.addField=function(_){p([_]),v.subject.attributes.push(_)},v.subject.attributes=[],v.subject.hash=null,v.extensions=[],v.publicKey=null,v.md=null,v.setSubject=function(_,A){p(_),v.subject.attributes=_,delete v.subject.uniqueId,A&&(v.subject.uniqueId=A),v.subject.hash=null},v.setIssuer=function(_,A){p(_),v.issuer.attributes=_,delete v.issuer.uniqueId,A&&(v.issuer.uniqueId=A),v.issuer.hash=null},v.setExtensions=function(_){for(var A=0;A<_.length;++A)S(_[A],{cert:v});v.extensions=_},v.getExtension=function(_){typeof _=="string"&&(_={name:_});for(var A=null,d,g=0;A===null&&g<v.extensions.length;++g)d=v.extensions[g],(_.id&&d.id===_.id||_.name&&d.name===_.name)&&(A=d);return A},v.sign=function(_,A){v.md=A||B.md.sha1.create();var d=n[v.md.algorithm+"WithRSAEncryption"];if(!d){var g=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw g.algorithm=v.md.algorithm,g}v.signatureOid=v.siginfo.algorithmOid=d,v.tbsCertificate=r.getTBSCertificate(v);var E=e.toDer(v.tbsCertificate);v.md.update(E.getBytes()),v.signature=_.sign(v.md)},v.verify=function(_){var A=!1;if(!v.issued(_)){var d=_.issuer,g=v.subject,E=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw E.expectedIssuer=d.attributes,E.actualIssuer=g.attributes,E}var b=_.md;if(b===null){if(_.signatureOid in n){var C=n[_.signatureOid];switch(C){case"sha1WithRSAEncryption":b=B.md.sha1.create();break;case"md5WithRSAEncryption":b=B.md.md5.create();break;case"sha256WithRSAEncryption":b=B.md.sha256.create();break;case"sha384WithRSAEncryption":b=B.md.sha384.create();break;case"sha512WithRSAEncryption":b=B.md.sha512.create();break;case"RSASSA-PSS":b=B.md.sha256.create();break}}if(b===null){var E=new Error("Could not compute certificate digest. Unknown signature OID.");throw E.signatureOid=_.signatureOid,E}var P=_.tbsCertificate||r.getTBSCertificate(_),D=e.toDer(P);b.update(D.getBytes())}if(b!==null){var O;switch(_.signatureOid){case n.sha1WithRSAEncryption:O=void 0;break;case n["RSASSA-PSS"]:var x,F;if(x=n[_.signatureParameters.mgf.hash.algorithmOid],x===void 0||B.md[x]===void 0){var E=new Error("Unsupported MGF hash function.");throw E.oid=_.signatureParameters.mgf.hash.algorithmOid,E.name=x,E}if(F=n[_.signatureParameters.mgf.algorithmOid],F===void 0||B.mgf[F]===void 0){var E=new Error("Unsupported MGF function.");throw E.oid=_.signatureParameters.mgf.algorithmOid,E.name=F,E}if(F=B.mgf[F].create(B.md[x].create()),x=n[_.signatureParameters.hash.algorithmOid],x===void 0||B.md[x]===void 0)throw{message:"Unsupported RSASSA-PSS hash function.",oid:_.signatureParameters.hash.algorithmOid,name:x};O=B.pss.create(B.md[x].create(),F,_.signatureParameters.saltLength);break}A=v.publicKey.verify(b.digest().getBytes(),_.signature,O)}return A},v.isIssuer=function(_){var A=!1,d=v.issuer,g=_.subject;if(d.hash&&g.hash)A=d.hash===g.hash;else if(d.attributes.length===g.attributes.length){A=!0;for(var E,b,C=0;A&&C<d.attributes.length;++C)E=d.attributes[C],b=g.attributes[C],(E.type!==b.type||E.value!==b.value)&&(A=!1)}return A},v.issued=function(_){return _.isIssuer(v)},v.generateSubjectKeyIdentifier=function(){return r.getPublicKeyFingerprint(v.publicKey,{type:"RSAPublicKey"})},v.verifySubjectKeyIdentifier=function(){for(var _=n.subjectKeyIdentifier,A=0;A<v.extensions.length;++A){var d=v.extensions[A];if(d.id===_){var g=v.generateSubjectKeyIdentifier().getBytes();return B.util.hexToBytes(d.subjectKeyIdentifier)===g}}return!1},v},r.certificateFromAsn1=function(v,_){var A={},d=[];if(!e.validate(v,a,A,d)){var g=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw g.errors=d,g}var E=e.derToOid(A.publicKeyOid);if(E!==r.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var b=r.createCertificate();b.version=A.certVersion?A.certVersion.charCodeAt(0):0;var C=B.util.createBuffer(A.certSerialNumber);b.serialNumber=C.toHex(),b.signatureOid=B.asn1.derToOid(A.certSignatureOid),b.signatureParameters=h(b.signatureOid,A.certSignatureParams,!0),b.siginfo.algorithmOid=B.asn1.derToOid(A.certinfoSignatureOid),b.siginfo.parameters=h(b.siginfo.algorithmOid,A.certinfoSignatureParams,!1),b.signature=A.certSignature;var P=[];if(A.certValidity1UTCTime!==void 0&&P.push(e.utcTimeToDate(A.certValidity1UTCTime)),A.certValidity2GeneralizedTime!==void 0&&P.push(e.generalizedTimeToDate(A.certValidity2GeneralizedTime)),A.certValidity3UTCTime!==void 0&&P.push(e.utcTimeToDate(A.certValidity3UTCTime)),A.certValidity4GeneralizedTime!==void 0&&P.push(e.generalizedTimeToDate(A.certValidity4GeneralizedTime)),P.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(P.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(b.validity.notBefore=P[0],b.validity.notAfter=P[1],b.tbsCertificate=A.tbsCertificate,_){if(b.md=null,b.signatureOid in n){var E=n[b.signatureOid];switch(E){case"sha1WithRSAEncryption":b.md=B.md.sha1.create();break;case"md5WithRSAEncryption":b.md=B.md.md5.create();break;case"sha256WithRSAEncryption":b.md=B.md.sha256.create();break;case"sha384WithRSAEncryption":b.md=B.md.sha384.create();break;case"sha512WithRSAEncryption":b.md=B.md.sha512.create();break;case"RSASSA-PSS":b.md=B.md.sha256.create();break}}if(b.md===null){var g=new Error("Could not compute certificate digest. Unknown signature OID.");throw g.signatureOid=b.signatureOid,g}var D=e.toDer(b.tbsCertificate);b.md.update(D.getBytes())}var O=B.md.sha1.create();b.issuer.getField=function(F){return u(b.issuer,F)},b.issuer.addField=function(F){p([F]),b.issuer.attributes.push(F)},b.issuer.attributes=r.RDNAttributesAsArray(A.certIssuer,O),A.certIssuerUniqueId&&(b.issuer.uniqueId=A.certIssuerUniqueId),b.issuer.hash=O.digest().toHex();var x=B.md.sha1.create();return b.subject.getField=function(F){return u(b.subject,F)},b.subject.addField=function(F){p([F]),b.subject.attributes.push(F)},b.subject.attributes=r.RDNAttributesAsArray(A.certSubject,x),A.certSubjectUniqueId&&(b.subject.uniqueId=A.certSubjectUniqueId),b.subject.hash=x.digest().toHex(),A.certExtensions?b.extensions=r.certificateExtensionsFromAsn1(A.certExtensions):b.extensions=[],b.publicKey=r.publicKeyFromAsn1(A.subjectPublicKeyInfo),b},r.certificateExtensionsFromAsn1=function(v){for(var _=[],A=0;A<v.value.length;++A)for(var d=v.value[A],g=0;g<d.value.length;++g)_.push(r.certificateExtensionFromAsn1(d.value[g]));return _},r.certificateExtensionFromAsn1=function(v){var _={};if(_.id=e.derToOid(v.value[0].value),_.critical=!1,v.value[1].type===e.Type.BOOLEAN?(_.critical=v.value[1].value.charCodeAt(0)!==0,_.value=v.value[2].value):_.value=v.value[1].value,_.id in n){if(_.name=n[_.id],_.name==="keyUsage"){var A=e.fromDer(_.value),d=0,g=0;A.value.length>1&&(d=A.value.charCodeAt(1),g=A.value.length>2?A.value.charCodeAt(2):0),_.digitalSignature=(d&128)===128,_.nonRepudiation=(d&64)===64,_.keyEncipherment=(d&32)===32,_.dataEncipherment=(d&16)===16,_.keyAgreement=(d&8)===8,_.keyCertSign=(d&4)===4,_.cRLSign=(d&2)===2,_.encipherOnly=(d&1)===1,_.decipherOnly=(g&128)===128}else if(_.name==="basicConstraints"){var A=e.fromDer(_.value);A.value.length>0&&A.value[0].type===e.Type.BOOLEAN?_.cA=A.value[0].value.charCodeAt(0)!==0:_.cA=!1;var E=null;A.value.length>0&&A.value[0].type===e.Type.INTEGER?E=A.value[0].value:A.value.length>1&&(E=A.value[1].value),E!==null&&(_.pathLenConstraint=e.derToInteger(E))}else if(_.name==="extKeyUsage")for(var A=e.fromDer(_.value),b=0;b<A.value.length;++b){var C=e.derToOid(A.value[b].value);C in n?_[n[C]]=!0:_[C]=!0}else if(_.name==="nsCertType"){var A=e.fromDer(_.value),d=0;A.value.length>1&&(d=A.value.charCodeAt(1)),_.client=(d&128)===128,_.server=(d&64)===64,_.email=(d&32)===32,_.objsign=(d&16)===16,_.reserved=(d&8)===8,_.sslCA=(d&4)===4,_.emailCA=(d&2)===2,_.objCA=(d&1)===1}else if(_.name==="subjectAltName"||_.name==="issuerAltName"){_.altNames=[];for(var P,A=e.fromDer(_.value),D=0;D<A.value.length;++D){P=A.value[D];var O={type:P.type,value:P.value};_.altNames.push(O);switch(P.type){case 1:case 2:case 6:break;case 7:O.ip=B.util.bytesToIP(P.value);break;case 8:O.oid=e.derToOid(P.value);break}}}else if(_.name==="subjectKeyIdentifier"){var A=e.fromDer(_.value);_.subjectKeyIdentifier=B.util.bytesToHex(A.value)}}return _},r.certificationRequestFromAsn1=function(v,_){var A={},d=[];if(!e.validate(v,l,A,d)){var g=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw g.errors=d,g}var E=e.derToOid(A.publicKeyOid);if(E!==r.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var b=r.createCertificationRequest();if(b.version=A.csrVersion?A.csrVersion.charCodeAt(0):0,b.signatureOid=B.asn1.derToOid(A.csrSignatureOid),b.signatureParameters=h(b.signatureOid,A.csrSignatureParams,!0),b.siginfo.algorithmOid=B.asn1.derToOid(A.csrSignatureOid),b.siginfo.parameters=h(b.siginfo.algorithmOid,A.csrSignatureParams,!1),b.signature=A.csrSignature,b.certificationRequestInfo=A.certificationRequestInfo,_){if(b.md=null,b.signatureOid in n){var E=n[b.signatureOid];switch(E){case"sha1WithRSAEncryption":b.md=B.md.sha1.create();break;case"md5WithRSAEncryption":b.md=B.md.md5.create();break;case"sha256WithRSAEncryption":b.md=B.md.sha256.create();break;case"sha384WithRSAEncryption":b.md=B.md.sha384.create();break;case"sha512WithRSAEncryption":b.md=B.md.sha512.create();break;case"RSASSA-PSS":b.md=B.md.sha256.create();break}}if(b.md===null){var g=new Error("Could not compute certification request digest. Unknown signature OID.");throw g.signatureOid=b.signatureOid,g}var C=e.toDer(b.certificationRequestInfo);b.md.update(C.getBytes())}var P=B.md.sha1.create();return b.subject.getField=function(D){return u(b.subject,D)},b.subject.addField=function(D){p([D]),b.subject.attributes.push(D)},b.subject.attributes=r.RDNAttributesAsArray(A.certificationRequestInfoSubject,P),b.subject.hash=P.digest().toHex(),b.publicKey=r.publicKeyFromAsn1(A.subjectPublicKeyInfo),b.getAttribute=function(D){return u(b,D)},b.addAttribute=function(D){p([D]),b.attributes.push(D)},b.attributes=r.CRIAttributesAsArray(A.certificationRequestInfoAttributes||[]),b},r.createCertificationRequest=function(){var v={};return v.version=0,v.signatureOid=null,v.signature=null,v.siginfo={},v.siginfo.algorithmOid=null,v.subject={},v.subject.getField=function(_){return u(v.subject,_)},v.subject.addField=function(_){p([_]),v.subject.attributes.push(_)},v.subject.attributes=[],v.subject.hash=null,v.publicKey=null,v.attributes=[],v.getAttribute=function(_){return u(v,_)},v.addAttribute=function(_){p([_]),v.attributes.push(_)},v.md=null,v.setSubject=function(_){p(_),v.subject.attributes=_,v.subject.hash=null},v.setAttributes=function(_){p(_),v.attributes=_},v.sign=function(_,A){v.md=A||B.md.sha1.create();var d=n[v.md.algorithm+"WithRSAEncryption"];if(!d){var g=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw g.algorithm=v.md.algorithm,g}v.signatureOid=v.siginfo.algorithmOid=d,v.certificationRequestInfo=r.getCertificationRequestInfo(v);var E=e.toDer(v.certificationRequestInfo);v.md.update(E.getBytes()),v.signature=_.sign(v.md)},v.verify=function(){var _=!1,A=v.md;if(A===null){if(v.signatureOid in n){var d=n[v.signatureOid];switch(d){case"sha1WithRSAEncryption":A=B.md.sha1.create();break;case"md5WithRSAEncryption":A=B.md.md5.create();break;case"sha256WithRSAEncryption":A=B.md.sha256.create();break;case"sha384WithRSAEncryption":A=B.md.sha384.create();break;case"sha512WithRSAEncryption":A=B.md.sha512.create();break;case"RSASSA-PSS":A=B.md.sha256.create();break}}if(A===null){var g=new Error("Could not compute certification request digest. Unknown signature OID.");throw g.signatureOid=v.signatureOid,g}var E=v.certificationRequestInfo||r.getCertificationRequestInfo(v),b=e.toDer(E);A.update(b.getBytes())}if(A!==null){var C;switch(v.signatureOid){case n.sha1WithRSAEncryption:break;case n["RSASSA-PSS"]:var P,D;if(P=n[v.signatureParameters.mgf.hash.algorithmOid],P===void 0||B.md[P]===void 0){var g=new Error("Unsupported MGF hash function.");throw g.oid=v.signatureParameters.mgf.hash.algorithmOid,g.name=P,g}if(D=n[v.signatureParameters.mgf.algorithmOid],D===void 0||B.mgf[D]===void 0){var g=new Error("Unsupported MGF function.");throw g.oid=v.signatureParameters.mgf.algorithmOid,g.name=D,g}if(D=B.mgf[D].create(B.md[P].create()),P=n[v.signatureParameters.hash.algorithmOid],P===void 0||B.md[P]===void 0){var g=new Error("Unsupported RSASSA-PSS hash function.");throw g.oid=v.signatureParameters.hash.algorithmOid,g.name=P,g}C=B.pss.create(B.md[P].create(),D,v.signatureParameters.saltLength);break}_=v.publicKey.verify(A.digest().getBytes(),v.signature,C)}return _},v};function f(v){for(var _=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]),A,d,g=v.attributes,E=0;E<g.length;++E){A=g[E];var b=A.value,C=e.Type.PRINTABLESTRING;"valueTagClass"in A&&(C=A.valueTagClass,C===e.Type.UTF8&&(b=B.util.encodeUtf8(b))),d=e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(A.type).getBytes()),e.create(e.Class.UNIVERSAL,C,!1,b)])]),_.value.push(d)}return _}function p(v){for(var _,A=0;A<v.length;++A){if(_=v[A],typeof _.name=="undefined"&&(_.type&&_.type in r.oids?_.name=r.oids[_.type]:_.shortName&&_.shortName in i&&(_.name=r.oids[i[_.shortName]])),typeof _.type=="undefined")if(_.name&&_.name in r.oids)_.type=r.oids[_.name];else{var d=new Error("Attribute type not specified.");throw d.attribute=_,d}if(typeof _.shortName=="undefined"&&(_.name&&_.name in i&&(_.shortName=i[_.name])),_.type===n.extensionRequest&&(_.valueConstructed=!0,_.valueTagClass=e.Type.SEQUENCE,!_.value&&_.extensions)){_.value=[];for(var g=0;g<_.extensions.length;++g)_.value.push(r.certificateExtensionToAsn1(S(_.extensions[g])))}if(typeof _.value=="undefined"){var d=new Error("Attribute value not specified.");throw d.attribute=_,d}}}function S(v,_){if(_=_||{},typeof v.name=="undefined"&&(v.id&&v.id in r.oids&&(v.name=r.oids[v.id])),typeof v.id=="undefined")if(v.name&&v.name in r.oids)v.id=r.oids[v.name];else{var A=new Error("Extension ID not specified.");throw A.extension=v,A}if(typeof v.value!="undefined")return v;if(v.name==="keyUsage"){var d=0,g=0,E=0;v.digitalSignature&&(g|=128,d=7),v.nonRepudiation&&(g|=64,d=6),v.keyEncipherment&&(g|=32,d=5),v.dataEncipherment&&(g|=16,d=4),v.keyAgreement&&(g|=8,d=3),v.keyCertSign&&(g|=4,d=2),v.cRLSign&&(g|=2,d=1),v.encipherOnly&&(g|=1,d=0),v.decipherOnly&&(E|=128,d=7);var b=String.fromCharCode(d);E!==0?b+=String.fromCharCode(g)+String.fromCharCode(E):g!==0&&(b+=String.fromCharCode(g)),v.value=e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,b)}else if(v.name==="basicConstraints")v.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]),v.cA&&v.value.value.push(e.create(e.Class.UNIVERSAL,e.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in v&&v.value.value.push(e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(v.pathLenConstraint).getBytes()));else if(v.name==="extKeyUsage"){v.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);var C=v.value.value;for(var P in v){if(v[P]!==!0)continue;P in n?C.push(e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(n[P]).getBytes())):P.indexOf(".")!==-1&&C.push(e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(P).getBytes()))}}else if(v.name==="nsCertType"){var d=0,g=0;v.client&&(g|=128,d=7),v.server&&(g|=64,d=6),v.email&&(g|=32,d=5),v.objsign&&(g|=16,d=4),v.reserved&&(g|=8,d=3),v.sslCA&&(g|=4,d=2),v.emailCA&&(g|=2,d=1),v.objCA&&(g|=1,d=0);var b=String.fromCharCode(d);g!==0&&(b+=String.fromCharCode(g)),v.value=e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,b)}else if(v.name==="subjectAltName"||v.name==="issuerAltName"){v.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);for(var D,O=0;O<v.altNames.length;++O){D=v.altNames[O];var b=D.value;if(D.type===7&&D.ip){if(b=B.util.bytesFromIP(D.ip),b===null){var A=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw A.extension=v,A}}else D.type===8&&(D.oid?b=e.oidToDer(e.oidToDer(D.oid)):b=e.oidToDer(b));v.value.value.push(e.create(e.Class.CONTEXT_SPECIFIC,D.type,!1,b))}}else if(v.name==="nsComment"&&_.cert){if(!/^[\x00-\x7F]*$/.test(v.comment)||v.comment.length<1||v.comment.length>128)throw new Error('Invalid "nsComment" content.');v.value=e.create(e.Class.UNIVERSAL,e.Type.IA5STRING,!1,v.comment)}else if(v.name==="subjectKeyIdentifier"&&_.cert){var x=_.cert.generateSubjectKeyIdentifier();v.subjectKeyIdentifier=x.toHex(),v.value=e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,x.getBytes())}else if(v.name==="authorityKeyIdentifier"&&_.cert){v.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);var C=v.value.value;if(v.keyIdentifier){var F=v.keyIdentifier===!0?_.cert.generateSubjectKeyIdentifier().getBytes():v.keyIdentifier;C.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!1,F))}if(v.authorityCertIssuer){var $=[e.create(e.Class.CONTEXT_SPECIFIC,4,!0,[f(v.authorityCertIssuer===!0?_.cert.issuer:v.authorityCertIssuer)])];C.push(e.create(e.Class.CONTEXT_SPECIFIC,1,!0,$))}if(v.serialNumber){var H=B.util.hexToBytes(v.serialNumber===!0?_.cert.serialNumber:v.serialNumber);C.push(e.create(e.Class.CONTEXT_SPECIFIC,2,!1,H))}}else if(v.name==="cRLDistributionPoints"){v.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);for(var C=v.value.value,re=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]),ee=e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[]),D,O=0;O<v.altNames.length;++O){D=v.altNames[O];var b=D.value;if(D.type===7&&D.ip){if(b=B.util.bytesFromIP(D.ip),b===null){var A=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw A.extension=v,A}}else D.type===8&&(D.oid?b=e.oidToDer(e.oidToDer(D.oid)):b=e.oidToDer(b));ee.value.push(e.create(e.Class.CONTEXT_SPECIFIC,D.type,!1,b))}re.value.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[ee])),C.push(re)}if(typeof v.value=="undefined"){var A=new Error("Extension value not specified.");throw A.extension=v,A}return v}function M(v,_){switch(v){case n["RSASSA-PSS"]:var A=[];return _.hash.algorithmOid!==void 0&&A.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(_.hash.algorithmOid).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")])])),_.mgf.algorithmOid!==void 0&&A.push(e.create(e.Class.CONTEXT_SPECIFIC,1,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(_.mgf.algorithmOid).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(_.mgf.hash.algorithmOid).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")])])])),_.saltLength!==void 0&&A.push(e.create(e.Class.CONTEXT_SPECIFIC,2,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(_.saltLength).getBytes())])),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,A);default:return e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")}}function I(v){var _=e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[]);if(v.attributes.length===0)return _;for(var A=v.attributes,d=0;d<A.length;++d){var g=A[d],E=g.value,b=e.Type.UTF8;"valueTagClass"in g&&(b=g.valueTagClass),b===e.Type.UTF8&&(E=B.util.encodeUtf8(E));var C=!1;"valueConstructed"in g&&(C=g.valueConstructed);var P=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(g.type).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[e.create(e.Class.UNIVERSAL,b,C,E)])]);_.value.push(P)}return _}var k=new Date("1950-01-01T00:00:00Z"),V=new Date("2050-01-01T00:00:00Z");function z(v){return v>=k&&v<V?e.create(e.Class.UNIVERSAL,e.Type.UTCTIME,!1,e.dateToUtcTime(v)):e.create(e.Class.UNIVERSAL,e.Type.GENERALIZEDTIME,!1,e.dateToGeneralizedTime(v))}r.getTBSCertificate=function(v){var _=z(v.validity.notBefore),A=z(v.validity.notAfter),d=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(v.version).getBytes())]),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,B.util.hexToBytes(v.serialNumber)),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(v.siginfo.algorithmOid).getBytes()),M(v.siginfo.algorithmOid,v.siginfo.parameters)]),f(v.issuer),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[_,A]),f(v.subject),r.publicKeyToAsn1(v.publicKey)]);return v.issuer.uniqueId&&d.value.push(e.create(e.Class.CONTEXT_SPECIFIC,1,!0,[e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,String.fromCharCode(0)+v.issuer.uniqueId)])),v.subject.uniqueId&&d.value.push(e.create(e.Class.CONTEXT_SPECIFIC,2,!0,[e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,String.fromCharCode(0)+v.subject.uniqueId)])),v.extensions.length>0&&d.value.push(r.certificateExtensionsToAsn1(v.extensions)),d},r.getCertificationRequestInfo=function(v){var _=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(v.version).getBytes()),f(v.subject),r.publicKeyToAsn1(v.publicKey),I(v)]);return _},r.distinguishedNameToAsn1=function(v){return f(v)},r.certificateToAsn1=function(v){var _=v.tbsCertificate||r.getTBSCertificate(v);return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[_,e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(v.signatureOid).getBytes()),M(v.signatureOid,v.signatureParameters)]),e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,String.fromCharCode(0)+v.signature)])},r.certificateExtensionsToAsn1=function(v){var _=e.create(e.Class.CONTEXT_SPECIFIC,3,!0,[]),A=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);_.value.push(A);for(var d=0;d<v.length;++d)A.value.push(r.certificateExtensionToAsn1(v[d]));return _},r.certificateExtensionToAsn1=function(v){var _=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);_.value.push(e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(v.id).getBytes())),v.critical&&_.value.push(e.create(e.Class.UNIVERSAL,e.Type.BOOLEAN,!1,String.fromCharCode(255)));var A=v.value;return typeof v.value!="string"&&(A=e.toDer(A).getBytes()),_.value.push(e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,A)),_},r.certificationRequestToAsn1=function(v){var _=v.certificationRequestInfo||r.getCertificationRequestInfo(v);return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[_,e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(v.signatureOid).getBytes()),M(v.signatureOid,v.signatureParameters)]),e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,String.fromCharCode(0)+v.signature)])},r.createCaStore=function(v){var _={certs:{}};_.getIssuer=function(b){var C=A(b.issuer);return C},_.addCertificate=function(b){if(typeof b=="string"&&(b=B.pki.certificateFromPem(b)),d(b.subject),!_.hasCertificate(b))if(b.subject.hash in _.certs){var C=_.certs[b.subject.hash];B.util.isArray(C)||(C=[C]),C.push(b),_.certs[b.subject.hash]=C}else _.certs[b.subject.hash]=b},_.hasCertificate=function(b){typeof b=="string"&&(b=B.pki.certificateFromPem(b));var C=A(b.subject);if(!C)return!1;B.util.isArray(C)||(C=[C]);for(var P=e.toDer(r.certificateToAsn1(b)).getBytes(),D=0;D<C.length;++D){var O=e.toDer(r.certificateToAsn1(C[D])).getBytes();if(P===O)return!0}return!1},_.listAllCertificates=function(){var b=[];for(var C in _.certs)if(_.certs.hasOwnProperty(C)){var P=_.certs[C];if(!B.util.isArray(P))b.push(P);else for(var D=0;D<P.length;++D)b.push(P[D])}return b},_.removeCertificate=function(b){var C;if(typeof b=="string"&&(b=B.pki.certificateFromPem(b)),d(b.subject),!_.hasCertificate(b))return null;var P=A(b.subject);if(!B.util.isArray(P))return C=_.certs[b.subject.hash],delete _.certs[b.subject.hash],C;for(var D=e.toDer(r.certificateToAsn1(b)).getBytes(),O=0;O<P.length;++O){var x=e.toDer(r.certificateToAsn1(P[O])).getBytes();D===x&&(C=P[O],P.splice(O,1))}return P.length===0&&delete _.certs[b.subject.hash],C};function A(b){return d(b),_.certs[b.hash]||null}function d(b){if(!b.hash){var C=B.md.sha1.create();b.attributes=r.RDNAttributesAsArray(f(b),C),b.hash=C.digest().toHex()}}if(v)for(var g=0;g<v.length;++g){var E=v[g];_.addCertificate(E)}return _},r.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},r.verifyCertificateChain=function(v,_,A){typeof A=="function"&&(A={verify:A}),A=A||{},_=_.slice(0);var d=_.slice(0),g=A.validityCheckDate;typeof g=="undefined"&&(g=new Date);var E=!0,b=null,C=0;do{var P=_.shift(),D=null,O=!1;if(g&&((g<P.validity.notBefore||g>P.validity.notAfter)&&(b={message:"Certificate is not valid yet or has expired.",error:r.certificateError.certificate_expired,notBefore:P.validity.notBefore,notAfter:P.validity.notAfter,now:g})),b===null){if(D=_[0]||v.getIssuer(P),D===null&&(P.isIssuer(P)&&(O=!0,D=P)),D){var x=D;B.util.isArray(x)||(x=[x]);for(var F=!1;!F&&x.length>0;){D=x.shift();try{F=D.verify(P)}catch(Ae){}}F||(b={message:"Certificate signature is invalid.",error:r.certificateError.bad_certificate})}b===null&&(!D||O)&&!v.hasCertificate(P)&&(b={message:"Certificate is not trusted.",error:r.certificateError.unknown_ca})}if(b===null&&D&&!P.isIssuer(D)&&(b={message:"Certificate issuer is invalid.",error:r.certificateError.bad_certificate}),b===null)for(var $={keyUsage:!0,basicConstraints:!0},H=0;b===null&&H<P.extensions.length;++H){var re=P.extensions[H];re.critical&&!(re.name in $)&&(b={message:"Certificate has an unsupported critical extension.",error:r.certificateError.unsupported_certificate})}if(b===null&&(!E||_.length===0&&(!D||O))){var ee=P.getExtension("basicConstraints"),ge=P.getExtension("keyUsage");if(ge!==null&&((!ge.keyCertSign||ee===null)&&(b={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:r.certificateError.bad_certificate})),b===null&&ee!==null&&!ee.cA&&(b={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:r.certificateError.bad_certificate}),b===null&&ge!==null&&"pathLenConstraint"in ee){var _e=C-1;_e>ee.pathLenConstraint&&(b={message:"Certificate basicConstraints pathLenConstraint violated.",error:r.certificateError.bad_certificate})}}var oe=b===null?!0:b.error,ce=A.verify?A.verify(oe,C,d):oe;if(ce===!0)b=null;else throw oe===!0&&(b={message:"The application rejected the certificate.",error:r.certificateError.bad_certificate}),(ce||ce===0)&&(typeof ce=="object"&&!B.util.isArray(ce)?(ce.message&&(b.message=ce.message),ce.error&&(b.error=ce.error)):typeof ce=="string"&&(b.error=ce)),b;E=!1,++C}while(_.length>0);return!0}}),VP=te(function(t){var e=B.asn1,r=t.exports=B.pkcs7=B.pkcs7||{};r.messageFromPem=function(p){var S=B.pem.decode(p)[0];if(S.type!=="PKCS7"){var M=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw M.headerType=S.type,M}if(S.procType&&S.procType.type==="ENCRYPTED")throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var I=e.fromDer(S.body);return r.messageFromAsn1(I)},r.messageToPem=function(p,S){var M={type:"PKCS7",body:e.toDer(p.toAsn1()).getBytes()};return B.pem.encode(M,{maxline:S})},r.messageFromAsn1=function(p){var S={},M=[];if(!e.validate(p,r.asn1.contentInfoValidator,S,M)){var I=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw I.errors=M,I}var k=e.derToOid(S.contentType),V;switch(k){case B.pki.oids.envelopedData:V=r.createEnvelopedData();break;case B.pki.oids.encryptedData:V=r.createEncryptedData();break;case B.pki.oids.signedData:V=r.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+k+" is not (yet) supported.")}return V.fromAsn1(S.content.value[0]),V},r.createSignedData=function(){var p=null;return p={type:B.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(I){if(h(p,I,r.asn1.signedDataValidator),p.certificates=[],p.crls=[],p.digestAlgorithmIdentifiers=[],p.contentInfo=null,p.signerInfos=[],p.rawCapture.certificates)for(var k=p.rawCapture.certificates.value,V=0;V<k.length;++V)p.certificates.push(B.pki.certificateFromAsn1(k[V]))},toAsn1:function(){p.contentInfo||p.sign();for(var I=[],k=0;k<p.certificates.length;++k)I.push(B.pki.certificateToAsn1(p.certificates[k]));var V=[],z=e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(p.version).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,p.digestAlgorithmIdentifiers),p.contentInfo])]);return I.length>0&&z.value[0].value.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!0,I)),V.length>0&&z.value[0].value.push(e.create(e.Class.CONTEXT_SPECIFIC,1,!0,V)),z.value[0].value.push(e.create(e.Class.UNIVERSAL,e.Type.SET,!0,p.signerInfos)),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.type).getBytes()),z])},addSigner:function(I){var k=I.issuer,V=I.serialNumber;if(I.certificate){var z=I.certificate;typeof z=="string"&&(z=B.pki.certificateFromPem(z)),k=z.issuer.attributes,V=z.serialNumber}var v=I.key;if(!v)throw new Error("Could not add PKCS#7 signer; no private key specified.");typeof v=="string"&&(v=B.pki.privateKeyFromPem(v));var _=I.digestAlgorithm||B.pki.oids.sha1;switch(_){case B.pki.oids.sha1:case B.pki.oids.sha256:case B.pki.oids.sha384:case B.pki.oids.sha512:case B.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+_)}var A=I.authenticatedAttributes||[];if(A.length>0){for(var d=!1,g=!1,E=0;E<A.length;++E){var b=A[E];if(!d&&b.type===B.pki.oids.contentType){if(d=!0,g)break;continue}if(!g&&b.type===B.pki.oids.messageDigest){if(g=!0,d)break;continue}}if(!d||!g)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}p.signers.push({key:v,version:1,issuer:k,serialNumber:V,digestAlgorithm:_,signatureAlgorithm:B.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:A,unauthenticatedAttributes:[]})},sign:function(I){if(I=I||{},(typeof p.content!="object"||p.contentInfo===null)&&(p.contentInfo=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(B.pki.oids.data).getBytes())]),"content"in p)){var k;p.content instanceof B.util.ByteBuffer?k=p.content.bytes():typeof p.content=="string"&&(k=B.util.encodeUtf8(p.content)),I.detached?p.detachedContent=e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,k):p.contentInfo.value.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,k)]))}if(p.signers.length===0)return;var V=S();M(V)},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(I){typeof I=="string"&&(I=B.pki.certificateFromPem(I)),p.certificates.push(I)},addCertificateRevokationList:function(I){throw new Error("PKCS#7 CRL support not yet implemented.")}},p;function S(){for(var I={},k=0;k<p.signers.length;++k){var V=p.signers[k],z=V.digestAlgorithm;z in I||(I[z]=B.md[B.pki.oids[z]].create()),V.authenticatedAttributes.length===0?V.md=I[z]:V.md=B.md[B.pki.oids[z]].create()}p.digestAlgorithmIdentifiers=[];for(var z in I)p.digestAlgorithmIdentifiers.push(e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(z).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")]));return I}function M(I){var k;if(p.detachedContent?k=p.detachedContent:(k=p.contentInfo.value[1],k=k.value[0]),!k)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var V=e.derToOid(p.contentInfo.value[0].value),z=e.toDer(k);z.getByte(),e.getBerValueLength(z),z=z.getBytes();for(var v in I)I[v].start().update(z);for(var _=new Date,A=0;A<p.signers.length;++A){var d=p.signers[A];if(d.authenticatedAttributes.length===0){if(V!==B.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{d.authenticatedAttributesAsn1=e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var g=e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[]),E=0;E<d.authenticatedAttributes.length;++E){var b=d.authenticatedAttributes[E];b.type===B.pki.oids.messageDigest?b.value=I[d.digestAlgorithm].digest():b.type===B.pki.oids.signingTime&&(b.value||(b.value=_)),g.value.push(l(b)),d.authenticatedAttributesAsn1.value.push(l(b))}z=e.toDer(g).getBytes(),d.md.start().update(z)}d.signature=d.key.sign(d.md,"RSASSA-PKCS1-V1_5")}p.signerInfos=o(p.signers)}},r.createEncryptedData=function(){var p=null;return p={type:B.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:B.pki.oids["aes256-CBC"]},fromAsn1:function(S){h(p,S,r.asn1.encryptedDataValidator)},decrypt:function(S){S!==void 0&&(p.encryptedContent.key=S),f(p)}},p},r.createEnvelopedData=function(){var p=null;return p={type:B.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:B.pki.oids["aes256-CBC"]},fromAsn1:function(S){var M=h(p,S,r.asn1.envelopedDataValidator);p.recipients=s(M.recipientInfos.value)},toAsn1:function(){return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.type).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(p.version).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,a(p.recipients)),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,u(p.encryptedContent))])])])},findRecipient:function(S){for(var M=S.issuer.attributes,I=0;I<p.recipients.length;++I){var k=p.recipients[I],V=k.issuer;if(k.serialNumber!==S.serialNumber)continue;if(V.length!==M.length)continue;for(var z=!0,v=0;v<M.length;++v)if(V[v].type!==M[v].type||V[v].value!==M[v].value){z=!1;break}if(z)return k}return null},decrypt:function(S,M){if(p.encryptedContent.key===void 0&&S!==void 0&&M!==void 0)switch(S.encryptedContent.algorithm){case B.pki.oids.rsaEncryption:case B.pki.oids.desCBC:var I=M.decrypt(S.encryptedContent.content);p.encryptedContent.key=B.util.createBuffer(I);break;default:throw new Error("Unsupported asymmetric cipher, OID "+S.encryptedContent.algorithm)}f(p)},addRecipient:function(S){p.recipients.push({version:0,issuer:S.issuer.attributes,serialNumber:S.serialNumber,encryptedContent:{algorithm:B.pki.oids.rsaEncryption,key:S.publicKey}})},encrypt:function(S,M){if(p.encryptedContent.content===void 0){M=M||p.encryptedContent.algorithm,S=S||p.encryptedContent.key;var I,k,V;switch(M){case B.pki.oids["aes128-CBC"]:I=16,k=16,V=B.aes.createEncryptionCipher;break;case B.pki.oids["aes192-CBC"]:I=24,k=16,V=B.aes.createEncryptionCipher;break;case B.pki.oids["aes256-CBC"]:I=32,k=16,V=B.aes.createEncryptionCipher;break;case B.pki.oids["des-EDE3-CBC"]:I=24,k=8,V=B.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+M)}if(S===void 0)S=B.util.createBuffer(B.random.getBytes(I));else if(S.length()!=I)throw new Error("Symmetric key has wrong length; got "+S.length()+" bytes, expected "+I+".");p.encryptedContent.algorithm=M,p.encryptedContent.key=S,p.encryptedContent.parameter=B.util.createBuffer(B.random.getBytes(k));var z=V(S);if(z.start(p.encryptedContent.parameter.copy()),z.update(p.content),!z.finish())throw new Error("Symmetric encryption failed.");p.encryptedContent.content=z.output}for(var v=0;v<p.recipients.length;++v){var _=p.recipients[v];if(_.encryptedContent.content!==void 0)continue;switch(_.encryptedContent.algorithm){case B.pki.oids.rsaEncryption:_.encryptedContent.content=_.encryptedContent.key.encrypt(p.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+_.encryptedContent.algorithm)}}}},p};function n(p){var S={},M=[];if(!e.validate(p,r.asn1.recipientInfoValidator,S,M)){var I=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw I.errors=M,I}return{version:S.version.charCodeAt(0),issuer:B.pki.RDNAttributesAsArray(S.issuer),serialNumber:B.util.createBuffer(S.serial).toHex(),encryptedContent:{algorithm:e.derToOid(S.encAlgorithm),parameter:S.encParameter.value,content:S.encKey}}}function i(p){return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(p.version).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[B.pki.distinguishedNameToAsn1({attributes:p.issuer}),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,B.util.hexToBytes(p.serialNumber))]),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.encryptedContent.algorithm).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")]),e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.encryptedContent.content)])}function s(p){for(var S=[],M=0;M<p.length;++M)S.push(n(p[M]));return S}function a(p){for(var S=[],M=0;M<p.length;++M)S.push(i(p[M]));return S}function c(p){var S=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(p.version).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[B.pki.distinguishedNameToAsn1({attributes:p.issuer}),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,B.util.hexToBytes(p.serialNumber))]),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.digestAlgorithm).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")])]);if(p.authenticatedAttributesAsn1&&S.value.push(p.authenticatedAttributesAsn1),S.value.push(e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.signatureAlgorithm).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")])),S.value.push(e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.signature)),p.unauthenticatedAttributes.length>0){for(var M=e.create(e.Class.CONTEXT_SPECIFIC,1,!0,[]),I=0;I<p.unauthenticatedAttributes.length;++I){var k=p.unauthenticatedAttributes[I];M.values.push(l(k))}S.value.push(M)}return S}function o(p){for(var S=[],M=0;M<p.length;++M)S.push(c(p[M]));return S}function l(p){var S;if(p.type===B.pki.oids.contentType)S=e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.value).getBytes());else if(p.type===B.pki.oids.messageDigest)S=e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.value.bytes());else if(p.type===B.pki.oids.signingTime){var M=new Date("1950-01-01T00:00:00Z"),I=new Date("2050-01-01T00:00:00Z"),k=p.value;if(typeof k=="string"){var V=Date.parse(k);isNaN(V)?k.length===13?k=e.utcTimeToDate(k):k=e.generalizedTimeToDate(k):k=new Date(V)}k>=M&&k<I?S=e.create(e.Class.UNIVERSAL,e.Type.UTCTIME,!1,e.dateToUtcTime(k)):S=e.create(e.Class.UNIVERSAL,e.Type.GENERALIZEDTIME,!1,e.dateToGeneralizedTime(k))}return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.type).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[S])])}function u(p){return[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(B.pki.oids.data).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.algorithm).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.parameter.getBytes())]),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.content.getBytes())])]}function h(p,S,M){var I={},k=[];if(!e.validate(S,M,I,k)){var V=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw V.errors=V,V}var z=e.derToOid(I.contentType);if(z!==B.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(I.encryptedContent){var v="";if(B.util.isArray(I.encryptedContent))for(var _=0;_<I.encryptedContent.length;++_){if(I.encryptedContent[_].type!==e.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");v+=I.encryptedContent[_].value}else v=I.encryptedContent;p.encryptedContent={algorithm:e.derToOid(I.encAlgorithm),parameter:B.util.createBuffer(I.encParameter.value),content:B.util.createBuffer(v)}}if(I.content){var v="";if(B.util.isArray(I.content))for(var _=0;_<I.content.length;++_){if(I.content[_].type!==e.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");v+=I.content[_].value}else v=I.content;p.content=B.util.createBuffer(v)}return p.version=I.version.charCodeAt(0),p.rawCapture=I,I}function f(p){if(p.encryptedContent.key===void 0)throw new Error("Symmetric key not available.");if(p.content===void 0){var S;switch(p.encryptedContent.algorithm){case B.pki.oids["aes128-CBC"]:case B.pki.oids["aes192-CBC"]:case B.pki.oids["aes256-CBC"]:S=B.aes.createDecryptionCipher(p.encryptedContent.key);break;case B.pki.oids.desCBC:case B.pki.oids["des-EDE3-CBC"]:S=B.des.createDecryptionCipher(p.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+p.encryptedContent.algorithm)}if(S.start(p.encryptedContent.parameter),S.update(p.encryptedContent.content),!S.finish())throw new Error("Symmetric decryption failed.");p.content=S.output}}}),u0=te(function(t,e){const r=B.pki;e=t.exports,e.certificateForKey=(i,s)=>{const a=r.setRsaPublicKey(s.n,s.e),c=r.createCertificate();c.publicKey=a,c.serialNumber="01",c.validity.notBefore=new Date,c.validity.notAfter=new Date,c.validity.notAfter.setFullYear(c.validity.notBefore.getFullYear()+10);const o=[{name:"organizationName",value:"ipfs"},{shortName:"OU",value:"keystore"},{name:"commonName",value:i.id}];return c.setSubject(o),c.setIssuer(o),c.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"extKeyUsage",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:"nsCertType",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),c.sign(s),c};async function n(i,s){const a=i.map(s),c=await Promise.all(a),o=c.findIndex(l=>l);return i[o]}t.exports.findAsync=n});const{certificateForKey:d0,findAsync:h0}=u0;class p0{constructor(t){if(!t)throw U(new Error("keychain is required"),"ERR_KEYCHAIN_REQUIRED");this.keychain=t}async encrypt(t,e){if(!(e instanceof Uint8Array))throw U(new Error("Plain data must be a Uint8Array"),"ERR_INVALID_PARAMS");const r=await this.keychain.findKeyByName(t),n=await this.keychain._getPrivateKey(t),i=B.pki.decryptRsaPrivateKey(n,this.keychain._()),s=await d0(r,i),a=B.pkcs7.createEnvelopedData();a.addRecipient(s),a.content=B.util.createBuffer(e),a.encrypt();const c=B.asn1.toDer(a.toAsn1()).getBytes();return je(c,"ascii")}async decrypt(t){if(!(t instanceof Uint8Array))throw U(new Error("CMS data is required"),"ERR_INVALID_PARAMS");let e;try{const c=B.util.createBuffer(se(t,"ascii")),o=B.asn1.fromDer(c);e=B.pkcs7.messageFromAsn1(o)}catch(c){throw U(new Error("Invalid CMS: "+c.message),"ERR_INVALID_CMS")}const r=e.recipients.filter(c=>c.issuer.find(o=>o.shortName==="O"&&o.value==="ipfs")).filter(c=>c.issuer.find(o=>o.shortName==="CN")).map(c=>({recipient:c,keyId:c.issuer.find(o=>o.shortName==="CN").value})),n=await h0(r,async c=>{try{const o=await this.keychain.findKeyById(c.keyId);if(o)return!0}catch(o){return!1}return!1});if(!n){const c=r.map(o=>o.keyId);throw U(new Error("Decryption needs one of the key(s): "+c.join(", ")),"ERR_MISSING_KEYS",{missingKeys:c})}const i=await this.keychain.findKeyById(n.keyId),s=await this.keychain._getPrivateKey(i.name),a=B.pki.decryptRsaPrivateKey(s,this.keychain._());return e.decrypt(n.recipient,a),je(e.content.getBytes(),"ascii")}}var f0=p0;const{Number:m0}=ri,g0="/pkcs8/",Zd="/info/",ai={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},Bc={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function Zr(t){return t?typeof t!="string"?!1:t===l0(t.trim()):!1}async function Le(t){const e=200,r=1e3,n=Math.random()*(r-e)+e;throw await new Promise(i=>setTimeout(i,n)),t}function In(t){return new nc.Key(g0+t)}function oi(t){return new nc.Key(Zd+t)}class b0{constructor(t,e){if(!t)throw new Error("store is required");if(this.store=t,this.opts=Wa(Bc,e),this.opts.passPhrase&&this.opts.passPhrase.length<20)throw new Error("passPhrase must be least 20 characters");if(this.opts.dek.keyLength<ai.minKeyLength)throw new Error(`dek.keyLength must be least ${ai.minKeyLength} bytes`);if(this.opts.dek.salt.length<ai.minSaltLength)throw new Error(`dek.saltLength must be least ${ai.minSaltLength} bytes`);if(this.opts.dek.iterationCount<ai.minIterationCount)throw new Error(`dek.iterationCount must be least ${ai.minIterationCount}`);const r=this.opts.passPhrase?rr.pbkdf2(this.opts.passPhrase,this.opts.dek.salt,this.opts.dek.iterationCount,this.opts.dek.keyLength,this.opts.dek.hash):"";Object.defineProperty(this,"_",{value:()=>r})}get cms(){return new f0(this)}static generateOptions(){const t=Object.assign({},Bc),e=Math.ceil(ai.minSaltLength/3)*3;return t.dek.salt=se(rr.randomBytes(e),"base64"),t}static get options(){return Bc}async createKey(t,e,r){const n=this;if(!Zr(t)||t==="self")return Le(U(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));if(typeof e!="string")return Le(U(new Error(`Invalid key type '${e}'`),"ERR_INVALID_KEY_TYPE"));const i=In(t),s=await n.store.has(i);if(s)return Le(U(new Error(`Key '${t}' already exists`),"ERR_KEY_ALREADY_EXISTS"));switch(e.toLowerCase()){case"rsa":if(!m0.isSafeInteger(r)||r<2048)return Le(U(new Error(`Invalid RSA key size ${r}`),"ERR_INVALID_KEY_SIZE"));break}let a;try{const c=await rr.keys.generateKeyPair(e,r),o=await c.id(),l=await c.export(this._());a={name:t,id:o};const u=n.store.batch();u.put(i,je(l)),u.put(oi(t),je(JSON.stringify(a))),await u.commit()}catch(c){return Le(c)}return a}async listKeys(){const t=this,e={prefix:Zd},r=[];for await(const n of t.store.query(e))r.push(JSON.parse(se(n.value)));return r}async findKeyById(t){try{const e=await this.listKeys();return e.find(r=>r.id===t)}catch(e){return Le(e)}}async findKeyByName(t){if(!Zr(t))return Le(U(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));const e=oi(t);try{const r=await this.store.get(e);return JSON.parse(se(r))}catch(r){return Le(U(new Error(`Key '${t}' does not exist. ${r.message}`),"ERR_KEY_NOT_FOUND"))}}async removeKey(t){const e=this;if(!Zr(t)||t==="self")return Le(U(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));const r=In(t),n=await e.findKeyByName(t),i=e.store.batch();return i.delete(r),i.delete(oi(t)),await i.commit(),n}async renameKey(t,e){const r=this;if(!Zr(t)||t==="self")return Le(U(new Error(`Invalid old key name '${t}'`),"ERR_OLD_KEY_NAME_INVALID"));if(!Zr(e)||e==="self")return Le(U(new Error(`Invalid new key name '${e}'`),"ERR_NEW_KEY_NAME_INVALID"));const n=In(t),i=In(e),s=oi(t),a=oi(e),c=await r.store.has(i);if(c)return Le(U(new Error(`Key '${e}' already exists`),"ERR_KEY_ALREADY_EXISTS"));try{const o=await r.store.get(n),l=await r.store.get(s),u=JSON.parse(se(l));u.name=e;const h=r.store.batch();return h.put(i,o),h.put(a,je(JSON.stringify(u))),h.delete(n),h.delete(s),await h.commit(),u}catch(o){return Le(o)}}async exportKey(t,e){if(!Zr(t))return Le(U(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));if(!e)return Le(U(new Error("Password is required"),"ERR_PASSWORD_REQUIRED"));const r=In(t);try{const n=await this.store.get(r),i=se(n),s=await rr.keys.import(i,this._());return s.export(e)}catch(n){return Le(n)}}async importKey(t,e,r){const n=this;if(!Zr(t)||t==="self")return Le(U(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));if(!e)return Le(U(new Error("PEM encoded key is required"),"ERR_PEM_REQUIRED"));const i=In(t),s=await n.store.has(i);if(s)return Le(U(new Error(`Key '${t}' already exists`),"ERR_KEY_ALREADY_EXISTS"));let a;try{a=await rr.keys.import(e,r)}catch(u){return Le(U(new Error("Cannot read the key, most likely the password is wrong"),"ERR_CANNOT_READ_KEY"))}let c;try{c=await a.id(),e=await a.export(this._())}catch(u){return Le(u)}const o={name:t,id:c},l=n.store.batch();return l.put(i,je(e)),l.put(oi(t),je(JSON.stringify(o))),await l.commit(),o}async importPeer(t,e){const r=this;if(!Zr(t))return Le(U(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));if(!e||!e.privKey)return Le(U(new Error("Peer.privKey is required"),"ERR_MISSING_PRIVATE_KEY"));const n=e.privKey,i=In(t),s=await r.store.has(i);if(s)return Le(U(new Error(`Key '${t}' already exists`),"ERR_KEY_ALREADY_EXISTS"));try{const a=await n.id(),c=await n.export(this._()),o={name:t,id:a},l=r.store.batch();return l.put(i,je(c)),l.put(oi(t),je(JSON.stringify(o))),await l.commit(),o}catch(a){return Le(a)}}async _getPrivateKey(t){if(!Zr(t))return Le(U(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));try{const e=In(t),r=await this.store.get(e);return se(r)}catch(e){return Le(U(new Error(`Key '${t}' does not exist. ${e.message}`),"ERR_KEY_NOT_FOUND"))}}}var eh=b0,y0=t=>{const e=Og(t);return e.delete=e.remove,e},v0=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Uc=Math.ceil,Dr=Math.floor,Dt="[BigNumber Error] ",th=Dt+"Number primitive has more than 15 significant digits: ",wr=1e14,me=14,Fc=9007199254740991,$c=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Rn=1e7,ot=1e9;function rh(t){var e,r,n,i=k.prototype={constructor:k,toString:null,valueOf:null},s=new k(1),a=20,c=4,o=-7,l=21,u=-1e7,h=1e7,f=!1,p=1,S=0,M={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},I="0123456789abcdefghijklmnopqrstuvwxyz";function k(d,g){var E,b,C,P,D,O,x,F,$=this;if(!($ instanceof k))return new k(d,g);if(g==null){if(d&&d._isBigNumber===!0){$.s=d.s,!d.c||d.e>h?$.c=$.e=null:d.e<u?$.c=[$.e=0]:($.e=d.e,$.c=d.c.slice());return}if((O=typeof d=="number")&&d*0==0){if($.s=1/d<0?(d=-d,-1):1,d===~~d){for(P=0,D=d;D>=10;D/=10,P++);P>h?$.c=$.e=null:($.e=P,$.c=[d]);return}F=String(d)}else{if(!v0.test(F=String(d)))return n($,F,O);$.s=F.charCodeAt(0)==45?(F=F.slice(1),-1):1}(P=F.indexOf("."))>-1&&(F=F.replace(".","")),(D=F.search(/e/i))>0?(P<0&&(P=D),P+=+F.slice(D+1),F=F.substring(0,D)):P<0&&(P=F.length)}else{if(Ve(g,2,I.length,"Base"),g==10)return $=new k(d),_($,a+$.e+1,c);if(F=String(d),O=typeof d=="number"){if(d*0!=0)return n($,F,O,g);if($.s=1/d<0?(F=F.slice(1),-1):1,k.DEBUG&&F.replace(/^0\.0*|\./,"").length>15)throw Error(th+d)}else $.s=F.charCodeAt(0)===45?(F=F.slice(1),-1):1;for(E=I.slice(0,g),P=D=0,x=F.length;D<x;D++)if(E.indexOf(b=F.charAt(D))<0){if(b=="."){if(D>P){P=x;continue}}else if(!C&&(F==F.toUpperCase()&&(F=F.toLowerCase())||F==F.toLowerCase()&&(F=F.toUpperCase()))){C=!0,D=-1,P=0;continue}return n($,String(d),O,g)}O=!1,F=r(F,g,10,$.s),(P=F.indexOf("."))>-1?F=F.replace(".",""):P=F.length}for(D=0;F.charCodeAt(D)===48;D++);for(x=F.length;F.charCodeAt(--x)===48;);if(F=F.slice(D,++x)){if(x-=D,O&&k.DEBUG&&x>15&&(d>Fc||d!==Dr(d)))throw Error(th+$.s*d);if((P=P-D-1)>h)$.c=$.e=null;else if(P<u)$.c=[$.e=0];else{if($.e=P,$.c=[],D=(P+1)%me,P<0&&(D+=me),D<x){for(D&&$.c.push(+F.slice(0,D)),x-=me;D<x;)$.c.push(+F.slice(D,D+=me));D=me-(F=F.slice(D)).length}else D-=x;for(;D--;F+="0");$.c.push(+F)}}else $.c=[$.e=0]}k.clone=rh,k.ROUND_UP=0,k.ROUND_DOWN=1,k.ROUND_CEIL=2,k.ROUND_FLOOR=3,k.ROUND_HALF_UP=4,k.ROUND_HALF_DOWN=5,k.ROUND_HALF_EVEN=6,k.ROUND_HALF_CEIL=7,k.ROUND_HALF_FLOOR=8,k.EUCLID=9,k.config=k.set=function(d){var g,E;if(d!=null)if(typeof d=="object"){if(d.hasOwnProperty(g="DECIMAL_PLACES")&&(E=d[g],Ve(E,0,ot,g),a=E),d.hasOwnProperty(g="ROUNDING_MODE")&&(E=d[g],Ve(E,0,8,g),c=E),d.hasOwnProperty(g="EXPONENTIAL_AT")&&(E=d[g],E&&E.pop?(Ve(E[0],-ot,0,g),Ve(E[1],0,ot,g),o=E[0],l=E[1]):(Ve(E,-ot,ot,g),o=-(l=E<0?-E:E))),d.hasOwnProperty(g="RANGE"))if(E=d[g],E&&E.pop)Ve(E[0],-ot,-1,g),Ve(E[1],1,ot,g),u=E[0],h=E[1];else if(Ve(E,-ot,ot,g),E)u=-(h=E<0?-E:E);else throw Error(Dt+g+" cannot be zero: "+E);if(d.hasOwnProperty(g="CRYPTO"))if(E=d[g],E===!!E)if(E)if(typeof crypto!="undefined"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))f=E;else throw f=!E,Error(Dt+"crypto unavailable");else f=E;else throw Error(Dt+g+" not true or false: "+E);if(d.hasOwnProperty(g="MODULO_MODE")&&(E=d[g],Ve(E,0,9,g),p=E),d.hasOwnProperty(g="POW_PRECISION")&&(E=d[g],Ve(E,0,ot,g),S=E),d.hasOwnProperty(g="FORMAT"))if(E=d[g],typeof E=="object")M=E;else throw Error(Dt+g+" not an object: "+E);if(d.hasOwnProperty(g="ALPHABET"))if(E=d[g],typeof E=="string"&&!/^.$|[+-.\s]|(.).*\1/.test(E))I=E;else throw Error(Dt+g+" invalid: "+E)}else throw Error(Dt+"Object expected: "+d);return{DECIMAL_PLACES:a,ROUNDING_MODE:c,EXPONENTIAL_AT:[o,l],RANGE:[u,h],CRYPTO:f,MODULO_MODE:p,POW_PRECISION:S,FORMAT:M,ALPHABET:I}},k.isBigNumber=function(d){if(!d||d._isBigNumber!==!0)return!1;if(!k.DEBUG)return!0;var g,E,b=d.c,C=d.e,P=d.s;e:if({}.toString.call(b)=="[object Array]"){if((P===1||P===-1)&&C>=-ot&&C<=ot&&C===Dr(C)){if(b[0]===0){if(C===0&&b.length===1)return!0;break e}if(g=(C+1)%me,g<1&&(g+=me),String(b[0]).length==g){for(g=0;g<b.length;g++)if(E=b[g],E<0||E>=wr||E!==Dr(E))break e;if(E!==0)return!0}}}else if(b===null&&C===null&&(P===null||P===1||P===-1))return!0;throw Error(Dt+"Invalid BigNumber: "+d)},k.maximum=k.max=function(){return z(arguments,i.lt)},k.minimum=k.min=function(){return z(arguments,i.gt)},k.random=function(){var d=9007199254740992,g=Math.random()*d&2097151?function(){return Dr(Math.random()*d)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(E){var b,C,P,D,O,x=0,F=[],$=new k(s);if(E==null?E=a:Ve(E,0,ot),D=Uc(E/me),f)if(crypto.getRandomValues){for(b=crypto.getRandomValues(new Uint32Array(D*=2));x<D;)O=b[x]*131072+(b[x+1]>>>11),O>=9e15?(C=crypto.getRandomValues(new Uint32Array(2)),b[x]=C[0],b[x+1]=C[1]):(F.push(O%1e14),x+=2);x=D/2}else if(crypto.randomBytes){for(b=crypto.randomBytes(D*=7);x<D;)O=(b[x]&31)*281474976710656+b[x+1]*1099511627776+b[x+2]*4294967296+b[x+3]*16777216+(b[x+4]<<16)+(b[x+5]<<8)+b[x+6],O>=9e15?crypto.randomBytes(7).copy(b,x):(F.push(O%1e14),x+=7);x=D/7}else throw f=!1,Error(Dt+"crypto unavailable");if(!f)for(;x<D;)O=g(),O<9e15&&(F[x++]=O%1e14);for(D=F[--x],E%=me,D&&E&&(O=$c[me-E],F[x]=Dr(D/O)*O);F[x]===0;F.pop(),x--);if(x<0)F=[P=0];else{for(P=-1;F[0]===0;F.splice(0,1),P-=me);for(x=1,O=F[0];O>=10;O/=10,x++);x<me&&(P-=me-x)}return $.e=P,$.c=F,$}}(),k.sum=function(){for(var d=1,g=arguments,E=new k(g[0]);d<g.length;)E=E.plus(g[d++]);return E},r=function(){var d="0123456789";function g(E,b,C,P){for(var D,O=[0],x,F=0,$=E.length;F<$;){for(x=O.length;x--;O[x]*=b);for(O[0]+=P.indexOf(E.charAt(F++)),D=0;D<O.length;D++)O[D]>C-1&&(O[D+1]==null&&(O[D+1]=0),O[D+1]+=O[D]/C|0,O[D]%=C)}return O.reverse()}return function(E,b,C,P,D){var O,x,F,$,H,re,ee,ge,_e=E.indexOf("."),oe=a,ce=c;for(_e>=0&&($=S,S=0,E=E.replace(".",""),ge=new k(b),re=ge.pow(E.length-_e),S=$,ge.c=g(en(ar(re.c),re.e,"0"),10,C,d),ge.e=ge.c.length),ee=g(E,b,C,D?(O=I,d):(O=d,I)),F=$=ee.length;ee[--$]==0;ee.pop());if(!ee[0])return O.charAt(0);if(_e<0?--F:(re.c=ee,re.e=F,re.s=P,re=e(re,ge,oe,ce,C),ee=re.c,H=re.r,F=re.e),x=F+oe+1,_e=ee[x],$=C/2,H=H||x<0||ee[x+1]!=null,H=ce<4?(_e!=null||H)&&(ce==0||ce==(re.s<0?3:2)):_e>$||_e==$&&(ce==4||H||ce==6&&ee[x-1]&1||ce==(re.s<0?8:7)),x<1||!ee[0])E=H?en(O.charAt(1),-oe,O.charAt(0)):O.charAt(0);else{if(ee.length=x,H)for(--C;++ee[--x]>C;)ee[x]=0,x||(++F,ee=[1].concat(ee));for($=ee.length;!ee[--$];);for(_e=0,E="";_e<=$;E+=O.charAt(ee[_e++]));E=en(E,F,O.charAt(0))}return E}}(),e=function(){function d(b,C,P){var D,O,x,F,$=0,H=b.length,re=C%Rn,ee=C/Rn|0;for(b=b.slice();H--;)x=b[H]%Rn,F=b[H]/Rn|0,D=ee*x+F*re,O=re*x+D%Rn*Rn+$,$=(O/P|0)+(D/Rn|0)+ee*F,b[H]=O%P;return $&&(b=[$].concat(b)),b}function g(b,C,P,D){var O,x;if(P!=D)x=P>D?1:-1;else for(O=x=0;O<P;O++)if(b[O]!=C[O]){x=b[O]>C[O]?1:-1;break}return x}function E(b,C,P,D){for(var O=0;P--;)b[P]-=O,O=b[P]<C[P]?1:0,b[P]=O*D+b[P]-C[P];for(;!b[0]&&b.length>1;b.splice(0,1));}return function(b,C,P,D,O){var x,F,$,H,re,ee,ge,_e,oe,ce,Ae,Be,fr,$t,ht,it,Kt,Ze=b.s==C.s?1:-1,We=b.c,le=C.c;if(!We||!We[0]||!le||!le[0])return new k(!b.s||!C.s||(We?le&&We[0]==le[0]:!le)?NaN:We&&We[0]==0||!le?Ze*0:Ze/0);for(_e=new k(Ze),oe=_e.c=[],F=b.e-C.e,Ze=P+F+1,O||(O=wr,F=sr(b.e/me)-sr(C.e/me),Ze=Ze/me|0),$=0;le[$]==(We[$]||0);$++);if(le[$]>(We[$]||0)&&F--,Ze<0)oe.push(1),H=!0;else{for($t=We.length,it=le.length,$=0,Ze+=2,re=Dr(O/(le[0]+1)),re>1&&(le=d(le,re,O),We=d(We,re,O),it=le.length,$t=We.length),fr=it,ce=We.slice(0,it),Ae=ce.length;Ae<it;ce[Ae++]=0);Kt=le.slice(),Kt=[0].concat(Kt),ht=le[0],le[1]>=O/2&&ht++;do{if(re=0,x=g(le,ce,it,Ae),x<0){if(Be=ce[0],it!=Ae&&(Be=Be*O+(ce[1]||0)),re=Dr(Be/ht),re>1)for(re>=O&&(re=O-1),ee=d(le,re,O),ge=ee.length,Ae=ce.length;g(ee,ce,ge,Ae)==1;)re--,E(ee,it<ge?Kt:le,ge,O),ge=ee.length,x=1;else re==0&&(x=re=1),ee=le.slice(),ge=ee.length;if(ge<Ae&&(ee=[0].concat(ee)),E(ce,ee,Ae,O),Ae=ce.length,x==-1)for(;g(le,ce,it,Ae)<1;)re++,E(ce,it<Ae?Kt:le,Ae,O),Ae=ce.length}else x===0&&(re++,ce=[0]);oe[$++]=re,ce[0]?ce[Ae++]=We[fr]||0:(ce=[We[fr]],Ae=1)}while((fr++<$t||ce[0]!=null)&&Ze--);H=ce[0]!=null,oe[0]||oe.splice(0,1)}if(O==wr){for($=1,Ze=oe[0];Ze>=10;Ze/=10,$++);_(_e,P+(_e.e=$+F*me-1)+1,D,H)}else _e.e=F,_e.r=+H;return _e}}();function V(d,g,E,b){var C,P,D,O,x;if(E==null?E=c:Ve(E,0,8),!d.c)return d.toString();if(C=d.c[0],D=d.e,g==null)x=ar(d.c),x=b==1||b==2&&(D<=o||D>=l)?no(x,D):en(x,D,"0");else if(d=_(new k(d),g,E),P=d.e,x=ar(d.c),O=x.length,b==1||b==2&&(g<=P||P<=o)){for(;O<g;x+="0",O++);x=no(x,P)}else if(g-=D,x=en(x,P,"0"),P+1>O){if(--g>0)for(x+=".";g--;x+="0");}else if(g+=P-O,g>0)for(P+1==O&&(x+=".");g--;x+="0");return d.s<0&&C?"-"+x:x}function z(d,g){for(var E,b=1,C=new k(d[0]);b<d.length;b++)if(E=new k(d[b]),E.s)g.call(C,E)&&(C=E);else{C=E;break}return C}function v(d,g,E){for(var b=1,C=g.length;!g[--C];g.pop());for(C=g[0];C>=10;C/=10,b++);return(E=b+E*me-1)>h?d.c=d.e=null:E<u?d.c=[d.e=0]:(d.e=E,d.c=g),d}n=function(){var d=/^(-?)0([xbo])(?=\w[\w.]*$)/i,g=/^([^.]+)\.$/,E=/^\.([^.]+)$/,b=/^-?(Infinity|NaN)$/,C=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(P,D,O,x){var F,$=O?D:D.replace(C,"");if(b.test($))P.s=isNaN($)?null:$<0?-1:1;else{if(!O&&($=$.replace(d,function(H,re,ee){return F=(ee=ee.toLowerCase())=="x"?16:ee=="b"?2:8,!x||x==F?re:H}),x&&(F=x,$=$.replace(g,"$1").replace(E,"0.$1")),D!=$))return new k($,F);if(k.DEBUG)throw Error(Dt+"Not a"+(x?" base "+x:"")+" number: "+D);P.s=null}P.c=P.e=null}}();function _(d,g,E,b){var C,P,D,O,x,F,$,H=d.c,re=$c;if(H){e:{for(C=1,O=H[0];O>=10;O/=10,C++);if(P=g-C,P<0)P+=me,D=g,x=H[F=0],$=x/re[C-D-1]%10|0;else if(F=Uc((P+1)/me),F>=H.length)if(b){for(;H.length<=F;H.push(0));x=$=0,C=1,P%=me,D=P-me+1}else break e;else{for(x=O=H[F],C=1;O>=10;O/=10,C++);P%=me,D=P-me+C,$=D<0?0:x/re[C-D-1]%10|0}if(b=b||g<0||H[F+1]!=null||(D<0?x:x%re[C-D-1]),b=E<4?($||b)&&(E==0||E==(d.s<0?3:2)):$>5||$==5&&(E==4||b||E==6&&(P>0?D>0?x/re[C-D]:0:H[F-1])%10&1||E==(d.s<0?8:7)),g<1||!H[0])return H.length=0,b?(g-=d.e+1,H[0]=re[(me-g%me)%me],d.e=-g||0):H[0]=d.e=0,d;if(P==0?(H.length=F,O=1,F--):(H.length=F+1,O=re[me-P],H[F]=D>0?Dr(x/re[C-D]%re[D])*O:0),b)for(;;)if(F==0){for(P=1,D=H[0];D>=10;D/=10,P++);for(D=H[0]+=O,O=1;D>=10;D/=10,O++);P!=O&&(d.e++,H[0]==wr&&(H[0]=1));break}else{if(H[F]+=O,H[F]!=wr)break;H[F--]=0,O=1}for(P=H.length;H[--P]===0;H.pop());}d.e>h?d.c=d.e=null:d.e<u&&(d.c=[d.e=0])}return d}function A(d){var g,E=d.e;return E===null?d.toString():(g=ar(d.c),g=E<=o||E>=l?no(g,E):en(g,E,"0"),d.s<0?"-"+g:g)}return i.absoluteValue=i.abs=function(){var d=new k(this);return d.s<0&&(d.s=1),d},i.comparedTo=function(d,g){return Xi(this,new k(d,g))},i.decimalPlaces=i.dp=function(d,g){var E,b,C,P=this;if(d!=null)return Ve(d,0,ot),g==null?g=c:Ve(g,0,8),_(new k(P),d+P.e+1,g);if(!(E=P.c))return null;if(b=((C=E.length-1)-sr(this.e/me))*me,C=E[C])for(;C%10==0;C/=10,b--);return b<0&&(b=0),b},i.dividedBy=i.div=function(d,g){return e(this,new k(d,g),a,c)},i.dividedToIntegerBy=i.idiv=function(d,g){return e(this,new k(d,g),0,1)},i.exponentiatedBy=i.pow=function(d,g){var E,b,C,P,D,O,x,F,$,H=this;if(d=new k(d),d.c&&!d.isInteger())throw Error(Dt+"Exponent not an integer: "+A(d));if(g!=null&&(g=new k(g)),O=d.e>14,!H.c||!H.c[0]||H.c[0]==1&&!H.e&&H.c.length==1||!d.c||!d.c[0])return $=new k(Math.pow(+A(H),O?2-ro(d):+A(d))),g?$.mod(g):$;if(x=d.s<0,g){if(g.c?!g.c[0]:!g.s)return new k(NaN);b=!x&&H.isInteger()&&g.isInteger(),b&&(H=H.mod(g))}else{if(d.e>9&&(H.e>0||H.e<-1||(H.e==0?H.c[0]>1||O&&H.c[1]>=24e7:H.c[0]<8e13||O&&H.c[0]<=9999975e7)))return P=(H.s<0&&ro(d),-0),H.e>-1&&(P=1/P),new k(x?1/P:P);S&&(P=Uc(S/me+2))}for(O?(E=new k(.5),x&&(d.s=1),F=ro(d)):(C=Math.abs(+A(d)),F=C%2),$=new k(s);;){if(F){if($=$.times(H),!$.c)break;P?$.c.length>P&&($.c.length=P):b&&($=$.mod(g))}if(C){if(C=Dr(C/2),C===0)break;F=C%2}else if(d=d.times(E),_(d,d.e+1,1),d.e>14)F=ro(d);else{if(C=+A(d),C===0)break;F=C%2}H=H.times(H),P?H.c&&H.c.length>P&&(H.c.length=P):b&&(H=H.mod(g))}return b?$:(x&&($=s.div($)),g?$.mod(g):P?_($,S,c,D):$)},i.integerValue=function(d){var g=new k(this);return d==null?d=c:Ve(d,0,8),_(g,g.e+1,d)},i.isEqualTo=i.eq=function(d,g){return Xi(this,new k(d,g))===0},i.isFinite=function(){return!!this.c},i.isGreaterThan=i.gt=function(d,g){return Xi(this,new k(d,g))>0},i.isGreaterThanOrEqualTo=i.gte=function(d,g){return(g=Xi(this,new k(d,g)))===1||g===0},i.isInteger=function(){return!!this.c&&sr(this.e/me)>this.c.length-2},i.isLessThan=i.lt=function(d,g){return Xi(this,new k(d,g))<0},i.isLessThanOrEqualTo=i.lte=function(d,g){return(g=Xi(this,new k(d,g)))===-1||g===0},i.isNaN=function(){return!this.s},i.isNegative=function(){return this.s<0},i.isPositive=function(){return this.s>0},i.isZero=function(){return!!this.c&&this.c[0]==0},i.minus=function(d,g){var E,b,C,P,D=this,O=D.s;if(d=new k(d,g),g=d.s,!O||!g)return new k(NaN);if(O!=g)return d.s=-g,D.plus(d);var x=D.e/me,F=d.e/me,$=D.c,H=d.c;if(!x||!F){if(!$||!H)return $?(d.s=-g,d):new k(H?D:NaN);if(!$[0]||!H[0])return H[0]?(d.s=-g,d):new k($[0]?D:(c==3,-0))}if(x=sr(x),F=sr(F),$=$.slice(),O=x-F){for((P=O<0)?(O=-O,C=$):(F=x,C=H),C.reverse(),g=O;g--;C.push(0));C.reverse()}else for(b=(P=(O=$.length)<(g=H.length))?O:g,O=g=0;g<b;g++)if($[g]!=H[g]){P=$[g]<H[g];break}if(P&&(C=$,$=H,H=C,d.s=-d.s),g=(b=H.length)-(E=$.length),g>0)for(;g--;$[E++]=0);for(g=wr-1;b>O;){if($[--b]<H[b]){for(E=b;E&&!$[--E];$[E]=g);--$[E],$[b]+=wr}$[b]-=H[b]}for(;$[0]==0;$.splice(0,1),--F);return $[0]?v(d,$,F):(d.s=c==3?-1:1,d.c=[d.e=0],d)},i.modulo=i.mod=function(d,g){var E,b,C=this;return d=new k(d,g),!C.c||!d.s||d.c&&!d.c[0]?new k(NaN):!d.c||C.c&&!C.c[0]?new k(C):(p==9?(b=d.s,d.s=1,E=e(C,d,0,3),d.s=b,E.s*=b):E=e(C,d,0,p),d=C.minus(E.times(d)),!d.c[0]&&p==1&&(d.s=C.s),d)},i.multipliedBy=i.times=function(d,g){var E,b,C,P,D,O,x,F,$,H,re,ee,ge,_e,oe,ce=this,Ae=ce.c,Be=(d=new k(d,g)).c;if(!Ae||!Be||!Ae[0]||!Be[0])return!ce.s||!d.s||Ae&&!Ae[0]&&!Be||Be&&!Be[0]&&!Ae?d.c=d.e=d.s=null:(d.s*=ce.s,!Ae||!Be?d.c=d.e=null:(d.c=[0],d.e=0)),d;for(b=sr(ce.e/me)+sr(d.e/me),d.s*=ce.s,x=Ae.length,H=Be.length,x<H&&(ge=Ae,Ae=Be,Be=ge,C=x,x=H,H=C),C=x+H,ge=[];C--;ge.push(0));for(_e=wr,oe=Rn,C=H;--C>=0;){for(E=0,re=Be[C]%oe,ee=Be[C]/oe|0,D=x,P=C+D;P>C;)F=Ae[--D]%oe,$=Ae[D]/oe|0,O=ee*F+$*re,F=re*F+O%oe*oe+ge[P]+E,E=(F/_e|0)+(O/oe|0)+ee*$,ge[P--]=F%_e;ge[P]=E}return E?++b:ge.splice(0,1),v(d,ge,b)},i.negated=function(){var d=new k(this);return d.s=-d.s||null,d},i.plus=function(d,g){var E,b=this,C=b.s;if(d=new k(d,g),g=d.s,!C||!g)return new k(NaN);if(C!=g)return d.s=-g,b.minus(d);var P=b.e/me,D=d.e/me,O=b.c,x=d.c;if(!P||!D){if(!O||!x)return new k(C/0);if(!O[0]||!x[0])return x[0]?d:new k(O[0]?b:C*0)}if(P=sr(P),D=sr(D),O=O.slice(),C=P-D){for(C>0?(D=P,E=x):(C=-C,E=O),E.reverse();C--;E.push(0));E.reverse()}for(C=O.length,g=x.length,C-g<0&&(E=x,x=O,O=E,g=C),C=0;g;)C=(O[--g]=O[g]+x[g]+C)/wr|0,O[g]=wr===O[g]?0:O[g]%wr;return C&&(O=[C].concat(O),++D),v(d,O,D)},i.precision=i.sd=function(d,g){var E,b,C,P=this;if(d!=null&&d!==!!d)return Ve(d,1,ot),g==null?g=c:Ve(g,0,8),_(new k(P),d,g);if(!(E=P.c))return null;if(C=E.length-1,b=C*me+1,C=E[C]){for(;C%10==0;C/=10,b--);for(C=E[0];C>=10;C/=10,b++);}return d&&P.e+1>b&&(b=P.e+1),b},i.shiftedBy=function(d){return Ve(d,-Fc,Fc),this.times("1e"+d)},i.squareRoot=i.sqrt=function(){var d,g,E,b,C,P=this,D=P.c,O=P.s,x=P.e,F=a+4,$=new k("0.5");if(O!==1||!D||!D[0])return new k(!O||O<0&&(!D||D[0])?NaN:D?P:1/0);if(O=Math.sqrt(+A(P)),O==0||O==1/0?(g=ar(D),(g.length+x)%2==0&&(g+="0"),O=Math.sqrt(+g),x=sr((x+1)/2)-(x<0||x%2),O==1/0?g="5e"+x:(g=O.toExponential(),g=g.slice(0,g.indexOf("e")+1)+x),E=new k(g)):E=new k(O+""),E.c[0]){for(x=E.e,O=x+F,O<3&&(O=0);;)if(C=E,E=$.times(C.plus(e(P,C,F,1))),ar(C.c).slice(0,O)===(g=ar(E.c)).slice(0,O))if(E.e<x&&--O,g=g.slice(O-3,O+1),g=="9999"||!b&&g=="4999"){if(!b&&(_(C,C.e+a+2,0),C.times(C).eq(P))){E=C;break}F+=4,O+=4,b=1}else{(!+g||!+g.slice(1)&&g.charAt(0)=="5")&&(_(E,E.e+a+2,1),d=!E.times(E).eq(P));break}}return _(E,E.e+a+1,c,d)},i.toExponential=function(d,g){return d!=null&&(Ve(d,0,ot),d++),V(this,d,g,1)},i.toFixed=function(d,g){return d!=null&&(Ve(d,0,ot),d=d+this.e+1),V(this,d,g)},i.toFormat=function(d,g,E){var b,C=this;if(E==null)d!=null&&g&&typeof g=="object"?(E=g,g=null):d&&typeof d=="object"?(E=d,d=g=null):E=M;else if(typeof E!="object")throw Error(Dt+"Argument not an object: "+E);if(b=C.toFixed(d,g),C.c){var P,D=b.split("."),O=+E.groupSize,x=+E.secondaryGroupSize,F=E.groupSeparator||"",$=D[0],H=D[1],re=C.s<0,ee=re?$.slice(1):$,ge=ee.length;if(x&&(P=O,O=x,x=P,ge-=P),O>0&&ge>0){for(P=ge%O||O,$=ee.substr(0,P);P<ge;P+=O)$+=F+ee.substr(P,O);x>0&&($+=F+ee.slice(P)),re&&($="-"+$)}b=H?$+(E.decimalSeparator||"")+((x=+E.fractionGroupSize)?H.replace(new RegExp("\\d{"+x+"}\\B","g"),"$&"+(E.fractionGroupSeparator||"")):H):$}return(E.prefix||"")+b+(E.suffix||"")},i.toFraction=function(d){var g,E,b,C,P,D,O,x,F,$,H,re,ee=this,ge=ee.c;if(d!=null&&(O=new k(d),!O.isInteger()&&(O.c||O.s!==1)||O.lt(s)))throw Error(Dt+"Argument "+(O.isInteger()?"out of range: ":"not an integer: ")+A(O));if(!ge)return new k(ee);for(g=new k(s),F=E=new k(s),b=x=new k(s),re=ar(ge),P=g.e=re.length-ee.e-1,g.c[0]=$c[(D=P%me)<0?me+D:D],d=!d||O.comparedTo(g)>0?P>0?g:F:O,D=h,h=1/0,O=new k(re),x.c[0]=0;!($=e(O,g,0,1),C=E.plus($.times(b)),C.comparedTo(d)==1);)E=b,b=C,F=x.plus($.times(C=F)),x=C,g=O.minus($.times(C=g)),O=C;return C=e(d.minus(E),b,0,1),x=x.plus(C.times(F)),E=E.plus(C.times(b)),x.s=F.s=ee.s,P=P*2,H=e(F,b,P,c).minus(ee).abs().comparedTo(e(x,E,P,c).minus(ee).abs())<1?[F,b]:[x,E],h=D,H},i.toNumber=function(){return+A(this)},i.toPrecision=function(d,g){return d!=null&&Ve(d,1,ot),V(this,d,g,2)},i.toString=function(d){var g,E=this,b=E.s,C=E.e;return C===null?b?(g="Infinity",b<0&&(g="-"+g)):g="NaN":(d==null?g=C<=o||C>=l?no(ar(E.c),C):en(ar(E.c),C,"0"):d===10?(E=_(new k(E),a+C+1,c),g=en(ar(E.c),E.e,"0")):(Ve(d,2,I.length,"Base"),g=r(en(ar(E.c),C,"0"),10,d,b,!0)),b<0&&E.c[0]&&(g="-"+g)),g},i.valueOf=i.toJSON=function(){return A(this)},i._isBigNumber=!0,i[Symbol.toStringTag]="BigNumber",i[Symbol.for("nodejs.util.inspect.custom")]=i.valueOf,t!=null&&k.set(t),k}function sr(t){var e=t|0;return t>0||t===e?e:e-1}function ar(t){for(var e,r,n=1,i=t.length,s=t[0]+"";n<i;){for(e=t[n++]+"",r=me-e.length;r--;e="0"+e);s+=e}for(i=s.length;s.charCodeAt(--i)===48;);return s.slice(0,i+1||1)}function Xi(t,e){var r,n,i=t.c,s=e.c,a=t.s,c=e.s,o=t.e,l=e.e;if(!a||!c)return null;if(r=i&&!i[0],n=s&&!s[0],r||n)return r?n?0:-c:a;if(a!=c)return a;if(r=a<0,n=o==l,!i||!s)return n?0:!i^r?1:-1;if(!n)return o>l^r?1:-1;for(c=(o=i.length)<(l=s.length)?o:l,a=0;a<c;a++)if(i[a]!=s[a])return i[a]>s[a]^r?1:-1;return o==l?0:o>l^r?1:-1}function Ve(t,e,r,n){if(t<e||t>r||t!==Dr(t))throw Error(Dt+(n||"Argument")+(typeof t=="number"?t<e||t>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(t))}function ro(t){var e=t.c.length-1;return sr(t.e/me)==e&&t.c[e]%2!=0}function no(t,e){return(t.length>1?t.charAt(0)+"."+t.slice(1):t)+(e<0?"e":"e+")+e}function en(t,e,r){var n,i;if(e<0){for(i=r+".";++e;i+=r);t=i+t}else if(n=t.length,++e>n){for(i=r,e-=n;--e;i+=r);t+=i}else e<n&&(t=t.slice(0,e)+"."+t.slice(e));return t}var nh=rh(),w0=Object.freeze({__proto__:null,BigNumber:nh,default:nh}),ih=te(function(t,e){const r=Math.exp;e=t.exports=function(i){if(typeof i!="number")throw new Error("must provide a timespan to the moving average constructor");if(i<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let s,a=0,c=0,o=0,l,u={};function h(f,p){return 1-r(-(f-p)/i)}return u.push=function(p,S){if(l){const M=h(p,l),I=S-s,k=M*I;s=M*S+(1-M)*s,a=(1-M)*(a+I*k),c=Math.sqrt(a),o=s+M*I}else s=S;l=p},u.movingAverage=function(){return s},u.variance=function(){return a},u.deviation=function(){return c},u.forecast=function(){return o},u}}),sh=Ag(w0);class _0 extends St{constructor(t,e){super();this._options=e,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this);const r=this._options.movingAverageIntervals;for(var n=0;n<t.length;n++){var i=t[n];this._stats[i]=sh(0),this._movingAverages[i]={};for(var s=0;s<r.length;s++){var a=r[s],c=this._movingAverages[i][a]=ih(a);c.push(this._frequencyLastTime,0)}}}start(){this._queue.length&&this._resetComputeTimeout()}stop(){this._timeout&&(this._timeout.clear(),this._timeout=null)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}toJSON(){const t=this.snapshot,e=this.movingAverages,r={dataReceived:t.dataReceived.toString(),dataSent:t.dataSent.toString(),movingAverages:{}},n=Object.keys(e);for(const i of n){r.movingAverages[i]={};for(const s of Object.keys(e[i]))r.movingAverages[i][s]=e[i][s].movingAverage()}return r}push(t,e){this._queue.push([t,e,Date.now()]),this._resetComputeTimeout()}_resetComputeTimeout(){this._timeout=ni(this._update,this._nextTimeout())}_nextTimeout(){const t=this._queue.length/this._options.computeThrottleMaxQueueSize,e=Math.max(this._options.computeThrottleTimeout*(1-t),0);return e}_update(){if(this._timeout=null,this._queue.length){let t;for(t of this._queue)this._applyOp(t);this._queue=[],this._updateFrequency(t[2]),this.emit("update",this._stats)}}_updateFrequency(t){const e=t-this._frequencyLastTime;Object.keys(this._stats).forEach(r=>{this._updateFrequencyFor(r,e,t)}),this._frequencyLastTime=t}_updateFrequencyFor(t,e,r){const n=this._frequencyAccumulators[t]||0;this._frequencyAccumulators[t]=0;const i=e||1,s=n/i*1e3;let a=this._movingAverages[t];a||(a=this._movingAverages[t]={});const c=this._options.movingAverageIntervals;for(var o=0;o<c.length;o++){var l=c[o],u=a[l];u||(u=a[l]=ih(l)),u.push(r,s)}}_applyOp(t){const e=t[0],r=t[1];if(typeof r!="number")throw new Error("invalid increment number:",r);let n;Object.prototype.hasOwnProperty.call(this._stats,e)?n=this._stats[e]:n=this._stats[e]=sh(0),this._stats[e]=n.plus(r),this._frequencyAccumulators[e]||(this._frequencyAccumulators[e]=0),this._frequencyAccumulators[e]+=r}}var qc=_0;const{tap:ah}=ic,{METRICS:E0}=ta,Vc=["dataReceived","dataSent"],S0={in:"dataReceived",out:"dataSent"};class oh{constructor(t){this._options=Wa(E0,t),this._globalStats=new qc(Vc,this._options),this._peerStats=new Map,this._protocolStats=new Map,this._oldPeers=y0(this._options.maxOldPeersRetention),this._running=!1,this._onMessage=this._onMessage.bind(this),this._connectionManager=t.connectionManager,this._connectionManager.on("peer:disconnect",e=>{this.onPeerDisconnected(e.remotePeer)})}start(){this._running=!0}stop(){this._running=!1,this._globalStats.stop();for(const t of this._peerStats.values())t.stop();for(const t of this._protocolStats.values())t.stop()}get global(){return this._globalStats}get peers(){return Array.from(this._peerStats.keys())}forPeer(t){const e=t.toB58String();return this._peerStats.get(e)||this._oldPeers.get(e)}get protocols(){return Array.from(this._protocolStats.keys())}forProtocol(t){return this._protocolStats.get(t)}onPeerDisconnected(t){const e=t.toB58String(),r=this._peerStats.get(e);r&&(r.stop(),this._peerStats.delete(e),this._oldPeers.set(e,r))}_onMessage({remotePeer:t,protocol:e,direction:r,dataLength:n}){if(!this._running)return;const i=S0[r];let s=this.forPeer(t);if(s||(s=new qc(Vc,this._options),this._peerStats.set(t.toB58String(),s)),s.push(i,n),this._globalStats.push(i,n),e){let a=this.forProtocol(e);a||(a=new qc(Vc,this._options),this._protocolStats.set(e,a)),a.push(i,n)}}updatePlaceholder(t,e){if(!this._running)return;const r=this.forPeer(t),n=e.toB58String(),i=this.forPeer(e);let s=r;i&&(s=oh.mergeStats(i,s),this._oldPeers.delete(n)),this._peerStats.delete(t.toB58String()),this._peerStats.set(n,s),s.start()}trackStream({stream:t,remotePeer:e,protocol:r}){const n=this,i=t.source;t.source=ah(a=>n._onMessage({remotePeer:e,protocol:r,direction:"in",dataLength:a.length}))(i);const s=t.sink;return t.sink=a=>gt(a,ah(c=>n._onMessage({remotePeer:e,protocol:r,direction:"out",dataLength:c.length})),s),t}static mergeStats(t,e){return t.stop(),e.stop(),t._queue=[...t._queue,...e._queue],t}}var T0=oh,xt=te(function(t,e){const r=je(`
`);async function n(i){for await(const s of i)return s}e.encode=i=>Je.encode.single(new ut([i,r])),e.write=(i,s)=>i.push(e.encode(s)),e.writeAll=(i,s)=>{i.push(s.reduce((a,c)=>a.append(e.encode(c)),new ut))},e.read=async i=>{let s=1;const a={[Symbol.asyncIterator](){return this},next:()=>i.next(s)},c=l=>{s=l},o=await gt(a,Je.decode({onLength:c}),n);if(o.get(o.length-1)!==r[0])throw U(new Error("missing newline"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return o.shallowSlice(0,-1)}});const Qi=Q("mss:select");var ch=async(t,e,r)=>{e=Array.isArray(e)?[...e]:[e];const{reader:n,writer:i,rest:s,stream:a}=sa(t),c=e.shift();r?(Qi('select: write ["%s", "%s"]',r,c),xt.writeAll(i,[r,c])):(Qi('select: write "%s"',c),xt.write(i,c));let o=(await xt.read(n)).toString();if(Qi('select: read "%s"',o),o===r&&(o=(await xt.read(n)).toString(),Qi('select: read "%s"',o)),o===c)return s(),{stream:a,protocol:c};for(const l of e){Qi('select: write "%s"',l),xt.write(i,l);const u=(await xt.read(n)).toString();if(Qi('select: read "%s" for "%s"',u,l),u===l)return s(),{stream:a,protocol:l}}throw s(),U(new Error("protocol selection failed"),"ERR_UNSUPPORTED_PROTOCOL")},A0="/multistream/1.0.0",lh={PROTOCOL_ID:A0};const oa=Q("mss:handle"),{PROTOCOL_ID:Gc}=lh;var C0=async(t,e)=>{e=Array.isArray(e)?e:[e];const{writer:r,reader:n,rest:i,stream:s}=sa(t);for(;;){const a=(await xt.read(n)).toString();if(oa('read "%s"',a),a===Gc){oa('respond with "%s" for "%s"',Gc,a),xt.write(r,Gc);continue}if(e.includes(a))return xt.write(r,a),oa('respond with "%s" for "%s"',a,a),i(),{stream:s,protocol:a};if(a==="ls"){xt.write(r,new ut(e.map(c=>xt.encode(c)))),oa('respond with "%s" for %s',e,a);continue}xt.write(r,"na"),oa('respond with "na" for "%s"',a)}};const I0=Q("it-multistream-select:ls");var R0=async t=>{const{reader:e,writer:r,rest:n,stream:i}=sa(t);I0('write "ls"'),xt.write(r,"ls"),n();const s=await xt.read(e),a=zd([s]),c=[];return await gt(a,Je.decode(),async o=>{for await(const l of o)c.push(l.shallowSlice(0,-1).toString())}),{stream:i,protocols:c}};const{PROTOCOL_ID:zc}=lh;var k0=zc;class uh{constructor(t){this._stream=t,this._shaken=!1}async _handshake(){if(this._shaken)return;const{stream:t}=await ch(this._stream,zc);this._stream=t,this._shaken=!0}}class P0 extends uh{select(t){return ch(this._stream,t,this._shaken?null:zc)}async ls(){await this._handshake();const{stream:t,protocols:e}=await R0(this._stream);return this._stream=t,e}}var N0=P0;class O0 extends uh{handle(t){return C0(this._stream,t)}}var M0=O0,Yi={PROTOCOL_ID:k0,Dialer:N0,Listener:M0};const D0=Tt,Hc=Tt.v4,dh=Tt.v6,hh=function(t,e,r){r=~~r;var n;if(Hc(t))n=e||new Uint8Array(r+4),t.split(/\./g).map(function(u){n[r++]=parseInt(u,10)&255});else if(dh(t)){var i=t.split(":",8),s;for(s=0;s<i.length;s++){var a=Hc(i[s]),c;a&&(c=hh(i[s]),i[s]=se(c.slice(0,2),"base16")),c&&++s<8&&i.splice(s,0,se(c.slice(2,4),"base16"))}if(i[0]==="")for(;i.length<8;)i.unshift("0");else if(i[i.length-1]==="")for(;i.length<8;)i.push("0");else if(i.length<8){for(s=0;s<i.length&&i[s]!=="";s++);var o=[s,"1"];for(s=9-i.length;s>0;s--)o.push("0");i.splice.apply(i,o)}for(n=e||new Uint8Array(r+16),s=0;s<i.length;s++){var l=parseInt(i[s],16);n[r++]=l>>8&255,n[r++]=l&255}}if(!n)throw Error("Invalid ip address: "+t);return n},x0=function(t,e,r){e=~~e,r=r||t.length-e;var n=[],i;const s=new DataView(t.buffer);if(r===4){for(let a=0;a<r;a++)n.push(t[e+a]);i=n.join(".")}else if(r===16){for(let a=0;a<r;a+=2)n.push(s.getUint16(e+a).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i};var io={isIP:D0,isV4:Hc,isV6:dh,toBytes:hh,toString:x0};function jt(t){if(typeof t=="number"){if(jt.codes[t])return jt.codes[t];throw new Error("no protocol with code: "+t)}else if(typeof t=="string"||t instanceof String){if(jt.names[t])return jt.names[t];throw new Error("no protocol with name: "+t)}throw new Error("invalid protocol id type: "+t)}const or=-1;jt.lengthPrefixedVarSize=or,jt.V=or,jt.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,or,"ip6zone"],[53,or,"dns","resolvable"],[54,or,"dns4","resolvable"],[55,or,"dns6","resolvable"],[56,or,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,or,"unix",!1,"path"],[421,or,"ipfs"],[421,or,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,or,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,or,"memory"]],jt.names={},jt.codes={},jt.table.map(t=>{const e=ph.apply(null,t);jt.codes[e.code]=e,jt.names[e.name]=e}),jt.object=ph;function ph(t,e,r,n,i){return{code:t,size:e,name:r,resolvable:Boolean(n),path:Boolean(i)}}var xr=jt,fh=ca;function ca(t,e){return e instanceof Uint8Array?ca.toString(t,e):ca.toBytes(t,e)}ca.toString=function(e,r){e=xr(e);switch(e.code){case 4:case 41:return j0(r);case 6:case 273:case 33:case 132:return gh(r);case 53:case 54:case 55:case 56:case 400:case 777:return B0(r);case 421:return F0(r);case 444:return bh(r);case 445:return bh(r);default:return se(r,"base16")}},ca.toBytes=function(e,r){e=xr(e);switch(e.code){case 4:return mh(r);case 41:return mh(r);case 6:case 273:case 33:case 132:return Wc(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return L0(r);case 421:return U0(r);case 444:return $0(r);case 445:return q0(r);default:return je(r,"base16")}};function mh(t){if(!io.isIP(t))throw new Error("invalid ip address");return io.toBytes(t)}function j0(t){const e=io.toString(t);if(!e||!io.isIP(e))throw new Error("invalid ip address");return e}function Wc(t){const e=new ArrayBuffer(2),r=new DataView(e);return r.setUint16(0,t),new Uint8Array(e)}function gh(t){const e=new DataView(t.buffer);return e.getUint16(0)}function L0(t){const e=je(t),r=Uint8Array.from(J.encode(e.length));return we([r,e],r.length+e.length)}function B0(t){const e=J.decode(t);if(t=t.slice(J.decode.bytes),t.length!==e)throw new Error("inconsistent lengths");return se(t)}function U0(t){const e=new Nr(t).multihash,r=Uint8Array.from(J.encode(e.length));return we([r,e],r.length+e.length)}function F0(t){const e=J.decode(t),r=t.slice(J.decode.bytes);if(r.length!==e)throw new Error("inconsistent lengths");return se(r,"base58btc")}function $0(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==16)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion address.");const r=Or.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Wc(n);return we([r,i],r.length+i.length)}function q0(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==56)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion3 address.");const r=Or.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Wc(n);return we([r,i],r.length+i.length)}function bh(t){const e=t.slice(0,t.length-2),r=t.slice(t.length-2),n=se(e,"base32"),i=gh(r);return n+":"+i}var _r={stringToStringTuples:yh,stringTuplesToString:vh,tuplesToStringTuples:_h,stringTuplesToTuples:wh,bytesToTuples:Kc,tuplesToBytes:Eh,bytesToString:V0,stringToBytes:Th,fromString:G0,fromBytes:Ah,validateBytes:Xc,isValidBytes:z0,cleanPath:so,ParseError:Qc,protoFromTuple:la,sizeForAddr:Sh};function yh(t){const e=[],r=t.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let n=0;n<r.length;n++){const i=r[n],s=xr(i);if(s.size===0){e.push([i]);continue}if(n++,n>=r.length)throw Qc("invalid address: "+t);if(s.path){e.push([i,so(r.slice(n).join("/"))]);break}e.push([i,r[n]])}return e}function vh(t){const e=[];return t.map(r=>{const n=la(r);e.push(n.name),r.length>1&&e.push(r[1])}),so(e.join("/"))}function wh(t){return t.map(e=>{Array.isArray(e)||(e=[e]);const r=la(e);return e.length>1?[r.code,fh.toBytes(r.code,e[1])]:[r.code]})}function _h(t){return t.map(e=>{const r=la(e);return e.length>1?[r.code,fh.toString(r.code,e[1])]:[r.code]})}function Eh(t){return Ah(we(t.map(e=>{const r=la(e);let n=Uint8Array.from(J.encode(r.code));return e.length>1&&(n=we([n,e[1]])),n})))}function Sh(t,e){if(t.size>0)return t.size/8;if(t.size===0)return 0;{const r=J.decode(e);return r+J.decode.bytes}}function Kc(t){const e=[];let r=0;for(;r<t.length;){const n=J.decode(t,r),i=J.decode.bytes,s=xr(n),a=Sh(s,t.slice(r+i));if(a===0){e.push([n]),r+=i;continue}const c=t.slice(r+i,r+i+a);if(r+=a+i,r>t.length)throw Qc("Invalid address Uint8Array: "+se(t,"base16"));e.push([n,c])}return e}function V0(t){const e=Kc(t),r=_h(e);return vh(r)}function Th(t){t=so(t);const e=yh(t),r=wh(e);return Eh(r)}function G0(t){return Th(t)}function Ah(t){const e=Xc(t);if(e)throw e;return Uint8Array.from(t)}function Xc(t){try{Kc(t)}catch(e){return e}}function z0(t){return Xc(t)===void 0}function so(t){return"/"+t.trim().split("/").filter(e=>e).join("/")}function Qc(t){return new Error("Error parsing address: "+t)}function la(t){const e=xr(t[0]);return e}var H0=te(function(t,e){const r=Symbol.for("nodejs.util.inspect.custom"),n=Ht.proto(function(i){if(!(this instanceof n))return new n(i);if(i==null&&(i=""),i instanceof Uint8Array)this.bytes=_r.fromBytes(i);else if(typeof i=="string"||i instanceof String){if(i.length>0&&i.charAt(0)!=="/")throw new Error(`multiaddr "${i}" must start with a "/"`);this.bytes=_r.fromString(i)}else if(i.bytes&&i.protos&&i.protoCodes)this.bytes=_r.fromBytes(i.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});n.prototype.toString=function(){return _r.bytesToString(this.bytes)},n.prototype.toJSON=n.prototype.toString,n.prototype.toOptions=function(){const s={},a=this.toString().split("/");return s.family=a[1]==="ip4"?"ipv4":"ipv6",s.host=a[2],s.transport=a[3],s.port=parseInt(a[4]),s},n.prototype[r]=function(){return"<Multiaddr "+se(this.bytes,"base16")+" - "+_r.bytesToString(this.bytes)+">"},n.prototype.inspect=function(){return"<Multiaddr "+se(this.bytes,"base16")+" - "+_r.bytesToString(this.bytes)+">"},n.prototype.protos=function(){return this.protoCodes().map(s=>Object.assign({},xr(s)))},n.prototype.protoCodes=function(){const s=[],a=this.bytes;let c=0;for(;c<a.length;){const o=J.decode(a,c),l=J.decode.bytes,u=xr(o),h=_r.sizeForAddr(u,a.slice(c+l));c+=h+l,s.push(o)}return s},n.prototype.protoNames=function(){return this.protos().map(s=>s.name)},n.prototype.tuples=function(){return _r.bytesToTuples(this.bytes)},n.prototype.stringTuples=function(){const s=_r.bytesToTuples(this.bytes);return _r.tuplesToStringTuples(s)},n.prototype.encapsulate=function(s){return s=n(s),n(this.toString()+s.toString())},n.prototype.decapsulate=function(s){s=s.toString();const a=this.toString(),c=a.lastIndexOf(s);if(c<0)throw new Error("Address "+this+" does not contain subaddress: "+s);return n(a.slice(0,c))},n.prototype.decapsulateCode=function(s){const a=this.tuples();for(let c=a.length-1;c>=0;c--)if(a[c][0]===s)return n(_r.tuplesToBytes(a.slice(0,c)));return this},n.prototype.getPeerId=function(){let s=null;try{const a=this.stringTuples().filter(c=>{if(c[0]===xr.names.ipfs.code)return!0});s=a.pop()[1],s=se(new Nr(s).multihash,"base58btc")}catch(a){s=null}return s},n.prototype.getPath=function(){let s=null;try{s=this.stringTuples().filter(a=>{const c=xr(a[0]);if(c.path)return!0})[0][1]}catch(a){s=null}return s},n.prototype.equals=function(s){return tr(this.bytes,s.bytes)},n.prototype.nodeAddress=function(){const s=this.protoCodes(),a=this.protoNames(),c=this.toString().split("/").slice(1);if(c.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(s[0]!==4&&s[0]!==41&&s[0]!==54&&s[0]!==55)throw new Error(`no protocol with name: "'${a[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(c[2]!=="tcp"&&c[2]!=="udp")throw new Error(`no protocol with name: "'${a[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:s[0]===41||s[0]===55?6:4,address:c[1],port:parseInt(c[3])}},n.fromNodeAddress=function(s,a){if(!s)throw new Error("requires node address object");if(!a)throw new Error("requires transport protocol");let c;switch(s.family){case"IPv4":c="ip4";break;case"IPv6":c="ip6";break;default:throw Error(`Invalid addr family. Got '${s.family}' instead of 'IPv4' or 'IPv6'`)}return n("/"+[c,s.address,a,s.port].join("/"))},n.prototype.isThinWaistAddress=function(s){const a=(s||this).protos();return a.length!==2||a[0].code!==4&&a[0].code!==41?!1:!(a[1].code!==6&&a[1].code!==273)},n.protocols=xr,n.isName=function(s){return n.isMultiaddr(s)?s.protos().some(a=>a.resolvable):!1},n.resolve=function(s){return!n.isMultiaddr(s)||!n.isName(s)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},e=t.exports=n}),ci={OPEN:"open",CLOSING:"closing",CLOSED:"closed"};function W0(t,e,r,n,i,s,a){if(t&&!H0.isMultiaddr(t))throw U(new Error("localAddr must be an instance of multiaddr"),"ERR_INVALID_PARAMETERS");if(!be.isPeerId(e))throw U(new Error("localPeer must be an instance of peer-id"),"ERR_INVALID_PARAMETERS");if(!be.isPeerId(r))throw U(new Error("remotePeer must be an instance of peer-id"),"ERR_INVALID_PARAMETERS");if(typeof n!="function")throw U(new Error("new stream must be a function"),"ERR_INVALID_PARAMETERS");if(typeof i!="function")throw U(new Error("close must be a function"),"ERR_INVALID_PARAMETERS");if(typeof s!="function")throw U(new Error("getStreams must be a function"),"ERR_INVALID_PARAMETERS");if(!a)throw U(new Error("connection metadata object must be provided"),"ERR_INVALID_PARAMETERS");if(a.direction!=="inbound"&&a.direction!=="outbound")throw U(new Error('direction must be "inbound" or "outbound"'),"ERR_INVALID_PARAMETERS");if(!a.timeline)throw U(new Error("connection timeline object must be provided in the stat object"),"ERR_INVALID_PARAMETERS");if(!a.timeline.open)throw U(new Error("connection open timestamp must be provided"),"ERR_INVALID_PARAMETERS");if(!a.timeline.upgraded)throw U(new Error("connection upgraded timestamp must be provided"),"ERR_INVALID_PARAMETERS")}class K0{constructor({localAddr:t,remoteAddr:e,localPeer:r,remotePeer:n,newStream:i,close:s,getStreams:a,stat:c}){W0(t,r,n,i,s,a,c),this.id=parseInt(Math.random()*1e9).toString(36)+Date.now(),this.localAddr=t,this.remoteAddr=e,this.localPeer=r,this.remotePeer=n,this._stat={...c,status:ci.OPEN},this._newStream=i,this._close=s,this._getStreams=a,this.registry=new Map,this.tags=[]}get stat(){return this._stat}get streams(){return this._getStreams()}async newStream(t){if(this.stat.status===ci.CLOSING)throw U(new Error("the connection is being closed"),"ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===ci.CLOSED)throw U(new Error("the connection is closed"),"ERR_CONNECTION_CLOSED");Array.isArray(t)||(t=[t]);const{stream:e,protocol:r}=await this._newStream(t);return this.addStream(e,{protocol:r}),{stream:e,protocol:r}}addStream(t,{protocol:e,metadata:r={}}){this.registry.set(t.id,{protocol:e,...r})}removeStream(t){this.registry.delete(t)}async close(){if(this.stat.status===ci.CLOSED)return;if(this._closing)return this._closing;this.stat.status=ci.CLOSING,this._closing=await this._close(),this._stat.timeline.close=Date.now(),this.stat.status=ci.CLOSED}}var X0=Ht(K0,{className:"Connection",symbolName:"@libp2p/interface-connection/connection"}),Q0=X0,Y0={Connection:Q0};function J0(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}else return Array.from(t)}var Ch=function(e){var r=void 0,n=void 0;function i(c){if(!(c instanceof Object))throw new Error('Target "'+c+'" is not an object');n=c}function s(c){Object.keys(c).forEach(function(o){var l=c[o];if(typeof l!="function")throw new Error('Trap "'+o+": "+l+'" is not a function');if(!Reflect[o])throw new Error('Trap "'+o+": "+l+'" is not a valid trap')}),r=c}i(function(){}),e&&i(e),s(Reflect);var a=new Proxy({},{get:function(o,l){return function(){for(var u=arguments.length,h=Array(u),f=0;f<u;f++)h[f]=arguments[f];return r[l].apply(null,[n].concat(J0(h.slice(1))))}}});return{setTarget:i,setHandler:s,getTarget:function(){return n},getHandler:function(){return r},proxy:new Proxy(n,a)}};const Ke=Q("libp2p:upgrader");Ke.error=Q("libp2p:upgrader:error");const{Connection:Z0}=Y0,{codes:ua}=dt;class ew{constructor({localPeer:t,metrics:e,cryptos:r,muxers:n,onConnectionEnd:i=()=>{},onConnection:s=()=>{}}){this.localPeer=t,this.metrics=e,this.cryptos=r||new Map,this.muxers=n||new Map,this.protector=null,this.protocols=new Map,this.onConnection=s,this.onConnectionEnd=i}async upgradeInbound(t){let e,r,n,i,s,a,c;if(this.metrics){({setTarget:a,proxy:c}=Ch());const l=parseInt(Math.random()*1e9).toString(36)+Date.now();a({toB58String:()=>l}),t=this.metrics.trackStream({stream:t,remotePeer:c})}Ke("Starting the inbound connection upgrade");let o=t;this.protector&&(o=await this.protector.protect(t));try{({conn:e,remotePeer:r,protocol:s}=await this._encryptInbound(this.localPeer,o,this.cryptos)),this.muxers.size?{stream:n,Muxer:i}=await this._multiplexInbound(e,this.muxers):n=e}catch(l){throw Ke.error("Failed to upgrade inbound connection",l),await t.close(l),l}return this.metrics&&(this.metrics.updatePlaceholder(c,r),a(r)),Ke("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:s,direction:"inbound",maConn:t,upgradedConn:n,Muxer:i,remotePeer:r})}async upgradeOutbound(t){let e;try{e=be.createFromB58String(t.remoteAddr.getPeerId())}catch(u){Ke.error("multiaddr did not contain a valid peer id",u)}let r,n,i,s,a,c,o;if(this.metrics){({setTarget:c,proxy:o}=Ch());const u=parseInt(Math.random()*1e9).toString(36)+Date.now();c({toB58String:()=>u}),t=this.metrics.trackStream({stream:t,remotePeer:o})}Ke("Starting the outbound connection upgrade");let l=t;this.protector&&(l=await this.protector.protect(t));try{({conn:r,remotePeer:n,protocol:s}=await this._encryptOutbound(this.localPeer,l,e,this.cryptos)),this.muxers.size?{stream:i,Muxer:a}=await this._multiplexOutbound(r,this.muxers):i=r}catch(u){throw Ke.error("Failed to upgrade outbound connection",u),await t.close(u),u}return this.metrics&&(this.metrics.updatePlaceholder(o,n),c(n)),Ke("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:s,direction:"outbound",maConn:t,upgradedConn:i,Muxer:a,remotePeer:n})}_createConnection({cryptoProtocol:t,direction:e,maConn:r,upgradedConn:n,Muxer:i,remotePeer:s}){let a,c,o;i&&(a=new i({onStream:async h=>{const f=new Yi.Listener(h);try{const{stream:p,protocol:S}=await f.handle(Array.from(this.protocols.keys()));Ke("%s: incoming stream opened on %s",e,S),this.metrics&&this.metrics.trackStream({stream:p,remotePeer:s,protocol:S}),o.addStream(h,{protocol:S}),this._onStream({connection:o,stream:{...h,...p},protocol:S})}catch(p){Ke.error(p)}},onStreamEnd:h=>{o.removeStream(h.id)}}),c=async h=>{Ke("%s: starting new stream on %s",e,h);const f=a.newStream(),p=new Yi.Dialer(f);try{const{stream:S,protocol:M}=await p.select(h);return this.metrics&&this.metrics.trackStream({stream:S,remotePeer:s,protocol:M}),{stream:{...f,...S},protocol:M}}catch(S){throw Ke.error("could not create new stream",S),U(S,ua.ERR_UNSUPPORTED_PROTOCOL)}},gt(n,a,n).catch(Ke.error));const l=r.timeline;r.timeline=new Proxy(l,{set:(...h)=>(o&&h[1]==="close"&&h[2]&&!l.close&&(async()=>{try{o.stat.status===ci.OPEN&&await o.close()}catch(f){Ke.error(f)}finally{this.onConnectionEnd(o)}})(),Reflect.set(...h))}),r.timeline.upgraded=Date.now();const u=()=>{throw U(new Error("connection is not multiplexed"),"ERR_CONNECTION_NOT_MULTIPLEXED")};return o=new Z0({localAddr:r.localAddr,remoteAddr:r.remoteAddr,localPeer:this.localPeer,remotePeer:s,stat:{direction:e,timeline:r.timeline,multiplexer:i&&i.multicodec,encryption:t},newStream:c||u,getStreams:()=>a?a.streams:u,close:async h=>{await r.close(h),a&&a.streams.map(f=>f.abort(h))}}),this.onConnection(o),o}_onStream({connection:t,stream:e,protocol:r}){const n=this.protocols.get(r);n({connection:t,stream:e,protocol:r})}async _encryptInbound(t,e,r){const n=new Yi.Listener(e),i=Array.from(r.keys());Ke("handling inbound crypto protocol selection",i);try{const{stream:s,protocol:a}=await n.handle(i),c=r.get(a);return Ke("encrypting inbound connection..."),{...await c.secureInbound(t,s),protocol:a}}catch(s){throw U(s,ua.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(t,e,r,n){const i=new Yi.Dialer(e),s=Array.from(n.keys());Ke("selecting outbound crypto protocol",s);try{const{stream:a,protocol:c}=await i.select(s),o=n.get(c);return Ke("encrypting outbound connection to %j",r),{...await o.secureOutbound(t,a,r),protocol:c}}catch(a){throw U(a,ua.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(t,e){const r=new Yi.Dialer(t),n=Array.from(e.keys());Ke("outbound selecting muxer %s",n);try{const{stream:i,protocol:s}=await r.select(n);Ke("%s selected as muxer protocol",s);const a=e.get(s);return{stream:i,Muxer:a}}catch(i){throw U(i,ua.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(t,e){const r=new Yi.Listener(t),n=Array.from(e.keys());Ke("inbound handling muxers %s",n);try{const{stream:i,protocol:s}=await r.handle(n),a=e.get(s);return{stream:i,Muxer:a}}catch(i){throw U(i,ua.ERR_MUXER_UNAVAILABLE)}}}var tw=ew;const{codes:{ERR_INVALID_PARAMETERS:Ih}}=dt,rw=t=>t;class nw{constructor({peerStore:t,eventName:e,eventProperty:r,eventTransformer:n=rw}){this._ps=t,this.eventName=e,this.eventProperty=r,this.eventTransformer=n,this.data=new Map}set(t,e){throw U(new Error("set must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}_setData(t,e,{emit:r=!0}={}){const n=t.toB58String();this.data.set(n,e),r&&this._emit(t,e)}_emit(t,e){this._ps.emit(this.eventName,{peerId:t,[this.eventProperty]:this.eventTransformer(e)})}get(t){if(!be.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),Ih);const e=this.data.get(t.toB58String());return e?[...e]:void 0}delete(t){if(!be.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),Ih);return this.data.delete(t.toB58String())?(this._emit(t,[]),!0):!1}}var ao=nw;class iw{constructor(t,e){this.domain=t,this.codec=e}marshal(){throw U(new Error("marshal must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}equals(t){throw U(new Error("equals must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}}var sw=iw;function aw(t,e){return t.length===e.length&&e.sort()&&t.sort().every((r,n)=>e[n].equals(r))}var ow=aw;const cw=`
message PeerRecord {
    // AddressInfo is a wrapper around a binary multiaddr. It is defined as a
    // separate message to allow us to add per-address metadata in the future.
    message AddressInfo {
        bytes multiaddr = 1;
    }

    // peer_id contains a libp2p peer id in its binary representation.
    bytes peer_id = 1;

    // seq contains a monotonically-increasing sequence counter to order PeerRecords in time.
    uint64 seq = 2;

    // addresses is a list of public listen addresses for the peer.
    repeated AddressInfo addresses = 3;
}
`;var Rh=Mr(cw).PeerRecord,lw=Lu.getName(Lu.LIBP2P_PEER_RECORD),uw=Uint8Array.from([3,1]),dw={ENVELOPE_DOMAIN_PEER_RECORD:lw,ENVELOPE_PAYLOAD_TYPE_PEER_RECORD:uw};const{ENVELOPE_DOMAIN_PEER_RECORD:kh,ENVELOPE_PAYLOAD_TYPE_PEER_RECORD:hw}=dw;class oo extends sw{constructor({peerId:t,multiaddrs:e=[],seqNumber:r=Date.now()}){super(kh,hw);this.peerId=t,this.multiaddrs=e,this.seqNumber=r,this._marshal=void 0}marshal(){return this._marshal?this._marshal:(this._marshal=Rh.encode({peer_id:this.peerId.toBytes(),seq:this.seqNumber,addresses:this.multiaddrs.map(t=>({multiaddr:t.bytes}))}),this._marshal)}equals(t){return this.peerId.equals(t.peerId)?this.seqNumber!==t.seqNumber?!1:!!ow(this.multiaddrs,t.multiaddrs):!1}}oo.createFromProtobuf=t=>{const e=Rh.decode(t),r=be.createFromBytes(e.peer_id),n=(e.addresses||[]).map(s=>Ge(s.multiaddr)),i=e.seq;return new oo({peerId:r,multiaddrs:n,seqNumber:i})},oo.DOMAIN=kh;var co=oo;const pw=`
message Envelope {
  // public_key is the public key of the keypair the enclosed payload was
  // signed with.
  bytes public_key = 1;

  // payload_type encodes the type of payload, so that it can be deserialized
  // deterministically.
  bytes payload_type = 2;

  // payload is the actual payload carried inside this envelope.
  bytes payload = 3;

  // signature is the signature produced by the private key corresponding to
  // the enclosed public key, over the payload, prefixing a domain string for
  // additional security.
  bytes signature = 5;
}
`;var Ph=Mr(pw).Envelope;const fw=Q("libp2p:envelope");fw.error=Q("libp2p:envelope:error");const{codes:mw}=dt;class li{constructor({peerId:t,payloadType:e,payload:r,signature:n}){this.peerId=t,this.payloadType=e,this.payload=r,this.signature=n,this._marshal=void 0}marshal(){if(this._marshal)return this._marshal;const t=Eg.marshalPublicKey(this.peerId.pubKey);return this._marshal=Ph.encode({public_key:t,payload_type:this.payloadType,payload:this.payload,signature:this.signature}),this._marshal}equals(t){return tr(this.peerId.pubKey.bytes,t.peerId.pubKey.bytes)&&tr(this.payloadType,t.payloadType)&&tr(this.payload,t.payload)&&tr(this.signature,t.signature)}validate(t){const e=Nh(t,this.payloadType,this.payload);return this.peerId.pubKey.verify(e,this.signature)}}const Nh=(t,e,r)=>{t=je(t);const n=J.encode(t.byteLength),i=J.encode(e.length),s=J.encode(r.length);return we([new Uint8Array(n),t,new Uint8Array(i),e,new Uint8Array(s),r])};li.createFromProtobuf=async t=>{const e=Ph.decode(t),r=await be.createFromPubKey(e.public_key);return new li({peerId:r,payloadType:e.payload_type,payload:e.payload,signature:e.signature})},li.seal=async(t,e)=>{const r=t.domain,n=t.codec,i=t.marshal(),s=Nh(r,n,i),a=await e.privKey.sign(s);return new li({peerId:e,payloadType:n,payload:i,signature:a})},li.openAndCertify=async(t,e)=>{const r=await li.createFromProtobuf(t),n=await r.validate(e);if(!n)throw U(new Error("envelope signature is not valid for the given domain"),mw.ERR_SIGNATURE_NOT_VALID);return r};var da=li;const cr=Q("libp2p:peer-store:address-book");cr.error=Q("libp2p:peer-store:address-book:error");const{codes:{ERR_INVALID_PARAMETERS:Ji}}=dt;class gw extends ao{constructor(t){super({peerStore:t,eventName:"change:multiaddrs",eventProperty:"multiaddrs",eventTransformer:e=>e.addresses?e.addresses.map(r=>r.multiaddr):[]});this.data=new Map}consumePeerRecord(t){let e;try{e=co.createFromProtobuf(t.payload)}catch(c){return cr.error("invalid peer record received"),!1}if(!e.peerId.equals(t.peerId))return cr("signing key does not match PeerId in the PeerRecord"),!1;if(!e.multiaddrs||!e.multiaddrs.length)return!1;const r=e.peerId,n=r.toB58String(),i=this.data.get(n)||{},s=i.record;if(s&&s.seqNumber>=e.seqNumber)return!1;const a=this._toAddresses(e.multiaddrs,!0);return this._setData(r,{addresses:a,record:{raw:t.marshal(),seqNumber:e.seqNumber}}),cr(`stored provided peer record for ${n}`),!0}getRawEnvelope(t){const e=this.data.get(t.toB58String());return!e||!e.record||!e.record.raw?void 0:e.record.raw}getPeerRecord(t){const e=this.getRawEnvelope(t);return e?da.createFromProtobuf(e):void 0}set(t,e){if(!be.isPeerId(t))throw cr.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),Ji);const r=this._toAddresses(e),n=t.toB58String(),i=this.data.get(n)||{},s=i.addresses;if(!r.length)return this;if(s&&s.length===r.length){const a=s.filter(c=>r.some(o=>c.multiaddr.equals(o.multiaddr)));if(a.length===s.length)return cr(`the addresses provided to store are equal to the already stored for ${n}`),this}return this._setData(t,{addresses:r,record:i.record}),cr(`stored provided multiaddrs for ${n}`),s||this._ps.emit("peer",t),this}add(t,e){if(!be.isPeerId(t))throw cr.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),Ji);const r=this._toAddresses(e),n=t.toB58String(),i=this.data.get(n)||{},s=i.addresses||[];return s.forEach(a=>{r.find(c=>c.multiaddr.equals(a.multiaddr))||r.push(a)}),s&&s.length===r.length?(cr(`the addresses provided to store are already stored for ${n}`),this):(this._setData(t,{addresses:r,record:i.record}),cr(`added provided multiaddrs for ${n}`),i.addresses||this._ps.emit("peer",t),this)}get(t){if(!be.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),Ji);const e=this.data.get(t.toB58String());return e&&e.addresses?[...e.addresses]:void 0}_toAddresses(t,e=!1){if(!t)throw cr.error("multiaddrs must be provided to store data"),U(new Error("multiaddrs must be provided"),Ji);const r=[];return t.forEach(n=>{if(!Ge.isMultiaddr(n))throw cr.error(`multiaddr ${n} must be an instance of multiaddr`),U(new Error(`multiaddr ${n} must be an instance of multiaddr`),Ji);r.push({multiaddr:n,isCertified:e})}),r}getMultiaddrsForPeer(t){if(!be.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),Ji);const e=this.data.get(t.toB58String());return!e||!e.addresses?void 0:e.addresses.map(r=>{const n=r.multiaddr,i=n.getPeerId();return i&&i===t.toB58String()?n:n.encapsulate(`/p2p/${t.toB58String()}`)})}}var bw=gw;const Yc=Q("libp2p:peer-store:key-book");Yc.error=Q("libp2p:peer-store:key-book:error");const{codes:{ERR_INVALID_PARAMETERS:Oh}}=dt;class yw extends ao{constructor(t){super({peerStore:t,eventName:"change:pubkey",eventProperty:"pubkey",eventTransformer:e=>e.pubKey});this.data=new Map}set(t,e){if(!be.isPeerId(t))throw Yc.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),Oh);const r=t.toB58String(),n=this.data.get(r);return!n&&e&&(t.pubKey=e,this._setData(t,t),Yc(`stored provided public key for ${r}`)),this}get(t){if(!be.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),Oh);const e=this.data.get(t.toB58String());return e?e.pubKey:void 0}}var vw=yw;const lo=Q("libp2p:peer-store:proto-book");lo.error=Q("libp2p:peer-store:proto-book:error");const{codes:{ERR_INVALID_PARAMETERS:Zi}}=dt;class ww extends ao{constructor(t){super({peerStore:t,eventName:"change:metadata",eventProperty:"metadata"});this.data=new Map}set(t,e,r){if(!be.isPeerId(t))throw lo.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),Zi);if(typeof e!="string"||!(r instanceof Uint8Array))throw lo.error("valid key and value must be provided to store data"),U(new Error("valid key and value must be provided"),Zi);return this._setValue(t,e,r),this}_setValue(t,e,r,{emit:n=!0}={}){const i=t.toB58String(),s=this.data.get(i)||new Map,a=s.get(e);if(a&&tr(r,a)){lo(`the metadata provided to store is equal to the already stored for ${i} on ${e}`);return}s.set(e,r),this.data.set(i,s),n&&this._emit(t,e)}get(t){if(!be.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),Zi);return this.data.get(t.toB58String())}getValue(t,e){if(!be.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),Zi);const r=this.data.get(t.toB58String());return r&&r.get(e)}delete(t){if(!be.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),Zi);return this.data.delete(t.toB58String())?(this._emit(t),!0):!1}deleteValue(t,e){if(!be.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),Zi);const r=this.data.get(t.toB58String());return!r||!r.delete(e)?!1:(this._emit(t,e),!0)}}var _w=ww;const tn=Q("libp2p:peer-store:proto-book");tn.error=Q("libp2p:peer-store:proto-book:error");const{codes:{ERR_INVALID_PARAMETERS:uo}}=dt;class Ew extends ao{constructor(t){super({peerStore:t,eventName:"change:protocols",eventProperty:"protocols",eventTransformer:e=>Array.from(e)});this.data=new Map}set(t,e){if(!be.isPeerId(t))throw tn.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),uo);if(!e)throw tn.error("protocols must be provided to store data"),U(new Error("protocols must be provided"),uo);const r=t.toB58String(),n=this.data.get(r),i=new Set(e),s=(a,c)=>a.size===c.size&&[...a].every(o=>c.has(o));return n&&s(n,i)?(tn(`the protocols provided to store are equal to the already stored for ${r}`),this):(this._setData(t,i),tn(`stored provided protocols for ${r}`),this)}add(t,e){if(!be.isPeerId(t))throw tn.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),uo);if(!e)throw tn.error("protocols must be provided to store data"),U(new Error("protocols must be provided"),uo);const r=t.toB58String(),n=this.data.get(r)||new Set,i=new Set([...n,...e]);return n.size===i.size?(tn(`the protocols provided to store are already stored for ${r}`),this):(e=[...i],this._setData(t,i),tn(`added provided protocols for ${r}`),this)}}var Sw=Ew;const Tw=Q("libp2p:peer-store");Tw.error=Q("libp2p:peer-store:error");const{EventEmitter:Aw}=St,{ERR_INVALID_PARAMETERS:Cw}=dt;class Iw extends Aw{constructor({peerId:t}){super();this._peerId=t,this.addressBook=new bw(this),this.keyBook=new vw(this),this.metadataBook=new _w(this),this.protoBook=new Sw(this)}start(){}stop(){}get peers(){const t=new Set([...this.addressBook.data.keys(),...this.keyBook.data.keys(),...this.protoBook.data.keys(),...this.metadataBook.data.keys()]);this._peerId&&t.delete(this._peerId.toB58String());const e=new Map;return t.forEach(r=>{e.set(r,this.get(be.createFromCID(r)))}),e}delete(t){const e=this.addressBook.delete(t),r=this.keyBook.delete(t),n=this.protoBook.delete(t),i=this.metadataBook.delete(t);return e||r||n||i}get(t){if(!be.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),Cw);const e=this.keyBook.data.get(t.toB58String()),r=this.addressBook.get(t),n=this.metadataBook.get(t),i=this.protoBook.get(t);return!e&&!r&&!n&&!i?void 0:{id:e||t,addresses:r||[],protocols:i||[],metadata:n}}}var Mh=Iw,Rw=(t,e,r)=>{class n extends t{subscribe(i,s){s&&this.on(i,s),super.subscribe(i)}unsubscribe(i,s){s?this.removeListener(i,s):this.removeAllListeners(i),this.listenerCount(i)===0&&super.unsubscribe(i)}}return new n(e,r)},kw="/peers/",Pw="/peers/addrs/",Nw="/peers/keys/",Ow="/peers/metadata/",Mw="/peers/protos/",Dw={NAMESPACE_COMMON:kw,NAMESPACE_ADDRESS:Pw,NAMESPACE_KEYS:Nw,NAMESPACE_METADATA:Ow,NAMESPACE_PROTOCOL:Mw};const xw=`
message Addresses {
  // Address represents a single multiaddr.
  message Address {
    required bytes multiaddr = 1;

    // Flag to indicate if the address comes from a certified source.
    optional bool isCertified = 2;
  }

  // CertifiedRecord contains a serialized signed PeerRecord used to
  // populate the signedAddrs list.
  message CertifiedRecord {
    // The Seq counter from the signed PeerRecord envelope
    uint64 seq = 1;

    // The serialized bytes of the SignedEnvelope containing the PeerRecord.
    bytes raw = 2;
  }

  // The known multiaddrs.
  repeated Address addrs = 1;

  // The most recently received signed PeerRecord.
  CertifiedRecord certified_record = 2;
}
`;var Dh=Mr(xw).Addresses;const jw=`
message Protocols {
  repeated string protocols = 1;
}
`;var xh=Mr(jw).Protocols;const nt=Q("libp2p:persistent-peer-store");nt.error=Q("libp2p:persistent-peer-store:error");const{Key:ho}=nc,{NAMESPACE_ADDRESS:Lw,NAMESPACE_COMMON:Bw,NAMESPACE_KEYS:Uw,NAMESPACE_METADATA:Fw,NAMESPACE_PROTOCOL:$w}=Dw;class qw extends Mh{constructor({peerId:t,datastore:e,threshold:r=5}){super({peerId:t});this._datastore=e,this._dirtyPeers=new Set,this._dirtyMetadata=new Map,this.threshold=r,this._addDirtyPeer=this._addDirtyPeer.bind(this)}async start(){nt("PeerStore is starting"),this.on("change:protocols",this._addDirtyPeer),this.on("change:multiaddrs",this._addDirtyPeer),this.on("change:pubkey",this._addDirtyPeerKey),this.on("change:metadata",this._addDirtyPeerMetadata);for await(const t of this._datastore.query({prefix:Bw}))await this._processDatastoreEntry(t);nt("PeerStore started")}async stop(){nt("PeerStore is stopping"),this.removeAllListeners(),await this._commitData(),nt("PeerStore stopped")}_addDirtyPeer({peerId:t}){const e=t.toB58String();nt("add dirty peer",e),this._dirtyPeers.add(e),this._dirtyPeers.size>=this.threshold&&this._commitData().catch(r=>{nt.error("error committing data",r)})}_addDirtyPeerKey({peerId:t}){if(t.hasInlinePublicKey())return;const e=t.toB58String();nt("add dirty peer key",e),this._dirtyPeers.add(e),this._dirtyPeers.size>=this.threshold&&this._commitData().catch(r=>{nt.error("error committing data",r)})}_addDirtyPeerMetadata({peerId:t,metadata:e}){const r=t.toB58String();nt("add dirty metadata peer",r),this._dirtyPeers.add(r);const n=this._dirtyMetadata.get(r)||new Set;n.add(e),this._dirtyMetadata.set(r,n),this._dirtyPeers.size>=this.threshold&&this._commitData().catch(i=>{nt.error("error committing data",i)})}async _commitData(){const t=Array.from(this._dirtyPeers);if(!t.length)return;this._dirtyPeers.clear(),nt("create batch commit");const e=this._datastore.batch();for(const r of t){const n=this.keyBook.data.get(r)||be.createFromCID(r);this._batchAddressBook(n,e),!n.hasInlinePublicKey()&&this._batchKeyBook(n,e),this._batchMetadataBook(n,e),this._batchProtoBook(n,e)}await e.commit(),nt("batch committed")}_batchAddressBook(t,e){const r=t.toString(),n=new ho(`${Lw}${r}`),i=this.addressBook.data.get(t.toB58String());try{if(!i){e.delete(n);return}const s=Dh.encode({addrs:i.addresses.map(a=>({multiaddr:a.multiaddr.bytes,isCertified:a.isCertified})),certified_record:i.record?{seq:i.record.seqNumber,raw:i.record.raw}:void 0});e.put(n,s)}catch(s){nt.error(s)}}_batchKeyBook(t,e){const r=t.toString(),n=new ho(`${Uw}${r}`);try{if(!t.pubKey){e.delete(n);return}const i=t.marshalPubKey();e.put(n,i)}catch(i){nt.error(i)}}_batchMetadataBook(t,e){const r=t.toString(),n=this._dirtyMetadata.get(t.toB58String())||[];try{n.forEach(i=>{const s=new ho(`${Fw}${r}/${i}`),a=this.metadataBook.getValue(t,i);a?e.put(s,a):e.delete(s)})}catch(i){nt.error(i)}}_batchProtoBook(t,e){const r=t.toString(),n=new ho(`${$w}${r}`),i=this.protoBook.get(t);try{if(!i){e.delete(n);return}const s=xh.encode({protocols:i});e.put(n,s)}catch(s){nt.error(s)}}async _processDatastoreEntry({key:t,value:e}){try{const r=t.toString().split("/"),n=be.createFromCID(r[3]);let i;switch(r[2]){case"addrs":i=Dh.decode(e),this.addressBook._setData(n,{addresses:i.addrs.map(s=>({multiaddr:Ge(s.multiaddr),isCertified:Boolean(s.isCertified)})),record:i.certified_record?{raw:i.certified_record.raw,seqNumber:i.certified_record.seq}:void 0},{emit:!1});break;case"keys":i=await be.createFromPubKey(e),this.keyBook._setData(i,i,{emit:!1});break;case"metadata":this.metadataBook._setValue(n,r[4],e,{emit:!1});break;case"protos":i=xh.decode(e),this.protoBook._setData(n,new Set(i.protocols),{emit:!1});break;default:nt("invalid data persisted for: ",t.toString())}}catch(r){nt.error(r)}}}var Vw=qw;const jh=()=>{};class Gw{constructor({min:t=0,max:e=Infinity,handlers:r={}}){this.min=t,this.max=e,this._onConnect=r.onConnect||jh,this._onDisconnect=r.onDisconnect||jh,this.peers=new Set}set registrar(t){this._registrar=t}disconnect(t){this._onDisconnect(t)}}var zw=Ht(Gw,{className:"Topology",symbolName:"@libp2p/js-interfaces/topology"});const Hw=Q("libp2p:peer-store");Hw.error=Q("libp2p:peer-store:error");const{ERR_INVALID_PARAMETERS:Ww}=dt;class Kw{constructor({peerStore:t,connectionManager:e}){this.peerStore=t,this.connectionManager=e,this.topologies=new Map,this._handle=void 0,this._onDisconnect=this._onDisconnect.bind(this),this.connectionManager.on("peer:disconnect",this._onDisconnect)}get handle(){return this._handle}set handle(t){this._handle=t}getConnection(t){return this.connectionManager.get(t)}register(t){if(!zw.isTopology(t))throw U(new Error("topology must be an instance of interfaces/topology"),Ww);const e=parseInt(Math.random()*1e9).toString(36)+Date.now();return this.topologies.set(e,t),t.registrar=this,e}unregister(t){return this.topologies.delete(t)}_onDisconnect(t,e){for(const[,r]of this.topologies)r.disconnect(t.remotePeer,e)}}var Xw=Kw,Jc=te(function(t){const{Buffer:e}=Qs;t.exports=async function*(r){for await(const n of r)e.isBuffer(n)?yield n:ut.isBufferList(n)?yield n.slice():yield e.from(n)},t.exports.toBuffer=t.exports,t.exports.toList=async function*(r){for await(const n of r)e.isBuffer(n)?yield new ut().append(n):ut.isBufferList(n)?yield n:yield new ut().append(e.from(n))}}),Qw={PROTOCOL:"/ipfs/ping/1.0.0",PING_LENGTH:32},po=te(function(t,e){const r=Q("libp2p-ping");r.error=Q("libp2p-ping:error");const{toBuffer:n}=Jc,{collect:i,take:s}=ic,{PROTOCOL:a,PING_LENGTH:c}=Qw;async function o(h,f){r("dialing %s to %s",a,f.toB58String?f.toB58String():f);const{stream:p}=await h.dialProtocol(f,a),S=new Date,M=rr.randomBytes(c),[I]=await gt([M],p,V=>s(1,V),n,i),k=Date.now();if(!M.equals(I))throw U(new Error("Received wrong ping ack"),"ERR_WRONG_PING_ACK");return k-S}function l(h){h.handle(a,({stream:f})=>gt(f,f))}function u(h){h.unhandle(a)}e=t.exports=o,e.mount=l,e.unmount=u}),Yw=t=>e=>async function*(){for await(const r of e)yield t.encode(r)}(),Jw=t=>e=>async function*(){for await(const r of e)yield t.decode(r)}(),Zc={encode:Yw,decode:Jw},Zw=t=>e=>Je.encode()(Zc.encode(t)(e)),e_=t=>e=>Zc.decode(t)(Jc(Je.decode()(e))),t_=Zc,r_={encode:Zw,decode:e_,it:t_};const n_=`
message Identify {
  // protocolVersion determines compatibility between peers
  optional string protocolVersion = 5; // e.g. ipfs/1.0.0

  // agentVersion is like a UserAgent string in browsers, or client version in bittorrent
  // includes the client name and client.
  optional string agentVersion = 6; // e.g. go-ipfs/0.1.0

  // publicKey is this node's public key (which also gives its node.ID)
  // - may not need to be sent, as secure channel implies it has been sent.
  // - then again, if we change / disable secure channel, may still want it.
  optional bytes publicKey = 1;

  // listenAddrs are the multiaddrs the sender node listens for open connections on
  repeated bytes listenAddrs = 2;

  // oservedAddr is the multiaddr of the remote endpoint that the sender node perceives
  // this is useful information to convey to the other side, as it helps the remote endpoint
  // determine whether its connection to the local peer goes through NAT.
  optional bytes observedAddr = 4;

  repeated string protocols = 3;

  // signedPeerRecord contains a serialized SignedEnvelope containing a PeerRecord,
  // signed by the sending node. It contains the same addresses as the listenAddrs field, but
  // in a form that lets us share authenticated addrs with other peers.
  optional bytes signedPeerRecord = 8;
}
`;var ha=Mr(n_).Identify;const lr=Q("libp2p:identify");lr.error=Q("libp2p:identify:error");const{collect:Lh,take:Bh,consume:Uh}=ic,{toBuffer:Fh}=Jc,{MULTICODEC_IDENTIFY:el,MULTICODEC_IDENTIFY_PUSH:fo,AGENT_VERSION:i_,PROTOCOL_VERSION:s_}=_d,{codes:tl}=dt;class $h{static getCleanMultiaddr(t){if(t&&t.length>0)try{return Ge(t)}catch(e){return null}return null}constructor({libp2p:t,protocols:e}){this.peerStore=t.peerStore,this.connectionManager=t.connectionManager,this.connectionManager.on("peer:connect",r=>{const n=r.remotePeer;this.identify(r,n).catch(lr.error)}),this.peerId=t.peerId,this._libp2p=t,this._protocols=e,this.handleMessage=this.handleMessage.bind(this),this._host={agentVersion:i_,protocolVersion:s_,...t._options.host},this.peerStore.metadataBook.set(this.peerId,"AgentVersion",je(this._host.agentVersion)),this.peerStore.metadataBook.set(this.peerId,"ProtocolVersion",je(this._host.protocolVersion))}async push(t){const e=await this._getSelfPeerRecord(),r=this._libp2p.multiaddrs.map(s=>s.bytes),n=Array.from(this._protocols.keys()),i=t.map(async s=>{try{const{stream:a}=await s.newStream(fo);await gt([{listenAddrs:r,signedPeerRecord:e,protocols:n}],r_.encode(ha),a,Uh)}catch(a){lr.error("could not push identify update to peer",a)}});return Promise.all(i)}pushToPeerStore(t){const e=[];let r;for(const n of t.peers.values())n.protocols.includes(fo)&&(r=this.connectionManager.get(n.id))&&e.push(r);this.push(e)}async identify(t){const{stream:e}=await t.newStream(el),[r]=await gt([],e,Je.decode(),Bh(1),Fh,Lh);if(!r)throw U(new Error("No data could be retrieved"),tl.ERR_CONNECTION_ENDED);let n;try{n=ha.decode(r)}catch(u){throw U(u,tl.ERR_INVALID_MESSAGE)}let{publicKey:i,listenAddrs:s,protocols:a,observedAddr:c,signedPeerRecord:o}=n;const l=await be.createFromPubKey(i);if(t.remotePeer.toB58String()!==l.toB58String())throw U(new Error("identified peer does not match the expected peer"),tl.ERR_INVALID_PEER);c=$h.getCleanMultiaddr(c);try{const u=await da.openAndCertify(o,co.DOMAIN);if(this.peerStore.addressBook.consumePeerRecord(u)){this.peerStore.protoBook.set(l,a);return}}catch(u){lr("received invalid envelope, discard it and fallback to listenAddrs is available",u)}try{this.peerStore.addressBook.set(l,s.map(u=>Ge(u)))}catch(u){lr.error("received invalid addrs",u)}this.peerStore.protoBook.set(l,a),this.peerStore.metadataBook.set(l,"AgentVersion",je(n.agentVersion)),lr("received observed address of %s",c)}handleMessage({connection:t,stream:e,protocol:r}){switch(r){case el:return this._handleIdentify({connection:t,stream:e});case fo:return this._handlePush({connection:t,stream:e});default:lr.error("cannot handle unknown protocol %s",r)}}async _handleIdentify({connection:t,stream:e}){let r=new Uint8Array(0);this.peerId.pubKey&&(r=this.peerId.pubKey.bytes);const n=await this._getSelfPeerRecord(),i=ha.encode({protocolVersion:this._host.protocolVersion,agentVersion:this._host.agentVersion,publicKey:r,listenAddrs:this._libp2p.multiaddrs.map(s=>s.bytes),signedPeerRecord:n,observedAddr:t.remoteAddr.bytes,protocols:Array.from(this._protocols.keys())});try{await gt([i],Je.encode(),e,Uh)}catch(s){lr.error("could not respond to identify request",s)}}async _handlePush({connection:t,stream:e}){let r;try{const[i]=await gt([],e,Je.decode(),Bh(1),Fh,Lh);r=ha.decode(i)}catch(i){return lr.error("received invalid message",i)}const n=t.remotePeer;try{const i=await da.openAndCertify(r.signedPeerRecord,co.DOMAIN);if(this.peerStore.addressBook.consumePeerRecord(i)){this.peerStore.protoBook.set(n,r.protocols);return}}catch(i){lr("received invalid envelope, discard it and fallback to listenAddrs is available",i)}try{this.peerStore.addressBook.set(n,r.listenAddrs.map(i=>Ge(i)))}catch(i){lr.error("received invalid addrs",i)}this.peerStore.protoBook.set(n,r.protocols)}async _getSelfPeerRecord(){const t=this.peerStore.addressBook.getRawEnvelope(this.peerId);if(t)return t;try{const e=new co({peerId:this.peerId,multiaddrs:this._libp2p.multiaddrs}),r=await da.seal(e,this.peerId);return this.peerStore.addressBook.consumePeerRecord(r),this.peerStore.addressBook.getRawEnvelope(this.peerId)}catch(e){lr.error("failed to get self peer record")}return null}}var a_=$h,o_={IDENTIFY:el,IDENTIFY_PUSH:fo},c_=ha,l_={IdentifyService:a_,multicodecs:o_,Message:c_};const{EventEmitter:u_}=St,Wt=Q("libp2p");Wt.error=Q("libp2p:error");const{validate:d_}=Ay,{codes:rl,messages:h_}=dt,{IdentifyService:p_,multicodecs:f_}=l_;class mo extends u_{constructor(t){super();if(this._options=d_(t),this.peerId=this._options.peerId,this.datastore=this._options.datastore,this.peerStore=this.datastore&&this._options.peerStore.persistence?new Vw({peerId:this.peerId,datastore:this.datastore,...this._options.peerStore}):new Mh({peerId:this.peerId}),this.addresses=this._options.addresses,this.addressManager=new Ry(this._options.addresses),this._modules=this._options.modules,this._config=this._options.config,this._transport=[],this._discovery=new Map,this._options.connectionManager.minPeers&&(this._options.connectionManager.minConnections=this._options.connectionManager.minPeers),this.connectionManager=new Ly(this,{autoDial:this._config.peerDiscovery.autoDial,...this._options.connectionManager}),this._options.metrics.enabled&&(this.metrics=new T0({...this._options.metrics,connectionManager:this.connectionManager})),this._options.keychain&&this._options.keychain.datastore){Wt("creating keychain");const r=eh.generateOptions();this.keychain=new eh(this._options.keychain.datastore,{passPhrase:this._options.keychain.pass,...r,...this._options.keychain}),Wt("keychain constructed")}if(this.upgrader=new tw({localPeer:this.peerId,metrics:this.metrics,onConnection:r=>this.connectionManager.onConnect(r),onConnectionEnd:r=>this.connectionManager.onDisconnect(r)}),this.transportManager=new Rd({libp2p:this,upgrader:this.upgrader,faultTolerance:this._options.transportManager.faultTolerance}),this.registrar=new Xw({peerStore:this.peerStore,connectionManager:this.connectionManager}),this.handle=this.handle.bind(this),this.registrar.handle=this.handle,!this._modules.connEncryption||!this._modules.connEncryption.length)throw U(new Error(h_.CONN_ENCRYPTION_REQUIRED),rl.CONN_ENCRYPTION_REQUIRED);const e=this._modules.connEncryption;if(e.forEach(r=>{this.upgrader.cryptos.set(r.protocol,r)}),this.dialer=new Qv({transportManager:this.transportManager,peerStore:this.peerStore,concurrency:this._options.dialer.maxParallelDials,perPeerLimit:this._options.dialer.maxDialsPerPeer,timeout:this._options.dialer.dialTimeout,resolvers:this._options.dialer.resolvers}),this._modules.transport.forEach(r=>{const n=r.prototype[Symbol.toStringTag],i=this._config.transport[n];this.transportManager.add(n,r,i)}),this._config.relay.enabled&&this.transportManager.add(Xd.prototype[Symbol.toStringTag],Xd),this._modules.streamMuxer){const r=this._modules.streamMuxer;r.forEach(n=>{this.upgrader.muxers.set(n.multicodec,n)}),this.identifyService=new p_({libp2p:this,protocols:this.upgrader.protocols}),this.handle(Object.values(f_),this.identifyService.handleMessage)}if(this._modules.connProtector)this.upgrader.protector=this._modules.connProtector;else if(ri.process!==void 0&&ri.process.env&&ri.process.env.LIBP2P_FORCE_PNET)throw new Error("Private network is enforced, but no protector was provided");if(this._modules.dht){const r=this._modules.dht;this._dht=new r({libp2p:this,dialer:this.dialer,peerId:this.peerId,peerStore:this.peerStore,registrar:this.registrar,datastore:this.datastore,...this._config.dht})}if(this._modules.pubsub){const r=this._modules.pubsub;this.pubsub=Rw(r,this,this._config.pubsub)}this.peerRouting=$g(this),this.contentRouting=Hg(this),po.mount(this),this._onDiscoveryPeer=this._onDiscoveryPeer.bind(this)}emit(t,...e){t==="error"&&!this._events.error?Wt.error(...e):super.emit(t,...e)}async start(){Wt("libp2p is starting");try{await this._onStarting(),await this._onDidStart(),Wt("libp2p has started")}catch(t){throw this.emit("error",t),Wt.error("An error occurred starting libp2p",t),await this.stop(),t}}async stop(){Wt("libp2p is stopping");try{for(const t of this._discovery.values())t.removeListener("peer",this._onDiscoveryPeer);await Promise.all(Array.from(this._discovery.values(),t=>t.stop())),this._discovery=new Map,await this.peerStore.stop(),await this.connectionManager.stop(),await Promise.all([this.pubsub&&this.pubsub.stop(),this._dht&&this._dht.stop(),this.metrics&&this.metrics.stop()]),await this.transportManager.close(),po.unmount(this),this.dialer.destroy()}catch(t){t&&(Wt.error(t),this.emit("error",t))}this._isStarted=!1,Wt("libp2p has stopped")}async loadKeychain(){try{await this.keychain.findKeyByName("self")}catch(t){await this.keychain.importPeer("self",this.peerId)}}isStarted(){return this._isStarted}get connections(){return this.connectionManager.connections}dial(t,e){return this.dialProtocol(t,null,e)}async dialProtocol(t,e,r){const{id:n,multiaddrs:i}=Ga(t);if(n.equals(this.peerId))throw U(new Error("Cannot dial self"),rl.ERR_DIALED_SELF);let s=this.connectionManager.get(n);return s?i&&this.peerStore.addressBook.add(n,i):s=await this.dialer.connectToPeer(t,r),e?s.newStream(e):s}get multiaddrs(){const t=this.addressManager.getNoAnnounceAddrs();return this.transportManager.getAddrs().concat(this.addressManager.getAnnounceAddrs()).filter((e,r,n)=>n.findIndex(i=>i.equals(e))!==r?!1:!t.find(i=>i.equals(e)))}async hangUp(t){const{id:e}=Ga(t),r=this.connectionManager.connections.get(e.toB58String());if(!r)return;await Promise.all(r.map(n=>n.close()))}ping(t){const{id:e,multiaddrs:r}=Ga(t);return r?po(this,r[0]):po(this,e)}handle(t,e){t=Array.isArray(t)?t:[t],t.forEach(r=>{this.upgrader.protocols.set(r,e)}),this.isStarted()&&this.identifyService&&this.identifyService.pushToPeerStore(this.peerStore)}unhandle(t){t=Array.isArray(t)?t:[t],t.forEach(e=>{this.upgrader.protocols.delete(e)}),this.isStarted()&&this.identifyService&&this.identifyService.pushToPeerStore(this.peerStore)}async _onStarting(){await this.transportManager.listen(),await this.peerStore.start(),this._config.pubsub.enabled&&(this.pubsub&&this.pubsub.start()),this._config.dht.enabled&&(this._dht&&this._dht.start(),this._dht.on("peer",this._onDiscoveryPeer)),this.metrics&&this.metrics.start()}async _onDidStart(){this._isStarted=!0,this.peerStore.on("peer",t=>{this.emit("peer:discovery",t),this._maybeConnect(t)});for(const t of this.peerStore.peers.values())this.emit("peer:discovery",t.id);this.connectionManager.start(),await this._setupPeerDiscovery()}_onDiscoveryPeer(t){if(t.id.toB58String()===this.peerId.toB58String()){Wt.error(new Error(rl.ERR_DISCOVERED_SELF));return}t.multiaddrs&&this.peerStore.addressBook.add(t.id,t.multiaddrs),t.protocols&&this.peerStore.protoBook.set(t.id,t.protocols)}async _maybeConnect(t){if(this._config.peerDiscovery.autoDial===!0&&!this.connectionManager.get(t)){const e=this._options.connectionManager.minConnections||0;if(e>this.connectionManager.size){Wt("connecting to discovered peer %s",t.toB58String());try{await this.dialer.connectToPeer(t)}catch(r){Wt.error("could not connect to discovered peer",r)}}}}async _setupPeerDiscovery(){const t=e=>{let r={enabled:!0};if(e.tag&&this._config.peerDiscovery&&this._config.peerDiscovery[e.tag]&&(r={...r,...this._config.peerDiscovery[e.tag]}),r.enabled&&!this._discovery.has(e.tag)){let n;typeof e=="function"?n=new e(Object.assign({},r,{peerId:this.peerId,libp2p:this})):n=e,n.on("peer",this._onDiscoveryPeer),this._discovery.set(e.tag,n)}};for(const e of this._modules.peerDiscovery||[])t(e);for(const e of this.transportManager.getTransports())e.discovery&&t(e.discovery);await Promise.all(Array.from(this._discovery.values(),e=>e.start()))}}mo.create=async function(e={}){if(e.peerId)return new mo(e);const r=await be.create();return e.peerId=r,new mo(e)};var m_=mo,g_=typeof WebSocket=="undefined"?ji:WebSocket,nl=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(i){if(this.isStopped)return;const s={value:i,done:!1};if(this.pullQueue.length){const a=this.pullQueue.shift();a&&a.resolve(s)}else this.pushQueue.push(Promise.resolve(s)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(this.isStopped)return;this.isStopped=!0,this.remove();for(const i of this.pullQueue)i.resolve({value:void 0,done:!0});this.pullQueue.length=0}fail(i){if(this.isStopped)return;if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const s of this.pullQueue)s.reject(i);this.pullQueue.length=0}else{const s=Promise.reject(i);s.catch(()=>{}),this.pushQueue.push(s)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:i=>{const s=this.pushQueue.shift();return s?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),s):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((a,c)=>{this.pullQueue.push({resolve:a,reject:c})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class n{constructor(i,{highWaterMark:s=100,lowWaterMark:a=1}={}){const c=new r;c.highWaterMark=s,c.lowWaterMark=a,c.removeCallback=i({push:o=>c.push(o),stop:()=>c.stop(),fail:o=>c.fail(o),on:(o,l)=>{c.eventHandlers[o]=l}})||(()=>{}),this[Symbol.asyncIterator]=()=>c[Symbol.asyncIterator](),Object.freeze(this)}}e.EventIterator=n,e.default=n}),b_=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.EventIterator=nl.EventIterator;function r(n,i,s){return new nl.EventIterator(({push:a})=>(this.addEventListener(n,a,i),()=>this.removeEventListener(n,a,i)),s)}e.subscribe=r,e.default=nl.EventIterator});const{Buffer:y_}=Qs,{EventIterator:v_}=b_;function w_(t){return t instanceof ArrayBuffer||t!=null&&t.constructor!=null&&t.constructor.name==="ArrayBuffer"&&typeof t.byteLength=="number"}var qh=t=>{const e=t.removeEventListener||t.removeListener,r=async function*(){const s=new v_(({push:a,stop:c,fail:o})=>(t.addEventListener("message",a),t.addEventListener("error",o),t.addEventListener("close",c),()=>{e.call(t,"message",a),e.call(t,"error",o),e.call(t,"close",c)}),{highWaterMark:Infinity});for await(const{data:a}of s)yield w_(a)?y_.from(a):a}();let n=t.readyState===1,i;return t.addEventListener("open",()=>{n=!0,i=null}),t.addEventListener("close",()=>{n=!1,i=null}),t.addEventListener("error",s=>{n||(i=s)}),r.connected=()=>new Promise((s,a)=>{if(n)return s();if(i)return a(i);const c=u=>{e.call(t,"open",o),e.call(t,"error",l),u()},o=()=>c(s),l=u=>c(()=>a(u));t.addEventListener("open",o),t.addEventListener("error",l)}),r},__=async t=>{if(t.readyState>=2)throw new Error("socket closed");return t.readyState===1?void 0:new Promise((e,r)=>{const n=t&&(t.removeEventListener||t.removeListener);function i(){typeof n=="function"&&(n.call(t,"open",s),n.call(t,"error",a))}function s(){i(),e()}function a(c){i(),r(c)}t.addEventListener("open",s),t.addEventListener("error",a)})},Vh=(t,e)=>(e=e||{},e.closeOnEnd=e.closeOnEnd!==!1,async r=>{for await(const n of r){try{await __(t)}catch(i){if(i.message==="socket closed")break;throw i}t.send(n)}if(e.closeOnEnd&&t.readyState<=1)return new Promise((n,i)=>{t.addEventListener("close",s=>{if(s.wasClean||s.code===1006)n();else{const a=Object.assign(new Error("ws error"),{event:s});i(a)}}),setTimeout(()=>t.close())})}),Gh=(t,e)=>{e=e||{},e.binaryType?t.binaryType=e.binaryType:e.binary&&(t.binaryType="arraybuffer");const r={sink:Vh(t,e),source:qh(t),connected:()=>r.source.connected()};return r},E_=function(t,e,r,n){r=r||{};var t=Ys.parse(t,!1,!0),i;return t.protocol?i=t.protocol:(i=e.protocol?e.protocol.replace(/:$/,""):"http",i=(r[i]||n||i)+":"),t.host&&t.host[0]===":"&&(t.host=null),t.hostname?Ys.format({protocol:i,slashes:!0,hostname:t.hostname,port:t.port,pathname:t.pathname,search:t.search}):(t.host=e.host,t.port?Ys.format({protocol:i,slashes:!0,host:e.hostname+":"+t.port,port:t.port,pathname:t.pathname,search:t.search}):t.pathname?Ys.format({protocol:i,slashes:!0,host:t.host,pathname:t.pathname,search:t.search}):(t.pathname=e.pathname,t.search?Ys.format({protocol:i,slashes:!0,host:t.host,pathname:t.pathname,search:t.search}):(t.search=e.search,t.format(t))))};const S_={http:"ws",https:"wss"},T_="ws";var A_=(t,e)=>E_(t,e,S_,T_),zh=te(function(t){t.exports=function(e,r={}){const n=typeof window=="undefined"?{}:window.location,i=A_(e,n),s=new g_(i,r.websocket),a=Gh(s,r);return a.remoteAddress=i,a.close=()=>new Promise((c,o)=>{s.addEventListener("close",c),s.close()}),a.destroy=()=>{s.terminate?s.terminate():s.close()},a.socket=s,a},t.exports.connect=t.exports});const go=(t,e)=>e,C_=(t,e,r,n)=>{if(n&&n.assumeHttp===!1)return`tcp://${t}:${e}`;let i="tcp",s=`:${e}`;const a=r[r.length-1];return a.protocol==="tcp"&&(i=e==="443"?"https":"http",s=e==="443"||e==="80"?"":s),`${i}://${t}${s}`},I_={ip4:go,ip6:(t,e,r,n)=>n.length===1&&n[0].protocol==="ip6"?e:`[${e}]`,tcp:(t,e,r,n,i)=>n.some(s=>["http","https","ws","wss"].includes(s.protocol))?`${t}:${e}`:C_(t,e,n,i),udp:(t,e)=>`udp://${t}:${e}`,dnsaddr:go,dns4:go,dns6:go,ipfs:(t,e)=>`${t}/ipfs/${e}`,p2p:(t,e)=>`${t}/p2p/${e}`,http:t=>`http://${t}`,https:t=>`https://${t}`,ws:t=>`ws://${t}`,wss:t=>`wss://${t}`,"p2p-websocket-star":t=>`${t}/p2p-websocket-star`,"p2p-webrtc-star":t=>`${t}/p2p-webrtc-star`,"p2p-webrtc-direct":t=>`${t}/p2p-webrtc-direct`};var R_=(t,e)=>{const r=At(t),n=t.toString().split("/").slice(1);return r.tuples().map(i=>({protocol:n.shift(),content:i[1]?n.shift():null})).reduce((i,s,a,c)=>{const o=I_[s.protocol];if(!o)throw new Error(`Unsupported protocol ${s.protocol}`);return o(i,s.content,a,c,e)},"")};function k_(){return typeof window!="undefined"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof fe!="undefined"&&typeof fe.versions=="object"&&!!fe.versions.electron?!0:typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0}var P_=k_;const bo=typeof window=="object"&&typeof document=="object"&&document.nodeType===9,pa=P_(),N_=bo&&!pa,O_=pa&&!bo,M_=pa&&bo,D_=typeof Cg=="function"&&typeof fe!="undefined"&&typeof fe.release!="undefined"&&fe.release.name==="node"&&!pa,x_=typeof importScripts=="function"&&typeof self!="undefined"&&typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope,j_=typeof fe!="undefined"&&typeof fe.env!="undefined"&&!1;var Hh={isTest:j_,isElectron:pa,isElectronMain:O_,isElectronRenderer:M_,isNode:D_,isBrowser:N_,isWebWorker:x_,isEnvWithDom:bo};const L_=Tt,il=Tt.v4,Wh=Tt.v6,Kh=function(t,e,r){r=~~r;var n;if(il(t))n=e||new Uint8Array(r+4),t.split(/\./g).map(function(u){n[r++]=parseInt(u,10)&255});else if(Wh(t)){var i=t.split(":",8),s;for(s=0;s<i.length;s++){var a=il(i[s]),c;a&&(c=Kh(i[s]),i[s]=se(c.slice(0,2),"base16")),c&&++s<8&&i.splice(s,0,se(c.slice(2,4),"base16"))}if(i[0]==="")for(;i.length<8;)i.unshift("0");else if(i[i.length-1]==="")for(;i.length<8;)i.push("0");else if(i.length<8){for(s=0;s<i.length&&i[s]!=="";s++);var o=[s,"1"];for(s=9-i.length;s>0;s--)o.push("0");i.splice.apply(i,o)}for(n=e||new Uint8Array(r+16),s=0;s<i.length;s++){var l=parseInt(i[s],16);n[r++]=l>>8&255,n[r++]=l&255}}if(!n)throw Error("Invalid ip address: "+t);return n},B_=function(t,e,r){e=~~e,r=r||t.length-e;var n=[],i;const s=new DataView(t.buffer);if(r===4){for(let a=0;a<r;a++)n.push(t[e+a]);i=n.join(".")}else if(r===16){for(let a=0;a<r;a+=2)n.push(s.getUint16(e+a).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i};var yo={isIP:L_,isV4:il,isV6:Wh,toBytes:Kh,toString:B_};function Lt(t){if(typeof t=="number"){if(Lt.codes[t])return Lt.codes[t];throw new Error("no protocol with code: "+t)}else if(typeof t=="string"||t instanceof String){if(Lt.names[t])return Lt.names[t];throw new Error("no protocol with name: "+t)}throw new Error("invalid protocol id type: "+t)}const ur=-1;Lt.lengthPrefixedVarSize=ur,Lt.V=ur,Lt.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,ur,"ip6zone"],[53,ur,"dns","resolvable"],[54,ur,"dns4","resolvable"],[55,ur,"dns6","resolvable"],[56,ur,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,ur,"unix",!1,"path"],[421,ur,"ipfs"],[421,ur,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,ur,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,ur,"memory"]],Lt.names={},Lt.codes={},Lt.table.map(t=>{const e=Xh.apply(null,t);Lt.codes[e.code]=e,Lt.names[e.name]=e}),Lt.object=Xh;function Xh(t,e,r,n,i){return{code:t,size:e,name:r,resolvable:Boolean(n),path:Boolean(i)}}var jr=Lt,Qh=fa;function fa(t,e){return e instanceof Uint8Array?fa.toString(t,e):fa.toBytes(t,e)}fa.toString=function(e,r){e=jr(e);switch(e.code){case 4:case 41:return U_(r);case 6:case 273:case 33:case 132:return Jh(r);case 53:case 54:case 55:case 56:case 400:case 777:return $_(r);case 421:return V_(r);case 444:return Zh(r);case 445:return Zh(r);default:return se(r,"base16")}},fa.toBytes=function(e,r){e=jr(e);switch(e.code){case 4:return Yh(r);case 41:return Yh(r);case 6:case 273:case 33:case 132:return sl(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return F_(r);case 421:return q_(r);case 444:return G_(r);case 445:return z_(r);default:return je(r,"base16")}};function Yh(t){if(!yo.isIP(t))throw new Error("invalid ip address");return yo.toBytes(t)}function U_(t){const e=yo.toString(t);if(!e||!yo.isIP(e))throw new Error("invalid ip address");return e}function sl(t){const e=new ArrayBuffer(2),r=new DataView(e);return r.setUint16(0,t),new Uint8Array(e)}function Jh(t){const e=new DataView(t.buffer);return e.getUint16(0)}function F_(t){const e=je(t),r=Uint8Array.from(J.encode(e.length));return we([r,e],r.length+e.length)}function $_(t){const e=J.decode(t);if(t=t.slice(J.decode.bytes),t.length!==e)throw new Error("inconsistent lengths");return se(t)}function q_(t){const e=new Nr(t).multihash,r=Uint8Array.from(J.encode(e.length));return we([r,e],r.length+e.length)}function V_(t){const e=J.decode(t),r=t.slice(J.decode.bytes);if(r.length!==e)throw new Error("inconsistent lengths");return se(r,"base58btc")}function G_(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==16)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion address.");const r=Or.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=sl(n);return we([r,i],r.length+i.length)}function z_(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==56)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion3 address.");const r=Or.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=sl(n);return we([r,i],r.length+i.length)}function Zh(t){const e=t.slice(0,t.length-2),r=t.slice(t.length-2),n=se(e,"base32"),i=Jh(r);return n+":"+i}var Er={stringToStringTuples:ep,stringTuplesToString:tp,tuplesToStringTuples:np,stringTuplesToTuples:rp,bytesToTuples:al,tuplesToBytes:ip,bytesToString:H_,stringToBytes:ap,fromString:W_,fromBytes:op,validateBytes:ol,isValidBytes:K_,cleanPath:vo,ParseError:cl,protoFromTuple:ma,sizeForAddr:sp};function ep(t){const e=[],r=t.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let n=0;n<r.length;n++){const i=r[n],s=jr(i);if(s.size===0){e.push([i]);continue}if(n++,n>=r.length)throw cl("invalid address: "+t);if(s.path){e.push([i,vo(r.slice(n).join("/"))]);break}e.push([i,r[n]])}return e}function tp(t){const e=[];return t.map(r=>{const n=ma(r);e.push(n.name),r.length>1&&e.push(r[1])}),vo(e.join("/"))}function rp(t){return t.map(e=>{Array.isArray(e)||(e=[e]);const r=ma(e);return e.length>1?[r.code,Qh.toBytes(r.code,e[1])]:[r.code]})}function np(t){return t.map(e=>{const r=ma(e);return e.length>1?[r.code,Qh.toString(r.code,e[1])]:[r.code]})}function ip(t){return op(we(t.map(e=>{const r=ma(e);let n=Uint8Array.from(J.encode(r.code));return e.length>1&&(n=we([n,e[1]])),n})))}function sp(t,e){if(t.size>0)return t.size/8;if(t.size===0)return 0;{const r=J.decode(e);return r+J.decode.bytes}}function al(t){const e=[];let r=0;for(;r<t.length;){const n=J.decode(t,r),i=J.decode.bytes,s=jr(n),a=sp(s,t.slice(r+i));if(a===0){e.push([n]),r+=i;continue}const c=t.slice(r+i,r+i+a);if(r+=a+i,r>t.length)throw cl("Invalid address Uint8Array: "+se(t,"base16"));e.push([n,c])}return e}function H_(t){const e=al(t),r=np(e);return tp(r)}function ap(t){t=vo(t);const e=ep(t),r=rp(e);return ip(r)}function W_(t){return ap(t)}function op(t){const e=ol(t);if(e)throw e;return Uint8Array.from(t)}function ol(t){try{al(t)}catch(e){return e}}function K_(t){return ol(t)===void 0}function vo(t){return"/"+t.trim().split("/").filter(e=>e).join("/")}function cl(t){return new Error("Error parsing address: "+t)}function ma(t){const e=jr(t[0]);return e}var X_=te(function(t,e){const r=Symbol.for("nodejs.util.inspect.custom"),n=new Map,i=Ht.proto(function(s){if(!(this instanceof i))return new i(s);if(s==null&&(s=""),s instanceof Uint8Array)this.bytes=Er.fromBytes(s);else if(typeof s=="string"||s instanceof String){if(s.length>0&&s.charAt(0)!=="/")throw new Error(`multiaddr "${s}" must start with a "/"`);this.bytes=Er.fromString(s)}else if(s.bytes&&s.protos&&s.protoCodes)this.bytes=Er.fromBytes(s.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});i.prototype.toString=function(){return Er.bytesToString(this.bytes)},i.prototype.toJSON=i.prototype.toString,i.prototype.toOptions=function(){const a={},c=this.toString().split("/");return a.family=c[1]==="ip4"?"ipv4":"ipv6",a.host=c[2],a.transport=c[3],a.port=parseInt(c[4]),a},i.prototype[r]=function(){return"<Multiaddr "+se(this.bytes,"base16")+" - "+Er.bytesToString(this.bytes)+">"},i.prototype.inspect=function(){return"<Multiaddr "+se(this.bytes,"base16")+" - "+Er.bytesToString(this.bytes)+">"},i.prototype.protos=function(){return this.protoCodes().map(a=>Object.assign({},jr(a)))},i.prototype.protoCodes=function(){const a=[],c=this.bytes;let o=0;for(;o<c.length;){const l=J.decode(c,o),u=J.decode.bytes,h=jr(l),f=Er.sizeForAddr(h,c.slice(o+u));o+=f+u,a.push(l)}return a},i.prototype.protoNames=function(){return this.protos().map(a=>a.name)},i.prototype.tuples=function(){return Er.bytesToTuples(this.bytes)},i.prototype.stringTuples=function(){const a=Er.bytesToTuples(this.bytes);return Er.tuplesToStringTuples(a)},i.prototype.encapsulate=function(a){return a=i(a),i(this.toString()+a.toString())},i.prototype.decapsulate=function(a){a=a.toString();const c=this.toString(),o=c.lastIndexOf(a);if(o<0)throw new Error("Address "+this+" does not contain subaddress: "+a);return i(c.slice(0,o))},i.prototype.decapsulateCode=function(a){const c=this.tuples();for(let o=c.length-1;o>=0;o--)if(c[o][0]===a)return i(Er.tuplesToBytes(c.slice(0,o)));return this},i.prototype.getPeerId=function(){let a=null;try{const c=this.stringTuples().filter(o=>{if(o[0]===jr.names.ipfs.code)return!0});a=c.pop()[1],a=se(new Nr(a).multihash,"base58btc")}catch(c){a=null}return a},i.prototype.getPath=function(){let a=null;try{a=this.stringTuples().filter(c=>{const o=jr(c[0]);if(o.path)return!0})[0][1]}catch(c){a=null}return a},i.prototype.equals=function(a){return tr(this.bytes,a.bytes)},i.prototype.resolve=async function(){const a=this.protos().find(l=>l.resolvable);if(!a)return[this];const c=n.get(a.name);if(!c)throw U(new Error(`no available resolver for ${a.name}`),"ERR_NO_AVAILABLE_RESOLVER");const o=await c(this);return o.map(l=>i(l))},i.prototype.nodeAddress=function(){const a=this.protoCodes(),c=this.protoNames(),o=this.toString().split("/").slice(1);if(o.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(a[0]!==4&&a[0]!==41&&a[0]!==54&&a[0]!==55)throw new Error(`no protocol with name: "'${c[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(o[2]!=="tcp"&&o[2]!=="udp")throw new Error(`no protocol with name: "'${c[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:a[0]===41||a[0]===55?6:4,address:o[1],port:parseInt(o[3])}},i.fromNodeAddress=function(a,c){if(!a)throw new Error("requires node address object");if(!c)throw new Error("requires transport protocol");let o;switch(a.family){case"IPv4":o="ip4";break;case"IPv6":o="ip6";break;default:throw Error(`Invalid addr family. Got '${a.family}' instead of 'IPv4' or 'IPv6'`)}return i("/"+[o,a.address,c,a.port].join("/"))},i.prototype.isThinWaistAddress=function(a){const c=(a||this).protos();return c.length!==2||c[0].code!==4&&c[0].code!==41?!1:!(c[1].code!==6&&c[1].code!==273)},i.protocols=jr,i.isName=function(a){return i.isMultiaddr(a)?a.protos().some(c=>c.resolvable):!1},i.resolve=function(a){return!i.isMultiaddr(a)||!i.isName(a)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},i.resolvers=n,e=t.exports=i}),Q_=te(function(t,e){e=t.exports=Gh,e.source=qh,e.sink=Vh,e.createServer=ji,e.connect=zh}),Y_=421,J_=290,Z_=6,eE=477,tE=478,rE=2e3,cp={CODE_P2P:Y_,CODE_CIRCUIT:J_,CODE_TCP:Z_,CODE_WS:eE,CODE_WSS:tE,CLOSE_TIMEOUT:rE};const nE=Tt,ll=Tt.v4,lp=Tt.v6,up=function(t,e,r){r=~~r;var n;if(ll(t))n=e||new Uint8Array(r+4),t.split(/\./g).map(function(u){n[r++]=parseInt(u,10)&255});else if(lp(t)){var i=t.split(":",8),s;for(s=0;s<i.length;s++){var a=ll(i[s]),c;a&&(c=up(i[s]),i[s]=se(c.slice(0,2),"base16")),c&&++s<8&&i.splice(s,0,se(c.slice(2,4),"base16"))}if(i[0]==="")for(;i.length<8;)i.unshift("0");else if(i[i.length-1]==="")for(;i.length<8;)i.push("0");else if(i.length<8){for(s=0;s<i.length&&i[s]!=="";s++);var o=[s,"1"];for(s=9-i.length;s>0;s--)o.push("0");i.splice.apply(i,o)}for(n=e||new Uint8Array(r+16),s=0;s<i.length;s++){var l=parseInt(i[s],16);n[r++]=l>>8&255,n[r++]=l&255}}if(!n)throw Error("Invalid ip address: "+t);return n},iE=function(t,e,r){e=~~e,r=r||t.length-e;var n=[],i;const s=new DataView(t.buffer);if(r===4){for(let a=0;a<r;a++)n.push(t[e+a]);i=n.join(".")}else if(r===16){for(let a=0;a<r;a+=2)n.push(s.getUint16(e+a).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i};var wo={isIP:nE,isV4:ll,isV6:lp,toBytes:up,toString:iE};function Bt(t){if(typeof t=="number"){if(Bt.codes[t])return Bt.codes[t];throw new Error("no protocol with code: "+t)}else if(typeof t=="string"||t instanceof String){if(Bt.names[t])return Bt.names[t];throw new Error("no protocol with name: "+t)}throw new Error("invalid protocol id type: "+t)}const dr=-1;Bt.lengthPrefixedVarSize=dr,Bt.V=dr,Bt.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,dr,"ip6zone"],[53,dr,"dns","resolvable"],[54,dr,"dns4","resolvable"],[55,dr,"dns6","resolvable"],[56,dr,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,dr,"unix",!1,"path"],[421,dr,"ipfs"],[421,dr,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,dr,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,dr,"memory"]],Bt.names={},Bt.codes={},Bt.table.map(t=>{const e=dp.apply(null,t);Bt.codes[e.code]=e,Bt.names[e.name]=e}),Bt.object=dp;function dp(t,e,r,n,i){return{code:t,size:e,name:r,resolvable:Boolean(n),path:Boolean(i)}}var Lr=Bt,hp=ga;function ga(t,e){return e instanceof Uint8Array?ga.toString(t,e):ga.toBytes(t,e)}ga.toString=function(e,r){e=Lr(e);switch(e.code){case 4:case 41:return sE(r);case 6:case 273:case 33:case 132:return fp(r);case 53:case 54:case 55:case 56:case 400:case 777:return oE(r);case 421:return lE(r);case 444:return mp(r);case 445:return mp(r);default:return se(r,"base16")}},ga.toBytes=function(e,r){e=Lr(e);switch(e.code){case 4:return pp(r);case 41:return pp(r);case 6:case 273:case 33:case 132:return ul(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return aE(r);case 421:return cE(r);case 444:return uE(r);case 445:return dE(r);default:return je(r,"base16")}};function pp(t){if(!wo.isIP(t))throw new Error("invalid ip address");return wo.toBytes(t)}function sE(t){const e=wo.toString(t);if(!e||!wo.isIP(e))throw new Error("invalid ip address");return e}function ul(t){const e=new ArrayBuffer(2),r=new DataView(e);return r.setUint16(0,t),new Uint8Array(e)}function fp(t){const e=new DataView(t.buffer);return e.getUint16(0)}function aE(t){const e=je(t),r=Uint8Array.from(J.encode(e.length));return we([r,e],r.length+e.length)}function oE(t){const e=J.decode(t);if(t=t.slice(J.decode.bytes),t.length!==e)throw new Error("inconsistent lengths");return se(t)}function cE(t){const e=new Nr(t).multihash,r=Uint8Array.from(J.encode(e.length));return we([r,e],r.length+e.length)}function lE(t){const e=J.decode(t),r=t.slice(J.decode.bytes);if(r.length!==e)throw new Error("inconsistent lengths");return se(r,"base58btc")}function uE(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==16)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion address.");const r=Or.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=ul(n);return we([r,i],r.length+i.length)}function dE(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==56)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion3 address.");const r=Or.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=ul(n);return we([r,i],r.length+i.length)}function mp(t){const e=t.slice(0,t.length-2),r=t.slice(t.length-2),n=se(e,"base32"),i=fp(r);return n+":"+i}var Sr={stringToStringTuples:gp,stringTuplesToString:bp,tuplesToStringTuples:vp,stringTuplesToTuples:yp,bytesToTuples:dl,tuplesToBytes:wp,bytesToString:hE,stringToBytes:Ep,fromString:pE,fromBytes:Sp,validateBytes:hl,isValidBytes:fE,cleanPath:_o,ParseError:pl,protoFromTuple:ba,sizeForAddr:_p};function gp(t){const e=[],r=t.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let n=0;n<r.length;n++){const i=r[n],s=Lr(i);if(s.size===0){e.push([i]);continue}if(n++,n>=r.length)throw pl("invalid address: "+t);if(s.path){e.push([i,_o(r.slice(n).join("/"))]);break}e.push([i,r[n]])}return e}function bp(t){const e=[];return t.map(r=>{const n=ba(r);e.push(n.name),r.length>1&&e.push(r[1])}),_o(e.join("/"))}function yp(t){return t.map(e=>{Array.isArray(e)||(e=[e]);const r=ba(e);return e.length>1?[r.code,hp.toBytes(r.code,e[1])]:[r.code]})}function vp(t){return t.map(e=>{const r=ba(e);return e.length>1?[r.code,hp.toString(r.code,e[1])]:[r.code]})}function wp(t){return Sp(we(t.map(e=>{const r=ba(e);let n=Uint8Array.from(J.encode(r.code));return e.length>1&&(n=we([n,e[1]])),n})))}function _p(t,e){if(t.size>0)return t.size/8;if(t.size===0)return 0;{const r=J.decode(e);return r+J.decode.bytes}}function dl(t){const e=[];let r=0;for(;r<t.length;){const n=J.decode(t,r),i=J.decode.bytes,s=Lr(n),a=_p(s,t.slice(r+i));if(a===0){e.push([n]),r+=i;continue}const c=t.slice(r+i,r+i+a);if(r+=a+i,r>t.length)throw pl("Invalid address Uint8Array: "+se(t,"base16"));e.push([n,c])}return e}function hE(t){const e=dl(t),r=vp(e);return bp(r)}function Ep(t){t=_o(t);const e=gp(t),r=yp(e);return wp(r)}function pE(t){return Ep(t)}function Sp(t){const e=hl(t);if(e)throw e;return Uint8Array.from(t)}function hl(t){try{dl(t)}catch(e){return e}}function fE(t){return hl(t)===void 0}function _o(t){return"/"+t.trim().split("/").filter(e=>e).join("/")}function pl(t){return new Error("Error parsing address: "+t)}function ba(t){const e=Lr(t[0]);return e}var fl=te(function(t,e){const r=Symbol.for("nodejs.util.inspect.custom"),n=Ht.proto(function(i){if(!(this instanceof n))return new n(i);if(i==null&&(i=""),i instanceof Uint8Array)this.bytes=Sr.fromBytes(i);else if(typeof i=="string"||i instanceof String){if(i.length>0&&i.charAt(0)!=="/")throw new Error(`multiaddr "${i}" must start with a "/"`);this.bytes=Sr.fromString(i)}else if(i.bytes&&i.protos&&i.protoCodes)this.bytes=Sr.fromBytes(i.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});n.prototype.toString=function(){return Sr.bytesToString(this.bytes)},n.prototype.toJSON=n.prototype.toString,n.prototype.toOptions=function(){const s={},a=this.toString().split("/");return s.family=a[1]==="ip4"?"ipv4":"ipv6",s.host=a[2],s.transport=a[3],s.port=parseInt(a[4]),s},n.prototype[r]=function(){return"<Multiaddr "+se(this.bytes,"base16")+" - "+Sr.bytesToString(this.bytes)+">"},n.prototype.inspect=function(){return"<Multiaddr "+se(this.bytes,"base16")+" - "+Sr.bytesToString(this.bytes)+">"},n.prototype.protos=function(){return this.protoCodes().map(s=>Object.assign({},Lr(s)))},n.prototype.protoCodes=function(){const s=[],a=this.bytes;let c=0;for(;c<a.length;){const o=J.decode(a,c),l=J.decode.bytes,u=Lr(o),h=Sr.sizeForAddr(u,a.slice(c+l));c+=h+l,s.push(o)}return s},n.prototype.protoNames=function(){return this.protos().map(s=>s.name)},n.prototype.tuples=function(){return Sr.bytesToTuples(this.bytes)},n.prototype.stringTuples=function(){const s=Sr.bytesToTuples(this.bytes);return Sr.tuplesToStringTuples(s)},n.prototype.encapsulate=function(s){return s=n(s),n(this.toString()+s.toString())},n.prototype.decapsulate=function(s){s=s.toString();const a=this.toString(),c=a.lastIndexOf(s);if(c<0)throw new Error("Address "+this+" does not contain subaddress: "+s);return n(a.slice(0,c))},n.prototype.decapsulateCode=function(s){const a=this.tuples();for(let c=a.length-1;c>=0;c--)if(a[c][0]===s)return n(Sr.tuplesToBytes(a.slice(0,c)));return this},n.prototype.getPeerId=function(){let s=null;try{const a=this.stringTuples().filter(c=>{if(c[0]===Lr.names.ipfs.code)return!0});s=a.pop()[1],s=se(new Nr(s).multihash,"base58btc")}catch(a){s=null}return s},n.prototype.getPath=function(){let s=null;try{s=this.stringTuples().filter(a=>{const c=Lr(a[0]);if(c.path)return!0})[0][1]}catch(a){s=null}return s},n.prototype.equals=function(s){return tr(this.bytes,s.bytes)},n.prototype.nodeAddress=function(){const s=this.protoCodes(),a=this.protoNames(),c=this.toString().split("/").slice(1);if(c.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(s[0]!==4&&s[0]!==41&&s[0]!==54&&s[0]!==55)throw new Error(`no protocol with name: "'${a[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(c[2]!=="tcp"&&c[2]!=="udp")throw new Error(`no protocol with name: "'${a[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:s[0]===41||s[0]===55?6:4,address:c[1],port:parseInt(c[3])}},n.fromNodeAddress=function(s,a){if(!s)throw new Error("requires node address object");if(!a)throw new Error("requires transport protocol");let c;switch(s.family){case"IPv4":c="ip4";break;case"IPv6":c="ip6";break;default:throw Error(`Invalid addr family. Got '${s.family}' instead of 'IPv4' or 'IPv6'`)}return n("/"+[c,s.address,a,s.port].join("/"))},n.prototype.isThinWaistAddress=function(s){const a=(s||this).protos();return a.length!==2||a[0].code!==4&&a[0].code!==41?!1:!(a[1].code!==6&&a[1].code!==273)},n.protocols=Lr,n.isName=function(s){return n.isMultiaddr(s)?s.protos().some(a=>a.resolvable):!1},n.resolve=function(s){return!n.isMultiaddr(s)||!n.isName(s)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},e=t.exports=n}),Tp=te(function(t,e){(function(){var r,n=244837814094590,i=(n&16777215)==15715070;function s(m,w,T){m!=null&&(typeof m=="number"?this.fromNumber(m,w,T):w==null&&typeof m!="string"?this.fromString(m,256):this.fromString(m,w))}function a(){return new s(null)}function c(m,w,T,j,W,K){for(;--K>=0;){var Y=w*this[m++]+T[j]+W;W=Math.floor(Y/67108864),T[j++]=Y&67108863}return W}function o(m,w,T,j,W,K){for(var Y=w&32767,Z=w>>15;--K>=0;){var Ie=this[m]&32767,qe=this[m++]>>15,et=Z*Ie+qe*Y;Ie=Y*Ie+((et&32767)<<15)+T[j]+(W&1073741823),W=(Ie>>>30)+(et>>>15)+Z*qe+(W>>>30),T[j++]=Ie&1073741823}return W}function l(m,w,T,j,W,K){for(var Y=w&16383,Z=w>>14;--K>=0;){var Ie=this[m]&16383,qe=this[m++]>>14,et=Z*Ie+qe*Y;Ie=Y*Ie+((et&16383)<<14)+T[j]+W,W=(Ie>>28)+(et>>14)+Z*qe,T[j++]=Ie&268435455}return W}var u=typeof navigator!="undefined";u&&i&&navigator.appName=="Microsoft Internet Explorer"?(s.prototype.am=o,r=30):u&&i&&navigator.appName!="Netscape"?(s.prototype.am=c,r=26):(s.prototype.am=l,r=28),s.prototype.DB=r,s.prototype.DM=(1<<r)-1,s.prototype.DV=1<<r;var h=52;s.prototype.FV=Math.pow(2,h),s.prototype.F1=h-r,s.prototype.F2=2*r-h;var f="0123456789abcdefghijklmnopqrstuvwxyz",p=new Array,S,M;for(S="0".charCodeAt(0),M=0;M<=9;++M)p[S++]=M;for(S="a".charCodeAt(0),M=10;M<36;++M)p[S++]=M;for(S="A".charCodeAt(0),M=10;M<36;++M)p[S++]=M;function I(m){return f.charAt(m)}function k(m,w){var T=p[m.charCodeAt(w)];return T??-1}function V(m){for(var w=this.t-1;w>=0;--w)m[w]=this[w];m.t=this.t,m.s=this.s}function z(m){this.t=1,this.s=m<0?-1:0,m>0?this[0]=m:m<-1?this[0]=m+this.DV:this.t=0}function v(m){var w=a();return w.fromInt(m),w}function _(m,w){var T;if(w==16)T=4;else if(w==8)T=3;else if(w==256)T=8;else if(w==2)T=1;else if(w==32)T=5;else if(w==4)T=2;else{this.fromRadix(m,w);return}this.t=0,this.s=0;for(var j=m.length,W=!1,K=0;--j>=0;){var Y=T==8?m[j]&255:k(m,j);if(Y<0){m.charAt(j)=="-"&&(W=!0);continue}W=!1,K==0?this[this.t++]=Y:K+T>this.DB?(this[this.t-1]|=(Y&(1<<this.DB-K)-1)<<K,this[this.t++]=Y>>this.DB-K):this[this.t-1]|=Y<<K,K+=T,K>=this.DB&&(K-=this.DB)}T==8&&(m[0]&128)!=0&&(this.s=-1,K>0&&(this[this.t-1]|=(1<<this.DB-K)-1<<K)),this.clamp(),W&&s.ZERO.subTo(this,this)}function A(){for(var m=this.s&this.DM;this.t>0&&this[this.t-1]==m;)--this.t}function d(m){if(this.s<0)return"-"+this.negate().toString(m);var w;if(m==16)w=4;else if(m==8)w=3;else if(m==2)w=1;else if(m==32)w=5;else if(m==4)w=2;else return this.toRadix(m);var T=(1<<w)-1,j,W=!1,K="",Y=this.t,Z=this.DB-Y*this.DB%w;if(Y-- >0)for(Z<this.DB&&(j=this[Y]>>Z)>0&&(W=!0,K=I(j));Y>=0;)Z<w?(j=(this[Y]&(1<<Z)-1)<<w-Z,j|=this[--Y]>>(Z+=this.DB-w)):(j=this[Y]>>(Z-=w)&T,Z<=0&&(Z+=this.DB,--Y)),j>0&&(W=!0),W&&(K+=I(j));return W?K:"0"}function g(){var m=a();return s.ZERO.subTo(this,m),m}function E(){return this.s<0?this.negate():this}function b(m){var w=this.s-m.s;if(w!=0)return w;var T=this.t;if(w=T-m.t,w!=0)return this.s<0?-w:w;for(;--T>=0;)if((w=this[T]-m[T])!=0)return w;return 0}function C(m){var w=1,T;return(T=m>>>16)!=0&&(m=T,w+=16),(T=m>>8)!=0&&(m=T,w+=8),(T=m>>4)!=0&&(m=T,w+=4),(T=m>>2)!=0&&(m=T,w+=2),(T=m>>1)!=0&&(m=T,w+=1),w}function P(){return this.t<=0?0:this.DB*(this.t-1)+C(this[this.t-1]^this.s&this.DM)}function D(m,w){var T;for(T=this.t-1;T>=0;--T)w[T+m]=this[T];for(T=m-1;T>=0;--T)w[T]=0;w.t=this.t+m,w.s=this.s}function O(m,w){for(var T=m;T<this.t;++T)w[T-m]=this[T];w.t=Math.max(this.t-m,0),w.s=this.s}function x(m,w){var T=m%this.DB,j=this.DB-T,W=(1<<j)-1,K=Math.floor(m/this.DB),Y=this.s<<T&this.DM,Z;for(Z=this.t-1;Z>=0;--Z)w[Z+K+1]=this[Z]>>j|Y,Y=(this[Z]&W)<<T;for(Z=K-1;Z>=0;--Z)w[Z]=0;w[K]=Y,w.t=this.t+K+1,w.s=this.s,w.clamp()}function F(m,w){w.s=this.s;var T=Math.floor(m/this.DB);if(T>=this.t){w.t=0;return}var j=m%this.DB,W=this.DB-j,K=(1<<j)-1;w[0]=this[T]>>j;for(var Y=T+1;Y<this.t;++Y)w[Y-T-1]|=(this[Y]&K)<<W,w[Y-T]=this[Y]>>j;j>0&&(w[this.t-T-1]|=(this.s&K)<<W),w.t=this.t-T,w.clamp()}function $(m,w){for(var T=0,j=0,W=Math.min(m.t,this.t);T<W;)j+=this[T]-m[T],w[T++]=j&this.DM,j>>=this.DB;if(m.t<this.t){for(j-=m.s;T<this.t;)j+=this[T],w[T++]=j&this.DM,j>>=this.DB;j+=this.s}else{for(j+=this.s;T<m.t;)j-=m[T],w[T++]=j&this.DM,j>>=this.DB;j-=m.s}w.s=j<0?-1:0,j<-1?w[T++]=this.DV+j:j>0&&(w[T++]=j),w.t=T,w.clamp()}function H(m,w){var T=this.abs(),j=m.abs(),W=T.t;for(w.t=W+j.t;--W>=0;)w[W]=0;for(W=0;W<j.t;++W)w[W+T.t]=T.am(0,j[W],w,W,0,T.t);w.s=0,w.clamp(),this.s!=m.s&&s.ZERO.subTo(w,w)}function re(m){for(var w=this.abs(),T=m.t=2*w.t;--T>=0;)m[T]=0;for(T=0;T<w.t-1;++T){var j=w.am(T,w[T],m,2*T,0,1);(m[T+w.t]+=w.am(T+1,2*w[T],m,2*T+1,j,w.t-T-1))>=w.DV&&(m[T+w.t]-=w.DV,m[T+w.t+1]=1)}m.t>0&&(m[m.t-1]+=w.am(T,w[T],m,2*T,0,1)),m.s=0,m.clamp()}function ee(m,w,T){var j=m.abs();if(j.t<=0)return;var W=this.abs();if(W.t<j.t){w!=null&&w.fromInt(0),T!=null&&this.copyTo(T);return}T==null&&(T=a());var K=a(),Y=this.s,Z=m.s,Ie=this.DB-C(j[j.t-1]);Ie>0?(j.lShiftTo(Ie,K),W.lShiftTo(Ie,T)):(j.copyTo(K),W.copyTo(T));var qe=K.t,et=K[qe-1];if(et==0)return;var lt=et*(1<<this.F1)+(qe>1?K[qe-2]>>this.F2:0),Nt=this.FV/lt,zt=(1<<this.F1)/lt,ft=1<<this.F2,Ue=T.t,tt=Ue-qe,Jt=w??a();for(K.dlShiftTo(tt,Jt),T.compareTo(Jt)>=0&&(T[T.t++]=1,T.subTo(Jt,T)),s.ONE.dlShiftTo(qe,Jt),Jt.subTo(K,K);K.t<qe;)K[K.t++]=0;for(;--tt>=0;){var Kr=T[--Ue]==et?this.DM:Math.floor(T[Ue]*Nt+(T[Ue-1]+ft)*zt);if((T[Ue]+=K.am(0,Kr,T,tt,0,qe))<Kr)for(K.dlShiftTo(tt,Jt),T.subTo(Jt,T);T[Ue]<--Kr;)T.subTo(Jt,T)}w!=null&&(T.drShiftTo(qe,w),Y!=Z&&s.ZERO.subTo(w,w)),T.t=qe,T.clamp(),Ie>0&&T.rShiftTo(Ie,T),Y<0&&s.ZERO.subTo(T,T)}function ge(m){var w=a();return this.abs().divRemTo(m,null,w),this.s<0&&w.compareTo(s.ZERO)>0&&m.subTo(w,w),w}function _e(m){this.m=m}function oe(m){return m.s<0||m.compareTo(this.m)>=0?m.mod(this.m):m}function ce(m){return m}function Ae(m){m.divRemTo(this.m,null,m)}function Be(m,w,T){m.multiplyTo(w,T),this.reduce(T)}function fr(m,w){m.squareTo(w),this.reduce(w)}_e.prototype.convert=oe,_e.prototype.revert=ce,_e.prototype.reduce=Ae,_e.prototype.mulTo=Be,_e.prototype.sqrTo=fr;function $t(){if(this.t<1)return 0;var m=this[0];if((m&1)==0)return 0;var w=m&3;return w=w*(2-(m&15)*w)&15,w=w*(2-(m&255)*w)&255,w=w*(2-((m&65535)*w&65535))&65535,w=w*(2-m*w%this.DV)%this.DV,w>0?this.DV-w:-w}function ht(m){this.m=m,this.mp=m.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<m.DB-15)-1,this.mt2=2*m.t}function it(m){var w=a();return m.abs().dlShiftTo(this.m.t,w),w.divRemTo(this.m,null,w),m.s<0&&w.compareTo(s.ZERO)>0&&this.m.subTo(w,w),w}function Kt(m){var w=a();return m.copyTo(w),this.reduce(w),w}function Ze(m){for(;m.t<=this.mt2;)m[m.t++]=0;for(var w=0;w<this.m.t;++w){var T=m[w]&32767,j=T*this.mpl+((T*this.mph+(m[w]>>15)*this.mpl&this.um)<<15)&m.DM;for(T=w+this.m.t,m[T]+=this.m.am(0,j,m,w,0,this.m.t);m[T]>=m.DV;)m[T]-=m.DV,m[++T]++}m.clamp(),m.drShiftTo(this.m.t,m),m.compareTo(this.m)>=0&&m.subTo(this.m,m)}function We(m,w){m.squareTo(w),this.reduce(w)}function le(m,w,T){m.multiplyTo(w,T),this.reduce(T)}ht.prototype.convert=it,ht.prototype.revert=Kt,ht.prototype.reduce=Ze,ht.prototype.mulTo=le,ht.prototype.sqrTo=We;function Es(){return(this.t>0?this[0]&1:this.s)==0}function Si(m,w){if(m>4294967295||m<1)return s.ONE;var T=a(),j=a(),W=w.convert(this),K=C(m)-1;for(W.copyTo(T);--K>=0;)if(w.sqrTo(T,j),(m&1<<K)>0)w.mulTo(j,W,T);else{var Y=T;T=j,j=Y}return w.revert(T)}function Ss(m,w){var T;return m<256||w.isEven()?T=new _e(w):T=new ht(w),this.exp(m,T)}s.prototype.copyTo=V,s.prototype.fromInt=z,s.prototype.fromString=_,s.prototype.clamp=A,s.prototype.dlShiftTo=D,s.prototype.drShiftTo=O,s.prototype.lShiftTo=x,s.prototype.rShiftTo=F,s.prototype.subTo=$,s.prototype.multiplyTo=H,s.prototype.squareTo=re,s.prototype.divRemTo=ee,s.prototype.invDigit=$t,s.prototype.isEven=Es,s.prototype.exp=Si,s.prototype.toString=d,s.prototype.negate=g,s.prototype.abs=E,s.prototype.compareTo=b,s.prototype.bitLength=P,s.prototype.mod=ge,s.prototype.modPowInt=Ss,s.ZERO=v(0),s.ONE=v(1);function Xt(){var m=a();return this.copyTo(m),m}function Ti(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function Vr(){return this.t==0?this.s:this[0]<<24>>24}function $n(){return this.t==0?this.s:this[0]<<16>>16}function Gr(m){return Math.floor(Math.LN2*this.DB/Math.log(m))}function Rt(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function qn(m){if(m==null&&(m=10),this.signum()==0||m<2||m>36)return"0";var w=this.chunkSize(m),T=Math.pow(m,w),j=v(T),W=a(),K=a(),Y="";for(this.divRemTo(j,W,K);W.signum()>0;)Y=(T+K.intValue()).toString(m).substr(1)+Y,W.divRemTo(j,W,K);return K.intValue().toString(m)+Y}function Ai(m,w){this.fromInt(0),w==null&&(w=10);for(var T=this.chunkSize(w),j=Math.pow(w,T),W=!1,K=0,Y=0,Z=0;Z<m.length;++Z){var Ie=k(m,Z);if(Ie<0){m.charAt(Z)=="-"&&this.signum()==0&&(W=!0);continue}Y=w*Y+Ie,++K>=T&&(this.dMultiply(j),this.dAddOffset(Y,0),K=0,Y=0)}K>0&&(this.dMultiply(Math.pow(w,K)),this.dAddOffset(Y,0)),W&&s.ZERO.subTo(this,this)}function Ts(m,w,T){if(typeof w=="number")if(m<2)this.fromInt(1);else for(this.fromNumber(m,T),this.testBit(m-1)||this.bitwiseTo(s.ONE.shiftLeft(m-1),Vn,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(w);)this.dAddOffset(2,0),this.bitLength()>m&&this.subTo(s.ONE.shiftLeft(m-1),this);else{var j=new Array,W=m&7;j.length=(m>>3)+1,w.nextBytes(j),W>0?j[0]&=(1<<W)-1:j[0]=0,this.fromString(j,256)}}function As(){var m=this.t,w=new Array;w[0]=this.s;var T=this.DB-m*this.DB%8,j,W=0;if(m-- >0)for(T<this.DB&&(j=this[m]>>T)!=(this.s&this.DM)>>T&&(w[W++]=j|this.s<<this.DB-T);m>=0;)T<8?(j=(this[m]&(1<<T)-1)<<8-T,j|=this[--m]>>(T+=this.DB-8)):(j=this[m]>>(T-=8)&255,T<=0&&(T+=this.DB,--m)),(j&128)!=0&&(j|=-256),W==0&&(this.s&128)!=(j&128)&&++W,(W>0||j!=this.s)&&(w[W++]=j);return w}function dn(m){return this.compareTo(m)==0}function Ci(m){return this.compareTo(m)<0?this:m}function Ii(m){return this.compareTo(m)>0?this:m}function hn(m,w,T){var j,W,K=Math.min(m.t,this.t);for(j=0;j<K;++j)T[j]=w(this[j],m[j]);if(m.t<this.t){for(W=m.s&this.DM,j=K;j<this.t;++j)T[j]=w(this[j],W);T.t=this.t}else{for(W=this.s&this.DM,j=K;j<m.t;++j)T[j]=w(W,m[j]);T.t=m.t}T.s=w(this.s,m.s),T.clamp()}function Ri(m,w){return m&w}function ki(m){var w=a();return this.bitwiseTo(m,Ri,w),w}function Vn(m,w){return m|w}function Cs(m){var w=a();return this.bitwiseTo(m,Vn,w),w}function Qt(m,w){return m^w}function mr(m){var w=a();return this.bitwiseTo(m,Qt,w),w}function pn(m,w){return m&~w}function Gn(m){var w=a();return this.bitwiseTo(m,pn,w),w}function Pi(){for(var m=a(),w=0;w<this.t;++w)m[w]=this.DM&~this[w];return m.t=this.t,m.s=~this.s,m}function kt(m){var w=a();return m<0?this.rShiftTo(-m,w):this.lShiftTo(m,w),w}function Pt(m){var w=a();return m<0?this.lShiftTo(-m,w):this.rShiftTo(m,w),w}function Is(m){if(m==0)return-1;var w=0;return(m&65535)==0&&(m>>=16,w+=16),(m&255)==0&&(m>>=8,w+=8),(m&15)==0&&(m>>=4,w+=4),(m&3)==0&&(m>>=2,w+=2),(m&1)==0&&++w,w}function Yt(){for(var m=0;m<this.t;++m)if(this[m]!=0)return m*this.DB+Is(this[m]);return this.s<0?this.t*this.DB:-1}function Ni(m){for(var w=0;m!=0;)m&=m-1,++w;return w}function Rs(){for(var m=0,w=this.s&this.DM,T=0;T<this.t;++T)m+=Ni(this[T]^w);return m}function ks(m){var w=Math.floor(m/this.DB);return w>=this.t?this.s!=0:(this[w]&1<<m%this.DB)!=0}function Ps(m,w){var T=s.ONE.shiftLeft(m);return this.bitwiseTo(T,w,T),T}function Ns(m){return this.changeBit(m,Vn)}function vt(m){return this.changeBit(m,pn)}function zr(m){return this.changeBit(m,Qt)}function zn(m,w){for(var T=0,j=0,W=Math.min(m.t,this.t);T<W;)j+=this[T]+m[T],w[T++]=j&this.DM,j>>=this.DB;if(m.t<this.t){for(j+=m.s;T<this.t;)j+=this[T],w[T++]=j&this.DM,j>>=this.DB;j+=this.s}else{for(j+=this.s;T<m.t;)j+=m[T],w[T++]=j&this.DM,j>>=this.DB;j+=m.s}w.s=j<0?-1:0,j>0?w[T++]=j:j<-1&&(w[T++]=this.DV+j),w.t=T,w.clamp()}function Hn(m){var w=a();return this.addTo(m,w),w}function Wn(m){var w=a();return this.subTo(m,w),w}function Hr(m){var w=a();return this.multiplyTo(m,w),w}function kr(){var m=a();return this.squareTo(m),m}function Os(m){var w=a();return this.divRemTo(m,w,null),w}function Ms(m){var w=a();return this.divRemTo(m,null,w),w}function Ds(m){var w=a(),T=a();return this.divRemTo(m,w,T),new Array(w,T)}function xs(m){this[this.t]=this.am(0,m-1,this,0,0,this.t),++this.t,this.clamp()}function fn(m,w){if(m==0)return;for(;this.t<=w;)this[this.t++]=0;for(this[w]+=m;this[w]>=this.DV;)this[w]-=this.DV,++w>=this.t&&(this[this.t++]=0),++this[w]}function pt(){}function Kn(m){return m}function gr(m,w,T){m.multiplyTo(w,T)}function js(m,w){m.squareTo(w)}pt.prototype.convert=Kn,pt.prototype.revert=Kn,pt.prototype.mulTo=gr,pt.prototype.sqrTo=js;function Ls(m){return this.exp(m,new pt)}function Bs(m,w,T){var j=Math.min(this.t+m.t,w);for(T.s=0,T.t=j;j>0;)T[--j]=0;var W;for(W=T.t-this.t;j<W;++j)T[j+this.t]=this.am(0,m[j],T,j,0,this.t);for(W=Math.min(m.t,w);j<W;++j)this.am(0,m[j],T,j,0,w-j);T.clamp()}function Us(m,w,T){--w;var j=T.t=this.t+m.t-w;for(T.s=0;--j>=0;)T[j]=0;for(j=Math.max(w-this.t,0);j<m.t;++j)T[this.t+j-w]=this.am(w-j,m[j],T,0,0,this.t+j-w);T.clamp(),T.drShiftTo(1,T)}function qt(m){this.r2=a(),this.q3=a(),s.ONE.dlShiftTo(2*m.t,this.r2),this.mu=this.r2.divide(m),this.m=m}function Vt(m){if(m.s<0||m.t>2*this.m.t)return m.mod(this.m);if(m.compareTo(this.m)<0)return m;var w=a();return m.copyTo(w),this.reduce(w),w}function mn(m){return m}function Xn(m){for(m.drShiftTo(this.m.t-1,this.r2),m.t>this.m.t+1&&(m.t=this.m.t+1,m.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);m.compareTo(this.r2)<0;)m.dAddOffset(1,this.m.t+1);for(m.subTo(this.r2,m);m.compareTo(this.m)>=0;)m.subTo(this.m,m)}function Fs(m,w){m.squareTo(w),this.reduce(w)}function gn(m,w,T){m.multiplyTo(w,T),this.reduce(T)}qt.prototype.convert=Vt,qt.prototype.revert=mn,qt.prototype.reduce=Xn,qt.prototype.mulTo=gn,qt.prototype.sqrTo=Fs;function Oi(m,w){var T=m.bitLength(),j,W=v(1),K;if(T<=0)return W;T<18?j=1:T<48?j=3:T<144?j=4:T<768?j=5:j=6,T<8?K=new _e(w):w.isEven()?K=new qt(w):K=new ht(w);var Y=new Array,Z=3,Ie=j-1,qe=(1<<j)-1;if(Y[1]=K.convert(this),j>1){var et=a();for(K.sqrTo(Y[1],et);Z<=qe;)Y[Z]=a(),K.mulTo(et,Y[Z-2],Y[Z]),Z+=2}var lt=m.t-1,Nt,zt=!0,ft=a(),Ue;for(T=C(m[lt])-1;lt>=0;){for(T>=Ie?Nt=m[lt]>>T-Ie&qe:(Nt=(m[lt]&(1<<T+1)-1)<<Ie-T,lt>0&&(Nt|=m[lt-1]>>this.DB+T-Ie)),Z=j;(Nt&1)==0;)Nt>>=1,--Z;if((T-=Z)<0&&(T+=this.DB,--lt),zt)Y[Nt].copyTo(W),zt=!1;else{for(;Z>1;)K.sqrTo(W,ft),K.sqrTo(ft,W),Z-=2;Z>0?K.sqrTo(W,ft):(Ue=W,W=ft,ft=Ue),K.mulTo(ft,Y[Nt],W)}for(;lt>=0&&(m[lt]&1<<T)==0;)K.sqrTo(W,ft),Ue=W,W=ft,ft=Ue,--T<0&&(T=this.DB-1,--lt)}return K.revert(W)}function Gt(m){var w=this.s<0?this.negate():this.clone(),T=m.s<0?m.negate():m.clone();if(w.compareTo(T)<0){var j=w;w=T,T=j}var W=w.getLowestSetBit(),K=T.getLowestSetBit();if(K<0)return w;for(W<K&&(K=W),K>0&&(w.rShiftTo(K,w),T.rShiftTo(K,T));w.signum()>0;)(W=w.getLowestSetBit())>0&&w.rShiftTo(W,w),(W=T.getLowestSetBit())>0&&T.rShiftTo(W,T),w.compareTo(T)>=0?(w.subTo(T,w),w.rShiftTo(1,w)):(T.subTo(w,T),T.rShiftTo(1,T));return K>0&&T.lShiftTo(K,T),T}function $s(m){if(m<=0)return 0;var w=this.DV%m,T=this.s<0?m-1:0;if(this.t>0)if(w==0)T=this[0]%m;else for(var j=this.t-1;j>=0;--j)T=(w*T+this[j])%m;return T}function qs(m){var w=m.isEven();if(this.isEven()&&w||m.signum()==0)return s.ZERO;for(var T=m.clone(),j=this.clone(),W=v(1),K=v(0),Y=v(0),Z=v(1);T.signum()!=0;){for(;T.isEven();)T.rShiftTo(1,T),w?((!W.isEven()||!K.isEven())&&(W.addTo(this,W),K.subTo(m,K)),W.rShiftTo(1,W)):K.isEven()||K.subTo(m,K),K.rShiftTo(1,K);for(;j.isEven();)j.rShiftTo(1,j),w?((!Y.isEven()||!Z.isEven())&&(Y.addTo(this,Y),Z.subTo(m,Z)),Y.rShiftTo(1,Y)):Z.isEven()||Z.subTo(m,Z),Z.rShiftTo(1,Z);T.compareTo(j)>=0?(T.subTo(j,T),w&&W.subTo(Y,W),K.subTo(Z,K)):(j.subTo(T,j),w&&Y.subTo(W,Y),Z.subTo(K,Z))}if(j.compareTo(s.ONE)!=0)return s.ZERO;if(Z.compareTo(m)>=0)return Z.subtract(m);if(Z.signum()<0)Z.addTo(m,Z);else return Z;return Z.signum()<0?Z.add(m):Z}var Qe=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Vs=(1<<26)/Qe[Qe.length-1];function Gs(m){var w,T=this.abs();if(T.t==1&&T[0]<=Qe[Qe.length-1]){for(w=0;w<Qe.length;++w)if(T[0]==Qe[w])return!0;return!1}if(T.isEven())return!1;for(w=1;w<Qe.length;){for(var j=Qe[w],W=w+1;W<Qe.length&&j<Vs;)j*=Qe[W++];for(j=T.modInt(j);w<W;)if(j%Qe[w++]==0)return!1}return T.millerRabin(m)}function bn(m){var w=this.subtract(s.ONE),T=w.getLowestSetBit();if(T<=0)return!1;var j=w.shiftRight(T);m=m+1>>1,m>Qe.length&&(m=Qe.length);for(var W=a(),K=0;K<m;++K){W.fromInt(Qe[Math.floor(Math.random()*Qe.length)]);var Y=W.modPow(j,this);if(Y.compareTo(s.ONE)!=0&&Y.compareTo(w)!=0){for(var Z=1;Z++<T&&Y.compareTo(w)!=0;)if(Y=Y.modPowInt(2,this),Y.compareTo(s.ONE)==0)return!1;if(Y.compareTo(w)!=0)return!1}}return!0}s.prototype.chunkSize=Gr,s.prototype.toRadix=qn,s.prototype.fromRadix=Ai,s.prototype.fromNumber=Ts,s.prototype.bitwiseTo=hn,s.prototype.changeBit=Ps,s.prototype.addTo=zn,s.prototype.dMultiply=xs,s.prototype.dAddOffset=fn,s.prototype.multiplyLowerTo=Bs,s.prototype.multiplyUpperTo=Us,s.prototype.modInt=$s,s.prototype.millerRabin=bn,s.prototype.clone=Xt,s.prototype.intValue=Ti,s.prototype.byteValue=Vr,s.prototype.shortValue=$n,s.prototype.signum=Rt,s.prototype.toByteArray=As,s.prototype.equals=dn,s.prototype.min=Ci,s.prototype.max=Ii,s.prototype.and=ki,s.prototype.or=Cs,s.prototype.xor=mr,s.prototype.andNot=Gn,s.prototype.not=Pi,s.prototype.shiftLeft=kt,s.prototype.shiftRight=Pt,s.prototype.getLowestSetBit=Yt,s.prototype.bitCount=Rs,s.prototype.testBit=ks,s.prototype.setBit=Ns,s.prototype.clearBit=vt,s.prototype.flipBit=zr,s.prototype.add=Hn,s.prototype.subtract=Wn,s.prototype.multiply=Hr,s.prototype.divide=Os,s.prototype.remainder=Ms,s.prototype.divideAndRemainder=Ds,s.prototype.modPow=Oi,s.prototype.modInverse=qs,s.prototype.pow=Ls,s.prototype.gcd=Gt,s.prototype.isProbablePrime=Gs,s.prototype.square=kr,s.prototype.Barrett=qt;var yn,ct,Oe;function zs(m){ct[Oe++]^=m&255,ct[Oe++]^=m>>8&255,ct[Oe++]^=m>>16&255,ct[Oe++]^=m>>24&255,Oe>=_n&&(Oe-=_n)}function Mi(){zs(new Date().getTime())}if(ct==null){ct=new Array,Oe=0;var wt;if(typeof window!="undefined"&&window.crypto){if(window.crypto.getRandomValues){var Di=new Uint8Array(32);for(window.crypto.getRandomValues(Di),wt=0;wt<32;++wt)ct[Oe++]=Di[wt]}else if(navigator.appName=="Netscape"&&navigator.appVersion<"5"){var Wr=window.crypto.random(32);for(wt=0;wt<Wr.length;++wt)ct[Oe++]=Wr.charCodeAt(wt)&255}}for(;Oe<_n;)wt=Math.floor(65536*Math.random()),ct[Oe++]=wt>>>8,ct[Oe++]=wt&255;Oe=0,Mi()}function Qn(){if(yn==null){for(Mi(),yn=Ws(),yn.init(ct),Oe=0;Oe<ct.length;++Oe)ct[Oe]=0;Oe=0}return yn.next()}function vn(m){var w;for(w=0;w<m.length;++w)m[w]=Qn()}function Yn(){}Yn.prototype.nextBytes=vn;function wn(){this.i=0,this.j=0,this.S=new Array}function Hs(m){var w,T,j;for(w=0;w<256;++w)this.S[w]=w;for(T=0,w=0;w<256;++w)T=T+this.S[w]+m[w%m.length]&255,j=this.S[w],this.S[w]=this.S[T],this.S[T]=j;this.i=0,this.j=0}function Jn(){var m;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,m=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=m,this.S[m+this.S[this.i]&255]}wn.prototype.init=Hs,wn.prototype.next=Jn;function Ws(){return new wn}var _n=256;e=t.exports={default:s,BigInteger:s,SecureRandom:Yn}}).call(ae)}),Tr=te(function(t,e){var r=e.falseIfInvalid=function(n){return function(){return this.valid?n.apply(this,arguments):!1}};e.isInSubnet=r(function(n){return this.subnetMask<n.subnetMask?!1:this.mask(n.subnetMask)===n.mask()}),e.isCorrect=function(n){return r(function(){return this.addressMinusSuffix!==this.correctForm()?!1:this.subnetMask===n&&!this.parsedSubnet?!0:this.parsedSubnet===String(this.subnetMask)})}}),ya=te(function(t,e){!function(){var r={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function n(o){return s(c(o),arguments)}function i(o,l){return n.apply(null,[o].concat(l||[]))}function s(o,l){var u=1,h=o.length,f,p="",S,M,I,k,V,z,v,_;for(S=0;S<h;S++)if(typeof o[S]=="string")p+=o[S];else if(typeof o[S]=="object"){if(I=o[S],I.keys)for(f=l[u],M=0;M<I.keys.length;M++){if(f==null)throw new Error(n('[sprintf] Cannot access property "%s" of undefined value "%s"',I.keys[M],I.keys[M-1]));f=f[I.keys[M]]}else I.param_no?f=l[I.param_no]:f=l[u++];if(r.not_type.test(I.type)&&r.not_primitive.test(I.type)&&f instanceof Function&&(f=f()),r.numeric_arg.test(I.type)&&typeof f!="number"&&isNaN(f))throw new TypeError(n("[sprintf] expecting number but found %T",f));r.number.test(I.type)&&(v=f>=0);switch(I.type){case"b":f=parseInt(f,10).toString(2);break;case"c":f=String.fromCharCode(parseInt(f,10));break;case"d":case"i":f=parseInt(f,10);break;case"j":f=JSON.stringify(f,null,I.width?parseInt(I.width):0);break;case"e":f=I.precision?parseFloat(f).toExponential(I.precision):parseFloat(f).toExponential();break;case"f":f=I.precision?parseFloat(f).toFixed(I.precision):parseFloat(f);break;case"g":f=I.precision?String(Number(f.toPrecision(I.precision))):parseFloat(f);break;case"o":f=(parseInt(f,10)>>>0).toString(8);break;case"s":f=String(f),f=I.precision?f.substring(0,I.precision):f;break;case"t":f=String(!!f),f=I.precision?f.substring(0,I.precision):f;break;case"T":f=Object.prototype.toString.call(f).slice(8,-1).toLowerCase(),f=I.precision?f.substring(0,I.precision):f;break;case"u":f=parseInt(f,10)>>>0;break;case"v":f=f.valueOf(),f=I.precision?f.substring(0,I.precision):f;break;case"x":f=(parseInt(f,10)>>>0).toString(16);break;case"X":f=(parseInt(f,10)>>>0).toString(16).toUpperCase();break}r.json.test(I.type)?p+=f:(r.number.test(I.type)&&(!v||I.sign)?(_=v?"+":"-",f=f.toString().replace(r.sign,"")):_="",V=I.pad_char?I.pad_char==="0"?"0":I.pad_char.charAt(1):" ",z=I.width-(_+f).length,k=I.width&&z>0?V.repeat(z):"",p+=I.align?_+f+k:V==="0"?_+k+f:k+_+f)}return p}var a=Object.create(null);function c(o){if(a[o])return a[o];for(var l=o,u,h=[],f=0;l;){if((u=r.text.exec(l))!==null)h.push(u[0]);else if((u=r.modulo.exec(l))!==null)h.push("%");else if((u=r.placeholder.exec(l))!==null){if(u[2]){f|=1;var p=[],S=u[2],M=[];if((M=r.key.exec(S))!==null)for(p.push(M[1]);(S=S.substring(M[0].length))!=="";)if((M=r.key_access.exec(S))!==null)p.push(M[1]);else if((M=r.index_access.exec(S))!==null)p.push(M[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");u[2]=p}else f|=2;if(f===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");h.push({placeholder:u[0],param_no:u[1],keys:u[2],sign:u[3],pad_char:u[4],align:u[5],width:u[6],precision:u[7],type:u[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");l=l.substring(u[0].length)}return a[o]=h}e.sprintf=n,e.vsprintf=i,typeof window!="undefined"&&(window.sprintf=n,window.vsprintf=i)}()}),ml=1/0,mE=9007199254740991,gE=17976931348623157e292,Ap=0/0,bE="[object Symbol]",yE=/^\s+|\s+$/g,vE=/^[-+]0x[0-9a-f]+$/i,wE=/^0b[01]+$/i,_E=/^0o[0-7]+$/i,gl="\\ud800-\\udfff",Cp="\\u0300-\\u036f\\ufe20-\\ufe23",Ip="\\u20d0-\\u20f0",Rp="\\ufe0e\\ufe0f",EE="["+gl+"]",bl="["+Cp+Ip+"]",yl="\\ud83c[\\udffb-\\udfff]",SE="(?:"+bl+"|"+yl+")",kp="[^"+gl+"]",Pp="(?:\\ud83c[\\udde6-\\uddff]){2}",Np="[\\ud800-\\udbff][\\udc00-\\udfff]",Op="\\u200d",Mp=SE+"?",Dp="["+Rp+"]?",TE="(?:"+Op+"(?:"+[kp,Pp,Np].join("|")+")"+Dp+Mp+")*",AE=Dp+Mp+TE,CE="(?:"+[kp+bl+"?",bl,Pp,Np,EE].join("|")+")",vl=RegExp(yl+"(?="+yl+")|"+CE+AE,"g"),IE=RegExp("["+Op+gl+Cp+Ip+Rp+"]"),RE=parseInt,kE=typeof ae=="object"&&ae&&ae.Object===Object&&ae,PE=typeof self=="object"&&self&&self.Object===Object&&self,NE=kE||PE||Function("return this")(),OE=DE("length");function ME(t){return t.split("")}function DE(t){return function(e){return e==null?void 0:e[t]}}function wl(t){return IE.test(t)}function xp(t){return wl(t)?jE(t):OE(t)}function xE(t){return wl(t)?LE(t):ME(t)}function jE(t){for(var e=vl.lastIndex=0;vl.test(t);)e++;return e}function LE(t){return t.match(vl)||[]}var BE=Object.prototype,UE=BE.toString,jp=NE.Symbol,FE=Math.ceil,$E=Math.floor,Lp=jp?jp.prototype:void 0,Bp=Lp?Lp.toString:void 0;function Up(t,e){var r="";if(!t||e<1||e>mE)return r;do e%2&&(r+=t),e=$E(e/2),e&&(t+=t);while(e);return r}function qE(t,e,r){var n=-1,i=t.length;e<0&&(e=-e>i?0:i+e),r=r>i?i:r,r<0&&(r+=i),i=e>r?0:r-e>>>0,e>>>=0;for(var s=Array(i);++n<i;)s[n]=t[n+e];return s}function Fp(t){if(typeof t=="string")return t;if(qp(t))return Bp?Bp.call(t):"";var e=t+"";return e=="0"&&1/t==-ml?"-0":e}function VE(t,e,r){var n=t.length;return r=r===void 0?n:r,!e&&r>=n?t:qE(t,e,r)}function GE(t,e){e=e===void 0?" ":Fp(e);var r=e.length;if(r<2)return r?Up(e,t):e;var n=Up(e,FE(t/xp(e)));return wl(e)?VE(xE(n),0,t).join(""):n.slice(0,t)}function $p(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function zE(t){return!!t&&typeof t=="object"}function qp(t){return typeof t=="symbol"||zE(t)&&UE.call(t)==bE}function HE(t){if(!t)return t===0?t:0;if(t=KE(t),t===ml||t===-ml){var e=t<0?-1:1;return e*gE}return t===t?t:0}function WE(t){var e=HE(t),r=e%1;return e===e?r?e-r:e:0}function KE(t){if(typeof t=="number")return t;if(qp(t))return Ap;if($p(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=$p(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(yE,"");var r=wE.test(t);return r||_E.test(t)?RE(t.slice(2),r?2:8):vE.test(t)?Ap:+t}function XE(t){return t==null?"":Fp(t)}function QE(t,e,r){t=XE(t),e=WE(e);var n=e?xp(t):0;return e&&n<e?GE(e-n,r)+t:t}var va=QE,_l=1/0,El=9007199254740991,YE=17976931348623157e292,Vp=0/0,JE="[object Function]",ZE="[object GeneratorFunction]",eS="[object Symbol]",tS=/^\s+|\s+$/g,rS=/^[-+]0x[0-9a-f]+$/i,nS=/^0b[01]+$/i,iS=/^0o[0-7]+$/i,sS=/^(?:0|[1-9]\d*)$/,aS=parseInt,oS=typeof ae=="object"&&ae&&ae.Object===Object&&ae,cS=typeof self=="object"&&self&&self.Object===Object&&self,lS=oS||cS||Function("return this")(),uS=Object.prototype,Gp=uS.toString,zp=lS.Symbol,dS=Math.floor,Hp=zp?zp.prototype:void 0,Wp=Hp?Hp.toString:void 0;function hS(t,e){var r="";if(!t||e<1||e>El)return r;do e%2&&(r+=t),e=dS(e/2),e&&(t+=t);while(e);return r}function pS(t){if(typeof t=="string")return t;if(Kp(t))return Wp?Wp.call(t):"";var e=t+"";return e=="0"&&1/t==-_l?"-0":e}function fS(t,e){return e=e??El,!!e&&(typeof t=="number"||sS.test(t))&&(t>-1&&t%1==0)&&t<e}function mS(t,e,r){if(!Eo(r))return!1;var n=typeof e;return(n=="number"?bS(r)&&fS(e,r.length):n=="string"&&e in r)?gS(r[e],t):!1}function gS(t,e){return t===e||t!==t&&e!==e}function bS(t){return t!=null&&vS(t.length)&&!yS(t)}function yS(t){var e=Eo(t)?Gp.call(t):"";return e==JE||e==ZE}function vS(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=El}function Eo(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function wS(t){return!!t&&typeof t=="object"}function Kp(t){return typeof t=="symbol"||wS(t)&&Gp.call(t)==eS}function _S(t){if(!t)return t===0?t:0;if(t=SS(t),t===_l||t===-_l){var e=t<0?-1:1;return e*YE}return t===t?t:0}function ES(t){var e=_S(t),r=e%1;return e===e?r?e-r:e:0}function SS(t){if(typeof t=="number")return t;if(Kp(t))return Vp;if(Eo(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Eo(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(tS,"");var r=nS.test(t);return r||iS.test(t)?aS(t.slice(2),r?2:8):rS.test(t)?Vp:+t}function TS(t){return t==null?"":pS(t)}function AS(t,e,r){return(r?mS(t,e,r):e===void 0)?e=1:e=ES(e),hS(TS(t),e)}var So=AS,CS=32,IS=4,RS=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/g,kS=/\/\d{1,2}$/,Ct={BITS:CS,GROUPS:IS,RE_ADDRESS:RS,RE_SUBNET_STRING:kS},wa=Tp.BigInteger,To=ya.sprintf;function Ne(t){this.valid=!1,this.address=t,this.groups=Ct.GROUPS,this.v4=!0,this.subnet="/32",this.subnetMask=32;var e=Ct.RE_SUBNET_STRING.exec(t);if(e){if(this.parsedSubnet=e[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,this.subnetMask<0||this.subnetMask>Ct.BITS){this.valid=!1,this.error="Invalid subnet mask.";return}t=t.replace(Ct.RE_SUBNET_STRING,"")}this.addressMinusSuffix=t,this.parsedAddress=this.parse(t)}Ne.prototype.parse=function(t){var e=t.split(".");return t.match(Ct.RE_ADDRESS)?this.valid=!0:this.error="Invalid IPv4 address.",e},Ne.prototype.isValid=function(){return this.valid},Ne.prototype.correctForm=function(){return this.parsedAddress.map(function(t){return parseInt(t,10)}).join(".")},Ne.prototype.isCorrect=Tr.isCorrect(Ct.BITS),Ne.fromHex=function(t){var e=va(t.replace(/:/g,""),8,"0"),r=[],n;for(n=0;n<8;n+=2){var i=e.slice(n,n+2);r.push(parseInt(i,16))}return new Ne(r.join("."))},Ne.fromInteger=function(t){return Ne.fromHex(t.toString(16))},Ne.prototype.toHex=function(){return this.parsedAddress.map(function(t){return To("%02x",parseInt(t,10))}).join(":")},Ne.prototype.toArray=function(){return this.parsedAddress.map(function(t){return parseInt(t,10)})},Ne.prototype.toGroup6=function(){var t=[],e;for(e=0;e<Ct.GROUPS;e+=2){var r=To("%02x%02x",parseInt(this.parsedAddress[e],10),parseInt(this.parsedAddress[e+1],10));t.push(To("%x",parseInt(r,16)))}return t.join(":")},Ne.prototype.bigInteger=function(){return this.valid?new wa(this.parsedAddress.map(function(t){return To("%02x",parseInt(t,10))}).join(""),16):null},Ne.prototype._startAddress=function(){return new wa(this.mask()+So("0",Ct.BITS-this.subnetMask),2)},Ne.prototype.startAddress=function(){return Ne.fromBigInteger(this._startAddress())},Ne.prototype.startAddressExclusive=function(){var t=new wa("1");return Ne.fromBigInteger(this._startAddress().add(t))},Ne.prototype._endAddress=function(){return new wa(this.mask()+So("1",Ct.BITS-this.subnetMask),2)},Ne.prototype.endAddress=function(){return Ne.fromBigInteger(this._endAddress())},Ne.prototype.endAddressExclusive=function(){var t=new wa("1");return Ne.fromBigInteger(this._endAddress().subtract(t))},Ne.fromBigInteger=function(t){return Ne.fromInteger(parseInt(t.toString(),10))},Ne.prototype.mask=function(t){return t===void 0&&(t=this.subnetMask),this.getBitsBase2(0,t)},Ne.prototype.getBitsBase2=function(t,e){return this.binaryZeroPad().slice(t,e)},Ne.prototype.isInSubnet=Tr.isInSubnet,Ne.prototype.isMulticast=function(){return this.isInSubnet(new Ne("224.0.0.0/4"))},Ne.prototype.binaryZeroPad=function(){return va(this.bigInteger().toString(2),Ct.BITS,"0")};var ui=Ne,Sl=te(function(t,e){var r=200,n="__lodash_hash_undefined__",i=800,s=16,a=9007199254740991,c="[object Arguments]",o="[object Array]",l="[object AsyncFunction]",u="[object Boolean]",h="[object Date]",f="[object Error]",p="[object Function]",S="[object GeneratorFunction]",M="[object Map]",I="[object Number]",k="[object Null]",V="[object Object]",z="[object Proxy]",v="[object RegExp]",_="[object Set]",A="[object String]",d="[object Undefined]",g="[object WeakMap]",E="[object ArrayBuffer]",b="[object DataView]",C="[object Float32Array]",P="[object Float64Array]",D="[object Int8Array]",O="[object Int16Array]",x="[object Int32Array]",F="[object Uint8Array]",$="[object Uint8ClampedArray]",H="[object Uint16Array]",re="[object Uint32Array]",ee=/[\\^$.*+?()[\]{}|]/g,ge=/^\[object .+?Constructor\]$/,_e=/^(?:0|[1-9]\d*)$/,oe={};oe[C]=oe[P]=oe[D]=oe[O]=oe[x]=oe[F]=oe[$]=oe[H]=oe[re]=!0,oe[c]=oe[o]=oe[E]=oe[u]=oe[b]=oe[h]=oe[f]=oe[p]=oe[M]=oe[I]=oe[V]=oe[v]=oe[_]=oe[A]=oe[g]=!1;var ce=typeof ae=="object"&&ae&&ae.Object===Object&&ae,Ae=typeof self=="object"&&self&&self.Object===Object&&self,Be=ce||Ae||Function("return this")(),fr=e&&!e.nodeType&&e,$t=fr&&!0&&t&&!t.nodeType&&t,ht=$t&&$t.exports===fr,it=ht&&ce.process,Kt=function(){try{var R=$t&&$t.require&&$t.require("util").types;return R||it&&it.binding&&it.binding("util")}catch(L){}}(),Ze=Kt&&Kt.isTypedArray;function We(R,L,q){switch(q.length){case 0:return R.call(L);case 1:return R.call(L,q[0]);case 2:return R.call(L,q[0],q[1]);case 3:return R.call(L,q[0],q[1],q[2])}return R.apply(L,q)}function le(R,L){for(var q=-1,ne=Array(R);++q<R;)ne[q]=L(q);return ne}function Es(R){return function(L){return R(L)}}function Si(R,L){return R==null?void 0:R[L]}function Ss(R,L){return function(q){return R(L(q))}}var Xt=Array.prototype,Ti=Function.prototype,Vr=Object.prototype,$n=Be["__core-js_shared__"],Gr=Ti.toString,Rt=Vr.hasOwnProperty,qn=function(){var R=/[^.]+$/.exec($n&&$n.keys&&$n.keys.IE_PROTO||"");return R?"Symbol(src)_1."+R:""}(),Ai=Vr.toString,Ts=Gr.call(Object),As=RegExp("^"+Gr.call(Rt).replace(ee,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),dn=ht?Be.Buffer:void 0,Ci=Be.Symbol,Ii=Be.Uint8Array,hn=dn?dn.allocUnsafe:void 0,Ri=Ss(Object.getPrototypeOf,Object),ki=Object.create,Vn=Vr.propertyIsEnumerable,Cs=Xt.splice,Qt=Ci?Ci.toStringTag:void 0,mr=function(){try{var R=Qn(Object,"defineProperty");return R({},"",{}),R}catch(L){}}(),pn=dn?dn.isBuffer:void 0,Gn=Math.max,Pi=Date.now,kt=Qn(Be,"Map"),Pt=Qn(Object,"create"),Is=function(){function R(){}return function(L){if(!Ue(L))return{};if(ki)return ki(L);R.prototype=L;var q=new R;return R.prototype=void 0,q}}();function Yt(R){var L=-1,q=R==null?0:R.length;for(this.clear();++L<q;){var ne=R[L];this.set(ne[0],ne[1])}}function Ni(){this.__data__=Pt?Pt(null):{},this.size=0}function Rs(R){var L=this.has(R)&&delete this.__data__[R];return this.size-=L?1:0,L}function ks(R){var L=this.__data__;if(Pt){var q=L[R];return q===n?void 0:q}return Rt.call(L,R)?L[R]:void 0}function Ps(R){var L=this.__data__;return Pt?L[R]!==void 0:Rt.call(L,R)}function Ns(R,L){var q=this.__data__;return this.size+=this.has(R)?0:1,q[R]=Pt&&L===void 0?n:L,this}Yt.prototype.clear=Ni,Yt.prototype.delete=Rs,Yt.prototype.get=ks,Yt.prototype.has=Ps,Yt.prototype.set=Ns;function vt(R){var L=-1,q=R==null?0:R.length;for(this.clear();++L<q;){var ne=R[L];this.set(ne[0],ne[1])}}function zr(){this.__data__=[],this.size=0}function zn(R){var L=this.__data__,q=mn(L,R);if(q<0)return!1;var ne=L.length-1;return q==ne?L.pop():Cs.call(L,q,1),--this.size,!0}function Hn(R){var L=this.__data__,q=mn(L,R);return q<0?void 0:L[q][1]}function Wn(R){return mn(this.__data__,R)>-1}function Hr(R,L){var q=this.__data__,ne=mn(q,R);return ne<0?(++this.size,q.push([R,L])):q[ne][1]=L,this}vt.prototype.clear=zr,vt.prototype.delete=zn,vt.prototype.get=Hn,vt.prototype.has=Wn,vt.prototype.set=Hr;function kr(R){var L=-1,q=R==null?0:R.length;for(this.clear();++L<q;){var ne=R[L];this.set(ne[0],ne[1])}}function Os(){this.size=0,this.__data__={hash:new Yt,map:new(kt||vt),string:new Yt}}function Ms(R){var L=Wr(this,R).delete(R);return this.size-=L?1:0,L}function Ds(R){return Wr(this,R).get(R)}function xs(R){return Wr(this,R).has(R)}function fn(R,L){var q=Wr(this,R),ne=q.size;return q.set(R,L),this.size+=q.size==ne?0:1,this}kr.prototype.clear=Os,kr.prototype.delete=Ms,kr.prototype.get=Ds,kr.prototype.has=xs,kr.prototype.set=fn;function pt(R){var L=this.__data__=new vt(R);this.size=L.size}function Kn(){this.__data__=new vt,this.size=0}function gr(R){var L=this.__data__,q=L.delete(R);return this.size=L.size,q}function js(R){return this.__data__.get(R)}function Ls(R){return this.__data__.has(R)}function Bs(R,L){var q=this.__data__;if(q instanceof vt){var ne=q.__data__;if(!kt||ne.length<r-1)return ne.push([R,L]),this.size=++q.size,this;q=this.__data__=new kr(ne)}return q.set(R,L),this.size=q.size,this}pt.prototype.clear=Kn,pt.prototype.delete=gr,pt.prototype.get=js,pt.prototype.has=Ls,pt.prototype.set=Bs;function Us(R,L){var q=qe(R),ne=!q&&Ie(R),Ee=!q&&!ne&&Nt(R),Pe=!q&&!ne&&!Ee&&Kr(R),xe=q||ne||Ee||Pe,ye=xe?le(R.length,String):[],Re=ye.length;for(var mt in R)(L||Rt.call(R,mt))&&!(xe&&(mt=="length"||Ee&&(mt=="offset"||mt=="parent")||Pe&&(mt=="buffer"||mt=="byteLength"||mt=="byteOffset")||wn(mt,Re)))&&ye.push(mt);return ye}function qt(R,L,q){(q!==void 0&&!Z(R[L],q)||q===void 0&&!(L in R))&&Xn(R,L,q)}function Vt(R,L,q){var ne=R[L];(!(Rt.call(R,L)&&Z(ne,q))||q===void 0&&!(L in R))&&Xn(R,L,q)}function mn(R,L){for(var q=R.length;q--;)if(Z(R[q][0],L))return q;return-1}function Xn(R,L,q){L=="__proto__"&&mr?mr(R,L,{configurable:!0,enumerable:!0,value:q,writable:!0}):R[L]=q}var Fs=Di();function gn(R){return R==null?R===void 0?d:k:Qt&&Qt in Object(R)?vn(R):w(R)}function Oi(R){return tt(R)&&gn(R)==c}function Gt(R){if(!Ue(R)||Ws(R))return!1;var L=zt(R)?As:ge;return L.test(Y(R))}function $s(R){return tt(R)&&ft(R.length)&&!!oe[gn(R)]}function qs(R){if(!Ue(R))return m(R);var L=_n(R),q=[];for(var ne in R)ne=="constructor"&&(L||!Rt.call(R,ne))||q.push(ne);return q}function Qe(R,L,q,ne,Ee){if(R===L)return;Fs(L,function(Pe,xe){if(Ee||(Ee=new pt),Ue(Pe))Vs(R,L,xe,q,Qe,ne,Ee);else{var ye=ne?ne(j(R,xe),Pe,xe+"",R,L,Ee):void 0;ye===void 0&&(ye=Pe),qt(R,xe,ye)}},Ma)}function Vs(R,L,q,ne,Ee,Pe,xe){var ye=j(R,q),Re=j(L,q),mt=xe.get(Re);if(mt){qt(R,q,mt);return}var _t=Pe?Pe(ye,Re,q+"",R,L,xe):void 0,En=_t===void 0;if(En){var Zn=qe(Re),Pr=!Zn&&Nt(Re),ei=!Zn&&!Pr&&Kr(Re);_t=Re,Zn||Pr||ei?qe(ye)?_t=ye:lt(ye)?_t=zs(ye):Pr?(En=!1,_t=yn(Re,!0)):ei?(En=!1,_t=Oe(Re,!0)):_t=[]:Jt(Re)||Ie(Re)?(_t=ye,Ie(ye)?_t=xi(ye):(!Ue(ye)||zt(ye))&&(_t=Yn(Re))):En=!1}En&&(xe.set(Re,_t),Ee(_t,Re,ne,Pe,xe),xe.delete(Re)),qt(R,q,_t)}function Gs(R,L){return W(T(R,L,Ks),R+"")}var bn=mr?function(R,L){return mr(R,"toString",{configurable:!0,enumerable:!1,value:tc(L),writable:!0})}:Ks;function yn(R,L){if(L)return R.slice();var q=R.length,ne=hn?hn(q):new R.constructor(q);return R.copy(ne),ne}function ct(R){var L=new R.constructor(R.byteLength);return new Ii(L).set(new Ii(R)),L}function Oe(R,L){var q=L?ct(R.buffer):R.buffer;return new R.constructor(q,R.byteOffset,R.length)}function zs(R,L){var q=-1,ne=R.length;for(L||(L=Array(ne));++q<ne;)L[q]=R[q];return L}function Mi(R,L,q,ne){var Ee=!q;q||(q={});for(var Pe=-1,xe=L.length;++Pe<xe;){var ye=L[Pe],Re=ne?ne(q[ye],R[ye],ye,q,R):void 0;Re===void 0&&(Re=R[ye]),Ee?Xn(q,ye,Re):Vt(q,ye,Re)}return q}function wt(R){return Gs(function(L,q){var ne=-1,Ee=q.length,Pe=Ee>1?q[Ee-1]:void 0,xe=Ee>2?q[2]:void 0;for(Pe=R.length>3&&typeof Pe=="function"?(Ee--,Pe):void 0,xe&&Hs(q[0],q[1],xe)&&(Pe=Ee<3?void 0:Pe,Ee=1),L=Object(L);++ne<Ee;){var ye=q[ne];ye&&R(L,ye,ne,Pe)}return L})}function Di(R){return function(L,q,ne){for(var Ee=-1,Pe=Object(L),xe=ne(L),ye=xe.length;ye--;){var Re=xe[R?ye:++Ee];if(q(Pe[Re],Re,Pe)===!1)break}return L}}function Wr(R,L){var q=R.__data__;return Jn(L)?q[typeof L=="string"?"string":"hash"]:q.map}function Qn(R,L){var q=Si(R,L);return Gt(q)?q:void 0}function vn(R){var L=Rt.call(R,Qt),q=R[Qt];try{R[Qt]=void 0;var ne=!0}catch(Pe){}var Ee=Ai.call(R);return ne&&(L?R[Qt]=q:delete R[Qt]),Ee}function Yn(R){return typeof R.constructor=="function"&&!_n(R)?Is(Ri(R)):{}}function wn(R,L){var q=typeof R;return L=L??a,!!L&&(q=="number"||q!="symbol"&&_e.test(R))&&(R>-1&&R%1==0)&&R<L}function Hs(R,L,q){if(!Ue(q))return!1;var ne=typeof L;return(ne=="number"?et(q)&&wn(L,q.length):ne=="string"&&L in q)?Z(q[L],R):!1}function Jn(R){var L=typeof R;return L=="string"||L=="number"||L=="symbol"||L=="boolean"?R!=="__proto__":R===null}function Ws(R){return!!qn&&qn in R}function _n(R){var L=R&&R.constructor,q=typeof L=="function"&&L.prototype||Vr;return R===q}function m(R){var L=[];if(R!=null)for(var q in Object(R))L.push(q);return L}function w(R){return Ai.call(R)}function T(R,L,q){return L=Gn(L===void 0?R.length-1:L,0),function(){for(var ne=arguments,Ee=-1,Pe=Gn(ne.length-L,0),xe=Array(Pe);++Ee<Pe;)xe[Ee]=ne[L+Ee];Ee=-1;for(var ye=Array(L+1);++Ee<L;)ye[Ee]=ne[Ee];return ye[L]=q(xe),We(R,this,ye)}}function j(R,L){return L==="constructor"&&typeof R[L]=="function"||L=="__proto__"?void 0:R[L]}var W=K(bn);function K(R){var L=0,q=0;return function(){var ne=Pi(),Ee=s-(ne-q);if(q=ne,Ee>0){if(++L>=i)return arguments[0]}else L=0;return R.apply(void 0,arguments)}}function Y(R){if(R!=null){try{return Gr.call(R)}catch(L){}try{return R+""}catch(L){}}return""}function Z(R,L){return R===L||R!==R&&L!==L}var Ie=Oi(function(){return arguments}())?Oi:function(R){return tt(R)&&Rt.call(R,"callee")&&!Vn.call(R,"callee")},qe=Array.isArray;function et(R){return R!=null&&ft(R.length)&&!zt(R)}function lt(R){return tt(R)&&et(R)}var Nt=pn||Da;function zt(R){if(!Ue(R))return!1;var L=gn(R);return L==p||L==S||L==l||L==z}function ft(R){return typeof R=="number"&&R>-1&&R%1==0&&R<=a}function Ue(R){var L=typeof R;return R!=null&&(L=="object"||L=="function")}function tt(R){return R!=null&&typeof R=="object"}function Jt(R){if(!tt(R)||gn(R)!=V)return!1;var L=Ri(R);if(L===null)return!0;var q=Rt.call(L,"constructor")&&L.constructor;return typeof q=="function"&&q instanceof q&&Gr.call(q)==Ts}var Kr=Ze?Es(Ze):$s;function xi(R){return Mi(R,Ma(R))}function Ma(R){return et(R)?Us(R,!0):qs(R)}var ec=wt(function(R,L,q){Qe(R,L,q)});function tc(R){return function(){return R}}function Ks(R){return R}function Da(){return!1}t.exports=ec}),PS=te(function(t,e){var r=200,n="Expected a function",i="__lodash_hash_undefined__",s=1,a=2,c=1/0,o=9007199254740991,l=17976931348623157e292,u=0/0,h="[object Arguments]",f="[object Array]",p="[object Boolean]",S="[object Date]",M="[object Error]",I="[object Function]",k="[object GeneratorFunction]",V="[object Map]",z="[object Number]",v="[object Object]",_="[object Promise]",A="[object RegExp]",d="[object Set]",g="[object String]",E="[object Symbol]",b="[object WeakMap]",C="[object ArrayBuffer]",P="[object DataView]",D="[object Float32Array]",O="[object Float64Array]",x="[object Int8Array]",F="[object Int16Array]",$="[object Int32Array]",H="[object Uint8Array]",re="[object Uint8ClampedArray]",ee="[object Uint16Array]",ge="[object Uint32Array]",_e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,oe=/^\w*$/,ce=/^\./,Ae=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Be=/[\\^$.*+?()[\]{}|]/g,fr=/^\s+|\s+$/g,$t=/\\(\\)?/g,ht=/^[-+]0x[0-9a-f]+$/i,it=/^0b[01]+$/i,Kt=/^\[object .+?Constructor\]$/,Ze=/^0o[0-7]+$/i,We=/^(?:0|[1-9]\d*)$/,le={};le[D]=le[O]=le[x]=le[F]=le[$]=le[H]=le[re]=le[ee]=le[ge]=!0,le[h]=le[f]=le[C]=le[p]=le[P]=le[S]=le[M]=le[I]=le[V]=le[z]=le[v]=le[A]=le[d]=le[g]=le[b]=!1;var Es=parseInt,Si=typeof ae=="object"&&ae&&ae.Object===Object&&ae,Ss=typeof self=="object"&&self&&self.Object===Object&&self,Xt=Si||Ss||Function("return this")(),Ti=e&&!e.nodeType&&e,Vr=Ti&&!0&&t&&!t.nodeType&&t,$n=Vr&&Vr.exports===Ti,Gr=$n&&Si.process,Rt=function(){try{return Gr&&Gr.binding("util")}catch(y){}}(),qn=Rt&&Rt.isTypedArray;function Ai(y,N){for(var G=-1,X=y?y.length:0;++G<X;)if(N(y[G],G,y))return!0;return!1}function Ts(y,N,G,X){for(var de=y.length,ie=G+(X?1:-1);X?ie--:++ie<de;)if(N(y[ie],ie,y))return ie;return-1}function As(y){return function(N){return N==null?void 0:N[y]}}function dn(y,N){for(var G=-1,X=Array(y);++G<y;)X[G]=N(G);return X}function Ci(y){return function(N){return y(N)}}function Ii(y,N){return y==null?void 0:y[N]}function hn(y){var N=!1;if(y!=null&&typeof y.toString!="function")try{N=!!(y+"")}catch(G){}return N}function Ri(y){var N=-1,G=Array(y.size);return y.forEach(function(X,de){G[++N]=[de,X]}),G}function ki(y,N){return function(G){return y(N(G))}}function Vn(y){var N=-1,G=Array(y.size);return y.forEach(function(X){G[++N]=X}),G}var Cs=Array.prototype,Qt=Function.prototype,mr=Object.prototype,pn=Xt["__core-js_shared__"],Gn=function(){var y=/[^.]+$/.exec(pn&&pn.keys&&pn.keys.IE_PROTO||"");return y?"Symbol(src)_1."+y:""}(),Pi=Qt.toString,kt=mr.hasOwnProperty,Pt=mr.toString,Is=RegExp("^"+Pi.call(kt).replace(Be,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Yt=Xt.Symbol,Ni=Xt.Uint8Array,Rs=mr.propertyIsEnumerable,ks=Cs.splice,Ps=ki(Object.keys,Object),Ns=Math.max,vt=Ue(Xt,"DataView"),zr=Ue(Xt,"Map"),zn=Ue(Xt,"Promise"),Hn=Ue(Xt,"Set"),Wn=Ue(Xt,"WeakMap"),Hr=Ue(Object,"create"),kr=q(vt),Os=q(zr),Ms=q(zn),Ds=q(Hn),xs=q(Wn),fn=Yt?Yt.prototype:void 0,pt=fn?fn.valueOf:void 0,Kn=fn?fn.toString:void 0;function gr(y){var N=-1,G=y?y.length:0;for(this.clear();++N<G;){var X=y[N];this.set(X[0],X[1])}}function js(){this.__data__=Hr?Hr(null):{}}function Ls(y){return this.has(y)&&delete this.__data__[y]}function Bs(y){var N=this.__data__;if(Hr){var G=N[y];return G===i?void 0:G}return kt.call(N,y)?N[y]:void 0}function Us(y){var N=this.__data__;return Hr?N[y]!==void 0:kt.call(N,y)}function qt(y,N){var G=this.__data__;return G[y]=Hr&&N===void 0?i:N,this}gr.prototype.clear=js,gr.prototype.delete=Ls,gr.prototype.get=Bs,gr.prototype.has=Us,gr.prototype.set=qt;function Vt(y){var N=-1,G=y?y.length:0;for(this.clear();++N<G;){var X=y[N];this.set(X[0],X[1])}}function mn(){this.__data__=[]}function Xn(y){var N=this.__data__,G=vn(N,y);if(G<0)return!1;var X=N.length-1;return G==X?N.pop():ks.call(N,G,1),!0}function Fs(y){var N=this.__data__,G=vn(N,y);return G<0?void 0:N[G][1]}function gn(y){return vn(this.__data__,y)>-1}function Oi(y,N){var G=this.__data__,X=vn(G,y);return X<0?G.push([y,N]):G[X][1]=N,this}Vt.prototype.clear=mn,Vt.prototype.delete=Xn,Vt.prototype.get=Fs,Vt.prototype.has=gn,Vt.prototype.set=Oi;function Gt(y){var N=-1,G=y?y.length:0;for(this.clear();++N<G;){var X=y[N];this.set(X[0],X[1])}}function $s(){this.__data__={hash:new gr,map:new(zr||Vt),string:new gr}}function qs(y){return zt(this,y).delete(y)}function Qe(y){return zt(this,y).get(y)}function Vs(y){return zt(this,y).has(y)}function Gs(y,N){return zt(this,y).set(y,N),this}Gt.prototype.clear=$s,Gt.prototype.delete=qs,Gt.prototype.get=Qe,Gt.prototype.has=Vs,Gt.prototype.set=Gs;function bn(y){var N=-1,G=y?y.length:0;for(this.__data__=new Gt;++N<G;)this.add(y[N])}function yn(y){return this.__data__.set(y,i),this}function ct(y){return this.__data__.has(y)}bn.prototype.add=bn.prototype.push=yn,bn.prototype.has=ct;function Oe(y){this.__data__=new Vt(y)}function zs(){this.__data__=new Vt}function Mi(y){return this.__data__.delete(y)}function wt(y){return this.__data__.get(y)}function Di(y){return this.__data__.has(y)}function Wr(y,N){var G=this.__data__;if(G instanceof Vt){var X=G.__data__;if(!zr||X.length<r-1)return X.push([y,N]),this;G=this.__data__=new Gt(X)}return G.set(y,N),this}Oe.prototype.clear=zs,Oe.prototype.delete=Mi,Oe.prototype.get=wt,Oe.prototype.has=Di,Oe.prototype.set=Wr;function Qn(y,N){var G=Re(y)||ye(y)?dn(y.length,String):[],X=G.length,de=!!X;for(var ie in y)(N||kt.call(y,ie))&&!(de&&(ie=="length"||Kr(ie,X)))&&G.push(ie);return G}function vn(y,N){for(var G=y.length;G--;)if(xe(y[G][0],N))return G;return-1}function Yn(y,N){N=xi(N,y)?[N]:Ie(N);for(var G=0,X=N.length;y!=null&&G<X;)y=y[L(N[G++])];return G&&G==X?y:void 0}function wn(y){return Pt.call(y)}function Hs(y,N){return y!=null&&N in Object(y)}function Jn(y,N,G,X,de){return y===N?!0:y==null||N==null||!Pr(y)&&!ei(N)?y!==y&&N!==N:Ws(y,N,Jn,G,X,de)}function Ws(y,N,G,X,de,ie){var Me=Re(y),Fe=Re(N),Ye=f,st=f;Me||(Ye=tt(y),Ye=Ye==h?v:Ye),Fe||(st=tt(N),st=st==h?v:st);var Et=Ye==v&&!hn(y),Ot=st==v&&!hn(N),at=Ye==st;if(at&&!Et)return ie||(ie=new Oe),Me||pg(y)?et(y,N,G,X,de,ie):lt(y,N,Ye,G,X,de,ie);if(!(de&a)){var Zt=Et&&kt.call(y,"__wrapped__"),er=Ot&&kt.call(N,"__wrapped__");if(Zt||er){var Sn=Zt?y.value():y,Xr=er?N.value():N;return ie||(ie=new Oe),G(Sn,Xr,X,de,ie)}}return at?(ie||(ie=new Oe),Nt(y,N,G,X,de,ie)):!1}function _n(y,N,G,X){var de=G.length,ie=de,Me=!X;if(y==null)return!ie;for(y=Object(y);de--;){var Fe=G[de];if(Me&&Fe[2]?Fe[1]!==y[Fe[0]]:!(Fe[0]in y))return!1}for(;++de<ie;){Fe=G[de];var Ye=Fe[0],st=y[Ye],Et=Fe[1];if(Me&&Fe[2]){if(st===void 0&&!(Ye in y))return!1}else{var Ot=new Oe;if(X)var at=X(st,Et,Ye,y,N,Ot);if(!(at===void 0?Jn(Et,st,X,s|a,Ot):at))return!1}}return!0}function m(y){if(!Pr(y)||ec(y))return!1;var N=En(y)||hn(y)?Is:Kt;return N.test(q(y))}function w(y){return ei(y)&&Zn(y.length)&&!!le[Pt.call(y)]}function T(y){return typeof y=="function"?y:y==null?wg:typeof y=="object"?Re(y)?K(y[0],y[1]):W(y):_g(y)}function j(y){if(!tc(y))return Ps(y);var N=[];for(var G in Object(y))kt.call(y,G)&&G!="constructor"&&N.push(G);return N}function W(y){var N=ft(y);return N.length==1&&N[0][2]?Da(N[0][0],N[0][1]):function(G){return G===y||_n(G,y,N)}}function K(y,N){return xi(y)&&Ks(N)?Da(L(y),N):function(G){var X=yg(G,y);return X===void 0&&X===N?vg(G,y):Jn(N,X,void 0,s|a)}}function Y(y){return function(N){return Yn(N,y)}}function Z(y){if(typeof y=="string")return y;if(xa(y))return Kn?Kn.call(y):"";var N=y+"";return N=="0"&&1/y==-c?"-0":N}function Ie(y){return Re(y)?y:R(y)}function qe(y){return function(N,G,X){var de=Object(N);if(!mt(N)){var ie=T(G);N=ja(N),G=function(Fe){return ie(de[Fe],Fe,de)}}var Me=y(N,G,X);return Me>-1?de[ie?N[Me]:Me]:void 0}}function et(y,N,G,X,de,ie){var Me=de&a,Fe=y.length,Ye=N.length;if(Fe!=Ye&&!(Me&&Ye>Fe))return!1;var st=ie.get(y);if(st&&ie.get(N))return st==N;var Et=-1,Ot=!0,at=de&s?new bn:void 0;for(ie.set(y,N),ie.set(N,y);++Et<Fe;){var Zt=y[Et],er=N[Et];if(X)var Sn=Me?X(er,Zt,Et,N,y,ie):X(Zt,er,Et,y,N,ie);if(Sn!==void 0){if(Sn)continue;Ot=!1;break}if(at){if(!Ai(N,function(Xr,ti){if(!at.has(ti)&&(Zt===Xr||G(Zt,Xr,X,de,ie)))return at.add(ti)})){Ot=!1;break}}else if(!(Zt===er||G(Zt,er,X,de,ie))){Ot=!1;break}}return ie.delete(y),ie.delete(N),Ot}function lt(y,N,G,X,de,ie,Me){switch(G){case P:if(y.byteLength!=N.byteLength||y.byteOffset!=N.byteOffset)return!1;y=y.buffer,N=N.buffer;case C:return!(y.byteLength!=N.byteLength||!X(new Ni(y),new Ni(N)));case p:case S:case z:return xe(+y,+N);case M:return y.name==N.name&&y.message==N.message;case A:case g:return y==N+"";case V:var Fe=Ri;case d:var Ye=ie&a;if(Fe||(Fe=Vn),y.size!=N.size&&!Ye)return!1;var st=Me.get(y);if(st)return st==N;ie|=s,Me.set(y,N);var Et=et(Fe(y),Fe(N),X,de,ie,Me);return Me.delete(y),Et;case E:if(pt)return pt.call(y)==pt.call(N)}return!1}function Nt(y,N,G,X,de,ie){var Me=de&a,Fe=ja(y),Ye=Fe.length,st=ja(N),Et=st.length;if(Ye!=Et&&!Me)return!1;for(var Ot=Ye;Ot--;){var at=Fe[Ot];if(!(Me?at in N:kt.call(N,at)))return!1}var Zt=ie.get(y);if(Zt&&ie.get(N))return Zt==N;var er=!0;ie.set(y,N),ie.set(N,y);for(var Sn=Me;++Ot<Ye;){at=Fe[Ot];var Xr=y[at],ti=N[at];if(X)var ju=Me?X(ti,Xr,at,N,y,ie):X(Xr,ti,at,y,N,ie);if(!(ju===void 0?Xr===ti||G(Xr,ti,X,de,ie):ju)){er=!1;break}Sn||(Sn=at=="constructor")}if(er&&!Sn){var La=y.constructor,Ba=N.constructor;La!=Ba&&"constructor"in y&&"constructor"in N&&!(typeof La=="function"&&La instanceof La&&typeof Ba=="function"&&Ba instanceof Ba)&&(er=!1)}return ie.delete(y),ie.delete(N),er}function zt(y,N){var G=y.__data__;return Ma(N)?G[typeof N=="string"?"string":"hash"]:G.map}function ft(y){for(var N=ja(y),G=N.length;G--;){var X=N[G],de=y[X];N[G]=[X,de,Ks(de)]}return N}function Ue(y,N){var G=Ii(y,N);return m(G)?G:void 0}var tt=wn;(vt&&tt(new vt(new ArrayBuffer(1)))!=P||zr&&tt(new zr)!=V||zn&&tt(zn.resolve())!=_||Hn&&tt(new Hn)!=d||Wn&&tt(new Wn)!=b)&&(tt=function(y){var N=Pt.call(y),G=N==v?y.constructor:void 0,X=G?q(G):void 0;if(X)switch(X){case kr:return P;case Os:return V;case Ms:return _;case Ds:return d;case xs:return b}return N});function Jt(y,N,G){N=xi(N,y)?[N]:Ie(N);for(var X,de=-1,ie=N.length;++de<ie;){var Me=L(N[de]);if(!(X=y!=null&&G(y,Me)))break;y=y[Me]}if(X)return X;var ie=y?y.length:0;return!!ie&&Zn(ie)&&Kr(Me,ie)&&(Re(y)||ye(y))}function Kr(y,N){return N=N??o,!!N&&(typeof y=="number"||We.test(y))&&(y>-1&&y%1==0)&&y<N}function xi(y,N){if(Re(y))return!1;var G=typeof y;return G=="number"||G=="symbol"||G=="boolean"||y==null||xa(y)?!0:oe.test(y)||!_e.test(y)||N!=null&&y in Object(N)}function Ma(y){var N=typeof y;return N=="string"||N=="number"||N=="symbol"||N=="boolean"?y!=="__proto__":y===null}function ec(y){return!!Gn&&Gn in y}function tc(y){var N=y&&y.constructor,G=typeof N=="function"&&N.prototype||mr;return y===G}function Ks(y){return y===y&&!Pr(y)}function Da(y,N){return function(G){return G==null?!1:G[y]===N&&(N!==void 0||y in Object(G))}}var R=Pe(function(y){y=bg(y);var N=[];return ce.test(y)&&N.push(""),y.replace(Ae,function(G,X,de,ie){N.push(de?ie.replace($t,"$1"):X||G)}),N});function L(y){if(typeof y=="string"||xa(y))return y;var N=y+"";return N=="0"&&1/y==-c?"-0":N}function q(y){if(y!=null){try{return Pi.call(y)}catch(N){}try{return y+""}catch(N){}}return""}function ne(y,N,G){var X=y?y.length:0;if(!X)return-1;var de=G==null?0:mg(G);return de<0&&(de=Ns(X+de,0)),Ts(y,T(N),de)}var Ee=qe(ne);function Pe(y,N){if(typeof y!="function"||N&&typeof N!="function")throw new TypeError(n);var G=function(){var X=arguments,de=N?N.apply(this,X):X[0],ie=G.cache;if(ie.has(de))return ie.get(de);var Me=y.apply(this,X);return G.cache=ie.set(de,Me),Me};return G.cache=new(Pe.Cache||Gt),G}Pe.Cache=Gt;function xe(y,N){return y===N||y!==y&&N!==N}function ye(y){return _t(y)&&kt.call(y,"callee")&&(!Rs.call(y,"callee")||Pt.call(y)==h)}var Re=Array.isArray;function mt(y){return y!=null&&Zn(y.length)&&!En(y)}function _t(y){return ei(y)&&mt(y)}function En(y){var N=Pr(y)?Pt.call(y):"";return N==I||N==k}function Zn(y){return typeof y=="number"&&y>-1&&y%1==0&&y<=o}function Pr(y){var N=typeof y;return!!y&&(N=="object"||N=="function")}function ei(y){return!!y&&typeof y=="object"}function xa(y){return typeof y=="symbol"||ei(y)&&Pt.call(y)==E}var pg=qn?Ci(qn):w;function fg(y){if(!y)return y===0?y:0;if(y=gg(y),y===c||y===-c){var N=y<0?-1:1;return N*l}return y===y?y:0}function mg(y){var N=fg(y),G=N%1;return N===N?G?N-G:N:0}function gg(y){if(typeof y=="number")return y;if(xa(y))return u;if(Pr(y)){var N=typeof y.valueOf=="function"?y.valueOf():y;y=Pr(N)?N+"":N}if(typeof y!="string")return y===0?y:+y;y=y.replace(fr,"");var G=it.test(y);return G||Ze.test(y)?Es(y.slice(2),G?2:8):ht.test(y)?u:+y}function bg(y){return y==null?"":Z(y)}function yg(y,N,G){var X=y==null?void 0:Yn(y,N);return X===void 0?G:X}function vg(y,N){return y!=null&&Jt(y,N,Hs)}function ja(y){return mt(y)?Qn(y):j(y)}function wg(y){return y}function _g(y){return xi(y)?As(L(y)):Y(y)}t.exports=Ee}),NS="[object Symbol]",OS=Object.prototype,MS=OS.toString;function DS(t,e,r){for(var n=-1,i=t.length;++n<i;){var s=t[n],a=e(s);if(a!=null&&(c===void 0?a===a&&!LS(a):r(a,c)))var c=a,o=s}return o}function xS(t,e){return t>e}function jS(t){return!!t&&typeof t=="object"}function LS(t){return typeof t=="symbol"||jS(t)&&MS.call(t)==NS}function BS(t){return t}function US(t){return t&&t.length?DS(t,BS,xS):void 0}var FS=US,$S=128,qS=8,VS={0:"Reserved",1:"Interface local",2:"Link local",4:"Admin local",5:"Site local",8:"Organization local",14:"Global",15:"Reserved"},GS={"ff01::1/128":"Multicast (All nodes on this interface)","ff01::2/128":"Multicast (All routers on this interface)","ff02::1/128":"Multicast (All nodes on this link)","ff02::2/128":"Multicast (All routers on this link)","ff05::2/128":"Multicast (All routers in this site)","ff02::5/128":"Multicast (OSPFv3 AllSPF routers)","ff02::6/128":"Multicast (OSPFv3 AllDR routers)","ff02::9/128":"Multicast (RIP routers)","ff02::a/128":"Multicast (EIGRP routers)","ff02::d/128":"Multicast (PIM routers)","ff02::16/128":"Multicast (MLDv2 reports)","ff01::fb/128":"Multicast (mDNSv6)","ff02::fb/128":"Multicast (mDNSv6)","ff05::fb/128":"Multicast (mDNSv6)","ff02::1:2/128":"Multicast (All DHCP servers and relay agents on this link)","ff05::1:2/128":"Multicast (All DHCP servers and relay agents in this site)","ff02::1:3/128":"Multicast (All DHCP servers on this link)","ff05::1:3/128":"Multicast (All DHCP servers in this site)","::/128":"Unspecified","::1/128":"Loopback","ff00::/8":"Multicast","fe80::/10":"Link-local unicast"},zS=/([^0-9a-f:\/%])/ig,HS=/([0-9a-f]{5,}|:{3,}|[^:]:$|^:[^:]|\/$)/ig,WS=/\/\d{1,3}(?=%|$)/,KS=/%.*$/,XS=new RegExp(/^\[{0,1}([0-9a-f:]+)\]{0,1}/),QS=new RegExp(/\[([0-9a-f:]+)\]:([0-9]{1,5})/),$e={BITS:$S,GROUPS:qS,SCOPES:VS,TYPES:GS,RE_BAD_CHARACTERS:zS,RE_BAD_ADDRESS:HS,RE_SUBNET_STRING:WS,RE_ZONE_STRING:KS,RE_URL:XS,RE_URL_WITH_PORT:QS},YS=function(){return this.valid},JS=Tr.isInSubnet,ZS=Tr.isCorrect($e.BITS),eT=Tr.falseIfInvalid(function(){return this.addressMinusSuffix===this.canonicalForm()}),tT=Tr.falseIfInvalid(function(){return this.getBitsBase2(0,64)==="1111111010000000000000000000000000000000000000000000000000000000"}),rT=Tr.falseIfInvalid(function(){return this.getType()==="Multicast"}),nT=Tr.falseIfInvalid(function(){return this.v4}),iT=Tr.falseIfInvalid(function(){return this.isInSubnet(new this.constructor("2001::/32"))}),sT=Tr.falseIfInvalid(function(){return this.isInSubnet(new this.constructor("2002::/16"))}),aT=Tr.falseIfInvalid(function(){return this.getType()==="Loopback"}),oT={isValid:YS,isInSubnet:JS,isCorrect:ZS,isCanonical:eT,isLinkLocal:tT,isMulticast:rT,is4:nT,isTeredo:iT,is6to4:sT,isLoopback:aT},Ao=te(function(t,e){var r=ya.sprintf,n=e.spanAllZeroes=function(s){return s.replace(/(0+)/g,'<span class="zero">$1</span>')};e.spanAll=function(s,a){a===void 0&&(a=0);var c=s.split("");return c.map(function(o,l){return r('<span class="digit value-%s position-%d">%s</span>',o,l+a,n(o))}).join("")};function i(s){return s.replace(/^(0+)/,'<span class="zero">$1</span>')}e.spanLeadingZeroes=function(s){var a=s.split(":");return a.map(function(c){return i(c)}).join(":")},e.simpleGroup=function(s,a){var c=s.split(":");return a||(a=0),c.map(function(o,l){return/group-v4/.test(o)?o:r('<span class="hover-group group-%d">%s</span>',l+a,i(o))}).join(":")}}),di=ya.sprintf,cT=function(t){return t===void 0?t="":t=di(":%s",t),di("http://[%s]%s/",this.correctForm(),t)},lT=function(t){t||(t={}),t.className===void 0&&(t.className=""),t.prefix===void 0&&(t.prefix="/#address="),t.v4===void 0&&(t.v4=!1);var e=this.correctForm;return t.v4&&(e=this.to4in6),t.className?di('<a href="%1$s%2$s" class="%3$s">%2$s</a>',t.prefix,e.call(this),t.className):di('<a href="%1$s%2$s">%2$s</a>',t.prefix,e.call(this))},uT=function(){var t=this.address.match(Ct.RE_ADDRESS),e;if(t){var r=t[0].split(".");this.address=this.address.replace(Ct.RE_ADDRESS,di('<span class="hover-group group-v4 group-6">%s</span>.<span class="hover-group group-v4 group-7">%s</span>',r.slice(0,2).join("."),r.slice(2,4).join(".")))}if(this.elidedGroups===0)return Ao.simpleGroup(this.address);var n=[],i=this.address.split("::");i[0].length?n.push(Ao.simpleGroup(i[0])):n.push("");var s=["hover-group"];for(e=this.elisionBegin;e<this.elisionBegin+this.elidedGroups;e++)s.push(di("group-%d",e));return n.push(di('<span class="%s"></span>',s.join(" "))),i[1].length?n.push(Ao.simpleGroup(i[1],this.elisionEnd)):n.push(""),n.join(":")},dT={href:cT,link:lT,group:uT},es=ya.sprintf;function Tl(t){return es("(%s)",t.join("|"))}function Al(t){return t.length<4?es("0{0,%d}%s",4-t.length,t):t}var Xp="[^A-Fa-f0-9:]";function Cl(t){var e=[];t.forEach(function(n,i){var s=parseInt(n,16);s===0&&e.push(i)});var r=e.map(function(n){return t.map(function(i,s){if(s===n){var a=s===0||s===$e.GROUPS-1?":":"";return Tl([Al(i),a])}return Al(i)}).join(":")});return r.push(t.map(Al).join(":")),Tl(r)}function Qp(t,e,r){var n=e?"":":",i=r?"":":",s=[];!e&&!r&&s.push("::"),e&&r&&s.push(""),(r&&!e||!r&&e)&&s.push(":"),s.push(es("%s(:0{1,4}){1,%d}",n,t-1)),s.push(es("(0{1,4}:){1,%d}%s",t-1,i)),s.push(es("(0{1,4}:){%d}0{1,4}",t-1));for(var a=1;a<t-1;a++)for(var c=1;c<t-a;c++)s.push(es("(0{1,4}:){%d}:(0{1,4}:){%d}0{1,4}",c,t-c-a-1));return Tl(s)}var hT=function(t){t===void 0&&(t=!1);var e=[],r=new this.constructor(this.correctForm());if(r.elidedGroups===0)e.push(Cl(r.parsedAddress));else if(r.elidedGroups===$e.GROUPS)e.push(Qp($e.GROUPS));else{var n=r.address.split("::");n[0].length&&e.push(Cl(n[0].split(":"))),e.push(Qp(r.elidedGroups,n[0].length!==0,n[1].length!==0)),n[1].length&&e.push(Cl(n[1].split(":"))),e=[e.join(":")]}return t||(e=[].concat("(?=^|",Xp,"|[^\\w\\:])(",e,")(?=[^\\w\\:]|",Xp,"|$)")),e.join("")},pT=function(t){return new RegExp(this.regularExpressionString(t),"i")},fT={regularExpressionString:hT,regularExpression:pT},It=Tp.BigInteger,rn=ya.sprintf;function mT(t){for(var e=/(\d+)(\d{3})/;e.test(t);)t=t.replace(e,"$1,$2");return t}function gT(t){return t=t.replace(/^(0{1,})([1-9]+)$/,'<span class="parse-error">$1</span>$2'),t=t.replace(/^(0{1,})(0)$/,'<span class="parse-error">$1</span>$2'),t}function ue(t,e){e===void 0?this.groups=$e.GROUPS:this.groups=e,this.v4=!1,this.subnet="/128",this.subnetMask=128,this.zone="",this.address=t;var r=$e.RE_SUBNET_STRING.exec(t);if(r){if(this.parsedSubnet=r[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,isNaN(this.subnetMask)||this.subnetMask<0||this.subnetMask>$e.BITS){this.valid=!1,this.error="Invalid subnet mask.";return}t=t.replace($e.RE_SUBNET_STRING,"")}else if(/\//.test(t)){this.valid=!1,this.error="Invalid subnet mask.";return}var n=$e.RE_ZONE_STRING.exec(t);n&&(this.zone=n[0],t=t.replace($e.RE_ZONE_STRING,"")),this.addressMinusSuffix=t,this.parsedAddress=this.parse(this.addressMinusSuffix)}Sl(ue.prototype,oT),Sl(ue.prototype,dT),Sl(ue.prototype,fT),ue.fromBigInteger=function(t){var e=va(t.toString(16),32,"0"),r=[],n;for(n=0;n<$e.GROUPS;n++)r.push(e.slice(n*4,(n+1)*4));return new ue(r.join(":"))},ue.fromURL=function(t){var e,r,n;if(t.indexOf("[")!==-1&&t.indexOf("]:")!==-1){if(n=$e.RE_URL_WITH_PORT.exec(t),n===null)return{error:"failed to parse address with port",address:null,port:null};e=n[1],r=n[2]}else if(t.indexOf("/")!==-1){if(t=t.replace(/^[a-z0-9]+:\/\//,""),n=$e.RE_URL.exec(t),n===null)return{error:"failed to parse address from URL",address:null,port:null};e=n[1]}else e=t;return r?(r=parseInt(r,10),(r<0||r>65536)&&(r=null)):r=null,{address:new ue(e),port:r}},ue.fromAddress4=function(t){var t=new ui(t),e=$e.BITS-(Ct.BITS-t.subnetMask);return new ue("::ffff:"+t.correctForm()+"/"+e)},ue.fromArpa=function(t){var e=t.replace(/(\.ip6\.arpa)?\.$/,""),r=7;if(e.length!==63)return e={error:"Not Valid 'ip6.arpa' form",address:null},e;e=e.split(".").reverse();for(var n=r;n>0;n--){var i=n*4;e.splice(i,0,":")}return e=e.join(""),new ue(e)};function bT(t,e){var r=[],n=[],i;for(i=0;i<t.length;i++)i<e[0]?r.push(t[i]):i>e[1]&&n.push(t[i]);return r.concat(["compact"]).concat(n)}ue.prototype.microsoftTranscription=function(){return rn("%s.ipv6-literal.net",this.correctForm().replace(/:/g,"-"))},ue.prototype.mask=function(t){return t===void 0&&(t=this.subnetMask),this.getBitsBase2(0,t)},ue.prototype.possibleSubnets=function(t){t===void 0&&(t=128);var e=$e.BITS-this.subnetMask,r=Math.abs(t-$e.BITS),n=e-r;return n<0?"0":mT(new It("2",10).pow(n).toString(10))},ue.prototype._startAddress=function(){return new It(this.mask()+So("0",$e.BITS-this.subnetMask),2)},ue.prototype.startAddress=function(){return ue.fromBigInteger(this._startAddress())},ue.prototype.startAddressExclusive=function(){var t=new It("1");return ue.fromBigInteger(this._startAddress().add(t))},ue.prototype._endAddress=function(){return new It(this.mask()+So("1",$e.BITS-this.subnetMask),2)},ue.prototype.endAddress=function(){return ue.fromBigInteger(this._endAddress())},ue.prototype.endAddressExclusive=function(){var t=new It("1");return ue.fromBigInteger(this._endAddress().subtract(t))},ue.prototype.getScope=function(){var t=$e.SCOPES[this.getBits(12,16)];return this.getType()==="Global unicast"&&t!=="Link local"&&(t="Global"),t},ue.prototype.getType=function(){var t=this;function e(r,n){return t.isInSubnet(new ue(n))}return PS($e.TYPES,e)||"Global unicast"},ue.prototype.getBits=function(t,e){return new It(this.getBitsBase2(t,e),2)},ue.prototype.getBitsBase2=function(t,e){return this.binaryZeroPad().slice(t,e)},ue.prototype.getBitsBase16=function(t,e){var r=e-t;return r%4!==0?null:va(this.getBits(t,e).toString(16),r/4,"0")},ue.prototype.getBitsPastSubnet=function(){return this.getBitsBase2(this.subnetMask,$e.BITS)},ue.prototype.reverseForm=function(t){t||(t={});var e=Math.floor(this.subnetMask/4),r=this.canonicalForm().replace(/:/g,"").split("").slice(0,e).reverse().join(".");return e>0?t.omitSuffix?r:rn("%s.ip6.arpa.",r):t.omitSuffix?"":"ip6.arpa."},ue.prototype.correctForm=function(){if(!this.parsedAddress)return null;var t,e=[],r=0,n=[];for(t=0;t<this.parsedAddress.length;t++){var i=parseInt(this.parsedAddress[t],16);i===0&&r++,i!==0&&r>0&&(r>1&&n.push([t-r,t-1]),r=0)}r>1&&n.push([this.parsedAddress.length-r,this.parsedAddress.length-1]);var s=n.map(function(o){return o[1]-o[0]+1});if(n.length>0){var a=s.indexOf(FS(s));e=bT(this.parsedAddress,n[a])}else e=this.parsedAddress;for(t=0;t<e.length;t++)e[t]!=="compact"&&(e[t]=parseInt(e[t],16).toString(16));var c=e.join(":");return c=c.replace(/^compact$/,"::"),c=c.replace(/^compact|compact$/,":"),c=c.replace(/compact/,""),c},ue.prototype.binaryZeroPad=function(){return va(this.bigInteger().toString(2),$e.BITS,"0")},ue.prototype.parse4in6=function(t){var e=t.split(":"),r=e.slice(-1)[0],n=r.match(Ct.RE_ADDRESS);if(n){for(var i=new ui(n[0]),s=0;s<i.groups;s++)if(/^0[0-9]+/.test(i.parsedAddress[s]))return this.valid=!1,this.error="IPv4 addresses can not have leading zeroes.",this.parseError=t.replace(Ct.RE_ADDRESS,i.parsedAddress.map(gT).join(".")),null;this.v4=!0,e[e.length-1]=i.toGroup6(),t=e.join(":")}return t},ue.prototype.parse=function(t){if(t=this.parse4in6(t),this.error)return null;var e=t.match($e.RE_BAD_CHARACTERS);if(e)return this.valid=!1,this.error=rn("Bad character%s detected in address: %s",e.length>1?"s":"",e.join("")),this.parseError=t.replace($e.RE_BAD_CHARACTERS,'<span class="parse-error">$1</span>'),null;var r=t.match($e.RE_BAD_ADDRESS);if(r)return this.valid=!1,this.error=rn("Address failed regex: %s",r.join("")),this.parseError=t.replace($e.RE_BAD_ADDRESS,'<span class="parse-error">$1</span>'),null;var n=[],i=t.split("::");if(i.length===2){var s=i[0].split(":"),a=i[1].split(":");s.length===1&&s[0]===""&&(s=[]),a.length===1&&a[0]===""&&(a=[]);var c=this.groups-(s.length+a.length);if(!c)return this.valid=!1,this.error="Error parsing groups",null;this.elidedGroups=c,this.elisionBegin=s.length,this.elisionEnd=s.length+this.elidedGroups,s.forEach(function(l){n.push(l)});for(var o=0;o<c;o++)n.push(0);a.forEach(function(l){n.push(l)})}else if(i.length===1)n=t.split(":"),this.elidedGroups=0;else return this.valid=!1,this.error="Too many :: groups found",null;return n=n.map(function(l){return rn("%x",parseInt(l,16))}),n.length!==this.groups?(this.valid=!1,this.error="Incorrect number of groups found",null):(this.valid=!0,n)};function Yp(t){return rn("%04x",parseInt(t,16))}ue.prototype.canonicalForm=function(){return this.valid?this.parsedAddress.map(Yp).join(":"):null},ue.prototype.decimal=function(){return this.valid?this.parsedAddress.map(function(t){return rn("%05d",parseInt(t,16))}).join(":"):null},ue.prototype.bigInteger=function(){return this.valid?new It(this.parsedAddress.map(Yp).join(""),16):null},ue.prototype.to4=function(){var t=this.binaryZeroPad().split("");return ui.fromHex(new It(t.slice(96,128).join(""),2).toString(16))},ue.prototype.to4in6=function(){var t=this.to4(),e=new ue(this.parsedAddress.slice(0,6).join(":"),6),r=e.correctForm(),n="";return/:$/.test(r)||(n=":"),e.correctForm()+n+t.address},ue.prototype.inspectTeredo=function(){var t=this.getBitsBase16(0,32),e=this.getBits(80,96).xor(new It("ffff",16)).toString(),r=ui.fromHex(this.getBitsBase16(32,64)),n=ui.fromHex(this.getBits(96,128).xor(new It("ffffffff",16)).toString(16)),i=this.getBits(64,80),s=this.getBitsBase2(64,80),a=i.testBit(15),c=i.testBit(14),o=i.testBit(8),l=i.testBit(9),u=new It(s.slice(2,6)+s.slice(8,16),2).toString(10);return{prefix:rn("%s:%s",t.slice(0,4),t.slice(4,8)),server4:r.address,client4:n.address,flags:s,coneNat:a,microsoft:{reserved:c,universalLocal:l,groupIndividual:o,nonce:u},udpPort:e}},ue.prototype.inspect6to4=function(){var t=this.getBitsBase16(0,16),e=ui.fromHex(this.getBitsBase16(16,48));return{prefix:rn("%s",t.slice(0,4)),gateway:e.address}},ue.prototype.to6to4=function(){if(!this.is4())return null;var t=["2002",this.getBitsBase16(96,112),this.getBitsBase16(112,128),"","/16"].join(":");return new ue(t)},ue.prototype.toByteArray=function(){var t=this.bigInteger().toByteArray();return t.length===17&&t[0]===0?t.slice(1):t};function Jp(t){return t&255}ue.prototype.toUnsignedByteArray=function(){return this.toByteArray().map(Jp)},ue.fromByteArray=function(t){return this.fromUnsignedByteArray(t.map(Jp))},ue.fromUnsignedByteArray=function(t){for(var e=new It("256",10),r=new It("0",10),n=new It("1",10),i=t.length-1;i>=0;i--)r=r.add(n.multiply(new It(t[i].toString(10),10))),n=n.multiply(e);return ue.fromBigInteger(r)};var yT=ue,vT=ui,wT=yT,_T={helpers:Ao},Il={Address4:vT,Address6:wT,v6:_T};const{Address4:ET,Address6:ST}=Il,Co={ERR_INVALID_IP_PARAMETER:"ERR_INVALID_IP_PARAMETER",ERR_INVALID_PORT_PARAMETER:"ERR_INVALID_PORT_PARAMETER",ERR_INVALID_IP:"ERR_INVALID_IP"};function TT(t,e){if(typeof t!="string")throw U(new Error(`invalid ip provided: ${t}`),Co.ERR_INVALID_IP_PARAMETER);if(e=parseInt(e),isNaN(e))throw U(new Error(`invalid port provided: ${e}`),Co.ERR_INVALID_PORT_PARAMETER);if(new ET(t).isValid())return fl(`/ip4/${t}/tcp/${e}`);const r=new ST(t);if(r.isValid())return r.is4()?fl(`/ip4/${r.to4().correctForm()}/tcp/${e}`):fl(`/ip6/${t}/tcp/${e}`);throw U(new Error(`invalid ip:port for creating a multiaddr: ${t}:${e}`),Co.ERR_INVALID_IP)}var Rl=TT,AT=Co;Rl.Errors=AT;const{CLOSE_TIMEOUT:CT}=cp,kl=Q("libp2p:websockets:socket");kl.error=Q("libp2p:websockets:socket:error");var Zp=(t,e={})=>{const r={async sink(n){e.signal&&(n=rt(n,e.signal));try{await t.sink(async function*(){for await(const i of n)yield i instanceof Uint8Array?i:i.slice()}())}catch(i){i.type!=="aborted"&&kl.error(i)}},source:e.signal?rt(t.source,e.signal):t.source,conn:t,localAddr:e.localAddr||(t.localAddress&&t.localPort?Rl(t.localAddress,t.localPort):void 0),remoteAddr:e.remoteAddr||Rl(t.remoteAddress,t.remotePort),timeline:{open:Date.now()},async close(){const n=Date.now();try{await Mg(t.close(),CT)}catch(i){const{host:s,port:a}=r.remoteAddr.toOptions();kl("timeout closing stream to %s:%s after %dms, destroying it manually",s,a,Date.now()-n),t.destroy()}finally{r.timeline.close=Date.now()}}};return t.socket.once&&t.socket.once("close",()=>{r.timeline.close||(r.timeline.close=Date.now())}),r};const{createServer:IT}=Q_,Io=Q("libp2p:websockets:listener");Io.error=Q("libp2p:websockets:listener:error");var RT=({handler:t,upgrader:e},r={})=>{const n=new St,i=IT(r,async a=>{let c,o;try{c=Zp(a),Io("new inbound connection %s",c.remoteAddr),o=await e.upgradeInbound(c)}catch(l){return Io.error("inbound connection failed to upgrade",l),c&&c.close()}Io("inbound connection %s upgraded",c.remoteAddr),kT(i,c),t&&t(o),n.emit("connection",o)});i.on("listening",()=>n.emit("listening")).on("error",a=>n.emit("error",a)).on("close",()=>n.emit("close")),i.__connections=[];let s;return n.close=()=>(i.__connections.forEach(a=>a.close()),i.close()),n.listen=a=>(s=a,i.listen(a.toOptions())),n.getAddrs=()=>{const a=[],c=i.address();if(!c)throw new Error("Listener is not ready yet");const o=s.getPeerId();if(s.toString().indexOf("ip4")!==-1){let l=s.decapsulate("tcp");if(l=l.encapsulate("/tcp/"+c.port+"/ws"),s.getPeerId()&&(l=l.encapsulate("/p2p/"+o)),l.toString().indexOf("0.0.0.0")!==-1){const u=Bu.networkInterfaces();Object.keys(u).forEach(h=>{u[h].forEach(f=>{f.family==="IPv4"&&a.push(X_(l.toString().replace("0.0.0.0",f.address)))})})}else a.push(l)}return a},n};function kT(t,e){t.__connections.push(e)}const PT=Tt,Pl=Tt.v4,ef=Tt.v6,tf=function(t,e,r){r=~~r;var n;if(Pl(t))n=e||new Uint8Array(r+4),t.split(/\./g).map(function(u){n[r++]=parseInt(u,10)&255});else if(ef(t)){var i=t.split(":",8),s;for(s=0;s<i.length;s++){var a=Pl(i[s]),c;a&&(c=tf(i[s]),i[s]=se(c.slice(0,2),"base16")),c&&++s<8&&i.splice(s,0,se(c.slice(2,4),"base16"))}if(i[0]==="")for(;i.length<8;)i.unshift("0");else if(i[i.length-1]==="")for(;i.length<8;)i.push("0");else if(i.length<8){for(s=0;s<i.length&&i[s]!=="";s++);var o=[s,"1"];for(s=9-i.length;s>0;s--)o.push("0");i.splice.apply(i,o)}for(n=e||new Uint8Array(r+16),s=0;s<i.length;s++){var l=parseInt(i[s],16);n[r++]=l>>8&255,n[r++]=l&255}}if(!n)throw Error("Invalid ip address: "+t);return n},NT=function(t,e,r){e=~~e,r=r||t.length-e;var n=[],i;const s=new DataView(t.buffer);if(r===4){for(let a=0;a<r;a++)n.push(t[e+a]);i=n.join(".")}else if(r===16){for(let a=0;a<r;a+=2)n.push(s.getUint16(e+a).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i};var Ro={isIP:PT,isV4:Pl,isV6:ef,toBytes:tf,toString:NT};function Ut(t){if(typeof t=="number"){if(Ut.codes[t])return Ut.codes[t];throw new Error("no protocol with code: "+t)}else if(typeof t=="string"||t instanceof String){if(Ut.names[t])return Ut.names[t];throw new Error("no protocol with name: "+t)}throw new Error("invalid protocol id type: "+t)}const hr=-1;Ut.lengthPrefixedVarSize=hr,Ut.V=hr,Ut.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,hr,"ip6zone"],[53,hr,"dns","resolvable"],[54,hr,"dns4","resolvable"],[55,hr,"dns6","resolvable"],[56,hr,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,hr,"unix",!1,"path"],[421,hr,"ipfs"],[421,hr,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,hr,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,hr,"memory"]],Ut.names={},Ut.codes={},Ut.table.map(t=>{const e=rf.apply(null,t);Ut.codes[e.code]=e,Ut.names[e.name]=e}),Ut.object=rf;function rf(t,e,r,n,i){return{code:t,size:e,name:r,resolvable:Boolean(n),path:Boolean(i)}}var Br=Ut,nf=_a;function _a(t,e){return e instanceof Uint8Array?_a.toString(t,e):_a.toBytes(t,e)}_a.toString=function(e,r){e=Br(e);switch(e.code){case 4:case 41:return OT(r);case 6:case 273:case 33:case 132:return af(r);case 53:case 54:case 55:case 56:case 400:case 777:return DT(r);case 421:return jT(r);case 444:return of(r);case 445:return of(r);default:return se(r,"base16")}},_a.toBytes=function(e,r){e=Br(e);switch(e.code){case 4:return sf(r);case 41:return sf(r);case 6:case 273:case 33:case 132:return Nl(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return MT(r);case 421:return xT(r);case 444:return LT(r);case 445:return BT(r);default:return je(r,"base16")}};function sf(t){if(!Ro.isIP(t))throw new Error("invalid ip address");return Ro.toBytes(t)}function OT(t){const e=Ro.toString(t);if(!e||!Ro.isIP(e))throw new Error("invalid ip address");return e}function Nl(t){const e=new ArrayBuffer(2),r=new DataView(e);return r.setUint16(0,t),new Uint8Array(e)}function af(t){const e=new DataView(t.buffer);return e.getUint16(0)}function MT(t){const e=je(t),r=Uint8Array.from(J.encode(e.length));return we([r,e],r.length+e.length)}function DT(t){const e=J.decode(t);if(t=t.slice(J.decode.bytes),t.length!==e)throw new Error("inconsistent lengths");return se(t)}function xT(t){const e=new Nr(t).multihash,r=Uint8Array.from(J.encode(e.length));return we([r,e],r.length+e.length)}function jT(t){const e=J.decode(t),r=t.slice(J.decode.bytes);if(r.length!==e)throw new Error("inconsistent lengths");return se(r,"base58btc")}function LT(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==16)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion address.");const r=Or.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Nl(n);return we([r,i],r.length+i.length)}function BT(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==56)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion3 address.");const r=Or.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Nl(n);return we([r,i],r.length+i.length)}function of(t){const e=t.slice(0,t.length-2),r=t.slice(t.length-2),n=se(e,"base32"),i=af(r);return n+":"+i}var Ar={stringToStringTuples:cf,stringTuplesToString:lf,tuplesToStringTuples:df,stringTuplesToTuples:uf,bytesToTuples:Ol,tuplesToBytes:hf,bytesToString:UT,stringToBytes:ff,fromString:FT,fromBytes:mf,validateBytes:Ml,isValidBytes:$T,cleanPath:ko,ParseError:Dl,protoFromTuple:Ea,sizeForAddr:pf};function cf(t){const e=[],r=t.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let n=0;n<r.length;n++){const i=r[n],s=Br(i);if(s.size===0){e.push([i]);continue}if(n++,n>=r.length)throw Dl("invalid address: "+t);if(s.path){e.push([i,ko(r.slice(n).join("/"))]);break}e.push([i,r[n]])}return e}function lf(t){const e=[];return t.map(r=>{const n=Ea(r);e.push(n.name),r.length>1&&e.push(r[1])}),ko(e.join("/"))}function uf(t){return t.map(e=>{Array.isArray(e)||(e=[e]);const r=Ea(e);return e.length>1?[r.code,nf.toBytes(r.code,e[1])]:[r.code]})}function df(t){return t.map(e=>{const r=Ea(e);return e.length>1?[r.code,nf.toString(r.code,e[1])]:[r.code]})}function hf(t){return mf(we(t.map(e=>{const r=Ea(e);let n=Uint8Array.from(J.encode(r.code));return e.length>1&&(n=we([n,e[1]])),n})))}function pf(t,e){if(t.size>0)return t.size/8;if(t.size===0)return 0;{const r=J.decode(e);return r+J.decode.bytes}}function Ol(t){const e=[];let r=0;for(;r<t.length;){const n=J.decode(t,r),i=J.decode.bytes,s=Br(n),a=pf(s,t.slice(r+i));if(a===0){e.push([n]),r+=i;continue}const c=t.slice(r+i,r+i+a);if(r+=a+i,r>t.length)throw Dl("Invalid address Uint8Array: "+se(t,"base16"));e.push([n,c])}return e}function UT(t){const e=Ol(t),r=df(e);return lf(r)}function ff(t){t=ko(t);const e=cf(t),r=uf(e);return hf(r)}function FT(t){return ff(t)}function mf(t){const e=Ml(t);if(e)throw e;return Uint8Array.from(t)}function Ml(t){try{Ol(t)}catch(e){return e}}function $T(t){return Ml(t)===void 0}function ko(t){return"/"+t.trim().split("/").filter(e=>e).join("/")}function Dl(t){return new Error("Error parsing address: "+t)}function Ea(t){const e=Br(t[0]);return e}var xl=te(function(t,e){const r=Symbol.for("nodejs.util.inspect.custom"),n=Ht.proto(function(i){if(!(this instanceof n))return new n(i);if(i==null&&(i=""),i instanceof Uint8Array)this.bytes=Ar.fromBytes(i);else if(typeof i=="string"||i instanceof String){if(i.length>0&&i.charAt(0)!=="/")throw new Error(`multiaddr "${i}" must start with a "/"`);this.bytes=Ar.fromString(i)}else if(i.bytes&&i.protos&&i.protoCodes)this.bytes=Ar.fromBytes(i.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});n.prototype.toString=function(){return Ar.bytesToString(this.bytes)},n.prototype.toJSON=n.prototype.toString,n.prototype.toOptions=function(){const s={},a=this.toString().split("/");return s.family=a[1]==="ip4"?"ipv4":"ipv6",s.host=a[2],s.transport=a[3],s.port=parseInt(a[4]),s},n.prototype[r]=function(){return"<Multiaddr "+se(this.bytes,"base16")+" - "+Ar.bytesToString(this.bytes)+">"},n.prototype.inspect=function(){return"<Multiaddr "+se(this.bytes,"base16")+" - "+Ar.bytesToString(this.bytes)+">"},n.prototype.protos=function(){return this.protoCodes().map(s=>Object.assign({},Br(s)))},n.prototype.protoCodes=function(){const s=[],a=this.bytes;let c=0;for(;c<a.length;){const o=J.decode(a,c),l=J.decode.bytes,u=Br(o),h=Ar.sizeForAddr(u,a.slice(c+l));c+=h+l,s.push(o)}return s},n.prototype.protoNames=function(){return this.protos().map(s=>s.name)},n.prototype.tuples=function(){return Ar.bytesToTuples(this.bytes)},n.prototype.stringTuples=function(){const s=Ar.bytesToTuples(this.bytes);return Ar.tuplesToStringTuples(s)},n.prototype.encapsulate=function(s){return s=n(s),n(this.toString()+s.toString())},n.prototype.decapsulate=function(s){s=s.toString();const a=this.toString(),c=a.lastIndexOf(s);if(c<0)throw new Error("Address "+this+" does not contain subaddress: "+s);return n(a.slice(0,c))},n.prototype.decapsulateCode=function(s){const a=this.tuples();for(let c=a.length-1;c>=0;c--)if(a[c][0]===s)return n(Ar.tuplesToBytes(a.slice(0,c)));return this},n.prototype.getPeerId=function(){let s=null;try{const a=this.stringTuples().filter(c=>{if(c[0]===Br.names.ipfs.code)return!0});s=a.pop()[1],s=se(new Nr(s).multihash,"base58btc")}catch(a){s=null}return s},n.prototype.getPath=function(){let s=null;try{s=this.stringTuples().filter(a=>{const c=Br(a[0]);if(c.path)return!0})[0][1]}catch(a){s=null}return s},n.prototype.equals=function(s){return tr(this.bytes,s.bytes)},n.prototype.nodeAddress=function(){const s=this.protoCodes(),a=this.protoNames(),c=this.toString().split("/").slice(1);if(c.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(s[0]!==4&&s[0]!==41&&s[0]!==54&&s[0]!==55)throw new Error(`no protocol with name: "'${a[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(c[2]!=="tcp"&&c[2]!=="udp")throw new Error(`no protocol with name: "'${a[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:s[0]===41||s[0]===55?6:4,address:c[1],port:parseInt(c[3])}},n.fromNodeAddress=function(s,a){if(!s)throw new Error("requires node address object");if(!a)throw new Error("requires transport protocol");let c;switch(s.family){case"IPv4":c="ip4";break;case"IPv6":c="ip6";break;default:throw Error(`Invalid addr family. Got '${s.family}' instead of 'IPv4' or 'IPv6'`)}return n("/"+[c,s.address,a,s.port].join("/"))},n.prototype.isThinWaistAddress=function(s){const a=(s||this).protos();return a.length!==2||a[0].code!==4&&a[0].code!==41?!1:!(a[1].code!==6&&a[1].code!==273)},n.protocols=Br,n.isName=function(s){return n.isMultiaddr(s)?s.protos().some(a=>a.resolvable):!1},n.resolve=function(s){return!n.isMultiaddr(s)||!n.isName(s)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},e=t.exports=n});const gf=pe("dns4"),bf=pe("dns6"),yf=pe("dnsaddr"),hi=yt(pe("dns"),yf,gf,bf),Sa=yt(pe("ip4"),pe("ip6")),ts=yt(Te(Sa,pe("tcp")),Te(hi,pe("tcp"))),vf=Te(Sa,pe("udp")),wf=Te(vf,pe("utp")),rs=yt(Te(ts,pe("ws")),Te(hi,pe("ws"))),ns=yt(Te(ts,pe("wss")),Te(hi,pe("wss"))),jl=yt(Te(ts,pe("http")),Te(Sa,pe("http")),Te(hi,pe("http"))),Ll=yt(Te(ts,pe("https")),Te(Sa,pe("https")),Te(hi,pe("https"))),Bl=yt(Te(rs,pe("p2p-webrtc-star"),pe("p2p")),Te(ns,pe("p2p-webrtc-star"),pe("p2p")),Te(rs,pe("p2p-webrtc-star")),Te(ns,pe("p2p-webrtc-star"))),qT=yt(Te(rs,pe("p2p-websocket-star"),pe("p2p")),Te(ns,pe("p2p-websocket-star"),pe("p2p")),Te(rs,pe("p2p-websocket-star")),Te(ns,pe("p2p-websocket-star"))),_f=yt(Te(jl,pe("p2p-webrtc-direct")),Te(Ll,pe("p2p-webrtc-direct"))),is=yt(rs,ns,jl,Ll,Bl,_f,ts,wf,hi),VT=yt(Te(is,pe("p2p-stardust"),pe("p2p")),Te(is,pe("p2p-stardust"))),kn=yt(Te(is,pe("p2p")),Bl,pe("p2p")),Ef=yt(Te(kn,pe("p2p-circuit"),kn),Te(kn,pe("p2p-circuit")),Te(pe("p2p-circuit"),kn),Te(is,pe("p2p-circuit")),Te(pe("p2p-circuit"),is),pe("p2p-circuit")),Sf=()=>yt(Te(Ef,Sf),Ef),ss=Sf(),Tf=yt(Te(ss,kn,ss),Te(kn,ss),Te(ss,kn),ss,kn);var GT=hi,zT=gf,HT=bf,WT=yf,KT=Sa,XT=ts,QT=vf,YT=wf,JT=jl,ZT=Ll,e1=rs,t1=ns,r1=qT,n1=Bl,i1=_f,s1=is,a1=VT,o1=ss,c1=Tf,l1=Tf;function Af(t){return function(r){if(!xl.isMultiaddr(r))try{r=xl(r)}catch(i){return!1}const n=t(r.protoNames());return n===null?!1:n.length===0}}function Te(){const t=Array.from(arguments);function e(r){return r.length<t.length?null:(t.some(n=>{if(r=typeof n=="function"?n().partialMatch(r):n.partialMatch(r),r===null)return!0}),r)}return{toString:function(){return"{ "+t.join(" ")+" }"},input:t,matches:Af(e),partialMatch:e}}function yt(){const t=Array.from(arguments);function e(n){let i=null;return t.some(s=>{const a=typeof s=="function"?s().partialMatch(n):s.partialMatch(n);if(a)return i=a,!0}),i}const r={toString:function(){return"{ "+t.join(" ")+" }"},input:t,matches:Af(e),partialMatch:e};return r}function pe(t){const e=t;function r(i){if(typeof i=="string")try{i=xl(i)}catch(a){return!1}const s=i.protoNames();return s.length===1&&s[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:r,partialMatch:n}}var Pn={DNS:GT,DNS4:zT,DNS6:HT,DNSADDR:WT,IP:KT,TCP:XT,UDP:QT,UTP:YT,HTTP:JT,HTTPS:ZT,WebSockets:e1,WebSocketsSecure:t1,WebSocketStar:r1,WebRTCStar:n1,WebRTCDirect:i1,Reliable:s1,Stardust:a1,Circuit:o1,P2P:c1,IPFS:l1};const{CODE_CIRCUIT:Ul,CODE_P2P:Fl,CODE_TCP:$l,CODE_WS:u1,CODE_WSS:Cf}=cp;var If={all:t=>t.filter(e=>{if(e.protoCodes().includes(Ul))return!1;const r=e.decapsulateCode(Fl);return Pn.WebSockets.matches(r)||Pn.WebSocketsSecure.matches(r)}),dnsWss:t=>t.filter(e=>{if(e.protoCodes().includes(Ul))return!1;const r=e.decapsulateCode(Fl);return Pn.WebSocketsSecure.matches(r)&&Pn.DNS.matches(r.decapsulateCode($l).decapsulateCode(Cf))}),dnsWsOrWss:t=>t.filter(e=>{if(e.protoCodes().includes(Ul))return!1;const r=e.decapsulateCode(Fl);return Pn.WebSockets.matches(r)?Pn.DNS.matches(r.decapsulateCode($l).decapsulateCode(u1)):Pn.WebSocketsSecure.matches(r)&&Pn.DNS.matches(r.decapsulateCode($l).decapsulateCode(Cf))})};const{AbortError:Rf}=rt,as=Q("libp2p:websockets");class d1{constructor({upgrader:t,filter:e}){if(!t)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=t,this._filter=e}async dial(t,e={}){as("dialing %s",t);const r=await this._connect(t,e),n=Zp(r,{remoteAddr:t,signal:e.signal});as("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return as("outbound connection %s upgraded",n.remoteAddr),i}async _connect(t,e={}){if(e.signal&&e.signal.aborted)throw new Rf;const r=t.toOptions();as("dialing %s:%s",r.host,r.port);const n=zh(R_(t),Object.assign({binary:!0},e));if(!e.signal)return await n.connected(),as("connected %s",t),n;let i;const s=new Promise((a,c)=>{if(i=()=>{c(new Rf),n.close()},e.signal.aborted)return i();e.signal.addEventListener("abort",i)});try{await Promise.race([s,n.connected()])}finally{e.signal.removeEventListener("abort",i)}return as("connected %s",t),n}createListener(t={},e){return typeof t=="function"&&(e=t,t={}),RT({handler:e,upgrader:this._upgrader},t)}filter(t){return t=Array.isArray(t)?t:[t],this._filter?this._filter(t):Hh.isBrowser||Hh.isWebWorker?If.dnsWss(t):If.all(t)}}var h1=Ht(d1,{className:"WebSockets",symbolName:"@libp2p/js-libp2p-websockets/websockets"}),pi=St.EventEmitter;function kf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function p1(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?kf(Object(r),!0).forEach(function(n){f1(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):kf(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function f1(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function m1(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Pf(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function g1(t,e,r){return e&&Pf(t.prototype,e),r&&Pf(t,r),t}var Po=Qs.Buffer,ql=ji.inspect,b1=ql&&ql.custom||"inspect";function y1(t,e,r){Po.prototype.copy.call(t,e,r)}var v1=function(){function t(){m1(this,t),this.head=null,this.tail=null,this.length=0}return g1(t,[{key:"push",value:function(r){var n={data:r,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}},{key:"unshift",value:function(r){var n={data:r,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length}},{key:"shift",value:function(){if(this.length===0)return;var r=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,r}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(r){if(this.length===0)return"";for(var n=this.head,i=""+n.data;n=n.next;)i+=r+n.data;return i}},{key:"concat",value:function(r){if(this.length===0)return Po.alloc(0);for(var n=Po.allocUnsafe(r>>>0),i=this.head,s=0;i;)y1(i.data,n,s),s+=i.data.length,i=i.next;return n}},{key:"consume",value:function(r,n){var i;return r<this.head.data.length?(i=this.head.data.slice(0,r),this.head.data=this.head.data.slice(r)):r===this.head.data.length?i=this.shift():i=n?this._getString(r):this._getBuffer(r),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(r){var n=this.head,i=1,s=n.data;for(r-=s.length;n=n.next;){var a=n.data,c=r>a.length?a.length:r;if(c===a.length?s+=a:s+=a.slice(0,r),r-=c,r===0){c===a.length?(++i,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=a.slice(c));break}++i}return this.length-=i,s}},{key:"_getBuffer",value:function(r){var n=Po.allocUnsafe(r),i=this.head,s=1;for(i.data.copy(n),r-=i.data.length;i=i.next;){var a=i.data,c=r>a.length?a.length:r;if(a.copy(n,n.length-r,0,c),r-=c,r===0){c===a.length?(++s,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=a.slice(c));break}++s}return this.length-=s,n}},{key:b1,value:function(r,n){return ql(this,p1({},n,{depth:0,customInspect:!1}))}}]),t}();function w1(t,e){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,fe.nextTick(Vl,this,t)):fe.nextTick(Vl,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(s){!e&&s?r._writableState?r._writableState.errorEmitted?fe.nextTick(No,r):(r._writableState.errorEmitted=!0,fe.nextTick(Nf,r,s)):fe.nextTick(Nf,r,s):e?(fe.nextTick(No,r),e(s)):fe.nextTick(No,r)}),this)}function Nf(t,e){Vl(t,e),No(t)}function No(t){if(t._writableState&&!t._writableState.emitClose)return;if(t._readableState&&!t._readableState.emitClose)return;t.emit("close")}function _1(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function Vl(t,e){t.emit("error",e)}function E1(t,e){var r=t._readableState,n=t._writableState;r&&r.autoDestroy||n&&n.autoDestroy?t.destroy(e):t.emit("error",e)}var os={destroy:w1,undestroy:_1,errorOrDestroy:E1};function S1(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var Of={};function pr(t,e,r){r||(r=Error);function n(s,a,c){return typeof e=="string"?e:e(s,a,c)}var i=function(s){S1(a,s);function a(c,o,l){return s.call(this,n(c,o,l))||this}return a}(r);i.prototype.name=r.name,i.prototype.code=t,Of[t]=i}function Mf(t,e){if(Array.isArray(t)){var r=t.length;return t=t.map(function(n){return String(n)}),r>2?"one of ".concat(e," ").concat(t.slice(0,r-1).join(", "),", or ")+t[r-1]:r===2?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}else return"of ".concat(e," ").concat(String(t))}function T1(t,e,r){return t.substr(!r||r<0?0:+r,e.length)===e}function A1(t,e,r){return(r===void 0||r>t.length)&&(r=t.length),t.substring(r-e.length,r)===e}function C1(t,e,r){return typeof r!="number"&&(r=0),r+e.length>t.length?!1:t.indexOf(e,r)!==-1}pr("ERR_INVALID_OPT_VALUE",function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'},TypeError),pr("ERR_INVALID_ARG_TYPE",function(t,e,r){var n;typeof e=="string"&&T1(e,"not ")?(n="must not be",e=e.replace(/^not /,"")):n="must be";var i;if(A1(t," argument"))i="The ".concat(t," ").concat(n," ").concat(Mf(e,"type"));else{var s=C1(t,".")?"property":"argument";i='The "'.concat(t,'" ').concat(s," ").concat(n," ").concat(Mf(e,"type"))}return i+=". Received type ".concat(typeof r),i},TypeError),pr("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),pr("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"}),pr("ERR_STREAM_PREMATURE_CLOSE","Premature close"),pr("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"}),pr("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),pr("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),pr("ERR_STREAM_WRITE_AFTER_END","write after end"),pr("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),pr("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError),pr("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");var I1=Of,cs={codes:I1},R1=cs.codes.ERR_INVALID_OPT_VALUE;function k1(t,e,r){return t.highWaterMark!=null?t.highWaterMark:e?t[r]:null}function P1(t,e,r,n){var i=k1(e,n,r);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var s=n?r:"highWaterMark";throw new R1(s,i)}return Math.floor(i)}return t.objectMode?16:16*1024}var Df={getHighWaterMark:P1},Oo=ze;function xf(t){var e=this;this.next=null,this.entry=null,this.finish=function(){rA(e,t)}}var ls;ze.WritableState=Ta;var N1={deprecate:kg},Mo=Qs.Buffer,O1=ae.Uint8Array||function(){};function M1(t){return Mo.from(t)}function D1(t){return Mo.isBuffer(t)||t instanceof O1}var x1=Df.getHighWaterMark,Nn=cs.codes,j1=Nn.ERR_INVALID_ARG_TYPE,L1=Nn.ERR_METHOD_NOT_IMPLEMENTED,B1=Nn.ERR_MULTIPLE_CALLBACK,U1=Nn.ERR_STREAM_CANNOT_PIPE,F1=Nn.ERR_STREAM_DESTROYED,$1=Nn.ERR_STREAM_NULL_VALUES,q1=Nn.ERR_STREAM_WRITE_AFTER_END,V1=Nn.ERR_UNKNOWN_ENCODING,us=os.errorOrDestroy;Xs(ze,pi);function G1(){}function Ta(t,e,r){ls=ls||nn,t=t||{},typeof r!="boolean"&&(r=e instanceof ls),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=x1(this,t,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var n=t.decodeStrings===!1;this.decodeStrings=!n,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(i){Y1(e,i)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new xf(this)}Ta.prototype.getBuffer=function(){for(var e=this.bufferedRequest,r=[];e;)r.push(e),e=e.next;return r},function(){try{Object.defineProperty(Ta.prototype,"buffer",{get:N1.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}();var Do;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Do=Function.prototype[Symbol.hasInstance],Object.defineProperty(ze,Symbol.hasInstance,{value:function(e){return Do.call(this,e)?!0:this!==ze?!1:e&&e._writableState instanceof Ta}})):Do=function(e){return e instanceof this};function ze(t){ls=ls||nn;var e=this instanceof ls;if(!e&&!Do.call(ze,this))return new ze(t);this._writableState=new Ta(t,this,e),this.writable=!0,t&&(typeof t.write=="function"&&(this._write=t.write),typeof t.writev=="function"&&(this._writev=t.writev),typeof t.destroy=="function"&&(this._destroy=t.destroy),typeof t.final=="function"&&(this._final=t.final)),pi.call(this)}ze.prototype.pipe=function(){us(this,new U1)};function z1(t,e){var r=new q1;us(t,r),fe.nextTick(e,r)}function H1(t,e,r,n){var i;return r===null?i=new $1:typeof r!="string"&&!e.objectMode&&(i=new j1("chunk",["string","Buffer"],r)),i?(us(t,i),fe.nextTick(n,i),!1):!0}ze.prototype.write=function(t,e,r){var n=this._writableState,i=!1,s=!n.objectMode&&D1(t);return s&&!Mo.isBuffer(t)&&(t=M1(t)),typeof e=="function"&&(r=e,e=null),s?e="buffer":e||(e=n.defaultEncoding),typeof r!="function"&&(r=G1),n.ending?z1(this,r):(s||H1(this,n,t,r))&&(n.pendingcb++,i=K1(this,n,s,t,e,r)),i},ze.prototype.cork=function(){this._writableState.corked++},ze.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,!t.writing&&!t.corked&&!t.bufferProcessing&&t.bufferedRequest&&Lf(this,t))},ze.prototype.setDefaultEncoding=function(e){if(typeof e=="string"&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new V1(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(ze.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function W1(t,e,r){return!t.objectMode&&t.decodeStrings!==!1&&typeof e=="string"&&(e=Mo.from(e,r)),e}Object.defineProperty(ze.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function K1(t,e,r,n,i,s){if(!r){var a=W1(e,n,i);n!==a&&(r=!0,i="buffer",n=a)}var c=e.objectMode?1:n.length;e.length+=c;var o=e.length<e.highWaterMark;if(o||(e.needDrain=!0),e.writing||e.corked){var l=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:s,next:null},l?l.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else Gl(t,e,!1,c,n,i,s);return o}function Gl(t,e,r,n,i,s,a){e.writelen=n,e.writecb=a,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new F1("write")):r?t._writev(i,e.onwrite):t._write(i,s,e.onwrite),e.sync=!1}function X1(t,e,r,n,i){--e.pendingcb,r?(fe.nextTick(i,n),fe.nextTick(Aa,t,e),t._writableState.errorEmitted=!0,us(t,n)):(i(n),t._writableState.errorEmitted=!0,us(t,n),Aa(t,e))}function Q1(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function Y1(t,e){var r=t._writableState,n=r.sync,i=r.writecb;if(typeof i!="function")throw new B1;if(Q1(r),e)X1(t,r,n,e,i);else{var s=Bf(r)||t.destroyed;!s&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&Lf(t,r),n?fe.nextTick(jf,t,r,s,i):jf(t,r,s,i)}}function jf(t,e,r,n){r||J1(t,e),e.pendingcb--,n(),Aa(t,e)}function J1(t,e){e.length===0&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function Lf(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var n=e.bufferedRequestCount,i=new Array(n),s=e.corkedRequestsFree;s.entry=r;for(var a=0,c=!0;r;)i[a]=r,r.isBuf||(c=!1),r=r.next,a+=1;i.allBuffers=c,Gl(t,e,!0,e.length,i,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new xf(e),e.bufferedRequestCount=0}else{for(;r;){var o=r.chunk,l=r.encoding,u=r.callback,h=e.objectMode?1:o.length;if(Gl(t,e,!1,h,o,l,u),r=r.next,e.bufferedRequestCount--,e.writing)break}r===null&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}ze.prototype._write=function(t,e,r){r(new L1("_write()"))},ze.prototype._writev=null,ze.prototype.end=function(t,e,r){var n=this._writableState;return typeof t=="function"?(r=t,t=null,e=null):typeof e=="function"&&(r=e,e=null),t!=null&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||tA(this,n,r),this},Object.defineProperty(ze.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Bf(t){return t.ending&&t.length===0&&t.bufferedRequest===null&&!t.finished&&!t.writing}function Z1(t,e){t._final(function(r){e.pendingcb--,r&&us(t,r),e.prefinished=!0,t.emit("prefinish"),Aa(t,e)})}function eA(t,e){!e.prefinished&&!e.finalCalled&&(typeof t._final=="function"&&!e.destroyed?(e.pendingcb++,e.finalCalled=!0,fe.nextTick(Z1,t,e)):(e.prefinished=!0,t.emit("prefinish")))}function Aa(t,e){var r=Bf(e);if(r&&(eA(t,e),e.pendingcb===0&&(e.finished=!0,t.emit("finish"),e.autoDestroy))){var n=t._readableState;(!n||n.autoDestroy&&n.endEmitted)&&t.destroy()}return r}function tA(t,e,r){e.ending=!0,Aa(t,e),r&&(e.finished?fe.nextTick(r):t.once("finish",r)),e.ended=!0,t.writable=!1}function rA(t,e,r){var n=t.entry;for(t.entry=null;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree.next=t}Object.defineProperty(ze.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(e){if(!this._writableState)return;this._writableState.destroyed=e}}),ze.prototype.destroy=os.destroy,ze.prototype._undestroy=os.undestroy,ze.prototype._destroy=function(t,e){e(t)};var nA=Object.keys||function(t){var e=[];for(var r in t)e.push(r);return e},nn=Ur;Xs(Ur,Yl);for(var Uf=nA(Oo.prototype),zl=0;zl<Uf.length;zl++){var Hl=Uf[zl];Ur.prototype[Hl]||(Ur.prototype[Hl]=Oo.prototype[Hl])}function Ur(t){if(!(this instanceof Ur))return new Ur(t);Yl.call(this,t),Oo.call(this,t),this.allowHalfOpen=!0,t&&(t.readable===!1&&(this.readable=!1),t.writable===!1&&(this.writable=!1),t.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",iA)))}Object.defineProperty(Ur.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(Ur.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(Ur.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function iA(){if(this._writableState.ended)return;fe.nextTick(sA,this)}function sA(t){t.end()}Object.defineProperty(Ur.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(e){if(this._readableState===void 0||this._writableState===void 0)return;this._readableState.destroyed=e,this._writableState.destroyed=e}});var Wl=Pg.Buffer,Ff=Wl.isEncoding||function(t){t=""+t;switch(t&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function aA(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}function oA(t){var e=aA(t);if(typeof e!="string"&&(Wl.isEncoding===Ff||!Ff(t)))throw new Error("Unknown encoding: "+t);return e||t}var cA=Ca;function Ca(t){this.encoding=oA(t);var e;switch(this.encoding){case"utf16le":this.text=fA,this.end=mA,e=4;break;case"utf8":this.fillLast=dA,e=4;break;case"base64":this.text=gA,this.end=bA,e=3;break;default:this.write=yA,this.end=vA;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=Wl.allocUnsafe(e)}Ca.prototype.write=function(t){if(t.length===0)return"";var e,r;if(this.lastNeed){if(e=this.fillLast(t),e===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""},Ca.prototype.end=pA,Ca.prototype.text=hA,Ca.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length};function Kl(t){return t<=127?0:t>>5===6?2:t>>4===14?3:t>>3===30?4:t>>6===2?-1:-2}function lA(t,e,r){var n=e.length-1;if(n<r)return 0;var i=Kl(e[n]);return i>=0?(i>0&&(t.lastNeed=i-1),i):--n<r||i===-2?0:(i=Kl(e[n]),i>=0?(i>0&&(t.lastNeed=i-2),i):--n<r||i===-2?0:(i=Kl(e[n]),i>=0?(i>0&&(i===2?i=0:t.lastNeed=i-3),i):0))}function uA(t,e,r){if((e[0]&192)!==128)return t.lastNeed=0,"\uFFFD";if(t.lastNeed>1&&e.length>1){if((e[1]&192)!==128)return t.lastNeed=1,"\uFFFD";if(t.lastNeed>2&&e.length>2&&(e[2]&192)!==128)return t.lastNeed=2,"\uFFFD"}}function dA(t){var e=this.lastTotal-this.lastNeed,r=uA(this,t);if(r!==void 0)return r;if(this.lastNeed<=t.length)return t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,e,0,t.length),this.lastNeed-=t.length}function hA(t,e){var r=lA(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var n=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)}function pA(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"\uFFFD":e}function fA(t,e){if((t.length-e)%2===0){var r=t.toString("utf16le",e);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function mA(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function gA(t,e){var r=(t.length-e)%3;return r===0?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function bA(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function yA(t){return t.toString(this.encoding)}function vA(t){return t&&t.length?this.write(t):""}var $f={StringDecoder:cA},qf=cs.codes.ERR_STREAM_PREMATURE_CLOSE;function wA(t){var e=!1;return function(){if(e)return;e=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];t.apply(this,n)}}function _A(){}function EA(t){return t.setHeader&&typeof t.abort=="function"}function Vf(t,e,r){if(typeof e=="function")return Vf(t,null,e);e||(e={}),r=wA(r||_A);var n=e.readable||e.readable!==!1&&t.readable,i=e.writable||e.writable!==!1&&t.writable,s=function(){t.writable||c()},a=t._writableState&&t._writableState.finished,c=function(){i=!1,a=!0,n||r.call(t)},o=t._readableState&&t._readableState.endEmitted,l=function(){n=!1,o=!0,i||r.call(t)},u=function(S){r.call(t,S)},h=function(){var S;if(n&&!o)return(!t._readableState||!t._readableState.ended)&&(S=new qf),r.call(t,S);if(i&&!a)return(!t._writableState||!t._writableState.ended)&&(S=new qf),r.call(t,S)},f=function(){t.req.on("finish",c)};return EA(t)?(t.on("complete",c),t.on("abort",h),t.req?f():t.on("request",f)):i&&!t._writableState&&(t.on("end",s),t.on("close",s)),t.on("end",l),t.on("finish",c),e.error!==!1&&t.on("error",u),t.on("close",h),function(){t.removeListener("complete",c),t.removeListener("abort",h),t.removeListener("request",f),t.req&&t.req.removeListener("finish",c),t.removeListener("end",s),t.removeListener("close",s),t.removeListener("finish",c),t.removeListener("end",l),t.removeListener("error",u),t.removeListener("close",h)}}var Xl=Vf,xo;function On(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Mn=Symbol("lastResolve"),fi=Symbol("lastReject"),Ia=Symbol("error"),jo=Symbol("ended"),mi=Symbol("lastPromise"),Ql=Symbol("handlePromise"),gi=Symbol("stream");function Dn(t,e){return{value:t,done:e}}function SA(t){var e=t[Mn];if(e!==null){var r=t[gi].read();r!==null&&(t[mi]=null,t[Mn]=null,t[fi]=null,e(Dn(r,!1)))}}function TA(t){fe.nextTick(SA,t)}function AA(t,e){return function(r,n){t.then(function(){if(e[jo]){r(Dn(void 0,!0));return}e[Ql](r,n)},n)}}var CA=Object.getPrototypeOf(function(){}),IA=Object.setPrototypeOf((xo={get stream(){return this[gi]},next:function(){var e=this,r=this[Ia];if(r!==null)return Promise.reject(r);if(this[jo])return Promise.resolve(Dn(void 0,!0));if(this[gi].destroyed)return new Promise(function(a,c){fe.nextTick(function(){e[Ia]?c(e[Ia]):a(Dn(void 0,!0))})});var n=this[mi],i;if(n)i=new Promise(AA(n,this));else{var s=this[gi].read();if(s!==null)return Promise.resolve(Dn(s,!1));i=new Promise(this[Ql])}return this[mi]=i,i}},On(xo,Symbol.asyncIterator,function(){return this}),On(xo,"return",function(){var e=this;return new Promise(function(r,n){e[gi].destroy(null,function(i){if(i){n(i);return}r(Dn(void 0,!0))})})}),xo),CA),RA=function(e){var r,n=Object.create(IA,(r={},On(r,gi,{value:e,writable:!0}),On(r,Mn,{value:null,writable:!0}),On(r,fi,{value:null,writable:!0}),On(r,Ia,{value:null,writable:!0}),On(r,jo,{value:e._readableState.endEmitted,writable:!0}),On(r,Ql,{value:function(s,a){var c=n[gi].read();c?(n[mi]=null,n[Mn]=null,n[fi]=null,s(Dn(c,!1))):(n[Mn]=s,n[fi]=a)},writable:!0}),r));return n[mi]=null,Xl(e,function(i){if(i&&i.code!=="ERR_STREAM_PREMATURE_CLOSE"){var s=n[fi];s!==null&&(n[mi]=null,n[Mn]=null,n[fi]=null,s(i)),n[Ia]=i;return}var a=n[Mn];a!==null&&(n[mi]=null,n[Mn]=null,n[fi]=null,a(Dn(void 0,!0))),n[jo]=!0}),e.on("readable",TA.bind(null,n)),n},kA=RA,PA=function(){throw new Error("Readable.from is not available in the browser")},Yl=Ce,ds;Ce.ReadableState=zf;var GP=St.EventEmitter,Gf=function(e,r){return e.listeners(r).length},Lo=Qs.Buffer,NA=ae.Uint8Array||function(){};function OA(t){return Lo.from(t)}function MA(t){return Lo.isBuffer(t)||t instanceof NA}var ve;ji&&ji.debuglog?ve=ji.debuglog("stream"):ve=function(){};var DA=Df.getHighWaterMark,Bo=cs.codes,xA=Bo.ERR_INVALID_ARG_TYPE,jA=Bo.ERR_STREAM_PUSH_AFTER_EOF,LA=Bo.ERR_METHOD_NOT_IMPLEMENTED,BA=Bo.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,hs,Jl,Zl;Xs(Ce,pi);var Ra=os.errorOrDestroy,eu=["error","close","destroy","pause","resume"];function UA(t,e,r){if(typeof t.prependListener=="function")return t.prependListener(e,r);!t._events||!t._events[e]?t.on(e,r):Array.isArray(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]}function zf(t,e,r){ds=ds||nn,t=t||{},typeof r!="boolean"&&(r=e instanceof ds),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=DA(this,t,"readableHighWaterMark",r),this.buffer=new v1,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(hs||(hs=$f.StringDecoder),this.decoder=new hs(t.encoding),this.encoding=t.encoding)}function Ce(t){if(ds=ds||nn,!(this instanceof Ce))return new Ce(t);var e=this instanceof ds;this._readableState=new zf(t,this,e),this.readable=!0,t&&(typeof t.read=="function"&&(this._read=t.read),typeof t.destroy=="function"&&(this._destroy=t.destroy)),pi.call(this)}Object.defineProperty(Ce.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(e){if(!this._readableState)return;this._readableState.destroyed=e}}),Ce.prototype.destroy=os.destroy,Ce.prototype._undestroy=os.undestroy,Ce.prototype._destroy=function(t,e){e(t)},Ce.prototype.push=function(t,e){var r=this._readableState,n;return r.objectMode?n=!0:typeof t=="string"&&(e=e||r.defaultEncoding,e!==r.encoding&&(t=Lo.from(t,e),e=""),n=!0),Hf(this,t,e,!1,n)},Ce.prototype.unshift=function(t){return Hf(this,t,null,!0,!1)};function Hf(t,e,r,n,i){ve("readableAddChunk",e);var s=t._readableState;if(e===null)s.reading=!1,qA(t,s);else{var a;if(i||(a=FA(s,e)),a)Ra(t,a);else if(s.objectMode||e&&e.length>0)if(typeof e!="string"&&!s.objectMode&&Object.getPrototypeOf(e)!==Lo.prototype&&(e=OA(e)),n)s.endEmitted?Ra(t,new BA):tu(t,s,e,!0);else if(s.ended)Ra(t,new jA);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!r?(e=s.decoder.write(e),s.objectMode||e.length!==0?tu(t,s,e,!1):ru(t,s)):tu(t,s,e,!1)}else n||(s.reading=!1,ru(t,s))}return!s.ended&&(s.length<s.highWaterMark||s.length===0)}function tu(t,e,r,n){e.flowing&&e.length===0&&!e.sync?(e.awaitDrain=0,t.emit("data",r)):(e.length+=e.objectMode?1:r.length,n?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&Uo(t)),ru(t,e)}function FA(t,e){var r;return!MA(e)&&typeof e!="string"&&e!==void 0&&!t.objectMode&&(r=new xA("chunk",["string","Buffer","Uint8Array"],e)),r}Ce.prototype.isPaused=function(){return this._readableState.flowing===!1},Ce.prototype.setEncoding=function(t){hs||(hs=$f.StringDecoder);var e=new hs(t);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";r!==null;)n+=e.write(r.data),r=r.next;return this._readableState.buffer.clear(),n!==""&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var Wf=1073741824;function $A(t){return t>=Wf?t=Wf:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function Kf(t,e){return t<=0||e.length===0&&e.ended?0:e.objectMode?1:t!==t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=$A(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}Ce.prototype.read=function(t){ve("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(t!==0&&(e.emittedReadable=!1),t===0&&e.needReadable&&((e.highWaterMark!==0?e.length>=e.highWaterMark:e.length>0)||e.ended))return ve("read: emitReadable",e.length,e.ended),e.length===0&&e.ended?iu(this):Uo(this),null;if(t=Kf(t,e),t===0&&e.ended)return e.length===0&&iu(this),null;var n=e.needReadable;ve("need readable",n),(e.length===0||e.length-t<e.highWaterMark)&&(n=!0,ve("length less than watermark",n)),e.ended||e.reading?(n=!1,ve("reading or ended",n)):n&&(ve("do read"),e.reading=!0,e.sync=!0,e.length===0&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=Kf(r,e)));var i;return t>0?i=Yf(t,e):i=null,i===null?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.awaitDrain=0),e.length===0&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&iu(this)),i!==null&&this.emit("data",i),i};function qA(t,e){if(ve("onEofChunk"),e.ended)return;if(e.decoder){var r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,e.sync?Uo(t):(e.needReadable=!1,e.emittedReadable||(e.emittedReadable=!0,Xf(t)))}function Uo(t){var e=t._readableState;ve("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(ve("emitReadable",e.flowing),e.emittedReadable=!0,fe.nextTick(Xf,t))}function Xf(t){var e=t._readableState;ve("emitReadable_",e.destroyed,e.length,e.ended),!e.destroyed&&(e.length||e.ended)&&(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,nu(t)}function ru(t,e){e.readingMore||(e.readingMore=!0,fe.nextTick(VA,t,e))}function VA(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&e.length===0);){var r=e.length;if(ve("maybeReadMore read 0"),t.read(0),r===e.length)break}e.readingMore=!1}Ce.prototype._read=function(t){Ra(this,new LA("_read()"))},Ce.prototype.pipe=function(t,e){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=t;break;case 1:n.pipes=[n.pipes,t];break;default:n.pipes.push(t);break}n.pipesCount+=1,ve("pipe count=%d opts=%j",n.pipesCount,e);var i=(!e||e.end!==!1)&&t!==fe.stdout&&t!==fe.stderr,s=i?c:M;n.endEmitted?fe.nextTick(s):r.once("end",s),t.on("unpipe",a);function a(I,k){ve("onunpipe"),I===r&&(k&&k.hasUnpiped===!1&&(k.hasUnpiped=!0,u()))}function c(){ve("onend"),t.end()}var o=GA(r);t.on("drain",o);var l=!1;function u(){ve("cleanup"),t.removeListener("close",p),t.removeListener("finish",S),t.removeListener("drain",o),t.removeListener("error",f),t.removeListener("unpipe",a),r.removeListener("end",c),r.removeListener("end",M),r.removeListener("data",h),l=!0,n.awaitDrain&&(!t._writableState||t._writableState.needDrain)&&o()}r.on("data",h);function h(I){ve("ondata");var k=t.write(I);ve("dest.write",k),k===!1&&((n.pipesCount===1&&n.pipes===t||n.pipesCount>1&&Jf(n.pipes,t)!==-1)&&!l&&(ve("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function f(I){ve("onerror",I),M(),t.removeListener("error",f),Gf(t,"error")===0&&Ra(t,I)}UA(t,"error",f);function p(){t.removeListener("finish",S),M()}t.once("close",p);function S(){ve("onfinish"),t.removeListener("close",p),M()}t.once("finish",S);function M(){ve("unpipe"),r.unpipe(t)}return t.emit("pipe",r),n.flowing||(ve("pipe resume"),r.resume()),t};function GA(t){return function(){var r=t._readableState;ve("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&Gf(t,"data")&&(r.flowing=!0,nu(t))}}Ce.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(e.pipesCount===0)return this;if(e.pipesCount===1)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r),this);if(!t){var n=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<i;s++)n[s].emit("unpipe",this,{hasUnpiped:!1});return this}var a=Jf(e.pipes,t);return a===-1?this:(e.pipes.splice(a,1),e.pipesCount-=1,e.pipesCount===1&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r),this)},Ce.prototype.on=function(t,e){var r=pi.prototype.on.call(this,t,e),n=this._readableState;return t==="data"?(n.readableListening=this.listenerCount("readable")>0,n.flowing!==!1&&this.resume()):t==="readable"&&(!n.endEmitted&&!n.readableListening&&(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,ve("on readable",n.length,n.reading),n.length?Uo(this):n.reading||fe.nextTick(zA,this))),r},Ce.prototype.addListener=Ce.prototype.on,Ce.prototype.removeListener=function(t,e){var r=pi.prototype.removeListener.call(this,t,e);return t==="readable"&&fe.nextTick(Qf,this),r},Ce.prototype.removeAllListeners=function(t){var e=pi.prototype.removeAllListeners.apply(this,arguments);return(t==="readable"||t===void 0)&&fe.nextTick(Qf,this),e};function Qf(t){var e=t._readableState;e.readableListening=t.listenerCount("readable")>0,e.resumeScheduled&&!e.paused?e.flowing=!0:t.listenerCount("data")>0&&t.resume()}function zA(t){ve("readable nexttick read 0"),t.read(0)}Ce.prototype.resume=function(){var t=this._readableState;return t.flowing||(ve("resume"),t.flowing=!t.readableListening,HA(this,t)),t.paused=!1,this};function HA(t,e){e.resumeScheduled||(e.resumeScheduled=!0,fe.nextTick(WA,t,e))}function WA(t,e){ve("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),nu(t),e.flowing&&!e.reading&&t.read(0)}Ce.prototype.pause=function(){return ve("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(ve("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function nu(t){var e=t._readableState;for(ve("flow",e.flowing);e.flowing&&t.read()!==null;);}Ce.prototype.wrap=function(t){var e=this,r=this._readableState,n=!1;t.on("end",function(){if(ve("wrapped end"),r.decoder&&!r.ended){var a=r.decoder.end();a&&a.length&&e.push(a)}e.push(null)}),t.on("data",function(a){if(ve("wrapped data"),r.decoder&&(a=r.decoder.write(a)),r.objectMode&&a==null)return;if(!r.objectMode&&(!a||!a.length))return;var c=e.push(a);c||(n=!0,t.pause())});for(var i in t)this[i]===void 0&&typeof t[i]=="function"&&(this[i]=function(c){return function(){return t[c].apply(t,arguments)}}(i));for(var s=0;s<eu.length;s++)t.on(eu[s],this.emit.bind(this,eu[s]));return this._read=function(a){ve("wrapped _read",a),n&&(n=!1,t.resume())},this},typeof Symbol=="function"&&(Ce.prototype[Symbol.asyncIterator]=function(){return Jl===void 0&&(Jl=kA),Jl(this)}),Object.defineProperty(Ce.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(Ce.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(Ce.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),Ce._fromList=Yf,Object.defineProperty(Ce.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function Yf(t,e){if(e.length===0)return null;var r;return e.objectMode?r=e.buffer.shift():!t||t>=e.length?(e.decoder?r=e.buffer.join(""):e.buffer.length===1?r=e.buffer.first():r=e.buffer.concat(e.length),e.buffer.clear()):r=e.buffer.consume(t,e.decoder),r}function iu(t){var e=t._readableState;ve("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,fe.nextTick(KA,e,t))}function KA(t,e){if(ve("endReadableNT",t.endEmitted,t.length),!t.endEmitted&&t.length===0&&(t.endEmitted=!0,e.readable=!1,e.emit("end"),t.autoDestroy)){var r=e._writableState;(!r||r.autoDestroy&&r.finished)&&e.destroy()}}typeof Symbol=="function"&&(Ce.from=function(t,e){return Zl===void 0&&(Zl=PA),Zl(Ce,t,e)});function Jf(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}var su=sn,Fo=cs.codes,XA=Fo.ERR_METHOD_NOT_IMPLEMENTED,QA=Fo.ERR_MULTIPLE_CALLBACK,YA=Fo.ERR_TRANSFORM_ALREADY_TRANSFORMING,JA=Fo.ERR_TRANSFORM_WITH_LENGTH_0;Xs(sn,nn);function ZA(t,e){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(n===null)return this.emit("error",new QA);r.writechunk=null,r.writecb=null,e!=null&&this.push(e),n(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function sn(t){if(!(this instanceof sn))return new sn(t);nn.call(this,t),this._transformState={afterTransform:ZA.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",eC)}function eC(){var t=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,r){Zf(t,e,r)}):Zf(this,null,null)}sn.prototype.push=function(t,e){return this._transformState.needTransform=!1,nn.prototype.push.call(this,t,e)},sn.prototype._transform=function(t,e,r){r(new XA("_transform()"))},sn.prototype._write=function(t,e,r){var n=this._transformState;if(n.writecb=r,n.writechunk=t,n.writeencoding=e,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},sn.prototype._read=function(t){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},sn.prototype._destroy=function(t,e){nn.prototype._destroy.call(this,t,function(r){e(r)})};function Zf(t,e,r){if(e)return t.emit("error",e);if(r!=null&&t.push(r),t._writableState.length)throw new JA;if(t._transformState.transforming)throw new YA;return t.push(null)}var tC=ka;Xs(ka,su);function ka(t){if(!(this instanceof ka))return new ka(t);su.call(this,t)}ka.prototype._transform=function(t,e,r){r(null,t)};var au;function rC(t){var e=!1;return function(){if(e)return;e=!0,t.apply(void 0,arguments)}}var em=cs.codes,nC=em.ERR_MISSING_ARGS,iC=em.ERR_STREAM_DESTROYED;function tm(t){if(t)throw t}function sC(t){return t.setHeader&&typeof t.abort=="function"}function aC(t,e,r,n){n=rC(n);var i=!1;t.on("close",function(){i=!0}),au===void 0&&(au=Xl),au(t,{readable:e,writable:r},function(a){if(a)return n(a);i=!0,n()});var s=!1;return function(a){if(i)return;if(s)return;if(s=!0,sC(t))return t.abort();if(typeof t.destroy=="function")return t.destroy();n(a||new iC("pipe"))}}function rm(t){t()}function oC(t,e){return t.pipe(e)}function cC(t){return t.length?typeof t[t.length-1]!="function"?tm:t.pop():tm}function lC(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=cC(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new nC("streams");var i,s=e.map(function(a,c){var o=c<e.length-1,l=c>0;return aC(a,o,l,function(u){if(i||(i=u),u&&s.forEach(rm),o)return;s.forEach(rm),n(i)})});return e.reduce(oC)}var uC=lC,dC=te(function(t,e){e=t.exports=Yl,e.Stream=e,e.Readable=e,e.Writable=Oo,e.Duplex=nn,e.Transform=su,e.PassThrough=tC,e.finished=Xl,e.pipeline=uC});/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let nm;var ou=typeof queueMicrotask=="function"?queueMicrotask:t=>(nm||(nm=Promise.resolve())).then(t).catch(e=>setTimeout(()=>{throw e},0));/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var hC=Q("simple-peer"),cu=64*1024,pC=5*1e3,fC=5*1e3;function im(t){return t.replace(/a=ice-options:trickle\s\n/g,"")}function mC(t){console.warn(t)}class ps extends dC.Duplex{constructor(t){if(t=Object.assign({allowHalfOpen:!1},t),super(t),this._id=Fu(4).toString("hex").slice(0,7),this._debug("new peer %o",t),this.channelName=t.initiator?t.channelName||Fu(20).toString("hex"):null,this.initiator=t.initiator||!1,this.channelConfig=t.channelConfig||ps.channelConfig,this.negotiated=this.channelConfig.negotiated,this.config=Object.assign({},ps.config,t.config),this.offerOptions=t.offerOptions||{},this.answerOptions=t.answerOptions||{},this.sdpTransform=t.sdpTransform||(e=>e),this.streams=t.streams||(t.stream?[t.stream]:[]),this.trickle=t.trickle!==void 0?t.trickle:!0,this.allowHalfTrickle=t.allowHalfTrickle!==void 0?t.allowHalfTrickle:!1,this.iceCompleteTimeout=t.iceCompleteTimeout||pC,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=t.wrtc&&typeof t.wrtc=="object"?t.wrtc:Uu(),!this._wrtc)throw typeof window=="undefined"?U(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):U(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=this.negotiated?!1:!this.initiator,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._firstStable=!0,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(e){ou(()=>this.destroy(U(e,"ERR_PC_CONSTRUCTOR")));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=e=>{this._onIceCandidate(e)},this.initiator||this.negotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=e=>{this._setupData(e)},this.streams&&this.streams.forEach(e=>{this.addStream(e)}),this._pc.ontrack=e=>{this._onTrack(e)},this.initiator&&this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(t){if(this.destroyed)throw U(new Error("cannot signal after peer is destroyed"),"ERR_SIGNALING");if(typeof t=="string")try{t=JSON.parse(t)}catch(e){t={}}this._debug("signal()"),t.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),t.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(t.transceiverRequest.kind,t.transceiverRequest.init)),t.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(t.candidate):this._pendingCandidates.push(t.candidate)),t.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(t)).then(()=>{if(this.destroyed)return;this._pendingCandidates.forEach(e=>{this._addIceCandidate(e)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer()}).catch(e=>{this.destroy(U(e,"ERR_SET_REMOTE_DESCRIPTION"))}),!t.sdp&&!t.candidate&&!t.renegotiate&&!t.transceiverRequest&&this.destroy(U(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}_addIceCandidate(t){var e=new this._wrtc.RTCIceCandidate(t);this._pc.addIceCandidate(e).catch(r=>{!e.address||e.address.endsWith(".local")?mC("Ignoring unsupported ICE candidate."):this.destroy(U(r,"ERR_ADD_ICE_CANDIDATE"))})}send(t){this._channel.send(t)}addTransceiver(t,e){if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,e),this._needsNegotiation()}catch(r){this.destroy(U(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{transceiverRequest:{kind:t,init:e}})}addStream(t){this._debug("addStream()"),t.getTracks().forEach(e=>{this.addTrack(e,t)})}addTrack(t,e){this._debug("addTrack()");var r=this._senderMap.get(t)||new Map,n=r.get(e);if(!n)n=this._pc.addTrack(t,e),r.set(e,n),this._senderMap.set(t,r),this._needsNegotiation();else throw n.removed?U(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):U(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(t,e,r){this._debug("replaceTrack()");var n=this._senderMap.get(t),i=n?n.get(r):null;if(!i)throw U(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");e&&this._senderMap.set(e,n),i.replaceTrack!=null?i.replaceTrack(e):this.destroy(U(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(t,e){this._debug("removeSender()");var r=this._senderMap.get(t),n=r?r.get(e):null;if(!n)throw U(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{n.removed=!0,this._pc.removeTrack(n)}catch(i){i.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(n):this.destroy(U(i,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){this._debug("removeSenders()"),t.getTracks().forEach(e=>{this.removeTrack(e,t)})}_needsNegotiation(){if(this._debug("_needsNegotiation"),this._batchedNegotiation)return;this._batchedNegotiation=!0,ou(()=>{this._batchedNegotiation=!1,this._debug("starting batched negotiation"),this.negotiate()})}negotiate(){this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{renegotiate:!0})),this._isNegotiating=!0}_destroy(t,e){if(this._debug("destroy (error: %s)",t&&(t.message||t)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(r){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(r){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e(t)}_setupData(t){if(!t.channel)return this.destroy(U(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=t.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=cu),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{this.destroy(U(r,"ERR_DATA_CHANNEL"))};var e=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(e&&this._onChannelClose(),e=!0):e=!1},fC)}_read(){}_write(t,e,r){if(this.destroyed)return r(U(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(t)}catch(n){return this.destroy(U(n,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>cu?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=t,this._cb=r}_onFinish(){if(this.destroyed)return;const t=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?t():this.once("connect",t)}_startIceCompleteTimeout(){if(this.destroyed)return;if(this._iceCompleteTimer)return;this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout)}_createOffer(){if(this.destroyed)return;this._pc.createOffer(this.offerOptions).then(t=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(t.sdp=im(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const e=()=>{if(this.destroyed)return;var i=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:i.type,sdp:i.sdp})},r=()=>{if(this._debug("createOffer success"),this.destroyed)return;this.trickle||this._iceComplete?e():this.once("_iceComplete",e)},n=i=>{this.destroy(U(i,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(t).then(r).catch(n)}).catch(t=>{this.destroy(U(t,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(t=>{!t.mid&&t.sender.track&&!t.requested&&(t.requested=!0,this.addTransceiver(t.sender.track.kind))})}_createAnswer(){if(this.destroyed)return;this._pc.createAnswer(this.answerOptions).then(t=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(t.sdp=im(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const e=()=>{if(this.destroyed)return;var i=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:i.type,sdp:i.sdp}),this.initiator||this._requestMissingTransceivers()},r=()=>{if(this.destroyed)return;this.trickle||this._iceComplete?e():this.once("_iceComplete",e)},n=i=>{this.destroy(U(i,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(t).then(r).catch(n)}).catch(t=>{this.destroy(U(t,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){if(this.destroyed)return;this._pc.connectionState==="failed"&&this.destroy(U(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;var t=this._pc.iceConnectionState,e=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",t,e),this.emit("iceStateChange",t,e),(t==="connected"||t==="completed")&&(this._pcReady=!0,this._maybeReady()),t==="failed"&&this.destroy(U(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),t==="closed"&&this.destroy(U(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(t){const e=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(n=>{Object.assign(r,n)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{var n=[];r.forEach(i=>{n.push(e(i))}),t(null,n)},r=>t(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;var n=[];r.result().forEach(i=>{var s={};i.names().forEach(a=>{s[a]=i.stat(a)}),s.id=i.id,s.type=i.type,s.timestamp=i.timestamp,n.push(e(s))}),t(null,n)},r=>t(r)):t(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const t=()=>{if(this.destroyed)return;this.getStats((e,r)=>{if(this.destroyed)return;e&&(r=[]);var n={},i={},s={},a=!1;r.forEach(l=>{(l.type==="remotecandidate"||l.type==="remote-candidate")&&(n[l.id]=l),(l.type==="localcandidate"||l.type==="local-candidate")&&(i[l.id]=l),(l.type==="candidatepair"||l.type==="candidate-pair")&&(s[l.id]=l)});const c=l=>{a=!0;var u=i[l.localCandidateId];u&&(u.ip||u.address)?(this.localAddress=u.ip||u.address,this.localPort=Number(u.port)):u&&u.ipAddress?(this.localAddress=u.ipAddress,this.localPort=Number(u.portNumber)):typeof l.googLocalAddress=="string"&&(u=l.googLocalAddress.split(":"),this.localAddress=u[0],this.localPort=Number(u[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");var h=n[l.remoteCandidateId];h&&(h.ip||h.address)?(this.remoteAddress=h.ip||h.address,this.remotePort=Number(h.port)):h&&h.ipAddress?(this.remoteAddress=h.ipAddress,this.remotePort=Number(h.portNumber)):typeof l.googRemoteAddress=="string"&&(h=l.googRemoteAddress.split(":"),this.remoteAddress=h[0],this.remotePort=Number(h[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(l=>{l.type==="transport"&&l.selectedCandidatePairId&&c(s[l.selectedCandidatePairId]),(l.type==="googCandidatePair"&&l.googActiveConnection==="true"||(l.type==="candidatepair"||l.type==="candidate-pair")&&l.selected)&&c(l)}),!a&&(!Object.keys(s).length||Object.keys(i).length)){setTimeout(t,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(l){return this.destroy(U(l,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');var o=this._cb;this._cb=null,o(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};t()}_onInterval(){if(!this._cb||!this._channel||this._channel.bufferedAmount>cu)return;this._onChannelBufferedAmountLow()}_onSignalingStateChange(){if(this.destroyed)return;this._pc.signalingState==="stable"&&!this._firstStable&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(t=>{this._pc.removeTrack(t),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation&&(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()),this._debug("negotiate"),this.emit("negotiate")),this._firstStable=!1,this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState)}_onIceCandidate(t){if(this.destroyed)return;t.candidate&&this.trickle?this.emit("signal",{candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}}):!t.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),t.candidate&&this._startIceCompleteTimeout()}_onChannelMessage(t){if(this.destroyed)return;var e=t.data;e instanceof ArrayBuffer&&(e=new Uint8Array(e)),this.push(e)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var t=this._cb;this._cb=null,t(null)}_onChannelOpen(){if(this._connected||this.destroyed)return;this._debug("on channel open"),this._channelReady=!0,this._maybeReady()}_onChannelClose(){if(this.destroyed)return;this._debug("on channel close"),this.destroy()}_onTrack(t){if(this.destroyed)return;t.streams.forEach(e=>{if(this._debug("on track"),this.emit("track",t.track,e),this._remoteTracks.push({track:t.track,stream:e}),this._remoteStreams.some(r=>r.id===e.id))return;this._remoteStreams.push(e),ou(()=>{this.emit("stream",e)})})}_debug(){var t=[].slice.call(arguments);t[0]="["+this._id+"] "+t[0],hC.apply(null,t)}}ps.WEBRTC_SUPPORT=!!Uu(),ps.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},ps.channelConfig={};var sm=ps;(function(){if(typeof globalThis=="object")return;Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__})();var am=globalThis,gC={supportsFileReader:typeof self!="undefined"&&"FileReader"in self,supportsWebRTC:"RTCPeerConnection"in am&&(typeof navigator!="undefined"&&typeof navigator.mediaDevices!="undefined")&&"getUserMedia"in navigator.mediaDevices,supportsWebRTCDataChannels:"RTCPeerConnection"in am},bC=421,yC=290,vC=2e3,lu={CODE_P2P:bC,CODE_CIRCUIT:yC,CLOSE_TIMEOUT:vC},wC=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,_C=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],uu=function(e){var r=e,n=e.indexOf("["),i=e.indexOf("]");n!=-1&&i!=-1&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));for(var s=wC.exec(e||""),a={},c=14;c--;)a[_C[c]]=s[c]||"";return n!=-1&&i!=-1&&(a.source=r,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=EC(a,a.path),a.queryKey=SC(a,a.query),a};function EC(t,e){var r=/\/{2,9}/g,n=e.replace(r,"/").split("/");return(e.substr(0,1)=="/"||e.length===0)&&n.splice(0,1),e.substr(e.length-1,1)=="/"&&n.splice(n.length-1,1),n}function SC(t,e){var r={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,s){i&&(r[i]=s)}),r}function TC(t){r.debug=r,r.default=r,r.coerce=l,r.disable=a,r.enable=s,r.enabled=c,r.humanize=Ua,Object.keys(t).forEach(u=>{r[u]=t[u]}),r.instances=[],r.names=[],r.skips=[],r.formatters={};function e(u){let h=0;for(let f=0;f<u.length;f++)h=(h<<5)-h+u.charCodeAt(f),h|=0;return r.colors[Math.abs(h)%r.colors.length]}r.selectColor=e;function r(u){let h;function f(...p){if(!f.enabled)return;const S=f,M=Number(new Date),I=M-(h||M);S.diff=I,S.prev=h,S.curr=M,h=M,p[0]=r.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let k=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(z,v)=>{if(z==="%%")return z;k++;const _=r.formatters[v];if(typeof _=="function"){const A=p[k];z=_.call(S,A),p.splice(k,1),k--}return z}),r.formatArgs.call(S,p);const V=S.log||r.log;V.apply(S,p)}return f.namespace=u,f.enabled=r.enabled(u),f.useColors=r.useColors(),f.color=e(u),f.destroy=n,f.extend=i,typeof r.init=="function"&&r.init(f),r.instances.push(f),f}function n(){const u=r.instances.indexOf(this);return u!==-1?(r.instances.splice(u,1),!0):!1}function i(u,h){const f=r(this.namespace+(typeof h=="undefined"?":":h)+u);return f.log=this.log,f}function s(u){r.save(u),r.names=[],r.skips=[];let h;const f=(typeof u=="string"?u:"").split(/[\s,]+/),p=f.length;for(h=0;h<p;h++){if(!f[h])continue;u=f[h].replace(/\*/g,".*?"),u[0]==="-"?r.skips.push(new RegExp("^"+u.substr(1)+"$")):r.names.push(new RegExp("^"+u+"$"))}for(h=0;h<r.instances.length;h++){const S=r.instances[h];S.enabled=r.enabled(S.namespace)}}function a(){const u=[...r.names.map(o),...r.skips.map(o).map(h=>"-"+h)].join(",");return r.enable(""),u}function c(u){if(u[u.length-1]==="*")return!0;let h,f;for(h=0,f=r.skips.length;h<f;h++)if(r.skips[h].test(u))return!1;for(h=0,f=r.names.length;h<f;h++)if(r.names[h].test(u))return!0;return!1}function o(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack||u.message:u}return r.enable(r.load()),r}var AC=TC,$o=te(function(t,e){e.log=i,e.formatArgs=n,e.save=s,e.load=a,e.useColors=r,e.storage=c(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let h=0,f=0;l[0].replace(/%[a-zA-Z%]/g,p=>{if(p==="%%")return;h++,p==="%c"&&(f=h)}),l.splice(f,0,u)}function i(...l){return typeof console=="object"&&console.log&&console.log(...l)}function s(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch(u){}}function a(){let l;try{l=e.storage.getItem("debug")}catch(u){}return!l&&typeof fe!="undefined"&&"env"in fe&&(l=fe.env.DEBUG),l}function c(){try{return localStorage}catch(l){}}t.exports=AC(e);const{formatters:o}=t.exports;o.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}}),CC=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.url=void 0;const r=$o("socket.io-client:url");function n(i,s){let a=i;s=s||typeof location!="undefined"&&location,i==null&&(i=s.protocol+"//"+s.host),typeof i=="string"&&(i.charAt(0)==="/"&&(i.charAt(1)==="/"?i=s.protocol+i:i=s.host+i),/^(https?|wss?):\/\//.test(i)||(r("protocol-less url %s",i),typeof s!="undefined"?i=s.protocol+"//"+i:i="https://"+i),r("parse %s",i),a=uu(i)),a.port||(/^(http|ws)$/.test(a.protocol)?a.port="80":/^(http|ws)s$/.test(a.protocol)&&(a.port="443")),a.path=a.path||"/";const c=a.host.indexOf(":")!==-1,o=c?"["+a.host+"]":a.host;return a.id=a.protocol+"://"+o+":"+a.port,a.href=a.protocol+"://"+o+(s&&s.port===a.port?"":":"+a.port),a}e.url=n}),IC=te(function(t){try{t.exports=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}}),fs=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())(),du=function(t){const e=t.xdomain,r=t.xscheme,n=t.enablesXDR;try{if(typeof XMLHttpRequest!="undefined"&&(!e||IC))return new XMLHttpRequest}catch(i){}try{if(typeof XDomainRequest!="undefined"&&!r&&n)return new XDomainRequest}catch(i){}if(!e)try{return new fs[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(i){}};const Fr=Object.create(null);Fr.open="0",Fr.close="1",Fr.ping="2",Fr.pong="3",Fr.message="4",Fr.upgrade="5",Fr.noop="6";const om=Object.create(null);Object.keys(Fr).forEach(t=>{om[Fr[t]]=t});const RC={type:"error",data:"parser error"};var cm={PACKET_TYPES:Fr,PACKET_TYPES_REVERSE:om,ERROR_PACKET:RC};const{PACKET_TYPES:kC}=cm,PC=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",NC=typeof ArrayBuffer=="function",OC=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,MC=({type:t,data:e},r,n)=>PC&&e instanceof Blob?r?n(e):lm(e,n):NC&&(e instanceof ArrayBuffer||OC(e))?r?n(e instanceof ArrayBuffer?e:e.buffer):lm(new Blob([e]),n):n(kC[t]+(e||"")),lm=(t,e)=>{const r=new FileReader;return r.onload=function(){const n=r.result.split(",")[1];e("b"+n)},r.readAsDataURL(t)};var um=MC,DC=te(function(t,e){(function(r){e.encode=function(n){var i=new Uint8Array(n),s,a=i.length,c="";for(s=0;s<a;s+=3)c+=r[i[s]>>2],c+=r[(i[s]&3)<<4|i[s+1]>>4],c+=r[(i[s+1]&15)<<2|i[s+2]>>6],c+=r[i[s+2]&63];return a%3===2?c=c.substring(0,c.length-1)+"=":a%3===1&&(c=c.substring(0,c.length-2)+"=="),c},e.decode=function(n){var i=n.length*.75,s=n.length,a,c=0,o,l,u,h;n[n.length-1]==="="&&(i--,n[n.length-2]==="="&&i--);var f=new ArrayBuffer(i),p=new Uint8Array(f);for(a=0;a<s;a+=4)o=r.indexOf(n[a]),l=r.indexOf(n[a+1]),u=r.indexOf(n[a+2]),h=r.indexOf(n[a+3]),p[c++]=o<<2|l>>4,p[c++]=(l&15)<<4|u>>2,p[c++]=(u&3)<<6|h&63;return f}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")});const{PACKET_TYPES_REVERSE:hu,ERROR_PACKET:xC}=cm,jC=typeof ArrayBuffer=="function";let pu;jC&&(pu=DC);const LC=(t,e)=>{if(typeof t!="string")return{type:"message",data:dm(t,e)};const r=t.charAt(0);if(r==="b")return{type:"message",data:BC(t.substring(1),e)};const n=hu[r];return n?t.length>1?{type:hu[r],data:t.substring(1)}:{type:hu[r]}:xC},BC=(t,e)=>{if(pu){const r=pu.decode(t);return dm(r,e)}else return{base64:!0,data:t}},dm=(t,e)=>{switch(e){case"blob":return t instanceof ArrayBuffer?new Blob([t]):t;case"arraybuffer":default:return t}};var hm=LC;const pm=String.fromCharCode(30),UC=(t,e)=>{const r=t.length,n=new Array(r);let i=0;t.forEach((s,a)=>{um(s,!1,c=>{n[a]=c,++i===r&&e(n.join(pm))})})},FC=(t,e)=>{const r=t.split(pm),n=[];for(let i=0;i<r.length;i++){const s=hm(r[i],e);if(n.push(s),s.type==="error")break}return n};var bi={protocol:4,encodePacket:um,encodePayload:UC,decodePacket:hm,decodePayload:FC},ms=te(function(t){t.exports=e;function e(n){if(n)return r(n)}function r(n){for(var i in e.prototype)n[i]=e.prototype[i];return n}e.prototype.on=e.prototype.addEventListener=function(n,i){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(i),this},e.prototype.once=function(n,i){function s(){this.off(n,s),i.apply(this,arguments)}return s.fn=i,this.on(n,s),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(n,i){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var s=this._callbacks["$"+n];if(!s)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var a,c=0;c<s.length;c++)if(a=s[c],a===i||a.fn===i){s.splice(c,1);break}return s.length===0&&delete this._callbacks["$"+n],this},e.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var i=new Array(arguments.length-1),s=this._callbacks["$"+n],a=1;a<arguments.length;a++)i[a-1]=arguments[a];if(s){s=s.slice(0);for(var a=0,c=s.length;a<c;++a)s[a].apply(this,i)}return this},e.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]},e.prototype.hasListeners=function(n){return!!this.listeners(n).length}});class $C extends ms{constructor(t){super();this.opts=t,this.query=t.query,this.readyState="",this.socket=t.socket}onError(t,e){const r=new Error(t);return r.type="TransportError",r.description=e,this.emit("error",r),this}open(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){if(this.readyState==="open")this.write(t);else throw new Error("Transport not open")}onOpen(){this.readyState="open",this.writable=!0,this.emit("open")}onData(t){const e=bi.decodePacket(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){this.emit("packet",t)}onClose(){this.readyState="closed",this.emit("close")}}var qo=$C,qC=function(t){var e="";for(var r in t)t.hasOwnProperty(r)&&(e.length&&(e+="&"),e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e},VC=function(t){for(var e={},r=t.split("&"),n=0,i=r.length;n<i;n++){var s=r[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e},fu={encode:qC,decode:VC},fm="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Vo=64,mm={},gm=0,xn=0,bm;function mu(t){var e="";do e=fm[t%Vo]+e,t=Math.floor(t/Vo);while(t>0);return e}function GC(t){var e=0;for(xn=0;xn<t.length;xn++)e=e*Vo+mm[t.charAt(xn)];return e}function gu(){var t=mu(+new Date);return t!==bm?(gm=0,bm=t):t+"."+mu(gm++)}for(;xn<Vo;xn++)mm[fm[xn]]=xn;gu.encode=mu,gu.decode=GC;var ym=gu;function zC(t){r.debug=r,r.default=r,r.coerce=l,r.disable=a,r.enable=s,r.enabled=c,r.humanize=Ua,Object.keys(t).forEach(u=>{r[u]=t[u]}),r.instances=[],r.names=[],r.skips=[],r.formatters={};function e(u){let h=0;for(let f=0;f<u.length;f++)h=(h<<5)-h+u.charCodeAt(f),h|=0;return r.colors[Math.abs(h)%r.colors.length]}r.selectColor=e;function r(u){let h;function f(...p){if(!f.enabled)return;const S=f,M=Number(new Date),I=M-(h||M);S.diff=I,S.prev=h,S.curr=M,h=M,p[0]=r.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let k=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(z,v)=>{if(z==="%%")return z;k++;const _=r.formatters[v];if(typeof _=="function"){const A=p[k];z=_.call(S,A),p.splice(k,1),k--}return z}),r.formatArgs.call(S,p);const V=S.log||r.log;V.apply(S,p)}return f.namespace=u,f.enabled=r.enabled(u),f.useColors=r.useColors(),f.color=e(u),f.destroy=n,f.extend=i,typeof r.init=="function"&&r.init(f),r.instances.push(f),f}function n(){const u=r.instances.indexOf(this);return u!==-1?(r.instances.splice(u,1),!0):!1}function i(u,h){const f=r(this.namespace+(typeof h=="undefined"?":":h)+u);return f.log=this.log,f}function s(u){r.save(u),r.names=[],r.skips=[];let h;const f=(typeof u=="string"?u:"").split(/[\s,]+/),p=f.length;for(h=0;h<p;h++){if(!f[h])continue;u=f[h].replace(/\*/g,".*?"),u[0]==="-"?r.skips.push(new RegExp("^"+u.substr(1)+"$")):r.names.push(new RegExp("^"+u+"$"))}for(h=0;h<r.instances.length;h++){const S=r.instances[h];S.enabled=r.enabled(S.namespace)}}function a(){const u=[...r.names.map(o),...r.skips.map(o).map(h=>"-"+h)].join(",");return r.enable(""),u}function c(u){if(u[u.length-1]==="*")return!0;let h,f;for(h=0,f=r.skips.length;h<f;h++)if(r.skips[h].test(u))return!1;for(h=0,f=r.names.length;h<f;h++)if(r.names[h].test(u))return!0;return!1}function o(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack||u.message:u}return r.enable(r.load()),r}var HC=zC,Go=te(function(t,e){e.log=i,e.formatArgs=n,e.save=s,e.load=a,e.useColors=r,e.storage=c(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let h=0,f=0;l[0].replace(/%[a-zA-Z%]/g,p=>{if(p==="%%")return;h++,p==="%c"&&(f=h)}),l.splice(f,0,u)}function i(...l){return typeof console=="object"&&console.log&&console.log(...l)}function s(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch(u){}}function a(){let l;try{l=e.storage.getItem("debug")}catch(u){}return!l&&typeof fe!="undefined"&&"env"in fe&&(l=fe.env.DEBUG),l}function c(){try{return localStorage}catch(l){}}t.exports=HC(e);const{formatters:o}=t.exports;o.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}});const Cr=Go("engine.io-client:polling");class WC extends qo{get name(){return"polling"}doOpen(){this.poll()}pause(t){const e=this;this.readyState="pausing";function r(){Cr("paused"),e.readyState="paused",t()}if(this.polling||!this.writable){let n=0;this.polling&&(Cr("we are currently polling - waiting to pause"),n++,this.once("pollComplete",function(){Cr("pre-pause polling complete"),--n||r()})),this.writable||(Cr("we are currently writing - waiting to pause"),n++,this.once("drain",function(){Cr("pre-pause writing complete"),--n||r()}))}else r()}poll(){Cr("polling"),this.polling=!0,this.doPoll(),this.emit("poll")}onData(t){const e=this;Cr("polling got data %s",t);const r=function(n,i,s){if(e.readyState==="opening"&&n.type==="open"&&e.onOpen(),n.type==="close")return e.onClose(),!1;e.onPacket(n)};bi.decodePayload(t,this.socket.binaryType).forEach(r),this.readyState!=="closed"&&(this.polling=!1,this.emit("pollComplete"),this.readyState==="open"?this.poll():Cr('ignoring poll - transport state "%s"',this.readyState))}doClose(){const t=this;function e(){Cr("writing close packet"),t.write([{type:"close"}])}this.readyState==="open"?(Cr("transport open - closing"),e()):(Cr("transport not open - deferring close"),this.once("open",e))}write(t){this.writable=!1,bi.encodePayload(t,e=>{this.doWrite(e,()=>{this.writable=!0,this.emit("drain")})})}uri(){let t=this.query||{};const e=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=ym()),!this.supportsBinary&&!t.sid&&(t.b64=1),t=fu.encode(t),this.opts.port&&(e==="https"&&Number(this.opts.port)!==443||e==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),t.length&&(t="?"+t);const n=this.opts.hostname.indexOf(":")!==-1;return e+"://"+(n?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+t}}var vm=WC,KC=(t,...e)=>e.reduce((r,n)=>(r[n]=t[n],r),{}),wm={pick:KC};const{pick:XC}=wm,bu=Go("engine.io-client:polling-xhr");function _m(){}const QC=function(){const t=new du({xdomain:!1});return t.responseType!=null}();class YC extends vm{constructor(t){super(t);if(typeof location!="undefined"){const r=location.protocol==="https:";let n=location.port;n||(n=r?443:80),this.xd=typeof location!="undefined"&&t.hostname!==location.hostname||n!==t.port,this.xs=t.secure!==r}const e=t&&t.forceBase64;this.supportsBinary=QC&&!e}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new $r(this.uri(),t)}doWrite(t,e){const r=this.request({method:"POST",data:t}),n=this;r.on("success",e),r.on("error",function(i){n.onError("xhr post error",i)})}doPoll(){bu("xhr poll");const t=this.request(),e=this;t.on("data",function(r){e.onData(r)}),t.on("error",function(r){e.onError("xhr poll error",r)}),this.pollXhr=t}}class $r extends ms{constructor(t,e){super();this.opts=e,this.method=e.method||"GET",this.uri=t,this.async=e.async!==!1,this.data=e.data!==void 0?e.data:null,this.create()}create(){const t=XC(this.opts,"agent","enablesXDR","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const e=this.xhr=new du(t),r=this;try{bu("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(let n in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&e.setRequestHeader(n,this.opts.extraHeaders[n])}}catch(n){}if(this.method==="POST")try{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(n){}try{e.setRequestHeader("Accept","*/*")}catch(n){}"withCredentials"in e&&(e.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(e.timeout=this.opts.requestTimeout),this.hasXDR()?(e.onload=function(){r.onLoad()},e.onerror=function(){r.onError(e.responseText)}):e.onreadystatechange=function(){if(e.readyState!==4)return;e.status===200||e.status===1223?r.onLoad():setTimeout(function(){r.onError(typeof e.status=="number"?e.status:0)},0)},bu("xhr data %s",this.data),e.send(this.data)}catch(n){setTimeout(function(){r.onError(n)},0);return}typeof document!="undefined"&&(this.index=$r.requestsCount++,$r.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(t){this.emit("data",t),this.onSuccess()}onError(t){this.emit("error",t),this.cleanup(!0)}cleanup(t){if(typeof this.xhr=="undefined"||this.xhr===null)return;if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=_m:this.xhr.onreadystatechange=_m,t)try{this.xhr.abort()}catch(e){}typeof document!="undefined"&&delete $r.requests[this.index],this.xhr=null}onLoad(){const t=this.xhr.responseText;t!==null&&this.onData(t)}hasXDR(){return typeof XDomainRequest!="undefined"&&!this.xs&&this.enablesXDR}abort(){this.cleanup()}}if($r.requestsCount=0,$r.requests={},typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",Em);else if(typeof addEventListener=="function"){const t="onpagehide"in fs?"pagehide":"unload";addEventListener(t,Em,!1)}}function Em(){for(let t in $r.requests)$r.requests.hasOwnProperty(t)&&$r.requests[t].abort()}var Sm=YC,JC=$r;Sm.Request=JC;const ZC=/\n/g,eI=/\\n/g;let zo;function tI(){}class rI extends vm{constructor(t){super(t);this.query=this.query||{},zo||(zo=fs.___eio=fs.___eio||[]),this.index=zo.length;const e=this;zo.push(function(r){e.onData(r)}),this.query.j=this.index,typeof addEventListener=="function"&&addEventListener("beforeunload",function(){e.script&&(e.script.onerror=tI)},!1)}get supportsBinary(){return!1}doClose(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),super.doClose()}doPoll(){const t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(i){t.onError("jsonp poll error",i)};const r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(e,r):(document.head||document.body).appendChild(e),this.script=e;const n=typeof navigator!="undefined"&&/gecko/i.test(navigator.userAgent);n&&setTimeout(function(){const i=document.createElement("iframe");document.body.appendChild(i),document.body.removeChild(i)},100)}doWrite(t,e){const r=this;let n;if(!this.form){const a=document.createElement("form"),c=document.createElement("textarea"),o=this.iframeId="eio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=o,a.method="POST",a.setAttribute("accept-charset","utf-8"),c.name="d",a.appendChild(c),document.body.appendChild(a),this.form=a,this.area=c}this.form.action=this.uri();function i(){s(),e()}function s(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(a){r.onError("jsonp polling iframe removal error",a)}try{const a='<iframe src="javascript:0" name="'+r.iframeId+'">';n=document.createElement(a)}catch(a){n=document.createElement("iframe"),n.name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}s(),t=t.replace(eI,`\\
`),this.area.value=t.replace(ZC,"\\n");try{this.form.submit()}catch(a){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){r.iframe.readyState==="complete"&&i()}:this.iframe.onload=i}}var nI=rI,iI={WebSocket:fs.WebSocket||fs.MozWebSocket,usingBrowserWebSocket:!0,defaultBinaryType:"arraybuffer"};const{pick:sI}=wm,{WebSocket:Pa,usingBrowserWebSocket:yu,defaultBinaryType:aI}=iI,oI=Go("engine.io-client:websocket"),Tm=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Am extends qo{constructor(t){super(t);this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,r=Tm?{}:sI(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=yu&&!Tm?e?new Pa(t,e):new Pa(t):new Pa(t,e,r)}catch(n){return this.emit("error",n)}this.ws.binaryType=this.socket.binaryType||aI,this.addEventListeners()}addEventListeners(){const t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}}write(t){const e=this;this.writable=!1;let r=t.length,n=0;const i=r;for(;n<i;n++)(function(a){bi.encodePacket(a,e.supportsBinary,function(c){const o={};if(!yu&&(a.options&&(o.compress=a.options.compress),e.opts.perMessageDeflate)){const l=typeof c=="string"?Buffer.byteLength(c):c.length;l<e.opts.perMessageDeflate.threshold&&(o.compress=!1)}try{yu?e.ws.send(c):e.ws.send(c,o)}catch(l){oI("websocket closed before onclose event")}--r||s()})})(t[n]);function s(){e.emit("flush"),setTimeout(function(){e.writable=!0,e.emit("drain")},0)}}onClose(){qo.prototype.onClose.call(this)}doClose(){typeof this.ws!="undefined"&&this.ws.close()}uri(){let t=this.query||{};const e=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(e==="wss"&&Number(this.opts.port)!==443||e==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=ym()),this.supportsBinary||(t.b64=1),t=fu.encode(t),t.length&&(t="?"+t);const n=this.opts.hostname.indexOf(":")!==-1;return e+"://"+(n?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+t}check(){return!!Pa&&!("__initialize"in Pa&&this.name===Am.prototype.name)}}var cI=Am,lI=dI,uI=cI;function dI(t){let e,r=!1,n=!1;const i=t.jsonp!==!1;if(typeof location!="undefined"){const s=location.protocol==="https:";let a=location.port;a||(a=s?443:80),r=t.hostname!==location.hostname||a!==t.port,n=t.secure!==s}if(t.xdomain=r,t.xscheme=n,e=new du(t),"open"in e&&!t.forceJSONP)return new Sm(t);if(!i)throw new Error("JSONP disabled");return new nI(t)}var Cm={polling:lI,websocket:uI};const Xe=Go("engine.io-client:socket");class jn extends ms{constructor(t,e={}){super();t&&typeof t=="object"&&(e=t,t=null),t?(t=uu(t),e.hostname=t.host,e.secure=t.protocol==="https"||t.protocol==="wss",e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=uu(e.host).host),this.secure=e.secure!=null?e.secure:typeof location!="undefined"&&location.protocol==="https:",e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=e.port||(typeof location!="undefined"&&location.port?location.port:this.secure?443:80),this.transports=e.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,jsonp:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{}},e),this.opts.path=this.opts.path.replace(/\/$/,"")+"/",typeof this.opts.query=="string"&&(this.opts.query=fu.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,this.open()}createTransport(t){Xe('creating transport "%s"',t);const e=hI(this.opts.query);e.EIO=bi.protocol,e.transport=t,this.id&&(e.sid=this.id);const r=Object.assign({},this.opts.transportOptions[t],this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return Xe("options: %j",r),new Cm[t](r)}open(){let t;if(this.opts.rememberUpgrade&&jn.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else if(this.transports.length===0){const e=this;setTimeout(function(){e.emit("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch(e){Xe("error while creating transport: %s",e),this.transports.shift(),this.open();return}t.open(),this.setTransport(t)}setTransport(t){Xe("setting transport %s",t.name);const e=this;this.transport&&(Xe("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.onDrain()}).on("packet",function(r){e.onPacket(r)}).on("error",function(r){e.onError(r)}).on("close",function(){e.onClose("transport close")})}probe(t){Xe('probing transport "%s"',t);let e=this.createTransport(t,{probe:1}),r=!1;const n=this;jn.priorWebsocketSuccess=!1;function i(){if(n.onlyBinaryUpgrades){const h=!this.supportsBinary&&n.transport.supportsBinary;r=r||h}if(r)return;Xe('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",function(h){if(r)return;if(h.type==="pong"&&h.data==="probe"){if(Xe('probe transport "%s" pong',t),n.upgrading=!0,n.emit("upgrading",e),!e)return;jn.priorWebsocketSuccess=e.name==="websocket",Xe('pausing current transport "%s"',n.transport.name),n.transport.pause(function(){if(r)return;if(n.readyState==="closed")return;Xe("changing transport and sending upgrade packet"),u(),n.setTransport(e),e.send([{type:"upgrade"}]),n.emit("upgrade",e),e=null,n.upgrading=!1,n.flush()})}else{Xe('probe transport "%s" failed',t);const f=new Error("probe error");f.transport=e.name,n.emit("upgradeError",f)}})}function s(){if(r)return;r=!0,u(),e.close(),e=null}function a(h){const f=new Error("probe error: "+h);f.transport=e.name,s(),Xe('probe transport "%s" failed because of error: %s',t,h),n.emit("upgradeError",f)}function c(){a("transport closed")}function o(){a("socket closed")}function l(h){e&&h.name!==e.name&&(Xe('"%s" works - aborting "%s"',h.name,e.name),s())}function u(){e.removeListener("open",i),e.removeListener("error",a),e.removeListener("close",c),n.removeListener("close",o),n.removeListener("upgrading",l)}e.once("open",i),e.once("error",a),e.once("close",c),this.once("close",o),this.once("upgrading",l),e.open()}onOpen(){if(Xe("socket open"),this.readyState="open",jn.priorWebsocketSuccess=this.transport.name==="websocket",this.emit("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade&&this.transport.pause){Xe("starting upgrade probes");let t=0;const e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){Xe('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat");switch(t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emit("pong");break;case"error":const e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data);break}}else Xe('packet received with socket readyState "%s"',this.readyState)}onHandshake(t){if(this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),this.readyState==="closed")return;this.resetPingTimeout()}resetPingTimeout(){clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=setTimeout(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout)}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emit("drain"):this.flush()}flush(){this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(Xe("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))}write(t,e,r){return this.sendPacket("message",t,e,r),this}send(t,e,r){return this.sendPacket("message",t,e,r),this}sendPacket(t,e,r,n){if(typeof e=="function"&&(n=e,e=void 0),typeof r=="function"&&(n=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const i={type:t,data:e,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){const t=this;(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():e()}):this.upgrading?n():e());function e(){t.onClose("forced close"),Xe("socket closing - telling transport to close"),t.transport.close()}function r(){t.removeListener("upgrade",r),t.removeListener("upgradeError",r),e()}function n(){t.once("upgrade",r),t.once("upgradeError",r)}return this}onError(t){Xe("socket error %j",t),jn.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)}onClose(t,e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){Xe('socket close with reason: "%s"',t);const r=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),r.writeBuffer=[],r.prevBufferLen=0}}filterUpgrades(t){const e=[];let r=0;const n=t.length;for(;r<n;r++)~this.transports.indexOf(t[r])&&e.push(t[r]);return e}}jn.priorWebsocketSuccess=!1,jn.protocol=bi.protocol;function hI(t){const e={};for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}var vu=jn,gs=(t,e)=>new vu(t,e),pI=vu,fI=vu.protocol,mI=qo,gI=Cm,bI=bi;gs.Socket=pI,gs.protocol=fI,gs.Transport=mI,gs.transports=gI,gs.parser=bI;var wu=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.hasBinary=e.isBinary=void 0;const r=typeof ArrayBuffer=="function",n=l=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(l):l.buffer instanceof ArrayBuffer,i=Object.prototype.toString,s=typeof Blob=="function"||typeof Blob!="undefined"&&i.call(Blob)==="[object BlobConstructor]",a=typeof File=="function"||typeof File!="undefined"&&i.call(File)==="[object FileConstructor]";function c(l){return r&&(l instanceof ArrayBuffer||n(l))||s&&l instanceof Blob||a&&l instanceof File}e.isBinary=c;function o(l,u){if(!l||typeof l!="object")return!1;if(Array.isArray(l)){for(let h=0,f=l.length;h<f;h++)if(o(l[h]))return!0;return!1}if(c(l))return!0;if(l.toJSON&&typeof l.toJSON=="function"&&arguments.length===1)return o(l.toJSON(),!0);for(const h in l)if(Object.prototype.hasOwnProperty.call(l,h)&&o(l[h]))return!0;return!1}e.hasBinary=o}),Im=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.reconstructPacket=e.deconstructPacket=void 0;function r(a){const c=[],o=a.data,l=a;return l.data=n(o,c),l.attachments=c.length,{packet:l,buffers:c}}e.deconstructPacket=r;function n(a,c){if(!a)return a;if(wu.isBinary(a)){const o={_placeholder:!0,num:c.length};return c.push(a),o}else if(Array.isArray(a)){const o=new Array(a.length);for(let l=0;l<a.length;l++)o[l]=n(a[l],c);return o}else if(typeof a=="object"&&!(a instanceof Date)){const o={};for(const l in a)a.hasOwnProperty(l)&&(o[l]=n(a[l],c));return o}return a}function i(a,c){return a.data=s(a.data,c),a.attachments=void 0,a}e.reconstructPacket=i;function s(a,c){if(!a)return a;if(a&&a._placeholder)return c[a.num];if(Array.isArray(a))for(let o=0;o<a.length;o++)a[o]=s(a[o],c);else if(typeof a=="object")for(const o in a)a.hasOwnProperty(o)&&(a[o]=s(a[o],c));return a}});function yI(t){r.debug=r,r.default=r,r.coerce=l,r.disable=a,r.enable=s,r.enabled=c,r.humanize=Ua,Object.keys(t).forEach(u=>{r[u]=t[u]}),r.instances=[],r.names=[],r.skips=[],r.formatters={};function e(u){let h=0;for(let f=0;f<u.length;f++)h=(h<<5)-h+u.charCodeAt(f),h|=0;return r.colors[Math.abs(h)%r.colors.length]}r.selectColor=e;function r(u){let h;function f(...p){if(!f.enabled)return;const S=f,M=Number(new Date),I=M-(h||M);S.diff=I,S.prev=h,S.curr=M,h=M,p[0]=r.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let k=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(z,v)=>{if(z==="%%")return z;k++;const _=r.formatters[v];if(typeof _=="function"){const A=p[k];z=_.call(S,A),p.splice(k,1),k--}return z}),r.formatArgs.call(S,p);const V=S.log||r.log;V.apply(S,p)}return f.namespace=u,f.enabled=r.enabled(u),f.useColors=r.useColors(),f.color=e(u),f.destroy=n,f.extend=i,typeof r.init=="function"&&r.init(f),r.instances.push(f),f}function n(){const u=r.instances.indexOf(this);return u!==-1?(r.instances.splice(u,1),!0):!1}function i(u,h){const f=r(this.namespace+(typeof h=="undefined"?":":h)+u);return f.log=this.log,f}function s(u){r.save(u),r.names=[],r.skips=[];let h;const f=(typeof u=="string"?u:"").split(/[\s,]+/),p=f.length;for(h=0;h<p;h++){if(!f[h])continue;u=f[h].replace(/\*/g,".*?"),u[0]==="-"?r.skips.push(new RegExp("^"+u.substr(1)+"$")):r.names.push(new RegExp("^"+u+"$"))}for(h=0;h<r.instances.length;h++){const S=r.instances[h];S.enabled=r.enabled(S.namespace)}}function a(){const u=[...r.names.map(o),...r.skips.map(o).map(h=>"-"+h)].join(",");return r.enable(""),u}function c(u){if(u[u.length-1]==="*")return!0;let h,f;for(h=0,f=r.skips.length;h<f;h++)if(r.skips[h].test(u))return!1;for(h=0,f=r.names.length;h<f;h++)if(r.names[h].test(u))return!0;return!1}function o(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack||u.message:u}return r.enable(r.load()),r}var vI=yI,wI=te(function(t,e){e.log=i,e.formatArgs=n,e.save=s,e.load=a,e.useColors=r,e.storage=c(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let h=0,f=0;l[0].replace(/%[a-zA-Z%]/g,p=>{if(p==="%%")return;h++,p==="%c"&&(f=h)}),l.splice(f,0,u)}function i(...l){return typeof console=="object"&&console.log&&console.log(...l)}function s(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch(u){}}function a(){let l;try{l=e.storage.getItem("debug")}catch(u){}return!l&&typeof fe!="undefined"&&"env"in fe&&(l=fe.env.DEBUG),l}function c(){try{return localStorage}catch(l){}}t.exports=vI(e);const{formatters:o}=t.exports;o.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}}),Ft=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Decoder=e.Encoder=e.PacketType=e.protocol=void 0;const r=wI("socket.io-parser");e.protocol=5;var n;(function(o){o[o.CONNECT=0]="CONNECT",o[o.DISCONNECT=1]="DISCONNECT",o[o.EVENT=2]="EVENT",o[o.ACK=3]="ACK",o[o.CONNECT_ERROR=4]="CONNECT_ERROR",o[o.BINARY_EVENT=5]="BINARY_EVENT",o[o.BINARY_ACK=6]="BINARY_ACK"})(n=e.PacketType||(e.PacketType={}));class i{encode(o){return r("encoding packet %j",o),(o.type===n.EVENT||o.type===n.ACK)&&wu.hasBinary(o)?(o.type=o.type===n.EVENT?n.BINARY_EVENT:n.BINARY_ACK,this.encodeAsBinary(o)):[this.encodeAsString(o)]}encodeAsString(o){let l=""+o.type;return(o.type===n.BINARY_EVENT||o.type===n.BINARY_ACK)&&(l+=o.attachments+"-"),o.nsp&&o.nsp!=="/"&&(l+=o.nsp+","),o.id!=null&&(l+=o.id),o.data!=null&&(l+=JSON.stringify(o.data)),r("encoded %j as %s",o,l),l}encodeAsBinary(o){const l=Im.deconstructPacket(o),u=this.encodeAsString(l.packet),h=l.buffers;return h.unshift(u),h}}e.Encoder=i;class s extends ms{constructor(){super()}add(o){let l;if(typeof o=="string")l=this.decodeString(o),l.type===n.BINARY_EVENT||l.type===n.BINARY_ACK?(this.reconstructor=new c(l),l.attachments===0&&super.emit("decoded",l)):super.emit("decoded",l);else if(wu.isBinary(o)||o.base64)if(this.reconstructor)l=this.reconstructor.takeBinaryData(o),l&&(this.reconstructor=null,super.emit("decoded",l));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+o)}decodeString(o){let l=0;const u={type:Number(o.charAt(0))};if(n[u.type]===void 0)throw new Error("unknown packet type "+u.type);if(u.type===n.BINARY_EVENT||u.type===n.BINARY_ACK){const f=l+1;for(;o.charAt(++l)!=="-"&&l!=o.length;);const p=o.substring(f,l);if(p!=Number(p)||o.charAt(l)!=="-")throw new Error("Illegal attachments");u.attachments=Number(p)}if(o.charAt(l+1)==="/"){const f=l+1;for(;++l;){const p=o.charAt(l);if(p===",")break;if(l===o.length)break}u.nsp=o.substring(f,l)}else u.nsp="/";const h=o.charAt(l+1);if(h!==""&&Number(h)==h){const f=l+1;for(;++l;){const p=o.charAt(l);if(p==null||Number(p)!=p){--l;break}if(l===o.length)break}u.id=Number(o.substring(f,l+1))}if(o.charAt(++l)){const f=a(o.substr(l));if(s.isPayloadValid(u.type,f))u.data=f;else throw new Error("invalid payload")}return r("decoded %s as %j",o,u),u}static isPayloadValid(o,l){switch(o){case n.CONNECT:return typeof l=="object";case n.DISCONNECT:return l===void 0;case n.CONNECT_ERROR:return typeof l=="string"||typeof l=="object";case n.EVENT:case n.BINARY_EVENT:return Array.isArray(l)&&typeof l[0]=="string";case n.ACK:case n.BINARY_ACK:return Array.isArray(l)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}e.Decoder=s;function a(o){try{return JSON.parse(o)}catch(l){return!1}}class c{constructor(o){this.packet=o,this.buffers=[],this.reconPack=o}takeBinaryData(o){if(this.buffers.push(o),this.buffers.length===this.reconPack.attachments){const l=Im.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),l}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}}),qr=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.on=void 0;function r(n,i,s){return n.on(i,s),{destroy:function(){n.off(i,s)}}}e.on=r}),Rm=[].slice,Ln=function(t,e){if(typeof e=="string"&&(e=t[e]),typeof e!="function")throw new Error("bind() requires a function");var r=Rm.call(arguments,2);return function(){return e.apply(t,r.concat(Rm.call(arguments)))}},km=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Socket=void 0;const r=$o("socket.io-client:socket"),n=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class i extends ms{constructor(s,a,c){super();this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.flags={},this.io=s,this.nsp=a,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},c&&c.auth&&(this.auth=c.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;const s=this.io;this.subs=[qr.on(s,"open",Ln(this,"onopen")),qr.on(s,"packet",Ln(this,"onpacket")),qr.on(s,"close",Ln(this,"onclose"))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...s){return s.unshift("message"),this.emit.apply(this,s),this}emit(s,...a){if(n.hasOwnProperty(s))throw new Error('"'+s+'" is a reserved event name');a.unshift(s);const c={type:Ft.PacketType.EVENT,data:a};c.options={},c.options.compress=this.flags.compress!==!1,typeof a[a.length-1]=="function"&&(r("emitting packet with ack id %d",this.ids),this.acks[this.ids]=a.pop(),c.id=this.ids++);const o=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable,l=this.flags.volatile&&(!o||!this.connected);return l?r("discard packet as the transport is not currently writable"):this.connected?this.packet(c):this.sendBuffer.push(c),this.flags={},this}packet(s){s.nsp=this.nsp,this.io._packet(s)}onopen(){r("transport is open - connecting"),typeof this.auth=="function"?this.auth(s=>{this.packet({type:Ft.PacketType.CONNECT,data:s})}):this.packet({type:Ft.PacketType.CONNECT,data:this.auth})}onclose(s){r("close (%s)",s),this.connected=!1,this.disconnected=!0,delete this.id,super.emit("disconnect",s)}onpacket(s){const a=s.nsp===this.nsp;if(!a)return;switch(s.type){case Ft.PacketType.CONNECT:if(s.data&&s.data.sid){const o=s.data.sid;this.onconnect(o)}else super.emit("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Ft.PacketType.EVENT:this.onevent(s);break;case Ft.PacketType.BINARY_EVENT:this.onevent(s);break;case Ft.PacketType.ACK:this.onack(s);break;case Ft.PacketType.BINARY_ACK:this.onack(s);break;case Ft.PacketType.DISCONNECT:this.ondisconnect();break;case Ft.PacketType.CONNECT_ERROR:const c=new Error(s.data.message);c.data=s.data.data,super.emit("connect_error",c);break}}onevent(s){const a=s.data||[];r("emitting event %j",a),s.id!=null&&(r("attaching ack callback to event"),a.push(this.ack(s.id))),this.connected?this.emitEvent(a):this.receiveBuffer.push(Object.freeze(a))}emitEvent(s){if(this._anyListeners&&this._anyListeners.length){const a=this._anyListeners.slice();for(const c of a)c.apply(this,s)}super.emit.apply(this,s)}ack(s){const a=this;let c=!1;return function(...o){if(c)return;c=!0,r("sending ack %j",o),a.packet({type:Ft.PacketType.ACK,id:s,data:o})}}onack(s){const a=this.acks[s.id];typeof a=="function"?(r("calling ack %s with %j",s.id,s.data),a.apply(this,s.data),delete this.acks[s.id]):r("bad ack %s",s.id)}onconnect(s){r("socket connected with id %s",s),this.id=s,this.connected=!0,this.disconnected=!1,super.emit("connect"),this.emitBuffered()}emitBuffered(){this.receiveBuffer.forEach(s=>this.emitEvent(s)),this.receiveBuffer=[],this.sendBuffer.forEach(s=>this.packet(s)),this.sendBuffer=[]}ondisconnect(){r("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){if(this.subs){for(let s=0;s<this.subs.length;s++)this.subs[s].destroy();this.subs=null}this.io._destroy(this)}disconnect(){return this.connected&&(r("performing disconnect (%s)",this.nsp),this.packet({type:Ft.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(s){return this.flags.compress=s,this}get volatile(){return this.flags.volatile=!0,this}onAny(s){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(s),this}prependAny(s){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(s),this}offAny(s){if(!this._anyListeners)return this;if(s){const a=this._anyListeners;for(let c=0;c<a.length;c++)if(s===a[c])return a.splice(c,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}e.Socket=i}),_I=bs;function bs(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}bs.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),r=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-r:t+r}return Math.min(t,this.max)|0},bs.prototype.reset=function(){this.attempts=0},bs.prototype.setMin=function(t){this.ms=t},bs.prototype.setMax=function(t){this.max=t},bs.prototype.setJitter=function(t){this.jitter=t};var _u=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Manager=void 0;const r=$o("socket.io-client:manager");class n extends ms{constructor(i,s){super();this.nsps={},this.subs=[],i&&typeof i=="object"&&(s=i,i=void 0),s=s||{},s.path=s.path||"/socket.io",this.opts=s,this.reconnection(s.reconnection!==!1),this.reconnectionAttempts(s.reconnectionAttempts||Infinity),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor(s.randomizationFactor||.5),this.backoff=new _I({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(s.timeout==null?2e4:s.timeout),this._readyState="closed",this.uri=i;const a=s.parser||Ft;this.encoder=new a.Encoder,this.decoder=new a.Decoder,this._autoConnect=s.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(i){return arguments.length?(this._reconnection=!!i,this):this._reconnection}reconnectionAttempts(i){return i===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=i,this)}reconnectionDelay(i){var s;return i===void 0?this._reconnectionDelay:(this._reconnectionDelay=i,(s=this.backoff)===null||s===void 0||s.setMin(i),this)}randomizationFactor(i){var s;return i===void 0?this._randomizationFactor:(this._randomizationFactor=i,(s=this.backoff)===null||s===void 0||s.setJitter(i),this)}reconnectionDelayMax(i){var s;return i===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=i,(s=this.backoff)===null||s===void 0||s.setMax(i),this)}timeout(i){return arguments.length?(this._timeout=i,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(i){if(r("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;r("opening %s",this.uri),this.engine=gs(this.uri,this.opts);const s=this.engine,a=this;this._readyState="opening",this.skipReconnect=!1;const c=qr.on(s,"open",function(){a.onopen(),i&&i()}),o=qr.on(s,"error",l=>{r("error"),a.cleanup(),a._readyState="closed",super.emit("error",l),i?i(l):a.maybeReconnectOnOpen()});if(this._timeout!==!1){const l=this._timeout;r("connect attempt will timeout after %d",l),l===0&&c.destroy();const u=setTimeout(()=>{r("connect attempt timed out after %d",l),c.destroy(),s.close(),s.emit("error",new Error("timeout"))},l);this.subs.push({destroy:function(){clearTimeout(u)}})}return this.subs.push(c),this.subs.push(o),this}connect(i){return this.open(i)}onopen(){r("open"),this.cleanup(),this._readyState="open",super.emit("open");const i=this.engine;this.subs.push(qr.on(i,"data",Ln(this,"ondata")),qr.on(i,"ping",Ln(this,"onping")),qr.on(i,"error",Ln(this,"onerror")),qr.on(i,"close",Ln(this,"onclose")),qr.on(this.decoder,"decoded",Ln(this,"ondecoded")))}onping(){super.emit("ping")}ondata(i){this.decoder.add(i)}ondecoded(i){super.emit("packet",i)}onerror(i){r("error",i),super.emit("error",i)}socket(i,s){let a=this.nsps[i];return a||(a=new km.Socket(this,i,s),this.nsps[i]=a),a}_destroy(i){const s=Object.keys(this.nsps);for(const a of s){const c=this.nsps[a];if(c.active){r("socket %s is still active, skipping close",a);return}}this._close()}_packet(i){r("writing packet %j",i),i.query&&i.type===0&&(i.nsp+="?"+i.query);const s=this.encoder.encode(i);for(let a=0;a<s.length;a++)this.engine.write(s[a],i.options)}cleanup(){r("cleanup");const i=this.subs.length;for(let s=0;s<i;s++){const a=this.subs.shift();a.destroy()}this.decoder.destroy()}_close(){r("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this._readyState==="opening"&&this.cleanup(),this.backoff.reset(),this._readyState="closed",this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(i){r("onclose"),this.cleanup(),this.backoff.reset(),this._readyState="closed",super.emit("close",i),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const i=this;if(this.backoff.attempts>=this._reconnectionAttempts)r("reconnect failed"),this.backoff.reset(),super.emit("reconnect_failed"),this._reconnecting=!1;else{const s=this.backoff.duration();r("will wait %dms before reconnect attempt",s),this._reconnecting=!0;const a=setTimeout(()=>{if(i.skipReconnect)return;if(r("attempting reconnect"),super.emit("reconnect_attempt",i.backoff.attempts),i.skipReconnect)return;i.open(c=>{c?(r("reconnect attempt error"),i._reconnecting=!1,i.reconnect(),super.emit("reconnect_error",c)):(r("reconnect success"),i.onreconnect())})},s);this.subs.push({destroy:function(){clearTimeout(a)}})}}onreconnect(){const i=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),super.emit("reconnect",i)}}e.Manager=n}),EI=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Socket=e.io=e.Manager=e.protocol=void 0,Object.defineProperty(e,"Socket",{enumerable:!0,get:function(){return km.Socket}});const r=$o("socket.io-client");t.exports=e=i;const n=e.managers={};function i(a,c){typeof a=="object"&&(c=a,a=void 0),c=c||{};const o=CC.url(a),l=o.source,u=o.id,h=o.path,f=n[u]&&h in n[u].nsps,p=c.forceNew||c["force new connection"]||c.multiplex===!1||f;let S;return p?(r("ignoring socket cache for %s",l),S=new _u.Manager(l,c)):(n[u]||(r("new io instance for %s",l),n[u]=new _u.Manager(l,c)),S=n[u]),o.query&&!c.query&&(c.query=o.query),S.socket(o.path,c)}e.io=i,Object.defineProperty(e,"protocol",{enumerable:!0,get:function(){return Ft.protocol}}),e.connect=i;var s=_u;Object.defineProperty(e,"Manager",{enumerable:!0,get:function(){return s.Manager}})}),Eu=t=>{if(t[Symbol.asyncIterator])return t;if(t.getReader)return async function*(){const e=t.getReader();try{for(;;){const{done:r,value:n}=await e.read();if(r)return;yield n}}finally{e.releaseLock()}}();throw new Error("unknown stream")},Pm=t=>async e=>{e=kc(e);const r=k=>{typeof k.return=="function"&&k.return()};let n=null,i=null;const s=k=>{n=k,i&&i(k),r(e)};let a=null,c=!1;const o=()=>{c=!0,a&&a()};let l=null,u=!1;const h=()=>{u=!0,l&&l()};let f=null;const p=()=>{f&&f()},S=()=>new Promise((k,V)=>{a=f=k,i=V,t.once("drain",p)}),M=()=>(r(e),new Promise((k,V)=>{if(c||u||n)return k();l=a=k,i=V})),I=()=>{t.removeListener("error",s),t.removeListener("close",o),t.removeListener("finish",h),t.removeListener("drain",p)};t.once("error",s),t.once("close",o),t.once("finish",h);try{for await(const k of e){if(!t.writable||t.destroyed||n)break;t.write(k)===!1&&await S()}}catch(k){n||t.destroy(),n=k}try{if(t.writable&&t.end(),await M(),n)throw n}finally{I()}},Nm=t=>({sink:Pm(t),source:Eu(t)}),SI=t=>async function*(e){const r=Nm(t);r.sink(e).catch(n=>{}),yield*r.source},ys=Eu,TI=Eu,AI=Pm,CI=SI,II=Nm;ys.source=TI,ys.sink=AI,ys.transform=CI,ys.duplex=II;const{Address4:RI,Address6:kI}=Il,Ho={ERR_INVALID_IP_PARAMETER:"ERR_INVALID_IP_PARAMETER",ERR_INVALID_PORT_PARAMETER:"ERR_INVALID_PORT_PARAMETER",ERR_INVALID_IP:"ERR_INVALID_IP"};function PI(t,e){if(typeof t!="string")throw U(new Error(`invalid ip provided: ${t}`),Ho.ERR_INVALID_IP_PARAMETER);if(e=parseInt(e),isNaN(e))throw U(new Error(`invalid port provided: ${e}`),Ho.ERR_INVALID_PORT_PARAMETER);if(new RI(t).isValid())return At(`/ip4/${t}/tcp/${e}`);const r=new kI(t);if(r.isValid())return r.is4()?At(`/ip4/${r.to4().correctForm()}/tcp/${e}`):At(`/ip6/${t}/tcp/${e}`);throw U(new Error(`invalid ip:port for creating a multiaddr: ${t}:${e}`),Ho.ERR_INVALID_IP)}var Su=PI,NI=Ho;Su.Errors=NI;const{CLOSE_TIMEOUT:OI}=lu,Wo=Q("libp2p:webrtc-star:socket");Wo.error=Q("libp2p:webrtc-star:socket:error");const Om=(t,e)=>{if(!t||!e)return;try{return Su(t,e)}catch(r){return Wo.error(r),Su("0.0.0.0",e)}};var Mm=(t,e={})=>{const{sink:r,source:n}=ys.duplex(t),i=e.remoteAddr||Om(t.remoteAddress,t.remotePort),s=Om(t.localAddress,t.localPort),a={async sink(c){e.signal&&(c=rt(c,e.signal));try{await r(async function*(){for await(const o of c)yield o instanceof Uint8Array?o:o.slice()}())}catch(o){o.type!=="aborted"&&Wo.error(o)}},source:e.signal?rt(n,e.signal):n,conn:t,localAddr:s,remoteAddr:i,timeline:{open:Date.now()},close(){return t.destroyed?void 0:new Promise((c,o)=>{const l=Date.now(),u=setTimeout(()=>{if(a.remoteAddr){const{host:h,port:f}=a.remoteAddr.toOptions();Wo("timeout closing socket to %s:%s after %dms, destroying it manually",h,f,Date.now()-l)}t.destroyed||t.destroy()},OI);t.once("close",()=>{c()}),t.end(h=>{if(clearTimeout(u),a.timeline.close=Date.now(),h)return o(h)})})}};return t.once("close",()=>{a.timeline.close||(a.timeline.close=Date.now())}),a},Dm=te(function(t,e){function r(i){const s=i.toString().split("/"),a=i.protos()[1].name,c=i.protos()[2].name,o=i.stringTuples()[1][1];if(a!=="tcp"||c!=="ws"&&c!=="wss")throw new Error("invalid multiaddr: "+i.toString());if(!At.isName(i))return"http://"+s[2]+":"+s[4];if(c==="ws")return"http://"+s[2]+(o===80?"":":"+o);if(c==="wss")return"https://"+s[2]+(o===443?"":":"+o)}function n(i){const s="/libp2p-webrtc-star";if(i.indexOf(s)!==-1){i=i.substring(s.length,i.length);let a=At(i);const c=a.stringTuples().filter(o=>o[0]===421)[0];a=a.decapsulate("p2p"),a=a.encapsulate("/p2p-webrtc-star"),a=a.encapsulate(`/p2p/${c[1]}`),i=a.toString()}return i}e=t.exports,e.cleanUrlSIO=r,e.cleanMultiaddr=n});const yi=Q("libp2p:webrtc-star:listener");yi.error=Q("libp2p:webrtc-star:listener:error");const{cleanUrlSIO:MI}=Dm,{CODE_P2P:xm}=lu,DI={transports:["websocket"],"force new connection":!0};var xI=({handler:t,upgrader:e},r,n={})=>{const i=new St;let s;return i.__connections=[],i.__spChannels=new Map,i.__pendingIntents=new Map,i.listen=a=>{const c=to();s=a,!a.protoCodes().includes(xm)&&e.localPeer?r._signallingAddr=a.encapsulate(`/p2p/${e.localPeer.toB58String()}`):r._signallingAddr=a;const o=MI(a);yi("Dialing to Signalling Server on: "+o),i.io=EI.connect(o,DI);const l=u=>{if(u.answer||u.err||!u.intentId)return;const h=u.intentId;let f=i.__pendingIntents.get(h);f||(f=[],i.__pendingIntents.set(h,f));let p=i.__spChannels.get(h);if(p){p.signal(u.signal);return}else if(u.signal.type!=="offer"){f.push(u);return}const S={trickle:!1,...n};r.wrtc&&(S.wrtc=r.wrtc),p=new sm(S);const M=I=>{yi.error("incoming connectioned errored",I)};p.on("error",M),p.once("close",(...I)=>{p.removeListener("error",M)}),p.on("signal",I=>{u.signal=I,u.answer=!0,i.io.emit("ss-handshake",u)}),p.signal(u.signal);for(const I of f)p.signal(I.signal);i.__pendingIntents.set(h,[]),p.once("connect",async()=>{const I=Mm(p);yi("new inbound connection %s",I.remoteAddr);let k;try{k=await e.upgradeInbound(I)}catch(V){return yi.error("inbound connection failed to upgrade",V),I.close()}if(!k.remoteAddr)try{k.remoteAddr=a.decapsulateCode(xm).encapsulate(`/p2p/${k.remotePeer.toB58String()}`)}catch(V){yi.error("could not determine remote address",V)}yi("inbound connection %s upgraded",I.remoteAddr),jI(i,I,h),i.emit("connection",k),t(k)}),i.__spChannels.set(h,p)};return i.io.once("connect_error",u=>c.reject(u)),i.io.once("error",u=>{i.emit("error",u),i.emit("close")}),i.io.on("ws-handshake",l),i.io.on("ws-peer",r._peerDiscovered),i.io.on("connect",()=>{i.io.emit("ss-join",r._signallingAddr.toString())}),i.io.once("connect",()=>{i.emit("listening"),c.resolve()}),c.promise},i.close=async()=>{i.io&&i.io.emit("ss-leave"),await Promise.all(i.__connections.map(a=>a.close())),i.emit("close")},i.getAddrs=()=>[s],r.listenersRefs[At.toString()]=i,i};function jI(t,e,r){t.__connections.push(e);const n=()=>{t.__connections=t.__connections.filter(i=>i!==e),t.__spChannels.delete(r),t.__pendingIntents.delete(r)};e.conn.once("close",n)}const an=Q("libp2p:webrtc-star");an.error=Q("libp2p:webrtc-star:error");const{EventEmitter:LI}=St,{AbortError:jm}=rt,{supportsWebRTCDataChannels:BI}=gC,{CODE_CIRCUIT:UI}=lu,{cleanMultiaddr:FI}=Dm;function $I(){}class qI{constructor(t={}){if(!t.upgrader)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=t.upgrader,this._signallingAddr=void 0,this.sioOptions={transports:["websocket"],"force new connection":!0},t.wrtc&&(this.wrtc=t.wrtc),this.listenersRefs={},this.discovery=new LI,this.discovery.tag="webRTCStar",this.discovery._isStarted=!1,this.discovery.start=()=>{this.discovery._isStarted=!0},this.discovery.stop=()=>{this.discovery._isStarted=!1},this._peerDiscovered=this._peerDiscovered.bind(this)}async dial(t,e={}){const r=await this._connect(t,e),n=Mm(r,{remoteAddr:t,signal:e.signal});an("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return an("outbound connection %s upgraded",n.remoteAddr),i}_connect(t,e={}){if(e.signal&&e.signal.aborted)throw new jm;const r={initiator:!0,trickle:!1,...e.spOptions||{}};this.wrtc&&(r.wrtc=this.wrtc);const n=t.toOptions(),i=(~~(Math.random()*1e9)).toString(36)+Date.now(),s=this.listenersRefs[Object.keys(this.listenersRefs)[0]].io;return new Promise((a,c)=>{const o=Date.now();let l;an("dialing %s:%s",n.host,n.port);const u=new sm(r),h=I=>{if(!l){const k=`connection error ${n.host}:${n.port}: ${I.message}`;an.error(k),M(I)}},f=()=>{an("connnection timeout %s:%s",n.host,n.port);const I=U(new Error(`connection timeout after ${Date.now()-o}ms`),"ERR_CONNECT_TIMEOUT");u.emit("error",I)},p=()=>{l=!0,an("connection opened %s:%s",n.host,n.port),M(null)},S=()=>{an.error("connection aborted %s:%s",n.host,n.port),u.destroy(),M(new jm)},M=I=>{u.removeListener("timeout",f),u.removeListener("connect",p),e.signal&&e.signal.removeEventListener("abort",S),I?c(I):a(u)};u.on("error",h),u.once("timeout",f),u.once("connect",p),u.on("close",()=>{u.removeListener("error",h)}),e.signal&&e.signal.addEventListener("abort",S),u.on("signal",I=>{s.emit("ss-handshake",{intentId:i,srcMultiaddr:this._signallingAddr.toString(),dstMultiaddr:t.toString(),signal:I})}),s.on("ws-handshake",I=>{if(I.intentId===i&&I.err&&c(U(I.err instanceof Error?I.err:new Error(I.err),"ERR_SIGNALLING_FAILED")),I.intentId!==i||!I.answer||u.destroyed)return;u.signal(I.signal)})})}createListener(t={},e){if(!BI&&!this.wrtc)throw U(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");return typeof t=="function"&&(e=t,t={}),e=e||$I,xI({handler:e,upgrader:this._upgrader},this,t)}filter(t){return t=Array.isArray(t)?t:[t],t.filter(e=>e.protoCodes().includes(UI)?!1:Rc.WebRTCStar.matches(e))}_peerDiscovered(t){if(!this.discovery._isStarted)return;an("Peer Discovered:",t),t=FI(t);const e=At(t),r=be.createFromB58String(e.getPeerId());this.discovery.emit("peer",{id:r,multiaddrs:[e]})}}var Lm=Ht(qI,{className:"WebRTCStar",symbolName:"@libp2p/js-libp2p-webrtc-star/webrtcstar"});const{Address4:VI,Address6:GI}=Il,Ko={ERR_INVALID_IP_PARAMETER:"ERR_INVALID_IP_PARAMETER",ERR_INVALID_PORT_PARAMETER:"ERR_INVALID_PORT_PARAMETER",ERR_INVALID_IP:"ERR_INVALID_IP"};function zI(t,e){if(typeof t!="string")throw U(new Error(`invalid ip provided: ${t}`),Ko.ERR_INVALID_IP_PARAMETER);if(e=parseInt(e),isNaN(e))throw U(new Error(`invalid port provided: ${e}`),Ko.ERR_INVALID_PORT_PARAMETER);if(new VI(t).isValid())return At(`/ip4/${t}/tcp/${e}`);const r=new GI(t);if(r.isValid())return r.is4()?At(`/ip4/${r.to4().correctForm()}/tcp/${e}`):At(`/ip6/${t}/tcp/${e}`);throw U(new Error(`invalid ip:port for creating a multiaddr: ${t}:${e}`),Ko.ERR_INVALID_IP)}var Tu=zI,HI=Ko;Tu.Errors=HI;var WI=421,KI=290,XI=2e3,Au={CODE_P2P:WI,CODE_CIRCUIT:KI,CLOSE_TIMEOUT:XI};const Cu=Q("libp2p:tcp:socket"),{CLOSE_TIMEOUT:QI}=Au;var Bm=(t,e)=>{e=e||{},e.listeningAddr&&e.listeningAddr.getPath()&&(e.remoteAddr=e.listeningAddr),e.remoteAddr&&e.remoteAddr.getPath()&&(e.localAddr=e.remoteAddr);const{sink:r,source:n}=ys.duplex(t),i={async sink(s){e.signal&&(s=rt(s,e.signal));try{await r(async function*(){for await(const a of s)yield Buffer.isBuffer(a)?a:a.slice()}())}catch(a){a.type!=="aborted"&&Cu(a)}},source:e.signal?rt(n,e.signal):n,conn:t,localAddr:e.localAddr||Tu(t.localAddress,t.localPort),remoteAddr:e.remoteAddr||Tu(t.remoteAddress,t.remotePort),timeline:{open:Date.now()},close(){return t.destroyed?void 0:new Promise((s,a)=>{const c=Date.now(),o=setTimeout(()=>{const{host:l,port:u}=i.remoteAddr.toOptions();Cu("timeout closing socket to %s:%s after %dms, destroying it manually",l,u,Date.now()-c),t.destroyed?Cu("%s:%s is already destroyed",l,u):t.destroy(),s()},QI);t.once("close",()=>clearTimeout(o)),t.end(l=>{if(i.timeline.close=Date.now(),l)return a(l);s()})})}};return t.once("close",()=>{i.timeline.close||(i.timeline.close=Date.now())}),i};const{resolve:YI}=Rg,JI={ip4:"IPv4",ip6:"IPv6"};function ZI(t){const e=t.getPath();return e?YI(e):t.toOptions()}function eR(t,e,r){const n=i=>At(`/${t}/${i}/tcp/${r}`);return(Um(e)?tR(JI[t]):[e]).map(n)}function Um(t){return["0.0.0.0","::"].includes(t)}function tR(t){return Object.values(Bu.networkInterfaces()).reduce((e,r)=>(r.forEach(n=>{n.family===t&&e.push(n.address)}),e),[])}var Fm={multiaddrToNetConfig:ZI,isAnyAddr:Um,getMultiaddrs:eR};const vi=Q("libp2p:tcp:listener");vi.error=Q("libp2p:tcp:listener:error");const{CODE_P2P:rR}=Au,{getMultiaddrs:$m,multiaddrToNetConfig:nR}=Fm;async function qm(t){try{t&&await t.close()}catch(e){vi.error("an error occurred closing the connection",e)}}var iR=({handler:t,upgrader:e},r)=>{const n=new St,i=rc.createServer(async c=>{c.on("error",u=>vi("socket error",u));let o,l;try{o=Bm(c,{listeningAddr:a}),vi("new inbound connection %s",o.remoteAddr),l=await e.upgradeInbound(o)}catch(u){return vi.error("inbound connection failed",u),qm(o)}vi("inbound connection %s upgraded",o.remoteAddr),sR(i,o),t&&t(l),n.emit("connection",l)});i.on("listening",()=>n.emit("listening")).on("error",c=>n.emit("error",c)).on("close",()=>n.emit("close")),i.__connections=[],n.close=()=>i.listening?new Promise((c,o)=>{i.__connections.forEach(l=>qm(l)),i.close(l=>l?o(l):c())}):void 0;let s,a;return n.listen=c=>(a=c,s=c.getPeerId(),s&&(a=c.decapsulateCode(rR)),new Promise((o,l)=>{const u=nR(a);i.listen(u,h=>{if(h)return l(h);vi("Listening on %s",i.address()),o()})})),n.getAddrs=()=>{let c=[];const o=i.address();if(!o)throw new Error("Listener is not ready yet");return a.toString().startsWith("/ip4")?c=c.concat($m("ip4",o.address,o.port)):o.family==="IPv6"&&(c=c.concat($m("ip6",o.address,o.port))),c.map(l=>s?l.encapsulate(`/p2p/${s}`):l)},n};function sR(t,e){t.__connections.push(e);const r=()=>{t.__connections=t.__connections.filter(n=>n!==e)};e.conn.once("close",r)}const vs=Q("libp2p:tcp"),{multiaddrToNetConfig:aR}=Fm,{AbortError:Vm}=rt,{CODE_CIRCUIT:oR,CODE_P2P:cR}=Au;class lR{constructor({upgrader:t}){if(!t)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=t}async dial(t,e){e=e||{};const r=await this._connect(t,e),n=Bm(r,{remoteAddr:t,signal:e.signal});vs("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return vs("outbound connection %s upgraded",n.remoteAddr),i}_connect(t,e={}){if(e.signal&&e.signal.aborted)throw new Vm;return new Promise((r,n)=>{const i=Date.now(),s=aR(t);vs("dialing %j",s);const a=rc.connect(s),c=f=>{f.message=`connection error ${s.host}:${s.port}: ${f.message}`,h(f)},o=()=>{vs("connnection timeout %s:%s",s.host,s.port);const f=U(new Error(`connection timeout after ${Date.now()-i}ms`),"ERR_CONNECT_TIMEOUT");a.emit("error",f)},l=()=>{vs("connection opened %j",s),h()},u=()=>{vs("connection aborted %j",s),a.destroy(),h(new Vm)},h=f=>{if(a.removeListener("error",c),a.removeListener("timeout",o),a.removeListener("connect",l),e.signal&&e.signal.removeEventListener("abort",u),f)return n(f);r(a)};a.on("error",c),a.on("timeout",o),a.on("connect",l),e.signal&&e.signal.addEventListener("abort",u)})}createListener(t,e){return typeof t=="function"&&(e=t,t={}),t=t||{},iR({handler:e,upgrader:this._upgrader})}filter(t){return t=Array.isArray(t)?t:[t],t.filter(e=>e.protoCodes().includes(oR)?!1:Rc.TCP.matches(e.decapsulateCode(cR)))}}var uR=Ht(lR,{className:"TCP",symbolName:"@libp2p/js-libp2p-tcp/tcp"});const Iu=10*1024;class dR{constructor(){this._pool=new Uint8Array(Iu),this._poolOffset=0}write(t){const e=this._pool;let r=this._poolOffset;J.encode(t.id<<3|t.type,e,r),r+=J.encode.bytes,J.encode(t.data?t.data.length:0,e,r),r+=J.encode.bytes;const n=e.subarray(this._poolOffset,r);return Iu-r<100?(this._pool=new Uint8Array(Iu),this._poolOffset=0):this._poolOffset=r,t.data?[n,t.data]:n}}const Gm=new dR;var hR=t=>async function*(){for await(const r of t)Array.isArray(r)?yield new ut(r.map(n=>Gm.write(n))):yield new ut(Gm.write(r))}(),pR=t=>async function*(){const r=new fR;for await(const n of t){const i=r.write(n);i.length&&(yield i)}}();class fR{constructor(){this._buffer=new ut,this._bufferProxy=new Proxy({},{get:(t,e)=>e[0]==="l"?this._buffer[e]:this._buffer.get(parseInt(e))}),this._headerInfo=null}write(t){if(!t||!t.length)return[];this._buffer.append(t);const e=[];for(;;){if(!this._headerInfo)try{this._headerInfo=this._decodeHeader(this._bufferProxy)}catch(c){break}const{id:r,type:n,length:i,offset:s}=this._headerInfo,a=this._buffer.length-s;if(a<i)break;e.push({id:r,type:n,data:this._buffer.shallowSlice(s,s+i)}),this._buffer.consume(s+i),this._headerInfo=null}return e}_decodeHeader(t){const e=J.decode(t);let r=J.decode.bytes;const n=J.decode(t,r);return r+=J.decode.bytes,{id:e>>3,type:e&7,offset:r,length:n}}}var mR=hR,gR=pR,zm={encode:mR,decode:gR};const Hm=1<<20;var Ru=t=>{t=t||Hm;const e=r=>{if(r.data&&r.data.length>t)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"})};return r=>async function*(){for await(const i of r)Array.isArray(i)?i.forEach(e):e(i),yield i}()},bR=Hm;Ru.MAX_MSG_SIZE=bR;const on=Object.freeze({NEW_STREAM:0,MESSAGE_RECEIVER:1,MESSAGE_INITIATOR:2,CLOSE_RECEIVER:3,CLOSE_INITIATOR:4,RESET_RECEIVER:5,RESET_INITIATOR:6});var yR=on,vR=Object.freeze({NEW_STREAM:on.NEW_STREAM,MESSAGE:on.MESSAGE_INITIATOR,CLOSE:on.CLOSE_INITIATOR,RESET:on.RESET_INITIATOR}),wR=Object.freeze({MESSAGE:on.MESSAGE_RECEIVER,CLOSE:on.CLOSE_RECEIVER,RESET:on.RESET_RECEIVER}),_R=Object.freeze(Object.entries(on).reduce((t,e)=>(t[e[1]]=e[0],t),{})),Wm={MessageTypes:yR,InitiatorMessageTypes:vR,ReceiverMessageTypes:wR,MessageTypeNames:_R};const Na=Q("libp2p:mplex:stream"),{MAX_MSG_SIZE:ER}=Ru,{InitiatorMessageTypes:SR,ReceiverMessageTypes:TR}=Wm,ku="ERR_MPLEX_STREAM_RESET",AR="ERR_MPLEX_STREAM_ABORT";var CR=({id:t,name:e,send:r,onEnd:n=()=>{},type:i="initiator",maxMsgSize:s=ER})=>{const a=new Js,c=new Js,o=i==="initiator"?SR:TR,l=i==="initiator"?`i${t}`:`r${t}`;e=String(e??t);let u=!1,h=!1,f;const p=I=>{if(u)return;u=!0,Na("%s stream %s source end",i,e,I),I&&!f&&(f=I),h&&(M.timeline.close=Date.now(),n(f))},S=I=>{if(h)return;h=!0,Na("%s stream %s sink end",i,e,I),I&&!f&&(f=I),u&&(M.timeline.close=Date.now(),n(f))},M={close:()=>M.source.end(),abort:I=>{Na("%s stream %s abort",i,e,I),M.source.end(I),a.abort(),S(I)},reset:()=>{const I=U(new Error("stream reset"),ku);c.abort(),M.source.end(I),S(I)},sink:async I=>{I=rt(I,[{signal:a.signal,options:{abortMessage:"stream aborted",abortCode:AR}},{signal:c.signal,options:{abortMessage:"stream reset",abortCode:ku}}]),i==="initiator"&&r({id:t,type:o.NEW_STREAM,data:e});try{for await(let k of I)for(;k.length;){if(k.length<=s){r({id:t,type:o.MESSAGE,data:k});break}k=ut.isBufferList(k)?k:new ut(k),r({id:t,type:o.MESSAGE,data:k.shallowSlice(0,s)}),k.consume(s)}}catch(k){return k.code===ku?Na("%s stream %s reset",i,e):(Na("%s stream %s error",i,e,k),r({id:t,type:o.RESET})),M.source.end(k),S(k)}r({id:t,type:o.CLOSE}),S()},source:eo(p),timeline:{open:Date.now(),close:null},id:l};return M};const cn=Q("libp2p:mplex"),{MessageTypes:wi,MessageTypeNames:Km}=Wm;class Xm{constructor(t){t=t||{},t=typeof t=="function"?{onStream:t}:t,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._options=t,this.sink=this._createSink(),this.source=this._createSource(),this.onStream=t.onStream,this.onStreamEnd=t.onStreamEnd}get streams(){const t=[];return this._streams.initiators.forEach(e=>{t.push(e)}),this._streams.receivers.forEach(e=>{t.push(e)}),t}newStream(t){const e=this._streamId++;t=t==null?e.toString():String(t);const r=this._streams.initiators;return this._newStream({id:e,name:t,type:"initiator",registry:r})}_newReceiverStream({id:t,name:e}){const r=this._streams.receivers;return this._newStream({id:t,name:e,type:"receiver",registry:r})}_newStream({id:t,name:e,type:r,registry:n}){if(n.has(t))throw new Error(`${r} stream ${t} already exists!`);cn("new %s stream %s %s",r,t,e);const i=c=>(cn.enabled&&cn("%s stream %s %s send",r,t,e,{...c,type:Km[c.type],data:c.data&&c.data.slice()}),this.source.push(c)),s=()=>{cn("%s stream %s %s ended",r,t,e),n.delete(t),this.onStreamEnd&&this.onStreamEnd(a)},a=CR({id:t,name:e,send:i,type:r,onEnd:s,maxMsgSize:this._options.maxMsgSize});return n.set(t,a),a}_createSink(){return async t=>{this._options.signal&&(t=rt(t,this._options.signal));try{await gt(t,zm.decode,Ru(this._options.maxMsgSize),async e=>{for await(const r of e)for(const n of r)this._handleIncoming(n)})}catch(e){return cn("error in sink",e),this.source.end(e)}this.source.end()}}_createSource(){const t=r=>{const{initiators:n,receivers:i}=this._streams;for(const s of n.values())s.abort(r);for(const s of i.values())s.abort(r)},e=eo({onEnd:t,writev:!0});return Object.assign(zm.encode(e),{push:e.push,end:e.end,return:e.return})}_handleIncoming({id:t,type:e,data:r}){if(cn.enabled&&cn("incoming message",{id:t,type:Km[e],data:r.slice()}),e===wi.NEW_STREAM&&this.onStream){const s=this._newReceiverStream({id:t,name:r.toString()});return this.onStream(s)}const n=e&1?this._streams.initiators:this._streams.receivers,i=n.get(t);if(!i)return cn("missing stream %s",t);switch(e){case wi.MESSAGE_INITIATOR:case wi.MESSAGE_RECEIVER:i.source.push(r);break;case wi.CLOSE_INITIATOR:case wi.CLOSE_RECEIVER:i.close();break;case wi.RESET_INITIATOR:case wi.RESET_RECEIVER:i.reset();break;default:cn("unknown message type %s",e)}}}Xm.multicodec="/mplex/6.7.0";var IR=Xm,RR=IR,Xo=Mr(`message Propose {
  optional bytes rand = 1;
  optional bytes pubkey = 2;
  optional string exchanges = 3;
  optional string ciphers = 4;
  optional string hashes = 5;
}

message Exchange {
  optional bytes epubkey = 1;
  optional bytes signature = 2;
}`);function kR(t,e){for(let r=0;r<t.byteLength;r++){if(t[r]<e[r])return-1;if(t[r]>e[r])return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0}var PR=kR;class Qm extends Error{constructor(t="Unexpected Peer"){super(t);this.code=Qm.code}static get code(){return"ERR_UNEXPECTED_PEER"}}class Ym extends Error{constructor(t="Invalid crypto exchange"){super(t);this.code=Ym.code}static get code(){return"ERR_INVALID_CRYPTO_EXCHANGE"}}class Jm extends Error{constructor(t="Invalid crypto transmission"){super(t);this.code=Jm.code}static get code(){return"ERR_INVALID_CRYPTO_TRANSMISSION"}}var Pu={UnexpectedPeerError:Qm,InvalidCryptoExchangeError:Ym,InvalidCryptoTransmissionError:Jm},Bn=te(function(t,e){const{InvalidCryptoExchangeError:r}=Pu;e.exchanges=["P-256","P-384","P-521"],e.ciphers=["AES-256","AES-128"],e.hashes=["SHA256","SHA512"],e.theBest=(s,a,c)=>{let o,l;if(s<0)o=c,l=a;else if(s>0)o=a,l=c;else return a[0];for(const u of o)for(const h of l)if(u===h)return u;throw new r("No algorithms in common!")},e.makeMacAndCipher=async s=>{[s.mac,s.cipher]=await Promise.all([n(s.hashT,s.keys.macKey),i(s.cipherT,s.keys.iv,s.keys.cipherKey)])};function n(s,a){return rr.hmac.create(s,a)}function i(s,a,c){if(s==="AES-128"||s==="AES-256")return rr.aes.create(c,a);throw new r(`unrecognized cipher type: ${s}`)}e.selectBest=async(s,a)=>{const c=await e.digest(we([a.pubKeyBytes,s.nonce])),o=await e.digest(we([s.pubKeyBytes,a.nonce])),l=PR(c,o);if(l===0)throw new r("you are trying to talk to yourself");return{curveT:e.theBest(l,s.exchanges,a.exchanges),cipherT:e.theBest(l,s.ciphers,a.ciphers),hashT:e.theBest(l,s.hashes,a.hashes),order:l}},e.digest=s=>Dg.digest(s,"sha2-256",s.length)});const Un=Q("libp2p:secio");Un.error=Q("libp2p:secio:error");const{UnexpectedPeerError:NR}=Pu,OR=16;var MR=t=>(t.proposal.out={rand:rr.randomBytes(OR),pubkey:t.key.local.public.bytes,exchanges:Bn.exchanges.join(","),ciphers:Bn.ciphers.join(","),hashes:Bn.hashes.join(",")},t.proposalEncoded.out=Xo.Propose.encode(t.proposal.out),t.proposalEncoded.out),DR=async t=>{const e=await rr.keys.generateEphemeralKeyPair(t.protocols.local.curveT);t.ephemeralKey.local=e.key,t.shared.generate=e.genSharedKey;const r=we([t.proposalEncoded.out,t.proposalEncoded.in,t.ephemeralKey.local]),n=await t.key.local.sign(r);return t.exchange.out={epubkey:t.ephemeralKey.local,signature:n},Xo.Exchange.encode(t.exchange.out)},xR=async(t,e)=>{Un("1.1 identify"),t.proposalEncoded.in=e,t.proposal.in=Xo.Propose.decode(e);const r=t.proposal.in.pubkey;t.key.remote=rr.keys.unmarshalPublicKey(r);const n=await be.createFromPubKey(se(r,"base64pad"));if(t.id.remote){if(t.id.remote.toString()!==n.toString())throw new NR("Dialed to the wrong peer: IDs do not match!");t.id.remote.pubKey=t.key.remote}else t.id.remote=n;Un("1.1 identify - %s - identified remote peer as %s",t.id.local.toB58String(),t.id.remote.toB58String())},jR=async t=>{Un("1.2 selection");const e={pubKeyBytes:t.key.local.public.bytes,exchanges:Bn.exchanges,hashes:Bn.hashes,ciphers:Bn.ciphers,nonce:t.proposal.out.rand},r={pubKeyBytes:t.proposal.in.pubkey,exchanges:t.proposal.in.exchanges.split(","),hashes:t.proposal.in.hashes.split(","),ciphers:t.proposal.in.ciphers.split(","),nonce:t.proposal.in.rand},n=await Bn.selectBest(e,r);t.protocols.remote={order:n.order,curveT:n.curveT,cipherT:n.cipherT,hashT:n.hashT},t.protocols.local={order:n.order,curveT:n.curveT,cipherT:n.cipherT,hashT:n.hashT}},LR=async(t,e)=>{Un("2.1. verify"),t.exchange.in=Xo.Exchange.decode(e),t.ephemeralKey.remote=t.exchange.in.epubkey;const r=we([t.proposalEncoded.in,t.proposalEncoded.out,t.ephemeralKey.remote]),n=await t.key.remote.verify(r,t.exchange.in.signature);if(!n)throw new Error("Bad signature");Un("2.1. verify - signature verified")},BR=async t=>{Un("2.2. keys");const e=await t.shared.generate(t.exchange.in.epubkey);t.shared.secret=e;const r=await rr.keys.keyStretcher(t.protocols.local.cipherT,t.protocols.local.hashT,t.shared.secret);if(t.protocols.local.order>0)t.protocols.local.keys=r.k1,t.protocols.remote.keys=r.k2;else if(t.protocols.local.order<0)t.protocols.local.keys=r.k2,t.protocols.remote.keys=r.k1;else throw new Error("you are trying to talk to yourself");Un("2.3. mac + cipher"),await Promise.all([t.protocols.local,t.protocols.remote].map(n=>Bn.makeMacAndCipher(n)))},UR=(t,e)=>{const r=t.proposal.out.rand;if(tr(r,e))return;throw new Error(`Failed to read our encrypted nonce: ${se(r,"base16")} != ${se(e,"base16")}`)},_i={createProposal:MR,createExchange:DR,identify:xR,selectProtocols:jR,verify:LR,generateKeys:BR,verifyNonce:UR};const{int32BEEncode:FR}=Je,ws=Q("libp2p:secio");ws.error=Q("libp2p:secio:error");var $R=async function(e,r){ws("1. propose - start");const n=_i.createProposal(e);ws("1. propose - writing proposal",n),await r.write(Je.encode.single(n,{lengthEncoder:FR})),ws("1. propose - reading proposal");const i=(await r.readLP()).slice();ws("1. propose - read proposal",i),await _i.identify(e,i),await _i.selectProtocols(e),ws("1. propose - finish")};const Oa=Q("libp2p:secio");Oa.error=Q("libp2p:secio:error");var qR=async function(e,r){Oa("2. exchange - start"),Oa("2. exchange - writing exchange");const n=await _i.createExchange(e);await r.writeLP(n);const i=await r.readLP();Oa("2. exchange - reading exchange"),await _i.verify(e,i.slice()),await _i.generateKeys(e),Oa("2. exchange - finish")},Zm=function(){let e,r;const n=async s=>{if(e)throw new Error("already piped");e=kc(s),r&&r(e)},i={[Symbol.asyncIterator](){return this},next(){return e?e.next():new Promise(s=>{r=a=>{r=null,s(a.next())}})}};return{sink:n,source:i}},VR=function(){var t=Zm(),e=Zm();return[{source:t.source,sink:e.sink},{source:e.source,sink:t.sink}]};/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var GR=function(e){return e!=null&&e.constructor!=null&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)},eg=(t,e={})=>{const r=sa(t),n=Je.decode.fromReader(r.reader,e),i={read:async s=>{const{value:a,done:c}=await r.reader.next(s);if(c&&a.length<s)throw new Error("Couldn't read enough bytes");if(!a)throw new Error("Value is null");return a},readLP:async()=>{const{value:s,done:a}=await n.next();if(!s)throw new Error("Value is null");return s},readPB:async s=>{const a=await i.readLP();if(!a)throw new Error("Value is null");const c=GR(a)?a:a.slice();return s.decode(c)},write:s=>{r.writer.push(s)},writeLP:s=>{i.write(Je.encode.single(s,e))},writePB:(s,a)=>{i.writeLP(a.encode(s))},pb:s=>({read:()=>i.readPB(s),write:a=>i.writePB(a,s)}),unwrap:()=>(r.rest(),r.stream)};return i};const{InvalidCryptoTransmissionError:tg}=Pu;var zR=(t,e)=>async function*(r){for await(const n of r){const i=await t.encrypt(ut.isBufferList(n)?n.slice():n),s=await e.digest(i);yield new ut([i,s])}},HR=(t,e)=>async function*(r){for await(const n of r){const i=n.length,s=e.length;if(i<s)throw new tg(`buffer (${i}) shorter than MAC size (${s})`);const a=i-s,c=n.slice(0,a),o=n.slice(a),l=await e.digest(c);if(!tr(o,l))throw new tg(`MAC Invalid: ${se(o,"base16")} != ${se(l,"base16")}`);const u=await t.decrypt(c);yield u}},rg={createBoxStream:zR,createUnboxStream:HR};const Qo=Q("libp2p:secio");Qo.error=Q("libp2p:secio:error");const{int32BEEncode:WR,int32BEDecode:KR}=Je,XR=8388608;var QR=async function(e,r){Qo("3. finish - start");const n=e.protocols,[i,s]=VR(),a=r.unwrap();gt(i,rg.createBoxStream(n.local.cipher,n.local.mac),Je.encode({lengthEncoder:WR}),a,Je.decode({lengthDecoder:KR,maxDataLength:XR}),rg.createUnboxStream(n.remote.cipher,n.remote.mac),i).catch(l=>{Qo.error("an error occurred in the crypto stream",l)});const c=eg(s);c.write(e.proposal.in.rand);const o=await c.read(e.proposal.in.rand.length);_i.verifyNonce(e,o.slice()),Qo("3. finish - finish"),e.secure=c.unwrap()},YR=async function(e,r){await $R(e,r),await qR(e,r),await QR(e,r),e.cleanSecrets()};class JR{constructor(t,e){this.setup(),this.id.local=t,this.id.remote=e,this.key.local=t.privKey}setup(){this.id={local:null,remote:null},this.key={local:null,remote:null},this.shake=null,this.cleanSecrets()}cleanSecrets(){this.shared={},this.ephemeralKey={local:null,remote:null},this.proposal={in:null,out:null},this.proposalEncoded={in:null,out:null},this.protocols={local:null,remote:null},this.exchange={in:null,out:null}}}var ZR=JR;const ek=Q("libp2p:secio");ek.error=Q("libp2p:secio:error");const{int32BEDecode:tk,int32BEEncode:rk}=Je;async function ng(t,e,r){if(!t)throw new Error("no local private key provided");if(!e)throw new Error("no connection for the handshake provided");const n=new ZR(t,r),i=eg(e,{lengthDecoder:tk,lengthEncoder:rk});return await YR(n,i),{conn:n.secure,remotePeer:n.id.remote}}var nk={protocol:"/secio/1.0.0",secureInbound:ng,secureOutbound:ng};const ig=()=>{};class ik{constructor({min:t=0,max:e=Infinity,handlers:r={}}){this.min=t,this.max=e,this._onConnect=r.onConnect||ig,this._onDisconnect=r.onDisconnect||ig,this.peers=new Set}set registrar(t){this._registrar=t}disconnect(t){this._onDisconnect(t)}}var sk=Ht(ik,{className:"Topology",symbolName:"@libp2p/js-interfaces/topology"});class ak extends sk{constructor({min:t,max:e,multicodecs:r,handlers:n}){super({min:t,max:e,handlers:n});if(!r)throw new Error("one or more multicodec should be provided");if(!n)throw new Error("the handlers should be provided");if(typeof n.onConnect!="function")throw new Error("the 'onConnect' handler must be provided");if(typeof n.onDisconnect!="function")throw new Error("the 'onDisconnect' handler must be provided");this.multicodecs=Array.isArray(r)?r:[r],this._registrar=void 0,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerConnect=this._onPeerConnect.bind(this)}set registrar(t){this._registrar=t,this._registrar.peerStore.on("change:protocols",this._onProtocolChange),this._registrar.connectionManager.on("peer:connect",this._onPeerConnect),this._updatePeers(this._registrar.peerStore.peers.values())}_updatePeers(t){for(const{id:e,protocols:r}of t)if(this.multicodecs.filter(n=>r.includes(n)).length){this.peers.add(e.toB58String());const n=this._registrar.getConnection(e);n&&this._onConnect(e,n)}else this.peers.delete(e.toB58String())}_onProtocolChange({peerId:t,protocols:e}){const r=this.peers.has(t.toB58String()),n=e.filter(i=>this.multicodecs.includes(i));r&&n.length===0&&this._onDisconnect(t);for(const i of e)if(this.multicodecs.includes(i)){const s=this._registrar.peerStore.get(t);this._updatePeers([s]);return}}_onPeerConnect(t){const e=t.remotePeer,r=this._registrar.peerStore.protoBook.get(e);if(!r)return;this.multicodecs.find(n=>r.includes(n))&&(this.peers.add(e.toB58String()),this._onConnect(e,t))}}var ok=Ht(ak,{className:"MulticodecTopology",symbolName:"@libp2p/js-interfaces/topology/multicodec-topology"}),ck={ERR_INVALID_SIGNATURE_POLICY:"ERR_INVALID_SIGNATURE_POLICY",ERR_UNHANDLED_SIGNATURE_POLICY:"ERR_UNHANDLED_SIGNATURE_POLICY",ERR_MISSING_SIGNATURE:"ERR_MISSING_SIGNATURE",ERR_MISSING_SEQNO:"ERR_MISSING_SEQNO",ERR_INVALID_SIGNATURE:"ERR_INVALID_SIGNATURE",ERR_UNEXPECTED_FROM:"ERR_UNEXPECTED_FROM",ERR_UNEXPECTED_SIGNATURE:"ERR_UNEXPECTED_SIGNATURE",ERR_UNEXPECTED_KEY:"ERR_UNEXPECTED_KEY",ERR_UNEXPECTED_SEQNO:"ERR_UNEXPECTED_SEQNO"},Nu={codes:ck},lk=`
message RPC {
  repeated SubOpts subscriptions = 1;
  repeated Message msgs = 2;

  message SubOpts {
    optional bool subscribe = 1; // subscribe or unsubcribe
    optional string topicID = 2;
  }

  message Message {
    optional bytes from = 1;
    optional bytes data = 2;
    optional bytes seqno = 3;
    repeated string topicIDs = 4;
    optional bytes signature = 5;
    optional bytes key = 6;
  }
}`,uk=`
// topicCID = cid(merkledag_protobuf(topicDescriptor)); (not the topic.name)
message TopicDescriptor {
  optional string name = 1;
  optional AuthOpts auth = 2;
  optional EncOpts enc = 2;

  message AuthOpts {
    optional AuthMode mode = 1;
    repeated bytes keys = 2; // root keys to trust

    enum AuthMode {
      NONE = 0; // no authentication, anyone can publish
      KEY = 1; // only messages signed by keys in the topic descriptor are accepted
      WOT = 2; // web of trust, certificates can allow publisher set to grow
    }
  }

  message EncOpts {
    optional EncMode mode = 1;
    repeated bytes keyHashes = 2; // the hashes of the shared keys used (salted)

    enum EncMode {
      NONE = 0; // no encryption, anyone can read
      SHAREDKEY = 1; // messages are encrypted with shared key
      WOT = 2; // web of trust, certificates can allow publisher set to grow
    }
  }
}`,Yo=te(function(t,e){const r=Mr(lk),n=r.RPC,i=Mr(uk);e=t.exports,e.rpc=r,e.td=i,e.RPC=n,e.Message=n.Message,e.SubOpts=n.SubOpts});const sg=Q("libp2p-pubsub:peer-streams");sg.error=Q("libp2p-pubsub:peer-streams:error");class dk extends St{constructor({id:t,protocol:e}){super();this.id=t,this.protocol=e,this._rawOutboundStream=null,this._rawInboundStream=null,this._inboundAbortController=null,this.outboundStream=null,this.inboundStream=null}get isReadable(){return Boolean(this.inboundStream)}get isWritable(){return Boolean(this.outboundStream)}write(t){if(!this.isWritable){const e=this.id.toB58String();throw new Error("No writable connection to "+e)}this.outboundStream.push(t)}attachInboundStream(t){this._inboundAbortController=new Js,this._rawInboundStream=t,this.inboundStream=rt(gt(this._rawInboundStream,Je.decode()),this._inboundAbortController.signal,{returnOnAbort:!0}),this.emit("stream:inbound")}async attachOutboundStream(t){const e=this.outboundStream;e&&await this.outboundStream.end(!1),this._rawOutboundStream=t,this.outboundStream=eo({onEnd:r=>{this._rawOutboundStream.reset&&this._rawOutboundStream.reset(),this._rawOutboundStream=null,this.outboundStream=null,r!==!1&&this.emit("close")}}),gt(this.outboundStream,Je.encode(),this._rawOutboundStream).catch(r=>{sg.error(r)}),e||this.emit("stream:outbound")}close(){this.outboundStream&&this.outboundStream.end(),this.inboundStream&&this._inboundAbortController.abort(),this._rawOutboundStream=null,this.outboundStream=null,this._rawInboundStream=null,this.inboundStream=null,this.emit("close")}}var hk=dk,pk={StrictSign:"StrictSign",StrictNoSign:"StrictNoSign"},fk={SignaturePolicy:pk},ln=te(function(t,e){e=t.exports,e.randomSeqno=()=>Sg(8),e.msgId=(r,n)=>{const i=be.createFromB58String(r).id,s=new Uint8Array(i.length+n.length);return s.set(i,0),s.set(n,i.length),s},e.noSignMsgId=r=>Tg.encode(r,"sha2-256"),e.anyMatch=(r,n)=>{let i;Array.isArray(n)?i=s=>n.indexOf(s)>-1:i=s=>n.has(s);for(const s of r)if(i(s))return!0;return!1},e.ensureArray=r=>Array.isArray(r)?r:[r],e.normalizeInRpcMessage=(r,n)=>{const i=Object.assign({},r);return r.from instanceof Uint8Array&&(i.from=se(r.from,"base58btc")),n&&(i.receivedFrom=n),i},e.normalizeOutRpcMessage=r=>{const n=Object.assign({},r);return(typeof r.from=="string"||r.from instanceof String)&&(n.from=je(r.from,"base58btc")),(typeof r.data=="string"||r.data instanceof String)&&(n.data=je(r.data)),n}});const{Message:ag}=Yo,Ou=je("libp2p-pubsub:");async function mk(t,e){const r=we([Ou,ag.encode(e)]),n=await t.privKey.sign(r);return{...e,signature:n,key:t.pubKey.bytes}}async function gk(t){const e={...t};delete e.signature,delete e.key,e.from=be.createFromCID(e.from).toBytes();const r=we([Ou,ag.encode(e)]),n=await og(t);return n.verify(r,t.signature)}async function og(t){const e=be.createFromCID(t.from);if(t.key){const r=await be.createFromPubKey(t.key);if(r.isEqual(e))return r.pubKey;throw new Error("Public Key does not match the originator")}else{if(e.pubKey)return e.pubKey;throw new Error("Could not get the public key from the originator id")}}var bk={messagePublicKey:og,signMessage:mk,SignPrefix:Ou,verifySignature:gk};const{codes:Ir}=Nu,{SignaturePolicy:un}=fk,{signMessage:yk,verifySignature:vk}=bk;class wk extends St{constructor({debugName:t,multicodecs:e,libp2p:r,globalSignaturePolicy:n=un.StrictSign,canRelayMessage:i=!1,emitSelf:s=!1}){if(typeof t!="string")throw new Error("a debugname `string` is required");if(!e)throw new Error("multicodecs are required");if(!r)throw new Error("libp2p is required");super();if(this.log=Q(t),this.log.err=Q(`${t}:error`),this.multicodecs=ln.ensureArray(e),this._libp2p=r,this.registrar=r.registrar,this.peerId=r.peerId,this.started=!1,this.topics=new Map,this.subscriptions=new Set,this.peers=new Map,!un[n])throw U(new Error("Invalid global signature policy"),Ir.ERR_INVALID_SIGUATURE_POLICY);this.globalSignaturePolicy=n,this.canRelayMessage=i,this.emitSelf=s,this.topicValidators=new Map,this._registrarId=void 0,this._onIncomingStream=this._onIncomingStream.bind(this),this._onPeerConnected=this._onPeerConnected.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this)}start(){if(this.started)return;this.log("starting"),this.registrar.handle(this.multicodecs,this._onIncomingStream);const t=new ok({multicodecs:this.multicodecs,handlers:{onConnect:this._onPeerConnected,onDisconnect:this._onPeerDisconnected}});this._registrarId=this.registrar.register(t),this.log("started"),this.started=!0}stop(){if(!this.started)return;this.registrar.unregister(this._registrarId),this.log("stopping"),this.peers.forEach(t=>t.close()),this.peers=new Map,this.subscriptions=new Set,this.started=!1,this.log("stopped")}_onIncomingStream({protocol:t,stream:e,connection:r}){const n=r.remotePeer,i=n.toB58String(),s=this._addPeer(n,t);s.attachInboundStream(e),this._processMessages(i,s.inboundStream,s)}async _onPeerConnected(t,e){const r=t.toB58String();this.log("connected",r);try{const{stream:n,protocol:i}=await e.newStream(this.multicodecs),s=this._addPeer(t,i);await s.attachOutboundStream(n)}catch(n){this.log.err(n)}this._sendSubscriptions(r,Array.from(this.subscriptions),!0)}_onPeerDisconnected(t,e){const r=t.toB58String();this.log("connection ended",r,e?e.message:""),this._removePeer(t)}_addPeer(t,e){const r=t.toB58String(),n=this.peers.get(r);if(n)return n;this.log("new peer",r);const i=new hk({id:t,protocol:e});return this.peers.set(r,i),i.once("close",()=>this._removePeer(t)),i}_removePeer(t){if(!t)return;const e=t.toB58String(),r=this.peers.get(e);if(!r)return;r.removeAllListeners(),r.close(),this.log("delete peer",e),this.peers.delete(e);for(const n of this.topics.values())n.delete(e);return r}async _processMessages(t,e,r){try{await gt(e,async n=>{for await(const i of n){const s=i instanceof Uint8Array?i:i.slice(),a=this._decodeRpc(s);this._processRpc(t,r,a)}})}catch(n){this._onPeerDisconnected(r.id,n)}}_processRpc(t,e,r){this.log("rpc from",t);const n=r.subscriptions,i=r.msgs;return n.length&&(n.forEach(s=>this._processRpcSubOpt(t,s)),this.emit("pubsub:subscription-change",e.id,n)),this._acceptFrom(t)?(i.length&&i.forEach(s=>{if(!(this.canRelayMessage||s.topicIDs.some(c=>this.subscriptions.has(c)))){this.log("received message we didn't subscribe to. Dropping.");return}const a=ln.normalizeInRpcMessage(s,t);this._processRpcMessage(a)}),!0):(this.log("received message from unacceptable peer %s",t),!1)}_processRpcSubOpt(t,e){const r=e.topicID;let n=this.topics.get(r);n||(n=new Set,this.topics.set(r,n)),e.subscribe?n.add(t):n.delete(t)}async _processRpcMessage(t){if(this.peerId.toB58String()===t.from&&!this.emitSelf)return;try{await this.validate(t)}catch(e){this.log("Message is invalid, dropping it. %O",e);return}this._emitMessage(t),this._publish(ln.normalizeOutRpcMessage(t))}_emitMessage(t){t.topicIDs.forEach(e=>{this.subscriptions.has(e)&&this.emit(e,t)})}getMsgId(t){const e=this.globalSignaturePolicy;switch(e){case un.StrictSign:return ln.msgId(t.from,t.seqno);case un.StrictNoSign:return ln.noSignMsgId(t.data);default:throw U(new Error("Cannot get message id: unhandled signature policy: "+e),Ir.ERR_UNHANDLED_SIGNATURE_POLICY)}}_acceptFrom(t){return!0}_decodeRpc(t){return Yo.rpc.RPC.decode(t)}_encodeRpc(t){return Yo.rpc.RPC.encode(t)}_sendRpc(t,e){const r=this.peers.get(t);if(!r||!r.isWritable){const n=`Cannot send RPC to ${t} as there is no open stream to it available`;this.log.err(n);return}r.write(this._encodeRpc(e))}_sendSubscriptions(t,e,r){return this._sendRpc(t,{subscriptions:e.map(n=>({topicID:n,subscribe:r}))})}async validate(t){const e=this.globalSignaturePolicy;switch(e){case un.StrictNoSign:if(t.from)throw U(new Error("StrictNoSigning: from should not be present"),Ir.ERR_UNEXPECTED_FROM);if(t.signature)throw U(new Error("StrictNoSigning: signature should not be present"),Ir.ERR_UNEXPECTED_SIGNATURE);if(t.key)throw U(new Error("StrictNoSigning: key should not be present"),Ir.ERR_UNEXPECTED_KEY);if(t.seqno)throw U(new Error("StrictNoSigning: seqno should not be present"),Ir.ERR_UNEXPECTED_SEQNO);break;case un.StrictSign:if(!t.signature)throw U(new Error("StrictSigning: Signing required and no signature was present"),Ir.ERR_MISSING_SIGNATURE);if(!t.seqno)throw U(new Error("StrictSigning: Signing required and no seqno was present"),Ir.ERR_MISSING_SEQNO);if(!await vk(t))throw U(new Error("StrictSigning: Invalid message signature"),Ir.ERR_INVALID_SIGNATURE);break;default:throw U(new Error("Cannot validate message: unhandled signature policy: "+e),Ir.ERR_UNHANDLED_SIGNATURE_POLICY)}for(const r of t.topicIDs){const n=this.topicValidators.get(r);if(!n)continue;await n(r,t)}}_buildMessage(t){const e=this.globalSignaturePolicy;switch(e){case un.StrictSign:return t.from=this.peerId.toB58String(),t.seqno=ln.randomSeqno(),yk(this.peerId,ln.normalizeOutRpcMessage(t));case un.StrictNoSign:return t;default:throw U(new Error("Cannot build message: unhandled signature policy: "+e),Ir.ERR_UNHANDLED_SIGNATURE_POLICY)}}getSubscribers(t){if(!this.started)throw U(new Error("not started yet"),"ERR_NOT_STARTED_YET");if(!t||typeof t!="string")throw U(new Error("a string topic must be provided"),"ERR_NOT_VALID_TOPIC");const e=this.topics.get(t);return e?Array.from(e):[]}async publish(t,e){if(!this.started)throw new Error("Pubsub has not started");this.log("publish",t,e);const r=this.peerId.toB58String();let n={receivedFrom:r,data:e,topicIDs:[t]};const i=await this._buildMessage(n);n=ln.normalizeInRpcMessage(i),this.emitSelf&&this._emitMessage(n),await this._publish(n)}_publish(t){throw U(new Error("publish must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}subscribe(t){if(!this.started)throw new Error("Pubsub has not started");this.subscriptions.has(t)||(this.subscriptions.add(t),this.peers.forEach((e,r)=>this._sendSubscriptions(r,[t],!0)))}unsubscribe(t){if(!this.started)throw new Error("Pubsub is not started");this.subscriptions.has(t)&&this.listenerCount(t)===0&&(this.subscriptions.delete(t),this.peers.forEach((e,r)=>this._sendSubscriptions(r,[t],!1)))}getTopics(){if(!this.started)throw new Error("Pubsub is not started");return Array.from(this.subscriptions)}}var Jo=wk,_k=Yo,Ek=ln,Sk=un;Jo.message=_k,Jo.utils=Ek,Jo.SignaturePolicy=Sk;var Tk=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.createGossipRpc=void 0;function r(n=[],i={}){return{subscriptions:[],msgs:n,control:Object.assign({ihave:[],iwant:[],graft:[],prune:[]},i)}}e.createGossipRpc=r}),Ak=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.shuffle=void 0;function r(n){if(n.length<=1)return n;const i=()=>Math.floor(Math.random()*Math.floor(n.length));for(let s=0;s<n.length;s++){const a=i(),c=n[s];n[s]=n[a],n[a]=c}return n}e.shuffle=r}),Ei=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ERR_TOPIC_VALIDATOR_IGNORE=e.ERR_TOPIC_VALIDATOR_REJECT=e.TimeCacheDuration=e.GossipsubIWantFollowupTime=e.GossipsubMaxIHaveMessages=e.GossipsubMaxIHaveLength=e.GossipsubGraftFloodThreshold=e.GossipsubOpportunisticGraftPeers=e.GossipsubOpportunisticGraftTicks=e.GossipsubDirectConnectInitialDelay=e.GossipsubDirectConnectTicks=e.GossipsubConnectionTimeout=e.GossipsubMaxPendingConnections=e.GossipsubConnectors=e.GossipsubPruneBackoffTicks=e.GossipsubPruneBackoff=e.GossipsubPrunePeers=e.GossipsubFanoutTTL=e.GossipsubHeartbeatInterval=e.GossipsubHeartbeatInitialDelay=e.GossipsubGossipRetransmission=e.GossipsubGossipFactor=e.GossipsubDlazy=e.GossipsubHistoryGossip=e.GossipsubHistoryLength=e.GossipsubDout=e.GossipsubDscore=e.GossipsubDhi=e.GossipsubDlo=e.GossipsubD=e.GossipsubIDv11=e.GossipsubIDv10=e.FloodsubID=e.minute=e.second=void 0,e.second=1e3,e.minute=60*e.second,e.FloodsubID="/floodsub/1.0.0",e.GossipsubIDv10="/meshsub/1.0.0",e.GossipsubIDv11="/meshsub/1.1.0",e.GossipsubD=6,e.GossipsubDlo=4,e.GossipsubDhi=12,e.GossipsubDscore=4,e.GossipsubDout=2,e.GossipsubHistoryLength=5,e.GossipsubHistoryGossip=3,e.GossipsubDlazy=6,e.GossipsubGossipFactor=.25,e.GossipsubGossipRetransmission=3,e.GossipsubHeartbeatInitialDelay=100,e.GossipsubHeartbeatInterval=e.second,e.GossipsubFanoutTTL=e.minute,e.GossipsubPrunePeers=16,e.GossipsubPruneBackoff=e.minute,e.GossipsubPruneBackoffTicks=15,e.GossipsubConnectors=8,e.GossipsubMaxPendingConnections=128,e.GossipsubConnectionTimeout=30*e.second,e.GossipsubDirectConnectTicks=300,e.GossipsubDirectConnectInitialDelay=e.second,e.GossipsubOpportunisticGraftTicks=60,e.GossipsubOpportunisticGraftPeers=2,e.GossipsubGraftFloodThreshold=10*e.second,e.GossipsubMaxIHaveLength=5e3,e.GossipsubMaxIHaveMessages=10,e.GossipsubIWantFollowupTime=3*e.second,e.TimeCacheDuration=120*1e3,e.ERR_TOPIC_VALIDATOR_REJECT="ERR_TOPIC_VALIDATOR_REJECT",e.ERR_TOPIC_VALIDATOR_IGNORE="ERR_TOPIC_VALIDATOR_IGNORE"}),Ck=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.hasGossipProtocol=void 0;function r(n){return n===Ei.GossipsubIDv10||n===Ei.GossipsubIDv11}e.hasGossipProtocol=r}),Ik=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.messageIdToString=void 0;function r(n){return se(n,"base64")}e.messageIdToString=r}),De=te(function(t,e){var r=ae&&ae.__createBinding||(Object.create?function(i,s,a,c){c===void 0&&(c=a),Object.defineProperty(i,c,{enumerable:!0,get:function(){return s[a]}})}:function(i,s,a,c){c===void 0&&(c=a),i[c]=s[a]}),n=ae&&ae.__exportStar||function(i,s){for(var a in i)a!=="default"&&!s.hasOwnProperty(a)&&r(s,i,a)};Object.defineProperty(e,"__esModule",{value:!0}),n(Tk,e),n(Ak,e),n(Ck,e),n(Ik,e)}),Rk=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.MessageCache=void 0;class r{constructor(n,i,s){this.msgs=new Map,this.peertx=new Map,this.history=[];for(let a=0;a<i;a++)this.history[a]=[];this.gossip=n,this.msgIdFn=s}put(n){const i=this.getMsgId(n),s=De.messageIdToString(i);this.msgs.set(s,n),this.history[0].push({msgID:i,topics:n.topicIDs})}getMsgId(n){return this.msgIdFn(n)}get(n){return this.msgs.get(De.messageIdToString(n))}getForPeer(n,i){const s=De.messageIdToString(n),a=this.msgs.get(s);if(!a)return[void 0,0];let c=this.peertx.get(s);c||(c=new Map,this.peertx.set(s,c));const o=(c.get(i)||0)+1;return c.set(i,o),[a,o]}getGossipIDs(n){const i=[];for(let s=0;s<this.gossip;s++)this.history[s].forEach(a=>{for(const c of a.topics)if(c===n){i.push(a.msgID);break}});return i}shift(){const n=this.history[this.history.length-1];n.forEach(i=>{const s=De.messageIdToString(i.msgID);this.msgs.delete(s),this.peertx.delete(s)}),this.history.pop(),this.history.unshift([])}}e.MessageCache=r}),kk=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=`
message RPC {
  repeated SubOpts subscriptions = 1;
  repeated Message msgs = 2;
  optional ControlMessage control = 3;

  message SubOpts {
    optional bool subscribe = 1; // subscribe or unsubcribe
    optional string topicID = 2;
  }

  message Message {
    optional bytes from = 1;
    optional bytes data = 2;
    optional bytes seqno = 3;
    repeated string topicIDs = 4; 
    optional bytes signature = 5;
    optional bytes key = 6;
  }

  message ControlMessage {
    repeated ControlIHave ihave = 1;
    repeated ControlIWant iwant = 2;
    repeated ControlGraft graft = 3;
    repeated ControlPrune prune = 4;
  }

  message ControlIHave {
    optional string topicID = 1;
    repeated bytes messageIDs = 2;
  }

  message ControlIWant {
    repeated bytes messageIDs = 1;  
  }

  message ControlGraft {
    optional string topicID = 1;
  }

  message ControlPrune {
    optional string topicID = 1;
    repeated PeerInfo peers = 2;
    optional uint64 backoff = 3;
  }

  message PeerInfo {
    optional bytes peerID = 1;
    optional bytes signedPeerRecord = 2;
  }
}`}),Mu=te(function(t,e){var r=ae&&ae.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(e,"__esModule",{value:!0}),e.RPCCodec=void 0;const n=r(kk),i=Mr(n.default);e.RPCCodec=i.RPC}),Fn=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getGossipPeers=void 0;function r(n,i,s,a=()=>!0){const c=n.topics.get(i);if(!c)return new Set;let o=[];return c.forEach(l=>{const u=n.peers.get(l);if(!u)return;De.hasGossipProtocol(u.protocol)&&a(l)&&o.push(l)}),o=De.shuffle(o),s>0&&o.length>s&&(o=o.slice(0,s)),new Set(o)}e.getGossipPeers=r}),Pk=te(function(t,e){var r=ae&&ae.__createBinding||(Object.create?function(c,o,l,u){u===void 0&&(u=l),Object.defineProperty(c,u,{enumerable:!0,get:function(){return o[l]}})}:function(c,o,l,u){u===void 0&&(u=l),c[u]=o[l]}),n=ae&&ae.__setModuleDefault||(Object.create?function(c,o){Object.defineProperty(c,"default",{enumerable:!0,value:o})}:function(c,o){c.default=o}),i=ae&&ae.__importStar||function(c){if(c&&c.__esModule)return c;var o={};if(c!=null)for(var l in c)l!=="default"&&Object.hasOwnProperty.call(c,l)&&r(o,c,l);return n(o,c),o};Object.defineProperty(e,"__esModule",{value:!0}),e.Heartbeat=void 0;const s=i(Ei);class a{constructor(c){this.gossipsub=c}start(){if(this._heartbeatTimer)return;const c=this._heartbeat.bind(this),o=setTimeout(()=>{c(),this._heartbeatTimer.runPeriodically(c,s.GossipsubHeartbeatInterval)},s.GossipsubHeartbeatInitialDelay);this._heartbeatTimer={_intervalId:void 0,runPeriodically:(l,u)=>{this._heartbeatTimer._intervalId=setInterval(l,u)},cancel:()=>{clearTimeout(o),clearInterval(this._heartbeatTimer._intervalId)}}}stop(){if(!this._heartbeatTimer)return;this._heartbeatTimer.cancel(),this._heartbeatTimer=null}_heartbeat(){const{D:c,Dlo:o,Dhi:l,Dscore:u,Dout:h}=this.gossipsub._options;this.gossipsub.heartbeatTicks++;const f=new Map,p=V=>{let z=f.get(V);return z===void 0&&(z=this.gossipsub.score.score(V),f.set(V,z)),z},S=new Map,M=new Map,I=new Map;this.gossipsub._clearBackoff(),this.gossipsub.peerhave.clear(),this.gossipsub.iasked.clear(),this.gossipsub._applyIwantPenalties(),this.gossipsub._directConnect(),this.gossipsub.mesh.forEach((V,z)=>{const v=A=>{this.gossipsub.log("HEARTBEAT: Remove mesh link to %s in %s",A,z),this.gossipsub.score.prune(A,z),this.gossipsub._addBackoff(A,z),V.delete(A);const d=M.get(A);d?d.push(z):M.set(A,[z])},_=A=>{this.gossipsub.log("HEARTBEAT: Add mesh link to %s in %s",A,z),this.gossipsub.score.graft(A,z),V.add(A);const d=S.get(A);d?d.push(z):S.set(A,[z])};if(V.forEach(A=>{const d=p(A);d<0&&(this.gossipsub.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",A,d,z),v(A),I.set(A,!0))}),V.size<o){const A=this.gossipsub.backoff.get(z),d=c-V.size,g=Fn.getGossipPeers(this.gossipsub,z,d,E=>!V.has(E)&&!this.gossipsub.direct.has(E)&&(!A||!A.has(E))&&p(E)>=0);g.forEach(_)}if(V.size>l){let A=Array.from(V);A.sort((g,E)=>p(E)-p(g)),A=A.slice(0,u).concat(De.shuffle(A.slice(u)));let d=0;if(A.slice(0,c).forEach(g=>{this.gossipsub.outbound.get(g)&&d++}),d<h){const g=b=>{const C=A[b];for(let P=b;P>0;P--)A[P]=A[P-1];A[0]=C};if(d>0){let b=d;for(let C=1;C<c&&b>0;C++)this.gossipsub.outbound.get(A[C])&&(g(C),b--)}let E=c-d;for(let b=c;b<A.length&&E>0;b++)this.gossipsub.outbound.get(A[b])&&(g(b),E--)}A.slice(c).forEach(v)}if(V.size>=o){let A=0;if(V.forEach(d=>{this.gossipsub.outbound.get(d)&&A++}),A<h){const d=h-A,g=this.gossipsub.backoff.get(z);Fn.getGossipPeers(this.gossipsub,z,d,E=>!V.has(E)&&!this.gossipsub.direct.has(E)&&(!g||!g.has(E))&&p(E)>=0).forEach(_)}}if(this.gossipsub.heartbeatTicks%s.GossipsubOpportunisticGraftTicks===0&&V.size>1){const A=Array.from(V).sort((E,b)=>p(E)-p(b)),d=V.size/2,g=p(A[d]);if(g<this.gossipsub._options.scoreThresholds.opportunisticGraftThreshold){const E=this.gossipsub.backoff.get(z),b=Fn.getGossipPeers(this.gossipsub,z,s.GossipsubOpportunisticGraftPeers,C=>V.has(C)&&!this.gossipsub.direct.has(C)&&(!E||!E.has(C))&&p(C)>g);b.forEach(C=>{this.gossipsub.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",C,z),_(C)})}}this.gossipsub._emitGossip(z,V)});const k=this.gossipsub._now();this.gossipsub.lastpub.forEach((V,z)=>{V+s.GossipsubFanoutTTL<k&&(this.gossipsub.fanout.delete(z),this.gossipsub.lastpub.delete(z))}),this.gossipsub.fanout.forEach((V,z)=>{const v=this.gossipsub.topics.get(z);if(V.forEach(_=>{(!v.has(_)||p(_)<this.gossipsub._options.scoreThresholds.publishThreshold)&&V.delete(_)}),V.size<c){const _=c-V.size,A=Fn.getGossipPeers(this.gossipsub,z,_,d=>!V.has(d)&&!this.gossipsub.direct.has(d)&&p(d)>=this.gossipsub._options.scoreThresholds.publishThreshold);A.forEach(d=>{V.add(d)})}this.gossipsub._emitGossip(z,V)}),this.gossipsub._sendGraftPrune(S,M,I),this.gossipsub._flush(),this.gossipsub.messageCache.shift(),this.gossipsub.emit("gossipsub:heartbeat")}}e.Heartbeat=a}),ke=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ERR_INVALID_PEER_SCORE_THRESHOLDS=e.ERR_INVALID_PEER_SCORE_PARAMS=void 0,e.ERR_INVALID_PEER_SCORE_PARAMS="ERR_INVALID_PEER_SCORE_PARAMS",e.ERR_INVALID_PEER_SCORE_THRESHOLDS="ERR_INVALID_PEER_SCORE_THRESHOLDS"}),cg=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.validateTopicScoreParams=e.validatePeerScoreParams=e.createTopicScoreParams=e.createPeerScoreParams=e.defaultTopicScoreParams=e.defaultPeerScoreParams=void 0,e.defaultPeerScoreParams={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},e.defaultTopicScoreParams={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function r(a={}){return Object.assign(Object.assign(Object.assign({},e.defaultPeerScoreParams),a),{topics:a.topics?Object.entries(a.topics).reduce((c,[o,l])=>(c[o]=n(l),c),{}):{}})}e.createPeerScoreParams=r;function n(a={}){return Object.assign(Object.assign({},e.defaultTopicScoreParams),a)}e.createTopicScoreParams=n;function i(a){for(const[c,o]of Object.entries(a.topics))try{s(o)}catch(l){throw U(new Error(`invalid score parameters for topic ${c}: ${l.message}`),ke.ERR_INVALID_PEER_SCORE_PARAMS)}if(a.topicScoreCap<0)throw U(new Error("invalid topic score cap; must be positive (or 0 for no cap)"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.appSpecificScore===null||a.appSpecificScore===void 0)throw U(new Error("missing application specific score function"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.IPColocationFactorWeight>0)throw U(new Error("invalid IPColocationFactorWeight; must be negative (or 0 to disable)"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.IPColocationFactorWeight!==0&&a.IPColocationFactorThreshold<1)throw U(new Error("invalid IPColocationFactorThreshold; must be at least 1"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.behaviourPenaltyWeight>0)throw U(new Error("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.behaviourPenaltyWeight!==0&&(a.behaviourPenaltyDecay<=0||a.behaviourPenaltyDecay>=1))throw U(new Error("invalid BehaviourPenaltyDecay; must be between 0 and 1"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.decayInterval<1e3)throw U(new Error("invalid DecayInterval; must be at least 1s"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.decayToZero<=0||a.decayToZero>=1)throw U(new Error("invalid DecayToZero; must be between 0 and 1"),ke.ERR_INVALID_PEER_SCORE_PARAMS)}e.validatePeerScoreParams=i;function s(a){if(a.topicWeight<0)throw U(new Error("invalid topic weight; must be >= 0"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.timeInMeshQuantum===0)throw U(new Error("invalid TimeInMeshQuantum; must be non zero"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.timeInMeshWeight<0)throw U(new Error("invalid TimeInMeshWeight; must be positive (or 0 to disable)"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.timeInMeshWeight!==0&&a.timeInMeshQuantum<=0)throw U(new Error("invalid TimeInMeshQuantum; must be positive"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.timeInMeshWeight!==0&&a.timeInMeshCap<=0)throw U(new Error("invalid TimeInMeshCap; must be positive"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.firstMessageDeliveriesWeight<0)throw U(new Error("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.firstMessageDeliveriesWeight!==0&&(a.firstMessageDeliveriesDecay<=0||a.firstMessageDeliveriesDecay>=1))throw U(new Error("invalid FirstMessageDeliveriesDecay; must be between 0 and 1"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.firstMessageDeliveriesWeight!==0&&a.firstMessageDeliveriesCap<=0)throw U(new Error("invalid FirstMessageDeliveriesCap; must be positive"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight>0)throw U(new Error("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight!==0&&(a.meshMessageDeliveriesDecay<=0||a.meshMessageDeliveriesDecay>=1))throw U(new Error("invalid MeshMessageDeliveriesDecay; must be between 0 and 1"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight!==0&&a.meshMessageDeliveriesCap<=0)throw U(new Error("invalid MeshMessageDeliveriesCap; must be positive"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight!==0&&a.meshMessageDeliveriesThreshold<=0)throw U(new Error("invalid MeshMessageDeliveriesThreshold; must be positive"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWindow<0)throw U(new Error("invalid MeshMessageDeliveriesWindow; must be non-negative"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight!==0&&a.meshMessageDeliveriesActivation<1e3)throw U(new Error("invalid MeshMessageDeliveriesActivation; must be at least 1s"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshFailurePenaltyWeight>0)throw U(new Error("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshFailurePenaltyWeight!==0&&(a.meshFailurePenaltyDecay<=0||a.meshFailurePenaltyDecay>=1))throw U(new Error("invalid MeshFailurePenaltyDecay; must be between 0 and 1"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.invalidMessageDeliveriesWeight>0)throw U(new Error("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)"),ke.ERR_INVALID_PEER_SCORE_PARAMS);if(a.invalidMessageDeliveriesDecay<=0||a.invalidMessageDeliveriesDecay>=1)throw U(new Error("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1"),ke.ERR_INVALID_PEER_SCORE_PARAMS)}e.validateTopicScoreParams=s}),Nk=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.validatePeerScoreThresholds=e.createPeerScoreThresholds=e.defaultPeerScoreThresholds=void 0,e.defaultPeerScoreThresholds={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function r(i={}){return Object.assign(Object.assign({},e.defaultPeerScoreThresholds),i)}e.createPeerScoreThresholds=r;function n(i){if(i.gossipThreshold>0)throw U(new Error("invalid gossip threshold; it must be <= 0"),ke.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.publishThreshold>0||i.publishThreshold>i.gossipThreshold)throw U(new Error("invalid publish threshold; it must be <= 0 and <= gossip threshold"),ke.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.graylistThreshold>0||i.graylistThreshold>i.publishThreshold)throw U(new Error("invalid graylist threshold; it must be <= 0 and <= publish threshold"),ke.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.acceptPXThreshold<0)throw U(new Error("invalid accept PX threshold; it must be >= 0"),ke.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.opportunisticGraftThreshold<0)throw U(new Error("invalid opportunistic grafting threshold; it must be >= 0"),ke.ERR_INVALID_PEER_SCORE_THRESHOLDS)}e.validatePeerScoreThresholds=n}),_s=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ensureTopicStats=e.createTopicStats=e.createPeerStats=void 0;function r(s={}){return Object.assign(Object.assign({connected:!1,expire:0,ips:[],behaviourPenalty:0},s),{topics:s.topics?Object.entries(s.topics).reduce((a,[c,o])=>(a[c]=n(o),a),{}):{}})}e.createPeerStats=r;function n(s={}){return Object.assign({inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},s)}e.createTopicStats=n;function i(s,a,c){let o=a.topics[s];return o||(c.topics[s]?(a.topics[s]=o=n(),o):void 0)}e.ensureTopicStats=i}),Ok=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.computeScore=void 0;function r(n,i,s,a){let c=0;Object.entries(i.topics).forEach(([u,h])=>{const f=s.topics[u];if(!f)return;let p=0;if(h.inMesh){let k=h.meshTime/f.timeInMeshQuantum;k>f.timeInMeshCap&&(k=f.timeInMeshCap),p+=k*f.timeInMeshWeight}const S=h.firstMessageDeliveries;if(p+=S*f.firstMessageDeliveriesWeight,h.meshMessageDeliveriesActive&&h.meshMessageDeliveries<f.meshMessageDeliveriesThreshold){const k=f.meshMessageDeliveriesThreshold-h.meshMessageDeliveries,V=k*k;p+=V*f.meshMessageDeliveriesWeight}const M=h.meshFailurePenalty;p+=M*f.meshFailurePenaltyWeight;const I=h.invalidMessageDeliveries*h.invalidMessageDeliveries;p+=I*f.invalidMessageDeliveriesWeight,c+=p*f.topicWeight}),s.topicScoreCap>0&&c>s.topicScoreCap&&(c=s.topicScoreCap);const o=s.appSpecificScore(n);c+=o*s.appSpecificWeight,i.ips.forEach(u=>{if(s.IPColocationFactorWhitelist.has(u))return;const h=a.get(u),f=h?h.size:0;if(f>s.IPColocationFactorThreshold){const p=f-s.IPColocationFactorThreshold,S=p*p;c+=S*s.IPColocationFactorWeight}});const l=i.behaviourPenalty*i.behaviourPenalty;return c+=l*s.behaviourPenaltyWeight,c}e.computeScore=r});function He(t){this._head=0,this._tail=0,this._capacityMask=3,this._list=new Array(4),Array.isArray(t)&&this._fromArray(t)}He.prototype.peekAt=function(e){var r=e;if(r!==(r|0))return;var n=this.size();return r>=n||r<-n?void 0:(r<0&&(r+=n),r=this._head+r&this._capacityMask,this._list[r])},He.prototype.get=function(e){return this.peekAt(e)},He.prototype.peek=function(){return this._head===this._tail?void 0:this._list[this._head]},He.prototype.peekFront=function(){return this.peek()},He.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(He.prototype,"length",{get:function(){return this.size()}}),He.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},He.prototype.unshift=function(e){if(e===void 0)return this.size();var r=this._list.length;return this._head=this._head-1+r&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},He.prototype.shift=function(){var e=this._head;if(e===this._tail)return;var r=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),r},He.prototype.push=function(e){if(e===void 0)return this.size();var r=this._tail;return this._list[r]=e,this._tail=r+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},He.prototype.pop=function(){var e=this._tail;if(e===this._head)return;var r=this._list.length;this._tail=e-1+r&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=r>>>2&&this._shrinkArray(),n},He.prototype.removeOne=function(e){var r=e;if(r!==(r|0))return;if(this._head===this._tail)return;var n=this.size(),i=this._list.length;if(r>=n||r<-n)return;r<0&&(r+=n),r=this._head+r&this._capacityMask;var s=this._list[r],a;if(e<n/2){for(a=e;a>0;a--)this._list[r]=this._list[r=r-1+i&this._capacityMask];this._list[r]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(a=n-1-e;a>0;a--)this._list[r]=this._list[r=r+1+i&this._capacityMask];this._list[r]=void 0,this._tail=this._tail-1+i&this._capacityMask}return s},He.prototype.remove=function(e,r){var n=e,i,s=r;if(n!==(n|0))return;if(this._head===this._tail)return;var a=this.size(),c=this._list.length;if(n>=a||n<-a||r<1)return;if(n<0&&(n+=a),r===1||!r)return i=new Array(1),i[0]=this.removeOne(n),i;if(n===0&&n+r>=a)return i=this.toArray(),this.clear(),i;n+r>a&&(r=a-n);var o;for(i=new Array(r),o=0;o<r;o++)i[o]=this._list[this._head+n+o&this._capacityMask];if(n=this._head+n&this._capacityMask,e+r===a){for(this._tail=this._tail-r+c&this._capacityMask,o=r;o>0;o--)this._list[n=n+1+c&this._capacityMask]=void 0;return i}if(e===0){for(this._head=this._head+r+c&this._capacityMask,o=r-1;o>0;o--)this._list[n=n+1+c&this._capacityMask]=void 0;return i}if(n<a/2){for(this._head=this._head+e+r+c&this._capacityMask,o=e;o>0;o--)this.unshift(this._list[n=n-1+c&this._capacityMask]);for(n=this._head-1+c&this._capacityMask;s>0;)this._list[n=n-1+c&this._capacityMask]=void 0,s--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+r+c&this._capacityMask,o=a-(r+e);o>0;o--)this.push(this._list[n++]);for(n=this._tail;s>0;)this._list[n=n+1+c&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=c>>>2&&this._shrinkArray(),i},He.prototype.splice=function(e,r){var n=e;if(n!==(n|0))return;var i=this.size();if(n<0&&(n+=i),n>i)return;if(arguments.length>2){var s,a,c,o=arguments.length,l=this._list.length,u=2;if(!i||n<i/2){for(a=new Array(n),s=0;s<n;s++)a[s]=this._list[this._head+s&this._capacityMask];for(r===0?(c=[],n>0&&(this._head=this._head+n+l&this._capacityMask)):(c=this.remove(n,r),this._head=this._head+n+l&this._capacityMask);o>u;)this.unshift(arguments[--o]);for(s=n;s>0;s--)this.unshift(a[s-1])}else{a=new Array(i-(n+r));var h=a.length;for(s=0;s<h;s++)a[s]=this._list[this._head+n+r+s&this._capacityMask];for(r===0?(c=[],n!=i&&(this._tail=this._head+n+l&this._capacityMask)):(c=this.remove(n,r),this._tail=this._tail-h+l&this._capacityMask);u<o;)this.push(arguments[u++]);for(s=0;s<h;s++)this.push(a[s])}return c}else return this.remove(n,r)},He.prototype.clear=function(){this._head=0,this._tail=0},He.prototype.isEmpty=function(){return this._head===this._tail},He.prototype.toArray=function(){return this._copyArray(!1)},He.prototype._fromArray=function(e){for(var r=0;r<e.length;r++)this.push(e[r])},He.prototype._copyArray=function(e){var r=[],n=this._list,i=n.length,s;if(e||this._head>this._tail){for(s=this._head;s<i;s++)r.push(n[s]);for(s=0;s<this._tail;s++)r.push(n[s])}else for(s=this._head;s<this._tail;s++)r.push(n[s]);return r},He.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length*=2,this._capacityMask=this._capacityMask<<1|1},He.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};var Mk=He,Rr=te(function(t,e){var r=ae&&ae.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(e,"__esModule",{value:!0}),e.MessageDeliveries=e.DeliveryRecordStatus=void 0;const n=r(Mk);var i;(function(a){a[a.unknown=0]="unknown",a[a.valid=1]="valid",a[a.invalid=2]="invalid",a[a.ignored=3]="ignored"})(i=e.DeliveryRecordStatus||(e.DeliveryRecordStatus={}));class s{constructor(){this.records=new Map,this.queue=new n.default}ensureRecord(a){const c=De.messageIdToString(a);let o=this.records.get(c);if(o)return o;o={status:i.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(c,o);const l={msgId:c,expire:Date.now()+Ei.TimeCacheDuration};return this.queue.push(l),o}gc(){const a=Date.now();let c=this.queue.peekFront();for(;c&&c.expire<a;)this.records.delete(c.msgId),this.queue.shift(),c=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}e.MessageDeliveries=s}),Dk=te(function(t,e){var r=ae&&ae.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(e,"__esModule",{value:!0}),e.PeerScore=void 0;const n=r(be),{ERR_INVALID_SIGNATURE:i,ERR_MISSING_SIGNATURE:s}=Nu.codes,a=Q("libp2p:gossipsub:score");class c{constructor(o,l,u){cg.validatePeerScoreParams(o),this.params=o,this._connectionManager=l,this.peerStats=new Map,this.peerIPs=new Map,this.deliveryRecords=new Rr.MessageDeliveries,this.msgId=u}start(){if(this._backgroundInterval){a("Peer score already running");return}this._backgroundInterval=setInterval(()=>this.background(),this.params.decayInterval),a("started")}stop(){if(!this._backgroundInterval){a("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),a("stopped")}background(){this._refreshScores(),this._updateIPs(),this.deliveryRecords.gc()}_refreshScores(){const o=Date.now(),l=this.params.decayToZero;this.peerStats.forEach((u,h)=>{if(!u.connected){o>u.expire&&(this._removeIPs(h,u.ips),this.peerStats.delete(h));return}Object.entries(u.topics).forEach(([f,p])=>{const S=this.params.topics[f];if(!S)return;p.firstMessageDeliveries*=S.firstMessageDeliveriesDecay,p.firstMessageDeliveries<l&&(p.firstMessageDeliveries=0),p.meshMessageDeliveries*=S.meshMessageDeliveriesDecay,p.meshMessageDeliveries<l&&(p.meshMessageDeliveries=0),p.meshFailurePenalty*=S.meshFailurePenaltyDecay,p.meshFailurePenalty<l&&(p.meshFailurePenalty=0),p.invalidMessageDeliveries*=S.invalidMessageDeliveriesDecay,p.invalidMessageDeliveries<l&&(p.invalidMessageDeliveries=0),p.inMesh&&(p.meshTime=o-p.graftTime,p.meshTime>S.meshMessageDeliveriesActivation&&(p.meshMessageDeliveriesActive=!0))}),u.behaviourPenalty*=this.params.behaviourPenaltyDecay,u.behaviourPenalty<l&&(u.behaviourPenalty=0)})}score(o){const l=this.peerStats.get(o);return l?Ok.computeScore(o,l,this.params,this.peerIPs):0}addPenalty(o,l){const u=this.peerStats.get(o);if(!u)return;u.behaviourPenalty+=l}addPeer(o){const l=_s.createPeerStats({connected:!0});this.peerStats.set(o,l);const u=this._getIPs(o);this._setIPs(o,u,l.ips),l.ips=u}removePeer(o){const l=this.peerStats.get(o);if(!l)return;if(this.score(o)>0){this._removeIPs(o,l.ips),this.peerStats.delete(o);return}Object.entries(l.topics).forEach(([u,h])=>{h.firstMessageDeliveries=0;const f=this.params.topics[u].meshMessageDeliveriesThreshold;if(h.inMesh&&h.meshMessageDeliveriesActive&&h.meshMessageDeliveries<f){const p=f-h.meshMessageDeliveries;h.meshFailurePenalty+=p*p}h.inMesh=!1}),l.connected=!1,l.expire=Date.now()+this.params.retainScore}graft(o,l){const u=this.peerStats.get(o);if(!u)return;const h=_s.ensureTopicStats(l,u,this.params);if(!h)return;h.inMesh=!0,h.graftTime=Date.now(),h.meshTime=0,h.meshMessageDeliveriesActive=!1}prune(o,l){const u=this.peerStats.get(o);if(!u)return;const h=_s.ensureTopicStats(l,u,this.params);if(!h)return;const f=this.params.topics[l].meshMessageDeliveriesThreshold;if(h.meshMessageDeliveriesActive&&h.meshMessageDeliveries<f){const p=f-h.meshMessageDeliveries;h.meshFailurePenalty+=p*p}h.inMesh=!1}validateMessage(o){this.deliveryRecords.ensureRecord(this.msgId(o))}deliverMessage(o){const l=o.receivedFrom;this._markFirstMessageDelivery(l,o);const u=this.deliveryRecords.ensureRecord(this.msgId(o)),h=Date.now();if(u.status!==Rr.DeliveryRecordStatus.unknown){a("unexpected delivery: message from %s was first seen %s ago and has delivery status %d",l,h-u.firstSeen,Rr.DeliveryRecordStatus[u.status]);return}u.status=Rr.DeliveryRecordStatus.valid,u.validated=h,u.peers.forEach(f=>{f!==l&&this._markDuplicateMessageDelivery(f,o)})}rejectMessage(o,l){const u=o.receivedFrom;switch(l){case s:case i:this._markInvalidMessageDelivery(u,o);return}const h=this.deliveryRecords.ensureRecord(this.msgId(o));if(h.status!==Rr.DeliveryRecordStatus.unknown){a("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",u,Date.now()-h.firstSeen,Rr.DeliveryRecordStatus[h.status]);return}switch(l){case Ei.ERR_TOPIC_VALIDATOR_IGNORE:h.status=Rr.DeliveryRecordStatus.ignored;return}h.status=Rr.DeliveryRecordStatus.invalid,this._markInvalidMessageDelivery(u,o),h.peers.forEach(f=>{this._markInvalidMessageDelivery(f,o)})}duplicateMessage(o){const l=o.receivedFrom,u=this.deliveryRecords.ensureRecord(this.msgId(o));if(u.peers.has(l))return;switch(u.status){case Rr.DeliveryRecordStatus.unknown:u.peers.add(l);break;case Rr.DeliveryRecordStatus.valid:u.peers.add(l),this._markDuplicateMessageDelivery(l,o,u.validated);break;case Rr.DeliveryRecordStatus.invalid:this._markInvalidMessageDelivery(l,o);break}}_markInvalidMessageDelivery(o,l){const u=this.peerStats.get(o);if(!u)return;l.topicIDs.forEach(h=>{const f=_s.ensureTopicStats(h,u,this.params);if(!f)return;f.invalidMessageDeliveries+=1})}_markFirstMessageDelivery(o,l){const u=this.peerStats.get(o);if(!u)return;l.topicIDs.forEach(h=>{const f=_s.ensureTopicStats(h,u,this.params);if(!f)return;let p=this.params.topics[h].firstMessageDeliveriesCap;if(f.firstMessageDeliveries+=1,f.firstMessageDeliveries>p&&(f.firstMessageDeliveries=p),!f.inMesh)return;p=this.params.topics[h].meshMessageDeliveriesCap,f.meshMessageDeliveries+=1,f.meshMessageDeliveries>p&&(f.meshMessageDeliveries=p)})}_markDuplicateMessageDelivery(o,l,u=0){const h=this.peerStats.get(o);if(!h)return;const f=u?Date.now():0;l.topicIDs.forEach(p=>{const S=_s.ensureTopicStats(p,h,this.params);if(!S)return;if(!S.inMesh)return;const M=this.params.topics[p];if(u&&f>u+M.meshMessageDeliveriesWindow)return;const I=M.meshMessageDeliveriesCap;S.meshMessageDeliveries+=1,S.meshMessageDeliveries>I&&(S.meshMessageDeliveries=I)})}_getIPs(o){return this._connectionManager.getAll(n.default.createFromB58String(o)).map(l=>l.remoteAddr.toOptions().host)}_setIPs(o,l,u){e:for(const h of l){for(const p of u)if(h===p)continue e;let f=this.peerIPs.get(h);f||(f=new Set,this.peerIPs.set(h,f)),f.add(o)}e:for(const h of u){for(const p of l)if(h===p)continue e;const f=this.peerIPs.get(h);if(!f)continue;f.delete(o),f.size||this.peerIPs.delete(h)}}_removeIPs(o,l){l.forEach(u=>{const h=this.peerIPs.get(u);if(!h)return;h.delete(o),h.size||this.peerIPs.delete(u)})}_updateIPs(){this.peerStats.forEach((o,l)=>{const u=this._getIPs(l);this._setIPs(l,u,o.ips),o.ips=u})}}e.PeerScore=c}),Du=te(function(t,e){var r=ae&&ae.__createBinding||(Object.create?function(i,s,a,c){c===void 0&&(c=a),Object.defineProperty(i,c,{enumerable:!0,get:function(){return s[a]}})}:function(i,s,a,c){c===void 0&&(c=a),i[c]=s[a]}),n=ae&&ae.__exportStar||function(i,s){for(var a in i)a!=="default"&&!s.hasOwnProperty(a)&&r(s,i,a)};Object.defineProperty(e,"__esModule",{value:!0}),n(cg,e),n(Nk,e),n(Dk,e)}),xk=te(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.IWantTracer=void 0;const{ERR_INVALID_SIGNATURE:r,ERR_MISSING_SIGNATURE:n}=Nu.codes;class i{constructor(s){this.getMsgId=s,this.promises=new Map}addPromise(s,a){const c=Math.floor(Math.random()*a.length),o=a[c],l=De.messageIdToString(o);let u=this.promises.get(l);u||(u=new Map,this.promises.set(l,u)),u.has(s)||u.set(s,Date.now()+Ei.GossipsubIWantFollowupTime)}getBrokenPromises(){const s=Date.now(),a=new Map;return this.promises.forEach((c,o)=>{c.forEach((l,u)=>{l<s&&(a.set(u,(a.get(u)||0)+1),c.delete(u))}),c.size||this.promises.delete(o)}),a}deliverMessage(s){const a=this.getMsgId(s),c=De.messageIdToString(a);this.promises.delete(c)}rejectMessage(s,a){switch(a){case r:case n:return}const c=this.getMsgId(s),o=De.messageIdToString(c);this.promises.delete(o)}clear(){this.promises.clear()}}e.IWantTracer=i}),lg="Expected a function",ug=0/0,jk="[object Symbol]",Lk=/^\s+|\s+$/g,Bk=/^[-+]0x[0-9a-f]+$/i,Uk=/^0b[01]+$/i,Fk=/^0o[0-7]+$/i,$k=parseInt,qk=typeof ae=="object"&&ae&&ae.Object===Object&&ae,Vk=typeof self=="object"&&self&&self.Object===Object&&self,Gk=qk||Vk||Function("return this")(),zk=Object.prototype,Hk=zk.toString,Wk=Math.max,Kk=Math.min,xu=function(){return Gk.Date.now()};function Xk(t,e,r){var n,i,s,a,c,o,l=0,u=!1,h=!1,f=!0;if(typeof t!="function")throw new TypeError(lg);e=dg(e)||0,Zo(r)&&(u=!!r.leading,h="maxWait"in r,s=h?Wk(dg(r.maxWait)||0,e):s,f="trailing"in r?!!r.trailing:f);function p(A){var d=n,g=i;return n=i=void 0,l=A,a=t.apply(g,d),a}function S(A){return l=A,c=setTimeout(k,e),u?p(A):a}function M(A){var d=A-o,g=A-l,E=e-d;return h?Kk(E,s-g):E}function I(A){var d=A-o,g=A-l;return o===void 0||d>=e||d<0||h&&g>=s}function k(){var A=xu();if(I(A))return V(A);c=setTimeout(k,M(A))}function V(A){return c=void 0,f&&n?p(A):(n=i=void 0,a)}function z(){c!==void 0&&clearTimeout(c),l=0,n=o=i=c=void 0}function v(){return c===void 0?a:V(xu())}function _(){var A=xu(),d=I(A);if(n=arguments,i=this,o=A,d){if(c===void 0)return S(o);if(h)return c=setTimeout(k,e),p(o)}return c===void 0&&(c=setTimeout(k,e)),a}return _.cancel=z,_.flush=v,_}function Qk(t,e,r){var n=!0,i=!0;if(typeof t!="function")throw new TypeError(lg);return Zo(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),Xk(t,e,{leading:n,maxWait:e,trailing:i})}function Zo(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function Yk(t){return!!t&&typeof t=="object"}function Jk(t){return typeof t=="symbol"||Yk(t)&&Hk.call(t)==jk}function dg(t){if(typeof t=="number")return t;if(Jk(t))return ug;if(Zo(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Zo(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(Lk,"");var r=Uk.test(t);return r||Fk.test(t)?$k(t.slice(2),r?2:8):Bk.test(t)?ug:+t}var Zk=Qk,eP=te(function(t,e){e=t.exports=r;function r(i){if(!(this instanceof r))return new r(i);i=i||{};const s=i.validity||30,a=new Map,c=Zk(()=>{a.forEach((o,l)=>{const u=o.validity||s,h=n(o.timestamp);h>u&&a.delete(l)})},200);this.put=(o,l,u)=>{this.has(o)||a.set(o,{value:l,timestamp:new Date,validity:u}),c()},this.get=o=>{if(a.has(o))return a.get(o).value;throw new Error("key does not exist")},this.has=o=>a.has(o)}function n(i){const s=new Date,a=s.getTime()-i.getTime();return Math.floor(a/1e3)}}),tP=te(function(t){var e=ae&&ae.__createBinding||(Object.create?function(o,l,u,h){h===void 0&&(h=u),Object.defineProperty(o,h,{enumerable:!0,get:function(){return l[u]}})}:function(o,l,u,h){h===void 0&&(h=u),o[h]=l[u]}),r=ae&&ae.__setModuleDefault||(Object.create?function(o,l){Object.defineProperty(o,"default",{enumerable:!0,value:l})}:function(o,l){o.default=l}),n=ae&&ae.__importStar||function(o){if(o&&o.__esModule)return o;var l={};if(o!=null)for(var u in o)u!=="default"&&Object.hasOwnProperty.call(o,u)&&e(l,o,u);return r(l,o),l},i=ae&&ae.__awaiter||function(o,l,u,h){function f(p){return p instanceof u?p:new u(function(S){S(p)})}return new(u||(u=Promise))(function(p,S){function M(V){try{k(h.next(V))}catch(z){S(z)}}function I(V){try{k(h.throw(V))}catch(z){S(z)}}function k(V){V.done?p(V.value):f(V.value).then(M,I)}k((h=h.apply(o,l||[])).next())})};const s=n(Jo),a=n(Ei);class c extends s.default{constructor(o,l={}){const u=[a.GossipsubIDv11,a.GossipsubIDv10],h=Object.assign(Object.assign({gossipIncoming:!0,fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:a.GossipsubD,Dlo:a.GossipsubDlo,Dhi:a.GossipsubDhi,Dscore:a.GossipsubDscore,Dout:a.GossipsubDout,Dlazy:a.GossipsubDlazy},l),{scoreParams:Du.createPeerScoreParams(l.scoreParams),scoreThresholds:Du.createPeerScoreThresholds(l.scoreThresholds)});h.fallbackToFloodsub&&u.push(a.FloodsubID),super(Object.assign({debugName:"libp2p:gossipsub",multicodecs:u,libp2p:o},h)),this._options=h,this.direct=new Set(h.directPeers.map(f=>f.id.toB58String())),h.directPeers.forEach(f=>{o.peerStore.addressBook.add(f.id,f.addrs)}),this.seenCache=new eP,this.mesh=new Map,this.fanout=new Map,this.lastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.messageCache=l.messageCache||new Rk.MessageCache(a.GossipsubHistoryGossip,a.GossipsubHistoryLength,this.getMsgId.bind(this)),this.heartbeat=new Pk.Heartbeat(this),this.heartbeatTicks=0,this.gossipTracer=new xk.IWantTracer(this.getMsgId.bind(this)),this._libp2p=o,this.score=new Du.PeerScore(this._options.scoreParams,o.connectionManager,this.getMsgId.bind(this))}_decodeRpc(o){return Mu.RPCCodec.decode(o)}_encodeRpc(o){return Mu.RPCCodec.encode(o)}_addPeer(o,l){const u=super._addPeer(o,l);this.score.addPeer(o.toB58String());let h=!1;for(const f of this._libp2p.connectionManager.getAll(o))if(f.stat.direction==="outbound"&&Array.from(f.registry.values()).some(p=>l===p.protocol)){h=!0;break}return this.outbound.set(u.id.toB58String(),h),u}_removePeer(o){const l=super._removePeer(o),u=o.toB58String();for(const h of this.mesh.values())h.delete(u);for(const h of this.fanout.values())h.delete(u);return this.gossip.delete(u),this.control.delete(u),this.outbound.delete(u),this.score.removePeer(u),l}_processRpc(o,l,u){return super._processRpc(o,l,u)?(u.control&&this._processRpcControlMessage(o,u.control),!0):!1}_processRpcControlMessage(o,l){if(!l)return;const u=this._handleIHave(o,l.ihave),h=this._handleIWant(o,l.iwant),f=this._handleGraft(o,l.graft);if(this._handlePrune(o,l.prune),!u.length&&!h.length&&!f.length)return;const p=De.createGossipRpc(h,{iwant:u,prune:f});this._sendRpc(o,p)}_processRpcMessage(o){const l=Object.create(null,{_processRpcMessage:{get:()=>super._processRpcMessage}});return i(this,void 0,void 0,function*(){const u=this.getMsgId(o),h=De.messageIdToString(u);if(this.seenCache.has(h)){this.score.duplicateMessage(o);return}this.seenCache.put(h),this.score.validateMessage(o),yield l._processRpcMessage.call(this,o)})}_acceptFrom(o){return this.direct.has(o)||this.score.score(o)>=this._options.scoreThresholds.graylistThreshold}validate(o){const l=Object.create(null,{validate:{get:()=>super.validate}});return i(this,void 0,void 0,function*(){try{yield l.validate.call(this,o)}catch(u){throw this.score.rejectMessage(o,u.code),this.gossipTracer.rejectMessage(o,u.code),u}})}_handleIHave(o,l){if(!l.length)return[];const u=this.score.score(o);if(u<this._options.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",o,u),[];const h=(this.peerhave.get(o)||0)+1;if(this.peerhave.set(o,h),h>a.GossipsubMaxIHaveMessages)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",o,h),[];const f=this.iasked.get(o)||0;if(f>=a.GossipsubMaxIHaveLength)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",o,f),[];const p=new Map;if(l.forEach(({topicID:I,messageIDs:k})=>{if(!I||!this.mesh.has(I))return;k.forEach(V=>{const z=De.messageIdToString(V);if(this.seenCache.has(z))return;p.set(z,V)})}),!p.size)return[];let S=p.size;S+f>a.GossipsubMaxIHaveLength&&(S=a.GossipsubMaxIHaveLength-f),this.log("IHAVE: Asking for %d out of %d messages from %s",S,p.size,o);let M=Array.from(p.values());return De.shuffle(M),M=M.slice(0,S),this.iasked.set(o,f+S),this.gossipTracer.addPromise(o,M),[{messageIDs:M}]}_handleIWant(o,l){if(!l.length)return[];const u=this.score.score(o);if(u<this._options.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",o,u),[];const h=new Map;return l.forEach(({messageIDs:f})=>{f.forEach(p=>{const[S,M]=this.messageCache.getForPeer(p,o);if(!S)return;if(M>a.GossipsubGossipRetransmission){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",o,p);return}h.set(De.messageIdToString(p),S)})}),h.size?(this.log("IWANT: Sending %d messages to %s",h.size,o),Array.from(h.values()).map(s.utils.normalizeOutRpcMessage)):[]}_handleGraft(o,l){const u=[],h=this.score.score(o),f=this._now();let p=this._options.doPX;return l.forEach(({topicID:S})=>{var M;if(!S)return;const I=this.mesh.get(S);if(!I){p=!1;return}if(I.has(o))return;if(this.direct.has(o)){this.log("GRAFT: ignoring request from direct peer %s",o),u.push(S),p=!1;return}const k=(M=this.backoff.get(S))===null||M===void 0?void 0:M.get(o);if(typeof k=="number"&&f<k){this.log("GRAFT: ignoring backed off peer %s",o),this.score.addPenalty(o,1),p=!1;const V=k+a.GossipsubGraftFloodThreshold-a.GossipsubPruneBackoff;f<V&&this.score.addPenalty(o,1),this._addBackoff(o,S),u.push(S);return}if(h<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",o,h,S),u.push(S),p=!1,this._addBackoff(o,S);return}if(I.size>=this._options.Dhi&&!this.outbound.get(o)){u.push(S),this._addBackoff(o,S);return}this.log("GRAFT: Add mesh link from %s in %s",o,S),this.score.graft(o,S),I.add(o)}),u.length?u.map(S=>this._makePrune(o,S,p)):[]}_handlePrune(o,l){const u=this.score.score(o);l.forEach(({topicID:h,backoff:f,peers:p})=>{if(!h)return;const S=this.mesh.get(h);if(!S)return;if(this.log("PRUNE: Remove mesh link to %s in %s",o,h),this.score.prune(o,h),S.delete(o),typeof f=="number"&&f>0?this._doAddBackoff(o,h,f*1e3):this._addBackoff(o,h),p&&p.length){if(u<this._options.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",o,u,h);return}this._pxConnect(p)}})}_addBackoff(o,l){this._doAddBackoff(o,l,a.GossipsubPruneBackoff)}_doAddBackoff(o,l,u){let h=this.backoff.get(l);h||(h=new Map,this.backoff.set(l,h));const f=this._now()+u,p=h.get(o)||0;p<f&&h.set(o,f)}_applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((o,l)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",l,o),this.score.addPenalty(l,o)})}_clearBackoff(){if(this.heartbeatTicks%a.GossipsubPruneBackoffTicks!==0)return;const o=this._now();this.backoff.forEach((l,u)=>{l.forEach((h,f)=>{h<o&&l.delete(f)}),l.size===0&&this.backoff.delete(u)})}_directConnect(){if(this.heartbeatTicks%a.GossipsubDirectConnectTicks!==0)return;const o=[];this.direct.forEach(l=>{const u=this.peers.get(l);(!u||!u.isWritable)&&o.push(l)}),o.length&&o.forEach(l=>{this._connect(l)})}_pxConnect(o){return i(this,void 0,void 0,function*(){o.length>a.GossipsubPrunePeers&&(De.shuffle(o),o=o.slice(0,a.GossipsubPrunePeers));const l=[];if(yield Promise.all(o.map(u=>i(this,void 0,void 0,function*(){if(!u.peerID)return;const h=be.createFromBytes(u.peerID),f=h.toB58String();if(this.peers.has(f))return;if(!u.signedPeerRecord){l.push(f);return}try{const p=yield da.openAndCertify(u.signedPeerRecord,"libp2p-peer-record"),S=p.peerId.toB58String();if(f!==S){this.log("bogus peer record obtained through px: peer ID %s doesn't match expected peer %s",S,f);return}if(!this._libp2p.peerStore.addressBook.consumePeerRecord(p)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}l.push(f)}catch(p){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}))),!l.length)return;l.forEach(u=>this._connect(u))})}start(){super.start(),this.heartbeat.start(),this.score.start(),this._directPeerInitial=setTimeout(()=>{this.direct.forEach(o=>{this._connect(o)})},a.GossipsubDirectConnectInitialDelay)}stop(){super.stop(),this.heartbeat.stop(),this.score.stop(),this.mesh=new Map,this.fanout=new Map,this.lastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.gossipTracer.clear(),clearTimeout(this._directPeerInitial)}_connect(o){this.log("Initiating connection with %s",o),this._libp2p.dialProtocol(be.createFromB58String(o),this.multicodecs)}subscribe(o){super.subscribe(o),this.join(o)}unsubscribe(o){super.unsubscribe(o),this.leave(o)}join(o){if(!this.started)throw new Error("Gossipsub has not started");this.log("JOIN %s",o);const l=this.fanout.get(o);if(l)l.forEach(u=>{this.score.score(u)<0&&l.delete(u)}),l.size<this._options.D&&Fn.getGossipPeers(this,o,this._options.D-l.size,u=>!l.has(u)&&!this.direct.has(u)&&this.score.score(u)>=0).forEach(u=>l.add(u)),this.mesh.set(o,l),this.fanout.delete(o),this.lastpub.delete(o);else{const u=Fn.getGossipPeers(this,o,this._options.D,h=>!this.direct.has(h)&&this.score.score(h)>=0);this.mesh.set(o,u)}this.mesh.get(o).forEach(u=>{this.log("JOIN: Add mesh link to %s in %s",u,o),this._sendGraft(u,o)})}leave(o){if(!this.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",o);const l=this.mesh.get(o);l&&(l.forEach(u=>{this.log("LEAVE: Remove mesh link to %s in %s",u,o),this._sendPrune(u,o)}),this.mesh.delete(o))}_publish(o){return i(this,void 0,void 0,function*(){o.receivedFrom!==this.peerId.toB58String()&&(this.score.deliverMessage(o),this.gossipTracer.deliverMessage(o));const l=this.getMsgId(o),u=De.messageIdToString(l);this.seenCache.put(u),this.messageCache.put(o);const h=new Set;o.topicIDs.forEach(p=>{const S=this.topics.get(p);if(!S)return;if(this._options.floodPublish&&o.from===this.peerId.toB58String())S.forEach(M=>{(this.direct.has(M)||this.score.score(M)>=this._options.scoreThresholds.publishThreshold)&&h.add(M)});else{this.direct.forEach(I=>{h.add(I)}),S.forEach(I=>{const k=this.score.score(I),V=this.peers.get(I);if(!V)return;V.protocol===a.FloodsubID&&k>=this._options.scoreThresholds.publishThreshold&&h.add(I)});let M=this.mesh.get(p);if(!M||!M.size){if(M=this.fanout.get(p),!M){const I=Fn.getGossipPeers(this,p,this._options.D,k=>this.score.score(k)>=this._options.scoreThresholds.publishThreshold);I.size>0?(M=I,this.fanout.set(p,I)):M=new Set}this.lastpub.set(p,this._now())}M.forEach(I=>{h.add(I)})}});const f=De.createGossipRpc([s.utils.normalizeOutRpcMessage(o)]);h.forEach(p=>{if(p===o.from)return;this._sendRpc(p,f)})})}_sendGraft(o,l){const u=[{topicID:l}],h=De.createGossipRpc([],{graft:u});this._sendRpc(o,h)}_sendPrune(o,l){const u=[this._makePrune(o,l,this._options.doPX)],h=De.createGossipRpc([],{prune:u});this._sendRpc(o,h)}_sendRpc(o,l){const u=this.peers.get(o);if(!u||!u.isWritable)return;const h=this.control.get(o);h&&(this._piggybackControl(o,l,h),this.control.delete(o));const f=this.gossip.get(o);f&&(this._piggybackGossip(o,l,f),this.gossip.delete(o)),u.write(Mu.RPCCodec.encode(l))}_piggybackControl(o,l,u){const h=(u.graft||[]).filter(({topicID:p})=>(p&&this.mesh.get(p)||new Set).has(o)),f=(u.prune||[]).filter(({topicID:p})=>!(p&&this.mesh.get(p)||new Set).has(o));if(!h.length&&!f.length)return;l.control?(l.control.graft=l.control.graft.concat(h),l.control.prune=l.control.prune.concat(f)):l.control={ihave:[],iwant:[],graft:h,prune:f}}_piggybackGossip(o,l,u){l.control||(l.control={ihave:[],iwant:[],graft:[],prune:[]}),l.control.ihave=u}_sendGraftPrune(o,l,u){const h=this._options.doPX;for(const[f,p]of o){const S=p.map(V=>({topicID:V}));let M=[];const I=l.get(f);I&&(M=I.map(V=>this._makePrune(f,V,h&&!u.get(f))),l.delete(f));const k=De.createGossipRpc([],{graft:S,prune:M});this._sendRpc(f,k)}for(const[f,p]of l){const S=p.map(I=>this._makePrune(f,I,h&&!u.get(f))),M=De.createGossipRpc([],{prune:S});this._sendRpc(f,M)}}_emitGossip(o,l){const u=this.messageCache.getGossipIDs(o);if(!u.length)return;De.shuffle(u),u.length>a.GossipsubMaxIHaveLength&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",u.length);const h=[],f=this.topics.get(o);if(!f)return;f.forEach(M=>{const I=this.peers.get(M);if(!I)return;!l.has(M)&&!this.direct.has(M)&&De.hasGossipProtocol(I.protocol)&&this.score.score(M)>=this._options.scoreThresholds.gossipThreshold&&h.push(M)});let p=this._options.Dlazy;const S=a.GossipsubGossipFactor*h.length;S>p&&(p=S),p>h.length?p=h.length:De.shuffle(h),h.slice(0,p).forEach(M=>{let I=u;u.length>a.GossipsubMaxIHaveLength&&(I=De.shuffle(I.slice()).slice(0,a.GossipsubMaxIHaveLength)),this._pushGossip(M,{topicID:o,messageIDs:I})})}_flush(){for(const[o,l]of this.gossip.entries()){this.gossip.delete(o);const u=De.createGossipRpc([],{ihave:l});this._sendRpc(o,u)}for(const[o,l]of this.control.entries()){this.control.delete(o);const u=De.createGossipRpc([],{graft:l.graft,prune:l.prune});this._sendRpc(o,u)}}_pushGossip(o,l){this.log("Add gossip to %s",o);const u=this.gossip.get(o)||[];this.gossip.set(o,u.concat(l))}_now(){return Date.now()}_makePrune(o,l,u){if(this.peers.get(o).protocol===a.GossipsubIDv10)return{topicID:l,peers:[]};const h=a.GossipsubPruneBackoff/1e3,f=[];if(u){const p=Fn.getGossipPeers(this,l,a.GossipsubPrunePeers,S=>S!==o&&this.score.score(S)>=0);p.forEach(S=>{const M=be.createFromB58String(S);f.push({peerID:M.toBytes(),signedPeerRecord:this._libp2p.peerStore.addressBook.getRawEnvelope(M)})})}return{topicID:l,peers:f,backoff:h}}}c.multicodec=a.GossipsubIDv11,t.exports=c}),rP=Ig(tP),nP=window.MediaStream,iP=window.MediaStreamTrack,sP=window.RTCDataChannel,aP=window.RTCDataChannelEvent,oP=window.RTCDtlsTransport,cP=window.RTCIceCandidate,lP=window.RTCIceTransport,uP=window.RTCPeerConnection,dP=window.RTCPeerConnectionIceEvent,hP=window.RTCRtpReceiver,pP=window.RTCRtpSender,fP=window.RTCRtpTransceiver,mP=window.RTCSctpTransport,gP=window.RTCSessionDescription,bP=window.getUserMedia,yP=navigator.mediaDevices,vP={MediaStream:nP,MediaStreamTrack:iP,RTCDataChannel:sP,RTCDataChannelEvent:aP,RTCDtlsTransport:oP,RTCIceCandidate:cP,RTCIceTransport:lP,RTCPeerConnection:uP,RTCPeerConnectionIceEvent:dP,RTCRtpReceiver:hP,RTCRtpSender:pP,RTCRtpTransceiver:fP,RTCSctpTransport:mP,RTCSessionDescription:gP,getUserMedia:bP,mediaDevices:yP};function hg(){return{addresses:{listen:["/dns4/boiling-hamlet-91904.herokuapp.com/tcp/443/wss/p2p-webrtc-star"]},modules:{transport:[uR,h1,Lm],streamMuxer:[RR],connEncryption:[nk],dht:xg,pubsub:rP},config:{transport:{[Lm.prototype[Symbol.toStringTag]]:{wrtc:vP}},dht:{protocolPrefix:"/conjure",kBucketSize:10,enabled:!0,randomWalk:{enabled:!0,interval:3e5,timeout:1e4}}}}}async function wP(t){const e=await m_.create(t||hg());return await e.start(),e}export default wP;export{hg as config};
