import s from"./DiscordOauthHandler.js";import e from"../ProfileService.js";export default class r extends e{constructor(t){super(t,"Discord");this.link=this.link.bind(this)}async initialise(){await super.initialise(),this.discordHandler=new s(this),await this.discordHandler.initialise()&&(this.guilds=await this.getGuilds())}getSchema(){return{linkButton:{type:"button",buttonText:this.getAuthenticated()?"Unlink":"Link",ignoreLabel:!0,callback:this.link}}}link(){if(!this.discordHandler)return;this.getAuthenticated()?this.discordHandler.logOut():this.discordHandler.logInToDiscord()}toJson(){return this.isAuthenticated?this.data:super.toJson()}readFromJson(t){}async getGuilds(){return!this.discordHandler||!this.isAuthenticated?[]:await this.discordHandler.getUserGuilds()}async getRealms(){(!this.guilds||this.guilds.length===0)&&(this.guilds=await this.getGuilds());let t=JSON.parse(JSON.stringify(this.guilds));for(let i of t)i.iconURL="https://cdn.discordapp.com/icons/"+i.id+"/"+i.icon+".png",i.worldData={guildID:i.id},i.id="Discord-"+i.id,i.worldSettings={features:["Discord"]};return t}}
