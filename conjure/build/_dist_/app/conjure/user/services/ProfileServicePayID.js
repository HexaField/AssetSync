import c from"./ProfileService.js";import d from"./payid/PayIDHandler.js";export default class D extends c{constructor(e){super(e,"PayID");this.payIDHandler=new d(this),this.openPayIDScreen=this.openPayIDScreen.bind(this)}async initialise(){super.initialise(),await this.payIDHandler.initialise()}openPayIDScreen(){this.profile.conjure.getScreens().showScreen(this.profile.conjure.getScreens().screenPayID)}getPreferredID(){return this.payIDHandler.activeID}getBalanceOnPreferred(){return this.payIDHandler.getBalance(this.getPreferredID())}sendPayment(e,a,t){this.payIDHandler.sendPayment(e,a,t)&&this.conjure.getGlobalHUD().log("Successfully sent "+e+" from "+t+" to "+a)}getSchema(){return{linkButton:{type:"button",buttonText:"Edit Info",ignoreLabel:!0,callback:this.openPayIDScreen}}}toJson(){let e={domains:{},activeID:this.payIDHandler.activeID};for(let a of this.payIDHandler.domains){e.domains[a.getDomain()]={};for(let t of a.accounts){e.domains[a.getDomain()][t.getAccount()]={};for(let n of t.wallets)e.domains[a.getDomain()][t.getAccount()][n.getAddress()]=n.getInfo()}}return console.log("PayID toJson",e),e}async readFromJson(e){let a=Object.keys(e.domains);for(let t of a){let n=this.payIDHandler.addDomain(t)||this.payIDHandler.getDomain(t);if(n){let s=Object.keys(e.domains[t]);for(let o of s){let r=await this.payIDHandler.addAccount(n,o);if(r){let l=Object.keys(e.domains[t][o]);for(let i of l)console.log(i,e.domains[t][o][i]),await this.payIDHandler.addWallet(n,r,e.domains[t][o][i])}}}}this.payIDHandler.activeID=e.activeID}}
