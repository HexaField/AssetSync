import{r as Nn,e as $,t as qe,f as st,c as dr,v as Ve,s as Hl,a as zl,b as On,d as Dn,g as Ae,h as te,i as Bt,j as _n,k as zt,l as Lt,m as q,p as Sg,u as Ag,n as Tg,o as Kl,q as Wl,w as Xl,x as es,y as Cg,z as Js}from"./index-1cb6efae.js";import{c as le,a as ge,g as Ql,b as Ig}from"./_commonjsHelpers-0597c316.js";import{p as _e}from"./env-435c5b99.js";import{i as Yl,a as Sc,b as Rg,c as Zs,o as Jl,p as kg,f as Zl}from"./path-bf8f9db7.js";(function(){if(typeof globalThis=="object")return;Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__})();var Mn=globalThis,Pg=(e,t=1,r)=>{if(r={indent:" ",includeEmptyLines:!1,...r},typeof e!="string")throw new TypeError(`Expected \`input\` to be a \`string\`, got \`${typeof e}\``);if(typeof t!="number")throw new TypeError(`Expected \`count\` to be a \`number\`, got \`${typeof t}\``);if(typeof r.indent!="string")throw new TypeError(`Expected \`options.indent\` to be a \`string\`, got \`${typeof r.indent}\``);if(t===0)return e;const n=r.includeEmptyLines?/^/gm:/^(?!\s*$)/gm;return e.replace(n,r.indent.repeat(t))};const eh=/\s+at.*(?:\(|\s)(.*)\)?/,Ng=/^(?:(?:(?:node|(?:internal\/[\w/]*|.*node_modules\/(?:babel-polyfill|pirates)\/.*)?\w+)\.js:\d+:\d+)|native)/,Og=typeof Nn.homedir=="undefined"?"":Nn.homedir();var Dg=(e,t)=>(t=Object.assign({pretty:!1},t),e.replace(/\\/g,"/").split(`
`).filter(r=>{const n=r.match(eh);if(n===null||!n[1])return!0;const i=n[1];return i.includes(".app/Contents/Resources/electron.asar")||i.includes(".app/Contents/Resources/default_app.asar")?!1:!Ng.test(i)}).filter(r=>r.trim()!=="").map(r=>t.pretty?r.replace(eh,(n,i)=>n.replace(i,i.replace(Og,"~"))):r).join(`
`));const Mg=e=>e.replace(/\s+at .*aggregate-error\/index.js:\d+:\d+\)?/g,"");class xg extends Error{constructor(e){if(!Array.isArray(e))throw new TypeError(`Expected input to be an Array, got ${typeof e}`);e=[...e].map(r=>r instanceof Error?r:r!==null&&typeof r=="object"?Object.assign(new Error(r.message),r):new Error(r));let t=e.map(r=>typeof r.stack=="string"?Mg(Dg(r.stack)):String(r)).join(`
`);t=`
`+Pg(t,4),super(t),this.name="AggregateError",Object.defineProperty(this,"_errors",{value:e})}*[Symbol.iterator](){for(const e of this._errors)yield e}}var th=xg;class rh extends Error{constructor(e){super(e||"Promise was canceled");this.name="CancelError"}get isCanceled(){return!0}}class Ac{static fn(e){return(...t)=>new Ac((r,n,i)=>{t.push(i),e(...t).then(r,n)})}constructor(e){this._cancelHandlers=[],this._isPending=!0,this._isCanceled=!1,this._rejectOnCancel=!0,this._promise=new Promise((t,r)=>{this._reject=r;const n=s=>{this._isPending=!1,t(s)},i=s=>{this._isPending=!1,r(s)},a=s=>{if(!this._isPending)throw new Error("The `onCancel` handler was attached after the promise settled.");this._cancelHandlers.push(s)};return Object.defineProperties(a,{shouldReject:{get:()=>this._rejectOnCancel,set:s=>{this._rejectOnCancel=s}}}),e(n,i,a)})}then(e,t){return this._promise.then(e,t)}catch(e){return this._promise.catch(e)}finally(e){return this._promise.finally(e)}cancel(e){if(!this._isPending||this._isCanceled)return;if(this._cancelHandlers.length>0)try{for(const t of this._cancelHandlers)t()}catch(t){this._reject(t)}this._isCanceled=!0,this._rejectOnCancel&&this._reject(new rh(e))}get isCanceled(){return this._isCanceled}}Object.setPrototypeOf(Ac.prototype,Promise.prototype);var Tc=Ac,Bg=rh;Tc.CancelError=Bg;class nh extends Error{}const Lg=(e,t)=>new Tc((r,n,i)=>{const{count:a,filter:s=()=>!0}=t;if(!Number.isFinite(a)){n(new TypeError(`Expected a finite number, got ${typeof t.count}`));return}const c=[],o=[];let u=0,l=!1;const f=new Set,_=()=>(c.length===a&&(r(c),l=!0),u-o.length<a&&(n(new th(o)),l=!0),l),p=()=>{for(const I of e)!f.has(I)&&typeof I.cancel=="function"&&I.cancel()};i(p);for(const I of e)u++,(async()=>{try{const d=await I;if(l)return;if(!s(d))throw new nh("Value does not satisfy filter");c.push(d)}catch(d){o.push(d)}finally{f.add(I),!l&&_()&&p()}})();a>u&&(n(new RangeError(`Expected input to contain at least ${t.count} items, but contains ${u} items`)),p())});var eo=Lg,jg=th,Ug=nh;eo.AggregateError=jg,eo.FilterError=Ug;var to=(e,t)=>{const r=eo(e,{...t,count:1});return Tc.fn(async n=>{n(()=>{r.cancel()});const[i]=await r;return i})()},Fg=eo.AggregateError;to.AggregateError=Fg;var qg=e=>{const t=e._modules.peerRouting||[];return e._dht&&t.unshift(e._dht),{findPeer:async(r,n)=>{if(!t.length)throw $(new Error("No peer routers available"),"NO_ROUTERS_AVAILABLE");return to(t.map(async i=>{const a=await i.findPeer(r,n);if(!a||Object.keys(a).length===0)throw $(new Error("not found"),"NOT_FOUND");return a}))}}},Gg={NOT_STARTED_YET:"The libp2p node is not started yet",DHT_DISABLED:"DHT is not available",CONN_ENCRYPTION_REQUIRED:"At least one connection encryption module is required"},$g={DHT_DISABLED:"ERR_DHT_DISABLED",PUBSUB_NOT_STARTED:"ERR_PUBSUB_NOT_STARTED",DHT_NOT_STARTED:"ERR_DHT_NOT_STARTED",CONN_ENCRYPTION_REQUIRED:"ERR_CONN_ENCRYPTION_REQUIRED",ERR_CONNECTION_ENDED:"ERR_CONNECTION_ENDED",ERR_CONNECTION_FAILED:"ERR_CONNECTION_FAILED",ERR_NODE_NOT_STARTED:"ERR_NODE_NOT_STARTED",ERR_ALREADY_ABORTED:"ERR_ALREADY_ABORTED",ERR_NO_VALID_ADDRESSES:"ERR_NO_VALID_ADDRESSES",ERR_DISCOVERED_SELF:"ERR_DISCOVERED_SELF",ERR_DUPLICATE_TRANSPORT:"ERR_DUPLICATE_TRANSPORT",ERR_ENCRYPTION_FAILED:"ERR_ENCRYPTION_FAILED",ERR_HOP_REQUEST_FAILED:"ERR_HOP_REQUEST_FAILED",ERR_INVALID_KEY:"ERR_INVALID_KEY",ERR_INVALID_MESSAGE:"ERR_INVALID_MESSAGE",ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS",ERR_INVALID_PEER:"ERR_INVALID_PEER",ERR_MUXER_UNAVAILABLE:"ERR_MUXER_UNAVAILABLE",ERR_TIMEOUT:"ERR_TIMEOUT",ERR_TRANSPORT_UNAVAILABLE:"ERR_TRANSPORT_UNAVAILABLE",ERR_TRANSPORT_DIAL_FAILED:"ERR_TRANSPORT_DIAL_FAILED",ERR_UNSUPPORTED_PROTOCOL:"ERR_UNSUPPORTED_PROTOCOL",ERR_INVALID_MULTIADDR:"ERR_INVALID_MULTIADDR",ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"},It={messages:Gg,codes:$g};const Vg=async e=>{const t=[];for await(const r of e)t.push(r);return t};var Hg=Vg;const{messages:Cc,codes:Ic}=It;var zg=e=>{const t=e._modules.contentRouting||[],r=e._dht;return r&&t.unshift(r),{async*findProviders(n,i){if(!t.length)throw $(new Error("No content routers available"),"NO_ROUTERS_AVAILABLE");const a=await to(t.map(async s=>{const c=await Hg(s.findProviders(n,i));if(!c||!c.length)throw $(new Error("not found"),"NOT_FOUND");return c}));for(const s of a)yield s},async provide(n){if(!t.length)throw $(new Error("No content routers available"),"NO_ROUTERS_AVAILABLE");return Promise.all(t.map(i=>i.provide(n)))},async put(n,i,a){if(!e.isStarted()||!r.isStarted)throw $(new Error(Cc.NOT_STARTED_YET),Ic.DHT_NOT_STARTED);return r.put(n,i,a)},async get(n,i){if(!e.isStarted()||!r.isStarted)throw $(new Error(Cc.NOT_STARTED_YET),Ic.DHT_NOT_STARTED);return r.get(n,i)},async getMany(n,i,a){if(!e.isStarted()||!r.isStarted)throw $(new Error(Cc.NOT_STARTED_YET),Ic.DHT_NOT_STARTED);return r.getMany(n,i,a)}}};const ih="[a-fA-F\\d:]",ii=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${ih})|(?<=${ih})(?=\\s|$))`:"",zr="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",ot="[a-fA-F\\d]{1,4}",ro=`
(
(?:${ot}:){7}(?:${ot}|:)|                                // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${ot}:){6}(?:${zr}|:${ot}|:)|                         // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${ot}:){5}(?::${zr}|(:${ot}){1,2}|:)|                 // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${ot}:){4}(?:(:${ot}){0,1}:${zr}|(:${ot}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${ot}:){3}(?:(:${ot}){0,2}:${zr}|(:${ot}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${ot}:){2}(?:(:${ot}){0,3}:${zr}|(:${ot}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${ot}:){1}(?:(:${ot}){0,4}:${zr}|(:${ot}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::((?::${ot}){0,5}:${zr}|(?::${ot}){1,7}|:))           // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(%[0-9a-zA-Z]{1,})?                                           // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),Kg=new RegExp(`(?:^${zr}$)|(?:^${ro}$)`),Wg=new RegExp(`^${zr}$`),Xg=new RegExp(`^${ro}$`),Rc=e=>e&&e.exact?Kg:new RegExp(`(?:${ii(e)}${zr}${ii(e)})|(?:${ii(e)}${ro}${ii(e)})`,"g");Rc.v4=e=>e&&e.exact?Wg:new RegExp(`${ii(e)}${zr}${ii(e)}`,"g"),Rc.v6=e=>e&&e.exact?Xg:new RegExp(`${ii(e)}${ro}${ii(e)}`,"g");var kc=Rc;const ra=e=>kc({exact:!0}).test(e);ra.v4=e=>kc.v4({exact:!0}).test(e),ra.v6=e=>kc.v6({exact:!0}).test(e),ra.version=e=>ra(e)?ra.v4(e)?4:6:void 0;var Pc=ra;const Qg=Pc,Nc=Pc.v4,ah=Pc.v6,sh=function(e,t,r){r=~~r;var n;if(Nc(e))n=t||new Uint8Array(r+4),e.split(/\./g).map(function(l){n[r++]=parseInt(l,10)&255});else if(ah(e)){var i=e.split(":",8),a;for(a=0;a<i.length;a++){var s=Nc(i[a]),c;s&&(c=sh(i[a]),i[a]=qe(c.slice(0,2),"base16")),c&&++a<8&&i.splice(a,0,qe(c.slice(2,4),"base16"))}if(i[0]==="")for(;i.length<8;)i.unshift("0");else if(i[i.length-1]==="")for(;i.length<8;)i.push("0");else if(i.length<8){for(a=0;a<i.length&&i[a]!=="";a++);var o=[a,"1"];for(a=9-i.length;a>0;a--)o.push("0");i.splice.apply(i,o)}for(n=t||new Uint8Array(r+16),a=0;a<i.length;a++){var u=parseInt(i[a],16);n[r++]=u>>8&255,n[r++]=u&255}}if(!n)throw Error("Invalid ip address: "+e);return n},Yg=function(e,t,r){t=~~t,r=r||e.length-t;var n=[],i;const a=new DataView(e.buffer);if(r===4){for(let s=0;s<r;s++)n.push(e[t+s]);i=n.join(".")}else if(r===16){for(let s=0;s<r;s+=2)n.push(a.getUint16(t+s).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i};var no={isIP:Qg,isV4:Nc,isV6:ah,toBytes:sh,toString:Yg};function tr(e){if(typeof e=="number"){if(tr.codes[e])return tr.codes[e];throw new Error("no protocol with code: "+e)}else if(typeof e=="string"||e instanceof String){if(tr.names[e])return tr.names[e];throw new Error("no protocol with name: "+e)}throw new Error("invalid protocol id type: "+e)}const Cr=-1;tr.lengthPrefixedVarSize=Cr,tr.V=Cr,tr.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Cr,"ip6zone"],[53,Cr,"dns","resolvable"],[54,Cr,"dns4","resolvable"],[55,Cr,"dns6","resolvable"],[56,Cr,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Cr,"unix",!1,"path"],[421,Cr,"ipfs"],[421,Cr,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Cr,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Cr,"memory"]],tr.names={},tr.codes={},tr.table.map(e=>{const t=oh.apply(null,e);tr.codes[t.code]=t,tr.names[t.name]=t}),tr.object=oh;function oh(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(i)}}var En=tr,ch=ts;function ts(e,t){return t instanceof Uint8Array?ts.toString(e,t):ts.toBytes(e,t)}ts.toString=function(t,r){t=En(t);switch(t.code){case 4:case 41:return Jg(r);case 6:case 273:case 33:case 132:return lh(r);case 53:case 54:case 55:case 56:case 400:case 777:return eb(r);case 421:return rb(r);case 444:return hh(r);case 445:return hh(r);default:return qe(r,"base16")}},ts.toBytes=function(t,r){t=En(t);switch(t.code){case 4:return uh(r);case 41:return uh(r);case 6:case 273:case 33:case 132:return Oc(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return Zg(r);case 421:return tb(r);case 444:return nb(r);case 445:return ib(r);default:return st(r,"base16")}};function uh(e){if(!no.isIP(e))throw new Error("invalid ip address");return no.toBytes(e)}function Jg(e){const t=no.toString(e);if(!t||!no.isIP(t))throw new Error("invalid ip address");return t}function Oc(e){const t=new ArrayBuffer(2),r=new DataView(t);return r.setUint16(0,e),new Uint8Array(t)}function lh(e){const t=new DataView(e.buffer);return t.getUint16(0)}function Zg(e){const t=st(e),r=Uint8Array.from(Ve.encode(t.length));return dr([r,t],r.length+t.length)}function eb(e){const t=Ve.decode(e);if(e=e.slice(Ve.decode.bytes),e.length!==t)throw new Error("inconsistent lengths");return qe(e)}function tb(e){const t=new Hl(e).multihash,r=Uint8Array.from(Ve.encode(t.length));return dr([r,t],r.length+t.length)}function rb(e){const t=Ve.decode(e),r=e.slice(Ve.decode.bytes);if(r.length!==t)throw new Error("inconsistent lengths");return qe(r,"base58btc")}function nb(e){const t=e.split(":");if(t.length!==2)throw new Error("failed to parse onion addr: "+t+" does not contain a port number");if(t[0].length!==16)throw new Error("failed to parse onion addr: "+t[0]+" not a Tor onion address.");const r=zl.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Oc(n);return dr([r,i],r.length+i.length)}function ib(e){const t=e.split(":");if(t.length!==2)throw new Error("failed to parse onion addr: "+t+" does not contain a port number");if(t[0].length!==56)throw new Error("failed to parse onion addr: "+t[0]+" not a Tor onion3 address.");const r=zl.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Oc(n);return dr([r,i],r.length+i.length)}function hh(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2),n=qe(t,"base32"),i=lh(r);return n+":"+i}var Kr={stringToStringTuples:dh,stringTuplesToString:ph,tuplesToStringTuples:mh,stringTuplesToTuples:fh,bytesToTuples:Dc,tuplesToBytes:gh,bytesToString:ab,stringToBytes:yh,fromString:sb,fromBytes:vh,validateBytes:Mc,isValidBytes:ob,cleanPath:io,ParseError:xc,protoFromTuple:rs,sizeForAddr:bh};function dh(e){const t=[],r=e.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let n=0;n<r.length;n++){const i=r[n],a=En(i);if(a.size===0){t.push([i]);continue}if(n++,n>=r.length)throw xc("invalid address: "+e);if(a.path){t.push([i,io(r.slice(n).join("/"))]);break}t.push([i,r[n]])}return t}function ph(e){const t=[];return e.map(r=>{const n=rs(r);t.push(n.name),r.length>1&&t.push(r[1])}),io(t.join("/"))}function fh(e){return e.map(t=>{Array.isArray(t)||(t=[t]);const r=rs(t);return t.length>1?[r.code,ch.toBytes(r.code,t[1])]:[r.code]})}function mh(e){return e.map(t=>{const r=rs(t);return t.length>1?[r.code,ch.toString(r.code,t[1])]:[r.code]})}function gh(e){return vh(dr(e.map(t=>{const r=rs(t);let n=Uint8Array.from(Ve.encode(r.code));return t.length>1&&(n=dr([n,t[1]])),n})))}function bh(e,t){if(e.size>0)return e.size/8;if(e.size===0)return 0;{const r=Ve.decode(t);return r+Ve.decode.bytes}}function Dc(e){const t=[];let r=0;for(;r<e.length;){const n=Ve.decode(e,r),i=Ve.decode.bytes,a=En(n),s=bh(a,e.slice(r+i));if(s===0){t.push([n]),r+=i;continue}const c=e.slice(r+i,r+i+s);if(r+=s+i,r>e.length)throw xc("Invalid address Uint8Array: "+qe(e,"base16"));t.push([n,c])}return t}function ab(e){const t=Dc(e),r=mh(t);return ph(r)}function yh(e){e=io(e);const t=dh(e),r=fh(t);return gh(r)}function sb(e){return yh(e)}function vh(e){const t=Mc(e);if(t)throw t;return Uint8Array.from(e)}function Mc(e){try{Dc(e)}catch(t){return t}}function ob(e){return Mc(e)===void 0}function io(e){return"/"+e.trim().split("/").filter(t=>t).join("/")}function xc(e){return new Error("Error parsing address: "+e)}function rs(e){const t=En(e[0]);return t}var Pe=le(function(e,t){const r=Symbol.for("nodejs.util.inspect.custom"),n=On.proto(function(i){if(!(this instanceof n))return new n(i);if(i==null&&(i=""),i instanceof Uint8Array)this.bytes=Kr.fromBytes(i);else if(typeof i=="string"||i instanceof String){if(i.length>0&&i.charAt(0)!=="/")throw new Error(`multiaddr "${i}" must start with a "/"`);this.bytes=Kr.fromString(i)}else if(i.bytes&&i.protos&&i.protoCodes)this.bytes=Kr.fromBytes(i.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});n.prototype.toString=function(){return Kr.bytesToString(this.bytes)},n.prototype.toJSON=n.prototype.toString,n.prototype.toOptions=function(){const a={},s=this.toString().split("/");return a.family=s[1]==="ip4"?"ipv4":"ipv6",a.host=s[2],a.transport=s[3],a.port=parseInt(s[4]),a},n.prototype[r]=function(){return"<Multiaddr "+qe(this.bytes,"base16")+" - "+Kr.bytesToString(this.bytes)+">"},n.prototype.inspect=function(){return"<Multiaddr "+qe(this.bytes,"base16")+" - "+Kr.bytesToString(this.bytes)+">"},n.prototype.protos=function(){return this.protoCodes().map(a=>Object.assign({},En(a)))},n.prototype.protoCodes=function(){const a=[],s=this.bytes;let c=0;for(;c<s.length;){const o=Ve.decode(s,c),u=Ve.decode.bytes,l=En(o),f=Kr.sizeForAddr(l,s.slice(c+u));c+=f+u,a.push(o)}return a},n.prototype.protoNames=function(){return this.protos().map(a=>a.name)},n.prototype.tuples=function(){return Kr.bytesToTuples(this.bytes)},n.prototype.stringTuples=function(){const a=Kr.bytesToTuples(this.bytes);return Kr.tuplesToStringTuples(a)},n.prototype.encapsulate=function(a){return a=n(a),n(this.toString()+a.toString())},n.prototype.decapsulate=function(a){a=a.toString();const s=this.toString(),c=s.lastIndexOf(a);if(c<0)throw new Error("Address "+this+" does not contain subaddress: "+a);return n(s.slice(0,c))},n.prototype.decapsulateCode=function(a){const s=this.tuples();for(let c=s.length-1;c>=0;c--)if(s[c][0]===a)return n(Kr.tuplesToBytes(s.slice(0,c)));return this},n.prototype.getPeerId=function(){let a=null;try{const s=this.stringTuples().filter(c=>{if(c[0]===En.names.ipfs.code)return!0});a=s.pop()[1],a=qe(new Hl(a).multihash,"base58btc")}catch(s){a=null}return a},n.prototype.getPath=function(){let a=null;try{a=this.stringTuples().filter(s=>{const c=En(s[0]);if(c.path)return!0})[0][1]}catch(s){a=null}return a},n.prototype.equals=function(a){return Dn(this.bytes,a.bytes)},n.prototype.nodeAddress=function(){const a=this.protoCodes(),s=this.protoNames(),c=this.toString().split("/").slice(1);if(c.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(a[0]!==4&&a[0]!==41&&a[0]!==54&&a[0]!==55)throw new Error(`no protocol with name: "'${s[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(c[2]!=="tcp"&&c[2]!=="udp")throw new Error(`no protocol with name: "'${s[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:a[0]===41||a[0]===55?6:4,address:c[1],port:parseInt(c[3])}},n.fromNodeAddress=function(a,s){if(!a)throw new Error("requires node address object");if(!s)throw new Error("requires transport protocol");let c;switch(a.family){case"IPv4":c="ip4";break;case"IPv6":c="ip6";break;default:throw Error(`Invalid addr family. Got '${a.family}' instead of 'IPv4' or 'IPv6'`)}return n("/"+[c,a.address,s,a.port].join("/"))},n.prototype.isThinWaistAddress=function(a){const s=(a||this).protos();return s.length!==2||s[0].code!==4&&s[0].code!==41?!1:!(s[1].code!==6&&s[1].code!==273)},n.protocols=En,n.isName=function(a){return n.isMultiaddr(a)?a.protos().some(s=>s.resolvable):!1},n.resolve=function(a){return!n.isMultiaddr(a)||!n.isName(a)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},t=e.exports=n});const{codes:cb}=It;function ub(e){typeof e=="string"&&(e=Pe(e));let t;if(Pe.isMultiaddr(e)){t=e;try{e=Ae.createFromB58String(e.getPeerId())}catch(r){throw $(new Error(`${e} is not a valid peer type`),cb.ERR_INVALID_MULTIADDR)}}return{id:e,multiaddrs:t?[t]:void 0}}var ao=ub,so=e=>{if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype};const{hasOwnProperty:wh}=Object.prototype,{propertyIsEnumerable:lb}=Object,na=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0}),hb=ge,_h={concatArrays:!1,ignoreUndefined:!1},oo=e=>{const t=[];for(const r in e)wh.call(e,r)&&t.push(r);if(Object.getOwnPropertySymbols){const r=Object.getOwnPropertySymbols(e);for(const n of r)lb.call(e,n)&&t.push(n)}return t};function ia(e){return Array.isArray(e)?db(e):so(e)?pb(e):e}function db(e){const t=e.slice(0,0);return oo(e).forEach(r=>{na(t,r,ia(e[r]))}),t}function pb(e){const t=Object.getPrototypeOf(e)===null?Object.create(null):{};return oo(e).forEach(r=>{na(t,r,ia(e[r]))}),t}const Eh=(e,t,r,n)=>(r.forEach(i=>{if(typeof t[i]=="undefined"&&n.ignoreUndefined)return;i in e&&e[i]!==Object.getPrototypeOf(e)?na(e,i,Bc(e[i],t[i],n)):na(e,i,ia(t[i]))}),e),fb=(e,t,r)=>{let n=e.slice(0,0),i=0;return[e,t].forEach(a=>{const s=[];for(let c=0;c<a.length;c++){if(!wh.call(a,c))continue;s.push(String(c)),a===e?na(n,i++,a[c]):na(n,i++,ia(a[c]))}n=Eh(n,a,oo(a).filter(c=>!s.includes(c)),r)}),n};function Bc(e,t,r){return r.concatArrays&&Array.isArray(e)&&Array.isArray(t)?fb(e,t,r):!so(t)||!so(e)?ia(t):Eh(e,t,oo(t),r)}var co=function(...e){const t=Bc(ia(_h),this!==hb&&this||{},_h);let r={_:{}};for(const n of e){if(n===void 0)continue;if(!so(n))throw new TypeError("`"+n+"` is not an Option Object");r=Bc(r,{_:n},t)}return r._},ns={DIAL_TIMEOUT:3e4,MAX_PARALLEL_DIALS:100,MAX_PER_PEER_DIALS:4,METRICS:{computeThrottleMaxQueueSize:1e3,computeThrottleTimeout:2e3,movingAverageIntervals:[60*1e3,5*60*1e3,15*60*1e3],maxOldPeersRetention:50}};const Sh=async e=>{try{const t=await e;return{isFulfilled:!0,isRejected:!1,value:t}}catch(t){return{isFulfilled:!1,isRejected:!0,reason:t}}};var uo=Sh,mb=Sh;uo.default=mb;const Ah=(e,...t)=>new Promise(r=>{r(e(...t))});var Th=Ah,gb=Ah;Th.default=gb;const Ch=e=>{if(!((Number.isInteger(e)||e===Infinity)&&e>0))return Promise.reject(new TypeError("Expected `concurrency` to be a number from 1 and up"));const t=[];let r=0;const n=()=>{r--,t.length>0&&t.shift()()},i=(c,o,...u)=>{r++;const l=Th(c,...u);o(l),l.then(n,n)},a=(c,o,...u)=>{r<e?i(c,o,...u):t.push(i.bind(null,c,o,...u))},s=(c,...o)=>new Promise(u=>a(c,u,...o));return Object.defineProperties(s,{activeCount:{get:()=>r},pendingCount:{get:()=>t.length},clearQueue:{value:()=>{t.length=0}}}),s};var Ih=Ch,bb=Ch;Ih.default=bb;var yb=async(e,t={})=>{const{concurrency:r=Infinity}=t,n=Ih(r);return Promise.all(e.map(i=>i&&typeof i.then=="function"?uo(i):typeof i=="function"?uo(n(()=>i())):uo(Promise.resolve(i))))};const{codes:aa}=It,ai=te("libp2p:transports");ai.error=te("libp2p:transports:error");class Rh{constructor({libp2p:e,upgrader:t,faultTolerance:r=Lc.FATAL_ALL}){this.libp2p=e,this.upgrader=t,this._transports=new Map,this._listeners=new Map,this.faultTolerance=r}add(e,t,r={}){if(ai("adding %s",e),!e)throw $(new Error(`Transport must have a valid key, was given '${e}'`),aa.ERR_INVALID_KEY);if(this._transports.has(e))throw $(new Error("There is already a transport with this key"),aa.ERR_DUPLICATE_TRANSPORT);const n=new t({...r,libp2p:this.libp2p,upgrader:this.upgrader});this._transports.set(e,n),this._listeners.has(e)||this._listeners.set(e,[])}async close(){const e=[];for(const[t,r]of this._listeners)for(ai("closing listeners for %s",t);r.length;){const n=r.pop();e.push(n.close())}await Promise.all(e),ai("all listeners closed");for(const t of this._listeners.keys())this._listeners.set(t,[])}async dial(e,t){const r=this.transportForMultiaddr(e);if(!r)throw $(new Error(`No transport available for address ${String(e)}`),aa.ERR_TRANSPORT_UNAVAILABLE);try{return await r.dial(e,t)}catch(n){throw n.code||(n.code=aa.ERR_TRANSPORT_DIAL_FAILED),n}}getAddrs(){let e=[];for(const t of this._listeners.values())for(const r of t)e=[...e,...r.getAddrs()];return e}getTransports(){return this._transports.values()}transportForMultiaddr(e){for(const t of this._transports.values()){const r=t.filter([e]);if(r.length)return t}return null}async listen(){const e=this.libp2p.addressManager.getListenAddrs();if(e.length===0){ai("no addresses were provided for listening, this node is dial only");return}const t=[];for(const[r,n]of this._transports.entries()){const i=n.filter(e),a=[];for(const o of i){ai("creating listener for %s on %s",r,o);const u=n.createListener({},this.onConnection);this._listeners.get(r).push(u),a.push(u.listen(o))}if(a.length===0){t.push(r);continue}const s=await yb(a),c=s.find(o=>o.isFulfilled===!0);if(!c)throw $(new Error(`Transport (${r}) could not listen on any available address`),aa.ERR_NO_VALID_ADDRESSES)}if(t.length===this._transports.size){const r=`no valid addresses were provided for transports [${t}]`;if(this.faultTolerance===Lc.FATAL_ALL)throw $(new Error(r),aa.ERR_NO_VALID_ADDRESSES);ai(`libp2p in dial mode only: ${r}`)}}async remove(e){if(ai("removing %s",e),this._listeners.has(e))for(const t of this._listeners.get(e))await t.close();this._transports.delete(e),this._listeners.delete(e)}async removeAll(){const e=[];for(const t of this._transports.keys())e.push(this.remove(t));await Promise.all(e)}}const Lc={FATAL_ALL:0,NO_FATAL:1};Rh.FaultTolerance=Lc;var kh=Rh;const{FaultTolerance:vb}=kh,wb={addresses:{listen:[],announce:[],noAnnounce:[]},connectionManager:{minConnections:25},transportManager:{faultTolerance:vb.FATAL_ALL},dialer:{maxParallelDials:ns.MAX_PARALLEL_DIALS,maxDialsPerPeer:ns.MAX_PER_PEER_DIALS,dialTimeout:ns.DIAL_TIMEOUT},metrics:{enabled:!1},peerStore:{persistence:!1,threshold:5},config:{dht:{enabled:!1,kBucketSize:20,randomWalk:{enabled:!1,queriesPerPeriod:1,interval:3e5,timeout:1e4}},peerDiscovery:{autoDial:!0},pubsub:{enabled:!0,emitSelf:!0,signMessages:!0,strictSigning:!0},relay:{enabled:!0,hop:{enabled:!1,active:!1}},transport:{}}};var _b=e=>{if(e=co(wb,e),e.modules.transport.length<1)throw new Error("'options.modules.transport' must contain at least 1 transport");return e},Eb={validate:_b};const Sb=te("libp2p:addresses");Sb.error=te("libp2p:addresses:error");class Ab{constructor({listen:e=[],announce:t=[],noAnnounce:r=[]}={}){this.listen=new Set(e),this.announce=new Set(t),this.noAnnounce=new Set(r)}getListenAddrs(){return Array.from(this.listen).map(e=>Pe(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>Pe(e))}getNoAnnounceAddrs(){return Array.from(this.noAnnounce).map(e=>Pe(e))}}var Tb=Ab;const jc=te("latency-monitor:VisibilityChangeEmitter");var Cb=class extends Bt{constructor(){super();if(typeof document=="undefined"){jc('This is not a browser, no "document" found. Stopping.');return}this._initializeVisibilityVarNames(),this._addVisibilityChangeListener()}_initializeVisibilityVarNames(){let t,r;typeof document.hidden!="undefined"?(t="hidden",r="visibilitychange"):typeof document.mozHidden!="undefined"?(t="mozHidden",r="mozvisibilitychange"):typeof document.msHidden!="undefined"?(t="msHidden",r="msvisibilitychange"):typeof document.webkitHidden!="undefined"&&(t="webkitHidden",r="webkitvisibilitychange"),this._hidden=t,this._visibilityChange=r}_addVisibilityChangeListener(){typeof document.addEventListener=="undefined"||typeof document[this._hidden]=="undefined"?jc("Checking page visibility requires a browser that supports the Page Visibility API."):document.addEventListener(this._visibilityChange,this._handleVisibilityChange.bind(this),!1)}isVisible(){return this._hidden===void 0||document[this._hidden]===void 0?void 0:!document[this._hidden]}_handleVisibilityChange(){const t=!document[this._hidden];jc(t?"Page Visible":"Page Hidden"),this.emit("visibilityChange",t)}};const xn=te("latency-monitor:LatencyMonitor");class Ib extends Bt{constructor({latencyCheckIntervalMs:e,dataEmitIntervalMs:t,asyncTestFn:r,latencyRandomPercentage:n}={}){super();const i=this;i.latencyCheckIntervalMs=e||500,i.latencyRandomPercentage=n||10,i._latecyCheckMultiply=2*(i.latencyRandomPercentage/100)*i.latencyCheckIntervalMs,i._latecyCheckSubtract=i._latecyCheckMultiply/2,i.dataEmitIntervalMs=t===null||t===0?void 0:t||5*1e3,xn("latencyCheckIntervalMs: %s dataEmitIntervalMs: %s",i.latencyCheckIntervalMs,i.dataEmitIntervalMs),i.dataEmitIntervalMs?xn("Expecting ~%s events per summary",i.latencyCheckIntervalMs/i.dataEmitIntervalMs):xn("Not emitting summaries"),i.asyncTestFn=r,Mn.process&&Mn.process.hrtime?(xn("Using process.hrtime for timing"),i.now=Mn.process.hrtime,i.getDeltaMS=a=>{const s=i.now(a);return s[0]*1e3+s[1]/1e6}):typeof window!="undefined"&&window.performance&&window.performance.now?(xn("Using performance.now for timing"),i.now=window.performance.now.bind(window.performance),i.getDeltaMS=a=>Math.round(i.now()-a)):(xn("Using Date.now for timing"),i.now=Date.now,i.getDeltaMS=a=>i.now()-a),i._latencyData=i._initLatencyData(),Rb()&&(i._visibilityChangeEmitter=new Cb,i._visibilityChangeEmitter.on("visibilityChange",a=>{a?i._startTimers():(i._emitSummary(),i._stopTimers())})),(!i._visibilityChangeEmitter||i._visibilityChangeEmitter.isVisible())&&i._startTimers()}_startTimers(){if(this._checkLatencyID)return;this._checkLatency(),this.dataEmitIntervalMs&&(this._emitIntervalID=setInterval(()=>this._emitSummary(),this.dataEmitIntervalMs),typeof this._emitIntervalID.unref=="function"&&this._emitIntervalID.unref())}_stopTimers(){this._checkLatencyID&&(clearTimeout(this._checkLatencyID),this._checkLatencyID=void 0),this._emitIntervalID&&(clearInterval(this._emitIntervalID),this._emitIntervalID=void 0)}_emitSummary(){const e=this.getSummary();e.events>0&&this.emit("data",e)}getSummary(){const e={events:this._latencyData.events,minMs:this._latencyData.minMs,maxMs:this._latencyData.maxMs,avgMs:this._latencyData.events?this._latencyData.totalMs/this._latencyData.events:Number.POSITIVE_INFINITY,lengthMs:this.getDeltaMS(this._latencyData.startTime)};return this._latencyData=this._initLatencyData(),xn("Summary: %O",e),e}_checkLatency(){const e=this,t=Math.random()*e._latecyCheckMultiply-e._latecyCheckSubtract,r={deltaOffset:Math.ceil(e.latencyCheckIntervalMs+t),startTime:e.now()},n=()=>{if(!this._checkLatencyID)return;const i=e.getDeltaMS(r.startTime)-r.deltaOffset;e._checkLatency(),e._latencyData.events++,e._latencyData.minMs=Math.min(e._latencyData.minMs,i),e._latencyData.maxMs=Math.max(e._latencyData.maxMs,i),e._latencyData.totalMs+=i,xn("MS: %s Data: %O",i,e._latencyData)};xn("localData: %O",r),this._checkLatencyID=setTimeout(()=>{e.asyncTestFn?(r.deltaOffset=0,r.startTime=e.now(),e.asyncTestFn(n)):(r.deltaOffset-=1,n())},r.deltaOffset),typeof this._checkLatencyID.unref=="function"&&this._checkLatencyID.unref()}_initLatencyData(){return{startTime:this.now(),minMs:Number.POSITIVE_INFINITY,maxMs:Number.NEGATIVE_INFINITY,events:0,totalMs:0}}}function Rb(){return typeof window!="undefined"}var kb=Ib,Uc=function(){return Date.now()};function Fc(e,t,r){var n=this;this._started=Uc(),this._rescheduled=0,this._scheduled=t,this._args=r,this._timer=setTimeout(i,t);function i(){n._rescheduled>0?(n._scheduled=n._rescheduled-(Uc()-n._started),n._timer=setTimeout(i,n._scheduled),n._rescheduled=0):e.apply(null,n._args)}}Fc.prototype.reschedule=function(e){var t=Uc();return t+e-(this._started+this._scheduled)<0?!1:(this._started=t,this._rescheduled=e,!0)},Fc.prototype.clear=function(){clearTimeout(this._timer)};function Pb(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("timeout needed");var e;if(arguments.length>0){e=new Array(arguments.length-2);for(var t=0;t<e.length;t++)e[t]=arguments[t+2]}return new Fc(arguments[0],arguments[1],e)}var Oi=Pb;const Ir=te("libp2p:connection-manager");Ir.error=te("libp2p:connection-manager:error");const{EventEmitter:Nb}=Bt,{ERR_INVALID_PARAMETERS:Ph}=It,Ob={maxConnections:Infinity,minConnections:0,maxData:Infinity,maxSentData:Infinity,maxReceivedData:Infinity,maxEventLoopDelay:Infinity,pollInterval:2e3,autoDialInterval:1e4,movingAverageInterval:6e4,defaultPeerValue:1};class Db extends Nb{constructor(e,t){super();if(this._libp2p=e,this._peerId=e.peerId.toB58String(),this._options=co.call({ignoreUndefined:!0},Ob,t),this._options.maxConnections<this._options.minConnections)throw $(new Error("Connection Manager maxConnections must be greater than minConnections"),Ph);Ir("options: %j",this._options),this._libp2p=e,this._peerValues=new Map,this.connections=new Map,this._started=!1,this._timer=null,this._autoDialTimeout=null,this._checkMetrics=this._checkMetrics.bind(this),this._autoDial=this._autoDial.bind(this)}get size(){return Array.from(this.connections.values()).reduce((e,t)=>e+t.length,0)}start(){this._libp2p.metrics&&(this._timer=this._timer||Oi(this._checkMetrics,this._options.pollInterval)),this._latencyMonitor=new kb({latencyCheckIntervalMs:this._options.pollInterval,dataEmitIntervalMs:this._options.pollInterval}),this._onLatencyMeasure=this._onLatencyMeasure.bind(this),this._latencyMonitor.on("data",this._onLatencyMeasure),this._started=!0,Ir("started"),this._options.autoDial&&this._autoDial()}async stop(){this._autoDialTimeout&&this._autoDialTimeout.clear(),this._timer&&this._timer.clear(),this._latencyMonitor&&this._latencyMonitor.removeListener("data",this._onLatencyMeasure),this._started=!1,await this._close(),Ir("stopped")}async _close(){const e=[];for(const t of this.connections.values())for(const r of t)e.push(r.close());await e,this.connections.clear()}setPeerValue(e,t){if(t<0||t>1)throw new Error("value should be a number between 0 and 1");e.toB58String&&(e=e.toB58String()),this._peerValues.set(e,t)}_checkMetrics(){const e=this._libp2p.metrics.global.movingAverages,t=e.dataReceived[this._options.movingAverageInterval].movingAverage();this._checkMaxLimit("maxReceivedData",t);const r=e.dataSent[this._options.movingAverageInterval].movingAverage();this._checkMaxLimit("maxSentData",r);const n=t+r;this._checkMaxLimit("maxData",n),Ir("metrics update",n),this._timer=Oi(this._checkMetrics,this._options.pollInterval)}onConnect(e){const t=e.remotePeer,r=t.toB58String(),n=this.connections.get(r);this.emit("peer:connect",e),n?n.push(e):this.connections.set(r,[e]),this._libp2p.peerStore.keyBook.set(t,t.pubKey),this._peerValues.has(r)||this._peerValues.set(r,this._options.defaultPeerValue),this._checkMaxLimit("maxConnections",this.size)}onDisconnect(e){const t=e.remotePeer.toB58String();let r=this.connections.get(t);r&&r.length>1?(r=r.filter(n=>n.id!==e.id),this.connections.set(t,r)):r&&(this.connections.delete(t),this._peerValues.delete(e.remotePeer.toB58String()),this.emit("peer:disconnect",e))}get(e){const t=this.getAll(e);return t.length?t[0]:null}getAll(e){if(!Ae.isPeerId(e))throw $(new Error("peerId must be an instance of peer-id"),Ph);const t=e.toB58String(),r=this.connections.get(t);return r?r.filter(n=>n.stat.status==="open"):[]}_onLatencyMeasure(e){this._checkMaxLimit("maxEventLoopDelay",e.avgMs)}_checkMaxLimit(e,t){const r=this._options[e];Ir("checking limit of %s. current value: %d of %d",e,t,r),t>r&&(Ir("%s: limit exceeded: %s, %d",this._peerId,e,t),this._maybeDisconnectOne())}async _autoDial(){const e=this._options.minConnections;if(this.size>=e){this._autoDialTimeout=Oi(this._autoDial,this._options.autoDialInterval);return}const t=Array.from(this._libp2p.peerStore.peers.values()).sort((r,n)=>n.protocols&&n.protocols.length&&(!r.protocols||!r.protocols.length)||n.id.pubKey&&!r.id.pubKey?1:-1);for(let r=0;r<t.length&&this.size<e;r++)if(!this.get(t[r].id)){Ir("connecting to a peerStore stored peer %s",t[r].id.toB58String());try{if(await this._libp2p.dialer.connectToPeer(t[r].id),!this._started)return}catch(n){Ir.error("could not connect to peerStore stored peer",n)}}this._autoDialTimeout=Oi(this._autoDial,this._options.autoDialInterval)}_maybeDisconnectOne(){if(this._options.minConnections<this.connections.size){const e=Array.from(this._peerValues).sort(xb);Ir("%s: sorted peer values: %j",this._peerId,e);const t=e[0];if(t){const r=t[0];Ir("%s: lowest value peer is %s",this._peerId,r),Ir("%s: closing a connection to %j",this._peerId,r);for(const n of this.connections.values())if(n[0].remotePeer.toB58String()===r){n[0].close();break}}}}}var Mb=Db;function xb(e,t){return e[1]-t[1]}const Nh=we("dns4"),Oh=we("dns6"),sa=jt(we("dns"),we("dnsaddr"),Nh,Oh),is=jt(we("ip4"),we("ip6")),oa=jt(ke(is,we("tcp")),ke(sa,we("tcp"))),Dh=ke(is,we("udp")),Mh=ke(Dh,we("utp")),ca=jt(ke(oa,we("ws")),ke(sa,we("ws"))),ua=jt(ke(oa,we("wss")),ke(sa,we("wss"))),qc=jt(ke(oa,we("http")),ke(is,we("http")),ke(sa,we("http"))),Gc=jt(ke(oa,we("https")),ke(is,we("https")),ke(sa,we("https"))),$c=jt(ke(ca,we("p2p-webrtc-star"),we("p2p")),ke(ua,we("p2p-webrtc-star"),we("p2p")),ke(ca,we("p2p-webrtc-star")),ke(ua,we("p2p-webrtc-star"))),Bb=jt(ke(ca,we("p2p-websocket-star"),we("p2p")),ke(ua,we("p2p-websocket-star"),we("p2p")),ke(ca,we("p2p-websocket-star")),ke(ua,we("p2p-websocket-star"))),xh=jt(ke(qc,we("p2p-webrtc-direct")),ke(Gc,we("p2p-webrtc-direct"))),la=jt(ca,ua,qc,Gc,$c,xh,oa,Mh),Lb=jt(ke(la,we("p2p-stardust"),we("p2p")),ke(la,we("p2p-stardust"))),si=jt(ke(la,we("p2p")),$c,we("p2p")),Bh=jt(ke(si,we("p2p-circuit"),si),ke(si,we("p2p-circuit")),ke(we("p2p-circuit"),si),ke(la,we("p2p-circuit")),ke(we("p2p-circuit"),la),we("p2p-circuit")),Lh=()=>jt(ke(Bh,Lh),Bh),ha=Lh(),jh=jt(ke(ha,si,ha),ke(si,ha),ke(ha,si),ha,si);var jb=sa,Ub=Nh,Fb=Oh,qb=is,Gb=oa,$b=Dh,Vb=Mh,Hb=qc,zb=Gc,Kb=ca,Wb=ua,Xb=Bb,Qb=$c,Yb=xh,Jb=la,Zb=Lb,ey=ha,ty=jh,ry=jh;function Uh(e){return function(r){if(!Pe.isMultiaddr(r))try{r=Pe(r)}catch(i){return!1}const n=e(r.protoNames());return n===null?!1:n.length===0}}function ke(){const e=Array.from(arguments);function t(r){return r.length<e.length?null:(e.some(n=>{if(r=typeof n=="function"?n().partialMatch(r):n.partialMatch(r),r===null)return!0}),r)}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:Uh(t),partialMatch:t}}function jt(){const e=Array.from(arguments);function t(n){let i=null;return e.some(a=>{const s=typeof a=="function"?a().partialMatch(n):a.partialMatch(n);if(s)return i=s,!0}),i}const r={toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:Uh(t),partialMatch:t};return r}function we(e){const t=e;function r(i){if(typeof i=="string")try{i=Pe(i)}catch(s){return!1}const a=i.protoNames();return a.length===1&&a[0]===t}function n(i){return i.length===0?null:i[0]===t?i.slice(1):null}return{toString:function(){return t},matches:r,partialMatch:n}}var da={DNS:jb,DNS4:Ub,DNS6:Fb,IP:qb,TCP:Gb,UDP:$b,UTP:Vb,HTTP:Hb,HTTPS:zb,WebSockets:Kb,WebSocketsSecure:Wb,WebSocketStar:Xb,WebRTCStar:Qb,WebRTCDirect:Yb,Reliable:Jb,Stardust:Zb,Circuit:ey,P2P:ty,IPFS:ry},as=_n(`
message CircuitRelay {

  enum Status {
    SUCCESS                    = 100;
    HOP_SRC_ADDR_TOO_LONG      = 220;
    HOP_DST_ADDR_TOO_LONG      = 221;
    HOP_SRC_MULTIADDR_INVALID  = 250;
    HOP_DST_MULTIADDR_INVALID  = 251;
    HOP_NO_CONN_TO_DST         = 260;
    HOP_CANT_DIAL_DST          = 261;
    HOP_CANT_OPEN_DST_STREAM   = 262;
    HOP_CANT_SPEAK_RELAY       = 270;
    HOP_CANT_RELAY_TO_SELF     = 280;
    STOP_SRC_ADDR_TOO_LONG     = 320;
    STOP_DST_ADDR_TOO_LONG     = 321;
    STOP_SRC_MULTIADDR_INVALID = 350;
    STOP_DST_MULTIADDR_INVALID = 351;
    STOP_RELAY_REFUSED         = 390;
    MALFORMED_MESSAGE          = 400;
  }

  enum Type { // RPC identifier, either HOP, STOP or STATUS
    HOP = 1;
    STOP = 2;
    STATUS = 3;
    CAN_HOP = 4;
  }

  message Peer {
    required bytes id = 1;    // peer id
    repeated bytes addrs = 2; // peer's known addresses
  }

  optional Type type = 1;     // Type of the message

  optional Peer srcPeer = 2;  // srcPeer and dstPeer are used when Type is HOP or STATUS
  optional Peer dstPeer = 3;

  optional Status code = 4;   // Status code, used when Type is STATUS
}
`),Vc=function(t){if(t){if(typeof t[Symbol.iterator]=="function")return t[Symbol.iterator]();if(typeof t[Symbol.asyncIterator]=="function")return t[Symbol.asyncIterator]();if(typeof t.next=="function")return t}throw new Error("argument is not an iterator or iterable")},Hc=class extends Error{constructor(t,r){super(t||"The operation was aborted");this.type="aborted",this.code=r||"ABORT_ERR"}};const Fh=(e,t,r)=>zc(e,Array.isArray(t)?t:[{signal:t,options:r}]),zc=(e,t)=>{e=Vc(e),t=t.map(({signal:n,options:i})=>({signal:n,options:i||{}}));async function*r(){let n;const i=()=>{n&&n()};for(const{signal:a}of t)a.addEventListener("abort",i);for(;;){let a;try{for(const{signal:c,options:o}of t)if(c.aborted){const{abortMessage:u,abortCode:l}=o;throw new Hc(u,l)}const s=new Promise((c,o)=>{n=()=>{const{options:u}=t.find(({signal:_})=>_.aborted),{abortMessage:l,abortCode:f}=u;o(new Hc(l,f))}});a=await Promise.race([s,e.next()]),n=null}catch(s){for(const{signal:u}of t)u.removeEventListener("abort",i);const c=t.find(({signal:u})=>u.aborted),o=s.type==="aborted"&&c;if(o&&c.options.onAbort&&await c.options.onAbort(e),typeof e.return=="function"&&await e.return(),o&&c.options.returnOnAbort)return;throw s}if(a.done)break;yield a.value}for(const{signal:a}of t)a.removeEventListener("abort",i)}return r()},qh=(e,t,r)=>Gh(e,Array.isArray(t)?t:[{signal:t,options:r}]),Gh=(e,t)=>r=>e(zc(r,t)),ny=(e,t,r)=>iy(e,Array.isArray(t)?t:[{signal:t,options:r}]),iy=(e,t)=>({sink:Gh(e.sink,t),source:zc(e.source,t)});var gt=Fh,ay=Hc,sy=Fh,oy=qh,cy=qh,uy=ny;gt.AbortError=ay,gt.source=sy,gt.sink=oy,gt.transform=cy,gt.duplex=uy;const ly=te("libp2p:stream:converter");function hy({stream:e,remoteAddr:t,localAddr:r},n={}){const{sink:i,source:a}=e,s={async sink(o){n.signal&&(o=gt(o,n.signal));try{await i(o)}catch(u){u.type!=="aborted"&&ly(u)}c()},source:n.signal?gt(a,n.signal):a,conn:e,localAddr:r,remoteAddr:t,timeline:{open:Date.now()},close(){i([]),c()}};function c(){s.timeline.close||(s.timeline.close=Date.now())}return s}var $h=hy,Kc={relay:"/libp2p/circuit/relay/0.1.0"};const dy=te("libp2p:circuit:listener");dy.err=te("libp2p:circuit:error:listener");var py=e=>{const t=new Bt,r=new Map;return t.listen=async n=>{const i=String(n).split("/p2p-circuit").find(c=>c!==""),a=await e._dialer.connectToPeer(Pe(i)),s=a.remoteAddr.encapsulate("/p2p-circuit");r.set(a.remotePeer.toB58String(),s),t.emit("listening")},t.close=()=>{},t.getAddrs=()=>{const n=[];for(const i of r.values())n.push(i);return n},t};const{CircuitRelay:Di}=as;function Vh(e,t){e.write({type:Di.Type.STATUS,code:t})}function fy(e,t){try{e.dstPeer.addrs.forEach(r=>Pe(r))}catch(r){throw Vh(t,e.type===Di.Type.HOP?Di.Status.HOP_DST_MULTIADDR_INVALID:Di.Status.STOP_DST_MULTIADDR_INVALID),r}try{e.srcPeer.addrs.forEach(r=>Pe(r))}catch(r){throw Vh(t,e.type===Di.Type.HOP?Di.Status.HOP_SRC_MULTIADDR_INVALID:Di.Status.STOP_SRC_MULTIADDR_INVALID),r}}var Hh={validateAddrs:fy};const{Buffer:Wr}=zt,zh=Symbol.for("BufferList");function Xe(e){if(!(this instanceof Xe))return new Xe(e);Xe._init.call(this,e)}Xe._init=function(t){Object.defineProperty(this,zh,{value:!0}),this._bufs=[],this.length=0,t&&this.append(t)},Xe.prototype._new=function(t){return new Xe(t)},Xe.prototype._offset=function(t){if(t===0)return[0,0];let r=0;for(let n=0;n<this._bufs.length;n++){const i=r+this._bufs[n].length;if(t<i||n===this._bufs.length-1)return[n,t-r];r=i}},Xe.prototype._reverseOffset=function(e){const t=e[0];let r=e[1];for(let n=0;n<t;n++)r+=this._bufs[n].length;return r},Xe.prototype.get=function(t){if(t>this.length||t<0)return;const r=this._offset(t);return this._bufs[r[0]][r[1]]},Xe.prototype.slice=function(t,r){return typeof t=="number"&&t<0&&(t+=this.length),typeof r=="number"&&r<0&&(r+=this.length),this.copy(null,0,t,r)},Xe.prototype.copy=function(t,r,n,i){if((typeof n!="number"||n<0)&&(n=0),(typeof i!="number"||i>this.length)&&(i=this.length),n>=this.length)return t||Wr.alloc(0);if(i<=0)return t||Wr.alloc(0);const a=!!t,s=this._offset(n),c=i-n;let o=c,u=a&&r||0,l=s[1];if(n===0&&i===this.length){if(!a)return this._bufs.length===1?this._bufs[0]:Wr.concat(this._bufs,this.length);for(let f=0;f<this._bufs.length;f++)this._bufs[f].copy(t,u),u+=this._bufs[f].length;return t}if(o<=this._bufs[s[0]].length-l)return a?this._bufs[s[0]].copy(t,r,l,l+o):this._bufs[s[0]].slice(l,l+o);a||(t=Wr.allocUnsafe(c));for(let f=s[0];f<this._bufs.length;f++){const _=this._bufs[f].length-l;if(o>_)this._bufs[f].copy(t,u,l),u+=_;else{this._bufs[f].copy(t,u,l,l+o),u+=_;break}o-=_,l&&(l=0)}return t.length>u?t.slice(0,u):t},Xe.prototype.shallowSlice=function(t,r){if(t=t||0,r=typeof r!="number"?this.length:r,t<0&&(t+=this.length),r<0&&(r+=this.length),t===r)return this._new();const n=this._offset(t),i=this._offset(r),a=this._bufs.slice(n[0],i[0]+1);return i[1]===0?a.pop():a[a.length-1]=a[a.length-1].slice(0,i[1]),n[1]!==0&&(a[0]=a[0].slice(n[1])),this._new(a)},Xe.prototype.toString=function(t,r,n){return this.slice(r,n).toString(t)},Xe.prototype.consume=function(t){if(t=Math.trunc(t),Number.isNaN(t)||t<=0)return this;for(;this._bufs.length;)if(t>=this._bufs[0].length)t-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift();else{this._bufs[0]=this._bufs[0].slice(t),this.length-=t;break}return this},Xe.prototype.duplicate=function(){const t=this._new();for(let r=0;r<this._bufs.length;r++)t.append(this._bufs[r]);return t},Xe.prototype.append=function(t){if(t==null)return this;if(t.buffer)this._appendBuffer(Wr.from(t.buffer,t.byteOffset,t.byteLength));else if(Array.isArray(t))for(let r=0;r<t.length;r++)this.append(t[r]);else if(this._isBufferList(t))for(let r=0;r<t._bufs.length;r++)this.append(t._bufs[r]);else typeof t=="number"&&(t=t.toString()),this._appendBuffer(Wr.from(t));return this},Xe.prototype._appendBuffer=function(t){this._bufs.push(t),this.length+=t.length},Xe.prototype.indexOf=function(e,t,r){if(r===void 0&&typeof t=="string"&&(r=t,t=void 0),typeof e=="function"||Array.isArray(e))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof e=="number"?e=Wr.from([e]):typeof e=="string"?e=Wr.from(e,r):this._isBufferList(e)?e=e.slice():Array.isArray(e.buffer)?e=Wr.from(e.buffer,e.byteOffset,e.byteLength):Wr.isBuffer(e)||(e=Wr.from(e)),t=Number(t||0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const n=this._offset(t);let i=n[0],a=n[1];for(;i<this._bufs.length;i++){const s=this._bufs[i];for(;a<s.length;){const c=s.length-a;if(c>=e.length){const o=s.indexOf(e,a);if(o!==-1)return this._reverseOffset([i,o]);a=s.length-e.length+1}else{const o=this._reverseOffset([i,a]);if(this._match(o,e))return o;a++}}a=0}return-1},Xe.prototype._match=function(e,t){if(this.length-e<t.length)return!1;for(let r=0;r<t.length;r++)if(this.get(e+r)!==t[r])return!1;return!0},function(){const e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(const t in e)(function(r){e[r]===null?Xe.prototype[r]=function(n,i){return this.slice(n,n+i)[r](0,i)}:Xe.prototype[r]=function(n){return this.slice(n,n+e[r])[r](0)}})(t)}(),Xe.prototype._isBufferList=function(t){return t instanceof Xe||Xe.isBufferList(t)},Xe.isBufferList=function(t){return t!=null&&t[zh]};var Ze=Xe;const{Buffer:my}=zt,Kh=(e,t,r)=>{const n=Ve.encode(e,t,r);return Kh.bytes=Ve.encode.bytes,t||my.from(n)};var Wc=Kh;const{Buffer:Wh}=zt,Xc=8,Xh=10*1024;function Qh(e){e=e||{};const t=Math.max(e.poolSize||Xh,e.minPoolSize||Xc),r=e.lengthEncoder||Wc;return n=>async function*(){let i=Wh.alloc(t),a=0;for await(const s of n){r(s.length,i,a);const c=i.slice(a,a+r.bytes);a+=r.bytes,i.length-a<Xc&&(i=Wh.alloc(t),a=0),yield new Ze().append(c).append(s)}}()}Qh.single=(e,t)=>{t=t||{};const r=t.lengthEncoder||Wc;return new Ze([r(e.length),e])};var Qc=Qh,gy=Xc,by=Xh;Qc.MIN_POOL_SIZE=gy,Qc.DEFAULT_POOL_SIZE=by;const{Buffer:yy}=zt,vy=e=>new Proxy({},{get:(t,r)=>r[0]==="l"?e[r]:e.get(parseInt(r))}),Yh=e=>{const t=Ve.decode(yy.isBuffer(e)?e:vy(e));return Yh.bytes=Ve.decode.bytes,t};var Jh=Yh;const{Buffer:wy}=zt,Zh=8,ed=1024*1024*4,td=wy.alloc(0),oi={LENGTH:"readLength",DATA:"readData"},_y={[oi.LENGTH]:(e,t,r,n)=>{t=t.append(e);let i;try{i=n.lengthDecoder(t)}catch(a){if(t.length>n.maxLengthLength)throw Object.assign(a,{message:"message length too long",code:"ERR_MSG_LENGTH_TOO_LONG"});if(a instanceof RangeError)return{mode:oi.LENGTH,buffer:t};throw a}if(i>n.maxDataLength)throw Object.assign(new Error("message data too long"),{code:"ERR_MSG_DATA_TOO_LONG"});return e=t.shallowSlice(n.lengthDecoder.bytes),t=new Ze,n.onLength&&n.onLength(i),i<=0?(n.onData&&n.onData(td),{mode:oi.LENGTH,chunk:e,buffer:t,data:td}):{mode:oi.DATA,chunk:e,buffer:t,state:{dataLength:i}}},[oi.DATA]:(e,t,r,n)=>{if(t=t.append(e),t.length<r.dataLength)return{mode:oi.DATA,buffer:t,state:r};const{dataLength:i}=r,a=t.shallowSlice(0,i);return e=t.length>i?t.shallowSlice(i):null,t=new Ze,n.onData&&n.onData(a),{mode:oi.LENGTH,chunk:e,buffer:t,data:a}}};function Yc(e){return e=e||{},e.lengthDecoder=e.lengthDecoder||Jh,e.maxLengthLength=e.maxLengthLength||Zh,e.maxDataLength=e.maxDataLength||ed,t=>async function*(){let r=new Ze,n=oi.LENGTH,i;for await(let a of t)for(;a;){const s=_y[n](a,r,i,e);({mode:n,chunk:a,buffer:r,state:i}=s),s.data&&(yield s.data)}if(r.length)throw Object.assign(new Error("unexpected end of input"),{code:"ERR_UNEXPECTED_EOF"})}()}Yc.fromReader=(e,t)=>{t=t||{};let r=1;const n={[Symbol.asyncIterator](){return this},next:async()=>{try{return await e.next(r)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{r=1}}};return t.onLength=i=>{r=i},Yc(t)(n)};var Jc=Yc,Ey=Zh,Sy=ed;Jc.MAX_LENGTH_LENGTH=Ey,Jc.MAX_DATA_LENGTH=Sy;const{Buffer:Ay}=zt,rd=(e,t,r)=>(t=t||Ay.allocUnsafe(4),t.writeInt32BE(e,r),t);rd.bytes=4;var Ty=rd;const nd=e=>{if(e.length<4)throw RangeError("Could not decode int32BE");return e.readInt32BE(0)};nd.bytes=4;var Cy=nd,Iy=Qc,Ry=Jc,ky=Wc,Py=Jh,Ny=Ty,Oy=Cy,ct={encode:Iy,decode:Ry,varintEncode:ky,varintDecode:Py,int32BEEncode:Ny,int32BEDecode:Oy},id=e=>{const t=async function*(){let r=yield,n=new Ze;for await(const i of e){if(!r){r=yield n.append(i),n=new Ze;continue}for(n.append(i);n.length>=r;){const a=n.shallowSlice(0,r);if(n.consume(r),r=yield a,!r){n.length&&(r=yield n,n=new Ze);break}}}if(r)throw Object.assign(new Error(`stream ended before ${r} bytes became available`),{code:"ERR_UNDER_READ",buffer:n})}();return t.next(),t},ad=class{constructor(t){if(!(t>0)||(t-1&t)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];return t===void 0?void 0:(this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t)}isEmpty(){return this.buffer[this.btm]===void 0}},ss=class{constructor(t){this.hwm=t||16,this.head=new ad(this.hwm),this.tail=this.head}push(t){if(!this.head.push(t)){const r=this.head;this.head=r.next=new ad(2*this.head.buffer.length),this.head.push(t)}}shift(){const t=this.tail.shift();if(t===void 0&&this.tail.next){const r=this.tail.next;return this.tail.next=null,this.tail=r,this.tail.shift()}return t}isEmpty(){return this.head.isEmpty()}},lo=e=>{e=e||{};let t;typeof e=="function"?(t=e,e={}):t=e.onEnd;let r=new ss,n,i,a;const s=()=>{if(!r.isEmpty()){if(e.writev){let d;const v=[];for(;!r.isEmpty();){if(d=r.shift(),d.error)throw d.error;v.push(d.value)}return{done:d.done,value:v}}const I=r.shift();if(I.error)throw I.error;return I}return a?{done:!0}:new Promise((I,d)=>{i=v=>(i=null,v.error?d(v.error):e.writev&&!v.done?I({done:v.done,value:[v.value]}):I(v),n)})},c=I=>i?i(I):(r.push(I),n),o=I=>(r=new ss,i?i({error:I}):(r.push({error:I}),n)),u=I=>a?n:c({done:!1,value:I}),l=I=>a?n:(a=!0,I?o(I):c({done:!0})),f=()=>(r=new ss,l(),{done:!0}),_=I=>(l(I),{done:!0});if(n={[Symbol.asyncIterator](){return this},next:s,return:f,throw:_,push:u,end:l},!t)return n;const p=n;return n={[Symbol.asyncIterator](){return this},next(){return p.next()},throw(I){return p.throw(I),t&&(t(I),t=null),{done:!0}},return(){return p.return(),t&&(t(),t=null),{done:!0}},push:u,end(I){return p.end(I),t&&(t(I),t=null),n}},n};const Dy=()=>{const e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e};var ho=Dy,os=e=>{const t=lo(),r=id(e.source),n=ho();let i;const a=e.sink(async function*(){yield*t;const c=await n.promise;yield*c}());a.catch(c=>{i=c});const s={sink:c=>i?Promise.reject(i):(n.resolve(c),a),source:r};return{reader:r,writer:t,stream:s,rest:()=>t.end(),write:t.push,read:async()=>(await r.next()).value}};const{CircuitRelay:sd}=as,cs=te("libp2p:circuit:stream-handler");cs.error=te("libp2p:circuit:stream-handler:error");class My{constructor({stream:e,maxLength:t=4096}){this.stream=e,this.shake=os(this.stream),this.decoder=ct.decode.fromReader(this.shake.reader,{maxDataLength:t})}async read(){const e=await this.decoder.next();if(e.value){const t=sd.decode(e.value.slice());return cs("read message type",t.type),t}cs("read received no value, closing stream"),this.close()}write(e){cs("write message type %s",e.type),this.shake.write(ct.encode.single(sd.encode(e)))}rest(){return this.shake.rest(),this.shake.stream}end(e){this.write(e),this.close()}close(){cs("closing the stream"),this.rest().sink([])}}var Zc=My;const{CircuitRelay:eu}=as,{validateAddrs:xy}=Hh,pa=te("libp2p:circuit:stop");pa.error=te("libp2p:circuit:stop:error");var By=function({connection:t,request:r,streamHandler:n}){try{xy(r,n)}catch(i){return pa.error("invalid stop request via peer %s",t.remotePeer.toB58String(),i)}return pa("stop request is valid"),n.write({type:eu.Type.STATUS,code:eu.Status.SUCCESS}),n.rest()},Ly=async function({connection:t,request:r}){const{stream:n}=await t.newStream([Kc.relay]);pa("starting stop request to %s",t.remotePeer.toB58String());const i=new Zc({stream:n});i.write(r);const a=await i.read();if(a.code===eu.Status.SUCCESS)return pa("stop request to %s was successful",t.remotePeer.toB58String()),i.rest();pa("stop request failed with code %d",a.code),i.close()},od={handleStop:By,stop:Ly};const Bn=te("libp2p:circuit:hop");Bn.error=te("libp2p:circuit:hop:error");const{validateAddrs:jy}=Hh,{CircuitRelay:Xr}=as,{codes:Uy}=It,{stop:Fy}=od;var qy=async function({connection:t,request:r,streamHandler:n,circuit:i}){if(!i._options.hop.enabled)return Bn("HOP request received but we are not acting as a relay"),n.end({type:Xr.Type.STATUS,code:Xr.Status.HOP_CANT_SPEAK_RELAY});try{jy(r,n)}catch(l){return Bn.error("invalid hop request via peer %s",t.remotePeer.toB58String(),l)}const a=new Ae(r.dstPeer.id),s=i._connectionManager.get(a);if(!s&&!i._options.hop.active)return Bn("HOP request received but we are not connected to the destination peer"),n.end({type:Xr.Type.STATUS,code:Xr.Status.HOP_NO_CONN_TO_DST});const c={type:Xr.Type.STOP,dstPeer:r.dstPeer,srcPeer:r.srcPeer};let o;try{o=await Fy({connection:s,request:c,circuit:i})}catch(l){return Bn.error(l)}Bn("hop request from %s is valid",t.remotePeer.toB58String()),n.write({type:Xr.Type.STATUS,code:Xr.Status.SUCCESS});const u=n.rest();return Lt(u,o,u)},Gy=async function({connection:t,request:r}){const{stream:n}=await t.newStream([Kc.relay]),i=new Zc({stream:n});i.write(r);const a=await i.read();if(a.code===Xr.Status.SUCCESS)return Bn("hop request was successful"),i.rest();throw Bn("hop request failed with code %d, closing stream",a.code),i.close(),$(new Error(`HOP request failed with code ${a.code}`),Uy.ERR_HOP_REQUEST_FAILED)},$y=function({connection:t,streamHandler:r,circuit:n}){const i=n._options.hop.enabled;Bn("can hop (%s) request from %s",i,t.remotePeer.toB58String()),r.end({type:Xr.Type.STATUS,code:i?Xr.Status.SUCCESS:Xr.Status.HOP_CANT_SPEAK_RELAY})},Vy={handleHop:qy,hop:Gy,handleCanHop:$y};const{CircuitRelay:fa}=as,Ln=te("libp2p:circuit");Ln.error=te("libp2p:circuit:error");const{relay:Hy}=Kc,{handleCanHop:zy,handleHop:Ky,hop:Wy}=Vy,{handleStop:Xy}=od;class Qy{constructor({libp2p:e,upgrader:t}){this._dialer=e.dialer,this._registrar=e.registrar,this._connectionManager=e.connectionManager,this._upgrader=t,this._options=e._config.relay,this._libp2p=e,this.peerId=e.peerId,this._registrar.handle(Hy,this._onProtocol.bind(this))}async _onProtocol({connection:e,stream:t,protocol:r}){const n=new Zc({stream:t}),i=await n.read(),a=this;let s;switch(i.type){case fa.Type.CAN_HOP:{Ln("received CAN_HOP request from %s",e.remotePeer.toB58String()),await zy({circuit:a,connection:e,streamHandler:n});break}case fa.Type.HOP:{Ln("received HOP request from %s",e.remotePeer.toB58String()),s=await Ky({connection:e,request:i,streamHandler:n,circuit:a});break}case fa.Type.STOP:{Ln("received STOP request from %s",e.remotePeer.toB58String()),s=await Xy({connection:e,request:i,streamHandler:n,circuit:a});break}default:Ln("Request of type %s not supported",i.type)}if(s){const c=Pe(i.dstPeer.addrs[0]),o=Pe(i.srcPeer.addrs[0]),u=$h({stream:s,remoteAddr:c,localAddr:o}),l=fa.Type===fa.Type.HOP?"relay":"inbound";Ln("new %s connection %s",l,u.remoteAddr);const f=await this._upgrader.upgradeInbound(u);Ln("%s connection %s upgraded",l,u.remoteAddr),this.handler&&this.handler(f)}}async dial(e,t){const r=e.toString().split("/p2p-circuit"),n=Pe(r[0]),i=Pe(r[r.length-1]),a=Ae.createFromCID(n.getPeerId()),s=Ae.createFromCID(i.getPeerId());let c=!1,o=this._connectionManager.get(a);o||(o=await this._dialer.connectToPeer(n,t),c=!0);try{const u=await Wy({connection:o,circuit:this,request:{type:fa.Type.HOP,srcPeer:{id:this.peerId.toBytes(),addrs:this._libp2p.multiaddrs.map(_=>_.bytes)},dstPeer:{id:s.toBytes(),addrs:[Pe(i).bytes]}}}),l=n.encapsulate(`/p2p-circuit/p2p/${this.peerId.toB58String()}`),f=$h({stream:u,remoteAddr:e,localAddr:l});return Ln("new outbound connection %s",f.remoteAddr),this._upgrader.upgradeOutbound(f)}catch(u){throw Ln.error("Circuit relay dial failed",u),c&&await o.close(),u}}createListener(e,t){return typeof e=="function"&&(t=e,e={}),this.handler=t,py(this)}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>da.Circuit.matches(t))}}var cd=On(Qy,{className:"Circuit",symbolName:"@libp2p/js-libp2p-circuit/circuit"});const{AbortController:ud,AbortSignal:Yy}=typeof self!="undefined"?self:typeof window!="undefined"?window:void 0;var Mi=ud,Jy=Yy,Zy=ud;Mi.AbortSignal=Jy,Mi.default=Zy;const{AbortController:ev}=typeof self!="undefined"?self:typeof window!="undefined"?window:Mi;class tu extends ev{constructor(e){super();this._ms=e,this._timer=Oi(()=>this.abort(),e),Object.setPrototypeOf(this,tu.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=Oi(()=>this.abort(),this._ms)}}var ld=tu,tv=tu;ld.TimeoutController=tv;var rv=AbortController;function hd(e){const t=new rv;function r(){t.abort();for(const n of e){if(!n||!n.removeEventListener)continue;n.removeEventListener("abort",r)}}for(const n of e){if(!n||!n.addEventListener)continue;if(n.aborted){r();break}n.addEventListener("abort",r)}return t.signal}var ru=hd,nv=hd;ru.anySignal=nv;var iv=class{constructor(){this._buffer=new ss,this._waitingConsumers=new ss}push(t){const{promise:r,resolve:n}=ho();return this._buffer.push({chunk:t,resolve:n}),this._consume(),r}_consume(){for(;!this._waitingConsumers.isEmpty()&&!this._buffer.isEmpty();){const t=this._waitingConsumers.shift(),r=this._buffer.shift();t.resolve(r.chunk),r.resolve()}}shift(){const{promise:t,resolve:r}=ho();return this._waitingConsumers.push({resolve:r}),this._consume(),t}isEmpty(){return this._buffer.isEmpty()}};const av=te("libp2p:dialer:request");av.error=te("libp2p:dialer:request:error");class sv{constructor({addrs:e,dialAction:t,dialer:r}){this.addrs=e,this.dialer=r,this.dialAction=t}async run(e){const t=this.dialer.getTokens(this.addrs.length);if(t.length<1)throw $(new Error("No dial tokens available"),"ERR_NO_DIAL_TOKENS");const r=new iv;t.forEach(a=>r.push(a));const n=this.addrs.map(()=>new Mi);let i=0;try{return await to(this.addrs.map(async(a,s)=>{const c=await r.shift();let o;try{const u=n[s].signal;o=await this.dialAction(a,{...e,signal:ru([u,e.signal])}),n.splice(s,1)}finally{i++,this.addrs.length-i>=t.length?r.push(c):this.dialer.releaseToken(t.splice(t.indexOf(c),1)[0])}return o}))}finally{n.map(a=>a.abort()),t.forEach(a=>this.dialer.releaseToken(a))}}}var ov=sv,cv={DialRequest:ov};const ma=te("libp2p:dialer");ma.error=te("libp2p:dialer:error");const{DialRequest:uv}=cv,{codes:nu}=It,{DIAL_TIMEOUT:lv,MAX_PARALLEL_DIALS:hv,MAX_PER_PEER_DIALS:dv}=ns;class pv{constructor({transportManager:e,peerStore:t,concurrency:r=hv,timeout:n=lv,perPeerLimit:i=dv}){this.transportManager=e,this.peerStore=t,this.concurrency=r,this.timeout=n,this.perPeerLimit=i,this.tokens=[...new Array(r)].map((a,s)=>s),this._pendingDials=new Map}destroy(){for(const e of this._pendingDials.values())try{e.controller.abort()}catch(t){ma.error(t)}this._pendingDials.clear()}async connectToPeer(e,t={}){const r=this._createDialTarget(e);if(!r.addrs.length)throw $(new Error("The dial request has no addresses"),nu.ERR_NO_VALID_ADDRESSES);const n=this._pendingDials.get(r.id)||this._createPendingDial(r,t);try{const i=await n.promise;return ma("dial succeeded to %s",r.id),i}catch(i){throw n.controller.signal.aborted&&(i.code=nu.ERR_TIMEOUT),ma.error(i),i}finally{n.destroy()}}_createDialTarget(e){const{id:t,multiaddrs:r}=ao(e);r&&this.peerStore.addressBook.add(t,r);let n=this.peerStore.addressBook.getMultiaddrsForPeer(t)||[];return Pe.isMultiaddr(e)&&(n=n.filter(i=>!e.equals(i)),n.unshift(e)),{id:t.toB58String(),addrs:n}}_createPendingDial(e,t){const r=(o,u)=>{if(u.signal.aborted)throw $(new Error("already aborted"),nu.ERR_ALREADY_ABORTED);return this.transportManager.dial(o,u)},n=new uv({addrs:e.addrs,dialAction:r,dialer:this}),i=new ld(this.timeout),a=[i.signal];t.signal&&a.push(t.signal);const s=ru(a),c={dialRequest:n,controller:i,promise:n.run({...t,signal:s}),destroy:()=>{i.clear(),this._pendingDials.delete(e.id)}};return this._pendingDials.set(e.id,c),c}getTokens(e){const t=Math.min(e,this.perPeerLimit,this.tokens.length),r=this.tokens.splice(0,t);return ma("%d tokens request, returning %d, %d remaining",e,t,this.tokens.length),r}releaseToken(e){if(this.tokens.indexOf(e)>-1)return;ma("token %d released",e),this.tokens.push(e)}}var fv=pv;function mv(e){return e>=55296&&e<=56319}function gv(e){return e>=56320&&e<=57343}var bv=function(t,r,n){if(typeof r!="string")throw new Error("Input must be string");for(var i=r.length,a=0,s,c,o=0;o<i;o+=1){if(s=r.charCodeAt(o),c=r[o],mv(s)&&gv(r.charCodeAt(o+1))&&(o+=1,c+=r[o]),a+=t(c),a===n)return r.slice(0,o+1);if(a>n)return r.slice(0,o-c.length+1)}return r};function yv(e){return e>=55296&&e<=56319}function vv(e){return e>=56320&&e<=57343}var wv=function(t){if(typeof t!="string")throw new Error("Input must be string");for(var r=t.length,n=0,i=null,a=null,s=0;s<r;s++)i=t.charCodeAt(s),vv(i)?a!=null&&yv(a)?n+=1:n+=3:i<=127?n+=1:i>=128&&i<=2047?n+=2:i>=2048&&i<=65535&&(n+=3),a=i;return n},_v=bv.bind(null,wv),Ev=/[\/\?<>\\:\*\|"]/g,Sv=/[\x00-\x1f\x80-\x9f]/g,Av=/^\.+$/,Tv=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,Cv=/[\. ]+$/;function dd(e,t){if(typeof e!="string")throw new Error("Input must be string");var r=e.replace(Ev,t).replace(Sv,t).replace(Av,t).replace(Tv,t).replace(Cv,t);return _v(r,255)}var Iv=function(e,t){var r=t&&t.replacement||"",n=dd(e,r);return r===""?n:dd(n,"")},pd={createCipheriv:(e,t,r)=>{const n=q.cipher.createCipher("AES-CTR",qe(t,"ascii"));return n.start({iv:qe(r,"ascii")}),{update:i=>(n.update(q.util.createBuffer(qe(i,"ascii"))),st(n.output.getBytes(),"ascii"))}},createDecipheriv:(e,t,r)=>{const n=q.cipher.createDecipher("AES-CTR",qe(t,"ascii"));return n.start({iv:qe(r,"ascii")}),{update:i=>(n.update(q.util.createBuffer(qe(i,"ascii"))),st(n.output.getBytes(),"ascii"))}}};const fd={16:"aes-128-ctr",32:"aes-256-ctr"};var Rv=function(e){const t=fd[e.length];if(!t){const r=Object.entries(fd).map(([n,i])=>`${n} (${i})`).join(" / ");throw $(new Error(`Invalid key length ${e.length} bytes. Must be ${r}`),"ERR_INVALID_KEY_LENGTH")}return t},kv=async function(e,t){const r=Rv(e),n=pd.createCipheriv(r,e,t),i=pd.createDecipheriv(r,e,t),a={async encrypt(s){return n.update(s)},async decrypt(s){return i.update(s)}};return a},Pv={create:kv};const md={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function Nv(e,t,r,n,i){const a=md[i];if(!a){const c=Object.keys(md).join(" / ");throw $(new Error(`Hash '${i}' is unknown or not supported. Must be ${c}`),"ERR_UNSUPPORTED_HASH_TYPE")}const s=Sg(e,t,r,n,a);return Ag.encode64(s)}var Ov=Nv,Dv=Pv,Mv=Tg,xv=Kl,Bv=Wl,Lv=Ov,Rr={aes:Dv,hmac:Mv,keys:xv,randomBytes:Bv,pbkdf2:Lv};let jv="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",gd=e=>crypto.getRandomValues(new Uint8Array(e)),bd=(e,t,r)=>{let n=(2<<Math.log(e.length-1)/Math.LN2)-1,i=-~(1.6*n*t/e.length);return()=>{let a="";for(;;){let s=r(i),c=i;for(;c--;)if(a+=e[s[c]&n]||"",a.length===+t)return a}}},Uv=(e,t)=>bd(e,t,gd),Fv=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let n=r[e]&63;n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n<63?t+="_":t+="-"}return t};var yd=Object.freeze({__proto__:null,nanoid:Fv,customAlphabet:Uv,customRandom:bd,urlAlphabet:jv,random:gd});const{nanoid:qv}=yd,Gv=(e=t=>t)=>e(qv());var $v=Gv,Vv=Mn.TextEncoder,vd=Mn.TextDecoder,Hv=new Vv("utf8"),zv=new vd("utf8"),Kv=(e,t)=>async function*(){for await(const r of e){const n=await t(r);if(!n)continue;yield r}}(),Wv=(e,t)=>async function*(){let r=[];for await(const n of e)r.push(n);r=await t(r);for(const n of r)yield n}(),Xv=(e,t)=>async function*(){if(t<=0)return;let r=0;for await(const n of e)if(yield n,r++,r>=t)return}(),Qv=(e,t)=>async function*(){for await(const r of e)yield t(r)}(),Yv=function(e,t){const r=new RegExp("^"+t);return e.replace(r,"")},Jv=$v,iu={utf8Encoder:Hv,utf8Decoder:zv,filter:Kv,sortAll:Wv,take:Xv,map:Qv,replaceStartWith:Yv,tmpdir:Jv};const{nanoid:Zv}=yd,{utf8Encoder:wd,utf8Decoder:ew}=iu,jn="/",_d=wd.encode(jn),po=_d[0];class au{constructor(e,t){if(typeof e=="string")this._buf=wd.encode(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==po)throw new Error("Invalid key")}toString(e="utf8"){return e==="utf8"||e==="utf-8"?ew.decode(this._buf):new vd(e).decode(this._buf)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new ci(e.join(jn))}static random(){return new ci(Zv().replace(/-/g,""))}clean(){if((!this._buf||this._buf.byteLength===0)&&(this._buf=_d),this._buf[0]!==po){const e=new Uint8Array(this._buf.byteLength+1);e.fill(po,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===po;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let n=0;n<t.length;n++){if(r.length<n+1)return!1;const i=t[n],a=r[n];if(i<a)return!0;if(i>a)return!1}return t.length<r.length}reverse(){return au.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(jn).slice(1)}type(){return tw(this.baseNamespace())}name(){return rw(this.baseNamespace())}instance(e){return new ci(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(jn)||(e+=jn),e+=this.type(),new ci(e)}parent(){const e=this.list();return e.length===1?new ci(jn):new ci(e.slice(0,-1).join(jn))}child(e){return this.toString()===jn?e:e.toString()===jn?this:new ci(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return au.withNamespaces([...this.namespaces(),...nw(e.map(t=>t.namespaces()))])}}function tw(e){const t=e.split(":");return t.length<2?"":t.slice(0,-1).join(":")}function rw(e){const t=e.split(":");return t[t.length-1]}function nw(e){return[].concat(...e)}const ci=On(au,{className:"Key",symbolName:"@ipfs/interface-datastore/key"});var Ed=ci;const iw=async e=>{for await(const t of e);};var Sd=iw;const{filter:su,sortAll:aw,take:sw,map:ow}=iu;class cw{async open(){}async close(){}async put(e,t,r={}){}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield{key:r,value:n}}async get(e,t={}){}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}async has(e){}async delete(e,t={}){}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(r,n){e.push({key:r,value:n})},delete(r){t.push(r)},commit:async r=>{await Sd(this.putMany(e,r)),e=[],await Sd(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){}async*query(e,t){let r=this._all(e,t);if(e.prefix!=null&&(r=su(r,n=>n.key.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(r=e.filters.reduce((n,i)=>su(n,i),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((n,i)=>aw(n,i),r)),e.offset!=null){let n=0;r=su(r,()=>n++>=e.offset)}e.limit!=null&&(r=sw(r,e.limit)),e.keysOnly===!0&&(r=ow(r,n=>({key:n.key}))),yield*r}}var Ad=cw,uw=e=>(e=e||new Error("Cannot open database"),$(e,"ERR_DB_OPEN_FAILED")),lw=e=>(e=e||new Error("Delete failed"),$(e,"ERR_DB_DELETE_FAILED")),hw=e=>(e=e||new Error("Write failed"),$(e,"ERR_DB_WRITE_FAILED")),dw=e=>(e=e||new Error("Not Found"),$(e,"ERR_NOT_FOUND")),pw=e=>(e=e||new Error("Aborted"),$(e,"ERR_ABORTED")),Td={dbOpenFailedError:uw,dbDeleteFailedError:lw,dbWriteFailedError:hw,notFoundError:dw,abortedError:pw};class fw extends Ad{constructor(){super();this.data={}}async put(e,t){this.data[e.toString()]=t}async get(e){const t=await this.has(e);if(!t)throw Td.notFoundError();return this.data[e.toString()]}async has(e){return this.data[e.toString()]!==void 0}async delete(e){delete this.data[e.toString()]}*_all(){yield*Object.entries(this.data).map(([e,t])=>({key:new Ed(e),value:t}))}}var mw=fw,gw=Ed,bw=mw,yw=iu,vw=Td,ww=Ad,ou={Key:gw,MemoryDatastore:bw,utils:yw,Errors:vw,Adapter:ww},rN=le(function(e){var t=q.asn1,r=e.exports=q.pkcs7asn1=q.pkcs7asn1||{};q.pkcs7=q.pkcs7||{},q.pkcs7.asn1=r;var n={name:"ContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};r.contentInfoValidator=n;var i={name:"EncryptedContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};r.envelopedDataValidator={name:"EnvelopedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(i)},r.encryptedDataValidator={name:"EncryptedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"}].concat(i)};var a={name:"SignerInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};r.signedDataValidator={name:"SignedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},n,{name:"SignedData.Certificates",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,capture:"signerInfos",optional:!0,value:[a]}]},r.recipientInfoValidator={name:"RecipientInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter"}]},{name:"RecipientInfo.encryptedKey",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}}),nN=le(function(e){q.mgf=q.mgf||{};var t=e.exports=q.mgf.mgf1=q.mgf1=q.mgf1||{};t.create=function(r){var n={generate:function(i,a){for(var s=new q.util.ByteBuffer,c=Math.ceil(a/r.digestLength),o=0;o<c;o++){var u=new q.util.ByteBuffer;u.putInt32(o),r.start(),r.update(i+u.getBytes()),s.putBuffer(r.digest())}return s.truncate(s.length()-a),s.getBytes()}};return n}}),iN=q.mgf=q.mgf||{};q.mgf.mgf1=q.mgf1;var aN=le(function(e){var t=e.exports=q.pss=q.pss||{};t.create=function(r){arguments.length===3&&(r={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var n=r.md,i=r.mgf,a=n.digestLength,s=r.salt||null;typeof s=="string"&&(s=q.util.createBuffer(s));var c;if("saltLength"in r)c=r.saltLength;else if(s!==null)c=s.length();else throw new Error("Salt length not specified or specific salt not given.");if(s!==null&&s.length()!==c)throw new Error("Given salt length does not match length of given salt.");var o=r.prng||q.random,u={};return u.encode=function(l,f){var _,p=f-1,I=Math.ceil(p/8),d=l.digest().getBytes();if(I<a+c+2)throw new Error("Message is too long to encrypt.");var v;s===null?v=o.getBytesSync(c):v=s.bytes();var A=new q.util.ByteBuffer;A.fillWithByte(0,8),A.putBytes(d),A.putBytes(v),n.start(),n.update(A.getBytes());var j=n.digest().getBytes(),O=new q.util.ByteBuffer;O.fillWithByte(0,I-c-a-2),O.putByte(1),O.putBytes(v);var m=O.getBytes(),b=I-a-1,S=i.generate(j,b),h="";for(_=0;_<b;_++)h+=String.fromCharCode(m.charCodeAt(_)^S.charCodeAt(_));var g=65280>>8*I-p&255;return h=String.fromCharCode(h.charCodeAt(0)&~g)+h.substr(1),h+j+String.fromCharCode(188)},u.verify=function(l,f,_){var p,I=_-1,d=Math.ceil(I/8);if(f=f.substr(-d),d<a+c+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(f.charCodeAt(d-1)!==188)throw new Error("Encoded message does not end in 0xBC.");var v=d-a-1,A=f.substr(0,v),j=f.substr(v,a),O=65280>>8*d-I&255;if((A.charCodeAt(0)&O)!==0)throw new Error("Bits beyond keysize not zero as expected.");var m=i.generate(j,v),b="";for(p=0;p<v;p++)b+=String.fromCharCode(A.charCodeAt(p)^m.charCodeAt(p));b=String.fromCharCode(b.charCodeAt(0)&~O)+b.substr(1);var S=d-a-c-2;for(p=0;p<S;p++)if(b.charCodeAt(p)!==0)throw new Error("Leftmost octets not zero as expected");if(b.charCodeAt(S)!==1)throw new Error("Inconsistent PSS signature, 0x01 marker not found");var h=b.substr(-c),g=new q.util.ByteBuffer;g.fillWithByte(0,8),g.putBytes(l),g.putBytes(h),n.start(),n.update(g.getBytes());var w=n.digest().getBytes();return j===w},u}}),sN=le(function(e){var t=q.asn1,r=e.exports=q.pki=q.pki||{},n=r.oids,i={};i.CN=n.commonName,i.commonName="CN",i.C=n.countryName,i.countryName="C",i.L=n.localityName,i.localityName="L",i.ST=n.stateOrProvinceName,i.stateOrProvinceName="ST",i.O=n.organizationName,i.organizationName="O",i.OU=n.organizationalUnitName,i.organizationalUnitName="OU",i.E=n.emailAddress,i.emailAddress="E";var a=q.pki.rsa.publicKeyValidator,s={name:"Certificate",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:t.Class.UNIVERSAL,type:t.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:t.Class.UNIVERSAL,type:t.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:t.Class.UNIVERSAL,type:t.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:t.Class.UNIVERSAL,type:t.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},a,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:t.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:t.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},c={name:"rsapss",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:t.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:t.Class.UNIVERSAL,type:t.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:t.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:t.Class.UNIVERSAL,type:t.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},o={name:"CertificationRequestInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},a,{name:"CertificationRequestInfo.attributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0}]}]}]},u={name:"CertificationRequest",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[o,{name:"CertificationRequest.signatureAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};r.RDNAttributesAsArray=function(m,b){for(var S=[],h,g,w,y=0;y<m.value.length;++y){h=m.value[y];for(var P=0;P<h.value.length;++P)w={},g=h.value[P],w.type=t.derToOid(g.value[0].value),w.value=g.value[1].value,w.valueTagClass=g.value[1].type,w.type in n&&(w.name=n[w.type],w.name in i&&(w.shortName=i[w.name])),b&&(b.update(w.type),b.update(w.value)),S.push(w)}return S},r.CRIAttributesAsArray=function(m){for(var b=[],S=0;S<m.length;++S)for(var h=m[S],g=t.derToOid(h.value[0].value),w=h.value[1].value,y=0;y<w.length;++y){var P={};if(P.type=g,P.value=w[y].value,P.valueTagClass=w[y].type,P.type in n&&(P.name=n[P.type],P.name in i&&(P.shortName=i[P.name])),P.type===n.extensionRequest){P.extensions=[];for(var D=0;D<P.value.length;++D)P.extensions.push(r.certificateExtensionFromAsn1(P.value[D]))}b.push(P)}return b};function l(m,b){typeof b=="string"&&(b={shortName:b});for(var S=null,h,g=0;S===null&&g<m.attributes.length;++g)h=m.attributes[g],(b.type&&b.type===h.type||(b.name&&b.name===h.name||b.shortName&&b.shortName===h.shortName))&&(S=h);return S}var f=function(m,b,S){var h={};if(m!==n["RSASSA-PSS"])return h;S&&(h={hash:{algorithmOid:n.sha1},mgf:{algorithmOid:n.mgf1,hash:{algorithmOid:n.sha1}},saltLength:20});var g={},w=[];if(!t.validate(b,c,g,w)){var y=new Error("Cannot read RSASSA-PSS parameter block.");throw y.errors=w,y}return g.hashOid!==void 0&&(h.hash=h.hash||{},h.hash.algorithmOid=t.derToOid(g.hashOid)),g.maskGenOid!==void 0&&(h.mgf=h.mgf||{},h.mgf.algorithmOid=t.derToOid(g.maskGenOid),h.mgf.hash=h.mgf.hash||{},h.mgf.hash.algorithmOid=t.derToOid(g.maskGenHashOid)),g.saltLength!==void 0&&(h.saltLength=g.saltLength.charCodeAt(0)),h};r.certificateFromPem=function(m,b,S){var h=q.pem.decode(m)[0];if(h.type!=="CERTIFICATE"&&h.type!=="X509 CERTIFICATE"&&h.type!=="TRUSTED CERTIFICATE"){var g=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw g.headerType=h.type,g}if(h.procType&&h.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var w=t.fromDer(h.body,S);return r.certificateFromAsn1(w,b)},r.certificateToPem=function(m,b){var S={type:"CERTIFICATE",body:t.toDer(r.certificateToAsn1(m)).getBytes()};return q.pem.encode(S,{maxline:b})},r.publicKeyFromPem=function(m){var b=q.pem.decode(m)[0];if(b.type!=="PUBLIC KEY"&&b.type!=="RSA PUBLIC KEY"){var S=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw S.headerType=b.type,S}if(b.procType&&b.procType.type==="ENCRYPTED")throw new Error("Could not convert public key from PEM; PEM is encrypted.");var h=t.fromDer(b.body);return r.publicKeyFromAsn1(h)},r.publicKeyToPem=function(m,b){var S={type:"PUBLIC KEY",body:t.toDer(r.publicKeyToAsn1(m)).getBytes()};return q.pem.encode(S,{maxline:b})},r.publicKeyToRSAPublicKeyPem=function(m,b){var S={type:"RSA PUBLIC KEY",body:t.toDer(r.publicKeyToRSAPublicKey(m)).getBytes()};return q.pem.encode(S,{maxline:b})},r.getPublicKeyFingerprint=function(m,b){b=b||{};var S=b.md||q.md.sha1.create(),h=b.type||"RSAPublicKey",g;switch(h){case"RSAPublicKey":g=t.toDer(r.publicKeyToRSAPublicKey(m)).getBytes();break;case"SubjectPublicKeyInfo":g=t.toDer(r.publicKeyToAsn1(m)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+b.type+'".')}S.start(),S.update(g);var w=S.digest();if(b.encoding==="hex"){var y=w.toHex();return b.delimiter?y.match(/.{2}/g).join(b.delimiter):y}else{if(b.encoding==="binary")return w.getBytes();if(b.encoding)throw new Error('Unknown encoding "'+b.encoding+'".')}return w},r.certificationRequestFromPem=function(m,b,S){var h=q.pem.decode(m)[0];if(h.type!=="CERTIFICATE REQUEST"){var g=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw g.headerType=h.type,g}if(h.procType&&h.procType.type==="ENCRYPTED")throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var w=t.fromDer(h.body,S);return r.certificationRequestFromAsn1(w,b)},r.certificationRequestToPem=function(m,b){var S={type:"CERTIFICATE REQUEST",body:t.toDer(r.certificationRequestToAsn1(m)).getBytes()};return q.pem.encode(S,{maxline:b})},r.createCertificate=function(){var m={};return m.version=2,m.serialNumber="00",m.signatureOid=null,m.signature=null,m.siginfo={},m.siginfo.algorithmOid=null,m.validity={},m.validity.notBefore=new Date,m.validity.notAfter=new Date,m.issuer={},m.issuer.getField=function(b){return l(m.issuer,b)},m.issuer.addField=function(b){p([b]),m.issuer.attributes.push(b)},m.issuer.attributes=[],m.issuer.hash=null,m.subject={},m.subject.getField=function(b){return l(m.subject,b)},m.subject.addField=function(b){p([b]),m.subject.attributes.push(b)},m.subject.attributes=[],m.subject.hash=null,m.extensions=[],m.publicKey=null,m.md=null,m.setSubject=function(b,S){p(b),m.subject.attributes=b,delete m.subject.uniqueId,S&&(m.subject.uniqueId=S),m.subject.hash=null},m.setIssuer=function(b,S){p(b),m.issuer.attributes=b,delete m.issuer.uniqueId,S&&(m.issuer.uniqueId=S),m.issuer.hash=null},m.setExtensions=function(b){for(var S=0;S<b.length;++S)I(b[S],{cert:m});m.extensions=b},m.getExtension=function(b){typeof b=="string"&&(b={name:b});for(var S=null,h,g=0;S===null&&g<m.extensions.length;++g)h=m.extensions[g],(b.id&&h.id===b.id||b.name&&h.name===b.name)&&(S=h);return S},m.sign=function(b,S){m.md=S||q.md.sha1.create();var h=n[m.md.algorithm+"WithRSAEncryption"];if(!h){var g=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw g.algorithm=m.md.algorithm,g}m.signatureOid=m.siginfo.algorithmOid=h,m.tbsCertificate=r.getTBSCertificate(m);var w=t.toDer(m.tbsCertificate);m.md.update(w.getBytes()),m.signature=b.sign(m.md)},m.verify=function(b){var S=!1;if(!m.issued(b)){var h=b.issuer,g=m.subject,w=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw w.expectedIssuer=h.attributes,w.actualIssuer=g.attributes,w}var y=b.md;if(y===null){if(b.signatureOid in n){var P=n[b.signatureOid];switch(P){case"sha1WithRSAEncryption":y=q.md.sha1.create();break;case"md5WithRSAEncryption":y=q.md.md5.create();break;case"sha256WithRSAEncryption":y=q.md.sha256.create();break;case"sha384WithRSAEncryption":y=q.md.sha384.create();break;case"sha512WithRSAEncryption":y=q.md.sha512.create();break;case"RSASSA-PSS":y=q.md.sha256.create();break}}if(y===null){var w=new Error("Could not compute certificate digest. Unknown signature OID.");throw w.signatureOid=b.signatureOid,w}var D=b.tbsCertificate||r.getTBSCertificate(b),L=t.toDer(D);y.update(L.getBytes())}if(y!==null){var x;switch(b.signatureOid){case n.sha1WithRSAEncryption:x=void 0;break;case n["RSASSA-PSS"]:var B,G;if(B=n[b.signatureParameters.mgf.hash.algorithmOid],B===void 0||q.md[B]===void 0){var w=new Error("Unsupported MGF hash function.");throw w.oid=b.signatureParameters.mgf.hash.algorithmOid,w.name=B,w}if(G=n[b.signatureParameters.mgf.algorithmOid],G===void 0||q.mgf[G]===void 0){var w=new Error("Unsupported MGF function.");throw w.oid=b.signatureParameters.mgf.algorithmOid,w.name=G,w}if(G=q.mgf[G].create(q.md[B].create()),B=n[b.signatureParameters.hash.algorithmOid],B===void 0||q.md[B]===void 0)throw{message:"Unsupported RSASSA-PSS hash function.",oid:b.signatureParameters.hash.algorithmOid,name:B};x=q.pss.create(q.md[B].create(),G,b.signatureParameters.saltLength);break}S=m.publicKey.verify(y.digest().getBytes(),b.signature,x)}return S},m.isIssuer=function(b){var S=!1,h=m.issuer,g=b.subject;if(h.hash&&g.hash)S=h.hash===g.hash;else if(h.attributes.length===g.attributes.length){S=!0;for(var w,y,P=0;S&&P<h.attributes.length;++P)w=h.attributes[P],y=g.attributes[P],(w.type!==y.type||w.value!==y.value)&&(S=!1)}return S},m.issued=function(b){return b.isIssuer(m)},m.generateSubjectKeyIdentifier=function(){return r.getPublicKeyFingerprint(m.publicKey,{type:"RSAPublicKey"})},m.verifySubjectKeyIdentifier=function(){for(var b=n.subjectKeyIdentifier,S=0;S<m.extensions.length;++S){var h=m.extensions[S];if(h.id===b){var g=m.generateSubjectKeyIdentifier().getBytes();return q.util.hexToBytes(h.subjectKeyIdentifier)===g}}return!1},m},r.certificateFromAsn1=function(m,b){var S={},h=[];if(!t.validate(m,s,S,h)){var g=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw g.errors=h,g}var w=t.derToOid(S.publicKeyOid);if(w!==r.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var y=r.createCertificate();y.version=S.certVersion?S.certVersion.charCodeAt(0):0;var P=q.util.createBuffer(S.certSerialNumber);y.serialNumber=P.toHex(),y.signatureOid=q.asn1.derToOid(S.certSignatureOid),y.signatureParameters=f(y.signatureOid,S.certSignatureParams,!0),y.siginfo.algorithmOid=q.asn1.derToOid(S.certinfoSignatureOid),y.siginfo.parameters=f(y.siginfo.algorithmOid,S.certinfoSignatureParams,!1),y.signature=S.certSignature;var D=[];if(S.certValidity1UTCTime!==void 0&&D.push(t.utcTimeToDate(S.certValidity1UTCTime)),S.certValidity2GeneralizedTime!==void 0&&D.push(t.generalizedTimeToDate(S.certValidity2GeneralizedTime)),S.certValidity3UTCTime!==void 0&&D.push(t.utcTimeToDate(S.certValidity3UTCTime)),S.certValidity4GeneralizedTime!==void 0&&D.push(t.generalizedTimeToDate(S.certValidity4GeneralizedTime)),D.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(D.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(y.validity.notBefore=D[0],y.validity.notAfter=D[1],y.tbsCertificate=S.tbsCertificate,b){if(y.md=null,y.signatureOid in n){var w=n[y.signatureOid];switch(w){case"sha1WithRSAEncryption":y.md=q.md.sha1.create();break;case"md5WithRSAEncryption":y.md=q.md.md5.create();break;case"sha256WithRSAEncryption":y.md=q.md.sha256.create();break;case"sha384WithRSAEncryption":y.md=q.md.sha384.create();break;case"sha512WithRSAEncryption":y.md=q.md.sha512.create();break;case"RSASSA-PSS":y.md=q.md.sha256.create();break}}if(y.md===null){var g=new Error("Could not compute certificate digest. Unknown signature OID.");throw g.signatureOid=y.signatureOid,g}var L=t.toDer(y.tbsCertificate);y.md.update(L.getBytes())}var x=q.md.sha1.create();y.issuer.getField=function(G){return l(y.issuer,G)},y.issuer.addField=function(G){p([G]),y.issuer.attributes.push(G)},y.issuer.attributes=r.RDNAttributesAsArray(S.certIssuer,x),S.certIssuerUniqueId&&(y.issuer.uniqueId=S.certIssuerUniqueId),y.issuer.hash=x.digest().toHex();var B=q.md.sha1.create();return y.subject.getField=function(G){return l(y.subject,G)},y.subject.addField=function(G){p([G]),y.subject.attributes.push(G)},y.subject.attributes=r.RDNAttributesAsArray(S.certSubject,B),S.certSubjectUniqueId&&(y.subject.uniqueId=S.certSubjectUniqueId),y.subject.hash=B.digest().toHex(),S.certExtensions?y.extensions=r.certificateExtensionsFromAsn1(S.certExtensions):y.extensions=[],y.publicKey=r.publicKeyFromAsn1(S.subjectPublicKeyInfo),y},r.certificateExtensionsFromAsn1=function(m){for(var b=[],S=0;S<m.value.length;++S)for(var h=m.value[S],g=0;g<h.value.length;++g)b.push(r.certificateExtensionFromAsn1(h.value[g]));return b},r.certificateExtensionFromAsn1=function(m){var b={};if(b.id=t.derToOid(m.value[0].value),b.critical=!1,m.value[1].type===t.Type.BOOLEAN?(b.critical=m.value[1].value.charCodeAt(0)!==0,b.value=m.value[2].value):b.value=m.value[1].value,b.id in n){if(b.name=n[b.id],b.name==="keyUsage"){var S=t.fromDer(b.value),h=0,g=0;S.value.length>1&&(h=S.value.charCodeAt(1),g=S.value.length>2?S.value.charCodeAt(2):0),b.digitalSignature=(h&128)===128,b.nonRepudiation=(h&64)===64,b.keyEncipherment=(h&32)===32,b.dataEncipherment=(h&16)===16,b.keyAgreement=(h&8)===8,b.keyCertSign=(h&4)===4,b.cRLSign=(h&2)===2,b.encipherOnly=(h&1)===1,b.decipherOnly=(g&128)===128}else if(b.name==="basicConstraints"){var S=t.fromDer(b.value);S.value.length>0&&S.value[0].type===t.Type.BOOLEAN?b.cA=S.value[0].value.charCodeAt(0)!==0:b.cA=!1;var w=null;S.value.length>0&&S.value[0].type===t.Type.INTEGER?w=S.value[0].value:S.value.length>1&&(w=S.value[1].value),w!==null&&(b.pathLenConstraint=t.derToInteger(w))}else if(b.name==="extKeyUsage")for(var S=t.fromDer(b.value),y=0;y<S.value.length;++y){var P=t.derToOid(S.value[y].value);P in n?b[n[P]]=!0:b[P]=!0}else if(b.name==="nsCertType"){var S=t.fromDer(b.value),h=0;S.value.length>1&&(h=S.value.charCodeAt(1)),b.client=(h&128)===128,b.server=(h&64)===64,b.email=(h&32)===32,b.objsign=(h&16)===16,b.reserved=(h&8)===8,b.sslCA=(h&4)===4,b.emailCA=(h&2)===2,b.objCA=(h&1)===1}else if(b.name==="subjectAltName"||b.name==="issuerAltName"){b.altNames=[];for(var D,S=t.fromDer(b.value),L=0;L<S.value.length;++L){D=S.value[L];var x={type:D.type,value:D.value};b.altNames.push(x);switch(D.type){case 1:case 2:case 6:break;case 7:x.ip=q.util.bytesToIP(D.value);break;case 8:x.oid=t.derToOid(D.value);break}}}else if(b.name==="subjectKeyIdentifier"){var S=t.fromDer(b.value);b.subjectKeyIdentifier=q.util.bytesToHex(S.value)}}return b},r.certificationRequestFromAsn1=function(m,b){var S={},h=[];if(!t.validate(m,u,S,h)){var g=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw g.errors=h,g}var w=t.derToOid(S.publicKeyOid);if(w!==r.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var y=r.createCertificationRequest();if(y.version=S.csrVersion?S.csrVersion.charCodeAt(0):0,y.signatureOid=q.asn1.derToOid(S.csrSignatureOid),y.signatureParameters=f(y.signatureOid,S.csrSignatureParams,!0),y.siginfo.algorithmOid=q.asn1.derToOid(S.csrSignatureOid),y.siginfo.parameters=f(y.siginfo.algorithmOid,S.csrSignatureParams,!1),y.signature=S.csrSignature,y.certificationRequestInfo=S.certificationRequestInfo,b){if(y.md=null,y.signatureOid in n){var w=n[y.signatureOid];switch(w){case"sha1WithRSAEncryption":y.md=q.md.sha1.create();break;case"md5WithRSAEncryption":y.md=q.md.md5.create();break;case"sha256WithRSAEncryption":y.md=q.md.sha256.create();break;case"sha384WithRSAEncryption":y.md=q.md.sha384.create();break;case"sha512WithRSAEncryption":y.md=q.md.sha512.create();break;case"RSASSA-PSS":y.md=q.md.sha256.create();break}}if(y.md===null){var g=new Error("Could not compute certification request digest. Unknown signature OID.");throw g.signatureOid=y.signatureOid,g}var P=t.toDer(y.certificationRequestInfo);y.md.update(P.getBytes())}var D=q.md.sha1.create();return y.subject.getField=function(L){return l(y.subject,L)},y.subject.addField=function(L){p([L]),y.subject.attributes.push(L)},y.subject.attributes=r.RDNAttributesAsArray(S.certificationRequestInfoSubject,D),y.subject.hash=D.digest().toHex(),y.publicKey=r.publicKeyFromAsn1(S.subjectPublicKeyInfo),y.getAttribute=function(L){return l(y,L)},y.addAttribute=function(L){p([L]),y.attributes.push(L)},y.attributes=r.CRIAttributesAsArray(S.certificationRequestInfoAttributes||[]),y},r.createCertificationRequest=function(){var m={};return m.version=0,m.signatureOid=null,m.signature=null,m.siginfo={},m.siginfo.algorithmOid=null,m.subject={},m.subject.getField=function(b){return l(m.subject,b)},m.subject.addField=function(b){p([b]),m.subject.attributes.push(b)},m.subject.attributes=[],m.subject.hash=null,m.publicKey=null,m.attributes=[],m.getAttribute=function(b){return l(m,b)},m.addAttribute=function(b){p([b]),m.attributes.push(b)},m.md=null,m.setSubject=function(b){p(b),m.subject.attributes=b,m.subject.hash=null},m.setAttributes=function(b){p(b),m.attributes=b},m.sign=function(b,S){m.md=S||q.md.sha1.create();var h=n[m.md.algorithm+"WithRSAEncryption"];if(!h){var g=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw g.algorithm=m.md.algorithm,g}m.signatureOid=m.siginfo.algorithmOid=h,m.certificationRequestInfo=r.getCertificationRequestInfo(m);var w=t.toDer(m.certificationRequestInfo);m.md.update(w.getBytes()),m.signature=b.sign(m.md)},m.verify=function(){var b=!1,S=m.md;if(S===null){if(m.signatureOid in n){var h=n[m.signatureOid];switch(h){case"sha1WithRSAEncryption":S=q.md.sha1.create();break;case"md5WithRSAEncryption":S=q.md.md5.create();break;case"sha256WithRSAEncryption":S=q.md.sha256.create();break;case"sha384WithRSAEncryption":S=q.md.sha384.create();break;case"sha512WithRSAEncryption":S=q.md.sha512.create();break;case"RSASSA-PSS":S=q.md.sha256.create();break}}if(S===null){var g=new Error("Could not compute certification request digest. Unknown signature OID.");throw g.signatureOid=m.signatureOid,g}var w=m.certificationRequestInfo||r.getCertificationRequestInfo(m),y=t.toDer(w);S.update(y.getBytes())}if(S!==null){var P;switch(m.signatureOid){case n.sha1WithRSAEncryption:break;case n["RSASSA-PSS"]:var D,L;if(D=n[m.signatureParameters.mgf.hash.algorithmOid],D===void 0||q.md[D]===void 0){var g=new Error("Unsupported MGF hash function.");throw g.oid=m.signatureParameters.mgf.hash.algorithmOid,g.name=D,g}if(L=n[m.signatureParameters.mgf.algorithmOid],L===void 0||q.mgf[L]===void 0){var g=new Error("Unsupported MGF function.");throw g.oid=m.signatureParameters.mgf.algorithmOid,g.name=L,g}if(L=q.mgf[L].create(q.md[D].create()),D=n[m.signatureParameters.hash.algorithmOid],D===void 0||q.md[D]===void 0){var g=new Error("Unsupported RSASSA-PSS hash function.");throw g.oid=m.signatureParameters.hash.algorithmOid,g.name=D,g}P=q.pss.create(q.md[D].create(),L,m.signatureParameters.saltLength);break}b=m.publicKey.verify(S.digest().getBytes(),m.signature,P)}return b},m};function _(m){for(var b=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),S,h,g=m.attributes,w=0;w<g.length;++w){S=g[w];var y=S.value,P=t.Type.PRINTABLESTRING;"valueTagClass"in S&&(P=S.valueTagClass,P===t.Type.UTF8&&(y=q.util.encodeUtf8(y))),h=t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(S.type).getBytes()),t.create(t.Class.UNIVERSAL,P,!1,y)])]),b.value.push(h)}return b}function p(m){for(var b,S=0;S<m.length;++S){if(b=m[S],typeof b.name=="undefined"&&(b.type&&b.type in r.oids?b.name=r.oids[b.type]:b.shortName&&b.shortName in i&&(b.name=r.oids[i[b.shortName]])),typeof b.type=="undefined")if(b.name&&b.name in r.oids)b.type=r.oids[b.name];else{var h=new Error("Attribute type not specified.");throw h.attribute=b,h}if(typeof b.shortName=="undefined"&&(b.name&&b.name in i&&(b.shortName=i[b.name])),b.type===n.extensionRequest&&(b.valueConstructed=!0,b.valueTagClass=t.Type.SEQUENCE,!b.value&&b.extensions)){b.value=[];for(var g=0;g<b.extensions.length;++g)b.value.push(r.certificateExtensionToAsn1(I(b.extensions[g])))}if(typeof b.value=="undefined"){var h=new Error("Attribute value not specified.");throw h.attribute=b,h}}}function I(m,b){if(b=b||{},typeof m.name=="undefined"&&(m.id&&m.id in r.oids&&(m.name=r.oids[m.id])),typeof m.id=="undefined")if(m.name&&m.name in r.oids)m.id=r.oids[m.name];else{var S=new Error("Extension ID not specified.");throw S.extension=m,S}if(typeof m.value!="undefined")return m;if(m.name==="keyUsage"){var h=0,g=0,w=0;m.digitalSignature&&(g|=128,h=7),m.nonRepudiation&&(g|=64,h=6),m.keyEncipherment&&(g|=32,h=5),m.dataEncipherment&&(g|=16,h=4),m.keyAgreement&&(g|=8,h=3),m.keyCertSign&&(g|=4,h=2),m.cRLSign&&(g|=2,h=1),m.encipherOnly&&(g|=1,h=0),m.decipherOnly&&(w|=128,h=7);var y=String.fromCharCode(h);w!==0?y+=String.fromCharCode(g)+String.fromCharCode(w):g!==0&&(y+=String.fromCharCode(g)),m.value=t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,y)}else if(m.name==="basicConstraints")m.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),m.cA&&m.value.value.push(t.create(t.Class.UNIVERSAL,t.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in m&&m.value.value.push(t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(m.pathLenConstraint).getBytes()));else if(m.name==="extKeyUsage"){m.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);var P=m.value.value;for(var D in m){if(m[D]!==!0)continue;D in n?P.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n[D]).getBytes())):D.indexOf(".")!==-1&&P.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(D).getBytes()))}}else if(m.name==="nsCertType"){var h=0,g=0;m.client&&(g|=128,h=7),m.server&&(g|=64,h=6),m.email&&(g|=32,h=5),m.objsign&&(g|=16,h=4),m.reserved&&(g|=8,h=3),m.sslCA&&(g|=4,h=2),m.emailCA&&(g|=2,h=1),m.objCA&&(g|=1,h=0);var y=String.fromCharCode(h);g!==0&&(y+=String.fromCharCode(g)),m.value=t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,y)}else if(m.name==="subjectAltName"||m.name==="issuerAltName"){m.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);for(var L,x=0;x<m.altNames.length;++x){L=m.altNames[x];var y=L.value;if(L.type===7&&L.ip){if(y=q.util.bytesFromIP(L.ip),y===null){var S=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw S.extension=m,S}}else L.type===8&&(L.oid?y=t.oidToDer(t.oidToDer(L.oid)):y=t.oidToDer(y));m.value.value.push(t.create(t.Class.CONTEXT_SPECIFIC,L.type,!1,y))}}else if(m.name==="nsComment"&&b.cert){if(!/^[\x00-\x7F]*$/.test(m.comment)||m.comment.length<1||m.comment.length>128)throw new Error('Invalid "nsComment" content.');m.value=t.create(t.Class.UNIVERSAL,t.Type.IA5STRING,!1,m.comment)}else if(m.name==="subjectKeyIdentifier"&&b.cert){var B=b.cert.generateSubjectKeyIdentifier();m.subjectKeyIdentifier=B.toHex(),m.value=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,B.getBytes())}else if(m.name==="authorityKeyIdentifier"&&b.cert){m.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);var P=m.value.value;if(m.keyIdentifier){var G=m.keyIdentifier===!0?b.cert.generateSubjectKeyIdentifier().getBytes():m.keyIdentifier;P.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!1,G))}if(m.authorityCertIssuer){var V=[t.create(t.Class.CONTEXT_SPECIFIC,4,!0,[_(m.authorityCertIssuer===!0?b.cert.issuer:m.authorityCertIssuer)])];P.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,V))}if(m.serialNumber){var K=q.util.hexToBytes(m.serialNumber===!0?b.cert.serialNumber:m.serialNumber);P.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!1,K))}}else if(m.name==="cRLDistributionPoints"){m.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);for(var P=m.value.value,ae=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),se=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[]),L,x=0;x<m.altNames.length;++x){L=m.altNames[x];var y=L.value;if(L.type===7&&L.ip){if(y=q.util.bytesFromIP(L.ip),y===null){var S=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw S.extension=m,S}}else L.type===8&&(L.oid?y=t.oidToDer(t.oidToDer(L.oid)):y=t.oidToDer(y));se.value.push(t.create(t.Class.CONTEXT_SPECIFIC,L.type,!1,y))}ae.value.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[se])),P.push(ae)}if(typeof m.value=="undefined"){var S=new Error("Extension value not specified.");throw S.extension=m,S}return m}function d(m,b){switch(m){case n["RSASSA-PSS"]:var S=[];return b.hash.algorithmOid!==void 0&&S.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(b.hash.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])])),b.mgf.algorithmOid!==void 0&&S.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(b.mgf.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(b.mgf.hash.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])])])),b.saltLength!==void 0&&S.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(b.saltLength).getBytes())])),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,S);default:return t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")}}function v(m){var b=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[]);if(m.attributes.length===0)return b;for(var S=m.attributes,h=0;h<S.length;++h){var g=S[h],w=g.value,y=t.Type.UTF8;"valueTagClass"in g&&(y=g.valueTagClass),y===t.Type.UTF8&&(w=q.util.encodeUtf8(w));var P=!1;"valueConstructed"in g&&(P=g.valueConstructed);var D=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(g.type).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,y,P,w)])]);b.value.push(D)}return b}var A=new Date("1950-01-01T00:00:00Z"),j=new Date("2050-01-01T00:00:00Z");function O(m){return m>=A&&m<j?t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(m)):t.create(t.Class.UNIVERSAL,t.Type.GENERALIZEDTIME,!1,t.dateToGeneralizedTime(m))}r.getTBSCertificate=function(m){var b=O(m.validity.notBefore),S=O(m.validity.notAfter),h=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(m.version).getBytes())]),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,q.util.hexToBytes(m.serialNumber)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(m.siginfo.algorithmOid).getBytes()),d(m.siginfo.algorithmOid,m.siginfo.parameters)]),_(m.issuer),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[b,S]),_(m.subject),r.publicKeyToAsn1(m.publicKey)]);return m.issuer.uniqueId&&h.value.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+m.issuer.uniqueId)])),m.subject.uniqueId&&h.value.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!0,[t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+m.subject.uniqueId)])),m.extensions.length>0&&h.value.push(r.certificateExtensionsToAsn1(m.extensions)),h},r.getCertificationRequestInfo=function(m){var b=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(m.version).getBytes()),_(m.subject),r.publicKeyToAsn1(m.publicKey),v(m)]);return b},r.distinguishedNameToAsn1=function(m){return _(m)},r.certificateToAsn1=function(m){var b=m.tbsCertificate||r.getTBSCertificate(m);return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[b,t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(m.signatureOid).getBytes()),d(m.signatureOid,m.signatureParameters)]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+m.signature)])},r.certificateExtensionsToAsn1=function(m){var b=t.create(t.Class.CONTEXT_SPECIFIC,3,!0,[]),S=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);b.value.push(S);for(var h=0;h<m.length;++h)S.value.push(r.certificateExtensionToAsn1(m[h]));return b},r.certificateExtensionToAsn1=function(m){var b=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);b.value.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(m.id).getBytes())),m.critical&&b.value.push(t.create(t.Class.UNIVERSAL,t.Type.BOOLEAN,!1,String.fromCharCode(255)));var S=m.value;return typeof m.value!="string"&&(S=t.toDer(S).getBytes()),b.value.push(t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,S)),b},r.certificationRequestToAsn1=function(m){var b=m.certificationRequestInfo||r.getCertificationRequestInfo(m);return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[b,t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(m.signatureOid).getBytes()),d(m.signatureOid,m.signatureParameters)]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+m.signature)])},r.createCaStore=function(m){var b={certs:{}};b.getIssuer=function(y){var P=S(y.issuer);return P},b.addCertificate=function(y){if(typeof y=="string"&&(y=q.pki.certificateFromPem(y)),h(y.subject),!b.hasCertificate(y))if(y.subject.hash in b.certs){var P=b.certs[y.subject.hash];q.util.isArray(P)||(P=[P]),P.push(y),b.certs[y.subject.hash]=P}else b.certs[y.subject.hash]=y},b.hasCertificate=function(y){typeof y=="string"&&(y=q.pki.certificateFromPem(y));var P=S(y.subject);if(!P)return!1;q.util.isArray(P)||(P=[P]);for(var D=t.toDer(r.certificateToAsn1(y)).getBytes(),L=0;L<P.length;++L){var x=t.toDer(r.certificateToAsn1(P[L])).getBytes();if(D===x)return!0}return!1},b.listAllCertificates=function(){var y=[];for(var P in b.certs)if(b.certs.hasOwnProperty(P)){var D=b.certs[P];if(!q.util.isArray(D))y.push(D);else for(var L=0;L<D.length;++L)y.push(D[L])}return y},b.removeCertificate=function(y){var P;if(typeof y=="string"&&(y=q.pki.certificateFromPem(y)),h(y.subject),!b.hasCertificate(y))return null;var D=S(y.subject);if(!q.util.isArray(D))return P=b.certs[y.subject.hash],delete b.certs[y.subject.hash],P;for(var L=t.toDer(r.certificateToAsn1(y)).getBytes(),x=0;x<D.length;++x){var B=t.toDer(r.certificateToAsn1(D[x])).getBytes();L===B&&(P=D[x],D.splice(x,1))}return D.length===0&&delete b.certs[y.subject.hash],P};function S(y){return h(y),b.certs[y.hash]||null}function h(y){if(!y.hash){var P=q.md.sha1.create();y.attributes=r.RDNAttributesAsArray(_(y),P),y.hash=P.digest().toHex()}}if(m)for(var g=0;g<m.length;++g){var w=m[g];b.addCertificate(w)}return b},r.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},r.verifyCertificateChain=function(m,b,S){typeof S=="function"&&(S={verify:S}),S=S||{},b=b.slice(0);var h=b.slice(0),g=S.validityCheckDate;typeof g=="undefined"&&(g=new Date);var w=!0,y=null,P=0;do{var D=b.shift(),L=null,x=!1;if(g&&((g<D.validity.notBefore||g>D.validity.notAfter)&&(y={message:"Certificate is not valid yet or has expired.",error:r.certificateError.certificate_expired,notBefore:D.validity.notBefore,notAfter:D.validity.notAfter,now:g})),y===null){if(L=b[0]||m.getIssuer(D),L===null&&(D.isIssuer(D)&&(x=!0,L=D)),L){var B=L;q.util.isArray(B)||(B=[B]);for(var G=!1;!G&&B.length>0;){L=B.shift();try{G=L.verify(D)}catch(R){}}G||(y={message:"Certificate signature is invalid.",error:r.certificateError.bad_certificate})}y===null&&(!L||x)&&!m.hasCertificate(D)&&(y={message:"Certificate is not trusted.",error:r.certificateError.unknown_ca})}if(y===null&&L&&!D.isIssuer(L)&&(y={message:"Certificate issuer is invalid.",error:r.certificateError.bad_certificate}),y===null)for(var V={keyUsage:!0,basicConstraints:!0},K=0;y===null&&K<D.extensions.length;++K){var ae=D.extensions[K];ae.critical&&!(ae.name in V)&&(y={message:"Certificate has an unsupported critical extension.",error:r.certificateError.unsupported_certificate})}if(y===null&&(!w||b.length===0&&(!L||x))){var se=D.getExtension("basicConstraints"),ve=D.getExtension("keyUsage");if(ve!==null&&((!ve.keyCertSign||se===null)&&(y={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:r.certificateError.bad_certificate})),y===null&&se!==null&&!se.cA&&(y={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:r.certificateError.bad_certificate}),y===null&&ve!==null&&"pathLenConstraint"in se){var fe=P-1;fe>se.pathLenConstraint&&(y={message:"Certificate basicConstraints pathLenConstraint violated.",error:r.certificateError.bad_certificate})}}var me=y===null?!0:y.error,pe=S.verify?S.verify(me,P,h):me;if(pe===!0)y=null;else throw me===!0&&(y={message:"The application rejected the certificate.",error:r.certificateError.bad_certificate}),(pe||pe===0)&&(typeof pe=="object"&&!q.util.isArray(pe)?(pe.message&&(y.message=pe.message),pe.error&&(y.error=pe.error)):typeof pe=="string"&&(y.error=pe)),y;w=!1,++P}while(b.length>0);return!0}}),oN=le(function(e){var t=q.asn1,r=e.exports=q.pkcs7=q.pkcs7||{};r.messageFromPem=function(p){var I=q.pem.decode(p)[0];if(I.type!=="PKCS7"){var d=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw d.headerType=I.type,d}if(I.procType&&I.procType.type==="ENCRYPTED")throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var v=t.fromDer(I.body);return r.messageFromAsn1(v)},r.messageToPem=function(p,I){var d={type:"PKCS7",body:t.toDer(p.toAsn1()).getBytes()};return q.pem.encode(d,{maxline:I})},r.messageFromAsn1=function(p){var I={},d=[];if(!t.validate(p,r.asn1.contentInfoValidator,I,d)){var v=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw v.errors=d,v}var A=t.derToOid(I.contentType),j;switch(A){case q.pki.oids.envelopedData:j=r.createEnvelopedData();break;case q.pki.oids.encryptedData:j=r.createEncryptedData();break;case q.pki.oids.signedData:j=r.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+A+" is not (yet) supported.")}return j.fromAsn1(I.content.value[0]),j},r.createSignedData=function(){var p=null;return p={type:q.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(v){if(f(p,v,r.asn1.signedDataValidator),p.certificates=[],p.crls=[],p.digestAlgorithmIdentifiers=[],p.contentInfo=null,p.signerInfos=[],p.rawCapture.certificates)for(var A=p.rawCapture.certificates.value,j=0;j<A.length;++j)p.certificates.push(q.pki.certificateFromAsn1(A[j]))},toAsn1:function(){p.contentInfo||p.sign();for(var v=[],A=0;A<p.certificates.length;++A)v.push(q.pki.certificateToAsn1(p.certificates[A]));var j=[],O=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(p.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,p.digestAlgorithmIdentifiers),p.contentInfo])]);return v.length>0&&O.value[0].value.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,v)),j.length>0&&O.value[0].value.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,j)),O.value[0].value.push(t.create(t.Class.UNIVERSAL,t.Type.SET,!0,p.signerInfos)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(p.type).getBytes()),O])},addSigner:function(v){var A=v.issuer,j=v.serialNumber;if(v.certificate){var O=v.certificate;typeof O=="string"&&(O=q.pki.certificateFromPem(O)),A=O.issuer.attributes,j=O.serialNumber}var m=v.key;if(!m)throw new Error("Could not add PKCS#7 signer; no private key specified.");typeof m=="string"&&(m=q.pki.privateKeyFromPem(m));var b=v.digestAlgorithm||q.pki.oids.sha1;switch(b){case q.pki.oids.sha1:case q.pki.oids.sha256:case q.pki.oids.sha384:case q.pki.oids.sha512:case q.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+b)}var S=v.authenticatedAttributes||[];if(S.length>0){for(var h=!1,g=!1,w=0;w<S.length;++w){var y=S[w];if(!h&&y.type===q.pki.oids.contentType){if(h=!0,g)break;continue}if(!g&&y.type===q.pki.oids.messageDigest){if(g=!0,h)break;continue}}if(!h||!g)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}p.signers.push({key:m,version:1,issuer:A,serialNumber:j,digestAlgorithm:b,signatureAlgorithm:q.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:S,unauthenticatedAttributes:[]})},sign:function(v){if(v=v||{},(typeof p.content!="object"||p.contentInfo===null)&&(p.contentInfo=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(q.pki.oids.data).getBytes())]),"content"in p)){var A;p.content instanceof q.util.ByteBuffer?A=p.content.bytes():typeof p.content=="string"&&(A=q.util.encodeUtf8(p.content)),v.detached?p.detachedContent=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,A):p.contentInfo.value.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,A)]))}if(p.signers.length===0)return;var j=I();d(j)},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(v){typeof v=="string"&&(v=q.pki.certificateFromPem(v)),p.certificates.push(v)},addCertificateRevokationList:function(v){throw new Error("PKCS#7 CRL support not yet implemented.")}},p;function I(){for(var v={},A=0;A<p.signers.length;++A){var j=p.signers[A],O=j.digestAlgorithm;O in v||(v[O]=q.md[q.pki.oids[O]].create()),j.authenticatedAttributes.length===0?j.md=v[O]:j.md=q.md[q.pki.oids[O]].create()}p.digestAlgorithmIdentifiers=[];for(var O in v)p.digestAlgorithmIdentifiers.push(t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(O).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]));return v}function d(v){var A;if(p.detachedContent?A=p.detachedContent:(A=p.contentInfo.value[1],A=A.value[0]),!A)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var j=t.derToOid(p.contentInfo.value[0].value),O=t.toDer(A);O.getByte(),t.getBerValueLength(O),O=O.getBytes();for(var m in v)v[m].start().update(O);for(var b=new Date,S=0;S<p.signers.length;++S){var h=p.signers[S];if(h.authenticatedAttributes.length===0){if(j!==q.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{h.authenticatedAttributesAsn1=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var g=t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[]),w=0;w<h.authenticatedAttributes.length;++w){var y=h.authenticatedAttributes[w];y.type===q.pki.oids.messageDigest?y.value=v[h.digestAlgorithm].digest():y.type===q.pki.oids.signingTime&&(y.value||(y.value=b)),g.value.push(u(y)),h.authenticatedAttributesAsn1.value.push(u(y))}O=t.toDer(g).getBytes(),h.md.start().update(O)}h.signature=h.key.sign(h.md,"RSASSA-PKCS1-V1_5")}p.signerInfos=o(p.signers)}},r.createEncryptedData=function(){var p=null;return p={type:q.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:q.pki.oids["aes256-CBC"]},fromAsn1:function(I){f(p,I,r.asn1.encryptedDataValidator)},decrypt:function(I){I!==void 0&&(p.encryptedContent.key=I),_(p)}},p},r.createEnvelopedData=function(){var p=null;return p={type:q.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:q.pki.oids["aes256-CBC"]},fromAsn1:function(I){var d=f(p,I,r.asn1.envelopedDataValidator);p.recipients=a(d.recipientInfos.value)},toAsn1:function(){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(p.type).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(p.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,s(p.recipients)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,l(p.encryptedContent))])])])},findRecipient:function(I){for(var d=I.issuer.attributes,v=0;v<p.recipients.length;++v){var A=p.recipients[v],j=A.issuer;if(A.serialNumber!==I.serialNumber)continue;if(j.length!==d.length)continue;for(var O=!0,m=0;m<d.length;++m)if(j[m].type!==d[m].type||j[m].value!==d[m].value){O=!1;break}if(O)return A}return null},decrypt:function(I,d){if(p.encryptedContent.key===void 0&&I!==void 0&&d!==void 0)switch(I.encryptedContent.algorithm){case q.pki.oids.rsaEncryption:case q.pki.oids.desCBC:var v=d.decrypt(I.encryptedContent.content);p.encryptedContent.key=q.util.createBuffer(v);break;default:throw new Error("Unsupported asymmetric cipher, OID "+I.encryptedContent.algorithm)}_(p)},addRecipient:function(I){p.recipients.push({version:0,issuer:I.issuer.attributes,serialNumber:I.serialNumber,encryptedContent:{algorithm:q.pki.oids.rsaEncryption,key:I.publicKey}})},encrypt:function(I,d){if(p.encryptedContent.content===void 0){d=d||p.encryptedContent.algorithm,I=I||p.encryptedContent.key;var v,A,j;switch(d){case q.pki.oids["aes128-CBC"]:v=16,A=16,j=q.aes.createEncryptionCipher;break;case q.pki.oids["aes192-CBC"]:v=24,A=16,j=q.aes.createEncryptionCipher;break;case q.pki.oids["aes256-CBC"]:v=32,A=16,j=q.aes.createEncryptionCipher;break;case q.pki.oids["des-EDE3-CBC"]:v=24,A=8,j=q.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+d)}if(I===void 0)I=q.util.createBuffer(q.random.getBytes(v));else if(I.length()!=v)throw new Error("Symmetric key has wrong length; got "+I.length()+" bytes, expected "+v+".");p.encryptedContent.algorithm=d,p.encryptedContent.key=I,p.encryptedContent.parameter=q.util.createBuffer(q.random.getBytes(A));var O=j(I);if(O.start(p.encryptedContent.parameter.copy()),O.update(p.content),!O.finish())throw new Error("Symmetric encryption failed.");p.encryptedContent.content=O.output}for(var m=0;m<p.recipients.length;++m){var b=p.recipients[m];if(b.encryptedContent.content!==void 0)continue;switch(b.encryptedContent.algorithm){case q.pki.oids.rsaEncryption:b.encryptedContent.content=b.encryptedContent.key.encrypt(p.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+b.encryptedContent.algorithm)}}}},p};function n(p){var I={},d=[];if(!t.validate(p,r.asn1.recipientInfoValidator,I,d)){var v=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw v.errors=d,v}return{version:I.version.charCodeAt(0),issuer:q.pki.RDNAttributesAsArray(I.issuer),serialNumber:q.util.createBuffer(I.serial).toHex(),encryptedContent:{algorithm:t.derToOid(I.encAlgorithm),parameter:I.encParameter.value,content:I.encKey}}}function i(p){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(p.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[q.pki.distinguishedNameToAsn1({attributes:p.issuer}),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,q.util.hexToBytes(p.serialNumber))]),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(p.encryptedContent.algorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,p.encryptedContent.content)])}function a(p){for(var I=[],d=0;d<p.length;++d)I.push(n(p[d]));return I}function s(p){for(var I=[],d=0;d<p.length;++d)I.push(i(p[d]));return I}function c(p){var I=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(p.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[q.pki.distinguishedNameToAsn1({attributes:p.issuer}),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,q.util.hexToBytes(p.serialNumber))]),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(p.digestAlgorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])]);if(p.authenticatedAttributesAsn1&&I.value.push(p.authenticatedAttributesAsn1),I.value.push(t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(p.signatureAlgorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])),I.value.push(t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,p.signature)),p.unauthenticatedAttributes.length>0){for(var d=t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[]),v=0;v<p.unauthenticatedAttributes.length;++v){var A=p.unauthenticatedAttributes[v];d.values.push(u(A))}I.value.push(d)}return I}function o(p){for(var I=[],d=0;d<p.length;++d)I.push(c(p[d]));return I}function u(p){var I;if(p.type===q.pki.oids.contentType)I=t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(p.value).getBytes());else if(p.type===q.pki.oids.messageDigest)I=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,p.value.bytes());else if(p.type===q.pki.oids.signingTime){var d=new Date("1950-01-01T00:00:00Z"),v=new Date("2050-01-01T00:00:00Z"),A=p.value;if(typeof A=="string"){var j=Date.parse(A);isNaN(j)?A.length===13?A=t.utcTimeToDate(A):A=t.generalizedTimeToDate(A):A=new Date(j)}A>=d&&A<v?I=t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(A)):I=t.create(t.Class.UNIVERSAL,t.Type.GENERALIZEDTIME,!1,t.dateToGeneralizedTime(A))}return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(p.type).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[I])])}function l(p){return[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(q.pki.oids.data).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(p.algorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,p.parameter.getBytes())]),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,p.content.getBytes())])]}function f(p,I,d){var v={},A=[];if(!t.validate(I,d,v,A)){var j=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw j.errors=j,j}var O=t.derToOid(v.contentType);if(O!==q.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(v.encryptedContent){var m="";if(q.util.isArray(v.encryptedContent))for(var b=0;b<v.encryptedContent.length;++b){if(v.encryptedContent[b].type!==t.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");m+=v.encryptedContent[b].value}else m=v.encryptedContent;p.encryptedContent={algorithm:t.derToOid(v.encAlgorithm),parameter:q.util.createBuffer(v.encParameter.value),content:q.util.createBuffer(m)}}if(v.content){var m="";if(q.util.isArray(v.content))for(var b=0;b<v.content.length;++b){if(v.content[b].type!==t.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");m+=v.content[b].value}else m=v.content;p.content=q.util.createBuffer(m)}return p.version=v.version.charCodeAt(0),p.rawCapture=v,v}function _(p){if(p.encryptedContent.key===void 0)throw new Error("Symmetric key not available.");if(p.content===void 0){var I;switch(p.encryptedContent.algorithm){case q.pki.oids["aes128-CBC"]:case q.pki.oids["aes192-CBC"]:case q.pki.oids["aes256-CBC"]:I=q.aes.createDecryptionCipher(p.encryptedContent.key);break;case q.pki.oids.desCBC:case q.pki.oids["des-EDE3-CBC"]:I=q.des.createDecryptionCipher(p.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+p.encryptedContent.algorithm)}if(I.start(p.encryptedContent.parameter),I.update(p.encryptedContent.content),!I.finish())throw new Error("Symmetric decryption failed.");p.content=I.output}}}),_w=le(function(e,t){const r=q.pki;t=e.exports,t.certificateForKey=(i,a)=>{const s=r.setRsaPublicKey(a.n,a.e),c=r.createCertificate();c.publicKey=s,c.serialNumber="01",c.validity.notBefore=new Date,c.validity.notAfter=new Date,c.validity.notAfter.setFullYear(c.validity.notBefore.getFullYear()+10);const o=[{name:"organizationName",value:"ipfs"},{shortName:"OU",value:"keystore"},{name:"commonName",value:i.id}];return c.setSubject(o),c.setIssuer(o),c.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"extKeyUsage",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:"nsCertType",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),c.sign(a),c};async function n(i,a){const s=i.map(a),c=await Promise.all(s),o=c.findIndex(u=>u);return i[o]}e.exports.findAsync=n});const{certificateForKey:Ew,findAsync:Sw}=_w;class Aw{constructor(e){if(!e)throw $(new Error("keychain is required"),"ERR_KEYCHAIN_REQUIRED");this.keychain=e}async encrypt(e,t){if(!(t instanceof Uint8Array))throw $(new Error("Plain data must be a Uint8Array"),"ERR_INVALID_PARAMS");const r=await this.keychain.findKeyByName(e),n=await this.keychain._getPrivateKey(e),i=q.pki.decryptRsaPrivateKey(n,this.keychain._()),a=await Ew(r,i),s=q.pkcs7.createEnvelopedData();s.addRecipient(a),s.content=q.util.createBuffer(t),s.encrypt();const c=q.asn1.toDer(s.toAsn1()).getBytes();return st(c,"ascii")}async decrypt(e){if(!(e instanceof Uint8Array))throw $(new Error("CMS data is required"),"ERR_INVALID_PARAMS");let t;try{const c=q.util.createBuffer(qe(e,"ascii")),o=q.asn1.fromDer(c);t=q.pkcs7.messageFromAsn1(o)}catch(c){throw $(new Error("Invalid CMS: "+c.message),"ERR_INVALID_CMS")}const r=t.recipients.filter(c=>c.issuer.find(o=>o.shortName==="O"&&o.value==="ipfs")).filter(c=>c.issuer.find(o=>o.shortName==="CN")).map(c=>({recipient:c,keyId:c.issuer.find(o=>o.shortName==="CN").value})),n=await Sw(r,async c=>{try{const o=await this.keychain.findKeyById(c.keyId);if(o)return!0}catch(o){return!1}return!1});if(!n){const c=r.map(o=>o.keyId);throw $(new Error("Decryption needs one of the key(s): "+c.join(", ")),"ERR_MISSING_KEYS",{missingKeys:c})}const i=await this.keychain.findKeyById(n.keyId),a=await this.keychain._getPrivateKey(i.name),s=q.pki.decryptRsaPrivateKey(a,this.keychain._());return t.decrypt(n.recipient,s),st(t.content.getBytes(),"ascii")}}var Tw=Aw;const{Number:Cw}=Mn,Iw="/pkcs8/",Cd="/info/",xi={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},cu={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function Un(e){return e?typeof e!="string"?!1:e===Iv(e.trim()):!1}async function ze(e){const t=200,r=1e3,n=Math.random()*(r-t)+t;throw await new Promise(i=>setTimeout(i,n)),e}function ui(e){return new ou.Key(Iw+e)}function Bi(e){return new ou.Key(Cd+e)}class Rw{constructor(e,t){if(!e)throw new Error("store is required");if(this.store=e,this.opts=co(cu,t),this.opts.passPhrase&&this.opts.passPhrase.length<20)throw new Error("passPhrase must be least 20 characters");if(this.opts.dek.keyLength<xi.minKeyLength)throw new Error(`dek.keyLength must be least ${xi.minKeyLength} bytes`);if(this.opts.dek.salt.length<xi.minSaltLength)throw new Error(`dek.saltLength must be least ${xi.minSaltLength} bytes`);if(this.opts.dek.iterationCount<xi.minIterationCount)throw new Error(`dek.iterationCount must be least ${xi.minIterationCount}`);const r=this.opts.passPhrase?Rr.pbkdf2(this.opts.passPhrase,this.opts.dek.salt,this.opts.dek.iterationCount,this.opts.dek.keyLength,this.opts.dek.hash):"";Object.defineProperty(this,"_",{value:()=>r})}get cms(){return new Tw(this)}static generateOptions(){const e=Object.assign({},cu),t=Math.ceil(xi.minSaltLength/3)*3;return e.dek.salt=qe(Rr.randomBytes(t),"base64"),e}static get options(){return cu}async createKey(e,t,r){const n=this;if(!Un(e)||e==="self")return ze($(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));if(typeof t!="string")return ze($(new Error(`Invalid key type '${t}'`),"ERR_INVALID_KEY_TYPE"));const i=ui(e),a=await n.store.has(i);if(a)return ze($(new Error(`Key '${e}' already exists`),"ERR_KEY_ALREADY_EXISTS"));switch(t.toLowerCase()){case"rsa":if(!Cw.isSafeInteger(r)||r<2048)return ze($(new Error(`Invalid RSA key size ${r}`),"ERR_INVALID_KEY_SIZE"));break}let s;try{const c=await Rr.keys.generateKeyPair(t,r),o=await c.id(),u=await c.export(this._());s={name:e,id:o};const l=n.store.batch();l.put(i,st(u)),l.put(Bi(e),st(JSON.stringify(s))),await l.commit()}catch(c){return ze(c)}return s}async listKeys(){const e=this,t={prefix:Cd},r=[];for await(const n of e.store.query(t))r.push(JSON.parse(qe(n.value)));return r}async findKeyById(e){try{const t=await this.listKeys();return t.find(r=>r.id===e)}catch(t){return ze(t)}}async findKeyByName(e){if(!Un(e))return ze($(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));const t=Bi(e);try{const r=await this.store.get(t);return JSON.parse(qe(r))}catch(r){return ze($(new Error(`Key '${e}' does not exist. ${r.message}`),"ERR_KEY_NOT_FOUND"))}}async removeKey(e){const t=this;if(!Un(e)||e==="self")return ze($(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));const r=ui(e),n=await t.findKeyByName(e),i=t.store.batch();return i.delete(r),i.delete(Bi(e)),await i.commit(),n}async renameKey(e,t){const r=this;if(!Un(e)||e==="self")return ze($(new Error(`Invalid old key name '${e}'`),"ERR_OLD_KEY_NAME_INVALID"));if(!Un(t)||t==="self")return ze($(new Error(`Invalid new key name '${t}'`),"ERR_NEW_KEY_NAME_INVALID"));const n=ui(e),i=ui(t),a=Bi(e),s=Bi(t),c=await r.store.has(i);if(c)return ze($(new Error(`Key '${t}' already exists`),"ERR_KEY_ALREADY_EXISTS"));try{const o=await r.store.get(n),u=await r.store.get(a),l=JSON.parse(qe(u));l.name=t;const f=r.store.batch();return f.put(i,o),f.put(s,st(JSON.stringify(l))),f.delete(n),f.delete(a),await f.commit(),l}catch(o){return ze(o)}}async exportKey(e,t){if(!Un(e))return ze($(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));if(!t)return ze($(new Error("Password is required"),"ERR_PASSWORD_REQUIRED"));const r=ui(e);try{const n=await this.store.get(r),i=qe(n),a=await Rr.keys.import(i,this._());return a.export(t)}catch(n){return ze(n)}}async importKey(e,t,r){const n=this;if(!Un(e)||e==="self")return ze($(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));if(!t)return ze($(new Error("PEM encoded key is required"),"ERR_PEM_REQUIRED"));const i=ui(e),a=await n.store.has(i);if(a)return ze($(new Error(`Key '${e}' already exists`),"ERR_KEY_ALREADY_EXISTS"));let s;try{s=await Rr.keys.import(t,r)}catch(l){return ze($(new Error("Cannot read the key, most likely the password is wrong"),"ERR_CANNOT_READ_KEY"))}let c;try{c=await s.id(),t=await s.export(this._())}catch(l){return ze(l)}const o={name:e,id:c},u=n.store.batch();return u.put(i,st(t)),u.put(Bi(e),st(JSON.stringify(o))),await u.commit(),o}async importPeer(e,t){const r=this;if(!Un(e))return ze($(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));if(!t||!t.privKey)return ze($(new Error("Peer.privKey is required"),"ERR_MISSING_PRIVATE_KEY"));const n=t.privKey,i=ui(e),a=await r.store.has(i);if(a)return ze($(new Error(`Key '${e}' already exists`),"ERR_KEY_ALREADY_EXISTS"));try{const s=await n.id(),c=await n.export(this._()),o={name:e,id:s},u=r.store.batch();return u.put(i,st(c)),u.put(Bi(e),st(JSON.stringify(o))),await u.commit(),o}catch(s){return ze(s)}}async _getPrivateKey(e){if(!Un(e))return ze($(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));try{const t=ui(e),r=await this.store.get(t);return qe(r)}catch(t){return ze($(new Error(`Key '${e}' does not exist. ${t.message}`),"ERR_KEY_NOT_FOUND"))}}}var Id=Rw;async function*kw(e,t){let r=[];for await(const n of t)r.push(n),r.length===e&&(yield r,r=[]);r.length>0&&(yield r)}function*Pw(e,t){let r=[];for(const n of t)r.push(n),r.length===e&&(yield r,r=[]);r.length>0&&(yield r)}function Rd(e,t){return t===void 0?r=>Rd(e,r):t[Symbol.asyncIterator]?kw(e,t):Pw(e,t)}function Li(e){if(typeof e.next=="function")return e;if(typeof e[Symbol.iterator]=="function")return e[Symbol.iterator]();if(typeof e[Symbol.asyncIterator]=="function")return e[Symbol.asyncIterator]();throw new TypeError('"values" does not to conform to any of the iterator or iterable protocols')}function uu(){let e,t;const r=new Promise((n,i)=>{t=n,e=i});return{promise:r,reject:e,resolve:t}}function Nw(e,t){const r=Li(t),n=[],i=[];let a=!1,s=!1;function c(){for(;i.length>0&&n.length>0;){const f=i.shift(),{error:_,value:p}=n.shift();_?f.reject(_):f.resolve({done:!1,value:p})}for(;i.length>0&&s;){const{resolve:f}=i.shift();f({done:!0,value:void 0})}}async function o(){if(s)return;if(a)return;if(n.length>=e)return;a=!0;try{const{done:f,value:_}=await r.next();f?s=!0:n.push({value:_})}catch(f){s=!0,n.push({error:f})}c(),a=!1,o()}async function u(){if(n.length>0){const{error:_,value:p}=n.shift();if(_)throw _;return o(),{done:!1,value:p}}if(s)return{done:!0,value:void 0};const f=uu();return i.push(f),o(),f.promise}const l={next:u,[Symbol.asyncIterator]:()=>l};return l}function*Ow(e,t){const r=[];let n;try{for(const i of t){if(r.push(i),r.length<=e)continue;yield r.shift()}}catch(i){n=i}for(const i of r)yield i;if(n)throw n}function fo(e,t){return t===void 0?r=>fo(e,r):e===0?t:t[Symbol.asyncIterator]?Nw(e,t):Ow(e,t)}async function Dw(e){const t=[];for await(const r of e)t.push(r);return t}function Mw(e){return e[Symbol.asyncIterator]?Dw(e):Array.from(e)}async function*xw(e){for await(const t of e)yield*t}function*Bw(e){for(const t of e)yield*t}function Lw(...e){const t=e.find(r=>r[Symbol.asyncIterator]!==void 0);return t?xw(e):Bw(e)}async function jw(e){for await(const t of e);}function Uw(e){if(e[Symbol.asyncIterator])return jw(e);for(const t of e);}async function*kd(e,t){for await(const r of t)await e(r)&&(yield r)}function mo(e,t){return t===void 0?r=>kd(e,r):kd(e,t)}async function*us(e){for await(const t of e)t&&typeof t!="string"&&(t[Symbol.iterator]||t[Symbol.asyncIterator])?yield*us(t):yield t}async function*Pd(e,t){for await(const r of t)yield await e(r)}function go(e,t){return t===void 0?r=>Pd(e,r):Pd(e,t)}function Nd(e,t){return t===void 0?r=>Nd(e,r):mo(r=>r!=null,us(go(e,t)))}function Fw(e,t,r){const n=Li(r),i=[],a=[];let s=!1,c=!1,o=0,u=null;function l(){for(;a.length>0&&i.length>0;){const{resolve:d}=a.shift(),v=i.shift();d({done:!1,value:v})}for(;a.length>0&&o===0&&s;){const{resolve:d,reject:v}=a.shift();u?(v(u),u=null):d({done:!0,value:void 0})}}async function f(){if(s){l();return}if(c)return;if(o+i.length>=e)return;c=!0,o++;try{const{done:d,value:v}=await n.next();d?(s=!0,o--,l()):_(v)}catch(d){s=!0,o--,u=d,l()}c=!1,f()}async function _(d){try{const v=await t(d);if(v&&v[Symbol.asyncIterator])for await(const A of v)i.push(A);else i.push(v)}catch(v){s=!0,u=v}o--,l(),f()}async function p(){if(i.length===0){const v=uu();return a.push(v),f(),v.promise}const d=i.shift();return f(),{done:!1,value:d}}const I={next:p,[Symbol.asyncIterator]:()=>I};return I}function bo(e,t,r){return t===void 0?(n,i)=>i?bo(e,n,i):bo(e,n):r===void 0?n=>bo(e,t,n):mo(n=>n!=null,us(Fw(e,t,r)))}async function qw(e){return new Promise(t=>{e.once("readable",()=>{t()})})}async function*Gw(e){for(;;){const t=e.read();if(t!==null){yield t;continue}if(e._readableState.ended)break;await qw(e)}}function $w(e){return typeof e[Symbol.asyncIterator]=="function"?e:Gw(e)}async function*Vw(...e){const t=new Set(e.map(Li));for(;t.size>0;)for(const r of t){const n=await r.next();n.done?t.delete(r):yield n.value}}function Od(e,...t){let r=e();for(const n of t)r=n(r);return r}async function*Hw(e,t,r){let n=null;const i=o=>({value:t(o)}),a=async function*(o){for await(const u of o){if(n)return;yield u}},s=Od(()=>r,fo(1),a,go(i),fo(e-1)),c=Li(s);for(;;){const{value:o,done:u}=await c.next();if(u)break;try{const l=await o.value;n||(yield l)}catch(l){n=l}}if(n)throw n}function yo(e,t,r){return t===void 0?(n,i)=>yo(e,n,i):r===void 0?n=>yo(e,t,n):e===1?go(t,r):Hw(e,t,r)}function vo(e,t,r){return t===void 0?(n,i)=>i?vo(e,n,i):vo(e,n):r===void 0?n=>vo(e,t,n):mo(n=>n!=null,us(yo(e,t,r)))}async function*zw(...e){const t=e.map(Li),r=new Set,n=new Map;let i=null,a=null,s=null;const c=f=>{i=f,a&&a(f)},o=f=>{s&&s(f)},u=()=>new Promise((f,_)=>{if(i&&_(i),n.size>0)return f();s=f,a=_}),l=f=>{const _=Promise.resolve(f.next()).then(async({done:p,value:I})=>{p||n.set(f,I),r.delete(_)});r.add(_),_.then(o,c)};for(const f of t)l(f);for(;;){if(r.size===0&&n.size===0)return;await u();for(const[f,_]of n)n.delete(f),yield _,l(f)}}async function Dd(e,t,r){let n=t;for await(const i of r)n=await e(n,i);return n}function lu(e,t,r){return t===void 0?(n,i)=>i?Dd(e,n,i):lu(e,n):r===void 0?n=>lu(e,t,n):Dd(e,t,r)}async function*Kw(e,t){let r=0;for await(const n of t)if(yield await n,r++,r>=e)break}function*Ww(e,t){let r=0;for(const n of t)if(yield n,r++,r>=e)break}function Md(e,t){return t===void 0?r=>Md(e,r):t[Symbol.asyncIterator]?Kw(e,t):Ww(e,t)}async function*xd(e,t){for await(const r of t)await e(r),yield r}function Xw(e,t){return t===void 0?r=>xd(e,r):xd(e,t)}function Bd(e,t){let r=e[0]+t[0],n=e[1]+t[1];if(n>=1e9){const i=n%1e9;r+=(n-i)/1e9,n=i}return[r,n]}async function*Qw(e,t){const r=t[Symbol.asyncIterator]();let n=[0,0];for(;;){const i=_e.hrtime(),{value:a,done:s}=await r.next(),c=_e.hrtime(i);if(n=Bd(n,c),e.progress&&e.progress(c,n),s)return e.total&&e.total(n),a;yield a}}function*Yw(e,t){const r=t[Symbol.iterator]();let n=[0,0];for(;;){const i=_e.hrtime(),{value:a,done:s}=r.next(),c=_e.hrtime(i);if(n=Bd(n,c),e.progress&&e.progress(c,n),s)return e.total&&e.total(n),a;yield a}}function Ld(e={},t){return t===void 0?r=>Ld(e,r):t[Symbol.asyncIterator]!==void 0?Qw(e,t):Yw(e,t)}function Jw(e,t,r){const n=Li(r),i=[],a=[];let s=!1,c=!1,o=0,u=null;function l(){for(;a.length>0&&i.length>0;){const{resolve:d}=a.shift(),v=i.shift();d({done:!1,value:v})}for(;a.length>0&&o===0&&s;){const{resolve:d,reject:v}=a.shift();u?(v(u),u=null):d({done:!0,value:void 0})}}async function f(){if(s){l();return}if(c)return;if(o+i.length>=e)return;c=!0,o++;try{const{done:d,value:v}=await n.next();d?(s=!0,o--,l()):_(v)}catch(d){s=!0,o--,u=d,l()}c=!1,f()}async function _(d){try{const v=await t(d);i.push(v)}catch(v){s=!0,u=v}o--,l(),f()}async function p(){if(i.length===0){const v=uu();return a.push(v),f(),v.promise}const d=i.shift();return f(),{done:!1,value:d}}const I={next:p,[Symbol.asyncIterator]:()=>I};return I}function wo(e,t,r){return t===void 0?(n,i)=>i?wo(e,n,i):wo(e,n):r===void 0?n=>wo(e,t,n):Jw(e,t,r)}async function jd(e,t){let r=null,n=null,i=null;const a=u=>{r=u,n&&n(u)},s=()=>{i&&i()},c=()=>{e.removeListener("error",a),e.removeListener("drain",s)};e.once("error",a);const o=()=>new Promise((u,l)=>{if(r)return l(r);e.once("drain",s),i=u,n=l});for await(const u of t)if(e.write(u)===!1&&await o(),r)break;if(c(),r)throw r}function Zw(e,t){return t===void 0?r=>jd(e,r):jd(e,t)}var e0=Object.freeze({__proto__:null,batch:Rd,buffer:fo,collect:Mw,concat:Lw,consume:Uw,filter:mo,flatMap:Nd,flatTransform:bo,flatten:us,fromStream:$w,getIterator:Li,map:go,merge:Vw,parallelFlatMap:vo,parallelMap:yo,parallelMerge:zw,pipeline:Od,reduce:lu,take:Md,tap:Xw,time:Ld,transform:wo,writeToStream:Zw}),t0=function(e){if(!e)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,r=Object.create(null),n=Object.create(null);function i(a,s){r[a]=s,t++,t>=e&&(t=0,n=r,r=Object.create(null))}return{has:function(a){return r[a]!==void 0||n[a]!==void 0},remove:function(a){r[a]!==void 0&&(r[a]=void 0),n[a]!==void 0&&(n[a]=void 0)},get:function(a){var s=r[a];if(s!==void 0)return s;if((s=n[a])!==void 0)return i(a,s),s},set:function(a,s){r[a]!==void 0?r[a]=s:i(a,s)},clear:function(){r=Object.create(null),n=Object.create(null)}}},r0=e=>{const t=t0(e);return t.delete=t.remove,t},n0=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,hu=Math.ceil,Sn=Math.floor,rr="[BigNumber Error] ",Ud=rr+"Number primitive has more than 15 significant digits: ",Qr=1e14,Ee=14,du=9007199254740991,pu=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],li=1e7,wt=1e9;function Fd(e){var t,r,n,i=A.prototype={constructor:A,toString:null,valueOf:null},a=new A(1),s=20,c=4,o=-7,u=21,l=-1e7,f=1e7,_=!1,p=1,I=0,d={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},v="0123456789abcdefghijklmnopqrstuvwxyz";function A(h,g){var w,y,P,D,L,x,B,G,V=this;if(!(V instanceof A))return new A(h,g);if(g==null){if(h&&h._isBigNumber===!0){V.s=h.s,!h.c||h.e>f?V.c=V.e=null:h.e<l?V.c=[V.e=0]:(V.e=h.e,V.c=h.c.slice());return}if((x=typeof h=="number")&&h*0==0){if(V.s=1/h<0?(h=-h,-1):1,h===~~h){for(D=0,L=h;L>=10;L/=10,D++);D>f?V.c=V.e=null:(V.e=D,V.c=[h]);return}G=String(h)}else{if(!n0.test(G=String(h)))return n(V,G,x);V.s=G.charCodeAt(0)==45?(G=G.slice(1),-1):1}(D=G.indexOf("."))>-1&&(G=G.replace(".","")),(L=G.search(/e/i))>0?(D<0&&(D=L),D+=+G.slice(L+1),G=G.substring(0,L)):D<0&&(D=G.length)}else{if(Je(g,2,v.length,"Base"),g==10)return V=new A(h),b(V,s+V.e+1,c);if(G=String(h),x=typeof h=="number"){if(h*0!=0)return n(V,G,x,g);if(V.s=1/h<0?(G=G.slice(1),-1):1,A.DEBUG&&G.replace(/^0\.0*|\./,"").length>15)throw Error(Ud+h)}else V.s=G.charCodeAt(0)===45?(G=G.slice(1),-1):1;for(w=v.slice(0,g),D=L=0,B=G.length;L<B;L++)if(w.indexOf(y=G.charAt(L))<0){if(y=="."){if(L>D){D=B;continue}}else if(!P&&(G==G.toUpperCase()&&(G=G.toLowerCase())||G==G.toLowerCase()&&(G=G.toUpperCase()))){P=!0,L=-1,D=0;continue}return n(V,String(h),x,g)}x=!1,G=r(G,g,10,V.s),(D=G.indexOf("."))>-1?G=G.replace(".",""):D=G.length}for(L=0;G.charCodeAt(L)===48;L++);for(B=G.length;G.charCodeAt(--B)===48;);if(G=G.slice(L,++B)){if(B-=L,x&&A.DEBUG&&B>15&&(h>du||h!==Sn(h)))throw Error(Ud+V.s*h);if((D=D-L-1)>f)V.c=V.e=null;else if(D<l)V.c=[V.e=0];else{if(V.e=D,V.c=[],L=(D+1)%Ee,D<0&&(L+=Ee),L<B){for(L&&V.c.push(+G.slice(0,L)),B-=Ee;L<B;)V.c.push(+G.slice(L,L+=Ee));L=Ee-(G=G.slice(L)).length}else L-=B;for(;L--;G+="0");V.c.push(+G)}}else V.c=[V.e=0]}A.clone=Fd,A.ROUND_UP=0,A.ROUND_DOWN=1,A.ROUND_CEIL=2,A.ROUND_FLOOR=3,A.ROUND_HALF_UP=4,A.ROUND_HALF_DOWN=5,A.ROUND_HALF_EVEN=6,A.ROUND_HALF_CEIL=7,A.ROUND_HALF_FLOOR=8,A.EUCLID=9,A.config=A.set=function(h){var g,w;if(h!=null)if(typeof h=="object"){if(h.hasOwnProperty(g="DECIMAL_PLACES")&&(w=h[g],Je(w,0,wt,g),s=w),h.hasOwnProperty(g="ROUNDING_MODE")&&(w=h[g],Je(w,0,8,g),c=w),h.hasOwnProperty(g="EXPONENTIAL_AT")&&(w=h[g],w&&w.pop?(Je(w[0],-wt,0,g),Je(w[1],0,wt,g),o=w[0],u=w[1]):(Je(w,-wt,wt,g),o=-(u=w<0?-w:w))),h.hasOwnProperty(g="RANGE"))if(w=h[g],w&&w.pop)Je(w[0],-wt,-1,g),Je(w[1],1,wt,g),l=w[0],f=w[1];else if(Je(w,-wt,wt,g),w)l=-(f=w<0?-w:w);else throw Error(rr+g+" cannot be zero: "+w);if(h.hasOwnProperty(g="CRYPTO"))if(w=h[g],w===!!w)if(w)if(typeof crypto!="undefined"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))_=w;else throw _=!w,Error(rr+"crypto unavailable");else _=w;else throw Error(rr+g+" not true or false: "+w);if(h.hasOwnProperty(g="MODULO_MODE")&&(w=h[g],Je(w,0,9,g),p=w),h.hasOwnProperty(g="POW_PRECISION")&&(w=h[g],Je(w,0,wt,g),I=w),h.hasOwnProperty(g="FORMAT"))if(w=h[g],typeof w=="object")d=w;else throw Error(rr+g+" not an object: "+w);if(h.hasOwnProperty(g="ALPHABET"))if(w=h[g],typeof w=="string"&&!/^.$|[+-.\s]|(.).*\1/.test(w))v=w;else throw Error(rr+g+" invalid: "+w)}else throw Error(rr+"Object expected: "+h);return{DECIMAL_PLACES:s,ROUNDING_MODE:c,EXPONENTIAL_AT:[o,u],RANGE:[l,f],CRYPTO:_,MODULO_MODE:p,POW_PRECISION:I,FORMAT:d,ALPHABET:v}},A.isBigNumber=function(h){if(!h||h._isBigNumber!==!0)return!1;if(!A.DEBUG)return!0;var g,w,y=h.c,P=h.e,D=h.s;e:if({}.toString.call(y)=="[object Array]"){if((D===1||D===-1)&&P>=-wt&&P<=wt&&P===Sn(P)){if(y[0]===0){if(P===0&&y.length===1)return!0;break e}if(g=(P+1)%Ee,g<1&&(g+=Ee),String(y[0]).length==g){for(g=0;g<y.length;g++)if(w=y[g],w<0||w>=Qr||w!==Sn(w))break e;if(w!==0)return!0}}}else if(y===null&&P===null&&(D===null||D===1||D===-1))return!0;throw Error(rr+"Invalid BigNumber: "+h)},A.maximum=A.max=function(){return O(arguments,i.lt)},A.minimum=A.min=function(){return O(arguments,i.gt)},A.random=function(){var h=9007199254740992,g=Math.random()*h&2097151?function(){return Sn(Math.random()*h)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(w){var y,P,D,L,x,B=0,G=[],V=new A(a);if(w==null?w=s:Je(w,0,wt),L=hu(w/Ee),_)if(crypto.getRandomValues){for(y=crypto.getRandomValues(new Uint32Array(L*=2));B<L;)x=y[B]*131072+(y[B+1]>>>11),x>=9e15?(P=crypto.getRandomValues(new Uint32Array(2)),y[B]=P[0],y[B+1]=P[1]):(G.push(x%1e14),B+=2);B=L/2}else if(crypto.randomBytes){for(y=crypto.randomBytes(L*=7);B<L;)x=(y[B]&31)*281474976710656+y[B+1]*1099511627776+y[B+2]*4294967296+y[B+3]*16777216+(y[B+4]<<16)+(y[B+5]<<8)+y[B+6],x>=9e15?crypto.randomBytes(7).copy(y,B):(G.push(x%1e14),B+=7);B=L/7}else throw _=!1,Error(rr+"crypto unavailable");if(!_)for(;B<L;)x=g(),x<9e15&&(G[B++]=x%1e14);for(L=G[--B],w%=Ee,L&&w&&(x=pu[Ee-w],G[B]=Sn(L/x)*x);G[B]===0;G.pop(),B--);if(B<0)G=[D=0];else{for(D=-1;G[0]===0;G.splice(0,1),D-=Ee);for(B=1,x=G[0];x>=10;x/=10,B++);B<Ee&&(D-=Ee-B)}return V.e=D,V.c=G,V}}(),A.sum=function(){for(var h=1,g=arguments,w=new A(g[0]);h<g.length;)w=w.plus(g[h++]);return w},r=function(){var h="0123456789";function g(w,y,P,D){for(var L,x=[0],B,G=0,V=w.length;G<V;){for(B=x.length;B--;x[B]*=y);for(x[0]+=D.indexOf(w.charAt(G++)),L=0;L<x.length;L++)x[L]>P-1&&(x[L+1]==null&&(x[L+1]=0),x[L+1]+=x[L]/P|0,x[L]%=P)}return x.reverse()}return function(w,y,P,D,L){var x,B,G,V,K,ae,se,ve,fe=w.indexOf("."),me=s,pe=c;for(fe>=0&&(V=I,I=0,w=w.replace(".",""),ve=new A(y),ae=ve.pow(w.length-fe),I=V,ve.c=g(Fn(Pr(ae.c),ae.e,"0"),10,P,h),ve.e=ve.c.length),se=g(w,y,P,L?(x=v,h):(x=h,v)),G=V=se.length;se[--V]==0;se.pop());if(!se[0])return x.charAt(0);if(fe<0?--G:(ae.c=se,ae.e=G,ae.s=D,ae=t(ae,ve,me,pe,P),se=ae.c,K=ae.r,G=ae.e),B=G+me+1,fe=se[B],V=P/2,K=K||B<0||se[B+1]!=null,K=pe<4?(fe!=null||K)&&(pe==0||pe==(ae.s<0?3:2)):fe>V||fe==V&&(pe==4||K||pe==6&&se[B-1]&1||pe==(ae.s<0?8:7)),B<1||!se[0])w=K?Fn(x.charAt(1),-me,x.charAt(0)):x.charAt(0);else{if(se.length=B,K)for(--P;++se[--B]>P;)se[B]=0,B||(++G,se=[1].concat(se));for(V=se.length;!se[--V];);for(fe=0,w="";fe<=V;w+=x.charAt(se[fe++]));w=Fn(w,G,x.charAt(0))}return w}}(),t=function(){function h(y,P,D){var L,x,B,G,V=0,K=y.length,ae=P%li,se=P/li|0;for(y=y.slice();K--;)B=y[K]%li,G=y[K]/li|0,L=se*B+G*ae,x=ae*B+L%li*li+V,V=(x/D|0)+(L/li|0)+se*G,y[K]=x%D;return V&&(y=[V].concat(y)),y}function g(y,P,D,L){var x,B;if(D!=L)B=D>L?1:-1;else for(x=B=0;x<D;x++)if(y[x]!=P[x]){B=y[x]>P[x]?1:-1;break}return B}function w(y,P,D,L){for(var x=0;D--;)y[D]-=x,x=y[D]<P[D]?1:0,y[D]=x*L+y[D]-P[D];for(;!y[0]&&y.length>1;y.splice(0,1));}return function(y,P,D,L,x){var B,G,V,K,ae,se,ve,fe,me,pe,R,W,Q,Z,ne,ce,de,oe=y.s==P.s?1:-1,Se=y.c,J=P.c;if(!Se||!Se[0]||!J||!J[0])return new A(!y.s||!P.s||(Se?J&&Se[0]==J[0]:!J)?NaN:Se&&Se[0]==0||!J?oe*0:oe/0);for(fe=new A(oe),me=fe.c=[],G=y.e-P.e,oe=D+G+1,x||(x=Qr,G=kr(y.e/Ee)-kr(P.e/Ee),oe=oe/Ee|0),V=0;J[V]==(Se[V]||0);V++);if(J[V]>(Se[V]||0)&&G--,oe<0)me.push(1),K=!0;else{for(Z=Se.length,ce=J.length,V=0,oe+=2,ae=Sn(x/(J[0]+1)),ae>1&&(J=h(J,ae,x),Se=h(Se,ae,x),ce=J.length,Z=Se.length),Q=ce,pe=Se.slice(0,ce),R=pe.length;R<ce;pe[R++]=0);de=J.slice(),de=[0].concat(de),ne=J[0],J[1]>=x/2&&ne++;do{if(ae=0,B=g(J,pe,ce,R),B<0){if(W=pe[0],ce!=R&&(W=W*x+(pe[1]||0)),ae=Sn(W/ne),ae>1)for(ae>=x&&(ae=x-1),se=h(J,ae,x),ve=se.length,R=pe.length;g(se,pe,ve,R)==1;)ae--,w(se,ce<ve?de:J,ve,x),ve=se.length,B=1;else ae==0&&(B=ae=1),se=J.slice(),ve=se.length;if(ve<R&&(se=[0].concat(se)),w(pe,se,R,x),R=pe.length,B==-1)for(;g(J,pe,ce,R)<1;)ae++,w(pe,ce<R?de:J,R,x),R=pe.length}else B===0&&(ae++,pe=[0]);me[V++]=ae,pe[0]?pe[R++]=Se[Q]||0:(pe=[Se[Q]],R=1)}while((Q++<Z||pe[0]!=null)&&oe--);K=pe[0]!=null,me[0]||me.splice(0,1)}if(x==Qr){for(V=1,oe=me[0];oe>=10;oe/=10,V++);b(fe,D+(fe.e=V+G*Ee-1)+1,L,K)}else fe.e=G,fe.r=+K;return fe}}();function j(h,g,w,y){var P,D,L,x,B;if(w==null?w=c:Je(w,0,8),!h.c)return h.toString();if(P=h.c[0],L=h.e,g==null)B=Pr(h.c),B=y==1||y==2&&(L<=o||L>=u)?Eo(B,L):Fn(B,L,"0");else if(h=b(new A(h),g,w),D=h.e,B=Pr(h.c),x=B.length,y==1||y==2&&(g<=D||D<=o)){for(;x<g;B+="0",x++);B=Eo(B,D)}else if(g-=L,B=Fn(B,D,"0"),D+1>x){if(--g>0)for(B+=".";g--;B+="0");}else if(g+=D-x,g>0)for(D+1==x&&(B+=".");g--;B+="0");return h.s<0&&P?"-"+B:B}function O(h,g){for(var w,y=1,P=new A(h[0]);y<h.length;y++)if(w=new A(h[y]),w.s)g.call(P,w)&&(P=w);else{P=w;break}return P}function m(h,g,w){for(var y=1,P=g.length;!g[--P];g.pop());for(P=g[0];P>=10;P/=10,y++);return(w=y+w*Ee-1)>f?h.c=h.e=null:w<l?h.c=[h.e=0]:(h.e=w,h.c=g),h}n=function(){var h=/^(-?)0([xbo])(?=\w[\w.]*$)/i,g=/^([^.]+)\.$/,w=/^\.([^.]+)$/,y=/^-?(Infinity|NaN)$/,P=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(D,L,x,B){var G,V=x?L:L.replace(P,"");if(y.test(V))D.s=isNaN(V)?null:V<0?-1:1;else{if(!x&&(V=V.replace(h,function(K,ae,se){return G=(se=se.toLowerCase())=="x"?16:se=="b"?2:8,!B||B==G?ae:K}),B&&(G=B,V=V.replace(g,"$1").replace(w,"0.$1")),L!=V))return new A(V,G);if(A.DEBUG)throw Error(rr+"Not a"+(B?" base "+B:"")+" number: "+L);D.s=null}D.c=D.e=null}}();function b(h,g,w,y){var P,D,L,x,B,G,V,K=h.c,ae=pu;if(K){e:{for(P=1,x=K[0];x>=10;x/=10,P++);if(D=g-P,D<0)D+=Ee,L=g,B=K[G=0],V=B/ae[P-L-1]%10|0;else if(G=hu((D+1)/Ee),G>=K.length)if(y){for(;K.length<=G;K.push(0));B=V=0,P=1,D%=Ee,L=D-Ee+1}else break e;else{for(B=x=K[G],P=1;x>=10;x/=10,P++);D%=Ee,L=D-Ee+P,V=L<0?0:B/ae[P-L-1]%10|0}if(y=y||g<0||K[G+1]!=null||(L<0?B:B%ae[P-L-1]),y=w<4?(V||y)&&(w==0||w==(h.s<0?3:2)):V>5||V==5&&(w==4||y||w==6&&(D>0?L>0?B/ae[P-L]:0:K[G-1])%10&1||w==(h.s<0?8:7)),g<1||!K[0])return K.length=0,y?(g-=h.e+1,K[0]=ae[(Ee-g%Ee)%Ee],h.e=-g||0):K[0]=h.e=0,h;if(D==0?(K.length=G,x=1,G--):(K.length=G+1,x=ae[Ee-D],K[G]=L>0?Sn(B/ae[P-L]%ae[L])*x:0),y)for(;;)if(G==0){for(D=1,L=K[0];L>=10;L/=10,D++);for(L=K[0]+=x,x=1;L>=10;L/=10,x++);D!=x&&(h.e++,K[0]==Qr&&(K[0]=1));break}else{if(K[G]+=x,K[G]!=Qr)break;K[G--]=0,x=1}for(D=K.length;K[--D]===0;K.pop());}h.e>f?h.c=h.e=null:h.e<l&&(h.c=[h.e=0])}return h}function S(h){var g,w=h.e;return w===null?h.toString():(g=Pr(h.c),g=w<=o||w>=u?Eo(g,w):Fn(g,w,"0"),h.s<0?"-"+g:g)}return i.absoluteValue=i.abs=function(){var h=new A(this);return h.s<0&&(h.s=1),h},i.comparedTo=function(h,g){return ga(this,new A(h,g))},i.decimalPlaces=i.dp=function(h,g){var w,y,P,D=this;if(h!=null)return Je(h,0,wt),g==null?g=c:Je(g,0,8),b(new A(D),h+D.e+1,g);if(!(w=D.c))return null;if(y=((P=w.length-1)-kr(this.e/Ee))*Ee,P=w[P])for(;P%10==0;P/=10,y--);return y<0&&(y=0),y},i.dividedBy=i.div=function(h,g){return t(this,new A(h,g),s,c)},i.dividedToIntegerBy=i.idiv=function(h,g){return t(this,new A(h,g),0,1)},i.exponentiatedBy=i.pow=function(h,g){var w,y,P,D,L,x,B,G,V,K=this;if(h=new A(h),h.c&&!h.isInteger())throw Error(rr+"Exponent not an integer: "+S(h));if(g!=null&&(g=new A(g)),x=h.e>14,!K.c||!K.c[0]||K.c[0]==1&&!K.e&&K.c.length==1||!h.c||!h.c[0])return V=new A(Math.pow(+S(K),x?2-_o(h):+S(h))),g?V.mod(g):V;if(B=h.s<0,g){if(g.c?!g.c[0]:!g.s)return new A(NaN);y=!B&&K.isInteger()&&g.isInteger(),y&&(K=K.mod(g))}else{if(h.e>9&&(K.e>0||K.e<-1||(K.e==0?K.c[0]>1||x&&K.c[1]>=24e7:K.c[0]<8e13||x&&K.c[0]<=9999975e7)))return D=(K.s<0&&_o(h),-0),K.e>-1&&(D=1/D),new A(B?1/D:D);I&&(D=hu(I/Ee+2))}for(x?(w=new A(.5),B&&(h.s=1),G=_o(h)):(P=Math.abs(+S(h)),G=P%2),V=new A(a);;){if(G){if(V=V.times(K),!V.c)break;D?V.c.length>D&&(V.c.length=D):y&&(V=V.mod(g))}if(P){if(P=Sn(P/2),P===0)break;G=P%2}else if(h=h.times(w),b(h,h.e+1,1),h.e>14)G=_o(h);else{if(P=+S(h),P===0)break;G=P%2}K=K.times(K),D?K.c&&K.c.length>D&&(K.c.length=D):y&&(K=K.mod(g))}return y?V:(B&&(V=a.div(V)),g?V.mod(g):D?b(V,I,c,L):V)},i.integerValue=function(h){var g=new A(this);return h==null?h=c:Je(h,0,8),b(g,g.e+1,h)},i.isEqualTo=i.eq=function(h,g){return ga(this,new A(h,g))===0},i.isFinite=function(){return!!this.c},i.isGreaterThan=i.gt=function(h,g){return ga(this,new A(h,g))>0},i.isGreaterThanOrEqualTo=i.gte=function(h,g){return(g=ga(this,new A(h,g)))===1||g===0},i.isInteger=function(){return!!this.c&&kr(this.e/Ee)>this.c.length-2},i.isLessThan=i.lt=function(h,g){return ga(this,new A(h,g))<0},i.isLessThanOrEqualTo=i.lte=function(h,g){return(g=ga(this,new A(h,g)))===-1||g===0},i.isNaN=function(){return!this.s},i.isNegative=function(){return this.s<0},i.isPositive=function(){return this.s>0},i.isZero=function(){return!!this.c&&this.c[0]==0},i.minus=function(h,g){var w,y,P,D,L=this,x=L.s;if(h=new A(h,g),g=h.s,!x||!g)return new A(NaN);if(x!=g)return h.s=-g,L.plus(h);var B=L.e/Ee,G=h.e/Ee,V=L.c,K=h.c;if(!B||!G){if(!V||!K)return V?(h.s=-g,h):new A(K?L:NaN);if(!V[0]||!K[0])return K[0]?(h.s=-g,h):new A(V[0]?L:(c==3,-0))}if(B=kr(B),G=kr(G),V=V.slice(),x=B-G){for((D=x<0)?(x=-x,P=V):(G=B,P=K),P.reverse(),g=x;g--;P.push(0));P.reverse()}else for(y=(D=(x=V.length)<(g=K.length))?x:g,x=g=0;g<y;g++)if(V[g]!=K[g]){D=V[g]<K[g];break}if(D&&(P=V,V=K,K=P,h.s=-h.s),g=(y=K.length)-(w=V.length),g>0)for(;g--;V[w++]=0);for(g=Qr-1;y>x;){if(V[--y]<K[y]){for(w=y;w&&!V[--w];V[w]=g);--V[w],V[y]+=Qr}V[y]-=K[y]}for(;V[0]==0;V.splice(0,1),--G);return V[0]?m(h,V,G):(h.s=c==3?-1:1,h.c=[h.e=0],h)},i.modulo=i.mod=function(h,g){var w,y,P=this;return h=new A(h,g),!P.c||!h.s||h.c&&!h.c[0]?new A(NaN):!h.c||P.c&&!P.c[0]?new A(P):(p==9?(y=h.s,h.s=1,w=t(P,h,0,3),h.s=y,w.s*=y):w=t(P,h,0,p),h=P.minus(w.times(h)),!h.c[0]&&p==1&&(h.s=P.s),h)},i.multipliedBy=i.times=function(h,g){var w,y,P,D,L,x,B,G,V,K,ae,se,ve,fe,me,pe=this,R=pe.c,W=(h=new A(h,g)).c;if(!R||!W||!R[0]||!W[0])return!pe.s||!h.s||R&&!R[0]&&!W||W&&!W[0]&&!R?h.c=h.e=h.s=null:(h.s*=pe.s,!R||!W?h.c=h.e=null:(h.c=[0],h.e=0)),h;for(y=kr(pe.e/Ee)+kr(h.e/Ee),h.s*=pe.s,B=R.length,K=W.length,B<K&&(ve=R,R=W,W=ve,P=B,B=K,K=P),P=B+K,ve=[];P--;ve.push(0));for(fe=Qr,me=li,P=K;--P>=0;){for(w=0,ae=W[P]%me,se=W[P]/me|0,L=B,D=P+L;D>P;)G=R[--L]%me,V=R[L]/me|0,x=se*G+V*ae,G=ae*G+x%me*me+ve[D]+w,w=(G/fe|0)+(x/me|0)+se*V,ve[D--]=G%fe;ve[D]=w}return w?++y:ve.splice(0,1),m(h,ve,y)},i.negated=function(){var h=new A(this);return h.s=-h.s||null,h},i.plus=function(h,g){var w,y=this,P=y.s;if(h=new A(h,g),g=h.s,!P||!g)return new A(NaN);if(P!=g)return h.s=-g,y.minus(h);var D=y.e/Ee,L=h.e/Ee,x=y.c,B=h.c;if(!D||!L){if(!x||!B)return new A(P/0);if(!x[0]||!B[0])return B[0]?h:new A(x[0]?y:P*0)}if(D=kr(D),L=kr(L),x=x.slice(),P=D-L){for(P>0?(L=D,w=B):(P=-P,w=x),w.reverse();P--;w.push(0));w.reverse()}for(P=x.length,g=B.length,P-g<0&&(w=B,B=x,x=w,g=P),P=0;g;)P=(x[--g]=x[g]+B[g]+P)/Qr|0,x[g]=Qr===x[g]?0:x[g]%Qr;return P&&(x=[P].concat(x),++L),m(h,x,L)},i.precision=i.sd=function(h,g){var w,y,P,D=this;if(h!=null&&h!==!!h)return Je(h,1,wt),g==null?g=c:Je(g,0,8),b(new A(D),h,g);if(!(w=D.c))return null;if(P=w.length-1,y=P*Ee+1,P=w[P]){for(;P%10==0;P/=10,y--);for(P=w[0];P>=10;P/=10,y++);}return h&&D.e+1>y&&(y=D.e+1),y},i.shiftedBy=function(h){return Je(h,-du,du),this.times("1e"+h)},i.squareRoot=i.sqrt=function(){var h,g,w,y,P,D=this,L=D.c,x=D.s,B=D.e,G=s+4,V=new A("0.5");if(x!==1||!L||!L[0])return new A(!x||x<0&&(!L||L[0])?NaN:L?D:1/0);if(x=Math.sqrt(+S(D)),x==0||x==1/0?(g=Pr(L),(g.length+B)%2==0&&(g+="0"),x=Math.sqrt(+g),B=kr((B+1)/2)-(B<0||B%2),x==1/0?g="5e"+B:(g=x.toExponential(),g=g.slice(0,g.indexOf("e")+1)+B),w=new A(g)):w=new A(x+""),w.c[0]){for(B=w.e,x=B+G,x<3&&(x=0);;)if(P=w,w=V.times(P.plus(t(D,P,G,1))),Pr(P.c).slice(0,x)===(g=Pr(w.c)).slice(0,x))if(w.e<B&&--x,g=g.slice(x-3,x+1),g=="9999"||!y&&g=="4999"){if(!y&&(b(P,P.e+s+2,0),P.times(P).eq(D))){w=P;break}G+=4,x+=4,y=1}else{(!+g||!+g.slice(1)&&g.charAt(0)=="5")&&(b(w,w.e+s+2,1),h=!w.times(w).eq(D));break}}return b(w,w.e+s+1,c,h)},i.toExponential=function(h,g){return h!=null&&(Je(h,0,wt),h++),j(this,h,g,1)},i.toFixed=function(h,g){return h!=null&&(Je(h,0,wt),h=h+this.e+1),j(this,h,g)},i.toFormat=function(h,g,w){var y,P=this;if(w==null)h!=null&&g&&typeof g=="object"?(w=g,g=null):h&&typeof h=="object"?(w=h,h=g=null):w=d;else if(typeof w!="object")throw Error(rr+"Argument not an object: "+w);if(y=P.toFixed(h,g),P.c){var D,L=y.split("."),x=+w.groupSize,B=+w.secondaryGroupSize,G=w.groupSeparator||"",V=L[0],K=L[1],ae=P.s<0,se=ae?V.slice(1):V,ve=se.length;if(B&&(D=x,x=B,B=D,ve-=D),x>0&&ve>0){for(D=ve%x||x,V=se.substr(0,D);D<ve;D+=x)V+=G+se.substr(D,x);B>0&&(V+=G+se.slice(D)),ae&&(V="-"+V)}y=K?V+(w.decimalSeparator||"")+((B=+w.fractionGroupSize)?K.replace(new RegExp("\\d{"+B+"}\\B","g"),"$&"+(w.fractionGroupSeparator||"")):K):V}return(w.prefix||"")+y+(w.suffix||"")},i.toFraction=function(h){var g,w,y,P,D,L,x,B,G,V,K,ae,se=this,ve=se.c;if(h!=null&&(x=new A(h),!x.isInteger()&&(x.c||x.s!==1)||x.lt(a)))throw Error(rr+"Argument "+(x.isInteger()?"out of range: ":"not an integer: ")+S(x));if(!ve)return new A(se);for(g=new A(a),G=w=new A(a),y=B=new A(a),ae=Pr(ve),D=g.e=ae.length-se.e-1,g.c[0]=pu[(L=D%Ee)<0?Ee+L:L],h=!h||x.comparedTo(g)>0?D>0?g:G:x,L=f,f=1/0,x=new A(ae),B.c[0]=0;!(V=t(x,g,0,1),P=w.plus(V.times(y)),P.comparedTo(h)==1);)w=y,y=P,G=B.plus(V.times(P=G)),B=P,g=x.minus(V.times(P=g)),x=P;return P=t(h.minus(w),y,0,1),B=B.plus(P.times(G)),w=w.plus(P.times(y)),B.s=G.s=se.s,D=D*2,K=t(G,y,D,c).minus(se).abs().comparedTo(t(B,w,D,c).minus(se).abs())<1?[G,y]:[B,w],f=L,K},i.toNumber=function(){return+S(this)},i.toPrecision=function(h,g){return h!=null&&Je(h,1,wt),j(this,h,g,2)},i.toString=function(h){var g,w=this,y=w.s,P=w.e;return P===null?y?(g="Infinity",y<0&&(g="-"+g)):g="NaN":(h==null?g=P<=o||P>=u?Eo(Pr(w.c),P):Fn(Pr(w.c),P,"0"):h===10?(w=b(new A(w),s+P+1,c),g=Fn(Pr(w.c),w.e,"0")):(Je(h,2,v.length,"Base"),g=r(Fn(Pr(w.c),P,"0"),10,h,y,!0)),y<0&&w.c[0]&&(g="-"+g)),g},i.valueOf=i.toJSON=function(){return S(this)},i._isBigNumber=!0,i[Symbol.toStringTag]="BigNumber",i[Symbol.for("nodejs.util.inspect.custom")]=i.valueOf,e!=null&&A.set(e),A}function kr(e){var t=e|0;return e>0||e===t?t:t-1}function Pr(e){for(var t,r,n=1,i=e.length,a=e[0]+"";n<i;){for(t=e[n++]+"",r=Ee-t.length;r--;t="0"+t);a+=t}for(i=a.length;a.charCodeAt(--i)===48;);return a.slice(0,i+1||1)}function ga(e,t){var r,n,i=e.c,a=t.c,s=e.s,c=t.s,o=e.e,u=t.e;if(!s||!c)return null;if(r=i&&!i[0],n=a&&!a[0],r||n)return r?n?0:-c:s;if(s!=c)return s;if(r=s<0,n=o==u,!i||!a)return n?0:!i^r?1:-1;if(!n)return o>u^r?1:-1;for(c=(o=i.length)<(u=a.length)?o:u,s=0;s<c;s++)if(i[s]!=a[s])return i[s]>a[s]^r?1:-1;return o==u?0:o>u^r?1:-1}function Je(e,t,r,n){if(e<t||e>r||e!==Sn(e))throw Error(rr+(n||"Argument")+(typeof e=="number"?e<t||e>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function _o(e){var t=e.c.length-1;return kr(e.e/Ee)==t&&e.c[t]%2!=0}function Eo(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function Fn(e,t,r){var n,i;if(t<0){for(i=r+".";++t;i+=r);e=i+e}else if(n=e.length,++t>n){for(i=r,t-=n;--t;i+=r);e+=i}else t<n&&(e=e.slice(0,t)+"."+e.slice(t));return e}var qd=Fd(),i0=Object.freeze({__proto__:null,BigNumber:qd,default:qd}),Gd=le(function(e,t){const r=Math.exp;t=e.exports=function(i){if(typeof i!="number")throw new Error("must provide a timespan to the moving average constructor");if(i<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let a,s=0,c=0,o=0,u,l={};function f(_,p){return 1-r(-(_-p)/i)}return l.push=function(p,I){if(u){const d=f(p,u),v=I-a,A=d*v;a=d*I+(1-d)*a,s=(1-d)*(s+v*A),c=Math.sqrt(s),o=a+d*v}else a=I;u=p},l.movingAverage=function(){return a},l.variance=function(){return s},l.deviation=function(){return c},l.forecast=function(){return o},l}}),$d=Ql(i0);class a0 extends Bt{constructor(e,t){super();this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this);const r=this._options.movingAverageIntervals;for(var n=0;n<e.length;n++){var i=e[n];this._stats[i]=$d(0),this._movingAverages[i]={};for(var a=0;a<r.length;a++){var s=r[a],c=this._movingAverages[i][s]=Gd(s);c.push(this._frequencyLastTime,0)}}}start(){this._queue.length&&this._resetComputeTimeout()}stop(){this._timeout&&(this._timeout.clear(),this._timeout=null)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}toJSON(){const e=this.snapshot,t=this.movingAverages,r={dataReceived:e.dataReceived.toString(),dataSent:e.dataSent.toString(),movingAverages:{}},n=Object.keys(t);for(const i of n){r.movingAverages[i]={};for(const a of Object.keys(t[i]))r.movingAverages[i][a]=t[i][a].movingAverage()}return r}push(e,t){this._queue.push([e,t,Date.now()]),this._resetComputeTimeout()}_resetComputeTimeout(){this._timeout=Oi(this._update,this._nextTimeout())}_nextTimeout(){const e=this._queue.length/this._options.computeThrottleMaxQueueSize,t=Math.max(this._options.computeThrottleTimeout*(1-e),0);return t}_update(){if(this._timeout=null,this._queue.length){let e;for(e of this._queue)this._applyOp(e);this._queue=[],this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){const t=e-this._frequencyLastTime;Object.keys(this._stats).forEach(r=>{this._updateFrequencyFor(r,t,e)}),this._frequencyLastTime=e}_updateFrequencyFor(e,t,r){const n=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;const i=t||1,a=n/i*1e3;let s=this._movingAverages[e];s||(s=this._movingAverages[e]={});const c=this._options.movingAverageIntervals;for(var o=0;o<c.length;o++){var u=c[o],l=s[u];l||(l=s[u]=Gd(u)),l.push(r,a)}}_applyOp(e){const t=e[0],r=e[1];if(typeof r!="number")throw new Error("invalid increment number:",r);let n;Object.prototype.hasOwnProperty.call(this._stats,t)?n=this._stats[t]:n=this._stats[t]=$d(0),this._stats[t]=n.plus(r),this._frequencyAccumulators[t]||(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=r}}var fu=a0,mu=Ql(e0);const{tap:Vd}=mu,{METRICS:s0}=ns,gu=["dataReceived","dataSent"],o0={in:"dataReceived",out:"dataSent"};class Hd{constructor(e){this._options=co(s0,e),this._globalStats=new fu(gu,this._options),this._peerStats=new Map,this._protocolStats=new Map,this._oldPeers=r0(this._options.maxOldPeersRetention),this._running=!1,this._onMessage=this._onMessage.bind(this),this._connectionManager=e.connectionManager,this._connectionManager.on("peer:disconnect",t=>{this.onPeerDisconnected(t.remotePeer)})}start(){this._running=!0}stop(){this._running=!1,this._globalStats.stop();for(const e of this._peerStats.values())e.stop();for(const e of this._protocolStats.values())e.stop()}get global(){return this._globalStats}get peers(){return Array.from(this._peerStats.keys())}forPeer(e){const t=e.toB58String();return this._peerStats.get(t)||this._oldPeers.get(t)}get protocols(){return Array.from(this._protocolStats.keys())}forProtocol(e){return this._protocolStats.get(e)}onPeerDisconnected(e){const t=e.toB58String(),r=this._peerStats.get(t);r&&(r.stop(),this._peerStats.delete(t),this._oldPeers.set(t,r))}_onMessage({remotePeer:e,protocol:t,direction:r,dataLength:n}){if(!this._running)return;const i=o0[r];let a=this.forPeer(e);if(a||(a=new fu(gu,this._options),this._peerStats.set(e.toB58String(),a)),a.push(i,n),this._globalStats.push(i,n),t){let s=this.forProtocol(t);s||(s=new fu(gu,this._options),this._protocolStats.set(t,s)),s.push(i,n)}}updatePlaceholder(e,t){if(!this._running)return;const r=this.forPeer(e),n=t.toB58String(),i=this.forPeer(t);let a=r;i&&(a=Hd.mergeStats(i,a),this._oldPeers.delete(n)),this._peerStats.delete(e.toB58String()),this._peerStats.set(n,a),a.start()}trackStream({stream:e,remotePeer:t,protocol:r}){const n=this,i=e.source;e.source=Vd(s=>n._onMessage({remotePeer:t,protocol:r,direction:"in",dataLength:s.length}))(i);const a=e.sink;return e.sink=s=>Lt(s,Vd(c=>n._onMessage({remotePeer:t,protocol:r,direction:"out",dataLength:c.length})),a),e}static mergeStats(e,t){return e.stop(),t.stop(),e._queue=[...e._queue,...t._queue],e}}var c0=Hd,nr=le(function(e,t){const r=st(`
`);async function n(i){for await(const a of i)return a}t.encode=i=>ct.encode.single(new Ze([i,r])),t.write=(i,a)=>i.push(t.encode(a)),t.writeAll=(i,a)=>{i.push(a.reduce((s,c)=>s.append(t.encode(c)),new Ze))},t.read=async i=>{let a=1;const s={[Symbol.asyncIterator](){return this},next:()=>i.next(a)},c=u=>{a=u},o=await Lt(s,ct.decode({onLength:c}),n);if(o.get(o.length-1)!==r[0])throw $(new Error("missing newline"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return o.shallowSlice(0,-1)}});const ba=te("mss:select");var zd=async(e,t,r)=>{t=Array.isArray(t)?[...t]:[t];const{reader:n,writer:i,rest:a,stream:s}=os(e),c=t.shift();r?(ba('select: write ["%s", "%s"]',r,c),nr.writeAll(i,[r,c])):(ba('select: write "%s"',c),nr.write(i,c));let o=(await nr.read(n)).toString();if(ba('select: read "%s"',o),o===r&&(o=(await nr.read(n)).toString(),ba('select: read "%s"',o)),o===c)return a(),{stream:s,protocol:c};for(const u of t){ba('select: write "%s"',u),nr.write(i,u);const l=(await nr.read(n)).toString();if(ba('select: read "%s" for "%s"',l,u),l===u)return a(),{stream:s,protocol:u}}throw a(),$(new Error("protocol selection failed"),"ERR_UNSUPPORTED_PROTOCOL")},u0="/multistream/1.0.0",Kd={PROTOCOL_ID:u0};const ls=te("mss:handle"),{PROTOCOL_ID:bu}=Kd;var l0=async(e,t)=>{t=Array.isArray(t)?t:[t];const{writer:r,reader:n,rest:i,stream:a}=os(e);for(;;){const s=(await nr.read(n)).toString();if(ls('read "%s"',s),s===bu){ls('respond with "%s" for "%s"',bu,s),nr.write(r,bu);continue}if(t.includes(s))return nr.write(r,s),ls('respond with "%s" for "%s"',s,s),i(),{stream:a,protocol:s};if(s==="ls"){nr.write(r,new Ze(t.map(c=>nr.encode(c)))),ls('respond with "%s" for %s',t,s);continue}nr.write(r,"na"),ls('respond with "na" for "%s"',s)}};const h0=te("it-multistream-select:ls");var d0=async e=>{const{reader:t,writer:r,rest:n,stream:i}=os(e);h0('write "ls"'),nr.write(r,"ls"),n();const a=await nr.read(t),s=id([a]),c=[];return await Lt(s,ct.decode(),async o=>{for await(const u of o)c.push(u.shallowSlice(0,-1).toString())}),{stream:i,protocols:c}};const{PROTOCOL_ID:yu}=Kd;var p0=yu;class Wd{constructor(e){this._stream=e,this._shaken=!1}async _handshake(){if(this._shaken)return;const{stream:e}=await zd(this._stream,yu);this._stream=e,this._shaken=!0}}class f0 extends Wd{select(e){return zd(this._stream,e,this._shaken?null:yu)}async ls(){await this._handshake();const{stream:e,protocols:t}=await d0(this._stream);return this._stream=e,t}}var m0=f0;class g0 extends Wd{handle(e){return l0(this._stream,e)}}var b0=g0,ya={PROTOCOL_ID:p0,Dialer:m0,Listener:b0},va={OPEN:"open",CLOSING:"closing",CLOSED:"closed"};function y0(e,t,r,n,i,a,s){if(e&&!Pe.isMultiaddr(e))throw $(new Error("localAddr must be an instance of multiaddr"),"ERR_INVALID_PARAMETERS");if(!Ae.isPeerId(t))throw $(new Error("localPeer must be an instance of peer-id"),"ERR_INVALID_PARAMETERS");if(!Ae.isPeerId(r))throw $(new Error("remotePeer must be an instance of peer-id"),"ERR_INVALID_PARAMETERS");if(typeof n!="function")throw $(new Error("new stream must be a function"),"ERR_INVALID_PARAMETERS");if(typeof i!="function")throw $(new Error("close must be a function"),"ERR_INVALID_PARAMETERS");if(typeof a!="function")throw $(new Error("getStreams must be a function"),"ERR_INVALID_PARAMETERS");if(!s)throw $(new Error("connection metadata object must be provided"),"ERR_INVALID_PARAMETERS");if(s.direction!=="inbound"&&s.direction!=="outbound")throw $(new Error('direction must be "inbound" or "outbound"'),"ERR_INVALID_PARAMETERS");if(!s.timeline)throw $(new Error("connection timeline object must be provided in the stat object"),"ERR_INVALID_PARAMETERS");if(!s.timeline.open)throw $(new Error("connection open timestamp must be provided"),"ERR_INVALID_PARAMETERS");if(!s.timeline.upgraded)throw $(new Error("connection upgraded timestamp must be provided"),"ERR_INVALID_PARAMETERS")}class v0{constructor({localAddr:e,remoteAddr:t,localPeer:r,remotePeer:n,newStream:i,close:a,getStreams:s,stat:c}){y0(e,r,n,i,a,s,c),this.id=parseInt(Math.random()*1e9).toString(36)+Date.now(),this.localAddr=e,this.remoteAddr=t,this.localPeer=r,this.remotePeer=n,this._stat={...c,status:va.OPEN},this._newStream=i,this._close=a,this._getStreams=s,this.registry=new Map,this.tags=[]}get stat(){return this._stat}get streams(){return this._getStreams()}async newStream(e){if(this.stat.status===va.CLOSING)throw $(new Error("the connection is being closed"),"ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===va.CLOSED)throw $(new Error("the connection is closed"),"ERR_CONNECTION_CLOSED");Array.isArray(e)||(e=[e]);const{stream:t,protocol:r}=await this._newStream(e);return this.addStream(t,{protocol:r}),{stream:t,protocol:r}}addStream(e,{protocol:t,metadata:r={}}){this.registry.set(e.id,{protocol:t,...r})}removeStream(e){this.registry.delete(e)}async close(){if(this.stat.status===va.CLOSED)return;if(this._closing)return this._closing;this.stat.status=va.CLOSING,this._closing=await this._close(),this._stat.timeline.close=Date.now(),this.stat.status=va.CLOSED}}var w0=On(v0,{className:"Connection",symbolName:"@libp2p/interface-connection/connection"}),_0=w0,E0={Connection:_0};function S0(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}else return Array.from(e)}var Xd=function(t){var r=void 0,n=void 0;function i(c){if(!(c instanceof Object))throw new Error('Target "'+c+'" is not an object');n=c}function a(c){Object.keys(c).forEach(function(o){var u=c[o];if(typeof u!="function")throw new Error('Trap "'+o+": "+u+'" is not a function');if(!Reflect[o])throw new Error('Trap "'+o+": "+u+'" is not a valid trap')}),r=c}i(function(){}),t&&i(t),a(Reflect);var s=new Proxy({},{get:function(o,u){return function(){for(var l=arguments.length,f=Array(l),_=0;_<l;_++)f[_]=arguments[_];return r[u].apply(null,[n].concat(S0(f.slice(1))))}}});return{setTarget:i,setHandler:a,getTarget:function(){return n},getHandler:function(){return r},proxy:new Proxy(n,s)}};const ut=te("libp2p:upgrader");ut.error=te("libp2p:upgrader:error");const{Connection:A0}=E0,{codes:hs}=It;class T0{constructor({localPeer:e,metrics:t,cryptos:r,muxers:n,onConnectionEnd:i=()=>{},onConnection:a=()=>{}}){this.localPeer=e,this.metrics=t,this.cryptos=r||new Map,this.muxers=n||new Map,this.protector=null,this.protocols=new Map,this.onConnection=a,this.onConnectionEnd=i}async upgradeInbound(e){let t,r,n,i,a,s,c;if(this.metrics){({setTarget:s,proxy:c}=Xd());const u=parseInt(Math.random()*1e9).toString(36)+Date.now();s({toB58String:()=>u}),e=this.metrics.trackStream({stream:e,remotePeer:c})}ut("Starting the inbound connection upgrade");let o=e;this.protector&&(o=await this.protector.protect(e));try{({conn:t,remotePeer:r,protocol:a}=await this._encryptInbound(this.localPeer,o,this.cryptos)),this.muxers.size?{stream:n,Muxer:i}=await this._multiplexInbound(t,this.muxers):n=t}catch(u){throw ut.error("Failed to upgrade inbound connection",u),await e.close(u),u}return this.metrics&&(this.metrics.updatePlaceholder(c,r),s(r)),ut("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:a,direction:"inbound",maConn:e,upgradedConn:n,Muxer:i,remotePeer:r})}async upgradeOutbound(e){let t;try{t=Ae.createFromB58String(e.remoteAddr.getPeerId())}catch(l){ut.error("multiaddr did not contain a valid peer id",l)}let r,n,i,a,s,c,o;if(this.metrics){({setTarget:c,proxy:o}=Xd());const l=parseInt(Math.random()*1e9).toString(36)+Date.now();c({toB58String:()=>l}),e=this.metrics.trackStream({stream:e,remotePeer:o})}ut("Starting the outbound connection upgrade");let u=e;this.protector&&(u=await this.protector.protect(e));try{({conn:r,remotePeer:n,protocol:a}=await this._encryptOutbound(this.localPeer,u,t,this.cryptos)),this.muxers.size?{stream:i,Muxer:s}=await this._multiplexOutbound(r,this.muxers):i=r}catch(l){throw ut.error("Failed to upgrade outbound connection",l),await e.close(l),l}return this.metrics&&(this.metrics.updatePlaceholder(o,n),c(n)),ut("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:a,direction:"outbound",maConn:e,upgradedConn:i,Muxer:s,remotePeer:n})}_createConnection({cryptoProtocol:e,direction:t,maConn:r,upgradedConn:n,Muxer:i,remotePeer:a}){let s,c,o;i&&(s=new i({onStream:async f=>{const _=new ya.Listener(f);try{const{stream:p,protocol:I}=await _.handle(Array.from(this.protocols.keys()));ut("%s: incoming stream opened on %s",t,I),this.metrics&&this.metrics.trackStream({stream:p,remotePeer:a,protocol:I}),o.addStream(f,{protocol:I}),this._onStream({connection:o,stream:{...f,...p},protocol:I})}catch(p){ut.error(p)}},onStreamEnd:f=>{o.removeStream(f.id)}}),c=async f=>{ut("%s: starting new stream on %s",t,f);const _=s.newStream(),p=new ya.Dialer(_);try{const{stream:I,protocol:d}=await p.select(f);return this.metrics&&this.metrics.trackStream({stream:I,remotePeer:a,protocol:d}),{stream:{..._,...I},protocol:d}}catch(I){throw ut.error("could not create new stream",I),$(I,hs.ERR_UNSUPPORTED_PROTOCOL)}},Lt(n,s,n).catch(ut.error));const u=r.timeline;r.timeline=new Proxy(u,{set:(...f)=>(o&&f[1]==="close"&&f[2]&&!u.close&&(o.stat.status="closed",this.onConnectionEnd(o)),Reflect.set(...f))}),r.timeline.upgraded=Date.now();const l=()=>{throw $(new Error("connection is not multiplexed"),"ERR_CONNECTION_NOT_MULTIPLEXED")};return o=new A0({localAddr:r.localAddr,remoteAddr:r.remoteAddr,localPeer:this.localPeer,remotePeer:a,stat:{direction:t,timeline:r.timeline,multiplexer:i&&i.multicodec,encryption:e},newStream:c||l,getStreams:()=>s?s.streams:l,close:f=>r.close(f)}),this.onConnection(o),o}_onStream({connection:e,stream:t,protocol:r}){const n=this.protocols.get(r);n({connection:e,stream:t,protocol:r})}async _encryptInbound(e,t,r){const n=new ya.Listener(t),i=Array.from(r.keys());ut("handling inbound crypto protocol selection",i);try{const{stream:a,protocol:s}=await n.handle(i),c=r.get(s);return ut("encrypting inbound connection..."),{...await c.secureInbound(e,a),protocol:s}}catch(a){throw $(a,hs.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(e,t,r,n){const i=new ya.Dialer(t),a=Array.from(n.keys());ut("selecting outbound crypto protocol",a);try{const{stream:s,protocol:c}=await i.select(a),o=n.get(c);return ut("encrypting outbound connection to %j",r),{...await o.secureOutbound(e,s,r),protocol:c}}catch(s){throw $(s,hs.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(e,t){const r=new ya.Dialer(e),n=Array.from(t.keys());ut("outbound selecting muxer %s",n);try{const{stream:i,protocol:a}=await r.select(n);ut("%s selected as muxer protocol",a);const s=t.get(a);return{stream:i,Muxer:s}}catch(i){throw $(i,hs.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(e,t){const r=new ya.Listener(e),n=Array.from(t.keys());ut("inbound handling muxers %s",n);try{const{stream:i,protocol:a}=await r.handle(n),s=t.get(a);return{stream:i,Muxer:s}}catch(i){throw $(i,hs.ERR_MUXER_UNAVAILABLE)}}}var C0=T0;const{codes:{ERR_INVALID_PARAMETERS:Qd}}=It,I0=e=>e;class R0{constructor({peerStore:e,eventName:t,eventProperty:r,eventTransformer:n=I0}){this._ps=e,this.eventName=t,this.eventProperty=r,this.eventTransformer=n,this.data=new Map}set(e,t){throw $(new Error("set must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}_setData(e,t,{emit:r=!0}={}){const n=e.toB58String();this.data.set(n,t),r&&this._emit(e,t)}_emit(e,t){this._ps.emit(this.eventName,{peerId:e,[this.eventProperty]:this.eventTransformer(t)})}get(e){if(!Ae.isPeerId(e))throw $(new Error("peerId must be an instance of peer-id"),Qd);const t=this.data.get(e.toB58String());return t?[...t]:void 0}delete(e){if(!Ae.isPeerId(e))throw $(new Error("peerId must be an instance of peer-id"),Qd);return this.data.delete(e.toB58String())?(this._emit(e,[]),!0):!1}}var So=R0;class k0{constructor(e,t){this.domain=e,this.codec=t}marshal(){throw $(new Error("marshal must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}equals(e){throw $(new Error("equals must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}}var P0=k0;function N0(e,t){return e.length===t.length&&t.sort()&&e.sort().every((r,n)=>t[n].equals(r))}var O0=N0;const D0=`
message PeerRecord {
    // AddressInfo is a wrapper around a binary multiaddr. It is defined as a
    // separate message to allow us to add per-address metadata in the future.
    message AddressInfo {
        bytes multiaddr = 1;
    }

    // peer_id contains a libp2p peer id in its binary representation.
    bytes peer_id = 1;

    // seq contains a monotonically-increasing sequence counter to order PeerRecords in time.
    uint64 seq = 2;

    // addresses is a list of public listen addresses for the peer.
    repeated AddressInfo addresses = 3;
}
`;var Yd=_n(D0).PeerRecord,M0=Xl.getName(Xl.LIBP2P_PEER_RECORD),x0=Uint8Array.from([3,1]),B0={ENVELOPE_DOMAIN_PEER_RECORD:M0,ENVELOPE_PAYLOAD_TYPE_PEER_RECORD:x0};const{ENVELOPE_DOMAIN_PEER_RECORD:Jd,ENVELOPE_PAYLOAD_TYPE_PEER_RECORD:L0}=B0;class Ao extends P0{constructor({peerId:e,multiaddrs:t=[],seqNumber:r=Date.now()}){super(Jd,L0);this.peerId=e,this.multiaddrs=t,this.seqNumber=r,this._marshal=void 0}marshal(){return this._marshal?this._marshal:(this._marshal=Yd.encode({peer_id:this.peerId.toBytes(),seq:this.seqNumber,addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))}),this._marshal)}equals(e){return this.peerId.equals(e.peerId)?this.seqNumber!==e.seqNumber?!1:!!O0(this.multiaddrs,e.multiaddrs):!1}}Ao.createFromProtobuf=e=>{const t=Yd.decode(e),r=Ae.createFromBytes(t.peer_id),n=(t.addresses||[]).map(a=>Pe(a.multiaddr)),i=t.seq;return new Ao({peerId:r,multiaddrs:n,seqNumber:i})},Ao.DOMAIN=Jd;var To=Ao;const j0=`
message Envelope {
  // public_key is the public key of the keypair the enclosed payload was
  // signed with.
  bytes public_key = 1;

  // payload_type encodes the type of payload, so that it can be deserialized
  // deterministically.
  bytes payload_type = 2;

  // payload is the actual payload carried inside this envelope.
  bytes payload = 3;

  // signature is the signature produced by the private key corresponding to
  // the enclosed public key, over the payload, prefixing a domain string for
  // additional security.
  bytes signature = 5;
}
`;var Zd=_n(j0).Envelope;const U0=te("libp2p:envelope");U0.error=te("libp2p:envelope:error");const{codes:F0}=It;class ji{constructor({peerId:e,payloadType:t,payload:r,signature:n}){this.peerId=e,this.payloadType=t,this.payload=r,this.signature=n,this._marshal=void 0}marshal(){if(this._marshal)return this._marshal;const e=Kl.marshalPublicKey(this.peerId.pubKey);return this._marshal=Zd.encode({public_key:e,payload_type:this.payloadType,payload:this.payload,signature:this.signature}),this._marshal}equals(e){return Dn(this.peerId.pubKey.bytes,e.peerId.pubKey.bytes)&&Dn(this.payloadType,e.payloadType)&&Dn(this.payload,e.payload)&&Dn(this.signature,e.signature)}validate(e){const t=ep(e,this.payloadType,this.payload);return this.peerId.pubKey.verify(t,this.signature)}}const ep=(e,t,r)=>{e=st(e);const n=Ve.encode(e.byteLength),i=Ve.encode(t.length),a=Ve.encode(r.length);return dr([new Uint8Array(n),e,new Uint8Array(i),t,new Uint8Array(a),r])};ji.createFromProtobuf=async e=>{const t=Zd.decode(e),r=await Ae.createFromPubKey(t.public_key);return new ji({peerId:r,payloadType:t.payload_type,payload:t.payload,signature:t.signature})},ji.seal=async(e,t)=>{const r=e.domain,n=e.codec,i=e.marshal(),a=ep(r,n,i),s=await t.privKey.sign(a);return new ji({peerId:t,payloadType:n,payload:i,signature:s})},ji.openAndCertify=async(e,t)=>{const r=await ji.createFromProtobuf(e),n=await r.validate(t);if(!n)throw $(new Error("envelope signature is not valid for the given domain"),F0.ERR_SIGNATURE_NOT_VALID);return r};var ds=ji;const Nr=te("libp2p:peer-store:address-book");Nr.error=te("libp2p:peer-store:address-book:error");const{codes:{ERR_INVALID_PARAMETERS:wa}}=It;class q0 extends So{constructor(e){super({peerStore:e,eventName:"change:multiaddrs",eventProperty:"multiaddrs",eventTransformer:t=>t.addresses?t.addresses.map(r=>r.multiaddr):[]});this.data=new Map}consumePeerRecord(e){let t;try{t=To.createFromProtobuf(e.payload)}catch(c){return Nr.error("invalid peer record received"),!1}if(!t.peerId.equals(e.peerId))return Nr("signing key does not match PeerId in the PeerRecord"),!1;if(!t.multiaddrs||!t.multiaddrs.length)return!1;const r=t.peerId,n=r.toB58String(),i=this.data.get(n)||{},a=i.record;if(a&&a.seqNumber>=t.seqNumber)return!1;const s=this._toAddresses(t.multiaddrs,!0);return this._setData(r,{addresses:s,record:{raw:e.marshal(),seqNumber:t.seqNumber}}),Nr(`stored provided peer record for ${n}`),!0}getRawEnvelope(e){const t=this.data.get(e.toB58String());return!t||!t.record||!t.record.raw?void 0:t.record.raw}getPeerRecord(e){const t=this.getRawEnvelope(e);return t?ds.createFromProtobuf(t):void 0}set(e,t){if(!Ae.isPeerId(e))throw Nr.error("peerId must be an instance of peer-id to store data"),$(new Error("peerId must be an instance of peer-id"),wa);const r=this._toAddresses(t),n=e.toB58String(),i=this.data.get(n)||{},a=i.addresses;if(!r.length)return this;if(a&&a.length===r.length){const s=a.filter(c=>r.some(o=>c.multiaddr.equals(o.multiaddr)));if(s.length===a.length)return Nr(`the addresses provided to store are equal to the already stored for ${n}`),this}return this._setData(e,{addresses:r,record:i.record}),Nr(`stored provided multiaddrs for ${n}`),a||this._ps.emit("peer",e),this}add(e,t){if(!Ae.isPeerId(e))throw Nr.error("peerId must be an instance of peer-id to store data"),$(new Error("peerId must be an instance of peer-id"),wa);const r=this._toAddresses(t),n=e.toB58String(),i=this.data.get(n)||{},a=i.addresses||[];return a.forEach(s=>{r.find(c=>c.multiaddr.equals(s.multiaddr))||r.push(s)}),a&&a.length===r.length?(Nr(`the addresses provided to store are already stored for ${n}`),this):(this._setData(e,{addresses:r,record:i.record}),Nr(`added provided multiaddrs for ${n}`),i.addresses||this._ps.emit("peer",e),this)}get(e){if(!Ae.isPeerId(e))throw $(new Error("peerId must be an instance of peer-id"),wa);const t=this.data.get(e.toB58String());return t&&t.addresses?[...t.addresses]:void 0}_toAddresses(e,t=!1){if(!e)throw Nr.error("multiaddrs must be provided to store data"),$(new Error("multiaddrs must be provided"),wa);const r=[];return e.forEach(n=>{if(!Pe.isMultiaddr(n))throw Nr.error(`multiaddr ${n} must be an instance of multiaddr`),$(new Error(`multiaddr ${n} must be an instance of multiaddr`),wa);r.push({multiaddr:n,isCertified:t})}),r}getMultiaddrsForPeer(e){if(!Ae.isPeerId(e))throw $(new Error("peerId must be an instance of peer-id"),wa);const t=this.data.get(e.toB58String());return!t||!t.addresses?void 0:t.addresses.map(r=>{const n=r.multiaddr,i=n.getPeerId();return i&&i===e.toB58String()?n:n.encapsulate(`/p2p/${e.toB58String()}`)})}}var G0=q0;const vu=te("libp2p:peer-store:key-book");vu.error=te("libp2p:peer-store:key-book:error");const{codes:{ERR_INVALID_PARAMETERS:tp}}=It;class $0 extends So{constructor(e){super({peerStore:e,eventName:"change:pubkey",eventProperty:"pubkey",eventTransformer:t=>t.pubKey});this.data=new Map}set(e,t){if(!Ae.isPeerId(e))throw vu.error("peerId must be an instance of peer-id to store data"),$(new Error("peerId must be an instance of peer-id"),tp);const r=e.toB58String(),n=this.data.get(r);return!n&&t&&(e.pubKey=t,this._setData(e,e),vu(`stored provided public key for ${r}`)),this}get(e){if(!Ae.isPeerId(e))throw $(new Error("peerId must be an instance of peer-id"),tp);const t=this.data.get(e.toB58String());return t?t.pubKey:void 0}}var V0=$0;const Co=te("libp2p:peer-store:proto-book");Co.error=te("libp2p:peer-store:proto-book:error");const{codes:{ERR_INVALID_PARAMETERS:_a}}=It;class H0 extends So{constructor(e){super({peerStore:e,eventName:"change:metadata",eventProperty:"metadata"});this.data=new Map}set(e,t,r){if(!Ae.isPeerId(e))throw Co.error("peerId must be an instance of peer-id to store data"),$(new Error("peerId must be an instance of peer-id"),_a);if(typeof t!="string"||!(r instanceof Uint8Array))throw Co.error("valid key and value must be provided to store data"),$(new Error("valid key and value must be provided"),_a);return this._setValue(e,t,r),this}_setValue(e,t,r,{emit:n=!0}={}){const i=e.toB58String(),a=this.data.get(i)||new Map,s=a.get(t);if(s&&Dn(r,s)){Co(`the metadata provided to store is equal to the already stored for ${i} on ${t}`);return}a.set(t,r),this.data.set(i,a),n&&this._emit(e,t)}get(e){if(!Ae.isPeerId(e))throw $(new Error("peerId must be an instance of peer-id"),_a);return this.data.get(e.toB58String())}getValue(e,t){if(!Ae.isPeerId(e))throw $(new Error("peerId must be an instance of peer-id"),_a);const r=this.data.get(e.toB58String());return r&&r.get(t)}delete(e){if(!Ae.isPeerId(e))throw $(new Error("peerId must be an instance of peer-id"),_a);return this.data.delete(e.toB58String())?(this._emit(e),!0):!1}deleteValue(e,t){if(!Ae.isPeerId(e))throw $(new Error("peerId must be an instance of peer-id"),_a);const r=this.data.get(e.toB58String());return!r||!r.delete(t)?!1:(this._emit(e,t),!0)}}var z0=H0;const qn=te("libp2p:peer-store:proto-book");qn.error=te("libp2p:peer-store:proto-book:error");const{codes:{ERR_INVALID_PARAMETERS:Io}}=It;class K0 extends So{constructor(e){super({peerStore:e,eventName:"change:protocols",eventProperty:"protocols",eventTransformer:t=>Array.from(t)});this.data=new Map}set(e,t){if(!Ae.isPeerId(e))throw qn.error("peerId must be an instance of peer-id to store data"),$(new Error("peerId must be an instance of peer-id"),Io);if(!t)throw qn.error("protocols must be provided to store data"),$(new Error("protocols must be provided"),Io);const r=e.toB58String(),n=this.data.get(r),i=new Set(t),a=(s,c)=>s.size===c.size&&[...s].every(o=>c.has(o));return n&&a(n,i)?(qn(`the protocols provided to store are equal to the already stored for ${r}`),this):(this._setData(e,i),qn(`stored provided protocols for ${r}`),this)}add(e,t){if(!Ae.isPeerId(e))throw qn.error("peerId must be an instance of peer-id to store data"),$(new Error("peerId must be an instance of peer-id"),Io);if(!t)throw qn.error("protocols must be provided to store data"),$(new Error("protocols must be provided"),Io);const r=e.toB58String(),n=this.data.get(r)||new Set,i=new Set([...n,...t]);return n.size===i.size?(qn(`the protocols provided to store are already stored for ${r}`),this):(t=[...i],this._setData(e,i),qn(`added provided protocols for ${r}`),this)}}var W0=K0;const X0=te("libp2p:peer-store");X0.error=te("libp2p:peer-store:error");const{EventEmitter:Q0}=Bt,{ERR_INVALID_PARAMETERS:Y0}=It;class J0 extends Q0{constructor({peerId:e}){super();this._peerId=e,this.addressBook=new G0(this),this.keyBook=new V0(this),this.metadataBook=new z0(this),this.protoBook=new W0(this)}start(){}stop(){}get peers(){const e=new Set([...this.addressBook.data.keys(),...this.keyBook.data.keys(),...this.protoBook.data.keys(),...this.metadataBook.data.keys()]);this._peerId&&e.delete(this._peerId.toB58String());const t=new Map;return e.forEach(r=>{t.set(r,this.get(Ae.createFromCID(r)))}),t}delete(e){const t=this.addressBook.delete(e),r=this.keyBook.delete(e),n=this.protoBook.delete(e),i=this.metadataBook.delete(e);return t||r||n||i}get(e){if(!Ae.isPeerId(e))throw $(new Error("peerId must be an instance of peer-id"),Y0);const t=this.keyBook.data.get(e.toB58String()),r=this.addressBook.get(e),n=this.metadataBook.get(e),i=this.protoBook.get(e);return!t&&!r&&!n&&!i?void 0:{id:t||e,addresses:r||[],protocols:i||[],metadata:n}}}var rp=J0,Z0=(e,t,r)=>{class n extends e{subscribe(i,a){a&&this.on(i,a),super.subscribe(i)}unsubscribe(i,a){a?this.removeListener(i,a):this.removeAllListeners(i),this.listenerCount(i)===0&&super.unsubscribe(i)}}return new n(t,r)},e_="/peers/",t_="/peers/addrs/",r_="/peers/keys/",n_="/peers/metadata/",i_="/peers/protos/",a_={NAMESPACE_COMMON:e_,NAMESPACE_ADDRESS:t_,NAMESPACE_KEYS:r_,NAMESPACE_METADATA:n_,NAMESPACE_PROTOCOL:i_};const s_=`
message Addresses {
  // Address represents a single multiaddr.
  message Address {
    required bytes multiaddr = 1;

    // Flag to indicate if the address comes from a certified source.
    optional bool isCertified = 2;
  }

  // CertifiedRecord contains a serialized signed PeerRecord used to
  // populate the signedAddrs list.
  message CertifiedRecord {
    // The Seq counter from the signed PeerRecord envelope
    uint64 seq = 1;

    // The serialized bytes of the SignedEnvelope containing the PeerRecord.
    bytes raw = 2;
  }

  // The known multiaddrs.
  repeated Address addrs = 1;

  // The most recently received signed PeerRecord.
  CertifiedRecord certified_record = 2;
}
`;var np=_n(s_).Addresses;const o_=`
message Protocols {
  repeated string protocols = 1;
}
`;var ip=_n(o_).Protocols;const Rt=te("libp2p:persistent-peer-store");Rt.error=te("libp2p:persistent-peer-store:error");const{Key:Ro}=ou,{NAMESPACE_ADDRESS:c_,NAMESPACE_COMMON:u_,NAMESPACE_KEYS:l_,NAMESPACE_METADATA:h_,NAMESPACE_PROTOCOL:d_}=a_;class p_ extends rp{constructor({peerId:e,datastore:t,threshold:r=5}){super({peerId:e});this._datastore=t,this._dirtyPeers=new Set,this._dirtyMetadata=new Map,this.threshold=r,this._addDirtyPeer=this._addDirtyPeer.bind(this)}async start(){Rt("PeerStore is starting"),this.on("change:protocols",this._addDirtyPeer),this.on("change:multiaddrs",this._addDirtyPeer),this.on("change:pubkey",this._addDirtyPeer),this.on("change:metadata",this._addDirtyPeerMetadata);for await(const e of this._datastore.query({prefix:u_}))await this._processDatastoreEntry(e);Rt("PeerStore started")}async stop(){Rt("PeerStore is stopping"),this.removeAllListeners(),await this._commitData(),Rt("PeerStore stopped")}_addDirtyPeer({peerId:e}){const t=e.toB58String();Rt("add dirty peer",t),this._dirtyPeers.add(t),this._dirtyPeers.size>=this.threshold&&this._commitData().catch(r=>{Rt.error("error committing data",r)})}_addDirtyPeerMetadata({peerId:e,metadata:t}){const r=e.toB58String();Rt("add dirty metadata peer",r),this._dirtyPeers.add(r);const n=this._dirtyMetadata.get(r)||new Set;n.add(t),this._dirtyMetadata.set(r,n),this._dirtyPeers.size>=this.threshold&&this._commitData().catch(i=>{Rt.error("error committing data",i)})}async _commitData(){const e=Array.from(this._dirtyPeers);if(!e.length)return;this._dirtyPeers.clear(),Rt("create batch commit");const t=this._datastore.batch();for(const r of e){const n=this.keyBook.data.get(r)||Ae.createFromCID(r);this._batchAddressBook(n,t),this._batchKeyBook(n,t),this._batchMetadataBook(n,t),this._batchProtoBook(n,t)}await t.commit(),Rt("batch committed")}_batchAddressBook(e,t){const r=e.toString(),n=new Ro(`${c_}${r}`),i=this.addressBook.data.get(e.toB58String());try{if(!i){t.delete(n);return}const a=np.encode({addrs:i.addresses.map(s=>({multiaddr:s.multiaddr.bytes,isCertified:s.isCertified})),certified_record:i.record?{seq:i.record.seqNumber,raw:i.record.raw}:void 0});t.put(n,a)}catch(a){Rt.error(a)}}_batchKeyBook(e,t){const r=e.toString(),n=new Ro(`${l_}${r}`);try{if(!e.pubKey){t.delete(n);return}const i=e.marshalPubKey();t.put(n,i)}catch(i){Rt.error(i)}}_batchMetadataBook(e,t){const r=e.toString(),n=this._dirtyMetadata.get(e.toB58String())||[];try{n.forEach(i=>{const a=new Ro(`${h_}${r}/${i}`),s=this.metadataBook.getValue(e,i);s?t.put(a,s):t.delete(a)})}catch(i){Rt.error(i)}}_batchProtoBook(e,t){const r=e.toString(),n=new Ro(`${d_}${r}`),i=this.protoBook.get(e);try{if(!i){t.delete(n);return}const a=ip.encode({protocols:i});t.put(n,a)}catch(a){Rt.error(a)}}async _processDatastoreEntry({key:e,value:t}){try{const r=e.toString().split("/"),n=Ae.createFromCID(r[3]);let i;switch(r[2]){case"addrs":i=np.decode(t),this.addressBook._setData(n,{addresses:i.addrs.map(a=>({multiaddr:Pe(a.multiaddr),isCertified:Boolean(a.isCertified)})),record:i.certified_record?{raw:i.certified_record.raw,seqNumber:i.certified_record.seq}:void 0},{emit:!1});break;case"keys":i=await Ae.createFromPubKey(t),this.keyBook._setData(i,i,{emit:!1});break;case"metadata":this.metadataBook._setValue(n,r[4],t,{emit:!1});break;case"protos":i=ip.decode(t),this.protoBook._setData(n,new Set(i.protocols),{emit:!1});break;default:Rt("invalid data persisted for: ",e.toString())}}catch(r){Rt.error(r)}}}var f_=p_;const ap=()=>{};class m_{constructor({min:e=0,max:t=Infinity,handlers:r={}}){this.min=e,this.max=t,this._onConnect=r.onConnect||ap,this._onDisconnect=r.onDisconnect||ap,this.peers=new Set}set registrar(e){this._registrar=e}disconnect(e){this._onDisconnect(e)}}var sp=On(m_,{className:"Topology",symbolName:"@libp2p/js-interfaces/topology"});const g_=te("libp2p:peer-store");g_.error=te("libp2p:peer-store:error");const{ERR_INVALID_PARAMETERS:b_}=It;class y_{constructor({peerStore:e,connectionManager:t}){this.peerStore=e,this.connectionManager=t,this.topologies=new Map,this._handle=void 0,this._onDisconnect=this._onDisconnect.bind(this),this.connectionManager.on("peer:disconnect",this._onDisconnect)}get handle(){return this._handle}set handle(e){this._handle=e}getConnection(e){return this.connectionManager.get(e)}register(e){if(!sp.isTopology(e))throw $(new Error("topology must be an instance of interfaces/topology"),b_);const t=parseInt(Math.random()*1e9).toString(36)+Date.now();return this.topologies.set(t,e),e.registrar=this,t}unregister(e){return this.topologies.delete(e)}_onDisconnect(e,t){for(const[,r]of this.topologies)r.disconnect(e.remotePeer,t)}}var v_=y_,wu=le(function(e){const{Buffer:t}=zt;e.exports=async function*(r){for await(const n of r)t.isBuffer(n)?yield n:Ze.isBufferList(n)?yield n.slice():yield t.from(n)},e.exports.toBuffer=e.exports,e.exports.toList=async function*(r){for await(const n of r)t.isBuffer(n)?yield new Ze().append(n):Ze.isBufferList(n)?yield n:yield new Ze().append(t.from(n))}}),w_={PROTOCOL:"/ipfs/ping/1.0.0",PING_LENGTH:32},ko=le(function(e,t){const r=te("libp2p-ping");r.error=te("libp2p-ping:error");const{toBuffer:n}=wu,{collect:i,take:a}=mu,{PROTOCOL:s,PING_LENGTH:c}=w_;async function o(f,_){r("dialing %s to %s",s,_.toB58String?_.toB58String():_);const{stream:p}=await f.dialProtocol(_,s),I=new Date,d=Rr.randomBytes(c),[v]=await Lt([d],p,j=>a(1,j),n,i),A=Date.now();if(!d.equals(v))throw $(new Error("Received wrong ping ack"),"ERR_WRONG_PING_ACK");return A-I}function u(f){f.handle(s,({stream:_})=>Lt(_,_))}function l(f){f.unhandle(s)}t=e.exports=o,t.mount=u,t.unmount=l}),__=e=>t=>async function*(){for await(const r of t)yield e.encode(r)}(),E_=e=>t=>async function*(){for await(const r of t)yield e.decode(r)}(),_u={encode:__,decode:E_},S_=e=>t=>ct.encode()(_u.encode(e)(t)),A_=e=>t=>_u.decode(e)(wu(ct.decode()(t))),T_=_u,C_={encode:S_,decode:A_,it:T_};const I_=`
message Identify {
  // protocolVersion determines compatibility between peers
  optional string protocolVersion = 5; // e.g. ipfs/1.0.0

  // agentVersion is like a UserAgent string in browsers, or client version in bittorrent
  // includes the client name and client.
  optional string agentVersion = 6; // e.g. go-ipfs/0.1.0

  // publicKey is this node's public key (which also gives its node.ID)
  // - may not need to be sent, as secure channel implies it has been sent.
  // - then again, if we change / disable secure channel, may still want it.
  optional bytes publicKey = 1;

  // listenAddrs are the multiaddrs the sender node listens for open connections on
  repeated bytes listenAddrs = 2;

  // oservedAddr is the multiaddr of the remote endpoint that the sender node perceives
  // this is useful information to convey to the other side, as it helps the remote endpoint
  // determine whether its connection to the local peer goes through NAT.
  optional bytes observedAddr = 4;

  repeated string protocols = 3;

  // signedPeerRecord contains a serialized SignedEnvelope containing a PeerRecord,
  // signed by the sending node. It contains the same addresses as the listenAddrs field, but
  // in a form that lets us share authenticated addrs with other peers.
  optional bytes signedPeerRecord = 8;
}
`;var ps=_n(I_).Identify;const R_="libp2p",k_="0.29.0",P_="JavaScript implementation of libp2p, a modular peer to peer network stack",N_="Jacob Heun <jacobheun@gmail.com>",O_="src/index.js",D_=["dist","src"],M_={lint:"aegir lint",build:"aegir build",test:"npm run test:node && npm run test:browser","test:node":'aegir test -t node -f "./test/**/*.{node,spec}.js"',"test:browser":"aegir test -t browser",release:"aegir release -t node -t browser","release-minor":"aegir release --type minor -t node -t browser","release-major":"aegir release --type major -t node -t browser",coverage:"nyc --reporter=text --reporter=lcov npm run test:node"},x_={type:"git",url:"https://github.com/libp2p/js-libp2p.git"},B_=["libp2p","network","p2p","peer","peer-to-peer","IPFS"],L_={url:"https://github.com/libp2p/js-libp2p/issues"},j_="https://libp2p.io",U_="MIT",F_={node:">=12.0.0",npm:">=6.0.0"},q_={"abort-controller":"^3.0.0","aggregate-error":"^3.0.1","any-signal":"^1.1.0","bignumber.js":"^9.0.0","class-is":"^1.1.0",debug:"^4.1.1","err-code":"^2.0.0",events:"^3.1.0",hashlru:"^2.3.0","interface-datastore":"^2.0.0","ipfs-utils":"^2.2.0","it-all":"^1.0.1","it-buffer":"^0.1.2","it-handshake":"^1.0.1","it-length-prefixed":"^3.0.1","it-pipe":"^1.1.0","it-protocol-buffers":"^0.2.0","libp2p-crypto":"^0.18.0","libp2p-interfaces":"^0.5.1","libp2p-utils":"^0.2.0",mafmt:"^8.0.0","merge-options":"^2.0.0","moving-average":"^1.0.0",multiaddr:"^8.0.0",multicodec:"^2.0.0","multistream-select":"^1.0.0","mutable-proxy":"^1.0.0","node-forge":"^0.9.1","p-any":"^3.0.0","p-fifo":"^1.0.0","p-settle":"^4.0.1","peer-id":"^0.14.0",protons:"^2.0.0",retimer:"^2.0.0","sanitize-filename":"^1.6.3","streaming-iterables":"^5.0.2","timeout-abort-controller":"^1.1.1",varint:"^5.0.0",xsalsa20:"^1.0.2"},G_={"@nodeutils/defaults-deep":"^1.1.0","abortable-iterator":"^3.0.0",aegir:"^26.0.0",chai:"^4.2.0","chai-as-promised":"^7.1.1","chai-bytes":"^0.1.2","chai-string":"^1.5.0",cids:"^1.0.0",delay:"^4.3.0","dirty-chai":"^2.0.1","interop-libp2p":"^0.3.0","ipfs-http-client":"^46.0.0","it-concat":"^1.0.0","it-pair":"^1.0.0","it-pushable":"^1.4.0",libp2p:".","libp2p-bootstrap":"^0.12.0","libp2p-delegated-content-routing":"^0.6.0","libp2p-delegated-peer-routing":"^0.6.0","libp2p-floodsub":"^0.23.0","libp2p-gossipsub":"^0.6.0","libp2p-kad-dht":"^0.20.0","libp2p-mdns":"^0.15.0","libp2p-mplex":"^0.10.0","libp2p-noise":"^2.0.0","libp2p-secio":"^0.13.1","libp2p-tcp":"^0.15.1","libp2p-webrtc-star":"^0.20.0","libp2p-websockets":"^0.14.0",multihashes:"^3.0.1",nock:"^13.0.3","p-defer":"^3.0.0","p-times":"^3.0.0","p-wait-for":"^3.1.0","promisify-es6":"^1.0.3",rimraf:"^3.0.2",sinon:"^9.0.2",uint8arrays:"^1.1.0"},$_=["David Dias <daviddias.p@gmail.com>","Jacob Heun <jacobheun@gmail.com>","Vasco Santos <vasco.santos@moxy.studio>","Alan Shaw <alan@tableflip.io>","Alex Potsides <alex@achingbrain.net>","Cayman <caymannava@gmail.com>","Pedro Teixeira <i@pgte.me>","Friedel Ziegelmayer <dignifiedquire@gmail.com>","Maciej Krüger <mkg20001@gmail.com>","Hugo Dias <mail@hugodias.me>","Volker Mische <volker.mische@gmail.com>","dirkmc <dirkmdev@gmail.com>","Richard Littauer <richard.littauer@gmail.com>","ᴠɪᴄᴛᴏʀ ʙᴊᴇʟᴋʜᴏʟᴍ <victorbjelkholm@gmail.com>","Andrew Nesbitt <andrewnez@gmail.com>","Elven <mon.samuel@qq.com>","Giovanni T. Parra <fiatjaf@gmail.com>","Ryan Bell <ryan@piing.net>","Thomas Eizinger <thomas@eizinger.io>","Didrik Nordström <didrik@betamos.se>","Francis Gulotta <wizard@roborooter.com>","Florian-Merle <florian.david.merle@gmail.com>","Joel Gustafson <joelg@mit.edu>","Julien Bouquillon <contact@revolunet.com>","Kevin Kwok <antimatter15@gmail.com>","Felipe Martins <felipebrasil93@gmail.com>","Nuno Nogueira <nunofmn@gmail.com>","Fei Liu <liu.feiwood@gmail.com>","RasmusErik Voel Jensen <github@solsort.com>","Dmitriy Ryajov <dryajov@gmail.com>","Soeren <nikorpoulsen@gmail.com>","Sönke Hahn <soenkehahn@gmail.com>","Tiago Alves <alvesjtiago@gmail.com>","Diogo Silva <fsdiogo@gmail.com>","Yusef Napora <yusef@napora.org>","Zane Starr <zcstarr@gmail.com>","Daijiro Wachi <daijiro.wachi@gmail.com>","Chris Bratlien <chrisbratlien@gmail.com>","ebinks <elizabethjbinks@gmail.com>","Bernd Strehl <bernd.strehl@gmail.com>","isan_rivkin <isanrivkin@gmail.com>","Henrique Dias <hacdias@gmail.com>","robertkiel <robert.kiel@validitylabs.org>","Irakli Gozalishvili <rfobic@gmail.com>"];var V_={name:R_,version:k_,description:P_,leadMaintainer:N_,main:O_,files:D_,scripts:M_,repository:x_,keywords:B_,bugs:L_,homepage:j_,license:U_,engines:F_,dependencies:q_,devDependencies:G_,contributors:$_};const H_=V_.version;var z_="ipfs/0.1.0",K_=`js-libp2p/${H_}`,W_="/ipfs/id/1.0.0",X_="/ipfs/id/push/1.0.0",Q_={PROTOCOL_VERSION:z_,AGENT_VERSION:K_,MULTICODEC_IDENTIFY:W_,MULTICODEC_IDENTIFY_PUSH:X_};const Or=te("libp2p:identify");Or.error=te("libp2p:identify:error");const{collect:op,take:cp,consume:up}=mu,{toBuffer:lp}=wu,{MULTICODEC_IDENTIFY:Eu,MULTICODEC_IDENTIFY_PUSH:Po,AGENT_VERSION:Y_,PROTOCOL_VERSION:J_}=Q_,{codes:Su}=It;class hp{static getCleanMultiaddr(e){if(e&&e.length>0)try{return Pe(e)}catch(t){return null}return null}constructor({libp2p:e,protocols:t}){this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.connectionManager.on("peer:connect",r=>{const n=r.remotePeer;this.identify(r,n).catch(Or.error)}),this.peerId=e.peerId,this._libp2p=e,this._protocols=t,this.handleMessage=this.handleMessage.bind(this)}async push(e){const t=await this._getSelfPeerRecord(),r=this._libp2p.multiaddrs.map(a=>a.bytes),n=Array.from(this._protocols.keys()),i=e.map(async a=>{try{const{stream:s}=await a.newStream(Po);await Lt([{listenAddrs:r,signedPeerRecord:t,protocols:n}],C_.encode(ps),s,up)}catch(s){Or.error("could not push identify update to peer",s)}});return Promise.all(i)}pushToPeerStore(e){const t=[];let r;for(const n of e.peers.values())n.protocols.includes(Po)&&(r=this.connectionManager.get(n.id))&&t.push(r);this.push(t)}async identify(e){const{stream:t}=await e.newStream(Eu),[r]=await Lt([],t,ct.decode(),cp(1),lp,op);if(!r)throw $(new Error("No data could be retrieved"),Su.ERR_CONNECTION_ENDED);let n;try{n=ps.decode(r)}catch(l){throw $(l,Su.ERR_INVALID_MESSAGE)}let{publicKey:i,listenAddrs:a,protocols:s,observedAddr:c,signedPeerRecord:o}=n;const u=await Ae.createFromPubKey(i);if(e.remotePeer.toB58String()!==u.toB58String())throw $(new Error("identified peer does not match the expected peer"),Su.ERR_INVALID_PEER);c=hp.getCleanMultiaddr(c);try{const l=await ds.openAndCertify(o,To.DOMAIN);if(this.peerStore.addressBook.consumePeerRecord(l)){this.peerStore.protoBook.set(u,s);return}}catch(l){Or("received invalid envelope, discard it and fallback to listenAddrs is available",l)}try{this.peerStore.addressBook.set(u,a.map(l=>Pe(l)))}catch(l){Or.error("received invalid addrs",l)}this.peerStore.protoBook.set(u,s),this.peerStore.metadataBook.set(u,"AgentVersion",st(n.agentVersion)),Or("received observed address of %s",c)}handleMessage({connection:e,stream:t,protocol:r}){switch(r){case Eu:return this._handleIdentify({connection:e,stream:t});case Po:return this._handlePush({connection:e,stream:t});default:Or.error("cannot handle unknown protocol %s",r)}}async _handleIdentify({connection:e,stream:t}){let r=new Uint8Array(0);this.peerId.pubKey&&(r=this.peerId.pubKey.bytes);const n=await this._getSelfPeerRecord(),i=ps.encode({protocolVersion:J_,agentVersion:Y_,publicKey:r,listenAddrs:this._libp2p.multiaddrs.map(a=>a.bytes),signedPeerRecord:n,observedAddr:e.remoteAddr.bytes,protocols:Array.from(this._protocols.keys())});try{await Lt([i],ct.encode(),t,up)}catch(a){Or.error("could not respond to identify request",a)}}async _handlePush({connection:e,stream:t}){let r;try{const[i]=await Lt([],t,ct.decode(),cp(1),lp,op);r=ps.decode(i)}catch(i){return Or.error("received invalid message",i)}const n=e.remotePeer;try{const i=await ds.openAndCertify(r.signedPeerRecord,To.DOMAIN);if(this.peerStore.addressBook.consumePeerRecord(i)){this.peerStore.protoBook.set(n,r.protocols);return}}catch(i){Or("received invalid envelope, discard it and fallback to listenAddrs is available",i)}try{this.peerStore.addressBook.set(n,r.listenAddrs.map(i=>Pe(i)))}catch(i){Or.error("received invalid addrs",i)}this.peerStore.protoBook.set(n,r.protocols)}async _getSelfPeerRecord(){const e=this.peerStore.addressBook.getRawEnvelope(this.peerId);if(e)return e;try{const t=new To({peerId:this.peerId,multiaddrs:this._libp2p.multiaddrs}),r=await ds.seal(t,this.peerId);return this.peerStore.addressBook.consumePeerRecord(r),this.peerStore.addressBook.getRawEnvelope(this.peerId)}catch(t){Or.error("failed to get self peer record")}return null}}var Z_=hp,eE={IDENTIFY:Eu,IDENTIFY_PUSH:Po},tE=ps,rE={IdentifyService:Z_,multicodecs:eE,Message:tE};const{EventEmitter:nE}=Bt,pr=te("libp2p");pr.error=te("libp2p:error");const{validate:iE}=Eb,{codes:dp,messages:aE}=It,{IdentifyService:sE,multicodecs:oE}=rE;class No extends nE{constructor(e){super();if(this._options=iE(e),this.peerId=this._options.peerId,this.datastore=this._options.datastore,this.peerStore=this.datastore&&this._options.peerStore.persistence?new f_({peerId:this.peerId,datastore:this.datastore,...this._options.peerStore}):new rp({peerId:this.peerId}),this.addresses=this._options.addresses,this.addressManager=new Tb(this._options.addresses),this._modules=this._options.modules,this._config=this._options.config,this._transport=[],this._discovery=new Map,this._options.connectionManager.minPeers&&(this._options.connectionManager.minConnections=this._options.connectionManager.minPeers),this.connectionManager=new Mb(this,{autoDial:this._config.peerDiscovery.autoDial,...this._options.connectionManager}),this._options.metrics.enabled&&(this.metrics=new c0({...this._options.metrics,connectionManager:this.connectionManager})),this._options.keychain&&this._options.keychain.datastore){pr("creating keychain");const r=Id.generateOptions();this.keychain=new Id(this._options.keychain.datastore,{passPhrase:this._options.keychain.pass,...r,...this._options.keychain}),pr("keychain constructed")}if(this.upgrader=new C0({localPeer:this.peerId,metrics:this.metrics,onConnection:r=>this.connectionManager.onConnect(r),onConnectionEnd:r=>this.connectionManager.onDisconnect(r)}),this.transportManager=new kh({libp2p:this,upgrader:this.upgrader,faultTolerance:this._options.transportManager.faultTolerance}),this.registrar=new v_({peerStore:this.peerStore,connectionManager:this.connectionManager}),this.handle=this.handle.bind(this),this.registrar.handle=this.handle,!this._modules.connEncryption||!this._modules.connEncryption.length)throw $(new Error(aE.CONN_ENCRYPTION_REQUIRED),dp.CONN_ENCRYPTION_REQUIRED);const t=this._modules.connEncryption;if(t.forEach(r=>{this.upgrader.cryptos.set(r.protocol,r)}),this.dialer=new fv({transportManager:this.transportManager,peerStore:this.peerStore,concurrency:this._options.dialer.maxParallelDials,perPeerLimit:this._options.dialer.maxDialsPerPeer,timeout:this._options.dialer.dialTimeout}),this._modules.transport.forEach(r=>{const n=r.prototype[Symbol.toStringTag],i=this._config.transport[n];this.transportManager.add(n,r,i)}),this._config.relay.enabled&&this.transportManager.add(cd.prototype[Symbol.toStringTag],cd),this._modules.streamMuxer){const r=this._modules.streamMuxer;r.forEach(n=>{this.upgrader.muxers.set(n.multicodec,n)}),this.identifyService=new sE({libp2p:this,protocols:this.upgrader.protocols}),this.handle(Object.values(oE),this.identifyService.handleMessage)}if(this._modules.connProtector)this.upgrader.protector=this._modules.connProtector;else if(Mn.process!==void 0&&Mn.process.env&&Mn.process.env.LIBP2P_FORCE_PNET)throw new Error("Private network is enforced, but no protector was provided");if(this._modules.dht){const r=this._modules.dht;this._dht=new r({libp2p:this,dialer:this.dialer,peerId:this.peerId,peerStore:this.peerStore,registrar:this.registrar,datastore:this.datastore,...this._config.dht})}if(this._modules.pubsub){const r=this._modules.pubsub;this.pubsub=Z0(r,this,this._config.pubsub)}this.peerRouting=qg(this),this.contentRouting=zg(this),ko.mount(this),this._onDiscoveryPeer=this._onDiscoveryPeer.bind(this)}emit(e,...t){e==="error"&&!this._events.error?pr.error(...t):super.emit(e,...t)}async start(){pr("libp2p is starting");try{await this._onStarting(),await this._onDidStart(),pr("libp2p has started")}catch(e){throw this.emit("error",e),pr.error("An error occurred starting libp2p",e),await this.stop(),e}}async stop(){pr("libp2p is stopping");try{for(const e of this._discovery.values())e.removeListener("peer",this._onDiscoveryPeer);await Promise.all(Array.from(this._discovery.values(),e=>e.stop())),this._discovery=new Map,await this.peerStore.stop(),await this.connectionManager.stop(),await Promise.all([this.pubsub&&this.pubsub.stop(),this._dht&&this._dht.stop(),this.metrics&&this.metrics.stop()]),await this.transportManager.close(),ko.unmount(this),this.dialer.destroy()}catch(e){e&&(pr.error(e),this.emit("error",e))}this._isStarted=!1,pr("libp2p has stopped")}async loadKeychain(){try{await this.keychain.findKeyByName("self")}catch(e){await this.keychain.importPeer("self",this.peerId)}}isStarted(){return this._isStarted}get connections(){return this.connectionManager.connections}dial(e,t){return this.dialProtocol(e,null,t)}async dialProtocol(e,t,r){const{id:n,multiaddrs:i}=ao(e);let a=this.connectionManager.get(n);return a?i&&this.peerStore.addressBook.add(n,i):a=await this.dialer.connectToPeer(e,r),t?a.newStream(t):a}get multiaddrs(){const e=this.addressManager.getNoAnnounceAddrs();return this.transportManager.getAddrs().concat(this.addressManager.getAnnounceAddrs()).filter((t,r,n)=>n.findIndex(i=>i.equals(t))!==r?!1:!e.find(i=>i.equals(t)))}async hangUp(e){const{id:t}=ao(e),r=this.connectionManager.connections.get(t.toB58String());if(!r)return;await Promise.all(r.map(n=>n.close()))}ping(e){const{id:t,multiaddrs:r}=ao(e);return r?ko(this,r[0]):ko(this,t)}handle(e,t){e=Array.isArray(e)?e:[e],e.forEach(r=>{this.upgrader.protocols.set(r,t)}),this.isStarted()&&this.identifyService&&this.identifyService.pushToPeerStore(this.peerStore)}unhandle(e){e=Array.isArray(e)?e:[e],e.forEach(t=>{this.upgrader.protocols.delete(t)}),this.isStarted()&&this.identifyService&&this.identifyService.pushToPeerStore(this.peerStore)}async _onStarting(){await this.transportManager.listen(),await this.peerStore.start(),this._config.pubsub.enabled&&(this.pubsub&&this.pubsub.start()),this._config.dht.enabled&&(this._dht&&this._dht.start(),this._dht.on("peer",this._onDiscoveryPeer)),this.metrics&&this.metrics.start()}async _onDidStart(){this._isStarted=!0,this.peerStore.on("peer",e=>{this.emit("peer:discovery",e),this._maybeConnect(e)});for(const e of this.peerStore.peers.values())this.emit("peer:discovery",e.id);this.connectionManager.start(),await this._setupPeerDiscovery()}_onDiscoveryPeer(e){if(e.id.toB58String()===this.peerId.toB58String()){pr.error(new Error(dp.ERR_DISCOVERED_SELF));return}e.multiaddrs&&this.peerStore.addressBook.add(e.id,e.multiaddrs),e.protocols&&this.peerStore.protoBook.set(e.id,e.protocols)}async _maybeConnect(e){if(this._config.peerDiscovery.autoDial===!0&&!this.connectionManager.get(e)){const t=this._options.connectionManager.minConnections||0;if(t>this.connectionManager.size){pr("connecting to discovered peer %s",e.toB58String());try{await this.dialer.connectToPeer(e)}catch(r){pr.error("could not connect to discovered peer",r)}}}}async _setupPeerDiscovery(){const e=t=>{let r={enabled:!0};if(t.tag&&this._config.peerDiscovery&&this._config.peerDiscovery[t.tag]&&(r={...r,...this._config.peerDiscovery[t.tag]}),r.enabled&&!this._discovery.has(t.tag)){let n;typeof t=="function"?n=new t(Object.assign({},r,{peerId:this.peerId,libp2p:this})):n=t,n.on("peer",this._onDiscoveryPeer),this._discovery.set(t.tag,n)}};for(const t of this._modules.peerDiscovery||[])e(t);for(const t of this.transportManager.getTransports())t.discovery&&e(t.discovery);await Promise.all(Array.from(this._discovery.values(),t=>t.start()))}}No.create=async function(t={}){if(t.peerId)return new No(t);const r=await Ae.create();return t.peerId=r,new No(t)};var cE=No,uE=typeof WebSocket=="undefined"?Nn:WebSocket,Au=le(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(i){if(this.isStopped)return;const a={value:i,done:!1};if(this.pullQueue.length){const s=this.pullQueue.shift();s&&s.resolve(a)}else this.pushQueue.push(Promise.resolve(a)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(this.isStopped)return;this.isStopped=!0,this.remove();for(const i of this.pullQueue)i.resolve({value:void 0,done:!0});this.pullQueue.length=0}fail(i){if(this.isStopped)return;if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const a of this.pullQueue)a.reject(i);this.pullQueue.length=0}else{const a=Promise.reject(i);a.catch(()=>{}),this.pushQueue.push(a)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:i=>{const a=this.pushQueue.shift();return a?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),a):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((s,c)=>{this.pullQueue.push({resolve:s,reject:c})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class n{constructor(i,{highWaterMark:a=100,lowWaterMark:s=1}={}){const c=new r;c.highWaterMark=a,c.lowWaterMark=s,c.removeCallback=i({push:o=>c.push(o),stop:()=>c.stop(),fail:o=>c.fail(o),on:(o,u)=>{c.eventHandlers[o]=u}})||(()=>{}),this[Symbol.asyncIterator]=()=>c[Symbol.asyncIterator](),Object.freeze(this)}}t.EventIterator=n,t.default=n}),lE=le(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventIterator=Au.EventIterator;function r(n,i,a){return new Au.EventIterator(({push:s})=>(this.addEventListener(n,s,i),()=>this.removeEventListener(n,s,i)),a)}t.subscribe=r,t.default=Au.EventIterator});const{Buffer:hE}=zt,{EventIterator:dE}=lE;function pE(e){return e instanceof ArrayBuffer||e!=null&&e.constructor!=null&&e.constructor.name==="ArrayBuffer"&&typeof e.byteLength=="number"}var pp=e=>{const t=e.removeEventListener||e.removeListener,r=async function*(){const a=new dE(({push:s,stop:c,fail:o})=>(e.addEventListener("message",s),e.addEventListener("error",o),e.addEventListener("close",c),()=>{t.call(e,"message",s),t.call(e,"error",o),t.call(e,"close",c)}),{highWaterMark:Infinity});for await(const{data:s}of a)yield pE(s)?hE.from(s):s}();let n=e.readyState===1,i;return e.addEventListener("open",()=>{n=!0,i=null}),e.addEventListener("close",()=>{n=!1,i=null}),e.addEventListener("error",a=>{n||(i=a)}),r.connected=()=>new Promise((a,s)=>{if(n)return a();if(i)return s(i);const c=l=>{t.call(e,"open",o),t.call(e,"error",u),l()},o=()=>c(a),u=l=>c(()=>s(l));e.addEventListener("open",o),e.addEventListener("error",u)}),r},fE=async e=>{if(e.readyState>=2)throw new Error("socket closed");return e.readyState===1?void 0:new Promise((t,r)=>{const n=e&&(e.removeEventListener||e.removeListener);function i(){typeof n=="function"&&(n.call(e,"open",a),n.call(e,"error",s))}function a(){i(),t()}function s(c){i(),r(c)}e.addEventListener("open",a),e.addEventListener("error",s)})},fp=(e,t)=>(t=t||{},t.closeOnEnd=t.closeOnEnd!==!1,async r=>{for await(const n of r){try{await fE(e)}catch(i){if(i.message==="socket closed")break;throw i}e.send(n)}if(t.closeOnEnd&&e.readyState<=1)return new Promise((n,i)=>{e.addEventListener("close",a=>{if(a.wasClean||a.code===1006)n();else{const s=Object.assign(new Error("ws error"),{event:a});i(s)}}),setTimeout(()=>e.close())})}),mp=(e,t)=>{t=t||{},t.binaryType?e.binaryType=t.binaryType:t.binary&&(e.binaryType="arraybuffer");const r={sink:fp(e,t),source:pp(e),connected:()=>r.source.connected()};return r};/*! https://mths.be/punycode v1.4.1 by @mathias */var Tu=2147483647,fs=36,gp=1,Cu=26,mE=38,gE=700,bE=72,yE=128,vE="-",wE=/[^\x20-\x7E]/,_E=/[\x2E\u3002\uFF0E\uFF61]/g,EE={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Iu=fs-gp,Ea=Math.floor,Ru=String.fromCharCode;function bp(e){throw new RangeError(EE[e])}function SE(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function AE(e,t){var r=e.split("@"),n="";r.length>1&&(n=r[0]+"@",e=r[1]),e=e.replace(_E,".");var i=e.split("."),a=SE(i,t).join(".");return n+a}function TE(e){for(var t=[],r=0,n=e.length,i,a;r<n;)i=e.charCodeAt(r++),i>=55296&&i<=56319&&r<n?(a=e.charCodeAt(r++),(a&64512)==56320?t.push(((i&1023)<<10)+(a&1023)+65536):(t.push(i),r--)):t.push(i);return t}function yp(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function CE(e,t,r){var n=0;for(e=r?Ea(e/gE):e>>1,e+=Ea(e/t);e>Iu*Cu>>1;n+=fs)e=Ea(e/Iu);return Ea(n+(Iu+1)*e/(e+mE))}function IE(e){var t,r,n,i,a,s,c,o,u,l,f,_=[],p,I,d,v;for(e=TE(e),p=e.length,t=yE,r=0,a=bE,s=0;s<p;++s)f=e[s],f<128&&_.push(Ru(f));for(n=i=_.length,i&&_.push(vE);n<p;){for(c=Tu,s=0;s<p;++s)f=e[s],f>=t&&f<c&&(c=f);for(I=n+1,c-t>Ea((Tu-r)/I)&&bp("overflow"),r+=(c-t)*I,t=c,s=0;s<p;++s)if(f=e[s],f<t&&++r>Tu&&bp("overflow"),f==t){for(o=r,u=fs;!(l=u<=a?gp:u>=a+Cu?Cu:u-a,o<l);u+=fs)v=o-l,d=fs-l,_.push(Ru(yp(l+v%d,0))),o=Ea(v/d);_.push(Ru(yp(o,0))),a=CE(r,I,n==i),r=0,++n}++r,++t}return _.join("")}function RE(e){return AE(e,function(t){return wE.test(t)?"xn--"+IE(t):t})}function kE(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var vp=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function ms(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}function PE(e,t,r,n){return t=t||"&",r=r||"=",e===null&&(e=void 0),typeof e=="object"?wp(NE(e),function(i){var a=encodeURIComponent(ms(i))+r;return vp(e[i])?wp(e[i],function(s){return a+encodeURIComponent(ms(s))}).join(t):a+encodeURIComponent(ms(e[i]))}).join(t):n?encodeURIComponent(ms(n))+r+encodeURIComponent(ms(e)):""}function wp(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var NE=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t};function _p(e,t,r,n){t=t||"&",r=r||"=";var i={};if(typeof e!="string"||e.length===0)return i;var a=/\+/g;e=e.split(t);var s=1e3;n&&typeof n.maxKeys=="number"&&(s=n.maxKeys);var c=e.length;s>0&&c>s&&(c=s);for(var o=0;o<c;++o){var u=e[o].replace(a,"%20"),l=u.indexOf(r),f,_,p,I;l>=0?(f=u.substr(0,l),_=u.substr(l+1)):(f=u,_=""),p=decodeURIComponent(f),I=decodeURIComponent(_),kE(i,p)?vp(i[p])?i[p].push(I):i[p]=[i[p],I]:i[p]=I}return i}var OE={parse:gs,resolve:Ip,resolveObject:Rp,format:Cp,Url:Yr};function Yr(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var DE=/^([a-z0-9.+-]+:)/i,ME=/:[0-9]*$/,xE=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,BE=["<",">",'"',"`"," ","\r",`
`,"	"],LE=["{","}","|","\\","^","`"].concat(BE),ku=["'"].concat(LE),Ep=["%","/","?",";","#"].concat(ku),Sp=["/","?","#"],jE=255,Ap=/^[+a-z0-9A-Z_-]{0,63}$/,UE=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,FE={javascript:!0,"javascript:":!0},Pu={javascript:!0,"javascript:":!0},Sa={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function gs(e,t,r){if(e&&Yl(e)&&e instanceof Yr)return e;var n=new Yr;return n.parse(e,t,r),n}Yr.prototype.parse=function(e,t,r){return Tp(this,e,t,r)};function Tp(e,t,r,n){if(!Sc(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var i=t.indexOf("?"),a=i!==-1&&i<t.indexOf("#")?"?":"#",s=t.split(a),c=/\\/g;s[0]=s[0].replace(c,"/"),t=s.join(a);var o=t;if(o=o.trim(),!n&&t.split("#").length===1){var u=xE.exec(o);if(u)return e.path=o,e.href=o,e.pathname=u[1],u[2]?(e.search=u[2],r?e.query=_p(e.search.substr(1)):e.query=e.search.substr(1)):r&&(e.search="",e.query={}),e}var l=DE.exec(o);if(l){l=l[0];var f=l.toLowerCase();e.protocol=f,o=o.substr(l.length)}if(n||l||o.match(/^\/\/[^@\/]+@[^@\/]+/)){var _=o.substr(0,2)==="//";_&&!(l&&Pu[l])&&(o=o.substr(2),e.slashes=!0)}var p,I,d,v;if(!Pu[l]&&(_||l&&!Sa[l])){var A=-1;for(p=0;p<Sp.length;p++)I=o.indexOf(Sp[p]),I!==-1&&(A===-1||I<A)&&(A=I);var j,O;for(A===-1?O=o.lastIndexOf("@"):O=o.lastIndexOf("@",A),O!==-1&&(j=o.slice(0,O),o=o.slice(O+1),e.auth=decodeURIComponent(j)),A=-1,p=0;p<Ep.length;p++)I=o.indexOf(Ep[p]),I!==-1&&(A===-1||I<A)&&(A=I);A===-1&&(A=o.length),e.host=o.slice(0,A),o=o.slice(A),kp(e),e.hostname=e.hostname||"";var m=e.hostname[0]==="["&&e.hostname[e.hostname.length-1]==="]";if(!m){var b=e.hostname.split(/\./);for(p=0,d=b.length;p<d;p++){var S=b[p];if(!S)continue;if(!S.match(Ap)){for(var h="",g=0,w=S.length;g<w;g++)S.charCodeAt(g)>127?h+="x":h+=S[g];if(!h.match(Ap)){var y=b.slice(0,p),P=b.slice(p+1),D=S.match(UE);D&&(y.push(D[1]),P.unshift(D[2])),P.length&&(o="/"+P.join(".")+o),e.hostname=y.join(".");break}}}}e.hostname.length>jE?e.hostname="":e.hostname=e.hostname.toLowerCase(),m||(e.hostname=RE(e.hostname)),v=e.port?":"+e.port:"";var L=e.hostname||"";e.host=L+v,e.href+=e.host,m&&(e.hostname=e.hostname.substr(1,e.hostname.length-2),o[0]!=="/"&&(o="/"+o))}if(!FE[f])for(p=0,d=ku.length;p<d;p++){var x=ku[p];if(o.indexOf(x)===-1)continue;var B=encodeURIComponent(x);B===x&&(B=escape(x)),o=o.split(x).join(B)}var G=o.indexOf("#");G!==-1&&(e.hash=o.substr(G),o=o.slice(0,G));var V=o.indexOf("?");if(V!==-1?(e.search=o.substr(V),e.query=o.substr(V+1),r&&(e.query=_p(e.query)),o=o.slice(0,V)):r&&(e.search="",e.query={}),o&&(e.pathname=o),Sa[f]&&e.hostname&&!e.pathname&&(e.pathname="/"),e.pathname||e.search){v=e.pathname||"";var K=e.search||"";e.path=v+K}return e.href=Nu(e),e}function Cp(e){return Sc(e)&&(e=Tp({},e)),Nu(e)}function Nu(e){var t=e.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var r=e.protocol||"",n=e.pathname||"",i=e.hash||"",a=!1,s="";e.host?a=t+e.host:e.hostname&&(a=t+(e.hostname.indexOf(":")===-1?e.hostname:"["+this.hostname+"]"),e.port&&(a+=":"+e.port)),e.query&&Yl(e.query)&&Object.keys(e.query).length&&(s=PE(e.query));var c=e.search||s&&"?"+s||"";return r&&r.substr(-1)!==":"&&(r+=":"),e.slashes||(!r||Sa[r])&&a!==!1?(a="//"+(a||""),n&&n.charAt(0)!=="/"&&(n="/"+n)):a||(a=""),i&&i.charAt(0)!=="#"&&(i="#"+i),c&&c.charAt(0)!=="?"&&(c="?"+c),n=n.replace(/[?#]/g,function(o){return encodeURIComponent(o)}),c=c.replace("#","%23"),r+a+n+c+i}Yr.prototype.format=function(){return Nu(this)};function Ip(e,t){return gs(e,!1,!0).resolve(t)}Yr.prototype.resolve=function(e){return this.resolveObject(gs(e,!1,!0)).format()};function Rp(e,t){return e?gs(e,!1,!0).resolveObject(t):t}Yr.prototype.resolveObject=function(e){if(Sc(e)){var t=new Yr;t.parse(e,!1,!0),e=t}for(var r=new Yr,n=Object.keys(this),i=0;i<n.length;i++){var a=n[i];r[a]=this[a]}if(r.hash=e.hash,e.href==="")return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),c=0;c<s.length;c++){var o=s[c];o!=="protocol"&&(r[o]=e[o])}return Sa[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}var u;if(e.protocol&&e.protocol!==r.protocol){if(!Sa[e.protocol]){for(var l=Object.keys(e),f=0;f<l.length;f++){var _=l[f];r[_]=e[_]}return r.href=r.format(),r}if(r.protocol=e.protocol,!e.host&&!Pu[e.protocol]){for(u=(e.pathname||"").split("/");u.length&&!(e.host=u.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),u[0]!==""&&u.unshift(""),u.length<2&&u.unshift(""),r.pathname=u.join("/")}else r.pathname=e.pathname;if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var p=r.pathname||"",I=r.search||"";r.path=p+I}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var d=r.pathname&&r.pathname.charAt(0)==="/",v=e.host||e.pathname&&e.pathname.charAt(0)==="/",A=v||d||r.host&&e.pathname,j=A,O=r.pathname&&r.pathname.split("/")||[],m=r.protocol&&!Sa[r.protocol];u=e.pathname&&e.pathname.split("/")||[],m&&(r.hostname="",r.port=null,r.host&&(O[0]===""?O[0]=r.host:O.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(u[0]===""?u[0]=e.host:u.unshift(e.host)),e.host=null),A=A&&(u[0]===""||O[0]===""));var b;if(v)r.host=e.host||e.host===""?e.host:r.host,r.hostname=e.hostname||e.hostname===""?e.hostname:r.hostname,r.search=e.search,r.query=e.query,O=u;else if(u.length)O||(O=[]),O.pop(),O=O.concat(u),r.search=e.search,r.query=e.query;else if(!Rg(e.search))return m&&(r.hostname=r.host=O.shift(),b=r.host&&r.host.indexOf("@")>0?r.host.split("@"):!1,b&&(r.auth=b.shift(),r.host=r.hostname=b.shift())),r.search=e.search,r.query=e.query,(!Zs(r.pathname)||!Zs(r.search))&&(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!O.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var S=O.slice(-1)[0],h=(r.host||e.host||O.length>1)&&(S==="."||S==="..")||S==="",g=0,w=O.length;w>=0;w--)S=O[w],S==="."?O.splice(w,1):S===".."?(O.splice(w,1),g++):g&&(O.splice(w,1),g--);if(!A&&!j)for(;g--;g)O.unshift("..");A&&O[0]!==""&&(!O[0]||O[0].charAt(0)!=="/")&&O.unshift(""),h&&O.join("/").substr(-1)!=="/"&&O.push("");var y=O[0]===""||O[0]&&O[0].charAt(0)==="/";return m&&(r.hostname=r.host=y?"":O.length?O.shift():"",b=r.host&&r.host.indexOf("@")>0?r.host.split("@"):!1,b&&(r.auth=b.shift(),r.host=r.hostname=b.shift())),A=A||r.host&&O.length,A&&!y&&O.unshift(""),O.length?r.pathname=O.join("/"):(r.pathname=null,r.path=null),(!Zs(r.pathname)||!Zs(r.search))&&(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},Yr.prototype.parseHost=function(){return kp(this)};function kp(e){var t=e.host,r=ME.exec(t);r&&(r=r[0],r!==":"&&(e.port=r.substr(1)),t=t.substr(0,t.length-r.length)),t&&(e.hostname=t)}var bs=Object.freeze({__proto__:null,parse:gs,resolve:Ip,resolveObject:Rp,format:Cp,default:OE,Url:Yr}),qE=function(e,t,r,n){r=r||{};var e=bs.parse(e,!1,!0),i;return e.protocol?i=e.protocol:(i=t.protocol?t.protocol.replace(/:$/,""):"http",i=(r[i]||n||i)+":"),e.host&&e.host[0]===":"&&(e.host=null),e.hostname?bs.format({protocol:i,slashes:!0,hostname:e.hostname,port:e.port,pathname:e.pathname,search:e.search}):(e.host=t.host,e.port?bs.format({protocol:i,slashes:!0,host:t.hostname+":"+e.port,port:e.port,pathname:e.pathname,search:e.search}):e.pathname?bs.format({protocol:i,slashes:!0,host:e.host,pathname:e.pathname,search:e.search}):(e.pathname=t.pathname,e.search?bs.format({protocol:i,slashes:!0,host:e.host,pathname:e.pathname,search:e.search}):(e.search=t.search,e.format(e))))};const GE={http:"ws",https:"wss"},$E="ws";var VE=(e,t)=>qE(e,t,GE,$E),Pp=le(function(e){e.exports=function(t,r={}){const n=typeof window=="undefined"?{}:window.location,i=VE(t,n),a=new uE(i,r.websocket),s=mp(a,r);return s.remoteAddress=i,s.close=()=>new Promise((c,o)=>{a.addEventListener("close",c),a.close()}),s.destroy=()=>{a.terminate?a.terminate():a.close()},s.socket=a,s},e.exports.connect=e.exports});const Oo=(e,t)=>t,HE=(e,t,r,n)=>{if(n&&n.assumeHttp===!1)return`tcp://${e}:${t}`;let i="tcp",a=`:${t}`;const s=r[r.length-1];return s.protocol==="tcp"&&(i=t==="443"?"https":"http",a=t==="443"||t==="80"?"":a),`${i}://${e}${a}`},zE={ip4:Oo,ip6:(e,t,r,n)=>n.length===1&&n[0].protocol==="ip6"?t:`[${t}]`,tcp:(e,t,r,n,i)=>n.some(a=>["http","https","ws","wss"].includes(a.protocol))?`${e}:${t}`:HE(e,t,n,i),udp:(e,t)=>`udp://${e}:${t}`,dnsaddr:Oo,dns4:Oo,dns6:Oo,ipfs:(e,t)=>`${e}/ipfs/${t}`,p2p:(e,t)=>`${e}/p2p/${t}`,http:e=>`http://${e}`,https:e=>`https://${e}`,ws:e=>`ws://${e}`,wss:e=>`wss://${e}`,"p2p-websocket-star":e=>`${e}/p2p-websocket-star`,"p2p-webrtc-star":e=>`${e}/p2p-webrtc-star`,"p2p-webrtc-direct":e=>`${e}/p2p-webrtc-direct`};var KE=(e,t)=>{const r=Pe(e),n=e.toString().split("/").slice(1);return r.tuples().map(i=>({protocol:n.shift(),content:i[1]?n.shift():null})).reduce((i,a,s,c)=>{const o=zE[a.protocol];if(!o)throw new Error(`Unsupported protocol ${a.protocol}`);return o(i,a.content,s,c,t)},"")},WE=le(function(e,t){t=e.exports=mp,t.source=pp,t.sink=fp,t.createServer=Nn,t.connect=Pp}),XE=421,QE=290,YE=2e3,Np={CODE_P2P:XE,CODE_CIRCUIT:QE,CLOSE_TIMEOUT:YE},Op=le(function(e,t){(function(){var r,n=244837814094590,i=(n&16777215)==15715070;function a(E,C,k){E!=null&&(typeof E=="number"?this.fromNumber(E,C,k):C==null&&typeof E!="string"?this.fromString(E,256):this.fromString(E,C))}function s(){return new a(null)}function c(E,C,k,U,X,Y){for(;--Y>=0;){var re=C*this[E++]+k[U]+X;X=Math.floor(re/67108864),k[U++]=re&67108863}return X}function o(E,C,k,U,X,Y){for(var re=C&32767,ie=C>>15;--Y>=0;){var De=this[E]&32767,Ye=this[E++]>>15,ft=ie*De+Ye*re;De=re*De+((ft&32767)<<15)+k[U]+(X&1073741823),X=(De>>>30)+(ft>>>15)+ie*Ye+(X>>>30),k[U++]=De&1073741823}return X}function u(E,C,k,U,X,Y){for(var re=C&16383,ie=C>>14;--Y>=0;){var De=this[E]&16383,Ye=this[E++]>>14,ft=ie*De+Ye*re;De=re*De+((ft&16383)<<14)+k[U]+X,X=(De>>28)+(ft>>14)+ie*Ye,k[U++]=De&268435455}return X}var l=typeof navigator!="undefined";l&&i&&navigator.appName=="Microsoft Internet Explorer"?(a.prototype.am=o,r=30):l&&i&&navigator.appName!="Netscape"?(a.prototype.am=c,r=26):(a.prototype.am=u,r=28),a.prototype.DB=r,a.prototype.DM=(1<<r)-1,a.prototype.DV=1<<r;var f=52;a.prototype.FV=Math.pow(2,f),a.prototype.F1=f-r,a.prototype.F2=2*r-f;var _="0123456789abcdefghijklmnopqrstuvwxyz",p=new Array,I,d;for(I="0".charCodeAt(0),d=0;d<=9;++d)p[I++]=d;for(I="a".charCodeAt(0),d=10;d<36;++d)p[I++]=d;for(I="A".charCodeAt(0),d=10;d<36;++d)p[I++]=d;function v(E){return _.charAt(E)}function A(E,C){var k=p[E.charCodeAt(C)];return k??-1}function j(E){for(var C=this.t-1;C>=0;--C)E[C]=this[C];E.t=this.t,E.s=this.s}function O(E){this.t=1,this.s=E<0?-1:0,E>0?this[0]=E:E<-1?this[0]=E+this.DV:this.t=0}function m(E){var C=s();return C.fromInt(E),C}function b(E,C){var k;if(C==16)k=4;else if(C==8)k=3;else if(C==256)k=8;else if(C==2)k=1;else if(C==32)k=5;else if(C==4)k=2;else{this.fromRadix(E,C);return}this.t=0,this.s=0;for(var U=E.length,X=!1,Y=0;--U>=0;){var re=k==8?E[U]&255:A(E,U);if(re<0){E.charAt(U)=="-"&&(X=!0);continue}X=!1,Y==0?this[this.t++]=re:Y+k>this.DB?(this[this.t-1]|=(re&(1<<this.DB-Y)-1)<<Y,this[this.t++]=re>>this.DB-Y):this[this.t-1]|=re<<Y,Y+=k,Y>=this.DB&&(Y-=this.DB)}k==8&&(E[0]&128)!=0&&(this.s=-1,Y>0&&(this[this.t-1]|=(1<<this.DB-Y)-1<<Y)),this.clamp(),X&&a.ZERO.subTo(this,this)}function S(){for(var E=this.s&this.DM;this.t>0&&this[this.t-1]==E;)--this.t}function h(E){if(this.s<0)return"-"+this.negate().toString(E);var C;if(E==16)C=4;else if(E==8)C=3;else if(E==2)C=1;else if(E==32)C=5;else if(E==4)C=2;else return this.toRadix(E);var k=(1<<C)-1,U,X=!1,Y="",re=this.t,ie=this.DB-re*this.DB%C;if(re-- >0)for(ie<this.DB&&(U=this[re]>>ie)>0&&(X=!0,Y=v(U));re>=0;)ie<C?(U=(this[re]&(1<<ie)-1)<<C-ie,U|=this[--re]>>(ie+=this.DB-C)):(U=this[re]>>(ie-=C)&k,ie<=0&&(ie+=this.DB,--re)),U>0&&(X=!0),X&&(Y+=v(U));return X?Y:"0"}function g(){var E=s();return a.ZERO.subTo(this,E),E}function w(){return this.s<0?this.negate():this}function y(E){var C=this.s-E.s;if(C!=0)return C;var k=this.t;if(C=k-E.t,C!=0)return this.s<0?-C:C;for(;--k>=0;)if((C=this[k]-E[k])!=0)return C;return 0}function P(E){var C=1,k;return(k=E>>>16)!=0&&(E=k,C+=16),(k=E>>8)!=0&&(E=k,C+=8),(k=E>>4)!=0&&(E=k,C+=4),(k=E>>2)!=0&&(E=k,C+=2),(k=E>>1)!=0&&(E=k,C+=1),C}function D(){return this.t<=0?0:this.DB*(this.t-1)+P(this[this.t-1]^this.s&this.DM)}function L(E,C){var k;for(k=this.t-1;k>=0;--k)C[k+E]=this[k];for(k=E-1;k>=0;--k)C[k]=0;C.t=this.t+E,C.s=this.s}function x(E,C){for(var k=E;k<this.t;++k)C[k-E]=this[k];C.t=Math.max(this.t-E,0),C.s=this.s}function B(E,C){var k=E%this.DB,U=this.DB-k,X=(1<<U)-1,Y=Math.floor(E/this.DB),re=this.s<<k&this.DM,ie;for(ie=this.t-1;ie>=0;--ie)C[ie+Y+1]=this[ie]>>U|re,re=(this[ie]&X)<<k;for(ie=Y-1;ie>=0;--ie)C[ie]=0;C[Y]=re,C.t=this.t+Y+1,C.s=this.s,C.clamp()}function G(E,C){C.s=this.s;var k=Math.floor(E/this.DB);if(k>=this.t){C.t=0;return}var U=E%this.DB,X=this.DB-U,Y=(1<<U)-1;C[0]=this[k]>>U;for(var re=k+1;re<this.t;++re)C[re-k-1]|=(this[re]&Y)<<X,C[re-k]=this[re]>>U;U>0&&(C[this.t-k-1]|=(this.s&Y)<<X),C.t=this.t-k,C.clamp()}function V(E,C){for(var k=0,U=0,X=Math.min(E.t,this.t);k<X;)U+=this[k]-E[k],C[k++]=U&this.DM,U>>=this.DB;if(E.t<this.t){for(U-=E.s;k<this.t;)U+=this[k],C[k++]=U&this.DM,U>>=this.DB;U+=this.s}else{for(U+=this.s;k<E.t;)U-=E[k],C[k++]=U&this.DM,U>>=this.DB;U-=E.s}C.s=U<0?-1:0,U<-1?C[k++]=this.DV+U:U>0&&(C[k++]=U),C.t=k,C.clamp()}function K(E,C){var k=this.abs(),U=E.abs(),X=k.t;for(C.t=X+U.t;--X>=0;)C[X]=0;for(X=0;X<U.t;++X)C[X+k.t]=k.am(0,U[X],C,X,0,k.t);C.s=0,C.clamp(),this.s!=E.s&&a.ZERO.subTo(C,C)}function ae(E){for(var C=this.abs(),k=E.t=2*C.t;--k>=0;)E[k]=0;for(k=0;k<C.t-1;++k){var U=C.am(k,C[k],E,2*k,0,1);(E[k+C.t]+=C.am(k+1,2*C[k],E,2*k+1,U,C.t-k-1))>=C.DV&&(E[k+C.t]-=C.DV,E[k+C.t+1]=1)}E.t>0&&(E[E.t-1]+=C.am(k,C[k],E,2*k,0,1)),E.s=0,E.clamp()}function se(E,C,k){var U=E.abs();if(U.t<=0)return;var X=this.abs();if(X.t<U.t){C!=null&&C.fromInt(0),k!=null&&this.copyTo(k);return}k==null&&(k=s());var Y=s(),re=this.s,ie=E.s,De=this.DB-P(U[U.t-1]);De>0?(U.lShiftTo(De,Y),X.lShiftTo(De,k)):(U.copyTo(Y),X.copyTo(k));var Ye=Y.t,ft=Y[Ye-1];if(ft==0)return;var Ct=ft*(1<<this.F1)+(Ye>1?Y[Ye-2]>>this.F2:0),Zt=this.FV/Ct,hr=(1<<this.F1)/Ct,Mt=1<<this.F2,Ke=k.t,mt=Ke-Ye,Sr=C??s();for(Y.dlShiftTo(mt,Sr),k.compareTo(Sr)>=0&&(k[k.t++]=1,k.subTo(Sr,k)),a.ONE.dlShiftTo(Ye,Sr),Sr.subTo(Y,Y);Y.t<Ye;)Y[Y.t++]=0;for(;--mt>=0;){var kn=k[--Ke]==ft?this.DM:Math.floor(k[Ke]*Zt+(k[Ke-1]+Mt)*hr);if((k[Ke]+=Y.am(0,kn,k,mt,0,Ye))<kn)for(Y.dlShiftTo(mt,Sr),k.subTo(Sr,k);k[Ke]<--kn;)k.subTo(Sr,k)}C!=null&&(k.drShiftTo(Ye,C),re!=ie&&a.ZERO.subTo(C,C)),k.t=Ye,k.clamp(),De>0&&k.rShiftTo(De,k),re<0&&a.ZERO.subTo(k,k)}function ve(E){var C=s();return this.abs().divRemTo(E,null,C),this.s<0&&C.compareTo(a.ZERO)>0&&E.subTo(C,C),C}function fe(E){this.m=E}function me(E){return E.s<0||E.compareTo(this.m)>=0?E.mod(this.m):E}function pe(E){return E}function R(E){E.divRemTo(this.m,null,E)}function W(E,C,k){E.multiplyTo(C,k),this.reduce(k)}function Q(E,C){E.squareTo(C),this.reduce(C)}fe.prototype.convert=me,fe.prototype.revert=pe,fe.prototype.reduce=R,fe.prototype.mulTo=W,fe.prototype.sqrTo=Q;function Z(){if(this.t<1)return 0;var E=this[0];if((E&1)==0)return 0;var C=E&3;return C=C*(2-(E&15)*C)&15,C=C*(2-(E&255)*C)&255,C=C*(2-((E&65535)*C&65535))&65535,C=C*(2-E*C%this.DV)%this.DV,C>0?this.DV-C:-C}function ne(E){this.m=E,this.mp=E.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<E.DB-15)-1,this.mt2=2*E.t}function ce(E){var C=s();return E.abs().dlShiftTo(this.m.t,C),C.divRemTo(this.m,null,C),E.s<0&&C.compareTo(a.ZERO)>0&&this.m.subTo(C,C),C}function de(E){var C=s();return E.copyTo(C),this.reduce(C),C}function oe(E){for(;E.t<=this.mt2;)E[E.t++]=0;for(var C=0;C<this.m.t;++C){var k=E[C]&32767,U=k*this.mpl+((k*this.mph+(E[C]>>15)*this.mpl&this.um)<<15)&E.DM;for(k=C+this.m.t,E[k]+=this.m.am(0,U,E,C,0,this.m.t);E[k]>=E.DV;)E[k]-=E.DV,E[++k]++}E.clamp(),E.drShiftTo(this.m.t,E),E.compareTo(this.m)>=0&&E.subTo(this.m,E)}function Se(E,C){E.squareTo(C),this.reduce(C)}function J(E,C,k){E.multiplyTo(C,k),this.reduce(k)}ne.prototype.convert=ce,ne.prototype.revert=de,ne.prototype.reduce=oe,ne.prototype.mulTo=J,ne.prototype.sqrTo=Se;function $e(){return(this.t>0?this[0]&1:this.s)==0}function Lr(E,C){if(E>4294967295||E<1)return a.ONE;var k=s(),U=s(),X=C.convert(this),Y=P(E)-1;for(X.copyTo(k);--Y>=0;)if(C.sqrTo(k,U),(E&1<<Y)>0)C.mulTo(U,X,k);else{var re=k;k=U,U=re}return C.revert(k)}function rn(E,C){var k;return E<256||C.isEven()?k=new fe(C):k=new ne(C),this.exp(E,k)}a.prototype.copyTo=j,a.prototype.fromInt=O,a.prototype.fromString=b,a.prototype.clamp=S,a.prototype.dlShiftTo=L,a.prototype.drShiftTo=x,a.prototype.lShiftTo=B,a.prototype.rShiftTo=G,a.prototype.subTo=V,a.prototype.multiplyTo=K,a.prototype.squareTo=ae,a.prototype.divRemTo=se,a.prototype.invDigit=Z,a.prototype.isEven=$e,a.prototype.exp=Lr,a.prototype.toString=h,a.prototype.negate=g,a.prototype.abs=w,a.prototype.compareTo=y,a.prototype.bitLength=D,a.prototype.mod=ve,a.prototype.modPowInt=rn,a.ZERO=m(0),a.ONE=m(1);function Et(){var E=s();return this.copyTo(E),E}function jr(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function Xt(){return this.t==0?this.s:this[0]<<24>>24}function mr(){return this.t==0?this.s:this[0]<<16>>16}function Qt(E){return Math.floor(Math.LN2*this.DB/Math.log(E))}function ht(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function gr(E){if(E==null&&(E=10),this.signum()==0||E<2||E>36)return"0";var C=this.chunkSize(E),k=Math.pow(E,C),U=m(k),X=s(),Y=s(),re="";for(this.divRemTo(U,X,Y);X.signum()>0;)re=(k+Y.intValue()).toString(E).substr(1)+re,X.divRemTo(U,X,Y);return Y.intValue().toString(E)+re}function Ur(E,C){this.fromInt(0),C==null&&(C=10);for(var k=this.chunkSize(C),U=Math.pow(C,k),X=!1,Y=0,re=0,ie=0;ie<E.length;++ie){var De=A(E,ie);if(De<0){E.charAt(ie)=="-"&&this.signum()==0&&(X=!0);continue}re=C*re+De,++Y>=k&&(this.dMultiply(U),this.dAddOffset(re,0),Y=0,re=0)}Y>0&&(this.dMultiply(Math.pow(C,Y)),this.dAddOffset(re,0)),X&&a.ZERO.subTo(this,this)}function nn(E,C,k){if(typeof C=="number")if(E<2)this.fromInt(1);else for(this.fromNumber(E,k),this.testBit(E-1)||this.bitwiseTo(a.ONE.shiftLeft(E-1),br,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(C);)this.dAddOffset(2,0),this.bitLength()>E&&this.subTo(a.ONE.shiftLeft(E-1),this);else{var U=new Array,X=E&7;U.length=(E>>3)+1,C.nextBytes(U),X>0?U[0]&=(1<<X)-1:U[0]=0,this.fromString(U,256)}}function an(){var E=this.t,C=new Array;C[0]=this.s;var k=this.DB-E*this.DB%8,U,X=0;if(E-- >0)for(k<this.DB&&(U=this[E]>>k)!=(this.s&this.DM)>>k&&(C[X++]=U|this.s<<this.DB-k);E>=0;)k<8?(U=(this[E]&(1<<k)-1)<<8-k,U|=this[--E]>>(k+=this.DB-8)):(U=this[E]>>(k-=8)&255,k<=0&&(k+=this.DB,--E)),(U&128)!=0&&(U|=-256),X==0&&(this.s&128)!=(U&128)&&++X,(X>0||U!=this.s)&&(C[X++]=U);return C}function ir(E){return this.compareTo(E)==0}function Fr(E){return this.compareTo(E)<0?this:E}function qr(E){return this.compareTo(E)>0?this:E}function ar(E,C,k){var U,X,Y=Math.min(E.t,this.t);for(U=0;U<Y;++U)k[U]=C(this[U],E[U]);if(E.t<this.t){for(X=E.s&this.DM,U=Y;U<this.t;++U)k[U]=C(this[U],X);k.t=this.t}else{for(X=this.s&this.DM,U=Y;U<E.t;++U)k[U]=C(X,E[U]);k.t=E.t}k.s=C(this.s,E.s),k.clamp()}function Gr(E,C){return E&C}function $r(E){var C=s();return this.bitwiseTo(E,Gr,C),C}function br(E,C){return E|C}function sn(E){var C=s();return this.bitwiseTo(E,br,C),C}function St(E,C){return E^C}function Ot(E){var C=s();return this.bitwiseTo(E,St,C),C}function sr(E,C){return E&~C}function yr(E){var C=s();return this.bitwiseTo(E,sr,C),C}function Vr(){for(var E=s(),C=0;C<this.t;++C)E[C]=this.DM&~this[C];return E.t=this.t,E.s=~this.s,E}function dt(E){var C=s();return E<0?this.rShiftTo(-E,C):this.lShiftTo(E,C),C}function pt(E){var C=s();return E<0?this.lShiftTo(-E,C):this.rShiftTo(E,C),C}function on(E){if(E==0)return-1;var C=0;return(E&65535)==0&&(E>>=16,C+=16),(E&255)==0&&(E>>=8,C+=8),(E&15)==0&&(E>>=4,C+=4),(E&3)==0&&(E>>=2,C+=2),(E&1)==0&&++C,C}function At(){for(var E=0;E<this.t;++E)if(this[E]!=0)return E*this.DB+on(this[E]);return this.s<0?this.t*this.DB:-1}function Hr(E){for(var C=0;E!=0;)E&=E-1,++C;return C}function cn(){for(var E=0,C=this.s&this.DM,k=0;k<this.t;++k)E+=Hr(this[k]^C);return E}function un(E){var C=Math.floor(E/this.DB);return C>=this.t?this.s!=0:(this[C]&1<<E%this.DB)!=0}function ln(E,C){var k=a.ONE.shiftLeft(E);return this.bitwiseTo(k,C,k),k}function hn(E){return this.changeBit(E,br)}function nt(E){return this.changeBit(E,sr)}function Yt(E){return this.changeBit(E,St)}function vr(E,C){for(var k=0,U=0,X=Math.min(E.t,this.t);k<X;)U+=this[k]+E[k],C[k++]=U&this.DM,U>>=this.DB;if(E.t<this.t){for(U+=E.s;k<this.t;)U+=this[k],C[k++]=U&this.DM,U>>=this.DB;U+=this.s}else{for(U+=this.s;k<E.t;)U+=E[k],C[k++]=U&this.DM,U>>=this.DB;U+=E.s}C.s=U<0?-1:0,U>0?C[k++]=U:U<-1&&(C[k++]=this.DV+U),C.t=k,C.clamp()}function wr(E){var C=s();return this.addTo(E,C),C}function _r(E){var C=s();return this.subTo(E,C),C}function Jt(E){var C=s();return this.multiplyTo(E,C),C}function Gt(){var E=s();return this.squareTo(E),E}function dn(E){var C=s();return this.divRemTo(E,C,null),C}function pn(E){var C=s();return this.divRemTo(E,null,C),C}function fn(E){var C=s(),k=s();return this.divRemTo(E,C,k),new Array(C,k)}function mn(E){this[this.t]=this.am(0,E-1,this,0,0,this.t),++this.t,this.clamp()}function or(E,C){if(E==0)return;for(;this.t<=C;)this[this.t++]=0;for(this[C]+=E;this[C]>=this.DV;)this[C]-=this.DV,++C>=this.t&&(this[this.t++]=0),++this[C]}function rt(){}function Er(E){return E}function Dt(E,C,k){E.multiplyTo(C,k)}function gn(E,C){E.squareTo(C)}rt.prototype.convert=Er,rt.prototype.revert=Er,rt.prototype.mulTo=Dt,rt.prototype.sqrTo=gn;function bn(E){return this.exp(E,new rt)}function yn(E,C,k){var U=Math.min(this.t+E.t,C);for(k.s=0,k.t=U;U>0;)k[--U]=0;var X;for(X=k.t-this.t;U<X;++U)k[U+this.t]=this.am(0,E[U],k,U,0,this.t);for(X=Math.min(E.t,C);U<X;++U)this.am(0,E[U],k,U,0,C-U);k.clamp()}function vn(E,C,k){--C;var U=k.t=this.t+E.t-C;for(k.s=0;--U>=0;)k[U]=0;for(U=Math.max(C-this.t,0);U<E.t;++U)k[this.t+U-C]=this.am(C-U,E[U],k,0,0,this.t+U-C);k.clamp(),k.drShiftTo(1,k)}function cr(E){this.r2=s(),this.q3=s(),a.ONE.dlShiftTo(2*E.t,this.r2),this.mu=this.r2.divide(E),this.m=E}function ur(E){if(E.s<0||E.t>2*this.m.t)return E.mod(this.m);if(E.compareTo(this.m)<0)return E;var C=s();return E.copyTo(C),this.reduce(C),C}function Xn(E){return E}function Ti(E){for(E.drShiftTo(this.m.t-1,this.r2),E.t>this.m.t+1&&(E.t=this.m.t+1,E.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);E.compareTo(this.r2)<0;)E.dAddOffset(1,this.m.t+1);for(E.subTo(this.r2,E);E.compareTo(this.m)>=0;)E.subTo(this.m,E)}function Ha(E,C){E.squareTo(C),this.reduce(C)}function Qn(E,C,k){E.multiplyTo(C,k),this.reduce(k)}cr.prototype.convert=ur,cr.prototype.revert=Xn,cr.prototype.reduce=Ti,cr.prototype.mulTo=Qn,cr.prototype.sqrTo=Ha;function Ji(E,C){var k=E.bitLength(),U,X=m(1),Y;if(k<=0)return X;k<18?U=1:k<48?U=3:k<144?U=4:k<768?U=5:U=6,k<8?Y=new fe(C):C.isEven()?Y=new cr(C):Y=new ne(C);var re=new Array,ie=3,De=U-1,Ye=(1<<U)-1;if(re[1]=Y.convert(this),U>1){var ft=s();for(Y.sqrTo(re[1],ft);ie<=Ye;)re[ie]=s(),Y.mulTo(ft,re[ie-2],re[ie]),ie+=2}var Ct=E.t-1,Zt,hr=!0,Mt=s(),Ke;for(k=P(E[Ct])-1;Ct>=0;){for(k>=De?Zt=E[Ct]>>k-De&Ye:(Zt=(E[Ct]&(1<<k+1)-1)<<De-k,Ct>0&&(Zt|=E[Ct-1]>>this.DB+k-De)),ie=U;(Zt&1)==0;)Zt>>=1,--ie;if((k-=ie)<0&&(k+=this.DB,--Ct),hr)re[Zt].copyTo(X),hr=!1;else{for(;ie>1;)Y.sqrTo(X,Mt),Y.sqrTo(Mt,X),ie-=2;ie>0?Y.sqrTo(X,Mt):(Ke=X,X=Mt,Mt=Ke),Y.mulTo(Mt,re[Zt],X)}for(;Ct>=0&&(E[Ct]&1<<k)==0;)Y.sqrTo(X,Mt),Ke=X,X=Mt,Mt=Ke,--k<0&&(k=this.DB-1,--Ct)}return Y.revert(X)}function lr(E){var C=this.s<0?this.negate():this.clone(),k=E.s<0?E.negate():E.clone();if(C.compareTo(k)<0){var U=C;C=k,k=U}var X=C.getLowestSetBit(),Y=k.getLowestSetBit();if(Y<0)return C;for(X<Y&&(Y=X),Y>0&&(C.rShiftTo(Y,C),k.rShiftTo(Y,k));C.signum()>0;)(X=C.getLowestSetBit())>0&&C.rShiftTo(X,C),(X=k.getLowestSetBit())>0&&k.rShiftTo(X,k),C.compareTo(k)>=0?(C.subTo(k,C),C.rShiftTo(1,C)):(k.subTo(C,k),k.rShiftTo(1,k));return Y>0&&k.lShiftTo(Y,k),k}function za(E){if(E<=0)return 0;var C=this.DV%E,k=this.s<0?E-1:0;if(this.t>0)if(C==0)k=this[0]%E;else for(var U=this.t-1;U>=0;--U)k=(C*k+this[U])%E;return k}function Ka(E){var C=E.isEven();if(this.isEven()&&C||E.signum()==0)return a.ZERO;for(var k=E.clone(),U=this.clone(),X=m(1),Y=m(0),re=m(0),ie=m(1);k.signum()!=0;){for(;k.isEven();)k.rShiftTo(1,k),C?((!X.isEven()||!Y.isEven())&&(X.addTo(this,X),Y.subTo(E,Y)),X.rShiftTo(1,X)):Y.isEven()||Y.subTo(E,Y),Y.rShiftTo(1,Y);for(;U.isEven();)U.rShiftTo(1,U),C?((!re.isEven()||!ie.isEven())&&(re.addTo(this,re),ie.subTo(E,ie)),re.rShiftTo(1,re)):ie.isEven()||ie.subTo(E,ie),ie.rShiftTo(1,ie);k.compareTo(U)>=0?(k.subTo(U,k),C&&X.subTo(re,X),Y.subTo(ie,Y)):(U.subTo(k,U),C&&re.subTo(X,re),ie.subTo(Y,ie))}if(U.compareTo(a.ONE)!=0)return a.ZERO;if(ie.compareTo(E)>=0)return ie.subtract(E);if(ie.signum()<0)ie.addTo(E,ie);else return ie;return ie.signum()<0?ie.add(E):ie}var it=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Wa=(1<<26)/it[it.length-1];function Xa(E){var C,k=this.abs();if(k.t==1&&k[0]<=it[it.length-1]){for(C=0;C<it.length;++C)if(k[0]==it[C])return!0;return!1}if(k.isEven())return!1;for(C=1;C<it.length;){for(var U=it[C],X=C+1;X<it.length&&U<Wa;)U*=it[X++];for(U=k.modInt(U);C<X;)if(U%it[C++]==0)return!1}return k.millerRabin(E)}function Yn(E){var C=this.subtract(a.ONE),k=C.getLowestSetBit();if(k<=0)return!1;var U=C.shiftRight(k);E=E+1>>1,E>it.length&&(E=it.length);for(var X=s(),Y=0;Y<E;++Y){X.fromInt(it[Math.floor(Math.random()*it.length)]);var re=X.modPow(U,this);if(re.compareTo(a.ONE)!=0&&re.compareTo(C)!=0){for(var ie=1;ie++<k&&re.compareTo(C)!=0;)if(re=re.modPowInt(2,this),re.compareTo(a.ONE)==0)return!1;if(re.compareTo(C)!=0)return!1}}return!0}a.prototype.chunkSize=Qt,a.prototype.toRadix=gr,a.prototype.fromRadix=Ur,a.prototype.fromNumber=nn,a.prototype.bitwiseTo=ar,a.prototype.changeBit=ln,a.prototype.addTo=vr,a.prototype.dMultiply=mn,a.prototype.dAddOffset=or,a.prototype.multiplyLowerTo=yn,a.prototype.multiplyUpperTo=vn,a.prototype.modInt=za,a.prototype.millerRabin=Yn,a.prototype.clone=Et,a.prototype.intValue=jr,a.prototype.byteValue=Xt,a.prototype.shortValue=mr,a.prototype.signum=ht,a.prototype.toByteArray=an,a.prototype.equals=ir,a.prototype.min=Fr,a.prototype.max=qr,a.prototype.and=$r,a.prototype.or=sn,a.prototype.xor=Ot,a.prototype.andNot=yr,a.prototype.not=Vr,a.prototype.shiftLeft=dt,a.prototype.shiftRight=pt,a.prototype.getLowestSetBit=At,a.prototype.bitCount=cn,a.prototype.testBit=un,a.prototype.setBit=hn,a.prototype.clearBit=nt,a.prototype.flipBit=Yt,a.prototype.add=wr,a.prototype.subtract=_r,a.prototype.multiply=Jt,a.prototype.divide=dn,a.prototype.remainder=pn,a.prototype.divideAndRemainder=fn,a.prototype.modPow=Ji,a.prototype.modInverse=Ka,a.prototype.pow=bn,a.prototype.gcd=lr,a.prototype.isProbablePrime=Xa,a.prototype.square=Gt,a.prototype.Barrett=cr;var Jn,Tt,Fe;function Qa(E){Tt[Fe++]^=E&255,Tt[Fe++]^=E>>8&255,Tt[Fe++]^=E>>16&255,Tt[Fe++]^=E>>24&255,Fe>=ti&&(Fe-=ti)}function Zi(){Qa(new Date().getTime())}if(Tt==null){Tt=new Array,Fe=0;var $t;if(typeof window!="undefined"&&window.crypto){if(window.crypto.getRandomValues){var ea=new Uint8Array(32);for(window.crypto.getRandomValues(ea),$t=0;$t<32;++$t)Tt[Fe++]=ea[$t]}else if(navigator.appName=="Netscape"&&navigator.appVersion<"5"){var Rn=window.crypto.random(32);for($t=0;$t<Rn.length;++$t)Tt[Fe++]=Rn.charCodeAt($t)&255}}for(;Fe<ti;)$t=Math.floor(65536*Math.random()),Tt[Fe++]=$t>>>8,Tt[Fe++]=$t&255;Fe=0,Zi()}function Ci(){if(Jn==null){for(Zi(),Jn=Ja(),Jn.init(Tt),Fe=0;Fe<Tt.length;++Fe)Tt[Fe]=0;Fe=0}return Jn.next()}function Zn(E){var C;for(C=0;C<E.length;++C)E[C]=Ci()}function Ii(){}Ii.prototype.nextBytes=Zn;function ei(){this.i=0,this.j=0,this.S=new Array}function Ya(E){var C,k,U;for(C=0;C<256;++C)this.S[C]=C;for(k=0,C=0;C<256;++C)k=k+this.S[C]+E[C%E.length]&255,U=this.S[C],this.S[C]=this.S[k],this.S[k]=U;this.i=0,this.j=0}function Ri(){var E;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,E=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=E,this.S[E+this.S[this.i]&255]}ei.prototype.init=Ya,ei.prototype.next=Ri;function Ja(){return new ei}var ti=256;t=e.exports={default:a,BigInteger:a,SecureRandom:Ii}}).call(ge)}),Jr=le(function(e,t){var r=t.falseIfInvalid=function(n){return function(){return this.valid?n.apply(this,arguments):!1}};t.isInSubnet=r(function(n){return this.subnetMask<n.subnetMask?!1:this.mask(n.subnetMask)===n.mask()}),t.isCorrect=function(n){return r(function(){return this.addressMinusSuffix!==this.correctForm()?!1:this.subnetMask===n&&!this.parsedSubnet?!0:this.parsedSubnet===String(this.subnetMask)})}}),ys=le(function(e,t){!function(){var r={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function n(o){return a(c(o),arguments)}function i(o,u){return n.apply(null,[o].concat(u||[]))}function a(o,u){var l=1,f=o.length,_,p="",I,d,v,A,j,O,m,b;for(I=0;I<f;I++)if(typeof o[I]=="string")p+=o[I];else if(typeof o[I]=="object"){if(v=o[I],v.keys)for(_=u[l],d=0;d<v.keys.length;d++){if(_==null)throw new Error(n('[sprintf] Cannot access property "%s" of undefined value "%s"',v.keys[d],v.keys[d-1]));_=_[v.keys[d]]}else v.param_no?_=u[v.param_no]:_=u[l++];if(r.not_type.test(v.type)&&r.not_primitive.test(v.type)&&_ instanceof Function&&(_=_()),r.numeric_arg.test(v.type)&&typeof _!="number"&&isNaN(_))throw new TypeError(n("[sprintf] expecting number but found %T",_));r.number.test(v.type)&&(m=_>=0);switch(v.type){case"b":_=parseInt(_,10).toString(2);break;case"c":_=String.fromCharCode(parseInt(_,10));break;case"d":case"i":_=parseInt(_,10);break;case"j":_=JSON.stringify(_,null,v.width?parseInt(v.width):0);break;case"e":_=v.precision?parseFloat(_).toExponential(v.precision):parseFloat(_).toExponential();break;case"f":_=v.precision?parseFloat(_).toFixed(v.precision):parseFloat(_);break;case"g":_=v.precision?String(Number(_.toPrecision(v.precision))):parseFloat(_);break;case"o":_=(parseInt(_,10)>>>0).toString(8);break;case"s":_=String(_),_=v.precision?_.substring(0,v.precision):_;break;case"t":_=String(!!_),_=v.precision?_.substring(0,v.precision):_;break;case"T":_=Object.prototype.toString.call(_).slice(8,-1).toLowerCase(),_=v.precision?_.substring(0,v.precision):_;break;case"u":_=parseInt(_,10)>>>0;break;case"v":_=_.valueOf(),_=v.precision?_.substring(0,v.precision):_;break;case"x":_=(parseInt(_,10)>>>0).toString(16);break;case"X":_=(parseInt(_,10)>>>0).toString(16).toUpperCase();break}r.json.test(v.type)?p+=_:(r.number.test(v.type)&&(!m||v.sign)?(b=m?"+":"-",_=_.toString().replace(r.sign,"")):b="",j=v.pad_char?v.pad_char==="0"?"0":v.pad_char.charAt(1):" ",O=v.width-(b+_).length,A=v.width&&O>0?j.repeat(O):"",p+=v.align?b+_+A:j==="0"?b+A+_:A+b+_)}return p}var s=Object.create(null);function c(o){if(s[o])return s[o];for(var u=o,l,f=[],_=0;u;){if((l=r.text.exec(u))!==null)f.push(l[0]);else if((l=r.modulo.exec(u))!==null)f.push("%");else if((l=r.placeholder.exec(u))!==null){if(l[2]){_|=1;var p=[],I=l[2],d=[];if((d=r.key.exec(I))!==null)for(p.push(d[1]);(I=I.substring(d[0].length))!=="";)if((d=r.key_access.exec(I))!==null)p.push(d[1]);else if((d=r.index_access.exec(I))!==null)p.push(d[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");l[2]=p}else _|=2;if(_===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");f.push({placeholder:l[0],param_no:l[1],keys:l[2],sign:l[3],pad_char:l[4],align:l[5],width:l[6],precision:l[7],type:l[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");u=u.substring(l[0].length)}return s[o]=f}t.sprintf=n,t.vsprintf=i,typeof window!="undefined"&&(window.sprintf=n,window.vsprintf=i)}()}),Ou=1/0,JE=9007199254740991,ZE=17976931348623157e292,Dp=0/0,eS="[object Symbol]",tS=/^\s+|\s+$/g,rS=/^[-+]0x[0-9a-f]+$/i,nS=/^0b[01]+$/i,iS=/^0o[0-7]+$/i,Du="\\ud800-\\udfff",Mp="\\u0300-\\u036f\\ufe20-\\ufe23",xp="\\u20d0-\\u20f0",Bp="\\ufe0e\\ufe0f",aS="["+Du+"]",Mu="["+Mp+xp+"]",xu="\\ud83c[\\udffb-\\udfff]",sS="(?:"+Mu+"|"+xu+")",Lp="[^"+Du+"]",jp="(?:\\ud83c[\\udde6-\\uddff]){2}",Up="[\\ud800-\\udbff][\\udc00-\\udfff]",Fp="\\u200d",qp=sS+"?",Gp="["+Bp+"]?",oS="(?:"+Fp+"(?:"+[Lp,jp,Up].join("|")+")"+Gp+qp+")*",cS=Gp+qp+oS,uS="(?:"+[Lp+Mu+"?",Mu,jp,Up,aS].join("|")+")",Bu=RegExp(xu+"(?="+xu+")|"+uS+cS,"g"),lS=RegExp("["+Fp+Du+Mp+xp+Bp+"]"),hS=parseInt,dS=typeof ge=="object"&&ge&&ge.Object===Object&&ge,pS=typeof self=="object"&&self&&self.Object===Object&&self,fS=dS||pS||Function("return this")(),mS=bS("length");function gS(e){return e.split("")}function bS(e){return function(t){return t==null?void 0:t[e]}}function Lu(e){return lS.test(e)}function $p(e){return Lu(e)?vS(e):mS(e)}function yS(e){return Lu(e)?wS(e):gS(e)}function vS(e){for(var t=Bu.lastIndex=0;Bu.test(e);)t++;return t}function wS(e){return e.match(Bu)||[]}var _S=Object.prototype,ES=_S.toString,Vp=fS.Symbol,SS=Math.ceil,AS=Math.floor,Hp=Vp?Vp.prototype:void 0,zp=Hp?Hp.toString:void 0;function Kp(e,t){var r="";if(!e||t<1||t>JE)return r;do t%2&&(r+=e),t=AS(t/2),t&&(e+=e);while(t);return r}function TS(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),r=r>i?i:r,r<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var a=Array(i);++n<i;)a[n]=e[n+t];return a}function Wp(e){if(typeof e=="string")return e;if(Qp(e))return zp?zp.call(e):"";var t=e+"";return t=="0"&&1/e==-Ou?"-0":t}function CS(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:TS(e,t,r)}function IS(e,t){t=t===void 0?" ":Wp(t);var r=t.length;if(r<2)return r?Kp(t,e):t;var n=Kp(t,SS(e/$p(t)));return Lu(t)?CS(yS(n),0,e).join(""):n.slice(0,e)}function Xp(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function RS(e){return!!e&&typeof e=="object"}function Qp(e){return typeof e=="symbol"||RS(e)&&ES.call(e)==eS}function kS(e){if(!e)return e===0?e:0;if(e=NS(e),e===Ou||e===-Ou){var t=e<0?-1:1;return t*ZE}return e===e?e:0}function PS(e){var t=kS(e),r=t%1;return t===t?r?t-r:t:0}function NS(e){if(typeof e=="number")return e;if(Qp(e))return Dp;if(Xp(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Xp(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(tS,"");var r=nS.test(e);return r||iS.test(e)?hS(e.slice(2),r?2:8):rS.test(e)?Dp:+e}function OS(e){return e==null?"":Wp(e)}function DS(e,t,r){e=OS(e),t=PS(t);var n=t?$p(e):0;return t&&n<t?IS(t-n,r)+e:e}var vs=DS,ju=1/0,Uu=9007199254740991,MS=17976931348623157e292,Yp=0/0,xS="[object Function]",BS="[object GeneratorFunction]",LS="[object Symbol]",jS=/^\s+|\s+$/g,US=/^[-+]0x[0-9a-f]+$/i,FS=/^0b[01]+$/i,qS=/^0o[0-7]+$/i,GS=/^(?:0|[1-9]\d*)$/,$S=parseInt,VS=typeof ge=="object"&&ge&&ge.Object===Object&&ge,HS=typeof self=="object"&&self&&self.Object===Object&&self,zS=VS||HS||Function("return this")(),KS=Object.prototype,Jp=KS.toString,Zp=zS.Symbol,WS=Math.floor,ef=Zp?Zp.prototype:void 0,tf=ef?ef.toString:void 0;function XS(e,t){var r="";if(!e||t<1||t>Uu)return r;do t%2&&(r+=e),t=WS(t/2),t&&(e+=e);while(t);return r}function QS(e){if(typeof e=="string")return e;if(rf(e))return tf?tf.call(e):"";var t=e+"";return t=="0"&&1/e==-ju?"-0":t}function YS(e,t){return t=t??Uu,!!t&&(typeof e=="number"||GS.test(e))&&(e>-1&&e%1==0)&&e<t}function JS(e,t,r){if(!Do(r))return!1;var n=typeof t;return(n=="number"?e1(r)&&YS(t,r.length):n=="string"&&t in r)?ZS(r[t],e):!1}function ZS(e,t){return e===t||e!==e&&t!==t}function e1(e){return e!=null&&r1(e.length)&&!t1(e)}function t1(e){var t=Do(e)?Jp.call(e):"";return t==xS||t==BS}function r1(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Uu}function Do(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function n1(e){return!!e&&typeof e=="object"}function rf(e){return typeof e=="symbol"||n1(e)&&Jp.call(e)==LS}function i1(e){if(!e)return e===0?e:0;if(e=s1(e),e===ju||e===-ju){var t=e<0?-1:1;return t*MS}return e===e?e:0}function a1(e){var t=i1(e),r=t%1;return t===t?r?t-r:t:0}function s1(e){if(typeof e=="number")return e;if(rf(e))return Yp;if(Do(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Do(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(jS,"");var r=FS.test(e);return r||qS.test(e)?$S(e.slice(2),r?2:8):US.test(e)?Yp:+e}function o1(e){return e==null?"":QS(e)}function c1(e,t,r){return(r?JS(e,t,r):t===void 0)?t=1:t=a1(t),XS(o1(e),t)}var Mo=c1,u1=32,l1=4,h1=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/g,d1=/\/\d{1,2}$/,Kt={BITS:u1,GROUPS:l1,RE_ADDRESS:h1,RE_SUBNET_STRING:d1},ws=Op.BigInteger,xo=ys.sprintf;function Ue(e){this.valid=!1,this.address=e,this.groups=Kt.GROUPS,this.v4=!0,this.subnet="/32",this.subnetMask=32;var t=Kt.RE_SUBNET_STRING.exec(e);if(t){if(this.parsedSubnet=t[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,this.subnetMask<0||this.subnetMask>Kt.BITS){this.valid=!1,this.error="Invalid subnet mask.";return}e=e.replace(Kt.RE_SUBNET_STRING,"")}this.addressMinusSuffix=e,this.parsedAddress=this.parse(e)}Ue.prototype.parse=function(e){var t=e.split(".");return e.match(Kt.RE_ADDRESS)?this.valid=!0:this.error="Invalid IPv4 address.",t},Ue.prototype.isValid=function(){return this.valid},Ue.prototype.correctForm=function(){return this.parsedAddress.map(function(e){return parseInt(e,10)}).join(".")},Ue.prototype.isCorrect=Jr.isCorrect(Kt.BITS),Ue.fromHex=function(e){var t=vs(e.replace(/:/g,""),8,"0"),r=[],n;for(n=0;n<8;n+=2){var i=t.slice(n,n+2);r.push(parseInt(i,16))}return new Ue(r.join("."))},Ue.fromInteger=function(e){return Ue.fromHex(e.toString(16))},Ue.prototype.toHex=function(){return this.parsedAddress.map(function(e){return xo("%02x",parseInt(e,10))}).join(":")},Ue.prototype.toArray=function(){return this.parsedAddress.map(function(e){return parseInt(e,10)})},Ue.prototype.toGroup6=function(){var e=[],t;for(t=0;t<Kt.GROUPS;t+=2){var r=xo("%02x%02x",parseInt(this.parsedAddress[t],10),parseInt(this.parsedAddress[t+1],10));e.push(xo("%x",parseInt(r,16)))}return e.join(":")},Ue.prototype.bigInteger=function(){return this.valid?new ws(this.parsedAddress.map(function(e){return xo("%02x",parseInt(e,10))}).join(""),16):null},Ue.prototype._startAddress=function(){return new ws(this.mask()+Mo("0",Kt.BITS-this.subnetMask),2)},Ue.prototype.startAddress=function(){return Ue.fromBigInteger(this._startAddress())},Ue.prototype.startAddressExclusive=function(){var e=new ws("1");return Ue.fromBigInteger(this._startAddress().add(e))},Ue.prototype._endAddress=function(){return new ws(this.mask()+Mo("1",Kt.BITS-this.subnetMask),2)},Ue.prototype.endAddress=function(){return Ue.fromBigInteger(this._endAddress())},Ue.prototype.endAddressExclusive=function(){var e=new ws("1");return Ue.fromBigInteger(this._endAddress().subtract(e))},Ue.fromBigInteger=function(e){return Ue.fromInteger(parseInt(e.toString(),10))},Ue.prototype.mask=function(e){return e===void 0&&(e=this.subnetMask),this.getBitsBase2(0,e)},Ue.prototype.getBitsBase2=function(e,t){return this.binaryZeroPad().slice(e,t)},Ue.prototype.isInSubnet=Jr.isInSubnet,Ue.prototype.isMulticast=function(){return this.isInSubnet(new Ue("224.0.0.0/4"))},Ue.prototype.binaryZeroPad=function(){return vs(this.bigInteger().toString(2),Kt.BITS,"0")};var Ui=Ue,Fu=le(function(e,t){var r=200,n="__lodash_hash_undefined__",i=800,a=16,s=9007199254740991,c="[object Arguments]",o="[object Array]",u="[object AsyncFunction]",l="[object Boolean]",f="[object Date]",_="[object Error]",p="[object Function]",I="[object GeneratorFunction]",d="[object Map]",v="[object Number]",A="[object Null]",j="[object Object]",O="[object Proxy]",m="[object RegExp]",b="[object Set]",S="[object String]",h="[object Undefined]",g="[object WeakMap]",w="[object ArrayBuffer]",y="[object DataView]",P="[object Float32Array]",D="[object Float64Array]",L="[object Int8Array]",x="[object Int16Array]",B="[object Int32Array]",G="[object Uint8Array]",V="[object Uint8ClampedArray]",K="[object Uint16Array]",ae="[object Uint32Array]",se=/[\\^$.*+?()[\]{}|]/g,ve=/^\[object .+?Constructor\]$/,fe=/^(?:0|[1-9]\d*)$/,me={};me[P]=me[D]=me[L]=me[x]=me[B]=me[G]=me[V]=me[K]=me[ae]=!0,me[c]=me[o]=me[w]=me[l]=me[y]=me[f]=me[_]=me[p]=me[d]=me[v]=me[j]=me[m]=me[b]=me[S]=me[g]=!1;var pe=typeof ge=="object"&&ge&&ge.Object===Object&&ge,R=typeof self=="object"&&self&&self.Object===Object&&self,W=pe||R||Function("return this")(),Q=t&&!t.nodeType&&t,Z=Q&&!0&&e&&!e.nodeType&&e,ne=Z&&Z.exports===Q,ce=ne&&pe.process,de=function(){try{var N=Z&&Z.require&&Z.require("util").types;return N||ce&&ce.binding&&ce.binding("util")}catch(F){}}(),oe=de&&de.isTypedArray;function Se(N,F,H){switch(H.length){case 0:return N.call(F);case 1:return N.call(F,H[0]);case 2:return N.call(F,H[0],H[1]);case 3:return N.call(F,H[0],H[1],H[2])}return N.apply(F,H)}function J(N,F){for(var H=-1,ue=Array(N);++H<N;)ue[H]=F(H);return ue}function $e(N){return function(F){return N(F)}}function Lr(N,F){return N==null?void 0:N[F]}function rn(N,F){return function(H){return N(F(H))}}var Et=Array.prototype,jr=Function.prototype,Xt=Object.prototype,mr=W["__core-js_shared__"],Qt=jr.toString,ht=Xt.hasOwnProperty,gr=function(){var N=/[^.]+$/.exec(mr&&mr.keys&&mr.keys.IE_PROTO||"");return N?"Symbol(src)_1."+N:""}(),Ur=Xt.toString,nn=Qt.call(Object),an=RegExp("^"+Qt.call(ht).replace(se,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ir=ne?W.Buffer:void 0,Fr=W.Symbol,qr=W.Uint8Array,ar=ir?ir.allocUnsafe:void 0,Gr=rn(Object.getPrototypeOf,Object),$r=Object.create,br=Xt.propertyIsEnumerable,sn=Et.splice,St=Fr?Fr.toStringTag:void 0,Ot=function(){try{var N=Ci(Object,"defineProperty");return N({},"",{}),N}catch(F){}}(),sr=ir?ir.isBuffer:void 0,yr=Math.max,Vr=Date.now,dt=Ci(W,"Map"),pt=Ci(Object,"create"),on=function(){function N(){}return function(F){if(!Ke(F))return{};if($r)return $r(F);N.prototype=F;var H=new N;return N.prototype=void 0,H}}();function At(N){var F=-1,H=N==null?0:N.length;for(this.clear();++F<H;){var ue=N[F];this.set(ue[0],ue[1])}}function Hr(){this.__data__=pt?pt(null):{},this.size=0}function cn(N){var F=this.has(N)&&delete this.__data__[N];return this.size-=F?1:0,F}function un(N){var F=this.__data__;if(pt){var H=F[N];return H===n?void 0:H}return ht.call(F,N)?F[N]:void 0}function ln(N){var F=this.__data__;return pt?F[N]!==void 0:ht.call(F,N)}function hn(N,F){var H=this.__data__;return this.size+=this.has(N)?0:1,H[N]=pt&&F===void 0?n:F,this}At.prototype.clear=Hr,At.prototype.delete=cn,At.prototype.get=un,At.prototype.has=ln,At.prototype.set=hn;function nt(N){var F=-1,H=N==null?0:N.length;for(this.clear();++F<H;){var ue=N[F];this.set(ue[0],ue[1])}}function Yt(){this.__data__=[],this.size=0}function vr(N){var F=this.__data__,H=Xn(F,N);if(H<0)return!1;var ue=F.length-1;return H==ue?F.pop():sn.call(F,H,1),--this.size,!0}function wr(N){var F=this.__data__,H=Xn(F,N);return H<0?void 0:F[H][1]}function _r(N){return Xn(this.__data__,N)>-1}function Jt(N,F){var H=this.__data__,ue=Xn(H,N);return ue<0?(++this.size,H.push([N,F])):H[ue][1]=F,this}nt.prototype.clear=Yt,nt.prototype.delete=vr,nt.prototype.get=wr,nt.prototype.has=_r,nt.prototype.set=Jt;function Gt(N){var F=-1,H=N==null?0:N.length;for(this.clear();++F<H;){var ue=N[F];this.set(ue[0],ue[1])}}function dn(){this.size=0,this.__data__={hash:new At,map:new(dt||nt),string:new At}}function pn(N){var F=Rn(this,N).delete(N);return this.size-=F?1:0,F}function fn(N){return Rn(this,N).get(N)}function mn(N){return Rn(this,N).has(N)}function or(N,F){var H=Rn(this,N),ue=H.size;return H.set(N,F),this.size+=H.size==ue?0:1,this}Gt.prototype.clear=dn,Gt.prototype.delete=pn,Gt.prototype.get=fn,Gt.prototype.has=mn,Gt.prototype.set=or;function rt(N){var F=this.__data__=new nt(N);this.size=F.size}function Er(){this.__data__=new nt,this.size=0}function Dt(N){var F=this.__data__,H=F.delete(N);return this.size=F.size,H}function gn(N){return this.__data__.get(N)}function bn(N){return this.__data__.has(N)}function yn(N,F){var H=this.__data__;if(H instanceof nt){var ue=H.__data__;if(!dt||ue.length<r-1)return ue.push([N,F]),this.size=++H.size,this;H=this.__data__=new Gt(ue)}return H.set(N,F),this.size=H.size,this}rt.prototype.clear=Er,rt.prototype.delete=Dt,rt.prototype.get=gn,rt.prototype.has=bn,rt.prototype.set=yn;function vn(N,F){var H=Ye(N),ue=!H&&De(N),Re=!H&&!ue&&Zt(N),je=!H&&!ue&&!Re&&kn(N),He=H||ue||Re||je,Ce=He?J(N.length,String):[],Me=Ce.length;for(var xt in N)(F||ht.call(N,xt))&&!(He&&(xt=="length"||Re&&(xt=="offset"||xt=="parent")||je&&(xt=="buffer"||xt=="byteLength"||xt=="byteOffset")||ei(xt,Me)))&&Ce.push(xt);return Ce}function cr(N,F,H){(H!==void 0&&!ie(N[F],H)||H===void 0&&!(F in N))&&Ti(N,F,H)}function ur(N,F,H){var ue=N[F];(!(ht.call(N,F)&&ie(ue,H))||H===void 0&&!(F in N))&&Ti(N,F,H)}function Xn(N,F){for(var H=N.length;H--;)if(ie(N[H][0],F))return H;return-1}function Ti(N,F,H){F=="__proto__"&&Ot?Ot(N,F,{configurable:!0,enumerable:!0,value:H,writable:!0}):N[F]=H}var Ha=ea();function Qn(N){return N==null?N===void 0?h:A:St&&St in Object(N)?Zn(N):C(N)}function Ji(N){return mt(N)&&Qn(N)==c}function lr(N){if(!Ke(N)||Ja(N))return!1;var F=hr(N)?an:ve;return F.test(re(N))}function za(N){return mt(N)&&Mt(N.length)&&!!me[Qn(N)]}function Ka(N){if(!Ke(N))return E(N);var F=ti(N),H=[];for(var ue in N)ue=="constructor"&&(F||!ht.call(N,ue))||H.push(ue);return H}function it(N,F,H,ue,Re){if(N===F)return;Ha(F,function(je,He){if(Re||(Re=new rt),Ke(je))Wa(N,F,He,H,it,ue,Re);else{var Ce=ue?ue(U(N,He),je,He+"",N,F,Re):void 0;Ce===void 0&&(Ce=je),cr(N,He,Ce)}},zs)}function Wa(N,F,H,ue,Re,je,He){var Ce=U(N,H),Me=U(F,H),xt=He.get(Me);if(xt){cr(N,H,xt);return}var Vt=je?je(Ce,Me,H+"",N,F,He):void 0,ri=Vt===void 0;if(ri){var ki=Ye(Me),wn=!ki&&Zt(Me),Pi=!ki&&!wn&&kn(Me);Vt=Me,ki||wn||Pi?Ye(Ce)?Vt=Ce:Ct(Ce)?Vt=Qa(Ce):wn?(ri=!1,Vt=Jn(Me,!0)):Pi?(ri=!1,Vt=Fe(Me,!0)):Vt=[]:Sr(Me)||De(Me)?(Vt=Ce,De(Ce)?Vt=ta(Ce):(!Ke(Ce)||hr(Ce))&&(Vt=Ii(Me))):ri=!1}ri&&(He.set(Me,Vt),Re(Vt,Me,ue,je,He),He.delete(Me)),cr(N,H,Vt)}function Xa(N,F){return X(k(N,F,Za),N+"")}var Yn=Ot?function(N,F){return Ot(N,"toString",{configurable:!0,enumerable:!1,value:Ec(F),writable:!0})}:Za;function Jn(N,F){if(F)return N.slice();var H=N.length,ue=ar?ar(H):new N.constructor(H);return N.copy(ue),ue}function Tt(N){var F=new N.constructor(N.byteLength);return new qr(F).set(new qr(N)),F}function Fe(N,F){var H=F?Tt(N.buffer):N.buffer;return new N.constructor(H,N.byteOffset,N.length)}function Qa(N,F){var H=-1,ue=N.length;for(F||(F=Array(ue));++H<ue;)F[H]=N[H];return F}function Zi(N,F,H,ue){var Re=!H;H||(H={});for(var je=-1,He=F.length;++je<He;){var Ce=F[je],Me=ue?ue(H[Ce],N[Ce],Ce,H,N):void 0;Me===void 0&&(Me=N[Ce]),Re?Ti(H,Ce,Me):ur(H,Ce,Me)}return H}function $t(N){return Xa(function(F,H){var ue=-1,Re=H.length,je=Re>1?H[Re-1]:void 0,He=Re>2?H[2]:void 0;for(je=N.length>3&&typeof je=="function"?(Re--,je):void 0,He&&Ya(H[0],H[1],He)&&(je=Re<3?void 0:je,Re=1),F=Object(F);++ue<Re;){var Ce=H[ue];Ce&&N(F,Ce,ue,je)}return F})}function ea(N){return function(F,H,ue){for(var Re=-1,je=Object(F),He=ue(F),Ce=He.length;Ce--;){var Me=He[N?Ce:++Re];if(H(je[Me],Me,je)===!1)break}return F}}function Rn(N,F){var H=N.__data__;return Ri(F)?H[typeof F=="string"?"string":"hash"]:H.map}function Ci(N,F){var H=Lr(N,F);return lr(H)?H:void 0}function Zn(N){var F=ht.call(N,St),H=N[St];try{N[St]=void 0;var ue=!0}catch(je){}var Re=Ur.call(N);return ue&&(F?N[St]=H:delete N[St]),Re}function Ii(N){return typeof N.constructor=="function"&&!ti(N)?on(Gr(N)):{}}function ei(N,F){var H=typeof N;return F=F??s,!!F&&(H=="number"||H!="symbol"&&fe.test(N))&&(N>-1&&N%1==0)&&N<F}function Ya(N,F,H){if(!Ke(H))return!1;var ue=typeof F;return(ue=="number"?ft(H)&&ei(F,H.length):ue=="string"&&F in H)?ie(H[F],N):!1}function Ri(N){var F=typeof N;return F=="string"||F=="number"||F=="symbol"||F=="boolean"?N!=="__proto__":N===null}function Ja(N){return!!gr&&gr in N}function ti(N){var F=N&&N.constructor,H=typeof F=="function"&&F.prototype||Xt;return N===H}function E(N){var F=[];if(N!=null)for(var H in Object(N))F.push(H);return F}function C(N){return Ur.call(N)}function k(N,F,H){return F=yr(F===void 0?N.length-1:F,0),function(){for(var ue=arguments,Re=-1,je=yr(ue.length-F,0),He=Array(je);++Re<je;)He[Re]=ue[F+Re];Re=-1;for(var Ce=Array(F+1);++Re<F;)Ce[Re]=ue[Re];return Ce[F]=H(He),Se(N,this,Ce)}}function U(N,F){return F==="constructor"&&typeof N[F]=="function"||F=="__proto__"?void 0:N[F]}var X=Y(Yn);function Y(N){var F=0,H=0;return function(){var ue=Vr(),Re=a-(ue-H);if(H=ue,Re>0){if(++F>=i)return arguments[0]}else F=0;return N.apply(void 0,arguments)}}function re(N){if(N!=null){try{return Qt.call(N)}catch(F){}try{return N+""}catch(F){}}return""}function ie(N,F){return N===F||N!==N&&F!==F}var De=Ji(function(){return arguments}())?Ji:function(N){return mt(N)&&ht.call(N,"callee")&&!br.call(N,"callee")},Ye=Array.isArray;function ft(N){return N!=null&&Mt(N.length)&&!hr(N)}function Ct(N){return mt(N)&&ft(N)}var Zt=sr||Ks;function hr(N){if(!Ke(N))return!1;var F=Qn(N);return F==p||F==I||F==u||F==O}function Mt(N){return typeof N=="number"&&N>-1&&N%1==0&&N<=s}function Ke(N){var F=typeof N;return N!=null&&(F=="object"||F=="function")}function mt(N){return N!=null&&typeof N=="object"}function Sr(N){if(!mt(N)||Qn(N)!=j)return!1;var F=Gr(N);if(F===null)return!0;var H=ht.call(F,"constructor")&&F.constructor;return typeof H=="function"&&H instanceof H&&Qt.call(H)==nn}var kn=oe?$e(oe):za;function ta(N){return Zi(N,zs(N))}function zs(N){return ft(N)?vn(N,!0):Ka(N)}var _c=$t(function(N,F,H){it(N,F,H)});function Ec(N){return function(){return N}}function Za(N){return N}function Ks(){return!1}e.exports=_c}),p1=le(function(e,t){var r=200,n="Expected a function",i="__lodash_hash_undefined__",a=1,s=2,c=1/0,o=9007199254740991,u=17976931348623157e292,l=0/0,f="[object Arguments]",_="[object Array]",p="[object Boolean]",I="[object Date]",d="[object Error]",v="[object Function]",A="[object GeneratorFunction]",j="[object Map]",O="[object Number]",m="[object Object]",b="[object Promise]",S="[object RegExp]",h="[object Set]",g="[object String]",w="[object Symbol]",y="[object WeakMap]",P="[object ArrayBuffer]",D="[object DataView]",L="[object Float32Array]",x="[object Float64Array]",B="[object Int8Array]",G="[object Int16Array]",V="[object Int32Array]",K="[object Uint8Array]",ae="[object Uint8ClampedArray]",se="[object Uint16Array]",ve="[object Uint32Array]",fe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,me=/^\w*$/,pe=/^\./,R=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,W=/[\\^$.*+?()[\]{}|]/g,Q=/^\s+|\s+$/g,Z=/\\(\\)?/g,ne=/^[-+]0x[0-9a-f]+$/i,ce=/^0b[01]+$/i,de=/^\[object .+?Constructor\]$/,oe=/^0o[0-7]+$/i,Se=/^(?:0|[1-9]\d*)$/,J={};J[L]=J[x]=J[B]=J[G]=J[V]=J[K]=J[ae]=J[se]=J[ve]=!0,J[f]=J[_]=J[P]=J[p]=J[D]=J[I]=J[d]=J[v]=J[j]=J[O]=J[m]=J[S]=J[h]=J[g]=J[y]=!1;var $e=parseInt,Lr=typeof ge=="object"&&ge&&ge.Object===Object&&ge,rn=typeof self=="object"&&self&&self.Object===Object&&self,Et=Lr||rn||Function("return this")(),jr=t&&!t.nodeType&&t,Xt=jr&&!0&&e&&!e.nodeType&&e,mr=Xt&&Xt.exports===jr,Qt=mr&&Lr.process,ht=function(){try{return Qt&&Qt.binding("util")}catch(T){}}(),gr=ht&&ht.isTypedArray;function Ur(T,M){for(var z=-1,ee=T?T.length:0;++z<ee;)if(M(T[z],z,T))return!0;return!1}function nn(T,M,z,ee){for(var ye=T.length,he=z+(ee?1:-1);ee?he--:++he<ye;)if(M(T[he],he,T))return he;return-1}function an(T){return function(M){return M==null?void 0:M[T]}}function ir(T,M){for(var z=-1,ee=Array(T);++z<T;)ee[z]=M(z);return ee}function Fr(T){return function(M){return T(M)}}function qr(T,M){return T==null?void 0:T[M]}function ar(T){var M=!1;if(T!=null&&typeof T.toString!="function")try{M=!!(T+"")}catch(z){}return M}function Gr(T){var M=-1,z=Array(T.size);return T.forEach(function(ee,ye){z[++M]=[ye,ee]}),z}function $r(T,M){return function(z){return T(M(z))}}function br(T){var M=-1,z=Array(T.size);return T.forEach(function(ee){z[++M]=ee}),z}var sn=Array.prototype,St=Function.prototype,Ot=Object.prototype,sr=Et["__core-js_shared__"],yr=function(){var T=/[^.]+$/.exec(sr&&sr.keys&&sr.keys.IE_PROTO||"");return T?"Symbol(src)_1."+T:""}(),Vr=St.toString,dt=Ot.hasOwnProperty,pt=Ot.toString,on=RegExp("^"+Vr.call(dt).replace(W,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),At=Et.Symbol,Hr=Et.Uint8Array,cn=Ot.propertyIsEnumerable,un=sn.splice,ln=$r(Object.keys,Object),hn=Math.max,nt=Ke(Et,"DataView"),Yt=Ke(Et,"Map"),vr=Ke(Et,"Promise"),wr=Ke(Et,"Set"),_r=Ke(Et,"WeakMap"),Jt=Ke(Object,"create"),Gt=H(nt),dn=H(Yt),pn=H(vr),fn=H(wr),mn=H(_r),or=At?At.prototype:void 0,rt=or?or.valueOf:void 0,Er=or?or.toString:void 0;function Dt(T){var M=-1,z=T?T.length:0;for(this.clear();++M<z;){var ee=T[M];this.set(ee[0],ee[1])}}function gn(){this.__data__=Jt?Jt(null):{}}function bn(T){return this.has(T)&&delete this.__data__[T]}function yn(T){var M=this.__data__;if(Jt){var z=M[T];return z===i?void 0:z}return dt.call(M,T)?M[T]:void 0}function vn(T){var M=this.__data__;return Jt?M[T]!==void 0:dt.call(M,T)}function cr(T,M){var z=this.__data__;return z[T]=Jt&&M===void 0?i:M,this}Dt.prototype.clear=gn,Dt.prototype.delete=bn,Dt.prototype.get=yn,Dt.prototype.has=vn,Dt.prototype.set=cr;function ur(T){var M=-1,z=T?T.length:0;for(this.clear();++M<z;){var ee=T[M];this.set(ee[0],ee[1])}}function Xn(){this.__data__=[]}function Ti(T){var M=this.__data__,z=Zn(M,T);if(z<0)return!1;var ee=M.length-1;return z==ee?M.pop():un.call(M,z,1),!0}function Ha(T){var M=this.__data__,z=Zn(M,T);return z<0?void 0:M[z][1]}function Qn(T){return Zn(this.__data__,T)>-1}function Ji(T,M){var z=this.__data__,ee=Zn(z,T);return ee<0?z.push([T,M]):z[ee][1]=M,this}ur.prototype.clear=Xn,ur.prototype.delete=Ti,ur.prototype.get=Ha,ur.prototype.has=Qn,ur.prototype.set=Ji;function lr(T){var M=-1,z=T?T.length:0;for(this.clear();++M<z;){var ee=T[M];this.set(ee[0],ee[1])}}function za(){this.__data__={hash:new Dt,map:new(Yt||ur),string:new Dt}}function Ka(T){return hr(this,T).delete(T)}function it(T){return hr(this,T).get(T)}function Wa(T){return hr(this,T).has(T)}function Xa(T,M){return hr(this,T).set(T,M),this}lr.prototype.clear=za,lr.prototype.delete=Ka,lr.prototype.get=it,lr.prototype.has=Wa,lr.prototype.set=Xa;function Yn(T){var M=-1,z=T?T.length:0;for(this.__data__=new lr;++M<z;)this.add(T[M])}function Jn(T){return this.__data__.set(T,i),this}function Tt(T){return this.__data__.has(T)}Yn.prototype.add=Yn.prototype.push=Jn,Yn.prototype.has=Tt;function Fe(T){this.__data__=new ur(T)}function Qa(){this.__data__=new ur}function Zi(T){return this.__data__.delete(T)}function $t(T){return this.__data__.get(T)}function ea(T){return this.__data__.has(T)}function Rn(T,M){var z=this.__data__;if(z instanceof ur){var ee=z.__data__;if(!Yt||ee.length<r-1)return ee.push([T,M]),this;z=this.__data__=new lr(ee)}return z.set(T,M),this}Fe.prototype.clear=Qa,Fe.prototype.delete=Zi,Fe.prototype.get=$t,Fe.prototype.has=ea,Fe.prototype.set=Rn;function Ci(T,M){var z=Me(T)||Ce(T)?ir(T.length,String):[],ee=z.length,ye=!!ee;for(var he in T)(M||dt.call(T,he))&&!(ye&&(he=="length"||kn(he,ee)))&&z.push(he);return z}function Zn(T,M){for(var z=T.length;z--;)if(He(T[z][0],M))return z;return-1}function Ii(T,M){M=ta(M,T)?[M]:De(M);for(var z=0,ee=M.length;T!=null&&z<ee;)T=T[F(M[z++])];return z&&z==ee?T:void 0}function ei(T){return pt.call(T)}function Ya(T,M){return T!=null&&M in Object(T)}function Ri(T,M,z,ee,ye){return T===M?!0:T==null||M==null||!wn(T)&&!Pi(M)?T!==T&&M!==M:Ja(T,M,Ri,z,ee,ye)}function Ja(T,M,z,ee,ye,he){var Ge=Me(T),We=Me(M),at=_,yt=_;Ge||(at=mt(T),at=at==f?m:at),We||(yt=mt(M),yt=yt==f?m:yt);var Ht=at==m&&!ar(T),er=yt==m&&!ar(M),vt=at==yt;if(vt&&!Ht)return he||(he=new Fe),Ge||fg(T)?ft(T,M,z,ee,ye,he):Ct(T,M,at,z,ee,ye,he);if(!(ye&s)){var Ar=Ht&&dt.call(T,"__wrapped__"),Tr=er&&dt.call(M,"__wrapped__");if(Ar||Tr){var ni=Ar?T.value():T,Pn=Tr?M.value():M;return he||(he=new Fe),z(ni,Pn,ee,ye,he)}}return vt?(he||(he=new Fe),Zt(T,M,z,ee,ye,he)):!1}function ti(T,M,z,ee){var ye=z.length,he=ye,Ge=!ee;if(T==null)return!he;for(T=Object(T);ye--;){var We=z[ye];if(Ge&&We[2]?We[1]!==T[We[0]]:!(We[0]in T))return!1}for(;++ye<he;){We=z[ye];var at=We[0],yt=T[at],Ht=We[1];if(Ge&&We[2]){if(yt===void 0&&!(at in T))return!1}else{var er=new Fe;if(ee)var vt=ee(yt,Ht,at,T,M,er);if(!(vt===void 0?Ri(Ht,yt,ee,a|s,er):vt))return!1}}return!0}function E(T){if(!wn(T)||_c(T))return!1;var M=ri(T)||ar(T)?on:de;return M.test(H(T))}function C(T){return Pi(T)&&ki(T.length)&&!!J[pt.call(T)]}function k(T){return typeof T=="function"?T:T==null?_g:typeof T=="object"?Me(T)?Y(T[0],T[1]):X(T):Eg(T)}function U(T){if(!Ec(T))return ln(T);var M=[];for(var z in Object(T))dt.call(T,z)&&z!="constructor"&&M.push(z);return M}function X(T){var M=Mt(T);return M.length==1&&M[0][2]?Ks(M[0][0],M[0][1]):function(z){return z===T||ti(z,T,M)}}function Y(T,M){return ta(T)&&Za(M)?Ks(F(T),M):function(z){var ee=vg(z,T);return ee===void 0&&ee===M?wg(z,T):Ri(M,ee,void 0,a|s)}}function re(T){return function(M){return Ii(M,T)}}function ie(T){if(typeof T=="string")return T;if(Ws(T))return Er?Er.call(T):"";var M=T+"";return M=="0"&&1/T==-c?"-0":M}function De(T){return Me(T)?T:N(T)}function Ye(T){return function(M,z,ee){var ye=Object(M);if(!xt(M)){var he=k(z);M=Xs(M),z=function(We){return he(ye[We],We,ye)}}var Ge=T(M,z,ee);return Ge>-1?ye[he?M[Ge]:Ge]:void 0}}function ft(T,M,z,ee,ye,he){var Ge=ye&s,We=T.length,at=M.length;if(We!=at&&!(Ge&&at>We))return!1;var yt=he.get(T);if(yt&&he.get(M))return yt==M;var Ht=-1,er=!0,vt=ye&a?new Yn:void 0;for(he.set(T,M),he.set(M,T);++Ht<We;){var Ar=T[Ht],Tr=M[Ht];if(ee)var ni=Ge?ee(Tr,Ar,Ht,M,T,he):ee(Ar,Tr,Ht,T,M,he);if(ni!==void 0){if(ni)continue;er=!1;break}if(vt){if(!Ur(M,function(Pn,Ni){if(!vt.has(Ni)&&(Ar===Pn||z(Ar,Pn,ee,ye,he)))return vt.add(Ni)})){er=!1;break}}else if(!(Ar===Tr||z(Ar,Tr,ee,ye,he))){er=!1;break}}return he.delete(T),he.delete(M),er}function Ct(T,M,z,ee,ye,he,Ge){switch(z){case D:if(T.byteLength!=M.byteLength||T.byteOffset!=M.byteOffset)return!1;T=T.buffer,M=M.buffer;case P:return!(T.byteLength!=M.byteLength||!ee(new Hr(T),new Hr(M)));case p:case I:case O:return He(+T,+M);case d:return T.name==M.name&&T.message==M.message;case S:case g:return T==M+"";case j:var We=Gr;case h:var at=he&s;if(We||(We=br),T.size!=M.size&&!at)return!1;var yt=Ge.get(T);if(yt)return yt==M;he|=a,Ge.set(T,M);var Ht=ft(We(T),We(M),ee,ye,he,Ge);return Ge.delete(T),Ht;case w:if(rt)return rt.call(T)==rt.call(M)}return!1}function Zt(T,M,z,ee,ye,he){var Ge=ye&s,We=Xs(T),at=We.length,yt=Xs(M),Ht=yt.length;if(at!=Ht&&!Ge)return!1;for(var er=at;er--;){var vt=We[er];if(!(Ge?vt in M:dt.call(M,vt)))return!1}var Ar=he.get(T);if(Ar&&he.get(M))return Ar==M;var Tr=!0;he.set(T,M),he.set(M,T);for(var ni=Ge;++er<at;){vt=We[er];var Pn=T[vt],Ni=M[vt];if(ee)var Vl=Ge?ee(Ni,Pn,vt,M,T,he):ee(Pn,Ni,vt,T,M,he);if(!(Vl===void 0?Pn===Ni||z(Pn,Ni,ee,ye,he):Vl)){Tr=!1;break}ni||(ni=vt=="constructor")}if(Tr&&!ni){var Qs=T.constructor,Ys=M.constructor;Qs!=Ys&&"constructor"in T&&"constructor"in M&&!(typeof Qs=="function"&&Qs instanceof Qs&&typeof Ys=="function"&&Ys instanceof Ys)&&(Tr=!1)}return he.delete(T),he.delete(M),Tr}function hr(T,M){var z=T.__data__;return zs(M)?z[typeof M=="string"?"string":"hash"]:z.map}function Mt(T){for(var M=Xs(T),z=M.length;z--;){var ee=M[z],ye=T[ee];M[z]=[ee,ye,Za(ye)]}return M}function Ke(T,M){var z=qr(T,M);return E(z)?z:void 0}var mt=ei;(nt&&mt(new nt(new ArrayBuffer(1)))!=D||Yt&&mt(new Yt)!=j||vr&&mt(vr.resolve())!=b||wr&&mt(new wr)!=h||_r&&mt(new _r)!=y)&&(mt=function(T){var M=pt.call(T),z=M==m?T.constructor:void 0,ee=z?H(z):void 0;if(ee)switch(ee){case Gt:return D;case dn:return j;case pn:return b;case fn:return h;case mn:return y}return M});function Sr(T,M,z){M=ta(M,T)?[M]:De(M);for(var ee,ye=-1,he=M.length;++ye<he;){var Ge=F(M[ye]);if(!(ee=T!=null&&z(T,Ge)))break;T=T[Ge]}if(ee)return ee;var he=T?T.length:0;return!!he&&ki(he)&&kn(Ge,he)&&(Me(T)||Ce(T))}function kn(T,M){return M=M??o,!!M&&(typeof T=="number"||Se.test(T))&&(T>-1&&T%1==0)&&T<M}function ta(T,M){if(Me(T))return!1;var z=typeof T;return z=="number"||z=="symbol"||z=="boolean"||T==null||Ws(T)?!0:me.test(T)||!fe.test(T)||M!=null&&T in Object(M)}function zs(T){var M=typeof T;return M=="string"||M=="number"||M=="symbol"||M=="boolean"?T!=="__proto__":T===null}function _c(T){return!!yr&&yr in T}function Ec(T){var M=T&&T.constructor,z=typeof M=="function"&&M.prototype||Ot;return T===z}function Za(T){return T===T&&!wn(T)}function Ks(T,M){return function(z){return z==null?!1:z[T]===M&&(M!==void 0||T in Object(z))}}var N=je(function(T){T=yg(T);var M=[];return pe.test(T)&&M.push(""),T.replace(R,function(z,ee,ye,he){M.push(ye?he.replace(Z,"$1"):ee||z)}),M});function F(T){if(typeof T=="string"||Ws(T))return T;var M=T+"";return M=="0"&&1/T==-c?"-0":M}function H(T){if(T!=null){try{return Vr.call(T)}catch(M){}try{return T+""}catch(M){}}return""}function ue(T,M,z){var ee=T?T.length:0;if(!ee)return-1;var ye=z==null?0:gg(z);return ye<0&&(ye=hn(ee+ye,0)),nn(T,k(M),ye)}var Re=Ye(ue);function je(T,M){if(typeof T!="function"||M&&typeof M!="function")throw new TypeError(n);var z=function(){var ee=arguments,ye=M?M.apply(this,ee):ee[0],he=z.cache;if(he.has(ye))return he.get(ye);var Ge=T.apply(this,ee);return z.cache=he.set(ye,Ge),Ge};return z.cache=new(je.Cache||lr),z}je.Cache=lr;function He(T,M){return T===M||T!==T&&M!==M}function Ce(T){return Vt(T)&&dt.call(T,"callee")&&(!cn.call(T,"callee")||pt.call(T)==f)}var Me=Array.isArray;function xt(T){return T!=null&&ki(T.length)&&!ri(T)}function Vt(T){return Pi(T)&&xt(T)}function ri(T){var M=wn(T)?pt.call(T):"";return M==v||M==A}function ki(T){return typeof T=="number"&&T>-1&&T%1==0&&T<=o}function wn(T){var M=typeof T;return!!T&&(M=="object"||M=="function")}function Pi(T){return!!T&&typeof T=="object"}function Ws(T){return typeof T=="symbol"||Pi(T)&&pt.call(T)==w}var fg=gr?Fr(gr):C;function mg(T){if(!T)return T===0?T:0;if(T=bg(T),T===c||T===-c){var M=T<0?-1:1;return M*u}return T===T?T:0}function gg(T){var M=mg(T),z=M%1;return M===M?z?M-z:M:0}function bg(T){if(typeof T=="number")return T;if(Ws(T))return l;if(wn(T)){var M=typeof T.valueOf=="function"?T.valueOf():T;T=wn(M)?M+"":M}if(typeof T!="string")return T===0?T:+T;T=T.replace(Q,"");var z=ce.test(T);return z||oe.test(T)?$e(T.slice(2),z?2:8):ne.test(T)?l:+T}function yg(T){return T==null?"":ie(T)}function vg(T,M,z){var ee=T==null?void 0:Ii(T,M);return ee===void 0?z:ee}function wg(T,M){return T!=null&&Sr(T,M,Ya)}function Xs(T){return xt(T)?Ci(T):U(T)}function _g(T){return T}function Eg(T){return ta(T)?an(F(T)):re(T)}e.exports=Re}),f1="[object Symbol]",m1=Object.prototype,g1=m1.toString;function b1(e,t,r){for(var n=-1,i=e.length;++n<i;){var a=e[n],s=t(a);if(s!=null&&(c===void 0?s===s&&!w1(s):r(s,c)))var c=s,o=a}return o}function y1(e,t){return e>t}function v1(e){return!!e&&typeof e=="object"}function w1(e){return typeof e=="symbol"||v1(e)&&g1.call(e)==f1}function _1(e){return e}function E1(e){return e&&e.length?b1(e,_1,y1):void 0}var S1=E1,A1=128,T1=8,C1={0:"Reserved",1:"Interface local",2:"Link local",4:"Admin local",5:"Site local",8:"Organization local",14:"Global",15:"Reserved"},I1={"ff01::1/128":"Multicast (All nodes on this interface)","ff01::2/128":"Multicast (All routers on this interface)","ff02::1/128":"Multicast (All nodes on this link)","ff02::2/128":"Multicast (All routers on this link)","ff05::2/128":"Multicast (All routers in this site)","ff02::5/128":"Multicast (OSPFv3 AllSPF routers)","ff02::6/128":"Multicast (OSPFv3 AllDR routers)","ff02::9/128":"Multicast (RIP routers)","ff02::a/128":"Multicast (EIGRP routers)","ff02::d/128":"Multicast (PIM routers)","ff02::16/128":"Multicast (MLDv2 reports)","ff01::fb/128":"Multicast (mDNSv6)","ff02::fb/128":"Multicast (mDNSv6)","ff05::fb/128":"Multicast (mDNSv6)","ff02::1:2/128":"Multicast (All DHCP servers and relay agents on this link)","ff05::1:2/128":"Multicast (All DHCP servers and relay agents in this site)","ff02::1:3/128":"Multicast (All DHCP servers on this link)","ff05::1:3/128":"Multicast (All DHCP servers in this site)","::/128":"Unspecified","::1/128":"Loopback","ff00::/8":"Multicast","fe80::/10":"Link-local unicast"},R1=/([^0-9a-f:\/%])/ig,k1=/([0-9a-f]{5,}|:{3,}|[^:]:$|^:[^:]|\/$)/ig,P1=/\/\d{1,3}(?=%|$)/,N1=/%.*$/,O1=new RegExp(/^\[{0,1}([0-9a-f:]+)\]{0,1}/),D1=new RegExp(/\[([0-9a-f:]+)\]:([0-9]{1,5})/),Qe={BITS:A1,GROUPS:T1,SCOPES:C1,TYPES:I1,RE_BAD_CHARACTERS:R1,RE_BAD_ADDRESS:k1,RE_SUBNET_STRING:P1,RE_ZONE_STRING:N1,RE_URL:O1,RE_URL_WITH_PORT:D1},M1=function(){return this.valid},x1=Jr.isInSubnet,B1=Jr.isCorrect(Qe.BITS),L1=Jr.falseIfInvalid(function(){return this.addressMinusSuffix===this.canonicalForm()}),j1=Jr.falseIfInvalid(function(){return this.getBitsBase2(0,64)==="1111111010000000000000000000000000000000000000000000000000000000"}),U1=Jr.falseIfInvalid(function(){return this.getType()==="Multicast"}),F1=Jr.falseIfInvalid(function(){return this.v4}),q1=Jr.falseIfInvalid(function(){return this.isInSubnet(new this.constructor("2001::/32"))}),G1=Jr.falseIfInvalid(function(){return this.isInSubnet(new this.constructor("2002::/16"))}),$1=Jr.falseIfInvalid(function(){return this.getType()==="Loopback"}),V1={isValid:M1,isInSubnet:x1,isCorrect:B1,isCanonical:L1,isLinkLocal:j1,isMulticast:U1,is4:F1,isTeredo:q1,is6to4:G1,isLoopback:$1},Bo=le(function(e,t){var r=ys.sprintf,n=t.spanAllZeroes=function(a){return a.replace(/(0+)/g,'<span class="zero">$1</span>')};t.spanAll=function(a,s){s===void 0&&(s=0);var c=a.split("");return c.map(function(o,u){return r('<span class="digit value-%s position-%d">%s</span>',o,u+s,n(o))}).join("")};function i(a){return a.replace(/^(0+)/,'<span class="zero">$1</span>')}t.spanLeadingZeroes=function(a){var s=a.split(":");return s.map(function(c){return i(c)}).join(":")},t.simpleGroup=function(a,s){var c=a.split(":");return s||(s=0),c.map(function(o,u){return/group-v4/.test(o)?o:r('<span class="hover-group group-%d">%s</span>',u+s,i(o))}).join(":")}}),Fi=ys.sprintf,H1=function(e){return e===void 0?e="":e=Fi(":%s",e),Fi("http://[%s]%s/",this.correctForm(),e)},z1=function(e){e||(e={}),e.className===void 0&&(e.className=""),e.prefix===void 0&&(e.prefix="/#address="),e.v4===void 0&&(e.v4=!1);var t=this.correctForm;return e.v4&&(t=this.to4in6),e.className?Fi('<a href="%1$s%2$s" class="%3$s">%2$s</a>',e.prefix,t.call(this),e.className):Fi('<a href="%1$s%2$s">%2$s</a>',e.prefix,t.call(this))},K1=function(){var e=this.address.match(Kt.RE_ADDRESS),t;if(e){var r=e[0].split(".");this.address=this.address.replace(Kt.RE_ADDRESS,Fi('<span class="hover-group group-v4 group-6">%s</span>.<span class="hover-group group-v4 group-7">%s</span>',r.slice(0,2).join("."),r.slice(2,4).join(".")))}if(this.elidedGroups===0)return Bo.simpleGroup(this.address);var n=[],i=this.address.split("::");i[0].length?n.push(Bo.simpleGroup(i[0])):n.push("");var a=["hover-group"];for(t=this.elisionBegin;t<this.elisionBegin+this.elidedGroups;t++)a.push(Fi("group-%d",t));return n.push(Fi('<span class="%s"></span>',a.join(" "))),i[1].length?n.push(Bo.simpleGroup(i[1],this.elisionEnd)):n.push(""),n.join(":")},W1={href:H1,link:z1,group:K1},Aa=ys.sprintf;function qu(e){return Aa("(%s)",e.join("|"))}function Gu(e){return e.length<4?Aa("0{0,%d}%s",4-e.length,e):e}var nf="[^A-Fa-f0-9:]";function $u(e){var t=[];e.forEach(function(n,i){var a=parseInt(n,16);a===0&&t.push(i)});var r=t.map(function(n){return e.map(function(i,a){if(a===n){var s=a===0||a===Qe.GROUPS-1?":":"";return qu([Gu(i),s])}return Gu(i)}).join(":")});return r.push(e.map(Gu).join(":")),qu(r)}function af(e,t,r){var n=t?"":":",i=r?"":":",a=[];!t&&!r&&a.push("::"),t&&r&&a.push(""),(r&&!t||!r&&t)&&a.push(":"),a.push(Aa("%s(:0{1,4}){1,%d}",n,e-1)),a.push(Aa("(0{1,4}:){1,%d}%s",e-1,i)),a.push(Aa("(0{1,4}:){%d}0{1,4}",e-1));for(var s=1;s<e-1;s++)for(var c=1;c<e-s;c++)a.push(Aa("(0{1,4}:){%d}:(0{1,4}:){%d}0{1,4}",c,e-c-s-1));return qu(a)}var X1=function(e){e===void 0&&(e=!1);var t=[],r=new this.constructor(this.correctForm());if(r.elidedGroups===0)t.push($u(r.parsedAddress));else if(r.elidedGroups===Qe.GROUPS)t.push(af(Qe.GROUPS));else{var n=r.address.split("::");n[0].length&&t.push($u(n[0].split(":"))),t.push(af(r.elidedGroups,n[0].length!==0,n[1].length!==0)),n[1].length&&t.push($u(n[1].split(":"))),t=[t.join(":")]}return e||(t=[].concat("(?=^|",nf,"|[^\\w\\:])(",t,")(?=[^\\w\\:]|",nf,"|$)")),t.join("")},Q1=function(e){return new RegExp(this.regularExpressionString(e),"i")},Y1={regularExpressionString:X1,regularExpression:Q1},Wt=Op.BigInteger,Gn=ys.sprintf;function J1(e){for(var t=/(\d+)(\d{3})/;t.test(e);)e=e.replace(t,"$1,$2");return e}function Z1(e){return e=e.replace(/^(0{1,})([1-9]+)$/,'<span class="parse-error">$1</span>$2'),e=e.replace(/^(0{1,})(0)$/,'<span class="parse-error">$1</span>$2'),e}function be(e,t){t===void 0?this.groups=Qe.GROUPS:this.groups=t,this.v4=!1,this.subnet="/128",this.subnetMask=128,this.zone="",this.address=e;var r=Qe.RE_SUBNET_STRING.exec(e);if(r){if(this.parsedSubnet=r[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,isNaN(this.subnetMask)||this.subnetMask<0||this.subnetMask>Qe.BITS){this.valid=!1,this.error="Invalid subnet mask.";return}e=e.replace(Qe.RE_SUBNET_STRING,"")}else if(/\//.test(e)){this.valid=!1,this.error="Invalid subnet mask.";return}var n=Qe.RE_ZONE_STRING.exec(e);n&&(this.zone=n[0],e=e.replace(Qe.RE_ZONE_STRING,"")),this.addressMinusSuffix=e,this.parsedAddress=this.parse(this.addressMinusSuffix)}Fu(be.prototype,V1),Fu(be.prototype,W1),Fu(be.prototype,Y1),be.fromBigInteger=function(e){var t=vs(e.toString(16),32,"0"),r=[],n;for(n=0;n<Qe.GROUPS;n++)r.push(t.slice(n*4,(n+1)*4));return new be(r.join(":"))},be.fromURL=function(e){var t,r,n;if(e.indexOf("[")!==-1&&e.indexOf("]:")!==-1){if(n=Qe.RE_URL_WITH_PORT.exec(e),n===null)return{error:"failed to parse address with port",address:null,port:null};t=n[1],r=n[2]}else if(e.indexOf("/")!==-1){if(e=e.replace(/^[a-z0-9]+:\/\//,""),n=Qe.RE_URL.exec(e),n===null)return{error:"failed to parse address from URL",address:null,port:null};t=n[1]}else t=e;return r?(r=parseInt(r,10),(r<0||r>65536)&&(r=null)):r=null,{address:new be(t),port:r}},be.fromAddress4=function(e){var e=new Ui(e),t=Qe.BITS-(Kt.BITS-e.subnetMask);return new be("::ffff:"+e.correctForm()+"/"+t)},be.fromArpa=function(e){var t=e.replace(/(\.ip6\.arpa)?\.$/,""),r=7;if(t.length!==63)return t={error:"Not Valid 'ip6.arpa' form",address:null},t;t=t.split(".").reverse();for(var n=r;n>0;n--){var i=n*4;t.splice(i,0,":")}return t=t.join(""),new be(t)};function eA(e,t){var r=[],n=[],i;for(i=0;i<e.length;i++)i<t[0]?r.push(e[i]):i>t[1]&&n.push(e[i]);return r.concat(["compact"]).concat(n)}be.prototype.microsoftTranscription=function(){return Gn("%s.ipv6-literal.net",this.correctForm().replace(/:/g,"-"))},be.prototype.mask=function(e){return e===void 0&&(e=this.subnetMask),this.getBitsBase2(0,e)},be.prototype.possibleSubnets=function(e){e===void 0&&(e=128);var t=Qe.BITS-this.subnetMask,r=Math.abs(e-Qe.BITS),n=t-r;return n<0?"0":J1(new Wt("2",10).pow(n).toString(10))},be.prototype._startAddress=function(){return new Wt(this.mask()+Mo("0",Qe.BITS-this.subnetMask),2)},be.prototype.startAddress=function(){return be.fromBigInteger(this._startAddress())},be.prototype.startAddressExclusive=function(){var e=new Wt("1");return be.fromBigInteger(this._startAddress().add(e))},be.prototype._endAddress=function(){return new Wt(this.mask()+Mo("1",Qe.BITS-this.subnetMask),2)},be.prototype.endAddress=function(){return be.fromBigInteger(this._endAddress())},be.prototype.endAddressExclusive=function(){var e=new Wt("1");return be.fromBigInteger(this._endAddress().subtract(e))},be.prototype.getScope=function(){var e=Qe.SCOPES[this.getBits(12,16)];return this.getType()==="Global unicast"&&e!=="Link local"&&(e="Global"),e},be.prototype.getType=function(){var e=this;function t(r,n){return e.isInSubnet(new be(n))}return p1(Qe.TYPES,t)||"Global unicast"},be.prototype.getBits=function(e,t){return new Wt(this.getBitsBase2(e,t),2)},be.prototype.getBitsBase2=function(e,t){return this.binaryZeroPad().slice(e,t)},be.prototype.getBitsBase16=function(e,t){var r=t-e;return r%4!==0?null:vs(this.getBits(e,t).toString(16),r/4,"0")},be.prototype.getBitsPastSubnet=function(){return this.getBitsBase2(this.subnetMask,Qe.BITS)},be.prototype.reverseForm=function(e){e||(e={});var t=Math.floor(this.subnetMask/4),r=this.canonicalForm().replace(/:/g,"").split("").slice(0,t).reverse().join(".");return t>0?e.omitSuffix?r:Gn("%s.ip6.arpa.",r):e.omitSuffix?"":"ip6.arpa."},be.prototype.correctForm=function(){if(!this.parsedAddress)return null;var e,t=[],r=0,n=[];for(e=0;e<this.parsedAddress.length;e++){var i=parseInt(this.parsedAddress[e],16);i===0&&r++,i!==0&&r>0&&(r>1&&n.push([e-r,e-1]),r=0)}r>1&&n.push([this.parsedAddress.length-r,this.parsedAddress.length-1]);var a=n.map(function(o){return o[1]-o[0]+1});if(n.length>0){var s=a.indexOf(S1(a));t=eA(this.parsedAddress,n[s])}else t=this.parsedAddress;for(e=0;e<t.length;e++)t[e]!=="compact"&&(t[e]=parseInt(t[e],16).toString(16));var c=t.join(":");return c=c.replace(/^compact$/,"::"),c=c.replace(/^compact|compact$/,":"),c=c.replace(/compact/,""),c},be.prototype.binaryZeroPad=function(){return vs(this.bigInteger().toString(2),Qe.BITS,"0")},be.prototype.parse4in6=function(e){var t=e.split(":"),r=t.slice(-1)[0],n=r.match(Kt.RE_ADDRESS);if(n){for(var i=new Ui(n[0]),a=0;a<i.groups;a++)if(/^0[0-9]+/.test(i.parsedAddress[a]))return this.valid=!1,this.error="IPv4 addresses can not have leading zeroes.",this.parseError=e.replace(Kt.RE_ADDRESS,i.parsedAddress.map(Z1).join(".")),null;this.v4=!0,t[t.length-1]=i.toGroup6(),e=t.join(":")}return e},be.prototype.parse=function(e){if(e=this.parse4in6(e),this.error)return null;var t=e.match(Qe.RE_BAD_CHARACTERS);if(t)return this.valid=!1,this.error=Gn("Bad character%s detected in address: %s",t.length>1?"s":"",t.join("")),this.parseError=e.replace(Qe.RE_BAD_CHARACTERS,'<span class="parse-error">$1</span>'),null;var r=e.match(Qe.RE_BAD_ADDRESS);if(r)return this.valid=!1,this.error=Gn("Address failed regex: %s",r.join("")),this.parseError=e.replace(Qe.RE_BAD_ADDRESS,'<span class="parse-error">$1</span>'),null;var n=[],i=e.split("::");if(i.length===2){var a=i[0].split(":"),s=i[1].split(":");a.length===1&&a[0]===""&&(a=[]),s.length===1&&s[0]===""&&(s=[]);var c=this.groups-(a.length+s.length);if(!c)return this.valid=!1,this.error="Error parsing groups",null;this.elidedGroups=c,this.elisionBegin=a.length,this.elisionEnd=a.length+this.elidedGroups,a.forEach(function(u){n.push(u)});for(var o=0;o<c;o++)n.push(0);s.forEach(function(u){n.push(u)})}else if(i.length===1)n=e.split(":"),this.elidedGroups=0;else return this.valid=!1,this.error="Too many :: groups found",null;return n=n.map(function(u){return Gn("%x",parseInt(u,16))}),n.length!==this.groups?(this.valid=!1,this.error="Incorrect number of groups found",null):(this.valid=!0,n)};function sf(e){return Gn("%04x",parseInt(e,16))}be.prototype.canonicalForm=function(){return this.valid?this.parsedAddress.map(sf).join(":"):null},be.prototype.decimal=function(){return this.valid?this.parsedAddress.map(function(e){return Gn("%05d",parseInt(e,16))}).join(":"):null},be.prototype.bigInteger=function(){return this.valid?new Wt(this.parsedAddress.map(sf).join(""),16):null},be.prototype.to4=function(){var e=this.binaryZeroPad().split("");return Ui.fromHex(new Wt(e.slice(96,128).join(""),2).toString(16))},be.prototype.to4in6=function(){var e=this.to4(),t=new be(this.parsedAddress.slice(0,6).join(":"),6),r=t.correctForm(),n="";return/:$/.test(r)||(n=":"),t.correctForm()+n+e.address},be.prototype.inspectTeredo=function(){var e=this.getBitsBase16(0,32),t=this.getBits(80,96).xor(new Wt("ffff",16)).toString(),r=Ui.fromHex(this.getBitsBase16(32,64)),n=Ui.fromHex(this.getBits(96,128).xor(new Wt("ffffffff",16)).toString(16)),i=this.getBits(64,80),a=this.getBitsBase2(64,80),s=i.testBit(15),c=i.testBit(14),o=i.testBit(8),u=i.testBit(9),l=new Wt(a.slice(2,6)+a.slice(8,16),2).toString(10);return{prefix:Gn("%s:%s",e.slice(0,4),e.slice(4,8)),server4:r.address,client4:n.address,flags:a,coneNat:s,microsoft:{reserved:c,universalLocal:u,groupIndividual:o,nonce:l},udpPort:t}},be.prototype.inspect6to4=function(){var e=this.getBitsBase16(0,16),t=Ui.fromHex(this.getBitsBase16(16,48));return{prefix:Gn("%s",e.slice(0,4)),gateway:t.address}},be.prototype.to6to4=function(){if(!this.is4())return null;var e=["2002",this.getBitsBase16(96,112),this.getBitsBase16(112,128),"","/16"].join(":");return new be(e)},be.prototype.toByteArray=function(){var e=this.bigInteger().toByteArray();return e.length===17&&e[0]===0?e.slice(1):e};function of(e){return e&255}be.prototype.toUnsignedByteArray=function(){return this.toByteArray().map(of)},be.fromByteArray=function(e){return this.fromUnsignedByteArray(e.map(of))},be.fromUnsignedByteArray=function(e){for(var t=new Wt("256",10),r=new Wt("0",10),n=new Wt("1",10),i=e.length-1;i>=0;i--)r=r.add(n.multiply(new Wt(e[i].toString(10),10))),n=n.multiply(t);return be.fromBigInteger(r)};var tA=be,rA=Ui,nA=tA,iA={helpers:Bo},aA={Address4:rA,Address6:nA,v6:iA};const{Address4:sA,Address6:oA}=aA,Lo={ERR_INVALID_IP_PARAMETER:"ERR_INVALID_IP_PARAMETER",ERR_INVALID_PORT_PARAMETER:"ERR_INVALID_PORT_PARAMETER",ERR_INVALID_IP:"ERR_INVALID_IP"};function cA(e,t){if(typeof e!="string")throw $(new Error(`invalid ip provided: ${e}`),Lo.ERR_INVALID_IP_PARAMETER);if(t=parseInt(t),isNaN(t))throw $(new Error(`invalid port provided: ${t}`),Lo.ERR_INVALID_PORT_PARAMETER);if(new sA(e).isValid())return Pe(`/ip4/${e}/tcp/${t}`);const r=new oA(e);if(r.isValid())return r.is4()?Pe(`/ip4/${r.to4().correctForm()}/tcp/${t}`):Pe(`/ip6/${e}/tcp/${t}`);throw $(new Error(`invalid ip:port for creating a multiaddr: ${e}:${t}`),Lo.ERR_INVALID_IP)}var qi=cA,uA=Lo;qi.Errors=uA;var lA=(e,t)=>(t=t||(()=>{}),e.then(r=>new Promise(n=>{n(t())}).then(()=>r),r=>new Promise(n=>{n(t())}).then(()=>{throw r})));class cf extends Error{constructor(e){super(e);this.name="TimeoutError"}}const uf=(e,t,r)=>new Promise((n,i)=>{if(typeof t!="number"||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===Infinity){n(e);return}const a=setTimeout(()=>{if(typeof r=="function"){try{n(r())}catch(o){i(o)}return}const s=typeof r=="string"?r:`Promise timed out after ${t} milliseconds`,c=r instanceof Error?r:new cf(s);typeof e.cancel=="function"&&e.cancel(),i(c)},t);lA(e.then(n,i),()=>{clearTimeout(a)})});var Vu=uf,hA=uf,dA=cf;Vu.default=hA,Vu.TimeoutError=dA;const{CLOSE_TIMEOUT:pA}=Np,Hu=te("libp2p:websockets:socket");Hu.error=te("libp2p:websockets:socket:error");var lf=(e,t={})=>{const r={async sink(n){t.signal&&(n=gt(n,t.signal));try{await e.sink(async function*(){for await(const i of n)yield i instanceof Uint8Array?i:i.slice()}())}catch(i){i.type!=="aborted"&&Hu.error(i)}},source:t.signal?gt(e.source,t.signal):e.source,conn:e,localAddr:t.localAddr||(e.localAddress&&e.localPort?qi(e.localAddress,e.localPort):void 0),remoteAddr:t.remoteAddr||qi(e.remoteAddress,e.remotePort),timeline:{open:Date.now()},async close(){const n=Date.now();try{await Vu(e.close(),pA)}catch(i){const{host:a,port:s}=r.remoteAddr.toOptions();Hu("timeout closing stream to %s:%s after %dms, destroying it manually",a,s,Date.now()-n),e.destroy()}finally{r.timeline.close=Date.now()}}};return e.socket.once&&e.socket.once("close",()=>{r.timeline.close||(r.timeline.close=Date.now())}),r};const{createServer:fA}=WE,jo=te("libp2p:websockets:listener");jo.error=te("libp2p:websockets:listener:error");var mA=({handler:e,upgrader:t},r={})=>{const n=new Bt,i=fA(r,async s=>{let c,o;try{c=lf(s),jo("new inbound connection %s",c.remoteAddr),o=await t.upgradeInbound(c)}catch(u){return jo.error("inbound connection failed to upgrade",u),c&&c.close()}jo("inbound connection %s upgraded",c.remoteAddr),gA(i,c),e&&e(o),n.emit("connection",o)});i.on("listening",()=>n.emit("listening")).on("error",s=>n.emit("error",s)).on("close",()=>n.emit("close")),i.__connections=[];let a;return n.close=()=>(i.__connections.forEach(s=>s.close()),i.close()),n.listen=s=>(a=s,i.listen(s.toOptions())),n.getAddrs=()=>{const s=[],c=i.address();if(!c)throw new Error("Listener is not ready yet");const o=a.getPeerId();if(a.toString().indexOf("ip4")!==-1){let u=a.decapsulate("tcp");if(u=u.encapsulate("/tcp/"+c.port+"/ws"),a.getPeerId()&&(u=u.encapsulate("/p2p/"+o)),u.toString().indexOf("0.0.0.0")!==-1){const l=Jl.networkInterfaces();Object.keys(l).forEach(f=>{l[f].forEach(_=>{_.family==="IPv4"&&s.push(Pe(u.toString().replace("0.0.0.0",_.address)))})})}else s.push(u)}return s},n};function gA(e,t){e.__connections.push(t)}const{AbortError:hf}=gt,Ta=te("libp2p:websockets"),{CODE_CIRCUIT:bA,CODE_P2P:df}=Np;class yA{constructor({upgrader:e}){if(!e)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=e}async dial(e,t={}){Ta("dialing %s",e);const r=await this._connect(e,t),n=lf(r,{remoteAddr:e,signal:t.signal});Ta("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return Ta("outbound connection %s upgraded",n.remoteAddr),i}async _connect(e,t={}){if(t.signal&&t.signal.aborted)throw new hf;const r=e.toOptions();Ta("dialing %s:%s",r.host,r.port);const n=Pp(KE(e),Object.assign({binary:!0},t));if(!t.signal)return await n.connected(),Ta("connected %s",e),n;let i;const a=new Promise((s,c)=>{if(i=()=>{c(new hf),n.close()},t.signal.aborted)return i();t.signal.addEventListener("abort",i)});try{await Promise.race([a,n.connected()])}finally{t.signal.removeEventListener("abort",i)}return Ta("connected %s",e),n}createListener(e={},t){return typeof e=="function"&&(t=e,e={}),mA({handler:t,upgrader:this._upgrader},e)}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>t.protoCodes().includes(bA)?!1:da.WebSockets.matches(t.decapsulateCode(df))||da.WebSocketsSecure.matches(t.decapsulateCode(df)))}}var vA=On(yA,{className:"WebSockets",symbolName:"@libp2p/js-libp2p-websockets/websockets"}),pf=function(){if(typeof window=="undefined")return null;var t={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return t.RTCPeerConnection?t:null},ff=le(function(e,t){/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var r=zt.Buffer;function n(a,s){for(var c in a)s[c]=a[c]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=zt:(n(zt,t),t.Buffer=i);function i(a,s,c){return r(a,s,c)}i.prototype=Object.create(r.prototype),n(r,i),i.from=function(a,s,c){if(typeof a=="number")throw new TypeError("Argument must not be a number");return r(a,s,c)},i.alloc=function(a,s,c){if(typeof a!="number")throw new TypeError("Argument must be a number");var o=r(a);return s!==void 0?typeof c=="string"?o.fill(s,c):o.fill(s):o.fill(0),o},i.allocUnsafe=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return r(a)},i.allocUnsafeSlow=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return zt.SlowBuffer(a)}}),mf=le(function(e){var t=65536,r=4294967295;function n(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var i=ff.Buffer,a=ge.crypto||ge.msCrypto;a&&a.getRandomValues?e.exports=s:e.exports=n;function s(c,o){if(c>r)throw new RangeError("requested too many random bytes");var u=i.allocUnsafe(c);if(c>0)if(c>t)for(var l=0;l<c;l+=t)a.getRandomValues(u.slice(l,l+t));else a.getRandomValues(u);return typeof o=="function"?_e.nextTick(function(){o(null,u)}):u}}),Gi=Bt.EventEmitter;function gf(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function wA(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gf(Object(r),!0).forEach(function(n){_A(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _A(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function EA(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bf(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function SA(e,t,r){return t&&bf(e.prototype,t),r&&bf(e,r),e}var Uo=zt.Buffer,zu=Nn.inspect,AA=zu&&zu.custom||"inspect";function TA(e,t,r){Uo.prototype.copy.call(e,t,r)}var CA=function(){function e(){EA(this,e),this.head=null,this.tail=null,this.length=0}return SA(e,[{key:"push",value:function(r){var n={data:r,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}},{key:"unshift",value:function(r){var n={data:r,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length}},{key:"shift",value:function(){if(this.length===0)return;var r=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,r}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(r){if(this.length===0)return"";for(var n=this.head,i=""+n.data;n=n.next;)i+=r+n.data;return i}},{key:"concat",value:function(r){if(this.length===0)return Uo.alloc(0);for(var n=Uo.allocUnsafe(r>>>0),i=this.head,a=0;i;)TA(i.data,n,a),a+=i.data.length,i=i.next;return n}},{key:"consume",value:function(r,n){var i;return r<this.head.data.length?(i=this.head.data.slice(0,r),this.head.data=this.head.data.slice(r)):r===this.head.data.length?i=this.shift():i=n?this._getString(r):this._getBuffer(r),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(r){var n=this.head,i=1,a=n.data;for(r-=a.length;n=n.next;){var s=n.data,c=r>s.length?s.length:r;if(c===s.length?a+=s:a+=s.slice(0,r),r-=c,r===0){c===s.length?(++i,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=s.slice(c));break}++i}return this.length-=i,a}},{key:"_getBuffer",value:function(r){var n=Uo.allocUnsafe(r),i=this.head,a=1;for(i.data.copy(n),r-=i.data.length;i=i.next;){var s=i.data,c=r>s.length?s.length:r;if(s.copy(n,n.length-r,0,c),r-=c,r===0){c===s.length?(++a,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=s.slice(c));break}++a}return this.length-=a,n}},{key:AA,value:function(r,n){return zu(this,wA({},n,{depth:0,customInspect:!1}))}}]),e}();function IA(e,t){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,_e.nextTick(Ku,this,e)):_e.nextTick(Ku,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(a){!t&&a?r._writableState?r._writableState.errorEmitted?_e.nextTick(Fo,r):(r._writableState.errorEmitted=!0,_e.nextTick(yf,r,a)):_e.nextTick(yf,r,a):t?(_e.nextTick(Fo,r),t(a)):_e.nextTick(Fo,r)}),this)}function yf(e,t){Ku(e,t),Fo(e)}function Fo(e){if(e._writableState&&!e._writableState.emitClose)return;if(e._readableState&&!e._readableState.emitClose)return;e.emit("close")}function RA(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function Ku(e,t){e.emit("error",t)}function kA(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}var Ca={destroy:IA,undestroy:RA,errorOrDestroy:kA};function PA(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var vf={};function Dr(e,t,r){r||(r=Error);function n(a,s,c){return typeof t=="string"?t:t(a,s,c)}var i=function(a){PA(s,a);function s(c,o,u){return a.call(this,n(c,o,u))||this}return s}(r);i.prototype.name=r.name,i.prototype.code=e,vf[e]=i}function wf(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map(function(n){return String(n)}),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:r===2?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}else return"of ".concat(t," ").concat(String(e))}function NA(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}function OA(e,t,r){return(r===void 0||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function DA(e,t,r){return typeof r!="number"&&(r=0),r+t.length>e.length?!1:e.indexOf(t,r)!==-1}Dr("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),Dr("ERR_INVALID_ARG_TYPE",function(e,t,r){var n;typeof t=="string"&&NA(t,"not ")?(n="must not be",t=t.replace(/^not /,"")):n="must be";var i;if(OA(e," argument"))i="The ".concat(e," ").concat(n," ").concat(wf(t,"type"));else{var a=DA(e,".")?"property":"argument";i='The "'.concat(e,'" ').concat(a," ").concat(n," ").concat(wf(t,"type"))}return i+=". Received type ".concat(typeof r),i},TypeError),Dr("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),Dr("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),Dr("ERR_STREAM_PREMATURE_CLOSE","Premature close"),Dr("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),Dr("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),Dr("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),Dr("ERR_STREAM_WRITE_AFTER_END","write after end"),Dr("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),Dr("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),Dr("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");var MA=vf,Ia={codes:MA},xA=Ia.codes.ERR_INVALID_OPT_VALUE;function BA(e,t,r){return e.highWaterMark!=null?e.highWaterMark:t?e[r]:null}function LA(e,t,r,n){var i=BA(t,n,r);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var a=n?r:"highWaterMark";throw new xA(a,i)}return Math.floor(i)}return e.objectMode?16:16*1024}var _f={getHighWaterMark:LA},jA=UA;function UA(e,t){if(Wu("noDeprecation"))return e;var r=!1;function n(){if(!r){if(Wu("throwDeprecation"))throw new Error(t);Wu("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}return n}function Wu(e){try{if(!ge.localStorage)return!1}catch(r){return!1}var t=ge.localStorage[e];return t==null?!1:String(t).toLowerCase()==="true"}var qo=et;function Ef(e){var t=this;this.next=null,this.entry=null,this.finish=function(){hT(t,e)}}var Ra;et.WritableState=_s;var FA={deprecate:jA},Go=zt.Buffer,qA=ge.Uint8Array||function(){};function GA(e){return Go.from(e)}function $A(e){return Go.isBuffer(e)||e instanceof qA}var VA=_f.getHighWaterMark,hi=Ia.codes,HA=hi.ERR_INVALID_ARG_TYPE,zA=hi.ERR_METHOD_NOT_IMPLEMENTED,KA=hi.ERR_MULTIPLE_CALLBACK,WA=hi.ERR_STREAM_CANNOT_PIPE,XA=hi.ERR_STREAM_DESTROYED,QA=hi.ERR_STREAM_NULL_VALUES,YA=hi.ERR_STREAM_WRITE_AFTER_END,JA=hi.ERR_UNKNOWN_ENCODING,ka=Ca.errorOrDestroy;es(et,Gi);function ZA(){}function _s(e,t,r){Ra=Ra||$n,e=e||{},typeof r!="boolean"&&(r=t instanceof Ra),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=VA(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var n=e.decodeStrings===!1;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(i){sT(t,i)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=e.emitClose!==!1,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new Ef(this)}_s.prototype.getBuffer=function(){for(var t=this.bufferedRequest,r=[];t;)r.push(t),t=t.next;return r},function(){try{Object.defineProperty(_s.prototype,"buffer",{get:FA.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}();var $o;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?($o=Function.prototype[Symbol.hasInstance],Object.defineProperty(et,Symbol.hasInstance,{value:function(t){return $o.call(this,t)?!0:this!==et?!1:t&&t._writableState instanceof _s}})):$o=function(t){return t instanceof this};function et(e){Ra=Ra||$n;var t=this instanceof Ra;if(!t&&!$o.call(et,this))return new et(e);this._writableState=new _s(e,this,t),this.writable=!0,e&&(typeof e.write=="function"&&(this._write=e.write),typeof e.writev=="function"&&(this._writev=e.writev),typeof e.destroy=="function"&&(this._destroy=e.destroy),typeof e.final=="function"&&(this._final=e.final)),Gi.call(this)}et.prototype.pipe=function(){ka(this,new WA)};function eT(e,t){var r=new YA;ka(e,r),_e.nextTick(t,r)}function tT(e,t,r,n){var i;return r===null?i=new QA:typeof r!="string"&&!t.objectMode&&(i=new HA("chunk",["string","Buffer"],r)),i?(ka(e,i),_e.nextTick(n,i),!1):!0}et.prototype.write=function(e,t,r){var n=this._writableState,i=!1,a=!n.objectMode&&$A(e);return a&&!Go.isBuffer(e)&&(e=GA(e)),typeof t=="function"&&(r=t,t=null),a?t="buffer":t||(t=n.defaultEncoding),typeof r!="function"&&(r=ZA),n.ending?eT(this,r):(a||tT(this,n,e,r))&&(n.pendingcb++,i=nT(this,n,a,e,t,r)),i},et.prototype.cork=function(){this._writableState.corked++},et.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,!e.writing&&!e.corked&&!e.bufferProcessing&&e.bufferedRequest&&Af(this,e))},et.prototype.setDefaultEncoding=function(t){if(typeof t=="string"&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new JA(t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(et.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function rT(e,t,r){return!e.objectMode&&e.decodeStrings!==!1&&typeof t=="string"&&(t=Go.from(t,r)),t}Object.defineProperty(et.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function nT(e,t,r,n,i,a){if(!r){var s=rT(t,n,i);n!==s&&(r=!0,i="buffer",n=s)}var c=t.objectMode?1:n.length;t.length+=c;var o=t.length<t.highWaterMark;if(o||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:a,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else Xu(e,t,!1,c,n,i,a);return o}function Xu(e,t,r,n,i,a,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new XA("write")):r?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function iT(e,t,r,n,i){--t.pendingcb,r?(_e.nextTick(i,n),_e.nextTick(Es,e,t),e._writableState.errorEmitted=!0,ka(e,n)):(i(n),e._writableState.errorEmitted=!0,ka(e,n),Es(e,t))}function aT(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function sT(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(typeof i!="function")throw new KA;if(aT(r),t)iT(e,r,n,t,i);else{var a=Tf(r)||e.destroyed;!a&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&Af(e,r),n?_e.nextTick(Sf,e,r,a,i):Sf(e,r,a,i)}}function Sf(e,t,r,n){r||oT(e,t),t.pendingcb--,n(),Es(e,t)}function oT(e,t){t.length===0&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function Af(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),a=t.corkedRequestsFree;a.entry=r;for(var s=0,c=!0;r;)i[s]=r,r.isBuf||(c=!1),r=r.next,s+=1;i.allBuffers=c,Xu(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new Ef(t),t.bufferedRequestCount=0}else{for(;r;){var o=r.chunk,u=r.encoding,l=r.callback,f=t.objectMode?1:o.length;if(Xu(e,t,!1,f,o,u,l),r=r.next,t.bufferedRequestCount--,t.writing)break}r===null&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}et.prototype._write=function(e,t,r){r(new zA("_write()"))},et.prototype._writev=null,et.prototype.end=function(e,t,r){var n=this._writableState;return typeof e=="function"?(r=e,e=null,t=null):typeof t=="function"&&(r=t,t=null),e!=null&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||lT(this,n,r),this},Object.defineProperty(et.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Tf(e){return e.ending&&e.length===0&&e.bufferedRequest===null&&!e.finished&&!e.writing}function cT(e,t){e._final(function(r){t.pendingcb--,r&&ka(e,r),t.prefinished=!0,e.emit("prefinish"),Es(e,t)})}function uT(e,t){!t.prefinished&&!t.finalCalled&&(typeof e._final=="function"&&!t.destroyed?(t.pendingcb++,t.finalCalled=!0,_e.nextTick(cT,e,t)):(t.prefinished=!0,e.emit("prefinish")))}function Es(e,t){var r=Tf(t);if(r&&(uT(e,t),t.pendingcb===0&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}function lT(e,t,r){t.ending=!0,Es(e,t),r&&(t.finished?_e.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function hT(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}Object.defineProperty(et.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(t){if(!this._writableState)return;this._writableState.destroyed=t}}),et.prototype.destroy=Ca.destroy,et.prototype._undestroy=Ca.undestroy,et.prototype._destroy=function(e,t){t(e)};var dT=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t},$n=An;es(An,rl);for(var Cf=dT(qo.prototype),Qu=0;Qu<Cf.length;Qu++){var Yu=Cf[Qu];An.prototype[Yu]||(An.prototype[Yu]=qo.prototype[Yu])}function An(e){if(!(this instanceof An))return new An(e);rl.call(this,e),qo.call(this,e),this.allowHalfOpen=!0,e&&(e.readable===!1&&(this.readable=!1),e.writable===!1&&(this.writable=!1),e.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",pT)))}Object.defineProperty(An.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(An.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(An.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function pT(){if(this._writableState.ended)return;_e.nextTick(fT,this)}function fT(e){e.end()}Object.defineProperty(An.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(t){if(this._readableState===void 0||this._writableState===void 0)return;this._readableState.destroyed=t,this._writableState.destroyed=t}});var Ju=ff.Buffer,If=Ju.isEncoding||function(e){e=""+e;switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function mT(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function gT(e){var t=mT(e);if(typeof t!="string"&&(Ju.isEncoding===If||!If(e)))throw new Error("Unknown encoding: "+e);return t||e}var bT=Ss;function Ss(e){this.encoding=gT(e);var t;switch(this.encoding){case"utf16le":this.text=ST,this.end=AT,t=4;break;case"utf8":this.fillLast=wT,t=4;break;case"base64":this.text=TT,this.end=CT,t=3;break;default:this.write=IT,this.end=RT;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=Ju.allocUnsafe(t)}Ss.prototype.write=function(e){if(e.length===0)return"";var t,r;if(this.lastNeed){if(t=this.fillLast(e),t===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},Ss.prototype.end=ET,Ss.prototype.text=_T,Ss.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length};function Zu(e){return e<=127?0:e>>5===6?2:e>>4===14?3:e>>3===30?4:e>>6===2?-1:-2}function yT(e,t,r){var n=t.length-1;if(n<r)return 0;var i=Zu(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||i===-2?0:(i=Zu(t[n]),i>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||i===-2?0:(i=Zu(t[n]),i>=0?(i>0&&(i===2?i=0:e.lastNeed=i-3),i):0))}function vT(e,t,r){if((t[0]&192)!==128)return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if((t[1]&192)!==128)return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&(t[2]&192)!==128)return e.lastNeed=2,"�"}}function wT(e){var t=this.lastTotal-this.lastNeed,r=vT(this,e);if(r!==void 0)return r;if(this.lastNeed<=e.length)return e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length}function _T(e,t){var r=yT(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)}function ET(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t}function ST(e,t){if((e.length-t)%2===0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function AT(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function TT(e,t){var r=(e.length-t)%3;return r===0?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function CT(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function IT(e){return e.toString(this.encoding)}function RT(e){return e&&e.length?this.write(e):""}var Rf={StringDecoder:bT},kf=Ia.codes.ERR_STREAM_PREMATURE_CLOSE;function kT(e){var t=!1;return function(){if(t)return;t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}function PT(){}function NT(e){return e.setHeader&&typeof e.abort=="function"}function Pf(e,t,r){if(typeof t=="function")return Pf(e,null,t);t||(t={}),r=kT(r||PT);var n=t.readable||t.readable!==!1&&e.readable,i=t.writable||t.writable!==!1&&e.writable,a=function(){e.writable||c()},s=e._writableState&&e._writableState.finished,c=function(){i=!1,s=!0,n||r.call(e)},o=e._readableState&&e._readableState.endEmitted,u=function(){n=!1,o=!0,i||r.call(e)},l=function(I){r.call(e,I)},f=function(){var I;if(n&&!o)return(!e._readableState||!e._readableState.ended)&&(I=new kf),r.call(e,I);if(i&&!s)return(!e._writableState||!e._writableState.ended)&&(I=new kf),r.call(e,I)},_=function(){e.req.on("finish",c)};return NT(e)?(e.on("complete",c),e.on("abort",f),e.req?_():e.on("request",_)):i&&!e._writableState&&(e.on("end",a),e.on("close",a)),e.on("end",u),e.on("finish",c),t.error!==!1&&e.on("error",l),e.on("close",f),function(){e.removeListener("complete",c),e.removeListener("abort",f),e.removeListener("request",_),e.req&&e.req.removeListener("finish",c),e.removeListener("end",a),e.removeListener("close",a),e.removeListener("finish",c),e.removeListener("end",u),e.removeListener("error",l),e.removeListener("close",f)}}var el=Pf,Vo;function di(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var pi=Symbol("lastResolve"),$i=Symbol("lastReject"),As=Symbol("error"),Ho=Symbol("ended"),Vi=Symbol("lastPromise"),tl=Symbol("handlePromise"),Hi=Symbol("stream");function fi(e,t){return{value:e,done:t}}function OT(e){var t=e[pi];if(t!==null){var r=e[Hi].read();r!==null&&(e[Vi]=null,e[pi]=null,e[$i]=null,t(fi(r,!1)))}}function DT(e){_e.nextTick(OT,e)}function MT(e,t){return function(r,n){e.then(function(){if(t[Ho]){r(fi(void 0,!0));return}t[tl](r,n)},n)}}var xT=Object.getPrototypeOf(function(){}),BT=Object.setPrototypeOf((Vo={get stream(){return this[Hi]},next:function(){var t=this,r=this[As];if(r!==null)return Promise.reject(r);if(this[Ho])return Promise.resolve(fi(void 0,!0));if(this[Hi].destroyed)return new Promise(function(s,c){_e.nextTick(function(){t[As]?c(t[As]):s(fi(void 0,!0))})});var n=this[Vi],i;if(n)i=new Promise(MT(n,this));else{var a=this[Hi].read();if(a!==null)return Promise.resolve(fi(a,!1));i=new Promise(this[tl])}return this[Vi]=i,i}},di(Vo,Symbol.asyncIterator,function(){return this}),di(Vo,"return",function(){var t=this;return new Promise(function(r,n){t[Hi].destroy(null,function(i){if(i){n(i);return}r(fi(void 0,!0))})})}),Vo),xT),LT=function(t){var r,n=Object.create(BT,(r={},di(r,Hi,{value:t,writable:!0}),di(r,pi,{value:null,writable:!0}),di(r,$i,{value:null,writable:!0}),di(r,As,{value:null,writable:!0}),di(r,Ho,{value:t._readableState.endEmitted,writable:!0}),di(r,tl,{value:function(a,s){var c=n[Hi].read();c?(n[Vi]=null,n[pi]=null,n[$i]=null,a(fi(c,!1))):(n[pi]=a,n[$i]=s)},writable:!0}),r));return n[Vi]=null,el(t,function(i){if(i&&i.code!=="ERR_STREAM_PREMATURE_CLOSE"){var a=n[$i];a!==null&&(n[Vi]=null,n[pi]=null,n[$i]=null,a(i)),n[As]=i;return}var s=n[pi];s!==null&&(n[Vi]=null,n[pi]=null,n[$i]=null,s(fi(void 0,!0))),n[Ho]=!0}),t.on("readable",DT.bind(null,n)),n},jT=LT,UT=function(){throw new Error("Readable.from is not available in the browser")},rl=Oe,Pa;Oe.ReadableState=Of;var cN=Bt.EventEmitter,Nf=function(t,r){return t.listeners(r).length},zo=zt.Buffer,FT=ge.Uint8Array||function(){};function qT(e){return zo.from(e)}function GT(e){return zo.isBuffer(e)||e instanceof FT}var Ie;Nn&&Nn.debuglog?Ie=Nn.debuglog("stream"):Ie=function(){};var $T=_f.getHighWaterMark,Ko=Ia.codes,VT=Ko.ERR_INVALID_ARG_TYPE,HT=Ko.ERR_STREAM_PUSH_AFTER_EOF,zT=Ko.ERR_METHOD_NOT_IMPLEMENTED,KT=Ko.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,Na,nl,il;es(Oe,Gi);var Ts=Ca.errorOrDestroy,al=["error","close","destroy","pause","resume"];function WT(e,t,r){if(typeof e.prependListener=="function")return e.prependListener(t,r);!e._events||!e._events[t]?e.on(t,r):Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]}function Of(e,t,r){Pa=Pa||$n,e=e||{},typeof r!="boolean"&&(r=t instanceof Pa),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=$T(this,e,"readableHighWaterMark",r),this.buffer=new CA,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=e.emitClose!==!1,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(Na||(Na=Rf.StringDecoder),this.decoder=new Na(e.encoding),this.encoding=e.encoding)}function Oe(e){if(Pa=Pa||$n,!(this instanceof Oe))return new Oe(e);var t=this instanceof Pa;this._readableState=new Of(e,this,t),this.readable=!0,e&&(typeof e.read=="function"&&(this._read=e.read),typeof e.destroy=="function"&&(this._destroy=e.destroy)),Gi.call(this)}Object.defineProperty(Oe.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(t){if(!this._readableState)return;this._readableState.destroyed=t}}),Oe.prototype.destroy=Ca.destroy,Oe.prototype._undestroy=Ca.undestroy,Oe.prototype._destroy=function(e,t){t(e)},Oe.prototype.push=function(e,t){var r=this._readableState,n;return r.objectMode?n=!0:typeof e=="string"&&(t=t||r.defaultEncoding,t!==r.encoding&&(e=zo.from(e,t),t=""),n=!0),Df(this,e,t,!1,n)},Oe.prototype.unshift=function(e){return Df(this,e,null,!0,!1)};function Df(e,t,r,n,i){Ie("readableAddChunk",t);var a=e._readableState;if(t===null)a.reading=!1,YT(e,a);else{var s;if(i||(s=XT(a,t)),s)Ts(e,s);else if(a.objectMode||t&&t.length>0)if(typeof t!="string"&&!a.objectMode&&Object.getPrototypeOf(t)!==zo.prototype&&(t=qT(t)),n)a.endEmitted?Ts(e,new KT):sl(e,a,t,!0);else if(a.ended)Ts(e,new HT);else{if(a.destroyed)return!1;a.reading=!1,a.decoder&&!r?(t=a.decoder.write(t),a.objectMode||t.length!==0?sl(e,a,t,!1):ol(e,a)):sl(e,a,t,!1)}else n||(a.reading=!1,ol(e,a))}return!a.ended&&(a.length<a.highWaterMark||a.length===0)}function sl(e,t,r,n){t.flowing&&t.length===0&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&Wo(e)),ol(e,t)}function XT(e,t){var r;return!GT(t)&&typeof t!="string"&&t!==void 0&&!e.objectMode&&(r=new VT("chunk",["string","Buffer","Uint8Array"],t)),r}Oe.prototype.isPaused=function(){return this._readableState.flowing===!1},Oe.prototype.setEncoding=function(e){Na||(Na=Rf.StringDecoder);var t=new Na(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";r!==null;)n+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),n!==""&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var Mf=1073741824;function QT(e){return e>=Mf?e=Mf:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function xf(e,t){return e<=0||t.length===0&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=QT(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}Oe.prototype.read=function(e){Ie("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(e!==0&&(t.emittedReadable=!1),e===0&&t.needReadable&&((t.highWaterMark!==0?t.length>=t.highWaterMark:t.length>0)||t.ended))return Ie("read: emitReadable",t.length,t.ended),t.length===0&&t.ended?ul(this):Wo(this),null;if(e=xf(e,t),e===0&&t.ended)return t.length===0&&ul(this),null;var n=t.needReadable;Ie("need readable",n),(t.length===0||t.length-e<t.highWaterMark)&&(n=!0,Ie("length less than watermark",n)),t.ended||t.reading?(n=!1,Ie("reading or ended",n)):n&&(Ie("do read"),t.reading=!0,t.sync=!0,t.length===0&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=xf(r,t)));var i;return e>0?i=jf(e,t):i=null,i===null?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),t.length===0&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&ul(this)),i!==null&&this.emit("data",i),i};function YT(e,t){if(Ie("onEofChunk"),t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?Wo(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,Bf(e)))}function Wo(e){var t=e._readableState;Ie("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(Ie("emitReadable",t.flowing),t.emittedReadable=!0,_e.nextTick(Bf,e))}function Bf(e){var t=e._readableState;Ie("emitReadable_",t.destroyed,t.length,t.ended),!t.destroyed&&(t.length||t.ended)&&(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,cl(e)}function ol(e,t){t.readingMore||(t.readingMore=!0,_e.nextTick(JT,e,t))}function JT(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&t.length===0);){var r=t.length;if(Ie("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}Oe.prototype._read=function(e){Ts(this,new zT("_read()"))},Oe.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e);break}n.pipesCount+=1,Ie("pipe count=%d opts=%j",n.pipesCount,t);var i=(!t||t.end!==!1)&&e!==_e.stdout&&e!==_e.stderr,a=i?c:d;n.endEmitted?_e.nextTick(a):r.once("end",a),e.on("unpipe",s);function s(v,A){Ie("onunpipe"),v===r&&(A&&A.hasUnpiped===!1&&(A.hasUnpiped=!0,l()))}function c(){Ie("onend"),e.end()}var o=ZT(r);e.on("drain",o);var u=!1;function l(){Ie("cleanup"),e.removeListener("close",p),e.removeListener("finish",I),e.removeListener("drain",o),e.removeListener("error",_),e.removeListener("unpipe",s),r.removeListener("end",c),r.removeListener("end",d),r.removeListener("data",f),u=!0,n.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&o()}r.on("data",f);function f(v){Ie("ondata");var A=e.write(v);Ie("dest.write",A),A===!1&&((n.pipesCount===1&&n.pipes===e||n.pipesCount>1&&Uf(n.pipes,e)!==-1)&&!u&&(Ie("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function _(v){Ie("onerror",v),d(),e.removeListener("error",_),Nf(e,"error")===0&&Ts(e,v)}WT(e,"error",_);function p(){e.removeListener("finish",I),d()}e.once("close",p);function I(){Ie("onfinish"),e.removeListener("close",p),d()}e.once("finish",I);function d(){Ie("unpipe"),r.unpipe(e)}return e.emit("pipe",r),n.flowing||(Ie("pipe resume"),r.resume()),e};function ZT(e){return function(){var r=e._readableState;Ie("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&Nf(e,"data")&&(r.flowing=!0,cl(e))}}Oe.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(t.pipesCount===0)return this;if(t.pipesCount===1)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)n[a].emit("unpipe",this,{hasUnpiped:!1});return this}var s=Uf(t.pipes,e);return s===-1?this:(t.pipes.splice(s,1),t.pipesCount-=1,t.pipesCount===1&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)},Oe.prototype.on=function(e,t){var r=Gi.prototype.on.call(this,e,t),n=this._readableState;return e==="data"?(n.readableListening=this.listenerCount("readable")>0,n.flowing!==!1&&this.resume()):e==="readable"&&(!n.endEmitted&&!n.readableListening&&(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,Ie("on readable",n.length,n.reading),n.length?Wo(this):n.reading||_e.nextTick(eC,this))),r},Oe.prototype.addListener=Oe.prototype.on,Oe.prototype.removeListener=function(e,t){var r=Gi.prototype.removeListener.call(this,e,t);return e==="readable"&&_e.nextTick(Lf,this),r},Oe.prototype.removeAllListeners=function(e){var t=Gi.prototype.removeAllListeners.apply(this,arguments);return(e==="readable"||e===void 0)&&_e.nextTick(Lf,this),t};function Lf(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function eC(e){Ie("readable nexttick read 0"),e.read(0)}Oe.prototype.resume=function(){var e=this._readableState;return e.flowing||(Ie("resume"),e.flowing=!e.readableListening,tC(this,e)),e.paused=!1,this};function tC(e,t){t.resumeScheduled||(t.resumeScheduled=!0,_e.nextTick(rC,e,t))}function rC(e,t){Ie("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),cl(e),t.flowing&&!t.reading&&e.read(0)}Oe.prototype.pause=function(){return Ie("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(Ie("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function cl(e){var t=e._readableState;for(Ie("flow",t.flowing);t.flowing&&e.read()!==null;);}Oe.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;e.on("end",function(){if(Ie("wrapped end"),r.decoder&&!r.ended){var s=r.decoder.end();s&&s.length&&t.push(s)}t.push(null)}),e.on("data",function(s){if(Ie("wrapped data"),r.decoder&&(s=r.decoder.write(s)),r.objectMode&&s==null)return;if(!r.objectMode&&(!s||!s.length))return;var c=t.push(s);c||(n=!0,e.pause())});for(var i in e)this[i]===void 0&&typeof e[i]=="function"&&(this[i]=function(c){return function(){return e[c].apply(e,arguments)}}(i));for(var a=0;a<al.length;a++)e.on(al[a],this.emit.bind(this,al[a]));return this._read=function(s){Ie("wrapped _read",s),n&&(n=!1,e.resume())},this},typeof Symbol=="function"&&(Oe.prototype[Symbol.asyncIterator]=function(){return nl===void 0&&(nl=jT),nl(this)}),Object.defineProperty(Oe.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(Oe.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(Oe.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(t){this._readableState&&(this._readableState.flowing=t)}}),Oe._fromList=jf,Object.defineProperty(Oe.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function jf(e,t){if(t.length===0)return null;var r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(t.decoder?r=t.buffer.join(""):t.buffer.length===1?r=t.buffer.first():r=t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r}function ul(e){var t=e._readableState;Ie("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,_e.nextTick(nC,t,e))}function nC(e,t){if(Ie("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&e.length===0&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}typeof Symbol=="function"&&(Oe.from=function(e,t){return il===void 0&&(il=UT),il(Oe,e,t)});function Uf(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}var ll=Vn,Xo=Ia.codes,iC=Xo.ERR_METHOD_NOT_IMPLEMENTED,aC=Xo.ERR_MULTIPLE_CALLBACK,sC=Xo.ERR_TRANSFORM_ALREADY_TRANSFORMING,oC=Xo.ERR_TRANSFORM_WITH_LENGTH_0;es(Vn,$n);function cC(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(n===null)return this.emit("error",new aC);r.writechunk=null,r.writecb=null,t!=null&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function Vn(e){if(!(this instanceof Vn))return new Vn(e);$n.call(this,e),this._transformState={afterTransform:cC.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&(typeof e.transform=="function"&&(this._transform=e.transform),typeof e.flush=="function"&&(this._flush=e.flush)),this.on("prefinish",uC)}function uC(){var e=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(t,r){Ff(e,t,r)}):Ff(this,null,null)}Vn.prototype.push=function(e,t){return this._transformState.needTransform=!1,$n.prototype.push.call(this,e,t)},Vn.prototype._transform=function(e,t,r){r(new iC("_transform()"))},Vn.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},Vn.prototype._read=function(e){var t=this._transformState;t.writechunk!==null&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},Vn.prototype._destroy=function(e,t){$n.prototype._destroy.call(this,e,function(r){t(r)})};function Ff(e,t,r){if(t)return e.emit("error",t);if(r!=null&&e.push(r),e._writableState.length)throw new oC;if(e._transformState.transforming)throw new sC;return e.push(null)}var lC=Cs;es(Cs,ll);function Cs(e){if(!(this instanceof Cs))return new Cs(e);ll.call(this,e)}Cs.prototype._transform=function(e,t,r){r(null,e)};var hl;function hC(e){var t=!1;return function(){if(t)return;t=!0,e.apply(void 0,arguments)}}var qf=Ia.codes,dC=qf.ERR_MISSING_ARGS,pC=qf.ERR_STREAM_DESTROYED;function Gf(e){if(e)throw e}function fC(e){return e.setHeader&&typeof e.abort=="function"}function mC(e,t,r,n){n=hC(n);var i=!1;e.on("close",function(){i=!0}),hl===void 0&&(hl=el),hl(e,{readable:t,writable:r},function(s){if(s)return n(s);i=!0,n()});var a=!1;return function(s){if(i)return;if(a)return;if(a=!0,fC(e))return e.abort();if(typeof e.destroy=="function")return e.destroy();n(s||new pC("pipe"))}}function $f(e){e()}function gC(e,t){return e.pipe(t)}function bC(e){return e.length?typeof e[e.length-1]!="function"?Gf:e.pop():Gf}function yC(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=bC(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new dC("streams");var i,a=t.map(function(s,c){var o=c<t.length-1,u=c>0;return mC(s,o,u,function(l){if(i||(i=l),l&&a.forEach($f),o)return;a.forEach($f),n(i)})});return t.reduce(gC)}var vC=yC,wC=le(function(e,t){t=e.exports=rl,t.Stream=t,t.Readable=t,t.Writable=qo,t.Duplex=$n,t.Transform=ll,t.PassThrough=lC,t.finished=el,t.pipeline=vC});/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let Vf;var dl=typeof queueMicrotask=="function"?queueMicrotask:e=>(Vf||(Vf=Promise.resolve())).then(e).catch(t=>setTimeout(()=>{throw t},0));/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var _C=te("simple-peer"),pl=64*1024,EC=5*1e3,SC=5*1e3;function Hf(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}function AC(e){console.warn(e)}class Oa extends wC.Duplex{constructor(e){if(e=Object.assign({allowHalfOpen:!1},e),super(e),this._id=mf(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||mf(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||Oa.channelConfig,this.negotiated=this.channelConfig.negotiated,this.config=Object.assign({},Oa.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(t=>t),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||EC,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:pf(),!this._wrtc)throw typeof window=="undefined"?$(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):$(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=this.negotiated?!1:!this.initiator,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._firstStable=!0,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(t){dl(()=>this.destroy($(t,"ERR_PC_CONSTRUCTOR")));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=t=>{this._onIceCandidate(t)},this.initiator||this.negotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=t=>{this._setupData(t)},this.streams&&this.streams.forEach(t=>{this.addStream(t)}),this._pc.ontrack=t=>{this._onTrack(t)},this.initiator&&this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(this.destroyed)throw $(new Error("cannot signal after peer is destroyed"),"ERR_SIGNALING");if(typeof e=="string")try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{if(this.destroyed)return;this._pendingCandidates.forEach(t=>{this._addIceCandidate(t)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer()}).catch(t=>{this.destroy($(t,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy($(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}_addIceCandidate(e){var t=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(t).catch(r=>{!t.address||t.address.endsWith(".local")?AC("Ignoring unsupported ICE candidate."):this.destroy($(r,"ERR_ADD_ICE_CANDIDATE"))})}send(e){this._channel.send(e)}addTransceiver(e,t){if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(r){this.destroy($(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{transceiverRequest:{kind:e,init:t}})}addStream(e){this._debug("addStream()"),e.getTracks().forEach(t=>{this.addTrack(t,e)})}addTrack(e,t){this._debug("addTrack()");var r=this._senderMap.get(e)||new Map,n=r.get(t);if(!n)n=this._pc.addTrack(e,t),r.set(t,n),this._senderMap.set(e,r),this._needsNegotiation();else throw n.removed?$(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):$(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,t,r){this._debug("replaceTrack()");var n=this._senderMap.get(e),i=n?n.get(r):null;if(!i)throw $(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,n),i.replaceTrack!=null?i.replaceTrack(t):this.destroy($(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,t){this._debug("removeSender()");var r=this._senderMap.get(e),n=r?r.get(t):null;if(!n)throw $(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{n.removed=!0,this._pc.removeTrack(n)}catch(i){i.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(n):this.destroy($(i,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){this._debug("removeSenders()"),e.getTracks().forEach(t=>{this.removeTrack(t,e)})}_needsNegotiation(){if(this._debug("_needsNegotiation"),this._batchedNegotiation)return;this._batchedNegotiation=!0,dl(()=>{this._batchedNegotiation=!1,this._debug("starting batched negotiation"),this.negotiate()})}negotiate(){this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{renegotiate:!0})),this._isNegotiating=!0}_destroy(e,t){if(this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(r){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(r){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,t(e)}_setupData(e){if(!e.channel)return this.destroy($(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=pl),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{this.destroy($(r,"ERR_DATA_CHANNEL"))};var t=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(t&&this._onChannelClose(),t=!0):t=!1},SC)}_read(){}_write(e,t,r){if(this.destroyed)return r($(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(n){return this.destroy($(n,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>pl?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){if(this.destroyed)return;if(this._iceCompleteTimer)return;this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout)}_createOffer(){if(this.destroyed)return;this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Hf(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;var i=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:i.type,sdp:i.sdp})},r=()=>{if(this._debug("createOffer success"),this.destroyed)return;this.trickle||this._iceComplete?t():this.once("_iceComplete",t)},n=i=>{this.destroy($(i,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(n)}).catch(e=>{this.destroy($(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){if(this.destroyed)return;this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Hf(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;var i=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:i.type,sdp:i.sdp}),this.initiator||this._requestMissingTransceivers()},r=()=>{if(this.destroyed)return;this.trickle||this._iceComplete?t():this.once("_iceComplete",t)},n=i=>{this.destroy($(i,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(n)}).catch(e=>{this.destroy($(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){if(this.destroyed)return;this._pc.connectionState==="failed"&&this.destroy($(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy($(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy($(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const t=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(n=>{Object.assign(r,n)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{var n=[];r.forEach(i=>{n.push(t(i))}),e(null,n)},r=>e(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;var n=[];r.result().forEach(i=>{var a={};i.names().forEach(s=>{a[s]=i.stat(s)}),a.id=i.id,a.type=i.type,a.timestamp=i.timestamp,n.push(t(a))}),e(null,n)},r=>e(r)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{if(this.destroyed)return;this.getStats((t,r)=>{if(this.destroyed)return;t&&(r=[]);var n={},i={},a={},s=!1;r.forEach(u=>{(u.type==="remotecandidate"||u.type==="remote-candidate")&&(n[u.id]=u),(u.type==="localcandidate"||u.type==="local-candidate")&&(i[u.id]=u),(u.type==="candidatepair"||u.type==="candidate-pair")&&(a[u.id]=u)});const c=u=>{s=!0;var l=i[u.localCandidateId];l&&(l.ip||l.address)?(this.localAddress=l.ip||l.address,this.localPort=Number(l.port)):l&&l.ipAddress?(this.localAddress=l.ipAddress,this.localPort=Number(l.portNumber)):typeof u.googLocalAddress=="string"&&(l=u.googLocalAddress.split(":"),this.localAddress=l[0],this.localPort=Number(l[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");var f=n[u.remoteCandidateId];f&&(f.ip||f.address)?(this.remoteAddress=f.ip||f.address,this.remotePort=Number(f.port)):f&&f.ipAddress?(this.remoteAddress=f.ipAddress,this.remotePort=Number(f.portNumber)):typeof u.googRemoteAddress=="string"&&(f=u.googRemoteAddress.split(":"),this.remoteAddress=f[0],this.remotePort=Number(f[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(u=>{u.type==="transport"&&u.selectedCandidatePairId&&c(a[u.selectedCandidatePairId]),(u.type==="googCandidatePair"&&u.googActiveConnection==="true"||(u.type==="candidatepair"||u.type==="candidate-pair")&&u.selected)&&c(u)}),!s&&(!Object.keys(a).length||Object.keys(i).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(u){return this.destroy($(u,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');var o=this._cb;this._cb=null,o(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){if(!this._cb||!this._channel||this._channel.bufferedAmount>pl)return;this._onChannelBufferedAmountLow()}_onSignalingStateChange(){if(this.destroyed)return;this._pc.signalingState==="stable"&&!this._firstStable&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation&&(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()),this._debug("negotiate"),this.emit("negotiate")),this._firstStable=!1,this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState)}_onIceCandidate(e){if(this.destroyed)return;e.candidate&&this.trickle?this.emit("signal",{candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout()}_onChannelMessage(e){if(this.destroyed)return;var t=e.data;t instanceof ArrayBuffer&&(t=new Uint8Array(t)),this.push(t)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var e=this._cb;this._cb=null,e(null)}_onChannelOpen(){if(this._connected||this.destroyed)return;this._debug("on channel open"),this._channelReady=!0,this._maybeReady()}_onChannelClose(){if(this.destroyed)return;this._debug("on channel close"),this.destroy()}_onTrack(e){if(this.destroyed)return;e.streams.forEach(t=>{if(this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),this._remoteStreams.some(r=>r.id===t.id))return;this._remoteStreams.push(t),dl(()=>{this.emit("stream",t)})})}_debug(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],_C.apply(null,e)}}Oa.WEBRTC_SUPPORT=!!pf(),Oa.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},Oa.channelConfig={};var zf=Oa;(function(){if(typeof globalThis=="object")return;Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__})();var Kf=globalThis,TC={supportsFileReader:typeof self!="undefined"&&"FileReader"in self,supportsWebRTC:"RTCPeerConnection"in Kf&&(typeof navigator!="undefined"&&typeof navigator.mediaDevices!="undefined")&&"getUserMedia"in navigator.mediaDevices,supportsWebRTCDataChannels:"RTCPeerConnection"in Kf},CC=421,IC=290,RC=2e3,fl={CODE_P2P:CC,CODE_CIRCUIT:IC,CLOSE_TIMEOUT:RC},kC=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,PC=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],ml=function(t){var r=t,n=t.indexOf("["),i=t.indexOf("]");n!=-1&&i!=-1&&(t=t.substring(0,n)+t.substring(n,i).replace(/:/g,";")+t.substring(i,t.length));for(var a=kC.exec(t||""),s={},c=14;c--;)s[PC[c]]=a[c]||"";return n!=-1&&i!=-1&&(s.source=r,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=NC(s,s.path),s.queryKey=OC(s,s.query),s};function NC(e,t){var r=/\/{2,9}/g,n=t.replace(r,"/").split("/");return(t.substr(0,1)=="/"||t.length===0)&&n.splice(0,1),t.substr(t.length-1,1)=="/"&&n.splice(n.length-1,1),n}function OC(e,t){var r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,a){i&&(r[i]=a)}),r}var Is=1e3,Rs=Is*60,ks=Rs*60,Ps=ks*24,DC=Ps*365.25,MC=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return xC(e);if(r==="number"&&isNaN(e)===!1)return t.long?LC(e):BC(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function xC(e){if(e=String(e),e.length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*DC;case"days":case"day":case"d":return r*Ps;case"hours":case"hour":case"hrs":case"hr":case"h":return r*ks;case"minutes":case"minute":case"mins":case"min":case"m":return r*Rs;case"seconds":case"second":case"secs":case"sec":case"s":return r*Is;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}function BC(e){return e>=Ps?Math.round(e/Ps)+"d":e>=ks?Math.round(e/ks)+"h":e>=Rs?Math.round(e/Rs)+"m":e>=Is?Math.round(e/Is)+"s":e+"ms"}function LC(e){return Qo(e,Ps,"day")||Qo(e,ks,"hour")||Qo(e,Rs,"minute")||Qo(e,Is,"second")||e+" ms"}function Qo(e,t,r){return e<t?void 0:e<t*1.5?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var jC=le(function(e,t){t=e.exports=n.debug=n.default=n,t.coerce=o,t.disable=s,t.enable=a,t.enabled=c,t.humanize=MC,t.instances=[],t.names=[],t.skips=[],t.formatters={};function r(u){var l=0,f;for(f in u)l=(l<<5)-l+u.charCodeAt(f),l|=0;return t.colors[Math.abs(l)%t.colors.length]}function n(u){var l;function f(){if(!f.enabled)return;var _=f,p=+new Date,I=p-(l||p);_.diff=I,_.prev=l,_.curr=p,l=p;for(var d=new Array(arguments.length),v=0;v<d.length;v++)d[v]=arguments[v];d[0]=t.coerce(d[0]),typeof d[0]!="string"&&d.unshift("%O");var A=0;d[0]=d[0].replace(/%([a-zA-Z%])/g,function(O,m){if(O==="%%")return O;A++;var b=t.formatters[m];if(typeof b=="function"){var S=d[A];O=b.call(_,S),d.splice(A,1),A--}return O}),t.formatArgs.call(_,d);var j=f.log||t.log||console.log.bind(console);j.apply(_,d)}return f.namespace=u,f.enabled=t.enabled(u),f.useColors=t.useColors(),f.color=r(u),f.destroy=i,typeof t.init=="function"&&t.init(f),t.instances.push(f),f}function i(){var u=t.instances.indexOf(this);return u!==-1?(t.instances.splice(u,1),!0):!1}function a(u){t.save(u),t.names=[],t.skips=[];var l,f=(typeof u=="string"?u:"").split(/[\s,]+/),_=f.length;for(l=0;l<_;l++){if(!f[l])continue;u=f[l].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$"))}for(l=0;l<t.instances.length;l++){var p=t.instances[l];p.enabled=t.enabled(p.namespace)}}function s(){t.enable("")}function c(u){if(u[u.length-1]==="*")return!0;var l,f;for(l=0,f=t.skips.length;l<f;l++)if(t.skips[l].test(u))return!1;for(l=0,f=t.names.length;l<f;l++)if(t.names[l].test(u))return!0;return!1}function o(u){return u instanceof Error?u.stack||u.message:u}}),Yo=le(function(e,t){t=e.exports=jC,t.log=i,t.formatArgs=n,t.save=a,t.load=s,t.useColors=r,t.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:c(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&window.process.type==="renderer"?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}t.formatters.j=function(o){try{return JSON.stringify(o)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}};function n(o){var u=this.useColors;if(o[0]=(u?"%c":"")+this.namespace+(u?" %c":" ")+o[0]+(u?"%c ":" ")+"+"+t.humanize(this.diff),!u)return;var l="color: "+this.color;o.splice(1,0,l,"color: inherit");var f=0,_=0;o[0].replace(/%[a-zA-Z%]/g,function(p){if(p==="%%")return;f++,p==="%c"&&(_=f)}),o.splice(_,0,l)}function i(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(o){try{o==null?t.storage.removeItem("debug"):t.storage.debug=o}catch(u){}}function s(){var o;try{o=t.storage.debug}catch(u){}return!o&&typeof _e!="undefined"&&"env"in _e&&(o=_e.env.DEBUG),o}t.enable(s());function c(){try{return window.localStorage}catch(o){}}}),Wf=Yo("socket.io-client:url"),UC=FC;function FC(e,t){var r=e;t=t||typeof location!="undefined"&&location,e==null&&(e=t.protocol+"//"+t.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=t.protocol+e:e=t.host+e),/^(https?|wss?):\/\//.test(e)||(Wf("protocol-less url %s",e),typeof t!="undefined"?e=t.protocol+"//"+e:e="https://"+e),Wf("parse %s",e),r=ml(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var n=r.host.indexOf(":")!==-1,i=n?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}var Ns=1e3,Os=Ns*60,Ds=Os*60,Ms=Ds*24,qC=Ms*365.25,GC=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return $C(e);if(r==="number"&&isNaN(e)===!1)return t.long?HC(e):VC(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function $C(e){if(e=String(e),e.length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*qC;case"days":case"day":case"d":return r*Ms;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Ds;case"minutes":case"minute":case"mins":case"min":case"m":return r*Os;case"seconds":case"second":case"secs":case"sec":case"s":return r*Ns;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}function VC(e){return e>=Ms?Math.round(e/Ms)+"d":e>=Ds?Math.round(e/Ds)+"h":e>=Os?Math.round(e/Os)+"m":e>=Ns?Math.round(e/Ns)+"s":e+"ms"}function HC(e){return Jo(e,Ms,"day")||Jo(e,Ds,"hour")||Jo(e,Os,"minute")||Jo(e,Ns,"second")||e+" ms"}function Jo(e,t,r){return e<t?void 0:e<t*1.5?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var zC=le(function(e,t){t=e.exports=n.debug=n.default=n,t.coerce=o,t.disable=s,t.enable=a,t.enabled=c,t.humanize=GC,t.instances=[],t.names=[],t.skips=[],t.formatters={};function r(u){var l=0,f;for(f in u)l=(l<<5)-l+u.charCodeAt(f),l|=0;return t.colors[Math.abs(l)%t.colors.length]}function n(u){var l;function f(){if(!f.enabled)return;var _=f,p=+new Date,I=p-(l||p);_.diff=I,_.prev=l,_.curr=p,l=p;for(var d=new Array(arguments.length),v=0;v<d.length;v++)d[v]=arguments[v];d[0]=t.coerce(d[0]),typeof d[0]!="string"&&d.unshift("%O");var A=0;d[0]=d[0].replace(/%([a-zA-Z%])/g,function(O,m){if(O==="%%")return O;A++;var b=t.formatters[m];if(typeof b=="function"){var S=d[A];O=b.call(_,S),d.splice(A,1),A--}return O}),t.formatArgs.call(_,d);var j=f.log||t.log||console.log.bind(console);j.apply(_,d)}return f.namespace=u,f.enabled=t.enabled(u),f.useColors=t.useColors(),f.color=r(u),f.destroy=i,typeof t.init=="function"&&t.init(f),t.instances.push(f),f}function i(){var u=t.instances.indexOf(this);return u!==-1?(t.instances.splice(u,1),!0):!1}function a(u){t.save(u),t.names=[],t.skips=[];var l,f=(typeof u=="string"?u:"").split(/[\s,]+/),_=f.length;for(l=0;l<_;l++){if(!f[l])continue;u=f[l].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$"))}for(l=0;l<t.instances.length;l++){var p=t.instances[l];p.enabled=t.enabled(p.namespace)}}function s(){t.enable("")}function c(u){if(u[u.length-1]==="*")return!0;var l,f;for(l=0,f=t.skips.length;l<f;l++)if(t.skips[l].test(u))return!1;for(l=0,f=t.names.length;l<f;l++)if(t.names[l].test(u))return!0;return!1}function o(u){return u instanceof Error?u.stack||u.message:u}}),KC=le(function(e,t){t=e.exports=zC,t.log=i,t.formatArgs=n,t.save=a,t.load=s,t.useColors=r,t.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:c(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&window.process.type==="renderer"?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}t.formatters.j=function(o){try{return JSON.stringify(o)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}};function n(o){var u=this.useColors;if(o[0]=(u?"%c":"")+this.namespace+(u?" %c":" ")+o[0]+(u?"%c ":" ")+"+"+t.humanize(this.diff),!u)return;var l="color: "+this.color;o.splice(1,0,l,"color: inherit");var f=0,_=0;o[0].replace(/%[a-zA-Z%]/g,function(p){if(p==="%%")return;f++,p==="%c"&&(_=f)}),o.splice(_,0,l)}function i(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(o){try{o==null?t.storage.removeItem("debug"):t.storage.debug=o}catch(u){}}function s(){var o;try{o=t.storage.debug}catch(u){}return!o&&typeof _e!="undefined"&&"env"in _e&&(o=_e.env.DEBUG),o}t.enable(s());function c(){try{return window.localStorage}catch(o){}}}),zi=le(function(e){e.exports=t;function t(n){if(n)return r(n)}function r(n){for(var i in t.prototype)n[i]=t.prototype[i];return n}t.prototype.on=t.prototype.addEventListener=function(n,i){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(i),this},t.prototype.once=function(n,i){function a(){this.off(n,a),i.apply(this,arguments)}return a.fn=i,this.on(n,a),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(n,i){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var a=this._callbacks["$"+n];if(!a)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var s,c=0;c<a.length;c++)if(s=a[c],s===i||s.fn===i){a.splice(c,1);break}return a.length===0&&delete this._callbacks["$"+n],this},t.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var i=new Array(arguments.length-1),a=this._callbacks["$"+n],s=1;s<arguments.length;s++)i[s-1]=arguments[s];if(a){a=a.slice(0);for(var s=0,c=a.length;s<c;++s)a[s].apply(this,i)}return this},t.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]},t.prototype.hasListeners=function(n){return!!this.listeners(n).length}}),WC={}.toString,xs=Array.isArray||function(e){return WC.call(e)=="[object Array]"},gl=JC,XC=typeof Buffer=="function"&&typeof Buffer.isBuffer=="function",QC=typeof ArrayBuffer=="function",YC=function(e){return typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer};function JC(e){return XC&&Buffer.isBuffer(e)||QC&&(e instanceof ArrayBuffer||YC(e))}var Xf=Object.prototype.toString,ZC=typeof Blob=="function"||typeof Blob!="undefined"&&Xf.call(Blob)==="[object BlobConstructor]",eI=typeof File=="function"||typeof File!="undefined"&&Xf.call(File)==="[object FileConstructor]",tI=function(e){var t=[],r=e.data,n=e;return n.data=bl(r,t),n.attachments=t.length,{packet:n,buffers:t}};function bl(e,t){if(!e)return e;if(gl(e)){var r={_placeholder:!0,num:t.length};return t.push(e),r}else if(xs(e)){for(var n=new Array(e.length),i=0;i<e.length;i++)n[i]=bl(e[i],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){var n={};for(var a in e)n[a]=bl(e[a],t);return n}return e}var rI=function(e,t){return e.data=yl(e.data,t),e.attachments=void 0,e};function yl(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(xs(e))for(var r=0;r<e.length;r++)e[r]=yl(e[r],t);else if(typeof e=="object")for(var n in e)e[n]=yl(e[n],t);return e}var nI=function(e,t){function r(a,s,c){if(!a)return a;if(ZC&&a instanceof Blob||eI&&a instanceof File){n++;var o=new FileReader;o.onload=function(){c?c[s]=this.result:i=this.result,--n||t(i)},o.readAsArrayBuffer(a)}else if(xs(a))for(var u=0;u<a.length;u++)r(a[u],u,a);else if(typeof a=="object"&&!gl(a))for(var l in a)r(a[l],l,a)}var n=0,i=e;r(i),n||t(i)},vl={deconstructPacket:tI,reconstructPacket:rI,removeBlobs:nI},kt=le(function(e,t){var r=KC("socket.io-parser");t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=n,t.Decoder=o;function n(){}var i=t.ERROR+'"encode error"';n.prototype.encode=function(p,I){if(r("encoding packet %j",p),t.BINARY_EVENT===p.type||t.BINARY_ACK===p.type)c(p,I);else{var d=a(p);I([d])}};function a(p){var I=""+p.type;if((t.BINARY_EVENT===p.type||t.BINARY_ACK===p.type)&&(I+=p.attachments+"-"),p.nsp&&p.nsp!=="/"&&(I+=p.nsp+","),p.id!=null&&(I+=p.id),p.data!=null){var d=s(p.data);if(d!==!1)I+=d;else return i}return r("encoded %j as %s",p,I),I}function s(p){try{return JSON.stringify(p)}catch(I){return!1}}function c(p,I){function d(v){var A=vl.deconstructPacket(v),j=a(A.packet),O=A.buffers;O.unshift(j),I(O)}vl.removeBlobs(p,d)}function o(){this.reconstructor=null}zi(o.prototype),o.prototype.add=function(p){var I;if(typeof p=="string")I=u(p),t.BINARY_EVENT===I.type||t.BINARY_ACK===I.type?(this.reconstructor=new f(I),this.reconstructor.reconPack.attachments===0&&this.emit("decoded",I)):this.emit("decoded",I);else if(gl(p)||p.base64)if(this.reconstructor)I=this.reconstructor.takeBinaryData(p),I&&(this.reconstructor=null,this.emit("decoded",I));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+p)};function u(p){var I=0,d={type:Number(p.charAt(0))};if(t.types[d.type]==null)return _("unknown packet type "+d.type);if(t.BINARY_EVENT===d.type||t.BINARY_ACK===d.type){for(var v="";p.charAt(++I)!=="-"&&!(v+=p.charAt(I),I==p.length););if(v!=Number(v)||p.charAt(I)!=="-")throw new Error("Illegal attachments");d.attachments=Number(v)}if(p.charAt(I+1)==="/")for(d.nsp="";++I;){var A=p.charAt(I);if(A===",")break;if(d.nsp+=A,I===p.length)break}else d.nsp="/";var j=p.charAt(I+1);if(j!==""&&Number(j)==j){for(d.id="";++I;){var A=p.charAt(I);if(A==null||Number(A)!=A){--I;break}if(d.id+=p.charAt(I),I===p.length)break}d.id=Number(d.id)}if(p.charAt(++I)){var O=l(p.substr(I)),m=O!==!1&&(d.type===t.ERROR||xs(O));if(m)d.data=O;else return _("invalid payload")}return r("decoded %s as %j",p,d),d}function l(p){try{return JSON.parse(p)}catch(I){return!1}}o.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};function f(p){this.reconPack=p,this.buffers=[]}f.prototype.takeBinaryData=function(p){if(this.buffers.push(p),this.buffers.length===this.reconPack.attachments){var I=vl.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),I}return null},f.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]};function _(p){return{type:t.ERROR,data:"parser error: "+p}}}),iI=le(function(e){try{e.exports=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}}),Zo=function(){return typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")()}(),wl=function(e){var t=e.xdomain,r=e.xscheme,n=e.enablesXDR;try{if(typeof XMLHttpRequest!="undefined"&&(!t||iI))return new XMLHttpRequest}catch(i){}try{if(typeof XDomainRequest!="undefined"&&!r&&n)return new XDomainRequest}catch(i){}if(!t)try{return new Zo[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(i){}},aI=Object.keys||function(t){var r=[],n=Object.prototype.hasOwnProperty;for(var i in t)n.call(t,i)&&r.push(i);return r},Qf=Object.prototype.toString,sI=typeof Blob=="function"||typeof Blob!="undefined"&&Qf.call(Blob)==="[object BlobConstructor]",oI=typeof File=="function"||typeof File!="undefined"&&Qf.call(File)==="[object FileConstructor]",_l=ec;function ec(e){if(!e||typeof e!="object")return!1;if(xs(e)){for(var t=0,r=e.length;t<r;t++)if(ec(e[t]))return!0;return!1}if(typeof Buffer=="function"&&Buffer.isBuffer&&Buffer.isBuffer(e)||typeof ArrayBuffer=="function"&&e instanceof ArrayBuffer||sI&&e instanceof Blob||oI&&e instanceof File)return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return ec(e.toJSON(),!0);for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&ec(e[n]))return!0;return!1}var tc=function(e,t,r){var n=e.byteLength;if(t=t||0,r=r||n,e.slice)return e.slice(t,r);if(t<0&&(t+=n),r<0&&(r+=n),r>n&&(r=n),t>=n||t>=r||n===0)return new ArrayBuffer(0);for(var i=new Uint8Array(e),a=new Uint8Array(r-t),s=t,c=0;s<r;s++,c++)a[c]=i[s];return a.buffer},cI=uI;function uI(e,t,r){var n=!1;return r=r||lI,i.count=e,e===0?t():i;function i(a,s){if(i.count<=0)throw new Error("after called too many times");--i.count,a?(n=!0,t(a),t=r):i.count===0&&!n&&t(null,s)}}function lI(){}/*! https://mths.be/utf8js v2.1.2 by @mathias */var mi=String.fromCharCode;function Yf(e){for(var t=[],r=0,n=e.length,i,a;r<n;)i=e.charCodeAt(r++),i>=55296&&i<=56319&&r<n?(a=e.charCodeAt(r++),(a&64512)==56320?t.push(((i&1023)<<10)+(a&1023)+65536):(t.push(i),r--)):t.push(i);return t}function hI(e){for(var t=e.length,r=-1,n,i="";++r<t;)n=e[r],n>65535&&(n-=65536,i+=mi(n>>>10&1023|55296),n=56320|n&1023),i+=mi(n);return i}function Jf(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function El(e,t){return mi(e>>t&63|128)}function dI(e,t){if((e&4294967168)==0)return mi(e);var r="";return(e&4294965248)==0?r=mi(e>>6&31|192):(e&4294901760)==0?(Jf(e,t)||(e=65533),r=mi(e>>12&15|224),r+=El(e,6)):(e&4292870144)==0&&(r=mi(e>>18&7|240),r+=El(e,12),r+=El(e,6)),r+=mi(e&63|128),r}function pI(e,t){t=t||{};for(var r=t.strict!==!1,n=Yf(e),i=n.length,a=-1,s,c="";++a<i;)s=n[a],c+=dI(s,r);return c}function Da(){if(gi>=nc)throw Error("Invalid byte index");var e=rc[gi]&255;if(gi++,(e&192)==128)return e&63;throw Error("Invalid continuation byte")}function fI(e){var t,r,n,i,a;if(gi>nc)throw Error("Invalid byte index");if(gi==nc)return!1;if(t=rc[gi]&255,gi++,(t&128)==0)return t;if((t&224)==192){if(r=Da(),a=(t&31)<<6|r,a>=128)return a;throw Error("Invalid continuation byte")}if((t&240)==224){if(r=Da(),n=Da(),a=(t&15)<<12|r<<6|n,a>=2048)return Jf(a,e)?a:65533;throw Error("Invalid continuation byte")}if((t&248)==240&&(r=Da(),n=Da(),i=Da(),a=(t&7)<<18|r<<12|n<<6|i,a>=65536&&a<=1114111))return a;throw Error("Invalid UTF-8 detected")}var rc,nc,gi;function mI(e,t){t=t||{};var r=t.strict!==!1;rc=Yf(e),nc=rc.length,gi=0;for(var n=[],i;(i=fI(r))!==!1;)n.push(i);return hI(n)}var Zf={version:"2.1.2",encode:pI,decode:mI},gI=le(function(e,t){(function(r){t.encode=function(n){var i=new Uint8Array(n),a,s=i.length,c="";for(a=0;a<s;a+=3)c+=r[i[a]>>2],c+=r[(i[a]&3)<<4|i[a+1]>>4],c+=r[(i[a+1]&15)<<2|i[a+2]>>6],c+=r[i[a+2]&63];return s%3===2?c=c.substring(0,c.length-1)+"=":s%3===1&&(c=c.substring(0,c.length-2)+"=="),c},t.decode=function(n){var i=n.length*.75,a=n.length,s,c=0,o,u,l,f;n[n.length-1]==="="&&(i--,n[n.length-2]==="="&&i--);var _=new ArrayBuffer(i),p=new Uint8Array(_);for(s=0;s<a;s+=4)o=r.indexOf(n[s]),u=r.indexOf(n[s+1]),l=r.indexOf(n[s+2]),f=r.indexOf(n[s+3]),p[c++]=o<<2|u>>4,p[c++]=(u&15)<<4|l>>2,p[c++]=(l&3)<<6|f&63;return _}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")}),Ma=typeof Ma!="undefined"?Ma:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:!1,em=function(){try{var e=new Blob(["hi"]);return e.size===2}catch(t){return!1}}(),bI=em&&function(){try{var e=new Blob([new Uint8Array([1,2])]);return e.size===2}catch(t){return!1}}(),yI=Ma&&Ma.prototype.append&&Ma.prototype.getBlob;function tm(e){return e.map(function(t){if(t.buffer instanceof ArrayBuffer){var r=t.buffer;if(t.byteLength!==r.byteLength){var n=new Uint8Array(t.byteLength);n.set(new Uint8Array(r,t.byteOffset,t.byteLength)),r=n.buffer}return r}return t})}function rm(e,t){t=t||{};var r=new Ma;return tm(e).forEach(function(n){r.append(n)}),t.type?r.getBlob(t.type):r.getBlob()}function nm(e,t){return new Blob(tm(e),t||{})}typeof Blob!="undefined"&&(rm.prototype=Blob.prototype,nm.prototype=Blob.prototype);var fr=function(){return em?bI?Blob:nm:yI?rm:void 0}(),bi=le(function(e,t){var r;typeof ArrayBuffer!="undefined"&&(r=gI);var n=typeof navigator!="undefined"&&/Android/i.test(navigator.userAgent),i=typeof navigator!="undefined"&&/PhantomJS/i.test(navigator.userAgent),a=n||i;t.protocol=3;var s=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},c=aI(s),o={type:"error",data:"parser error"};t.encodePacket=function(d,v,A,j){typeof v=="function"&&(j=v,v=!1),typeof A=="function"&&(j=A,A=null);var O=d.data===void 0?void 0:d.data.buffer||d.data;if(typeof ArrayBuffer!="undefined"&&O instanceof ArrayBuffer)return l(d,v,j);if(typeof fr!="undefined"&&O instanceof fr)return _(d,v,j);if(O&&O.base64)return u(d,j);var m=s[d.type];return d.data!==void 0&&(m+=A?Zf.encode(String(d.data),{strict:!1}):String(d.data)),j(""+m)};function u(d,v){var A="b"+t.packets[d.type]+d.data.data;return v(A)}function l(d,v,A){if(!v)return t.encodeBase64Packet(d,A);var j=d.data,O=new Uint8Array(j),m=new Uint8Array(1+j.byteLength);m[0]=s[d.type];for(var b=0;b<O.length;b++)m[b+1]=O[b];return A(m.buffer)}function f(d,v,A){if(!v)return t.encodeBase64Packet(d,A);var j=new FileReader;return j.onload=function(){t.encodePacket({type:d.type,data:j.result},v,!0,A)},j.readAsArrayBuffer(d.data)}function _(d,v,A){if(!v)return t.encodeBase64Packet(d,A);if(a)return f(d,v,A);var j=new Uint8Array(1);j[0]=s[d.type];var O=new fr([j.buffer,d.data]);return A(O)}t.encodeBase64Packet=function(d,v){var A="b"+t.packets[d.type];if(typeof fr!="undefined"&&d.data instanceof fr){var j=new FileReader;return j.onload=function(){var h=j.result.split(",")[1];v(A+h)},j.readAsDataURL(d.data)}var O;try{O=String.fromCharCode.apply(null,new Uint8Array(d.data))}catch(h){for(var m=new Uint8Array(d.data),b=new Array(m.length),S=0;S<m.length;S++)b[S]=m[S];O=String.fromCharCode.apply(null,b)}return A+=btoa(O),v(A)},t.decodePacket=function(d,v,A){if(d===void 0)return o;if(typeof d=="string"){if(d.charAt(0)==="b")return t.decodeBase64Packet(d.substr(1),v);if(A&&(d=p(d),d===!1))return o;var O=d.charAt(0);return Number(O)!=O||!c[O]?o:d.length>1?{type:c[O],data:d.substring(1)}:{type:c[O]}}var j=new Uint8Array(d),O=j[0],m=tc(d,1);return fr&&v==="blob"&&(m=new fr([m])),{type:c[O],data:m}};function p(d){try{d=Zf.decode(d,{strict:!1})}catch(v){return!1}return d}t.decodeBase64Packet=function(d,v){var A=c[d.charAt(0)];if(!r)return{type:A,data:{base64:!0,data:d.substr(1)}};var j=r.decode(d.substr(1));return v==="blob"&&fr&&(j=new fr([j])),{type:A,data:j}},t.encodePayload=function(d,v,A){typeof v=="function"&&(A=v,v=null);var j=_l(d);if(v&&j)return fr&&!a?t.encodePayloadAsBlob(d,A):t.encodePayloadAsArrayBuffer(d,A);if(!d.length)return A("0:");function O(b){return b.length+":"+b}function m(b,S){t.encodePacket(b,j?v:!1,!1,function(h){S(null,O(h))})}I(d,m,function(b,S){return A(S.join(""))})};function I(d,v,A){for(var j=new Array(d.length),O=cI(d.length,A),m=function(S,h,g){v(h,function(w,y){j[S]=y,g(w,j)})},b=0;b<d.length;b++)m(b,d[b],O)}t.decodePayload=function(d,v,A){if(typeof d!="string")return t.decodePayloadAsBinary(d,v,A);typeof v=="function"&&(A=v,v=null);var j;if(d==="")return A(o,0,1);for(var O="",m,b,S=0,h=d.length;S<h;S++){var g=d.charAt(S);if(g!==":"){O+=g;continue}if(O===""||O!=(m=Number(O)))return A(o,0,1);if(b=d.substr(S+1,m),O!=b.length)return A(o,0,1);if(b.length){if(j=t.decodePacket(b,v,!1),o.type===j.type&&o.data===j.data)return A(o,0,1);var w=A(j,S+m,h);if(w===!1)return}S+=m,O=""}if(O!=="")return A(o,0,1)},t.encodePayloadAsArrayBuffer=function(d,v){if(!d.length)return v(new ArrayBuffer(0));function A(j,O){t.encodePacket(j,!0,!0,function(m){return O(null,m)})}I(d,A,function(j,O){var m=O.reduce(function(h,g){var w;return typeof g=="string"?w=g.length:w=g.byteLength,h+w.toString().length+w+2},0),b=new Uint8Array(m),S=0;return O.forEach(function(h){var g=typeof h=="string",w=h;if(g){for(var D=new Uint8Array(h.length),y=0;y<h.length;y++)D[y]=h.charCodeAt(y);w=D.buffer}g?b[S++]=0:b[S++]=1;for(var P=w.byteLength.toString(),y=0;y<P.length;y++)b[S++]=parseInt(P[y]);b[S++]=255;for(var D=new Uint8Array(w),y=0;y<D.length;y++)b[S++]=D[y]}),v(b.buffer)})},t.encodePayloadAsBlob=function(d,v){function A(j,O){t.encodePacket(j,!0,!0,function(m){var b=new Uint8Array(1);if(b[0]=1,typeof m=="string"){for(var S=new Uint8Array(m.length),h=0;h<m.length;h++)S[h]=m.charCodeAt(h);m=S.buffer,b[0]=0}for(var g=m instanceof ArrayBuffer?m.byteLength:m.size,w=g.toString(),y=new Uint8Array(w.length+1),h=0;h<w.length;h++)y[h]=parseInt(w[h]);if(y[w.length]=255,fr){var P=new fr([b.buffer,y.buffer,m]);O(null,P)}})}I(d,A,function(j,O){return v(new fr(O))})},t.decodePayloadAsBinary=function(d,v,A){typeof v=="function"&&(A=v,v=null);for(var j=d,O=[];j.byteLength>0;){for(var m=new Uint8Array(j),b=m[0]===0,S="",h=1;!(m[h]===255);h++){if(S.length>310)return A(o,0,1);S+=m[h]}j=tc(j,2+S.length),S=parseInt(S);var g=tc(j,0,S);if(b)try{g=String.fromCharCode.apply(null,new Uint8Array(g))}catch(P){var w=new Uint8Array(g);g="";for(var h=0;h<w.length;h++)g+=String.fromCharCode(w[h])}O.push(g),j=tc(j,S)}var y=O.length;O.forEach(function(P,D){A(t.decodePacket(P,v,!0),D,y)})}}),xa=Tn;function Tn(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}zi(Tn.prototype),Tn.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},Tn.prototype.open=function(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this},Tn.prototype.close=function(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this},Tn.prototype.send=function(e){if(this.readyState==="open")this.write(e);else throw new Error("Transport not open")},Tn.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},Tn.prototype.onData=function(e){var t=bi.decodePacket(e,this.socket.binaryType);this.onPacket(t)},Tn.prototype.onPacket=function(e){this.emit("packet",e)},Tn.prototype.onClose=function(){this.readyState="closed",this.emit("close")};var vI=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},wI=function(e){for(var t={},r=e.split("&"),n=0,i=r.length;n<i;n++){var a=r[n].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t},ic={encode:vI,decode:wI},ac=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e},im="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),sc=64,am={},sm=0,yi=0,om;function Sl(e){var t="";do t=im[e%sc]+t,e=Math.floor(e/sc);while(e>0);return t}function _I(e){var t=0;for(yi=0;yi<e.length;yi++)t=t*sc+am[e.charAt(yi)];return t}function Al(){var e=Sl(+new Date);return e!==om?(sm=0,om=e):e+"."+Sl(sm++)}for(;yi<sc;yi++)am[im[yi]]=yi;Al.encode=Sl,Al.decode=_I;var cm=Al,Bs=1e3,Ls=Bs*60,js=Ls*60,Us=js*24,EI=Us*365.25,SI=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return AI(e);if(r==="number"&&isNaN(e)===!1)return t.long?CI(e):TI(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function AI(e){if(e=String(e),e.length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*EI;case"days":case"day":case"d":return r*Us;case"hours":case"hour":case"hrs":case"hr":case"h":return r*js;case"minutes":case"minute":case"mins":case"min":case"m":return r*Ls;case"seconds":case"second":case"secs":case"sec":case"s":return r*Bs;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}function TI(e){return e>=Us?Math.round(e/Us)+"d":e>=js?Math.round(e/js)+"h":e>=Ls?Math.round(e/Ls)+"m":e>=Bs?Math.round(e/Bs)+"s":e+"ms"}function CI(e){return oc(e,Us,"day")||oc(e,js,"hour")||oc(e,Ls,"minute")||oc(e,Bs,"second")||e+" ms"}function oc(e,t,r){return e<t?void 0:e<t*1.5?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var II=le(function(e,t){t=e.exports=n.debug=n.default=n,t.coerce=o,t.disable=s,t.enable=a,t.enabled=c,t.humanize=SI,t.instances=[],t.names=[],t.skips=[],t.formatters={};function r(u){var l=0,f;for(f in u)l=(l<<5)-l+u.charCodeAt(f),l|=0;return t.colors[Math.abs(l)%t.colors.length]}function n(u){var l;function f(){if(!f.enabled)return;var _=f,p=+new Date,I=p-(l||p);_.diff=I,_.prev=l,_.curr=p,l=p;for(var d=new Array(arguments.length),v=0;v<d.length;v++)d[v]=arguments[v];d[0]=t.coerce(d[0]),typeof d[0]!="string"&&d.unshift("%O");var A=0;d[0]=d[0].replace(/%([a-zA-Z%])/g,function(O,m){if(O==="%%")return O;A++;var b=t.formatters[m];if(typeof b=="function"){var S=d[A];O=b.call(_,S),d.splice(A,1),A--}return O}),t.formatArgs.call(_,d);var j=f.log||t.log||console.log.bind(console);j.apply(_,d)}return f.namespace=u,f.enabled=t.enabled(u),f.useColors=t.useColors(),f.color=r(u),f.destroy=i,typeof t.init=="function"&&t.init(f),t.instances.push(f),f}function i(){var u=t.instances.indexOf(this);return u!==-1?(t.instances.splice(u,1),!0):!1}function a(u){t.save(u),t.names=[],t.skips=[];var l,f=(typeof u=="string"?u:"").split(/[\s,]+/),_=f.length;for(l=0;l<_;l++){if(!f[l])continue;u=f[l].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$"))}for(l=0;l<t.instances.length;l++){var p=t.instances[l];p.enabled=t.enabled(p.namespace)}}function s(){t.enable("")}function c(u){if(u[u.length-1]==="*")return!0;var l,f;for(l=0,f=t.skips.length;l<f;l++)if(t.skips[l].test(u))return!1;for(l=0,f=t.names.length;l<f;l++)if(t.names[l].test(u))return!0;return!1}function o(u){return u instanceof Error?u.stack||u.message:u}}),cc=le(function(e,t){t=e.exports=II,t.log=i,t.formatArgs=n,t.save=a,t.load=s,t.useColors=r,t.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:c(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&window.process.type==="renderer"?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}t.formatters.j=function(o){try{return JSON.stringify(o)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}};function n(o){var u=this.useColors;if(o[0]=(u?"%c":"")+this.namespace+(u?" %c":" ")+o[0]+(u?"%c ":" ")+"+"+t.humanize(this.diff),!u)return;var l="color: "+this.color;o.splice(1,0,l,"color: inherit");var f=0,_=0;o[0].replace(/%[a-zA-Z%]/g,function(p){if(p==="%%")return;f++,p==="%c"&&(_=f)}),o.splice(_,0,l)}function i(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(o){try{o==null?t.storage.removeItem("debug"):t.storage.debug=o}catch(u){}}function s(){var o;try{o=t.storage.debug}catch(u){}return!o&&typeof _e!="undefined"&&"env"in _e&&(o=_e.env.DEBUG),o}t.enable(s());function c(){try{return window.localStorage}catch(o){}}}),Zr=cc("engine.io-client:polling"),Fs=Cn,RI=function(){var e=wl,t=new e({xdomain:!1});return t.responseType!=null}();function Cn(e){var t=e&&e.forceBase64;(!RI||t)&&(this.supportsBinary=!1),xa.call(this,e)}ac(Cn,xa),Cn.prototype.name="polling",Cn.prototype.doOpen=function(){this.poll()},Cn.prototype.pause=function(e){var t=this;this.readyState="pausing";function r(){Zr("paused"),t.readyState="paused",e()}if(this.polling||!this.writable){var n=0;this.polling&&(Zr("we are currently polling - waiting to pause"),n++,this.once("pollComplete",function(){Zr("pre-pause polling complete"),--n||r()})),this.writable||(Zr("we are currently writing - waiting to pause"),n++,this.once("drain",function(){Zr("pre-pause writing complete"),--n||r()}))}else r()},Cn.prototype.poll=function(){Zr("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},Cn.prototype.onData=function(e){var t=this;Zr("polling got data %s",e);var r=function(n,i,a){if(t.readyState==="opening"&&t.onOpen(),n.type==="close")return t.onClose(),!1;t.onPacket(n)};bi.decodePayload(e,this.socket.binaryType,r),this.readyState!=="closed"&&(this.polling=!1,this.emit("pollComplete"),this.readyState==="open"?this.poll():Zr('ignoring poll - transport state "%s"',this.readyState))},Cn.prototype.doClose=function(){var e=this;function t(){Zr("writing close packet"),e.write([{type:"close"}])}this.readyState==="open"?(Zr("transport open - closing"),t()):(Zr("transport not open - deferring close"),this.once("open",t))},Cn.prototype.write=function(e){var t=this;this.writable=!1;var r=function(){t.writable=!0,t.emit("drain")};bi.encodePayload(e,this.supportsBinary,function(n){t.doWrite(n,r)})},Cn.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";this.timestampRequests!==!1&&(e[this.timestampParam]=cm()),!this.supportsBinary&&!e.sid&&(e.b64=1),e=ic.encode(e),this.port&&(t==="https"&&Number(this.port)!==443||t==="http"&&Number(this.port)!==80)&&(r=":"+this.port),e.length&&(e="?"+e);var n=this.hostname.indexOf(":")!==-1;return t+"://"+(n?"["+this.hostname+"]":this.hostname)+r+this.path+e};var Tl=cc("engine.io-client:polling-xhr"),um=Ba,kI=bt;function lm(){}function Ba(e){if(Fs.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,typeof location!="undefined"){var t=location.protocol==="https:",r=location.port;r||(r=t?443:80),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}}ac(Ba,Fs),Ba.prototype.supportsBinary=!0,Ba.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.withCredentials=this.withCredentials,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new bt(e)},Ba.prototype.doWrite=function(e,t){var r=typeof e!="string"&&e!==void 0,n=this.request({method:"POST",data:e,isBinary:r}),i=this;n.on("success",t),n.on("error",function(a){i.onError("xhr post error",a)}),this.sendXhr=n},Ba.prototype.doPoll=function(){Tl("xhr poll");var e=this.request(),t=this;e.on("data",function(r){t.onData(r)}),e.on("error",function(r){t.onError("xhr poll error",r)}),this.pollXhr=e};function bt(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=e.async!==!1,this.data=e.data!==void 0?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}if(zi(bt.prototype),bt.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new wl(e),r=this;try{Tl("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(var n in this.extraHeaders)this.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.extraHeaders[n])}}catch(i){}if(this.method==="POST")try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(i){}try{t.setRequestHeader("Accept","*/*")}catch(i){}"withCredentials"in t&&(t.withCredentials=this.withCredentials),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){r.onLoad()},t.onerror=function(){r.onError(t.responseText)}):t.onreadystatechange=function(){if(t.readyState===2)try{var i=t.getResponseHeader("Content-Type");(r.supportsBinary&&i==="application/octet-stream"||i==="application/octet-stream; charset=UTF-8")&&(t.responseType="arraybuffer")}catch(a){}if(t.readyState!==4)return;t.status===200||t.status===1223?r.onLoad():setTimeout(function(){r.onError(typeof t.status=="number"?t.status:0)},0)},Tl("xhr data %s",this.data),t.send(this.data)}catch(i){setTimeout(function(){r.onError(i)},0);return}typeof document!="undefined"&&(this.index=bt.requestsCount++,bt.requests[this.index]=this)},bt.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},bt.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},bt.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},bt.prototype.cleanup=function(e){if(typeof this.xhr=="undefined"||this.xhr===null)return;if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=lm:this.xhr.onreadystatechange=lm,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete bt.requests[this.index],this.xhr=null},bt.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(r){}t==="application/octet-stream"||t==="application/octet-stream; charset=UTF-8"?e=this.xhr.response||this.xhr.responseText:e=this.xhr.responseText}catch(r){this.onError(r)}e!=null&&this.onData(e)},bt.prototype.hasXDR=function(){return typeof XDomainRequest!="undefined"&&!this.xs&&this.enablesXDR},bt.prototype.abort=function(){this.cleanup()},bt.requestsCount=0,bt.requests={},typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",hm);else if(typeof addEventListener=="function"){var PI="onpagehide"in Zo?"pagehide":"unload";addEventListener(PI,hm,!1)}}function hm(){for(var e in bt.requests)bt.requests.hasOwnProperty(e)&&bt.requests[e].abort()}um.Request=kI;var NI=La,OI=/\n/g,DI=/\\n/g,uc;function MI(){}function La(e){Fs.call(this,e),this.query=this.query||{},uc||(uc=Zo.___eio=Zo.___eio||[]),this.index=uc.length;var t=this;uc.push(function(r){t.onData(r)}),this.query.j=this.index,typeof addEventListener=="function"&&addEventListener("beforeunload",function(){t.script&&(t.script.onerror=MI)},!1)}ac(La,Fs),La.prototype.supportsBinary=!1,La.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),Fs.prototype.doClose.call(this)},La.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(i){e.onError("jsonp poll error",i)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t;var n=typeof navigator!="undefined"&&/gecko/i.test(navigator.userAgent);n&&setTimeout(function(){var i=document.createElement("iframe");document.body.appendChild(i),document.body.removeChild(i)},100)},La.prototype.doWrite=function(e,t){var r=this;if(!this.form){var n=document.createElement("form"),i=document.createElement("textarea"),a=this.iframeId="eio_iframe_"+this.index,s;n.className="socketio",n.style.position="absolute",n.style.top="-1000px",n.style.left="-1000px",n.target=a,n.method="POST",n.setAttribute("accept-charset","utf-8"),i.name="d",n.appendChild(i),document.body.appendChild(n),this.form=n,this.area=i}this.form.action=this.uri();function c(){o(),t()}function o(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(l){r.onError("jsonp polling iframe removal error",l)}try{var u='<iframe src="javascript:0" name="'+r.iframeId+'">';s=document.createElement(u)}catch(l){s=document.createElement("iframe"),s.name=r.iframeId,s.src="javascript:0"}s.id=r.iframeId,r.form.appendChild(s),r.iframe=s}o(),e=e.replace(DI,`\\
`),this.area.value=e.replace(OI,"\\n");try{this.form.submit()}catch(u){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){r.iframe.readyState==="complete"&&c()}:this.iframe.onload=c};var xI=cc("engine.io-client:websocket"),lc,Cl;if(typeof WebSocket!="undefined"?lc=WebSocket:typeof self!="undefined"&&(lc=self.WebSocket||self.MozWebSocket),typeof window=="undefined")try{Cl=Nn}catch(e){}var ja=lc||Cl,BI=Mr;function Mr(e){var t=e&&e.forceBase64;t&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=lc&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(ja=Cl),xa.call(this,e)}ac(Mr,xa),Mr.prototype.name="websocket",Mr.prototype.supportsBinary=!0,Mr.prototype.doOpen=function(){if(!this.check())return;var e=this.uri(),t=this.protocols,r={};this.isReactNative||(r.agent=this.agent,r.perMessageDeflate=this.perMessageDeflate,r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized),this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new ja(e,t):new ja(e):new ja(e,t,r)}catch(n){return this.emit("error",n)}this.ws.binaryType===void 0&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()},Mr.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},Mr.prototype.write=function(e){var t=this;this.writable=!1;for(var r=e.length,n=0,i=r;n<i;n++)(function(s){bi.encodePacket(s,t.supportsBinary,function(c){if(!t.usingBrowserWebSocket){var o={};if(s.options&&(o.compress=s.options.compress),t.perMessageDeflate){var u=typeof c=="string"?Buffer.byteLength(c):c.length;u<t.perMessageDeflate.threshold&&(o.compress=!1)}}try{t.usingBrowserWebSocket?t.ws.send(c):t.ws.send(c,o)}catch(l){xI("websocket closed before onclose event")}--r||a()})})(e[n]);function a(){t.emit("flush"),setTimeout(function(){t.writable=!0,t.emit("drain")},0)}},Mr.prototype.onClose=function(){xa.prototype.onClose.call(this)},Mr.prototype.doClose=function(){typeof this.ws!="undefined"&&this.ws.close()},Mr.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";this.port&&(t==="wss"&&Number(this.port)!==443||t==="ws"&&Number(this.port)!==80)&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=cm()),this.supportsBinary||(e.b64=1),e=ic.encode(e),e.length&&(e="?"+e);var n=this.hostname.indexOf(":")!==-1;return t+"://"+(n?"["+this.hostname+"]":this.hostname)+r+this.path+e},Mr.prototype.check=function(){return!!ja&&!("__initialize"in ja&&this.name===Mr.prototype.name)};var LI=UI,jI=BI;function UI(e){var t,r=!1,n=!1,i=e.jsonp!==!1;if(typeof location!="undefined"){var a=location.protocol==="https:",s=location.port;s||(s=a?443:80),r=e.hostname!==location.hostname||s!==e.port,n=e.secure!==a}if(e.xdomain=r,e.xscheme=n,t=new wl(e),"open"in t&&!e.forceJSONP)return new um(e);if(!i)throw new Error("JSONP disabled");return new NI(e)}var dm={polling:LI,websocket:jI},FI=[].indexOf,Il=function(e,t){if(FI)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1},lt=cc("engine.io-client:socket"),qI=Ne;function Ne(e,t){if(!(this instanceof Ne))return new Ne(e,t);t=t||{},e&&typeof e=="object"&&(t=e,e=null),e?(e=ml(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=ml(t.host).host),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?443:80),this.query=t.query||{},typeof this.query=="string"&&(this.query=ic.decode(this.query)),this.upgrade=t.upgrade!==!1,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=t.jsonp!==!1,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.withCredentials=t.withCredentials!==!1,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=t.perMessageDeflate!==!1?t.perMessageDeflate||{}:!1,this.perMessageDeflate===!0&&(this.perMessageDeflate={}),this.perMessageDeflate&&this.perMessageDeflate.threshold==null&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=t.rejectUnauthorized===void 0?!0:t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",(typeof self=="undefined"||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}Ne.priorWebsocketSuccess=!1,zi(Ne.prototype),Ne.protocol=bi.protocol,Ne.Socket=Ne,Ne.Transport=xa,Ne.transports=dm,Ne.parser=bi,Ne.prototype.createTransport=function(e){lt('creating transport "%s"',e);var t=GI(this.query);t.EIO=bi.protocol,t.transport=e;var r=this.transportOptions[e]||{};this.id&&(t.sid=this.id);var n=new dm[e]({query:t,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,withCredentials:r.withCredentials||this.withCredentials,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0,isReactNative:this.isReactNative});return n};function GI(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}Ne.prototype.open=function(){var e;if(this.rememberUpgrade&&Ne.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){var t=this;setTimeout(function(){t.emit("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(r){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)},Ne.prototype.setTransport=function(e){lt("setting transport %s",e.name);var t=this;this.transport&&(lt("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(r){t.onPacket(r)}).on("error",function(r){t.onError(r)}).on("close",function(){t.onClose("transport close")})},Ne.prototype.probe=function(e){lt('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),r=!1,n=this;Ne.priorWebsocketSuccess=!1;function i(){if(n.onlyBinaryUpgrades){var f=!this.supportsBinary&&n.transport.supportsBinary;r=r||f}if(r)return;lt('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(_){if(r)return;if(_.type==="pong"&&_.data==="probe"){if(lt('probe transport "%s" pong',e),n.upgrading=!0,n.emit("upgrading",t),!t)return;Ne.priorWebsocketSuccess=t.name==="websocket",lt('pausing current transport "%s"',n.transport.name),n.transport.pause(function(){if(r)return;if(n.readyState==="closed")return;lt("changing transport and sending upgrade packet"),l(),n.setTransport(t),t.send([{type:"upgrade"}]),n.emit("upgrade",t),t=null,n.upgrading=!1,n.flush()})}else{lt('probe transport "%s" failed',e);var p=new Error("probe error");p.transport=t.name,n.emit("upgradeError",p)}})}function a(){if(r)return;r=!0,l(),t.close(),t=null}function s(f){var _=new Error("probe error: "+f);_.transport=t.name,a(),lt('probe transport "%s" failed because of error: %s',e,f),n.emit("upgradeError",_)}function c(){s("transport closed")}function o(){s("socket closed")}function u(f){t&&f.name!==t.name&&(lt('"%s" works - aborting "%s"',f.name,t.name),a())}function l(){t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",c),n.removeListener("close",o),n.removeListener("upgrading",u)}t.once("open",i),t.once("error",s),t.once("close",c),this.once("close",o),this.once("upgrading",u),t.open()},Ne.prototype.onOpen=function(){if(lt("socket open"),this.readyState="open",Ne.priorWebsocketSuccess=this.transport.name==="websocket",this.emit("open"),this.flush(),this.readyState==="open"&&this.upgrade&&this.transport.pause){lt("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},Ne.prototype.onPacket=function(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){lt('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat");switch(e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data);break}}else lt('packet received with socket readyState "%s"',this.readyState)},Ne.prototype.onHandshake=function(e){if(this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),this.readyState==="closed")return;this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat)},Ne.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){if(t.readyState==="closed")return;t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},Ne.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){lt("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},Ne.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},Ne.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emit("drain"):this.flush()},Ne.prototype.flush=function(){this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(lt("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Ne.prototype.write=Ne.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},Ne.prototype.sendPacket=function(e,t,r,n){if(typeof t=="function"&&(n=t,t=void 0),typeof r=="function"&&(n=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;var i={type:e,data:t,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()},Ne.prototype.close=function(){if(this.readyState==="opening"||this.readyState==="open"){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():t()}):this.upgrading?n():t()}function t(){e.onClose("forced close"),lt("socket closing - telling transport to close"),e.transport.close()}function r(){e.removeListener("upgrade",r),e.removeListener("upgradeError",r),t()}function n(){e.once("upgrade",r),e.once("upgradeError",r)}return this},Ne.prototype.onError=function(e){lt("socket error %j",e),Ne.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},Ne.prototype.onClose=function(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){lt('socket close with reason: "%s"',e);var r=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),r.writeBuffer=[],r.prevBufferLen=0}},Ne.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;r<n;r++)~Il(this.transports,e[r])&&t.push(e[r]);return t};var pm=qI,$I=bi;pm.parser=$I;var Rl=VI;function VI(e,t){var r=[];t=t||0;for(var n=t||0;n<e.length;n++)r[n-t]=e[n];return r}var en=HI;function HI(e,t,r){return e.on(t,r),{destroy:function(){e.removeListener(t,r)}}}var fm=[].slice,Hn=function(e,t){if(typeof t=="string"&&(t=e[t]),typeof t!="function")throw new Error("bind() requires a function");var r=fm.call(arguments,2);return function(){return t.apply(e,r.concat(fm.call(arguments)))}},mm=le(function(e,t){var r=Yo("socket.io-client:socket");e.exports=t=a;var n={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},i=zi.prototype.emit;function a(s,c,o){this.io=s,this.nsp=c,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},o&&o.query&&(this.query=o.query),this.io.autoConnect&&this.open()}zi(a.prototype),a.prototype.subEvents=function(){if(this.subs)return;var s=this.io;this.subs=[en(s,"open",Hn(this,"onopen")),en(s,"packet",Hn(this,"onpacket")),en(s,"close",Hn(this,"onclose"))]},a.prototype.open=a.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.reconnecting||this.io.open(),this.io.readyState==="open"&&this.onopen(),this.emit("connecting"),this)},a.prototype.send=function(){var s=Rl(arguments);return s.unshift("message"),this.emit.apply(this,s),this},a.prototype.emit=function(s){if(n.hasOwnProperty(s))return i.apply(this,arguments),this;var c=Rl(arguments),o={type:(this.flags.binary!==void 0?this.flags.binary:_l(c))?kt.BINARY_EVENT:kt.EVENT,data:c};return o.options={},o.options.compress=!this.flags||this.flags.compress!==!1,typeof c[c.length-1]=="function"&&(r("emitting packet with ack id %d",this.ids),this.acks[this.ids]=c.pop(),o.id=this.ids++),this.connected?this.packet(o):this.sendBuffer.push(o),this.flags={},this},a.prototype.packet=function(s){s.nsp=this.nsp,this.io.packet(s)},a.prototype.onopen=function(){if(r("transport is open - connecting"),this.nsp!=="/")if(this.query){var s=typeof this.query=="object"?ic.encode(this.query):this.query;r("sending connect packet with query %s",s),this.packet({type:kt.CONNECT,query:s})}else this.packet({type:kt.CONNECT})},a.prototype.onclose=function(s){r("close (%s)",s),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",s)},a.prototype.onpacket=function(s){var c=s.nsp===this.nsp,o=s.type===kt.ERROR&&s.nsp==="/";if(!c&&!o)return;switch(s.type){case kt.CONNECT:this.onconnect();break;case kt.EVENT:this.onevent(s);break;case kt.BINARY_EVENT:this.onevent(s);break;case kt.ACK:this.onack(s);break;case kt.BINARY_ACK:this.onack(s);break;case kt.DISCONNECT:this.ondisconnect();break;case kt.ERROR:this.emit("error",s.data);break}},a.prototype.onevent=function(s){var c=s.data||[];r("emitting event %j",c),s.id!=null&&(r("attaching ack callback to event"),c.push(this.ack(s.id))),this.connected?i.apply(this,c):this.receiveBuffer.push(c)},a.prototype.ack=function(s){var c=this,o=!1;return function(){if(o)return;o=!0;var u=Rl(arguments);r("sending ack %j",u),c.packet({type:_l(u)?kt.BINARY_ACK:kt.ACK,id:s,data:u})}},a.prototype.onack=function(s){var c=this.acks[s.id];typeof c=="function"?(r("calling ack %s with %j",s.id,s.data),c.apply(this,s.data),delete this.acks[s.id]):r("bad ack %s",s.id)},a.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},a.prototype.emitBuffered=function(){var s;for(s=0;s<this.receiveBuffer.length;s++)i.apply(this,this.receiveBuffer[s]);for(this.receiveBuffer=[],s=0;s<this.sendBuffer.length;s++)this.packet(this.sendBuffer[s]);this.sendBuffer=[]},a.prototype.ondisconnect=function(){r("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},a.prototype.destroy=function(){if(this.subs){for(var s=0;s<this.subs.length;s++)this.subs[s].destroy();this.subs=null}this.io.destroy(this)},a.prototype.close=a.prototype.disconnect=function(){return this.connected&&(r("performing disconnect (%s)",this.nsp),this.packet({type:kt.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},a.prototype.compress=function(s){return this.flags.compress=s,this},a.prototype.binary=function(s){return this.flags.binary=s,this}}),zI=Ua;function Ua(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Ua.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=(Math.floor(t*10)&1)==0?e-r:e+r}return Math.min(e,this.max)|0},Ua.prototype.reset=function(){this.attempts=0},Ua.prototype.setMin=function(e){this.ms=e},Ua.prototype.setMax=function(e){this.max=e},Ua.prototype.setJitter=function(e){this.jitter=e};var Ut=Yo("socket.io-client:manager"),gm=Object.prototype.hasOwnProperty,kl=xe;function xe(e,t){if(!(this instanceof xe))return new xe(e,t);e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||Infinity),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new zI({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=t.parser||kt;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=t.autoConnect!==!1,this.autoConnect&&this.open()}xe.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var e in this.nsps)gm.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},xe.prototype.updateSocketIds=function(){for(var e in this.nsps)gm.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},xe.prototype.generateId=function(e){return(e==="/"?"":e+"#")+this.engine.id},zi(xe.prototype),xe.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},xe.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},xe.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},xe.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},xe.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},xe.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},xe.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()},xe.prototype.open=xe.prototype.connect=function(e,t){if(Ut("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;Ut("opening %s",this.uri),this.engine=pm(this.uri,this.opts);var r=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var i=en(r,"open",function(){n.onopen(),e&&e()}),a=en(r,"error",function(o){if(Ut("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",o),e){var u=new Error("Connection error");u.data=o,e(u)}else n.maybeReconnectOnOpen()});if(this._timeout!==!1){var s=this._timeout;Ut("connect attempt will timeout after %d",s),s===0&&i.destroy();var c=setTimeout(function(){Ut("connect attempt timed out after %d",s),i.destroy(),r.close(),r.emit("error","timeout"),n.emitAll("connect_timeout",s)},s);this.subs.push({destroy:function(){clearTimeout(c)}})}return this.subs.push(i),this.subs.push(a),this},xe.prototype.onopen=function(){Ut("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(en(e,"data",Hn(this,"ondata"))),this.subs.push(en(e,"ping",Hn(this,"onping"))),this.subs.push(en(e,"pong",Hn(this,"onpong"))),this.subs.push(en(e,"error",Hn(this,"onerror"))),this.subs.push(en(e,"close",Hn(this,"onclose"))),this.subs.push(en(this.decoder,"decoded",Hn(this,"ondecoded")))},xe.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},xe.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},xe.prototype.ondata=function(e){this.decoder.add(e)},xe.prototype.ondecoded=function(e){this.emit("packet",e)},xe.prototype.onerror=function(e){Ut("error",e),this.emitAll("error",e)},xe.prototype.socket=function(e,t){var r=this.nsps[e];if(!r){r=new mm(this,e,t),this.nsps[e]=r;var n=this;r.on("connecting",i),r.on("connect",function(){r.id=n.generateId(e)}),this.autoConnect&&i()}function i(){~Il(n.connecting,r)||n.connecting.push(r)}return r},xe.prototype.destroy=function(e){var t=Il(this.connecting,e);if(~t&&this.connecting.splice(t,1),this.connecting.length)return;this.close()},xe.prototype.packet=function(e){Ut("writing packet %j",e);var t=this;e.query&&e.type===0&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(r){for(var n=0;n<r.length;n++)t.engine.write(r[n],e.options);t.encoding=!1,t.processPacketQueue()}))},xe.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},xe.prototype.cleanup=function(){Ut("cleanup");for(var e=this.subs.length,t=0;t<e;t++){var r=this.subs.shift();r.destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},xe.prototype.close=xe.prototype.disconnect=function(){Ut("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,this.readyState==="opening"&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},xe.prototype.onclose=function(e){Ut("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},xe.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)Ut("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();Ut("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var r=setTimeout(function(){if(e.skipReconnect)return;if(Ut("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect)return;e.open(function(n){n?(Ut("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",n.data)):(Ut("reconnect success"),e.onreconnect())})},t);this.subs.push({destroy:function(){clearTimeout(r)}})}},xe.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)};var KI=le(function(e,t){var r=Yo("socket.io-client");e.exports=t=i;var n=t.managers={};function i(a,s){typeof a=="object"&&(s=a,a=void 0),s=s||{};var c=UC(a),o=c.source,u=c.id,l=c.path,f=n[u]&&l in n[u].nsps,_=s.forceNew||s["force new connection"]||s.multiplex===!1||f,p;return _?(r("ignoring socket cache for %s",o),p=kl(o,s)):(n[u]||(r("new io instance for %s",o),n[u]=kl(o,s)),p=n[u]),c.query&&!s.query&&(s.query=c.query),p.socket(c.path,s)}t.protocol=kt.protocol,t.connect=i,t.Manager=kl,t.Socket=mm}),Pl=e=>{if(e[Symbol.asyncIterator])return e;if(e.getReader)return async function*(){const t=e.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)return;yield n}}finally{t.releaseLock()}}();throw new Error("unknown stream")},bm=e=>async t=>{t=Vc(t);const r=A=>{typeof A.return=="function"&&A.return()};let n=null,i=null;const a=A=>{n=A,i&&i(A),r(t)};let s=null,c=!1;const o=()=>{c=!0,s&&s()};let u=null,l=!1;const f=()=>{l=!0,u&&u()};let _=null;const p=()=>{_&&_()},I=()=>new Promise((A,j)=>{s=_=A,i=j,e.once("drain",p)}),d=()=>(r(t),new Promise((A,j)=>{if(c||l||n)return A();u=s=A,i=j})),v=()=>{e.removeListener("error",a),e.removeListener("close",o),e.removeListener("finish",f),e.removeListener("drain",p)};e.once("error",a),e.once("close",o),e.once("finish",f);try{for await(const A of t){if(!e.writable||e.destroyed||n)break;e.write(A)===!1&&await I()}}catch(A){n||e.destroy(),n=A}try{if(e.writable&&e.end(),await d(),n)throw n}finally{v()}},ym=e=>({sink:bm(e),source:Pl(e)}),WI=e=>async function*(t){const r=ym(e);r.sink(t).catch(n=>{}),yield*r.source},Fa=Pl,XI=Pl,QI=bm,YI=WI,JI=ym;Fa.source=XI,Fa.sink=QI,Fa.transform=YI,Fa.duplex=JI;const{CLOSE_TIMEOUT:ZI}=fl,hc=te("libp2p:webrtc-star:socket");hc.error=te("libp2p:webrtc-star:socket:error");const vm=(e,t)=>{if(!e||!t)return;try{return qi(e,t)}catch(r){return hc.error(r),qi("0.0.0.0",t)}};var wm=(e,t={})=>{const{sink:r,source:n}=Fa.duplex(e),i=t.remoteAddr||vm(e.remoteAddress,e.remotePort),a=vm(e.localAddress,e.localPort),s={async sink(c){t.signal&&(c=gt(c,t.signal));try{await r(async function*(){for await(const o of c)yield o instanceof Uint8Array?o:o.slice()}())}catch(o){o.type!=="aborted"&&hc.error(o)}},source:t.signal?gt(n,t.signal):n,conn:e,localAddr:a,remoteAddr:i,timeline:{open:Date.now()},close(){return e.destroyed?void 0:new Promise((c,o)=>{const u=Date.now(),l=setTimeout(()=>{if(s.remoteAddr){const{host:f,port:_}=s.remoteAddr.toOptions();hc("timeout closing socket to %s:%s after %dms, destroying it manually",f,_,Date.now()-u)}e.destroyed||e.destroy()},ZI);e.once("close",()=>{c()}),e.end(f=>{if(clearTimeout(l),s.timeline.close=Date.now(),f)return o(f)})})}};return e.once("close",()=>{s.timeline.close||(s.timeline.close=Date.now())}),s},_m=le(function(e,t){function r(i){const a=i.toString().split("/"),s=i.protos()[1].name,c=i.protos()[2].name,o=i.stringTuples()[1][1];if(s!=="tcp"||c!=="ws"&&c!=="wss")throw new Error("invalid multiaddr: "+i.toString());if(!Pe.isName(i))return"http://"+a[2]+":"+a[4];if(c==="ws")return"http://"+a[2]+(o===80?"":":"+o);if(c==="wss")return"https://"+a[2]+(o===443?"":":"+o)}function n(i){const a="/libp2p-webrtc-star";if(i.indexOf(a)!==-1){i=i.substring(a.length,i.length);let s=Pe(i);const c=s.stringTuples().filter(o=>o[0]===421)[0];s=s.decapsulate("p2p"),s=s.encapsulate("/p2p-webrtc-star"),s=s.encapsulate(`/p2p/${c[1]}`),i=s.toString()}return i}t=e.exports,t.cleanUrlSIO=r,t.cleanMultiaddr=n});const Ki=te("libp2p:webrtc-star:listener");Ki.error=te("libp2p:webrtc-star:listener:error");const{cleanUrlSIO:eR}=_m,{CODE_P2P:Em}=fl,tR={transports:["websocket"],"force new connection":!0};var rR=({handler:e,upgrader:t},r,n={})=>{const i=new Bt;let a;return i.__connections=[],i.listen=s=>{const c=ho();a=s,!s.protoCodes().includes(Em)&&t.localPeer?r._signallingAddr=s.encapsulate(`/p2p/${t.localPeer.toB58String()}`):r._signallingAddr=s;const o=eR(s);Ki("Dialing to Signalling Server on: "+o),i.io=KI.connect(o,tR);const u=l=>{if(l.answer||l.err)return;const f={trickle:!1,...n};r.wrtc&&(f.wrtc=r.wrtc);const _=new zf(f),p=I=>{Ki.error("incoming connectioned errored",I)};_.on("error",p),_.once("close",(...I)=>{_.removeListener("error",p)}),_.once("signal",I=>{l.signal=I,l.answer=!0,i.io.emit("ss-handshake",l)}),_.signal(l.signal),_.once("connect",async()=>{const I=wm(_);Ki("new inbound connection %s",I.remoteAddr);let d;try{d=await t.upgradeInbound(I)}catch(v){return Ki.error("inbound connection failed to upgrade",v),I.close()}if(!d.remoteAddr)try{d.remoteAddr=s.decapsulateCode(Em).encapsulate(`/p2p/${d.remotePeer.toB58String()}`)}catch(v){Ki.error("could not determine remote address",v)}Ki("inbound connection %s upgraded",I.remoteAddr),nR(i,I),i.emit("connection",d),e(d)})};return i.io.once("connect_error",l=>c.reject(l)),i.io.once("error",l=>{i.emit("error",l),i.emit("close")}),i.io.on("ws-handshake",u),i.io.on("ws-peer",r._peerDiscovered),i.io.on("connect",()=>{i.io.emit("ss-join",r._signallingAddr.toString())}),i.io.once("connect",()=>{i.emit("listening"),c.resolve()}),c.promise},i.close=async()=>{i.io&&i.io.emit("ss-leave"),await Promise.all(i.__connections.map(s=>s.close())),i.emit("close")},i.getAddrs=()=>[a],r.listenersRefs[Pe.toString()]=i,i};function nR(e,t){e.__connections.push(t);const r=()=>{e.__connections=e.__connections.filter(n=>n!==t)};t.conn.once("close",r)}const zn=te("libp2p:webrtc-star");zn.error=te("libp2p:webrtc-star:error");const{EventEmitter:iR}=Bt,{AbortError:Sm}=gt,{supportsWebRTCDataChannels:aR}=TC,{CODE_CIRCUIT:sR}=fl,{cleanMultiaddr:oR}=_m;function cR(){}class uR{constructor(e={}){if(!e.upgrader)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=e.upgrader,this._signallingAddr=void 0,this.sioOptions={transports:["websocket"],"force new connection":!0},e.wrtc&&(this.wrtc=e.wrtc),this.listenersRefs={},this.discovery=new iR,this.discovery.tag="webRTCStar",this.discovery._isStarted=!1,this.discovery.start=()=>{this.discovery._isStarted=!0},this.discovery.stop=()=>{this.discovery._isStarted=!1},this._peerDiscovered=this._peerDiscovered.bind(this)}async dial(e,t={}){const r=await this._connect(e,t),n=wm(r,{remoteAddr:e,signal:t.signal});zn("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return zn("outbound connection %s upgraded",n.remoteAddr),i}_connect(e,t={}){if(t.signal&&t.signal.aborted)throw new Sm;const r={initiator:!0,trickle:!1};this.wrtc&&(r.wrtc=this.wrtc);const n=e.toOptions(),i=(~~(Math.random()*1e9)).toString(36)+Date.now(),a=this.listenersRefs[Object.keys(this.listenersRefs)[0]].io;return new Promise((s,c)=>{const o=Date.now();let u;zn("dialing %s:%s",n.host,n.port);const l=new zf(r),f=v=>{if(!u){const A=`connection error ${n.host}:${n.port}: ${v.message}`;zn.error(A),d(v)}},_=()=>{zn("connnection timeout %s:%s",n.host,n.port);const v=$(new Error(`connection timeout after ${Date.now()-o}ms`),"ERR_CONNECT_TIMEOUT");l.emit("error",v)},p=()=>{u=!0,zn("connection opened %s:%s",n.host,n.port),d(null)},I=()=>{zn.error("connection aborted %s:%s",n.host,n.port),l.destroy(),d(new Sm)},d=v=>{l.removeListener("timeout",_),l.removeListener("connect",p),t.signal&&t.signal.removeEventListener("abort",I),v?c(v):s(l)};l.on("error",f),l.once("timeout",_),l.once("connect",p),l.on("close",()=>{l.removeListener("error",f)}),t.signal&&t.signal.addEventListener("abort",I),l.on("signal",v=>{a.emit("ss-handshake",{intentId:i,srcMultiaddr:this._signallingAddr.toString(),dstMultiaddr:e.toString(),signal:v})}),a.on("ws-handshake",v=>{if(v.intentId===i&&v.err&&c($(v.err instanceof Error?v.err:new Error(v.err),"ERR_SIGNALLING_FAILED")),v.intentId!==i||!v.answer||l.destroyed)return;l.signal(v.signal)})})}createListener(e={},t){if(!aR&&!this.wrtc)throw $(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");return typeof e=="function"&&(t=e,e={}),t=t||cR,rR({handler:t,upgrader:this._upgrader},this,e)}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>t.protoCodes().includes(sR)?!1:da.WebRTCStar.matches(t))}_peerDiscovered(e){if(!this.discovery._isStarted)return;zn("Peer Discovered:",e),e=oR(e);const t=Pe(e),r=Ae.createFromB58String(t.getPeerId());this.discovery.emit("peer",{id:r,multiaddrs:[t]})}}var Am=On(uR,{className:"WebRTCStar",symbolName:"@libp2p/js-libp2p-webrtc-star/webrtcstar"}),lR=421,hR=290,dR=2e3,Nl={CODE_P2P:lR,CODE_CIRCUIT:hR,CLOSE_TIMEOUT:dR};const Ol=te("libp2p:tcp:socket"),{CLOSE_TIMEOUT:pR}=Nl;var Tm=(e,t)=>{t=t||{},t.listeningAddr&&t.listeningAddr.getPath()&&(t.remoteAddr=t.listeningAddr),t.remoteAddr&&t.remoteAddr.getPath()&&(t.localAddr=t.remoteAddr);const{sink:r,source:n}=Fa.duplex(e),i={async sink(a){t.signal&&(a=gt(a,t.signal));try{await r(async function*(){for await(const s of a)yield Buffer.isBuffer(s)?s:s.slice()}())}catch(s){s.type!=="aborted"&&Ol(s)}},source:t.signal?gt(n,t.signal):n,conn:e,localAddr:t.localAddr||qi(e.localAddress,e.localPort),remoteAddr:t.remoteAddr||qi(e.remoteAddress,e.remotePort),timeline:{open:Date.now()},close(){return e.destroyed?void 0:new Promise((a,s)=>{const c=Date.now(),o=setTimeout(()=>{const{host:u,port:l}=i.remoteAddr.toOptions();Ol("timeout closing socket to %s:%s after %dms, destroying it manually",u,l,Date.now()-c),e.destroyed?Ol("%s:%s is already destroyed",u,l):e.destroy(),a()},pR);e.once("close",()=>clearTimeout(o)),e.end(u=>{if(i.timeline.close=Date.now(),u)return s(u);a()})})}};return e.once("close",()=>{i.timeline.close||(i.timeline.close=Date.now())}),i};const{resolve:fR}=kg,mR={ip4:"IPv4",ip6:"IPv6"};function gR(e){const t=e.getPath();return t?fR(t):e.toOptions()}function bR(e,t,r){const n=i=>Pe(`/${e}/${i}/tcp/${r}`);return(Cm(t)?yR(mR[e]):[t]).map(n)}function Cm(e){return["0.0.0.0","::"].includes(e)}function yR(e){return Object.values(Jl.networkInterfaces()).reduce((t,r)=>(r.forEach(n=>{n.family===e&&t.push(n.address)}),t),[])}var Im={multiaddrToNetConfig:gR,isAnyAddr:Cm,getMultiaddrs:bR};const Wi=te("libp2p:tcp:listener");Wi.error=te("libp2p:tcp:listener:error");const{CODE_P2P:vR}=Nl,{getMultiaddrs:Rm,multiaddrToNetConfig:wR}=Im;async function km(e){try{e&&await e.close()}catch(t){Wi.error("an error occurred closing the connection",t)}}var _R=({handler:e,upgrader:t},r)=>{const n=new Bt,i=Zl.createServer(async c=>{c.on("error",l=>Wi("socket error",l));let o,u;try{o=Tm(c,{listeningAddr:s}),Wi("new inbound connection %s",o.remoteAddr),u=await t.upgradeInbound(o)}catch(l){return Wi.error("inbound connection failed",l),km(o)}Wi("inbound connection %s upgraded",o.remoteAddr),ER(i,o),e&&e(u),n.emit("connection",u)});i.on("listening",()=>n.emit("listening")).on("error",c=>n.emit("error",c)).on("close",()=>n.emit("close")),i.__connections=[],n.close=()=>i.listening?new Promise((c,o)=>{i.__connections.forEach(u=>km(u)),i.close(u=>u?o(u):c())}):void 0;let a,s;return n.listen=c=>(s=c,a=c.getPeerId(),a&&(s=c.decapsulateCode(vR)),new Promise((o,u)=>{const l=wR(s);i.listen(l,f=>{if(f)return u(f);Wi("Listening on %s",i.address()),o()})})),n.getAddrs=()=>{let c=[];const o=i.address();if(!o)throw new Error("Listener is not ready yet");return s.toString().startsWith("/ip4")?c=c.concat(Rm("ip4",o.address,o.port)):o.family==="IPv6"&&(c=c.concat(Rm("ip6",o.address,o.port))),c.map(u=>a?u.encapsulate(`/p2p/${a}`):u)},n};function ER(e,t){e.__connections.push(t);const r=()=>{e.__connections=e.__connections.filter(n=>n!==t)};t.conn.once("close",r)}const qa=te("libp2p:tcp"),{multiaddrToNetConfig:SR}=Im,{AbortError:Pm}=gt,{CODE_CIRCUIT:AR,CODE_P2P:TR}=Nl;class CR{constructor({upgrader:e}){if(!e)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=e}async dial(e,t){t=t||{};const r=await this._connect(e,t),n=Tm(r,{remoteAddr:e,signal:t.signal});qa("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return qa("outbound connection %s upgraded",n.remoteAddr),i}_connect(e,t={}){if(t.signal&&t.signal.aborted)throw new Pm;return new Promise((r,n)=>{const i=Date.now(),a=SR(e);qa("dialing %j",a);const s=Zl.connect(a),c=_=>{_.message=`connection error ${a.host}:${a.port}: ${_.message}`,f(_)},o=()=>{qa("connnection timeout %s:%s",a.host,a.port);const _=$(new Error(`connection timeout after ${Date.now()-i}ms`),"ERR_CONNECT_TIMEOUT");s.emit("error",_)},u=()=>{qa("connection opened %j",a),f()},l=()=>{qa("connection aborted %j",a),s.destroy(),f(new Pm)},f=_=>{if(s.removeListener("error",c),s.removeListener("timeout",o),s.removeListener("connect",u),t.signal&&t.signal.removeEventListener("abort",l),_)return n(_);r(s)};s.on("error",c),s.on("timeout",o),s.on("connect",u),t.signal&&t.signal.addEventListener("abort",l)})}createListener(e,t){return typeof e=="function"&&(t=e,e={}),e=e||{},_R({handler:t,upgrader:this._upgrader})}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>t.protoCodes().includes(AR)?!1:da.TCP.matches(t.decapsulateCode(TR)))}}var IR=On(CR,{className:"TCP",symbolName:"@libp2p/js-libp2p-tcp/tcp"});const Dl=10*1024;class RR{constructor(){this._pool=new Uint8Array(Dl),this._poolOffset=0}write(e){const t=this._pool;let r=this._poolOffset;Ve.encode(e.id<<3|e.type,t,r),r+=Ve.encode.bytes,Ve.encode(e.data?e.data.length:0,t,r),r+=Ve.encode.bytes;const n=t.subarray(this._poolOffset,r);return Dl-r<100?(this._pool=new Uint8Array(Dl),this._poolOffset=0):this._poolOffset=r,e.data?[n,e.data]:n}}const Nm=new RR;var kR=e=>async function*(){for await(const r of e)Array.isArray(r)?yield new Ze(r.map(n=>Nm.write(n))):yield new Ze(Nm.write(r))}(),PR=e=>async function*(){const r=new NR;for await(const n of e){const i=r.write(n);i.length&&(yield i)}}();class NR{constructor(){this._buffer=new Ze,this._bufferProxy=new Proxy({},{get:(e,t)=>t[0]==="l"?this._buffer[t]:this._buffer.get(parseInt(t))}),this._headerInfo=null}write(e){if(!e||!e.length)return[];this._buffer.append(e);const t=[];for(;;){if(!this._headerInfo)try{this._headerInfo=this._decodeHeader(this._bufferProxy)}catch(c){break}const{id:r,type:n,length:i,offset:a}=this._headerInfo,s=this._buffer.length-a;if(s<i)break;t.push({id:r,type:n,data:this._buffer.shallowSlice(a,a+i)}),this._buffer.consume(a+i),this._headerInfo=null}return t}_decodeHeader(e){const t=Ve.decode(e);let r=Ve.decode.bytes;const n=Ve.decode(e,r);return r+=Ve.decode.bytes,{id:t>>3,type:t&7,offset:r,length:n}}}var OR=kR,DR=PR,Om={encode:OR,decode:DR};const Dm=1<<20;var Ml=e=>{e=e||Dm;const t=r=>{if(r.data&&r.data.length>e)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"})};return r=>async function*(){for await(const i of r)Array.isArray(i)?i.forEach(t):t(i),yield i}()},MR=Dm;Ml.MAX_MSG_SIZE=MR;const Kn=Object.freeze({NEW_STREAM:0,MESSAGE_RECEIVER:1,MESSAGE_INITIATOR:2,CLOSE_RECEIVER:3,CLOSE_INITIATOR:4,RESET_RECEIVER:5,RESET_INITIATOR:6});var xR=Kn,BR=Object.freeze({NEW_STREAM:Kn.NEW_STREAM,MESSAGE:Kn.MESSAGE_INITIATOR,CLOSE:Kn.CLOSE_INITIATOR,RESET:Kn.RESET_INITIATOR}),LR=Object.freeze({MESSAGE:Kn.MESSAGE_RECEIVER,CLOSE:Kn.CLOSE_RECEIVER,RESET:Kn.RESET_RECEIVER}),jR=Object.freeze(Object.entries(Kn).reduce((e,t)=>(e[t[1]]=t[0],e),{})),Mm={MessageTypes:xR,InitiatorMessageTypes:BR,ReceiverMessageTypes:LR,MessageTypeNames:jR};const qs=te("libp2p:mplex:stream"),{MAX_MSG_SIZE:UR}=Ml,{InitiatorMessageTypes:FR,ReceiverMessageTypes:qR}=Mm;var GR=({id:e,name:t,send:r,onEnd:n=()=>{},type:i="initiator",maxMsgSize:a=UR})=>{const s=new Mi,c=new Mi,o=i==="initiator"?FR:qR,u=i==="initiator"?`i${e}`:`r${e}`;t=String(t??e);let l=!1,f=!1,_;const p=v=>{l=!0,qs("%s stream %s source end",i,t,v),v&&!_&&(_=v),f&&(d.timeline.close=Date.now(),n(_))},I=v=>{f=!0,qs("%s stream %s sink end",i,t,v),v&&!_&&(_=v),l&&(d.timeline.close=Date.now(),n(_))},d={close:()=>d.source.end(),abort:v=>{qs("%s stream %s abort",i,t,v),d.source.end(v),s.abort()},reset:()=>c.abort(),sink:async v=>{v=gt(v,[{signal:s.signal,options:{abortMessage:"stream aborted",abortCode:"ERR_MPLEX_STREAM_ABORT"}},{signal:c.signal,options:{abortMessage:"stream reset",abortCode:"ERR_MPLEX_STREAM_RESET"}}]),i==="initiator"&&r({id:e,type:o.NEW_STREAM,data:t});try{for await(let A of v)for(;A.length;){if(A.length<=a){r({id:e,type:o.MESSAGE,data:A});break}A=Ze.isBufferList(A)?A:new Ze(A),r({id:e,type:o.MESSAGE,data:A.shallowSlice(0,a)}),A.consume(a)}}catch(A){return A.code==="ERR_MPLEX_STREAM_RESET"?qs("%s stream %s reset",i,t):(qs("%s stream %s error",i,t,A),r({id:e,type:o.RESET})),d.source.end(A),I(A)}r({id:e,type:o.CLOSE}),I()},source:lo(p),timeline:{open:Date.now(),close:null},id:u};return d};const Wn=te("libp2p:mplex"),{MessageTypes:Xi,MessageTypeNames:xm}=Mm;class Bm{constructor(e){e=e||{},e=typeof e=="function"?{onStream:e}:e,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._options=e,this.sink=this._createSink(),this.source=this._createSource(),this.onStream=e.onStream,this.onStreamEnd=e.onStreamEnd}get streams(){const e=[];return this._streams.initiators.forEach(t=>{e.push(t)}),this._streams.receivers.forEach(t=>{e.push(t)}),e}newStream(e){const t=this._streamId++;e=e==null?t.toString():String(e);const r=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:r})}_newReceiverStream({id:e,name:t}){const r=this._streams.receivers;return this._newStream({id:e,name:t,type:"receiver",registry:r})}_newStream({id:e,name:t,type:r,registry:n}){if(n.has(e))throw new Error(`${r} stream ${e} already exists!`);Wn("new %s stream %s %s",r,e,t);const i=c=>(Wn.enabled&&Wn("%s stream %s %s send",r,e,t,{...c,type:xm[c.type],data:c.data&&c.data.slice()}),this.source.push(c)),a=()=>{Wn("%s stream %s %s ended",r,e,t),n.delete(e),this.onStreamEnd&&this.onStreamEnd(s)},s=GR({id:e,name:t,send:i,type:r,onEnd:a,maxMsgSize:this._options.maxMsgSize});return n.set(e,s),s}_createSink(){return async e=>{this._options.signal&&(e=gt(e,this._options.signal));try{await Lt(e,Om.decode,Ml(this._options.maxMsgSize),async t=>{for await(const r of t)for(const n of r)this._handleIncoming(n)})}catch(t){return Wn("error in sink",t),this.source.end(t)}this.source.end()}}_createSource(){const e=r=>{const{initiators:n,receivers:i}=this._streams;for(const a of n.values())a.abort(r);for(const a of i.values())a.abort(r)},t=lo({onEnd:e,writev:!0});return Object.assign(Om.encode(t),{push:t.push,end:t.end,return:t.return})}_handleIncoming({id:e,type:t,data:r}){if(Wn.enabled&&Wn("incoming message",{id:e,type:xm[t],data:r.slice()}),t===Xi.NEW_STREAM&&this.onStream){const a=this._newReceiverStream({id:e,name:r.toString()});return this.onStream(a)}const n=t&1?this._streams.initiators:this._streams.receivers,i=n.get(e);if(!i)return Wn("missing stream %s",e);switch(t){case Xi.MESSAGE_INITIATOR:case Xi.MESSAGE_RECEIVER:i.source.push(r);break;case Xi.CLOSE_INITIATOR:case Xi.CLOSE_RECEIVER:i.close();break;case Xi.RESET_INITIATOR:case Xi.RESET_RECEIVER:i.reset();break;default:Wn("unknown message type %s",t)}}}Bm.multicodec="/mplex/6.7.0";var $R=Bm,VR=$R,dc=_n(`message Propose {
  optional bytes rand = 1;
  optional bytes pubkey = 2;
  optional string exchanges = 3;
  optional string ciphers = 4;
  optional string hashes = 5;
}

message Exchange {
  optional bytes epubkey = 1;
  optional bytes signature = 2;
}`),In=le(function(e){/**
 * [js-sha3]{@link https://github.com/emn178/js-sha3}
 *
 * @version 0.8.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2018
 * @license MIT
 */(function(){var t="input is invalid type",r="finalize already called",n=typeof window=="object",i=n?window:{};i.JS_SHA3_NO_WINDOW&&(n=!1);var a=!n&&typeof self=="object",s=!i.JS_SHA3_NO_NODE_JS&&typeof _e=="object"&&_e.versions&&_e.versions.node;s?i=ge:a&&(i=self);var c=!i.JS_SHA3_NO_COMMON_JS&&!0&&e.exports,o=!i.JS_SHA3_NO_ARRAY_BUFFER&&typeof ArrayBuffer!="undefined",u="0123456789abcdef".split(""),l=[31,7936,2031616,520093696],f=[4,1024,262144,67108864],_=[1,256,65536,16777216],p=[6,1536,393216,100663296],I=[0,8,16,24],d=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],v=[224,256,384,512],A=[128,256],j=["hex","buffer","arrayBuffer","array","digest"],O={"128":168,"256":136};(i.JS_SHA3_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(R){return Object.prototype.toString.call(R)==="[object Array]"}),o&&(i.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(R){return typeof R=="object"&&R.buffer&&R.buffer.constructor===ArrayBuffer});for(var m=function(R,W,Q){return function(Z){return new fe(R,W,R).update(Z)[Q]()}},b=function(R,W,Q){return function(Z,ne){return new fe(R,W,ne).update(Z)[Q]()}},S=function(R,W,Q){return function(Z,ne,ce,de){return x["cshake"+R].update(Z,ne,ce,de)[Q]()}},h=function(R,W,Q){return function(Z,ne,ce,de){return x["kmac"+R].update(Z,ne,ce,de)[Q]()}},g=function(R,W,Q,Z){for(var ne=0;ne<j.length;++ne){var ce=j[ne];R[ce]=W(Q,Z,ce)}return R},w=function(R,W){var Q=m(R,W,"hex");return Q.create=function(){return new fe(R,W,R)},Q.update=function(Z){return Q.create().update(Z)},g(Q,m,R,W)},y=function(R,W){var Q=b(R,W,"hex");return Q.create=function(Z){return new fe(R,W,Z)},Q.update=function(Z,ne){return Q.create(ne).update(Z)},g(Q,b,R,W)},P=function(R,W){var Q=O[R],Z=S(R,W,"hex");return Z.create=function(ne,ce,de){return!ce&&!de?x["shake"+R].create(ne):new fe(R,W,ne).bytepad([ce,de],Q)},Z.update=function(ne,ce,de,oe){return Z.create(ce,de,oe).update(ne)},g(Z,S,R,W)},D=function(R,W){var Q=O[R],Z=h(R,W,"hex");return Z.create=function(ne,ce,de){return new me(R,W,ce).bytepad(["KMAC",de],Q).bytepad([ne],Q)},Z.update=function(ne,ce,de,oe){return Z.create(ne,de,oe).update(ce)},g(Z,h,R,W)},L=[{name:"keccak",padding:_,bits:v,createMethod:w},{name:"sha3",padding:p,bits:v,createMethod:w},{name:"shake",padding:l,bits:A,createMethod:y},{name:"cshake",padding:f,bits:A,createMethod:P},{name:"kmac",padding:f,bits:A,createMethod:D}],x={},B=[],G=0;G<L.length;++G)for(var V=L[G],K=V.bits,ae=0;ae<K.length;++ae){var se=V.name+"_"+K[ae];if(B.push(se),x[se]=V.createMethod(K[ae],V.padding),V.name!=="sha3"){var ve=V.name+K[ae];B.push(ve),x[ve]=x[se]}}function fe(R,W,Q){this.blocks=[],this.s=[],this.padding=W,this.outputBits=Q,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(R<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=Q>>5,this.extraBytes=(Q&31)>>3;for(var Z=0;Z<50;++Z)this.s[Z]=0}fe.prototype.update=function(R){if(this.finalized)throw new Error(r);var W,Q=typeof R;if(Q!=="string"){if(Q==="object"){if(R===null)throw new Error(t);if(o&&R.constructor===ArrayBuffer)R=new Uint8Array(R);else if(!Array.isArray(R)&&(!o||!ArrayBuffer.isView(R)))throw new Error(t)}else throw new Error(t);W=!0}for(var Z=this.blocks,ne=this.byteCount,ce=R.length,de=this.blockCount,oe=0,Se=this.s,J,$e;oe<ce;){if(this.reset)for(this.reset=!1,Z[0]=this.block,J=1;J<de+1;++J)Z[J]=0;if(W)for(J=this.start;oe<ce&&J<ne;++oe)Z[J>>2]|=R[oe]<<I[J++&3];else for(J=this.start;oe<ce&&J<ne;++oe)$e=R.charCodeAt(oe),$e<128?Z[J>>2]|=$e<<I[J++&3]:$e<2048?(Z[J>>2]|=(192|$e>>6)<<I[J++&3],Z[J>>2]|=(128|$e&63)<<I[J++&3]):$e<55296||$e>=57344?(Z[J>>2]|=(224|$e>>12)<<I[J++&3],Z[J>>2]|=(128|$e>>6&63)<<I[J++&3],Z[J>>2]|=(128|$e&63)<<I[J++&3]):($e=65536+(($e&1023)<<10|R.charCodeAt(++oe)&1023),Z[J>>2]|=(240|$e>>18)<<I[J++&3],Z[J>>2]|=(128|$e>>12&63)<<I[J++&3],Z[J>>2]|=(128|$e>>6&63)<<I[J++&3],Z[J>>2]|=(128|$e&63)<<I[J++&3]);if(this.lastByteIndex=J,J>=ne){for(this.start=J-ne,this.block=Z[de],J=0;J<de;++J)Se[J]^=Z[J];pe(Se),this.reset=!0}else this.start=J}return this},fe.prototype.encode=function(R,W){var Q=R&255,Z=1,ne=[Q];for(R=R>>8,Q=R&255;Q>0;)ne.unshift(Q),R=R>>8,Q=R&255,++Z;return W?ne.push(Z):ne.unshift(Z),this.update(ne),ne.length},fe.prototype.encodeString=function(R){var W,Q=typeof R;if(Q!=="string"){if(Q==="object"){if(R===null)throw new Error(t);if(o&&R.constructor===ArrayBuffer)R=new Uint8Array(R);else if(!Array.isArray(R)&&(!o||!ArrayBuffer.isView(R)))throw new Error(t)}else throw new Error(t);W=!0}var Z=0,ne=R.length;if(W)Z=ne;else for(var ce=0;ce<R.length;++ce){var de=R.charCodeAt(ce);de<128?Z+=1:de<2048?Z+=2:de<55296||de>=57344?Z+=3:(de=65536+((de&1023)<<10|R.charCodeAt(++ce)&1023),Z+=4)}return Z+=this.encode(Z*8),this.update(R),Z},fe.prototype.bytepad=function(R,W){for(var Q=this.encode(W),Z=0;Z<R.length;++Z)Q+=this.encodeString(R[Z]);var ne=W-Q%W,ce=[];return ce.length=ne,this.update(ce),this},fe.prototype.finalize=function(){if(this.finalized)return;this.finalized=!0;var R=this.blocks,W=this.lastByteIndex,Q=this.blockCount,Z=this.s;if(R[W>>2]|=this.padding[W&3],this.lastByteIndex===this.byteCount)for(R[0]=R[Q],W=1;W<Q+1;++W)R[W]=0;for(R[Q-1]|=2147483648,W=0;W<Q;++W)Z[W]^=R[W];pe(Z)},fe.prototype.toString=fe.prototype.hex=function(){this.finalize();for(var R=this.blockCount,W=this.s,Q=this.outputBlocks,Z=this.extraBytes,ne=0,ce=0,de="",oe;ce<Q;){for(ne=0;ne<R&&ce<Q;++ne,++ce)oe=W[ne],de+=u[oe>>4&15]+u[oe&15]+u[oe>>12&15]+u[oe>>8&15]+u[oe>>20&15]+u[oe>>16&15]+u[oe>>28&15]+u[oe>>24&15];ce%R===0&&(pe(W),ne=0)}return Z&&(oe=W[ne],de+=u[oe>>4&15]+u[oe&15],Z>1&&(de+=u[oe>>12&15]+u[oe>>8&15]),Z>2&&(de+=u[oe>>20&15]+u[oe>>16&15])),de},fe.prototype.arrayBuffer=function(){this.finalize();var R=this.blockCount,W=this.s,Q=this.outputBlocks,Z=this.extraBytes,ne=0,ce=0,de=this.outputBits>>3,oe;Z?oe=new ArrayBuffer(Q+1<<2):oe=new ArrayBuffer(de);for(var Se=new Uint32Array(oe);ce<Q;){for(ne=0;ne<R&&ce<Q;++ne,++ce)Se[ce]=W[ne];ce%R===0&&pe(W)}return Z&&(Se[ne]=W[ne],oe=oe.slice(0,de)),oe},fe.prototype.buffer=fe.prototype.arrayBuffer,fe.prototype.digest=fe.prototype.array=function(){this.finalize();for(var R=this.blockCount,W=this.s,Q=this.outputBlocks,Z=this.extraBytes,ne=0,ce=0,de=[],oe,Se;ce<Q;){for(ne=0;ne<R&&ce<Q;++ne,++ce)oe=ce<<2,Se=W[ne],de[oe]=Se&255,de[oe+1]=Se>>8&255,de[oe+2]=Se>>16&255,de[oe+3]=Se>>24&255;ce%R===0&&pe(W)}return Z&&(oe=ce<<2,Se=W[ne],de[oe]=Se&255,Z>1&&(de[oe+1]=Se>>8&255),Z>2&&(de[oe+2]=Se>>16&255)),de};function me(R,W,Q){fe.call(this,R,W,Q)}me.prototype=new fe,me.prototype.finalize=function(){return this.encode(this.outputBits,!0),fe.prototype.finalize.call(this)};var pe=function(R){var W,Q,Z,ne,ce,de,oe,Se,J,$e,Lr,rn,Et,jr,Xt,mr,Qt,ht,gr,Ur,nn,an,ir,Fr,qr,ar,Gr,$r,br,sn,St,Ot,sr,yr,Vr,dt,pt,on,At,Hr,cn,un,ln,hn,nt,Yt,vr,wr,_r,Jt,Gt,dn,pn,fn,mn,or,rt,Er,Dt,gn,bn,yn,vn;for(Z=0;Z<48;Z+=2)ne=R[0]^R[10]^R[20]^R[30]^R[40],ce=R[1]^R[11]^R[21]^R[31]^R[41],de=R[2]^R[12]^R[22]^R[32]^R[42],oe=R[3]^R[13]^R[23]^R[33]^R[43],Se=R[4]^R[14]^R[24]^R[34]^R[44],J=R[5]^R[15]^R[25]^R[35]^R[45],$e=R[6]^R[16]^R[26]^R[36]^R[46],Lr=R[7]^R[17]^R[27]^R[37]^R[47],rn=R[8]^R[18]^R[28]^R[38]^R[48],Et=R[9]^R[19]^R[29]^R[39]^R[49],W=rn^(de<<1|oe>>>31),Q=Et^(oe<<1|de>>>31),R[0]^=W,R[1]^=Q,R[10]^=W,R[11]^=Q,R[20]^=W,R[21]^=Q,R[30]^=W,R[31]^=Q,R[40]^=W,R[41]^=Q,W=ne^(Se<<1|J>>>31),Q=ce^(J<<1|Se>>>31),R[2]^=W,R[3]^=Q,R[12]^=W,R[13]^=Q,R[22]^=W,R[23]^=Q,R[32]^=W,R[33]^=Q,R[42]^=W,R[43]^=Q,W=de^($e<<1|Lr>>>31),Q=oe^(Lr<<1|$e>>>31),R[4]^=W,R[5]^=Q,R[14]^=W,R[15]^=Q,R[24]^=W,R[25]^=Q,R[34]^=W,R[35]^=Q,R[44]^=W,R[45]^=Q,W=Se^(rn<<1|Et>>>31),Q=J^(Et<<1|rn>>>31),R[6]^=W,R[7]^=Q,R[16]^=W,R[17]^=Q,R[26]^=W,R[27]^=Q,R[36]^=W,R[37]^=Q,R[46]^=W,R[47]^=Q,W=$e^(ne<<1|ce>>>31),Q=Lr^(ce<<1|ne>>>31),R[8]^=W,R[9]^=Q,R[18]^=W,R[19]^=Q,R[28]^=W,R[29]^=Q,R[38]^=W,R[39]^=Q,R[48]^=W,R[49]^=Q,jr=R[0],Xt=R[1],Yt=R[11]<<4|R[10]>>>28,vr=R[10]<<4|R[11]>>>28,$r=R[20]<<3|R[21]>>>29,br=R[21]<<3|R[20]>>>29,gn=R[31]<<9|R[30]>>>23,bn=R[30]<<9|R[31]>>>23,un=R[40]<<18|R[41]>>>14,ln=R[41]<<18|R[40]>>>14,yr=R[2]<<1|R[3]>>>31,Vr=R[3]<<1|R[2]>>>31,mr=R[13]<<12|R[12]>>>20,Qt=R[12]<<12|R[13]>>>20,wr=R[22]<<10|R[23]>>>22,_r=R[23]<<10|R[22]>>>22,sn=R[33]<<13|R[32]>>>19,St=R[32]<<13|R[33]>>>19,yn=R[42]<<2|R[43]>>>30,vn=R[43]<<2|R[42]>>>30,fn=R[5]<<30|R[4]>>>2,mn=R[4]<<30|R[5]>>>2,dt=R[14]<<6|R[15]>>>26,pt=R[15]<<6|R[14]>>>26,ht=R[25]<<11|R[24]>>>21,gr=R[24]<<11|R[25]>>>21,Jt=R[34]<<15|R[35]>>>17,Gt=R[35]<<15|R[34]>>>17,Ot=R[45]<<29|R[44]>>>3,sr=R[44]<<29|R[45]>>>3,Fr=R[6]<<28|R[7]>>>4,qr=R[7]<<28|R[6]>>>4,or=R[17]<<23|R[16]>>>9,rt=R[16]<<23|R[17]>>>9,on=R[26]<<25|R[27]>>>7,At=R[27]<<25|R[26]>>>7,Ur=R[36]<<21|R[37]>>>11,nn=R[37]<<21|R[36]>>>11,dn=R[47]<<24|R[46]>>>8,pn=R[46]<<24|R[47]>>>8,hn=R[8]<<27|R[9]>>>5,nt=R[9]<<27|R[8]>>>5,ar=R[18]<<20|R[19]>>>12,Gr=R[19]<<20|R[18]>>>12,Er=R[29]<<7|R[28]>>>25,Dt=R[28]<<7|R[29]>>>25,Hr=R[38]<<8|R[39]>>>24,cn=R[39]<<8|R[38]>>>24,an=R[48]<<14|R[49]>>>18,ir=R[49]<<14|R[48]>>>18,R[0]=jr^~mr&ht,R[1]=Xt^~Qt&gr,R[10]=Fr^~ar&$r,R[11]=qr^~Gr&br,R[20]=yr^~dt&on,R[21]=Vr^~pt&At,R[30]=hn^~Yt&wr,R[31]=nt^~vr&_r,R[40]=fn^~or&Er,R[41]=mn^~rt&Dt,R[2]=mr^~ht&Ur,R[3]=Qt^~gr&nn,R[12]=ar^~$r&sn,R[13]=Gr^~br&St,R[22]=dt^~on&Hr,R[23]=pt^~At&cn,R[32]=Yt^~wr&Jt,R[33]=vr^~_r&Gt,R[42]=or^~Er&gn,R[43]=rt^~Dt&bn,R[4]=ht^~Ur&an,R[5]=gr^~nn&ir,R[14]=$r^~sn&Ot,R[15]=br^~St&sr,R[24]=on^~Hr&un,R[25]=At^~cn&ln,R[34]=wr^~Jt&dn,R[35]=_r^~Gt&pn,R[44]=Er^~gn&yn,R[45]=Dt^~bn&vn,R[6]=Ur^~an&jr,R[7]=nn^~ir&Xt,R[16]=sn^~Ot&Fr,R[17]=St^~sr&qr,R[26]=Hr^~un&yr,R[27]=cn^~ln&Vr,R[36]=Jt^~dn&hn,R[37]=Gt^~pn&nt,R[46]=gn^~yn&fn,R[47]=bn^~vn&mn,R[8]=an^~jr&mr,R[9]=ir^~Xt&Qt,R[18]=Ot^~Fr&ar,R[19]=sr^~qr&Gr,R[28]=un^~yr&dt,R[29]=ln^~Vr&pt,R[38]=dn^~hn&Yt,R[39]=pn^~nt&vr,R[48]=yn^~fn&or,R[49]=vn^~mn&rt,R[0]^=d[Z],R[1]^=d[Z+1]};if(c)e.exports=x;else for(G=0;G<B.length;++G)i[B[G]]=x[B[G]]})()}),HR=le(function(e,t){(function(r,n){var i={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function a(d){if(!Array.isArray(d)&&!ArrayBuffer.isView(d))return!1;for(var v=0;v<d.length;v++)if(!Number.isInteger(d[v])||d[v]<0||d[v]>255)return!1;return!0}function s(d,v){return(d&65535)*v+(((d>>>16)*v&65535)<<16)}function c(d,v){return d<<v|d>>>32-v}function o(d){return d^=d>>>16,d=s(d,2246822507),d^=d>>>13,d=s(d,3266489909),d^=d>>>16,d}function u(d,v){d=[d[0]>>>16,d[0]&65535,d[1]>>>16,d[1]&65535],v=[v[0]>>>16,v[0]&65535,v[1]>>>16,v[1]&65535];var A=[0,0,0,0];return A[3]+=d[3]+v[3],A[2]+=A[3]>>>16,A[3]&=65535,A[2]+=d[2]+v[2],A[1]+=A[2]>>>16,A[2]&=65535,A[1]+=d[1]+v[1],A[0]+=A[1]>>>16,A[1]&=65535,A[0]+=d[0]+v[0],A[0]&=65535,[A[0]<<16|A[1],A[2]<<16|A[3]]}function l(d,v){d=[d[0]>>>16,d[0]&65535,d[1]>>>16,d[1]&65535],v=[v[0]>>>16,v[0]&65535,v[1]>>>16,v[1]&65535];var A=[0,0,0,0];return A[3]+=d[3]*v[3],A[2]+=A[3]>>>16,A[3]&=65535,A[2]+=d[2]*v[3],A[1]+=A[2]>>>16,A[2]&=65535,A[2]+=d[3]*v[2],A[1]+=A[2]>>>16,A[2]&=65535,A[1]+=d[1]*v[3],A[0]+=A[1]>>>16,A[1]&=65535,A[1]+=d[2]*v[2],A[0]+=A[1]>>>16,A[1]&=65535,A[1]+=d[3]*v[1],A[0]+=A[1]>>>16,A[1]&=65535,A[0]+=d[0]*v[3]+d[1]*v[2]+d[2]*v[1]+d[3]*v[0],A[0]&=65535,[A[0]<<16|A[1],A[2]<<16|A[3]]}function f(d,v){return v%=64,v===32?[d[1],d[0]]:v<32?[d[0]<<v|d[1]>>>32-v,d[1]<<v|d[0]>>>32-v]:(v-=32,[d[1]<<v|d[0]>>>32-v,d[0]<<v|d[1]>>>32-v])}function _(d,v){return v%=64,v===0?d:v<32?[d[0]<<v|d[1]>>>32-v,d[1]<<v]:[d[1]<<v-32,0]}function p(d,v){return[d[0]^v[0],d[1]^v[1]]}function I(d){return d=p(d,[0,d[0]>>>1]),d=l(d,[4283543511,3981806797]),d=p(d,[0,d[0]>>>1]),d=l(d,[3301882366,444984403]),d=p(d,[0,d[0]>>>1]),d}i.x86.hash32=function(d,v){if(i.inputValidation&&!a(d))return n;v=v||0;for(var A=d.length%4,j=d.length-A,O=v,m=0,b=3432918353,S=461845907,h=0;h<j;h=h+4)m=d[h]|d[h+1]<<8|d[h+2]<<16|d[h+3]<<24,m=s(m,b),m=c(m,15),m=s(m,S),O^=m,O=c(O,13),O=s(O,5)+3864292196;m=0;switch(A){case 3:m^=d[h+2]<<16;case 2:m^=d[h+1]<<8;case 1:m^=d[h],m=s(m,b),m=c(m,15),m=s(m,S),O^=m}return O^=d.length,O=o(O),O>>>0},i.x86.hash128=function(d,v){if(i.inputValidation&&!a(d))return n;v=v||0;for(var A=d.length%16,j=d.length-A,O=v,m=v,b=v,S=v,h=0,g=0,w=0,y=0,P=597399067,D=2869860233,L=951274213,x=2716044179,B=0;B<j;B=B+16)h=d[B]|d[B+1]<<8|d[B+2]<<16|d[B+3]<<24,g=d[B+4]|d[B+5]<<8|d[B+6]<<16|d[B+7]<<24,w=d[B+8]|d[B+9]<<8|d[B+10]<<16|d[B+11]<<24,y=d[B+12]|d[B+13]<<8|d[B+14]<<16|d[B+15]<<24,h=s(h,P),h=c(h,15),h=s(h,D),O^=h,O=c(O,19),O+=m,O=s(O,5)+1444728091,g=s(g,D),g=c(g,16),g=s(g,L),m^=g,m=c(m,17),m+=b,m=s(m,5)+197830471,w=s(w,L),w=c(w,17),w=s(w,x),b^=w,b=c(b,15),b+=S,b=s(b,5)+2530024501,y=s(y,x),y=c(y,18),y=s(y,P),S^=y,S=c(S,13),S+=O,S=s(S,5)+850148119;h=0,g=0,w=0,y=0;switch(A){case 15:y^=d[B+14]<<16;case 14:y^=d[B+13]<<8;case 13:y^=d[B+12],y=s(y,x),y=c(y,18),y=s(y,P),S^=y;case 12:w^=d[B+11]<<24;case 11:w^=d[B+10]<<16;case 10:w^=d[B+9]<<8;case 9:w^=d[B+8],w=s(w,L),w=c(w,17),w=s(w,x),b^=w;case 8:g^=d[B+7]<<24;case 7:g^=d[B+6]<<16;case 6:g^=d[B+5]<<8;case 5:g^=d[B+4],g=s(g,D),g=c(g,16),g=s(g,L),m^=g;case 4:h^=d[B+3]<<24;case 3:h^=d[B+2]<<16;case 2:h^=d[B+1]<<8;case 1:h^=d[B],h=s(h,P),h=c(h,15),h=s(h,D),O^=h}return O^=d.length,m^=d.length,b^=d.length,S^=d.length,O+=m,O+=b,O+=S,m+=O,b+=O,S+=O,O=o(O),m=o(m),b=o(b),S=o(S),O+=m,O+=b,O+=S,m+=O,b+=O,S+=O,("00000000"+(O>>>0).toString(16)).slice(-8)+("00000000"+(m>>>0).toString(16)).slice(-8)+("00000000"+(b>>>0).toString(16)).slice(-8)+("00000000"+(S>>>0).toString(16)).slice(-8)},i.x64.hash128=function(d,v){if(i.inputValidation&&!a(d))return n;v=v||0;for(var A=d.length%16,j=d.length-A,O=[0,v],m=[0,v],b=[0,0],S=[0,0],h=[2277735313,289559509],g=[1291169091,658871167],w=0;w<j;w=w+16)b=[d[w+4]|d[w+5]<<8|d[w+6]<<16|d[w+7]<<24,d[w]|d[w+1]<<8|d[w+2]<<16|d[w+3]<<24],S=[d[w+12]|d[w+13]<<8|d[w+14]<<16|d[w+15]<<24,d[w+8]|d[w+9]<<8|d[w+10]<<16|d[w+11]<<24],b=l(b,h),b=f(b,31),b=l(b,g),O=p(O,b),O=f(O,27),O=u(O,m),O=u(l(O,[0,5]),[0,1390208809]),S=l(S,g),S=f(S,33),S=l(S,h),m=p(m,S),m=f(m,31),m=u(m,O),m=u(l(m,[0,5]),[0,944331445]);b=[0,0],S=[0,0];switch(A){case 15:S=p(S,_([0,d[w+14]],48));case 14:S=p(S,_([0,d[w+13]],40));case 13:S=p(S,_([0,d[w+12]],32));case 12:S=p(S,_([0,d[w+11]],24));case 11:S=p(S,_([0,d[w+10]],16));case 10:S=p(S,_([0,d[w+9]],8));case 9:S=p(S,[0,d[w+8]]),S=l(S,g),S=f(S,33),S=l(S,h),m=p(m,S);case 8:b=p(b,_([0,d[w+7]],56));case 7:b=p(b,_([0,d[w+6]],48));case 6:b=p(b,_([0,d[w+5]],40));case 5:b=p(b,_([0,d[w+4]],32));case 4:b=p(b,_([0,d[w+3]],24));case 3:b=p(b,_([0,d[w+2]],16));case 2:b=p(b,_([0,d[w+1]],8));case 1:b=p(b,[0,d[w]]),b=l(b,h),b=f(b,31),b=l(b,g),O=p(O,b)}return O=p(O,[0,d.length]),m=p(m,[0,d.length]),O=u(O,m),m=u(m,O),O=I(O),m=I(m),O=u(O,m),m=u(m,O),("00000000"+(O[0]>>>0).toString(16)).slice(-8)+("00000000"+(O[1]>>>0).toString(16)).slice(-8)+("00000000"+(m[0]>>>0).toString(16)).slice(-8)+("00000000"+(m[1]>>>0).toString(16)).slice(-8)},e.exports&&(t=e.exports=i),t.murmurHash3=i})()}),Lm=HR;const zR=e=>{const t=new Uint8Array(4);for(let r=0;r<4;r++)t[r]=e&255,e=e>>8;return t};var KR={fromNumberTo32BitBuf:zR},WR="Input must be an string, Buffer or Uint8Array";function XR(e){var t;if(e instanceof Uint8Array)t=e;else if(e instanceof Buffer)t=new Uint8Array(e);else if(typeof e=="string")t=new Uint8Array(Buffer.from(e,"utf8"));else throw new Error(WR);return t}function QR(e){return Array.prototype.map.call(e,function(t){return(t<16?"0":"")+t.toString(16)}).join("")}function pc(e){return(4294967296+e).toString(16).substring(1)}function YR(e,t,r){for(var n=`
`+e+" = ",i=0;i<t.length;i+=2){if(r===32)n+=pc(t[i]).toUpperCase(),n+=" ",n+=pc(t[i+1]).toUpperCase();else if(r===64)n+=pc(t[i+1]).toUpperCase(),n+=pc(t[i]).toUpperCase();else throw new Error("Invalid size "+r);i%6===4?n+=`
`+new Array(e.length+4).join(" "):i<t.length-2&&(n+=" ")}console.log(n)}function JR(e,t,r){for(var n=new Date().getTime(),i=new Uint8Array(t),a=0;a<t;a++)i[a]=a%256;var s=new Date().getTime();for(console.log("Generated random input in "+(s-n)+"ms"),n=s,a=0;a<r;a++){var c=e(i),o=new Date().getTime(),u=o-n;n=o,console.log("Hashed in "+u+"ms: "+c.substring(0,20)+"..."),console.log(Math.round(t/(1<<20)/(u/1e3)*100)/100+" MB PER SECOND")}}var fc={normalizeInput:XR,toHex:QR,debugPrint:YR,testSpeed:JR};function mc(e,t,r){var n=e[t]+e[r],i=e[t+1]+e[r+1];n>=4294967296&&i++,e[t]=n,e[t+1]=i}function jm(e,t,r,n){var i=e[t]+r;r<0&&(i+=4294967296);var a=e[t+1]+n;i>=4294967296&&a++,e[t]=i,e[t+1]=a}function ZR(e,t){return e[t]^e[t+1]<<8^e[t+2]<<16^e[t+3]<<24}function vi(e,t,r,n,i,a){var s=Gs[i],c=Gs[i+1],o=Gs[a],u=Gs[a+1];mc(Te,e,t),jm(Te,e,s,c);var l=Te[n]^Te[e],f=Te[n+1]^Te[e+1];Te[n]=f,Te[n+1]=l,mc(Te,r,n),l=Te[t]^Te[r],f=Te[t+1]^Te[r+1],Te[t]=l>>>24^f<<8,Te[t+1]=f>>>24^l<<8,mc(Te,e,t),jm(Te,e,o,u),l=Te[n]^Te[e],f=Te[n+1]^Te[e+1],Te[n]=l>>>16^f<<16,Te[n+1]=f>>>16^l<<16,mc(Te,r,n),l=Te[t]^Te[r],f=Te[t+1]^Te[r+1],Te[t]=f>>>31^l<<1,Te[t+1]=l>>>31^f<<1}var Um=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),ek=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],Ft=new Uint8Array(ek.map(function(e){return e*2})),Te=new Uint32Array(32),Gs=new Uint32Array(32);function Fm(e,t){var r=0;for(r=0;r<16;r++)Te[r]=e.h[r],Te[r+16]=Um[r];for(Te[24]=Te[24]^e.t,Te[25]=Te[25]^e.t/4294967296,t&&(Te[28]=~Te[28],Te[29]=~Te[29]),r=0;r<32;r++)Gs[r]=ZR(e.b,4*r);for(r=0;r<12;r++)vi(0,8,16,24,Ft[r*16+0],Ft[r*16+1]),vi(2,10,18,26,Ft[r*16+2],Ft[r*16+3]),vi(4,12,20,28,Ft[r*16+4],Ft[r*16+5]),vi(6,14,22,30,Ft[r*16+6],Ft[r*16+7]),vi(0,10,20,30,Ft[r*16+8],Ft[r*16+9]),vi(2,12,22,24,Ft[r*16+10],Ft[r*16+11]),vi(4,14,16,26,Ft[r*16+12],Ft[r*16+13]),vi(6,8,18,28,Ft[r*16+14],Ft[r*16+15]);for(r=0;r<16;r++)e.h[r]=e.h[r]^Te[r]^Te[r+16]}function qm(e,t){if(e===0||e>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(t&&t.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");for(var r={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:e},n=0;n<16;n++)r.h[n]=Um[n];var i=t?t.length:0;return r.h[0]^=16842752^i<<8^e,t&&(xl(r,t),r.c=128),r}function xl(e,t){for(var r=0;r<t.length;r++)e.c===128&&(e.t+=e.c,Fm(e,!1),e.c=0),e.b[e.c++]=t[r]}function Gm(e){for(e.t+=e.c;e.c<128;)e.b[e.c++]=0;Fm(e,!0);for(var t=new Uint8Array(e.outlen),r=0;r<e.outlen;r++)t[r]=e.h[r>>2]>>8*(r&3);return t}function $m(e,t,r){r=r||64,e=fc.normalizeInput(e);var n=qm(r,t);return xl(n,e),Gm(n)}function tk(e,t,r){var n=$m(e,t,r);return fc.toHex(n)}var $s={blake2b:$m,blake2bHex:tk,blake2bInit:qm,blake2bUpdate:xl,blake2bFinal:Gm};function rk(e,t){return e[t]^e[t+1]<<8^e[t+2]<<16^e[t+3]<<24}function wi(e,t,r,n,i,a){Be[e]=Be[e]+Be[t]+i,Be[n]=gc(Be[n]^Be[e],16),Be[r]=Be[r]+Be[n],Be[t]=gc(Be[t]^Be[r],12),Be[e]=Be[e]+Be[t]+a,Be[n]=gc(Be[n]^Be[e],8),Be[r]=Be[r]+Be[n],Be[t]=gc(Be[t]^Be[r],7)}function gc(e,t){return e>>>t^e<<32-t}var Vm=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),qt=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),Be=new Uint32Array(16),Pt=new Uint32Array(16);function Hm(e,t){var r=0;for(r=0;r<8;r++)Be[r]=e.h[r],Be[r+8]=Vm[r];for(Be[12]^=e.t,Be[13]^=e.t/4294967296,t&&(Be[14]=~Be[14]),r=0;r<16;r++)Pt[r]=rk(e.b,4*r);for(r=0;r<10;r++)wi(0,4,8,12,Pt[qt[r*16+0]],Pt[qt[r*16+1]]),wi(1,5,9,13,Pt[qt[r*16+2]],Pt[qt[r*16+3]]),wi(2,6,10,14,Pt[qt[r*16+4]],Pt[qt[r*16+5]]),wi(3,7,11,15,Pt[qt[r*16+6]],Pt[qt[r*16+7]]),wi(0,5,10,15,Pt[qt[r*16+8]],Pt[qt[r*16+9]]),wi(1,6,11,12,Pt[qt[r*16+10]],Pt[qt[r*16+11]]),wi(2,7,8,13,Pt[qt[r*16+12]],Pt[qt[r*16+13]]),wi(3,4,9,14,Pt[qt[r*16+14]],Pt[qt[r*16+15]]);for(r=0;r<8;r++)e.h[r]^=Be[r]^Be[r+8]}function zm(e,t){if(!(e>0&&e<=32))throw new Error("Incorrect output length, should be in [1, 32]");var r=t?t.length:0;if(t&&!(r>0&&r<=32))throw new Error("Incorrect key length, should be in [1, 32]");var n={h:new Uint32Array(Vm),b:new Uint32Array(64),c:0,t:0,outlen:e};return n.h[0]^=16842752^r<<8^e,r>0&&(Bl(n,t),n.c=64),n}function Bl(e,t){for(var r=0;r<t.length;r++)e.c===64&&(e.t+=e.c,Hm(e,!1),e.c=0),e.b[e.c++]=t[r]}function Km(e){for(e.t+=e.c;e.c<64;)e.b[e.c++]=0;Hm(e,!0);for(var t=new Uint8Array(e.outlen),r=0;r<e.outlen;r++)t[r]=e.h[r>>2]>>8*(r&3)&255;return t}function Wm(e,t,r){r=r||32,e=fc.normalizeInput(e);var n=zm(r,t);return Bl(n,e),Km(n)}function nk(e,t,r){var n=Wm(e,t,r);return fc.toHex(n)}var Vs={blake2s:Wm,blake2sHex:nk,blake2sInit:zm,blake2sUpdate:Bl,blake2sFinal:Km},Ga={blake2b:$s.blake2b,blake2bHex:$s.blake2bHex,blake2bInit:$s.blake2bInit,blake2bUpdate:$s.blake2bUpdate,blake2bFinal:$s.blake2bFinal,blake2s:Vs.blake2s,blake2sHex:Vs.blake2sHex,blake2sInit:Vs.blake2sInit,blake2sUpdate:Vs.blake2sUpdate,blake2sFinal:Vs.blake2sFinal};const ik=45569,ak=45633,sk={init:Ga.blake2bInit,update:Ga.blake2bUpdate,digest:Ga.blake2bFinal},ok={init:Ga.blake2sInit,update:Ga.blake2sUpdate,digest:Ga.blake2sFinal},Xm=(e,t)=>async r=>{const n=t.init(e,null);return t.update(n,r),t.digest(n)};var ck=e=>{for(let t=0;t<64;t++)e[ik+t]=Xm(t+1,sk);for(let t=0;t<32;t++)e[ak+t]=Xm(t+1,ok)};const{factory:bc}=Cg,{fromNumberTo32BitBuf:uk}=KR,xr=e=>async t=>{switch(e){case"sha3-224":return new Uint8Array(In.sha3_224.arrayBuffer(t));case"sha3-256":return new Uint8Array(In.sha3_256.arrayBuffer(t));case"sha3-384":return new Uint8Array(In.sha3_384.arrayBuffer(t));case"sha3-512":return new Uint8Array(In.sha3_512.arrayBuffer(t));case"shake-128":return new Uint8Array(In.shake128.create(128).update(t).arrayBuffer());case"shake-256":return new Uint8Array(In.shake256.create(256).update(t).arrayBuffer());case"keccak-224":return new Uint8Array(In.keccak224.arrayBuffer(t));case"keccak-256":return new Uint8Array(In.keccak256.arrayBuffer(t));case"keccak-384":return new Uint8Array(In.keccak384.arrayBuffer(t));case"keccak-512":return new Uint8Array(In.keccak512.arrayBuffer(t));case"murmur3-128":return st(Lm.x64.hash128(t),"base16");case"murmur3-32":return uk(Lm.x86.hash32(t));default:throw new TypeError(`${e} is not a supported algorithm`)}},lk=e=>e;var _t={identity:lk,sha1:bc("sha1"),sha2256:bc("sha2-256"),sha2512:bc("sha2-512"),dblSha2256:bc("dbl-sha2-256"),sha3224:xr("sha3-224"),sha3256:xr("sha3-256"),sha3384:xr("sha3-384"),sha3512:xr("sha3-512"),shake128:xr("shake-128"),shake256:xr("shake-256"),keccak224:xr("keccak-224"),keccak256:xr("keccak-256"),keccak384:xr("keccak-384"),keccak512:xr("keccak-512"),murmur3128:xr("murmur3-128"),murmur332:xr("murmur3-32"),addBlake:ck};async function Br(e,t,r){const n=await Br.digest(e,t,r);return Js.encode(n,t,r)}Br.multihash=Js,Br.digest=async(e,t,r)=>{const n=Br.createHash(t),i=await n(e);return r?i.slice(0,r):i},Br.createHash=function(e){if(!e)throw $(new Error("hash algorithm must be specified"),"ERR_HASH_ALGORITHM_NOT_SPECIFIED");if(e=Js.coerceCode(e),!Br.functions[e])throw $(new Error(`multihash function '${e}' not yet supported`),"ERR_HASH_ALGORITHM_NOT_SUPPORTED");return Br.functions[e]},Br.functions={0:_t.identity,17:_t.sha1,18:_t.sha2256,19:_t.sha2512,20:_t.sha3512,21:_t.sha3384,22:_t.sha3256,23:_t.sha3224,24:_t.shake128,25:_t.shake256,26:_t.keccak224,27:_t.keccak256,28:_t.keccak384,29:_t.keccak512,34:_t.murmur3128,35:_t.murmur332,86:_t.dblSha2256},_t.addBlake(Br.functions),Br.validate=async(e,t)=>{const r=await Br(e,Js.decode(t).name);return Dn(t,r)};var hk=Br;function dk(e,t){for(let r=0;r<e.byteLength;r++){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0}var pk=dk;class Qm extends Error{constructor(e="Unexpected Peer"){super(e);this.code=Qm.code}static get code(){return"ERR_UNEXPECTED_PEER"}}class Ym extends Error{constructor(e="Invalid crypto exchange"){super(e);this.code=Ym.code}static get code(){return"ERR_INVALID_CRYPTO_EXCHANGE"}}class Jm extends Error{constructor(e="Invalid crypto transmission"){super(e);this.code=Jm.code}static get code(){return"ERR_INVALID_CRYPTO_TRANSMISSION"}}var Ll={UnexpectedPeerError:Qm,InvalidCryptoExchangeError:Ym,InvalidCryptoTransmissionError:Jm},_i=le(function(e,t){const{InvalidCryptoExchangeError:r}=Ll;t.exchanges=["P-256","P-384","P-521"],t.ciphers=["AES-256","AES-128"],t.hashes=["SHA256","SHA512"],t.theBest=(a,s,c)=>{let o,u;if(a<0)o=c,u=s;else if(a>0)o=s,u=c;else return s[0];for(const l of o)for(const f of u)if(l===f)return l;throw new r("No algorithms in common!")},t.makeMacAndCipher=async a=>{[a.mac,a.cipher]=await Promise.all([n(a.hashT,a.keys.macKey),i(a.cipherT,a.keys.iv,a.keys.cipherKey)])};function n(a,s){return Rr.hmac.create(a,s)}function i(a,s,c){if(a==="AES-128"||a==="AES-256")return Rr.aes.create(c,s);throw new r(`unrecognized cipher type: ${a}`)}t.selectBest=async(a,s)=>{const c=await t.digest(dr([s.pubKeyBytes,a.nonce])),o=await t.digest(dr([a.pubKeyBytes,s.nonce])),u=pk(c,o);if(u===0)throw new r("you are trying to talk to yourself");return{curveT:t.theBest(u,a.exchanges,s.exchanges),cipherT:t.theBest(u,a.ciphers,s.ciphers),hashT:t.theBest(u,a.hashes,s.hashes),order:u}},t.digest=a=>hk.digest(a,"sha2-256",a.length)});const Ei=te("libp2p:secio");Ei.error=te("libp2p:secio:error");const{UnexpectedPeerError:fk}=Ll,mk=16;var gk=e=>(e.proposal.out={rand:Rr.randomBytes(mk),pubkey:e.key.local.public.bytes,exchanges:_i.exchanges.join(","),ciphers:_i.ciphers.join(","),hashes:_i.hashes.join(",")},e.proposalEncoded.out=dc.Propose.encode(e.proposal.out),e.proposalEncoded.out),bk=async e=>{const t=await Rr.keys.generateEphemeralKeyPair(e.protocols.local.curveT);e.ephemeralKey.local=t.key,e.shared.generate=t.genSharedKey;const r=dr([e.proposalEncoded.out,e.proposalEncoded.in,e.ephemeralKey.local]),n=await e.key.local.sign(r);return e.exchange.out={epubkey:e.ephemeralKey.local,signature:n},dc.Exchange.encode(e.exchange.out)},yk=async(e,t)=>{Ei("1.1 identify"),e.proposalEncoded.in=t,e.proposal.in=dc.Propose.decode(t);const r=e.proposal.in.pubkey;e.key.remote=Rr.keys.unmarshalPublicKey(r);const n=await Ae.createFromPubKey(qe(r,"base64pad"));if(e.id.remote){if(e.id.remote.toString()!==n.toString())throw new fk("Dialed to the wrong peer: IDs do not match!");e.id.remote.pubKey=e.key.remote}else e.id.remote=n;Ei("1.1 identify - %s - identified remote peer as %s",e.id.local.toB58String(),e.id.remote.toB58String())},vk=async e=>{Ei("1.2 selection");const t={pubKeyBytes:e.key.local.public.bytes,exchanges:_i.exchanges,hashes:_i.hashes,ciphers:_i.ciphers,nonce:e.proposal.out.rand},r={pubKeyBytes:e.proposal.in.pubkey,exchanges:e.proposal.in.exchanges.split(","),hashes:e.proposal.in.hashes.split(","),ciphers:e.proposal.in.ciphers.split(","),nonce:e.proposal.in.rand},n=await _i.selectBest(t,r);e.protocols.remote={order:n.order,curveT:n.curveT,cipherT:n.cipherT,hashT:n.hashT},e.protocols.local={order:n.order,curveT:n.curveT,cipherT:n.cipherT,hashT:n.hashT}},wk=async(e,t)=>{Ei("2.1. verify"),e.exchange.in=dc.Exchange.decode(t),e.ephemeralKey.remote=e.exchange.in.epubkey;const r=dr([e.proposalEncoded.in,e.proposalEncoded.out,e.ephemeralKey.remote]),n=await e.key.remote.verify(r,e.exchange.in.signature);if(!n)throw new Error("Bad signature");Ei("2.1. verify - signature verified")},_k=async e=>{Ei("2.2. keys");const t=await e.shared.generate(e.exchange.in.epubkey);e.shared.secret=t;const r=await Rr.keys.keyStretcher(e.protocols.local.cipherT,e.protocols.local.hashT,e.shared.secret);if(e.protocols.local.order>0)e.protocols.local.keys=r.k1,e.protocols.remote.keys=r.k2;else if(e.protocols.local.order<0)e.protocols.local.keys=r.k2,e.protocols.remote.keys=r.k1;else throw new Error("you are trying to talk to yourself");Ei("2.3. mac + cipher"),await Promise.all([e.protocols.local,e.protocols.remote].map(n=>_i.makeMacAndCipher(n)))},Ek=(e,t)=>{const r=e.proposal.out.rand;if(Dn(r,t))return;throw new Error(`Failed to read our encrypted nonce: ${qe(r,"base16")} != ${qe(t,"base16")}`)},Qi={createProposal:gk,createExchange:bk,identify:yk,selectProtocols:vk,verify:wk,generateKeys:_k,verifyNonce:Ek};const{int32BEEncode:Sk}=ct,$a=te("libp2p:secio");$a.error=te("libp2p:secio:error");var Ak=async function(t,r){$a("1. propose - start");const n=Qi.createProposal(t);$a("1. propose - writing proposal",n),await r.write(ct.encode.single(n,{lengthEncoder:Sk})),$a("1. propose - reading proposal");const i=(await r.readLP()).slice();$a("1. propose - read proposal",i),await Qi.identify(t,i),await Qi.selectProtocols(t),$a("1. propose - finish")};const Hs=te("libp2p:secio");Hs.error=te("libp2p:secio:error");var Tk=async function(t,r){Hs("2. exchange - start"),Hs("2. exchange - writing exchange");const n=await Qi.createExchange(t);await r.writeLP(n);const i=await r.readLP();Hs("2. exchange - reading exchange"),await Qi.verify(t,i.slice()),await Qi.generateKeys(t),Hs("2. exchange - finish")},Zm=function(){let t,r;const n=async a=>{if(t)throw new Error("already piped");t=Vc(a),r&&r(t)},i={[Symbol.asyncIterator](){return this},next(){return t?t.next():new Promise(a=>{r=s=>{r=null,a(s.next())}})}};return{sink:n,source:i}},Ck=function(){var e=Zm(),t=Zm();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]};/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Ik=function(t){return t!=null&&t.constructor!=null&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)},eg=(e,t={})=>{const r=os(e),n=ct.decode.fromReader(r.reader,t),i={read:async a=>{const{value:s,done:c}=await r.reader.next(a);if(c&&s.length<a)throw new Error("Couldn't read enough bytes");if(!s)throw new Error("Value is null");return s},readLP:async()=>{const{value:a,done:s}=await n.next();if(!a)throw new Error("Value is null");return a},readPB:async a=>{const s=await i.readLP();if(!s)throw new Error("Value is null");const c=Ik(s)?s:s.slice();return a.decode(c)},write:a=>{r.writer.push(a)},writeLP:a=>{i.write(ct.encode.single(a,t))},writePB:(a,s)=>{i.writeLP(s.encode(a))},pb:a=>({read:()=>i.readPB(a),write:s=>i.writePB(s,a)}),unwrap:()=>(r.rest(),r.stream)};return i};const{InvalidCryptoTransmissionError:tg}=Ll;var Rk=(e,t)=>async function*(r){for await(const n of r){const i=await e.encrypt(Ze.isBufferList(n)?n.slice():n),a=await t.digest(i);yield new Ze([i,a])}},kk=(e,t)=>async function*(r){for await(const n of r){const i=n.length,a=t.length;if(i<a)throw new tg(`buffer (${i}) shorter than MAC size (${a})`);const s=i-a,c=n.slice(0,s),o=n.slice(s),u=await t.digest(c);if(!Dn(o,u))throw new tg(`MAC Invalid: ${qe(o,"base16")} != ${qe(u,"base16")}`);const l=await e.decrypt(c);yield l}},rg={createBoxStream:Rk,createUnboxStream:kk};const yc=te("libp2p:secio");yc.error=te("libp2p:secio:error");const{int32BEEncode:Pk,int32BEDecode:Nk}=ct,Ok=8388608;var Dk=async function(t,r){yc("3. finish - start");const n=t.protocols,[i,a]=Ck(),s=r.unwrap();Lt(i,rg.createBoxStream(n.local.cipher,n.local.mac),ct.encode({lengthEncoder:Pk}),s,ct.decode({lengthDecoder:Nk,maxDataLength:Ok}),rg.createUnboxStream(n.remote.cipher,n.remote.mac),i).catch(u=>{yc.error("an error occurred in the crypto stream",u)});const c=eg(a);c.write(t.proposal.in.rand);const o=await c.read(t.proposal.in.rand.length);Qi.verifyNonce(t,o.slice()),yc("3. finish - finish"),t.secure=c.unwrap()},Mk=async function(t,r){await Ak(t,r),await Tk(t,r),await Dk(t,r),t.cleanSecrets()};class xk{constructor(e,t){this.setup(),this.id.local=e,this.id.remote=t,this.key.local=e.privKey}setup(){this.id={local:null,remote:null},this.key={local:null,remote:null},this.shake=null,this.cleanSecrets()}cleanSecrets(){this.shared={},this.ephemeralKey={local:null,remote:null},this.proposal={in:null,out:null},this.proposalEncoded={in:null,out:null},this.protocols={local:null,remote:null},this.exchange={in:null,out:null}}}var Bk=xk;const Lk=te("libp2p:secio");Lk.error=te("libp2p:secio:error");const{int32BEDecode:jk,int32BEEncode:Uk}=ct;async function ng(e,t,r){if(!e)throw new Error("no local private key provided");if(!t)throw new Error("no connection for the handshake provided");const n=new Bk(e,r),i=eg(t,{lengthDecoder:jk,lengthEncoder:Uk});return await Mk(n,i),{conn:n.secure,remotePeer:n.id.remote}}var Fk={protocol:"/secio/1.0.0",secureInbound:ng,secureOutbound:ng};class qk extends sp{constructor({min:e,max:t,multicodecs:r,handlers:n}){super({min:e,max:t,handlers:n});if(!r)throw new Error("one or more multicodec should be provided");if(!n)throw new Error("the handlers should be provided");if(typeof n.onConnect!="function")throw new Error("the 'onConnect' handler must be provided");if(typeof n.onDisconnect!="function")throw new Error("the 'onDisconnect' handler must be provided");this.multicodecs=Array.isArray(r)?r:[r],this._registrar=void 0,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerConnect=this._onPeerConnect.bind(this)}set registrar(e){this._registrar=e,this._registrar.peerStore.on("change:protocols",this._onProtocolChange),this._registrar.connectionManager.on("peer:connect",this._onPeerConnect),this._updatePeers(this._registrar.peerStore.peers.values())}_updatePeers(e){for(const{id:t,protocols:r}of e)if(this.multicodecs.filter(n=>r.includes(n)).length){this.peers.add(t.toB58String());const n=this._registrar.getConnection(t);n&&this._onConnect(t,n)}else this.peers.delete(t.toB58String())}_onProtocolChange({peerId:e,protocols:t}){const r=this.peers.has(e.toB58String()),n=t.filter(i=>this.multicodecs.includes(i));r&&n.length===0&&this._onDisconnect(e);for(const i of t)if(this.multicodecs.includes(i)){const a=this._registrar.peerStore.get(e);this._updatePeers([a]);return}}_onPeerConnect(e){const t=e.remotePeer,r=this._registrar.peerStore.protoBook.get(t);if(!r)return;this.multicodecs.find(n=>r.includes(n))&&(this.peers.add(t.toB58String()),this._onConnect(t,e))}}var Gk=On(qk,{className:"MulticodecTopology",symbolName:"@libp2p/js-interfaces/topology/multicodec-topology"}),$k={ERR_MISSING_SIGNATURE:"ERR_MISSING_SIGNATURE",ERR_INVALID_SIGNATURE:"ERR_INVALID_SIGNATURE"},jl={codes:$k},Vk=`
message RPC {
  repeated SubOpts subscriptions = 1;
  repeated Message msgs = 2;

  message SubOpts {
    optional bool subscribe = 1; // subscribe or unsubcribe
    optional string topicID = 2;
  }

  message Message {
    optional bytes from = 1;
    optional bytes data = 2;
    optional bytes seqno = 3;
    repeated string topicIDs = 4;
    optional bytes signature = 5;
    optional bytes key = 6;
  }
}`,Hk=`
// topicCID = cid(merkledag_protobuf(topicDescriptor)); (not the topic.name)
message TopicDescriptor {
  optional string name = 1;
  optional AuthOpts auth = 2;
  optional EncOpts enc = 2;

  message AuthOpts {
    optional AuthMode mode = 1;
    repeated bytes keys = 2; // root keys to trust

    enum AuthMode {
      NONE = 0; // no authentication, anyone can publish
      KEY = 1; // only messages signed by keys in the topic descriptor are accepted
      WOT = 2; // web of trust, certificates can allow publisher set to grow
    }
  }

  message EncOpts {
    optional EncMode mode = 1;
    repeated bytes keyHashes = 2; // the hashes of the shared keys used (salted)

    enum EncMode {
      NONE = 0; // no encryption, anyone can read
      SHAREDKEY = 1; // messages are encrypted with shared key
      WOT = 2; // web of trust, certificates can allow publisher set to grow
    }
  }
}`,vc=le(function(e,t){const r=_n(Vk),n=r.RPC,i=_n(Hk);t=e.exports,t.rpc=r,t.td=i,t.RPC=n,t.Message=n.Message,t.SubOpts=n.SubOpts});const ig=te("libp2p-pubsub:peer-streams");ig.error=te("libp2p-pubsub:peer-streams:error");class zk extends Bt{constructor({id:e,protocol:t}){super();this.id=e,this.protocol=t,this._rawOutboundStream=null,this._rawInboundStream=null,this._inboundAbortController=null,this.outboundStream=null,this.inboundStream=null}get isReadable(){return Boolean(this.inboundStream)}get isWritable(){return Boolean(this.outboundStream)}write(e){if(!this.isWritable){const t=this.id.toB58String();throw new Error("No writable connection to "+t)}this.outboundStream.push(e)}attachInboundStream(e){this._inboundAbortController=new Mi,this._rawInboundStream=e,this.inboundStream=gt(Lt(this._rawInboundStream,ct.decode()),this._inboundAbortController.signal,{returnOnAbort:!0}),this.emit("stream:inbound")}async attachOutboundStream(e){const t=this.outboundStream;t&&await this.outboundStream.end(!1),this._rawOutboundStream=e,this.outboundStream=lo({onEnd:r=>{this._rawOutboundStream.reset&&this._rawOutboundStream.reset(),this._rawOutboundStream=null,this.outboundStream=null,r!==!1&&this.emit("close")}}),Lt(this.outboundStream,ct.encode(),this._rawOutboundStream).catch(r=>{ig.error(r)}),t||this.emit("stream:outbound")}close(){this.outboundStream&&this.outboundStream.end(),this.inboundStream&&this._inboundAbortController.abort(),this._rawOutboundStream=null,this.outboundStream=null,this._rawInboundStream=null,this.inboundStream=null,this.emit("close")}}var Kk=zk,Si=le(function(e,t){t=e.exports,t.randomSeqno=()=>Wl(8),t.msgId=(r,n)=>r+qe(n,"base16"),t.anyMatch=(r,n)=>{let i;Array.isArray(n)?i=a=>n.indexOf(a)>-1:i=a=>n.has(a);for(const a of r)if(i(a))return!0;return!1},t.ensureArray=r=>Array.isArray(r)?r:[r],t.normalizeInRpcMessage=(r,n)=>{const i=Object.assign({},r);return r.from instanceof Uint8Array&&(i.from=qe(r.from,"base58btc")),n&&(i.receivedFrom=n),i},t.normalizeOutRpcMessage=r=>{const n=Object.assign({},r);return(typeof r.from=="string"||r.from instanceof String)&&(n.from=st(r.from,"base58btc")),(typeof r.data=="string"||r.data instanceof String)&&(n.data=st(r.data)),n}});const{Message:ag}=vc,Ul=st("libp2p-pubsub:");async function Wk(e,t){const r=dr([Ul,ag.encode(t)]),n=await e.privKey.sign(r);return{...t,signature:n,key:e.pubKey.bytes}}async function Xk(e){const t={...e};delete t.signature,delete t.key,t.from=Ae.createFromCID(t.from).toBytes();const r=dr([Ul,ag.encode(t)]),n=await sg(e);return n.verify(r,e.signature)}async function sg(e){const t=Ae.createFromCID(e.from);if(e.key){const r=await Ae.createFromPubKey(e.key);if(r.isEqual(t))return r.pubKey;throw new Error("Public Key does not match the originator")}else{if(t.pubKey)return t.pubKey;throw new Error("Could not get the public key from the originator id")}}var Qk={messagePublicKey:sg,signMessage:Wk,SignPrefix:Ul,verifySignature:Xk};const{codes:og}=jl,{signMessage:Yk,verifySignature:Jk}=Qk;class Zk extends Bt{constructor({debugName:e,multicodecs:t,libp2p:r,signMessages:n=!0,strictSigning:i=!0,canRelayMessage:a=!1,emitSelf:s=!1}){if(typeof e!="string")throw new Error("a debugname `string` is required");if(!t)throw new Error("multicodecs are required");if(!r)throw new Error("libp2p is required");super();this.log=te(e),this.log.err=te(`${e}:error`),this.multicodecs=Si.ensureArray(t),this._libp2p=r,this.registrar=r.registrar,this.peerId=r.peerId,this.started=!1,this.topics=new Map,this.subscriptions=new Set,this.peers=new Map,this.signMessages=n,this.strictSigning=i,this.canRelayMessage=a,this.emitSelf=s,this.topicValidators=new Map,this._registrarId=void 0,this._onIncomingStream=this._onIncomingStream.bind(this),this._onPeerConnected=this._onPeerConnected.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this)}start(){if(this.started)return;this.log("starting"),this.registrar.handle(this.multicodecs,this._onIncomingStream);const e=new Gk({multicodecs:this.multicodecs,handlers:{onConnect:this._onPeerConnected,onDisconnect:this._onPeerDisconnected}});this._registrarId=this.registrar.register(e),this.log("started"),this.started=!0}stop(){if(!this.started)return;this.registrar.unregister(this._registrarId),this.log("stopping"),this.peers.forEach(e=>e.close()),this.peers=new Map,this.subscriptions=new Set,this.started=!1,this.log("stopped")}_onIncomingStream({protocol:e,stream:t,connection:r}){const n=r.remotePeer,i=n.toB58String(),a=this._addPeer(n,e);a.attachInboundStream(t),this._processMessages(i,a.inboundStream,a)}async _onPeerConnected(e,t){const r=e.toB58String();this.log("connected",r);try{const{stream:n,protocol:i}=await t.newStream(this.multicodecs),a=this._addPeer(e,i);await a.attachOutboundStream(n)}catch(n){this.log.err(n)}this._sendSubscriptions(r,Array.from(this.subscriptions),!0)}_onPeerDisconnected(e,t){const r=e.toB58String();this.log("connection ended",r,t?t.message:""),this._removePeer(e)}_addPeer(e,t){const r=e.toB58String(),n=this.peers.get(r);if(n)return n;this.log("new peer",r);const i=new Kk({id:e,protocol:t});return this.peers.set(r,i),i.once("close",()=>this._removePeer(e)),i}_removePeer(e){if(!e)return;const t=e.toB58String(),r=this.peers.get(t);if(!r)return;r.removeAllListeners(),r.close(),this.log("delete peer",t),this.peers.delete(t);for(const n of this.topics.values())n.delete(t);return r}async _processMessages(e,t,r){try{await Lt(t,async n=>{for await(const i of n){const a=i instanceof Uint8Array?i:i.slice(),s=this._decodeRpc(a);this._processRpc(e,r,s)}})}catch(n){this._onPeerDisconnected(r.id,n)}}_processRpc(e,t,r){this.log("rpc from",e);const n=r.subscriptions,i=r.msgs;return n.length&&(n.forEach(a=>this._processRpcSubOpt(e,a)),this.emit("pubsub:subscription-change",t.id,n)),this._acceptFrom(e)?(i.length&&i.forEach(a=>{if(!(this.canRelayMessage||a.topicIDs.some(c=>this.subscriptions.has(c)))){this.log("received message we didn't subscribe to. Dropping.");return}const s=Si.normalizeInRpcMessage(a,e);this._processRpcMessage(s)}),!0):(this.log("received message from unacceptable peer %s",e),!1)}_processRpcSubOpt(e,t){const r=t.topicID;let n=this.topics.get(r);n||(n=new Set,this.topics.set(r,n)),t.subscribe?n.add(e):n.delete(e)}async _processRpcMessage(e){if(this.peerId.toB58String()===e.from&&!this.emitSelf)return;try{await this.validate(e)}catch(t){this.log("Message is invalid, dropping it. %O",t);return}this._emitMessage(e),this._publish(Si.normalizeOutRpcMessage(e))}_emitMessage(e){e.topicIDs.forEach(t=>{this.subscriptions.has(t)&&this.emit(t,e)})}getMsgId(e){return Si.msgId(e.from,e.seqno)}_acceptFrom(e){return!0}_decodeRpc(e){return vc.rpc.RPC.decode(e)}_encodeRpc(e){return vc.rpc.RPC.encode(e)}_sendRpc(e,t){const r=this.peers.get(e);if(!r||!r.isWritable){const n=`Cannot send RPC to ${e} as there is no open stream to it available`;this.log.err(n);return}r.write(this._encodeRpc(t))}_sendSubscriptions(e,t,r){return this._sendRpc(e,{subscriptions:t.map(n=>({topicID:n,subscribe:r}))})}async validate(e){if(this.strictSigning&&!e.signature)throw $(new Error("Signing required and no signature was present"),og.ERR_MISSING_SIGNATURE);if(e.signature&&!await Jk(e))throw $(new Error("Invalid message signature"),og.ERR_INVALID_SIGNATURE);for(const t of e.topicIDs){const r=this.topicValidators.get(t);if(!r)continue;await r(t,e)}}_buildMessage(e){const t=Si.normalizeOutRpcMessage(e);return this.signMessages?Yk(this.peerId,t):e}getSubscribers(e){if(!this.started)throw $(new Error("not started yet"),"ERR_NOT_STARTED_YET");if(!e||typeof e!="string")throw $(new Error("a string topic must be provided"),"ERR_NOT_VALID_TOPIC");const t=this.topics.get(e);return t?Array.from(t):[]}async publish(e,t){if(!this.started)throw new Error("Pubsub has not started");this.log("publish",e,t);const r=this.peerId.toB58String();let n={receivedFrom:r,from:r,data:t,seqno:Si.randomSeqno(),topicIDs:[e]};const i=await this._buildMessage(n);n=Si.normalizeInRpcMessage(i),this.emitSelf&&this._emitMessage(n),await this._publish(n)}_publish(e){throw $(new Error("publish must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}subscribe(e){if(!this.started)throw new Error("Pubsub has not started");this.subscriptions.has(e)||(this.subscriptions.add(e),this.peers.forEach((t,r)=>this._sendSubscriptions(r,[e],!0)))}unsubscribe(e){if(!this.started)throw new Error("Pubsub is not started");this.subscriptions.has(e)&&this.listenerCount(e)===0&&(this.subscriptions.delete(e),this.peers.forEach((t,r)=>this._sendSubscriptions(r,[e],!1)))}getTopics(){if(!this.started)throw new Error("Pubsub is not started");return Array.from(this.subscriptions)}}var Fl=Zk,eP=vc,tP=Si;Fl.message=eP,Fl.utils=tP;var rP=le(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MessageCache=void 0;class r{constructor(n,i,a){this.msgs=new Map,this.peertx=new Map,this.history=[];for(let s=0;s<i;s++)this.history[s]=[];this.gossip=n,this.msgIdFn=a}put(n){const i=this.getMsgId(n);this.msgs.set(i,n),this.history[0].push({msgID:i,topics:n.topicIDs})}getMsgId(n){return this.msgIdFn(n)}get(n){return this.msgs.get(n)}getForPeer(n,i){const a=this.msgs.get(n);if(!a)return[void 0,0];let s=this.peertx.get(n);s||(s=new Map,this.peertx.set(n,s));const c=(s.get(i)||0)+1;return s.set(i,c),[a,c]}getGossipIDs(n){const i=[];for(let a=0;a<this.gossip;a++)this.history[a].forEach(s=>{for(const c of s.topics)if(c===n){i.push(s.msgID);break}});return i}shift(){const n=this.history[this.history.length-1];n.forEach(i=>{this.msgs.delete(i.msgID),this.peertx.delete(i.msgID)}),this.history.pop(),this.history.unshift([])}}t.MessageCache=r}),nP=le(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=`
message RPC {
  repeated SubOpts subscriptions = 1;
  repeated Message msgs = 2;
  optional ControlMessage control = 3;

  message SubOpts {
    optional bool subscribe = 1; // subscribe or unsubcribe
    optional string topicID = 2;
  }

  message Message {
    optional bytes from = 1;
    optional bytes data = 2;
    optional bytes seqno = 3;
    repeated string topicIDs = 4; 
    optional bytes signature = 5;
    optional bytes key = 6;
  }

  message ControlMessage {
    repeated ControlIHave ihave = 1;
    repeated ControlIWant iwant = 2;
    repeated ControlGraft graft = 3;
    repeated ControlPrune prune = 4;
  }

  message ControlIHave {
    optional string topicID = 1;
    repeated string messageIDs = 2;
  }

  message ControlIWant {
    repeated string messageIDs = 1;  
  }

  message ControlGraft {
    optional string topicID = 1;
  }

  message ControlPrune {
    optional string topicID = 1;
    repeated PeerInfo peers = 2;
    optional uint64 backoff = 3;
  }

  message PeerInfo {
    optional bytes peerID = 1;
    optional bytes signedPeerRecord = 2;
  }
}`}),ql=le(function(e,t){var r=ge&&ge.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(t,"__esModule",{value:!0}),t.RPCCodec=void 0;const n=r(nP),i=_n(n.default);t.RPCCodec=i.RPC}),Yi=le(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ERR_TOPIC_VALIDATOR_IGNORE=t.ERR_TOPIC_VALIDATOR_REJECT=t.TimeCacheDuration=t.GossipsubIWantFollowupTime=t.GossipsubMaxIHaveMessages=t.GossipsubMaxIHaveLength=t.GossipsubGraftFloodThreshold=t.GossipsubOpportunisticGraftPeers=t.GossipsubOpportunisticGraftTicks=t.GossipsubDirectConnectInitialDelay=t.GossipsubDirectConnectTicks=t.GossipsubConnectionTimeout=t.GossipsubMaxPendingConnections=t.GossipsubConnectors=t.GossipsubPruneBackoffTicks=t.GossipsubPruneBackoff=t.GossipsubPrunePeers=t.GossipsubFanoutTTL=t.GossipsubHeartbeatInterval=t.GossipsubHeartbeatInitialDelay=t.GossipsubGossipRetransmission=t.GossipsubGossipFactor=t.GossipsubDlazy=t.GossipsubHistoryGossip=t.GossipsubHistoryLength=t.GossipsubDout=t.GossipsubDscore=t.GossipsubDhi=t.GossipsubDlo=t.GossipsubD=t.GossipsubIDv11=t.GossipsubIDv10=t.FloodsubID=t.minute=t.second=void 0,t.second=1e3,t.minute=60*t.second,t.FloodsubID="/floodsub/1.0.0",t.GossipsubIDv10="/meshsub/1.0.0",t.GossipsubIDv11="/meshsub/1.1.0",t.GossipsubD=6,t.GossipsubDlo=4,t.GossipsubDhi=12,t.GossipsubDscore=4,t.GossipsubDout=2,t.GossipsubHistoryLength=5,t.GossipsubHistoryGossip=3,t.GossipsubDlazy=6,t.GossipsubGossipFactor=.25,t.GossipsubGossipRetransmission=3,t.GossipsubHeartbeatInitialDelay=100,t.GossipsubHeartbeatInterval=t.second,t.GossipsubFanoutTTL=t.minute,t.GossipsubPrunePeers=16,t.GossipsubPruneBackoff=t.minute,t.GossipsubPruneBackoffTicks=15,t.GossipsubConnectors=8,t.GossipsubMaxPendingConnections=128,t.GossipsubConnectionTimeout=30*t.second,t.GossipsubDirectConnectTicks=300,t.GossipsubDirectConnectInitialDelay=t.second,t.GossipsubOpportunisticGraftTicks=60,t.GossipsubOpportunisticGraftPeers=2,t.GossipsubGraftFloodThreshold=10*t.second,t.GossipsubMaxIHaveLength=5e3,t.GossipsubMaxIHaveMessages=10,t.GossipsubIWantFollowupTime=3*t.second,t.TimeCacheDuration=120*1e3,t.ERR_TOPIC_VALIDATOR_REJECT="ERR_TOPIC_VALIDATOR_REJECT",t.ERR_TOPIC_VALIDATOR_IGNORE="ERR_TOPIC_VALIDATOR_IGNORE"}),iP=le(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createGossipRpc=void 0;function r(n=[],i={}){return{subscriptions:[],msgs:n,control:Object.assign({ihave:[],iwant:[],graft:[],prune:[]},i)}}t.createGossipRpc=r}),aP=le(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.shuffle=void 0;function r(n){if(n.length<=1)return n;const i=()=>Math.floor(Math.random()*Math.floor(n.length));for(let a=0;a<n.length;a++){const s=i(),c=n[a];n[a]=n[s],n[s]=c}return n}t.shuffle=r}),sP=le(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.hasGossipProtocol=void 0;function r(n){return n===Yi.GossipsubIDv10||n===Yi.GossipsubIDv11}t.hasGossipProtocol=r}),Nt=le(function(e,t){var r=ge&&ge.__createBinding||(Object.create?function(i,a,s,c){c===void 0&&(c=s),Object.defineProperty(i,c,{enumerable:!0,get:function(){return a[s]}})}:function(i,a,s,c){c===void 0&&(c=s),i[c]=a[s]}),n=ge&&ge.__exportStar||function(i,a){for(var s in i)s!=="default"&&!a.hasOwnProperty(s)&&r(a,i,s)};Object.defineProperty(t,"__esModule",{value:!0}),n(iP,t),n(aP,t),n(sP,t)}),Ai=le(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getGossipPeers=void 0;function r(n,i,a,s=()=>!0){const c=n.topics.get(i);if(!c)return new Set;let o=[];return c.forEach(u=>{const l=n.peers.get(u);if(!l)return;Nt.hasGossipProtocol(l.protocol)&&s(u)&&o.push(u)}),o=Nt.shuffle(o),a>0&&o.length>a&&(o=o.slice(0,a)),new Set(o)}t.getGossipPeers=r}),oP=le(function(e,t){var r=ge&&ge.__createBinding||(Object.create?function(c,o,u,l){l===void 0&&(l=u),Object.defineProperty(c,l,{enumerable:!0,get:function(){return o[u]}})}:function(c,o,u,l){l===void 0&&(l=u),c[l]=o[u]}),n=ge&&ge.__setModuleDefault||(Object.create?function(c,o){Object.defineProperty(c,"default",{enumerable:!0,value:o})}:function(c,o){c.default=o}),i=ge&&ge.__importStar||function(c){if(c&&c.__esModule)return c;var o={};if(c!=null)for(var u in c)u!=="default"&&Object.hasOwnProperty.call(c,u)&&r(o,c,u);return n(o,c),o};Object.defineProperty(t,"__esModule",{value:!0}),t.Heartbeat=void 0;const a=i(Yi);class s{constructor(c){this.gossipsub=c}start(){if(this._heartbeatTimer)return;const c=this._heartbeat.bind(this),o=setTimeout(()=>{c(),this._heartbeatTimer.runPeriodically(c,a.GossipsubHeartbeatInterval)},a.GossipsubHeartbeatInitialDelay);this._heartbeatTimer={_intervalId:void 0,runPeriodically:(u,l)=>{this._heartbeatTimer._intervalId=setInterval(u,l)},cancel:()=>{clearTimeout(o),clearInterval(this._heartbeatTimer._intervalId)}}}stop(){if(!this._heartbeatTimer)return;this._heartbeatTimer.cancel(),this._heartbeatTimer=null}_heartbeat(){const{D:c,Dlo:o,Dhi:u,Dscore:l,Dout:f}=this.gossipsub._options;this.gossipsub.heartbeatTicks++;const _=new Map,p=j=>{let O=_.get(j);return O===void 0&&(O=this.gossipsub.score.score(j),_.set(j,O)),O},I=new Map,d=new Map,v=new Map;this.gossipsub._clearBackoff(),this.gossipsub.peerhave.clear(),this.gossipsub.iasked.clear(),this.gossipsub._applyIwantPenalties(),this.gossipsub._directConnect(),this.gossipsub.mesh.forEach((j,O)=>{const m=S=>{this.gossipsub.log("HEARTBEAT: Remove mesh link to %s in %s",S,O),this.gossipsub.score.prune(S,O),this.gossipsub._addBackoff(S,O),j.delete(S);const h=d.get(S);h?h.push(O):d.set(S,[O])},b=S=>{this.gossipsub.log("HEARTBEAT: Add mesh link to %s in %s",S,O),this.gossipsub.score.graft(S,O),j.add(S);const h=I.get(S);h?h.push(O):I.set(S,[O])};if(j.forEach(S=>{const h=p(S);h<0&&(this.gossipsub.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",S,h,O),m(S),v.set(S,!0))}),j.size<o){const S=this.gossipsub.backoff.get(O),h=c-j.size,g=Ai.getGossipPeers(this.gossipsub,O,h,w=>!j.has(w)&&!this.gossipsub.direct.has(w)&&(!S||!S.has(w))&&p(w)>=0);g.forEach(b)}if(j.size>u){let S=Array.from(j);S.sort((g,w)=>p(w)-p(g)),S=S.slice(0,l).concat(Nt.shuffle(S.slice(l)));let h=0;if(S.slice(0,c).forEach(g=>{this.gossipsub.outbound.get(g)&&h++}),h<f){const g=y=>{const P=S[y];for(let D=y;D>0;D--)S[D]=S[D-1];S[0]=P};if(h>0){let y=h;for(let P=1;P<c&&y>0;P++)this.gossipsub.outbound.get(S[P])&&(g(P),y--)}let w=c-h;for(let y=c;y<S.length&&w>0;y++)this.gossipsub.outbound.get(S[y])&&(g(y),w--)}S.slice(c).forEach(m)}if(j.size>=o){let S=0;if(j.forEach(h=>{this.gossipsub.outbound.get(h)&&S++}),S<f){const h=f-S,g=this.gossipsub.backoff.get(O);Ai.getGossipPeers(this.gossipsub,O,h,w=>!j.has(w)&&!this.gossipsub.direct.has(w)&&(!g||!g.has(w))&&p(w)>=0).forEach(b)}}if(this.gossipsub.heartbeatTicks%a.GossipsubOpportunisticGraftTicks===0&&j.size>1){const S=Array.from(j).sort((w,y)=>p(w)-p(y)),h=j.size/2,g=p(S[h]);if(g<this.gossipsub._options.scoreThresholds.opportunisticGraftThreshold){const w=this.gossipsub.backoff.get(O),y=Ai.getGossipPeers(this.gossipsub,O,a.GossipsubOpportunisticGraftPeers,P=>j.has(P)&&!this.gossipsub.direct.has(P)&&(!w||!w.has(P))&&p(P)>g);y.forEach(P=>{this.gossipsub.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",P,O),b(P)})}}this.gossipsub._emitGossip(O,j)});const A=this.gossipsub._now();this.gossipsub.lastpub.forEach((j,O)=>{j+a.GossipsubFanoutTTL<A&&(this.gossipsub.fanout.delete(O),this.gossipsub.lastpub.delete(O))}),this.gossipsub.fanout.forEach((j,O)=>{const m=this.gossipsub.topics.get(O);if(j.forEach(b=>{(!m.has(b)||p(b)<this.gossipsub._options.scoreThresholds.publishThreshold)&&j.delete(b)}),j.size<c){const b=c-j.size,S=Ai.getGossipPeers(this.gossipsub,O,b,h=>!j.has(h)&&!this.gossipsub.direct.has(h)&&p(h)>=this.gossipsub._options.scoreThresholds.publishThreshold);S.forEach(h=>{j.add(h)})}this.gossipsub._emitGossip(O,j)}),this.gossipsub._sendGraftPrune(I,d,v),this.gossipsub._flush(),this.gossipsub.messageCache.shift(),this.gossipsub.emit("gossipsub:heartbeat")}}t.Heartbeat=s}),Le=le(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ERR_INVALID_PEER_SCORE_THRESHOLDS=t.ERR_INVALID_PEER_SCORE_PARAMS=void 0,t.ERR_INVALID_PEER_SCORE_PARAMS="ERR_INVALID_PEER_SCORE_PARAMS",t.ERR_INVALID_PEER_SCORE_THRESHOLDS="ERR_INVALID_PEER_SCORE_THRESHOLDS"}),cg=le(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validateTopicScoreParams=t.validatePeerScoreParams=t.createTopicScoreParams=t.createPeerScoreParams=t.defaultTopicScoreParams=t.defaultPeerScoreParams=void 0,t.defaultPeerScoreParams={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},t.defaultTopicScoreParams={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function r(s={}){return Object.assign(Object.assign(Object.assign({},t.defaultPeerScoreParams),s),{topics:s.topics?Object.entries(s.topics).reduce((c,[o,u])=>(c[o]=n(u),c),{}):{}})}t.createPeerScoreParams=r;function n(s={}){return Object.assign(Object.assign({},t.defaultTopicScoreParams),s)}t.createTopicScoreParams=n;function i(s){for(const[c,o]of Object.entries(s.topics))try{a(o)}catch(u){throw $(new Error(`invalid score parameters for topic ${c}: ${u.message}`),Le.ERR_INVALID_PEER_SCORE_PARAMS)}if(s.topicScoreCap<0)throw $(new Error("invalid topic score cap; must be positive (or 0 for no cap)"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.appSpecificScore===null||s.appSpecificScore===void 0)throw $(new Error("missing application specific score function"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.IPColocationFactorWeight>0)throw $(new Error("invalid IPColocationFactorWeight; must be negative (or 0 to disable)"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.IPColocationFactorWeight!==0&&s.IPColocationFactorThreshold<1)throw $(new Error("invalid IPColocationFactorThreshold; must be at least 1"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.behaviourPenaltyWeight>0)throw $(new Error("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.behaviourPenaltyWeight!==0&&(s.behaviourPenaltyDecay<=0||s.behaviourPenaltyDecay>=1))throw $(new Error("invalid BehaviourPenaltyDecay; must be between 0 and 1"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.decayInterval<1e3)throw $(new Error("invalid DecayInterval; must be at least 1s"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.decayToZero<=0||s.decayToZero>=1)throw $(new Error("invalid DecayToZero; must be between 0 and 1"),Le.ERR_INVALID_PEER_SCORE_PARAMS)}t.validatePeerScoreParams=i;function a(s){if(s.topicWeight<0)throw $(new Error("invalid topic weight; must be >= 0"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.timeInMeshQuantum===0)throw $(new Error("invalid TimeInMeshQuantum; must be non zero"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.timeInMeshWeight<0)throw $(new Error("invalid TimeInMeshWeight; must be positive (or 0 to disable)"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.timeInMeshWeight!==0&&s.timeInMeshQuantum<=0)throw $(new Error("invalid TimeInMeshQuantum; must be positive"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.timeInMeshWeight!==0&&s.timeInMeshCap<=0)throw $(new Error("invalid TimeInMeshCap; must be positive"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.firstMessageDeliveriesWeight<0)throw $(new Error("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.firstMessageDeliveriesWeight!==0&&(s.firstMessageDeliveriesDecay<=0||s.firstMessageDeliveriesDecay>=1))throw $(new Error("invalid FirstMessageDeliveriesDecay; must be between 0 and 1"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.firstMessageDeliveriesWeight!==0&&s.firstMessageDeliveriesCap<=0)throw $(new Error("invalid FirstMessageDeliveriesCap; must be positive"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.meshMessageDeliveriesWeight>0)throw $(new Error("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.meshMessageDeliveriesWeight!==0&&(s.meshMessageDeliveriesDecay<=0||s.meshMessageDeliveriesDecay>=1))throw $(new Error("invalid MeshMessageDeliveriesDecay; must be between 0 and 1"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.meshMessageDeliveriesWeight!==0&&s.meshMessageDeliveriesCap<=0)throw $(new Error("invalid MeshMessageDeliveriesCap; must be positive"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.meshMessageDeliveriesWeight!==0&&s.meshMessageDeliveriesThreshold<=0)throw $(new Error("invalid MeshMessageDeliveriesThreshold; must be positive"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.meshMessageDeliveriesWindow<0)throw $(new Error("invalid MeshMessageDeliveriesWindow; must be non-negative"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.meshMessageDeliveriesWeight!==0&&s.meshMessageDeliveriesActivation<1e3)throw $(new Error("invalid MeshMessageDeliveriesActivation; must be at least 1s"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.meshFailurePenaltyWeight>0)throw $(new Error("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.meshFailurePenaltyWeight!==0&&(s.meshFailurePenaltyDecay<=0||s.meshFailurePenaltyDecay>=1))throw $(new Error("invalid MeshFailurePenaltyDecay; must be between 0 and 1"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.invalidMessageDeliveriesWeight>0)throw $(new Error("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)"),Le.ERR_INVALID_PEER_SCORE_PARAMS);if(s.invalidMessageDeliveriesDecay<=0||s.invalidMessageDeliveriesDecay>=1)throw $(new Error("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1"),Le.ERR_INVALID_PEER_SCORE_PARAMS)}t.validateTopicScoreParams=a}),cP=le(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validatePeerScoreThresholds=t.createPeerScoreThresholds=t.defaultPeerScoreThresholds=void 0,t.defaultPeerScoreThresholds={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function r(i={}){return Object.assign(Object.assign({},t.defaultPeerScoreThresholds),i)}t.createPeerScoreThresholds=r;function n(i){if(i.gossipThreshold>0)throw $(new Error("invalid gossip threshold; it must be <= 0"),Le.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.publishThreshold>0||i.publishThreshold>i.gossipThreshold)throw $(new Error("invalid publish threshold; it must be <= 0 and <= gossip threshold"),Le.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.graylistThreshold>0||i.graylistThreshold>i.publishThreshold)throw $(new Error("invalid graylist threshold; it must be <= 0 and <= publish threshold"),Le.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.acceptPXThreshold<0)throw $(new Error("invalid accept PX threshold; it must be >= 0"),Le.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.opportunisticGraftThreshold<0)throw $(new Error("invalid opportunistic grafting threshold; it must be >= 0"),Le.ERR_INVALID_PEER_SCORE_THRESHOLDS)}t.validatePeerScoreThresholds=n}),Va=le(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ensureTopicStats=t.createTopicStats=t.createPeerStats=void 0;function r(a={}){return Object.assign(Object.assign({connected:!1,expire:0,ips:[],behaviourPenalty:0},a),{topics:a.topics?Object.entries(a.topics).reduce((s,[c,o])=>(s[c]=n(o),s),{}):{}})}t.createPeerStats=r;function n(a={}){return Object.assign({inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},a)}t.createTopicStats=n;function i(a,s,c){let o=s.topics[a];return o||(c.topics[a]?(s.topics[a]=o=n(),o):void 0)}t.ensureTopicStats=i}),uP=le(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.computeScore=void 0;function r(n,i,a,s){let c=0;Object.entries(i.topics).forEach(([l,f])=>{const _=a.topics[l];if(!_)return;let p=0;if(f.inMesh){let A=f.meshTime/_.timeInMeshQuantum;A>_.timeInMeshCap&&(A=_.timeInMeshCap),p+=A*_.timeInMeshWeight}const I=f.firstMessageDeliveries;if(p+=I*_.firstMessageDeliveriesWeight,f.meshMessageDeliveriesActive&&f.meshMessageDeliveries<_.meshMessageDeliveriesThreshold){const A=_.meshMessageDeliveriesThreshold-f.meshMessageDeliveries,j=A*A;p+=j*_.meshMessageDeliveriesWeight}const d=f.meshFailurePenalty;p+=d*_.meshFailurePenaltyWeight;const v=f.invalidMessageDeliveries*f.invalidMessageDeliveries;p+=v*_.invalidMessageDeliveriesWeight,c+=p*_.topicWeight}),a.topicScoreCap>0&&c>a.topicScoreCap&&(c=a.topicScoreCap);const o=a.appSpecificScore(n);c+=o*a.appSpecificWeight,i.ips.forEach(l=>{if(a.IPColocationFactorWhitelist.has(l))return;const f=s.get(l),_=f?f.size:0;if(_>a.IPColocationFactorThreshold){const p=_-a.IPColocationFactorThreshold,I=p*p;c+=I*a.IPColocationFactorWeight}});const u=i.behaviourPenalty*i.behaviourPenalty;return c+=u*a.behaviourPenaltyWeight,c}t.computeScore=r});function tt(e){this._head=0,this._tail=0,this._capacityMask=3,this._list=new Array(4),Array.isArray(e)&&this._fromArray(e)}tt.prototype.peekAt=function(t){var r=t;if(r!==(r|0))return;var n=this.size();return r>=n||r<-n?void 0:(r<0&&(r+=n),r=this._head+r&this._capacityMask,this._list[r])},tt.prototype.get=function(t){return this.peekAt(t)},tt.prototype.peek=function(){return this._head===this._tail?void 0:this._list[this._head]},tt.prototype.peekFront=function(){return this.peek()},tt.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(tt.prototype,"length",{get:function(){return this.size()}}),tt.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},tt.prototype.unshift=function(t){if(t===void 0)return this.size();var r=this._list.length;return this._head=this._head-1+r&this._capacityMask,this._list[this._head]=t,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},tt.prototype.shift=function(){var t=this._head;if(t===this._tail)return;var r=this._list[t];return this._list[t]=void 0,this._head=t+1&this._capacityMask,t<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),r},tt.prototype.push=function(t){if(t===void 0)return this.size();var r=this._tail;return this._list[r]=t,this._tail=r+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},tt.prototype.pop=function(){var t=this._tail;if(t===this._head)return;var r=this._list.length;this._tail=t-1+r&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&t>1e4&&t<=r>>>2&&this._shrinkArray(),n},tt.prototype.removeOne=function(t){var r=t;if(r!==(r|0))return;if(this._head===this._tail)return;var n=this.size(),i=this._list.length;if(r>=n||r<-n)return;r<0&&(r+=n),r=this._head+r&this._capacityMask;var a=this._list[r],s;if(t<n/2){for(s=t;s>0;s--)this._list[r]=this._list[r=r-1+i&this._capacityMask];this._list[r]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(s=n-1-t;s>0;s--)this._list[r]=this._list[r=r+1+i&this._capacityMask];this._list[r]=void 0,this._tail=this._tail-1+i&this._capacityMask}return a},tt.prototype.remove=function(t,r){var n=t,i,a=r;if(n!==(n|0))return;if(this._head===this._tail)return;var s=this.size(),c=this._list.length;if(n>=s||n<-s||r<1)return;if(n<0&&(n+=s),r===1||!r)return i=new Array(1),i[0]=this.removeOne(n),i;if(n===0&&n+r>=s)return i=this.toArray(),this.clear(),i;n+r>s&&(r=s-n);var o;for(i=new Array(r),o=0;o<r;o++)i[o]=this._list[this._head+n+o&this._capacityMask];if(n=this._head+n&this._capacityMask,t+r===s){for(this._tail=this._tail-r+c&this._capacityMask,o=r;o>0;o--)this._list[n=n+1+c&this._capacityMask]=void 0;return i}if(t===0){for(this._head=this._head+r+c&this._capacityMask,o=r-1;o>0;o--)this._list[n=n+1+c&this._capacityMask]=void 0;return i}if(n<s/2){for(this._head=this._head+t+r+c&this._capacityMask,o=t;o>0;o--)this.unshift(this._list[n=n-1+c&this._capacityMask]);for(n=this._head-1+c&this._capacityMask;a>0;)this._list[n=n-1+c&this._capacityMask]=void 0,a--;t<0&&(this._tail=n)}else{for(this._tail=n,n=n+r+c&this._capacityMask,o=s-(r+t);o>0;o--)this.push(this._list[n++]);for(n=this._tail;a>0;)this._list[n=n+1+c&this._capacityMask]=void 0,a--}return this._head<2&&this._tail>1e4&&this._tail<=c>>>2&&this._shrinkArray(),i},tt.prototype.splice=function(t,r){var n=t;if(n!==(n|0))return;var i=this.size();if(n<0&&(n+=i),n>i)return;if(arguments.length>2){var a,s,c,o=arguments.length,u=this._list.length,l=2;if(!i||n<i/2){for(s=new Array(n),a=0;a<n;a++)s[a]=this._list[this._head+a&this._capacityMask];for(r===0?(c=[],n>0&&(this._head=this._head+n+u&this._capacityMask)):(c=this.remove(n,r),this._head=this._head+n+u&this._capacityMask);o>l;)this.unshift(arguments[--o]);for(a=n;a>0;a--)this.unshift(s[a-1])}else{s=new Array(i-(n+r));var f=s.length;for(a=0;a<f;a++)s[a]=this._list[this._head+n+r+a&this._capacityMask];for(r===0?(c=[],n!=i&&(this._tail=this._head+n+u&this._capacityMask)):(c=this.remove(n,r),this._tail=this._tail-f+u&this._capacityMask);l<o;)this.push(arguments[l++]);for(a=0;a<f;a++)this.push(s[a])}return c}else return this.remove(n,r)},tt.prototype.clear=function(){this._head=0,this._tail=0},tt.prototype.isEmpty=function(){return this._head===this._tail},tt.prototype.toArray=function(){return this._copyArray(!1)},tt.prototype._fromArray=function(t){for(var r=0;r<t.length;r++)this.push(t[r])},tt.prototype._copyArray=function(t){var r=[],n=this._list,i=n.length,a;if(t||this._head>this._tail){for(a=this._head;a<i;a++)r.push(n[a]);for(a=0;a<this._tail;a++)r.push(n[a])}else for(a=this._head;a<this._tail;a++)r.push(n[a]);return r},tt.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length*=2,this._capacityMask=this._capacityMask<<1|1},tt.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};var lP=tt,tn=le(function(e,t){var r=ge&&ge.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageDeliveries=t.DeliveryRecordStatus=void 0;const n=r(lP);var i;(function(s){s[s.unknown=0]="unknown",s[s.valid=1]="valid",s[s.invalid=2]="invalid",s[s.ignored=3]="ignored"})(i=t.DeliveryRecordStatus||(t.DeliveryRecordStatus={}));class a{constructor(){this.records=new Map,this.queue=new n.default}ensureRecord(s){let c=this.records.get(s);if(c)return c;c={status:i.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(s,c);const o={msgId:s,expire:Date.now()+Yi.TimeCacheDuration};return this.queue.push(o),c}gc(){const s=Date.now();let c=this.queue.peekFront();for(;c&&c.expire<s;)this.records.delete(c.msgId),this.queue.shift(),c=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}t.MessageDeliveries=a}),hP=le(function(e,t){var r=ge&&ge.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0}),t.PeerScore=void 0;const n=r(Ae),{ERR_INVALID_SIGNATURE:i,ERR_MISSING_SIGNATURE:a}=jl.codes,s=te("libp2p:gossipsub:score");class c{constructor(o,u,l){cg.validatePeerScoreParams(o),this.params=o,this._connectionManager=u,this.peerStats=new Map,this.peerIPs=new Map,this.deliveryRecords=new tn.MessageDeliveries,this.msgId=l}start(){if(this._backgroundInterval){s("Peer score already running");return}this._backgroundInterval=setInterval(()=>this.background(),this.params.decayInterval),s("started")}stop(){if(!this._backgroundInterval){s("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),s("stopped")}background(){this._refreshScores(),this._updateIPs(),this.deliveryRecords.gc()}_refreshScores(){const o=Date.now(),u=this.params.decayToZero;this.peerStats.forEach((l,f)=>{if(!l.connected){o>l.expire&&(this._removeIPs(f,l.ips),this.peerStats.delete(f));return}Object.entries(l.topics).forEach(([_,p])=>{const I=this.params.topics[_];if(!I)return;p.firstMessageDeliveries*=I.firstMessageDeliveriesDecay,p.firstMessageDeliveries<u&&(p.firstMessageDeliveries=0),p.meshMessageDeliveries*=I.meshMessageDeliveriesDecay,p.meshMessageDeliveries<u&&(p.meshMessageDeliveries=0),p.meshFailurePenalty*=I.meshFailurePenaltyDecay,p.meshFailurePenalty<u&&(p.meshFailurePenalty=0),p.invalidMessageDeliveries*=I.invalidMessageDeliveriesDecay,p.invalidMessageDeliveries<u&&(p.invalidMessageDeliveries=0),p.inMesh&&(p.meshTime=o-p.graftTime,p.meshTime>I.meshMessageDeliveriesActivation&&(p.meshMessageDeliveriesActive=!0))}),l.behaviourPenalty*=this.params.behaviourPenaltyDecay,l.behaviourPenalty<u&&(l.behaviourPenalty=0)})}score(o){const u=this.peerStats.get(o);return u?uP.computeScore(o,u,this.params,this.peerIPs):0}addPenalty(o,u){const l=this.peerStats.get(o);if(!l)return;l.behaviourPenalty+=u}addPeer(o){const u=Va.createPeerStats({connected:!0});this.peerStats.set(o,u);const l=this._getIPs(o);this._setIPs(o,l,u.ips),u.ips=l}removePeer(o){const u=this.peerStats.get(o);if(!u)return;if(this.score(o)>0){this._removeIPs(o,u.ips),this.peerStats.delete(o);return}Object.entries(u.topics).forEach(([l,f])=>{f.firstMessageDeliveries=0;const _=this.params.topics[l].meshMessageDeliveriesThreshold;if(f.inMesh&&f.meshMessageDeliveriesActive&&f.meshMessageDeliveries<_){const p=_-f.meshMessageDeliveries;f.meshFailurePenalty+=p*p}f.inMesh=!1}),u.connected=!1,u.expire=Date.now()+this.params.retainScore}graft(o,u){const l=this.peerStats.get(o);if(!l)return;const f=Va.ensureTopicStats(u,l,this.params);if(!f)return;f.inMesh=!0,f.graftTime=Date.now(),f.meshTime=0,f.meshMessageDeliveriesActive=!1}prune(o,u){const l=this.peerStats.get(o);if(!l)return;const f=Va.ensureTopicStats(u,l,this.params);if(!f)return;const _=this.params.topics[u].meshMessageDeliveriesThreshold;if(f.meshMessageDeliveriesActive&&f.meshMessageDeliveries<_){const p=_-f.meshMessageDeliveries;f.meshFailurePenalty+=p*p}f.inMesh=!1}validateMessage(o){this.deliveryRecords.ensureRecord(this.msgId(o))}deliverMessage(o){const u=o.receivedFrom;this._markFirstMessageDelivery(u,o);const l=this.deliveryRecords.ensureRecord(this.msgId(o)),f=Date.now();if(l.status!==tn.DeliveryRecordStatus.unknown){s("unexpected delivery: message from %s was first seen %s ago and has delivery status %d",u,f-l.firstSeen,tn.DeliveryRecordStatus[l.status]);return}l.status=tn.DeliveryRecordStatus.valid,l.validated=f,l.peers.forEach(_=>{_!==u&&this._markDuplicateMessageDelivery(_,o)})}rejectMessage(o,u){const l=o.receivedFrom;switch(u){case a:case i:this._markInvalidMessageDelivery(l,o);return}const f=this.deliveryRecords.ensureRecord(this.msgId(o));if(f.status!==tn.DeliveryRecordStatus.unknown){s("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",l,Date.now()-f.firstSeen,tn.DeliveryRecordStatus[f.status]);return}switch(u){case Yi.ERR_TOPIC_VALIDATOR_IGNORE:f.status=tn.DeliveryRecordStatus.ignored;return}f.status=tn.DeliveryRecordStatus.invalid,this._markInvalidMessageDelivery(l,o),f.peers.forEach(_=>{this._markInvalidMessageDelivery(_,o)})}duplicateMessage(o){const u=o.receivedFrom,l=this.deliveryRecords.ensureRecord(this.msgId(o));if(l.peers.has(u))return;switch(l.status){case tn.DeliveryRecordStatus.unknown:l.peers.add(u);break;case tn.DeliveryRecordStatus.valid:l.peers.add(u),this._markDuplicateMessageDelivery(u,o,l.validated);break;case tn.DeliveryRecordStatus.invalid:this._markInvalidMessageDelivery(u,o);break}}_markInvalidMessageDelivery(o,u){const l=this.peerStats.get(o);if(!l)return;u.topicIDs.forEach(f=>{const _=Va.ensureTopicStats(f,l,this.params);if(!_)return;_.invalidMessageDeliveries+=1})}_markFirstMessageDelivery(o,u){const l=this.peerStats.get(o);if(!l)return;u.topicIDs.forEach(f=>{const _=Va.ensureTopicStats(f,l,this.params);if(!_)return;let p=this.params.topics[f].firstMessageDeliveriesCap;if(_.firstMessageDeliveries+=1,_.firstMessageDeliveries>p&&(_.firstMessageDeliveries=p),!_.inMesh)return;p=this.params.topics[f].meshMessageDeliveriesCap,_.meshMessageDeliveries+=1,_.meshMessageDeliveries>p&&(_.meshMessageDeliveries=p)})}_markDuplicateMessageDelivery(o,u,l=0){const f=this.peerStats.get(o);if(!f)return;const _=l?Date.now():0;u.topicIDs.forEach(p=>{const I=Va.ensureTopicStats(p,f,this.params);if(!I)return;if(!I.inMesh)return;const d=this.params.topics[p];if(l&&_>l+d.meshMessageDeliveriesWindow)return;const v=d.meshMessageDeliveriesCap;I.meshMessageDeliveries+=1,I.meshMessageDeliveries>v&&(I.meshMessageDeliveries=v)})}_getIPs(o){return this._connectionManager.getAll(n.default.createFromB58String(o)).map(u=>u.remoteAddr.toOptions().host)}_setIPs(o,u,l){e:for(const f of u){for(const p of l)if(f===p)continue e;let _=this.peerIPs.get(f);_||(_=new Set,this.peerIPs.set(f,_)),_.add(o)}e:for(const f of l){for(const p of u)if(f===p)continue e;const _=this.peerIPs.get(f);if(!_)continue;_.delete(o),_.size||this.peerIPs.delete(f)}}_removeIPs(o,u){u.forEach(l=>{const f=this.peerIPs.get(l);if(!f)return;f.delete(o),f.size||this.peerIPs.delete(l)})}_updateIPs(){this.peerStats.forEach((o,u)=>{const l=this._getIPs(u);this._setIPs(u,l,o.ips),o.ips=l})}}t.PeerScore=c}),Gl=le(function(e,t){var r=ge&&ge.__createBinding||(Object.create?function(i,a,s,c){c===void 0&&(c=s),Object.defineProperty(i,c,{enumerable:!0,get:function(){return a[s]}})}:function(i,a,s,c){c===void 0&&(c=s),i[c]=a[s]}),n=ge&&ge.__exportStar||function(i,a){for(var s in i)s!=="default"&&!a.hasOwnProperty(s)&&r(a,i,s)};Object.defineProperty(t,"__esModule",{value:!0}),n(cg,t),n(cP,t),n(hP,t)}),dP=le(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.IWantTracer=void 0;const{ERR_INVALID_SIGNATURE:r,ERR_MISSING_SIGNATURE:n}=jl.codes;class i{constructor(a){this.getMsgId=a,this.promises=new Map}addPromise(a,s){const c=Math.floor(Math.random()*s.length),o=s[c];let u=this.promises.get(o);u||(u=new Map,this.promises.set(o,u)),u.has(a)||u.set(a,Date.now()+Yi.GossipsubIWantFollowupTime)}getBrokenPromises(){const a=Date.now(),s=new Map;return this.promises.forEach((c,o)=>{c.forEach((u,l)=>{u<a&&(s.set(l,(s.get(l)||0)+1),c.delete(l))}),c.size||this.promises.delete(o)}),s}deliverMessage(a){const s=this.getMsgId(a);this.promises.delete(s)}rejectMessage(a,s){switch(s){case r:case n:return}const c=this.getMsgId(a);this.promises.delete(c)}clear(){this.promises.clear()}}t.IWantTracer=i}),ug="Expected a function",lg=0/0,pP="[object Symbol]",fP=/^\s+|\s+$/g,mP=/^[-+]0x[0-9a-f]+$/i,gP=/^0b[01]+$/i,bP=/^0o[0-7]+$/i,yP=parseInt,vP=typeof ge=="object"&&ge&&ge.Object===Object&&ge,wP=typeof self=="object"&&self&&self.Object===Object&&self,_P=vP||wP||Function("return this")(),EP=Object.prototype,SP=EP.toString,AP=Math.max,TP=Math.min,$l=function(){return _P.Date.now()};function CP(e,t,r){var n,i,a,s,c,o,u=0,l=!1,f=!1,_=!0;if(typeof e!="function")throw new TypeError(ug);t=hg(t)||0,wc(r)&&(l=!!r.leading,f="maxWait"in r,a=f?AP(hg(r.maxWait)||0,t):a,_="trailing"in r?!!r.trailing:_);function p(S){var h=n,g=i;return n=i=void 0,u=S,s=e.apply(g,h),s}function I(S){return u=S,c=setTimeout(A,t),l?p(S):s}function d(S){var h=S-o,g=S-u,w=t-h;return f?TP(w,a-g):w}function v(S){var h=S-o,g=S-u;return o===void 0||h>=t||h<0||f&&g>=a}function A(){var S=$l();if(v(S))return j(S);c=setTimeout(A,d(S))}function j(S){return c=void 0,_&&n?p(S):(n=i=void 0,s)}function O(){c!==void 0&&clearTimeout(c),u=0,n=o=i=c=void 0}function m(){return c===void 0?s:j($l())}function b(){var S=$l(),h=v(S);if(n=arguments,i=this,o=S,h){if(c===void 0)return I(o);if(f)return c=setTimeout(A,t),p(o)}return c===void 0&&(c=setTimeout(A,t)),s}return b.cancel=O,b.flush=m,b}function IP(e,t,r){var n=!0,i=!0;if(typeof e!="function")throw new TypeError(ug);return wc(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),CP(e,t,{leading:n,maxWait:t,trailing:i})}function wc(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function RP(e){return!!e&&typeof e=="object"}function kP(e){return typeof e=="symbol"||RP(e)&&SP.call(e)==pP}function hg(e){if(typeof e=="number")return e;if(kP(e))return lg;if(wc(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=wc(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(fP,"");var r=gP.test(e);return r||bP.test(e)?yP(e.slice(2),r?2:8):mP.test(e)?lg:+e}var PP=IP,NP=le(function(e,t){t=e.exports=r;function r(i){if(!(this instanceof r))return new r(i);i=i||{};const a=i.validity||30,s=new Map,c=PP(()=>{s.forEach((o,u)=>{const l=o.validity||a,f=n(o.timestamp);f>l&&s.delete(u)})},200);this.put=(o,u,l)=>{this.has(o)||s.set(o,{value:u,timestamp:new Date,validity:l}),c()},this.get=o=>{if(s.has(o))return s.get(o).value;throw new Error("key does not exist")},this.has=o=>s.has(o)}function n(i){const a=new Date,s=a.getTime()-i.getTime();return Math.floor(s/1e3)}}),OP=le(function(e){var t=ge&&ge.__createBinding||(Object.create?function(o,u,l,f){f===void 0&&(f=l),Object.defineProperty(o,f,{enumerable:!0,get:function(){return u[l]}})}:function(o,u,l,f){f===void 0&&(f=l),o[f]=u[l]}),r=ge&&ge.__setModuleDefault||(Object.create?function(o,u){Object.defineProperty(o,"default",{enumerable:!0,value:u})}:function(o,u){o.default=u}),n=ge&&ge.__importStar||function(o){if(o&&o.__esModule)return o;var u={};if(o!=null)for(var l in o)l!=="default"&&Object.hasOwnProperty.call(o,l)&&t(u,o,l);return r(u,o),u},i=ge&&ge.__awaiter||function(o,u,l,f){function _(p){return p instanceof l?p:new l(function(I){I(p)})}return new(l||(l=Promise))(function(p,I){function d(j){try{A(f.next(j))}catch(O){I(O)}}function v(j){try{A(f.throw(j))}catch(O){I(O)}}function A(j){j.done?p(j.value):_(j.value).then(d,v)}A((f=f.apply(o,u||[])).next())})};const a=n(Fl),s=n(Yi);class c extends a.default{constructor(o,u={}){const l=[s.GossipsubIDv11,s.GossipsubIDv10],f=Object.assign(Object.assign({gossipIncoming:!0,fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:s.GossipsubD,Dlo:s.GossipsubDlo,Dhi:s.GossipsubDhi,Dscore:s.GossipsubDscore,Dout:s.GossipsubDout,Dlazy:s.GossipsubDlazy,signMessages:!0,strictSigning:!0},u),{scoreParams:Gl.createPeerScoreParams(u.scoreParams),scoreThresholds:Gl.createPeerScoreThresholds(u.scoreThresholds)});f.fallbackToFloodsub&&l.push(s.FloodsubID),super(Object.assign({debugName:"libp2p:gossipsub",multicodecs:l,libp2p:o},f)),this._options=f,this.direct=new Set(f.directPeers.map(_=>_.id.toB58String())),f.directPeers.forEach(_=>{o.peerStore.addressBook.add(_.id,_.addrs)}),this.seenCache=new NP,this.mesh=new Map,this.fanout=new Map,this.lastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.defaultMsgIdFn=_=>a.utils.msgId(_.from,_.seqno),this._msgIdFn=u.msgIdFn||this.defaultMsgIdFn,this.messageCache=u.messageCache||new rP.MessageCache(s.GossipsubHistoryGossip,s.GossipsubHistoryLength,this._msgIdFn),this.heartbeat=new oP.Heartbeat(this),this.heartbeatTicks=0,this.gossipTracer=new dP.IWantTracer(this._msgIdFn),this._libp2p=o,this.score=new Gl.PeerScore(this._options.scoreParams,o.connectionManager,this._msgIdFn)}_decodeRpc(o){return ql.RPCCodec.decode(o)}_encodeRpc(o){return ql.RPCCodec.encode(o)}_addPeer(o,u){const l=super._addPeer(o,u);this.score.addPeer(o.toB58String());let f=!1;for(const _ of this._libp2p.connectionManager.getAll(o))if(_.stat.direction==="outbound"&&Array.from(_.registry.values()).some(p=>u===p.protocol)){f=!0;break}return this.outbound.set(l.id.toB58String(),f),l}_removePeer(o){const u=super._removePeer(o),l=o.toB58String();for(const f of this.mesh.values())f.delete(l);for(const f of this.fanout.values())f.delete(l);return this.gossip.delete(l),this.control.delete(l),this.outbound.delete(l),this.score.removePeer(l),u}_processRpc(o,u,l){return super._processRpc(o,u,l)?(l.control&&this._processRpcControlMessage(o,l.control),!0):!1}_processRpcControlMessage(o,u){if(!u)return;const l=this._handleIHave(o,u.ihave),f=this._handleIWant(o,u.iwant),_=this._handleGraft(o,u.graft);if(this._handlePrune(o,u.prune),!l.length&&!f.length&&!_.length)return;const p=Nt.createGossipRpc(f,{iwant:l,prune:_});this._sendRpc(o,p)}_processRpcMessage(o){const u=Object.create(null,{_processRpcMessage:{get:()=>super._processRpcMessage}});return i(this,void 0,void 0,function*(){const l=this.getMsgId(o);if(this.seenCache.has(l)){this.score.duplicateMessage(o);return}this.seenCache.put(l),this.score.validateMessage(o),yield u._processRpcMessage.call(this,o)})}_acceptFrom(o){return this.direct.has(o)||this.score.score(o)>=this._options.scoreThresholds.graylistThreshold}validate(o){const u=Object.create(null,{validate:{get:()=>super.validate}});return i(this,void 0,void 0,function*(){try{yield u.validate.call(this,o)}catch(l){throw this.score.rejectMessage(o,l.code),this.gossipTracer.rejectMessage(o,l.code),l}})}_handleIHave(o,u){if(!u.length)return[];const l=this.score.score(o);if(l<this._options.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",o,l),[];const f=(this.peerhave.get(o)||0)+1;if(this.peerhave.set(o,f),f>s.GossipsubMaxIHaveMessages)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",o,f),[];const _=this.iasked.get(o)||0;if(_>=s.GossipsubMaxIHaveLength)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",o,_),[];const p=new Set;if(u.forEach(({topicID:v,messageIDs:A})=>{if(!v||!this.mesh.has(v))return;A.forEach(j=>{if(this.seenCache.has(j))return;p.add(j)})}),!p.size)return[];let I=p.size;I+_>s.GossipsubMaxIHaveLength&&(I=s.GossipsubMaxIHaveLength-_),this.log("IHAVE: Asking for %d out of %d messages from %s",I,p.size,o);let d=Array.from(p);return Nt.shuffle(d),d=d.slice(0,I),this.iasked.set(o,_+I),this.gossipTracer.addPromise(o,d),[{messageIDs:d}]}_handleIWant(o,u){if(!u.length)return[];const l=this.score.score(o);if(l<this._options.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",o,l),[];const f=new Map;return u.forEach(({messageIDs:_})=>{_.forEach(p=>{const[I,d]=this.messageCache.getForPeer(p,o);if(!I)return;if(d>s.GossipsubGossipRetransmission){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",o,p);return}f.set(p,I)})}),f.size?(this.log("IWANT: Sending %d messages to %s",f.size,o),Array.from(f.values()).map(a.utils.normalizeOutRpcMessage)):[]}_handleGraft(o,u){const l=[],f=this.score.score(o),_=this._now();let p=this._options.doPX;return u.forEach(({topicID:I})=>{var d;if(!I)return;const v=this.mesh.get(I);if(!v){p=!1;return}if(v.has(o))return;if(this.direct.has(o)){this.log("GRAFT: ignoring request from direct peer %s",o),l.push(I),p=!1;return}const A=(d=this.backoff.get(I))===null||d===void 0?void 0:d.get(o);if(typeof A=="number"&&_<A){this.log("GRAFT: ignoring backed off peer %s",o),this.score.addPenalty(o,1),p=!1;const j=A+s.GossipsubGraftFloodThreshold-s.GossipsubPruneBackoff;_<j&&this.score.addPenalty(o,1),this._addBackoff(o,I),l.push(I);return}if(f<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",o,f,I),l.push(I),p=!1,this._addBackoff(o,I);return}if(v.size>=this._options.Dhi&&!this.outbound.get(o)){l.push(I),this._addBackoff(o,I);return}this.log("GRAFT: Add mesh link from %s in %s",o,I),this.score.graft(o,I),v.add(o)}),l.length?l.map(I=>this._makePrune(o,I,p)):[]}_handlePrune(o,u){const l=this.score.score(o);u.forEach(({topicID:f,backoff:_,peers:p})=>{if(!f)return;const I=this.mesh.get(f);if(!I)return;if(this.log("PRUNE: Remove mesh link to %s in %s",o,f),this.score.prune(o,f),I.delete(o),typeof _=="number"&&_>0?this._doAddBackoff(o,f,_*1e3):this._addBackoff(o,f),p&&p.length){if(l<this._options.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",o,l,f);return}this._pxConnect(p)}})}_addBackoff(o,u){this._doAddBackoff(o,u,s.GossipsubPruneBackoff)}_doAddBackoff(o,u,l){let f=this.backoff.get(u);f||(f=new Map,this.backoff.set(u,f));const _=this._now()+l,p=f.get(o)||0;p<_&&f.set(o,_)}_applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((o,u)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",u,o),this.score.addPenalty(u,o)})}_clearBackoff(){if(this.heartbeatTicks%s.GossipsubPruneBackoffTicks!==0)return;const o=this._now();this.backoff.forEach((u,l)=>{u.forEach((f,_)=>{f<o&&u.delete(_)}),u.size===0&&this.backoff.delete(l)})}_directConnect(){if(this.heartbeatTicks%s.GossipsubDirectConnectTicks!==0)return;const o=[];this.direct.forEach(u=>{const l=this.peers.get(u);(!l||!l.isWritable)&&o.push(u)}),o.length&&o.forEach(u=>{this._connect(u)})}_pxConnect(o){return i(this,void 0,void 0,function*(){o.length>s.GossipsubPrunePeers&&(Nt.shuffle(o),o=o.slice(0,s.GossipsubPrunePeers));const u=[];if(yield Promise.all(o.map(l=>i(this,void 0,void 0,function*(){if(!l.peerID)return;const f=Ae.createFromBytes(l.peerID),_=f.toB58String();if(this.peers.has(_))return;if(!l.signedPeerRecord){u.push(_);return}try{const p=yield ds.openAndCertify(l.signedPeerRecord,"libp2p-peer-record"),I=p.peerId.toB58String();if(_!==I){this.log("bogus peer record obtained through px: peer ID %s doesn't match expected peer %s",I,_);return}if(!this._libp2p.peerStore.addressBook.consumePeerRecord(p)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}u.push(_)}catch(p){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}))),!u.length)return;u.forEach(l=>this._connect(l))})}start(){super.start(),this.heartbeat.start(),this.score.start(),this._directPeerInitial=setTimeout(()=>{this.direct.forEach(o=>{this._connect(o)})},s.GossipsubDirectConnectInitialDelay)}stop(){super.stop(),this.heartbeat.stop(),this.score.stop(),this.mesh=new Map,this.fanout=new Map,this.lastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.gossipTracer.clear(),clearTimeout(this._directPeerInitial)}_connect(o){this.log("Initiating connection with %s",o),this._libp2p.dialProtocol(Ae.createFromB58String(o),this.multicodecs)}subscribe(o){super.subscribe(o),this.join(o)}unsubscribe(o){super.unsubscribe(o),this.leave(o)}join(o){if(!this.started)throw new Error("Gossipsub has not started");this.log("JOIN %s",o);const u=this.fanout.get(o);if(u)u.forEach(l=>{this.score.score(l)<0&&u.delete(l)}),u.size<this._options.D&&Ai.getGossipPeers(this,o,this._options.D-u.size,l=>!u.has(l)&&!this.direct.has(l)&&this.score.score(l)>=0).forEach(l=>u.add(l)),this.mesh.set(o,u),this.fanout.delete(o),this.lastpub.delete(o);else{const l=Ai.getGossipPeers(this,o,this._options.D,f=>!this.direct.has(f)&&this.score.score(f)>=0);this.mesh.set(o,l)}this.mesh.get(o).forEach(l=>{this.log("JOIN: Add mesh link to %s in %s",l,o),this._sendGraft(l,o)})}leave(o){if(!this.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",o);const u=this.mesh.get(o);u&&(u.forEach(l=>{this.log("LEAVE: Remove mesh link to %s in %s",l,o),this._sendPrune(l,o)}),this.mesh.delete(o))}getMsgId(o){return this._msgIdFn(o)}_publish(o){return i(this,void 0,void 0,function*(){o.receivedFrom!==this.peerId.toB58String()&&(this.score.deliverMessage(o),this.gossipTracer.deliverMessage(o));const u=this.getMsgId(o);this.seenCache.put(u),this.messageCache.put(o);const l=new Set;o.topicIDs.forEach(_=>{const p=this.topics.get(_);if(!p)return;if(this._options.floodPublish&&o.from===this.peerId.toB58String())p.forEach(I=>{(this.direct.has(I)||this.score.score(I)>=this._options.scoreThresholds.publishThreshold)&&l.add(I)});else{this.direct.forEach(d=>{l.add(d)}),p.forEach(d=>{const v=this.score.score(d),A=this.peers.get(d);if(!A)return;A.protocol===s.FloodsubID&&v>=this._options.scoreThresholds.publishThreshold&&l.add(d)});let I=this.mesh.get(_);if(!I||!I.size){if(I=this.fanout.get(_),!I){const d=Ai.getGossipPeers(this,_,this._options.D,v=>this.score.score(v)>=this._options.scoreThresholds.publishThreshold);d.size>0?(I=d,this.fanout.set(_,d)):I=new Set}this.lastpub.set(_,this._now())}I.forEach(d=>{l.add(d)})}});const f=Nt.createGossipRpc([a.utils.normalizeOutRpcMessage(o)]);l.forEach(_=>{if(_===o.from)return;this._sendRpc(_,f)})})}_sendGraft(o,u){const l=[{topicID:u}],f=Nt.createGossipRpc([],{graft:l});this._sendRpc(o,f)}_sendPrune(o,u){const l=[this._makePrune(o,u,this._options.doPX)],f=Nt.createGossipRpc([],{prune:l});this._sendRpc(o,f)}_sendRpc(o,u){const l=this.peers.get(o);if(!l||!l.isWritable)return;const f=this.control.get(o);f&&(this._piggybackControl(o,u,f),this.control.delete(o));const _=this.gossip.get(o);_&&(this._piggybackGossip(o,u,_),this.gossip.delete(o)),l.write(ql.RPCCodec.encode(u))}_piggybackControl(o,u,l){const f=(l.graft||[]).filter(({topicID:p})=>(p&&this.mesh.get(p)||new Set).has(o)),_=(l.prune||[]).filter(({topicID:p})=>!(p&&this.mesh.get(p)||new Set).has(o));if(!f.length&&!_.length)return;u.control?(u.control.graft=u.control.graft.concat(f),u.control.prune=u.control.prune.concat(_)):u.control={ihave:[],iwant:[],graft:f,prune:_}}_piggybackGossip(o,u,l){u.control||(u.control={ihave:[],iwant:[],graft:[],prune:[]}),u.control.ihave=l}_sendGraftPrune(o,u,l){const f=this._options.doPX;for(const[_,p]of o){const I=p.map(j=>({topicID:j}));let d=[];const v=u.get(_);v&&(d=v.map(j=>this._makePrune(_,j,f&&!l.get(_))),u.delete(_));const A=Nt.createGossipRpc([],{graft:I,prune:d});this._sendRpc(_,A)}for(const[_,p]of u){const I=p.map(v=>this._makePrune(_,v,f&&!l.get(_))),d=Nt.createGossipRpc([],{prune:I});this._sendRpc(_,d)}}_emitGossip(o,u){const l=this.messageCache.getGossipIDs(o);if(!l.length)return;Nt.shuffle(l),l.length>s.GossipsubMaxIHaveLength&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",l.length);const f=[],_=this.topics.get(o);if(!_)return;_.forEach(d=>{const v=this.peers.get(d);if(!v)return;!u.has(d)&&!this.direct.has(d)&&Nt.hasGossipProtocol(v.protocol)&&this.score.score(d)>=this._options.scoreThresholds.gossipThreshold&&f.push(d)});let p=this._options.Dlazy;const I=s.GossipsubGossipFactor*f.length;I>p&&(p=I),p>f.length?p=f.length:Nt.shuffle(f),f.slice(0,p).forEach(d=>{let v=l;l.length>s.GossipsubMaxIHaveLength&&(v=Nt.shuffle(v.slice()).slice(0,s.GossipsubMaxIHaveLength)),this._pushGossip(d,{topicID:o,messageIDs:v})})}_flush(){for(const[o,u]of this.gossip.entries()){this.gossip.delete(o);const l=Nt.createGossipRpc([],{ihave:u});this._sendRpc(o,l)}for(const[o,u]of this.control.entries()){this.control.delete(o);const l=Nt.createGossipRpc([],{graft:u.graft,prune:u.prune});this._sendRpc(o,l)}}_pushGossip(o,u){this.log("Add gossip to %s",o);const l=this.gossip.get(o)||[];this.gossip.set(o,l.concat(u))}_now(){return Date.now()}_makePrune(o,u,l){if(this.peers.get(o).protocol===s.GossipsubIDv10)return{topicID:u,peers:[]};const f=s.GossipsubPruneBackoff/1e3,_=[];if(l){const p=Ai.getGossipPeers(this,u,s.GossipsubPrunePeers,I=>I!==o&&this.score.score(I)>=0);p.forEach(I=>{const d=Ae.createFromB58String(I);_.push({peerID:d.toBytes(),signedPeerRecord:this._libp2p.peerStore.addressBook.getRawEnvelope(d)})})}return{topicID:u,peers:_,backoff:f}}}c.multicodec=s.GossipsubIDv11,e.exports=c}),DP=Ig(OP),dg=le(function(e,t){const{EventEmitter:r}=Bt,n=te("libp2p:bootstrap");n.error=te("libp2p:bootstrap:error");class i extends r{constructor(a={}){if(!a.list||!a.list.length)throw new Error("Bootstrap requires a list of peer addresses");super();this._list=a.list,this._interval=a.interval||1e4,this._timer=null}start(){if(this._timer)return;this._timer=setInterval(()=>this._discoverBootstrapPeers(),this._interval),this._discoverBootstrapPeers()}_discoverBootstrapPeers(){if(!this._timer)return;this._list.forEach(a=>{if(!da.P2P.matches(a))return n.error("Invalid multiaddr");const s=Pe(a),c=Ae.createFromB58String(s.getPeerId());try{this.emit("peer",{id:c,multiaddrs:[s]})}catch(o){n.error("Invalid bootstrap peer id",o)}})}stop(){clearInterval(this._timer),this._timer=null}}t=e.exports=i,t.tag="bootstrap"}),MP=window.MediaStream,xP=window.MediaStreamTrack,BP=window.RTCDataChannel,LP=window.RTCDataChannelEvent,jP=window.RTCDtlsTransport,UP=window.RTCIceCandidate,FP=window.RTCIceTransport,qP=window.RTCPeerConnection,GP=window.RTCPeerConnectionIceEvent,$P=window.RTCRtpReceiver,VP=window.RTCRtpSender,HP=window.RTCRtpTransceiver,zP=window.RTCSctpTransport,KP=window.RTCSessionDescription,WP=window.getUserMedia,XP=navigator.mediaDevices,QP={MediaStream:MP,MediaStreamTrack:xP,RTCDataChannel:BP,RTCDataChannelEvent:LP,RTCDtlsTransport:jP,RTCIceCandidate:UP,RTCIceTransport:FP,RTCPeerConnection:qP,RTCPeerConnectionIceEvent:GP,RTCRtpReceiver:$P,RTCRtpSender:VP,RTCRtpTransceiver:HP,RTCSctpTransport:zP,RTCSessionDescription:KP,getUserMedia:WP,mediaDevices:XP};async function pg(){return{addresses:{listen:["/dns4/boiling-hamlet-91904.herokuapp.com/tcp/443/wss/p2p-webrtc-star"]},modules:{transport:[IR,vA,Am],streamMuxer:[VR],connEncryption:[Fk],pubsub:DP,peerDiscovery:[dg]},config:{transport:{[Am.prototype[Symbol.toStringTag]]:{wrtc:QP}},peerDiscovery:{[dg.tag]:{enabled:!0,list:["/dns4/ams-1.bootstrap.libp2p.io/tcp/443/wss/p2p/QmSoLer265NRgSp2LA3dPaeykiS1J6DifTC88f5uVQKNAd","/dns4/lon-1.bootstrap.libp2p.io/tcp/443/wss/p2p/QmSoLMeWqB7YGVLJN3pNLQpmmEk35v6wYtsMGLzSr5QBU3","/dns4/sfo-3.bootstrap.libp2p.io/tcp/443/wss/p2p/QmSoLPppuBtQSGwKDZT2M73ULpjvfd3aZ6ha4oFGL1KrGM","/dns4/sgp-1.bootstrap.libp2p.io/tcp/443/wss/p2p/QmSoLSafTMBsPKadTEgaXctDQVcqN88CNLHXMkTNwMKPnu","/dns4/nyc-1.bootstrap.libp2p.io/tcp/443/wss/p2p/QmSoLueR4xBeUbY9WZ9xGUUxunbKWcrNFTDAadQJmocnWm","/dns4/nyc-2.bootstrap.libp2p.io/tcp/443/wss/p2p/QmSoLV4Bbm51jM9C4gDYZQ9Cy3U6aXMJDAbzgu2fzaDs64","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ","/ip4/104.236.176.52/tcp/4001/p2p/QmSoLnSGccFuZQJzRadHn95W2CrSFmZuTdDWP8HXaHca9z","/ip4/104.236.179.241/tcp/4001/p2p/QmSoLPppuBtQSGwKDZT2M73ULpjvfd3aZ6ha4oFGL1KrGM","/ip4/162.243.248.213/tcp/4001/p2p/QmSoLueR4xBeUbY9WZ9xGUUxunbKWcrNFTDAadQJmocnWm","/ip4/128.199.219.111/tcp/4001/p2p/QmSoLSafTMBsPKadTEgaXctDQVcqN88CNLHXMkTNwMKPnu","/ip4/104.236.76.40/tcp/4001/p2p/QmSoLV4Bbm51jM9C4gDYZQ9Cy3U6aXMJDAbzgu2fzaDs64","/ip4/178.62.158.247/tcp/4001/p2p/QmSoLer265NRgSp2LA3dPaeykiS1J6DifTC88f5uVQKNAd","/ip4/178.62.61.185/tcp/4001/p2p/QmSoLMeWqB7YGVLJN3pNLQpmmEk35v6wYtsMGLzSr5QBU3","/ip4/104.236.151.122/tcp/4001/p2p/QmSoLju6m7xTh3DuokvT3886QRYqxAzb1kShaanJgW36yx"]},pubsub:{enabled:!0,emitSelf:!0}}}}}async function YP(e={}){const t=await cE.create(await pg());return await t.start(),t}export default YP;export{pg as config};
