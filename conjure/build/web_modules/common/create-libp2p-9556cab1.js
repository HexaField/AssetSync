import{e as At}from"./events-18451fd5.js";import{e as U,t as De,f as at,c as nr,v as $e,s as io,a as Ql,b as Pr,d as ir,g as we,h as te,i as Nr,j as bt,k as G,p as Rg,u as Pg,l as Ng,m as Yl,r as Jl,n as Zl,o as ss,q as Og,w as ao}from"./index-34d041ab.js";import{p as _e}from"./process-e9e98960.js";import"./EventDispatcher-b8df954c.js";import{b as Yr}from"./buffer-es6-e6024076.js";import{o as ed,p as Dg,f as td}from"./path-96982e38.js";import{c as re,a as ge,g as rd,b as Mg}from"./_commonjsHelpers-c99fd594.js";import{d as Ln}from"./__node-resolve:empty-d7309c3b.js";import"./util-8448a06b.js";import{a as os}from"./url-e7878f21.js";import{b as xg,s as Bg,a as Mc,g as nd}from"./browser-dec0d699.js";(function(){if(typeof globalThis=="object")return;Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__})();var jn=globalThis,Lg=(e,t=1,r)=>{if(r={indent:" ",includeEmptyLines:!1,...r},typeof e!="string")throw new TypeError(`Expected \`input\` to be a \`string\`, got \`${typeof e}\``);if(typeof t!="number")throw new TypeError(`Expected \`count\` to be a \`number\`, got \`${typeof t}\``);if(typeof r.indent!="string")throw new TypeError(`Expected \`options.indent\` to be a \`string\`, got \`${typeof r.indent}\``);if(t===0)return e;const n=r.includeEmptyLines?/^/gm:/^(?!\s*$)/gm;return e.replace(n,r.indent.repeat(t))};const id=/\s+at.*(?:\(|\s)(.*)\)?/,jg=/^(?:(?:(?:node|(?:internal\/[\w/]*|.*node_modules\/(?:babel-polyfill|pirates)\/.*)?\w+)\.js:\d+:\d+)|native)/,Ug=typeof Ln.homedir=="undefined"?"":Ln.homedir();var Fg=(e,t)=>(t=Object.assign({pretty:!1},t),e.replace(/\\/g,"/").split(`
`).filter(r=>{const n=r.match(id);if(n===null||!n[1])return!0;const i=n[1];return i.includes(".app/Contents/Resources/electron.asar")||i.includes(".app/Contents/Resources/default_app.asar")?!1:!jg.test(i)}).filter(r=>r.trim()!=="").map(r=>t.pretty?r.replace(id,(n,i)=>n.replace(i,i.replace(Ug,"~"))):r).join(`
`));const qg=e=>e.replace(/\s+at .*aggregate-error\/index.js:\d+:\d+\)?/g,"");class Gg extends Error{constructor(e){if(!Array.isArray(e))throw new TypeError(`Expected input to be an Array, got ${typeof e}`);e=[...e].map(r=>r instanceof Error?r:r!==null&&typeof r=="object"?Object.assign(new Error(r.message),r):new Error(r));let t=e.map(r=>typeof r.stack=="string"?qg(Fg(r.stack)):String(r)).join(`
`);t=`
`+Lg(t,4),super(t),this.name="AggregateError",Object.defineProperty(this,"_errors",{value:e})}*[Symbol.iterator](){for(const e of this._errors)yield e}}var so=Gg;class ad extends Error{constructor(e){super(e||"Promise was canceled");this.name="CancelError"}get isCanceled(){return!0}}class xc{static fn(e){return(...t)=>new xc((r,n,i)=>{t.push(i),e(...t).then(r,n)})}constructor(e){this._cancelHandlers=[],this._isPending=!0,this._isCanceled=!1,this._rejectOnCancel=!0,this._promise=new Promise((t,r)=>{this._reject=r;const n=s=>{this._isPending=!1,t(s)},i=s=>{this._isPending=!1,r(s)},a=s=>{if(!this._isPending)throw new Error("The `onCancel` handler was attached after the promise settled.");this._cancelHandlers.push(s)};return Object.defineProperties(a,{shouldReject:{get:()=>this._rejectOnCancel,set:s=>{this._rejectOnCancel=s}}}),e(n,i,a)})}then(e,t){return this._promise.then(e,t)}catch(e){return this._promise.catch(e)}finally(e){return this._promise.finally(e)}cancel(e){if(!this._isPending||this._isCanceled)return;if(this._cancelHandlers.length>0)try{for(const t of this._cancelHandlers)t()}catch(t){this._reject(t)}this._isCanceled=!0,this._rejectOnCancel&&this._reject(new ad(e))}get isCanceled(){return this._isCanceled}}Object.setPrototypeOf(xc.prototype,Promise.prototype);var Bc=xc,$g=ad;Bc.CancelError=$g;class sd extends Error{}const Vg=(e,t)=>new Bc((r,n,i)=>{const{count:a,filter:s=()=>!0}=t;if(!Number.isFinite(a)){n(new TypeError(`Expected a finite number, got ${typeof t.count}`));return}const c=[],o=[];let u=0,l=!1;const h=new Set,w=()=>(c.length===a&&(r(c),l=!0),u-o.length<a&&(n(new so(o)),l=!0),l),f=()=>{for(const A of e)!h.has(A)&&typeof A.cancel=="function"&&A.cancel()};i(f);for(const A of e)u++,(async()=>{try{const p=await A;if(l)return;if(!s(p))throw new sd("Value does not satisfy filter");c.push(p)}catch(p){o.push(p)}finally{h.add(A),!l&&w()&&f()}})();a>u&&(n(new RangeError(`Expected input to contain at least ${t.count} items, but contains ${u} items`)),f())});var oo=Vg,Hg=so,zg=sd;oo.AggregateError=Hg,oo.FilterError=zg;var co=(e,t)=>{const r=oo(e,{...t,count:1});return Bc.fn(async n=>{n(()=>{r.cancel()});const[i]=await r;return i})()},Kg=oo.AggregateError;co.AggregateError=Kg;var Wg=e=>{const t=e._modules.peerRouting||[];return e._dht&&t.unshift(e._dht),{findPeer:async(r,n)=>{if(!t.length)throw U(new Error("No peer routers available"),"NO_ROUTERS_AVAILABLE");return co(t.map(async i=>{const a=await i.findPeer(r,n);if(!a||Object.keys(a).length===0)throw U(new Error("not found"),"NOT_FOUND");return a}))}}},Xg={NOT_STARTED_YET:"The libp2p node is not started yet",DHT_DISABLED:"DHT is not available",CONN_ENCRYPTION_REQUIRED:"At least one connection encryption module is required"},Qg={DHT_DISABLED:"ERR_DHT_DISABLED",PUBSUB_NOT_STARTED:"ERR_PUBSUB_NOT_STARTED",DHT_NOT_STARTED:"ERR_DHT_NOT_STARTED",CONN_ENCRYPTION_REQUIRED:"ERR_CONN_ENCRYPTION_REQUIRED",ERR_CONNECTION_ENDED:"ERR_CONNECTION_ENDED",ERR_CONNECTION_FAILED:"ERR_CONNECTION_FAILED",ERR_NODE_NOT_STARTED:"ERR_NODE_NOT_STARTED",ERR_ALREADY_ABORTED:"ERR_ALREADY_ABORTED",ERR_NO_VALID_ADDRESSES:"ERR_NO_VALID_ADDRESSES",ERR_DISCOVERED_SELF:"ERR_DISCOVERED_SELF",ERR_DUPLICATE_TRANSPORT:"ERR_DUPLICATE_TRANSPORT",ERR_ENCRYPTION_FAILED:"ERR_ENCRYPTION_FAILED",ERR_HOP_REQUEST_FAILED:"ERR_HOP_REQUEST_FAILED",ERR_INVALID_KEY:"ERR_INVALID_KEY",ERR_INVALID_MESSAGE:"ERR_INVALID_MESSAGE",ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS",ERR_INVALID_PEER:"ERR_INVALID_PEER",ERR_MUXER_UNAVAILABLE:"ERR_MUXER_UNAVAILABLE",ERR_TIMEOUT:"ERR_TIMEOUT",ERR_TRANSPORT_UNAVAILABLE:"ERR_TRANSPORT_UNAVAILABLE",ERR_TRANSPORT_DIAL_FAILED:"ERR_TRANSPORT_DIAL_FAILED",ERR_UNSUPPORTED_PROTOCOL:"ERR_UNSUPPORTED_PROTOCOL",ERR_INVALID_MULTIADDR:"ERR_INVALID_MULTIADDR",ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"},Ot={messages:Xg,codes:Qg};const Yg=async e=>{const t=[];for await(const r of e)t.push(r);return t};var Jg=Yg;const{messages:Lc,codes:jc}=Ot;var Zg=e=>{const t=e._modules.contentRouting||[],r=e._dht;return r&&t.unshift(r),{async*findProviders(n,i){if(!t.length)throw U(new Error("No content routers available"),"NO_ROUTERS_AVAILABLE");const a=await co(t.map(async s=>{const c=await Jg(s.findProviders(n,i));if(!c||!c.length)throw U(new Error("not found"),"NOT_FOUND");return c}));for(const s of a)yield s},async provide(n){if(!t.length)throw U(new Error("No content routers available"),"NO_ROUTERS_AVAILABLE");return Promise.all(t.map(i=>i.provide(n)))},async put(n,i,a){if(!e.isStarted()||!r.isStarted)throw U(new Error(Lc.NOT_STARTED_YET),jc.DHT_NOT_STARTED);return r.put(n,i,a)},async get(n,i){if(!e.isStarted()||!r.isStarted)throw U(new Error(Lc.NOT_STARTED_YET),jc.DHT_NOT_STARTED);return r.get(n,i)},async getMany(n,i,a){if(!e.isStarted()||!r.isStarted)throw U(new Error(Lc.NOT_STARTED_YET),jc.DHT_NOT_STARTED);return r.getMany(n,i,a)}}};const od="[a-fA-F\\d:]",ci=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${od})|(?<=${od})(?=\\s|$))`:"",Jr="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",lt="[a-fA-F\\d]{1,4}",uo=`
(
(?:${lt}:){7}(?:${lt}|:)|                                // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${lt}:){6}(?:${Jr}|:${lt}|:)|                         // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${lt}:){5}(?::${Jr}|(:${lt}){1,2}|:)|                 // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${lt}:){4}(?:(:${lt}){0,1}:${Jr}|(:${lt}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${lt}:){3}(?:(:${lt}){0,2}:${Jr}|(:${lt}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${lt}:){2}(?:(:${lt}){0,3}:${Jr}|(:${lt}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${lt}:){1}(?:(:${lt}){0,4}:${Jr}|(:${lt}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::((?::${lt}){0,5}:${Jr}|(?::${lt}){1,7}|:))           // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(%[0-9a-zA-Z]{1,})?                                           // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),ey=new RegExp(`(?:^${Jr}$)|(?:^${uo}$)`),ty=new RegExp(`^${Jr}$`),ry=new RegExp(`^${uo}$`),Uc=e=>e&&e.exact?ey:new RegExp(`(?:${ci(e)}${Jr}${ci(e)})|(?:${ci(e)}${uo}${ci(e)})`,"g");Uc.v4=e=>e&&e.exact?ty:new RegExp(`${ci(e)}${Jr}${ci(e)}`,"g"),Uc.v6=e=>e&&e.exact?ry:new RegExp(`${ci(e)}${uo}${ci(e)}`,"g");var Fc=Uc;const ua=e=>Fc({exact:!0}).test(e);ua.v4=e=>Fc.v4({exact:!0}).test(e),ua.v6=e=>Fc.v6({exact:!0}).test(e),ua.version=e=>ua(e)?ua.v4(e)?4:6:void 0;var qc=ua;const ny=qc,Gc=qc.v4,cd=qc.v6,ud=function(e,t,r){r=~~r;var n;if(Gc(e))n=t||new Uint8Array(r+4),e.split(/\./g).map(function(l){n[r++]=parseInt(l,10)&255});else if(cd(e)){var i=e.split(":",8),a;for(a=0;a<i.length;a++){var s=Gc(i[a]),c;s&&(c=ud(i[a]),i[a]=De(c.slice(0,2),"base16")),c&&++a<8&&i.splice(a,0,De(c.slice(2,4),"base16"))}if(i[0]==="")for(;i.length<8;)i.unshift("0");else if(i[i.length-1]==="")for(;i.length<8;)i.push("0");else if(i.length<8){for(a=0;a<i.length&&i[a]!=="";a++);var o=[a,"1"];for(a=9-i.length;a>0;a--)o.push("0");i.splice.apply(i,o)}for(n=t||new Uint8Array(r+16),a=0;a<i.length;a++){var u=parseInt(i[a],16);n[r++]=u>>8&255,n[r++]=u&255}}if(!n)throw Error("Invalid ip address: "+e);return n},iy=function(e,t,r){t=~~t,r=r||e.length-t;var n=[],i;const a=new DataView(e.buffer);if(r===4){for(let s=0;s<r;s++)n.push(e[t+s]);i=n.join(".")}else if(r===16){for(let s=0;s<r;s+=2)n.push(a.getUint16(t+s).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i};var lo={isIP:ny,isV4:Gc,isV6:cd,toBytes:ud,toString:iy};function ar(e){if(typeof e=="number"){if(ar.codes[e])return ar.codes[e];throw new Error("no protocol with code: "+e)}else if(typeof e=="string"||e instanceof String){if(ar.names[e])return ar.names[e];throw new Error("no protocol with name: "+e)}throw new Error("invalid protocol id type: "+e)}const Or=-1;ar.lengthPrefixedVarSize=Or,ar.V=Or,ar.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Or,"ip6zone"],[53,Or,"dns","resolvable"],[54,Or,"dns4","resolvable"],[55,Or,"dns6","resolvable"],[56,Or,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Or,"unix",!1,"path"],[421,Or,"ipfs"],[421,Or,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Or,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Or,"memory"]],ar.names={},ar.codes={},ar.table.map(e=>{const t=ld.apply(null,e);ar.codes[t.code]=t,ar.names[t.name]=t}),ar.object=ld;function ld(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(i)}}var In=ar,dd=cs;function cs(e,t){return t instanceof Uint8Array?cs.toString(e,t):cs.toBytes(e,t)}cs.toString=function(t,r){t=In(t);switch(t.code){case 4:case 41:return ay(r);case 6:case 273:case 33:case 132:return pd(r);case 53:case 54:case 55:case 56:case 400:case 777:return oy(r);case 421:return uy(r);case 444:return fd(r);case 445:return fd(r);default:return De(r,"base16")}},cs.toBytes=function(t,r){t=In(t);switch(t.code){case 4:return hd(r);case 41:return hd(r);case 6:case 273:case 33:case 132:return $c(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return sy(r);case 421:return cy(r);case 444:return ly(r);case 445:return dy(r);default:return at(r,"base16")}};function hd(e){if(!lo.isIP(e))throw new Error("invalid ip address");return lo.toBytes(e)}function ay(e){const t=lo.toString(e);if(!t||!lo.isIP(t))throw new Error("invalid ip address");return t}function $c(e){const t=new ArrayBuffer(2),r=new DataView(t);return r.setUint16(0,e),new Uint8Array(t)}function pd(e){const t=new DataView(e.buffer);return t.getUint16(0)}function sy(e){const t=at(e),r=Uint8Array.from($e.encode(t.length));return nr([r,t],r.length+t.length)}function oy(e){const t=$e.decode(e);if(e=e.slice($e.decode.bytes),e.length!==t)throw new Error("inconsistent lengths");return De(e)}function cy(e){const t=new io(e).multihash,r=Uint8Array.from($e.encode(t.length));return nr([r,t],r.length+t.length)}function uy(e){const t=$e.decode(e),r=e.slice($e.decode.bytes);if(r.length!==t)throw new Error("inconsistent lengths");return De(r,"base58btc")}function ly(e){const t=e.split(":");if(t.length!==2)throw new Error("failed to parse onion addr: "+t+" does not contain a port number");if(t[0].length!==16)throw new Error("failed to parse onion addr: "+t[0]+" not a Tor onion address.");const r=Ql.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=$c(n);return nr([r,i],r.length+i.length)}function dy(e){const t=e.split(":");if(t.length!==2)throw new Error("failed to parse onion addr: "+t+" does not contain a port number");if(t[0].length!==56)throw new Error("failed to parse onion addr: "+t[0]+" not a Tor onion3 address.");const r=Ql.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=$c(n);return nr([r,i],r.length+i.length)}function fd(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2),n=De(t,"base32"),i=pd(r);return n+":"+i}var Zr={stringToStringTuples:md,stringTuplesToString:gd,tuplesToStringTuples:bd,stringTuplesToTuples:yd,bytesToTuples:Vc,tuplesToBytes:vd,bytesToString:hy,stringToBytes:_d,fromString:py,fromBytes:Ed,validateBytes:Hc,isValidBytes:fy,cleanPath:ho,ParseError:zc,protoFromTuple:us,sizeForAddr:wd};function md(e){const t=[],r=e.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let n=0;n<r.length;n++){const i=r[n],a=In(i);if(a.size===0){t.push([i]);continue}if(n++,n>=r.length)throw zc("invalid address: "+e);if(a.path){t.push([i,ho(r.slice(n).join("/"))]);break}t.push([i,r[n]])}return t}function gd(e){const t=[];return e.map(r=>{const n=us(r);t.push(n.name),r.length>1&&t.push(r[1])}),ho(t.join("/"))}function yd(e){return e.map(t=>{Array.isArray(t)||(t=[t]);const r=us(t);return t.length>1?[r.code,dd.toBytes(r.code,t[1])]:[r.code]})}function bd(e){return e.map(t=>{const r=us(t);return t.length>1?[r.code,dd.toString(r.code,t[1])]:[r.code]})}function vd(e){return Ed(nr(e.map(t=>{const r=us(t);let n=Uint8Array.from($e.encode(r.code));return t.length>1&&(n=nr([n,t[1]])),n})))}function wd(e,t){if(e.size>0)return e.size/8;if(e.size===0)return 0;{const r=$e.decode(t);return r+$e.decode.bytes}}function Vc(e){const t=[];let r=0;for(;r<e.length;){const n=$e.decode(e,r),i=$e.decode.bytes,a=In(n),s=wd(a,e.slice(r+i));if(s===0){t.push([n]),r+=i;continue}const c=e.slice(r+i,r+i+s);if(r+=s+i,r>e.length)throw zc("Invalid address Uint8Array: "+De(e,"base16"));t.push([n,c])}return t}function hy(e){const t=Vc(e),r=bd(t);return gd(r)}function _d(e){e=ho(e);const t=md(e),r=yd(t);return vd(r)}function py(e){return _d(e)}function Ed(e){const t=Hc(e);if(t)throw t;return Uint8Array.from(e)}function Hc(e){try{Vc(e)}catch(t){return t}}function fy(e){return Hc(e)===void 0}function ho(e){return"/"+e.trim().split("/").filter(t=>t).join("/")}function zc(e){return new Error("Error parsing address: "+e)}function us(e){const t=In(e[0]);return t}var Ne=re(function(e,t){const r=Symbol.for("nodejs.util.inspect.custom"),n=Pr.proto(function(i){if(!(this instanceof n))return new n(i);if(i==null&&(i=""),i instanceof Uint8Array)this.bytes=Zr.fromBytes(i);else if(typeof i=="string"||i instanceof String){if(i.length>0&&i.charAt(0)!=="/")throw new Error(`multiaddr "${i}" must start with a "/"`);this.bytes=Zr.fromString(i)}else if(i.bytes&&i.protos&&i.protoCodes)this.bytes=Zr.fromBytes(i.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});n.prototype.toString=function(){return Zr.bytesToString(this.bytes)},n.prototype.toJSON=n.prototype.toString,n.prototype.toOptions=function(){const a={},s=this.toString().split("/");return a.family=s[1]==="ip4"?"ipv4":"ipv6",a.host=s[2],a.transport=s[3],a.port=parseInt(s[4]),a},n.prototype[r]=function(){return"<Multiaddr "+De(this.bytes,"base16")+" - "+Zr.bytesToString(this.bytes)+">"},n.prototype.inspect=function(){return"<Multiaddr "+De(this.bytes,"base16")+" - "+Zr.bytesToString(this.bytes)+">"},n.prototype.protos=function(){return this.protoCodes().map(a=>Object.assign({},In(a)))},n.prototype.protoCodes=function(){const a=[],s=this.bytes;let c=0;for(;c<s.length;){const o=$e.decode(s,c),u=$e.decode.bytes,l=In(o),h=Zr.sizeForAddr(l,s.slice(c+u));c+=h+u,a.push(o)}return a},n.prototype.protoNames=function(){return this.protos().map(a=>a.name)},n.prototype.tuples=function(){return Zr.bytesToTuples(this.bytes)},n.prototype.stringTuples=function(){const a=Zr.bytesToTuples(this.bytes);return Zr.tuplesToStringTuples(a)},n.prototype.encapsulate=function(a){return a=n(a),n(this.toString()+a.toString())},n.prototype.decapsulate=function(a){a=a.toString();const s=this.toString(),c=s.lastIndexOf(a);if(c<0)throw new Error("Address "+this+" does not contain subaddress: "+a);return n(s.slice(0,c))},n.prototype.decapsulateCode=function(a){const s=this.tuples();for(let c=s.length-1;c>=0;c--)if(s[c][0]===a)return n(Zr.tuplesToBytes(s.slice(0,c)));return this},n.prototype.getPeerId=function(){let a=null;try{const s=this.stringTuples().filter(c=>{if(c[0]===In.names.ipfs.code)return!0});a=s.pop()[1],a=De(new io(a).multihash,"base58btc")}catch(s){a=null}return a},n.prototype.getPath=function(){let a=null;try{a=this.stringTuples().filter(s=>{const c=In(s[0]);if(c.path)return!0})[0][1]}catch(s){a=null}return a},n.prototype.equals=function(a){return ir(this.bytes,a.bytes)},n.prototype.nodeAddress=function(){const a=this.protoCodes(),s=this.protoNames(),c=this.toString().split("/").slice(1);if(c.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(a[0]!==4&&a[0]!==41&&a[0]!==54&&a[0]!==55)throw new Error(`no protocol with name: "'${s[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(c[2]!=="tcp"&&c[2]!=="udp")throw new Error(`no protocol with name: "'${s[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:a[0]===41||a[0]===55?6:4,address:c[1],port:parseInt(c[3])}},n.fromNodeAddress=function(a,s){if(!a)throw new Error("requires node address object");if(!s)throw new Error("requires transport protocol");let c;switch(a.family){case"IPv4":c="ip4";break;case"IPv6":c="ip6";break;default:throw Error(`Invalid addr family. Got '${a.family}' instead of 'IPv4' or 'IPv6'`)}return n("/"+[c,a.address,s,a.port].join("/"))},n.prototype.isThinWaistAddress=function(a){const s=(a||this).protos();return s.length!==2||s[0].code!==4&&s[0].code!==41?!1:!(s[1].code!==6&&s[1].code!==273)},n.protocols=In,n.isName=function(a){return n.isMultiaddr(a)?a.protos().some(s=>s.resolvable):!1},n.resolve=function(a){return!n.isMultiaddr(a)||!n.isName(a)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},t=e.exports=n});const{codes:my}=Ot;function gy(e){typeof e=="string"&&(e=Ne(e));let t;if(Ne.isMultiaddr(e)){t=e;try{e=we.createFromB58String(e.getPeerId())}catch(r){throw U(new Error(`${e} is not a valid peer type`),my.ERR_INVALID_MULTIADDR)}}return{id:e,multiaddrs:t?[t]:void 0}}var po=gy,fo=e=>{if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype};const{hasOwnProperty:Sd}=Object.prototype,{propertyIsEnumerable:yy}=Object,la=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0}),by=ge,Ad={concatArrays:!1,ignoreUndefined:!1},mo=e=>{const t=[];for(const r in e)Sd.call(e,r)&&t.push(r);if(Object.getOwnPropertySymbols){const r=Object.getOwnPropertySymbols(e);for(const n of r)yy.call(e,n)&&t.push(n)}return t};function da(e){return Array.isArray(e)?vy(e):fo(e)?wy(e):e}function vy(e){const t=e.slice(0,0);return mo(e).forEach(r=>{la(t,r,da(e[r]))}),t}function wy(e){const t=Object.getPrototypeOf(e)===null?Object.create(null):{};return mo(e).forEach(r=>{la(t,r,da(e[r]))}),t}const Td=(e,t,r,n)=>(r.forEach(i=>{if(typeof t[i]=="undefined"&&n.ignoreUndefined)return;i in e&&e[i]!==Object.getPrototypeOf(e)?la(e,i,Kc(e[i],t[i],n)):la(e,i,da(t[i]))}),e),_y=(e,t,r)=>{let n=e.slice(0,0),i=0;return[e,t].forEach(a=>{const s=[];for(let c=0;c<a.length;c++){if(!Sd.call(a,c))continue;s.push(String(c)),a===e?la(n,i++,a[c]):la(n,i++,da(a[c]))}n=Td(n,a,mo(a).filter(c=>!s.includes(c)),r)}),n};function Kc(e,t,r){return r.concatArrays&&Array.isArray(e)&&Array.isArray(t)?_y(e,t,r):!fo(t)||!fo(e)?da(t):Td(e,t,mo(t),r)}var go=function(...e){const t=Kc(da(Ad),this!==by&&this||{},Ad);let r={_:{}};for(const n of e){if(n===void 0)continue;if(!fo(n))throw new TypeError("`"+n+"` is not an Option Object");r=Kc(r,{_:n},t)}return r._},ls={DIAL_TIMEOUT:3e4,MAX_PARALLEL_DIALS:100,MAX_PER_PEER_DIALS:4,METRICS:{computeThrottleMaxQueueSize:1e3,computeThrottleTimeout:2e3,movingAverageIntervals:[60*1e3,5*60*1e3,15*60*1e3],maxOldPeersRetention:50}};const Id=async e=>{try{const t=await e;return{isFulfilled:!0,isRejected:!1,value:t}}catch(t){return{isFulfilled:!1,isRejected:!0,reason:t}}};var yo=Id,Ey=Id;yo.default=Ey;const Cd=(e,...t)=>new Promise(r=>{r(e(...t))});var kd=Cd,Sy=Cd;kd.default=Sy;const Rd=e=>{if(!((Number.isInteger(e)||e===Infinity)&&e>0))return Promise.reject(new TypeError("Expected `concurrency` to be a number from 1 and up"));const t=[];let r=0;const n=()=>{r--,t.length>0&&t.shift()()},i=(c,o,...u)=>{r++;const l=kd(c,...u);o(l),l.then(n,n)},a=(c,o,...u)=>{r<e?i(c,o,...u):t.push(i.bind(null,c,o,...u))},s=(c,...o)=>new Promise(u=>a(c,u,...o));return Object.defineProperties(s,{activeCount:{get:()=>r},pendingCount:{get:()=>t.length},clearQueue:{value:()=>{t.length=0}}}),s};var Pd=Rd,Ay=Rd;Pd.default=Ay;var Ty=async(e,t={})=>{const{concurrency:r=Infinity}=t,n=Pd(r);return Promise.all(e.map(i=>i&&typeof i.then=="function"?yo(i):typeof i=="function"?yo(n(()=>i())):yo(Promise.resolve(i))))};const{codes:ha}=Ot,ui=te("libp2p:transports");ui.error=te("libp2p:transports:error");class Nd{constructor({libp2p:e,upgrader:t,faultTolerance:r=Wc.FATAL_ALL}){this.libp2p=e,this.upgrader=t,this._transports=new Map,this._listeners=new Map,this.faultTolerance=r}add(e,t,r={}){if(ui("adding %s",e),!e)throw U(new Error(`Transport must have a valid key, was given '${e}'`),ha.ERR_INVALID_KEY);if(this._transports.has(e))throw U(new Error("There is already a transport with this key"),ha.ERR_DUPLICATE_TRANSPORT);const n=new t({...r,libp2p:this.libp2p,upgrader:this.upgrader});this._transports.set(e,n),this._listeners.has(e)||this._listeners.set(e,[])}async close(){const e=[];for(const[t,r]of this._listeners)for(ui("closing listeners for %s",t);r.length;){const n=r.pop();e.push(n.close())}await Promise.all(e),ui("all listeners closed");for(const t of this._listeners.keys())this._listeners.set(t,[])}async dial(e,t){const r=this.transportForMultiaddr(e);if(!r)throw U(new Error(`No transport available for address ${String(e)}`),ha.ERR_TRANSPORT_UNAVAILABLE);try{return await r.dial(e,t)}catch(n){throw n.code||(n.code=ha.ERR_TRANSPORT_DIAL_FAILED),n}}getAddrs(){let e=[];for(const t of this._listeners.values())for(const r of t)e=[...e,...r.getAddrs()];return e}getTransports(){return this._transports.values()}transportForMultiaddr(e){for(const t of this._transports.values()){const r=t.filter([e]);if(r.length)return t}return null}async listen(){const e=this.libp2p.addressManager.getListenAddrs();if(e.length===0){ui("no addresses were provided for listening, this node is dial only");return}const t=[];for(const[r,n]of this._transports.entries()){const i=n.filter(e),a=[];for(const o of i){ui("creating listener for %s on %s",r,o);const u=n.createListener({},this.onConnection);this._listeners.get(r).push(u),a.push(u.listen(o))}if(a.length===0){t.push(r);continue}const s=await Ty(a),c=s.find(o=>o.isFulfilled===!0);if(!c)throw U(new Error(`Transport (${r}) could not listen on any available address`),ha.ERR_NO_VALID_ADDRESSES)}if(t.length===this._transports.size){const r=`no valid addresses were provided for transports [${t}]`;if(this.faultTolerance===Wc.FATAL_ALL)throw U(new Error(r),ha.ERR_NO_VALID_ADDRESSES);ui(`libp2p in dial mode only: ${r}`)}}async remove(e){if(ui("removing %s",e),this._listeners.has(e))for(const t of this._listeners.get(e))await t.close();this._transports.delete(e),this._listeners.delete(e)}async removeAll(){const e=[];for(const t of this._transports.keys())e.push(this.remove(t));await Promise.all(e)}}const Wc={FATAL_ALL:0,NO_FATAL:1};Nd.FaultTolerance=Wc;var Od=Nd;const{FaultTolerance:Iy}=Od,Cy={addresses:{listen:[],announce:[],noAnnounce:[]},connectionManager:{minConnections:25},transportManager:{faultTolerance:Iy.FATAL_ALL},dialer:{maxParallelDials:ls.MAX_PARALLEL_DIALS,maxDialsPerPeer:ls.MAX_PER_PEER_DIALS,dialTimeout:ls.DIAL_TIMEOUT},metrics:{enabled:!1},peerStore:{persistence:!1,threshold:5},config:{dht:{enabled:!1,kBucketSize:20,randomWalk:{enabled:!1,queriesPerPeriod:1,interval:3e5,timeout:1e4}},peerDiscovery:{autoDial:!0},pubsub:{enabled:!0,emitSelf:!0,signMessages:!0,strictSigning:!0},relay:{enabled:!0,hop:{enabled:!1,active:!1}},transport:{}}};var ky=e=>{if(e=go(Cy,e),e.modules.transport.length<1)throw new Error("'options.modules.transport' must contain at least 1 transport");return e},Ry={validate:ky};const Py=te("libp2p:addresses");Py.error=te("libp2p:addresses:error");class Ny{constructor({listen:e=[],announce:t=[],noAnnounce:r=[]}={}){this.listen=new Set(e),this.announce=new Set(t),this.noAnnounce=new Set(r)}getListenAddrs(){return Array.from(this.listen).map(e=>Ne(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>Ne(e))}getNoAnnounceAddrs(){return Array.from(this.noAnnounce).map(e=>Ne(e))}}var Oy=Ny;const Xc=te("latency-monitor:VisibilityChangeEmitter");var Dy=class extends At{constructor(){super();if(typeof document=="undefined"){Xc('This is not a browser, no "document" found. Stopping.');return}this._initializeVisibilityVarNames(),this._addVisibilityChangeListener()}_initializeVisibilityVarNames(){let t,r;typeof document.hidden!="undefined"?(t="hidden",r="visibilitychange"):typeof document.mozHidden!="undefined"?(t="mozHidden",r="mozvisibilitychange"):typeof document.msHidden!="undefined"?(t="msHidden",r="msvisibilitychange"):typeof document.webkitHidden!="undefined"&&(t="webkitHidden",r="webkitvisibilitychange"),this._hidden=t,this._visibilityChange=r}_addVisibilityChangeListener(){typeof document.addEventListener=="undefined"||typeof document[this._hidden]=="undefined"?Xc("Checking page visibility requires a browser that supports the Page Visibility API."):document.addEventListener(this._visibilityChange,this._handleVisibilityChange.bind(this),!1)}isVisible(){return this._hidden===void 0||document[this._hidden]===void 0?void 0:!document[this._hidden]}_handleVisibilityChange(){const t=!document[this._hidden];Xc(t?"Page Visible":"Page Hidden"),this.emit("visibilityChange",t)}};const Un=te("latency-monitor:LatencyMonitor");class My extends At{constructor({latencyCheckIntervalMs:e,dataEmitIntervalMs:t,asyncTestFn:r,latencyRandomPercentage:n}={}){super();const i=this;i.latencyCheckIntervalMs=e||500,i.latencyRandomPercentage=n||10,i._latecyCheckMultiply=2*(i.latencyRandomPercentage/100)*i.latencyCheckIntervalMs,i._latecyCheckSubtract=i._latecyCheckMultiply/2,i.dataEmitIntervalMs=t===null||t===0?void 0:t||5*1e3,Un("latencyCheckIntervalMs: %s dataEmitIntervalMs: %s",i.latencyCheckIntervalMs,i.dataEmitIntervalMs),i.dataEmitIntervalMs?Un("Expecting ~%s events per summary",i.latencyCheckIntervalMs/i.dataEmitIntervalMs):Un("Not emitting summaries"),i.asyncTestFn=r,jn.process&&jn.process.hrtime?(Un("Using process.hrtime for timing"),i.now=jn.process.hrtime,i.getDeltaMS=a=>{const s=i.now(a);return s[0]*1e3+s[1]/1e6}):typeof window!="undefined"&&window.performance&&window.performance.now?(Un("Using performance.now for timing"),i.now=window.performance.now.bind(window.performance),i.getDeltaMS=a=>Math.round(i.now()-a)):(Un("Using Date.now for timing"),i.now=Date.now,i.getDeltaMS=a=>i.now()-a),i._latencyData=i._initLatencyData(),xy()&&(i._visibilityChangeEmitter=new Dy,i._visibilityChangeEmitter.on("visibilityChange",a=>{a?i._startTimers():(i._emitSummary(),i._stopTimers())})),(!i._visibilityChangeEmitter||i._visibilityChangeEmitter.isVisible())&&i._startTimers()}_startTimers(){if(this._checkLatencyID)return;this._checkLatency(),this.dataEmitIntervalMs&&(this._emitIntervalID=setInterval(()=>this._emitSummary(),this.dataEmitIntervalMs),typeof this._emitIntervalID.unref=="function"&&this._emitIntervalID.unref())}_stopTimers(){this._checkLatencyID&&(clearTimeout(this._checkLatencyID),this._checkLatencyID=void 0),this._emitIntervalID&&(clearInterval(this._emitIntervalID),this._emitIntervalID=void 0)}_emitSummary(){const e=this.getSummary();e.events>0&&this.emit("data",e)}getSummary(){const e={events:this._latencyData.events,minMs:this._latencyData.minMs,maxMs:this._latencyData.maxMs,avgMs:this._latencyData.events?this._latencyData.totalMs/this._latencyData.events:Number.POSITIVE_INFINITY,lengthMs:this.getDeltaMS(this._latencyData.startTime)};return this._latencyData=this._initLatencyData(),Un("Summary: %O",e),e}_checkLatency(){const e=this,t=Math.random()*e._latecyCheckMultiply-e._latecyCheckSubtract,r={deltaOffset:Math.ceil(e.latencyCheckIntervalMs+t),startTime:e.now()},n=()=>{if(!this._checkLatencyID)return;const i=e.getDeltaMS(r.startTime)-r.deltaOffset;e._checkLatency(),e._latencyData.events++,e._latencyData.minMs=Math.min(e._latencyData.minMs,i),e._latencyData.maxMs=Math.max(e._latencyData.maxMs,i),e._latencyData.totalMs+=i,Un("MS: %s Data: %O",i,e._latencyData)};Un("localData: %O",r),this._checkLatencyID=setTimeout(()=>{e.asyncTestFn?(r.deltaOffset=0,r.startTime=e.now(),e.asyncTestFn(n)):(r.deltaOffset-=1,n())},r.deltaOffset),typeof this._checkLatencyID.unref=="function"&&this._checkLatencyID.unref()}_initLatencyData(){return{startTime:this.now(),minMs:Number.POSITIVE_INFINITY,maxMs:Number.NEGATIVE_INFINITY,events:0,totalMs:0}}}function xy(){return typeof window!="undefined"}var By=My,Qc=function(){return Date.now()};function Yc(e,t,r){var n=this;this._started=Qc(),this._rescheduled=0,this._scheduled=t,this._args=r,this._timer=setTimeout(i,t);function i(){n._rescheduled>0?(n._scheduled=n._rescheduled-(Qc()-n._started),n._timer=setTimeout(i,n._scheduled),n._rescheduled=0):e.apply(null,n._args)}}Yc.prototype.reschedule=function(e){var t=Qc();return t+e-(this._started+this._scheduled)<0?!1:(this._started=t,this._rescheduled=e,!0)},Yc.prototype.clear=function(){clearTimeout(this._timer)};function Ly(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("timeout needed");var e;if(arguments.length>0){e=new Array(arguments.length-2);for(var t=0;t<e.length;t++)e[t]=arguments[t+2]}return new Yc(arguments[0],arguments[1],e)}var ji=Ly;const Dr=te("libp2p:connection-manager");Dr.error=te("libp2p:connection-manager:error");const{EventEmitter:jy}=At,{ERR_INVALID_PARAMETERS:Dd}=Ot,Uy={maxConnections:Infinity,minConnections:0,maxData:Infinity,maxSentData:Infinity,maxReceivedData:Infinity,maxEventLoopDelay:Infinity,pollInterval:2e3,autoDialInterval:1e4,movingAverageInterval:6e4,defaultPeerValue:1};class Fy extends jy{constructor(e,t){super();if(this._libp2p=e,this._peerId=e.peerId.toB58String(),this._options=go.call({ignoreUndefined:!0},Uy,t),this._options.maxConnections<this._options.minConnections)throw U(new Error("Connection Manager maxConnections must be greater than minConnections"),Dd);Dr("options: %j",this._options),this._libp2p=e,this._peerValues=new Map,this.connections=new Map,this._started=!1,this._timer=null,this._autoDialTimeout=null,this._checkMetrics=this._checkMetrics.bind(this),this._autoDial=this._autoDial.bind(this)}get size(){return Array.from(this.connections.values()).reduce((e,t)=>e+t.length,0)}start(){this._libp2p.metrics&&(this._timer=this._timer||ji(this._checkMetrics,this._options.pollInterval)),this._latencyMonitor=new By({latencyCheckIntervalMs:this._options.pollInterval,dataEmitIntervalMs:this._options.pollInterval}),this._onLatencyMeasure=this._onLatencyMeasure.bind(this),this._latencyMonitor.on("data",this._onLatencyMeasure),this._started=!0,Dr("started"),this._options.autoDial&&this._autoDial()}async stop(){this._autoDialTimeout&&this._autoDialTimeout.clear(),this._timer&&this._timer.clear(),this._latencyMonitor&&this._latencyMonitor.removeListener("data",this._onLatencyMeasure),this._started=!1,await this._close(),Dr("stopped")}async _close(){const e=[];for(const t of this.connections.values())for(const r of t)e.push(r.close());await e,this.connections.clear()}setPeerValue(e,t){if(t<0||t>1)throw new Error("value should be a number between 0 and 1");e.toB58String&&(e=e.toB58String()),this._peerValues.set(e,t)}_checkMetrics(){const e=this._libp2p.metrics.global.movingAverages,t=e.dataReceived[this._options.movingAverageInterval].movingAverage();this._checkMaxLimit("maxReceivedData",t);const r=e.dataSent[this._options.movingAverageInterval].movingAverage();this._checkMaxLimit("maxSentData",r);const n=t+r;this._checkMaxLimit("maxData",n),Dr("metrics update",n),this._timer=ji(this._checkMetrics,this._options.pollInterval)}onConnect(e){const t=e.remotePeer,r=t.toB58String(),n=this.connections.get(r);this.emit("peer:connect",e),n?n.push(e):this.connections.set(r,[e]),this._libp2p.peerStore.keyBook.set(t,t.pubKey),this._peerValues.has(r)||this._peerValues.set(r,this._options.defaultPeerValue),this._checkMaxLimit("maxConnections",this.size)}onDisconnect(e){const t=e.remotePeer.toB58String();let r=this.connections.get(t);r&&r.length>1?(r=r.filter(n=>n.id!==e.id),this.connections.set(t,r)):r&&(this.connections.delete(t),this._peerValues.delete(e.remotePeer.toB58String()),this.emit("peer:disconnect",e))}get(e){const t=this.getAll(e);return t.length?t[0]:null}getAll(e){if(!we.isPeerId(e))throw U(new Error("peerId must be an instance of peer-id"),Dd);const t=e.toB58String(),r=this.connections.get(t);return r?r.filter(n=>n.stat.status==="open"):[]}_onLatencyMeasure(e){this._checkMaxLimit("maxEventLoopDelay",e.avgMs)}_checkMaxLimit(e,t){const r=this._options[e];Dr("checking limit of %s. current value: %d of %d",e,t,r),t>r&&(Dr("%s: limit exceeded: %s, %d",this._peerId,e,t),this._maybeDisconnectOne())}async _autoDial(){const e=this._options.minConnections;if(this.size>=e){this._autoDialTimeout=ji(this._autoDial,this._options.autoDialInterval);return}const t=Array.from(this._libp2p.peerStore.peers.values()).sort((r,n)=>n.protocols&&n.protocols.length&&(!r.protocols||!r.protocols.length)||n.id.pubKey&&!r.id.pubKey?1:-1);for(let r=0;r<t.length&&this.size<e;r++)if(!this.get(t[r].id)){Dr("connecting to a peerStore stored peer %s",t[r].id.toB58String());try{if(await this._libp2p.dialer.connectToPeer(t[r].id),!this._started)return}catch(n){Dr.error("could not connect to peerStore stored peer",n)}}this._autoDialTimeout=ji(this._autoDial,this._options.autoDialInterval)}_maybeDisconnectOne(){if(this._options.minConnections<this.connections.size){const e=Array.from(this._peerValues).sort(Gy);Dr("%s: sorted peer values: %j",this._peerId,e);const t=e[0];if(t){const r=t[0];Dr("%s: lowest value peer is %s",this._peerId,r),Dr("%s: closing a connection to %j",this._peerId,r);for(const n of this.connections.values())if(n[0].remotePeer.toB58String()===r){n[0].close();break}}}}}var qy=Fy;function Gy(e,t){return e[1]-t[1]}const Md=Se("dns4"),xd=Se("dns6"),pa=qt(Se("dns"),Se("dnsaddr"),Md,xd),ds=qt(Se("ip4"),Se("ip6")),fa=qt(Pe(ds,Se("tcp")),Pe(pa,Se("tcp"))),Bd=Pe(ds,Se("udp")),Ld=Pe(Bd,Se("utp")),ma=qt(Pe(fa,Se("ws")),Pe(pa,Se("ws"))),ga=qt(Pe(fa,Se("wss")),Pe(pa,Se("wss"))),Jc=qt(Pe(fa,Se("http")),Pe(ds,Se("http")),Pe(pa,Se("http"))),Zc=qt(Pe(fa,Se("https")),Pe(ds,Se("https")),Pe(pa,Se("https"))),eu=qt(Pe(ma,Se("p2p-webrtc-star"),Se("p2p")),Pe(ga,Se("p2p-webrtc-star"),Se("p2p")),Pe(ma,Se("p2p-webrtc-star")),Pe(ga,Se("p2p-webrtc-star"))),$y=qt(Pe(ma,Se("p2p-websocket-star"),Se("p2p")),Pe(ga,Se("p2p-websocket-star"),Se("p2p")),Pe(ma,Se("p2p-websocket-star")),Pe(ga,Se("p2p-websocket-star"))),jd=qt(Pe(Jc,Se("p2p-webrtc-direct")),Pe(Zc,Se("p2p-webrtc-direct"))),ya=qt(ma,ga,Jc,Zc,eu,jd,fa,Ld),Vy=qt(Pe(ya,Se("p2p-stardust"),Se("p2p")),Pe(ya,Se("p2p-stardust"))),li=qt(Pe(ya,Se("p2p")),eu,Se("p2p")),Ud=qt(Pe(li,Se("p2p-circuit"),li),Pe(li,Se("p2p-circuit")),Pe(Se("p2p-circuit"),li),Pe(ya,Se("p2p-circuit")),Pe(Se("p2p-circuit"),ya),Se("p2p-circuit")),Fd=()=>qt(Pe(Ud,Fd),Ud),ba=Fd(),qd=qt(Pe(ba,li,ba),Pe(li,ba),Pe(ba,li),ba,li);var Hy=pa,zy=Md,Ky=xd,Wy=ds,Xy=fa,Qy=Bd,Yy=Ld,Jy=Jc,Zy=Zc,eb=ma,tb=ga,rb=$y,nb=eu,ib=jd,ab=ya,sb=Vy,ob=ba,cb=qd,ub=qd;function Gd(e){return function(r){if(!Ne.isMultiaddr(r))try{r=Ne(r)}catch(i){return!1}const n=e(r.protoNames());return n===null?!1:n.length===0}}function Pe(){const e=Array.from(arguments);function t(r){return r.length<e.length?null:(e.some(n=>{if(r=typeof n=="function"?n().partialMatch(r):n.partialMatch(r),r===null)return!0}),r)}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:Gd(t),partialMatch:t}}function qt(){const e=Array.from(arguments);function t(n){let i=null;return e.some(a=>{const s=typeof a=="function"?a().partialMatch(n):a.partialMatch(n);if(s)return i=s,!0}),i}const r={toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:Gd(t),partialMatch:t};return r}function Se(e){const t=e;function r(i){if(typeof i=="string")try{i=Ne(i)}catch(s){return!1}const a=i.protoNames();return a.length===1&&a[0]===t}function n(i){return i.length===0?null:i[0]===t?i.slice(1):null}return{toString:function(){return t},matches:r,partialMatch:n}}var hs={DNS:Hy,DNS4:zy,DNS6:Ky,IP:Wy,TCP:Xy,UDP:Qy,UTP:Yy,HTTP:Jy,HTTPS:Zy,WebSockets:eb,WebSocketsSecure:tb,WebSocketStar:rb,WebRTCStar:nb,WebRTCDirect:ib,Reliable:ab,Stardust:sb,Circuit:ob,P2P:cb,IPFS:ub},ps=Nr(`
message CircuitRelay {

  enum Status {
    SUCCESS                    = 100;
    HOP_SRC_ADDR_TOO_LONG      = 220;
    HOP_DST_ADDR_TOO_LONG      = 221;
    HOP_SRC_MULTIADDR_INVALID  = 250;
    HOP_DST_MULTIADDR_INVALID  = 251;
    HOP_NO_CONN_TO_DST         = 260;
    HOP_CANT_DIAL_DST          = 261;
    HOP_CANT_OPEN_DST_STREAM   = 262;
    HOP_CANT_SPEAK_RELAY       = 270;
    HOP_CANT_RELAY_TO_SELF     = 280;
    STOP_SRC_ADDR_TOO_LONG     = 320;
    STOP_DST_ADDR_TOO_LONG     = 321;
    STOP_SRC_MULTIADDR_INVALID = 350;
    STOP_DST_MULTIADDR_INVALID = 351;
    STOP_RELAY_REFUSED         = 390;
    MALFORMED_MESSAGE          = 400;
  }

  enum Type { // RPC identifier, either HOP, STOP or STATUS
    HOP = 1;
    STOP = 2;
    STATUS = 3;
    CAN_HOP = 4;
  }

  message Peer {
    required bytes id = 1;    // peer id
    repeated bytes addrs = 2; // peer's known addresses
  }

  optional Type type = 1;     // Type of the message

  optional Peer srcPeer = 2;  // srcPeer and dstPeer are used when Type is HOP or STATUS
  optional Peer dstPeer = 3;

  optional Status code = 4;   // Status code, used when Type is STATUS
}
`),tu=function(t){if(t){if(typeof t[Symbol.iterator]=="function")return t[Symbol.iterator]();if(typeof t[Symbol.asyncIterator]=="function")return t[Symbol.asyncIterator]();if(typeof t.next=="function")return t}throw new Error("argument is not an iterator or iterable")},ru=class extends Error{constructor(t,r){super(t||"The operation was aborted");this.type="aborted",this.code=r||"ABORT_ERR"}};const $d=(e,t,r)=>nu(e,Array.isArray(t)?t:[{signal:t,options:r}]),nu=(e,t)=>{e=tu(e),t=t.map(({signal:n,options:i})=>({signal:n,options:i||{}}));async function*r(){let n;const i=()=>{n&&n()};for(const{signal:a}of t)a.addEventListener("abort",i);for(;;){let a;try{for(const{signal:c,options:o}of t)if(c.aborted){const{abortMessage:u,abortCode:l}=o;throw new ru(u,l)}const s=new Promise((c,o)=>{n=()=>{const{options:u}=t.find(({signal:w})=>w.aborted),{abortMessage:l,abortCode:h}=u;o(new ru(l,h))}});a=await Promise.race([s,e.next()]),n=null}catch(s){for(const{signal:u}of t)u.removeEventListener("abort",i);const c=t.find(({signal:u})=>u.aborted),o=s.type==="aborted"&&c;if(o&&c.options.onAbort&&await c.options.onAbort(e),typeof e.return=="function"&&await e.return(),o&&c.options.returnOnAbort)return;throw s}if(a.done)break;yield a.value}for(const{signal:a}of t)a.removeEventListener("abort",i)}return r()},Vd=(e,t,r)=>Hd(e,Array.isArray(t)?t:[{signal:t,options:r}]),Hd=(e,t)=>r=>e(nu(r,t)),lb=(e,t,r)=>db(e,Array.isArray(t)?t:[{signal:t,options:r}]),db=(e,t)=>({sink:Hd(e.sink,t),source:nu(e.source,t)});var vt=$d,hb=ru,pb=$d,fb=Vd,mb=Vd,gb=lb;vt.AbortError=hb,vt.source=pb,vt.sink=fb,vt.transform=mb,vt.duplex=gb;const yb=te("libp2p:stream:converter");function bb({stream:e,remoteAddr:t,localAddr:r},n={}){const{sink:i,source:a}=e,s={async sink(o){n.signal&&(o=vt(o,n.signal));try{await i(o)}catch(u){u.type!=="aborted"&&yb(u)}c()},source:n.signal?vt(a,n.signal):a,conn:e,localAddr:r,remoteAddr:t,timeline:{open:Date.now()},close(){i([]),c()}};function c(){s.timeline.close||(s.timeline.close=Date.now())}return s}var zd=bb,iu={relay:"/libp2p/circuit/relay/0.1.0"};const vb=te("libp2p:circuit:listener");vb.err=te("libp2p:circuit:error:listener");var wb=e=>{const t=new At,r=new Map;return t.listen=async n=>{const i=String(n).split("/p2p-circuit").find(c=>c!==""),a=await e._dialer.connectToPeer(Ne(i)),s=a.remoteAddr.encapsulate("/p2p-circuit");r.set(a.remotePeer.toB58String(),s),t.emit("listening")},t.close=()=>{},t.getAddrs=()=>{const n=[];for(const i of r.values())n.push(i);return n},t};const{CircuitRelay:Ui}=ps;function Kd(e,t){e.write({type:Ui.Type.STATUS,code:t})}function _b(e,t){try{e.dstPeer.addrs.forEach(r=>Ne(r))}catch(r){throw Kd(t,e.type===Ui.Type.HOP?Ui.Status.HOP_DST_MULTIADDR_INVALID:Ui.Status.STOP_DST_MULTIADDR_INVALID),r}try{e.srcPeer.addrs.forEach(r=>Ne(r))}catch(r){throw Kd(t,e.type===Ui.Type.HOP?Ui.Status.HOP_SRC_MULTIADDR_INVALID:Ui.Status.STOP_SRC_MULTIADDR_INVALID),r}}var Wd={validateAddrs:_b};const{Buffer:en}=Yr,Xd=Symbol.for("BufferList");function Qe(e){if(!(this instanceof Qe))return new Qe(e);Qe._init.call(this,e)}Qe._init=function(t){Object.defineProperty(this,Xd,{value:!0}),this._bufs=[],this.length=0,t&&this.append(t)},Qe.prototype._new=function(t){return new Qe(t)},Qe.prototype._offset=function(t){if(t===0)return[0,0];let r=0;for(let n=0;n<this._bufs.length;n++){const i=r+this._bufs[n].length;if(t<i||n===this._bufs.length-1)return[n,t-r];r=i}},Qe.prototype._reverseOffset=function(e){const t=e[0];let r=e[1];for(let n=0;n<t;n++)r+=this._bufs[n].length;return r},Qe.prototype.get=function(t){if(t>this.length||t<0)return;const r=this._offset(t);return this._bufs[r[0]][r[1]]},Qe.prototype.slice=function(t,r){return typeof t=="number"&&t<0&&(t+=this.length),typeof r=="number"&&r<0&&(r+=this.length),this.copy(null,0,t,r)},Qe.prototype.copy=function(t,r,n,i){if((typeof n!="number"||n<0)&&(n=0),(typeof i!="number"||i>this.length)&&(i=this.length),n>=this.length)return t||en.alloc(0);if(i<=0)return t||en.alloc(0);const a=!!t,s=this._offset(n),c=i-n;let o=c,u=a&&r||0,l=s[1];if(n===0&&i===this.length){if(!a)return this._bufs.length===1?this._bufs[0]:en.concat(this._bufs,this.length);for(let h=0;h<this._bufs.length;h++)this._bufs[h].copy(t,u),u+=this._bufs[h].length;return t}if(o<=this._bufs[s[0]].length-l)return a?this._bufs[s[0]].copy(t,r,l,l+o):this._bufs[s[0]].slice(l,l+o);a||(t=en.allocUnsafe(c));for(let h=s[0];h<this._bufs.length;h++){const w=this._bufs[h].length-l;if(o>w)this._bufs[h].copy(t,u,l),u+=w;else{this._bufs[h].copy(t,u,l,l+o),u+=w;break}o-=w,l&&(l=0)}return t.length>u?t.slice(0,u):t},Qe.prototype.shallowSlice=function(t,r){if(t=t||0,r=typeof r!="number"?this.length:r,t<0&&(t+=this.length),r<0&&(r+=this.length),t===r)return this._new();const n=this._offset(t),i=this._offset(r),a=this._bufs.slice(n[0],i[0]+1);return i[1]===0?a.pop():a[a.length-1]=a[a.length-1].slice(0,i[1]),n[1]!==0&&(a[0]=a[0].slice(n[1])),this._new(a)},Qe.prototype.toString=function(t,r,n){return this.slice(r,n).toString(t)},Qe.prototype.consume=function(t){if(t=Math.trunc(t),Number.isNaN(t)||t<=0)return this;for(;this._bufs.length;)if(t>=this._bufs[0].length)t-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift();else{this._bufs[0]=this._bufs[0].slice(t),this.length-=t;break}return this},Qe.prototype.duplicate=function(){const t=this._new();for(let r=0;r<this._bufs.length;r++)t.append(this._bufs[r]);return t},Qe.prototype.append=function(t){if(t==null)return this;if(t.buffer)this._appendBuffer(en.from(t.buffer,t.byteOffset,t.byteLength));else if(Array.isArray(t))for(let r=0;r<t.length;r++)this.append(t[r]);else if(this._isBufferList(t))for(let r=0;r<t._bufs.length;r++)this.append(t._bufs[r]);else typeof t=="number"&&(t=t.toString()),this._appendBuffer(en.from(t));return this},Qe.prototype._appendBuffer=function(t){this._bufs.push(t),this.length+=t.length},Qe.prototype.indexOf=function(e,t,r){if(r===void 0&&typeof t=="string"&&(r=t,t=void 0),typeof e=="function"||Array.isArray(e))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof e=="number"?e=en.from([e]):typeof e=="string"?e=en.from(e,r):this._isBufferList(e)?e=e.slice():Array.isArray(e.buffer)?e=en.from(e.buffer,e.byteOffset,e.byteLength):en.isBuffer(e)||(e=en.from(e)),t=Number(t||0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const n=this._offset(t);let i=n[0],a=n[1];for(;i<this._bufs.length;i++){const s=this._bufs[i];for(;a<s.length;){const c=s.length-a;if(c>=e.length){const o=s.indexOf(e,a);if(o!==-1)return this._reverseOffset([i,o]);a=s.length-e.length+1}else{const o=this._reverseOffset([i,a]);if(this._match(o,e))return o;a++}}a=0}return-1},Qe.prototype._match=function(e,t){if(this.length-e<t.length)return!1;for(let r=0;r<t.length;r++)if(this.get(e+r)!==t[r])return!1;return!0},function(){const e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(const t in e)(function(r){e[r]===null?Qe.prototype[r]=function(n,i){return this.slice(n,n+i)[r](0,i)}:Qe.prototype[r]=function(n){return this.slice(n,n+e[r])[r](0)}})(t)}(),Qe.prototype._isBufferList=function(t){return t instanceof Qe||Qe.isBufferList(t)},Qe.isBufferList=function(t){return t!=null&&t[Xd]};var tt=Qe;const{Buffer:Eb}=Yr,Qd=(e,t,r)=>{const n=$e.encode(e,t,r);return Qd.bytes=$e.encode.bytes,t||Eb.from(n)};var au=Qd;const{Buffer:Yd}=Yr,su=8,Jd=10*1024;function Zd(e){e=e||{};const t=Math.max(e.poolSize||Jd,e.minPoolSize||su),r=e.lengthEncoder||au;return n=>async function*(){let i=Yd.alloc(t),a=0;for await(const s of n){r(s.length,i,a);const c=i.slice(a,a+r.bytes);a+=r.bytes,i.length-a<su&&(i=Yd.alloc(t),a=0),yield new tt().append(c).append(s)}}()}Zd.single=(e,t)=>{t=t||{};const r=t.lengthEncoder||au;return new tt([r(e.length),e])};var ou=Zd,Sb=su,Ab=Jd;ou.MIN_POOL_SIZE=Sb,ou.DEFAULT_POOL_SIZE=Ab;const{Buffer:Tb}=Yr,Ib=e=>new Proxy({},{get:(t,r)=>r[0]==="l"?e[r]:e.get(parseInt(r))}),eh=e=>{const t=$e.decode(Tb.isBuffer(e)?e:Ib(e));return eh.bytes=$e.decode.bytes,t};var th=eh;const{Buffer:Cb}=Yr,rh=8,nh=1024*1024*4,ih=Cb.alloc(0),di={LENGTH:"readLength",DATA:"readData"},kb={[di.LENGTH]:(e,t,r,n)=>{t=t.append(e);let i;try{i=n.lengthDecoder(t)}catch(a){if(t.length>n.maxLengthLength)throw Object.assign(a,{message:"message length too long",code:"ERR_MSG_LENGTH_TOO_LONG"});if(a instanceof RangeError)return{mode:di.LENGTH,buffer:t};throw a}if(i>n.maxDataLength)throw Object.assign(new Error("message data too long"),{code:"ERR_MSG_DATA_TOO_LONG"});return e=t.shallowSlice(n.lengthDecoder.bytes),t=new tt,n.onLength&&n.onLength(i),i<=0?(n.onData&&n.onData(ih),{mode:di.LENGTH,chunk:e,buffer:t,data:ih}):{mode:di.DATA,chunk:e,buffer:t,state:{dataLength:i}}},[di.DATA]:(e,t,r,n)=>{if(t=t.append(e),t.length<r.dataLength)return{mode:di.DATA,buffer:t,state:r};const{dataLength:i}=r,a=t.shallowSlice(0,i);return e=t.length>i?t.shallowSlice(i):null,t=new tt,n.onData&&n.onData(a),{mode:di.LENGTH,chunk:e,buffer:t,data:a}}};function cu(e){return e=e||{},e.lengthDecoder=e.lengthDecoder||th,e.maxLengthLength=e.maxLengthLength||rh,e.maxDataLength=e.maxDataLength||nh,t=>async function*(){let r=new tt,n=di.LENGTH,i;for await(let a of t)for(;a;){const s=kb[n](a,r,i,e);({mode:n,chunk:a,buffer:r,state:i}=s),s.data&&(yield s.data)}if(r.length)throw Object.assign(new Error("unexpected end of input"),{code:"ERR_UNEXPECTED_EOF"})}()}cu.fromReader=(e,t)=>{t=t||{};let r=1;const n={[Symbol.asyncIterator](){return this},next:async()=>{try{return await e.next(r)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{r=1}}};return t.onLength=i=>{r=i},cu(t)(n)};var uu=cu,Rb=rh,Pb=nh;uu.MAX_LENGTH_LENGTH=Rb,uu.MAX_DATA_LENGTH=Pb;const{Buffer:Nb}=Yr,ah=(e,t,r)=>(t=t||Nb.allocUnsafe(4),t.writeInt32BE(e,r),t);ah.bytes=4;var Ob=ah;const sh=e=>{if(e.length<4)throw RangeError("Could not decode int32BE");return e.readInt32BE(0)};sh.bytes=4;var Db=sh,Mb=ou,xb=uu,Bb=au,Lb=th,jb=Ob,Ub=Db,Je={encode:Mb,decode:xb,varintEncode:Bb,varintDecode:Lb,int32BEEncode:jb,int32BEDecode:Ub},oh=e=>{const t=async function*(){let r=yield,n=new tt;for await(const i of e){if(!r){r=yield n.append(i),n=new tt;continue}for(n.append(i);n.length>=r;){const a=n.shallowSlice(0,r);if(n.consume(r),r=yield a,!r){n.length&&(r=yield n,n=new tt);break}}}if(r)throw Object.assign(new Error(`stream ended before ${r} bytes became available`),{code:"ERR_UNDER_READ",buffer:n})}();return t.next(),t},ch=class{constructor(t){if(!(t>0)||(t-1&t)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];return t===void 0?void 0:(this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t)}isEmpty(){return this.buffer[this.btm]===void 0}},fs=class{constructor(t){this.hwm=t||16,this.head=new ch(this.hwm),this.tail=this.head}push(t){if(!this.head.push(t)){const r=this.head;this.head=r.next=new ch(2*this.head.buffer.length),this.head.push(t)}}shift(){const t=this.tail.shift();if(t===void 0&&this.tail.next){const r=this.tail.next;return this.tail.next=null,this.tail=r,this.tail.shift()}return t}isEmpty(){return this.head.isEmpty()}},bo=e=>{e=e||{};let t;typeof e=="function"?(t=e,e={}):t=e.onEnd;let r=new fs,n,i,a;const s=()=>{if(!r.isEmpty()){if(e.writev){let p;const y=[];for(;!r.isEmpty();){if(p=r.shift(),p.error)throw p.error;y.push(p.value)}return{done:p.done,value:y}}const A=r.shift();if(A.error)throw A.error;return A}return a?{done:!0}:new Promise((A,p)=>{i=y=>(i=null,y.error?p(y.error):e.writev&&!y.done?A({done:y.done,value:[y.value]}):A(y),n)})},c=A=>i?i(A):(r.push(A),n),o=A=>(r=new fs,i?i({error:A}):(r.push({error:A}),n)),u=A=>a?n:c({done:!1,value:A}),l=A=>a?n:(a=!0,A?o(A):c({done:!0})),h=()=>(r=new fs,l(),{done:!0}),w=A=>(l(A),{done:!0});if(n={[Symbol.asyncIterator](){return this},next:s,return:h,throw:w,push:u,end:l},!t)return n;const f=n;return n={[Symbol.asyncIterator](){return this},next(){return f.next()},throw(A){return f.throw(A),t&&(t(A),t=null),{done:!0}},return(){return f.return(),t&&(t(),t=null),{done:!0}},push:u,end(A){return f.end(A),t&&(t(A),t=null),n}},n};const Fb=()=>{const e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e};var vo=Fb,ms=e=>{const t=bo(),r=oh(e.source),n=vo();let i;const a=e.sink(async function*(){yield*t;const c=await n.promise;yield*c}());a.catch(c=>{i=c});const s={sink:c=>i?Promise.reject(i):(n.resolve(c),a),source:r};return{reader:r,writer:t,stream:s,rest:()=>t.end(),write:t.push,read:async()=>(await r.next()).value}};const{CircuitRelay:uh}=ps,gs=te("libp2p:circuit:stream-handler");gs.error=te("libp2p:circuit:stream-handler:error");class qb{constructor({stream:e,maxLength:t=4096}){this.stream=e,this.shake=ms(this.stream),this.decoder=Je.decode.fromReader(this.shake.reader,{maxDataLength:t})}async read(){const e=await this.decoder.next();if(e.value){const t=uh.decode(e.value.slice());return gs("read message type",t.type),t}gs("read received no value, closing stream"),this.close()}write(e){gs("write message type %s",e.type),this.shake.write(Je.encode.single(uh.encode(e)))}rest(){return this.shake.rest(),this.shake.stream}end(e){this.write(e),this.close()}close(){gs("closing the stream"),this.rest().sink([])}}var lu=qb;const{CircuitRelay:du}=ps,{validateAddrs:Gb}=Wd,va=te("libp2p:circuit:stop");va.error=te("libp2p:circuit:stop:error");var $b=function({connection:t,request:r,streamHandler:n}){try{Gb(r,n)}catch(i){return va.error("invalid stop request via peer %s",t.remotePeer.toB58String(),i)}return va("stop request is valid"),n.write({type:du.Type.STATUS,code:du.Status.SUCCESS}),n.rest()},Vb=async function({connection:t,request:r}){const{stream:n}=await t.newStream([iu.relay]);va("starting stop request to %s",t.remotePeer.toB58String());const i=new lu({stream:n});i.write(r);const a=await i.read();if(a.code===du.Status.SUCCESS)return va("stop request to %s was successful",t.remotePeer.toB58String()),i.rest();va("stop request failed with code %d",a.code),i.close()},lh={handleStop:$b,stop:Vb};const Fn=te("libp2p:circuit:hop");Fn.error=te("libp2p:circuit:hop:error");const{validateAddrs:Hb}=Wd,{CircuitRelay:tn}=ps,{codes:zb}=Ot,{stop:Kb}=lh;var Wb=async function({connection:t,request:r,streamHandler:n,circuit:i}){if(!i._options.hop.enabled)return Fn("HOP request received but we are not acting as a relay"),n.end({type:tn.Type.STATUS,code:tn.Status.HOP_CANT_SPEAK_RELAY});try{Hb(r,n)}catch(l){return Fn.error("invalid hop request via peer %s",t.remotePeer.toB58String(),l)}const a=new we(r.dstPeer.id),s=i._connectionManager.get(a);if(!s&&!i._options.hop.active)return Fn("HOP request received but we are not connected to the destination peer"),n.end({type:tn.Type.STATUS,code:tn.Status.HOP_NO_CONN_TO_DST});const c={type:tn.Type.STOP,dstPeer:r.dstPeer,srcPeer:r.srcPeer};let o;try{o=await Kb({connection:s,request:c,circuit:i})}catch(l){return Fn.error(l)}Fn("hop request from %s is valid",t.remotePeer.toB58String()),n.write({type:tn.Type.STATUS,code:tn.Status.SUCCESS});const u=n.rest();return bt(u,o,u)},Xb=async function({connection:t,request:r}){const{stream:n}=await t.newStream([iu.relay]),i=new lu({stream:n});i.write(r);const a=await i.read();if(a.code===tn.Status.SUCCESS)return Fn("hop request was successful"),i.rest();throw Fn("hop request failed with code %d, closing stream",a.code),i.close(),U(new Error(`HOP request failed with code ${a.code}`),zb.ERR_HOP_REQUEST_FAILED)},Qb=function({connection:t,streamHandler:r,circuit:n}){const i=n._options.hop.enabled;Fn("can hop (%s) request from %s",i,t.remotePeer.toB58String()),r.end({type:tn.Type.STATUS,code:i?tn.Status.SUCCESS:tn.Status.HOP_CANT_SPEAK_RELAY})},Yb={handleHop:Wb,hop:Xb,handleCanHop:Qb};const{CircuitRelay:wa}=ps,qn=te("libp2p:circuit");qn.error=te("libp2p:circuit:error");const{relay:Jb}=iu,{handleCanHop:Zb,handleHop:ev,hop:tv}=Yb,{handleStop:rv}=lh;class nv{constructor({libp2p:e,upgrader:t}){this._dialer=e.dialer,this._registrar=e.registrar,this._connectionManager=e.connectionManager,this._upgrader=t,this._options=e._config.relay,this._libp2p=e,this.peerId=e.peerId,this._registrar.handle(Jb,this._onProtocol.bind(this))}async _onProtocol({connection:e,stream:t,protocol:r}){const n=new lu({stream:t}),i=await n.read(),a=this;let s;switch(i.type){case wa.Type.CAN_HOP:{qn("received CAN_HOP request from %s",e.remotePeer.toB58String()),await Zb({circuit:a,connection:e,streamHandler:n});break}case wa.Type.HOP:{qn("received HOP request from %s",e.remotePeer.toB58String()),s=await ev({connection:e,request:i,streamHandler:n,circuit:a});break}case wa.Type.STOP:{qn("received STOP request from %s",e.remotePeer.toB58String()),s=await rv({connection:e,request:i,streamHandler:n,circuit:a});break}default:qn("Request of type %s not supported",i.type)}if(s){const c=Ne(i.dstPeer.addrs[0]),o=Ne(i.srcPeer.addrs[0]),u=zd({stream:s,remoteAddr:c,localAddr:o}),l=wa.Type===wa.Type.HOP?"relay":"inbound";qn("new %s connection %s",l,u.remoteAddr);const h=await this._upgrader.upgradeInbound(u);qn("%s connection %s upgraded",l,u.remoteAddr),this.handler&&this.handler(h)}}async dial(e,t){const r=e.toString().split("/p2p-circuit"),n=Ne(r[0]),i=Ne(r[r.length-1]),a=we.createFromCID(n.getPeerId()),s=we.createFromCID(i.getPeerId());let c=!1,o=this._connectionManager.get(a);o||(o=await this._dialer.connectToPeer(n,t),c=!0);try{const u=await tv({connection:o,circuit:this,request:{type:wa.Type.HOP,srcPeer:{id:this.peerId.toBytes(),addrs:this._libp2p.multiaddrs.map(w=>w.bytes)},dstPeer:{id:s.toBytes(),addrs:[Ne(i).bytes]}}}),l=n.encapsulate(`/p2p-circuit/p2p/${this.peerId.toB58String()}`),h=zd({stream:u,remoteAddr:e,localAddr:l});return qn("new outbound connection %s",h.remoteAddr),this._upgrader.upgradeOutbound(h)}catch(u){throw qn.error("Circuit relay dial failed",u),c&&await o.close(),u}}createListener(e,t){return typeof e=="function"&&(t=e,e={}),this.handler=t,wb(this)}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>hs.Circuit.matches(t))}}var dh=Pr(nv,{className:"Circuit",symbolName:"@libp2p/js-libp2p-circuit/circuit"});const{AbortController:hh,AbortSignal:iv}=typeof self!="undefined"?self:typeof window!="undefined"?window:void 0;var hi=hh,av=iv,sv=hh;hi.AbortSignal=av,hi.default=sv;const{AbortController:ov}=typeof self!="undefined"?self:typeof window!="undefined"?window:hi;class hu extends ov{constructor(e){super();this._ms=e,this._timer=ji(()=>this.abort(),e),Object.setPrototypeOf(this,hu.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=ji(()=>this.abort(),this._ms)}}var ph=hu,cv=hu;ph.TimeoutController=cv;var uv=AbortController;function fh(e){const t=new uv;function r(){t.abort();for(const n of e){if(!n||!n.removeEventListener)continue;n.removeEventListener("abort",r)}}for(const n of e){if(!n||!n.addEventListener)continue;if(n.aborted){r();break}n.addEventListener("abort",r)}return t.signal}var pu=fh,lv=fh;pu.anySignal=lv;var dv=class{constructor(){this._buffer=new fs,this._waitingConsumers=new fs}push(t){const{promise:r,resolve:n}=vo();return this._buffer.push({chunk:t,resolve:n}),this._consume(),r}_consume(){for(;!this._waitingConsumers.isEmpty()&&!this._buffer.isEmpty();){const t=this._waitingConsumers.shift(),r=this._buffer.shift();t.resolve(r.chunk),r.resolve()}}shift(){const{promise:t,resolve:r}=vo();return this._waitingConsumers.push({resolve:r}),this._consume(),t}isEmpty(){return this._buffer.isEmpty()}};const hv=te("libp2p:dialer:request");hv.error=te("libp2p:dialer:request:error");class pv{constructor({addrs:e,dialAction:t,dialer:r}){this.addrs=e,this.dialer=r,this.dialAction=t}async run(e){const t=this.dialer.getTokens(this.addrs.length);if(t.length<1)throw U(new Error("No dial tokens available"),"ERR_NO_DIAL_TOKENS");const r=new dv;t.forEach(a=>r.push(a));const n=this.addrs.map(()=>new hi);let i=0;try{return await co(this.addrs.map(async(a,s)=>{const c=await r.shift();let o;try{const u=n[s].signal;o=await this.dialAction(a,{...e,signal:pu([u,e.signal])}),n.splice(s,1)}finally{i++,this.addrs.length-i>=t.length?r.push(c):this.dialer.releaseToken(t.splice(t.indexOf(c),1)[0])}return o}))}finally{n.map(a=>a.abort()),t.forEach(a=>this.dialer.releaseToken(a))}}}var fv=pv,mv={DialRequest:fv};const _a=te("libp2p:dialer");_a.error=te("libp2p:dialer:error");const{DialRequest:gv}=mv,{codes:fu}=Ot,{DIAL_TIMEOUT:yv,MAX_PARALLEL_DIALS:bv,MAX_PER_PEER_DIALS:vv}=ls;class wv{constructor({transportManager:e,peerStore:t,concurrency:r=bv,timeout:n=yv,perPeerLimit:i=vv}){this.transportManager=e,this.peerStore=t,this.concurrency=r,this.timeout=n,this.perPeerLimit=i,this.tokens=[...new Array(r)].map((a,s)=>s),this._pendingDials=new Map}destroy(){for(const e of this._pendingDials.values())try{e.controller.abort()}catch(t){_a.error(t)}this._pendingDials.clear()}async connectToPeer(e,t={}){const r=this._createDialTarget(e);if(!r.addrs.length)throw U(new Error("The dial request has no addresses"),fu.ERR_NO_VALID_ADDRESSES);const n=this._pendingDials.get(r.id)||this._createPendingDial(r,t);try{const i=await n.promise;return _a("dial succeeded to %s",r.id),i}catch(i){throw n.controller.signal.aborted&&(i.code=fu.ERR_TIMEOUT),_a.error(i),i}finally{n.destroy()}}_createDialTarget(e){const{id:t,multiaddrs:r}=po(e);r&&this.peerStore.addressBook.add(t,r);let n=this.peerStore.addressBook.getMultiaddrsForPeer(t)||[];return Ne.isMultiaddr(e)&&(n=n.filter(i=>!e.equals(i)),n.unshift(e)),{id:t.toB58String(),addrs:n}}_createPendingDial(e,t){const r=(o,u)=>{if(u.signal.aborted)throw U(new Error("already aborted"),fu.ERR_ALREADY_ABORTED);return this.transportManager.dial(o,u)},n=new gv({addrs:e.addrs,dialAction:r,dialer:this}),i=new ph(this.timeout),a=[i.signal];t.signal&&a.push(t.signal);const s=pu(a),c={dialRequest:n,controller:i,promise:n.run({...t,signal:s}),destroy:()=>{i.clear(),this._pendingDials.delete(e.id)}};return this._pendingDials.set(e.id,c),c}getTokens(e){const t=Math.min(e,this.perPeerLimit,this.tokens.length),r=this.tokens.splice(0,t);return _a("%d tokens request, returning %d, %d remaining",e,t,this.tokens.length),r}releaseToken(e){if(this.tokens.indexOf(e)>-1)return;_a("token %d released",e),this.tokens.push(e)}}var _v=wv;function Ev(e){return e>=55296&&e<=56319}function Sv(e){return e>=56320&&e<=57343}var Av=function(t,r,n){if(typeof r!="string")throw new Error("Input must be string");for(var i=r.length,a=0,s,c,o=0;o<i;o+=1){if(s=r.charCodeAt(o),c=r[o],Ev(s)&&Sv(r.charCodeAt(o+1))&&(o+=1,c+=r[o]),a+=t(c),a===n)return r.slice(0,o+1);if(a>n)return r.slice(0,o-c.length+1)}return r};function Tv(e){return e>=55296&&e<=56319}function Iv(e){return e>=56320&&e<=57343}var Cv=function(t){if(typeof t!="string")throw new Error("Input must be string");for(var r=t.length,n=0,i=null,a=null,s=0;s<r;s++)i=t.charCodeAt(s),Iv(i)?a!=null&&Tv(a)?n+=1:n+=3:i<=127?n+=1:i>=128&&i<=2047?n+=2:i>=2048&&i<=65535&&(n+=3),a=i;return n},kv=Av.bind(null,Cv),Rv=/[\/\?<>\\:\*\|"]/g,Pv=/[\x00-\x1f\x80-\x9f]/g,Nv=/^\.+$/,Ov=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,Dv=/[\. ]+$/;function mh(e,t){if(typeof e!="string")throw new Error("Input must be string");var r=e.replace(Rv,t).replace(Pv,t).replace(Nv,t).replace(Ov,t).replace(Dv,t);return kv(r,255)}var Mv=function(e,t){var r=t&&t.replacement||"",n=mh(e,r);return r===""?n:mh(n,"")},gh={createCipheriv:(e,t,r)=>{const n=G.cipher.createCipher("AES-CTR",De(t,"ascii"));return n.start({iv:De(r,"ascii")}),{update:i=>(n.update(G.util.createBuffer(De(i,"ascii"))),at(n.output.getBytes(),"ascii"))}},createDecipheriv:(e,t,r)=>{const n=G.cipher.createDecipher("AES-CTR",De(t,"ascii"));return n.start({iv:De(r,"ascii")}),{update:i=>(n.update(G.util.createBuffer(De(i,"ascii"))),at(n.output.getBytes(),"ascii"))}}};const yh={16:"aes-128-ctr",32:"aes-256-ctr"};var xv=function(e){const t=yh[e.length];if(!t){const r=Object.entries(yh).map(([n,i])=>`${n} (${i})`).join(" / ");throw U(new Error(`Invalid key length ${e.length} bytes. Must be ${r}`),"ERR_INVALID_KEY_LENGTH")}return t},Bv=async function(e,t){const r=xv(e),n=gh.createCipheriv(r,e,t),i=gh.createDecipheriv(r,e,t),a={async encrypt(s){return n.update(s)},async decrypt(s){return i.update(s)}};return a},Lv={create:Bv};const bh={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function jv(e,t,r,n,i){const a=bh[i];if(!a){const c=Object.keys(bh).join(" / ");throw U(new Error(`Hash '${i}' is unknown or not supported. Must be ${c}`),"ERR_UNSUPPORTED_HASH_TYPE")}const s=Rg(e,t,r,n,a);return Pg.encode64(s)}var Uv=jv,Fv=Lv,qv=Ng,Gv=Yl,$v=Jl,Vv=Uv,sr={aes:Fv,hmac:qv,keys:Gv,randomBytes:$v,pbkdf2:Vv};let Hv="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",vh=e=>crypto.getRandomValues(new Uint8Array(e)),wh=(e,t,r)=>{let n=(2<<Math.log(e.length-1)/Math.LN2)-1,i=-~(1.6*n*t/e.length);return()=>{let a="";for(;;){let s=r(i),c=i;for(;c--;)if(a+=e[s[c]&n]||"",a.length===+t)return a}}},zv=(e,t)=>wh(e,t,vh),Kv=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let n=r[e]&63;n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n<63?t+="_":t+="-"}return t};var _h=Object.freeze({__proto__:null,nanoid:Kv,customAlphabet:zv,customRandom:wh,urlAlphabet:Hv,random:vh});const{nanoid:Wv}=_h,Xv=(e=t=>t)=>e(Wv());var Qv=Xv,Yv=jn.TextEncoder,Eh=jn.TextDecoder,Jv=new Yv("utf8"),Zv=new Eh("utf8"),ew=(e,t)=>async function*(){for await(const r of e){const n=await t(r);if(!n)continue;yield r}}(),tw=(e,t)=>async function*(){let r=[];for await(const n of e)r.push(n);r=await t(r);for(const n of r)yield n}(),rw=(e,t)=>async function*(){if(t<=0)return;let r=0;for await(const n of e)if(yield n,r++,r>=t)return}(),nw=(e,t)=>async function*(){for await(const r of e)yield t(r)}(),iw=function(e,t){const r=new RegExp("^"+t);return e.replace(r,"")},aw=Qv,mu={utf8Encoder:Jv,utf8Decoder:Zv,filter:ew,sortAll:tw,take:rw,map:nw,replaceStartWith:iw,tmpdir:aw};const{nanoid:sw}=_h,{utf8Encoder:Sh,utf8Decoder:ow}=mu,Gn="/",Ah=Sh.encode(Gn),wo=Ah[0];class gu{constructor(e,t){if(typeof e=="string")this._buf=Sh.encode(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==wo)throw new Error("Invalid key")}toString(e="utf8"){return e==="utf8"||e==="utf-8"?ow.decode(this._buf):new Eh(e).decode(this._buf)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new pi(e.join(Gn))}static random(){return new pi(sw().replace(/-/g,""))}clean(){if((!this._buf||this._buf.byteLength===0)&&(this._buf=Ah),this._buf[0]!==wo){const e=new Uint8Array(this._buf.byteLength+1);e.fill(wo,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===wo;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let n=0;n<t.length;n++){if(r.length<n+1)return!1;const i=t[n],a=r[n];if(i<a)return!0;if(i>a)return!1}return t.length<r.length}reverse(){return gu.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Gn).slice(1)}type(){return cw(this.baseNamespace())}name(){return uw(this.baseNamespace())}instance(e){return new pi(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Gn)||(e+=Gn),e+=this.type(),new pi(e)}parent(){const e=this.list();return e.length===1?new pi(Gn):new pi(e.slice(0,-1).join(Gn))}child(e){return this.toString()===Gn?e:e.toString()===Gn?this:new pi(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return gu.withNamespaces([...this.namespaces(),...lw(e.map(t=>t.namespaces()))])}}function cw(e){const t=e.split(":");return t.length<2?"":t.slice(0,-1).join(":")}function uw(e){const t=e.split(":");return t[t.length-1]}function lw(e){return[].concat(...e)}const pi=Pr(gu,{className:"Key",symbolName:"@ipfs/interface-datastore/key"});var Th=pi;const dw=async e=>{for await(const t of e);};var Ih=dw;const{filter:yu,sortAll:hw,take:pw,map:fw}=mu;class mw{async open(){}async close(){}async put(e,t,r={}){}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield{key:r,value:n}}async get(e,t={}){}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}async has(e){}async delete(e,t={}){}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(r,n){e.push({key:r,value:n})},delete(r){t.push(r)},commit:async r=>{await Ih(this.putMany(e,r)),e=[],await Ih(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){}async*query(e,t){let r=this._all(e,t);if(e.prefix!=null&&(r=yu(r,n=>n.key.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(r=e.filters.reduce((n,i)=>yu(n,i),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((n,i)=>hw(n,i),r)),e.offset!=null){let n=0;r=yu(r,()=>n++>=e.offset)}e.limit!=null&&(r=pw(r,e.limit)),e.keysOnly===!0&&(r=fw(r,n=>({key:n.key}))),yield*r}}var Ch=mw,gw=e=>(e=e||new Error("Cannot open database"),U(e,"ERR_DB_OPEN_FAILED")),yw=e=>(e=e||new Error("Delete failed"),U(e,"ERR_DB_DELETE_FAILED")),bw=e=>(e=e||new Error("Write failed"),U(e,"ERR_DB_WRITE_FAILED")),vw=e=>(e=e||new Error("Not Found"),U(e,"ERR_NOT_FOUND")),ww=e=>(e=e||new Error("Aborted"),U(e,"ERR_ABORTED")),kh={dbOpenFailedError:gw,dbDeleteFailedError:yw,dbWriteFailedError:bw,notFoundError:vw,abortedError:ww};class _w extends Ch{constructor(){super();this.data={}}async put(e,t){this.data[e.toString()]=t}async get(e){const t=await this.has(e);if(!t)throw kh.notFoundError();return this.data[e.toString()]}async has(e){return this.data[e.toString()]!==void 0}async delete(e){delete this.data[e.toString()]}*_all(){yield*Object.entries(this.data).map(([e,t])=>({key:new Th(e),value:t}))}}var Ew=_w,Sw=Th,Aw=Ew,Tw=mu,Iw=kh,Cw=Ch,Ea={Key:Sw,MemoryDatastore:Aw,utils:Tw,Errors:Iw,Adapter:Cw},jO=re(function(e){var t=G.asn1,r=e.exports=G.pkcs7asn1=G.pkcs7asn1||{};G.pkcs7=G.pkcs7||{},G.pkcs7.asn1=r;var n={name:"ContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};r.contentInfoValidator=n;var i={name:"EncryptedContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};r.envelopedDataValidator={name:"EnvelopedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(i)},r.encryptedDataValidator={name:"EncryptedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"}].concat(i)};var a={name:"SignerInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};r.signedDataValidator={name:"SignedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},n,{name:"SignedData.Certificates",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,capture:"signerInfos",optional:!0,value:[a]}]},r.recipientInfoValidator={name:"RecipientInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter"}]},{name:"RecipientInfo.encryptedKey",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}}),UO=re(function(e){G.mgf=G.mgf||{};var t=e.exports=G.mgf.mgf1=G.mgf1=G.mgf1||{};t.create=function(r){var n={generate:function(i,a){for(var s=new G.util.ByteBuffer,c=Math.ceil(a/r.digestLength),o=0;o<c;o++){var u=new G.util.ByteBuffer;u.putInt32(o),r.start(),r.update(i+u.getBytes()),s.putBuffer(r.digest())}return s.truncate(s.length()-a),s.getBytes()}};return n}}),FO=G.mgf=G.mgf||{};G.mgf.mgf1=G.mgf1;var qO=re(function(e){var t=e.exports=G.pss=G.pss||{};t.create=function(r){arguments.length===3&&(r={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var n=r.md,i=r.mgf,a=n.digestLength,s=r.salt||null;typeof s=="string"&&(s=G.util.createBuffer(s));var c;if("saltLength"in r)c=r.saltLength;else if(s!==null)c=s.length();else throw new Error("Salt length not specified or specific salt not given.");if(s!==null&&s.length()!==c)throw new Error("Given salt length does not match length of given salt.");var o=r.prng||G.random,u={};return u.encode=function(l,h){var w,f=h-1,A=Math.ceil(f/8),p=l.digest().getBytes();if(A<a+c+2)throw new Error("Message is too long to encrypt.");var y;s===null?y=o.getBytesSync(c):y=s.bytes();var v=new G.util.ByteBuffer;v.fillWithByte(0,8),v.putBytes(p),v.putBytes(y),n.start(),n.update(v.getBytes());var O=n.digest().getBytes(),R=new G.util.ByteBuffer;R.fillWithByte(0,A-c-a-2),R.putByte(1),R.putBytes(y);var m=R.getBytes(),g=A-a-1,S=i.generate(O,g),d="";for(w=0;w<g;w++)d+=String.fromCharCode(m.charCodeAt(w)^S.charCodeAt(w));var b=65280>>8*A-f&255;return d=String.fromCharCode(d.charCodeAt(0)&~b)+d.substr(1),d+O+String.fromCharCode(188)},u.verify=function(l,h,w){var f,A=w-1,p=Math.ceil(A/8);if(h=h.substr(-p),p<a+c+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(h.charCodeAt(p-1)!==188)throw new Error("Encoded message does not end in 0xBC.");var y=p-a-1,v=h.substr(0,y),O=h.substr(y,a),R=65280>>8*p-A&255;if((v.charCodeAt(0)&R)!==0)throw new Error("Bits beyond keysize not zero as expected.");var m=i.generate(O,y),g="";for(f=0;f<y;f++)g+=String.fromCharCode(v.charCodeAt(f)^m.charCodeAt(f));g=String.fromCharCode(g.charCodeAt(0)&~R)+g.substr(1);var S=p-a-c-2;for(f=0;f<S;f++)if(g.charCodeAt(f)!==0)throw new Error("Leftmost octets not zero as expected");if(g.charCodeAt(S)!==1)throw new Error("Inconsistent PSS signature, 0x01 marker not found");var d=g.substr(-c),b=new G.util.ByteBuffer;b.fillWithByte(0,8),b.putBytes(l),b.putBytes(d),n.start(),n.update(b.getBytes());var E=n.digest().getBytes();return O===E},u}}),GO=re(function(e){var t=G.asn1,r=e.exports=G.pki=G.pki||{},n=r.oids,i={};i.CN=n.commonName,i.commonName="CN",i.C=n.countryName,i.countryName="C",i.L=n.localityName,i.localityName="L",i.ST=n.stateOrProvinceName,i.stateOrProvinceName="ST",i.O=n.organizationName,i.organizationName="O",i.OU=n.organizationalUnitName,i.organizationalUnitName="OU",i.E=n.emailAddress,i.emailAddress="E";var a=G.pki.rsa.publicKeyValidator,s={name:"Certificate",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:t.Class.UNIVERSAL,type:t.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:t.Class.UNIVERSAL,type:t.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:t.Class.UNIVERSAL,type:t.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:t.Class.UNIVERSAL,type:t.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},a,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:t.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:t.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},c={name:"rsapss",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:t.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:t.Class.UNIVERSAL,type:t.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:t.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:t.Class.UNIVERSAL,type:t.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},o={name:"CertificationRequestInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},a,{name:"CertificationRequestInfo.attributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0}]}]}]},u={name:"CertificationRequest",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[o,{name:"CertificationRequest.signatureAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};r.RDNAttributesAsArray=function(m,g){for(var S=[],d,b,E,_=0;_<m.value.length;++_){d=m.value[_];for(var P=0;P<d.value.length;++P)E={},b=d.value[P],E.type=t.derToOid(b.value[0].value),E.value=b.value[1].value,E.valueTagClass=b.value[1].type,E.type in n&&(E.name=n[E.type],E.name in i&&(E.shortName=i[E.name])),g&&(g.update(E.type),g.update(E.value)),S.push(E)}return S},r.CRIAttributesAsArray=function(m){for(var g=[],S=0;S<m.length;++S)for(var d=m[S],b=t.derToOid(d.value[0].value),E=d.value[1].value,_=0;_<E.length;++_){var P={};if(P.type=b,P.value=E[_].value,P.valueTagClass=E[_].type,P.type in n&&(P.name=n[P.type],P.name in i&&(P.shortName=i[P.name])),P.type===n.extensionRequest){P.extensions=[];for(var M=0;M<P.value.length;++M)P.extensions.push(r.certificateExtensionFromAsn1(P.value[M]))}g.push(P)}return g};function l(m,g){typeof g=="string"&&(g={shortName:g});for(var S=null,d,b=0;S===null&&b<m.attributes.length;++b)d=m.attributes[b],(g.type&&g.type===d.type||(g.name&&g.name===d.name||g.shortName&&g.shortName===d.shortName))&&(S=d);return S}var h=function(m,g,S){var d={};if(m!==n["RSASSA-PSS"])return d;S&&(d={hash:{algorithmOid:n.sha1},mgf:{algorithmOid:n.mgf1,hash:{algorithmOid:n.sha1}},saltLength:20});var b={},E=[];if(!t.validate(g,c,b,E)){var _=new Error("Cannot read RSASSA-PSS parameter block.");throw _.errors=E,_}return b.hashOid!==void 0&&(d.hash=d.hash||{},d.hash.algorithmOid=t.derToOid(b.hashOid)),b.maskGenOid!==void 0&&(d.mgf=d.mgf||{},d.mgf.algorithmOid=t.derToOid(b.maskGenOid),d.mgf.hash=d.mgf.hash||{},d.mgf.hash.algorithmOid=t.derToOid(b.maskGenHashOid)),b.saltLength!==void 0&&(d.saltLength=b.saltLength.charCodeAt(0)),d};r.certificateFromPem=function(m,g,S){var d=G.pem.decode(m)[0];if(d.type!=="CERTIFICATE"&&d.type!=="X509 CERTIFICATE"&&d.type!=="TRUSTED CERTIFICATE"){var b=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw b.headerType=d.type,b}if(d.procType&&d.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var E=t.fromDer(d.body,S);return r.certificateFromAsn1(E,g)},r.certificateToPem=function(m,g){var S={type:"CERTIFICATE",body:t.toDer(r.certificateToAsn1(m)).getBytes()};return G.pem.encode(S,{maxline:g})},r.publicKeyFromPem=function(m){var g=G.pem.decode(m)[0];if(g.type!=="PUBLIC KEY"&&g.type!=="RSA PUBLIC KEY"){var S=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw S.headerType=g.type,S}if(g.procType&&g.procType.type==="ENCRYPTED")throw new Error("Could not convert public key from PEM; PEM is encrypted.");var d=t.fromDer(g.body);return r.publicKeyFromAsn1(d)},r.publicKeyToPem=function(m,g){var S={type:"PUBLIC KEY",body:t.toDer(r.publicKeyToAsn1(m)).getBytes()};return G.pem.encode(S,{maxline:g})},r.publicKeyToRSAPublicKeyPem=function(m,g){var S={type:"RSA PUBLIC KEY",body:t.toDer(r.publicKeyToRSAPublicKey(m)).getBytes()};return G.pem.encode(S,{maxline:g})},r.getPublicKeyFingerprint=function(m,g){g=g||{};var S=g.md||G.md.sha1.create(),d=g.type||"RSAPublicKey",b;switch(d){case"RSAPublicKey":b=t.toDer(r.publicKeyToRSAPublicKey(m)).getBytes();break;case"SubjectPublicKeyInfo":b=t.toDer(r.publicKeyToAsn1(m)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+g.type+'".')}S.start(),S.update(b);var E=S.digest();if(g.encoding==="hex"){var _=E.toHex();return g.delimiter?_.match(/.{2}/g).join(g.delimiter):_}else{if(g.encoding==="binary")return E.getBytes();if(g.encoding)throw new Error('Unknown encoding "'+g.encoding+'".')}return E},r.certificationRequestFromPem=function(m,g,S){var d=G.pem.decode(m)[0];if(d.type!=="CERTIFICATE REQUEST"){var b=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw b.headerType=d.type,b}if(d.procType&&d.procType.type==="ENCRYPTED")throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var E=t.fromDer(d.body,S);return r.certificationRequestFromAsn1(E,g)},r.certificationRequestToPem=function(m,g){var S={type:"CERTIFICATE REQUEST",body:t.toDer(r.certificationRequestToAsn1(m)).getBytes()};return G.pem.encode(S,{maxline:g})},r.createCertificate=function(){var m={};return m.version=2,m.serialNumber="00",m.signatureOid=null,m.signature=null,m.siginfo={},m.siginfo.algorithmOid=null,m.validity={},m.validity.notBefore=new Date,m.validity.notAfter=new Date,m.issuer={},m.issuer.getField=function(g){return l(m.issuer,g)},m.issuer.addField=function(g){f([g]),m.issuer.attributes.push(g)},m.issuer.attributes=[],m.issuer.hash=null,m.subject={},m.subject.getField=function(g){return l(m.subject,g)},m.subject.addField=function(g){f([g]),m.subject.attributes.push(g)},m.subject.attributes=[],m.subject.hash=null,m.extensions=[],m.publicKey=null,m.md=null,m.setSubject=function(g,S){f(g),m.subject.attributes=g,delete m.subject.uniqueId,S&&(m.subject.uniqueId=S),m.subject.hash=null},m.setIssuer=function(g,S){f(g),m.issuer.attributes=g,delete m.issuer.uniqueId,S&&(m.issuer.uniqueId=S),m.issuer.hash=null},m.setExtensions=function(g){for(var S=0;S<g.length;++S)A(g[S],{cert:m});m.extensions=g},m.getExtension=function(g){typeof g=="string"&&(g={name:g});for(var S=null,d,b=0;S===null&&b<m.extensions.length;++b)d=m.extensions[b],(g.id&&d.id===g.id||g.name&&d.name===g.name)&&(S=d);return S},m.sign=function(g,S){m.md=S||G.md.sha1.create();var d=n[m.md.algorithm+"WithRSAEncryption"];if(!d){var b=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw b.algorithm=m.md.algorithm,b}m.signatureOid=m.siginfo.algorithmOid=d,m.tbsCertificate=r.getTBSCertificate(m);var E=t.toDer(m.tbsCertificate);m.md.update(E.getBytes()),m.signature=g.sign(m.md)},m.verify=function(g){var S=!1;if(!m.issued(g)){var d=g.issuer,b=m.subject,E=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw E.expectedIssuer=d.attributes,E.actualIssuer=b.attributes,E}var _=g.md;if(_===null){if(g.signatureOid in n){var P=n[g.signatureOid];switch(P){case"sha1WithRSAEncryption":_=G.md.sha1.create();break;case"md5WithRSAEncryption":_=G.md.md5.create();break;case"sha256WithRSAEncryption":_=G.md.sha256.create();break;case"sha384WithRSAEncryption":_=G.md.sha384.create();break;case"sha512WithRSAEncryption":_=G.md.sha512.create();break;case"RSASSA-PSS":_=G.md.sha256.create();break}}if(_===null){var E=new Error("Could not compute certificate digest. Unknown signature OID.");throw E.signatureOid=g.signatureOid,E}var M=g.tbsCertificate||r.getTBSCertificate(g),j=t.toDer(M);_.update(j.getBytes())}if(_!==null){var L;switch(g.signatureOid){case n.sha1WithRSAEncryption:L=void 0;break;case n["RSASSA-PSS"]:var B,$;if(B=n[g.signatureParameters.mgf.hash.algorithmOid],B===void 0||G.md[B]===void 0){var E=new Error("Unsupported MGF hash function.");throw E.oid=g.signatureParameters.mgf.hash.algorithmOid,E.name=B,E}if($=n[g.signatureParameters.mgf.algorithmOid],$===void 0||G.mgf[$]===void 0){var E=new Error("Unsupported MGF function.");throw E.oid=g.signatureParameters.mgf.algorithmOid,E.name=$,E}if($=G.mgf[$].create(G.md[B].create()),B=n[g.signatureParameters.hash.algorithmOid],B===void 0||G.md[B]===void 0)throw{message:"Unsupported RSASSA-PSS hash function.",oid:g.signatureParameters.hash.algorithmOid,name:B};L=G.pss.create(G.md[B].create(),$,g.signatureParameters.saltLength);break}S=m.publicKey.verify(_.digest().getBytes(),g.signature,L)}return S},m.isIssuer=function(g){var S=!1,d=m.issuer,b=g.subject;if(d.hash&&b.hash)S=d.hash===b.hash;else if(d.attributes.length===b.attributes.length){S=!0;for(var E,_,P=0;S&&P<d.attributes.length;++P)E=d.attributes[P],_=b.attributes[P],(E.type!==_.type||E.value!==_.value)&&(S=!1)}return S},m.issued=function(g){return g.isIssuer(m)},m.generateSubjectKeyIdentifier=function(){return r.getPublicKeyFingerprint(m.publicKey,{type:"RSAPublicKey"})},m.verifySubjectKeyIdentifier=function(){for(var g=n.subjectKeyIdentifier,S=0;S<m.extensions.length;++S){var d=m.extensions[S];if(d.id===g){var b=m.generateSubjectKeyIdentifier().getBytes();return G.util.hexToBytes(d.subjectKeyIdentifier)===b}}return!1},m},r.certificateFromAsn1=function(m,g){var S={},d=[];if(!t.validate(m,s,S,d)){var b=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw b.errors=d,b}var E=t.derToOid(S.publicKeyOid);if(E!==r.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var _=r.createCertificate();_.version=S.certVersion?S.certVersion.charCodeAt(0):0;var P=G.util.createBuffer(S.certSerialNumber);_.serialNumber=P.toHex(),_.signatureOid=G.asn1.derToOid(S.certSignatureOid),_.signatureParameters=h(_.signatureOid,S.certSignatureParams,!0),_.siginfo.algorithmOid=G.asn1.derToOid(S.certinfoSignatureOid),_.siginfo.parameters=h(_.siginfo.algorithmOid,S.certinfoSignatureParams,!1),_.signature=S.certSignature;var M=[];if(S.certValidity1UTCTime!==void 0&&M.push(t.utcTimeToDate(S.certValidity1UTCTime)),S.certValidity2GeneralizedTime!==void 0&&M.push(t.generalizedTimeToDate(S.certValidity2GeneralizedTime)),S.certValidity3UTCTime!==void 0&&M.push(t.utcTimeToDate(S.certValidity3UTCTime)),S.certValidity4GeneralizedTime!==void 0&&M.push(t.generalizedTimeToDate(S.certValidity4GeneralizedTime)),M.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(M.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(_.validity.notBefore=M[0],_.validity.notAfter=M[1],_.tbsCertificate=S.tbsCertificate,g){if(_.md=null,_.signatureOid in n){var E=n[_.signatureOid];switch(E){case"sha1WithRSAEncryption":_.md=G.md.sha1.create();break;case"md5WithRSAEncryption":_.md=G.md.md5.create();break;case"sha256WithRSAEncryption":_.md=G.md.sha256.create();break;case"sha384WithRSAEncryption":_.md=G.md.sha384.create();break;case"sha512WithRSAEncryption":_.md=G.md.sha512.create();break;case"RSASSA-PSS":_.md=G.md.sha256.create();break}}if(_.md===null){var b=new Error("Could not compute certificate digest. Unknown signature OID.");throw b.signatureOid=_.signatureOid,b}var j=t.toDer(_.tbsCertificate);_.md.update(j.getBytes())}var L=G.md.sha1.create();_.issuer.getField=function($){return l(_.issuer,$)},_.issuer.addField=function($){f([$]),_.issuer.attributes.push($)},_.issuer.attributes=r.RDNAttributesAsArray(S.certIssuer,L),S.certIssuerUniqueId&&(_.issuer.uniqueId=S.certIssuerUniqueId),_.issuer.hash=L.digest().toHex();var B=G.md.sha1.create();return _.subject.getField=function($){return l(_.subject,$)},_.subject.addField=function($){f([$]),_.subject.attributes.push($)},_.subject.attributes=r.RDNAttributesAsArray(S.certSubject,B),S.certSubjectUniqueId&&(_.subject.uniqueId=S.certSubjectUniqueId),_.subject.hash=B.digest().toHex(),S.certExtensions?_.extensions=r.certificateExtensionsFromAsn1(S.certExtensions):_.extensions=[],_.publicKey=r.publicKeyFromAsn1(S.subjectPublicKeyInfo),_},r.certificateExtensionsFromAsn1=function(m){for(var g=[],S=0;S<m.value.length;++S)for(var d=m.value[S],b=0;b<d.value.length;++b)g.push(r.certificateExtensionFromAsn1(d.value[b]));return g},r.certificateExtensionFromAsn1=function(m){var g={};if(g.id=t.derToOid(m.value[0].value),g.critical=!1,m.value[1].type===t.Type.BOOLEAN?(g.critical=m.value[1].value.charCodeAt(0)!==0,g.value=m.value[2].value):g.value=m.value[1].value,g.id in n){if(g.name=n[g.id],g.name==="keyUsage"){var S=t.fromDer(g.value),d=0,b=0;S.value.length>1&&(d=S.value.charCodeAt(1),b=S.value.length>2?S.value.charCodeAt(2):0),g.digitalSignature=(d&128)===128,g.nonRepudiation=(d&64)===64,g.keyEncipherment=(d&32)===32,g.dataEncipherment=(d&16)===16,g.keyAgreement=(d&8)===8,g.keyCertSign=(d&4)===4,g.cRLSign=(d&2)===2,g.encipherOnly=(d&1)===1,g.decipherOnly=(b&128)===128}else if(g.name==="basicConstraints"){var S=t.fromDer(g.value);S.value.length>0&&S.value[0].type===t.Type.BOOLEAN?g.cA=S.value[0].value.charCodeAt(0)!==0:g.cA=!1;var E=null;S.value.length>0&&S.value[0].type===t.Type.INTEGER?E=S.value[0].value:S.value.length>1&&(E=S.value[1].value),E!==null&&(g.pathLenConstraint=t.derToInteger(E))}else if(g.name==="extKeyUsage")for(var S=t.fromDer(g.value),_=0;_<S.value.length;++_){var P=t.derToOid(S.value[_].value);P in n?g[n[P]]=!0:g[P]=!0}else if(g.name==="nsCertType"){var S=t.fromDer(g.value),d=0;S.value.length>1&&(d=S.value.charCodeAt(1)),g.client=(d&128)===128,g.server=(d&64)===64,g.email=(d&32)===32,g.objsign=(d&16)===16,g.reserved=(d&8)===8,g.sslCA=(d&4)===4,g.emailCA=(d&2)===2,g.objCA=(d&1)===1}else if(g.name==="subjectAltName"||g.name==="issuerAltName"){g.altNames=[];for(var M,S=t.fromDer(g.value),j=0;j<S.value.length;++j){M=S.value[j];var L={type:M.type,value:M.value};g.altNames.push(L);switch(M.type){case 1:case 2:case 6:break;case 7:L.ip=G.util.bytesToIP(M.value);break;case 8:L.oid=t.derToOid(M.value);break}}}else if(g.name==="subjectKeyIdentifier"){var S=t.fromDer(g.value);g.subjectKeyIdentifier=G.util.bytesToHex(S.value)}}return g},r.certificationRequestFromAsn1=function(m,g){var S={},d=[];if(!t.validate(m,u,S,d)){var b=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw b.errors=d,b}var E=t.derToOid(S.publicKeyOid);if(E!==r.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var _=r.createCertificationRequest();if(_.version=S.csrVersion?S.csrVersion.charCodeAt(0):0,_.signatureOid=G.asn1.derToOid(S.csrSignatureOid),_.signatureParameters=h(_.signatureOid,S.csrSignatureParams,!0),_.siginfo.algorithmOid=G.asn1.derToOid(S.csrSignatureOid),_.siginfo.parameters=h(_.siginfo.algorithmOid,S.csrSignatureParams,!1),_.signature=S.csrSignature,_.certificationRequestInfo=S.certificationRequestInfo,g){if(_.md=null,_.signatureOid in n){var E=n[_.signatureOid];switch(E){case"sha1WithRSAEncryption":_.md=G.md.sha1.create();break;case"md5WithRSAEncryption":_.md=G.md.md5.create();break;case"sha256WithRSAEncryption":_.md=G.md.sha256.create();break;case"sha384WithRSAEncryption":_.md=G.md.sha384.create();break;case"sha512WithRSAEncryption":_.md=G.md.sha512.create();break;case"RSASSA-PSS":_.md=G.md.sha256.create();break}}if(_.md===null){var b=new Error("Could not compute certification request digest. Unknown signature OID.");throw b.signatureOid=_.signatureOid,b}var P=t.toDer(_.certificationRequestInfo);_.md.update(P.getBytes())}var M=G.md.sha1.create();return _.subject.getField=function(j){return l(_.subject,j)},_.subject.addField=function(j){f([j]),_.subject.attributes.push(j)},_.subject.attributes=r.RDNAttributesAsArray(S.certificationRequestInfoSubject,M),_.subject.hash=M.digest().toHex(),_.publicKey=r.publicKeyFromAsn1(S.subjectPublicKeyInfo),_.getAttribute=function(j){return l(_,j)},_.addAttribute=function(j){f([j]),_.attributes.push(j)},_.attributes=r.CRIAttributesAsArray(S.certificationRequestInfoAttributes||[]),_},r.createCertificationRequest=function(){var m={};return m.version=0,m.signatureOid=null,m.signature=null,m.siginfo={},m.siginfo.algorithmOid=null,m.subject={},m.subject.getField=function(g){return l(m.subject,g)},m.subject.addField=function(g){f([g]),m.subject.attributes.push(g)},m.subject.attributes=[],m.subject.hash=null,m.publicKey=null,m.attributes=[],m.getAttribute=function(g){return l(m,g)},m.addAttribute=function(g){f([g]),m.attributes.push(g)},m.md=null,m.setSubject=function(g){f(g),m.subject.attributes=g,m.subject.hash=null},m.setAttributes=function(g){f(g),m.attributes=g},m.sign=function(g,S){m.md=S||G.md.sha1.create();var d=n[m.md.algorithm+"WithRSAEncryption"];if(!d){var b=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw b.algorithm=m.md.algorithm,b}m.signatureOid=m.siginfo.algorithmOid=d,m.certificationRequestInfo=r.getCertificationRequestInfo(m);var E=t.toDer(m.certificationRequestInfo);m.md.update(E.getBytes()),m.signature=g.sign(m.md)},m.verify=function(){var g=!1,S=m.md;if(S===null){if(m.signatureOid in n){var d=n[m.signatureOid];switch(d){case"sha1WithRSAEncryption":S=G.md.sha1.create();break;case"md5WithRSAEncryption":S=G.md.md5.create();break;case"sha256WithRSAEncryption":S=G.md.sha256.create();break;case"sha384WithRSAEncryption":S=G.md.sha384.create();break;case"sha512WithRSAEncryption":S=G.md.sha512.create();break;case"RSASSA-PSS":S=G.md.sha256.create();break}}if(S===null){var b=new Error("Could not compute certification request digest. Unknown signature OID.");throw b.signatureOid=m.signatureOid,b}var E=m.certificationRequestInfo||r.getCertificationRequestInfo(m),_=t.toDer(E);S.update(_.getBytes())}if(S!==null){var P;switch(m.signatureOid){case n.sha1WithRSAEncryption:break;case n["RSASSA-PSS"]:var M,j;if(M=n[m.signatureParameters.mgf.hash.algorithmOid],M===void 0||G.md[M]===void 0){var b=new Error("Unsupported MGF hash function.");throw b.oid=m.signatureParameters.mgf.hash.algorithmOid,b.name=M,b}if(j=n[m.signatureParameters.mgf.algorithmOid],j===void 0||G.mgf[j]===void 0){var b=new Error("Unsupported MGF function.");throw b.oid=m.signatureParameters.mgf.algorithmOid,b.name=j,b}if(j=G.mgf[j].create(G.md[M].create()),M=n[m.signatureParameters.hash.algorithmOid],M===void 0||G.md[M]===void 0){var b=new Error("Unsupported RSASSA-PSS hash function.");throw b.oid=m.signatureParameters.hash.algorithmOid,b.name=M,b}P=G.pss.create(G.md[M].create(),j,m.signatureParameters.saltLength);break}g=m.publicKey.verify(S.digest().getBytes(),m.signature,P)}return g},m};function w(m){for(var g=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),S,d,b=m.attributes,E=0;E<b.length;++E){S=b[E];var _=S.value,P=t.Type.PRINTABLESTRING;"valueTagClass"in S&&(P=S.valueTagClass,P===t.Type.UTF8&&(_=G.util.encodeUtf8(_))),d=t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(S.type).getBytes()),t.create(t.Class.UNIVERSAL,P,!1,_)])]),g.value.push(d)}return g}function f(m){for(var g,S=0;S<m.length;++S){if(g=m[S],typeof g.name=="undefined"&&(g.type&&g.type in r.oids?g.name=r.oids[g.type]:g.shortName&&g.shortName in i&&(g.name=r.oids[i[g.shortName]])),typeof g.type=="undefined")if(g.name&&g.name in r.oids)g.type=r.oids[g.name];else{var d=new Error("Attribute type not specified.");throw d.attribute=g,d}if(typeof g.shortName=="undefined"&&(g.name&&g.name in i&&(g.shortName=i[g.name])),g.type===n.extensionRequest&&(g.valueConstructed=!0,g.valueTagClass=t.Type.SEQUENCE,!g.value&&g.extensions)){g.value=[];for(var b=0;b<g.extensions.length;++b)g.value.push(r.certificateExtensionToAsn1(A(g.extensions[b])))}if(typeof g.value=="undefined"){var d=new Error("Attribute value not specified.");throw d.attribute=g,d}}}function A(m,g){if(g=g||{},typeof m.name=="undefined"&&(m.id&&m.id in r.oids&&(m.name=r.oids[m.id])),typeof m.id=="undefined")if(m.name&&m.name in r.oids)m.id=r.oids[m.name];else{var S=new Error("Extension ID not specified.");throw S.extension=m,S}if(typeof m.value!="undefined")return m;if(m.name==="keyUsage"){var d=0,b=0,E=0;m.digitalSignature&&(b|=128,d=7),m.nonRepudiation&&(b|=64,d=6),m.keyEncipherment&&(b|=32,d=5),m.dataEncipherment&&(b|=16,d=4),m.keyAgreement&&(b|=8,d=3),m.keyCertSign&&(b|=4,d=2),m.cRLSign&&(b|=2,d=1),m.encipherOnly&&(b|=1,d=0),m.decipherOnly&&(E|=128,d=7);var _=String.fromCharCode(d);E!==0?_+=String.fromCharCode(b)+String.fromCharCode(E):b!==0&&(_+=String.fromCharCode(b)),m.value=t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,_)}else if(m.name==="basicConstraints")m.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),m.cA&&m.value.value.push(t.create(t.Class.UNIVERSAL,t.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in m&&m.value.value.push(t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(m.pathLenConstraint).getBytes()));else if(m.name==="extKeyUsage"){m.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);var P=m.value.value;for(var M in m){if(m[M]!==!0)continue;M in n?P.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n[M]).getBytes())):M.indexOf(".")!==-1&&P.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(M).getBytes()))}}else if(m.name==="nsCertType"){var d=0,b=0;m.client&&(b|=128,d=7),m.server&&(b|=64,d=6),m.email&&(b|=32,d=5),m.objsign&&(b|=16,d=4),m.reserved&&(b|=8,d=3),m.sslCA&&(b|=4,d=2),m.emailCA&&(b|=2,d=1),m.objCA&&(b|=1,d=0);var _=String.fromCharCode(d);b!==0&&(_+=String.fromCharCode(b)),m.value=t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,_)}else if(m.name==="subjectAltName"||m.name==="issuerAltName"){m.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);for(var j,L=0;L<m.altNames.length;++L){j=m.altNames[L];var _=j.value;if(j.type===7&&j.ip){if(_=G.util.bytesFromIP(j.ip),_===null){var S=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw S.extension=m,S}}else j.type===8&&(j.oid?_=t.oidToDer(t.oidToDer(j.oid)):_=t.oidToDer(_));m.value.value.push(t.create(t.Class.CONTEXT_SPECIFIC,j.type,!1,_))}}else if(m.name==="nsComment"&&g.cert){if(!/^[\x00-\x7F]*$/.test(m.comment)||m.comment.length<1||m.comment.length>128)throw new Error('Invalid "nsComment" content.');m.value=t.create(t.Class.UNIVERSAL,t.Type.IA5STRING,!1,m.comment)}else if(m.name==="subjectKeyIdentifier"&&g.cert){var B=g.cert.generateSubjectKeyIdentifier();m.subjectKeyIdentifier=B.toHex(),m.value=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,B.getBytes())}else if(m.name==="authorityKeyIdentifier"&&g.cert){m.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);var P=m.value.value;if(m.keyIdentifier){var $=m.keyIdentifier===!0?g.cert.generateSubjectKeyIdentifier().getBytes():m.keyIdentifier;P.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!1,$))}if(m.authorityCertIssuer){var V=[t.create(t.Class.CONTEXT_SPECIFIC,4,!0,[w(m.authorityCertIssuer===!0?g.cert.issuer:m.authorityCertIssuer)])];P.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,V))}if(m.serialNumber){var W=G.util.hexToBytes(m.serialNumber===!0?g.cert.serialNumber:m.serialNumber);P.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!1,W))}}else if(m.name==="cRLDistributionPoints"){m.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);for(var P=m.value.value,se=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),oe=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[]),j,L=0;L<m.altNames.length;++L){j=m.altNames[L];var _=j.value;if(j.type===7&&j.ip){if(_=G.util.bytesFromIP(j.ip),_===null){var S=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw S.extension=m,S}}else j.type===8&&(j.oid?_=t.oidToDer(t.oidToDer(j.oid)):_=t.oidToDer(_));oe.value.push(t.create(t.Class.CONTEXT_SPECIFIC,j.type,!1,_))}se.value.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[oe])),P.push(se)}if(typeof m.value=="undefined"){var S=new Error("Extension value not specified.");throw S.extension=m,S}return m}function p(m,g){switch(m){case n["RSASSA-PSS"]:var S=[];return g.hash.algorithmOid!==void 0&&S.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(g.hash.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])])),g.mgf.algorithmOid!==void 0&&S.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(g.mgf.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(g.mgf.hash.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])])])),g.saltLength!==void 0&&S.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(g.saltLength).getBytes())])),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,S);default:return t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")}}function y(m){var g=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[]);if(m.attributes.length===0)return g;for(var S=m.attributes,d=0;d<S.length;++d){var b=S[d],E=b.value,_=t.Type.UTF8;"valueTagClass"in b&&(_=b.valueTagClass),_===t.Type.UTF8&&(E=G.util.encodeUtf8(E));var P=!1;"valueConstructed"in b&&(P=b.valueConstructed);var M=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(b.type).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,_,P,E)])]);g.value.push(M)}return g}var v=new Date("1950-01-01T00:00:00Z"),O=new Date("2050-01-01T00:00:00Z");function R(m){return m>=v&&m<O?t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(m)):t.create(t.Class.UNIVERSAL,t.Type.GENERALIZEDTIME,!1,t.dateToGeneralizedTime(m))}r.getTBSCertificate=function(m){var g=R(m.validity.notBefore),S=R(m.validity.notAfter),d=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(m.version).getBytes())]),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,G.util.hexToBytes(m.serialNumber)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(m.siginfo.algorithmOid).getBytes()),p(m.siginfo.algorithmOid,m.siginfo.parameters)]),w(m.issuer),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[g,S]),w(m.subject),r.publicKeyToAsn1(m.publicKey)]);return m.issuer.uniqueId&&d.value.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+m.issuer.uniqueId)])),m.subject.uniqueId&&d.value.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!0,[t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+m.subject.uniqueId)])),m.extensions.length>0&&d.value.push(r.certificateExtensionsToAsn1(m.extensions)),d},r.getCertificationRequestInfo=function(m){var g=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(m.version).getBytes()),w(m.subject),r.publicKeyToAsn1(m.publicKey),y(m)]);return g},r.distinguishedNameToAsn1=function(m){return w(m)},r.certificateToAsn1=function(m){var g=m.tbsCertificate||r.getTBSCertificate(m);return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[g,t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(m.signatureOid).getBytes()),p(m.signatureOid,m.signatureParameters)]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+m.signature)])},r.certificateExtensionsToAsn1=function(m){var g=t.create(t.Class.CONTEXT_SPECIFIC,3,!0,[]),S=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);g.value.push(S);for(var d=0;d<m.length;++d)S.value.push(r.certificateExtensionToAsn1(m[d]));return g},r.certificateExtensionToAsn1=function(m){var g=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);g.value.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(m.id).getBytes())),m.critical&&g.value.push(t.create(t.Class.UNIVERSAL,t.Type.BOOLEAN,!1,String.fromCharCode(255)));var S=m.value;return typeof m.value!="string"&&(S=t.toDer(S).getBytes()),g.value.push(t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,S)),g},r.certificationRequestToAsn1=function(m){var g=m.certificationRequestInfo||r.getCertificationRequestInfo(m);return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[g,t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(m.signatureOid).getBytes()),p(m.signatureOid,m.signatureParameters)]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+m.signature)])},r.createCaStore=function(m){var g={certs:{}};g.getIssuer=function(_){var P=S(_.issuer);return P},g.addCertificate=function(_){if(typeof _=="string"&&(_=G.pki.certificateFromPem(_)),d(_.subject),!g.hasCertificate(_))if(_.subject.hash in g.certs){var P=g.certs[_.subject.hash];G.util.isArray(P)||(P=[P]),P.push(_),g.certs[_.subject.hash]=P}else g.certs[_.subject.hash]=_},g.hasCertificate=function(_){typeof _=="string"&&(_=G.pki.certificateFromPem(_));var P=S(_.subject);if(!P)return!1;G.util.isArray(P)||(P=[P]);for(var M=t.toDer(r.certificateToAsn1(_)).getBytes(),j=0;j<P.length;++j){var L=t.toDer(r.certificateToAsn1(P[j])).getBytes();if(M===L)return!0}return!1},g.listAllCertificates=function(){var _=[];for(var P in g.certs)if(g.certs.hasOwnProperty(P)){var M=g.certs[P];if(!G.util.isArray(M))_.push(M);else for(var j=0;j<M.length;++j)_.push(M[j])}return _},g.removeCertificate=function(_){var P;if(typeof _=="string"&&(_=G.pki.certificateFromPem(_)),d(_.subject),!g.hasCertificate(_))return null;var M=S(_.subject);if(!G.util.isArray(M))return P=g.certs[_.subject.hash],delete g.certs[_.subject.hash],P;for(var j=t.toDer(r.certificateToAsn1(_)).getBytes(),L=0;L<M.length;++L){var B=t.toDer(r.certificateToAsn1(M[L])).getBytes();j===B&&(P=M[L],M.splice(L,1))}return M.length===0&&delete g.certs[_.subject.hash],P};function S(_){return d(_),g.certs[_.hash]||null}function d(_){if(!_.hash){var P=G.md.sha1.create();_.attributes=r.RDNAttributesAsArray(w(_),P),_.hash=P.digest().toHex()}}if(m)for(var b=0;b<m.length;++b){var E=m[b];g.addCertificate(E)}return g},r.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},r.verifyCertificateChain=function(m,g,S){typeof S=="function"&&(S={verify:S}),S=S||{},g=g.slice(0);var d=g.slice(0),b=S.validityCheckDate;typeof b=="undefined"&&(b=new Date);var E=!0,_=null,P=0;do{var M=g.shift(),j=null,L=!1;if(b&&((b<M.validity.notBefore||b>M.validity.notAfter)&&(_={message:"Certificate is not valid yet or has expired.",error:r.certificateError.certificate_expired,notBefore:M.validity.notBefore,notAfter:M.validity.notAfter,now:b})),_===null){if(j=g[0]||m.getIssuer(M),j===null&&(M.isIssuer(M)&&(L=!0,j=M)),j){var B=j;G.util.isArray(B)||(B=[B]);for(var $=!1;!$&&B.length>0;){j=B.shift();try{$=j.verify(M)}catch(k){}}$||(_={message:"Certificate signature is invalid.",error:r.certificateError.bad_certificate})}_===null&&(!j||L)&&!m.hasCertificate(M)&&(_={message:"Certificate is not trusted.",error:r.certificateError.unknown_ca})}if(_===null&&j&&!M.isIssuer(j)&&(_={message:"Certificate issuer is invalid.",error:r.certificateError.bad_certificate}),_===null)for(var V={keyUsage:!0,basicConstraints:!0},W=0;_===null&&W<M.extensions.length;++W){var se=M.extensions[W];se.critical&&!(se.name in V)&&(_={message:"Certificate has an unsupported critical extension.",error:r.certificateError.unsupported_certificate})}if(_===null&&(!E||g.length===0&&(!j||L))){var oe=M.getExtension("basicConstraints"),Ee=M.getExtension("keyUsage");if(Ee!==null&&((!Ee.keyCertSign||oe===null)&&(_={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:r.certificateError.bad_certificate})),_===null&&oe!==null&&!oe.cA&&(_={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:r.certificateError.bad_certificate}),_===null&&Ee!==null&&"pathLenConstraint"in oe){var fe=P-1;fe>oe.pathLenConstraint&&(_={message:"Certificate basicConstraints pathLenConstraint violated.",error:r.certificateError.bad_certificate})}}var me=_===null?!0:_.error,pe=S.verify?S.verify(me,P,d):me;if(pe===!0)_=null;else throw me===!0&&(_={message:"The application rejected the certificate.",error:r.certificateError.bad_certificate}),(pe||pe===0)&&(typeof pe=="object"&&!G.util.isArray(pe)?(pe.message&&(_.message=pe.message),pe.error&&(_.error=pe.error)):typeof pe=="string"&&(_.error=pe)),_;E=!1,++P}while(g.length>0);return!0}}),$O=re(function(e){var t=G.asn1,r=e.exports=G.pkcs7=G.pkcs7||{};r.messageFromPem=function(f){var A=G.pem.decode(f)[0];if(A.type!=="PKCS7"){var p=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw p.headerType=A.type,p}if(A.procType&&A.procType.type==="ENCRYPTED")throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var y=t.fromDer(A.body);return r.messageFromAsn1(y)},r.messageToPem=function(f,A){var p={type:"PKCS7",body:t.toDer(f.toAsn1()).getBytes()};return G.pem.encode(p,{maxline:A})},r.messageFromAsn1=function(f){var A={},p=[];if(!t.validate(f,r.asn1.contentInfoValidator,A,p)){var y=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw y.errors=p,y}var v=t.derToOid(A.contentType),O;switch(v){case G.pki.oids.envelopedData:O=r.createEnvelopedData();break;case G.pki.oids.encryptedData:O=r.createEncryptedData();break;case G.pki.oids.signedData:O=r.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+v+" is not (yet) supported.")}return O.fromAsn1(A.content.value[0]),O},r.createSignedData=function(){var f=null;return f={type:G.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(y){if(h(f,y,r.asn1.signedDataValidator),f.certificates=[],f.crls=[],f.digestAlgorithmIdentifiers=[],f.contentInfo=null,f.signerInfos=[],f.rawCapture.certificates)for(var v=f.rawCapture.certificates.value,O=0;O<v.length;++O)f.certificates.push(G.pki.certificateFromAsn1(v[O]))},toAsn1:function(){f.contentInfo||f.sign();for(var y=[],v=0;v<f.certificates.length;++v)y.push(G.pki.certificateToAsn1(f.certificates[v]));var O=[],R=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(f.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,f.digestAlgorithmIdentifiers),f.contentInfo])]);return y.length>0&&R.value[0].value.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,y)),O.length>0&&R.value[0].value.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,O)),R.value[0].value.push(t.create(t.Class.UNIVERSAL,t.Type.SET,!0,f.signerInfos)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.type).getBytes()),R])},addSigner:function(y){var v=y.issuer,O=y.serialNumber;if(y.certificate){var R=y.certificate;typeof R=="string"&&(R=G.pki.certificateFromPem(R)),v=R.issuer.attributes,O=R.serialNumber}var m=y.key;if(!m)throw new Error("Could not add PKCS#7 signer; no private key specified.");typeof m=="string"&&(m=G.pki.privateKeyFromPem(m));var g=y.digestAlgorithm||G.pki.oids.sha1;switch(g){case G.pki.oids.sha1:case G.pki.oids.sha256:case G.pki.oids.sha384:case G.pki.oids.sha512:case G.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+g)}var S=y.authenticatedAttributes||[];if(S.length>0){for(var d=!1,b=!1,E=0;E<S.length;++E){var _=S[E];if(!d&&_.type===G.pki.oids.contentType){if(d=!0,b)break;continue}if(!b&&_.type===G.pki.oids.messageDigest){if(b=!0,d)break;continue}}if(!d||!b)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}f.signers.push({key:m,version:1,issuer:v,serialNumber:O,digestAlgorithm:g,signatureAlgorithm:G.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:S,unauthenticatedAttributes:[]})},sign:function(y){if(y=y||{},(typeof f.content!="object"||f.contentInfo===null)&&(f.contentInfo=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(G.pki.oids.data).getBytes())]),"content"in f)){var v;f.content instanceof G.util.ByteBuffer?v=f.content.bytes():typeof f.content=="string"&&(v=G.util.encodeUtf8(f.content)),y.detached?f.detachedContent=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,v):f.contentInfo.value.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,v)]))}if(f.signers.length===0)return;var O=A();p(O)},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(y){typeof y=="string"&&(y=G.pki.certificateFromPem(y)),f.certificates.push(y)},addCertificateRevokationList:function(y){throw new Error("PKCS#7 CRL support not yet implemented.")}},f;function A(){for(var y={},v=0;v<f.signers.length;++v){var O=f.signers[v],R=O.digestAlgorithm;R in y||(y[R]=G.md[G.pki.oids[R]].create()),O.authenticatedAttributes.length===0?O.md=y[R]:O.md=G.md[G.pki.oids[R]].create()}f.digestAlgorithmIdentifiers=[];for(var R in y)f.digestAlgorithmIdentifiers.push(t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(R).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]));return y}function p(y){var v;if(f.detachedContent?v=f.detachedContent:(v=f.contentInfo.value[1],v=v.value[0]),!v)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var O=t.derToOid(f.contentInfo.value[0].value),R=t.toDer(v);R.getByte(),t.getBerValueLength(R),R=R.getBytes();for(var m in y)y[m].start().update(R);for(var g=new Date,S=0;S<f.signers.length;++S){var d=f.signers[S];if(d.authenticatedAttributes.length===0){if(O!==G.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{d.authenticatedAttributesAsn1=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var b=t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[]),E=0;E<d.authenticatedAttributes.length;++E){var _=d.authenticatedAttributes[E];_.type===G.pki.oids.messageDigest?_.value=y[d.digestAlgorithm].digest():_.type===G.pki.oids.signingTime&&(_.value||(_.value=g)),b.value.push(u(_)),d.authenticatedAttributesAsn1.value.push(u(_))}R=t.toDer(b).getBytes(),d.md.start().update(R)}d.signature=d.key.sign(d.md,"RSASSA-PKCS1-V1_5")}f.signerInfos=o(f.signers)}},r.createEncryptedData=function(){var f=null;return f={type:G.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:G.pki.oids["aes256-CBC"]},fromAsn1:function(A){h(f,A,r.asn1.encryptedDataValidator)},decrypt:function(A){A!==void 0&&(f.encryptedContent.key=A),w(f)}},f},r.createEnvelopedData=function(){var f=null;return f={type:G.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:G.pki.oids["aes256-CBC"]},fromAsn1:function(A){var p=h(f,A,r.asn1.envelopedDataValidator);f.recipients=a(p.recipientInfos.value)},toAsn1:function(){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.type).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(f.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,s(f.recipients)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,l(f.encryptedContent))])])])},findRecipient:function(A){for(var p=A.issuer.attributes,y=0;y<f.recipients.length;++y){var v=f.recipients[y],O=v.issuer;if(v.serialNumber!==A.serialNumber)continue;if(O.length!==p.length)continue;for(var R=!0,m=0;m<p.length;++m)if(O[m].type!==p[m].type||O[m].value!==p[m].value){R=!1;break}if(R)return v}return null},decrypt:function(A,p){if(f.encryptedContent.key===void 0&&A!==void 0&&p!==void 0)switch(A.encryptedContent.algorithm){case G.pki.oids.rsaEncryption:case G.pki.oids.desCBC:var y=p.decrypt(A.encryptedContent.content);f.encryptedContent.key=G.util.createBuffer(y);break;default:throw new Error("Unsupported asymmetric cipher, OID "+A.encryptedContent.algorithm)}w(f)},addRecipient:function(A){f.recipients.push({version:0,issuer:A.issuer.attributes,serialNumber:A.serialNumber,encryptedContent:{algorithm:G.pki.oids.rsaEncryption,key:A.publicKey}})},encrypt:function(A,p){if(f.encryptedContent.content===void 0){p=p||f.encryptedContent.algorithm,A=A||f.encryptedContent.key;var y,v,O;switch(p){case G.pki.oids["aes128-CBC"]:y=16,v=16,O=G.aes.createEncryptionCipher;break;case G.pki.oids["aes192-CBC"]:y=24,v=16,O=G.aes.createEncryptionCipher;break;case G.pki.oids["aes256-CBC"]:y=32,v=16,O=G.aes.createEncryptionCipher;break;case G.pki.oids["des-EDE3-CBC"]:y=24,v=8,O=G.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+p)}if(A===void 0)A=G.util.createBuffer(G.random.getBytes(y));else if(A.length()!=y)throw new Error("Symmetric key has wrong length; got "+A.length()+" bytes, expected "+y+".");f.encryptedContent.algorithm=p,f.encryptedContent.key=A,f.encryptedContent.parameter=G.util.createBuffer(G.random.getBytes(v));var R=O(A);if(R.start(f.encryptedContent.parameter.copy()),R.update(f.content),!R.finish())throw new Error("Symmetric encryption failed.");f.encryptedContent.content=R.output}for(var m=0;m<f.recipients.length;++m){var g=f.recipients[m];if(g.encryptedContent.content!==void 0)continue;switch(g.encryptedContent.algorithm){case G.pki.oids.rsaEncryption:g.encryptedContent.content=g.encryptedContent.key.encrypt(f.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+g.encryptedContent.algorithm)}}}},f};function n(f){var A={},p=[];if(!t.validate(f,r.asn1.recipientInfoValidator,A,p)){var y=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw y.errors=p,y}return{version:A.version.charCodeAt(0),issuer:G.pki.RDNAttributesAsArray(A.issuer),serialNumber:G.util.createBuffer(A.serial).toHex(),encryptedContent:{algorithm:t.derToOid(A.encAlgorithm),parameter:A.encParameter.value,content:A.encKey}}}function i(f){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(f.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[G.pki.distinguishedNameToAsn1({attributes:f.issuer}),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,G.util.hexToBytes(f.serialNumber))]),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.encryptedContent.algorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,f.encryptedContent.content)])}function a(f){for(var A=[],p=0;p<f.length;++p)A.push(n(f[p]));return A}function s(f){for(var A=[],p=0;p<f.length;++p)A.push(i(f[p]));return A}function c(f){var A=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(f.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[G.pki.distinguishedNameToAsn1({attributes:f.issuer}),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,G.util.hexToBytes(f.serialNumber))]),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.digestAlgorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])]);if(f.authenticatedAttributesAsn1&&A.value.push(f.authenticatedAttributesAsn1),A.value.push(t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.signatureAlgorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])),A.value.push(t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,f.signature)),f.unauthenticatedAttributes.length>0){for(var p=t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[]),y=0;y<f.unauthenticatedAttributes.length;++y){var v=f.unauthenticatedAttributes[y];p.values.push(u(v))}A.value.push(p)}return A}function o(f){for(var A=[],p=0;p<f.length;++p)A.push(c(f[p]));return A}function u(f){var A;if(f.type===G.pki.oids.contentType)A=t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.value).getBytes());else if(f.type===G.pki.oids.messageDigest)A=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,f.value.bytes());else if(f.type===G.pki.oids.signingTime){var p=new Date("1950-01-01T00:00:00Z"),y=new Date("2050-01-01T00:00:00Z"),v=f.value;if(typeof v=="string"){var O=Date.parse(v);isNaN(O)?v.length===13?v=t.utcTimeToDate(v):v=t.generalizedTimeToDate(v):v=new Date(O)}v>=p&&v<y?A=t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(v)):A=t.create(t.Class.UNIVERSAL,t.Type.GENERALIZEDTIME,!1,t.dateToGeneralizedTime(v))}return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.type).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[A])])}function l(f){return[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(G.pki.oids.data).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.algorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,f.parameter.getBytes())]),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,f.content.getBytes())])]}function h(f,A,p){var y={},v=[];if(!t.validate(A,p,y,v)){var O=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw O.errors=O,O}var R=t.derToOid(y.contentType);if(R!==G.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(y.encryptedContent){var m="";if(G.util.isArray(y.encryptedContent))for(var g=0;g<y.encryptedContent.length;++g){if(y.encryptedContent[g].type!==t.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");m+=y.encryptedContent[g].value}else m=y.encryptedContent;f.encryptedContent={algorithm:t.derToOid(y.encAlgorithm),parameter:G.util.createBuffer(y.encParameter.value),content:G.util.createBuffer(m)}}if(y.content){var m="";if(G.util.isArray(y.content))for(var g=0;g<y.content.length;++g){if(y.content[g].type!==t.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");m+=y.content[g].value}else m=y.content;f.content=G.util.createBuffer(m)}return f.version=y.version.charCodeAt(0),f.rawCapture=y,y}function w(f){if(f.encryptedContent.key===void 0)throw new Error("Symmetric key not available.");if(f.content===void 0){var A;switch(f.encryptedContent.algorithm){case G.pki.oids["aes128-CBC"]:case G.pki.oids["aes192-CBC"]:case G.pki.oids["aes256-CBC"]:A=G.aes.createDecryptionCipher(f.encryptedContent.key);break;case G.pki.oids.desCBC:case G.pki.oids["des-EDE3-CBC"]:A=G.des.createDecryptionCipher(f.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+f.encryptedContent.algorithm)}if(A.start(f.encryptedContent.parameter),A.update(f.encryptedContent.content),!A.finish())throw new Error("Symmetric decryption failed.");f.content=A.output}}}),kw=re(function(e,t){const r=G.pki;t=e.exports,t.certificateForKey=(i,a)=>{const s=r.setRsaPublicKey(a.n,a.e),c=r.createCertificate();c.publicKey=s,c.serialNumber="01",c.validity.notBefore=new Date,c.validity.notAfter=new Date,c.validity.notAfter.setFullYear(c.validity.notBefore.getFullYear()+10);const o=[{name:"organizationName",value:"ipfs"},{shortName:"OU",value:"keystore"},{name:"commonName",value:i.id}];return c.setSubject(o),c.setIssuer(o),c.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"extKeyUsage",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:"nsCertType",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),c.sign(a),c};async function n(i,a){const s=i.map(a),c=await Promise.all(s),o=c.findIndex(u=>u);return i[o]}e.exports.findAsync=n});const{certificateForKey:Rw,findAsync:Pw}=kw;class Nw{constructor(e){if(!e)throw U(new Error("keychain is required"),"ERR_KEYCHAIN_REQUIRED");this.keychain=e}async encrypt(e,t){if(!(t instanceof Uint8Array))throw U(new Error("Plain data must be a Uint8Array"),"ERR_INVALID_PARAMS");const r=await this.keychain.findKeyByName(e),n=await this.keychain._getPrivateKey(e),i=G.pki.decryptRsaPrivateKey(n,this.keychain._()),a=await Rw(r,i),s=G.pkcs7.createEnvelopedData();s.addRecipient(a),s.content=G.util.createBuffer(t),s.encrypt();const c=G.asn1.toDer(s.toAsn1()).getBytes();return at(c,"ascii")}async decrypt(e){if(!(e instanceof Uint8Array))throw U(new Error("CMS data is required"),"ERR_INVALID_PARAMS");let t;try{const c=G.util.createBuffer(De(e,"ascii")),o=G.asn1.fromDer(c);t=G.pkcs7.messageFromAsn1(o)}catch(c){throw U(new Error("Invalid CMS: "+c.message),"ERR_INVALID_CMS")}const r=t.recipients.filter(c=>c.issuer.find(o=>o.shortName==="O"&&o.value==="ipfs")).filter(c=>c.issuer.find(o=>o.shortName==="CN")).map(c=>({recipient:c,keyId:c.issuer.find(o=>o.shortName==="CN").value})),n=await Pw(r,async c=>{try{const o=await this.keychain.findKeyById(c.keyId);if(o)return!0}catch(o){return!1}return!1});if(!n){const c=r.map(o=>o.keyId);throw U(new Error("Decryption needs one of the key(s): "+c.join(", ")),"ERR_MISSING_KEYS",{missingKeys:c})}const i=await this.keychain.findKeyById(n.keyId),a=await this.keychain._getPrivateKey(i.name),s=G.pki.decryptRsaPrivateKey(a,this.keychain._());return t.decrypt(n.recipient,s),at(t.content.getBytes(),"ascii")}}var Ow=Nw;const{Number:Dw}=jn,Mw="/pkcs8/",Rh="/info/",Fi={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},bu={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function $n(e){return e?typeof e!="string"?!1:e===Mv(e.trim()):!1}async function Ke(e){const t=200,r=1e3,n=Math.random()*(r-t)+t;throw await new Promise(i=>setTimeout(i,n)),e}function fi(e){return new Ea.Key(Mw+e)}function qi(e){return new Ea.Key(Rh+e)}class xw{constructor(e,t){if(!e)throw new Error("store is required");if(this.store=e,this.opts=go(bu,t),this.opts.passPhrase&&this.opts.passPhrase.length<20)throw new Error("passPhrase must be least 20 characters");if(this.opts.dek.keyLength<Fi.minKeyLength)throw new Error(`dek.keyLength must be least ${Fi.minKeyLength} bytes`);if(this.opts.dek.salt.length<Fi.minSaltLength)throw new Error(`dek.saltLength must be least ${Fi.minSaltLength} bytes`);if(this.opts.dek.iterationCount<Fi.minIterationCount)throw new Error(`dek.iterationCount must be least ${Fi.minIterationCount}`);const r=this.opts.passPhrase?sr.pbkdf2(this.opts.passPhrase,this.opts.dek.salt,this.opts.dek.iterationCount,this.opts.dek.keyLength,this.opts.dek.hash):"";Object.defineProperty(this,"_",{value:()=>r})}get cms(){return new Ow(this)}static generateOptions(){const e=Object.assign({},bu),t=Math.ceil(Fi.minSaltLength/3)*3;return e.dek.salt=De(sr.randomBytes(t),"base64"),e}static get options(){return bu}async createKey(e,t,r){const n=this;if(!$n(e)||e==="self")return Ke(U(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));if(typeof t!="string")return Ke(U(new Error(`Invalid key type '${t}'`),"ERR_INVALID_KEY_TYPE"));const i=fi(e),a=await n.store.has(i);if(a)return Ke(U(new Error(`Key '${e}' already exists`),"ERR_KEY_ALREADY_EXISTS"));switch(t.toLowerCase()){case"rsa":if(!Dw.isSafeInteger(r)||r<2048)return Ke(U(new Error(`Invalid RSA key size ${r}`),"ERR_INVALID_KEY_SIZE"));break}let s;try{const c=await sr.keys.generateKeyPair(t,r),o=await c.id(),u=await c.export(this._());s={name:e,id:o};const l=n.store.batch();l.put(i,at(u)),l.put(qi(e),at(JSON.stringify(s))),await l.commit()}catch(c){return Ke(c)}return s}async listKeys(){const e=this,t={prefix:Rh},r=[];for await(const n of e.store.query(t))r.push(JSON.parse(De(n.value)));return r}async findKeyById(e){try{const t=await this.listKeys();return t.find(r=>r.id===e)}catch(t){return Ke(t)}}async findKeyByName(e){if(!$n(e))return Ke(U(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));const t=qi(e);try{const r=await this.store.get(t);return JSON.parse(De(r))}catch(r){return Ke(U(new Error(`Key '${e}' does not exist. ${r.message}`),"ERR_KEY_NOT_FOUND"))}}async removeKey(e){const t=this;if(!$n(e)||e==="self")return Ke(U(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));const r=fi(e),n=await t.findKeyByName(e),i=t.store.batch();return i.delete(r),i.delete(qi(e)),await i.commit(),n}async renameKey(e,t){const r=this;if(!$n(e)||e==="self")return Ke(U(new Error(`Invalid old key name '${e}'`),"ERR_OLD_KEY_NAME_INVALID"));if(!$n(t)||t==="self")return Ke(U(new Error(`Invalid new key name '${t}'`),"ERR_NEW_KEY_NAME_INVALID"));const n=fi(e),i=fi(t),a=qi(e),s=qi(t),c=await r.store.has(i);if(c)return Ke(U(new Error(`Key '${t}' already exists`),"ERR_KEY_ALREADY_EXISTS"));try{const o=await r.store.get(n),u=await r.store.get(a),l=JSON.parse(De(u));l.name=t;const h=r.store.batch();return h.put(i,o),h.put(s,at(JSON.stringify(l))),h.delete(n),h.delete(a),await h.commit(),l}catch(o){return Ke(o)}}async exportKey(e,t){if(!$n(e))return Ke(U(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));if(!t)return Ke(U(new Error("Password is required"),"ERR_PASSWORD_REQUIRED"));const r=fi(e);try{const n=await this.store.get(r),i=De(n),a=await sr.keys.import(i,this._());return a.export(t)}catch(n){return Ke(n)}}async importKey(e,t,r){const n=this;if(!$n(e)||e==="self")return Ke(U(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));if(!t)return Ke(U(new Error("PEM encoded key is required"),"ERR_PEM_REQUIRED"));const i=fi(e),a=await n.store.has(i);if(a)return Ke(U(new Error(`Key '${e}' already exists`),"ERR_KEY_ALREADY_EXISTS"));let s;try{s=await sr.keys.import(t,r)}catch(l){return Ke(U(new Error("Cannot read the key, most likely the password is wrong"),"ERR_CANNOT_READ_KEY"))}let c;try{c=await s.id(),t=await s.export(this._())}catch(l){return Ke(l)}const o={name:e,id:c},u=n.store.batch();return u.put(i,at(t)),u.put(qi(e),at(JSON.stringify(o))),await u.commit(),o}async importPeer(e,t){const r=this;if(!$n(e))return Ke(U(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));if(!t||!t.privKey)return Ke(U(new Error("Peer.privKey is required"),"ERR_MISSING_PRIVATE_KEY"));const n=t.privKey,i=fi(e),a=await r.store.has(i);if(a)return Ke(U(new Error(`Key '${e}' already exists`),"ERR_KEY_ALREADY_EXISTS"));try{const s=await n.id(),c=await n.export(this._()),o={name:e,id:s},u=r.store.batch();return u.put(i,at(c)),u.put(qi(e),at(JSON.stringify(o))),await u.commit(),o}catch(s){return Ke(s)}}async _getPrivateKey(e){if(!$n(e))return Ke(U(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));try{const t=fi(e),r=await this.store.get(t);return De(r)}catch(t){return Ke(U(new Error(`Key '${e}' does not exist. ${t.message}`),"ERR_KEY_NOT_FOUND"))}}}var Ph=xw;async function*Bw(e,t){let r=[];for await(const n of t)r.push(n),r.length===e&&(yield r,r=[]);r.length>0&&(yield r)}function*Lw(e,t){let r=[];for(const n of t)r.push(n),r.length===e&&(yield r,r=[]);r.length>0&&(yield r)}function Nh(e,t){return t===void 0?r=>Nh(e,r):t[Symbol.asyncIterator]?Bw(e,t):Lw(e,t)}function Gi(e){if(typeof e.next=="function")return e;if(typeof e[Symbol.iterator]=="function")return e[Symbol.iterator]();if(typeof e[Symbol.asyncIterator]=="function")return e[Symbol.asyncIterator]();throw new TypeError('"values" does not to conform to any of the iterator or iterable protocols')}function vu(){let e,t;const r=new Promise((n,i)=>{t=n,e=i});return{promise:r,reject:e,resolve:t}}function jw(e,t){const r=Gi(t),n=[],i=[];let a=!1,s=!1;function c(){for(;i.length>0&&n.length>0;){const h=i.shift(),{error:w,value:f}=n.shift();w?h.reject(w):h.resolve({done:!1,value:f})}for(;i.length>0&&s;){const{resolve:h}=i.shift();h({done:!0,value:void 0})}}async function o(){if(s)return;if(a)return;if(n.length>=e)return;a=!0;try{const{done:h,value:w}=await r.next();h?s=!0:n.push({value:w})}catch(h){s=!0,n.push({error:h})}c(),a=!1,o()}async function u(){if(n.length>0){const{error:w,value:f}=n.shift();if(w)throw w;return o(),{done:!1,value:f}}if(s)return{done:!0,value:void 0};const h=vu();return i.push(h),o(),h.promise}const l={next:u,[Symbol.asyncIterator]:()=>l};return l}function*Uw(e,t){const r=[];let n;try{for(const i of t){if(r.push(i),r.length<=e)continue;yield r.shift()}}catch(i){n=i}for(const i of r)yield i;if(n)throw n}function _o(e,t){return t===void 0?r=>_o(e,r):e===0?t:t[Symbol.asyncIterator]?jw(e,t):Uw(e,t)}async function Fw(e){const t=[];for await(const r of e)t.push(r);return t}function qw(e){return e[Symbol.asyncIterator]?Fw(e):Array.from(e)}async function*Gw(e){for await(const t of e)yield*t}function*$w(e){for(const t of e)yield*t}function Vw(...e){const t=e.find(r=>r[Symbol.asyncIterator]!==void 0);return t?Gw(e):$w(e)}async function Hw(e){for await(const t of e);}function zw(e){if(e[Symbol.asyncIterator])return Hw(e);for(const t of e);}async function*Oh(e,t){for await(const r of t)await e(r)&&(yield r)}function Eo(e,t){return t===void 0?r=>Oh(e,r):Oh(e,t)}async function*ys(e){for await(const t of e)t&&typeof t!="string"&&(t[Symbol.iterator]||t[Symbol.asyncIterator])?yield*ys(t):yield t}async function*Dh(e,t){for await(const r of t)yield await e(r)}function So(e,t){return t===void 0?r=>Dh(e,r):Dh(e,t)}function Mh(e,t){return t===void 0?r=>Mh(e,r):Eo(r=>r!=null,ys(So(e,t)))}function Kw(e,t,r){const n=Gi(r),i=[],a=[];let s=!1,c=!1,o=0,u=null;function l(){for(;a.length>0&&i.length>0;){const{resolve:p}=a.shift(),y=i.shift();p({done:!1,value:y})}for(;a.length>0&&o===0&&s;){const{resolve:p,reject:y}=a.shift();u?(y(u),u=null):p({done:!0,value:void 0})}}async function h(){if(s){l();return}if(c)return;if(o+i.length>=e)return;c=!0,o++;try{const{done:p,value:y}=await n.next();p?(s=!0,o--,l()):w(y)}catch(p){s=!0,o--,u=p,l()}c=!1,h()}async function w(p){try{const y=await t(p);if(y&&y[Symbol.asyncIterator])for await(const v of y)i.push(v);else i.push(y)}catch(y){s=!0,u=y}o--,l(),h()}async function f(){if(i.length===0){const y=vu();return a.push(y),h(),y.promise}const p=i.shift();return h(),{done:!1,value:p}}const A={next:f,[Symbol.asyncIterator]:()=>A};return A}function Ao(e,t,r){return t===void 0?(n,i)=>i?Ao(e,n,i):Ao(e,n):r===void 0?n=>Ao(e,t,n):Eo(n=>n!=null,ys(Kw(e,t,r)))}async function Ww(e){return new Promise(t=>{e.once("readable",()=>{t()})})}async function*Xw(e){for(;;){const t=e.read();if(t!==null){yield t;continue}if(e._readableState.ended)break;await Ww(e)}}function Qw(e){return typeof e[Symbol.asyncIterator]=="function"?e:Xw(e)}async function*Yw(...e){const t=new Set(e.map(Gi));for(;t.size>0;)for(const r of t){const n=await r.next();n.done?t.delete(r):yield n.value}}function xh(e,...t){let r=e();for(const n of t)r=n(r);return r}async function*Jw(e,t,r){let n=null;const i=o=>({value:t(o)}),a=async function*(o){for await(const u of o){if(n)return;yield u}},s=xh(()=>r,_o(1),a,So(i),_o(e-1)),c=Gi(s);for(;;){const{value:o,done:u}=await c.next();if(u)break;try{const l=await o.value;n||(yield l)}catch(l){n=l}}if(n)throw n}function To(e,t,r){return t===void 0?(n,i)=>To(e,n,i):r===void 0?n=>To(e,t,n):e===1?So(t,r):Jw(e,t,r)}function Io(e,t,r){return t===void 0?(n,i)=>i?Io(e,n,i):Io(e,n):r===void 0?n=>Io(e,t,n):Eo(n=>n!=null,ys(To(e,t,r)))}async function*Zw(...e){const t=e.map(Gi),r=new Set,n=new Map;let i=null,a=null,s=null;const c=h=>{i=h,a&&a(h)},o=h=>{s&&s(h)},u=()=>new Promise((h,w)=>{if(i&&w(i),n.size>0)return h();s=h,a=w}),l=h=>{const w=Promise.resolve(h.next()).then(async({done:f,value:A})=>{f||n.set(h,A),r.delete(w)});r.add(w),w.then(o,c)};for(const h of t)l(h);for(;;){if(r.size===0&&n.size===0)return;await u();for(const[h,w]of n)n.delete(h),yield w,l(h)}}async function Bh(e,t,r){let n=t;for await(const i of r)n=await e(n,i);return n}function wu(e,t,r){return t===void 0?(n,i)=>i?Bh(e,n,i):wu(e,n):r===void 0?n=>wu(e,t,n):Bh(e,t,r)}async function*e0(e,t){let r=0;for await(const n of t)if(yield await n,r++,r>=e)break}function*t0(e,t){let r=0;for(const n of t)if(yield n,r++,r>=e)break}function Lh(e,t){return t===void 0?r=>Lh(e,r):t[Symbol.asyncIterator]?e0(e,t):t0(e,t)}async function*jh(e,t){for await(const r of t)await e(r),yield r}function r0(e,t){return t===void 0?r=>jh(e,r):jh(e,t)}function Uh(e,t){let r=e[0]+t[0],n=e[1]+t[1];if(n>=1e9){const i=n%1e9;r+=(n-i)/1e9,n=i}return[r,n]}async function*n0(e,t){const r=t[Symbol.asyncIterator]();let n=[0,0];for(;;){const i=_e.hrtime(),{value:a,done:s}=await r.next(),c=_e.hrtime(i);if(n=Uh(n,c),e.progress&&e.progress(c,n),s)return e.total&&e.total(n),a;yield a}}function*i0(e,t){const r=t[Symbol.iterator]();let n=[0,0];for(;;){const i=_e.hrtime(),{value:a,done:s}=r.next(),c=_e.hrtime(i);if(n=Uh(n,c),e.progress&&e.progress(c,n),s)return e.total&&e.total(n),a;yield a}}function Fh(e={},t){return t===void 0?r=>Fh(e,r):t[Symbol.asyncIterator]!==void 0?n0(e,t):i0(e,t)}function a0(e,t,r){const n=Gi(r),i=[],a=[];let s=!1,c=!1,o=0,u=null;function l(){for(;a.length>0&&i.length>0;){const{resolve:p}=a.shift(),y=i.shift();p({done:!1,value:y})}for(;a.length>0&&o===0&&s;){const{resolve:p,reject:y}=a.shift();u?(y(u),u=null):p({done:!0,value:void 0})}}async function h(){if(s){l();return}if(c)return;if(o+i.length>=e)return;c=!0,o++;try{const{done:p,value:y}=await n.next();p?(s=!0,o--,l()):w(y)}catch(p){s=!0,o--,u=p,l()}c=!1,h()}async function w(p){try{const y=await t(p);i.push(y)}catch(y){s=!0,u=y}o--,l(),h()}async function f(){if(i.length===0){const y=vu();return a.push(y),h(),y.promise}const p=i.shift();return h(),{done:!1,value:p}}const A={next:f,[Symbol.asyncIterator]:()=>A};return A}function Co(e,t,r){return t===void 0?(n,i)=>i?Co(e,n,i):Co(e,n):r===void 0?n=>Co(e,t,n):a0(e,t,r)}async function qh(e,t){let r=null,n=null,i=null;const a=u=>{r=u,n&&n(u)},s=()=>{i&&i()},c=()=>{e.removeListener("error",a),e.removeListener("drain",s)};e.once("error",a);const o=()=>new Promise((u,l)=>{if(r)return l(r);e.once("drain",s),i=u,n=l});for await(const u of t)if(e.write(u)===!1&&await o(),r)break;if(c(),r)throw r}function s0(e,t){return t===void 0?r=>qh(e,r):qh(e,t)}var o0=Object.freeze({__proto__:null,batch:Nh,buffer:_o,collect:qw,concat:Vw,consume:zw,filter:Eo,flatMap:Mh,flatTransform:Ao,flatten:ys,fromStream:Qw,getIterator:Gi,map:So,merge:Yw,parallelFlatMap:Io,parallelMap:To,parallelMerge:Zw,pipeline:xh,reduce:wu,take:Lh,tap:r0,time:Fh,transform:Co,writeToStream:s0}),Gh=function(e){if(!e)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,r=Object.create(null),n=Object.create(null);function i(a,s){r[a]=s,t++,t>=e&&(t=0,n=r,r=Object.create(null))}return{has:function(a){return r[a]!==void 0||n[a]!==void 0},remove:function(a){r[a]!==void 0&&(r[a]=void 0),n[a]!==void 0&&(n[a]=void 0)},get:function(a){var s=r[a];if(s!==void 0)return s;if((s=n[a])!==void 0)return i(a,s),s},set:function(a,s){r[a]!==void 0?r[a]=s:i(a,s)},clear:function(){r=Object.create(null),n=Object.create(null)}}},c0=e=>{const t=Gh(e);return t.delete=t.remove,t},u0=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,_u=Math.ceil,Cn=Math.floor,or="[BigNumber Error] ",$h=or+"Number primitive has more than 15 significant digits: ",rn=1e14,Ae=14,Eu=9007199254740991,Su=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],mi=1e7,Tt=1e9;function Vh(e){var t,r,n,i=v.prototype={constructor:v,toString:null,valueOf:null},a=new v(1),s=20,c=4,o=-7,u=21,l=-1e7,h=1e7,w=!1,f=1,A=0,p={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},y="0123456789abcdefghijklmnopqrstuvwxyz";function v(d,b){var E,_,P,M,j,L,B,$,V=this;if(!(V instanceof v))return new v(d,b);if(b==null){if(d&&d._isBigNumber===!0){V.s=d.s,!d.c||d.e>h?V.c=V.e=null:d.e<l?V.c=[V.e=0]:(V.e=d.e,V.c=d.c.slice());return}if((L=typeof d=="number")&&d*0==0){if(V.s=1/d<0?(d=-d,-1):1,d===~~d){for(M=0,j=d;j>=10;j/=10,M++);M>h?V.c=V.e=null:(V.e=M,V.c=[d]);return}$=String(d)}else{if(!u0.test($=String(d)))return n(V,$,L);V.s=$.charCodeAt(0)==45?($=$.slice(1),-1):1}(M=$.indexOf("."))>-1&&($=$.replace(".","")),(j=$.search(/e/i))>0?(M<0&&(M=j),M+=+$.slice(j+1),$=$.substring(0,j)):M<0&&(M=$.length)}else{if(et(b,2,y.length,"Base"),b==10)return V=new v(d),g(V,s+V.e+1,c);if($=String(d),L=typeof d=="number"){if(d*0!=0)return n(V,$,L,b);if(V.s=1/d<0?($=$.slice(1),-1):1,v.DEBUG&&$.replace(/^0\.0*|\./,"").length>15)throw Error($h+d)}else V.s=$.charCodeAt(0)===45?($=$.slice(1),-1):1;for(E=y.slice(0,b),M=j=0,B=$.length;j<B;j++)if(E.indexOf(_=$.charAt(j))<0){if(_=="."){if(j>M){M=B;continue}}else if(!P&&($==$.toUpperCase()&&($=$.toLowerCase())||$==$.toLowerCase()&&($=$.toUpperCase()))){P=!0,j=-1,M=0;continue}return n(V,String(d),L,b)}L=!1,$=r($,b,10,V.s),(M=$.indexOf("."))>-1?$=$.replace(".",""):M=$.length}for(j=0;$.charCodeAt(j)===48;j++);for(B=$.length;$.charCodeAt(--B)===48;);if($=$.slice(j,++B)){if(B-=j,L&&v.DEBUG&&B>15&&(d>Eu||d!==Cn(d)))throw Error($h+V.s*d);if((M=M-j-1)>h)V.c=V.e=null;else if(M<l)V.c=[V.e=0];else{if(V.e=M,V.c=[],j=(M+1)%Ae,M<0&&(j+=Ae),j<B){for(j&&V.c.push(+$.slice(0,j)),B-=Ae;j<B;)V.c.push(+$.slice(j,j+=Ae));j=Ae-($=$.slice(j)).length}else j-=B;for(;j--;$+="0");V.c.push(+$)}}else V.c=[V.e=0]}v.clone=Vh,v.ROUND_UP=0,v.ROUND_DOWN=1,v.ROUND_CEIL=2,v.ROUND_FLOOR=3,v.ROUND_HALF_UP=4,v.ROUND_HALF_DOWN=5,v.ROUND_HALF_EVEN=6,v.ROUND_HALF_CEIL=7,v.ROUND_HALF_FLOOR=8,v.EUCLID=9,v.config=v.set=function(d){var b,E;if(d!=null)if(typeof d=="object"){if(d.hasOwnProperty(b="DECIMAL_PLACES")&&(E=d[b],et(E,0,Tt,b),s=E),d.hasOwnProperty(b="ROUNDING_MODE")&&(E=d[b],et(E,0,8,b),c=E),d.hasOwnProperty(b="EXPONENTIAL_AT")&&(E=d[b],E&&E.pop?(et(E[0],-Tt,0,b),et(E[1],0,Tt,b),o=E[0],u=E[1]):(et(E,-Tt,Tt,b),o=-(u=E<0?-E:E))),d.hasOwnProperty(b="RANGE"))if(E=d[b],E&&E.pop)et(E[0],-Tt,-1,b),et(E[1],1,Tt,b),l=E[0],h=E[1];else if(et(E,-Tt,Tt,b),E)l=-(h=E<0?-E:E);else throw Error(or+b+" cannot be zero: "+E);if(d.hasOwnProperty(b="CRYPTO"))if(E=d[b],E===!!E)if(E)if(typeof crypto!="undefined"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))w=E;else throw w=!E,Error(or+"crypto unavailable");else w=E;else throw Error(or+b+" not true or false: "+E);if(d.hasOwnProperty(b="MODULO_MODE")&&(E=d[b],et(E,0,9,b),f=E),d.hasOwnProperty(b="POW_PRECISION")&&(E=d[b],et(E,0,Tt,b),A=E),d.hasOwnProperty(b="FORMAT"))if(E=d[b],typeof E=="object")p=E;else throw Error(or+b+" not an object: "+E);if(d.hasOwnProperty(b="ALPHABET"))if(E=d[b],typeof E=="string"&&!/^.$|[+-.\s]|(.).*\1/.test(E))y=E;else throw Error(or+b+" invalid: "+E)}else throw Error(or+"Object expected: "+d);return{DECIMAL_PLACES:s,ROUNDING_MODE:c,EXPONENTIAL_AT:[o,u],RANGE:[l,h],CRYPTO:w,MODULO_MODE:f,POW_PRECISION:A,FORMAT:p,ALPHABET:y}},v.isBigNumber=function(d){if(!d||d._isBigNumber!==!0)return!1;if(!v.DEBUG)return!0;var b,E,_=d.c,P=d.e,M=d.s;e:if({}.toString.call(_)=="[object Array]"){if((M===1||M===-1)&&P>=-Tt&&P<=Tt&&P===Cn(P)){if(_[0]===0){if(P===0&&_.length===1)return!0;break e}if(b=(P+1)%Ae,b<1&&(b+=Ae),String(_[0]).length==b){for(b=0;b<_.length;b++)if(E=_[b],E<0||E>=rn||E!==Cn(E))break e;if(E!==0)return!0}}}else if(_===null&&P===null&&(M===null||M===1||M===-1))return!0;throw Error(or+"Invalid BigNumber: "+d)},v.maximum=v.max=function(){return R(arguments,i.lt)},v.minimum=v.min=function(){return R(arguments,i.gt)},v.random=function(){var d=9007199254740992,b=Math.random()*d&2097151?function(){return Cn(Math.random()*d)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(E){var _,P,M,j,L,B=0,$=[],V=new v(a);if(E==null?E=s:et(E,0,Tt),j=_u(E/Ae),w)if(crypto.getRandomValues){for(_=crypto.getRandomValues(new Uint32Array(j*=2));B<j;)L=_[B]*131072+(_[B+1]>>>11),L>=9e15?(P=crypto.getRandomValues(new Uint32Array(2)),_[B]=P[0],_[B+1]=P[1]):($.push(L%1e14),B+=2);B=j/2}else if(crypto.randomBytes){for(_=crypto.randomBytes(j*=7);B<j;)L=(_[B]&31)*281474976710656+_[B+1]*1099511627776+_[B+2]*4294967296+_[B+3]*16777216+(_[B+4]<<16)+(_[B+5]<<8)+_[B+6],L>=9e15?crypto.randomBytes(7).copy(_,B):($.push(L%1e14),B+=7);B=j/7}else throw w=!1,Error(or+"crypto unavailable");if(!w)for(;B<j;)L=b(),L<9e15&&($[B++]=L%1e14);for(j=$[--B],E%=Ae,j&&E&&(L=Su[Ae-E],$[B]=Cn(j/L)*L);$[B]===0;$.pop(),B--);if(B<0)$=[M=0];else{for(M=-1;$[0]===0;$.splice(0,1),M-=Ae);for(B=1,L=$[0];L>=10;L/=10,B++);B<Ae&&(M-=Ae-B)}return V.e=M,V.c=$,V}}(),v.sum=function(){for(var d=1,b=arguments,E=new v(b[0]);d<b.length;)E=E.plus(b[d++]);return E},r=function(){var d="0123456789";function b(E,_,P,M){for(var j,L=[0],B,$=0,V=E.length;$<V;){for(B=L.length;B--;L[B]*=_);for(L[0]+=M.indexOf(E.charAt($++)),j=0;j<L.length;j++)L[j]>P-1&&(L[j+1]==null&&(L[j+1]=0),L[j+1]+=L[j]/P|0,L[j]%=P)}return L.reverse()}return function(E,_,P,M,j){var L,B,$,V,W,se,oe,Ee,fe=E.indexOf("."),me=s,pe=c;for(fe>=0&&(V=A,A=0,E=E.replace(".",""),Ee=new v(_),se=Ee.pow(E.length-fe),A=V,Ee.c=b(Vn(xr(se.c),se.e,"0"),10,P,d),Ee.e=Ee.c.length),oe=b(E,_,P,j?(L=y,d):(L=d,y)),$=V=oe.length;oe[--V]==0;oe.pop());if(!oe[0])return L.charAt(0);if(fe<0?--$:(se.c=oe,se.e=$,se.s=M,se=t(se,Ee,me,pe,P),oe=se.c,W=se.r,$=se.e),B=$+me+1,fe=oe[B],V=P/2,W=W||B<0||oe[B+1]!=null,W=pe<4?(fe!=null||W)&&(pe==0||pe==(se.s<0?3:2)):fe>V||fe==V&&(pe==4||W||pe==6&&oe[B-1]&1||pe==(se.s<0?8:7)),B<1||!oe[0])E=W?Vn(L.charAt(1),-me,L.charAt(0)):L.charAt(0);else{if(oe.length=B,W)for(--P;++oe[--B]>P;)oe[B]=0,B||(++$,oe=[1].concat(oe));for(V=oe.length;!oe[--V];);for(fe=0,E="";fe<=V;E+=L.charAt(oe[fe++]));E=Vn(E,$,L.charAt(0))}return E}}(),t=function(){function d(_,P,M){var j,L,B,$,V=0,W=_.length,se=P%mi,oe=P/mi|0;for(_=_.slice();W--;)B=_[W]%mi,$=_[W]/mi|0,j=oe*B+$*se,L=se*B+j%mi*mi+V,V=(L/M|0)+(j/mi|0)+oe*$,_[W]=L%M;return V&&(_=[V].concat(_)),_}function b(_,P,M,j){var L,B;if(M!=j)B=M>j?1:-1;else for(L=B=0;L<M;L++)if(_[L]!=P[L]){B=_[L]>P[L]?1:-1;break}return B}function E(_,P,M,j){for(var L=0;M--;)_[M]-=L,L=_[M]<P[M]?1:0,_[M]=L*j+_[M]-P[M];for(;!_[0]&&_.length>1;_.splice(0,1));}return function(_,P,M,j,L){var B,$,V,W,se,oe,Ee,fe,me,pe,k,K,Q,Z,ie,ue,he,ce=_.s==P.s?1:-1,Te=_.c,J=P.c;if(!Te||!Te[0]||!J||!J[0])return new v(!_.s||!P.s||(Te?J&&Te[0]==J[0]:!J)?NaN:Te&&Te[0]==0||!J?ce*0:ce/0);for(fe=new v(ce),me=fe.c=[],$=_.e-P.e,ce=M+$+1,L||(L=rn,$=Mr(_.e/Ae)-Mr(P.e/Ae),ce=ce/Ae|0),V=0;J[V]==(Te[V]||0);V++);if(J[V]>(Te[V]||0)&&$--,ce<0)me.push(1),W=!0;else{for(Z=Te.length,ue=J.length,V=0,ce+=2,se=Cn(L/(J[0]+1)),se>1&&(J=d(J,se,L),Te=d(Te,se,L),ue=J.length,Z=Te.length),Q=ue,pe=Te.slice(0,ue),k=pe.length;k<ue;pe[k++]=0);he=J.slice(),he=[0].concat(he),ie=J[0],J[1]>=L/2&&ie++;do{if(se=0,B=b(J,pe,ue,k),B<0){if(K=pe[0],ue!=k&&(K=K*L+(pe[1]||0)),se=Cn(K/ie),se>1)for(se>=L&&(se=L-1),oe=d(J,se,L),Ee=oe.length,k=pe.length;b(oe,pe,Ee,k)==1;)se--,E(oe,ue<Ee?he:J,Ee,L),Ee=oe.length,B=1;else se==0&&(B=se=1),oe=J.slice(),Ee=oe.length;if(Ee<k&&(oe=[0].concat(oe)),E(pe,oe,k,L),k=pe.length,B==-1)for(;b(J,pe,ue,k)<1;)se++,E(pe,ue<k?he:J,k,L),k=pe.length}else B===0&&(se++,pe=[0]);me[V++]=se,pe[0]?pe[k++]=Te[Q]||0:(pe=[Te[Q]],k=1)}while((Q++<Z||pe[0]!=null)&&ce--);W=pe[0]!=null,me[0]||me.splice(0,1)}if(L==rn){for(V=1,ce=me[0];ce>=10;ce/=10,V++);g(fe,M+(fe.e=V+$*Ae-1)+1,j,W)}else fe.e=$,fe.r=+W;return fe}}();function O(d,b,E,_){var P,M,j,L,B;if(E==null?E=c:et(E,0,8),!d.c)return d.toString();if(P=d.c[0],j=d.e,b==null)B=xr(d.c),B=_==1||_==2&&(j<=o||j>=u)?Ro(B,j):Vn(B,j,"0");else if(d=g(new v(d),b,E),M=d.e,B=xr(d.c),L=B.length,_==1||_==2&&(b<=M||M<=o)){for(;L<b;B+="0",L++);B=Ro(B,M)}else if(b-=j,B=Vn(B,M,"0"),M+1>L){if(--b>0)for(B+=".";b--;B+="0");}else if(b+=M-L,b>0)for(M+1==L&&(B+=".");b--;B+="0");return d.s<0&&P?"-"+B:B}function R(d,b){for(var E,_=1,P=new v(d[0]);_<d.length;_++)if(E=new v(d[_]),E.s)b.call(P,E)&&(P=E);else{P=E;break}return P}function m(d,b,E){for(var _=1,P=b.length;!b[--P];b.pop());for(P=b[0];P>=10;P/=10,_++);return(E=_+E*Ae-1)>h?d.c=d.e=null:E<l?d.c=[d.e=0]:(d.e=E,d.c=b),d}n=function(){var d=/^(-?)0([xbo])(?=\w[\w.]*$)/i,b=/^([^.]+)\.$/,E=/^\.([^.]+)$/,_=/^-?(Infinity|NaN)$/,P=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(M,j,L,B){var $,V=L?j:j.replace(P,"");if(_.test(V))M.s=isNaN(V)?null:V<0?-1:1;else{if(!L&&(V=V.replace(d,function(W,se,oe){return $=(oe=oe.toLowerCase())=="x"?16:oe=="b"?2:8,!B||B==$?se:W}),B&&($=B,V=V.replace(b,"$1").replace(E,"0.$1")),j!=V))return new v(V,$);if(v.DEBUG)throw Error(or+"Not a"+(B?" base "+B:"")+" number: "+j);M.s=null}M.c=M.e=null}}();function g(d,b,E,_){var P,M,j,L,B,$,V,W=d.c,se=Su;if(W){e:{for(P=1,L=W[0];L>=10;L/=10,P++);if(M=b-P,M<0)M+=Ae,j=b,B=W[$=0],V=B/se[P-j-1]%10|0;else if($=_u((M+1)/Ae),$>=W.length)if(_){for(;W.length<=$;W.push(0));B=V=0,P=1,M%=Ae,j=M-Ae+1}else break e;else{for(B=L=W[$],P=1;L>=10;L/=10,P++);M%=Ae,j=M-Ae+P,V=j<0?0:B/se[P-j-1]%10|0}if(_=_||b<0||W[$+1]!=null||(j<0?B:B%se[P-j-1]),_=E<4?(V||_)&&(E==0||E==(d.s<0?3:2)):V>5||V==5&&(E==4||_||E==6&&(M>0?j>0?B/se[P-j]:0:W[$-1])%10&1||E==(d.s<0?8:7)),b<1||!W[0])return W.length=0,_?(b-=d.e+1,W[0]=se[(Ae-b%Ae)%Ae],d.e=-b||0):W[0]=d.e=0,d;if(M==0?(W.length=$,L=1,$--):(W.length=$+1,L=se[Ae-M],W[$]=j>0?Cn(B/se[P-j]%se[j])*L:0),_)for(;;)if($==0){for(M=1,j=W[0];j>=10;j/=10,M++);for(j=W[0]+=L,L=1;j>=10;j/=10,L++);M!=L&&(d.e++,W[0]==rn&&(W[0]=1));break}else{if(W[$]+=L,W[$]!=rn)break;W[$--]=0,L=1}for(M=W.length;W[--M]===0;W.pop());}d.e>h?d.c=d.e=null:d.e<l&&(d.c=[d.e=0])}return d}function S(d){var b,E=d.e;return E===null?d.toString():(b=xr(d.c),b=E<=o||E>=u?Ro(b,E):Vn(b,E,"0"),d.s<0?"-"+b:b)}return i.absoluteValue=i.abs=function(){var d=new v(this);return d.s<0&&(d.s=1),d},i.comparedTo=function(d,b){return Sa(this,new v(d,b))},i.decimalPlaces=i.dp=function(d,b){var E,_,P,M=this;if(d!=null)return et(d,0,Tt),b==null?b=c:et(b,0,8),g(new v(M),d+M.e+1,b);if(!(E=M.c))return null;if(_=((P=E.length-1)-Mr(this.e/Ae))*Ae,P=E[P])for(;P%10==0;P/=10,_--);return _<0&&(_=0),_},i.dividedBy=i.div=function(d,b){return t(this,new v(d,b),s,c)},i.dividedToIntegerBy=i.idiv=function(d,b){return t(this,new v(d,b),0,1)},i.exponentiatedBy=i.pow=function(d,b){var E,_,P,M,j,L,B,$,V,W=this;if(d=new v(d),d.c&&!d.isInteger())throw Error(or+"Exponent not an integer: "+S(d));if(b!=null&&(b=new v(b)),L=d.e>14,!W.c||!W.c[0]||W.c[0]==1&&!W.e&&W.c.length==1||!d.c||!d.c[0])return V=new v(Math.pow(+S(W),L?2-ko(d):+S(d))),b?V.mod(b):V;if(B=d.s<0,b){if(b.c?!b.c[0]:!b.s)return new v(NaN);_=!B&&W.isInteger()&&b.isInteger(),_&&(W=W.mod(b))}else{if(d.e>9&&(W.e>0||W.e<-1||(W.e==0?W.c[0]>1||L&&W.c[1]>=24e7:W.c[0]<8e13||L&&W.c[0]<=9999975e7)))return M=(W.s<0&&ko(d),-0),W.e>-1&&(M=1/M),new v(B?1/M:M);A&&(M=_u(A/Ae+2))}for(L?(E=new v(.5),B&&(d.s=1),$=ko(d)):(P=Math.abs(+S(d)),$=P%2),V=new v(a);;){if($){if(V=V.times(W),!V.c)break;M?V.c.length>M&&(V.c.length=M):_&&(V=V.mod(b))}if(P){if(P=Cn(P/2),P===0)break;$=P%2}else if(d=d.times(E),g(d,d.e+1,1),d.e>14)$=ko(d);else{if(P=+S(d),P===0)break;$=P%2}W=W.times(W),M?W.c&&W.c.length>M&&(W.c.length=M):_&&(W=W.mod(b))}return _?V:(B&&(V=a.div(V)),b?V.mod(b):M?g(V,A,c,j):V)},i.integerValue=function(d){var b=new v(this);return d==null?d=c:et(d,0,8),g(b,b.e+1,d)},i.isEqualTo=i.eq=function(d,b){return Sa(this,new v(d,b))===0},i.isFinite=function(){return!!this.c},i.isGreaterThan=i.gt=function(d,b){return Sa(this,new v(d,b))>0},i.isGreaterThanOrEqualTo=i.gte=function(d,b){return(b=Sa(this,new v(d,b)))===1||b===0},i.isInteger=function(){return!!this.c&&Mr(this.e/Ae)>this.c.length-2},i.isLessThan=i.lt=function(d,b){return Sa(this,new v(d,b))<0},i.isLessThanOrEqualTo=i.lte=function(d,b){return(b=Sa(this,new v(d,b)))===-1||b===0},i.isNaN=function(){return!this.s},i.isNegative=function(){return this.s<0},i.isPositive=function(){return this.s>0},i.isZero=function(){return!!this.c&&this.c[0]==0},i.minus=function(d,b){var E,_,P,M,j=this,L=j.s;if(d=new v(d,b),b=d.s,!L||!b)return new v(NaN);if(L!=b)return d.s=-b,j.plus(d);var B=j.e/Ae,$=d.e/Ae,V=j.c,W=d.c;if(!B||!$){if(!V||!W)return V?(d.s=-b,d):new v(W?j:NaN);if(!V[0]||!W[0])return W[0]?(d.s=-b,d):new v(V[0]?j:(c==3,-0))}if(B=Mr(B),$=Mr($),V=V.slice(),L=B-$){for((M=L<0)?(L=-L,P=V):($=B,P=W),P.reverse(),b=L;b--;P.push(0));P.reverse()}else for(_=(M=(L=V.length)<(b=W.length))?L:b,L=b=0;b<_;b++)if(V[b]!=W[b]){M=V[b]<W[b];break}if(M&&(P=V,V=W,W=P,d.s=-d.s),b=(_=W.length)-(E=V.length),b>0)for(;b--;V[E++]=0);for(b=rn-1;_>L;){if(V[--_]<W[_]){for(E=_;E&&!V[--E];V[E]=b);--V[E],V[_]+=rn}V[_]-=W[_]}for(;V[0]==0;V.splice(0,1),--$);return V[0]?m(d,V,$):(d.s=c==3?-1:1,d.c=[d.e=0],d)},i.modulo=i.mod=function(d,b){var E,_,P=this;return d=new v(d,b),!P.c||!d.s||d.c&&!d.c[0]?new v(NaN):!d.c||P.c&&!P.c[0]?new v(P):(f==9?(_=d.s,d.s=1,E=t(P,d,0,3),d.s=_,E.s*=_):E=t(P,d,0,f),d=P.minus(E.times(d)),!d.c[0]&&f==1&&(d.s=P.s),d)},i.multipliedBy=i.times=function(d,b){var E,_,P,M,j,L,B,$,V,W,se,oe,Ee,fe,me,pe=this,k=pe.c,K=(d=new v(d,b)).c;if(!k||!K||!k[0]||!K[0])return!pe.s||!d.s||k&&!k[0]&&!K||K&&!K[0]&&!k?d.c=d.e=d.s=null:(d.s*=pe.s,!k||!K?d.c=d.e=null:(d.c=[0],d.e=0)),d;for(_=Mr(pe.e/Ae)+Mr(d.e/Ae),d.s*=pe.s,B=k.length,W=K.length,B<W&&(Ee=k,k=K,K=Ee,P=B,B=W,W=P),P=B+W,Ee=[];P--;Ee.push(0));for(fe=rn,me=mi,P=W;--P>=0;){for(E=0,se=K[P]%me,oe=K[P]/me|0,j=B,M=P+j;M>P;)$=k[--j]%me,V=k[j]/me|0,L=oe*$+V*se,$=se*$+L%me*me+Ee[M]+E,E=($/fe|0)+(L/me|0)+oe*V,Ee[M--]=$%fe;Ee[M]=E}return E?++_:Ee.splice(0,1),m(d,Ee,_)},i.negated=function(){var d=new v(this);return d.s=-d.s||null,d},i.plus=function(d,b){var E,_=this,P=_.s;if(d=new v(d,b),b=d.s,!P||!b)return new v(NaN);if(P!=b)return d.s=-b,_.minus(d);var M=_.e/Ae,j=d.e/Ae,L=_.c,B=d.c;if(!M||!j){if(!L||!B)return new v(P/0);if(!L[0]||!B[0])return B[0]?d:new v(L[0]?_:P*0)}if(M=Mr(M),j=Mr(j),L=L.slice(),P=M-j){for(P>0?(j=M,E=B):(P=-P,E=L),E.reverse();P--;E.push(0));E.reverse()}for(P=L.length,b=B.length,P-b<0&&(E=B,B=L,L=E,b=P),P=0;b;)P=(L[--b]=L[b]+B[b]+P)/rn|0,L[b]=rn===L[b]?0:L[b]%rn;return P&&(L=[P].concat(L),++j),m(d,L,j)},i.precision=i.sd=function(d,b){var E,_,P,M=this;if(d!=null&&d!==!!d)return et(d,1,Tt),b==null?b=c:et(b,0,8),g(new v(M),d,b);if(!(E=M.c))return null;if(P=E.length-1,_=P*Ae+1,P=E[P]){for(;P%10==0;P/=10,_--);for(P=E[0];P>=10;P/=10,_++);}return d&&M.e+1>_&&(_=M.e+1),_},i.shiftedBy=function(d){return et(d,-Eu,Eu),this.times("1e"+d)},i.squareRoot=i.sqrt=function(){var d,b,E,_,P,M=this,j=M.c,L=M.s,B=M.e,$=s+4,V=new v("0.5");if(L!==1||!j||!j[0])return new v(!L||L<0&&(!j||j[0])?NaN:j?M:1/0);if(L=Math.sqrt(+S(M)),L==0||L==1/0?(b=xr(j),(b.length+B)%2==0&&(b+="0"),L=Math.sqrt(+b),B=Mr((B+1)/2)-(B<0||B%2),L==1/0?b="5e"+B:(b=L.toExponential(),b=b.slice(0,b.indexOf("e")+1)+B),E=new v(b)):E=new v(L+""),E.c[0]){for(B=E.e,L=B+$,L<3&&(L=0);;)if(P=E,E=V.times(P.plus(t(M,P,$,1))),xr(P.c).slice(0,L)===(b=xr(E.c)).slice(0,L))if(E.e<B&&--L,b=b.slice(L-3,L+1),b=="9999"||!_&&b=="4999"){if(!_&&(g(P,P.e+s+2,0),P.times(P).eq(M))){E=P;break}$+=4,L+=4,_=1}else{(!+b||!+b.slice(1)&&b.charAt(0)=="5")&&(g(E,E.e+s+2,1),d=!E.times(E).eq(M));break}}return g(E,E.e+s+1,c,d)},i.toExponential=function(d,b){return d!=null&&(et(d,0,Tt),d++),O(this,d,b,1)},i.toFixed=function(d,b){return d!=null&&(et(d,0,Tt),d=d+this.e+1),O(this,d,b)},i.toFormat=function(d,b,E){var _,P=this;if(E==null)d!=null&&b&&typeof b=="object"?(E=b,b=null):d&&typeof d=="object"?(E=d,d=b=null):E=p;else if(typeof E!="object")throw Error(or+"Argument not an object: "+E);if(_=P.toFixed(d,b),P.c){var M,j=_.split("."),L=+E.groupSize,B=+E.secondaryGroupSize,$=E.groupSeparator||"",V=j[0],W=j[1],se=P.s<0,oe=se?V.slice(1):V,Ee=oe.length;if(B&&(M=L,L=B,B=M,Ee-=M),L>0&&Ee>0){for(M=Ee%L||L,V=oe.substr(0,M);M<Ee;M+=L)V+=$+oe.substr(M,L);B>0&&(V+=$+oe.slice(M)),se&&(V="-"+V)}_=W?V+(E.decimalSeparator||"")+((B=+E.fractionGroupSize)?W.replace(new RegExp("\\d{"+B+"}\\B","g"),"$&"+(E.fractionGroupSeparator||"")):W):V}return(E.prefix||"")+_+(E.suffix||"")},i.toFraction=function(d){var b,E,_,P,M,j,L,B,$,V,W,se,oe=this,Ee=oe.c;if(d!=null&&(L=new v(d),!L.isInteger()&&(L.c||L.s!==1)||L.lt(a)))throw Error(or+"Argument "+(L.isInteger()?"out of range: ":"not an integer: ")+S(L));if(!Ee)return new v(oe);for(b=new v(a),$=E=new v(a),_=B=new v(a),se=xr(Ee),M=b.e=se.length-oe.e-1,b.c[0]=Su[(j=M%Ae)<0?Ae+j:j],d=!d||L.comparedTo(b)>0?M>0?b:$:L,j=h,h=1/0,L=new v(se),B.c[0]=0;!(V=t(L,b,0,1),P=E.plus(V.times(_)),P.comparedTo(d)==1);)E=_,_=P,$=B.plus(V.times(P=$)),B=P,b=L.minus(V.times(P=b)),L=P;return P=t(d.minus(E),_,0,1),B=B.plus(P.times($)),E=E.plus(P.times(_)),B.s=$.s=oe.s,M=M*2,W=t($,_,M,c).minus(oe).abs().comparedTo(t(B,E,M,c).minus(oe).abs())<1?[$,_]:[B,E],h=j,W},i.toNumber=function(){return+S(this)},i.toPrecision=function(d,b){return d!=null&&et(d,1,Tt),O(this,d,b,2)},i.toString=function(d){var b,E=this,_=E.s,P=E.e;return P===null?_?(b="Infinity",_<0&&(b="-"+b)):b="NaN":(d==null?b=P<=o||P>=u?Ro(xr(E.c),P):Vn(xr(E.c),P,"0"):d===10?(E=g(new v(E),s+P+1,c),b=Vn(xr(E.c),E.e,"0")):(et(d,2,y.length,"Base"),b=r(Vn(xr(E.c),P,"0"),10,d,_,!0)),_<0&&E.c[0]&&(b="-"+b)),b},i.valueOf=i.toJSON=function(){return S(this)},i._isBigNumber=!0,i[Symbol.toStringTag]="BigNumber",i[Symbol.for("nodejs.util.inspect.custom")]=i.valueOf,e!=null&&v.set(e),v}function Mr(e){var t=e|0;return e>0||e===t?t:t-1}function xr(e){for(var t,r,n=1,i=e.length,a=e[0]+"";n<i;){for(t=e[n++]+"",r=Ae-t.length;r--;t="0"+t);a+=t}for(i=a.length;a.charCodeAt(--i)===48;);return a.slice(0,i+1||1)}function Sa(e,t){var r,n,i=e.c,a=t.c,s=e.s,c=t.s,o=e.e,u=t.e;if(!s||!c)return null;if(r=i&&!i[0],n=a&&!a[0],r||n)return r?n?0:-c:s;if(s!=c)return s;if(r=s<0,n=o==u,!i||!a)return n?0:!i^r?1:-1;if(!n)return o>u^r?1:-1;for(c=(o=i.length)<(u=a.length)?o:u,s=0;s<c;s++)if(i[s]!=a[s])return i[s]>a[s]^r?1:-1;return o==u?0:o>u^r?1:-1}function et(e,t,r,n){if(e<t||e>r||e!==Cn(e))throw Error(or+(n||"Argument")+(typeof e=="number"?e<t||e>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function ko(e){var t=e.c.length-1;return Mr(e.e/Ae)==t&&e.c[t]%2!=0}function Ro(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function Vn(e,t,r){var n,i;if(t<0){for(i=r+".";++t;i+=r);e=i+e}else if(n=e.length,++t>n){for(i=r,t-=n;--t;i+=r);e+=i}else t<n&&(e=e.slice(0,t)+"."+e.slice(t));return e}var Hh=Vh(),l0=Object.freeze({__proto__:null,BigNumber:Hh,default:Hh}),zh=re(function(e,t){const r=Math.exp;t=e.exports=function(i){if(typeof i!="number")throw new Error("must provide a timespan to the moving average constructor");if(i<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let a,s=0,c=0,o=0,u,l={};function h(w,f){return 1-r(-(w-f)/i)}return l.push=function(f,A){if(u){const p=h(f,u),y=A-a,v=p*y;a=p*A+(1-p)*a,s=(1-p)*(s+y*v),c=Math.sqrt(s),o=a+p*y}else a=A;u=f},l.movingAverage=function(){return a},l.variance=function(){return s},l.deviation=function(){return c},l.forecast=function(){return o},l}}),Kh=rd(l0);class d0 extends At{constructor(e,t){super();this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this);const r=this._options.movingAverageIntervals;for(var n=0;n<e.length;n++){var i=e[n];this._stats[i]=Kh(0),this._movingAverages[i]={};for(var a=0;a<r.length;a++){var s=r[a],c=this._movingAverages[i][s]=zh(s);c.push(this._frequencyLastTime,0)}}}start(){this._queue.length&&this._resetComputeTimeout()}stop(){this._timeout&&(this._timeout.clear(),this._timeout=null)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}toJSON(){const e=this.snapshot,t=this.movingAverages,r={dataReceived:e.dataReceived.toString(),dataSent:e.dataSent.toString(),movingAverages:{}},n=Object.keys(t);for(const i of n){r.movingAverages[i]={};for(const a of Object.keys(t[i]))r.movingAverages[i][a]=t[i][a].movingAverage()}return r}push(e,t){this._queue.push([e,t,Date.now()]),this._resetComputeTimeout()}_resetComputeTimeout(){this._timeout=ji(this._update,this._nextTimeout())}_nextTimeout(){const e=this._queue.length/this._options.computeThrottleMaxQueueSize,t=Math.max(this._options.computeThrottleTimeout*(1-e),0);return t}_update(){if(this._timeout=null,this._queue.length){let e;for(e of this._queue)this._applyOp(e);this._queue=[],this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){const t=e-this._frequencyLastTime;Object.keys(this._stats).forEach(r=>{this._updateFrequencyFor(r,t,e)}),this._frequencyLastTime=e}_updateFrequencyFor(e,t,r){const n=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;const i=t||1,a=n/i*1e3;let s=this._movingAverages[e];s||(s=this._movingAverages[e]={});const c=this._options.movingAverageIntervals;for(var o=0;o<c.length;o++){var u=c[o],l=s[u];l||(l=s[u]=zh(u)),l.push(r,a)}}_applyOp(e){const t=e[0],r=e[1];if(typeof r!="number")throw new Error("invalid increment number:",r);let n;Object.prototype.hasOwnProperty.call(this._stats,t)?n=this._stats[t]:n=this._stats[t]=Kh(0),this._stats[t]=n.plus(r),this._frequencyAccumulators[t]||(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=r}}var Au=d0,Po=rd(o0);const{tap:Wh}=Po,{METRICS:h0}=ls,Tu=["dataReceived","dataSent"],p0={in:"dataReceived",out:"dataSent"};class Xh{constructor(e){this._options=go(h0,e),this._globalStats=new Au(Tu,this._options),this._peerStats=new Map,this._protocolStats=new Map,this._oldPeers=c0(this._options.maxOldPeersRetention),this._running=!1,this._onMessage=this._onMessage.bind(this),this._connectionManager=e.connectionManager,this._connectionManager.on("peer:disconnect",t=>{this.onPeerDisconnected(t.remotePeer)})}start(){this._running=!0}stop(){this._running=!1,this._globalStats.stop();for(const e of this._peerStats.values())e.stop();for(const e of this._protocolStats.values())e.stop()}get global(){return this._globalStats}get peers(){return Array.from(this._peerStats.keys())}forPeer(e){const t=e.toB58String();return this._peerStats.get(t)||this._oldPeers.get(t)}get protocols(){return Array.from(this._protocolStats.keys())}forProtocol(e){return this._protocolStats.get(e)}onPeerDisconnected(e){const t=e.toB58String(),r=this._peerStats.get(t);r&&(r.stop(),this._peerStats.delete(t),this._oldPeers.set(t,r))}_onMessage({remotePeer:e,protocol:t,direction:r,dataLength:n}){if(!this._running)return;const i=p0[r];let a=this.forPeer(e);if(a||(a=new Au(Tu,this._options),this._peerStats.set(e.toB58String(),a)),a.push(i,n),this._globalStats.push(i,n),t){let s=this.forProtocol(t);s||(s=new Au(Tu,this._options),this._protocolStats.set(t,s)),s.push(i,n)}}updatePlaceholder(e,t){if(!this._running)return;const r=this.forPeer(e),n=t.toB58String(),i=this.forPeer(t);let a=r;i&&(a=Xh.mergeStats(i,a),this._oldPeers.delete(n)),this._peerStats.delete(e.toB58String()),this._peerStats.set(n,a),a.start()}trackStream({stream:e,remotePeer:t,protocol:r}){const n=this,i=e.source;e.source=Wh(s=>n._onMessage({remotePeer:t,protocol:r,direction:"in",dataLength:s.length}))(i);const a=e.sink;return e.sink=s=>bt(s,Wh(c=>n._onMessage({remotePeer:t,protocol:r,direction:"out",dataLength:c.length})),a),e}static mergeStats(e,t){return e.stop(),t.stop(),e._queue=[...e._queue,...t._queue],e}}var f0=Xh,cr=re(function(e,t){const r=at(`
`);async function n(i){for await(const a of i)return a}t.encode=i=>Je.encode.single(new tt([i,r])),t.write=(i,a)=>i.push(t.encode(a)),t.writeAll=(i,a)=>{i.push(a.reduce((s,c)=>s.append(t.encode(c)),new tt))},t.read=async i=>{let a=1;const s={[Symbol.asyncIterator](){return this},next:()=>i.next(a)},c=u=>{a=u},o=await bt(s,Je.decode({onLength:c}),n);if(o.get(o.length-1)!==r[0])throw U(new Error("missing newline"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return o.shallowSlice(0,-1)}});const Aa=te("mss:select");var Qh=async(e,t,r)=>{t=Array.isArray(t)?[...t]:[t];const{reader:n,writer:i,rest:a,stream:s}=ms(e),c=t.shift();r?(Aa('select: write ["%s", "%s"]',r,c),cr.writeAll(i,[r,c])):(Aa('select: write "%s"',c),cr.write(i,c));let o=(await cr.read(n)).toString();if(Aa('select: read "%s"',o),o===r&&(o=(await cr.read(n)).toString(),Aa('select: read "%s"',o)),o===c)return a(),{stream:s,protocol:c};for(const u of t){Aa('select: write "%s"',u),cr.write(i,u);const l=(await cr.read(n)).toString();if(Aa('select: read "%s" for "%s"',l,u),l===u)return a(),{stream:s,protocol:u}}throw a(),U(new Error("protocol selection failed"),"ERR_UNSUPPORTED_PROTOCOL")},m0="/multistream/1.0.0",Yh={PROTOCOL_ID:m0};const bs=te("mss:handle"),{PROTOCOL_ID:Iu}=Yh;var g0=async(e,t)=>{t=Array.isArray(t)?t:[t];const{writer:r,reader:n,rest:i,stream:a}=ms(e);for(;;){const s=(await cr.read(n)).toString();if(bs('read "%s"',s),s===Iu){bs('respond with "%s" for "%s"',Iu,s),cr.write(r,Iu);continue}if(t.includes(s))return cr.write(r,s),bs('respond with "%s" for "%s"',s,s),i(),{stream:a,protocol:s};if(s==="ls"){cr.write(r,new tt(t.map(c=>cr.encode(c)))),bs('respond with "%s" for %s',t,s);continue}cr.write(r,"na"),bs('respond with "na" for "%s"',s)}};const y0=te("it-multistream-select:ls");var b0=async e=>{const{reader:t,writer:r,rest:n,stream:i}=ms(e);y0('write "ls"'),cr.write(r,"ls"),n();const a=await cr.read(t),s=oh([a]),c=[];return await bt(s,Je.decode(),async o=>{for await(const u of o)c.push(u.shallowSlice(0,-1).toString())}),{stream:i,protocols:c}};const{PROTOCOL_ID:Cu}=Yh;var v0=Cu;class Jh{constructor(e){this._stream=e,this._shaken=!1}async _handshake(){if(this._shaken)return;const{stream:e}=await Qh(this._stream,Cu);this._stream=e,this._shaken=!0}}class w0 extends Jh{select(e){return Qh(this._stream,e,this._shaken?null:Cu)}async ls(){await this._handshake();const{stream:e,protocols:t}=await b0(this._stream);return this._stream=e,t}}var _0=w0;class E0 extends Jh{handle(e){return g0(this._stream,e)}}var S0=E0,Ta={PROTOCOL_ID:v0,Dialer:_0,Listener:S0},Ia={OPEN:"open",CLOSING:"closing",CLOSED:"closed"};function A0(e,t,r,n,i,a,s){if(e&&!Ne.isMultiaddr(e))throw U(new Error("localAddr must be an instance of multiaddr"),"ERR_INVALID_PARAMETERS");if(!we.isPeerId(t))throw U(new Error("localPeer must be an instance of peer-id"),"ERR_INVALID_PARAMETERS");if(!we.isPeerId(r))throw U(new Error("remotePeer must be an instance of peer-id"),"ERR_INVALID_PARAMETERS");if(typeof n!="function")throw U(new Error("new stream must be a function"),"ERR_INVALID_PARAMETERS");if(typeof i!="function")throw U(new Error("close must be a function"),"ERR_INVALID_PARAMETERS");if(typeof a!="function")throw U(new Error("getStreams must be a function"),"ERR_INVALID_PARAMETERS");if(!s)throw U(new Error("connection metadata object must be provided"),"ERR_INVALID_PARAMETERS");if(s.direction!=="inbound"&&s.direction!=="outbound")throw U(new Error('direction must be "inbound" or "outbound"'),"ERR_INVALID_PARAMETERS");if(!s.timeline)throw U(new Error("connection timeline object must be provided in the stat object"),"ERR_INVALID_PARAMETERS");if(!s.timeline.open)throw U(new Error("connection open timestamp must be provided"),"ERR_INVALID_PARAMETERS");if(!s.timeline.upgraded)throw U(new Error("connection upgraded timestamp must be provided"),"ERR_INVALID_PARAMETERS")}class T0{constructor({localAddr:e,remoteAddr:t,localPeer:r,remotePeer:n,newStream:i,close:a,getStreams:s,stat:c}){A0(e,r,n,i,a,s,c),this.id=parseInt(Math.random()*1e9).toString(36)+Date.now(),this.localAddr=e,this.remoteAddr=t,this.localPeer=r,this.remotePeer=n,this._stat={...c,status:Ia.OPEN},this._newStream=i,this._close=a,this._getStreams=s,this.registry=new Map,this.tags=[]}get stat(){return this._stat}get streams(){return this._getStreams()}async newStream(e){if(this.stat.status===Ia.CLOSING)throw U(new Error("the connection is being closed"),"ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===Ia.CLOSED)throw U(new Error("the connection is closed"),"ERR_CONNECTION_CLOSED");Array.isArray(e)||(e=[e]);const{stream:t,protocol:r}=await this._newStream(e);return this.addStream(t,{protocol:r}),{stream:t,protocol:r}}addStream(e,{protocol:t,metadata:r={}}){this.registry.set(e.id,{protocol:t,...r})}removeStream(e){this.registry.delete(e)}async close(){if(this.stat.status===Ia.CLOSED)return;if(this._closing)return this._closing;this.stat.status=Ia.CLOSING,this._closing=await this._close(),this._stat.timeline.close=Date.now(),this.stat.status=Ia.CLOSED}}var I0=Pr(T0,{className:"Connection",symbolName:"@libp2p/interface-connection/connection"}),C0=I0,k0={Connection:C0};function R0(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}else return Array.from(e)}var Zh=function(t){var r=void 0,n=void 0;function i(c){if(!(c instanceof Object))throw new Error('Target "'+c+'" is not an object');n=c}function a(c){Object.keys(c).forEach(function(o){var u=c[o];if(typeof u!="function")throw new Error('Trap "'+o+": "+u+'" is not a function');if(!Reflect[o])throw new Error('Trap "'+o+": "+u+'" is not a valid trap')}),r=c}i(function(){}),t&&i(t),a(Reflect);var s=new Proxy({},{get:function(o,u){return function(){for(var l=arguments.length,h=Array(l),w=0;w<l;w++)h[w]=arguments[w];return r[u].apply(null,[n].concat(R0(h.slice(1))))}}});return{setTarget:i,setHandler:a,getTarget:function(){return n},getHandler:function(){return r},proxy:new Proxy(n,s)}};const dt=te("libp2p:upgrader");dt.error=te("libp2p:upgrader:error");const{Connection:P0}=k0,{codes:vs}=Ot;class N0{constructor({localPeer:e,metrics:t,cryptos:r,muxers:n,onConnectionEnd:i=()=>{},onConnection:a=()=>{}}){this.localPeer=e,this.metrics=t,this.cryptos=r||new Map,this.muxers=n||new Map,this.protector=null,this.protocols=new Map,this.onConnection=a,this.onConnectionEnd=i}async upgradeInbound(e){let t,r,n,i,a,s,c;if(this.metrics){({setTarget:s,proxy:c}=Zh());const u=parseInt(Math.random()*1e9).toString(36)+Date.now();s({toB58String:()=>u}),e=this.metrics.trackStream({stream:e,remotePeer:c})}dt("Starting the inbound connection upgrade");let o=e;this.protector&&(o=await this.protector.protect(e));try{({conn:t,remotePeer:r,protocol:a}=await this._encryptInbound(this.localPeer,o,this.cryptos)),this.muxers.size?{stream:n,Muxer:i}=await this._multiplexInbound(t,this.muxers):n=t}catch(u){throw dt.error("Failed to upgrade inbound connection",u),await e.close(u),u}return this.metrics&&(this.metrics.updatePlaceholder(c,r),s(r)),dt("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:a,direction:"inbound",maConn:e,upgradedConn:n,Muxer:i,remotePeer:r})}async upgradeOutbound(e){let t;try{t=we.createFromB58String(e.remoteAddr.getPeerId())}catch(l){dt.error("multiaddr did not contain a valid peer id",l)}let r,n,i,a,s,c,o;if(this.metrics){({setTarget:c,proxy:o}=Zh());const l=parseInt(Math.random()*1e9).toString(36)+Date.now();c({toB58String:()=>l}),e=this.metrics.trackStream({stream:e,remotePeer:o})}dt("Starting the outbound connection upgrade");let u=e;this.protector&&(u=await this.protector.protect(e));try{({conn:r,remotePeer:n,protocol:a}=await this._encryptOutbound(this.localPeer,u,t,this.cryptos)),this.muxers.size?{stream:i,Muxer:s}=await this._multiplexOutbound(r,this.muxers):i=r}catch(l){throw dt.error("Failed to upgrade outbound connection",l),await e.close(l),l}return this.metrics&&(this.metrics.updatePlaceholder(o,n),c(n)),dt("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:a,direction:"outbound",maConn:e,upgradedConn:i,Muxer:s,remotePeer:n})}_createConnection({cryptoProtocol:e,direction:t,maConn:r,upgradedConn:n,Muxer:i,remotePeer:a}){let s,c,o;i&&(s=new i({onStream:async h=>{const w=new Ta.Listener(h);try{const{stream:f,protocol:A}=await w.handle(Array.from(this.protocols.keys()));dt("%s: incoming stream opened on %s",t,A),this.metrics&&this.metrics.trackStream({stream:f,remotePeer:a,protocol:A}),o.addStream(h,{protocol:A}),this._onStream({connection:o,stream:{...h,...f},protocol:A})}catch(f){dt.error(f)}},onStreamEnd:h=>{o.removeStream(h.id)}}),c=async h=>{dt("%s: starting new stream on %s",t,h);const w=s.newStream(),f=new Ta.Dialer(w);try{const{stream:A,protocol:p}=await f.select(h);return this.metrics&&this.metrics.trackStream({stream:A,remotePeer:a,protocol:p}),{stream:{...w,...A},protocol:p}}catch(A){throw dt.error("could not create new stream",A),U(A,vs.ERR_UNSUPPORTED_PROTOCOL)}},bt(n,s,n).catch(dt.error));const u=r.timeline;r.timeline=new Proxy(u,{set:(...h)=>(o&&h[1]==="close"&&h[2]&&!u.close&&(o.stat.status="closed",this.onConnectionEnd(o)),Reflect.set(...h))}),r.timeline.upgraded=Date.now();const l=()=>{throw U(new Error("connection is not multiplexed"),"ERR_CONNECTION_NOT_MULTIPLEXED")};return o=new P0({localAddr:r.localAddr,remoteAddr:r.remoteAddr,localPeer:this.localPeer,remotePeer:a,stat:{direction:t,timeline:r.timeline,multiplexer:i&&i.multicodec,encryption:e},newStream:c||l,getStreams:()=>s?s.streams:l,close:h=>r.close(h)}),this.onConnection(o),o}_onStream({connection:e,stream:t,protocol:r}){const n=this.protocols.get(r);n({connection:e,stream:t,protocol:r})}async _encryptInbound(e,t,r){const n=new Ta.Listener(t),i=Array.from(r.keys());dt("handling inbound crypto protocol selection",i);try{const{stream:a,protocol:s}=await n.handle(i),c=r.get(s);return dt("encrypting inbound connection..."),{...await c.secureInbound(e,a),protocol:s}}catch(a){throw U(a,vs.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(e,t,r,n){const i=new Ta.Dialer(t),a=Array.from(n.keys());dt("selecting outbound crypto protocol",a);try{const{stream:s,protocol:c}=await i.select(a),o=n.get(c);return dt("encrypting outbound connection to %j",r),{...await o.secureOutbound(e,s,r),protocol:c}}catch(s){throw U(s,vs.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(e,t){const r=new Ta.Dialer(e),n=Array.from(t.keys());dt("outbound selecting muxer %s",n);try{const{stream:i,protocol:a}=await r.select(n);dt("%s selected as muxer protocol",a);const s=t.get(a);return{stream:i,Muxer:s}}catch(i){throw U(i,vs.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(e,t){const r=new Ta.Listener(e),n=Array.from(t.keys());dt("inbound handling muxers %s",n);try{const{stream:i,protocol:a}=await r.handle(n),s=t.get(a);return{stream:i,Muxer:s}}catch(i){throw U(i,vs.ERR_MUXER_UNAVAILABLE)}}}var O0=N0;const{codes:{ERR_INVALID_PARAMETERS:ep}}=Ot,D0=e=>e;class M0{constructor({peerStore:e,eventName:t,eventProperty:r,eventTransformer:n=D0}){this._ps=e,this.eventName=t,this.eventProperty=r,this.eventTransformer=n,this.data=new Map}set(e,t){throw U(new Error("set must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}_setData(e,t,{emit:r=!0}={}){const n=e.toB58String();this.data.set(n,t),r&&this._emit(e,t)}_emit(e,t){this._ps.emit(this.eventName,{peerId:e,[this.eventProperty]:this.eventTransformer(t)})}get(e){if(!we.isPeerId(e))throw U(new Error("peerId must be an instance of peer-id"),ep);const t=this.data.get(e.toB58String());return t?[...t]:void 0}delete(e){if(!we.isPeerId(e))throw U(new Error("peerId must be an instance of peer-id"),ep);return this.data.delete(e.toB58String())?(this._emit(e,[]),!0):!1}}var No=M0;class x0{constructor(e,t){this.domain=e,this.codec=t}marshal(){throw U(new Error("marshal must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}equals(e){throw U(new Error("equals must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}}var B0=x0;function L0(e,t){return e.length===t.length&&t.sort()&&e.sort().every((r,n)=>t[n].equals(r))}var j0=L0;const U0=`
message PeerRecord {
    // AddressInfo is a wrapper around a binary multiaddr. It is defined as a
    // separate message to allow us to add per-address metadata in the future.
    message AddressInfo {
        bytes multiaddr = 1;
    }

    // peer_id contains a libp2p peer id in its binary representation.
    bytes peer_id = 1;

    // seq contains a monotonically-increasing sequence counter to order PeerRecords in time.
    uint64 seq = 2;

    // addresses is a list of public listen addresses for the peer.
    repeated AddressInfo addresses = 3;
}
`;var tp=Nr(U0).PeerRecord,F0=Zl.getName(Zl.LIBP2P_PEER_RECORD),q0=Uint8Array.from([3,1]),G0={ENVELOPE_DOMAIN_PEER_RECORD:F0,ENVELOPE_PAYLOAD_TYPE_PEER_RECORD:q0};const{ENVELOPE_DOMAIN_PEER_RECORD:rp,ENVELOPE_PAYLOAD_TYPE_PEER_RECORD:$0}=G0;class Oo extends B0{constructor({peerId:e,multiaddrs:t=[],seqNumber:r=Date.now()}){super(rp,$0);this.peerId=e,this.multiaddrs=t,this.seqNumber=r,this._marshal=void 0}marshal(){return this._marshal?this._marshal:(this._marshal=tp.encode({peer_id:this.peerId.toBytes(),seq:this.seqNumber,addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))}),this._marshal)}equals(e){return this.peerId.equals(e.peerId)?this.seqNumber!==e.seqNumber?!1:!!j0(this.multiaddrs,e.multiaddrs):!1}}Oo.createFromProtobuf=e=>{const t=tp.decode(e),r=we.createFromBytes(t.peer_id),n=(t.addresses||[]).map(a=>Ne(a.multiaddr)),i=t.seq;return new Oo({peerId:r,multiaddrs:n,seqNumber:i})},Oo.DOMAIN=rp;var Do=Oo;const V0=`
message Envelope {
  // public_key is the public key of the keypair the enclosed payload was
  // signed with.
  bytes public_key = 1;

  // payload_type encodes the type of payload, so that it can be deserialized
  // deterministically.
  bytes payload_type = 2;

  // payload is the actual payload carried inside this envelope.
  bytes payload = 3;

  // signature is the signature produced by the private key corresponding to
  // the enclosed public key, over the payload, prefixing a domain string for
  // additional security.
  bytes signature = 5;
}
`;var np=Nr(V0).Envelope;const H0=te("libp2p:envelope");H0.error=te("libp2p:envelope:error");const{codes:z0}=Ot;class $i{constructor({peerId:e,payloadType:t,payload:r,signature:n}){this.peerId=e,this.payloadType=t,this.payload=r,this.signature=n,this._marshal=void 0}marshal(){if(this._marshal)return this._marshal;const e=Yl.marshalPublicKey(this.peerId.pubKey);return this._marshal=np.encode({public_key:e,payload_type:this.payloadType,payload:this.payload,signature:this.signature}),this._marshal}equals(e){return ir(this.peerId.pubKey.bytes,e.peerId.pubKey.bytes)&&ir(this.payloadType,e.payloadType)&&ir(this.payload,e.payload)&&ir(this.signature,e.signature)}validate(e){const t=ip(e,this.payloadType,this.payload);return this.peerId.pubKey.verify(t,this.signature)}}const ip=(e,t,r)=>{e=at(e);const n=$e.encode(e.byteLength),i=$e.encode(t.length),a=$e.encode(r.length);return nr([new Uint8Array(n),e,new Uint8Array(i),t,new Uint8Array(a),r])};$i.createFromProtobuf=async e=>{const t=np.decode(e),r=await we.createFromPubKey(t.public_key);return new $i({peerId:r,payloadType:t.payload_type,payload:t.payload,signature:t.signature})},$i.seal=async(e,t)=>{const r=e.domain,n=e.codec,i=e.marshal(),a=ip(r,n,i),s=await t.privKey.sign(a);return new $i({peerId:t,payloadType:n,payload:i,signature:s})},$i.openAndCertify=async(e,t)=>{const r=await $i.createFromProtobuf(e),n=await r.validate(t);if(!n)throw U(new Error("envelope signature is not valid for the given domain"),z0.ERR_SIGNATURE_NOT_VALID);return r};var ws=$i;const Br=te("libp2p:peer-store:address-book");Br.error=te("libp2p:peer-store:address-book:error");const{codes:{ERR_INVALID_PARAMETERS:Ca}}=Ot;class K0 extends No{constructor(e){super({peerStore:e,eventName:"change:multiaddrs",eventProperty:"multiaddrs",eventTransformer:t=>t.addresses?t.addresses.map(r=>r.multiaddr):[]});this.data=new Map}consumePeerRecord(e){let t;try{t=Do.createFromProtobuf(e.payload)}catch(c){return Br.error("invalid peer record received"),!1}if(!t.peerId.equals(e.peerId))return Br("signing key does not match PeerId in the PeerRecord"),!1;if(!t.multiaddrs||!t.multiaddrs.length)return!1;const r=t.peerId,n=r.toB58String(),i=this.data.get(n)||{},a=i.record;if(a&&a.seqNumber>=t.seqNumber)return!1;const s=this._toAddresses(t.multiaddrs,!0);return this._setData(r,{addresses:s,record:{raw:e.marshal(),seqNumber:t.seqNumber}}),Br(`stored provided peer record for ${n}`),!0}getRawEnvelope(e){const t=this.data.get(e.toB58String());return!t||!t.record||!t.record.raw?void 0:t.record.raw}getPeerRecord(e){const t=this.getRawEnvelope(e);return t?ws.createFromProtobuf(t):void 0}set(e,t){if(!we.isPeerId(e))throw Br.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),Ca);const r=this._toAddresses(t),n=e.toB58String(),i=this.data.get(n)||{},a=i.addresses;if(!r.length)return this;if(a&&a.length===r.length){const s=a.filter(c=>r.some(o=>c.multiaddr.equals(o.multiaddr)));if(s.length===a.length)return Br(`the addresses provided to store are equal to the already stored for ${n}`),this}return this._setData(e,{addresses:r,record:i.record}),Br(`stored provided multiaddrs for ${n}`),a||this._ps.emit("peer",e),this}add(e,t){if(!we.isPeerId(e))throw Br.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),Ca);const r=this._toAddresses(t),n=e.toB58String(),i=this.data.get(n)||{},a=i.addresses||[];return a.forEach(s=>{r.find(c=>c.multiaddr.equals(s.multiaddr))||r.push(s)}),a&&a.length===r.length?(Br(`the addresses provided to store are already stored for ${n}`),this):(this._setData(e,{addresses:r,record:i.record}),Br(`added provided multiaddrs for ${n}`),i.addresses||this._ps.emit("peer",e),this)}get(e){if(!we.isPeerId(e))throw U(new Error("peerId must be an instance of peer-id"),Ca);const t=this.data.get(e.toB58String());return t&&t.addresses?[...t.addresses]:void 0}_toAddresses(e,t=!1){if(!e)throw Br.error("multiaddrs must be provided to store data"),U(new Error("multiaddrs must be provided"),Ca);const r=[];return e.forEach(n=>{if(!Ne.isMultiaddr(n))throw Br.error(`multiaddr ${n} must be an instance of multiaddr`),U(new Error(`multiaddr ${n} must be an instance of multiaddr`),Ca);r.push({multiaddr:n,isCertified:t})}),r}getMultiaddrsForPeer(e){if(!we.isPeerId(e))throw U(new Error("peerId must be an instance of peer-id"),Ca);const t=this.data.get(e.toB58String());return!t||!t.addresses?void 0:t.addresses.map(r=>{const n=r.multiaddr,i=n.getPeerId();return i&&i===e.toB58String()?n:n.encapsulate(`/p2p/${e.toB58String()}`)})}}var W0=K0;const ku=te("libp2p:peer-store:key-book");ku.error=te("libp2p:peer-store:key-book:error");const{codes:{ERR_INVALID_PARAMETERS:ap}}=Ot;class X0 extends No{constructor(e){super({peerStore:e,eventName:"change:pubkey",eventProperty:"pubkey",eventTransformer:t=>t.pubKey});this.data=new Map}set(e,t){if(!we.isPeerId(e))throw ku.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),ap);const r=e.toB58String(),n=this.data.get(r);return!n&&t&&(e.pubKey=t,this._setData(e,e),ku(`stored provided public key for ${r}`)),this}get(e){if(!we.isPeerId(e))throw U(new Error("peerId must be an instance of peer-id"),ap);const t=this.data.get(e.toB58String());return t?t.pubKey:void 0}}var Q0=X0;const Mo=te("libp2p:peer-store:proto-book");Mo.error=te("libp2p:peer-store:proto-book:error");const{codes:{ERR_INVALID_PARAMETERS:ka}}=Ot;class Y0 extends No{constructor(e){super({peerStore:e,eventName:"change:metadata",eventProperty:"metadata"});this.data=new Map}set(e,t,r){if(!we.isPeerId(e))throw Mo.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),ka);if(typeof t!="string"||!(r instanceof Uint8Array))throw Mo.error("valid key and value must be provided to store data"),U(new Error("valid key and value must be provided"),ka);return this._setValue(e,t,r),this}_setValue(e,t,r,{emit:n=!0}={}){const i=e.toB58String(),a=this.data.get(i)||new Map,s=a.get(t);if(s&&ir(r,s)){Mo(`the metadata provided to store is equal to the already stored for ${i} on ${t}`);return}a.set(t,r),this.data.set(i,a),n&&this._emit(e,t)}get(e){if(!we.isPeerId(e))throw U(new Error("peerId must be an instance of peer-id"),ka);return this.data.get(e.toB58String())}getValue(e,t){if(!we.isPeerId(e))throw U(new Error("peerId must be an instance of peer-id"),ka);const r=this.data.get(e.toB58String());return r&&r.get(t)}delete(e){if(!we.isPeerId(e))throw U(new Error("peerId must be an instance of peer-id"),ka);return this.data.delete(e.toB58String())?(this._emit(e),!0):!1}deleteValue(e,t){if(!we.isPeerId(e))throw U(new Error("peerId must be an instance of peer-id"),ka);const r=this.data.get(e.toB58String());return!r||!r.delete(t)?!1:(this._emit(e,t),!0)}}var J0=Y0;const Hn=te("libp2p:peer-store:proto-book");Hn.error=te("libp2p:peer-store:proto-book:error");const{codes:{ERR_INVALID_PARAMETERS:xo}}=Ot;class Z0 extends No{constructor(e){super({peerStore:e,eventName:"change:protocols",eventProperty:"protocols",eventTransformer:t=>Array.from(t)});this.data=new Map}set(e,t){if(!we.isPeerId(e))throw Hn.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),xo);if(!t)throw Hn.error("protocols must be provided to store data"),U(new Error("protocols must be provided"),xo);const r=e.toB58String(),n=this.data.get(r),i=new Set(t),a=(s,c)=>s.size===c.size&&[...s].every(o=>c.has(o));return n&&a(n,i)?(Hn(`the protocols provided to store are equal to the already stored for ${r}`),this):(this._setData(e,i),Hn(`stored provided protocols for ${r}`),this)}add(e,t){if(!we.isPeerId(e))throw Hn.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),xo);if(!t)throw Hn.error("protocols must be provided to store data"),U(new Error("protocols must be provided"),xo);const r=e.toB58String(),n=this.data.get(r)||new Set,i=new Set([...n,...t]);return n.size===i.size?(Hn(`the protocols provided to store are already stored for ${r}`),this):(t=[...i],this._setData(e,i),Hn(`added provided protocols for ${r}`),this)}}var e_=Z0;const t_=te("libp2p:peer-store");t_.error=te("libp2p:peer-store:error");const{EventEmitter:r_}=At,{ERR_INVALID_PARAMETERS:n_}=Ot;class i_ extends r_{constructor({peerId:e}){super();this._peerId=e,this.addressBook=new W0(this),this.keyBook=new Q0(this),this.metadataBook=new J0(this),this.protoBook=new e_(this)}start(){}stop(){}get peers(){const e=new Set([...this.addressBook.data.keys(),...this.keyBook.data.keys(),...this.protoBook.data.keys(),...this.metadataBook.data.keys()]);this._peerId&&e.delete(this._peerId.toB58String());const t=new Map;return e.forEach(r=>{t.set(r,this.get(we.createFromCID(r)))}),t}delete(e){const t=this.addressBook.delete(e),r=this.keyBook.delete(e),n=this.protoBook.delete(e),i=this.metadataBook.delete(e);return t||r||n||i}get(e){if(!we.isPeerId(e))throw U(new Error("peerId must be an instance of peer-id"),n_);const t=this.keyBook.data.get(e.toB58String()),r=this.addressBook.get(e),n=this.metadataBook.get(e),i=this.protoBook.get(e);return!t&&!r&&!n&&!i?void 0:{id:t||e,addresses:r||[],protocols:i||[],metadata:n}}}var sp=i_,a_=(e,t,r)=>{class n extends e{subscribe(i,a){a&&this.on(i,a),super.subscribe(i)}unsubscribe(i,a){a?this.removeListener(i,a):this.removeAllListeners(i),this.listenerCount(i)===0&&super.unsubscribe(i)}}return new n(t,r)},s_="/peers/",o_="/peers/addrs/",c_="/peers/keys/",u_="/peers/metadata/",l_="/peers/protos/",d_={NAMESPACE_COMMON:s_,NAMESPACE_ADDRESS:o_,NAMESPACE_KEYS:c_,NAMESPACE_METADATA:u_,NAMESPACE_PROTOCOL:l_};const h_=`
message Addresses {
  // Address represents a single multiaddr.
  message Address {
    required bytes multiaddr = 1;

    // Flag to indicate if the address comes from a certified source.
    optional bool isCertified = 2;
  }

  // CertifiedRecord contains a serialized signed PeerRecord used to
  // populate the signedAddrs list.
  message CertifiedRecord {
    // The Seq counter from the signed PeerRecord envelope
    uint64 seq = 1;

    // The serialized bytes of the SignedEnvelope containing the PeerRecord.
    bytes raw = 2;
  }

  // The known multiaddrs.
  repeated Address addrs = 1;

  // The most recently received signed PeerRecord.
  CertifiedRecord certified_record = 2;
}
`;var op=Nr(h_).Addresses;const p_=`
message Protocols {
  repeated string protocols = 1;
}
`;var cp=Nr(p_).Protocols;const Dt=te("libp2p:persistent-peer-store");Dt.error=te("libp2p:persistent-peer-store:error");const{Key:Bo}=Ea,{NAMESPACE_ADDRESS:f_,NAMESPACE_COMMON:m_,NAMESPACE_KEYS:g_,NAMESPACE_METADATA:y_,NAMESPACE_PROTOCOL:b_}=d_;class v_ extends sp{constructor({peerId:e,datastore:t,threshold:r=5}){super({peerId:e});this._datastore=t,this._dirtyPeers=new Set,this._dirtyMetadata=new Map,this.threshold=r,this._addDirtyPeer=this._addDirtyPeer.bind(this)}async start(){Dt("PeerStore is starting"),this.on("change:protocols",this._addDirtyPeer),this.on("change:multiaddrs",this._addDirtyPeer),this.on("change:pubkey",this._addDirtyPeer),this.on("change:metadata",this._addDirtyPeerMetadata);for await(const e of this._datastore.query({prefix:m_}))await this._processDatastoreEntry(e);Dt("PeerStore started")}async stop(){Dt("PeerStore is stopping"),this.removeAllListeners(),await this._commitData(),Dt("PeerStore stopped")}_addDirtyPeer({peerId:e}){const t=e.toB58String();Dt("add dirty peer",t),this._dirtyPeers.add(t),this._dirtyPeers.size>=this.threshold&&this._commitData().catch(r=>{Dt.error("error committing data",r)})}_addDirtyPeerMetadata({peerId:e,metadata:t}){const r=e.toB58String();Dt("add dirty metadata peer",r),this._dirtyPeers.add(r);const n=this._dirtyMetadata.get(r)||new Set;n.add(t),this._dirtyMetadata.set(r,n),this._dirtyPeers.size>=this.threshold&&this._commitData().catch(i=>{Dt.error("error committing data",i)})}async _commitData(){const e=Array.from(this._dirtyPeers);if(!e.length)return;this._dirtyPeers.clear(),Dt("create batch commit");const t=this._datastore.batch();for(const r of e){const n=this.keyBook.data.get(r)||we.createFromCID(r);this._batchAddressBook(n,t),this._batchKeyBook(n,t),this._batchMetadataBook(n,t),this._batchProtoBook(n,t)}await t.commit(),Dt("batch committed")}_batchAddressBook(e,t){const r=e.toString(),n=new Bo(`${f_}${r}`),i=this.addressBook.data.get(e.toB58String());try{if(!i){t.delete(n);return}const a=op.encode({addrs:i.addresses.map(s=>({multiaddr:s.multiaddr.bytes,isCertified:s.isCertified})),certified_record:i.record?{seq:i.record.seqNumber,raw:i.record.raw}:void 0});t.put(n,a)}catch(a){Dt.error(a)}}_batchKeyBook(e,t){const r=e.toString(),n=new Bo(`${g_}${r}`);try{if(!e.pubKey){t.delete(n);return}const i=e.marshalPubKey();t.put(n,i)}catch(i){Dt.error(i)}}_batchMetadataBook(e,t){const r=e.toString(),n=this._dirtyMetadata.get(e.toB58String())||[];try{n.forEach(i=>{const a=new Bo(`${y_}${r}/${i}`),s=this.metadataBook.getValue(e,i);s?t.put(a,s):t.delete(a)})}catch(i){Dt.error(i)}}_batchProtoBook(e,t){const r=e.toString(),n=new Bo(`${b_}${r}`),i=this.protoBook.get(e);try{if(!i){t.delete(n);return}const a=cp.encode({protocols:i});t.put(n,a)}catch(a){Dt.error(a)}}async _processDatastoreEntry({key:e,value:t}){try{const r=e.toString().split("/"),n=we.createFromCID(r[3]);let i;switch(r[2]){case"addrs":i=op.decode(t),this.addressBook._setData(n,{addresses:i.addrs.map(a=>({multiaddr:Ne(a.multiaddr),isCertified:Boolean(a.isCertified)})),record:i.certified_record?{raw:i.certified_record.raw,seqNumber:i.certified_record.seq}:void 0},{emit:!1});break;case"keys":i=await we.createFromPubKey(t),this.keyBook._setData(i,i,{emit:!1});break;case"metadata":this.metadataBook._setValue(n,r[4],t,{emit:!1});break;case"protos":i=cp.decode(t),this.protoBook._setData(n,new Set(i.protocols),{emit:!1});break;default:Dt("invalid data persisted for: ",e.toString())}}catch(r){Dt.error(r)}}}var w_=v_;const up=()=>{};class __{constructor({min:e=0,max:t=Infinity,handlers:r={}}){this.min=e,this.max=t,this._onConnect=r.onConnect||up,this._onDisconnect=r.onDisconnect||up,this.peers=new Set}set registrar(e){this._registrar=e}disconnect(e){this._onDisconnect(e)}}var E_=Pr(__,{className:"Topology",symbolName:"@libp2p/js-interfaces/topology"});const S_=te("libp2p:peer-store");S_.error=te("libp2p:peer-store:error");const{ERR_INVALID_PARAMETERS:A_}=Ot;class T_{constructor({peerStore:e,connectionManager:t}){this.peerStore=e,this.connectionManager=t,this.topologies=new Map,this._handle=void 0,this._onDisconnect=this._onDisconnect.bind(this),this.connectionManager.on("peer:disconnect",this._onDisconnect)}get handle(){return this._handle}set handle(e){this._handle=e}getConnection(e){return this.connectionManager.get(e)}register(e){if(!E_.isTopology(e))throw U(new Error("topology must be an instance of interfaces/topology"),A_);const t=parseInt(Math.random()*1e9).toString(36)+Date.now();return this.topologies.set(t,e),e.registrar=this,t}unregister(e){return this.topologies.delete(e)}_onDisconnect(e,t){for(const[,r]of this.topologies)r.disconnect(e.remotePeer,t)}}var I_=T_,Ru=re(function(e){const{Buffer:t}=Yr;e.exports=async function*(r){for await(const n of r)t.isBuffer(n)?yield n:tt.isBufferList(n)?yield n.slice():yield t.from(n)},e.exports.toBuffer=e.exports,e.exports.toList=async function*(r){for await(const n of r)t.isBuffer(n)?yield new tt().append(n):tt.isBufferList(n)?yield n:yield new tt().append(t.from(n))}}),C_={PROTOCOL:"/ipfs/ping/1.0.0",PING_LENGTH:32},Lo=re(function(e,t){const r=te("libp2p-ping");r.error=te("libp2p-ping:error");const{toBuffer:n}=Ru,{collect:i,take:a}=Po,{PROTOCOL:s,PING_LENGTH:c}=C_;async function o(h,w){r("dialing %s to %s",s,w.toB58String?w.toB58String():w);const{stream:f}=await h.dialProtocol(w,s),A=new Date,p=sr.randomBytes(c),[y]=await bt([p],f,O=>a(1,O),n,i),v=Date.now();if(!p.equals(y))throw U(new Error("Received wrong ping ack"),"ERR_WRONG_PING_ACK");return v-A}function u(h){h.handle(s,({stream:w})=>bt(w,w))}function l(h){h.unhandle(s)}t=e.exports=o,t.mount=u,t.unmount=l}),k_=e=>t=>async function*(){for await(const r of t)yield e.encode(r)}(),R_=e=>t=>async function*(){for await(const r of t)yield e.decode(r)}(),Pu={encode:k_,decode:R_},P_=e=>t=>Je.encode()(Pu.encode(e)(t)),N_=e=>t=>Pu.decode(e)(Ru(Je.decode()(t))),O_=Pu,D_={encode:P_,decode:N_,it:O_};const M_=`
message Identify {
  // protocolVersion determines compatibility between peers
  optional string protocolVersion = 5; // e.g. ipfs/1.0.0

  // agentVersion is like a UserAgent string in browsers, or client version in bittorrent
  // includes the client name and client.
  optional string agentVersion = 6; // e.g. go-ipfs/0.1.0

  // publicKey is this node's public key (which also gives its node.ID)
  // - may not need to be sent, as secure channel implies it has been sent.
  // - then again, if we change / disable secure channel, may still want it.
  optional bytes publicKey = 1;

  // listenAddrs are the multiaddrs the sender node listens for open connections on
  repeated bytes listenAddrs = 2;

  // oservedAddr is the multiaddr of the remote endpoint that the sender node perceives
  // this is useful information to convey to the other side, as it helps the remote endpoint
  // determine whether its connection to the local peer goes through NAT.
  optional bytes observedAddr = 4;

  repeated string protocols = 3;

  // signedPeerRecord contains a serialized SignedEnvelope containing a PeerRecord,
  // signed by the sending node. It contains the same addresses as the listenAddrs field, but
  // in a form that lets us share authenticated addrs with other peers.
  optional bytes signedPeerRecord = 8;
}
`;var _s=Nr(M_).Identify;const x_="libp2p",B_="0.29.0",L_="JavaScript implementation of libp2p, a modular peer to peer network stack",j_="Jacob Heun <jacobheun@gmail.com>",U_="src/index.js",F_=["dist","src"],q_={lint:"aegir lint",build:"aegir build",test:"npm run test:node && npm run test:browser","test:node":'aegir test -t node -f "./test/**/*.{node,spec}.js"',"test:browser":"aegir test -t browser",release:"aegir release -t node -t browser","release-minor":"aegir release --type minor -t node -t browser","release-major":"aegir release --type major -t node -t browser",coverage:"nyc --reporter=text --reporter=lcov npm run test:node"},G_={type:"git",url:"https://github.com/libp2p/js-libp2p.git"},$_=["libp2p","network","p2p","peer","peer-to-peer","IPFS"],V_={url:"https://github.com/libp2p/js-libp2p/issues"},H_="https://libp2p.io",z_="MIT",K_={node:">=12.0.0",npm:">=6.0.0"},W_={"abort-controller":"^3.0.0","aggregate-error":"^3.0.1","any-signal":"^1.1.0","bignumber.js":"^9.0.0","class-is":"^1.1.0",debug:"^4.1.1","err-code":"^2.0.0",events:"^3.1.0",hashlru:"^2.3.0","interface-datastore":"^2.0.0","ipfs-utils":"^2.2.0","it-all":"^1.0.1","it-buffer":"^0.1.2","it-handshake":"^1.0.1","it-length-prefixed":"^3.0.1","it-pipe":"^1.1.0","it-protocol-buffers":"^0.2.0","libp2p-crypto":"^0.18.0","libp2p-interfaces":"^0.5.1","libp2p-utils":"^0.2.0",mafmt:"^8.0.0","merge-options":"^2.0.0","moving-average":"^1.0.0",multiaddr:"^8.0.0",multicodec:"^2.0.0","multistream-select":"^1.0.0","mutable-proxy":"^1.0.0","node-forge":"^0.9.1","p-any":"^3.0.0","p-fifo":"^1.0.0","p-settle":"^4.0.1","peer-id":"^0.14.0",protons:"^2.0.0",retimer:"^2.0.0","sanitize-filename":"^1.6.3","streaming-iterables":"^5.0.2","timeout-abort-controller":"^1.1.1",varint:"^5.0.0",xsalsa20:"^1.0.2"},X_={"@nodeutils/defaults-deep":"^1.1.0","abortable-iterator":"^3.0.0",aegir:"^26.0.0",chai:"^4.2.0","chai-as-promised":"^7.1.1","chai-bytes":"^0.1.2","chai-string":"^1.5.0",cids:"^1.0.0",delay:"^4.3.0","dirty-chai":"^2.0.1","interop-libp2p":"^0.3.0","ipfs-http-client":"^46.0.0","it-concat":"^1.0.0","it-pair":"^1.0.0","it-pushable":"^1.4.0",libp2p:".","libp2p-bootstrap":"^0.12.0","libp2p-delegated-content-routing":"^0.6.0","libp2p-delegated-peer-routing":"^0.6.0","libp2p-floodsub":"^0.23.0","libp2p-gossipsub":"^0.6.0","libp2p-kad-dht":"^0.20.0","libp2p-mdns":"^0.15.0","libp2p-mplex":"^0.10.0","libp2p-noise":"^2.0.0","libp2p-secio":"^0.13.1","libp2p-tcp":"^0.15.1","libp2p-webrtc-star":"^0.20.0","libp2p-websockets":"^0.14.0",multihashes:"^3.0.1",nock:"^13.0.3","p-defer":"^3.0.0","p-times":"^3.0.0","p-wait-for":"^3.1.0","promisify-es6":"^1.0.3",rimraf:"^3.0.2",sinon:"^9.0.2",uint8arrays:"^1.1.0"},Q_=["David Dias <daviddias.p@gmail.com>","Jacob Heun <jacobheun@gmail.com>","Vasco Santos <vasco.santos@moxy.studio>","Alan Shaw <alan@tableflip.io>","Alex Potsides <alex@achingbrain.net>","Cayman <caymannava@gmail.com>","Pedro Teixeira <i@pgte.me>","Friedel Ziegelmayer <dignifiedquire@gmail.com>","Maciej Kr\xFCger <mkg20001@gmail.com>","Hugo Dias <mail@hugodias.me>","Volker Mische <volker.mische@gmail.com>","dirkmc <dirkmdev@gmail.com>","Richard Littauer <richard.littauer@gmail.com>","\u1D20\u026A\u1D04\u1D1B\u1D0F\u0280 \u0299\u1D0A\u1D07\u029F\u1D0B\u029C\u1D0F\u029F\u1D0D <victorbjelkholm@gmail.com>","Andrew Nesbitt <andrewnez@gmail.com>","Elven <mon.samuel@qq.com>","Giovanni T. Parra <fiatjaf@gmail.com>","Ryan Bell <ryan@piing.net>","Thomas Eizinger <thomas@eizinger.io>","Didrik Nordstr\xF6m <didrik@betamos.se>","Francis Gulotta <wizard@roborooter.com>","Florian-Merle <florian.david.merle@gmail.com>","Joel Gustafson <joelg@mit.edu>","Julien Bouquillon <contact@revolunet.com>","Kevin Kwok <antimatter15@gmail.com>","Felipe Martins <felipebrasil93@gmail.com>","Nuno Nogueira <nunofmn@gmail.com>","Fei Liu <liu.feiwood@gmail.com>","RasmusErik Voel Jensen <github@solsort.com>","Dmitriy Ryajov <dryajov@gmail.com>","Soeren <nikorpoulsen@gmail.com>","S\xF6nke Hahn <soenkehahn@gmail.com>","Tiago Alves <alvesjtiago@gmail.com>","Diogo Silva <fsdiogo@gmail.com>","Yusef Napora <yusef@napora.org>","Zane Starr <zcstarr@gmail.com>","Daijiro Wachi <daijiro.wachi@gmail.com>","Chris Bratlien <chrisbratlien@gmail.com>","ebinks <elizabethjbinks@gmail.com>","Bernd Strehl <bernd.strehl@gmail.com>","isan_rivkin <isanrivkin@gmail.com>","Henrique Dias <hacdias@gmail.com>","robertkiel <robert.kiel@validitylabs.org>","Irakli Gozalishvili <rfobic@gmail.com>"];var Y_={name:x_,version:B_,description:L_,leadMaintainer:j_,main:U_,files:F_,scripts:q_,repository:G_,keywords:$_,bugs:V_,homepage:H_,license:z_,engines:K_,dependencies:W_,devDependencies:X_,contributors:Q_};const J_=Y_.version;var Z_="ipfs/0.1.0",eE=`js-libp2p/${J_}`,tE="/ipfs/id/1.0.0",rE="/ipfs/id/push/1.0.0",nE={PROTOCOL_VERSION:Z_,AGENT_VERSION:eE,MULTICODEC_IDENTIFY:tE,MULTICODEC_IDENTIFY_PUSH:rE};const Lr=te("libp2p:identify");Lr.error=te("libp2p:identify:error");const{collect:lp,take:dp,consume:hp}=Po,{toBuffer:pp}=Ru,{MULTICODEC_IDENTIFY:Nu,MULTICODEC_IDENTIFY_PUSH:jo,AGENT_VERSION:iE,PROTOCOL_VERSION:aE}=nE,{codes:Ou}=Ot;class fp{static getCleanMultiaddr(e){if(e&&e.length>0)try{return Ne(e)}catch(t){return null}return null}constructor({libp2p:e,protocols:t}){this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.connectionManager.on("peer:connect",r=>{const n=r.remotePeer;this.identify(r,n).catch(Lr.error)}),this.peerId=e.peerId,this._libp2p=e,this._protocols=t,this.handleMessage=this.handleMessage.bind(this)}async push(e){const t=await this._getSelfPeerRecord(),r=this._libp2p.multiaddrs.map(a=>a.bytes),n=Array.from(this._protocols.keys()),i=e.map(async a=>{try{const{stream:s}=await a.newStream(jo);await bt([{listenAddrs:r,signedPeerRecord:t,protocols:n}],D_.encode(_s),s,hp)}catch(s){Lr.error("could not push identify update to peer",s)}});return Promise.all(i)}pushToPeerStore(e){const t=[];let r;for(const n of e.peers.values())n.protocols.includes(jo)&&(r=this.connectionManager.get(n.id))&&t.push(r);this.push(t)}async identify(e){const{stream:t}=await e.newStream(Nu),[r]=await bt([],t,Je.decode(),dp(1),pp,lp);if(!r)throw U(new Error("No data could be retrieved"),Ou.ERR_CONNECTION_ENDED);let n;try{n=_s.decode(r)}catch(l){throw U(l,Ou.ERR_INVALID_MESSAGE)}let{publicKey:i,listenAddrs:a,protocols:s,observedAddr:c,signedPeerRecord:o}=n;const u=await we.createFromPubKey(i);if(e.remotePeer.toB58String()!==u.toB58String())throw U(new Error("identified peer does not match the expected peer"),Ou.ERR_INVALID_PEER);c=fp.getCleanMultiaddr(c);try{const l=await ws.openAndCertify(o,Do.DOMAIN);if(this.peerStore.addressBook.consumePeerRecord(l)){this.peerStore.protoBook.set(u,s);return}}catch(l){Lr("received invalid envelope, discard it and fallback to listenAddrs is available",l)}try{this.peerStore.addressBook.set(u,a.map(l=>Ne(l)))}catch(l){Lr.error("received invalid addrs",l)}this.peerStore.protoBook.set(u,s),this.peerStore.metadataBook.set(u,"AgentVersion",at(n.agentVersion)),Lr("received observed address of %s",c)}handleMessage({connection:e,stream:t,protocol:r}){switch(r){case Nu:return this._handleIdentify({connection:e,stream:t});case jo:return this._handlePush({connection:e,stream:t});default:Lr.error("cannot handle unknown protocol %s",r)}}async _handleIdentify({connection:e,stream:t}){let r=new Uint8Array(0);this.peerId.pubKey&&(r=this.peerId.pubKey.bytes);const n=await this._getSelfPeerRecord(),i=_s.encode({protocolVersion:aE,agentVersion:iE,publicKey:r,listenAddrs:this._libp2p.multiaddrs.map(a=>a.bytes),signedPeerRecord:n,observedAddr:e.remoteAddr.bytes,protocols:Array.from(this._protocols.keys())});try{await bt([i],Je.encode(),t,hp)}catch(a){Lr.error("could not respond to identify request",a)}}async _handlePush({connection:e,stream:t}){let r;try{const[i]=await bt([],t,Je.decode(),dp(1),pp,lp);r=_s.decode(i)}catch(i){return Lr.error("received invalid message",i)}const n=e.remotePeer;try{const i=await ws.openAndCertify(r.signedPeerRecord,Do.DOMAIN);if(this.peerStore.addressBook.consumePeerRecord(i)){this.peerStore.protoBook.set(n,r.protocols);return}}catch(i){Lr("received invalid envelope, discard it and fallback to listenAddrs is available",i)}try{this.peerStore.addressBook.set(n,r.listenAddrs.map(i=>Ne(i)))}catch(i){Lr.error("received invalid addrs",i)}this.peerStore.protoBook.set(n,r.protocols)}async _getSelfPeerRecord(){const e=this.peerStore.addressBook.getRawEnvelope(this.peerId);if(e)return e;try{const t=new Do({peerId:this.peerId,multiaddrs:this._libp2p.multiaddrs}),r=await ws.seal(t,this.peerId);return this.peerStore.addressBook.consumePeerRecord(r),this.peerStore.addressBook.getRawEnvelope(this.peerId)}catch(t){Lr.error("failed to get self peer record")}return null}}var sE=fp,oE={IDENTIFY:Nu,IDENTIFY_PUSH:jo},cE=_s,uE={IdentifyService:sE,multicodecs:oE,Message:cE};const{EventEmitter:lE}=At,yr=te("libp2p");yr.error=te("libp2p:error");const{validate:dE}=Ry,{codes:mp,messages:hE}=Ot,{IdentifyService:pE,multicodecs:fE}=uE;class Uo extends lE{constructor(e){super();if(this._options=dE(e),this.peerId=this._options.peerId,this.datastore=this._options.datastore,this.peerStore=this.datastore&&this._options.peerStore.persistence?new w_({peerId:this.peerId,datastore:this.datastore,...this._options.peerStore}):new sp({peerId:this.peerId}),this.addresses=this._options.addresses,this.addressManager=new Oy(this._options.addresses),this._modules=this._options.modules,this._config=this._options.config,this._transport=[],this._discovery=new Map,this._options.connectionManager.minPeers&&(this._options.connectionManager.minConnections=this._options.connectionManager.minPeers),this.connectionManager=new qy(this,{autoDial:this._config.peerDiscovery.autoDial,...this._options.connectionManager}),this._options.metrics.enabled&&(this.metrics=new f0({...this._options.metrics,connectionManager:this.connectionManager})),this._options.keychain&&this._options.keychain.datastore){yr("creating keychain");const r=Ph.generateOptions();this.keychain=new Ph(this._options.keychain.datastore,{passPhrase:this._options.keychain.pass,...r,...this._options.keychain}),yr("keychain constructed")}if(this.upgrader=new O0({localPeer:this.peerId,metrics:this.metrics,onConnection:r=>this.connectionManager.onConnect(r),onConnectionEnd:r=>this.connectionManager.onDisconnect(r)}),this.transportManager=new Od({libp2p:this,upgrader:this.upgrader,faultTolerance:this._options.transportManager.faultTolerance}),this.registrar=new I_({peerStore:this.peerStore,connectionManager:this.connectionManager}),this.handle=this.handle.bind(this),this.registrar.handle=this.handle,!this._modules.connEncryption||!this._modules.connEncryption.length)throw U(new Error(hE.CONN_ENCRYPTION_REQUIRED),mp.CONN_ENCRYPTION_REQUIRED);const t=this._modules.connEncryption;if(t.forEach(r=>{this.upgrader.cryptos.set(r.protocol,r)}),this.dialer=new _v({transportManager:this.transportManager,peerStore:this.peerStore,concurrency:this._options.dialer.maxParallelDials,perPeerLimit:this._options.dialer.maxDialsPerPeer,timeout:this._options.dialer.dialTimeout}),this._modules.transport.forEach(r=>{const n=r.prototype[Symbol.toStringTag],i=this._config.transport[n];this.transportManager.add(n,r,i)}),this._config.relay.enabled&&this.transportManager.add(dh.prototype[Symbol.toStringTag],dh),this._modules.streamMuxer){const r=this._modules.streamMuxer;r.forEach(n=>{this.upgrader.muxers.set(n.multicodec,n)}),this.identifyService=new pE({libp2p:this,protocols:this.upgrader.protocols}),this.handle(Object.values(fE),this.identifyService.handleMessage)}if(this._modules.connProtector)this.upgrader.protector=this._modules.connProtector;else if(jn.process!==void 0&&jn.process.env&&jn.process.env.LIBP2P_FORCE_PNET)throw new Error("Private network is enforced, but no protector was provided");if(this._modules.dht){const r=this._modules.dht;this._dht=new r({libp2p:this,dialer:this.dialer,peerId:this.peerId,peerStore:this.peerStore,registrar:this.registrar,datastore:this.datastore,...this._config.dht})}if(this._modules.pubsub){const r=this._modules.pubsub;this.pubsub=a_(r,this,this._config.pubsub)}this.peerRouting=Wg(this),this.contentRouting=Zg(this),Lo.mount(this),this._onDiscoveryPeer=this._onDiscoveryPeer.bind(this)}emit(e,...t){e==="error"&&!this._events.error?yr.error(...t):super.emit(e,...t)}async start(){yr("libp2p is starting");try{await this._onStarting(),await this._onDidStart(),yr("libp2p has started")}catch(e){throw this.emit("error",e),yr.error("An error occurred starting libp2p",e),await this.stop(),e}}async stop(){yr("libp2p is stopping");try{for(const e of this._discovery.values())e.removeListener("peer",this._onDiscoveryPeer);await Promise.all(Array.from(this._discovery.values(),e=>e.stop())),this._discovery=new Map,await this.peerStore.stop(),await this.connectionManager.stop(),await Promise.all([this.pubsub&&this.pubsub.stop(),this._dht&&this._dht.stop(),this.metrics&&this.metrics.stop()]),await this.transportManager.close(),Lo.unmount(this),this.dialer.destroy()}catch(e){e&&(yr.error(e),this.emit("error",e))}this._isStarted=!1,yr("libp2p has stopped")}async loadKeychain(){try{await this.keychain.findKeyByName("self")}catch(e){await this.keychain.importPeer("self",this.peerId)}}isStarted(){return this._isStarted}get connections(){return this.connectionManager.connections}dial(e,t){return this.dialProtocol(e,null,t)}async dialProtocol(e,t,r){const{id:n,multiaddrs:i}=po(e);let a=this.connectionManager.get(n);return a?i&&this.peerStore.addressBook.add(n,i):a=await this.dialer.connectToPeer(e,r),t?a.newStream(t):a}get multiaddrs(){const e=this.addressManager.getNoAnnounceAddrs();return this.transportManager.getAddrs().concat(this.addressManager.getAnnounceAddrs()).filter((t,r,n)=>n.findIndex(i=>i.equals(t))!==r?!1:!e.find(i=>i.equals(t)))}async hangUp(e){const{id:t}=po(e),r=this.connectionManager.connections.get(t.toB58String());if(!r)return;await Promise.all(r.map(n=>n.close()))}ping(e){const{id:t,multiaddrs:r}=po(e);return r?Lo(this,r[0]):Lo(this,t)}handle(e,t){e=Array.isArray(e)?e:[e],e.forEach(r=>{this.upgrader.protocols.set(r,t)}),this.isStarted()&&this.identifyService&&this.identifyService.pushToPeerStore(this.peerStore)}unhandle(e){e=Array.isArray(e)?e:[e],e.forEach(t=>{this.upgrader.protocols.delete(t)}),this.isStarted()&&this.identifyService&&this.identifyService.pushToPeerStore(this.peerStore)}async _onStarting(){await this.transportManager.listen(),await this.peerStore.start(),this._config.pubsub.enabled&&(this.pubsub&&this.pubsub.start()),this._config.dht.enabled&&(this._dht&&this._dht.start(),this._dht.on("peer",this._onDiscoveryPeer)),this.metrics&&this.metrics.start()}async _onDidStart(){this._isStarted=!0,this.peerStore.on("peer",e=>{this.emit("peer:discovery",e),this._maybeConnect(e)});for(const e of this.peerStore.peers.values())this.emit("peer:discovery",e.id);this.connectionManager.start(),await this._setupPeerDiscovery()}_onDiscoveryPeer(e){if(e.id.toB58String()===this.peerId.toB58String()){yr.error(new Error(mp.ERR_DISCOVERED_SELF));return}e.multiaddrs&&this.peerStore.addressBook.add(e.id,e.multiaddrs),e.protocols&&this.peerStore.protoBook.set(e.id,e.protocols)}async _maybeConnect(e){if(this._config.peerDiscovery.autoDial===!0&&!this.connectionManager.get(e)){const t=this._options.connectionManager.minConnections||0;if(t>this.connectionManager.size){yr("connecting to discovered peer %s",e.toB58String());try{await this.dialer.connectToPeer(e)}catch(r){yr.error("could not connect to discovered peer",r)}}}}async _setupPeerDiscovery(){const e=t=>{let r={enabled:!0};if(t.tag&&this._config.peerDiscovery&&this._config.peerDiscovery[t.tag]&&(r={...r,...this._config.peerDiscovery[t.tag]}),r.enabled&&!this._discovery.has(t.tag)){let n;typeof t=="function"?n=new t(Object.assign({},r,{peerId:this.peerId,libp2p:this})):n=t,n.on("peer",this._onDiscoveryPeer),this._discovery.set(t.tag,n)}};for(const t of this._modules.peerDiscovery||[])e(t);for(const t of this.transportManager.getTransports())t.discovery&&e(t.discovery);await Promise.all(Array.from(this._discovery.values(),t=>t.start()))}}Uo.create=async function(t={}){if(t.peerId)return new Uo(t);const r=await we.create();return t.peerId=r,new Uo(t)};var mE=Uo,gE=typeof WebSocket=="undefined"?Ln:WebSocket,Du=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(i){if(this.isStopped)return;const a={value:i,done:!1};if(this.pullQueue.length){const s=this.pullQueue.shift();s&&s.resolve(a)}else this.pushQueue.push(Promise.resolve(a)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(this.isStopped)return;this.isStopped=!0,this.remove();for(const i of this.pullQueue)i.resolve({value:void 0,done:!0});this.pullQueue.length=0}fail(i){if(this.isStopped)return;if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const a of this.pullQueue)a.reject(i);this.pullQueue.length=0}else{const a=Promise.reject(i);a.catch(()=>{}),this.pushQueue.push(a)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:i=>{const a=this.pushQueue.shift();return a?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),a):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((s,c)=>{this.pullQueue.push({resolve:s,reject:c})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class n{constructor(i,{highWaterMark:a=100,lowWaterMark:s=1}={}){const c=new r;c.highWaterMark=a,c.lowWaterMark=s,c.removeCallback=i({push:o=>c.push(o),stop:()=>c.stop(),fail:o=>c.fail(o),on:(o,u)=>{c.eventHandlers[o]=u}})||(()=>{}),this[Symbol.asyncIterator]=()=>c[Symbol.asyncIterator](),Object.freeze(this)}}t.EventIterator=n,t.default=n}),yE=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventIterator=Du.EventIterator;function r(n,i,a){return new Du.EventIterator(({push:s})=>(this.addEventListener(n,s,i),()=>this.removeEventListener(n,s,i)),a)}t.subscribe=r,t.default=Du.EventIterator});const{Buffer:bE}=Yr,{EventIterator:vE}=yE;function wE(e){return e instanceof ArrayBuffer||e!=null&&e.constructor!=null&&e.constructor.name==="ArrayBuffer"&&typeof e.byteLength=="number"}var gp=e=>{const t=e.removeEventListener||e.removeListener,r=async function*(){const a=new vE(({push:s,stop:c,fail:o})=>(e.addEventListener("message",s),e.addEventListener("error",o),e.addEventListener("close",c),()=>{t.call(e,"message",s),t.call(e,"error",o),t.call(e,"close",c)}),{highWaterMark:Infinity});for await(const{data:s}of a)yield wE(s)?bE.from(s):s}();let n=e.readyState===1,i;return e.addEventListener("open",()=>{n=!0,i=null}),e.addEventListener("close",()=>{n=!1,i=null}),e.addEventListener("error",a=>{n||(i=a)}),r.connected=()=>new Promise((a,s)=>{if(n)return a();if(i)return s(i);const c=l=>{t.call(e,"open",o),t.call(e,"error",u),l()},o=()=>c(a),u=l=>c(()=>s(l));e.addEventListener("open",o),e.addEventListener("error",u)}),r},_E=async e=>{if(e.readyState>=2)throw new Error("socket closed");return e.readyState===1?void 0:new Promise((t,r)=>{const n=e&&(e.removeEventListener||e.removeListener);function i(){typeof n=="function"&&(n.call(e,"open",a),n.call(e,"error",s))}function a(){i(),t()}function s(c){i(),r(c)}e.addEventListener("open",a),e.addEventListener("error",s)})},yp=(e,t)=>(t=t||{},t.closeOnEnd=t.closeOnEnd!==!1,async r=>{for await(const n of r){try{await _E(e)}catch(i){if(i.message==="socket closed")break;throw i}e.send(n)}if(t.closeOnEnd&&e.readyState<=1)return new Promise((n,i)=>{e.addEventListener("close",a=>{if(a.wasClean||a.code===1006)n();else{const s=Object.assign(new Error("ws error"),{event:a});i(s)}}),setTimeout(()=>e.close())})}),bp=(e,t)=>{t=t||{},t.binaryType?e.binaryType=t.binaryType:t.binary&&(e.binaryType="arraybuffer");const r={sink:yp(e,t),source:gp(e),connected:()=>r.source.connected()};return r},EE=function(e,t,r,n){r=r||{};var e=os.parse(e,!1,!0),i;return e.protocol?i=e.protocol:(i=t.protocol?t.protocol.replace(/:$/,""):"http",i=(r[i]||n||i)+":"),e.host&&e.host[0]===":"&&(e.host=null),e.hostname?os.format({protocol:i,slashes:!0,hostname:e.hostname,port:e.port,pathname:e.pathname,search:e.search}):(e.host=t.host,e.port?os.format({protocol:i,slashes:!0,host:t.hostname+":"+e.port,port:e.port,pathname:e.pathname,search:e.search}):e.pathname?os.format({protocol:i,slashes:!0,host:e.host,pathname:e.pathname,search:e.search}):(e.pathname=t.pathname,e.search?os.format({protocol:i,slashes:!0,host:e.host,pathname:e.pathname,search:e.search}):(e.search=t.search,e.format(e))))};const SE={http:"ws",https:"wss"},AE="ws";var TE=(e,t)=>EE(e,t,SE,AE),vp=re(function(e){e.exports=function(t,r={}){const n=typeof window=="undefined"?{}:window.location,i=TE(t,n),a=new gE(i,r.websocket),s=bp(a,r);return s.remoteAddress=i,s.close=()=>new Promise((c,o)=>{a.addEventListener("close",c),a.close()}),s.destroy=()=>{a.terminate?a.terminate():a.close()},s.socket=a,s},e.exports.connect=e.exports});const Fo=(e,t)=>t,IE=(e,t,r,n)=>{if(n&&n.assumeHttp===!1)return`tcp://${e}:${t}`;let i="tcp",a=`:${t}`;const s=r[r.length-1];return s.protocol==="tcp"&&(i=t==="443"?"https":"http",a=t==="443"||t==="80"?"":a),`${i}://${e}${a}`},CE={ip4:Fo,ip6:(e,t,r,n)=>n.length===1&&n[0].protocol==="ip6"?t:`[${t}]`,tcp:(e,t,r,n,i)=>n.some(a=>["http","https","ws","wss"].includes(a.protocol))?`${e}:${t}`:IE(e,t,n,i),udp:(e,t)=>`udp://${e}:${t}`,dnsaddr:Fo,dns4:Fo,dns6:Fo,ipfs:(e,t)=>`${e}/ipfs/${t}`,p2p:(e,t)=>`${e}/p2p/${t}`,http:e=>`http://${e}`,https:e=>`https://${e}`,ws:e=>`ws://${e}`,wss:e=>`wss://${e}`,"p2p-websocket-star":e=>`${e}/p2p-websocket-star`,"p2p-webrtc-star":e=>`${e}/p2p-webrtc-star`,"p2p-webrtc-direct":e=>`${e}/p2p-webrtc-direct`};var kE=(e,t)=>{const r=Ne(e),n=e.toString().split("/").slice(1);return r.tuples().map(i=>({protocol:n.shift(),content:i[1]?n.shift():null})).reduce((i,a,s,c)=>{const o=CE[a.protocol];if(!o)throw new Error(`Unsupported protocol ${a.protocol}`);return o(i,a.content,s,c,t)},"")},RE=re(function(e,t){t=e.exports=bp,t.source=gp,t.sink=yp,t.createServer=Ln,t.connect=vp}),PE=421,NE=290,OE=2e3,wp={CODE_P2P:PE,CODE_CIRCUIT:NE,CLOSE_TIMEOUT:OE},_p=re(function(e,t){(function(){var r,n=244837814094590,i=(n&16777215)==15715070;function a(T,C,N){T!=null&&(typeof T=="number"?this.fromNumber(T,C,N):C==null&&typeof T!="string"?this.fromString(T,256):this.fromString(T,C))}function s(){return new a(null)}function c(T,C,N,F,X,Y){for(;--Y>=0;){var ne=C*this[T++]+N[F]+X;X=Math.floor(ne/67108864),N[F++]=ne&67108863}return X}function o(T,C,N,F,X,Y){for(var ne=C&32767,ae=C>>15;--Y>=0;){var xe=this[T]&32767,Ze=this[T++]>>15,gt=ae*xe+Ze*ne;xe=ne*xe+((gt&32767)<<15)+N[F]+(X&1073741823),X=(xe>>>30)+(gt>>>15)+ae*Ze+(X>>>30),N[F++]=xe&1073741823}return X}function u(T,C,N,F,X,Y){for(var ne=C&16383,ae=C>>14;--Y>=0;){var xe=this[T]&16383,Ze=this[T++]>>14,gt=ae*xe+Ze*ne;xe=ne*xe+((gt&16383)<<14)+N[F]+X,X=(xe>>28)+(gt>>14)+ae*Ze,N[F++]=xe&268435455}return X}var l=typeof navigator!="undefined";l&&i&&navigator.appName=="Microsoft Internet Explorer"?(a.prototype.am=o,r=30):l&&i&&navigator.appName!="Netscape"?(a.prototype.am=c,r=26):(a.prototype.am=u,r=28),a.prototype.DB=r,a.prototype.DM=(1<<r)-1,a.prototype.DV=1<<r;var h=52;a.prototype.FV=Math.pow(2,h),a.prototype.F1=h-r,a.prototype.F2=2*r-h;var w="0123456789abcdefghijklmnopqrstuvwxyz",f=new Array,A,p;for(A="0".charCodeAt(0),p=0;p<=9;++p)f[A++]=p;for(A="a".charCodeAt(0),p=10;p<36;++p)f[A++]=p;for(A="A".charCodeAt(0),p=10;p<36;++p)f[A++]=p;function y(T){return w.charAt(T)}function v(T,C){var N=f[T.charCodeAt(C)];return N??-1}function O(T){for(var C=this.t-1;C>=0;--C)T[C]=this[C];T.t=this.t,T.s=this.s}function R(T){this.t=1,this.s=T<0?-1:0,T>0?this[0]=T:T<-1?this[0]=T+this.DV:this.t=0}function m(T){var C=s();return C.fromInt(T),C}function g(T,C){var N;if(C==16)N=4;else if(C==8)N=3;else if(C==256)N=8;else if(C==2)N=1;else if(C==32)N=5;else if(C==4)N=2;else{this.fromRadix(T,C);return}this.t=0,this.s=0;for(var F=T.length,X=!1,Y=0;--F>=0;){var ne=N==8?T[F]&255:v(T,F);if(ne<0){T.charAt(F)=="-"&&(X=!0);continue}X=!1,Y==0?this[this.t++]=ne:Y+N>this.DB?(this[this.t-1]|=(ne&(1<<this.DB-Y)-1)<<Y,this[this.t++]=ne>>this.DB-Y):this[this.t-1]|=ne<<Y,Y+=N,Y>=this.DB&&(Y-=this.DB)}N==8&&(T[0]&128)!=0&&(this.s=-1,Y>0&&(this[this.t-1]|=(1<<this.DB-Y)-1<<Y)),this.clamp(),X&&a.ZERO.subTo(this,this)}function S(){for(var T=this.s&this.DM;this.t>0&&this[this.t-1]==T;)--this.t}function d(T){if(this.s<0)return"-"+this.negate().toString(T);var C;if(T==16)C=4;else if(T==8)C=3;else if(T==2)C=1;else if(T==32)C=5;else if(T==4)C=2;else return this.toRadix(T);var N=(1<<C)-1,F,X=!1,Y="",ne=this.t,ae=this.DB-ne*this.DB%C;if(ne-- >0)for(ae<this.DB&&(F=this[ne]>>ae)>0&&(X=!0,Y=y(F));ne>=0;)ae<C?(F=(this[ne]&(1<<ae)-1)<<C-ae,F|=this[--ne]>>(ae+=this.DB-C)):(F=this[ne]>>(ae-=C)&N,ae<=0&&(ae+=this.DB,--ne)),F>0&&(X=!0),X&&(Y+=y(F));return X?Y:"0"}function b(){var T=s();return a.ZERO.subTo(this,T),T}function E(){return this.s<0?this.negate():this}function _(T){var C=this.s-T.s;if(C!=0)return C;var N=this.t;if(C=N-T.t,C!=0)return this.s<0?-C:C;for(;--N>=0;)if((C=this[N]-T[N])!=0)return C;return 0}function P(T){var C=1,N;return(N=T>>>16)!=0&&(T=N,C+=16),(N=T>>8)!=0&&(T=N,C+=8),(N=T>>4)!=0&&(T=N,C+=4),(N=T>>2)!=0&&(T=N,C+=2),(N=T>>1)!=0&&(T=N,C+=1),C}function M(){return this.t<=0?0:this.DB*(this.t-1)+P(this[this.t-1]^this.s&this.DM)}function j(T,C){var N;for(N=this.t-1;N>=0;--N)C[N+T]=this[N];for(N=T-1;N>=0;--N)C[N]=0;C.t=this.t+T,C.s=this.s}function L(T,C){for(var N=T;N<this.t;++N)C[N-T]=this[N];C.t=Math.max(this.t-T,0),C.s=this.s}function B(T,C){var N=T%this.DB,F=this.DB-N,X=(1<<F)-1,Y=Math.floor(T/this.DB),ne=this.s<<N&this.DM,ae;for(ae=this.t-1;ae>=0;--ae)C[ae+Y+1]=this[ae]>>F|ne,ne=(this[ae]&X)<<N;for(ae=Y-1;ae>=0;--ae)C[ae]=0;C[Y]=ne,C.t=this.t+Y+1,C.s=this.s,C.clamp()}function $(T,C){C.s=this.s;var N=Math.floor(T/this.DB);if(N>=this.t){C.t=0;return}var F=T%this.DB,X=this.DB-F,Y=(1<<F)-1;C[0]=this[N]>>F;for(var ne=N+1;ne<this.t;++ne)C[ne-N-1]|=(this[ne]&Y)<<X,C[ne-N]=this[ne]>>F;F>0&&(C[this.t-N-1]|=(this.s&Y)<<X),C.t=this.t-N,C.clamp()}function V(T,C){for(var N=0,F=0,X=Math.min(T.t,this.t);N<X;)F+=this[N]-T[N],C[N++]=F&this.DM,F>>=this.DB;if(T.t<this.t){for(F-=T.s;N<this.t;)F+=this[N],C[N++]=F&this.DM,F>>=this.DB;F+=this.s}else{for(F+=this.s;N<T.t;)F-=T[N],C[N++]=F&this.DM,F>>=this.DB;F-=T.s}C.s=F<0?-1:0,F<-1?C[N++]=this.DV+F:F>0&&(C[N++]=F),C.t=N,C.clamp()}function W(T,C){var N=this.abs(),F=T.abs(),X=N.t;for(C.t=X+F.t;--X>=0;)C[X]=0;for(X=0;X<F.t;++X)C[X+N.t]=N.am(0,F[X],C,X,0,N.t);C.s=0,C.clamp(),this.s!=T.s&&a.ZERO.subTo(C,C)}function se(T){for(var C=this.abs(),N=T.t=2*C.t;--N>=0;)T[N]=0;for(N=0;N<C.t-1;++N){var F=C.am(N,C[N],T,2*N,0,1);(T[N+C.t]+=C.am(N+1,2*C[N],T,2*N+1,F,C.t-N-1))>=C.DV&&(T[N+C.t]-=C.DV,T[N+C.t+1]=1)}T.t>0&&(T[T.t-1]+=C.am(N,C[N],T,2*N,0,1)),T.s=0,T.clamp()}function oe(T,C,N){var F=T.abs();if(F.t<=0)return;var X=this.abs();if(X.t<F.t){C!=null&&C.fromInt(0),N!=null&&this.copyTo(N);return}N==null&&(N=s());var Y=s(),ne=this.s,ae=T.s,xe=this.DB-P(F[F.t-1]);xe>0?(F.lShiftTo(xe,Y),X.lShiftTo(xe,N)):(F.copyTo(Y),X.copyTo(N));var Ze=Y.t,gt=Y[Ze-1];if(gt==0)return;var Nt=gt*(1<<this.F1)+(Ze>1?Y[Ze-2]>>this.F2:0),tr=this.FV/Nt,gr=(1<<this.F1)/Nt,Ut=1<<this.F2,We=N.t,yt=We-Ze,Cr=C??s();for(Y.dlShiftTo(yt,Cr),N.compareTo(Cr)>=0&&(N[N.t++]=1,N.subTo(Cr,N)),a.ONE.dlShiftTo(Ze,Cr),Cr.subTo(Y,Y);Y.t<Ze;)Y[Y.t++]=0;for(;--yt>=0;){var xn=N[--We]==gt?this.DM:Math.floor(N[We]*tr+(N[We-1]+Ut)*gr);if((N[We]+=Y.am(0,xn,N,yt,0,Ze))<xn)for(Y.dlShiftTo(yt,Cr),N.subTo(Cr,N);N[We]<--xn;)N.subTo(Cr,N)}C!=null&&(N.drShiftTo(Ze,C),ne!=ae&&a.ZERO.subTo(C,C)),N.t=Ze,N.clamp(),xe>0&&N.rShiftTo(xe,N),ne<0&&a.ZERO.subTo(N,N)}function Ee(T){var C=s();return this.abs().divRemTo(T,null,C),this.s<0&&C.compareTo(a.ZERO)>0&&T.subTo(C,C),C}function fe(T){this.m=T}function me(T){return T.s<0||T.compareTo(this.m)>=0?T.mod(this.m):T}function pe(T){return T}function k(T){T.divRemTo(this.m,null,T)}function K(T,C,N){T.multiplyTo(C,N),this.reduce(N)}function Q(T,C){T.squareTo(C),this.reduce(C)}fe.prototype.convert=me,fe.prototype.revert=pe,fe.prototype.reduce=k,fe.prototype.mulTo=K,fe.prototype.sqrTo=Q;function Z(){if(this.t<1)return 0;var T=this[0];if((T&1)==0)return 0;var C=T&3;return C=C*(2-(T&15)*C)&15,C=C*(2-(T&255)*C)&255,C=C*(2-((T&65535)*C&65535))&65535,C=C*(2-T*C%this.DV)%this.DV,C>0?this.DV-C:-C}function ie(T){this.m=T,this.mp=T.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<T.DB-15)-1,this.mt2=2*T.t}function ue(T){var C=s();return T.abs().dlShiftTo(this.m.t,C),C.divRemTo(this.m,null,C),T.s<0&&C.compareTo(a.ZERO)>0&&this.m.subTo(C,C),C}function he(T){var C=s();return T.copyTo(C),this.reduce(C),C}function ce(T){for(;T.t<=this.mt2;)T[T.t++]=0;for(var C=0;C<this.m.t;++C){var N=T[C]&32767,F=N*this.mpl+((N*this.mph+(T[C]>>15)*this.mpl&this.um)<<15)&T.DM;for(N=C+this.m.t,T[N]+=this.m.am(0,F,T,C,0,this.m.t);T[N]>=T.DV;)T[N]-=T.DV,T[++N]++}T.clamp(),T.drShiftTo(this.m.t,T),T.compareTo(this.m)>=0&&T.subTo(this.m,T)}function Te(T,C){T.squareTo(C),this.reduce(C)}function J(T,C,N){T.multiplyTo(C,N),this.reduce(N)}ie.prototype.convert=ue,ie.prototype.revert=he,ie.prototype.reduce=ce,ie.prototype.mulTo=J,ie.prototype.sqrTo=Te;function He(){return(this.t>0?this[0]&1:this.s)==0}function Gr(T,C){if(T>4294967295||T<1)return a.ONE;var N=s(),F=s(),X=C.convert(this),Y=P(T)-1;for(X.copyTo(N);--Y>=0;)if(C.sqrTo(N,F),(T&1<<Y)>0)C.mulTo(F,X,N);else{var ne=N;N=F,F=ne}return C.revert(N)}function cn(T,C){var N;return T<256||C.isEven()?N=new fe(C):N=new ie(C),this.exp(T,N)}a.prototype.copyTo=O,a.prototype.fromInt=R,a.prototype.fromString=g,a.prototype.clamp=S,a.prototype.dlShiftTo=j,a.prototype.drShiftTo=L,a.prototype.lShiftTo=B,a.prototype.rShiftTo=$,a.prototype.subTo=V,a.prototype.multiplyTo=W,a.prototype.squareTo=se,a.prototype.divRemTo=oe,a.prototype.invDigit=Z,a.prototype.isEven=He,a.prototype.exp=Gr,a.prototype.toString=d,a.prototype.negate=b,a.prototype.abs=E,a.prototype.compareTo=_,a.prototype.bitLength=M,a.prototype.mod=Ee,a.prototype.modPowInt=cn,a.ZERO=m(0),a.ONE=m(1);function Ct(){var T=s();return this.copyTo(T),T}function $r(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function Yt(){return this.t==0?this.s:this[0]<<24>>24}function vr(){return this.t==0?this.s:this[0]<<16>>16}function Jt(T){return Math.floor(Math.LN2*this.DB/Math.log(T))}function pt(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function wr(T){if(T==null&&(T=10),this.signum()==0||T<2||T>36)return"0";var C=this.chunkSize(T),N=Math.pow(T,C),F=m(N),X=s(),Y=s(),ne="";for(this.divRemTo(F,X,Y);X.signum()>0;)ne=(N+Y.intValue()).toString(T).substr(1)+ne,X.divRemTo(F,X,Y);return Y.intValue().toString(T)+ne}function Vr(T,C){this.fromInt(0),C==null&&(C=10);for(var N=this.chunkSize(C),F=Math.pow(C,N),X=!1,Y=0,ne=0,ae=0;ae<T.length;++ae){var xe=v(T,ae);if(xe<0){T.charAt(ae)=="-"&&this.signum()==0&&(X=!0);continue}ne=C*ne+xe,++Y>=N&&(this.dMultiply(F),this.dAddOffset(ne,0),Y=0,ne=0)}Y>0&&(this.dMultiply(Math.pow(C,Y)),this.dAddOffset(ne,0)),X&&a.ZERO.subTo(this,this)}function un(T,C,N){if(typeof C=="number")if(T<2)this.fromInt(1);else for(this.fromNumber(T,N),this.testBit(T-1)||this.bitwiseTo(a.ONE.shiftLeft(T-1),_r,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(C);)this.dAddOffset(2,0),this.bitLength()>T&&this.subTo(a.ONE.shiftLeft(T-1),this);else{var F=new Array,X=T&7;F.length=(T>>3)+1,C.nextBytes(F),X>0?F[0]&=(1<<X)-1:F[0]=0,this.fromString(F,256)}}function ln(){var T=this.t,C=new Array;C[0]=this.s;var N=this.DB-T*this.DB%8,F,X=0;if(T-- >0)for(N<this.DB&&(F=this[T]>>N)!=(this.s&this.DM)>>N&&(C[X++]=F|this.s<<this.DB-N);T>=0;)N<8?(F=(this[T]&(1<<N)-1)<<8-N,F|=this[--T]>>(N+=this.DB-8)):(F=this[T]>>(N-=8)&255,N<=0&&(N+=this.DB,--T)),(F&128)!=0&&(F|=-256),X==0&&(this.s&128)!=(F&128)&&++X,(X>0||F!=this.s)&&(C[X++]=F);return C}function ur(T){return this.compareTo(T)==0}function Hr(T){return this.compareTo(T)<0?this:T}function zr(T){return this.compareTo(T)>0?this:T}function lr(T,C,N){var F,X,Y=Math.min(T.t,this.t);for(F=0;F<Y;++F)N[F]=C(this[F],T[F]);if(T.t<this.t){for(X=T.s&this.DM,F=Y;F<this.t;++F)N[F]=C(this[F],X);N.t=this.t}else{for(X=this.s&this.DM,F=Y;F<T.t;++F)N[F]=C(X,T[F]);N.t=T.t}N.s=C(this.s,T.s),N.clamp()}function Kr(T,C){return T&C}function Wr(T){var C=s();return this.bitwiseTo(T,Kr,C),C}function _r(T,C){return T|C}function dn(T){var C=s();return this.bitwiseTo(T,_r,C),C}function kt(T,C){return T^C}function Lt(T){var C=s();return this.bitwiseTo(T,kt,C),C}function dr(T,C){return T&~C}function Er(T){var C=s();return this.bitwiseTo(T,dr,C),C}function Xr(){for(var T=s(),C=0;C<this.t;++C)T[C]=this.DM&~this[C];return T.t=this.t,T.s=~this.s,T}function ft(T){var C=s();return T<0?this.rShiftTo(-T,C):this.lShiftTo(T,C),C}function mt(T){var C=s();return T<0?this.lShiftTo(-T,C):this.rShiftTo(T,C),C}function hn(T){if(T==0)return-1;var C=0;return(T&65535)==0&&(T>>=16,C+=16),(T&255)==0&&(T>>=8,C+=8),(T&15)==0&&(T>>=4,C+=4),(T&3)==0&&(T>>=2,C+=2),(T&1)==0&&++C,C}function Rt(){for(var T=0;T<this.t;++T)if(this[T]!=0)return T*this.DB+hn(this[T]);return this.s<0?this.t*this.DB:-1}function Qr(T){for(var C=0;T!=0;)T&=T-1,++C;return C}function pn(){for(var T=0,C=this.s&this.DM,N=0;N<this.t;++N)T+=Qr(this[N]^C);return T}function fn(T){var C=Math.floor(T/this.DB);return C>=this.t?this.s!=0:(this[C]&1<<T%this.DB)!=0}function mn(T,C){var N=a.ONE.shiftLeft(T);return this.bitwiseTo(N,C,N),N}function gn(T){return this.changeBit(T,_r)}function ot(T){return this.changeBit(T,dr)}function Zt(T){return this.changeBit(T,kt)}function Sr(T,C){for(var N=0,F=0,X=Math.min(T.t,this.t);N<X;)F+=this[N]+T[N],C[N++]=F&this.DM,F>>=this.DB;if(T.t<this.t){for(F+=T.s;N<this.t;)F+=this[N],C[N++]=F&this.DM,F>>=this.DB;F+=this.s}else{for(F+=this.s;N<T.t;)F+=T[N],C[N++]=F&this.DM,F>>=this.DB;F+=T.s}C.s=F<0?-1:0,F>0?C[N++]=F:F<-1&&(C[N++]=this.DV+F),C.t=N,C.clamp()}function Ar(T){var C=s();return this.addTo(T,C),C}function Tr(T){var C=s();return this.subTo(T,C),C}function er(T){var C=s();return this.multiplyTo(T,C),C}function Ht(){var T=s();return this.squareTo(T),T}function yn(T){var C=s();return this.divRemTo(T,C,null),C}function bn(T){var C=s();return this.divRemTo(T,null,C),C}function vn(T){var C=s(),N=s();return this.divRemTo(T,C,N),new Array(C,N)}function wn(T){this[this.t]=this.am(0,T-1,this,0,0,this.t),++this.t,this.clamp()}function hr(T,C){if(T==0)return;for(;this.t<=C;)this[this.t++]=0;for(this[C]+=T;this[C]>=this.DV;)this[C]-=this.DV,++C>=this.t&&(this[this.t++]=0),++this[C]}function it(){}function Ir(T){return T}function jt(T,C,N){T.multiplyTo(C,N)}function _n(T,C){T.squareTo(C)}it.prototype.convert=Ir,it.prototype.revert=Ir,it.prototype.mulTo=jt,it.prototype.sqrTo=_n;function En(T){return this.exp(T,new it)}function Sn(T,C,N){var F=Math.min(this.t+T.t,C);for(N.s=0,N.t=F;F>0;)N[--F]=0;var X;for(X=N.t-this.t;F<X;++F)N[F+this.t]=this.am(0,T[F],N,F,0,this.t);for(X=Math.min(T.t,C);F<X;++F)this.am(0,T[F],N,F,0,C-F);N.clamp()}function An(T,C,N){--C;var F=N.t=this.t+T.t-C;for(N.s=0;--F>=0;)N[F]=0;for(F=Math.max(C-this.t,0);F<T.t;++F)N[this.t+F-C]=this.am(C-F,T[F],N,0,0,this.t+F-C);N.clamp(),N.drShiftTo(1,N)}function pr(T){this.r2=s(),this.q3=s(),a.ONE.dlShiftTo(2*T.t,this.r2),this.mu=this.r2.divide(T),this.m=T}function fr(T){if(T.s<0||T.t>2*this.m.t)return T.mod(this.m);if(T.compareTo(this.m)<0)return T;var C=s();return T.copyTo(C),this.reduce(C),C}function Zn(T){return T}function Ni(T){for(T.drShiftTo(this.m.t-1,this.r2),T.t>this.m.t+1&&(T.t=this.m.t+1,T.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);T.compareTo(this.r2)<0;)T.dAddOffset(1,this.m.t+1);for(T.subTo(this.r2,T);T.compareTo(this.m)>=0;)T.subTo(this.m,T)}function Ya(T,C){T.squareTo(C),this.reduce(C)}function ei(T,C,N){T.multiplyTo(C,N),this.reduce(N)}pr.prototype.convert=fr,pr.prototype.revert=Zn,pr.prototype.reduce=Ni,pr.prototype.mulTo=ei,pr.prototype.sqrTo=Ya;function aa(T,C){var N=T.bitLength(),F,X=m(1),Y;if(N<=0)return X;N<18?F=1:N<48?F=3:N<144?F=4:N<768?F=5:F=6,N<8?Y=new fe(C):C.isEven()?Y=new pr(C):Y=new ie(C);var ne=new Array,ae=3,xe=F-1,Ze=(1<<F)-1;if(ne[1]=Y.convert(this),F>1){var gt=s();for(Y.sqrTo(ne[1],gt);ae<=Ze;)ne[ae]=s(),Y.mulTo(gt,ne[ae-2],ne[ae]),ae+=2}var Nt=T.t-1,tr,gr=!0,Ut=s(),We;for(N=P(T[Nt])-1;Nt>=0;){for(N>=xe?tr=T[Nt]>>N-xe&Ze:(tr=(T[Nt]&(1<<N+1)-1)<<xe-N,Nt>0&&(tr|=T[Nt-1]>>this.DB+N-xe)),ae=F;(tr&1)==0;)tr>>=1,--ae;if((N-=ae)<0&&(N+=this.DB,--Nt),gr)ne[tr].copyTo(X),gr=!1;else{for(;ae>1;)Y.sqrTo(X,Ut),Y.sqrTo(Ut,X),ae-=2;ae>0?Y.sqrTo(X,Ut):(We=X,X=Ut,Ut=We),Y.mulTo(Ut,ne[tr],X)}for(;Nt>=0&&(T[Nt]&1<<N)==0;)Y.sqrTo(X,Ut),We=X,X=Ut,Ut=We,--N<0&&(N=this.DB-1,--Nt)}return Y.revert(X)}function mr(T){var C=this.s<0?this.negate():this.clone(),N=T.s<0?T.negate():T.clone();if(C.compareTo(N)<0){var F=C;C=N,N=F}var X=C.getLowestSetBit(),Y=N.getLowestSetBit();if(Y<0)return C;for(X<Y&&(Y=X),Y>0&&(C.rShiftTo(Y,C),N.rShiftTo(Y,N));C.signum()>0;)(X=C.getLowestSetBit())>0&&C.rShiftTo(X,C),(X=N.getLowestSetBit())>0&&N.rShiftTo(X,N),C.compareTo(N)>=0?(C.subTo(N,C),C.rShiftTo(1,C)):(N.subTo(C,N),N.rShiftTo(1,N));return Y>0&&N.lShiftTo(Y,N),N}function Ja(T){if(T<=0)return 0;var C=this.DV%T,N=this.s<0?T-1:0;if(this.t>0)if(C==0)N=this[0]%T;else for(var F=this.t-1;F>=0;--F)N=(C*N+this[F])%T;return N}function Za(T){var C=T.isEven();if(this.isEven()&&C||T.signum()==0)return a.ZERO;for(var N=T.clone(),F=this.clone(),X=m(1),Y=m(0),ne=m(0),ae=m(1);N.signum()!=0;){for(;N.isEven();)N.rShiftTo(1,N),C?((!X.isEven()||!Y.isEven())&&(X.addTo(this,X),Y.subTo(T,Y)),X.rShiftTo(1,X)):Y.isEven()||Y.subTo(T,Y),Y.rShiftTo(1,Y);for(;F.isEven();)F.rShiftTo(1,F),C?((!ne.isEven()||!ae.isEven())&&(ne.addTo(this,ne),ae.subTo(T,ae)),ne.rShiftTo(1,ne)):ae.isEven()||ae.subTo(T,ae),ae.rShiftTo(1,ae);N.compareTo(F)>=0?(N.subTo(F,N),C&&X.subTo(ne,X),Y.subTo(ae,Y)):(F.subTo(N,F),C&&ne.subTo(X,ne),ae.subTo(Y,ae))}if(F.compareTo(a.ONE)!=0)return a.ZERO;if(ae.compareTo(T)>=0)return ae.subtract(T);if(ae.signum()<0)ae.addTo(T,ae);else return ae;return ae.signum()<0?ae.add(T):ae}var ct=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],es=(1<<26)/ct[ct.length-1];function ts(T){var C,N=this.abs();if(N.t==1&&N[0]<=ct[ct.length-1]){for(C=0;C<ct.length;++C)if(N[0]==ct[C])return!0;return!1}if(N.isEven())return!1;for(C=1;C<ct.length;){for(var F=ct[C],X=C+1;X<ct.length&&F<es;)F*=ct[X++];for(F=N.modInt(F);C<X;)if(F%ct[C++]==0)return!1}return N.millerRabin(T)}function ti(T){var C=this.subtract(a.ONE),N=C.getLowestSetBit();if(N<=0)return!1;var F=C.shiftRight(N);T=T+1>>1,T>ct.length&&(T=ct.length);for(var X=s(),Y=0;Y<T;++Y){X.fromInt(ct[Math.floor(Math.random()*ct.length)]);var ne=X.modPow(F,this);if(ne.compareTo(a.ONE)!=0&&ne.compareTo(C)!=0){for(var ae=1;ae++<N&&ne.compareTo(C)!=0;)if(ne=ne.modPowInt(2,this),ne.compareTo(a.ONE)==0)return!1;if(ne.compareTo(C)!=0)return!1}}return!0}a.prototype.chunkSize=Jt,a.prototype.toRadix=wr,a.prototype.fromRadix=Vr,a.prototype.fromNumber=un,a.prototype.bitwiseTo=lr,a.prototype.changeBit=mn,a.prototype.addTo=Sr,a.prototype.dMultiply=wn,a.prototype.dAddOffset=hr,a.prototype.multiplyLowerTo=Sn,a.prototype.multiplyUpperTo=An,a.prototype.modInt=Ja,a.prototype.millerRabin=ti,a.prototype.clone=Ct,a.prototype.intValue=$r,a.prototype.byteValue=Yt,a.prototype.shortValue=vr,a.prototype.signum=pt,a.prototype.toByteArray=ln,a.prototype.equals=ur,a.prototype.min=Hr,a.prototype.max=zr,a.prototype.and=Wr,a.prototype.or=dn,a.prototype.xor=Lt,a.prototype.andNot=Er,a.prototype.not=Xr,a.prototype.shiftLeft=ft,a.prototype.shiftRight=mt,a.prototype.getLowestSetBit=Rt,a.prototype.bitCount=pn,a.prototype.testBit=fn,a.prototype.setBit=gn,a.prototype.clearBit=ot,a.prototype.flipBit=Zt,a.prototype.add=Ar,a.prototype.subtract=Tr,a.prototype.multiply=er,a.prototype.divide=yn,a.prototype.remainder=bn,a.prototype.divideAndRemainder=vn,a.prototype.modPow=aa,a.prototype.modInverse=Za,a.prototype.pow=En,a.prototype.gcd=mr,a.prototype.isProbablePrime=ts,a.prototype.square=Ht,a.prototype.Barrett=pr;var ri,Pt,Ge;function rs(T){Pt[Ge++]^=T&255,Pt[Ge++]^=T>>8&255,Pt[Ge++]^=T>>16&255,Pt[Ge++]^=T>>24&255,Ge>=ai&&(Ge-=ai)}function sa(){rs(new Date().getTime())}if(Pt==null){Pt=new Array,Ge=0;var zt;if(typeof window!="undefined"&&window.crypto){if(window.crypto.getRandomValues){var oa=new Uint8Array(32);for(window.crypto.getRandomValues(oa),zt=0;zt<32;++zt)Pt[Ge++]=oa[zt]}else if(navigator.appName=="Netscape"&&navigator.appVersion<"5"){var Mn=window.crypto.random(32);for(zt=0;zt<Mn.length;++zt)Pt[Ge++]=Mn.charCodeAt(zt)&255}}for(;Ge<ai;)zt=Math.floor(65536*Math.random()),Pt[Ge++]=zt>>>8,Pt[Ge++]=zt&255;Ge=0,sa()}function Oi(){if(ri==null){for(sa(),ri=is(),ri.init(Pt),Ge=0;Ge<Pt.length;++Ge)Pt[Ge]=0;Ge=0}return ri.next()}function ni(T){var C;for(C=0;C<T.length;++C)T[C]=Oi()}function Di(){}Di.prototype.nextBytes=ni;function ii(){this.i=0,this.j=0,this.S=new Array}function ns(T){var C,N,F;for(C=0;C<256;++C)this.S[C]=C;for(N=0,C=0;C<256;++C)N=N+this.S[C]+T[C%T.length]&255,F=this.S[C],this.S[C]=this.S[N],this.S[N]=F;this.i=0,this.j=0}function Mi(){var T;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,T=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=T,this.S[T+this.S[this.i]&255]}ii.prototype.init=ns,ii.prototype.next=Mi;function is(){return new ii}var ai=256;t=e.exports={default:a,BigInteger:a,SecureRandom:Di}}).call(ge)}),nn=re(function(e,t){var r=t.falseIfInvalid=function(n){return function(){return this.valid?n.apply(this,arguments):!1}};t.isInSubnet=r(function(n){return this.subnetMask<n.subnetMask?!1:this.mask(n.subnetMask)===n.mask()}),t.isCorrect=function(n){return r(function(){return this.addressMinusSuffix!==this.correctForm()?!1:this.subnetMask===n&&!this.parsedSubnet?!0:this.parsedSubnet===String(this.subnetMask)})}}),Es=re(function(e,t){!function(){var r={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function n(o){return a(c(o),arguments)}function i(o,u){return n.apply(null,[o].concat(u||[]))}function a(o,u){var l=1,h=o.length,w,f="",A,p,y,v,O,R,m,g;for(A=0;A<h;A++)if(typeof o[A]=="string")f+=o[A];else if(typeof o[A]=="object"){if(y=o[A],y.keys)for(w=u[l],p=0;p<y.keys.length;p++){if(w==null)throw new Error(n('[sprintf] Cannot access property "%s" of undefined value "%s"',y.keys[p],y.keys[p-1]));w=w[y.keys[p]]}else y.param_no?w=u[y.param_no]:w=u[l++];if(r.not_type.test(y.type)&&r.not_primitive.test(y.type)&&w instanceof Function&&(w=w()),r.numeric_arg.test(y.type)&&typeof w!="number"&&isNaN(w))throw new TypeError(n("[sprintf] expecting number but found %T",w));r.number.test(y.type)&&(m=w>=0);switch(y.type){case"b":w=parseInt(w,10).toString(2);break;case"c":w=String.fromCharCode(parseInt(w,10));break;case"d":case"i":w=parseInt(w,10);break;case"j":w=JSON.stringify(w,null,y.width?parseInt(y.width):0);break;case"e":w=y.precision?parseFloat(w).toExponential(y.precision):parseFloat(w).toExponential();break;case"f":w=y.precision?parseFloat(w).toFixed(y.precision):parseFloat(w);break;case"g":w=y.precision?String(Number(w.toPrecision(y.precision))):parseFloat(w);break;case"o":w=(parseInt(w,10)>>>0).toString(8);break;case"s":w=String(w),w=y.precision?w.substring(0,y.precision):w;break;case"t":w=String(!!w),w=y.precision?w.substring(0,y.precision):w;break;case"T":w=Object.prototype.toString.call(w).slice(8,-1).toLowerCase(),w=y.precision?w.substring(0,y.precision):w;break;case"u":w=parseInt(w,10)>>>0;break;case"v":w=w.valueOf(),w=y.precision?w.substring(0,y.precision):w;break;case"x":w=(parseInt(w,10)>>>0).toString(16);break;case"X":w=(parseInt(w,10)>>>0).toString(16).toUpperCase();break}r.json.test(y.type)?f+=w:(r.number.test(y.type)&&(!m||y.sign)?(g=m?"+":"-",w=w.toString().replace(r.sign,"")):g="",O=y.pad_char?y.pad_char==="0"?"0":y.pad_char.charAt(1):" ",R=y.width-(g+w).length,v=y.width&&R>0?O.repeat(R):"",f+=y.align?g+w+v:O==="0"?g+v+w:v+g+w)}return f}var s=Object.create(null);function c(o){if(s[o])return s[o];for(var u=o,l,h=[],w=0;u;){if((l=r.text.exec(u))!==null)h.push(l[0]);else if((l=r.modulo.exec(u))!==null)h.push("%");else if((l=r.placeholder.exec(u))!==null){if(l[2]){w|=1;var f=[],A=l[2],p=[];if((p=r.key.exec(A))!==null)for(f.push(p[1]);(A=A.substring(p[0].length))!=="";)if((p=r.key_access.exec(A))!==null)f.push(p[1]);else if((p=r.index_access.exec(A))!==null)f.push(p[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");l[2]=f}else w|=2;if(w===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");h.push({placeholder:l[0],param_no:l[1],keys:l[2],sign:l[3],pad_char:l[4],align:l[5],width:l[6],precision:l[7],type:l[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");u=u.substring(l[0].length)}return s[o]=h}t.sprintf=n,t.vsprintf=i,typeof window!="undefined"&&(window.sprintf=n,window.vsprintf=i)}()}),Mu=1/0,DE=9007199254740991,ME=17976931348623157e292,Ep=0/0,xE="[object Symbol]",BE=/^\s+|\s+$/g,LE=/^[-+]0x[0-9a-f]+$/i,jE=/^0b[01]+$/i,UE=/^0o[0-7]+$/i,xu="\\ud800-\\udfff",Sp="\\u0300-\\u036f\\ufe20-\\ufe23",Ap="\\u20d0-\\u20f0",Tp="\\ufe0e\\ufe0f",FE="["+xu+"]",Bu="["+Sp+Ap+"]",Lu="\\ud83c[\\udffb-\\udfff]",qE="(?:"+Bu+"|"+Lu+")",Ip="[^"+xu+"]",Cp="(?:\\ud83c[\\udde6-\\uddff]){2}",kp="[\\ud800-\\udbff][\\udc00-\\udfff]",Rp="\\u200d",Pp=qE+"?",Np="["+Tp+"]?",GE="(?:"+Rp+"(?:"+[Ip,Cp,kp].join("|")+")"+Np+Pp+")*",$E=Np+Pp+GE,VE="(?:"+[Ip+Bu+"?",Bu,Cp,kp,FE].join("|")+")",ju=RegExp(Lu+"(?="+Lu+")|"+VE+$E,"g"),HE=RegExp("["+Rp+xu+Sp+Ap+Tp+"]"),zE=parseInt,KE=typeof ge=="object"&&ge&&ge.Object===Object&&ge,WE=typeof self=="object"&&self&&self.Object===Object&&self,XE=KE||WE||Function("return this")(),QE=JE("length");function YE(e){return e.split("")}function JE(e){return function(t){return t==null?void 0:t[e]}}function Uu(e){return HE.test(e)}function Op(e){return Uu(e)?eS(e):QE(e)}function ZE(e){return Uu(e)?tS(e):YE(e)}function eS(e){for(var t=ju.lastIndex=0;ju.test(e);)t++;return t}function tS(e){return e.match(ju)||[]}var rS=Object.prototype,nS=rS.toString,Dp=XE.Symbol,iS=Math.ceil,aS=Math.floor,Mp=Dp?Dp.prototype:void 0,xp=Mp?Mp.toString:void 0;function Bp(e,t){var r="";if(!e||t<1||t>DE)return r;do t%2&&(r+=e),t=aS(t/2),t&&(e+=e);while(t);return r}function sS(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),r=r>i?i:r,r<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var a=Array(i);++n<i;)a[n]=e[n+t];return a}function Lp(e){if(typeof e=="string")return e;if(Up(e))return xp?xp.call(e):"";var t=e+"";return t=="0"&&1/e==-Mu?"-0":t}function oS(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:sS(e,t,r)}function cS(e,t){t=t===void 0?" ":Lp(t);var r=t.length;if(r<2)return r?Bp(t,e):t;var n=Bp(t,iS(e/Op(t)));return Uu(t)?oS(ZE(n),0,e).join(""):n.slice(0,e)}function jp(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function uS(e){return!!e&&typeof e=="object"}function Up(e){return typeof e=="symbol"||uS(e)&&nS.call(e)==xE}function lS(e){if(!e)return e===0?e:0;if(e=hS(e),e===Mu||e===-Mu){var t=e<0?-1:1;return t*ME}return e===e?e:0}function dS(e){var t=lS(e),r=t%1;return t===t?r?t-r:t:0}function hS(e){if(typeof e=="number")return e;if(Up(e))return Ep;if(jp(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=jp(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(BE,"");var r=jE.test(e);return r||UE.test(e)?zE(e.slice(2),r?2:8):LE.test(e)?Ep:+e}function pS(e){return e==null?"":Lp(e)}function fS(e,t,r){e=pS(e),t=dS(t);var n=t?Op(e):0;return t&&n<t?cS(t-n,r)+e:e}var Ss=fS,Fu=1/0,qu=9007199254740991,mS=17976931348623157e292,Fp=0/0,gS="[object Function]",yS="[object GeneratorFunction]",bS="[object Symbol]",vS=/^\s+|\s+$/g,wS=/^[-+]0x[0-9a-f]+$/i,_S=/^0b[01]+$/i,ES=/^0o[0-7]+$/i,SS=/^(?:0|[1-9]\d*)$/,AS=parseInt,TS=typeof ge=="object"&&ge&&ge.Object===Object&&ge,IS=typeof self=="object"&&self&&self.Object===Object&&self,CS=TS||IS||Function("return this")(),kS=Object.prototype,qp=kS.toString,Gp=CS.Symbol,RS=Math.floor,$p=Gp?Gp.prototype:void 0,Vp=$p?$p.toString:void 0;function PS(e,t){var r="";if(!e||t<1||t>qu)return r;do t%2&&(r+=e),t=RS(t/2),t&&(e+=e);while(t);return r}function NS(e){if(typeof e=="string")return e;if(Hp(e))return Vp?Vp.call(e):"";var t=e+"";return t=="0"&&1/e==-Fu?"-0":t}function OS(e,t){return t=t??qu,!!t&&(typeof e=="number"||SS.test(e))&&(e>-1&&e%1==0)&&e<t}function DS(e,t,r){if(!qo(r))return!1;var n=typeof t;return(n=="number"?xS(r)&&OS(t,r.length):n=="string"&&t in r)?MS(r[t],e):!1}function MS(e,t){return e===t||e!==e&&t!==t}function xS(e){return e!=null&&LS(e.length)&&!BS(e)}function BS(e){var t=qo(e)?qp.call(e):"";return t==gS||t==yS}function LS(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=qu}function qo(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function jS(e){return!!e&&typeof e=="object"}function Hp(e){return typeof e=="symbol"||jS(e)&&qp.call(e)==bS}function US(e){if(!e)return e===0?e:0;if(e=qS(e),e===Fu||e===-Fu){var t=e<0?-1:1;return t*mS}return e===e?e:0}function FS(e){var t=US(e),r=t%1;return t===t?r?t-r:t:0}function qS(e){if(typeof e=="number")return e;if(Hp(e))return Fp;if(qo(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=qo(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(vS,"");var r=_S.test(e);return r||ES.test(e)?AS(e.slice(2),r?2:8):wS.test(e)?Fp:+e}function GS(e){return e==null?"":NS(e)}function $S(e,t,r){return(r?DS(e,t,r):t===void 0)?t=1:t=FS(t),PS(GS(e),t)}var Go=$S,VS=32,HS=4,zS=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/g,KS=/\/\d{1,2}$/,Xt={BITS:VS,GROUPS:HS,RE_ADDRESS:zS,RE_SUBNET_STRING:KS},As=_p.BigInteger,$o=Es.sprintf;function qe(e){this.valid=!1,this.address=e,this.groups=Xt.GROUPS,this.v4=!0,this.subnet="/32",this.subnetMask=32;var t=Xt.RE_SUBNET_STRING.exec(e);if(t){if(this.parsedSubnet=t[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,this.subnetMask<0||this.subnetMask>Xt.BITS){this.valid=!1,this.error="Invalid subnet mask.";return}e=e.replace(Xt.RE_SUBNET_STRING,"")}this.addressMinusSuffix=e,this.parsedAddress=this.parse(e)}qe.prototype.parse=function(e){var t=e.split(".");return e.match(Xt.RE_ADDRESS)?this.valid=!0:this.error="Invalid IPv4 address.",t},qe.prototype.isValid=function(){return this.valid},qe.prototype.correctForm=function(){return this.parsedAddress.map(function(e){return parseInt(e,10)}).join(".")},qe.prototype.isCorrect=nn.isCorrect(Xt.BITS),qe.fromHex=function(e){var t=Ss(e.replace(/:/g,""),8,"0"),r=[],n;for(n=0;n<8;n+=2){var i=t.slice(n,n+2);r.push(parseInt(i,16))}return new qe(r.join("."))},qe.fromInteger=function(e){return qe.fromHex(e.toString(16))},qe.prototype.toHex=function(){return this.parsedAddress.map(function(e){return $o("%02x",parseInt(e,10))}).join(":")},qe.prototype.toArray=function(){return this.parsedAddress.map(function(e){return parseInt(e,10)})},qe.prototype.toGroup6=function(){var e=[],t;for(t=0;t<Xt.GROUPS;t+=2){var r=$o("%02x%02x",parseInt(this.parsedAddress[t],10),parseInt(this.parsedAddress[t+1],10));e.push($o("%x",parseInt(r,16)))}return e.join(":")},qe.prototype.bigInteger=function(){return this.valid?new As(this.parsedAddress.map(function(e){return $o("%02x",parseInt(e,10))}).join(""),16):null},qe.prototype._startAddress=function(){return new As(this.mask()+Go("0",Xt.BITS-this.subnetMask),2)},qe.prototype.startAddress=function(){return qe.fromBigInteger(this._startAddress())},qe.prototype.startAddressExclusive=function(){var e=new As("1");return qe.fromBigInteger(this._startAddress().add(e))},qe.prototype._endAddress=function(){return new As(this.mask()+Go("1",Xt.BITS-this.subnetMask),2)},qe.prototype.endAddress=function(){return qe.fromBigInteger(this._endAddress())},qe.prototype.endAddressExclusive=function(){var e=new As("1");return qe.fromBigInteger(this._endAddress().subtract(e))},qe.fromBigInteger=function(e){return qe.fromInteger(parseInt(e.toString(),10))},qe.prototype.mask=function(e){return e===void 0&&(e=this.subnetMask),this.getBitsBase2(0,e)},qe.prototype.getBitsBase2=function(e,t){return this.binaryZeroPad().slice(e,t)},qe.prototype.isInSubnet=nn.isInSubnet,qe.prototype.isMulticast=function(){return this.isInSubnet(new qe("224.0.0.0/4"))},qe.prototype.binaryZeroPad=function(){return Ss(this.bigInteger().toString(2),Xt.BITS,"0")};var Vi=qe,Gu=re(function(e,t){var r=200,n="__lodash_hash_undefined__",i=800,a=16,s=9007199254740991,c="[object Arguments]",o="[object Array]",u="[object AsyncFunction]",l="[object Boolean]",h="[object Date]",w="[object Error]",f="[object Function]",A="[object GeneratorFunction]",p="[object Map]",y="[object Number]",v="[object Null]",O="[object Object]",R="[object Proxy]",m="[object RegExp]",g="[object Set]",S="[object String]",d="[object Undefined]",b="[object WeakMap]",E="[object ArrayBuffer]",_="[object DataView]",P="[object Float32Array]",M="[object Float64Array]",j="[object Int8Array]",L="[object Int16Array]",B="[object Int32Array]",$="[object Uint8Array]",V="[object Uint8ClampedArray]",W="[object Uint16Array]",se="[object Uint32Array]",oe=/[\\^$.*+?()[\]{}|]/g,Ee=/^\[object .+?Constructor\]$/,fe=/^(?:0|[1-9]\d*)$/,me={};me[P]=me[M]=me[j]=me[L]=me[B]=me[$]=me[V]=me[W]=me[se]=!0,me[c]=me[o]=me[E]=me[l]=me[_]=me[h]=me[w]=me[f]=me[p]=me[y]=me[O]=me[m]=me[g]=me[S]=me[b]=!1;var pe=typeof ge=="object"&&ge&&ge.Object===Object&&ge,k=typeof self=="object"&&self&&self.Object===Object&&self,K=pe||k||Function("return this")(),Q=t&&!t.nodeType&&t,Z=Q&&!0&&e&&!e.nodeType&&e,ie=Z&&Z.exports===Q,ue=ie&&pe.process,he=function(){try{var D=Z&&Z.require&&Z.require("util").types;return D||ue&&ue.binding&&ue.binding("util")}catch(q){}}(),ce=he&&he.isTypedArray;function Te(D,q,H){switch(H.length){case 0:return D.call(q);case 1:return D.call(q,H[0]);case 2:return D.call(q,H[0],H[1]);case 3:return D.call(q,H[0],H[1],H[2])}return D.apply(q,H)}function J(D,q){for(var H=-1,le=Array(D);++H<D;)le[H]=q(H);return le}function He(D){return function(q){return D(q)}}function Gr(D,q){return D==null?void 0:D[q]}function cn(D,q){return function(H){return D(q(H))}}var Ct=Array.prototype,$r=Function.prototype,Yt=Object.prototype,vr=K["__core-js_shared__"],Jt=$r.toString,pt=Yt.hasOwnProperty,wr=function(){var D=/[^.]+$/.exec(vr&&vr.keys&&vr.keys.IE_PROTO||"");return D?"Symbol(src)_1."+D:""}(),Vr=Yt.toString,un=Jt.call(Object),ln=RegExp("^"+Jt.call(pt).replace(oe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ur=ie?K.Buffer:void 0,Hr=K.Symbol,zr=K.Uint8Array,lr=ur?ur.allocUnsafe:void 0,Kr=cn(Object.getPrototypeOf,Object),Wr=Object.create,_r=Yt.propertyIsEnumerable,dn=Ct.splice,kt=Hr?Hr.toStringTag:void 0,Lt=function(){try{var D=Oi(Object,"defineProperty");return D({},"",{}),D}catch(q){}}(),dr=ur?ur.isBuffer:void 0,Er=Math.max,Xr=Date.now,ft=Oi(K,"Map"),mt=Oi(Object,"create"),hn=function(){function D(){}return function(q){if(!We(q))return{};if(Wr)return Wr(q);D.prototype=q;var H=new D;return D.prototype=void 0,H}}();function Rt(D){var q=-1,H=D==null?0:D.length;for(this.clear();++q<H;){var le=D[q];this.set(le[0],le[1])}}function Qr(){this.__data__=mt?mt(null):{},this.size=0}function pn(D){var q=this.has(D)&&delete this.__data__[D];return this.size-=q?1:0,q}function fn(D){var q=this.__data__;if(mt){var H=q[D];return H===n?void 0:H}return pt.call(q,D)?q[D]:void 0}function mn(D){var q=this.__data__;return mt?q[D]!==void 0:pt.call(q,D)}function gn(D,q){var H=this.__data__;return this.size+=this.has(D)?0:1,H[D]=mt&&q===void 0?n:q,this}Rt.prototype.clear=Qr,Rt.prototype.delete=pn,Rt.prototype.get=fn,Rt.prototype.has=mn,Rt.prototype.set=gn;function ot(D){var q=-1,H=D==null?0:D.length;for(this.clear();++q<H;){var le=D[q];this.set(le[0],le[1])}}function Zt(){this.__data__=[],this.size=0}function Sr(D){var q=this.__data__,H=Zn(q,D);if(H<0)return!1;var le=q.length-1;return H==le?q.pop():dn.call(q,H,1),--this.size,!0}function Ar(D){var q=this.__data__,H=Zn(q,D);return H<0?void 0:q[H][1]}function Tr(D){return Zn(this.__data__,D)>-1}function er(D,q){var H=this.__data__,le=Zn(H,D);return le<0?(++this.size,H.push([D,q])):H[le][1]=q,this}ot.prototype.clear=Zt,ot.prototype.delete=Sr,ot.prototype.get=Ar,ot.prototype.has=Tr,ot.prototype.set=er;function Ht(D){var q=-1,H=D==null?0:D.length;for(this.clear();++q<H;){var le=D[q];this.set(le[0],le[1])}}function yn(){this.size=0,this.__data__={hash:new Rt,map:new(ft||ot),string:new Rt}}function bn(D){var q=Mn(this,D).delete(D);return this.size-=q?1:0,q}function vn(D){return Mn(this,D).get(D)}function wn(D){return Mn(this,D).has(D)}function hr(D,q){var H=Mn(this,D),le=H.size;return H.set(D,q),this.size+=H.size==le?0:1,this}Ht.prototype.clear=yn,Ht.prototype.delete=bn,Ht.prototype.get=vn,Ht.prototype.has=wn,Ht.prototype.set=hr;function it(D){var q=this.__data__=new ot(D);this.size=q.size}function Ir(){this.__data__=new ot,this.size=0}function jt(D){var q=this.__data__,H=q.delete(D);return this.size=q.size,H}function _n(D){return this.__data__.get(D)}function En(D){return this.__data__.has(D)}function Sn(D,q){var H=this.__data__;if(H instanceof ot){var le=H.__data__;if(!ft||le.length<r-1)return le.push([D,q]),this.size=++H.size,this;H=this.__data__=new Ht(le)}return H.set(D,q),this.size=H.size,this}it.prototype.clear=Ir,it.prototype.delete=jt,it.prototype.get=_n,it.prototype.has=En,it.prototype.set=Sn;function An(D,q){var H=Ze(D),le=!H&&xe(D),Re=!H&&!le&&tr(D),Fe=!H&&!le&&!Re&&xn(D),ze=H||le||Re||Fe,Ce=ze?J(D.length,String):[],Be=Ce.length;for(var Ft in D)(q||pt.call(D,Ft))&&!(ze&&(Ft=="length"||Re&&(Ft=="offset"||Ft=="parent")||Fe&&(Ft=="buffer"||Ft=="byteLength"||Ft=="byteOffset")||ii(Ft,Be)))&&Ce.push(Ft);return Ce}function pr(D,q,H){(H!==void 0&&!ae(D[q],H)||H===void 0&&!(q in D))&&Ni(D,q,H)}function fr(D,q,H){var le=D[q];(!(pt.call(D,q)&&ae(le,H))||H===void 0&&!(q in D))&&Ni(D,q,H)}function Zn(D,q){for(var H=D.length;H--;)if(ae(D[H][0],q))return H;return-1}function Ni(D,q,H){q=="__proto__"&&Lt?Lt(D,q,{configurable:!0,enumerable:!0,value:H,writable:!0}):D[q]=H}var Ya=oa();function ei(D){return D==null?D===void 0?d:v:kt&&kt in Object(D)?ni(D):C(D)}function aa(D){return yt(D)&&ei(D)==c}function mr(D){if(!We(D)||is(D))return!1;var q=gr(D)?ln:Ee;return q.test(ne(D))}function Ja(D){return yt(D)&&Ut(D.length)&&!!me[ei(D)]}function Za(D){if(!We(D))return T(D);var q=ai(D),H=[];for(var le in D)le=="constructor"&&(q||!pt.call(D,le))||H.push(le);return H}function ct(D,q,H,le,Re){if(D===q)return;Ya(q,function(Fe,ze){if(Re||(Re=new it),We(Fe))es(D,q,ze,H,ct,le,Re);else{var Ce=le?le(F(D,ze),Fe,ze+"",D,q,Re):void 0;Ce===void 0&&(Ce=Fe),pr(D,ze,Ce)}},Js)}function es(D,q,H,le,Re,Fe,ze){var Ce=F(D,H),Be=F(q,H),Ft=ze.get(Be);if(Ft){pr(D,H,Ft);return}var Kt=Fe?Fe(Ce,Be,H+"",D,q,ze):void 0,si=Kt===void 0;if(si){var xi=Ze(Be),Tn=!xi&&tr(Be),Bi=!xi&&!Tn&&xn(Be);Kt=Be,xi||Tn||Bi?Ze(Ce)?Kt=Ce:Nt(Ce)?Kt=rs(Ce):Tn?(si=!1,Kt=ri(Be,!0)):Bi?(si=!1,Kt=Ge(Be,!0)):Kt=[]:Cr(Be)||xe(Be)?(Kt=Ce,xe(Ce)?Kt=ca(Ce):(!We(Ce)||gr(Ce))&&(Kt=Di(Be))):si=!1}si&&(ze.set(Be,Kt),Re(Kt,Be,le,Fe,ze),ze.delete(Be)),pr(D,H,Kt)}function ts(D,q){return X(N(D,q,as),D+"")}var ti=Lt?function(D,q){return Lt(D,"toString",{configurable:!0,enumerable:!1,value:Dc(q),writable:!0})}:as;function ri(D,q){if(q)return D.slice();var H=D.length,le=lr?lr(H):new D.constructor(H);return D.copy(le),le}function Pt(D){var q=new D.constructor(D.byteLength);return new zr(q).set(new zr(D)),q}function Ge(D,q){var H=q?Pt(D.buffer):D.buffer;return new D.constructor(H,D.byteOffset,D.length)}function rs(D,q){var H=-1,le=D.length;for(q||(q=Array(le));++H<le;)q[H]=D[H];return q}function sa(D,q,H,le){var Re=!H;H||(H={});for(var Fe=-1,ze=q.length;++Fe<ze;){var Ce=q[Fe],Be=le?le(H[Ce],D[Ce],Ce,H,D):void 0;Be===void 0&&(Be=D[Ce]),Re?Ni(H,Ce,Be):fr(H,Ce,Be)}return H}function zt(D){return ts(function(q,H){var le=-1,Re=H.length,Fe=Re>1?H[Re-1]:void 0,ze=Re>2?H[2]:void 0;for(Fe=D.length>3&&typeof Fe=="function"?(Re--,Fe):void 0,ze&&ns(H[0],H[1],ze)&&(Fe=Re<3?void 0:Fe,Re=1),q=Object(q);++le<Re;){var Ce=H[le];Ce&&D(q,Ce,le,Fe)}return q})}function oa(D){return function(q,H,le){for(var Re=-1,Fe=Object(q),ze=le(q),Ce=ze.length;Ce--;){var Be=ze[D?Ce:++Re];if(H(Fe[Be],Be,Fe)===!1)break}return q}}function Mn(D,q){var H=D.__data__;return Mi(q)?H[typeof q=="string"?"string":"hash"]:H.map}function Oi(D,q){var H=Gr(D,q);return mr(H)?H:void 0}function ni(D){var q=pt.call(D,kt),H=D[kt];try{D[kt]=void 0;var le=!0}catch(Fe){}var Re=Vr.call(D);return le&&(q?D[kt]=H:delete D[kt]),Re}function Di(D){return typeof D.constructor=="function"&&!ai(D)?hn(Kr(D)):{}}function ii(D,q){var H=typeof D;return q=q??s,!!q&&(H=="number"||H!="symbol"&&fe.test(D))&&(D>-1&&D%1==0)&&D<q}function ns(D,q,H){if(!We(H))return!1;var le=typeof q;return(le=="number"?gt(H)&&ii(q,H.length):le=="string"&&q in H)?ae(H[q],D):!1}function Mi(D){var q=typeof D;return q=="string"||q=="number"||q=="symbol"||q=="boolean"?D!=="__proto__":D===null}function is(D){return!!wr&&wr in D}function ai(D){var q=D&&D.constructor,H=typeof q=="function"&&q.prototype||Yt;return D===H}function T(D){var q=[];if(D!=null)for(var H in Object(D))q.push(H);return q}function C(D){return Vr.call(D)}function N(D,q,H){return q=Er(q===void 0?D.length-1:q,0),function(){for(var le=arguments,Re=-1,Fe=Er(le.length-q,0),ze=Array(Fe);++Re<Fe;)ze[Re]=le[q+Re];Re=-1;for(var Ce=Array(q+1);++Re<q;)Ce[Re]=le[Re];return Ce[q]=H(ze),Te(D,this,Ce)}}function F(D,q){return q==="constructor"&&typeof D[q]=="function"||q=="__proto__"?void 0:D[q]}var X=Y(ti);function Y(D){var q=0,H=0;return function(){var le=Xr(),Re=a-(le-H);if(H=le,Re>0){if(++q>=i)return arguments[0]}else q=0;return D.apply(void 0,arguments)}}function ne(D){if(D!=null){try{return Jt.call(D)}catch(q){}try{return D+""}catch(q){}}return""}function ae(D,q){return D===q||D!==D&&q!==q}var xe=aa(function(){return arguments}())?aa:function(D){return yt(D)&&pt.call(D,"callee")&&!_r.call(D,"callee")},Ze=Array.isArray;function gt(D){return D!=null&&Ut(D.length)&&!gr(D)}function Nt(D){return yt(D)&&gt(D)}var tr=dr||Zs;function gr(D){if(!We(D))return!1;var q=ei(D);return q==f||q==A||q==u||q==R}function Ut(D){return typeof D=="number"&&D>-1&&D%1==0&&D<=s}function We(D){var q=typeof D;return D!=null&&(q=="object"||q=="function")}function yt(D){return D!=null&&typeof D=="object"}function Cr(D){if(!yt(D)||ei(D)!=O)return!1;var q=Kr(D);if(q===null)return!0;var H=pt.call(q,"constructor")&&q.constructor;return typeof H=="function"&&H instanceof H&&Jt.call(H)==un}var xn=ce?He(ce):Ja;function ca(D){return sa(D,Js(D))}function Js(D){return gt(D)?An(D,!0):Za(D)}var Oc=zt(function(D,q,H){ct(D,q,H)});function Dc(D){return function(){return D}}function as(D){return D}function Zs(){return!1}e.exports=Oc}),WS=re(function(e,t){var r=200,n="Expected a function",i="__lodash_hash_undefined__",a=1,s=2,c=1/0,o=9007199254740991,u=17976931348623157e292,l=0/0,h="[object Arguments]",w="[object Array]",f="[object Boolean]",A="[object Date]",p="[object Error]",y="[object Function]",v="[object GeneratorFunction]",O="[object Map]",R="[object Number]",m="[object Object]",g="[object Promise]",S="[object RegExp]",d="[object Set]",b="[object String]",E="[object Symbol]",_="[object WeakMap]",P="[object ArrayBuffer]",M="[object DataView]",j="[object Float32Array]",L="[object Float64Array]",B="[object Int8Array]",$="[object Int16Array]",V="[object Int32Array]",W="[object Uint8Array]",se="[object Uint8ClampedArray]",oe="[object Uint16Array]",Ee="[object Uint32Array]",fe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,me=/^\w*$/,pe=/^\./,k=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,K=/[\\^$.*+?()[\]{}|]/g,Q=/^\s+|\s+$/g,Z=/\\(\\)?/g,ie=/^[-+]0x[0-9a-f]+$/i,ue=/^0b[01]+$/i,he=/^\[object .+?Constructor\]$/,ce=/^0o[0-7]+$/i,Te=/^(?:0|[1-9]\d*)$/,J={};J[j]=J[L]=J[B]=J[$]=J[V]=J[W]=J[se]=J[oe]=J[Ee]=!0,J[h]=J[w]=J[P]=J[f]=J[M]=J[A]=J[p]=J[y]=J[O]=J[R]=J[m]=J[S]=J[d]=J[b]=J[_]=!1;var He=parseInt,Gr=typeof ge=="object"&&ge&&ge.Object===Object&&ge,cn=typeof self=="object"&&self&&self.Object===Object&&self,Ct=Gr||cn||Function("return this")(),$r=t&&!t.nodeType&&t,Yt=$r&&!0&&e&&!e.nodeType&&e,vr=Yt&&Yt.exports===$r,Jt=vr&&Gr.process,pt=function(){try{return Jt&&Jt.binding("util")}catch(I){}}(),wr=pt&&pt.isTypedArray;function Vr(I,x){for(var z=-1,ee=I?I.length:0;++z<ee;)if(x(I[z],z,I))return!0;return!1}function un(I,x,z,ee){for(var be=I.length,de=z+(ee?1:-1);ee?de--:++de<be;)if(x(I[de],de,I))return de;return-1}function ln(I){return function(x){return x==null?void 0:x[I]}}function ur(I,x){for(var z=-1,ee=Array(I);++z<I;)ee[z]=x(z);return ee}function Hr(I){return function(x){return I(x)}}function zr(I,x){return I==null?void 0:I[x]}function lr(I){var x=!1;if(I!=null&&typeof I.toString!="function")try{x=!!(I+"")}catch(z){}return x}function Kr(I){var x=-1,z=Array(I.size);return I.forEach(function(ee,be){z[++x]=[be,ee]}),z}function Wr(I,x){return function(z){return I(x(z))}}function _r(I){var x=-1,z=Array(I.size);return I.forEach(function(ee){z[++x]=ee}),z}var dn=Array.prototype,kt=Function.prototype,Lt=Object.prototype,dr=Ct["__core-js_shared__"],Er=function(){var I=/[^.]+$/.exec(dr&&dr.keys&&dr.keys.IE_PROTO||"");return I?"Symbol(src)_1."+I:""}(),Xr=kt.toString,ft=Lt.hasOwnProperty,mt=Lt.toString,hn=RegExp("^"+Xr.call(ft).replace(K,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Rt=Ct.Symbol,Qr=Ct.Uint8Array,pn=Lt.propertyIsEnumerable,fn=dn.splice,mn=Wr(Object.keys,Object),gn=Math.max,ot=We(Ct,"DataView"),Zt=We(Ct,"Map"),Sr=We(Ct,"Promise"),Ar=We(Ct,"Set"),Tr=We(Ct,"WeakMap"),er=We(Object,"create"),Ht=H(ot),yn=H(Zt),bn=H(Sr),vn=H(Ar),wn=H(Tr),hr=Rt?Rt.prototype:void 0,it=hr?hr.valueOf:void 0,Ir=hr?hr.toString:void 0;function jt(I){var x=-1,z=I?I.length:0;for(this.clear();++x<z;){var ee=I[x];this.set(ee[0],ee[1])}}function _n(){this.__data__=er?er(null):{}}function En(I){return this.has(I)&&delete this.__data__[I]}function Sn(I){var x=this.__data__;if(er){var z=x[I];return z===i?void 0:z}return ft.call(x,I)?x[I]:void 0}function An(I){var x=this.__data__;return er?x[I]!==void 0:ft.call(x,I)}function pr(I,x){var z=this.__data__;return z[I]=er&&x===void 0?i:x,this}jt.prototype.clear=_n,jt.prototype.delete=En,jt.prototype.get=Sn,jt.prototype.has=An,jt.prototype.set=pr;function fr(I){var x=-1,z=I?I.length:0;for(this.clear();++x<z;){var ee=I[x];this.set(ee[0],ee[1])}}function Zn(){this.__data__=[]}function Ni(I){var x=this.__data__,z=ni(x,I);if(z<0)return!1;var ee=x.length-1;return z==ee?x.pop():fn.call(x,z,1),!0}function Ya(I){var x=this.__data__,z=ni(x,I);return z<0?void 0:x[z][1]}function ei(I){return ni(this.__data__,I)>-1}function aa(I,x){var z=this.__data__,ee=ni(z,I);return ee<0?z.push([I,x]):z[ee][1]=x,this}fr.prototype.clear=Zn,fr.prototype.delete=Ni,fr.prototype.get=Ya,fr.prototype.has=ei,fr.prototype.set=aa;function mr(I){var x=-1,z=I?I.length:0;for(this.clear();++x<z;){var ee=I[x];this.set(ee[0],ee[1])}}function Ja(){this.__data__={hash:new jt,map:new(Zt||fr),string:new jt}}function Za(I){return gr(this,I).delete(I)}function ct(I){return gr(this,I).get(I)}function es(I){return gr(this,I).has(I)}function ts(I,x){return gr(this,I).set(I,x),this}mr.prototype.clear=Ja,mr.prototype.delete=Za,mr.prototype.get=ct,mr.prototype.has=es,mr.prototype.set=ts;function ti(I){var x=-1,z=I?I.length:0;for(this.__data__=new mr;++x<z;)this.add(I[x])}function ri(I){return this.__data__.set(I,i),this}function Pt(I){return this.__data__.has(I)}ti.prototype.add=ti.prototype.push=ri,ti.prototype.has=Pt;function Ge(I){this.__data__=new fr(I)}function rs(){this.__data__=new fr}function sa(I){return this.__data__.delete(I)}function zt(I){return this.__data__.get(I)}function oa(I){return this.__data__.has(I)}function Mn(I,x){var z=this.__data__;if(z instanceof fr){var ee=z.__data__;if(!Zt||ee.length<r-1)return ee.push([I,x]),this;z=this.__data__=new mr(ee)}return z.set(I,x),this}Ge.prototype.clear=rs,Ge.prototype.delete=sa,Ge.prototype.get=zt,Ge.prototype.has=oa,Ge.prototype.set=Mn;function Oi(I,x){var z=Be(I)||Ce(I)?ur(I.length,String):[],ee=z.length,be=!!ee;for(var de in I)(x||ft.call(I,de))&&!(be&&(de=="length"||xn(de,ee)))&&z.push(de);return z}function ni(I,x){for(var z=I.length;z--;)if(ze(I[z][0],x))return z;return-1}function Di(I,x){x=ca(x,I)?[x]:xe(x);for(var z=0,ee=x.length;I!=null&&z<ee;)I=I[q(x[z++])];return z&&z==ee?I:void 0}function ii(I){return mt.call(I)}function ns(I,x){return I!=null&&x in Object(I)}function Mi(I,x,z,ee,be){return I===x?!0:I==null||x==null||!Tn(I)&&!Bi(x)?I!==I&&x!==x:is(I,x,Mi,z,ee,be)}function is(I,x,z,ee,be,de){var Ve=Be(I),Xe=Be(x),ut=w,Et=w;Ve||(ut=yt(I),ut=ut==h?m:ut),Xe||(Et=yt(x),Et=Et==h?m:Et);var Wt=ut==m&&!lr(I),rr=Et==m&&!lr(x),St=ut==Et;if(St&&!Wt)return de||(de=new Ge),Ve||wg(I)?gt(I,x,z,ee,be,de):Nt(I,x,ut,z,ee,be,de);if(!(be&s)){var kr=Wt&&ft.call(I,"__wrapped__"),Rr=rr&&ft.call(x,"__wrapped__");if(kr||Rr){var oi=kr?I.value():I,Bn=Rr?x.value():x;return de||(de=new Ge),z(oi,Bn,ee,be,de)}}return St?(de||(de=new Ge),tr(I,x,z,ee,be,de)):!1}function ai(I,x,z,ee){var be=z.length,de=be,Ve=!ee;if(I==null)return!de;for(I=Object(I);be--;){var Xe=z[be];if(Ve&&Xe[2]?Xe[1]!==I[Xe[0]]:!(Xe[0]in I))return!1}for(;++be<de;){Xe=z[be];var ut=Xe[0],Et=I[ut],Wt=Xe[1];if(Ve&&Xe[2]){if(Et===void 0&&!(ut in I))return!1}else{var rr=new Ge;if(ee)var St=ee(Et,Wt,ut,I,x,rr);if(!(St===void 0?Mi(Wt,Et,ee,a|s,rr):St))return!1}}return!0}function T(I){if(!Tn(I)||Oc(I))return!1;var x=si(I)||lr(I)?hn:he;return x.test(H(I))}function C(I){return Bi(I)&&xi(I.length)&&!!J[mt.call(I)]}function N(I){return typeof I=="function"?I:I==null?Cg:typeof I=="object"?Be(I)?Y(I[0],I[1]):X(I):kg(I)}function F(I){if(!Dc(I))return mn(I);var x=[];for(var z in Object(I))ft.call(I,z)&&z!="constructor"&&x.push(z);return x}function X(I){var x=Ut(I);return x.length==1&&x[0][2]?Zs(x[0][0],x[0][1]):function(z){return z===I||ai(z,I,x)}}function Y(I,x){return ca(I)&&as(x)?Zs(q(I),x):function(z){var ee=Tg(z,I);return ee===void 0&&ee===x?Ig(z,I):Mi(x,ee,void 0,a|s)}}function ne(I){return function(x){return Di(x,I)}}function ae(I){if(typeof I=="string")return I;if(eo(I))return Ir?Ir.call(I):"";var x=I+"";return x=="0"&&1/I==-c?"-0":x}function xe(I){return Be(I)?I:D(I)}function Ze(I){return function(x,z,ee){var be=Object(x);if(!Ft(x)){var de=N(z);x=to(x),z=function(Xe){return de(be[Xe],Xe,be)}}var Ve=I(x,z,ee);return Ve>-1?be[de?x[Ve]:Ve]:void 0}}function gt(I,x,z,ee,be,de){var Ve=be&s,Xe=I.length,ut=x.length;if(Xe!=ut&&!(Ve&&ut>Xe))return!1;var Et=de.get(I);if(Et&&de.get(x))return Et==x;var Wt=-1,rr=!0,St=be&a?new ti:void 0;for(de.set(I,x),de.set(x,I);++Wt<Xe;){var kr=I[Wt],Rr=x[Wt];if(ee)var oi=Ve?ee(Rr,kr,Wt,x,I,de):ee(kr,Rr,Wt,I,x,de);if(oi!==void 0){if(oi)continue;rr=!1;break}if(St){if(!Vr(x,function(Bn,Li){if(!St.has(Li)&&(kr===Bn||z(kr,Bn,ee,be,de)))return St.add(Li)})){rr=!1;break}}else if(!(kr===Rr||z(kr,Rr,ee,be,de))){rr=!1;break}}return de.delete(I),de.delete(x),rr}function Nt(I,x,z,ee,be,de,Ve){switch(z){case M:if(I.byteLength!=x.byteLength||I.byteOffset!=x.byteOffset)return!1;I=I.buffer,x=x.buffer;case P:return!(I.byteLength!=x.byteLength||!ee(new Qr(I),new Qr(x)));case f:case A:case R:return ze(+I,+x);case p:return I.name==x.name&&I.message==x.message;case S:case b:return I==x+"";case O:var Xe=Kr;case d:var ut=de&s;if(Xe||(Xe=_r),I.size!=x.size&&!ut)return!1;var Et=Ve.get(I);if(Et)return Et==x;de|=a,Ve.set(I,x);var Wt=gt(Xe(I),Xe(x),ee,be,de,Ve);return Ve.delete(I),Wt;case E:if(it)return it.call(I)==it.call(x)}return!1}function tr(I,x,z,ee,be,de){var Ve=be&s,Xe=to(I),ut=Xe.length,Et=to(x),Wt=Et.length;if(ut!=Wt&&!Ve)return!1;for(var rr=ut;rr--;){var St=Xe[rr];if(!(Ve?St in x:ft.call(x,St)))return!1}var kr=de.get(I);if(kr&&de.get(x))return kr==x;var Rr=!0;de.set(I,x),de.set(x,I);for(var oi=Ve;++rr<ut;){St=Xe[rr];var Bn=I[St],Li=x[St];if(ee)var Xl=Ve?ee(Li,Bn,St,x,I,de):ee(Bn,Li,St,I,x,de);if(!(Xl===void 0?Bn===Li||z(Bn,Li,ee,be,de):Xl)){Rr=!1;break}oi||(oi=St=="constructor")}if(Rr&&!oi){var ro=I.constructor,no=x.constructor;ro!=no&&"constructor"in I&&"constructor"in x&&!(typeof ro=="function"&&ro instanceof ro&&typeof no=="function"&&no instanceof no)&&(Rr=!1)}return de.delete(I),de.delete(x),Rr}function gr(I,x){var z=I.__data__;return Js(x)?z[typeof x=="string"?"string":"hash"]:z.map}function Ut(I){for(var x=to(I),z=x.length;z--;){var ee=x[z],be=I[ee];x[z]=[ee,be,as(be)]}return x}function We(I,x){var z=zr(I,x);return T(z)?z:void 0}var yt=ii;(ot&&yt(new ot(new ArrayBuffer(1)))!=M||Zt&&yt(new Zt)!=O||Sr&&yt(Sr.resolve())!=g||Ar&&yt(new Ar)!=d||Tr&&yt(new Tr)!=_)&&(yt=function(I){var x=mt.call(I),z=x==m?I.constructor:void 0,ee=z?H(z):void 0;if(ee)switch(ee){case Ht:return M;case yn:return O;case bn:return g;case vn:return d;case wn:return _}return x});function Cr(I,x,z){x=ca(x,I)?[x]:xe(x);for(var ee,be=-1,de=x.length;++be<de;){var Ve=q(x[be]);if(!(ee=I!=null&&z(I,Ve)))break;I=I[Ve]}if(ee)return ee;var de=I?I.length:0;return!!de&&xi(de)&&xn(Ve,de)&&(Be(I)||Ce(I))}function xn(I,x){return x=x??o,!!x&&(typeof I=="number"||Te.test(I))&&(I>-1&&I%1==0)&&I<x}function ca(I,x){if(Be(I))return!1;var z=typeof I;return z=="number"||z=="symbol"||z=="boolean"||I==null||eo(I)?!0:me.test(I)||!fe.test(I)||x!=null&&I in Object(x)}function Js(I){var x=typeof I;return x=="string"||x=="number"||x=="symbol"||x=="boolean"?I!=="__proto__":I===null}function Oc(I){return!!Er&&Er in I}function Dc(I){var x=I&&I.constructor,z=typeof x=="function"&&x.prototype||Lt;return I===z}function as(I){return I===I&&!Tn(I)}function Zs(I,x){return function(z){return z==null?!1:z[I]===x&&(x!==void 0||I in Object(z))}}var D=Fe(function(I){I=Ag(I);var x=[];return pe.test(I)&&x.push(""),I.replace(k,function(z,ee,be,de){x.push(be?de.replace(Z,"$1"):ee||z)}),x});function q(I){if(typeof I=="string"||eo(I))return I;var x=I+"";return x=="0"&&1/I==-c?"-0":x}function H(I){if(I!=null){try{return Xr.call(I)}catch(x){}try{return I+""}catch(x){}}return""}function le(I,x,z){var ee=I?I.length:0;if(!ee)return-1;var be=z==null?0:Eg(z);return be<0&&(be=gn(ee+be,0)),un(I,N(x),be)}var Re=Ze(le);function Fe(I,x){if(typeof I!="function"||x&&typeof x!="function")throw new TypeError(n);var z=function(){var ee=arguments,be=x?x.apply(this,ee):ee[0],de=z.cache;if(de.has(be))return de.get(be);var Ve=I.apply(this,ee);return z.cache=de.set(be,Ve),Ve};return z.cache=new(Fe.Cache||mr),z}Fe.Cache=mr;function ze(I,x){return I===x||I!==I&&x!==x}function Ce(I){return Kt(I)&&ft.call(I,"callee")&&(!pn.call(I,"callee")||mt.call(I)==h)}var Be=Array.isArray;function Ft(I){return I!=null&&xi(I.length)&&!si(I)}function Kt(I){return Bi(I)&&Ft(I)}function si(I){var x=Tn(I)?mt.call(I):"";return x==y||x==v}function xi(I){return typeof I=="number"&&I>-1&&I%1==0&&I<=o}function Tn(I){var x=typeof I;return!!I&&(x=="object"||x=="function")}function Bi(I){return!!I&&typeof I=="object"}function eo(I){return typeof I=="symbol"||Bi(I)&&mt.call(I)==E}var wg=wr?Hr(wr):C;function _g(I){if(!I)return I===0?I:0;if(I=Sg(I),I===c||I===-c){var x=I<0?-1:1;return x*u}return I===I?I:0}function Eg(I){var x=_g(I),z=x%1;return x===x?z?x-z:x:0}function Sg(I){if(typeof I=="number")return I;if(eo(I))return l;if(Tn(I)){var x=typeof I.valueOf=="function"?I.valueOf():I;I=Tn(x)?x+"":x}if(typeof I!="string")return I===0?I:+I;I=I.replace(Q,"");var z=ue.test(I);return z||ce.test(I)?He(I.slice(2),z?2:8):ie.test(I)?l:+I}function Ag(I){return I==null?"":ae(I)}function Tg(I,x,z){var ee=I==null?void 0:Di(I,x);return ee===void 0?z:ee}function Ig(I,x){return I!=null&&Cr(I,x,ns)}function to(I){return Ft(I)?Oi(I):F(I)}function Cg(I){return I}function kg(I){return ca(I)?ln(q(I)):ne(I)}e.exports=Re}),XS="[object Symbol]",QS=Object.prototype,YS=QS.toString;function JS(e,t,r){for(var n=-1,i=e.length;++n<i;){var a=e[n],s=t(a);if(s!=null&&(c===void 0?s===s&&!tA(s):r(s,c)))var c=s,o=a}return o}function ZS(e,t){return e>t}function eA(e){return!!e&&typeof e=="object"}function tA(e){return typeof e=="symbol"||eA(e)&&YS.call(e)==XS}function rA(e){return e}function nA(e){return e&&e.length?JS(e,rA,ZS):void 0}var iA=nA,aA=128,sA=8,oA={0:"Reserved",1:"Interface local",2:"Link local",4:"Admin local",5:"Site local",8:"Organization local",14:"Global",15:"Reserved"},cA={"ff01::1/128":"Multicast (All nodes on this interface)","ff01::2/128":"Multicast (All routers on this interface)","ff02::1/128":"Multicast (All nodes on this link)","ff02::2/128":"Multicast (All routers on this link)","ff05::2/128":"Multicast (All routers in this site)","ff02::5/128":"Multicast (OSPFv3 AllSPF routers)","ff02::6/128":"Multicast (OSPFv3 AllDR routers)","ff02::9/128":"Multicast (RIP routers)","ff02::a/128":"Multicast (EIGRP routers)","ff02::d/128":"Multicast (PIM routers)","ff02::16/128":"Multicast (MLDv2 reports)","ff01::fb/128":"Multicast (mDNSv6)","ff02::fb/128":"Multicast (mDNSv6)","ff05::fb/128":"Multicast (mDNSv6)","ff02::1:2/128":"Multicast (All DHCP servers and relay agents on this link)","ff05::1:2/128":"Multicast (All DHCP servers and relay agents in this site)","ff02::1:3/128":"Multicast (All DHCP servers on this link)","ff05::1:3/128":"Multicast (All DHCP servers in this site)","::/128":"Unspecified","::1/128":"Loopback","ff00::/8":"Multicast","fe80::/10":"Link-local unicast"},uA=/([^0-9a-f:\/%])/ig,lA=/([0-9a-f]{5,}|:{3,}|[^:]:$|^:[^:]|\/$)/ig,dA=/\/\d{1,3}(?=%|$)/,hA=/%.*$/,pA=new RegExp(/^\[{0,1}([0-9a-f:]+)\]{0,1}/),fA=new RegExp(/\[([0-9a-f:]+)\]:([0-9]{1,5})/),Ye={BITS:aA,GROUPS:sA,SCOPES:oA,TYPES:cA,RE_BAD_CHARACTERS:uA,RE_BAD_ADDRESS:lA,RE_SUBNET_STRING:dA,RE_ZONE_STRING:hA,RE_URL:pA,RE_URL_WITH_PORT:fA},mA=function(){return this.valid},gA=nn.isInSubnet,yA=nn.isCorrect(Ye.BITS),bA=nn.falseIfInvalid(function(){return this.addressMinusSuffix===this.canonicalForm()}),vA=nn.falseIfInvalid(function(){return this.getBitsBase2(0,64)==="1111111010000000000000000000000000000000000000000000000000000000"}),wA=nn.falseIfInvalid(function(){return this.getType()==="Multicast"}),_A=nn.falseIfInvalid(function(){return this.v4}),EA=nn.falseIfInvalid(function(){return this.isInSubnet(new this.constructor("2001::/32"))}),SA=nn.falseIfInvalid(function(){return this.isInSubnet(new this.constructor("2002::/16"))}),AA=nn.falseIfInvalid(function(){return this.getType()==="Loopback"}),TA={isValid:mA,isInSubnet:gA,isCorrect:yA,isCanonical:bA,isLinkLocal:vA,isMulticast:wA,is4:_A,isTeredo:EA,is6to4:SA,isLoopback:AA},Vo=re(function(e,t){var r=Es.sprintf,n=t.spanAllZeroes=function(a){return a.replace(/(0+)/g,'<span class="zero">$1</span>')};t.spanAll=function(a,s){s===void 0&&(s=0);var c=a.split("");return c.map(function(o,u){return r('<span class="digit value-%s position-%d">%s</span>',o,u+s,n(o))}).join("")};function i(a){return a.replace(/^(0+)/,'<span class="zero">$1</span>')}t.spanLeadingZeroes=function(a){var s=a.split(":");return s.map(function(c){return i(c)}).join(":")},t.simpleGroup=function(a,s){var c=a.split(":");return s||(s=0),c.map(function(o,u){return/group-v4/.test(o)?o:r('<span class="hover-group group-%d">%s</span>',u+s,i(o))}).join(":")}}),Hi=Es.sprintf,IA=function(e){return e===void 0?e="":e=Hi(":%s",e),Hi("http://[%s]%s/",this.correctForm(),e)},CA=function(e){e||(e={}),e.className===void 0&&(e.className=""),e.prefix===void 0&&(e.prefix="/#address="),e.v4===void 0&&(e.v4=!1);var t=this.correctForm;return e.v4&&(t=this.to4in6),e.className?Hi('<a href="%1$s%2$s" class="%3$s">%2$s</a>',e.prefix,t.call(this),e.className):Hi('<a href="%1$s%2$s">%2$s</a>',e.prefix,t.call(this))},kA=function(){var e=this.address.match(Xt.RE_ADDRESS),t;if(e){var r=e[0].split(".");this.address=this.address.replace(Xt.RE_ADDRESS,Hi('<span class="hover-group group-v4 group-6">%s</span>.<span class="hover-group group-v4 group-7">%s</span>',r.slice(0,2).join("."),r.slice(2,4).join(".")))}if(this.elidedGroups===0)return Vo.simpleGroup(this.address);var n=[],i=this.address.split("::");i[0].length?n.push(Vo.simpleGroup(i[0])):n.push("");var a=["hover-group"];for(t=this.elisionBegin;t<this.elisionBegin+this.elidedGroups;t++)a.push(Hi("group-%d",t));return n.push(Hi('<span class="%s"></span>',a.join(" "))),i[1].length?n.push(Vo.simpleGroup(i[1],this.elisionEnd)):n.push(""),n.join(":")},RA={href:IA,link:CA,group:kA},Ra=Es.sprintf;function $u(e){return Ra("(%s)",e.join("|"))}function Vu(e){return e.length<4?Ra("0{0,%d}%s",4-e.length,e):e}var zp="[^A-Fa-f0-9:]";function Hu(e){var t=[];e.forEach(function(n,i){var a=parseInt(n,16);a===0&&t.push(i)});var r=t.map(function(n){return e.map(function(i,a){if(a===n){var s=a===0||a===Ye.GROUPS-1?":":"";return $u([Vu(i),s])}return Vu(i)}).join(":")});return r.push(e.map(Vu).join(":")),$u(r)}function Kp(e,t,r){var n=t?"":":",i=r?"":":",a=[];!t&&!r&&a.push("::"),t&&r&&a.push(""),(r&&!t||!r&&t)&&a.push(":"),a.push(Ra("%s(:0{1,4}){1,%d}",n,e-1)),a.push(Ra("(0{1,4}:){1,%d}%s",e-1,i)),a.push(Ra("(0{1,4}:){%d}0{1,4}",e-1));for(var s=1;s<e-1;s++)for(var c=1;c<e-s;c++)a.push(Ra("(0{1,4}:){%d}:(0{1,4}:){%d}0{1,4}",c,e-c-s-1));return $u(a)}var PA=function(e){e===void 0&&(e=!1);var t=[],r=new this.constructor(this.correctForm());if(r.elidedGroups===0)t.push(Hu(r.parsedAddress));else if(r.elidedGroups===Ye.GROUPS)t.push(Kp(Ye.GROUPS));else{var n=r.address.split("::");n[0].length&&t.push(Hu(n[0].split(":"))),t.push(Kp(r.elidedGroups,n[0].length!==0,n[1].length!==0)),n[1].length&&t.push(Hu(n[1].split(":"))),t=[t.join(":")]}return e||(t=[].concat("(?=^|",zp,"|[^\\w\\:])(",t,")(?=[^\\w\\:]|",zp,"|$)")),t.join("")},NA=function(e){return new RegExp(this.regularExpressionString(e),"i")},OA={regularExpressionString:PA,regularExpression:NA},Qt=_p.BigInteger,zn=Es.sprintf;function DA(e){for(var t=/(\d+)(\d{3})/;t.test(e);)e=e.replace(t,"$1,$2");return e}function MA(e){return e=e.replace(/^(0{1,})([1-9]+)$/,'<span class="parse-error">$1</span>$2'),e=e.replace(/^(0{1,})(0)$/,'<span class="parse-error">$1</span>$2'),e}function ye(e,t){t===void 0?this.groups=Ye.GROUPS:this.groups=t,this.v4=!1,this.subnet="/128",this.subnetMask=128,this.zone="",this.address=e;var r=Ye.RE_SUBNET_STRING.exec(e);if(r){if(this.parsedSubnet=r[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,isNaN(this.subnetMask)||this.subnetMask<0||this.subnetMask>Ye.BITS){this.valid=!1,this.error="Invalid subnet mask.";return}e=e.replace(Ye.RE_SUBNET_STRING,"")}else if(/\//.test(e)){this.valid=!1,this.error="Invalid subnet mask.";return}var n=Ye.RE_ZONE_STRING.exec(e);n&&(this.zone=n[0],e=e.replace(Ye.RE_ZONE_STRING,"")),this.addressMinusSuffix=e,this.parsedAddress=this.parse(this.addressMinusSuffix)}Gu(ye.prototype,TA),Gu(ye.prototype,RA),Gu(ye.prototype,OA),ye.fromBigInteger=function(e){var t=Ss(e.toString(16),32,"0"),r=[],n;for(n=0;n<Ye.GROUPS;n++)r.push(t.slice(n*4,(n+1)*4));return new ye(r.join(":"))},ye.fromURL=function(e){var t,r,n;if(e.indexOf("[")!==-1&&e.indexOf("]:")!==-1){if(n=Ye.RE_URL_WITH_PORT.exec(e),n===null)return{error:"failed to parse address with port",address:null,port:null};t=n[1],r=n[2]}else if(e.indexOf("/")!==-1){if(e=e.replace(/^[a-z0-9]+:\/\//,""),n=Ye.RE_URL.exec(e),n===null)return{error:"failed to parse address from URL",address:null,port:null};t=n[1]}else t=e;return r?(r=parseInt(r,10),(r<0||r>65536)&&(r=null)):r=null,{address:new ye(t),port:r}},ye.fromAddress4=function(e){var e=new Vi(e),t=Ye.BITS-(Xt.BITS-e.subnetMask);return new ye("::ffff:"+e.correctForm()+"/"+t)},ye.fromArpa=function(e){var t=e.replace(/(\.ip6\.arpa)?\.$/,""),r=7;if(t.length!==63)return t={error:"Not Valid 'ip6.arpa' form",address:null},t;t=t.split(".").reverse();for(var n=r;n>0;n--){var i=n*4;t.splice(i,0,":")}return t=t.join(""),new ye(t)};function xA(e,t){var r=[],n=[],i;for(i=0;i<e.length;i++)i<t[0]?r.push(e[i]):i>t[1]&&n.push(e[i]);return r.concat(["compact"]).concat(n)}ye.prototype.microsoftTranscription=function(){return zn("%s.ipv6-literal.net",this.correctForm().replace(/:/g,"-"))},ye.prototype.mask=function(e){return e===void 0&&(e=this.subnetMask),this.getBitsBase2(0,e)},ye.prototype.possibleSubnets=function(e){e===void 0&&(e=128);var t=Ye.BITS-this.subnetMask,r=Math.abs(e-Ye.BITS),n=t-r;return n<0?"0":DA(new Qt("2",10).pow(n).toString(10))},ye.prototype._startAddress=function(){return new Qt(this.mask()+Go("0",Ye.BITS-this.subnetMask),2)},ye.prototype.startAddress=function(){return ye.fromBigInteger(this._startAddress())},ye.prototype.startAddressExclusive=function(){var e=new Qt("1");return ye.fromBigInteger(this._startAddress().add(e))},ye.prototype._endAddress=function(){return new Qt(this.mask()+Go("1",Ye.BITS-this.subnetMask),2)},ye.prototype.endAddress=function(){return ye.fromBigInteger(this._endAddress())},ye.prototype.endAddressExclusive=function(){var e=new Qt("1");return ye.fromBigInteger(this._endAddress().subtract(e))},ye.prototype.getScope=function(){var e=Ye.SCOPES[this.getBits(12,16)];return this.getType()==="Global unicast"&&e!=="Link local"&&(e="Global"),e},ye.prototype.getType=function(){var e=this;function t(r,n){return e.isInSubnet(new ye(n))}return WS(Ye.TYPES,t)||"Global unicast"},ye.prototype.getBits=function(e,t){return new Qt(this.getBitsBase2(e,t),2)},ye.prototype.getBitsBase2=function(e,t){return this.binaryZeroPad().slice(e,t)},ye.prototype.getBitsBase16=function(e,t){var r=t-e;return r%4!==0?null:Ss(this.getBits(e,t).toString(16),r/4,"0")},ye.prototype.getBitsPastSubnet=function(){return this.getBitsBase2(this.subnetMask,Ye.BITS)},ye.prototype.reverseForm=function(e){e||(e={});var t=Math.floor(this.subnetMask/4),r=this.canonicalForm().replace(/:/g,"").split("").slice(0,t).reverse().join(".");return t>0?e.omitSuffix?r:zn("%s.ip6.arpa.",r):e.omitSuffix?"":"ip6.arpa."},ye.prototype.correctForm=function(){if(!this.parsedAddress)return null;var e,t=[],r=0,n=[];for(e=0;e<this.parsedAddress.length;e++){var i=parseInt(this.parsedAddress[e],16);i===0&&r++,i!==0&&r>0&&(r>1&&n.push([e-r,e-1]),r=0)}r>1&&n.push([this.parsedAddress.length-r,this.parsedAddress.length-1]);var a=n.map(function(o){return o[1]-o[0]+1});if(n.length>0){var s=a.indexOf(iA(a));t=xA(this.parsedAddress,n[s])}else t=this.parsedAddress;for(e=0;e<t.length;e++)t[e]!=="compact"&&(t[e]=parseInt(t[e],16).toString(16));var c=t.join(":");return c=c.replace(/^compact$/,"::"),c=c.replace(/^compact|compact$/,":"),c=c.replace(/compact/,""),c},ye.prototype.binaryZeroPad=function(){return Ss(this.bigInteger().toString(2),Ye.BITS,"0")},ye.prototype.parse4in6=function(e){var t=e.split(":"),r=t.slice(-1)[0],n=r.match(Xt.RE_ADDRESS);if(n){for(var i=new Vi(n[0]),a=0;a<i.groups;a++)if(/^0[0-9]+/.test(i.parsedAddress[a]))return this.valid=!1,this.error="IPv4 addresses can not have leading zeroes.",this.parseError=e.replace(Xt.RE_ADDRESS,i.parsedAddress.map(MA).join(".")),null;this.v4=!0,t[t.length-1]=i.toGroup6(),e=t.join(":")}return e},ye.prototype.parse=function(e){if(e=this.parse4in6(e),this.error)return null;var t=e.match(Ye.RE_BAD_CHARACTERS);if(t)return this.valid=!1,this.error=zn("Bad character%s detected in address: %s",t.length>1?"s":"",t.join("")),this.parseError=e.replace(Ye.RE_BAD_CHARACTERS,'<span class="parse-error">$1</span>'),null;var r=e.match(Ye.RE_BAD_ADDRESS);if(r)return this.valid=!1,this.error=zn("Address failed regex: %s",r.join("")),this.parseError=e.replace(Ye.RE_BAD_ADDRESS,'<span class="parse-error">$1</span>'),null;var n=[],i=e.split("::");if(i.length===2){var a=i[0].split(":"),s=i[1].split(":");a.length===1&&a[0]===""&&(a=[]),s.length===1&&s[0]===""&&(s=[]);var c=this.groups-(a.length+s.length);if(!c)return this.valid=!1,this.error="Error parsing groups",null;this.elidedGroups=c,this.elisionBegin=a.length,this.elisionEnd=a.length+this.elidedGroups,a.forEach(function(u){n.push(u)});for(var o=0;o<c;o++)n.push(0);s.forEach(function(u){n.push(u)})}else if(i.length===1)n=e.split(":"),this.elidedGroups=0;else return this.valid=!1,this.error="Too many :: groups found",null;return n=n.map(function(u){return zn("%x",parseInt(u,16))}),n.length!==this.groups?(this.valid=!1,this.error="Incorrect number of groups found",null):(this.valid=!0,n)};function Wp(e){return zn("%04x",parseInt(e,16))}ye.prototype.canonicalForm=function(){return this.valid?this.parsedAddress.map(Wp).join(":"):null},ye.prototype.decimal=function(){return this.valid?this.parsedAddress.map(function(e){return zn("%05d",parseInt(e,16))}).join(":"):null},ye.prototype.bigInteger=function(){return this.valid?new Qt(this.parsedAddress.map(Wp).join(""),16):null},ye.prototype.to4=function(){var e=this.binaryZeroPad().split("");return Vi.fromHex(new Qt(e.slice(96,128).join(""),2).toString(16))},ye.prototype.to4in6=function(){var e=this.to4(),t=new ye(this.parsedAddress.slice(0,6).join(":"),6),r=t.correctForm(),n="";return/:$/.test(r)||(n=":"),t.correctForm()+n+e.address},ye.prototype.inspectTeredo=function(){var e=this.getBitsBase16(0,32),t=this.getBits(80,96).xor(new Qt("ffff",16)).toString(),r=Vi.fromHex(this.getBitsBase16(32,64)),n=Vi.fromHex(this.getBits(96,128).xor(new Qt("ffffffff",16)).toString(16)),i=this.getBits(64,80),a=this.getBitsBase2(64,80),s=i.testBit(15),c=i.testBit(14),o=i.testBit(8),u=i.testBit(9),l=new Qt(a.slice(2,6)+a.slice(8,16),2).toString(10);return{prefix:zn("%s:%s",e.slice(0,4),e.slice(4,8)),server4:r.address,client4:n.address,flags:a,coneNat:s,microsoft:{reserved:c,universalLocal:u,groupIndividual:o,nonce:l},udpPort:t}},ye.prototype.inspect6to4=function(){var e=this.getBitsBase16(0,16),t=Vi.fromHex(this.getBitsBase16(16,48));return{prefix:zn("%s",e.slice(0,4)),gateway:t.address}},ye.prototype.to6to4=function(){if(!this.is4())return null;var e=["2002",this.getBitsBase16(96,112),this.getBitsBase16(112,128),"","/16"].join(":");return new ye(e)},ye.prototype.toByteArray=function(){var e=this.bigInteger().toByteArray();return e.length===17&&e[0]===0?e.slice(1):e};function Xp(e){return e&255}ye.prototype.toUnsignedByteArray=function(){return this.toByteArray().map(Xp)},ye.fromByteArray=function(e){return this.fromUnsignedByteArray(e.map(Xp))},ye.fromUnsignedByteArray=function(e){for(var t=new Qt("256",10),r=new Qt("0",10),n=new Qt("1",10),i=e.length-1;i>=0;i--)r=r.add(n.multiply(new Qt(e[i].toString(10),10))),n=n.multiply(t);return ye.fromBigInteger(r)};var BA=ye,LA=Vi,jA=BA,UA={helpers:Vo},FA={Address4:LA,Address6:jA,v6:UA};const{Address4:qA,Address6:GA}=FA,Ho={ERR_INVALID_IP_PARAMETER:"ERR_INVALID_IP_PARAMETER",ERR_INVALID_PORT_PARAMETER:"ERR_INVALID_PORT_PARAMETER",ERR_INVALID_IP:"ERR_INVALID_IP"};function $A(e,t){if(typeof e!="string")throw U(new Error(`invalid ip provided: ${e}`),Ho.ERR_INVALID_IP_PARAMETER);if(t=parseInt(t),isNaN(t))throw U(new Error(`invalid port provided: ${t}`),Ho.ERR_INVALID_PORT_PARAMETER);if(new qA(e).isValid())return Ne(`/ip4/${e}/tcp/${t}`);const r=new GA(e);if(r.isValid())return r.is4()?Ne(`/ip4/${r.to4().correctForm()}/tcp/${t}`):Ne(`/ip6/${e}/tcp/${t}`);throw U(new Error(`invalid ip:port for creating a multiaddr: ${e}:${t}`),Ho.ERR_INVALID_IP)}var zi=$A,VA=Ho;zi.Errors=VA;var HA=(e,t)=>(t=t||(()=>{}),e.then(r=>new Promise(n=>{n(t())}).then(()=>r),r=>new Promise(n=>{n(t())}).then(()=>{throw r})));class Qp extends Error{constructor(e){super(e);this.name="TimeoutError"}}const Yp=(e,t,r)=>new Promise((n,i)=>{if(typeof t!="number"||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===Infinity){n(e);return}const a=setTimeout(()=>{if(typeof r=="function"){try{n(r())}catch(o){i(o)}return}const s=typeof r=="string"?r:`Promise timed out after ${t} milliseconds`,c=r instanceof Error?r:new Qp(s);typeof e.cancel=="function"&&e.cancel(),i(c)},t);HA(e.then(n,i),()=>{clearTimeout(a)})});var kn=Yp,zA=Yp,KA=Qp;kn.default=zA,kn.TimeoutError=KA;const{CLOSE_TIMEOUT:WA}=wp,zu=te("libp2p:websockets:socket");zu.error=te("libp2p:websockets:socket:error");var Jp=(e,t={})=>{const r={async sink(n){t.signal&&(n=vt(n,t.signal));try{await e.sink(async function*(){for await(const i of n)yield i instanceof Uint8Array?i:i.slice()}())}catch(i){i.type!=="aborted"&&zu.error(i)}},source:t.signal?vt(e.source,t.signal):e.source,conn:e,localAddr:t.localAddr||(e.localAddress&&e.localPort?zi(e.localAddress,e.localPort):void 0),remoteAddr:t.remoteAddr||zi(e.remoteAddress,e.remotePort),timeline:{open:Date.now()},async close(){const n=Date.now();try{await kn(e.close(),WA)}catch(i){const{host:a,port:s}=r.remoteAddr.toOptions();zu("timeout closing stream to %s:%s after %dms, destroying it manually",a,s,Date.now()-n),e.destroy()}finally{r.timeline.close=Date.now()}}};return e.socket.once&&e.socket.once("close",()=>{r.timeline.close||(r.timeline.close=Date.now())}),r};const{createServer:XA}=RE,zo=te("libp2p:websockets:listener");zo.error=te("libp2p:websockets:listener:error");var QA=({handler:e,upgrader:t},r={})=>{const n=new At,i=XA(r,async s=>{let c,o;try{c=Jp(s),zo("new inbound connection %s",c.remoteAddr),o=await t.upgradeInbound(c)}catch(u){return zo.error("inbound connection failed to upgrade",u),c&&c.close()}zo("inbound connection %s upgraded",c.remoteAddr),YA(i,c),e&&e(o),n.emit("connection",o)});i.on("listening",()=>n.emit("listening")).on("error",s=>n.emit("error",s)).on("close",()=>n.emit("close")),i.__connections=[];let a;return n.close=()=>(i.__connections.forEach(s=>s.close()),i.close()),n.listen=s=>(a=s,i.listen(s.toOptions())),n.getAddrs=()=>{const s=[],c=i.address();if(!c)throw new Error("Listener is not ready yet");const o=a.getPeerId();if(a.toString().indexOf("ip4")!==-1){let u=a.decapsulate("tcp");if(u=u.encapsulate("/tcp/"+c.port+"/ws"),a.getPeerId()&&(u=u.encapsulate("/p2p/"+o)),u.toString().indexOf("0.0.0.0")!==-1){const l=ed.networkInterfaces();Object.keys(l).forEach(h=>{l[h].forEach(w=>{w.family==="IPv4"&&s.push(Ne(u.toString().replace("0.0.0.0",w.address)))})})}else s.push(u)}return s},n};function YA(e,t){e.__connections.push(t)}const{AbortError:Zp}=vt,Pa=te("libp2p:websockets"),{CODE_CIRCUIT:JA,CODE_P2P:ef}=wp;class ZA{constructor({upgrader:e}){if(!e)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=e}async dial(e,t={}){Pa("dialing %s",e);const r=await this._connect(e,t),n=Jp(r,{remoteAddr:e,signal:t.signal});Pa("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return Pa("outbound connection %s upgraded",n.remoteAddr),i}async _connect(e,t={}){if(t.signal&&t.signal.aborted)throw new Zp;const r=e.toOptions();Pa("dialing %s:%s",r.host,r.port);const n=vp(kE(e),Object.assign({binary:!0},t));if(!t.signal)return await n.connected(),Pa("connected %s",e),n;let i;const a=new Promise((s,c)=>{if(i=()=>{c(new Zp),n.close()},t.signal.aborted)return i();t.signal.addEventListener("abort",i)});try{await Promise.race([a,n.connected()])}finally{t.signal.removeEventListener("abort",i)}return Pa("connected %s",e),n}createListener(e={},t){return typeof e=="function"&&(t=e,e={}),QA({handler:t,upgrader:this._upgrader},e)}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>t.protoCodes().includes(JA)?!1:hs.WebSockets.matches(t.decapsulateCode(ef))||hs.WebSocketsSecure.matches(t.decapsulateCode(ef)))}}var eT=Pr(ZA,{className:"WebSockets",symbolName:"@libp2p/js-libp2p-websockets/websockets"}),Ki=At.EventEmitter;function tf(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function tT(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?tf(Object(r),!0).forEach(function(n){rT(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rT(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nT(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function rf(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function iT(e,t,r){return t&&rf(e.prototype,t),r&&rf(e,r),e}var Ko=Yr.Buffer,Ku=Ln.inspect,aT=Ku&&Ku.custom||"inspect";function sT(e,t,r){Ko.prototype.copy.call(e,t,r)}var oT=function(){function e(){nT(this,e),this.head=null,this.tail=null,this.length=0}return iT(e,[{key:"push",value:function(r){var n={data:r,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}},{key:"unshift",value:function(r){var n={data:r,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length}},{key:"shift",value:function(){if(this.length===0)return;var r=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,r}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(r){if(this.length===0)return"";for(var n=this.head,i=""+n.data;n=n.next;)i+=r+n.data;return i}},{key:"concat",value:function(r){if(this.length===0)return Ko.alloc(0);for(var n=Ko.allocUnsafe(r>>>0),i=this.head,a=0;i;)sT(i.data,n,a),a+=i.data.length,i=i.next;return n}},{key:"consume",value:function(r,n){var i;return r<this.head.data.length?(i=this.head.data.slice(0,r),this.head.data=this.head.data.slice(r)):r===this.head.data.length?i=this.shift():i=n?this._getString(r):this._getBuffer(r),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(r){var n=this.head,i=1,a=n.data;for(r-=a.length;n=n.next;){var s=n.data,c=r>s.length?s.length:r;if(c===s.length?a+=s:a+=s.slice(0,r),r-=c,r===0){c===s.length?(++i,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=s.slice(c));break}++i}return this.length-=i,a}},{key:"_getBuffer",value:function(r){var n=Ko.allocUnsafe(r),i=this.head,a=1;for(i.data.copy(n),r-=i.data.length;i=i.next;){var s=i.data,c=r>s.length?s.length:r;if(s.copy(n,n.length-r,0,c),r-=c,r===0){c===s.length?(++a,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=s.slice(c));break}++a}return this.length-=a,n}},{key:aT,value:function(r,n){return Ku(this,tT({},n,{depth:0,customInspect:!1}))}}]),e}();function cT(e,t){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,_e.nextTick(Wu,this,e)):_e.nextTick(Wu,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(a){!t&&a?r._writableState?r._writableState.errorEmitted?_e.nextTick(Wo,r):(r._writableState.errorEmitted=!0,_e.nextTick(nf,r,a)):_e.nextTick(nf,r,a):t?(_e.nextTick(Wo,r),t(a)):_e.nextTick(Wo,r)}),this)}function nf(e,t){Wu(e,t),Wo(e)}function Wo(e){if(e._writableState&&!e._writableState.emitClose)return;if(e._readableState&&!e._readableState.emitClose)return;e.emit("close")}function uT(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function Wu(e,t){e.emit("error",t)}function lT(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}var Na={destroy:cT,undestroy:uT,errorOrDestroy:lT};function dT(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var af={};function jr(e,t,r){r||(r=Error);function n(a,s,c){return typeof t=="string"?t:t(a,s,c)}var i=function(a){dT(s,a);function s(c,o,u){return a.call(this,n(c,o,u))||this}return s}(r);i.prototype.name=r.name,i.prototype.code=e,af[e]=i}function sf(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map(function(n){return String(n)}),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:r===2?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}else return"of ".concat(t," ").concat(String(e))}function hT(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}function pT(e,t,r){return(r===void 0||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function fT(e,t,r){return typeof r!="number"&&(r=0),r+t.length>e.length?!1:e.indexOf(t,r)!==-1}jr("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),jr("ERR_INVALID_ARG_TYPE",function(e,t,r){var n;typeof t=="string"&&hT(t,"not ")?(n="must not be",t=t.replace(/^not /,"")):n="must be";var i;if(pT(e," argument"))i="The ".concat(e," ").concat(n," ").concat(sf(t,"type"));else{var a=fT(e,".")?"property":"argument";i='The "'.concat(e,'" ').concat(a," ").concat(n," ").concat(sf(t,"type"))}return i+=". Received type ".concat(typeof r),i},TypeError),jr("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),jr("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),jr("ERR_STREAM_PREMATURE_CLOSE","Premature close"),jr("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),jr("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),jr("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),jr("ERR_STREAM_WRITE_AFTER_END","write after end"),jr("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),jr("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),jr("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");var mT=af,Oa={codes:mT},gT=Oa.codes.ERR_INVALID_OPT_VALUE;function yT(e,t,r){return e.highWaterMark!=null?e.highWaterMark:t?e[r]:null}function bT(e,t,r,n){var i=yT(t,n,r);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var a=n?r:"highWaterMark";throw new gT(a,i)}return Math.floor(i)}return e.objectMode?16:16*1024}var of={getHighWaterMark:bT},Xo=rt;function cf(e){var t=this;this.next=null,this.entry=null,this.finish=function(){VT(t,e)}}var Da;rt.WritableState=Ts;var vT={deprecate:xg},Qo=Yr.Buffer,wT=ge.Uint8Array||function(){};function _T(e){return Qo.from(e)}function ET(e){return Qo.isBuffer(e)||e instanceof wT}var ST=of.getHighWaterMark,gi=Oa.codes,AT=gi.ERR_INVALID_ARG_TYPE,TT=gi.ERR_METHOD_NOT_IMPLEMENTED,IT=gi.ERR_MULTIPLE_CALLBACK,CT=gi.ERR_STREAM_CANNOT_PIPE,kT=gi.ERR_STREAM_DESTROYED,RT=gi.ERR_STREAM_NULL_VALUES,PT=gi.ERR_STREAM_WRITE_AFTER_END,NT=gi.ERR_UNKNOWN_ENCODING,Ma=Na.errorOrDestroy;ss(rt,Ki);function OT(){}function Ts(e,t,r){Da=Da||Kn,e=e||{},typeof r!="boolean"&&(r=t instanceof Da),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=ST(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var n=e.decodeStrings===!1;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(i){UT(t,i)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=e.emitClose!==!1,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new cf(this)}Ts.prototype.getBuffer=function(){for(var t=this.bufferedRequest,r=[];t;)r.push(t),t=t.next;return r},function(){try{Object.defineProperty(Ts.prototype,"buffer",{get:vT.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}();var Yo;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Yo=Function.prototype[Symbol.hasInstance],Object.defineProperty(rt,Symbol.hasInstance,{value:function(t){return Yo.call(this,t)?!0:this!==rt?!1:t&&t._writableState instanceof Ts}})):Yo=function(t){return t instanceof this};function rt(e){Da=Da||Kn;var t=this instanceof Da;if(!t&&!Yo.call(rt,this))return new rt(e);this._writableState=new Ts(e,this,t),this.writable=!0,e&&(typeof e.write=="function"&&(this._write=e.write),typeof e.writev=="function"&&(this._writev=e.writev),typeof e.destroy=="function"&&(this._destroy=e.destroy),typeof e.final=="function"&&(this._final=e.final)),Ki.call(this)}rt.prototype.pipe=function(){Ma(this,new CT)};function DT(e,t){var r=new PT;Ma(e,r),_e.nextTick(t,r)}function MT(e,t,r,n){var i;return r===null?i=new RT:typeof r!="string"&&!t.objectMode&&(i=new AT("chunk",["string","Buffer"],r)),i?(Ma(e,i),_e.nextTick(n,i),!1):!0}rt.prototype.write=function(e,t,r){var n=this._writableState,i=!1,a=!n.objectMode&&ET(e);return a&&!Qo.isBuffer(e)&&(e=_T(e)),typeof t=="function"&&(r=t,t=null),a?t="buffer":t||(t=n.defaultEncoding),typeof r!="function"&&(r=OT),n.ending?DT(this,r):(a||MT(this,n,e,r))&&(n.pendingcb++,i=BT(this,n,a,e,t,r)),i},rt.prototype.cork=function(){this._writableState.corked++},rt.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,!e.writing&&!e.corked&&!e.bufferProcessing&&e.bufferedRequest&&lf(this,e))},rt.prototype.setDefaultEncoding=function(t){if(typeof t=="string"&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new NT(t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(rt.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function xT(e,t,r){return!e.objectMode&&e.decodeStrings!==!1&&typeof t=="string"&&(t=Qo.from(t,r)),t}Object.defineProperty(rt.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function BT(e,t,r,n,i,a){if(!r){var s=xT(t,n,i);n!==s&&(r=!0,i="buffer",n=s)}var c=t.objectMode?1:n.length;t.length+=c;var o=t.length<t.highWaterMark;if(o||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:a,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else Xu(e,t,!1,c,n,i,a);return o}function Xu(e,t,r,n,i,a,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new kT("write")):r?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function LT(e,t,r,n,i){--t.pendingcb,r?(_e.nextTick(i,n),_e.nextTick(Is,e,t),e._writableState.errorEmitted=!0,Ma(e,n)):(i(n),e._writableState.errorEmitted=!0,Ma(e,n),Is(e,t))}function jT(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function UT(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(typeof i!="function")throw new IT;if(jT(r),t)LT(e,r,n,t,i);else{var a=df(r)||e.destroyed;!a&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&lf(e,r),n?_e.nextTick(uf,e,r,a,i):uf(e,r,a,i)}}function uf(e,t,r,n){r||FT(e,t),t.pendingcb--,n(),Is(e,t)}function FT(e,t){t.length===0&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function lf(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),a=t.corkedRequestsFree;a.entry=r;for(var s=0,c=!0;r;)i[s]=r,r.isBuf||(c=!1),r=r.next,s+=1;i.allBuffers=c,Xu(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new cf(t),t.bufferedRequestCount=0}else{for(;r;){var o=r.chunk,u=r.encoding,l=r.callback,h=t.objectMode?1:o.length;if(Xu(e,t,!1,h,o,u,l),r=r.next,t.bufferedRequestCount--,t.writing)break}r===null&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}rt.prototype._write=function(e,t,r){r(new TT("_write()"))},rt.prototype._writev=null,rt.prototype.end=function(e,t,r){var n=this._writableState;return typeof e=="function"?(r=e,e=null,t=null):typeof t=="function"&&(r=t,t=null),e!=null&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||$T(this,n,r),this},Object.defineProperty(rt.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function df(e){return e.ending&&e.length===0&&e.bufferedRequest===null&&!e.finished&&!e.writing}function qT(e,t){e._final(function(r){t.pendingcb--,r&&Ma(e,r),t.prefinished=!0,e.emit("prefinish"),Is(e,t)})}function GT(e,t){!t.prefinished&&!t.finalCalled&&(typeof e._final=="function"&&!t.destroyed?(t.pendingcb++,t.finalCalled=!0,_e.nextTick(qT,e,t)):(t.prefinished=!0,e.emit("prefinish")))}function Is(e,t){var r=df(t);if(r&&(GT(e,t),t.pendingcb===0&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}function $T(e,t,r){t.ending=!0,Is(e,t),r&&(t.finished?_e.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function VT(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}Object.defineProperty(rt.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(t){if(!this._writableState)return;this._writableState.destroyed=t}}),rt.prototype.destroy=Na.destroy,rt.prototype._undestroy=Na.undestroy,rt.prototype._destroy=function(e,t){t(e)};var HT=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t},Kn=Rn;ss(Rn,rl);for(var hf=HT(Xo.prototype),Qu=0;Qu<hf.length;Qu++){var Yu=hf[Qu];Rn.prototype[Yu]||(Rn.prototype[Yu]=Xo.prototype[Yu])}function Rn(e){if(!(this instanceof Rn))return new Rn(e);rl.call(this,e),Xo.call(this,e),this.allowHalfOpen=!0,e&&(e.readable===!1&&(this.readable=!1),e.writable===!1&&(this.writable=!1),e.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",zT)))}Object.defineProperty(Rn.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(Rn.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(Rn.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function zT(){if(this._writableState.ended)return;_e.nextTick(KT,this)}function KT(e){e.end()}Object.defineProperty(Rn.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(t){if(this._readableState===void 0||this._writableState===void 0)return;this._readableState.destroyed=t,this._writableState.destroyed=t}});var Ju=Bg.Buffer,pf=Ju.isEncoding||function(e){e=""+e;switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function WT(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function XT(e){var t=WT(e);if(typeof t!="string"&&(Ju.isEncoding===pf||!pf(e)))throw new Error("Unknown encoding: "+e);return t||e}var QT=Cs;function Cs(e){this.encoding=XT(e);var t;switch(this.encoding){case"utf16le":this.text=rI,this.end=nI,t=4;break;case"utf8":this.fillLast=ZT,t=4;break;case"base64":this.text=iI,this.end=aI,t=3;break;default:this.write=sI,this.end=oI;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=Ju.allocUnsafe(t)}Cs.prototype.write=function(e){if(e.length===0)return"";var t,r;if(this.lastNeed){if(t=this.fillLast(e),t===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},Cs.prototype.end=tI,Cs.prototype.text=eI,Cs.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length};function Zu(e){return e<=127?0:e>>5===6?2:e>>4===14?3:e>>3===30?4:e>>6===2?-1:-2}function YT(e,t,r){var n=t.length-1;if(n<r)return 0;var i=Zu(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||i===-2?0:(i=Zu(t[n]),i>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||i===-2?0:(i=Zu(t[n]),i>=0?(i>0&&(i===2?i=0:e.lastNeed=i-3),i):0))}function JT(e,t,r){if((t[0]&192)!==128)return e.lastNeed=0,"\uFFFD";if(e.lastNeed>1&&t.length>1){if((t[1]&192)!==128)return e.lastNeed=1,"\uFFFD";if(e.lastNeed>2&&t.length>2&&(t[2]&192)!==128)return e.lastNeed=2,"\uFFFD"}}function ZT(e){var t=this.lastTotal-this.lastNeed,r=JT(this,e);if(r!==void 0)return r;if(this.lastNeed<=e.length)return e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length}function eI(e,t){var r=YT(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)}function tI(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\uFFFD":t}function rI(e,t){if((e.length-t)%2===0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function nI(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function iI(e,t){var r=(e.length-t)%3;return r===0?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function aI(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function sI(e){return e.toString(this.encoding)}function oI(e){return e&&e.length?this.write(e):""}var ff={StringDecoder:QT},mf=Oa.codes.ERR_STREAM_PREMATURE_CLOSE;function cI(e){var t=!1;return function(){if(t)return;t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}function uI(){}function lI(e){return e.setHeader&&typeof e.abort=="function"}function gf(e,t,r){if(typeof t=="function")return gf(e,null,t);t||(t={}),r=cI(r||uI);var n=t.readable||t.readable!==!1&&e.readable,i=t.writable||t.writable!==!1&&e.writable,a=function(){e.writable||c()},s=e._writableState&&e._writableState.finished,c=function(){i=!1,s=!0,n||r.call(e)},o=e._readableState&&e._readableState.endEmitted,u=function(){n=!1,o=!0,i||r.call(e)},l=function(A){r.call(e,A)},h=function(){var A;if(n&&!o)return(!e._readableState||!e._readableState.ended)&&(A=new mf),r.call(e,A);if(i&&!s)return(!e._writableState||!e._writableState.ended)&&(A=new mf),r.call(e,A)},w=function(){e.req.on("finish",c)};return lI(e)?(e.on("complete",c),e.on("abort",h),e.req?w():e.on("request",w)):i&&!e._writableState&&(e.on("end",a),e.on("close",a)),e.on("end",u),e.on("finish",c),t.error!==!1&&e.on("error",l),e.on("close",h),function(){e.removeListener("complete",c),e.removeListener("abort",h),e.removeListener("request",w),e.req&&e.req.removeListener("finish",c),e.removeListener("end",a),e.removeListener("close",a),e.removeListener("finish",c),e.removeListener("end",u),e.removeListener("error",l),e.removeListener("close",h)}}var el=gf,Jo;function yi(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var bi=Symbol("lastResolve"),Wi=Symbol("lastReject"),ks=Symbol("error"),Zo=Symbol("ended"),Xi=Symbol("lastPromise"),tl=Symbol("handlePromise"),Qi=Symbol("stream");function vi(e,t){return{value:e,done:t}}function dI(e){var t=e[bi];if(t!==null){var r=e[Qi].read();r!==null&&(e[Xi]=null,e[bi]=null,e[Wi]=null,t(vi(r,!1)))}}function hI(e){_e.nextTick(dI,e)}function pI(e,t){return function(r,n){e.then(function(){if(t[Zo]){r(vi(void 0,!0));return}t[tl](r,n)},n)}}var fI=Object.getPrototypeOf(function(){}),mI=Object.setPrototypeOf((Jo={get stream(){return this[Qi]},next:function(){var t=this,r=this[ks];if(r!==null)return Promise.reject(r);if(this[Zo])return Promise.resolve(vi(void 0,!0));if(this[Qi].destroyed)return new Promise(function(s,c){_e.nextTick(function(){t[ks]?c(t[ks]):s(vi(void 0,!0))})});var n=this[Xi],i;if(n)i=new Promise(pI(n,this));else{var a=this[Qi].read();if(a!==null)return Promise.resolve(vi(a,!1));i=new Promise(this[tl])}return this[Xi]=i,i}},yi(Jo,Symbol.asyncIterator,function(){return this}),yi(Jo,"return",function(){var t=this;return new Promise(function(r,n){t[Qi].destroy(null,function(i){if(i){n(i);return}r(vi(void 0,!0))})})}),Jo),fI),gI=function(t){var r,n=Object.create(mI,(r={},yi(r,Qi,{value:t,writable:!0}),yi(r,bi,{value:null,writable:!0}),yi(r,Wi,{value:null,writable:!0}),yi(r,ks,{value:null,writable:!0}),yi(r,Zo,{value:t._readableState.endEmitted,writable:!0}),yi(r,tl,{value:function(a,s){var c=n[Qi].read();c?(n[Xi]=null,n[bi]=null,n[Wi]=null,a(vi(c,!1))):(n[bi]=a,n[Wi]=s)},writable:!0}),r));return n[Xi]=null,el(t,function(i){if(i&&i.code!=="ERR_STREAM_PREMATURE_CLOSE"){var a=n[Wi];a!==null&&(n[Xi]=null,n[bi]=null,n[Wi]=null,a(i)),n[ks]=i;return}var s=n[bi];s!==null&&(n[Xi]=null,n[bi]=null,n[Wi]=null,s(vi(void 0,!0))),n[Zo]=!0}),t.on("readable",hI.bind(null,n)),n},yI=gI,bI=function(){throw new Error("Readable.from is not available in the browser")},rl=Me,xa;Me.ReadableState=bf;var VO=At.EventEmitter,yf=function(t,r){return t.listeners(r).length},ec=Yr.Buffer,vI=ge.Uint8Array||function(){};function wI(e){return ec.from(e)}function _I(e){return ec.isBuffer(e)||e instanceof vI}var ke;Ln&&Ln.debuglog?ke=Ln.debuglog("stream"):ke=function(){};var EI=of.getHighWaterMark,tc=Oa.codes,SI=tc.ERR_INVALID_ARG_TYPE,AI=tc.ERR_STREAM_PUSH_AFTER_EOF,TI=tc.ERR_METHOD_NOT_IMPLEMENTED,II=tc.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,Ba,nl,il;ss(Me,Ki);var Rs=Na.errorOrDestroy,al=["error","close","destroy","pause","resume"];function CI(e,t,r){if(typeof e.prependListener=="function")return e.prependListener(t,r);!e._events||!e._events[t]?e.on(t,r):Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]}function bf(e,t,r){xa=xa||Kn,e=e||{},typeof r!="boolean"&&(r=t instanceof xa),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=EI(this,e,"readableHighWaterMark",r),this.buffer=new oT,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=e.emitClose!==!1,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(Ba||(Ba=ff.StringDecoder),this.decoder=new Ba(e.encoding),this.encoding=e.encoding)}function Me(e){if(xa=xa||Kn,!(this instanceof Me))return new Me(e);var t=this instanceof xa;this._readableState=new bf(e,this,t),this.readable=!0,e&&(typeof e.read=="function"&&(this._read=e.read),typeof e.destroy=="function"&&(this._destroy=e.destroy)),Ki.call(this)}Object.defineProperty(Me.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(t){if(!this._readableState)return;this._readableState.destroyed=t}}),Me.prototype.destroy=Na.destroy,Me.prototype._undestroy=Na.undestroy,Me.prototype._destroy=function(e,t){t(e)},Me.prototype.push=function(e,t){var r=this._readableState,n;return r.objectMode?n=!0:typeof e=="string"&&(t=t||r.defaultEncoding,t!==r.encoding&&(e=ec.from(e,t),t=""),n=!0),vf(this,e,t,!1,n)},Me.prototype.unshift=function(e){return vf(this,e,null,!0,!1)};function vf(e,t,r,n,i){ke("readableAddChunk",t);var a=e._readableState;if(t===null)a.reading=!1,PI(e,a);else{var s;if(i||(s=kI(a,t)),s)Rs(e,s);else if(a.objectMode||t&&t.length>0)if(typeof t!="string"&&!a.objectMode&&Object.getPrototypeOf(t)!==ec.prototype&&(t=wI(t)),n)a.endEmitted?Rs(e,new II):sl(e,a,t,!0);else if(a.ended)Rs(e,new AI);else{if(a.destroyed)return!1;a.reading=!1,a.decoder&&!r?(t=a.decoder.write(t),a.objectMode||t.length!==0?sl(e,a,t,!1):ol(e,a)):sl(e,a,t,!1)}else n||(a.reading=!1,ol(e,a))}return!a.ended&&(a.length<a.highWaterMark||a.length===0)}function sl(e,t,r,n){t.flowing&&t.length===0&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&rc(e)),ol(e,t)}function kI(e,t){var r;return!_I(t)&&typeof t!="string"&&t!==void 0&&!e.objectMode&&(r=new SI("chunk",["string","Buffer","Uint8Array"],t)),r}Me.prototype.isPaused=function(){return this._readableState.flowing===!1},Me.prototype.setEncoding=function(e){Ba||(Ba=ff.StringDecoder);var t=new Ba(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";r!==null;)n+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),n!==""&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var wf=1073741824;function RI(e){return e>=wf?e=wf:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function _f(e,t){return e<=0||t.length===0&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=RI(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}Me.prototype.read=function(e){ke("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(e!==0&&(t.emittedReadable=!1),e===0&&t.needReadable&&((t.highWaterMark!==0?t.length>=t.highWaterMark:t.length>0)||t.ended))return ke("read: emitReadable",t.length,t.ended),t.length===0&&t.ended?ul(this):rc(this),null;if(e=_f(e,t),e===0&&t.ended)return t.length===0&&ul(this),null;var n=t.needReadable;ke("need readable",n),(t.length===0||t.length-e<t.highWaterMark)&&(n=!0,ke("length less than watermark",n)),t.ended||t.reading?(n=!1,ke("reading or ended",n)):n&&(ke("do read"),t.reading=!0,t.sync=!0,t.length===0&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=_f(r,t)));var i;return e>0?i=Af(e,t):i=null,i===null?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),t.length===0&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&ul(this)),i!==null&&this.emit("data",i),i};function PI(e,t){if(ke("onEofChunk"),t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?rc(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,Ef(e)))}function rc(e){var t=e._readableState;ke("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(ke("emitReadable",t.flowing),t.emittedReadable=!0,_e.nextTick(Ef,e))}function Ef(e){var t=e._readableState;ke("emitReadable_",t.destroyed,t.length,t.ended),!t.destroyed&&(t.length||t.ended)&&(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,cl(e)}function ol(e,t){t.readingMore||(t.readingMore=!0,_e.nextTick(NI,e,t))}function NI(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&t.length===0);){var r=t.length;if(ke("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}Me.prototype._read=function(e){Rs(this,new TI("_read()"))},Me.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e);break}n.pipesCount+=1,ke("pipe count=%d opts=%j",n.pipesCount,t);var i=(!t||t.end!==!1)&&e!==_e.stdout&&e!==_e.stderr,a=i?c:p;n.endEmitted?_e.nextTick(a):r.once("end",a),e.on("unpipe",s);function s(y,v){ke("onunpipe"),y===r&&(v&&v.hasUnpiped===!1&&(v.hasUnpiped=!0,l()))}function c(){ke("onend"),e.end()}var o=OI(r);e.on("drain",o);var u=!1;function l(){ke("cleanup"),e.removeListener("close",f),e.removeListener("finish",A),e.removeListener("drain",o),e.removeListener("error",w),e.removeListener("unpipe",s),r.removeListener("end",c),r.removeListener("end",p),r.removeListener("data",h),u=!0,n.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&o()}r.on("data",h);function h(y){ke("ondata");var v=e.write(y);ke("dest.write",v),v===!1&&((n.pipesCount===1&&n.pipes===e||n.pipesCount>1&&Tf(n.pipes,e)!==-1)&&!u&&(ke("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function w(y){ke("onerror",y),p(),e.removeListener("error",w),yf(e,"error")===0&&Rs(e,y)}CI(e,"error",w);function f(){e.removeListener("finish",A),p()}e.once("close",f);function A(){ke("onfinish"),e.removeListener("close",f),p()}e.once("finish",A);function p(){ke("unpipe"),r.unpipe(e)}return e.emit("pipe",r),n.flowing||(ke("pipe resume"),r.resume()),e};function OI(e){return function(){var r=e._readableState;ke("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&yf(e,"data")&&(r.flowing=!0,cl(e))}}Me.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(t.pipesCount===0)return this;if(t.pipesCount===1)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)n[a].emit("unpipe",this,{hasUnpiped:!1});return this}var s=Tf(t.pipes,e);return s===-1?this:(t.pipes.splice(s,1),t.pipesCount-=1,t.pipesCount===1&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)},Me.prototype.on=function(e,t){var r=Ki.prototype.on.call(this,e,t),n=this._readableState;return e==="data"?(n.readableListening=this.listenerCount("readable")>0,n.flowing!==!1&&this.resume()):e==="readable"&&(!n.endEmitted&&!n.readableListening&&(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,ke("on readable",n.length,n.reading),n.length?rc(this):n.reading||_e.nextTick(DI,this))),r},Me.prototype.addListener=Me.prototype.on,Me.prototype.removeListener=function(e,t){var r=Ki.prototype.removeListener.call(this,e,t);return e==="readable"&&_e.nextTick(Sf,this),r},Me.prototype.removeAllListeners=function(e){var t=Ki.prototype.removeAllListeners.apply(this,arguments);return(e==="readable"||e===void 0)&&_e.nextTick(Sf,this),t};function Sf(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function DI(e){ke("readable nexttick read 0"),e.read(0)}Me.prototype.resume=function(){var e=this._readableState;return e.flowing||(ke("resume"),e.flowing=!e.readableListening,MI(this,e)),e.paused=!1,this};function MI(e,t){t.resumeScheduled||(t.resumeScheduled=!0,_e.nextTick(xI,e,t))}function xI(e,t){ke("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),cl(e),t.flowing&&!t.reading&&e.read(0)}Me.prototype.pause=function(){return ke("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(ke("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function cl(e){var t=e._readableState;for(ke("flow",t.flowing);t.flowing&&e.read()!==null;);}Me.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;e.on("end",function(){if(ke("wrapped end"),r.decoder&&!r.ended){var s=r.decoder.end();s&&s.length&&t.push(s)}t.push(null)}),e.on("data",function(s){if(ke("wrapped data"),r.decoder&&(s=r.decoder.write(s)),r.objectMode&&s==null)return;if(!r.objectMode&&(!s||!s.length))return;var c=t.push(s);c||(n=!0,e.pause())});for(var i in e)this[i]===void 0&&typeof e[i]=="function"&&(this[i]=function(c){return function(){return e[c].apply(e,arguments)}}(i));for(var a=0;a<al.length;a++)e.on(al[a],this.emit.bind(this,al[a]));return this._read=function(s){ke("wrapped _read",s),n&&(n=!1,e.resume())},this},typeof Symbol=="function"&&(Me.prototype[Symbol.asyncIterator]=function(){return nl===void 0&&(nl=yI),nl(this)}),Object.defineProperty(Me.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(Me.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(Me.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(t){this._readableState&&(this._readableState.flowing=t)}}),Me._fromList=Af,Object.defineProperty(Me.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function Af(e,t){if(t.length===0)return null;var r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(t.decoder?r=t.buffer.join(""):t.buffer.length===1?r=t.buffer.first():r=t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r}function ul(e){var t=e._readableState;ke("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,_e.nextTick(BI,t,e))}function BI(e,t){if(ke("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&e.length===0&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}typeof Symbol=="function"&&(Me.from=function(e,t){return il===void 0&&(il=bI),il(Me,e,t)});function Tf(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}var ll=Wn,nc=Oa.codes,LI=nc.ERR_METHOD_NOT_IMPLEMENTED,jI=nc.ERR_MULTIPLE_CALLBACK,UI=nc.ERR_TRANSFORM_ALREADY_TRANSFORMING,FI=nc.ERR_TRANSFORM_WITH_LENGTH_0;ss(Wn,Kn);function qI(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(n===null)return this.emit("error",new jI);r.writechunk=null,r.writecb=null,t!=null&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function Wn(e){if(!(this instanceof Wn))return new Wn(e);Kn.call(this,e),this._transformState={afterTransform:qI.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&(typeof e.transform=="function"&&(this._transform=e.transform),typeof e.flush=="function"&&(this._flush=e.flush)),this.on("prefinish",GI)}function GI(){var e=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(t,r){If(e,t,r)}):If(this,null,null)}Wn.prototype.push=function(e,t){return this._transformState.needTransform=!1,Kn.prototype.push.call(this,e,t)},Wn.prototype._transform=function(e,t,r){r(new LI("_transform()"))},Wn.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},Wn.prototype._read=function(e){var t=this._transformState;t.writechunk!==null&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},Wn.prototype._destroy=function(e,t){Kn.prototype._destroy.call(this,e,function(r){t(r)})};function If(e,t,r){if(t)return e.emit("error",t);if(r!=null&&e.push(r),e._writableState.length)throw new FI;if(e._transformState.transforming)throw new UI;return e.push(null)}var $I=Ps;ss(Ps,ll);function Ps(e){if(!(this instanceof Ps))return new Ps(e);ll.call(this,e)}Ps.prototype._transform=function(e,t,r){r(null,e)};var dl;function VI(e){var t=!1;return function(){if(t)return;t=!0,e.apply(void 0,arguments)}}var Cf=Oa.codes,HI=Cf.ERR_MISSING_ARGS,zI=Cf.ERR_STREAM_DESTROYED;function kf(e){if(e)throw e}function KI(e){return e.setHeader&&typeof e.abort=="function"}function WI(e,t,r,n){n=VI(n);var i=!1;e.on("close",function(){i=!0}),dl===void 0&&(dl=el),dl(e,{readable:t,writable:r},function(s){if(s)return n(s);i=!0,n()});var a=!1;return function(s){if(i)return;if(a)return;if(a=!0,KI(e))return e.abort();if(typeof e.destroy=="function")return e.destroy();n(s||new zI("pipe"))}}function Rf(e){e()}function XI(e,t){return e.pipe(t)}function QI(e){return e.length?typeof e[e.length-1]!="function"?kf:e.pop():kf}function YI(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=QI(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new HI("streams");var i,a=t.map(function(s,c){var o=c<t.length-1,u=c>0;return WI(s,o,u,function(l){if(i||(i=l),l&&a.forEach(Rf),o)return;a.forEach(Rf),n(i)})});return t.reduce(XI)}var JI=YI,ZI=re(function(e,t){t=e.exports=rl,t.Stream=t,t.Readable=t,t.Writable=Xo,t.Duplex=Kn,t.Transform=ll,t.PassThrough=$I,t.finished=el,t.pipeline=JI});/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let Pf;var hl=typeof queueMicrotask=="function"?queueMicrotask:e=>(Pf||(Pf=Promise.resolve())).then(e).catch(t=>setTimeout(()=>{throw t},0));/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var e1=te("simple-peer"),pl=64*1024,t1=5*1e3,r1=5*1e3;function Nf(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}function n1(e){console.warn(e)}class La extends ZI.Duplex{constructor(e){if(e=Object.assign({allowHalfOpen:!1},e),super(e),this._id=Mc(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||Mc(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||La.channelConfig,this.negotiated=this.channelConfig.negotiated,this.config=Object.assign({},La.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(t=>t),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||t1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:nd(),!this._wrtc)throw typeof window=="undefined"?U(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):U(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=this.negotiated?!1:!this.initiator,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._firstStable=!0,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(t){hl(()=>this.destroy(U(t,"ERR_PC_CONSTRUCTOR")));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=t=>{this._onIceCandidate(t)},this.initiator||this.negotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=t=>{this._setupData(t)},this.streams&&this.streams.forEach(t=>{this.addStream(t)}),this._pc.ontrack=t=>{this._onTrack(t)},this.initiator&&this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(this.destroyed)throw U(new Error("cannot signal after peer is destroyed"),"ERR_SIGNALING");if(typeof e=="string")try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{if(this.destroyed)return;this._pendingCandidates.forEach(t=>{this._addIceCandidate(t)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer()}).catch(t=>{this.destroy(U(t,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(U(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}_addIceCandidate(e){var t=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(t).catch(r=>{!t.address||t.address.endsWith(".local")?n1("Ignoring unsupported ICE candidate."):this.destroy(U(r,"ERR_ADD_ICE_CANDIDATE"))})}send(e){this._channel.send(e)}addTransceiver(e,t){if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(r){this.destroy(U(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{transceiverRequest:{kind:e,init:t}})}addStream(e){this._debug("addStream()"),e.getTracks().forEach(t=>{this.addTrack(t,e)})}addTrack(e,t){this._debug("addTrack()");var r=this._senderMap.get(e)||new Map,n=r.get(t);if(!n)n=this._pc.addTrack(e,t),r.set(t,n),this._senderMap.set(e,r),this._needsNegotiation();else throw n.removed?U(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):U(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,t,r){this._debug("replaceTrack()");var n=this._senderMap.get(e),i=n?n.get(r):null;if(!i)throw U(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,n),i.replaceTrack!=null?i.replaceTrack(t):this.destroy(U(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,t){this._debug("removeSender()");var r=this._senderMap.get(e),n=r?r.get(t):null;if(!n)throw U(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{n.removed=!0,this._pc.removeTrack(n)}catch(i){i.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(n):this.destroy(U(i,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){this._debug("removeSenders()"),e.getTracks().forEach(t=>{this.removeTrack(t,e)})}_needsNegotiation(){if(this._debug("_needsNegotiation"),this._batchedNegotiation)return;this._batchedNegotiation=!0,hl(()=>{this._batchedNegotiation=!1,this._debug("starting batched negotiation"),this.negotiate()})}negotiate(){this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{renegotiate:!0})),this._isNegotiating=!0}_destroy(e,t){if(this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(r){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(r){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,t(e)}_setupData(e){if(!e.channel)return this.destroy(U(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=pl),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{this.destroy(U(r,"ERR_DATA_CHANNEL"))};var t=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(t&&this._onChannelClose(),t=!0):t=!1},r1)}_read(){}_write(e,t,r){if(this.destroyed)return r(U(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(n){return this.destroy(U(n,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>pl?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){if(this.destroyed)return;if(this._iceCompleteTimer)return;this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout)}_createOffer(){if(this.destroyed)return;this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Nf(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;var i=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:i.type,sdp:i.sdp})},r=()=>{if(this._debug("createOffer success"),this.destroyed)return;this.trickle||this._iceComplete?t():this.once("_iceComplete",t)},n=i=>{this.destroy(U(i,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(n)}).catch(e=>{this.destroy(U(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){if(this.destroyed)return;this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Nf(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;var i=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:i.type,sdp:i.sdp}),this.initiator||this._requestMissingTransceivers()},r=()=>{if(this.destroyed)return;this.trickle||this._iceComplete?t():this.once("_iceComplete",t)},n=i=>{this.destroy(U(i,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(n)}).catch(e=>{this.destroy(U(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){if(this.destroyed)return;this._pc.connectionState==="failed"&&this.destroy(U(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(U(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(U(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const t=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(n=>{Object.assign(r,n)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{var n=[];r.forEach(i=>{n.push(t(i))}),e(null,n)},r=>e(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;var n=[];r.result().forEach(i=>{var a={};i.names().forEach(s=>{a[s]=i.stat(s)}),a.id=i.id,a.type=i.type,a.timestamp=i.timestamp,n.push(t(a))}),e(null,n)},r=>e(r)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{if(this.destroyed)return;this.getStats((t,r)=>{if(this.destroyed)return;t&&(r=[]);var n={},i={},a={},s=!1;r.forEach(u=>{(u.type==="remotecandidate"||u.type==="remote-candidate")&&(n[u.id]=u),(u.type==="localcandidate"||u.type==="local-candidate")&&(i[u.id]=u),(u.type==="candidatepair"||u.type==="candidate-pair")&&(a[u.id]=u)});const c=u=>{s=!0;var l=i[u.localCandidateId];l&&(l.ip||l.address)?(this.localAddress=l.ip||l.address,this.localPort=Number(l.port)):l&&l.ipAddress?(this.localAddress=l.ipAddress,this.localPort=Number(l.portNumber)):typeof u.googLocalAddress=="string"&&(l=u.googLocalAddress.split(":"),this.localAddress=l[0],this.localPort=Number(l[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");var h=n[u.remoteCandidateId];h&&(h.ip||h.address)?(this.remoteAddress=h.ip||h.address,this.remotePort=Number(h.port)):h&&h.ipAddress?(this.remoteAddress=h.ipAddress,this.remotePort=Number(h.portNumber)):typeof u.googRemoteAddress=="string"&&(h=u.googRemoteAddress.split(":"),this.remoteAddress=h[0],this.remotePort=Number(h[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(u=>{u.type==="transport"&&u.selectedCandidatePairId&&c(a[u.selectedCandidatePairId]),(u.type==="googCandidatePair"&&u.googActiveConnection==="true"||(u.type==="candidatepair"||u.type==="candidate-pair")&&u.selected)&&c(u)}),!s&&(!Object.keys(a).length||Object.keys(i).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(u){return this.destroy(U(u,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');var o=this._cb;this._cb=null,o(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){if(!this._cb||!this._channel||this._channel.bufferedAmount>pl)return;this._onChannelBufferedAmountLow()}_onSignalingStateChange(){if(this.destroyed)return;this._pc.signalingState==="stable"&&!this._firstStable&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation&&(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()),this._debug("negotiate"),this.emit("negotiate")),this._firstStable=!1,this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState)}_onIceCandidate(e){if(this.destroyed)return;e.candidate&&this.trickle?this.emit("signal",{candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout()}_onChannelMessage(e){if(this.destroyed)return;var t=e.data;t instanceof ArrayBuffer&&(t=new Uint8Array(t)),this.push(t)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var e=this._cb;this._cb=null,e(null)}_onChannelOpen(){if(this._connected||this.destroyed)return;this._debug("on channel open"),this._channelReady=!0,this._maybeReady()}_onChannelClose(){if(this.destroyed)return;this._debug("on channel close"),this.destroy()}_onTrack(e){if(this.destroyed)return;e.streams.forEach(t=>{if(this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),this._remoteStreams.some(r=>r.id===t.id))return;this._remoteStreams.push(t),hl(()=>{this.emit("stream",t)})})}_debug(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],e1.apply(null,e)}}La.WEBRTC_SUPPORT=!!nd(),La.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},La.channelConfig={};var Of=La;(function(){if(typeof globalThis=="object")return;Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__})();var Df=globalThis,i1={supportsFileReader:typeof self!="undefined"&&"FileReader"in self,supportsWebRTC:"RTCPeerConnection"in Df&&(typeof navigator!="undefined"&&typeof navigator.mediaDevices!="undefined")&&"getUserMedia"in navigator.mediaDevices,supportsWebRTCDataChannels:"RTCPeerConnection"in Df},a1=421,s1=290,o1=2e3,fl={CODE_P2P:a1,CODE_CIRCUIT:s1,CLOSE_TIMEOUT:o1},c1=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,u1=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],ml=function(t){var r=t,n=t.indexOf("["),i=t.indexOf("]");n!=-1&&i!=-1&&(t=t.substring(0,n)+t.substring(n,i).replace(/:/g,";")+t.substring(i,t.length));for(var a=c1.exec(t||""),s={},c=14;c--;)s[u1[c]]=a[c]||"";return n!=-1&&i!=-1&&(s.source=r,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=l1(s,s.path),s.queryKey=d1(s,s.query),s};function l1(e,t){var r=/\/{2,9}/g,n=t.replace(r,"/").split("/");return(t.substr(0,1)=="/"||t.length===0)&&n.splice(0,1),t.substr(t.length-1,1)=="/"&&n.splice(n.length-1,1),n}function d1(e,t){var r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,a){i&&(r[i]=a)}),r}var Ns=1e3,Os=Ns*60,Ds=Os*60,Ms=Ds*24,h1=Ms*365.25,p1=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return f1(e);if(r==="number"&&isNaN(e)===!1)return t.long?g1(e):m1(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function f1(e){if(e=String(e),e.length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*h1;case"days":case"day":case"d":return r*Ms;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Ds;case"minutes":case"minute":case"mins":case"min":case"m":return r*Os;case"seconds":case"second":case"secs":case"sec":case"s":return r*Ns;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}function m1(e){return e>=Ms?Math.round(e/Ms)+"d":e>=Ds?Math.round(e/Ds)+"h":e>=Os?Math.round(e/Os)+"m":e>=Ns?Math.round(e/Ns)+"s":e+"ms"}function g1(e){return ic(e,Ms,"day")||ic(e,Ds,"hour")||ic(e,Os,"minute")||ic(e,Ns,"second")||e+" ms"}function ic(e,t,r){return e<t?void 0:e<t*1.5?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var y1=re(function(e,t){t=e.exports=n.debug=n.default=n,t.coerce=o,t.disable=s,t.enable=a,t.enabled=c,t.humanize=p1,t.instances=[],t.names=[],t.skips=[],t.formatters={};function r(u){var l=0,h;for(h in u)l=(l<<5)-l+u.charCodeAt(h),l|=0;return t.colors[Math.abs(l)%t.colors.length]}function n(u){var l;function h(){if(!h.enabled)return;var w=h,f=+new Date,A=f-(l||f);w.diff=A,w.prev=l,w.curr=f,l=f;for(var p=new Array(arguments.length),y=0;y<p.length;y++)p[y]=arguments[y];p[0]=t.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");var v=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,function(R,m){if(R==="%%")return R;v++;var g=t.formatters[m];if(typeof g=="function"){var S=p[v];R=g.call(w,S),p.splice(v,1),v--}return R}),t.formatArgs.call(w,p);var O=h.log||t.log||console.log.bind(console);O.apply(w,p)}return h.namespace=u,h.enabled=t.enabled(u),h.useColors=t.useColors(),h.color=r(u),h.destroy=i,typeof t.init=="function"&&t.init(h),t.instances.push(h),h}function i(){var u=t.instances.indexOf(this);return u!==-1?(t.instances.splice(u,1),!0):!1}function a(u){t.save(u),t.names=[],t.skips=[];var l,h=(typeof u=="string"?u:"").split(/[\s,]+/),w=h.length;for(l=0;l<w;l++){if(!h[l])continue;u=h[l].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$"))}for(l=0;l<t.instances.length;l++){var f=t.instances[l];f.enabled=t.enabled(f.namespace)}}function s(){t.enable("")}function c(u){if(u[u.length-1]==="*")return!0;var l,h;for(l=0,h=t.skips.length;l<h;l++)if(t.skips[l].test(u))return!1;for(l=0,h=t.names.length;l<h;l++)if(t.names[l].test(u))return!0;return!1}function o(u){return u instanceof Error?u.stack||u.message:u}}),ac=re(function(e,t){t=e.exports=y1,t.log=i,t.formatArgs=n,t.save=a,t.load=s,t.useColors=r,t.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:c(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&window.process.type==="renderer"?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}t.formatters.j=function(o){try{return JSON.stringify(o)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}};function n(o){var u=this.useColors;if(o[0]=(u?"%c":"")+this.namespace+(u?" %c":" ")+o[0]+(u?"%c ":" ")+"+"+t.humanize(this.diff),!u)return;var l="color: "+this.color;o.splice(1,0,l,"color: inherit");var h=0,w=0;o[0].replace(/%[a-zA-Z%]/g,function(f){if(f==="%%")return;h++,f==="%c"&&(w=h)}),o.splice(w,0,l)}function i(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(o){try{o==null?t.storage.removeItem("debug"):t.storage.debug=o}catch(u){}}function s(){var o;try{o=t.storage.debug}catch(u){}return!o&&typeof _e!="undefined"&&"env"in _e&&(o=_e.env.DEBUG),o}t.enable(s());function c(){try{return window.localStorage}catch(o){}}}),Mf=ac("socket.io-client:url"),b1=v1;function v1(e,t){var r=e;t=t||typeof location!="undefined"&&location,e==null&&(e=t.protocol+"//"+t.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=t.protocol+e:e=t.host+e),/^(https?|wss?):\/\//.test(e)||(Mf("protocol-less url %s",e),typeof t!="undefined"?e=t.protocol+"//"+e:e="https://"+e),Mf("parse %s",e),r=ml(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var n=r.host.indexOf(":")!==-1,i=n?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}var xs=1e3,Bs=xs*60,Ls=Bs*60,js=Ls*24,w1=js*365.25,_1=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return E1(e);if(r==="number"&&isNaN(e)===!1)return t.long?A1(e):S1(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function E1(e){if(e=String(e),e.length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*w1;case"days":case"day":case"d":return r*js;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Ls;case"minutes":case"minute":case"mins":case"min":case"m":return r*Bs;case"seconds":case"second":case"secs":case"sec":case"s":return r*xs;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}function S1(e){return e>=js?Math.round(e/js)+"d":e>=Ls?Math.round(e/Ls)+"h":e>=Bs?Math.round(e/Bs)+"m":e>=xs?Math.round(e/xs)+"s":e+"ms"}function A1(e){return sc(e,js,"day")||sc(e,Ls,"hour")||sc(e,Bs,"minute")||sc(e,xs,"second")||e+" ms"}function sc(e,t,r){return e<t?void 0:e<t*1.5?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var T1=re(function(e,t){t=e.exports=n.debug=n.default=n,t.coerce=o,t.disable=s,t.enable=a,t.enabled=c,t.humanize=_1,t.instances=[],t.names=[],t.skips=[],t.formatters={};function r(u){var l=0,h;for(h in u)l=(l<<5)-l+u.charCodeAt(h),l|=0;return t.colors[Math.abs(l)%t.colors.length]}function n(u){var l;function h(){if(!h.enabled)return;var w=h,f=+new Date,A=f-(l||f);w.diff=A,w.prev=l,w.curr=f,l=f;for(var p=new Array(arguments.length),y=0;y<p.length;y++)p[y]=arguments[y];p[0]=t.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");var v=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,function(R,m){if(R==="%%")return R;v++;var g=t.formatters[m];if(typeof g=="function"){var S=p[v];R=g.call(w,S),p.splice(v,1),v--}return R}),t.formatArgs.call(w,p);var O=h.log||t.log||console.log.bind(console);O.apply(w,p)}return h.namespace=u,h.enabled=t.enabled(u),h.useColors=t.useColors(),h.color=r(u),h.destroy=i,typeof t.init=="function"&&t.init(h),t.instances.push(h),h}function i(){var u=t.instances.indexOf(this);return u!==-1?(t.instances.splice(u,1),!0):!1}function a(u){t.save(u),t.names=[],t.skips=[];var l,h=(typeof u=="string"?u:"").split(/[\s,]+/),w=h.length;for(l=0;l<w;l++){if(!h[l])continue;u=h[l].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$"))}for(l=0;l<t.instances.length;l++){var f=t.instances[l];f.enabled=t.enabled(f.namespace)}}function s(){t.enable("")}function c(u){if(u[u.length-1]==="*")return!0;var l,h;for(l=0,h=t.skips.length;l<h;l++)if(t.skips[l].test(u))return!1;for(l=0,h=t.names.length;l<h;l++)if(t.names[l].test(u))return!0;return!1}function o(u){return u instanceof Error?u.stack||u.message:u}}),I1=re(function(e,t){t=e.exports=T1,t.log=i,t.formatArgs=n,t.save=a,t.load=s,t.useColors=r,t.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:c(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&window.process.type==="renderer"?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}t.formatters.j=function(o){try{return JSON.stringify(o)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}};function n(o){var u=this.useColors;if(o[0]=(u?"%c":"")+this.namespace+(u?" %c":" ")+o[0]+(u?"%c ":" ")+"+"+t.humanize(this.diff),!u)return;var l="color: "+this.color;o.splice(1,0,l,"color: inherit");var h=0,w=0;o[0].replace(/%[a-zA-Z%]/g,function(f){if(f==="%%")return;h++,f==="%c"&&(w=h)}),o.splice(w,0,l)}function i(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(o){try{o==null?t.storage.removeItem("debug"):t.storage.debug=o}catch(u){}}function s(){var o;try{o=t.storage.debug}catch(u){}return!o&&typeof _e!="undefined"&&"env"in _e&&(o=_e.env.DEBUG),o}t.enable(s());function c(){try{return window.localStorage}catch(o){}}}),Yi=re(function(e){e.exports=t;function t(n){if(n)return r(n)}function r(n){for(var i in t.prototype)n[i]=t.prototype[i];return n}t.prototype.on=t.prototype.addEventListener=function(n,i){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(i),this},t.prototype.once=function(n,i){function a(){this.off(n,a),i.apply(this,arguments)}return a.fn=i,this.on(n,a),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(n,i){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var a=this._callbacks["$"+n];if(!a)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var s,c=0;c<a.length;c++)if(s=a[c],s===i||s.fn===i){a.splice(c,1);break}return a.length===0&&delete this._callbacks["$"+n],this},t.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var i=new Array(arguments.length-1),a=this._callbacks["$"+n],s=1;s<arguments.length;s++)i[s-1]=arguments[s];if(a){a=a.slice(0);for(var s=0,c=a.length;s<c;++s)a[s].apply(this,i)}return this},t.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]},t.prototype.hasListeners=function(n){return!!this.listeners(n).length}}),C1={}.toString,Us=Array.isArray||function(e){return C1.call(e)=="[object Array]"},gl=N1,k1=typeof Buffer=="function"&&typeof Buffer.isBuffer=="function",R1=typeof ArrayBuffer=="function",P1=function(e){return typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer};function N1(e){return k1&&Buffer.isBuffer(e)||R1&&(e instanceof ArrayBuffer||P1(e))}var xf=Object.prototype.toString,O1=typeof Blob=="function"||typeof Blob!="undefined"&&xf.call(Blob)==="[object BlobConstructor]",D1=typeof File=="function"||typeof File!="undefined"&&xf.call(File)==="[object FileConstructor]",M1=function(e){var t=[],r=e.data,n=e;return n.data=yl(r,t),n.attachments=t.length,{packet:n,buffers:t}};function yl(e,t){if(!e)return e;if(gl(e)){var r={_placeholder:!0,num:t.length};return t.push(e),r}else if(Us(e)){for(var n=new Array(e.length),i=0;i<e.length;i++)n[i]=yl(e[i],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){var n={};for(var a in e)n[a]=yl(e[a],t);return n}return e}var x1=function(e,t){return e.data=bl(e.data,t),e.attachments=void 0,e};function bl(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(Us(e))for(var r=0;r<e.length;r++)e[r]=bl(e[r],t);else if(typeof e=="object")for(var n in e)e[n]=bl(e[n],t);return e}var B1=function(e,t){function r(a,s,c){if(!a)return a;if(O1&&a instanceof Blob||D1&&a instanceof File){n++;var o=new FileReader;o.onload=function(){c?c[s]=this.result:i=this.result,--n||t(i)},o.readAsArrayBuffer(a)}else if(Us(a))for(var u=0;u<a.length;u++)r(a[u],u,a);else if(typeof a=="object"&&!gl(a))for(var l in a)r(a[l],l,a)}var n=0,i=e;r(i),n||t(i)},vl={deconstructPacket:M1,reconstructPacket:x1,removeBlobs:B1},Mt=re(function(e,t){var r=I1("socket.io-parser");t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=n,t.Decoder=o;function n(){}var i=t.ERROR+'"encode error"';n.prototype.encode=function(f,A){if(r("encoding packet %j",f),t.BINARY_EVENT===f.type||t.BINARY_ACK===f.type)c(f,A);else{var p=a(f);A([p])}};function a(f){var A=""+f.type;if((t.BINARY_EVENT===f.type||t.BINARY_ACK===f.type)&&(A+=f.attachments+"-"),f.nsp&&f.nsp!=="/"&&(A+=f.nsp+","),f.id!=null&&(A+=f.id),f.data!=null){var p=s(f.data);if(p!==!1)A+=p;else return i}return r("encoded %j as %s",f,A),A}function s(f){try{return JSON.stringify(f)}catch(A){return!1}}function c(f,A){function p(y){var v=vl.deconstructPacket(y),O=a(v.packet),R=v.buffers;R.unshift(O),A(R)}vl.removeBlobs(f,p)}function o(){this.reconstructor=null}Yi(o.prototype),o.prototype.add=function(f){var A;if(typeof f=="string")A=u(f),t.BINARY_EVENT===A.type||t.BINARY_ACK===A.type?(this.reconstructor=new h(A),this.reconstructor.reconPack.attachments===0&&this.emit("decoded",A)):this.emit("decoded",A);else if(gl(f)||f.base64)if(this.reconstructor)A=this.reconstructor.takeBinaryData(f),A&&(this.reconstructor=null,this.emit("decoded",A));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+f)};function u(f){var A=0,p={type:Number(f.charAt(0))};if(t.types[p.type]==null)return w("unknown packet type "+p.type);if(t.BINARY_EVENT===p.type||t.BINARY_ACK===p.type){for(var y="";f.charAt(++A)!=="-"&&!(y+=f.charAt(A),A==f.length););if(y!=Number(y)||f.charAt(A)!=="-")throw new Error("Illegal attachments");p.attachments=Number(y)}if(f.charAt(A+1)==="/")for(p.nsp="";++A;){var v=f.charAt(A);if(v===",")break;if(p.nsp+=v,A===f.length)break}else p.nsp="/";var O=f.charAt(A+1);if(O!==""&&Number(O)==O){for(p.id="";++A;){var v=f.charAt(A);if(v==null||Number(v)!=v){--A;break}if(p.id+=f.charAt(A),A===f.length)break}p.id=Number(p.id)}if(f.charAt(++A)){var R=l(f.substr(A)),m=R!==!1&&(p.type===t.ERROR||Us(R));if(m)p.data=R;else return w("invalid payload")}return r("decoded %s as %j",f,p),p}function l(f){try{return JSON.parse(f)}catch(A){return!1}}o.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};function h(f){this.reconPack=f,this.buffers=[]}h.prototype.takeBinaryData=function(f){if(this.buffers.push(f),this.buffers.length===this.reconPack.attachments){var A=vl.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),A}return null},h.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]};function w(f){return{type:t.ERROR,data:"parser error: "+f}}}),L1=re(function(e){try{e.exports=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}}),oc=function(){return typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")()}(),wl=function(e){var t=e.xdomain,r=e.xscheme,n=e.enablesXDR;try{if(typeof XMLHttpRequest!="undefined"&&(!t||L1))return new XMLHttpRequest}catch(i){}try{if(typeof XDomainRequest!="undefined"&&!r&&n)return new XDomainRequest}catch(i){}if(!t)try{return new oc[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(i){}},j1=Object.keys||function(t){var r=[],n=Object.prototype.hasOwnProperty;for(var i in t)n.call(t,i)&&r.push(i);return r},Bf=Object.prototype.toString,U1=typeof Blob=="function"||typeof Blob!="undefined"&&Bf.call(Blob)==="[object BlobConstructor]",F1=typeof File=="function"||typeof File!="undefined"&&Bf.call(File)==="[object FileConstructor]",_l=cc;function cc(e){if(!e||typeof e!="object")return!1;if(Us(e)){for(var t=0,r=e.length;t<r;t++)if(cc(e[t]))return!0;return!1}if(typeof Buffer=="function"&&Buffer.isBuffer&&Buffer.isBuffer(e)||typeof ArrayBuffer=="function"&&e instanceof ArrayBuffer||U1&&e instanceof Blob||F1&&e instanceof File)return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return cc(e.toJSON(),!0);for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&cc(e[n]))return!0;return!1}var uc=function(e,t,r){var n=e.byteLength;if(t=t||0,r=r||n,e.slice)return e.slice(t,r);if(t<0&&(t+=n),r<0&&(r+=n),r>n&&(r=n),t>=n||t>=r||n===0)return new ArrayBuffer(0);for(var i=new Uint8Array(e),a=new Uint8Array(r-t),s=t,c=0;s<r;s++,c++)a[c]=i[s];return a.buffer},q1=G1;function G1(e,t,r){var n=!1;return r=r||$1,i.count=e,e===0?t():i;function i(a,s){if(i.count<=0)throw new Error("after called too many times");--i.count,a?(n=!0,t(a),t=r):i.count===0&&!n&&t(null,s)}}function $1(){}/*! https://mths.be/utf8js v2.1.2 by @mathias */var wi=String.fromCharCode;function Lf(e){for(var t=[],r=0,n=e.length,i,a;r<n;)i=e.charCodeAt(r++),i>=55296&&i<=56319&&r<n?(a=e.charCodeAt(r++),(a&64512)==56320?t.push(((i&1023)<<10)+(a&1023)+65536):(t.push(i),r--)):t.push(i);return t}function V1(e){for(var t=e.length,r=-1,n,i="";++r<t;)n=e[r],n>65535&&(n-=65536,i+=wi(n>>>10&1023|55296),n=56320|n&1023),i+=wi(n);return i}function jf(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function El(e,t){return wi(e>>t&63|128)}function H1(e,t){if((e&4294967168)==0)return wi(e);var r="";return(e&4294965248)==0?r=wi(e>>6&31|192):(e&4294901760)==0?(jf(e,t)||(e=65533),r=wi(e>>12&15|224),r+=El(e,6)):(e&4292870144)==0&&(r=wi(e>>18&7|240),r+=El(e,12),r+=El(e,6)),r+=wi(e&63|128),r}function z1(e,t){t=t||{};for(var r=t.strict!==!1,n=Lf(e),i=n.length,a=-1,s,c="";++a<i;)s=n[a],c+=H1(s,r);return c}function ja(){if(_i>=dc)throw Error("Invalid byte index");var e=lc[_i]&255;if(_i++,(e&192)==128)return e&63;throw Error("Invalid continuation byte")}function K1(e){var t,r,n,i,a;if(_i>dc)throw Error("Invalid byte index");if(_i==dc)return!1;if(t=lc[_i]&255,_i++,(t&128)==0)return t;if((t&224)==192){if(r=ja(),a=(t&31)<<6|r,a>=128)return a;throw Error("Invalid continuation byte")}if((t&240)==224){if(r=ja(),n=ja(),a=(t&15)<<12|r<<6|n,a>=2048)return jf(a,e)?a:65533;throw Error("Invalid continuation byte")}if((t&248)==240&&(r=ja(),n=ja(),i=ja(),a=(t&7)<<18|r<<12|n<<6|i,a>=65536&&a<=1114111))return a;throw Error("Invalid UTF-8 detected")}var lc,dc,_i;function W1(e,t){t=t||{};var r=t.strict!==!1;lc=Lf(e),dc=lc.length,_i=0;for(var n=[],i;(i=K1(r))!==!1;)n.push(i);return V1(n)}var Uf={version:"2.1.2",encode:z1,decode:W1},X1=re(function(e,t){(function(r){t.encode=function(n){var i=new Uint8Array(n),a,s=i.length,c="";for(a=0;a<s;a+=3)c+=r[i[a]>>2],c+=r[(i[a]&3)<<4|i[a+1]>>4],c+=r[(i[a+1]&15)<<2|i[a+2]>>6],c+=r[i[a+2]&63];return s%3===2?c=c.substring(0,c.length-1)+"=":s%3===1&&(c=c.substring(0,c.length-2)+"=="),c},t.decode=function(n){var i=n.length*.75,a=n.length,s,c=0,o,u,l,h;n[n.length-1]==="="&&(i--,n[n.length-2]==="="&&i--);var w=new ArrayBuffer(i),f=new Uint8Array(w);for(s=0;s<a;s+=4)o=r.indexOf(n[s]),u=r.indexOf(n[s+1]),l=r.indexOf(n[s+2]),h=r.indexOf(n[s+3]),f[c++]=o<<2|u>>4,f[c++]=(u&15)<<4|l>>2,f[c++]=(l&3)<<6|h&63;return w}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")}),Ua=typeof Ua!="undefined"?Ua:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:!1,Ff=function(){try{var e=new Blob(["hi"]);return e.size===2}catch(t){return!1}}(),Q1=Ff&&function(){try{var e=new Blob([new Uint8Array([1,2])]);return e.size===2}catch(t){return!1}}(),Y1=Ua&&Ua.prototype.append&&Ua.prototype.getBlob;function qf(e){return e.map(function(t){if(t.buffer instanceof ArrayBuffer){var r=t.buffer;if(t.byteLength!==r.byteLength){var n=new Uint8Array(t.byteLength);n.set(new Uint8Array(r,t.byteOffset,t.byteLength)),r=n.buffer}return r}return t})}function Gf(e,t){t=t||{};var r=new Ua;return qf(e).forEach(function(n){r.append(n)}),t.type?r.getBlob(t.type):r.getBlob()}function $f(e,t){return new Blob(qf(e),t||{})}typeof Blob!="undefined"&&(Gf.prototype=Blob.prototype,$f.prototype=Blob.prototype);var br=function(){return Ff?Q1?Blob:$f:Y1?Gf:void 0}(),Ei=re(function(e,t){var r;typeof ArrayBuffer!="undefined"&&(r=X1);var n=typeof navigator!="undefined"&&/Android/i.test(navigator.userAgent),i=typeof navigator!="undefined"&&/PhantomJS/i.test(navigator.userAgent),a=n||i;t.protocol=3;var s=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},c=j1(s),o={type:"error",data:"parser error"};t.encodePacket=function(p,y,v,O){typeof y=="function"&&(O=y,y=!1),typeof v=="function"&&(O=v,v=null);var R=p.data===void 0?void 0:p.data.buffer||p.data;if(typeof ArrayBuffer!="undefined"&&R instanceof ArrayBuffer)return l(p,y,O);if(typeof br!="undefined"&&R instanceof br)return w(p,y,O);if(R&&R.base64)return u(p,O);var m=s[p.type];return p.data!==void 0&&(m+=v?Uf.encode(String(p.data),{strict:!1}):String(p.data)),O(""+m)};function u(p,y){var v="b"+t.packets[p.type]+p.data.data;return y(v)}function l(p,y,v){if(!y)return t.encodeBase64Packet(p,v);var O=p.data,R=new Uint8Array(O),m=new Uint8Array(1+O.byteLength);m[0]=s[p.type];for(var g=0;g<R.length;g++)m[g+1]=R[g];return v(m.buffer)}function h(p,y,v){if(!y)return t.encodeBase64Packet(p,v);var O=new FileReader;return O.onload=function(){t.encodePacket({type:p.type,data:O.result},y,!0,v)},O.readAsArrayBuffer(p.data)}function w(p,y,v){if(!y)return t.encodeBase64Packet(p,v);if(a)return h(p,y,v);var O=new Uint8Array(1);O[0]=s[p.type];var R=new br([O.buffer,p.data]);return v(R)}t.encodeBase64Packet=function(p,y){var v="b"+t.packets[p.type];if(typeof br!="undefined"&&p.data instanceof br){var O=new FileReader;return O.onload=function(){var d=O.result.split(",")[1];y(v+d)},O.readAsDataURL(p.data)}var R;try{R=String.fromCharCode.apply(null,new Uint8Array(p.data))}catch(d){for(var m=new Uint8Array(p.data),g=new Array(m.length),S=0;S<m.length;S++)g[S]=m[S];R=String.fromCharCode.apply(null,g)}return v+=btoa(R),y(v)},t.decodePacket=function(p,y,v){if(p===void 0)return o;if(typeof p=="string"){if(p.charAt(0)==="b")return t.decodeBase64Packet(p.substr(1),y);if(v&&(p=f(p),p===!1))return o;var R=p.charAt(0);return Number(R)!=R||!c[R]?o:p.length>1?{type:c[R],data:p.substring(1)}:{type:c[R]}}var O=new Uint8Array(p),R=O[0],m=uc(p,1);return br&&y==="blob"&&(m=new br([m])),{type:c[R],data:m}};function f(p){try{p=Uf.decode(p,{strict:!1})}catch(y){return!1}return p}t.decodeBase64Packet=function(p,y){var v=c[p.charAt(0)];if(!r)return{type:v,data:{base64:!0,data:p.substr(1)}};var O=r.decode(p.substr(1));return y==="blob"&&br&&(O=new br([O])),{type:v,data:O}},t.encodePayload=function(p,y,v){typeof y=="function"&&(v=y,y=null);var O=_l(p);if(y&&O)return br&&!a?t.encodePayloadAsBlob(p,v):t.encodePayloadAsArrayBuffer(p,v);if(!p.length)return v("0:");function R(g){return g.length+":"+g}function m(g,S){t.encodePacket(g,O?y:!1,!1,function(d){S(null,R(d))})}A(p,m,function(g,S){return v(S.join(""))})};function A(p,y,v){for(var O=new Array(p.length),R=q1(p.length,v),m=function(S,d,b){y(d,function(E,_){O[S]=_,b(E,O)})},g=0;g<p.length;g++)m(g,p[g],R)}t.decodePayload=function(p,y,v){if(typeof p!="string")return t.decodePayloadAsBinary(p,y,v);typeof y=="function"&&(v=y,y=null);var O;if(p==="")return v(o,0,1);for(var R="",m,g,S=0,d=p.length;S<d;S++){var b=p.charAt(S);if(b!==":"){R+=b;continue}if(R===""||R!=(m=Number(R)))return v(o,0,1);if(g=p.substr(S+1,m),R!=g.length)return v(o,0,1);if(g.length){if(O=t.decodePacket(g,y,!1),o.type===O.type&&o.data===O.data)return v(o,0,1);var E=v(O,S+m,d);if(E===!1)return}S+=m,R=""}if(R!=="")return v(o,0,1)},t.encodePayloadAsArrayBuffer=function(p,y){if(!p.length)return y(new ArrayBuffer(0));function v(O,R){t.encodePacket(O,!0,!0,function(m){return R(null,m)})}A(p,v,function(O,R){var m=R.reduce(function(d,b){var E;return typeof b=="string"?E=b.length:E=b.byteLength,d+E.toString().length+E+2},0),g=new Uint8Array(m),S=0;return R.forEach(function(d){var b=typeof d=="string",E=d;if(b){for(var M=new Uint8Array(d.length),_=0;_<d.length;_++)M[_]=d.charCodeAt(_);E=M.buffer}b?g[S++]=0:g[S++]=1;for(var P=E.byteLength.toString(),_=0;_<P.length;_++)g[S++]=parseInt(P[_]);g[S++]=255;for(var M=new Uint8Array(E),_=0;_<M.length;_++)g[S++]=M[_]}),y(g.buffer)})},t.encodePayloadAsBlob=function(p,y){function v(O,R){t.encodePacket(O,!0,!0,function(m){var g=new Uint8Array(1);if(g[0]=1,typeof m=="string"){for(var S=new Uint8Array(m.length),d=0;d<m.length;d++)S[d]=m.charCodeAt(d);m=S.buffer,g[0]=0}for(var b=m instanceof ArrayBuffer?m.byteLength:m.size,E=b.toString(),_=new Uint8Array(E.length+1),d=0;d<E.length;d++)_[d]=parseInt(E[d]);if(_[E.length]=255,br){var P=new br([g.buffer,_.buffer,m]);R(null,P)}})}A(p,v,function(O,R){return y(new br(R))})},t.decodePayloadAsBinary=function(p,y,v){typeof y=="function"&&(v=y,y=null);for(var O=p,R=[];O.byteLength>0;){for(var m=new Uint8Array(O),g=m[0]===0,S="",d=1;!(m[d]===255);d++){if(S.length>310)return v(o,0,1);S+=m[d]}O=uc(O,2+S.length),S=parseInt(S);var b=uc(O,0,S);if(g)try{b=String.fromCharCode.apply(null,new Uint8Array(b))}catch(P){var E=new Uint8Array(b);b="";for(var d=0;d<E.length;d++)b+=String.fromCharCode(E[d])}R.push(b),O=uc(O,S)}var _=R.length;R.forEach(function(P,M){v(t.decodePacket(P,y,!0),M,_)})}}),Fa=Pn;function Pn(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}Yi(Pn.prototype),Pn.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},Pn.prototype.open=function(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this},Pn.prototype.close=function(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this},Pn.prototype.send=function(e){if(this.readyState==="open")this.write(e);else throw new Error("Transport not open")},Pn.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},Pn.prototype.onData=function(e){var t=Ei.decodePacket(e,this.socket.binaryType);this.onPacket(t)},Pn.prototype.onPacket=function(e){this.emit("packet",e)},Pn.prototype.onClose=function(){this.readyState="closed",this.emit("close")};var J1=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},Z1=function(e){for(var t={},r=e.split("&"),n=0,i=r.length;n<i;n++){var a=r[n].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t},hc={encode:J1,decode:Z1},pc=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e},Vf="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),fc=64,Hf={},zf=0,Si=0,Kf;function Sl(e){var t="";do t=Vf[e%fc]+t,e=Math.floor(e/fc);while(e>0);return t}function eC(e){var t=0;for(Si=0;Si<e.length;Si++)t=t*fc+Hf[e.charAt(Si)];return t}function Al(){var e=Sl(+new Date);return e!==Kf?(zf=0,Kf=e):e+"."+Sl(zf++)}for(;Si<fc;Si++)Hf[Vf[Si]]=Si;Al.encode=Sl,Al.decode=eC;var Wf=Al,Fs=1e3,qs=Fs*60,Gs=qs*60,$s=Gs*24,tC=$s*365.25,rC=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return nC(e);if(r==="number"&&isNaN(e)===!1)return t.long?aC(e):iC(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function nC(e){if(e=String(e),e.length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*tC;case"days":case"day":case"d":return r*$s;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Gs;case"minutes":case"minute":case"mins":case"min":case"m":return r*qs;case"seconds":case"second":case"secs":case"sec":case"s":return r*Fs;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}function iC(e){return e>=$s?Math.round(e/$s)+"d":e>=Gs?Math.round(e/Gs)+"h":e>=qs?Math.round(e/qs)+"m":e>=Fs?Math.round(e/Fs)+"s":e+"ms"}function aC(e){return mc(e,$s,"day")||mc(e,Gs,"hour")||mc(e,qs,"minute")||mc(e,Fs,"second")||e+" ms"}function mc(e,t,r){return e<t?void 0:e<t*1.5?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var sC=re(function(e,t){t=e.exports=n.debug=n.default=n,t.coerce=o,t.disable=s,t.enable=a,t.enabled=c,t.humanize=rC,t.instances=[],t.names=[],t.skips=[],t.formatters={};function r(u){var l=0,h;for(h in u)l=(l<<5)-l+u.charCodeAt(h),l|=0;return t.colors[Math.abs(l)%t.colors.length]}function n(u){var l;function h(){if(!h.enabled)return;var w=h,f=+new Date,A=f-(l||f);w.diff=A,w.prev=l,w.curr=f,l=f;for(var p=new Array(arguments.length),y=0;y<p.length;y++)p[y]=arguments[y];p[0]=t.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");var v=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,function(R,m){if(R==="%%")return R;v++;var g=t.formatters[m];if(typeof g=="function"){var S=p[v];R=g.call(w,S),p.splice(v,1),v--}return R}),t.formatArgs.call(w,p);var O=h.log||t.log||console.log.bind(console);O.apply(w,p)}return h.namespace=u,h.enabled=t.enabled(u),h.useColors=t.useColors(),h.color=r(u),h.destroy=i,typeof t.init=="function"&&t.init(h),t.instances.push(h),h}function i(){var u=t.instances.indexOf(this);return u!==-1?(t.instances.splice(u,1),!0):!1}function a(u){t.save(u),t.names=[],t.skips=[];var l,h=(typeof u=="string"?u:"").split(/[\s,]+/),w=h.length;for(l=0;l<w;l++){if(!h[l])continue;u=h[l].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$"))}for(l=0;l<t.instances.length;l++){var f=t.instances[l];f.enabled=t.enabled(f.namespace)}}function s(){t.enable("")}function c(u){if(u[u.length-1]==="*")return!0;var l,h;for(l=0,h=t.skips.length;l<h;l++)if(t.skips[l].test(u))return!1;for(l=0,h=t.names.length;l<h;l++)if(t.names[l].test(u))return!0;return!1}function o(u){return u instanceof Error?u.stack||u.message:u}}),gc=re(function(e,t){t=e.exports=sC,t.log=i,t.formatArgs=n,t.save=a,t.load=s,t.useColors=r,t.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:c(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&window.process.type==="renderer"?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}t.formatters.j=function(o){try{return JSON.stringify(o)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}};function n(o){var u=this.useColors;if(o[0]=(u?"%c":"")+this.namespace+(u?" %c":" ")+o[0]+(u?"%c ":" ")+"+"+t.humanize(this.diff),!u)return;var l="color: "+this.color;o.splice(1,0,l,"color: inherit");var h=0,w=0;o[0].replace(/%[a-zA-Z%]/g,function(f){if(f==="%%")return;h++,f==="%c"&&(w=h)}),o.splice(w,0,l)}function i(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(o){try{o==null?t.storage.removeItem("debug"):t.storage.debug=o}catch(u){}}function s(){var o;try{o=t.storage.debug}catch(u){}return!o&&typeof _e!="undefined"&&"env"in _e&&(o=_e.env.DEBUG),o}t.enable(s());function c(){try{return window.localStorage}catch(o){}}}),an=gc("engine.io-client:polling"),Vs=Nn,oC=function(){var e=wl,t=new e({xdomain:!1});return t.responseType!=null}();function Nn(e){var t=e&&e.forceBase64;(!oC||t)&&(this.supportsBinary=!1),Fa.call(this,e)}pc(Nn,Fa),Nn.prototype.name="polling",Nn.prototype.doOpen=function(){this.poll()},Nn.prototype.pause=function(e){var t=this;this.readyState="pausing";function r(){an("paused"),t.readyState="paused",e()}if(this.polling||!this.writable){var n=0;this.polling&&(an("we are currently polling - waiting to pause"),n++,this.once("pollComplete",function(){an("pre-pause polling complete"),--n||r()})),this.writable||(an("we are currently writing - waiting to pause"),n++,this.once("drain",function(){an("pre-pause writing complete"),--n||r()}))}else r()},Nn.prototype.poll=function(){an("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},Nn.prototype.onData=function(e){var t=this;an("polling got data %s",e);var r=function(n,i,a){if(t.readyState==="opening"&&t.onOpen(),n.type==="close")return t.onClose(),!1;t.onPacket(n)};Ei.decodePayload(e,this.socket.binaryType,r),this.readyState!=="closed"&&(this.polling=!1,this.emit("pollComplete"),this.readyState==="open"?this.poll():an('ignoring poll - transport state "%s"',this.readyState))},Nn.prototype.doClose=function(){var e=this;function t(){an("writing close packet"),e.write([{type:"close"}])}this.readyState==="open"?(an("transport open - closing"),t()):(an("transport not open - deferring close"),this.once("open",t))},Nn.prototype.write=function(e){var t=this;this.writable=!1;var r=function(){t.writable=!0,t.emit("drain")};Ei.encodePayload(e,this.supportsBinary,function(n){t.doWrite(n,r)})},Nn.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";this.timestampRequests!==!1&&(e[this.timestampParam]=Wf()),!this.supportsBinary&&!e.sid&&(e.b64=1),e=hc.encode(e),this.port&&(t==="https"&&Number(this.port)!==443||t==="http"&&Number(this.port)!==80)&&(r=":"+this.port),e.length&&(e="?"+e);var n=this.hostname.indexOf(":")!==-1;return t+"://"+(n?"["+this.hostname+"]":this.hostname)+r+this.path+e};var Tl=gc("engine.io-client:polling-xhr"),Xf=qa,cC=wt;function Qf(){}function qa(e){if(Vs.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,typeof location!="undefined"){var t=location.protocol==="https:",r=location.port;r||(r=t?443:80),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}}pc(qa,Vs),qa.prototype.supportsBinary=!0,qa.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.withCredentials=this.withCredentials,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new wt(e)},qa.prototype.doWrite=function(e,t){var r=typeof e!="string"&&e!==void 0,n=this.request({method:"POST",data:e,isBinary:r}),i=this;n.on("success",t),n.on("error",function(a){i.onError("xhr post error",a)}),this.sendXhr=n},qa.prototype.doPoll=function(){Tl("xhr poll");var e=this.request(),t=this;e.on("data",function(r){t.onData(r)}),e.on("error",function(r){t.onError("xhr poll error",r)}),this.pollXhr=e};function wt(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=e.async!==!1,this.data=e.data!==void 0?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}if(Yi(wt.prototype),wt.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new wl(e),r=this;try{Tl("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(var n in this.extraHeaders)this.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.extraHeaders[n])}}catch(i){}if(this.method==="POST")try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(i){}try{t.setRequestHeader("Accept","*/*")}catch(i){}"withCredentials"in t&&(t.withCredentials=this.withCredentials),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){r.onLoad()},t.onerror=function(){r.onError(t.responseText)}):t.onreadystatechange=function(){if(t.readyState===2)try{var i=t.getResponseHeader("Content-Type");(r.supportsBinary&&i==="application/octet-stream"||i==="application/octet-stream; charset=UTF-8")&&(t.responseType="arraybuffer")}catch(a){}if(t.readyState!==4)return;t.status===200||t.status===1223?r.onLoad():setTimeout(function(){r.onError(typeof t.status=="number"?t.status:0)},0)},Tl("xhr data %s",this.data),t.send(this.data)}catch(i){setTimeout(function(){r.onError(i)},0);return}typeof document!="undefined"&&(this.index=wt.requestsCount++,wt.requests[this.index]=this)},wt.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},wt.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},wt.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},wt.prototype.cleanup=function(e){if(typeof this.xhr=="undefined"||this.xhr===null)return;if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=Qf:this.xhr.onreadystatechange=Qf,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete wt.requests[this.index],this.xhr=null},wt.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(r){}t==="application/octet-stream"||t==="application/octet-stream; charset=UTF-8"?e=this.xhr.response||this.xhr.responseText:e=this.xhr.responseText}catch(r){this.onError(r)}e!=null&&this.onData(e)},wt.prototype.hasXDR=function(){return typeof XDomainRequest!="undefined"&&!this.xs&&this.enablesXDR},wt.prototype.abort=function(){this.cleanup()},wt.requestsCount=0,wt.requests={},typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",Yf);else if(typeof addEventListener=="function"){var uC="onpagehide"in oc?"pagehide":"unload";addEventListener(uC,Yf,!1)}}function Yf(){for(var e in wt.requests)wt.requests.hasOwnProperty(e)&&wt.requests[e].abort()}Xf.Request=cC;var lC=Ga,dC=/\n/g,hC=/\\n/g,yc;function pC(){}function Ga(e){Vs.call(this,e),this.query=this.query||{},yc||(yc=oc.___eio=oc.___eio||[]),this.index=yc.length;var t=this;yc.push(function(r){t.onData(r)}),this.query.j=this.index,typeof addEventListener=="function"&&addEventListener("beforeunload",function(){t.script&&(t.script.onerror=pC)},!1)}pc(Ga,Vs),Ga.prototype.supportsBinary=!1,Ga.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),Vs.prototype.doClose.call(this)},Ga.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(i){e.onError("jsonp poll error",i)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t;var n=typeof navigator!="undefined"&&/gecko/i.test(navigator.userAgent);n&&setTimeout(function(){var i=document.createElement("iframe");document.body.appendChild(i),document.body.removeChild(i)},100)},Ga.prototype.doWrite=function(e,t){var r=this;if(!this.form){var n=document.createElement("form"),i=document.createElement("textarea"),a=this.iframeId="eio_iframe_"+this.index,s;n.className="socketio",n.style.position="absolute",n.style.top="-1000px",n.style.left="-1000px",n.target=a,n.method="POST",n.setAttribute("accept-charset","utf-8"),i.name="d",n.appendChild(i),document.body.appendChild(n),this.form=n,this.area=i}this.form.action=this.uri();function c(){o(),t()}function o(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(l){r.onError("jsonp polling iframe removal error",l)}try{var u='<iframe src="javascript:0" name="'+r.iframeId+'">';s=document.createElement(u)}catch(l){s=document.createElement("iframe"),s.name=r.iframeId,s.src="javascript:0"}s.id=r.iframeId,r.form.appendChild(s),r.iframe=s}o(),e=e.replace(hC,`\\
`),this.area.value=e.replace(dC,"\\n");try{this.form.submit()}catch(u){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){r.iframe.readyState==="complete"&&c()}:this.iframe.onload=c};var fC=gc("engine.io-client:websocket"),bc,Il;if(typeof WebSocket!="undefined"?bc=WebSocket:typeof self!="undefined"&&(bc=self.WebSocket||self.MozWebSocket),typeof window=="undefined")try{Il=Ln}catch(e){}var $a=bc||Il,mC=Ur;function Ur(e){var t=e&&e.forceBase64;t&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=bc&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||($a=Il),Fa.call(this,e)}pc(Ur,Fa),Ur.prototype.name="websocket",Ur.prototype.supportsBinary=!0,Ur.prototype.doOpen=function(){if(!this.check())return;var e=this.uri(),t=this.protocols,r={};this.isReactNative||(r.agent=this.agent,r.perMessageDeflate=this.perMessageDeflate,r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized),this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new $a(e,t):new $a(e):new $a(e,t,r)}catch(n){return this.emit("error",n)}this.ws.binaryType===void 0&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()},Ur.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},Ur.prototype.write=function(e){var t=this;this.writable=!1;for(var r=e.length,n=0,i=r;n<i;n++)(function(s){Ei.encodePacket(s,t.supportsBinary,function(c){if(!t.usingBrowserWebSocket){var o={};if(s.options&&(o.compress=s.options.compress),t.perMessageDeflate){var u=typeof c=="string"?Buffer.byteLength(c):c.length;u<t.perMessageDeflate.threshold&&(o.compress=!1)}}try{t.usingBrowserWebSocket?t.ws.send(c):t.ws.send(c,o)}catch(l){fC("websocket closed before onclose event")}--r||a()})})(e[n]);function a(){t.emit("flush"),setTimeout(function(){t.writable=!0,t.emit("drain")},0)}},Ur.prototype.onClose=function(){Fa.prototype.onClose.call(this)},Ur.prototype.doClose=function(){typeof this.ws!="undefined"&&this.ws.close()},Ur.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";this.port&&(t==="wss"&&Number(this.port)!==443||t==="ws"&&Number(this.port)!==80)&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=Wf()),this.supportsBinary||(e.b64=1),e=hc.encode(e),e.length&&(e="?"+e);var n=this.hostname.indexOf(":")!==-1;return t+"://"+(n?"["+this.hostname+"]":this.hostname)+r+this.path+e},Ur.prototype.check=function(){return!!$a&&!("__initialize"in $a&&this.name===Ur.prototype.name)};var gC=bC,yC=mC;function bC(e){var t,r=!1,n=!1,i=e.jsonp!==!1;if(typeof location!="undefined"){var a=location.protocol==="https:",s=location.port;s||(s=a?443:80),r=e.hostname!==location.hostname||s!==e.port,n=e.secure!==a}if(e.xdomain=r,e.xscheme=n,t=new wl(e),"open"in t&&!e.forceJSONP)return new Xf(e);if(!i)throw new Error("JSONP disabled");return new lC(e)}var Jf={polling:gC,websocket:yC},vC=[].indexOf,Cl=function(e,t){if(vC)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1},ht=gc("engine.io-client:socket"),wC=Oe;function Oe(e,t){if(!(this instanceof Oe))return new Oe(e,t);t=t||{},e&&typeof e=="object"&&(t=e,e=null),e?(e=ml(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=ml(t.host).host),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?443:80),this.query=t.query||{},typeof this.query=="string"&&(this.query=hc.decode(this.query)),this.upgrade=t.upgrade!==!1,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=t.jsonp!==!1,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.withCredentials=t.withCredentials!==!1,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=t.perMessageDeflate!==!1?t.perMessageDeflate||{}:!1,this.perMessageDeflate===!0&&(this.perMessageDeflate={}),this.perMessageDeflate&&this.perMessageDeflate.threshold==null&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=t.rejectUnauthorized===void 0?!0:t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",(typeof self=="undefined"||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}Oe.priorWebsocketSuccess=!1,Yi(Oe.prototype),Oe.protocol=Ei.protocol,Oe.Socket=Oe,Oe.Transport=Fa,Oe.transports=Jf,Oe.parser=Ei,Oe.prototype.createTransport=function(e){ht('creating transport "%s"',e);var t=_C(this.query);t.EIO=Ei.protocol,t.transport=e;var r=this.transportOptions[e]||{};this.id&&(t.sid=this.id);var n=new Jf[e]({query:t,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,withCredentials:r.withCredentials||this.withCredentials,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0,isReactNative:this.isReactNative});return n};function _C(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}Oe.prototype.open=function(){var e;if(this.rememberUpgrade&&Oe.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){var t=this;setTimeout(function(){t.emit("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(r){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)},Oe.prototype.setTransport=function(e){ht("setting transport %s",e.name);var t=this;this.transport&&(ht("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(r){t.onPacket(r)}).on("error",function(r){t.onError(r)}).on("close",function(){t.onClose("transport close")})},Oe.prototype.probe=function(e){ht('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),r=!1,n=this;Oe.priorWebsocketSuccess=!1;function i(){if(n.onlyBinaryUpgrades){var h=!this.supportsBinary&&n.transport.supportsBinary;r=r||h}if(r)return;ht('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(w){if(r)return;if(w.type==="pong"&&w.data==="probe"){if(ht('probe transport "%s" pong',e),n.upgrading=!0,n.emit("upgrading",t),!t)return;Oe.priorWebsocketSuccess=t.name==="websocket",ht('pausing current transport "%s"',n.transport.name),n.transport.pause(function(){if(r)return;if(n.readyState==="closed")return;ht("changing transport and sending upgrade packet"),l(),n.setTransport(t),t.send([{type:"upgrade"}]),n.emit("upgrade",t),t=null,n.upgrading=!1,n.flush()})}else{ht('probe transport "%s" failed',e);var f=new Error("probe error");f.transport=t.name,n.emit("upgradeError",f)}})}function a(){if(r)return;r=!0,l(),t.close(),t=null}function s(h){var w=new Error("probe error: "+h);w.transport=t.name,a(),ht('probe transport "%s" failed because of error: %s',e,h),n.emit("upgradeError",w)}function c(){s("transport closed")}function o(){s("socket closed")}function u(h){t&&h.name!==t.name&&(ht('"%s" works - aborting "%s"',h.name,t.name),a())}function l(){t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",c),n.removeListener("close",o),n.removeListener("upgrading",u)}t.once("open",i),t.once("error",s),t.once("close",c),this.once("close",o),this.once("upgrading",u),t.open()},Oe.prototype.onOpen=function(){if(ht("socket open"),this.readyState="open",Oe.priorWebsocketSuccess=this.transport.name==="websocket",this.emit("open"),this.flush(),this.readyState==="open"&&this.upgrade&&this.transport.pause){ht("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},Oe.prototype.onPacket=function(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){ht('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat");switch(e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data);break}}else ht('packet received with socket readyState "%s"',this.readyState)},Oe.prototype.onHandshake=function(e){if(this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),this.readyState==="closed")return;this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat)},Oe.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){if(t.readyState==="closed")return;t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},Oe.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){ht("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},Oe.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},Oe.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emit("drain"):this.flush()},Oe.prototype.flush=function(){this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(ht("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Oe.prototype.write=Oe.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},Oe.prototype.sendPacket=function(e,t,r,n){if(typeof t=="function"&&(n=t,t=void 0),typeof r=="function"&&(n=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;var i={type:e,data:t,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()},Oe.prototype.close=function(){if(this.readyState==="opening"||this.readyState==="open"){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():t()}):this.upgrading?n():t()}function t(){e.onClose("forced close"),ht("socket closing - telling transport to close"),e.transport.close()}function r(){e.removeListener("upgrade",r),e.removeListener("upgradeError",r),t()}function n(){e.once("upgrade",r),e.once("upgradeError",r)}return this},Oe.prototype.onError=function(e){ht("socket error %j",e),Oe.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},Oe.prototype.onClose=function(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){ht('socket close with reason: "%s"',e);var r=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),r.writeBuffer=[],r.prevBufferLen=0}},Oe.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;r<n;r++)~Cl(this.transports,e[r])&&t.push(e[r]);return t};var Zf=wC,EC=Ei;Zf.parser=EC;var kl=SC;function SC(e,t){var r=[];t=t||0;for(var n=t||0;n<e.length;n++)r[n-t]=e[n];return r}var sn=AC;function AC(e,t,r){return e.on(t,r),{destroy:function(){e.removeListener(t,r)}}}var em=[].slice,Xn=function(e,t){if(typeof t=="string"&&(t=e[t]),typeof t!="function")throw new Error("bind() requires a function");var r=em.call(arguments,2);return function(){return t.apply(e,r.concat(em.call(arguments)))}},tm=re(function(e,t){var r=ac("socket.io-client:socket");e.exports=t=a;var n={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},i=Yi.prototype.emit;function a(s,c,o){this.io=s,this.nsp=c,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},o&&o.query&&(this.query=o.query),this.io.autoConnect&&this.open()}Yi(a.prototype),a.prototype.subEvents=function(){if(this.subs)return;var s=this.io;this.subs=[sn(s,"open",Xn(this,"onopen")),sn(s,"packet",Xn(this,"onpacket")),sn(s,"close",Xn(this,"onclose"))]},a.prototype.open=a.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.reconnecting||this.io.open(),this.io.readyState==="open"&&this.onopen(),this.emit("connecting"),this)},a.prototype.send=function(){var s=kl(arguments);return s.unshift("message"),this.emit.apply(this,s),this},a.prototype.emit=function(s){if(n.hasOwnProperty(s))return i.apply(this,arguments),this;var c=kl(arguments),o={type:(this.flags.binary!==void 0?this.flags.binary:_l(c))?Mt.BINARY_EVENT:Mt.EVENT,data:c};return o.options={},o.options.compress=!this.flags||this.flags.compress!==!1,typeof c[c.length-1]=="function"&&(r("emitting packet with ack id %d",this.ids),this.acks[this.ids]=c.pop(),o.id=this.ids++),this.connected?this.packet(o):this.sendBuffer.push(o),this.flags={},this},a.prototype.packet=function(s){s.nsp=this.nsp,this.io.packet(s)},a.prototype.onopen=function(){if(r("transport is open - connecting"),this.nsp!=="/")if(this.query){var s=typeof this.query=="object"?hc.encode(this.query):this.query;r("sending connect packet with query %s",s),this.packet({type:Mt.CONNECT,query:s})}else this.packet({type:Mt.CONNECT})},a.prototype.onclose=function(s){r("close (%s)",s),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",s)},a.prototype.onpacket=function(s){var c=s.nsp===this.nsp,o=s.type===Mt.ERROR&&s.nsp==="/";if(!c&&!o)return;switch(s.type){case Mt.CONNECT:this.onconnect();break;case Mt.EVENT:this.onevent(s);break;case Mt.BINARY_EVENT:this.onevent(s);break;case Mt.ACK:this.onack(s);break;case Mt.BINARY_ACK:this.onack(s);break;case Mt.DISCONNECT:this.ondisconnect();break;case Mt.ERROR:this.emit("error",s.data);break}},a.prototype.onevent=function(s){var c=s.data||[];r("emitting event %j",c),s.id!=null&&(r("attaching ack callback to event"),c.push(this.ack(s.id))),this.connected?i.apply(this,c):this.receiveBuffer.push(c)},a.prototype.ack=function(s){var c=this,o=!1;return function(){if(o)return;o=!0;var u=kl(arguments);r("sending ack %j",u),c.packet({type:_l(u)?Mt.BINARY_ACK:Mt.ACK,id:s,data:u})}},a.prototype.onack=function(s){var c=this.acks[s.id];typeof c=="function"?(r("calling ack %s with %j",s.id,s.data),c.apply(this,s.data),delete this.acks[s.id]):r("bad ack %s",s.id)},a.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},a.prototype.emitBuffered=function(){var s;for(s=0;s<this.receiveBuffer.length;s++)i.apply(this,this.receiveBuffer[s]);for(this.receiveBuffer=[],s=0;s<this.sendBuffer.length;s++)this.packet(this.sendBuffer[s]);this.sendBuffer=[]},a.prototype.ondisconnect=function(){r("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},a.prototype.destroy=function(){if(this.subs){for(var s=0;s<this.subs.length;s++)this.subs[s].destroy();this.subs=null}this.io.destroy(this)},a.prototype.close=a.prototype.disconnect=function(){return this.connected&&(r("performing disconnect (%s)",this.nsp),this.packet({type:Mt.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},a.prototype.compress=function(s){return this.flags.compress=s,this},a.prototype.binary=function(s){return this.flags.binary=s,this}}),TC=Va;function Va(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Va.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=(Math.floor(t*10)&1)==0?e-r:e+r}return Math.min(e,this.max)|0},Va.prototype.reset=function(){this.attempts=0},Va.prototype.setMin=function(e){this.ms=e},Va.prototype.setMax=function(e){this.max=e},Va.prototype.setJitter=function(e){this.jitter=e};var Gt=ac("socket.io-client:manager"),rm=Object.prototype.hasOwnProperty,Rl=Le;function Le(e,t){if(!(this instanceof Le))return new Le(e,t);e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||Infinity),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new TC({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=t.parser||Mt;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=t.autoConnect!==!1,this.autoConnect&&this.open()}Le.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var e in this.nsps)rm.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},Le.prototype.updateSocketIds=function(){for(var e in this.nsps)rm.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},Le.prototype.generateId=function(e){return(e==="/"?"":e+"#")+this.engine.id},Yi(Le.prototype),Le.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},Le.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},Le.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},Le.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},Le.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},Le.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},Le.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()},Le.prototype.open=Le.prototype.connect=function(e,t){if(Gt("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;Gt("opening %s",this.uri),this.engine=Zf(this.uri,this.opts);var r=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var i=sn(r,"open",function(){n.onopen(),e&&e()}),a=sn(r,"error",function(o){if(Gt("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",o),e){var u=new Error("Connection error");u.data=o,e(u)}else n.maybeReconnectOnOpen()});if(this._timeout!==!1){var s=this._timeout;Gt("connect attempt will timeout after %d",s),s===0&&i.destroy();var c=setTimeout(function(){Gt("connect attempt timed out after %d",s),i.destroy(),r.close(),r.emit("error","timeout"),n.emitAll("connect_timeout",s)},s);this.subs.push({destroy:function(){clearTimeout(c)}})}return this.subs.push(i),this.subs.push(a),this},Le.prototype.onopen=function(){Gt("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(sn(e,"data",Xn(this,"ondata"))),this.subs.push(sn(e,"ping",Xn(this,"onping"))),this.subs.push(sn(e,"pong",Xn(this,"onpong"))),this.subs.push(sn(e,"error",Xn(this,"onerror"))),this.subs.push(sn(e,"close",Xn(this,"onclose"))),this.subs.push(sn(this.decoder,"decoded",Xn(this,"ondecoded")))},Le.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},Le.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},Le.prototype.ondata=function(e){this.decoder.add(e)},Le.prototype.ondecoded=function(e){this.emit("packet",e)},Le.prototype.onerror=function(e){Gt("error",e),this.emitAll("error",e)},Le.prototype.socket=function(e,t){var r=this.nsps[e];if(!r){r=new tm(this,e,t),this.nsps[e]=r;var n=this;r.on("connecting",i),r.on("connect",function(){r.id=n.generateId(e)}),this.autoConnect&&i()}function i(){~Cl(n.connecting,r)||n.connecting.push(r)}return r},Le.prototype.destroy=function(e){var t=Cl(this.connecting,e);if(~t&&this.connecting.splice(t,1),this.connecting.length)return;this.close()},Le.prototype.packet=function(e){Gt("writing packet %j",e);var t=this;e.query&&e.type===0&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(r){for(var n=0;n<r.length;n++)t.engine.write(r[n],e.options);t.encoding=!1,t.processPacketQueue()}))},Le.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},Le.prototype.cleanup=function(){Gt("cleanup");for(var e=this.subs.length,t=0;t<e;t++){var r=this.subs.shift();r.destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},Le.prototype.close=Le.prototype.disconnect=function(){Gt("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,this.readyState==="opening"&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},Le.prototype.onclose=function(e){Gt("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},Le.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)Gt("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();Gt("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var r=setTimeout(function(){if(e.skipReconnect)return;if(Gt("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect)return;e.open(function(n){n?(Gt("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",n.data)):(Gt("reconnect success"),e.onreconnect())})},t);this.subs.push({destroy:function(){clearTimeout(r)}})}},Le.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)};var IC=re(function(e,t){var r=ac("socket.io-client");e.exports=t=i;var n=t.managers={};function i(a,s){typeof a=="object"&&(s=a,a=void 0),s=s||{};var c=b1(a),o=c.source,u=c.id,l=c.path,h=n[u]&&l in n[u].nsps,w=s.forceNew||s["force new connection"]||s.multiplex===!1||h,f;return w?(r("ignoring socket cache for %s",o),f=Rl(o,s)):(n[u]||(r("new io instance for %s",o),n[u]=Rl(o,s)),f=n[u]),c.query&&!s.query&&(s.query=c.query),f.socket(c.path,s)}t.protocol=Mt.protocol,t.connect=i,t.Manager=Rl,t.Socket=tm}),Pl=e=>{if(e[Symbol.asyncIterator])return e;if(e.getReader)return async function*(){const t=e.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)return;yield n}}finally{t.releaseLock()}}();throw new Error("unknown stream")},nm=e=>async t=>{t=tu(t);const r=v=>{typeof v.return=="function"&&v.return()};let n=null,i=null;const a=v=>{n=v,i&&i(v),r(t)};let s=null,c=!1;const o=()=>{c=!0,s&&s()};let u=null,l=!1;const h=()=>{l=!0,u&&u()};let w=null;const f=()=>{w&&w()},A=()=>new Promise((v,O)=>{s=w=v,i=O,e.once("drain",f)}),p=()=>(r(t),new Promise((v,O)=>{if(c||l||n)return v();u=s=v,i=O})),y=()=>{e.removeListener("error",a),e.removeListener("close",o),e.removeListener("finish",h),e.removeListener("drain",f)};e.once("error",a),e.once("close",o),e.once("finish",h);try{for await(const v of t){if(!e.writable||e.destroyed||n)break;e.write(v)===!1&&await A()}}catch(v){n||e.destroy(),n=v}try{if(e.writable&&e.end(),await p(),n)throw n}finally{y()}},im=e=>({sink:nm(e),source:Pl(e)}),CC=e=>async function*(t){const r=im(e);r.sink(t).catch(n=>{}),yield*r.source},Ha=Pl,kC=Pl,RC=nm,PC=CC,NC=im;Ha.source=kC,Ha.sink=RC,Ha.transform=PC,Ha.duplex=NC;const{CLOSE_TIMEOUT:OC}=fl,vc=te("libp2p:webrtc-star:socket");vc.error=te("libp2p:webrtc-star:socket:error");const am=(e,t)=>{if(!e||!t)return;try{return zi(e,t)}catch(r){return vc.error(r),zi("0.0.0.0",t)}};var sm=(e,t={})=>{const{sink:r,source:n}=Ha.duplex(e),i=t.remoteAddr||am(e.remoteAddress,e.remotePort),a=am(e.localAddress,e.localPort),s={async sink(c){t.signal&&(c=vt(c,t.signal));try{await r(async function*(){for await(const o of c)yield o instanceof Uint8Array?o:o.slice()}())}catch(o){o.type!=="aborted"&&vc.error(o)}},source:t.signal?vt(n,t.signal):n,conn:e,localAddr:a,remoteAddr:i,timeline:{open:Date.now()},close(){return e.destroyed?void 0:new Promise((c,o)=>{const u=Date.now(),l=setTimeout(()=>{if(s.remoteAddr){const{host:h,port:w}=s.remoteAddr.toOptions();vc("timeout closing socket to %s:%s after %dms, destroying it manually",h,w,Date.now()-u)}e.destroyed||e.destroy()},OC);e.once("close",()=>{c()}),e.end(h=>{if(clearTimeout(l),s.timeline.close=Date.now(),h)return o(h)})})}};return e.once("close",()=>{s.timeline.close||(s.timeline.close=Date.now())}),s},om=re(function(e,t){function r(i){const a=i.toString().split("/"),s=i.protos()[1].name,c=i.protos()[2].name,o=i.stringTuples()[1][1];if(s!=="tcp"||c!=="ws"&&c!=="wss")throw new Error("invalid multiaddr: "+i.toString());if(!Ne.isName(i))return"http://"+a[2]+":"+a[4];if(c==="ws")return"http://"+a[2]+(o===80?"":":"+o);if(c==="wss")return"https://"+a[2]+(o===443?"":":"+o)}function n(i){const a="/libp2p-webrtc-star";if(i.indexOf(a)!==-1){i=i.substring(a.length,i.length);let s=Ne(i);const c=s.stringTuples().filter(o=>o[0]===421)[0];s=s.decapsulate("p2p"),s=s.encapsulate("/p2p-webrtc-star"),s=s.encapsulate(`/p2p/${c[1]}`),i=s.toString()}return i}t=e.exports,t.cleanUrlSIO=r,t.cleanMultiaddr=n});const Ji=te("libp2p:webrtc-star:listener");Ji.error=te("libp2p:webrtc-star:listener:error");const{cleanUrlSIO:DC}=om,{CODE_P2P:cm}=fl,MC={transports:["websocket"],"force new connection":!0};var xC=({handler:e,upgrader:t},r,n={})=>{const i=new At;let a;return i.__connections=[],i.listen=s=>{const c=vo();a=s,!s.protoCodes().includes(cm)&&t.localPeer?r._signallingAddr=s.encapsulate(`/p2p/${t.localPeer.toB58String()}`):r._signallingAddr=s;const o=DC(s);Ji("Dialing to Signalling Server on: "+o),i.io=IC.connect(o,MC);const u=l=>{if(l.answer||l.err)return;const h={trickle:!1,...n};r.wrtc&&(h.wrtc=r.wrtc);const w=new Of(h),f=A=>{Ji.error("incoming connectioned errored",A)};w.on("error",f),w.once("close",(...A)=>{w.removeListener("error",f)}),w.once("signal",A=>{l.signal=A,l.answer=!0,i.io.emit("ss-handshake",l)}),w.signal(l.signal),w.once("connect",async()=>{const A=sm(w);Ji("new inbound connection %s",A.remoteAddr);let p;try{p=await t.upgradeInbound(A)}catch(y){return Ji.error("inbound connection failed to upgrade",y),A.close()}if(!p.remoteAddr)try{p.remoteAddr=s.decapsulateCode(cm).encapsulate(`/p2p/${p.remotePeer.toB58String()}`)}catch(y){Ji.error("could not determine remote address",y)}Ji("inbound connection %s upgraded",A.remoteAddr),BC(i,A),i.emit("connection",p),e(p)})};return i.io.once("connect_error",l=>c.reject(l)),i.io.once("error",l=>{i.emit("error",l),i.emit("close")}),i.io.on("ws-handshake",u),i.io.on("ws-peer",r._peerDiscovered),i.io.on("connect",()=>{i.io.emit("ss-join",r._signallingAddr.toString())}),i.io.once("connect",()=>{i.emit("listening"),c.resolve()}),c.promise},i.close=async()=>{i.io&&i.io.emit("ss-leave"),await Promise.all(i.__connections.map(s=>s.close())),i.emit("close")},i.getAddrs=()=>[a],r.listenersRefs[Ne.toString()]=i,i};function BC(e,t){e.__connections.push(t);const r=()=>{e.__connections=e.__connections.filter(n=>n!==t)};t.conn.once("close",r)}const Qn=te("libp2p:webrtc-star");Qn.error=te("libp2p:webrtc-star:error");const{EventEmitter:LC}=At,{AbortError:um}=vt,{supportsWebRTCDataChannels:jC}=i1,{CODE_CIRCUIT:UC}=fl,{cleanMultiaddr:FC}=om;function qC(){}class GC{constructor(e={}){if(!e.upgrader)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=e.upgrader,this._signallingAddr=void 0,this.sioOptions={transports:["websocket"],"force new connection":!0},e.wrtc&&(this.wrtc=e.wrtc),this.listenersRefs={},this.discovery=new LC,this.discovery.tag="webRTCStar",this.discovery._isStarted=!1,this.discovery.start=()=>{this.discovery._isStarted=!0},this.discovery.stop=()=>{this.discovery._isStarted=!1},this._peerDiscovered=this._peerDiscovered.bind(this)}async dial(e,t={}){const r=await this._connect(e,t),n=sm(r,{remoteAddr:e,signal:t.signal});Qn("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return Qn("outbound connection %s upgraded",n.remoteAddr),i}_connect(e,t={}){if(t.signal&&t.signal.aborted)throw new um;const r={initiator:!0,trickle:!1};this.wrtc&&(r.wrtc=this.wrtc);const n=e.toOptions(),i=(~~(Math.random()*1e9)).toString(36)+Date.now(),a=this.listenersRefs[Object.keys(this.listenersRefs)[0]].io;return new Promise((s,c)=>{const o=Date.now();let u;Qn("dialing %s:%s",n.host,n.port);const l=new Of(r),h=y=>{if(!u){const v=`connection error ${n.host}:${n.port}: ${y.message}`;Qn.error(v),p(y)}},w=()=>{Qn("connnection timeout %s:%s",n.host,n.port);const y=U(new Error(`connection timeout after ${Date.now()-o}ms`),"ERR_CONNECT_TIMEOUT");l.emit("error",y)},f=()=>{u=!0,Qn("connection opened %s:%s",n.host,n.port),p(null)},A=()=>{Qn.error("connection aborted %s:%s",n.host,n.port),l.destroy(),p(new um)},p=y=>{l.removeListener("timeout",w),l.removeListener("connect",f),t.signal&&t.signal.removeEventListener("abort",A),y?c(y):s(l)};l.on("error",h),l.once("timeout",w),l.once("connect",f),l.on("close",()=>{l.removeListener("error",h)}),t.signal&&t.signal.addEventListener("abort",A),l.on("signal",y=>{a.emit("ss-handshake",{intentId:i,srcMultiaddr:this._signallingAddr.toString(),dstMultiaddr:e.toString(),signal:y})}),a.on("ws-handshake",y=>{if(y.intentId===i&&y.err&&c(U(y.err instanceof Error?y.err:new Error(y.err),"ERR_SIGNALLING_FAILED")),y.intentId!==i||!y.answer||l.destroyed)return;l.signal(y.signal)})})}createListener(e={},t){if(!jC&&!this.wrtc)throw U(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");return typeof e=="function"&&(t=e,e={}),t=t||qC,xC({handler:t,upgrader:this._upgrader},this,e)}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>t.protoCodes().includes(UC)?!1:hs.WebRTCStar.matches(t))}_peerDiscovered(e){if(!this.discovery._isStarted)return;Qn("Peer Discovered:",e),e=FC(e);const t=Ne(e),r=we.createFromB58String(t.getPeerId());this.discovery.emit("peer",{id:r,multiaddrs:[t]})}}var lm=Pr(GC,{className:"WebRTCStar",symbolName:"@libp2p/js-libp2p-webrtc-star/webrtcstar"}),$C=421,VC=290,HC=2e3,Nl={CODE_P2P:$C,CODE_CIRCUIT:VC,CLOSE_TIMEOUT:HC};const Ol=te("libp2p:tcp:socket"),{CLOSE_TIMEOUT:zC}=Nl;var dm=(e,t)=>{t=t||{},t.listeningAddr&&t.listeningAddr.getPath()&&(t.remoteAddr=t.listeningAddr),t.remoteAddr&&t.remoteAddr.getPath()&&(t.localAddr=t.remoteAddr);const{sink:r,source:n}=Ha.duplex(e),i={async sink(a){t.signal&&(a=vt(a,t.signal));try{await r(async function*(){for await(const s of a)yield Buffer.isBuffer(s)?s:s.slice()}())}catch(s){s.type!=="aborted"&&Ol(s)}},source:t.signal?vt(n,t.signal):n,conn:e,localAddr:t.localAddr||zi(e.localAddress,e.localPort),remoteAddr:t.remoteAddr||zi(e.remoteAddress,e.remotePort),timeline:{open:Date.now()},close(){return e.destroyed?void 0:new Promise((a,s)=>{const c=Date.now(),o=setTimeout(()=>{const{host:u,port:l}=i.remoteAddr.toOptions();Ol("timeout closing socket to %s:%s after %dms, destroying it manually",u,l,Date.now()-c),e.destroyed?Ol("%s:%s is already destroyed",u,l):e.destroy(),a()},zC);e.once("close",()=>clearTimeout(o)),e.end(u=>{if(i.timeline.close=Date.now(),u)return s(u);a()})})}};return e.once("close",()=>{i.timeline.close||(i.timeline.close=Date.now())}),i};const{resolve:KC}=Dg,WC={ip4:"IPv4",ip6:"IPv6"};function XC(e){const t=e.getPath();return t?KC(t):e.toOptions()}function QC(e,t,r){const n=i=>Ne(`/${e}/${i}/tcp/${r}`);return(hm(t)?YC(WC[e]):[t]).map(n)}function hm(e){return["0.0.0.0","::"].includes(e)}function YC(e){return Object.values(ed.networkInterfaces()).reduce((t,r)=>(r.forEach(n=>{n.family===e&&t.push(n.address)}),t),[])}var pm={multiaddrToNetConfig:XC,isAnyAddr:hm,getMultiaddrs:QC};const Zi=te("libp2p:tcp:listener");Zi.error=te("libp2p:tcp:listener:error");const{CODE_P2P:JC}=Nl,{getMultiaddrs:fm,multiaddrToNetConfig:ZC}=pm;async function mm(e){try{e&&await e.close()}catch(t){Zi.error("an error occurred closing the connection",t)}}var ek=({handler:e,upgrader:t},r)=>{const n=new At,i=td.createServer(async c=>{c.on("error",l=>Zi("socket error",l));let o,u;try{o=dm(c,{listeningAddr:s}),Zi("new inbound connection %s",o.remoteAddr),u=await t.upgradeInbound(o)}catch(l){return Zi.error("inbound connection failed",l),mm(o)}Zi("inbound connection %s upgraded",o.remoteAddr),tk(i,o),e&&e(u),n.emit("connection",u)});i.on("listening",()=>n.emit("listening")).on("error",c=>n.emit("error",c)).on("close",()=>n.emit("close")),i.__connections=[],n.close=()=>i.listening?new Promise((c,o)=>{i.__connections.forEach(u=>mm(u)),i.close(u=>u?o(u):c())}):void 0;let a,s;return n.listen=c=>(s=c,a=c.getPeerId(),a&&(s=c.decapsulateCode(JC)),new Promise((o,u)=>{const l=ZC(s);i.listen(l,h=>{if(h)return u(h);Zi("Listening on %s",i.address()),o()})})),n.getAddrs=()=>{let c=[];const o=i.address();if(!o)throw new Error("Listener is not ready yet");return s.toString().startsWith("/ip4")?c=c.concat(fm("ip4",o.address,o.port)):o.family==="IPv6"&&(c=c.concat(fm("ip6",o.address,o.port))),c.map(u=>a?u.encapsulate(`/p2p/${a}`):u)},n};function tk(e,t){e.__connections.push(t);const r=()=>{e.__connections=e.__connections.filter(n=>n!==t)};t.conn.once("close",r)}const za=te("libp2p:tcp"),{multiaddrToNetConfig:rk}=pm,{AbortError:gm}=vt,{CODE_CIRCUIT:nk,CODE_P2P:ik}=Nl;class ak{constructor({upgrader:e}){if(!e)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=e}async dial(e,t){t=t||{};const r=await this._connect(e,t),n=dm(r,{remoteAddr:e,signal:t.signal});za("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return za("outbound connection %s upgraded",n.remoteAddr),i}_connect(e,t={}){if(t.signal&&t.signal.aborted)throw new gm;return new Promise((r,n)=>{const i=Date.now(),a=rk(e);za("dialing %j",a);const s=td.connect(a),c=w=>{w.message=`connection error ${a.host}:${a.port}: ${w.message}`,h(w)},o=()=>{za("connnection timeout %s:%s",a.host,a.port);const w=U(new Error(`connection timeout after ${Date.now()-i}ms`),"ERR_CONNECT_TIMEOUT");s.emit("error",w)},u=()=>{za("connection opened %j",a),h()},l=()=>{za("connection aborted %j",a),s.destroy(),h(new gm)},h=w=>{if(s.removeListener("error",c),s.removeListener("timeout",o),s.removeListener("connect",u),t.signal&&t.signal.removeEventListener("abort",l),w)return n(w);r(s)};s.on("error",c),s.on("timeout",o),s.on("connect",u),t.signal&&t.signal.addEventListener("abort",l)})}createListener(e,t){return typeof e=="function"&&(t=e,e={}),e=e||{},ek({handler:t,upgrader:this._upgrader})}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>t.protoCodes().includes(nk)?!1:hs.TCP.matches(t.decapsulateCode(ik)))}}var sk=Pr(ak,{className:"TCP",symbolName:"@libp2p/js-libp2p-tcp/tcp"});const Dl=10*1024;class ok{constructor(){this._pool=new Uint8Array(Dl),this._poolOffset=0}write(e){const t=this._pool;let r=this._poolOffset;$e.encode(e.id<<3|e.type,t,r),r+=$e.encode.bytes,$e.encode(e.data?e.data.length:0,t,r),r+=$e.encode.bytes;const n=t.subarray(this._poolOffset,r);return Dl-r<100?(this._pool=new Uint8Array(Dl),this._poolOffset=0):this._poolOffset=r,e.data?[n,e.data]:n}}const ym=new ok;var ck=e=>async function*(){for await(const r of e)Array.isArray(r)?yield new tt(r.map(n=>ym.write(n))):yield new tt(ym.write(r))}(),uk=e=>async function*(){const r=new lk;for await(const n of e){const i=r.write(n);i.length&&(yield i)}}();class lk{constructor(){this._buffer=new tt,this._bufferProxy=new Proxy({},{get:(e,t)=>t[0]==="l"?this._buffer[t]:this._buffer.get(parseInt(t))}),this._headerInfo=null}write(e){if(!e||!e.length)return[];this._buffer.append(e);const t=[];for(;;){if(!this._headerInfo)try{this._headerInfo=this._decodeHeader(this._bufferProxy)}catch(c){break}const{id:r,type:n,length:i,offset:a}=this._headerInfo,s=this._buffer.length-a;if(s<i)break;t.push({id:r,type:n,data:this._buffer.shallowSlice(a,a+i)}),this._buffer.consume(a+i),this._headerInfo=null}return t}_decodeHeader(e){const t=$e.decode(e);let r=$e.decode.bytes;const n=$e.decode(e,r);return r+=$e.decode.bytes,{id:t>>3,type:t&7,offset:r,length:n}}}var dk=ck,hk=uk,bm={encode:dk,decode:hk};const vm=1<<20;var Ml=e=>{e=e||vm;const t=r=>{if(r.data&&r.data.length>e)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"})};return r=>async function*(){for await(const i of r)Array.isArray(i)?i.forEach(t):t(i),yield i}()},pk=vm;Ml.MAX_MSG_SIZE=pk;const Yn=Object.freeze({NEW_STREAM:0,MESSAGE_RECEIVER:1,MESSAGE_INITIATOR:2,CLOSE_RECEIVER:3,CLOSE_INITIATOR:4,RESET_RECEIVER:5,RESET_INITIATOR:6});var fk=Yn,mk=Object.freeze({NEW_STREAM:Yn.NEW_STREAM,MESSAGE:Yn.MESSAGE_INITIATOR,CLOSE:Yn.CLOSE_INITIATOR,RESET:Yn.RESET_INITIATOR}),gk=Object.freeze({MESSAGE:Yn.MESSAGE_RECEIVER,CLOSE:Yn.CLOSE_RECEIVER,RESET:Yn.RESET_RECEIVER}),yk=Object.freeze(Object.entries(Yn).reduce((e,t)=>(e[t[1]]=t[0],e),{})),wm={MessageTypes:fk,InitiatorMessageTypes:mk,ReceiverMessageTypes:gk,MessageTypeNames:yk};const Hs=te("libp2p:mplex:stream"),{MAX_MSG_SIZE:bk}=Ml,{InitiatorMessageTypes:vk,ReceiverMessageTypes:wk}=wm;var _k=({id:e,name:t,send:r,onEnd:n=()=>{},type:i="initiator",maxMsgSize:a=bk})=>{const s=new hi,c=new hi,o=i==="initiator"?vk:wk,u=i==="initiator"?`i${e}`:`r${e}`;t=String(t??e);let l=!1,h=!1,w;const f=y=>{l=!0,Hs("%s stream %s source end",i,t,y),y&&!w&&(w=y),h&&(p.timeline.close=Date.now(),n(w))},A=y=>{h=!0,Hs("%s stream %s sink end",i,t,y),y&&!w&&(w=y),l&&(p.timeline.close=Date.now(),n(w))},p={close:()=>p.source.end(),abort:y=>{Hs("%s stream %s abort",i,t,y),p.source.end(y),s.abort()},reset:()=>c.abort(),sink:async y=>{y=vt(y,[{signal:s.signal,options:{abortMessage:"stream aborted",abortCode:"ERR_MPLEX_STREAM_ABORT"}},{signal:c.signal,options:{abortMessage:"stream reset",abortCode:"ERR_MPLEX_STREAM_RESET"}}]),i==="initiator"&&r({id:e,type:o.NEW_STREAM,data:t});try{for await(let v of y)for(;v.length;){if(v.length<=a){r({id:e,type:o.MESSAGE,data:v});break}v=tt.isBufferList(v)?v:new tt(v),r({id:e,type:o.MESSAGE,data:v.shallowSlice(0,a)}),v.consume(a)}}catch(v){return v.code==="ERR_MPLEX_STREAM_RESET"?Hs("%s stream %s reset",i,t):(Hs("%s stream %s error",i,t,v),r({id:e,type:o.RESET})),p.source.end(v),A(v)}r({id:e,type:o.CLOSE}),A()},source:bo(f),timeline:{open:Date.now(),close:null},id:u};return p};const Jn=te("libp2p:mplex"),{MessageTypes:ea,MessageTypeNames:_m}=wm;class Em{constructor(e){e=e||{},e=typeof e=="function"?{onStream:e}:e,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._options=e,this.sink=this._createSink(),this.source=this._createSource(),this.onStream=e.onStream,this.onStreamEnd=e.onStreamEnd}get streams(){const e=[];return this._streams.initiators.forEach(t=>{e.push(t)}),this._streams.receivers.forEach(t=>{e.push(t)}),e}newStream(e){const t=this._streamId++;e=e==null?t.toString():String(e);const r=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:r})}_newReceiverStream({id:e,name:t}){const r=this._streams.receivers;return this._newStream({id:e,name:t,type:"receiver",registry:r})}_newStream({id:e,name:t,type:r,registry:n}){if(n.has(e))throw new Error(`${r} stream ${e} already exists!`);Jn("new %s stream %s %s",r,e,t);const i=c=>(Jn.enabled&&Jn("%s stream %s %s send",r,e,t,{...c,type:_m[c.type],data:c.data&&c.data.slice()}),this.source.push(c)),a=()=>{Jn("%s stream %s %s ended",r,e,t),n.delete(e),this.onStreamEnd&&this.onStreamEnd(s)},s=_k({id:e,name:t,send:i,type:r,onEnd:a,maxMsgSize:this._options.maxMsgSize});return n.set(e,s),s}_createSink(){return async e=>{this._options.signal&&(e=vt(e,this._options.signal));try{await bt(e,bm.decode,Ml(this._options.maxMsgSize),async t=>{for await(const r of t)for(const n of r)this._handleIncoming(n)})}catch(t){return Jn("error in sink",t),this.source.end(t)}this.source.end()}}_createSource(){const e=r=>{const{initiators:n,receivers:i}=this._streams;for(const a of n.values())a.abort(r);for(const a of i.values())a.abort(r)},t=bo({onEnd:e,writev:!0});return Object.assign(bm.encode(t),{push:t.push,end:t.end,return:t.return})}_handleIncoming({id:e,type:t,data:r}){if(Jn.enabled&&Jn("incoming message",{id:e,type:_m[t],data:r.slice()}),t===ea.NEW_STREAM&&this.onStream){const a=this._newReceiverStream({id:e,name:r.toString()});return this.onStream(a)}const n=t&1?this._streams.initiators:this._streams.receivers,i=n.get(e);if(!i)return Jn("missing stream %s",e);switch(t){case ea.MESSAGE_INITIATOR:case ea.MESSAGE_RECEIVER:i.source.push(r);break;case ea.CLOSE_INITIATOR:case ea.CLOSE_RECEIVER:i.close();break;case ea.RESET_INITIATOR:case ea.RESET_RECEIVER:i.reset();break;default:Jn("unknown message type %s",t)}}}Em.multicodec="/mplex/6.7.0";var Ek=Em,Sk=Ek,wc=Nr(`message Propose {
  optional bytes rand = 1;
  optional bytes pubkey = 2;
  optional string exchanges = 3;
  optional string ciphers = 4;
  optional string hashes = 5;
}

message Exchange {
  optional bytes epubkey = 1;
  optional bytes signature = 2;
}`),On=re(function(e){/**
 * [js-sha3]{@link https://github.com/emn178/js-sha3}
 *
 * @version 0.8.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2018
 * @license MIT
 */(function(){var t="input is invalid type",r="finalize already called",n=typeof window=="object",i=n?window:{};i.JS_SHA3_NO_WINDOW&&(n=!1);var a=!n&&typeof self=="object",s=!i.JS_SHA3_NO_NODE_JS&&typeof _e=="object"&&_e.versions&&_e.versions.node;s?i=ge:a&&(i=self);var c=!i.JS_SHA3_NO_COMMON_JS&&!0&&e.exports,o=!i.JS_SHA3_NO_ARRAY_BUFFER&&typeof ArrayBuffer!="undefined",u="0123456789abcdef".split(""),l=[31,7936,2031616,520093696],h=[4,1024,262144,67108864],w=[1,256,65536,16777216],f=[6,1536,393216,100663296],A=[0,8,16,24],p=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],y=[224,256,384,512],v=[128,256],O=["hex","buffer","arrayBuffer","array","digest"],R={"128":168,"256":136};(i.JS_SHA3_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(k){return Object.prototype.toString.call(k)==="[object Array]"}),o&&(i.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(k){return typeof k=="object"&&k.buffer&&k.buffer.constructor===ArrayBuffer});for(var m=function(k,K,Q){return function(Z){return new fe(k,K,k).update(Z)[Q]()}},g=function(k,K,Q){return function(Z,ie){return new fe(k,K,ie).update(Z)[Q]()}},S=function(k,K,Q){return function(Z,ie,ue,he){return L["cshake"+k].update(Z,ie,ue,he)[Q]()}},d=function(k,K,Q){return function(Z,ie,ue,he){return L["kmac"+k].update(Z,ie,ue,he)[Q]()}},b=function(k,K,Q,Z){for(var ie=0;ie<O.length;++ie){var ue=O[ie];k[ue]=K(Q,Z,ue)}return k},E=function(k,K){var Q=m(k,K,"hex");return Q.create=function(){return new fe(k,K,k)},Q.update=function(Z){return Q.create().update(Z)},b(Q,m,k,K)},_=function(k,K){var Q=g(k,K,"hex");return Q.create=function(Z){return new fe(k,K,Z)},Q.update=function(Z,ie){return Q.create(ie).update(Z)},b(Q,g,k,K)},P=function(k,K){var Q=R[k],Z=S(k,K,"hex");return Z.create=function(ie,ue,he){return!ue&&!he?L["shake"+k].create(ie):new fe(k,K,ie).bytepad([ue,he],Q)},Z.update=function(ie,ue,he,ce){return Z.create(ue,he,ce).update(ie)},b(Z,S,k,K)},M=function(k,K){var Q=R[k],Z=d(k,K,"hex");return Z.create=function(ie,ue,he){return new me(k,K,ue).bytepad(["KMAC",he],Q).bytepad([ie],Q)},Z.update=function(ie,ue,he,ce){return Z.create(ie,he,ce).update(ue)},b(Z,d,k,K)},j=[{name:"keccak",padding:w,bits:y,createMethod:E},{name:"sha3",padding:f,bits:y,createMethod:E},{name:"shake",padding:l,bits:v,createMethod:_},{name:"cshake",padding:h,bits:v,createMethod:P},{name:"kmac",padding:h,bits:v,createMethod:M}],L={},B=[],$=0;$<j.length;++$)for(var V=j[$],W=V.bits,se=0;se<W.length;++se){var oe=V.name+"_"+W[se];if(B.push(oe),L[oe]=V.createMethod(W[se],V.padding),V.name!=="sha3"){var Ee=V.name+W[se];B.push(Ee),L[Ee]=L[oe]}}function fe(k,K,Q){this.blocks=[],this.s=[],this.padding=K,this.outputBits=Q,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(k<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=Q>>5,this.extraBytes=(Q&31)>>3;for(var Z=0;Z<50;++Z)this.s[Z]=0}fe.prototype.update=function(k){if(this.finalized)throw new Error(r);var K,Q=typeof k;if(Q!=="string"){if(Q==="object"){if(k===null)throw new Error(t);if(o&&k.constructor===ArrayBuffer)k=new Uint8Array(k);else if(!Array.isArray(k)&&(!o||!ArrayBuffer.isView(k)))throw new Error(t)}else throw new Error(t);K=!0}for(var Z=this.blocks,ie=this.byteCount,ue=k.length,he=this.blockCount,ce=0,Te=this.s,J,He;ce<ue;){if(this.reset)for(this.reset=!1,Z[0]=this.block,J=1;J<he+1;++J)Z[J]=0;if(K)for(J=this.start;ce<ue&&J<ie;++ce)Z[J>>2]|=k[ce]<<A[J++&3];else for(J=this.start;ce<ue&&J<ie;++ce)He=k.charCodeAt(ce),He<128?Z[J>>2]|=He<<A[J++&3]:He<2048?(Z[J>>2]|=(192|He>>6)<<A[J++&3],Z[J>>2]|=(128|He&63)<<A[J++&3]):He<55296||He>=57344?(Z[J>>2]|=(224|He>>12)<<A[J++&3],Z[J>>2]|=(128|He>>6&63)<<A[J++&3],Z[J>>2]|=(128|He&63)<<A[J++&3]):(He=65536+((He&1023)<<10|k.charCodeAt(++ce)&1023),Z[J>>2]|=(240|He>>18)<<A[J++&3],Z[J>>2]|=(128|He>>12&63)<<A[J++&3],Z[J>>2]|=(128|He>>6&63)<<A[J++&3],Z[J>>2]|=(128|He&63)<<A[J++&3]);if(this.lastByteIndex=J,J>=ie){for(this.start=J-ie,this.block=Z[he],J=0;J<he;++J)Te[J]^=Z[J];pe(Te),this.reset=!0}else this.start=J}return this},fe.prototype.encode=function(k,K){var Q=k&255,Z=1,ie=[Q];for(k=k>>8,Q=k&255;Q>0;)ie.unshift(Q),k=k>>8,Q=k&255,++Z;return K?ie.push(Z):ie.unshift(Z),this.update(ie),ie.length},fe.prototype.encodeString=function(k){var K,Q=typeof k;if(Q!=="string"){if(Q==="object"){if(k===null)throw new Error(t);if(o&&k.constructor===ArrayBuffer)k=new Uint8Array(k);else if(!Array.isArray(k)&&(!o||!ArrayBuffer.isView(k)))throw new Error(t)}else throw new Error(t);K=!0}var Z=0,ie=k.length;if(K)Z=ie;else for(var ue=0;ue<k.length;++ue){var he=k.charCodeAt(ue);he<128?Z+=1:he<2048?Z+=2:he<55296||he>=57344?Z+=3:(he=65536+((he&1023)<<10|k.charCodeAt(++ue)&1023),Z+=4)}return Z+=this.encode(Z*8),this.update(k),Z},fe.prototype.bytepad=function(k,K){for(var Q=this.encode(K),Z=0;Z<k.length;++Z)Q+=this.encodeString(k[Z]);var ie=K-Q%K,ue=[];return ue.length=ie,this.update(ue),this},fe.prototype.finalize=function(){if(this.finalized)return;this.finalized=!0;var k=this.blocks,K=this.lastByteIndex,Q=this.blockCount,Z=this.s;if(k[K>>2]|=this.padding[K&3],this.lastByteIndex===this.byteCount)for(k[0]=k[Q],K=1;K<Q+1;++K)k[K]=0;for(k[Q-1]|=2147483648,K=0;K<Q;++K)Z[K]^=k[K];pe(Z)},fe.prototype.toString=fe.prototype.hex=function(){this.finalize();for(var k=this.blockCount,K=this.s,Q=this.outputBlocks,Z=this.extraBytes,ie=0,ue=0,he="",ce;ue<Q;){for(ie=0;ie<k&&ue<Q;++ie,++ue)ce=K[ie],he+=u[ce>>4&15]+u[ce&15]+u[ce>>12&15]+u[ce>>8&15]+u[ce>>20&15]+u[ce>>16&15]+u[ce>>28&15]+u[ce>>24&15];ue%k===0&&(pe(K),ie=0)}return Z&&(ce=K[ie],he+=u[ce>>4&15]+u[ce&15],Z>1&&(he+=u[ce>>12&15]+u[ce>>8&15]),Z>2&&(he+=u[ce>>20&15]+u[ce>>16&15])),he},fe.prototype.arrayBuffer=function(){this.finalize();var k=this.blockCount,K=this.s,Q=this.outputBlocks,Z=this.extraBytes,ie=0,ue=0,he=this.outputBits>>3,ce;Z?ce=new ArrayBuffer(Q+1<<2):ce=new ArrayBuffer(he);for(var Te=new Uint32Array(ce);ue<Q;){for(ie=0;ie<k&&ue<Q;++ie,++ue)Te[ue]=K[ie];ue%k===0&&pe(K)}return Z&&(Te[ie]=K[ie],ce=ce.slice(0,he)),ce},fe.prototype.buffer=fe.prototype.arrayBuffer,fe.prototype.digest=fe.prototype.array=function(){this.finalize();for(var k=this.blockCount,K=this.s,Q=this.outputBlocks,Z=this.extraBytes,ie=0,ue=0,he=[],ce,Te;ue<Q;){for(ie=0;ie<k&&ue<Q;++ie,++ue)ce=ue<<2,Te=K[ie],he[ce]=Te&255,he[ce+1]=Te>>8&255,he[ce+2]=Te>>16&255,he[ce+3]=Te>>24&255;ue%k===0&&pe(K)}return Z&&(ce=ue<<2,Te=K[ie],he[ce]=Te&255,Z>1&&(he[ce+1]=Te>>8&255),Z>2&&(he[ce+2]=Te>>16&255)),he};function me(k,K,Q){fe.call(this,k,K,Q)}me.prototype=new fe,me.prototype.finalize=function(){return this.encode(this.outputBits,!0),fe.prototype.finalize.call(this)};var pe=function(k){var K,Q,Z,ie,ue,he,ce,Te,J,He,Gr,cn,Ct,$r,Yt,vr,Jt,pt,wr,Vr,un,ln,ur,Hr,zr,lr,Kr,Wr,_r,dn,kt,Lt,dr,Er,Xr,ft,mt,hn,Rt,Qr,pn,fn,mn,gn,ot,Zt,Sr,Ar,Tr,er,Ht,yn,bn,vn,wn,hr,it,Ir,jt,_n,En,Sn,An;for(Z=0;Z<48;Z+=2)ie=k[0]^k[10]^k[20]^k[30]^k[40],ue=k[1]^k[11]^k[21]^k[31]^k[41],he=k[2]^k[12]^k[22]^k[32]^k[42],ce=k[3]^k[13]^k[23]^k[33]^k[43],Te=k[4]^k[14]^k[24]^k[34]^k[44],J=k[5]^k[15]^k[25]^k[35]^k[45],He=k[6]^k[16]^k[26]^k[36]^k[46],Gr=k[7]^k[17]^k[27]^k[37]^k[47],cn=k[8]^k[18]^k[28]^k[38]^k[48],Ct=k[9]^k[19]^k[29]^k[39]^k[49],K=cn^(he<<1|ce>>>31),Q=Ct^(ce<<1|he>>>31),k[0]^=K,k[1]^=Q,k[10]^=K,k[11]^=Q,k[20]^=K,k[21]^=Q,k[30]^=K,k[31]^=Q,k[40]^=K,k[41]^=Q,K=ie^(Te<<1|J>>>31),Q=ue^(J<<1|Te>>>31),k[2]^=K,k[3]^=Q,k[12]^=K,k[13]^=Q,k[22]^=K,k[23]^=Q,k[32]^=K,k[33]^=Q,k[42]^=K,k[43]^=Q,K=he^(He<<1|Gr>>>31),Q=ce^(Gr<<1|He>>>31),k[4]^=K,k[5]^=Q,k[14]^=K,k[15]^=Q,k[24]^=K,k[25]^=Q,k[34]^=K,k[35]^=Q,k[44]^=K,k[45]^=Q,K=Te^(cn<<1|Ct>>>31),Q=J^(Ct<<1|cn>>>31),k[6]^=K,k[7]^=Q,k[16]^=K,k[17]^=Q,k[26]^=K,k[27]^=Q,k[36]^=K,k[37]^=Q,k[46]^=K,k[47]^=Q,K=He^(ie<<1|ue>>>31),Q=Gr^(ue<<1|ie>>>31),k[8]^=K,k[9]^=Q,k[18]^=K,k[19]^=Q,k[28]^=K,k[29]^=Q,k[38]^=K,k[39]^=Q,k[48]^=K,k[49]^=Q,$r=k[0],Yt=k[1],Zt=k[11]<<4|k[10]>>>28,Sr=k[10]<<4|k[11]>>>28,Wr=k[20]<<3|k[21]>>>29,_r=k[21]<<3|k[20]>>>29,_n=k[31]<<9|k[30]>>>23,En=k[30]<<9|k[31]>>>23,fn=k[40]<<18|k[41]>>>14,mn=k[41]<<18|k[40]>>>14,Er=k[2]<<1|k[3]>>>31,Xr=k[3]<<1|k[2]>>>31,vr=k[13]<<12|k[12]>>>20,Jt=k[12]<<12|k[13]>>>20,Ar=k[22]<<10|k[23]>>>22,Tr=k[23]<<10|k[22]>>>22,dn=k[33]<<13|k[32]>>>19,kt=k[32]<<13|k[33]>>>19,Sn=k[42]<<2|k[43]>>>30,An=k[43]<<2|k[42]>>>30,vn=k[5]<<30|k[4]>>>2,wn=k[4]<<30|k[5]>>>2,ft=k[14]<<6|k[15]>>>26,mt=k[15]<<6|k[14]>>>26,pt=k[25]<<11|k[24]>>>21,wr=k[24]<<11|k[25]>>>21,er=k[34]<<15|k[35]>>>17,Ht=k[35]<<15|k[34]>>>17,Lt=k[45]<<29|k[44]>>>3,dr=k[44]<<29|k[45]>>>3,Hr=k[6]<<28|k[7]>>>4,zr=k[7]<<28|k[6]>>>4,hr=k[17]<<23|k[16]>>>9,it=k[16]<<23|k[17]>>>9,hn=k[26]<<25|k[27]>>>7,Rt=k[27]<<25|k[26]>>>7,Vr=k[36]<<21|k[37]>>>11,un=k[37]<<21|k[36]>>>11,yn=k[47]<<24|k[46]>>>8,bn=k[46]<<24|k[47]>>>8,gn=k[8]<<27|k[9]>>>5,ot=k[9]<<27|k[8]>>>5,lr=k[18]<<20|k[19]>>>12,Kr=k[19]<<20|k[18]>>>12,Ir=k[29]<<7|k[28]>>>25,jt=k[28]<<7|k[29]>>>25,Qr=k[38]<<8|k[39]>>>24,pn=k[39]<<8|k[38]>>>24,ln=k[48]<<14|k[49]>>>18,ur=k[49]<<14|k[48]>>>18,k[0]=$r^~vr&pt,k[1]=Yt^~Jt&wr,k[10]=Hr^~lr&Wr,k[11]=zr^~Kr&_r,k[20]=Er^~ft&hn,k[21]=Xr^~mt&Rt,k[30]=gn^~Zt&Ar,k[31]=ot^~Sr&Tr,k[40]=vn^~hr&Ir,k[41]=wn^~it&jt,k[2]=vr^~pt&Vr,k[3]=Jt^~wr&un,k[12]=lr^~Wr&dn,k[13]=Kr^~_r&kt,k[22]=ft^~hn&Qr,k[23]=mt^~Rt&pn,k[32]=Zt^~Ar&er,k[33]=Sr^~Tr&Ht,k[42]=hr^~Ir&_n,k[43]=it^~jt&En,k[4]=pt^~Vr&ln,k[5]=wr^~un&ur,k[14]=Wr^~dn&Lt,k[15]=_r^~kt&dr,k[24]=hn^~Qr&fn,k[25]=Rt^~pn&mn,k[34]=Ar^~er&yn,k[35]=Tr^~Ht&bn,k[44]=Ir^~_n&Sn,k[45]=jt^~En&An,k[6]=Vr^~ln&$r,k[7]=un^~ur&Yt,k[16]=dn^~Lt&Hr,k[17]=kt^~dr&zr,k[26]=Qr^~fn&Er,k[27]=pn^~mn&Xr,k[36]=er^~yn&gn,k[37]=Ht^~bn&ot,k[46]=_n^~Sn&vn,k[47]=En^~An&wn,k[8]=ln^~$r&vr,k[9]=ur^~Yt&Jt,k[18]=Lt^~Hr&lr,k[19]=dr^~zr&Kr,k[28]=fn^~Er&ft,k[29]=mn^~Xr&mt,k[38]=yn^~gn&Zt,k[39]=bn^~ot&Sr,k[48]=Sn^~vn&hr,k[49]=An^~wn&it,k[0]^=p[Z],k[1]^=p[Z+1]};if(c)e.exports=L;else for($=0;$<B.length;++$)i[B[$]]=L[B[$]]})()}),Ak=re(function(e,t){(function(r,n){var i={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function a(p){if(!Array.isArray(p)&&!ArrayBuffer.isView(p))return!1;for(var y=0;y<p.length;y++)if(!Number.isInteger(p[y])||p[y]<0||p[y]>255)return!1;return!0}function s(p,y){return(p&65535)*y+(((p>>>16)*y&65535)<<16)}function c(p,y){return p<<y|p>>>32-y}function o(p){return p^=p>>>16,p=s(p,2246822507),p^=p>>>13,p=s(p,3266489909),p^=p>>>16,p}function u(p,y){p=[p[0]>>>16,p[0]&65535,p[1]>>>16,p[1]&65535],y=[y[0]>>>16,y[0]&65535,y[1]>>>16,y[1]&65535];var v=[0,0,0,0];return v[3]+=p[3]+y[3],v[2]+=v[3]>>>16,v[3]&=65535,v[2]+=p[2]+y[2],v[1]+=v[2]>>>16,v[2]&=65535,v[1]+=p[1]+y[1],v[0]+=v[1]>>>16,v[1]&=65535,v[0]+=p[0]+y[0],v[0]&=65535,[v[0]<<16|v[1],v[2]<<16|v[3]]}function l(p,y){p=[p[0]>>>16,p[0]&65535,p[1]>>>16,p[1]&65535],y=[y[0]>>>16,y[0]&65535,y[1]>>>16,y[1]&65535];var v=[0,0,0,0];return v[3]+=p[3]*y[3],v[2]+=v[3]>>>16,v[3]&=65535,v[2]+=p[2]*y[3],v[1]+=v[2]>>>16,v[2]&=65535,v[2]+=p[3]*y[2],v[1]+=v[2]>>>16,v[2]&=65535,v[1]+=p[1]*y[3],v[0]+=v[1]>>>16,v[1]&=65535,v[1]+=p[2]*y[2],v[0]+=v[1]>>>16,v[1]&=65535,v[1]+=p[3]*y[1],v[0]+=v[1]>>>16,v[1]&=65535,v[0]+=p[0]*y[3]+p[1]*y[2]+p[2]*y[1]+p[3]*y[0],v[0]&=65535,[v[0]<<16|v[1],v[2]<<16|v[3]]}function h(p,y){return y%=64,y===32?[p[1],p[0]]:y<32?[p[0]<<y|p[1]>>>32-y,p[1]<<y|p[0]>>>32-y]:(y-=32,[p[1]<<y|p[0]>>>32-y,p[0]<<y|p[1]>>>32-y])}function w(p,y){return y%=64,y===0?p:y<32?[p[0]<<y|p[1]>>>32-y,p[1]<<y]:[p[1]<<y-32,0]}function f(p,y){return[p[0]^y[0],p[1]^y[1]]}function A(p){return p=f(p,[0,p[0]>>>1]),p=l(p,[4283543511,3981806797]),p=f(p,[0,p[0]>>>1]),p=l(p,[3301882366,444984403]),p=f(p,[0,p[0]>>>1]),p}i.x86.hash32=function(p,y){if(i.inputValidation&&!a(p))return n;y=y||0;for(var v=p.length%4,O=p.length-v,R=y,m=0,g=3432918353,S=461845907,d=0;d<O;d=d+4)m=p[d]|p[d+1]<<8|p[d+2]<<16|p[d+3]<<24,m=s(m,g),m=c(m,15),m=s(m,S),R^=m,R=c(R,13),R=s(R,5)+3864292196;m=0;switch(v){case 3:m^=p[d+2]<<16;case 2:m^=p[d+1]<<8;case 1:m^=p[d],m=s(m,g),m=c(m,15),m=s(m,S),R^=m}return R^=p.length,R=o(R),R>>>0},i.x86.hash128=function(p,y){if(i.inputValidation&&!a(p))return n;y=y||0;for(var v=p.length%16,O=p.length-v,R=y,m=y,g=y,S=y,d=0,b=0,E=0,_=0,P=597399067,M=2869860233,j=951274213,L=2716044179,B=0;B<O;B=B+16)d=p[B]|p[B+1]<<8|p[B+2]<<16|p[B+3]<<24,b=p[B+4]|p[B+5]<<8|p[B+6]<<16|p[B+7]<<24,E=p[B+8]|p[B+9]<<8|p[B+10]<<16|p[B+11]<<24,_=p[B+12]|p[B+13]<<8|p[B+14]<<16|p[B+15]<<24,d=s(d,P),d=c(d,15),d=s(d,M),R^=d,R=c(R,19),R+=m,R=s(R,5)+1444728091,b=s(b,M),b=c(b,16),b=s(b,j),m^=b,m=c(m,17),m+=g,m=s(m,5)+197830471,E=s(E,j),E=c(E,17),E=s(E,L),g^=E,g=c(g,15),g+=S,g=s(g,5)+2530024501,_=s(_,L),_=c(_,18),_=s(_,P),S^=_,S=c(S,13),S+=R,S=s(S,5)+850148119;d=0,b=0,E=0,_=0;switch(v){case 15:_^=p[B+14]<<16;case 14:_^=p[B+13]<<8;case 13:_^=p[B+12],_=s(_,L),_=c(_,18),_=s(_,P),S^=_;case 12:E^=p[B+11]<<24;case 11:E^=p[B+10]<<16;case 10:E^=p[B+9]<<8;case 9:E^=p[B+8],E=s(E,j),E=c(E,17),E=s(E,L),g^=E;case 8:b^=p[B+7]<<24;case 7:b^=p[B+6]<<16;case 6:b^=p[B+5]<<8;case 5:b^=p[B+4],b=s(b,M),b=c(b,16),b=s(b,j),m^=b;case 4:d^=p[B+3]<<24;case 3:d^=p[B+2]<<16;case 2:d^=p[B+1]<<8;case 1:d^=p[B],d=s(d,P),d=c(d,15),d=s(d,M),R^=d}return R^=p.length,m^=p.length,g^=p.length,S^=p.length,R+=m,R+=g,R+=S,m+=R,g+=R,S+=R,R=o(R),m=o(m),g=o(g),S=o(S),R+=m,R+=g,R+=S,m+=R,g+=R,S+=R,("00000000"+(R>>>0).toString(16)).slice(-8)+("00000000"+(m>>>0).toString(16)).slice(-8)+("00000000"+(g>>>0).toString(16)).slice(-8)+("00000000"+(S>>>0).toString(16)).slice(-8)},i.x64.hash128=function(p,y){if(i.inputValidation&&!a(p))return n;y=y||0;for(var v=p.length%16,O=p.length-v,R=[0,y],m=[0,y],g=[0,0],S=[0,0],d=[2277735313,289559509],b=[1291169091,658871167],E=0;E<O;E=E+16)g=[p[E+4]|p[E+5]<<8|p[E+6]<<16|p[E+7]<<24,p[E]|p[E+1]<<8|p[E+2]<<16|p[E+3]<<24],S=[p[E+12]|p[E+13]<<8|p[E+14]<<16|p[E+15]<<24,p[E+8]|p[E+9]<<8|p[E+10]<<16|p[E+11]<<24],g=l(g,d),g=h(g,31),g=l(g,b),R=f(R,g),R=h(R,27),R=u(R,m),R=u(l(R,[0,5]),[0,1390208809]),S=l(S,b),S=h(S,33),S=l(S,d),m=f(m,S),m=h(m,31),m=u(m,R),m=u(l(m,[0,5]),[0,944331445]);g=[0,0],S=[0,0];switch(v){case 15:S=f(S,w([0,p[E+14]],48));case 14:S=f(S,w([0,p[E+13]],40));case 13:S=f(S,w([0,p[E+12]],32));case 12:S=f(S,w([0,p[E+11]],24));case 11:S=f(S,w([0,p[E+10]],16));case 10:S=f(S,w([0,p[E+9]],8));case 9:S=f(S,[0,p[E+8]]),S=l(S,b),S=h(S,33),S=l(S,d),m=f(m,S);case 8:g=f(g,w([0,p[E+7]],56));case 7:g=f(g,w([0,p[E+6]],48));case 6:g=f(g,w([0,p[E+5]],40));case 5:g=f(g,w([0,p[E+4]],32));case 4:g=f(g,w([0,p[E+3]],24));case 3:g=f(g,w([0,p[E+2]],16));case 2:g=f(g,w([0,p[E+1]],8));case 1:g=f(g,[0,p[E]]),g=l(g,d),g=h(g,31),g=l(g,b),R=f(R,g)}return R=f(R,[0,p.length]),m=f(m,[0,p.length]),R=u(R,m),m=u(m,R),R=A(R),m=A(m),R=u(R,m),m=u(m,R),("00000000"+(R[0]>>>0).toString(16)).slice(-8)+("00000000"+(R[1]>>>0).toString(16)).slice(-8)+("00000000"+(m[0]>>>0).toString(16)).slice(-8)+("00000000"+(m[1]>>>0).toString(16)).slice(-8)},e.exports&&(t=e.exports=i),t.murmurHash3=i})()}),Sm=Ak;const Tk=e=>{const t=new Uint8Array(4);for(let r=0;r<4;r++)t[r]=e&255,e=e>>8;return t};var Ik={fromNumberTo32BitBuf:Tk},Ck="Input must be an string, Buffer or Uint8Array";function kk(e){var t;if(e instanceof Uint8Array)t=e;else if(e instanceof Buffer)t=new Uint8Array(e);else if(typeof e=="string")t=new Uint8Array(Buffer.from(e,"utf8"));else throw new Error(Ck);return t}function Rk(e){return Array.prototype.map.call(e,function(t){return(t<16?"0":"")+t.toString(16)}).join("")}function _c(e){return(4294967296+e).toString(16).substring(1)}function Pk(e,t,r){for(var n=`
`+e+" = ",i=0;i<t.length;i+=2){if(r===32)n+=_c(t[i]).toUpperCase(),n+=" ",n+=_c(t[i+1]).toUpperCase();else if(r===64)n+=_c(t[i+1]).toUpperCase(),n+=_c(t[i]).toUpperCase();else throw new Error("Invalid size "+r);i%6===4?n+=`
`+new Array(e.length+4).join(" "):i<t.length-2&&(n+=" ")}console.log(n)}function Nk(e,t,r){for(var n=new Date().getTime(),i=new Uint8Array(t),a=0;a<t;a++)i[a]=a%256;var s=new Date().getTime();for(console.log("Generated random input in "+(s-n)+"ms"),n=s,a=0;a<r;a++){var c=e(i),o=new Date().getTime(),u=o-n;n=o,console.log("Hashed in "+u+"ms: "+c.substring(0,20)+"..."),console.log(Math.round(t/(1<<20)/(u/1e3)*100)/100+" MB PER SECOND")}}var Ec={normalizeInput:kk,toHex:Rk,debugPrint:Pk,testSpeed:Nk};function Sc(e,t,r){var n=e[t]+e[r],i=e[t+1]+e[r+1];n>=4294967296&&i++,e[t]=n,e[t+1]=i}function Am(e,t,r,n){var i=e[t]+r;r<0&&(i+=4294967296);var a=e[t+1]+n;i>=4294967296&&a++,e[t]=i,e[t+1]=a}function Ok(e,t){return e[t]^e[t+1]<<8^e[t+2]<<16^e[t+3]<<24}function Ai(e,t,r,n,i,a){var s=zs[i],c=zs[i+1],o=zs[a],u=zs[a+1];Sc(Ie,e,t),Am(Ie,e,s,c);var l=Ie[n]^Ie[e],h=Ie[n+1]^Ie[e+1];Ie[n]=h,Ie[n+1]=l,Sc(Ie,r,n),l=Ie[t]^Ie[r],h=Ie[t+1]^Ie[r+1],Ie[t]=l>>>24^h<<8,Ie[t+1]=h>>>24^l<<8,Sc(Ie,e,t),Am(Ie,e,o,u),l=Ie[n]^Ie[e],h=Ie[n+1]^Ie[e+1],Ie[n]=l>>>16^h<<16,Ie[n+1]=h>>>16^l<<16,Sc(Ie,r,n),l=Ie[t]^Ie[r],h=Ie[t+1]^Ie[r+1],Ie[t]=h>>>31^l<<1,Ie[t+1]=l>>>31^h<<1}var Tm=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),Dk=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],$t=new Uint8Array(Dk.map(function(e){return e*2})),Ie=new Uint32Array(32),zs=new Uint32Array(32);function Im(e,t){var r=0;for(r=0;r<16;r++)Ie[r]=e.h[r],Ie[r+16]=Tm[r];for(Ie[24]=Ie[24]^e.t,Ie[25]=Ie[25]^e.t/4294967296,t&&(Ie[28]=~Ie[28],Ie[29]=~Ie[29]),r=0;r<32;r++)zs[r]=Ok(e.b,4*r);for(r=0;r<12;r++)Ai(0,8,16,24,$t[r*16+0],$t[r*16+1]),Ai(2,10,18,26,$t[r*16+2],$t[r*16+3]),Ai(4,12,20,28,$t[r*16+4],$t[r*16+5]),Ai(6,14,22,30,$t[r*16+6],$t[r*16+7]),Ai(0,10,20,30,$t[r*16+8],$t[r*16+9]),Ai(2,12,22,24,$t[r*16+10],$t[r*16+11]),Ai(4,14,16,26,$t[r*16+12],$t[r*16+13]),Ai(6,8,18,28,$t[r*16+14],$t[r*16+15]);for(r=0;r<16;r++)e.h[r]=e.h[r]^Ie[r]^Ie[r+16]}function Cm(e,t){if(e===0||e>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(t&&t.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");for(var r={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:e},n=0;n<16;n++)r.h[n]=Tm[n];var i=t?t.length:0;return r.h[0]^=16842752^i<<8^e,t&&(xl(r,t),r.c=128),r}function xl(e,t){for(var r=0;r<t.length;r++)e.c===128&&(e.t+=e.c,Im(e,!1),e.c=0),e.b[e.c++]=t[r]}function km(e){for(e.t+=e.c;e.c<128;)e.b[e.c++]=0;Im(e,!0);for(var t=new Uint8Array(e.outlen),r=0;r<e.outlen;r++)t[r]=e.h[r>>2]>>8*(r&3);return t}function Rm(e,t,r){r=r||64,e=Ec.normalizeInput(e);var n=Cm(r,t);return xl(n,e),km(n)}function Mk(e,t,r){var n=Rm(e,t,r);return Ec.toHex(n)}var Ks={blake2b:Rm,blake2bHex:Mk,blake2bInit:Cm,blake2bUpdate:xl,blake2bFinal:km};function xk(e,t){return e[t]^e[t+1]<<8^e[t+2]<<16^e[t+3]<<24}function Ti(e,t,r,n,i,a){je[e]=je[e]+je[t]+i,je[n]=Ac(je[n]^je[e],16),je[r]=je[r]+je[n],je[t]=Ac(je[t]^je[r],12),je[e]=je[e]+je[t]+a,je[n]=Ac(je[n]^je[e],8),je[r]=je[r]+je[n],je[t]=Ac(je[t]^je[r],7)}function Ac(e,t){return e>>>t^e<<32-t}var Pm=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Vt=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),je=new Uint32Array(16),xt=new Uint32Array(16);function Nm(e,t){var r=0;for(r=0;r<8;r++)je[r]=e.h[r],je[r+8]=Pm[r];for(je[12]^=e.t,je[13]^=e.t/4294967296,t&&(je[14]=~je[14]),r=0;r<16;r++)xt[r]=xk(e.b,4*r);for(r=0;r<10;r++)Ti(0,4,8,12,xt[Vt[r*16+0]],xt[Vt[r*16+1]]),Ti(1,5,9,13,xt[Vt[r*16+2]],xt[Vt[r*16+3]]),Ti(2,6,10,14,xt[Vt[r*16+4]],xt[Vt[r*16+5]]),Ti(3,7,11,15,xt[Vt[r*16+6]],xt[Vt[r*16+7]]),Ti(0,5,10,15,xt[Vt[r*16+8]],xt[Vt[r*16+9]]),Ti(1,6,11,12,xt[Vt[r*16+10]],xt[Vt[r*16+11]]),Ti(2,7,8,13,xt[Vt[r*16+12]],xt[Vt[r*16+13]]),Ti(3,4,9,14,xt[Vt[r*16+14]],xt[Vt[r*16+15]]);for(r=0;r<8;r++)e.h[r]^=je[r]^je[r+8]}function Om(e,t){if(!(e>0&&e<=32))throw new Error("Incorrect output length, should be in [1, 32]");var r=t?t.length:0;if(t&&!(r>0&&r<=32))throw new Error("Incorrect key length, should be in [1, 32]");var n={h:new Uint32Array(Pm),b:new Uint32Array(64),c:0,t:0,outlen:e};return n.h[0]^=16842752^r<<8^e,r>0&&(Bl(n,t),n.c=64),n}function Bl(e,t){for(var r=0;r<t.length;r++)e.c===64&&(e.t+=e.c,Nm(e,!1),e.c=0),e.b[e.c++]=t[r]}function Dm(e){for(e.t+=e.c;e.c<64;)e.b[e.c++]=0;Nm(e,!0);for(var t=new Uint8Array(e.outlen),r=0;r<e.outlen;r++)t[r]=e.h[r>>2]>>8*(r&3)&255;return t}function Mm(e,t,r){r=r||32,e=Ec.normalizeInput(e);var n=Om(r,t);return Bl(n,e),Dm(n)}function Bk(e,t,r){var n=Mm(e,t,r);return Ec.toHex(n)}var Ws={blake2s:Mm,blake2sHex:Bk,blake2sInit:Om,blake2sUpdate:Bl,blake2sFinal:Dm},Ka={blake2b:Ks.blake2b,blake2bHex:Ks.blake2bHex,blake2bInit:Ks.blake2bInit,blake2bUpdate:Ks.blake2bUpdate,blake2bFinal:Ks.blake2bFinal,blake2s:Ws.blake2s,blake2sHex:Ws.blake2sHex,blake2sInit:Ws.blake2sInit,blake2sUpdate:Ws.blake2sUpdate,blake2sFinal:Ws.blake2sFinal};const Lk=45569,jk=45633,Uk={init:Ka.blake2bInit,update:Ka.blake2bUpdate,digest:Ka.blake2bFinal},Fk={init:Ka.blake2sInit,update:Ka.blake2sUpdate,digest:Ka.blake2sFinal},xm=(e,t)=>async r=>{const n=t.init(e,null);return t.update(n,r),t.digest(n)};var qk=e=>{for(let t=0;t<64;t++)e[Lk+t]=xm(t+1,Uk);for(let t=0;t<32;t++)e[jk+t]=xm(t+1,Fk)};const{factory:Tc}=Og,{fromNumberTo32BitBuf:Gk}=Ik,Fr=e=>async t=>{switch(e){case"sha3-224":return new Uint8Array(On.sha3_224.arrayBuffer(t));case"sha3-256":return new Uint8Array(On.sha3_256.arrayBuffer(t));case"sha3-384":return new Uint8Array(On.sha3_384.arrayBuffer(t));case"sha3-512":return new Uint8Array(On.sha3_512.arrayBuffer(t));case"shake-128":return new Uint8Array(On.shake128.create(128).update(t).arrayBuffer());case"shake-256":return new Uint8Array(On.shake256.create(256).update(t).arrayBuffer());case"keccak-224":return new Uint8Array(On.keccak224.arrayBuffer(t));case"keccak-256":return new Uint8Array(On.keccak256.arrayBuffer(t));case"keccak-384":return new Uint8Array(On.keccak384.arrayBuffer(t));case"keccak-512":return new Uint8Array(On.keccak512.arrayBuffer(t));case"murmur3-128":return at(Sm.x64.hash128(t),"base16");case"murmur3-32":return Gk(Sm.x86.hash32(t));default:throw new TypeError(`${e} is not a supported algorithm`)}},$k=e=>e;var It={identity:$k,sha1:Tc("sha1"),sha2256:Tc("sha2-256"),sha2512:Tc("sha2-512"),dblSha2256:Tc("dbl-sha2-256"),sha3224:Fr("sha3-224"),sha3256:Fr("sha3-256"),sha3384:Fr("sha3-384"),sha3512:Fr("sha3-512"),shake128:Fr("shake-128"),shake256:Fr("shake-256"),keccak224:Fr("keccak-224"),keccak256:Fr("keccak-256"),keccak384:Fr("keccak-384"),keccak512:Fr("keccak-512"),murmur3128:Fr("murmur3-128"),murmur332:Fr("murmur3-32"),addBlake:qk};async function qr(e,t,r){const n=await qr.digest(e,t,r);return ao.encode(n,t,r)}qr.multihash=ao,qr.digest=async(e,t,r)=>{const n=qr.createHash(t),i=await n(e);return r?i.slice(0,r):i},qr.createHash=function(e){if(!e)throw U(new Error("hash algorithm must be specified"),"ERR_HASH_ALGORITHM_NOT_SPECIFIED");if(e=ao.coerceCode(e),!qr.functions[e])throw U(new Error(`multihash function '${e}' not yet supported`),"ERR_HASH_ALGORITHM_NOT_SUPPORTED");return qr.functions[e]},qr.functions={0:It.identity,17:It.sha1,18:It.sha2256,19:It.sha2512,20:It.sha3512,21:It.sha3384,22:It.sha3256,23:It.sha3224,24:It.shake128,25:It.shake256,26:It.keccak224,27:It.keccak256,28:It.keccak384,29:It.keccak512,34:It.murmur3128,35:It.murmur332,86:It.dblSha2256},It.addBlake(qr.functions),qr.validate=async(e,t)=>{const r=await qr(e,ao.decode(t).name);return ir(t,r)};var ta=qr;function Vk(e,t){for(let r=0;r<e.byteLength;r++){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0}var Hk=Vk;class Bm extends Error{constructor(e="Unexpected Peer"){super(e);this.code=Bm.code}static get code(){return"ERR_UNEXPECTED_PEER"}}class Lm extends Error{constructor(e="Invalid crypto exchange"){super(e);this.code=Lm.code}static get code(){return"ERR_INVALID_CRYPTO_EXCHANGE"}}class jm extends Error{constructor(e="Invalid crypto transmission"){super(e);this.code=jm.code}static get code(){return"ERR_INVALID_CRYPTO_TRANSMISSION"}}var Ll={UnexpectedPeerError:Bm,InvalidCryptoExchangeError:Lm,InvalidCryptoTransmissionError:jm},Ii=re(function(e,t){const{InvalidCryptoExchangeError:r}=Ll;t.exchanges=["P-256","P-384","P-521"],t.ciphers=["AES-256","AES-128"],t.hashes=["SHA256","SHA512"],t.theBest=(a,s,c)=>{let o,u;if(a<0)o=c,u=s;else if(a>0)o=s,u=c;else return s[0];for(const l of o)for(const h of u)if(l===h)return l;throw new r("No algorithms in common!")},t.makeMacAndCipher=async a=>{[a.mac,a.cipher]=await Promise.all([n(a.hashT,a.keys.macKey),i(a.cipherT,a.keys.iv,a.keys.cipherKey)])};function n(a,s){return sr.hmac.create(a,s)}function i(a,s,c){if(a==="AES-128"||a==="AES-256")return sr.aes.create(c,s);throw new r(`unrecognized cipher type: ${a}`)}t.selectBest=async(a,s)=>{const c=await t.digest(nr([s.pubKeyBytes,a.nonce])),o=await t.digest(nr([a.pubKeyBytes,s.nonce])),u=Hk(c,o);if(u===0)throw new r("you are trying to talk to yourself");return{curveT:t.theBest(u,a.exchanges,s.exchanges),cipherT:t.theBest(u,a.ciphers,s.ciphers),hashT:t.theBest(u,a.hashes,s.hashes),order:u}},t.digest=a=>ta.digest(a,"sha2-256",a.length)});const Ci=te("libp2p:secio");Ci.error=te("libp2p:secio:error");const{UnexpectedPeerError:zk}=Ll,Kk=16;var Wk=e=>(e.proposal.out={rand:sr.randomBytes(Kk),pubkey:e.key.local.public.bytes,exchanges:Ii.exchanges.join(","),ciphers:Ii.ciphers.join(","),hashes:Ii.hashes.join(",")},e.proposalEncoded.out=wc.Propose.encode(e.proposal.out),e.proposalEncoded.out),Xk=async e=>{const t=await sr.keys.generateEphemeralKeyPair(e.protocols.local.curveT);e.ephemeralKey.local=t.key,e.shared.generate=t.genSharedKey;const r=nr([e.proposalEncoded.out,e.proposalEncoded.in,e.ephemeralKey.local]),n=await e.key.local.sign(r);return e.exchange.out={epubkey:e.ephemeralKey.local,signature:n},wc.Exchange.encode(e.exchange.out)},Qk=async(e,t)=>{Ci("1.1 identify"),e.proposalEncoded.in=t,e.proposal.in=wc.Propose.decode(t);const r=e.proposal.in.pubkey;e.key.remote=sr.keys.unmarshalPublicKey(r);const n=await we.createFromPubKey(De(r,"base64pad"));if(e.id.remote){if(e.id.remote.toString()!==n.toString())throw new zk("Dialed to the wrong peer: IDs do not match!");e.id.remote.pubKey=e.key.remote}else e.id.remote=n;Ci("1.1 identify - %s - identified remote peer as %s",e.id.local.toB58String(),e.id.remote.toB58String())},Yk=async e=>{Ci("1.2 selection");const t={pubKeyBytes:e.key.local.public.bytes,exchanges:Ii.exchanges,hashes:Ii.hashes,ciphers:Ii.ciphers,nonce:e.proposal.out.rand},r={pubKeyBytes:e.proposal.in.pubkey,exchanges:e.proposal.in.exchanges.split(","),hashes:e.proposal.in.hashes.split(","),ciphers:e.proposal.in.ciphers.split(","),nonce:e.proposal.in.rand},n=await Ii.selectBest(t,r);e.protocols.remote={order:n.order,curveT:n.curveT,cipherT:n.cipherT,hashT:n.hashT},e.protocols.local={order:n.order,curveT:n.curveT,cipherT:n.cipherT,hashT:n.hashT}},Jk=async(e,t)=>{Ci("2.1. verify"),e.exchange.in=wc.Exchange.decode(t),e.ephemeralKey.remote=e.exchange.in.epubkey;const r=nr([e.proposalEncoded.in,e.proposalEncoded.out,e.ephemeralKey.remote]),n=await e.key.remote.verify(r,e.exchange.in.signature);if(!n)throw new Error("Bad signature");Ci("2.1. verify - signature verified")},Zk=async e=>{Ci("2.2. keys");const t=await e.shared.generate(e.exchange.in.epubkey);e.shared.secret=t;const r=await sr.keys.keyStretcher(e.protocols.local.cipherT,e.protocols.local.hashT,e.shared.secret);if(e.protocols.local.order>0)e.protocols.local.keys=r.k1,e.protocols.remote.keys=r.k2;else if(e.protocols.local.order<0)e.protocols.local.keys=r.k2,e.protocols.remote.keys=r.k1;else throw new Error("you are trying to talk to yourself");Ci("2.3. mac + cipher"),await Promise.all([e.protocols.local,e.protocols.remote].map(n=>Ii.makeMacAndCipher(n)))},eR=(e,t)=>{const r=e.proposal.out.rand;if(ir(r,t))return;throw new Error(`Failed to read our encrypted nonce: ${De(r,"base16")} != ${De(t,"base16")}`)},ra={createProposal:Wk,createExchange:Xk,identify:Qk,selectProtocols:Yk,verify:Jk,generateKeys:Zk,verifyNonce:eR};const{int32BEEncode:tR}=Je,Wa=te("libp2p:secio");Wa.error=te("libp2p:secio:error");var rR=async function(t,r){Wa("1. propose - start");const n=ra.createProposal(t);Wa("1. propose - writing proposal",n),await r.write(Je.encode.single(n,{lengthEncoder:tR})),Wa("1. propose - reading proposal");const i=(await r.readLP()).slice();Wa("1. propose - read proposal",i),await ra.identify(t,i),await ra.selectProtocols(t),Wa("1. propose - finish")};const Xs=te("libp2p:secio");Xs.error=te("libp2p:secio:error");var nR=async function(t,r){Xs("2. exchange - start"),Xs("2. exchange - writing exchange");const n=await ra.createExchange(t);await r.writeLP(n);const i=await r.readLP();Xs("2. exchange - reading exchange"),await ra.verify(t,i.slice()),await ra.generateKeys(t),Xs("2. exchange - finish")},Um=function(){let t,r;const n=async a=>{if(t)throw new Error("already piped");t=tu(a),r&&r(t)},i={[Symbol.asyncIterator](){return this},next(){return t?t.next():new Promise(a=>{r=s=>{r=null,a(s.next())}})}};return{sink:n,source:i}},iR=function(){var e=Um(),t=Um();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]};/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var aR=function(t){return t!=null&&t.constructor!=null&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)},Fm=(e,t={})=>{const r=ms(e),n=Je.decode.fromReader(r.reader,t),i={read:async a=>{const{value:s,done:c}=await r.reader.next(a);if(c&&s.length<a)throw new Error("Couldn't read enough bytes");if(!s)throw new Error("Value is null");return s},readLP:async()=>{const{value:a,done:s}=await n.next();if(!a)throw new Error("Value is null");return a},readPB:async a=>{const s=await i.readLP();if(!s)throw new Error("Value is null");const c=aR(s)?s:s.slice();return a.decode(c)},write:a=>{r.writer.push(a)},writeLP:a=>{i.write(Je.encode.single(a,t))},writePB:(a,s)=>{i.writeLP(s.encode(a))},pb:a=>({read:()=>i.readPB(a),write:s=>i.writePB(s,a)}),unwrap:()=>(r.rest(),r.stream)};return i};const{InvalidCryptoTransmissionError:qm}=Ll;var sR=(e,t)=>async function*(r){for await(const n of r){const i=await e.encrypt(tt.isBufferList(n)?n.slice():n),a=await t.digest(i);yield new tt([i,a])}},oR=(e,t)=>async function*(r){for await(const n of r){const i=n.length,a=t.length;if(i<a)throw new qm(`buffer (${i}) shorter than MAC size (${a})`);const s=i-a,c=n.slice(0,s),o=n.slice(s),u=await t.digest(c);if(!ir(o,u))throw new qm(`MAC Invalid: ${De(o,"base16")} != ${De(u,"base16")}`);const l=await e.decrypt(c);yield l}},Gm={createBoxStream:sR,createUnboxStream:oR};const Ic=te("libp2p:secio");Ic.error=te("libp2p:secio:error");const{int32BEEncode:cR,int32BEDecode:uR}=Je,lR=8388608;var dR=async function(t,r){Ic("3. finish - start");const n=t.protocols,[i,a]=iR(),s=r.unwrap();bt(i,Gm.createBoxStream(n.local.cipher,n.local.mac),Je.encode({lengthEncoder:cR}),s,Je.decode({lengthDecoder:uR,maxDataLength:lR}),Gm.createUnboxStream(n.remote.cipher,n.remote.mac),i).catch(u=>{Ic.error("an error occurred in the crypto stream",u)});const c=Fm(a);c.write(t.proposal.in.rand);const o=await c.read(t.proposal.in.rand.length);ra.verifyNonce(t,o.slice()),Ic("3. finish - finish"),t.secure=c.unwrap()},hR=async function(t,r){await rR(t,r),await nR(t,r),await dR(t,r),t.cleanSecrets()};class pR{constructor(e,t){this.setup(),this.id.local=e,this.id.remote=t,this.key.local=e.privKey}setup(){this.id={local:null,remote:null},this.key={local:null,remote:null},this.shake=null,this.cleanSecrets()}cleanSecrets(){this.shared={},this.ephemeralKey={local:null,remote:null},this.proposal={in:null,out:null},this.proposalEncoded={in:null,out:null},this.protocols={local:null,remote:null},this.exchange={in:null,out:null}}}var fR=pR;const mR=te("libp2p:secio");mR.error=te("libp2p:secio:error");const{int32BEDecode:gR,int32BEEncode:yR}=Je;async function $m(e,t,r){if(!e)throw new Error("no local private key provided");if(!t)throw new Error("no connection for the handshake provided");const n=new fR(e,r),i=Fm(t,{lengthDecoder:gR,lengthEncoder:yR});return await hR(n,i),{conn:n.secure,remotePeer:n.id.remote}}var bR={protocol:"/secio/1.0.0",secureInbound:$m,secureOutbound:$m};const Vm=()=>{};class vR{constructor({min:e=0,max:t=Infinity,handlers:r={}}){this.min=e,this.max=t,this._onConnect=r.onConnect||Vm,this._onDisconnect=r.onDisconnect||Vm,this.peers=new Set}set registrar(e){this._registrar=e}disconnect(e){this._onDisconnect(e)}}var wR=Pr(vR,{className:"Topology",symbolName:"@libp2p/js-interfaces/topology"});class _R extends wR{constructor({min:e,max:t,multicodecs:r,handlers:n}){super({min:e,max:t,handlers:n});if(!r)throw new Error("one or more multicodec should be provided");if(!n)throw new Error("the handlers should be provided");if(typeof n.onConnect!="function")throw new Error("the 'onConnect' handler must be provided");if(typeof n.onDisconnect!="function")throw new Error("the 'onDisconnect' handler must be provided");this.multicodecs=Array.isArray(r)?r:[r],this._registrar=void 0,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerConnect=this._onPeerConnect.bind(this)}set registrar(e){this._registrar=e,this._registrar.peerStore.on("change:protocols",this._onProtocolChange),this._registrar.connectionManager.on("peer:connect",this._onPeerConnect),this._updatePeers(this._registrar.peerStore.peers.values())}_updatePeers(e){for(const{id:t,protocols:r}of e)if(this.multicodecs.filter(n=>r.includes(n)).length){this.peers.add(t.toB58String());const n=this._registrar.getConnection(t);n&&this._onConnect(t,n)}else this.peers.delete(t.toB58String())}_onProtocolChange({peerId:e,protocols:t}){const r=this.peers.has(e.toB58String()),n=t.filter(i=>this.multicodecs.includes(i));r&&n.length===0&&this._onDisconnect(e);for(const i of t)if(this.multicodecs.includes(i)){const a=this._registrar.peerStore.get(e);this._updatePeers([a]);return}}_onPeerConnect(e){const t=e.remotePeer,r=this._registrar.peerStore.protoBook.get(t);if(!r)return;this.multicodecs.find(n=>r.includes(n))&&(this.peers.add(t.toB58String()),this._onConnect(t,e))}}var ER=Pr(_R,{className:"MulticodecTopology",symbolName:"@libp2p/js-interfaces/topology/multicodec-topology"}),SR={ERR_MISSING_SIGNATURE:"ERR_MISSING_SIGNATURE",ERR_INVALID_SIGNATURE:"ERR_INVALID_SIGNATURE"},jl={codes:SR},AR=`
message RPC {
  repeated SubOpts subscriptions = 1;
  repeated Message msgs = 2;

  message SubOpts {
    optional bool subscribe = 1; // subscribe or unsubcribe
    optional string topicID = 2;
  }

  message Message {
    optional bytes from = 1;
    optional bytes data = 2;
    optional bytes seqno = 3;
    repeated string topicIDs = 4;
    optional bytes signature = 5;
    optional bytes key = 6;
  }
}`,TR=`
// topicCID = cid(merkledag_protobuf(topicDescriptor)); (not the topic.name)
message TopicDescriptor {
  optional string name = 1;
  optional AuthOpts auth = 2;
  optional EncOpts enc = 2;

  message AuthOpts {
    optional AuthMode mode = 1;
    repeated bytes keys = 2; // root keys to trust

    enum AuthMode {
      NONE = 0; // no authentication, anyone can publish
      KEY = 1; // only messages signed by keys in the topic descriptor are accepted
      WOT = 2; // web of trust, certificates can allow publisher set to grow
    }
  }

  message EncOpts {
    optional EncMode mode = 1;
    repeated bytes keyHashes = 2; // the hashes of the shared keys used (salted)

    enum EncMode {
      NONE = 0; // no encryption, anyone can read
      SHAREDKEY = 1; // messages are encrypted with shared key
      WOT = 2; // web of trust, certificates can allow publisher set to grow
    }
  }
}`,Cc=re(function(e,t){const r=Nr(AR),n=r.RPC,i=Nr(TR);t=e.exports,t.rpc=r,t.td=i,t.RPC=n,t.Message=n.Message,t.SubOpts=n.SubOpts});const Hm=te("libp2p-pubsub:peer-streams");Hm.error=te("libp2p-pubsub:peer-streams:error");class IR extends At{constructor({id:e,protocol:t}){super();this.id=e,this.protocol=t,this._rawOutboundStream=null,this._rawInboundStream=null,this._inboundAbortController=null,this.outboundStream=null,this.inboundStream=null}get isReadable(){return Boolean(this.inboundStream)}get isWritable(){return Boolean(this.outboundStream)}write(e){if(!this.isWritable){const t=this.id.toB58String();throw new Error("No writable connection to "+t)}this.outboundStream.push(e)}attachInboundStream(e){this._inboundAbortController=new hi,this._rawInboundStream=e,this.inboundStream=vt(bt(this._rawInboundStream,Je.decode()),this._inboundAbortController.signal,{returnOnAbort:!0}),this.emit("stream:inbound")}async attachOutboundStream(e){const t=this.outboundStream;t&&await this.outboundStream.end(!1),this._rawOutboundStream=e,this.outboundStream=bo({onEnd:r=>{this._rawOutboundStream.reset&&this._rawOutboundStream.reset(),this._rawOutboundStream=null,this.outboundStream=null,r!==!1&&this.emit("close")}}),bt(this.outboundStream,Je.encode(),this._rawOutboundStream).catch(r=>{Hm.error(r)}),t||this.emit("stream:outbound")}close(){this.outboundStream&&this.outboundStream.end(),this.inboundStream&&this._inboundAbortController.abort(),this._rawOutboundStream=null,this.outboundStream=null,this._rawInboundStream=null,this.inboundStream=null,this.emit("close")}}var CR=IR,ki=re(function(e,t){t=e.exports,t.randomSeqno=()=>Jl(8),t.msgId=(r,n)=>r+De(n,"base16"),t.anyMatch=(r,n)=>{let i;Array.isArray(n)?i=a=>n.indexOf(a)>-1:i=a=>n.has(a);for(const a of r)if(i(a))return!0;return!1},t.ensureArray=r=>Array.isArray(r)?r:[r],t.normalizeInRpcMessage=(r,n)=>{const i=Object.assign({},r);return r.from instanceof Uint8Array&&(i.from=De(r.from,"base58btc")),n&&(i.receivedFrom=n),i},t.normalizeOutRpcMessage=r=>{const n=Object.assign({},r);return(typeof r.from=="string"||r.from instanceof String)&&(n.from=at(r.from,"base58btc")),(typeof r.data=="string"||r.data instanceof String)&&(n.data=at(r.data)),n}});const{Message:zm}=Cc,Ul=at("libp2p-pubsub:");async function kR(e,t){const r=nr([Ul,zm.encode(t)]),n=await e.privKey.sign(r);return{...t,signature:n,key:e.pubKey.bytes}}async function RR(e){const t={...e};delete t.signature,delete t.key,t.from=we.createFromCID(t.from).toBytes();const r=nr([Ul,zm.encode(t)]),n=await Km(e);return n.verify(r,e.signature)}async function Km(e){const t=we.createFromCID(e.from);if(e.key){const r=await we.createFromPubKey(e.key);if(r.isEqual(t))return r.pubKey;throw new Error("Public Key does not match the originator")}else{if(t.pubKey)return t.pubKey;throw new Error("Could not get the public key from the originator id")}}var PR={messagePublicKey:Km,signMessage:kR,SignPrefix:Ul,verifySignature:RR};const{codes:Wm}=jl,{signMessage:NR,verifySignature:OR}=PR;class DR extends At{constructor({debugName:e,multicodecs:t,libp2p:r,signMessages:n=!0,strictSigning:i=!0,canRelayMessage:a=!1,emitSelf:s=!1}){if(typeof e!="string")throw new Error("a debugname `string` is required");if(!t)throw new Error("multicodecs are required");if(!r)throw new Error("libp2p is required");super();this.log=te(e),this.log.err=te(`${e}:error`),this.multicodecs=ki.ensureArray(t),this._libp2p=r,this.registrar=r.registrar,this.peerId=r.peerId,this.started=!1,this.topics=new Map,this.subscriptions=new Set,this.peers=new Map,this.signMessages=n,this.strictSigning=i,this.canRelayMessage=a,this.emitSelf=s,this.topicValidators=new Map,this._registrarId=void 0,this._onIncomingStream=this._onIncomingStream.bind(this),this._onPeerConnected=this._onPeerConnected.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this)}start(){if(this.started)return;this.log("starting"),this.registrar.handle(this.multicodecs,this._onIncomingStream);const e=new ER({multicodecs:this.multicodecs,handlers:{onConnect:this._onPeerConnected,onDisconnect:this._onPeerDisconnected}});this._registrarId=this.registrar.register(e),this.log("started"),this.started=!0}stop(){if(!this.started)return;this.registrar.unregister(this._registrarId),this.log("stopping"),this.peers.forEach(e=>e.close()),this.peers=new Map,this.subscriptions=new Set,this.started=!1,this.log("stopped")}_onIncomingStream({protocol:e,stream:t,connection:r}){const n=r.remotePeer,i=n.toB58String(),a=this._addPeer(n,e);a.attachInboundStream(t),this._processMessages(i,a.inboundStream,a)}async _onPeerConnected(e,t){const r=e.toB58String();this.log("connected",r);try{const{stream:n,protocol:i}=await t.newStream(this.multicodecs),a=this._addPeer(e,i);await a.attachOutboundStream(n)}catch(n){this.log.err(n)}this._sendSubscriptions(r,Array.from(this.subscriptions),!0)}_onPeerDisconnected(e,t){const r=e.toB58String();this.log("connection ended",r,t?t.message:""),this._removePeer(e)}_addPeer(e,t){const r=e.toB58String(),n=this.peers.get(r);if(n)return n;this.log("new peer",r);const i=new CR({id:e,protocol:t});return this.peers.set(r,i),i.once("close",()=>this._removePeer(e)),i}_removePeer(e){if(!e)return;const t=e.toB58String(),r=this.peers.get(t);if(!r)return;r.removeAllListeners(),r.close(),this.log("delete peer",t),this.peers.delete(t);for(const n of this.topics.values())n.delete(t);return r}async _processMessages(e,t,r){try{await bt(t,async n=>{for await(const i of n){const a=i instanceof Uint8Array?i:i.slice(),s=this._decodeRpc(a);this._processRpc(e,r,s)}})}catch(n){this._onPeerDisconnected(r.id,n)}}_processRpc(e,t,r){this.log("rpc from",e);const n=r.subscriptions,i=r.msgs;return n.length&&(n.forEach(a=>this._processRpcSubOpt(e,a)),this.emit("pubsub:subscription-change",t.id,n)),this._acceptFrom(e)?(i.length&&i.forEach(a=>{if(!(this.canRelayMessage||a.topicIDs.some(c=>this.subscriptions.has(c)))){this.log("received message we didn't subscribe to. Dropping.");return}const s=ki.normalizeInRpcMessage(a,e);this._processRpcMessage(s)}),!0):(this.log("received message from unacceptable peer %s",e),!1)}_processRpcSubOpt(e,t){const r=t.topicID;let n=this.topics.get(r);n||(n=new Set,this.topics.set(r,n)),t.subscribe?n.add(e):n.delete(e)}async _processRpcMessage(e){if(this.peerId.toB58String()===e.from&&!this.emitSelf)return;try{await this.validate(e)}catch(t){this.log("Message is invalid, dropping it. %O",t);return}this._emitMessage(e),this._publish(ki.normalizeOutRpcMessage(e))}_emitMessage(e){e.topicIDs.forEach(t=>{this.subscriptions.has(t)&&this.emit(t,e)})}getMsgId(e){return ki.msgId(e.from,e.seqno)}_acceptFrom(e){return!0}_decodeRpc(e){return Cc.rpc.RPC.decode(e)}_encodeRpc(e){return Cc.rpc.RPC.encode(e)}_sendRpc(e,t){const r=this.peers.get(e);if(!r||!r.isWritable){const n=`Cannot send RPC to ${e} as there is no open stream to it available`;this.log.err(n);return}r.write(this._encodeRpc(t))}_sendSubscriptions(e,t,r){return this._sendRpc(e,{subscriptions:t.map(n=>({topicID:n,subscribe:r}))})}async validate(e){if(this.strictSigning&&!e.signature)throw U(new Error("Signing required and no signature was present"),Wm.ERR_MISSING_SIGNATURE);if(e.signature&&!await OR(e))throw U(new Error("Invalid message signature"),Wm.ERR_INVALID_SIGNATURE);for(const t of e.topicIDs){const r=this.topicValidators.get(t);if(!r)continue;await r(t,e)}}_buildMessage(e){const t=ki.normalizeOutRpcMessage(e);return this.signMessages?NR(this.peerId,t):e}getSubscribers(e){if(!this.started)throw U(new Error("not started yet"),"ERR_NOT_STARTED_YET");if(!e||typeof e!="string")throw U(new Error("a string topic must be provided"),"ERR_NOT_VALID_TOPIC");const t=this.topics.get(e);return t?Array.from(t):[]}async publish(e,t){if(!this.started)throw new Error("Pubsub has not started");this.log("publish",e,t);const r=this.peerId.toB58String();let n={receivedFrom:r,from:r,data:t,seqno:ki.randomSeqno(),topicIDs:[e]};const i=await this._buildMessage(n);n=ki.normalizeInRpcMessage(i),this.emitSelf&&this._emitMessage(n),await this._publish(n)}_publish(e){throw U(new Error("publish must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}subscribe(e){if(!this.started)throw new Error("Pubsub has not started");this.subscriptions.has(e)||(this.subscriptions.add(e),this.peers.forEach((t,r)=>this._sendSubscriptions(r,[e],!0)))}unsubscribe(e){if(!this.started)throw new Error("Pubsub is not started");this.subscriptions.has(e)&&this.listenerCount(e)===0&&(this.subscriptions.delete(e),this.peers.forEach((t,r)=>this._sendSubscriptions(r,[e],!1)))}getTopics(){if(!this.started)throw new Error("Pubsub is not started");return Array.from(this.subscriptions)}}var Fl=DR,MR=Cc,xR=ki;Fl.message=MR,Fl.utils=xR;var BR=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MessageCache=void 0;class r{constructor(n,i,a){this.msgs=new Map,this.peertx=new Map,this.history=[];for(let s=0;s<i;s++)this.history[s]=[];this.gossip=n,this.msgIdFn=a}put(n){const i=this.getMsgId(n);this.msgs.set(i,n),this.history[0].push({msgID:i,topics:n.topicIDs})}getMsgId(n){return this.msgIdFn(n)}get(n){return this.msgs.get(n)}getForPeer(n,i){const a=this.msgs.get(n);if(!a)return[void 0,0];let s=this.peertx.get(n);s||(s=new Map,this.peertx.set(n,s));const c=(s.get(i)||0)+1;return s.set(i,c),[a,c]}getGossipIDs(n){const i=[];for(let a=0;a<this.gossip;a++)this.history[a].forEach(s=>{for(const c of s.topics)if(c===n){i.push(s.msgID);break}});return i}shift(){const n=this.history[this.history.length-1];n.forEach(i=>{this.msgs.delete(i.msgID),this.peertx.delete(i.msgID)}),this.history.pop(),this.history.unshift([])}}t.MessageCache=r}),LR=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=`
message RPC {
  repeated SubOpts subscriptions = 1;
  repeated Message msgs = 2;
  optional ControlMessage control = 3;

  message SubOpts {
    optional bool subscribe = 1; // subscribe or unsubcribe
    optional string topicID = 2;
  }

  message Message {
    optional bytes from = 1;
    optional bytes data = 2;
    optional bytes seqno = 3;
    repeated string topicIDs = 4; 
    optional bytes signature = 5;
    optional bytes key = 6;
  }

  message ControlMessage {
    repeated ControlIHave ihave = 1;
    repeated ControlIWant iwant = 2;
    repeated ControlGraft graft = 3;
    repeated ControlPrune prune = 4;
  }

  message ControlIHave {
    optional string topicID = 1;
    repeated string messageIDs = 2;
  }

  message ControlIWant {
    repeated string messageIDs = 1;  
  }

  message ControlGraft {
    optional string topicID = 1;
  }

  message ControlPrune {
    optional string topicID = 1;
    repeated PeerInfo peers = 2;
    optional uint64 backoff = 3;
  }

  message PeerInfo {
    optional bytes peerID = 1;
    optional bytes signedPeerRecord = 2;
  }
}`}),ql=re(function(e,t){var r=ge&&ge.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(t,"__esModule",{value:!0}),t.RPCCodec=void 0;const n=r(LR),i=Nr(n.default);t.RPCCodec=i.RPC}),na=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ERR_TOPIC_VALIDATOR_IGNORE=t.ERR_TOPIC_VALIDATOR_REJECT=t.TimeCacheDuration=t.GossipsubIWantFollowupTime=t.GossipsubMaxIHaveMessages=t.GossipsubMaxIHaveLength=t.GossipsubGraftFloodThreshold=t.GossipsubOpportunisticGraftPeers=t.GossipsubOpportunisticGraftTicks=t.GossipsubDirectConnectInitialDelay=t.GossipsubDirectConnectTicks=t.GossipsubConnectionTimeout=t.GossipsubMaxPendingConnections=t.GossipsubConnectors=t.GossipsubPruneBackoffTicks=t.GossipsubPruneBackoff=t.GossipsubPrunePeers=t.GossipsubFanoutTTL=t.GossipsubHeartbeatInterval=t.GossipsubHeartbeatInitialDelay=t.GossipsubGossipRetransmission=t.GossipsubGossipFactor=t.GossipsubDlazy=t.GossipsubHistoryGossip=t.GossipsubHistoryLength=t.GossipsubDout=t.GossipsubDscore=t.GossipsubDhi=t.GossipsubDlo=t.GossipsubD=t.GossipsubIDv11=t.GossipsubIDv10=t.FloodsubID=t.minute=t.second=void 0,t.second=1e3,t.minute=60*t.second,t.FloodsubID="/floodsub/1.0.0",t.GossipsubIDv10="/meshsub/1.0.0",t.GossipsubIDv11="/meshsub/1.1.0",t.GossipsubD=6,t.GossipsubDlo=4,t.GossipsubDhi=12,t.GossipsubDscore=4,t.GossipsubDout=2,t.GossipsubHistoryLength=5,t.GossipsubHistoryGossip=3,t.GossipsubDlazy=6,t.GossipsubGossipFactor=.25,t.GossipsubGossipRetransmission=3,t.GossipsubHeartbeatInitialDelay=100,t.GossipsubHeartbeatInterval=t.second,t.GossipsubFanoutTTL=t.minute,t.GossipsubPrunePeers=16,t.GossipsubPruneBackoff=t.minute,t.GossipsubPruneBackoffTicks=15,t.GossipsubConnectors=8,t.GossipsubMaxPendingConnections=128,t.GossipsubConnectionTimeout=30*t.second,t.GossipsubDirectConnectTicks=300,t.GossipsubDirectConnectInitialDelay=t.second,t.GossipsubOpportunisticGraftTicks=60,t.GossipsubOpportunisticGraftPeers=2,t.GossipsubGraftFloodThreshold=10*t.second,t.GossipsubMaxIHaveLength=5e3,t.GossipsubMaxIHaveMessages=10,t.GossipsubIWantFollowupTime=3*t.second,t.TimeCacheDuration=120*1e3,t.ERR_TOPIC_VALIDATOR_REJECT="ERR_TOPIC_VALIDATOR_REJECT",t.ERR_TOPIC_VALIDATOR_IGNORE="ERR_TOPIC_VALIDATOR_IGNORE"}),jR=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createGossipRpc=void 0;function r(n=[],i={}){return{subscriptions:[],msgs:n,control:Object.assign({ihave:[],iwant:[],graft:[],prune:[]},i)}}t.createGossipRpc=r}),UR=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.shuffle=void 0;function r(n){if(n.length<=1)return n;const i=()=>Math.floor(Math.random()*Math.floor(n.length));for(let a=0;a<n.length;a++){const s=i(),c=n[a];n[a]=n[s],n[s]=c}return n}t.shuffle=r}),FR=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.hasGossipProtocol=void 0;function r(n){return n===na.GossipsubIDv10||n===na.GossipsubIDv11}t.hasGossipProtocol=r}),Bt=re(function(e,t){var r=ge&&ge.__createBinding||(Object.create?function(i,a,s,c){c===void 0&&(c=s),Object.defineProperty(i,c,{enumerable:!0,get:function(){return a[s]}})}:function(i,a,s,c){c===void 0&&(c=s),i[c]=a[s]}),n=ge&&ge.__exportStar||function(i,a){for(var s in i)s!=="default"&&!a.hasOwnProperty(s)&&r(a,i,s)};Object.defineProperty(t,"__esModule",{value:!0}),n(jR,t),n(UR,t),n(FR,t)}),Ri=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getGossipPeers=void 0;function r(n,i,a,s=()=>!0){const c=n.topics.get(i);if(!c)return new Set;let o=[];return c.forEach(u=>{const l=n.peers.get(u);if(!l)return;Bt.hasGossipProtocol(l.protocol)&&s(u)&&o.push(u)}),o=Bt.shuffle(o),a>0&&o.length>a&&(o=o.slice(0,a)),new Set(o)}t.getGossipPeers=r}),qR=re(function(e,t){var r=ge&&ge.__createBinding||(Object.create?function(c,o,u,l){l===void 0&&(l=u),Object.defineProperty(c,l,{enumerable:!0,get:function(){return o[u]}})}:function(c,o,u,l){l===void 0&&(l=u),c[l]=o[u]}),n=ge&&ge.__setModuleDefault||(Object.create?function(c,o){Object.defineProperty(c,"default",{enumerable:!0,value:o})}:function(c,o){c.default=o}),i=ge&&ge.__importStar||function(c){if(c&&c.__esModule)return c;var o={};if(c!=null)for(var u in c)u!=="default"&&Object.hasOwnProperty.call(c,u)&&r(o,c,u);return n(o,c),o};Object.defineProperty(t,"__esModule",{value:!0}),t.Heartbeat=void 0;const a=i(na);class s{constructor(c){this.gossipsub=c}start(){if(this._heartbeatTimer)return;const c=this._heartbeat.bind(this),o=setTimeout(()=>{c(),this._heartbeatTimer.runPeriodically(c,a.GossipsubHeartbeatInterval)},a.GossipsubHeartbeatInitialDelay);this._heartbeatTimer={_intervalId:void 0,runPeriodically:(u,l)=>{this._heartbeatTimer._intervalId=setInterval(u,l)},cancel:()=>{clearTimeout(o),clearInterval(this._heartbeatTimer._intervalId)}}}stop(){if(!this._heartbeatTimer)return;this._heartbeatTimer.cancel(),this._heartbeatTimer=null}_heartbeat(){const{D:c,Dlo:o,Dhi:u,Dscore:l,Dout:h}=this.gossipsub._options;this.gossipsub.heartbeatTicks++;const w=new Map,f=O=>{let R=w.get(O);return R===void 0&&(R=this.gossipsub.score.score(O),w.set(O,R)),R},A=new Map,p=new Map,y=new Map;this.gossipsub._clearBackoff(),this.gossipsub.peerhave.clear(),this.gossipsub.iasked.clear(),this.gossipsub._applyIwantPenalties(),this.gossipsub._directConnect(),this.gossipsub.mesh.forEach((O,R)=>{const m=S=>{this.gossipsub.log("HEARTBEAT: Remove mesh link to %s in %s",S,R),this.gossipsub.score.prune(S,R),this.gossipsub._addBackoff(S,R),O.delete(S);const d=p.get(S);d?d.push(R):p.set(S,[R])},g=S=>{this.gossipsub.log("HEARTBEAT: Add mesh link to %s in %s",S,R),this.gossipsub.score.graft(S,R),O.add(S);const d=A.get(S);d?d.push(R):A.set(S,[R])};if(O.forEach(S=>{const d=f(S);d<0&&(this.gossipsub.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",S,d,R),m(S),y.set(S,!0))}),O.size<o){const S=this.gossipsub.backoff.get(R),d=c-O.size,b=Ri.getGossipPeers(this.gossipsub,R,d,E=>!O.has(E)&&!this.gossipsub.direct.has(E)&&(!S||!S.has(E))&&f(E)>=0);b.forEach(g)}if(O.size>u){let S=Array.from(O);S.sort((b,E)=>f(E)-f(b)),S=S.slice(0,l).concat(Bt.shuffle(S.slice(l)));let d=0;if(S.slice(0,c).forEach(b=>{this.gossipsub.outbound.get(b)&&d++}),d<h){const b=_=>{const P=S[_];for(let M=_;M>0;M--)S[M]=S[M-1];S[0]=P};if(d>0){let _=d;for(let P=1;P<c&&_>0;P++)this.gossipsub.outbound.get(S[P])&&(b(P),_--)}let E=c-d;for(let _=c;_<S.length&&E>0;_++)this.gossipsub.outbound.get(S[_])&&(b(_),E--)}S.slice(c).forEach(m)}if(O.size>=o){let S=0;if(O.forEach(d=>{this.gossipsub.outbound.get(d)&&S++}),S<h){const d=h-S,b=this.gossipsub.backoff.get(R);Ri.getGossipPeers(this.gossipsub,R,d,E=>!O.has(E)&&!this.gossipsub.direct.has(E)&&(!b||!b.has(E))&&f(E)>=0).forEach(g)}}if(this.gossipsub.heartbeatTicks%a.GossipsubOpportunisticGraftTicks===0&&O.size>1){const S=Array.from(O).sort((E,_)=>f(E)-f(_)),d=O.size/2,b=f(S[d]);if(b<this.gossipsub._options.scoreThresholds.opportunisticGraftThreshold){const E=this.gossipsub.backoff.get(R),_=Ri.getGossipPeers(this.gossipsub,R,a.GossipsubOpportunisticGraftPeers,P=>O.has(P)&&!this.gossipsub.direct.has(P)&&(!E||!E.has(P))&&f(P)>b);_.forEach(P=>{this.gossipsub.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",P,R),g(P)})}}this.gossipsub._emitGossip(R,O)});const v=this.gossipsub._now();this.gossipsub.lastpub.forEach((O,R)=>{O+a.GossipsubFanoutTTL<v&&(this.gossipsub.fanout.delete(R),this.gossipsub.lastpub.delete(R))}),this.gossipsub.fanout.forEach((O,R)=>{const m=this.gossipsub.topics.get(R);if(O.forEach(g=>{(!m.has(g)||f(g)<this.gossipsub._options.scoreThresholds.publishThreshold)&&O.delete(g)}),O.size<c){const g=c-O.size,S=Ri.getGossipPeers(this.gossipsub,R,g,d=>!O.has(d)&&!this.gossipsub.direct.has(d)&&f(d)>=this.gossipsub._options.scoreThresholds.publishThreshold);S.forEach(d=>{O.add(d)})}this.gossipsub._emitGossip(R,O)}),this.gossipsub._sendGraftPrune(A,p,y),this.gossipsub._flush(),this.gossipsub.messageCache.shift(),this.gossipsub.emit("gossipsub:heartbeat")}}t.Heartbeat=s}),Ue=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ERR_INVALID_PEER_SCORE_THRESHOLDS=t.ERR_INVALID_PEER_SCORE_PARAMS=void 0,t.ERR_INVALID_PEER_SCORE_PARAMS="ERR_INVALID_PEER_SCORE_PARAMS",t.ERR_INVALID_PEER_SCORE_THRESHOLDS="ERR_INVALID_PEER_SCORE_THRESHOLDS"}),Xm=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validateTopicScoreParams=t.validatePeerScoreParams=t.createTopicScoreParams=t.createPeerScoreParams=t.defaultTopicScoreParams=t.defaultPeerScoreParams=void 0,t.defaultPeerScoreParams={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},t.defaultTopicScoreParams={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function r(s={}){return Object.assign(Object.assign(Object.assign({},t.defaultPeerScoreParams),s),{topics:s.topics?Object.entries(s.topics).reduce((c,[o,u])=>(c[o]=n(u),c),{}):{}})}t.createPeerScoreParams=r;function n(s={}){return Object.assign(Object.assign({},t.defaultTopicScoreParams),s)}t.createTopicScoreParams=n;function i(s){for(const[c,o]of Object.entries(s.topics))try{a(o)}catch(u){throw U(new Error(`invalid score parameters for topic ${c}: ${u.message}`),Ue.ERR_INVALID_PEER_SCORE_PARAMS)}if(s.topicScoreCap<0)throw U(new Error("invalid topic score cap; must be positive (or 0 for no cap)"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.appSpecificScore===null||s.appSpecificScore===void 0)throw U(new Error("missing application specific score function"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.IPColocationFactorWeight>0)throw U(new Error("invalid IPColocationFactorWeight; must be negative (or 0 to disable)"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.IPColocationFactorWeight!==0&&s.IPColocationFactorThreshold<1)throw U(new Error("invalid IPColocationFactorThreshold; must be at least 1"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.behaviourPenaltyWeight>0)throw U(new Error("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.behaviourPenaltyWeight!==0&&(s.behaviourPenaltyDecay<=0||s.behaviourPenaltyDecay>=1))throw U(new Error("invalid BehaviourPenaltyDecay; must be between 0 and 1"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.decayInterval<1e3)throw U(new Error("invalid DecayInterval; must be at least 1s"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.decayToZero<=0||s.decayToZero>=1)throw U(new Error("invalid DecayToZero; must be between 0 and 1"),Ue.ERR_INVALID_PEER_SCORE_PARAMS)}t.validatePeerScoreParams=i;function a(s){if(s.topicWeight<0)throw U(new Error("invalid topic weight; must be >= 0"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.timeInMeshQuantum===0)throw U(new Error("invalid TimeInMeshQuantum; must be non zero"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.timeInMeshWeight<0)throw U(new Error("invalid TimeInMeshWeight; must be positive (or 0 to disable)"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.timeInMeshWeight!==0&&s.timeInMeshQuantum<=0)throw U(new Error("invalid TimeInMeshQuantum; must be positive"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.timeInMeshWeight!==0&&s.timeInMeshCap<=0)throw U(new Error("invalid TimeInMeshCap; must be positive"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.firstMessageDeliveriesWeight<0)throw U(new Error("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.firstMessageDeliveriesWeight!==0&&(s.firstMessageDeliveriesDecay<=0||s.firstMessageDeliveriesDecay>=1))throw U(new Error("invalid FirstMessageDeliveriesDecay; must be between 0 and 1"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.firstMessageDeliveriesWeight!==0&&s.firstMessageDeliveriesCap<=0)throw U(new Error("invalid FirstMessageDeliveriesCap; must be positive"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.meshMessageDeliveriesWeight>0)throw U(new Error("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.meshMessageDeliveriesWeight!==0&&(s.meshMessageDeliveriesDecay<=0||s.meshMessageDeliveriesDecay>=1))throw U(new Error("invalid MeshMessageDeliveriesDecay; must be between 0 and 1"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.meshMessageDeliveriesWeight!==0&&s.meshMessageDeliveriesCap<=0)throw U(new Error("invalid MeshMessageDeliveriesCap; must be positive"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.meshMessageDeliveriesWeight!==0&&s.meshMessageDeliveriesThreshold<=0)throw U(new Error("invalid MeshMessageDeliveriesThreshold; must be positive"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.meshMessageDeliveriesWindow<0)throw U(new Error("invalid MeshMessageDeliveriesWindow; must be non-negative"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.meshMessageDeliveriesWeight!==0&&s.meshMessageDeliveriesActivation<1e3)throw U(new Error("invalid MeshMessageDeliveriesActivation; must be at least 1s"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.meshFailurePenaltyWeight>0)throw U(new Error("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.meshFailurePenaltyWeight!==0&&(s.meshFailurePenaltyDecay<=0||s.meshFailurePenaltyDecay>=1))throw U(new Error("invalid MeshFailurePenaltyDecay; must be between 0 and 1"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.invalidMessageDeliveriesWeight>0)throw U(new Error("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)"),Ue.ERR_INVALID_PEER_SCORE_PARAMS);if(s.invalidMessageDeliveriesDecay<=0||s.invalidMessageDeliveriesDecay>=1)throw U(new Error("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1"),Ue.ERR_INVALID_PEER_SCORE_PARAMS)}t.validateTopicScoreParams=a}),GR=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validatePeerScoreThresholds=t.createPeerScoreThresholds=t.defaultPeerScoreThresholds=void 0,t.defaultPeerScoreThresholds={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function r(i={}){return Object.assign(Object.assign({},t.defaultPeerScoreThresholds),i)}t.createPeerScoreThresholds=r;function n(i){if(i.gossipThreshold>0)throw U(new Error("invalid gossip threshold; it must be <= 0"),Ue.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.publishThreshold>0||i.publishThreshold>i.gossipThreshold)throw U(new Error("invalid publish threshold; it must be <= 0 and <= gossip threshold"),Ue.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.graylistThreshold>0||i.graylistThreshold>i.publishThreshold)throw U(new Error("invalid graylist threshold; it must be <= 0 and <= publish threshold"),Ue.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.acceptPXThreshold<0)throw U(new Error("invalid accept PX threshold; it must be >= 0"),Ue.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.opportunisticGraftThreshold<0)throw U(new Error("invalid opportunistic grafting threshold; it must be >= 0"),Ue.ERR_INVALID_PEER_SCORE_THRESHOLDS)}t.validatePeerScoreThresholds=n}),Xa=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ensureTopicStats=t.createTopicStats=t.createPeerStats=void 0;function r(a={}){return Object.assign(Object.assign({connected:!1,expire:0,ips:[],behaviourPenalty:0},a),{topics:a.topics?Object.entries(a.topics).reduce((s,[c,o])=>(s[c]=n(o),s),{}):{}})}t.createPeerStats=r;function n(a={}){return Object.assign({inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},a)}t.createTopicStats=n;function i(a,s,c){let o=s.topics[a];return o||(c.topics[a]?(s.topics[a]=o=n(),o):void 0)}t.ensureTopicStats=i}),$R=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.computeScore=void 0;function r(n,i,a,s){let c=0;Object.entries(i.topics).forEach(([l,h])=>{const w=a.topics[l];if(!w)return;let f=0;if(h.inMesh){let v=h.meshTime/w.timeInMeshQuantum;v>w.timeInMeshCap&&(v=w.timeInMeshCap),f+=v*w.timeInMeshWeight}const A=h.firstMessageDeliveries;if(f+=A*w.firstMessageDeliveriesWeight,h.meshMessageDeliveriesActive&&h.meshMessageDeliveries<w.meshMessageDeliveriesThreshold){const v=w.meshMessageDeliveriesThreshold-h.meshMessageDeliveries,O=v*v;f+=O*w.meshMessageDeliveriesWeight}const p=h.meshFailurePenalty;f+=p*w.meshFailurePenaltyWeight;const y=h.invalidMessageDeliveries*h.invalidMessageDeliveries;f+=y*w.invalidMessageDeliveriesWeight,c+=f*w.topicWeight}),a.topicScoreCap>0&&c>a.topicScoreCap&&(c=a.topicScoreCap);const o=a.appSpecificScore(n);c+=o*a.appSpecificWeight,i.ips.forEach(l=>{if(a.IPColocationFactorWhitelist.has(l))return;const h=s.get(l),w=h?h.size:0;if(w>a.IPColocationFactorThreshold){const f=w-a.IPColocationFactorThreshold,A=f*f;c+=A*a.IPColocationFactorWeight}});const u=i.behaviourPenalty*i.behaviourPenalty;return c+=u*a.behaviourPenaltyWeight,c}t.computeScore=r});function nt(e){this._head=0,this._tail=0,this._capacityMask=3,this._list=new Array(4),Array.isArray(e)&&this._fromArray(e)}nt.prototype.peekAt=function(t){var r=t;if(r!==(r|0))return;var n=this.size();return r>=n||r<-n?void 0:(r<0&&(r+=n),r=this._head+r&this._capacityMask,this._list[r])},nt.prototype.get=function(t){return this.peekAt(t)},nt.prototype.peek=function(){return this._head===this._tail?void 0:this._list[this._head]},nt.prototype.peekFront=function(){return this.peek()},nt.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(nt.prototype,"length",{get:function(){return this.size()}}),nt.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},nt.prototype.unshift=function(t){if(t===void 0)return this.size();var r=this._list.length;return this._head=this._head-1+r&this._capacityMask,this._list[this._head]=t,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},nt.prototype.shift=function(){var t=this._head;if(t===this._tail)return;var r=this._list[t];return this._list[t]=void 0,this._head=t+1&this._capacityMask,t<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),r},nt.prototype.push=function(t){if(t===void 0)return this.size();var r=this._tail;return this._list[r]=t,this._tail=r+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},nt.prototype.pop=function(){var t=this._tail;if(t===this._head)return;var r=this._list.length;this._tail=t-1+r&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&t>1e4&&t<=r>>>2&&this._shrinkArray(),n},nt.prototype.removeOne=function(t){var r=t;if(r!==(r|0))return;if(this._head===this._tail)return;var n=this.size(),i=this._list.length;if(r>=n||r<-n)return;r<0&&(r+=n),r=this._head+r&this._capacityMask;var a=this._list[r],s;if(t<n/2){for(s=t;s>0;s--)this._list[r]=this._list[r=r-1+i&this._capacityMask];this._list[r]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(s=n-1-t;s>0;s--)this._list[r]=this._list[r=r+1+i&this._capacityMask];this._list[r]=void 0,this._tail=this._tail-1+i&this._capacityMask}return a},nt.prototype.remove=function(t,r){var n=t,i,a=r;if(n!==(n|0))return;if(this._head===this._tail)return;var s=this.size(),c=this._list.length;if(n>=s||n<-s||r<1)return;if(n<0&&(n+=s),r===1||!r)return i=new Array(1),i[0]=this.removeOne(n),i;if(n===0&&n+r>=s)return i=this.toArray(),this.clear(),i;n+r>s&&(r=s-n);var o;for(i=new Array(r),o=0;o<r;o++)i[o]=this._list[this._head+n+o&this._capacityMask];if(n=this._head+n&this._capacityMask,t+r===s){for(this._tail=this._tail-r+c&this._capacityMask,o=r;o>0;o--)this._list[n=n+1+c&this._capacityMask]=void 0;return i}if(t===0){for(this._head=this._head+r+c&this._capacityMask,o=r-1;o>0;o--)this._list[n=n+1+c&this._capacityMask]=void 0;return i}if(n<s/2){for(this._head=this._head+t+r+c&this._capacityMask,o=t;o>0;o--)this.unshift(this._list[n=n-1+c&this._capacityMask]);for(n=this._head-1+c&this._capacityMask;a>0;)this._list[n=n-1+c&this._capacityMask]=void 0,a--;t<0&&(this._tail=n)}else{for(this._tail=n,n=n+r+c&this._capacityMask,o=s-(r+t);o>0;o--)this.push(this._list[n++]);for(n=this._tail;a>0;)this._list[n=n+1+c&this._capacityMask]=void 0,a--}return this._head<2&&this._tail>1e4&&this._tail<=c>>>2&&this._shrinkArray(),i},nt.prototype.splice=function(t,r){var n=t;if(n!==(n|0))return;var i=this.size();if(n<0&&(n+=i),n>i)return;if(arguments.length>2){var a,s,c,o=arguments.length,u=this._list.length,l=2;if(!i||n<i/2){for(s=new Array(n),a=0;a<n;a++)s[a]=this._list[this._head+a&this._capacityMask];for(r===0?(c=[],n>0&&(this._head=this._head+n+u&this._capacityMask)):(c=this.remove(n,r),this._head=this._head+n+u&this._capacityMask);o>l;)this.unshift(arguments[--o]);for(a=n;a>0;a--)this.unshift(s[a-1])}else{s=new Array(i-(n+r));var h=s.length;for(a=0;a<h;a++)s[a]=this._list[this._head+n+r+a&this._capacityMask];for(r===0?(c=[],n!=i&&(this._tail=this._head+n+u&this._capacityMask)):(c=this.remove(n,r),this._tail=this._tail-h+u&this._capacityMask);l<o;)this.push(arguments[l++]);for(a=0;a<h;a++)this.push(s[a])}return c}else return this.remove(n,r)},nt.prototype.clear=function(){this._head=0,this._tail=0},nt.prototype.isEmpty=function(){return this._head===this._tail},nt.prototype.toArray=function(){return this._copyArray(!1)},nt.prototype._fromArray=function(t){for(var r=0;r<t.length;r++)this.push(t[r])},nt.prototype._copyArray=function(t){var r=[],n=this._list,i=n.length,a;if(t||this._head>this._tail){for(a=this._head;a<i;a++)r.push(n[a]);for(a=0;a<this._tail;a++)r.push(n[a])}else for(a=this._head;a<this._tail;a++)r.push(n[a]);return r},nt.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length*=2,this._capacityMask=this._capacityMask<<1|1},nt.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};var VR=nt,on=re(function(e,t){var r=ge&&ge.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageDeliveries=t.DeliveryRecordStatus=void 0;const n=r(VR);var i;(function(s){s[s.unknown=0]="unknown",s[s.valid=1]="valid",s[s.invalid=2]="invalid",s[s.ignored=3]="ignored"})(i=t.DeliveryRecordStatus||(t.DeliveryRecordStatus={}));class a{constructor(){this.records=new Map,this.queue=new n.default}ensureRecord(s){let c=this.records.get(s);if(c)return c;c={status:i.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(s,c);const o={msgId:s,expire:Date.now()+na.TimeCacheDuration};return this.queue.push(o),c}gc(){const s=Date.now();let c=this.queue.peekFront();for(;c&&c.expire<s;)this.records.delete(c.msgId),this.queue.shift(),c=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}t.MessageDeliveries=a}),HR=re(function(e,t){var r=ge&&ge.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0}),t.PeerScore=void 0;const n=r(we),{ERR_INVALID_SIGNATURE:i,ERR_MISSING_SIGNATURE:a}=jl.codes,s=te("libp2p:gossipsub:score");class c{constructor(o,u,l){Xm.validatePeerScoreParams(o),this.params=o,this._connectionManager=u,this.peerStats=new Map,this.peerIPs=new Map,this.deliveryRecords=new on.MessageDeliveries,this.msgId=l}start(){if(this._backgroundInterval){s("Peer score already running");return}this._backgroundInterval=setInterval(()=>this.background(),this.params.decayInterval),s("started")}stop(){if(!this._backgroundInterval){s("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),s("stopped")}background(){this._refreshScores(),this._updateIPs(),this.deliveryRecords.gc()}_refreshScores(){const o=Date.now(),u=this.params.decayToZero;this.peerStats.forEach((l,h)=>{if(!l.connected){o>l.expire&&(this._removeIPs(h,l.ips),this.peerStats.delete(h));return}Object.entries(l.topics).forEach(([w,f])=>{const A=this.params.topics[w];if(!A)return;f.firstMessageDeliveries*=A.firstMessageDeliveriesDecay,f.firstMessageDeliveries<u&&(f.firstMessageDeliveries=0),f.meshMessageDeliveries*=A.meshMessageDeliveriesDecay,f.meshMessageDeliveries<u&&(f.meshMessageDeliveries=0),f.meshFailurePenalty*=A.meshFailurePenaltyDecay,f.meshFailurePenalty<u&&(f.meshFailurePenalty=0),f.invalidMessageDeliveries*=A.invalidMessageDeliveriesDecay,f.invalidMessageDeliveries<u&&(f.invalidMessageDeliveries=0),f.inMesh&&(f.meshTime=o-f.graftTime,f.meshTime>A.meshMessageDeliveriesActivation&&(f.meshMessageDeliveriesActive=!0))}),l.behaviourPenalty*=this.params.behaviourPenaltyDecay,l.behaviourPenalty<u&&(l.behaviourPenalty=0)})}score(o){const u=this.peerStats.get(o);return u?$R.computeScore(o,u,this.params,this.peerIPs):0}addPenalty(o,u){const l=this.peerStats.get(o);if(!l)return;l.behaviourPenalty+=u}addPeer(o){const u=Xa.createPeerStats({connected:!0});this.peerStats.set(o,u);const l=this._getIPs(o);this._setIPs(o,l,u.ips),u.ips=l}removePeer(o){const u=this.peerStats.get(o);if(!u)return;if(this.score(o)>0){this._removeIPs(o,u.ips),this.peerStats.delete(o);return}Object.entries(u.topics).forEach(([l,h])=>{h.firstMessageDeliveries=0;const w=this.params.topics[l].meshMessageDeliveriesThreshold;if(h.inMesh&&h.meshMessageDeliveriesActive&&h.meshMessageDeliveries<w){const f=w-h.meshMessageDeliveries;h.meshFailurePenalty+=f*f}h.inMesh=!1}),u.connected=!1,u.expire=Date.now()+this.params.retainScore}graft(o,u){const l=this.peerStats.get(o);if(!l)return;const h=Xa.ensureTopicStats(u,l,this.params);if(!h)return;h.inMesh=!0,h.graftTime=Date.now(),h.meshTime=0,h.meshMessageDeliveriesActive=!1}prune(o,u){const l=this.peerStats.get(o);if(!l)return;const h=Xa.ensureTopicStats(u,l,this.params);if(!h)return;const w=this.params.topics[u].meshMessageDeliveriesThreshold;if(h.meshMessageDeliveriesActive&&h.meshMessageDeliveries<w){const f=w-h.meshMessageDeliveries;h.meshFailurePenalty+=f*f}h.inMesh=!1}validateMessage(o){this.deliveryRecords.ensureRecord(this.msgId(o))}deliverMessage(o){const u=o.receivedFrom;this._markFirstMessageDelivery(u,o);const l=this.deliveryRecords.ensureRecord(this.msgId(o)),h=Date.now();if(l.status!==on.DeliveryRecordStatus.unknown){s("unexpected delivery: message from %s was first seen %s ago and has delivery status %d",u,h-l.firstSeen,on.DeliveryRecordStatus[l.status]);return}l.status=on.DeliveryRecordStatus.valid,l.validated=h,l.peers.forEach(w=>{w!==u&&this._markDuplicateMessageDelivery(w,o)})}rejectMessage(o,u){const l=o.receivedFrom;switch(u){case a:case i:this._markInvalidMessageDelivery(l,o);return}const h=this.deliveryRecords.ensureRecord(this.msgId(o));if(h.status!==on.DeliveryRecordStatus.unknown){s("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",l,Date.now()-h.firstSeen,on.DeliveryRecordStatus[h.status]);return}switch(u){case na.ERR_TOPIC_VALIDATOR_IGNORE:h.status=on.DeliveryRecordStatus.ignored;return}h.status=on.DeliveryRecordStatus.invalid,this._markInvalidMessageDelivery(l,o),h.peers.forEach(w=>{this._markInvalidMessageDelivery(w,o)})}duplicateMessage(o){const u=o.receivedFrom,l=this.deliveryRecords.ensureRecord(this.msgId(o));if(l.peers.has(u))return;switch(l.status){case on.DeliveryRecordStatus.unknown:l.peers.add(u);break;case on.DeliveryRecordStatus.valid:l.peers.add(u),this._markDuplicateMessageDelivery(u,o,l.validated);break;case on.DeliveryRecordStatus.invalid:this._markInvalidMessageDelivery(u,o);break}}_markInvalidMessageDelivery(o,u){const l=this.peerStats.get(o);if(!l)return;u.topicIDs.forEach(h=>{const w=Xa.ensureTopicStats(h,l,this.params);if(!w)return;w.invalidMessageDeliveries+=1})}_markFirstMessageDelivery(o,u){const l=this.peerStats.get(o);if(!l)return;u.topicIDs.forEach(h=>{const w=Xa.ensureTopicStats(h,l,this.params);if(!w)return;let f=this.params.topics[h].firstMessageDeliveriesCap;if(w.firstMessageDeliveries+=1,w.firstMessageDeliveries>f&&(w.firstMessageDeliveries=f),!w.inMesh)return;f=this.params.topics[h].meshMessageDeliveriesCap,w.meshMessageDeliveries+=1,w.meshMessageDeliveries>f&&(w.meshMessageDeliveries=f)})}_markDuplicateMessageDelivery(o,u,l=0){const h=this.peerStats.get(o);if(!h)return;const w=l?Date.now():0;u.topicIDs.forEach(f=>{const A=Xa.ensureTopicStats(f,h,this.params);if(!A)return;if(!A.inMesh)return;const p=this.params.topics[f];if(l&&w>l+p.meshMessageDeliveriesWindow)return;const y=p.meshMessageDeliveriesCap;A.meshMessageDeliveries+=1,A.meshMessageDeliveries>y&&(A.meshMessageDeliveries=y)})}_getIPs(o){return this._connectionManager.getAll(n.default.createFromB58String(o)).map(u=>u.remoteAddr.toOptions().host)}_setIPs(o,u,l){e:for(const h of u){for(const f of l)if(h===f)continue e;let w=this.peerIPs.get(h);w||(w=new Set,this.peerIPs.set(h,w)),w.add(o)}e:for(const h of l){for(const f of u)if(h===f)continue e;const w=this.peerIPs.get(h);if(!w)continue;w.delete(o),w.size||this.peerIPs.delete(h)}}_removeIPs(o,u){u.forEach(l=>{const h=this.peerIPs.get(l);if(!h)return;h.delete(o),h.size||this.peerIPs.delete(l)})}_updateIPs(){this.peerStats.forEach((o,u)=>{const l=this._getIPs(u);this._setIPs(u,l,o.ips),o.ips=l})}}t.PeerScore=c}),Gl=re(function(e,t){var r=ge&&ge.__createBinding||(Object.create?function(i,a,s,c){c===void 0&&(c=s),Object.defineProperty(i,c,{enumerable:!0,get:function(){return a[s]}})}:function(i,a,s,c){c===void 0&&(c=s),i[c]=a[s]}),n=ge&&ge.__exportStar||function(i,a){for(var s in i)s!=="default"&&!a.hasOwnProperty(s)&&r(a,i,s)};Object.defineProperty(t,"__esModule",{value:!0}),n(Xm,t),n(GR,t),n(HR,t)}),zR=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.IWantTracer=void 0;const{ERR_INVALID_SIGNATURE:r,ERR_MISSING_SIGNATURE:n}=jl.codes;class i{constructor(a){this.getMsgId=a,this.promises=new Map}addPromise(a,s){const c=Math.floor(Math.random()*s.length),o=s[c];let u=this.promises.get(o);u||(u=new Map,this.promises.set(o,u)),u.has(a)||u.set(a,Date.now()+na.GossipsubIWantFollowupTime)}getBrokenPromises(){const a=Date.now(),s=new Map;return this.promises.forEach((c,o)=>{c.forEach((u,l)=>{u<a&&(s.set(l,(s.get(l)||0)+1),c.delete(l))}),c.size||this.promises.delete(o)}),s}deliverMessage(a){const s=this.getMsgId(a);this.promises.delete(s)}rejectMessage(a,s){switch(s){case r:case n:return}const c=this.getMsgId(a);this.promises.delete(c)}clear(){this.promises.clear()}}t.IWantTracer=i}),Qm="Expected a function",Ym=0/0,KR="[object Symbol]",WR=/^\s+|\s+$/g,XR=/^[-+]0x[0-9a-f]+$/i,QR=/^0b[01]+$/i,YR=/^0o[0-7]+$/i,JR=parseInt,ZR=typeof ge=="object"&&ge&&ge.Object===Object&&ge,eP=typeof self=="object"&&self&&self.Object===Object&&self,tP=ZR||eP||Function("return this")(),rP=Object.prototype,nP=rP.toString,iP=Math.max,aP=Math.min,$l=function(){return tP.Date.now()};function sP(e,t,r){var n,i,a,s,c,o,u=0,l=!1,h=!1,w=!0;if(typeof e!="function")throw new TypeError(Qm);t=Jm(t)||0,kc(r)&&(l=!!r.leading,h="maxWait"in r,a=h?iP(Jm(r.maxWait)||0,t):a,w="trailing"in r?!!r.trailing:w);function f(S){var d=n,b=i;return n=i=void 0,u=S,s=e.apply(b,d),s}function A(S){return u=S,c=setTimeout(v,t),l?f(S):s}function p(S){var d=S-o,b=S-u,E=t-d;return h?aP(E,a-b):E}function y(S){var d=S-o,b=S-u;return o===void 0||d>=t||d<0||h&&b>=a}function v(){var S=$l();if(y(S))return O(S);c=setTimeout(v,p(S))}function O(S){return c=void 0,w&&n?f(S):(n=i=void 0,s)}function R(){c!==void 0&&clearTimeout(c),u=0,n=o=i=c=void 0}function m(){return c===void 0?s:O($l())}function g(){var S=$l(),d=y(S);if(n=arguments,i=this,o=S,d){if(c===void 0)return A(o);if(h)return c=setTimeout(v,t),f(o)}return c===void 0&&(c=setTimeout(v,t)),s}return g.cancel=R,g.flush=m,g}function oP(e,t,r){var n=!0,i=!0;if(typeof e!="function")throw new TypeError(Qm);return kc(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),sP(e,t,{leading:n,maxWait:t,trailing:i})}function kc(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function cP(e){return!!e&&typeof e=="object"}function uP(e){return typeof e=="symbol"||cP(e)&&nP.call(e)==KR}function Jm(e){if(typeof e=="number")return e;if(uP(e))return Ym;if(kc(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=kc(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(WR,"");var r=QR.test(e);return r||YR.test(e)?JR(e.slice(2),r?2:8):XR.test(e)?Ym:+e}var lP=oP,dP=re(function(e,t){t=e.exports=r;function r(i){if(!(this instanceof r))return new r(i);i=i||{};const a=i.validity||30,s=new Map,c=lP(()=>{s.forEach((o,u)=>{const l=o.validity||a,h=n(o.timestamp);h>l&&s.delete(u)})},200);this.put=(o,u,l)=>{this.has(o)||s.set(o,{value:u,timestamp:new Date,validity:l}),c()},this.get=o=>{if(s.has(o))return s.get(o).value;throw new Error("key does not exist")},this.has=o=>s.has(o)}function n(i){const a=new Date,s=a.getTime()-i.getTime();return Math.floor(s/1e3)}}),hP=re(function(e){var t=ge&&ge.__createBinding||(Object.create?function(o,u,l,h){h===void 0&&(h=l),Object.defineProperty(o,h,{enumerable:!0,get:function(){return u[l]}})}:function(o,u,l,h){h===void 0&&(h=l),o[h]=u[l]}),r=ge&&ge.__setModuleDefault||(Object.create?function(o,u){Object.defineProperty(o,"default",{enumerable:!0,value:u})}:function(o,u){o.default=u}),n=ge&&ge.__importStar||function(o){if(o&&o.__esModule)return o;var u={};if(o!=null)for(var l in o)l!=="default"&&Object.hasOwnProperty.call(o,l)&&t(u,o,l);return r(u,o),u},i=ge&&ge.__awaiter||function(o,u,l,h){function w(f){return f instanceof l?f:new l(function(A){A(f)})}return new(l||(l=Promise))(function(f,A){function p(O){try{v(h.next(O))}catch(R){A(R)}}function y(O){try{v(h.throw(O))}catch(R){A(R)}}function v(O){O.done?f(O.value):w(O.value).then(p,y)}v((h=h.apply(o,u||[])).next())})};const a=n(Fl),s=n(na);class c extends a.default{constructor(o,u={}){const l=[s.GossipsubIDv11,s.GossipsubIDv10],h=Object.assign(Object.assign({gossipIncoming:!0,fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:s.GossipsubD,Dlo:s.GossipsubDlo,Dhi:s.GossipsubDhi,Dscore:s.GossipsubDscore,Dout:s.GossipsubDout,Dlazy:s.GossipsubDlazy,signMessages:!0,strictSigning:!0},u),{scoreParams:Gl.createPeerScoreParams(u.scoreParams),scoreThresholds:Gl.createPeerScoreThresholds(u.scoreThresholds)});h.fallbackToFloodsub&&l.push(s.FloodsubID),super(Object.assign({debugName:"libp2p:gossipsub",multicodecs:l,libp2p:o},h)),this._options=h,this.direct=new Set(h.directPeers.map(w=>w.id.toB58String())),h.directPeers.forEach(w=>{o.peerStore.addressBook.add(w.id,w.addrs)}),this.seenCache=new dP,this.mesh=new Map,this.fanout=new Map,this.lastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.defaultMsgIdFn=w=>a.utils.msgId(w.from,w.seqno),this._msgIdFn=u.msgIdFn||this.defaultMsgIdFn,this.messageCache=u.messageCache||new BR.MessageCache(s.GossipsubHistoryGossip,s.GossipsubHistoryLength,this._msgIdFn),this.heartbeat=new qR.Heartbeat(this),this.heartbeatTicks=0,this.gossipTracer=new zR.IWantTracer(this._msgIdFn),this._libp2p=o,this.score=new Gl.PeerScore(this._options.scoreParams,o.connectionManager,this._msgIdFn)}_decodeRpc(o){return ql.RPCCodec.decode(o)}_encodeRpc(o){return ql.RPCCodec.encode(o)}_addPeer(o,u){const l=super._addPeer(o,u);this.score.addPeer(o.toB58String());let h=!1;for(const w of this._libp2p.connectionManager.getAll(o))if(w.stat.direction==="outbound"&&Array.from(w.registry.values()).some(f=>u===f.protocol)){h=!0;break}return this.outbound.set(l.id.toB58String(),h),l}_removePeer(o){const u=super._removePeer(o),l=o.toB58String();for(const h of this.mesh.values())h.delete(l);for(const h of this.fanout.values())h.delete(l);return this.gossip.delete(l),this.control.delete(l),this.outbound.delete(l),this.score.removePeer(l),u}_processRpc(o,u,l){return super._processRpc(o,u,l)?(l.control&&this._processRpcControlMessage(o,l.control),!0):!1}_processRpcControlMessage(o,u){if(!u)return;const l=this._handleIHave(o,u.ihave),h=this._handleIWant(o,u.iwant),w=this._handleGraft(o,u.graft);if(this._handlePrune(o,u.prune),!l.length&&!h.length&&!w.length)return;const f=Bt.createGossipRpc(h,{iwant:l,prune:w});this._sendRpc(o,f)}_processRpcMessage(o){const u=Object.create(null,{_processRpcMessage:{get:()=>super._processRpcMessage}});return i(this,void 0,void 0,function*(){const l=this.getMsgId(o);if(this.seenCache.has(l)){this.score.duplicateMessage(o);return}this.seenCache.put(l),this.score.validateMessage(o),yield u._processRpcMessage.call(this,o)})}_acceptFrom(o){return this.direct.has(o)||this.score.score(o)>=this._options.scoreThresholds.graylistThreshold}validate(o){const u=Object.create(null,{validate:{get:()=>super.validate}});return i(this,void 0,void 0,function*(){try{yield u.validate.call(this,o)}catch(l){throw this.score.rejectMessage(o,l.code),this.gossipTracer.rejectMessage(o,l.code),l}})}_handleIHave(o,u){if(!u.length)return[];const l=this.score.score(o);if(l<this._options.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",o,l),[];const h=(this.peerhave.get(o)||0)+1;if(this.peerhave.set(o,h),h>s.GossipsubMaxIHaveMessages)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",o,h),[];const w=this.iasked.get(o)||0;if(w>=s.GossipsubMaxIHaveLength)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",o,w),[];const f=new Set;if(u.forEach(({topicID:y,messageIDs:v})=>{if(!y||!this.mesh.has(y))return;v.forEach(O=>{if(this.seenCache.has(O))return;f.add(O)})}),!f.size)return[];let A=f.size;A+w>s.GossipsubMaxIHaveLength&&(A=s.GossipsubMaxIHaveLength-w),this.log("IHAVE: Asking for %d out of %d messages from %s",A,f.size,o);let p=Array.from(f);return Bt.shuffle(p),p=p.slice(0,A),this.iasked.set(o,w+A),this.gossipTracer.addPromise(o,p),[{messageIDs:p}]}_handleIWant(o,u){if(!u.length)return[];const l=this.score.score(o);if(l<this._options.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",o,l),[];const h=new Map;return u.forEach(({messageIDs:w})=>{w.forEach(f=>{const[A,p]=this.messageCache.getForPeer(f,o);if(!A)return;if(p>s.GossipsubGossipRetransmission){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",o,f);return}h.set(f,A)})}),h.size?(this.log("IWANT: Sending %d messages to %s",h.size,o),Array.from(h.values()).map(a.utils.normalizeOutRpcMessage)):[]}_handleGraft(o,u){const l=[],h=this.score.score(o),w=this._now();let f=this._options.doPX;return u.forEach(({topicID:A})=>{var p;if(!A)return;const y=this.mesh.get(A);if(!y){f=!1;return}if(y.has(o))return;if(this.direct.has(o)){this.log("GRAFT: ignoring request from direct peer %s",o),l.push(A),f=!1;return}const v=(p=this.backoff.get(A))===null||p===void 0?void 0:p.get(o);if(typeof v=="number"&&w<v){this.log("GRAFT: ignoring backed off peer %s",o),this.score.addPenalty(o,1),f=!1;const O=v+s.GossipsubGraftFloodThreshold-s.GossipsubPruneBackoff;w<O&&this.score.addPenalty(o,1),this._addBackoff(o,A),l.push(A);return}if(h<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",o,h,A),l.push(A),f=!1,this._addBackoff(o,A);return}if(y.size>=this._options.Dhi&&!this.outbound.get(o)){l.push(A),this._addBackoff(o,A);return}this.log("GRAFT: Add mesh link from %s in %s",o,A),this.score.graft(o,A),y.add(o)}),l.length?l.map(A=>this._makePrune(o,A,f)):[]}_handlePrune(o,u){const l=this.score.score(o);u.forEach(({topicID:h,backoff:w,peers:f})=>{if(!h)return;const A=this.mesh.get(h);if(!A)return;if(this.log("PRUNE: Remove mesh link to %s in %s",o,h),this.score.prune(o,h),A.delete(o),typeof w=="number"&&w>0?this._doAddBackoff(o,h,w*1e3):this._addBackoff(o,h),f&&f.length){if(l<this._options.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",o,l,h);return}this._pxConnect(f)}})}_addBackoff(o,u){this._doAddBackoff(o,u,s.GossipsubPruneBackoff)}_doAddBackoff(o,u,l){let h=this.backoff.get(u);h||(h=new Map,this.backoff.set(u,h));const w=this._now()+l,f=h.get(o)||0;f<w&&h.set(o,w)}_applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((o,u)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",u,o),this.score.addPenalty(u,o)})}_clearBackoff(){if(this.heartbeatTicks%s.GossipsubPruneBackoffTicks!==0)return;const o=this._now();this.backoff.forEach((u,l)=>{u.forEach((h,w)=>{h<o&&u.delete(w)}),u.size===0&&this.backoff.delete(l)})}_directConnect(){if(this.heartbeatTicks%s.GossipsubDirectConnectTicks!==0)return;const o=[];this.direct.forEach(u=>{const l=this.peers.get(u);(!l||!l.isWritable)&&o.push(u)}),o.length&&o.forEach(u=>{this._connect(u)})}_pxConnect(o){return i(this,void 0,void 0,function*(){o.length>s.GossipsubPrunePeers&&(Bt.shuffle(o),o=o.slice(0,s.GossipsubPrunePeers));const u=[];if(yield Promise.all(o.map(l=>i(this,void 0,void 0,function*(){if(!l.peerID)return;const h=we.createFromBytes(l.peerID),w=h.toB58String();if(this.peers.has(w))return;if(!l.signedPeerRecord){u.push(w);return}try{const f=yield ws.openAndCertify(l.signedPeerRecord,"libp2p-peer-record"),A=f.peerId.toB58String();if(w!==A){this.log("bogus peer record obtained through px: peer ID %s doesn't match expected peer %s",A,w);return}if(!this._libp2p.peerStore.addressBook.consumePeerRecord(f)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}u.push(w)}catch(f){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}))),!u.length)return;u.forEach(l=>this._connect(l))})}start(){super.start(),this.heartbeat.start(),this.score.start(),this._directPeerInitial=setTimeout(()=>{this.direct.forEach(o=>{this._connect(o)})},s.GossipsubDirectConnectInitialDelay)}stop(){super.stop(),this.heartbeat.stop(),this.score.stop(),this.mesh=new Map,this.fanout=new Map,this.lastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.gossipTracer.clear(),clearTimeout(this._directPeerInitial)}_connect(o){this.log("Initiating connection with %s",o),this._libp2p.dialProtocol(we.createFromB58String(o),this.multicodecs)}subscribe(o){super.subscribe(o),this.join(o)}unsubscribe(o){super.unsubscribe(o),this.leave(o)}join(o){if(!this.started)throw new Error("Gossipsub has not started");this.log("JOIN %s",o);const u=this.fanout.get(o);if(u)u.forEach(l=>{this.score.score(l)<0&&u.delete(l)}),u.size<this._options.D&&Ri.getGossipPeers(this,o,this._options.D-u.size,l=>!u.has(l)&&!this.direct.has(l)&&this.score.score(l)>=0).forEach(l=>u.add(l)),this.mesh.set(o,u),this.fanout.delete(o),this.lastpub.delete(o);else{const l=Ri.getGossipPeers(this,o,this._options.D,h=>!this.direct.has(h)&&this.score.score(h)>=0);this.mesh.set(o,l)}this.mesh.get(o).forEach(l=>{this.log("JOIN: Add mesh link to %s in %s",l,o),this._sendGraft(l,o)})}leave(o){if(!this.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",o);const u=this.mesh.get(o);u&&(u.forEach(l=>{this.log("LEAVE: Remove mesh link to %s in %s",l,o),this._sendPrune(l,o)}),this.mesh.delete(o))}getMsgId(o){return this._msgIdFn(o)}_publish(o){return i(this,void 0,void 0,function*(){o.receivedFrom!==this.peerId.toB58String()&&(this.score.deliverMessage(o),this.gossipTracer.deliverMessage(o));const u=this.getMsgId(o);this.seenCache.put(u),this.messageCache.put(o);const l=new Set;o.topicIDs.forEach(w=>{const f=this.topics.get(w);if(!f)return;if(this._options.floodPublish&&o.from===this.peerId.toB58String())f.forEach(A=>{(this.direct.has(A)||this.score.score(A)>=this._options.scoreThresholds.publishThreshold)&&l.add(A)});else{this.direct.forEach(p=>{l.add(p)}),f.forEach(p=>{const y=this.score.score(p),v=this.peers.get(p);if(!v)return;v.protocol===s.FloodsubID&&y>=this._options.scoreThresholds.publishThreshold&&l.add(p)});let A=this.mesh.get(w);if(!A||!A.size){if(A=this.fanout.get(w),!A){const p=Ri.getGossipPeers(this,w,this._options.D,y=>this.score.score(y)>=this._options.scoreThresholds.publishThreshold);p.size>0?(A=p,this.fanout.set(w,p)):A=new Set}this.lastpub.set(w,this._now())}A.forEach(p=>{l.add(p)})}});const h=Bt.createGossipRpc([a.utils.normalizeOutRpcMessage(o)]);l.forEach(w=>{if(w===o.from)return;this._sendRpc(w,h)})})}_sendGraft(o,u){const l=[{topicID:u}],h=Bt.createGossipRpc([],{graft:l});this._sendRpc(o,h)}_sendPrune(o,u){const l=[this._makePrune(o,u,this._options.doPX)],h=Bt.createGossipRpc([],{prune:l});this._sendRpc(o,h)}_sendRpc(o,u){const l=this.peers.get(o);if(!l||!l.isWritable)return;const h=this.control.get(o);h&&(this._piggybackControl(o,u,h),this.control.delete(o));const w=this.gossip.get(o);w&&(this._piggybackGossip(o,u,w),this.gossip.delete(o)),l.write(ql.RPCCodec.encode(u))}_piggybackControl(o,u,l){const h=(l.graft||[]).filter(({topicID:f})=>(f&&this.mesh.get(f)||new Set).has(o)),w=(l.prune||[]).filter(({topicID:f})=>!(f&&this.mesh.get(f)||new Set).has(o));if(!h.length&&!w.length)return;u.control?(u.control.graft=u.control.graft.concat(h),u.control.prune=u.control.prune.concat(w)):u.control={ihave:[],iwant:[],graft:h,prune:w}}_piggybackGossip(o,u,l){u.control||(u.control={ihave:[],iwant:[],graft:[],prune:[]}),u.control.ihave=l}_sendGraftPrune(o,u,l){const h=this._options.doPX;for(const[w,f]of o){const A=f.map(O=>({topicID:O}));let p=[];const y=u.get(w);y&&(p=y.map(O=>this._makePrune(w,O,h&&!l.get(w))),u.delete(w));const v=Bt.createGossipRpc([],{graft:A,prune:p});this._sendRpc(w,v)}for(const[w,f]of u){const A=f.map(y=>this._makePrune(w,y,h&&!l.get(w))),p=Bt.createGossipRpc([],{prune:A});this._sendRpc(w,p)}}_emitGossip(o,u){const l=this.messageCache.getGossipIDs(o);if(!l.length)return;Bt.shuffle(l),l.length>s.GossipsubMaxIHaveLength&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",l.length);const h=[],w=this.topics.get(o);if(!w)return;w.forEach(p=>{const y=this.peers.get(p);if(!y)return;!u.has(p)&&!this.direct.has(p)&&Bt.hasGossipProtocol(y.protocol)&&this.score.score(p)>=this._options.scoreThresholds.gossipThreshold&&h.push(p)});let f=this._options.Dlazy;const A=s.GossipsubGossipFactor*h.length;A>f&&(f=A),f>h.length?f=h.length:Bt.shuffle(h),h.slice(0,f).forEach(p=>{let y=l;l.length>s.GossipsubMaxIHaveLength&&(y=Bt.shuffle(y.slice()).slice(0,s.GossipsubMaxIHaveLength)),this._pushGossip(p,{topicID:o,messageIDs:y})})}_flush(){for(const[o,u]of this.gossip.entries()){this.gossip.delete(o);const l=Bt.createGossipRpc([],{ihave:u});this._sendRpc(o,l)}for(const[o,u]of this.control.entries()){this.control.delete(o);const l=Bt.createGossipRpc([],{graft:u.graft,prune:u.prune});this._sendRpc(o,l)}}_pushGossip(o,u){this.log("Add gossip to %s",o);const l=this.gossip.get(o)||[];this.gossip.set(o,l.concat(u))}_now(){return Date.now()}_makePrune(o,u,l){if(this.peers.get(o).protocol===s.GossipsubIDv10)return{topicID:u,peers:[]};const h=s.GossipsubPruneBackoff/1e3,w=[];if(l){const f=Ri.getGossipPeers(this,u,s.GossipsubPrunePeers,A=>A!==o&&this.score.score(A)>=0);f.forEach(A=>{const p=we.createFromB58String(A);w.push({peerID:p.toBytes(),signedPeerRecord:this._libp2p.peerStore.addressBook.getRawEnvelope(p)})})}return{topicID:u,peers:w,backoff:h}}}c.multicodec=s.GossipsubIDv11,e.exports=c}),pP=Mg(hP),fP=`// Record represents a dht record that contains a value
// for a key value pair
message Record {
  // The key that references this record
  bytes key = 1;

  // The actual value this record is storing
  bytes value = 2;

  // Note: These fields were removed from the Record message
  // hash of the authors public key
  // optional bytes author = 3;
  // A PKI signature for the key+value+author
  // optional bytes signature = 4;

  // Time the record was received, set by receiver
  optional string timeReceived = 5;
}`,mP=e=>{const t=e.getUTCFullYear(),r=String(e.getUTCMonth()+1).padStart(2,"0"),n=String(e.getUTCDate()).padStart(2,"0"),i=String(e.getUTCHours()).padStart(2,"0"),a=String(e.getUTCMinutes()).padStart(2,"0"),s=String(e.getUTCSeconds()).padStart(2,"0"),c=e.getUTCMilliseconds(),o=c*1e3*1e3;return`${t}-${r}-${n}T${i}:${a}:${s}.${o}Z`},gP=e=>{const t=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),r=String(e).trim().match(t);if(!r)throw new Error("Invalid format");const n=parseInt(r[1],10),i=parseInt(r[2],10)-1,a=parseInt(r[3],10),s=parseInt(r[4],10),c=parseInt(r[5],10),o=parseInt(r[6],10),u=parseInt(r[7].slice(0,-6),10);return new Date(Date.UTC(n,i,a,s,c,o,u))},Zm={toRFC3339:mP,parseRFC3339:gP};const eg=Nr(fP).Record;class Vl{constructor(e,t,r){if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=r}serialize(){return eg.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:this.timeReceived&&Zm.toRFC3339(this.timeReceived)}}static deserialize(e){const t=eg.decode(e);return Vl.fromDeserialized(t)}static fromDeserialized(e){let t;e.timeReceived&&(t=Zm.parseRFC3339(e.timeReceived));const r=new Vl(e.key,e.value,t);return r}}var yP=Vl;const bP=async(e,t)=>{if(!(e instanceof Uint8Array))throw U(new Error('"key" must be a Uint8Array'),"ERR_INVALID_RECORD_KEY_NOT_BUFFER");if(e.byteLength<5)throw U(new Error("invalid public key record"),"ERR_INVALID_RECORD_KEY_TOO_SHORT");const r=De(e.subarray(0,4));if(r!=="/pk/")throw U(new Error("key was not prefixed with /pk/"),"ERR_INVALID_RECORD_KEY_BAD_PREFIX");const n=e.slice(4),i=await ta(t,"sha2-256");if(!ir(n,i))throw U(new Error("public key does not match passed in key"),"ERR_INVALID_RECORD_HASH_MISMATCH")};var vP={func:bP,sign:!1},wP={pk:vP};const _P=(e,t)=>{const r=t.key,n=De(r),i=n.split("/");if(i.length<3)return;const a=e[i[1].toString()];if(!a){const s="Invalid record keytype";throw U(new Error(s),"ERR_INVALID_RECORD_KEY_TYPE")}return a.func(r,t.value)};var EP={verifyRecord:_P,validators:wP};const SP=(e,t)=>0;var AP=SP,TP={pk:AP};const IP=(e,t,r)=>{if(r.length===0){const s="No records given";throw U(new Error(s),"ERR_NO_RECORDS_RECEIVED")}const n=De(t),i=n.split("/");if(i.length<3){const s="Record key does not have a selector function";throw U(new Error(s),"ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")}const a=e[i[1].toString()];if(!a){const s=`Unrecognized key prefix: ${i[1]}`;throw U(new Error(s),"ERR_UNRECOGNIZED_KEY_PREFIX")}return a(t,r)};var CP={bestRecord:IP,selectors:TP},Dn={Record:yP,validator:EP,selection:CP};const{EventEmitter:kP}=At;function tg(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}function Hl(){return{contacts:[],dontSplit:!1,left:null,right:null}}function Qs(e,t){if(!(t instanceof Uint8Array))throw new TypeError(e+" is not a Uint8Array")}class zl extends kP{constructor(e={}){super();this.localNodeId=e.localNodeId||Mc(20),this.numberOfNodesPerKBucket=e.numberOfNodesPerKBucket||20,this.numberOfNodesToPing=e.numberOfNodesToPing||3,this.distance=e.distance||zl.distance,this.arbiter=e.arbiter||zl.arbiter,this.metadata=Object.assign({},e.metadata),Qs("option.localNodeId as parameter 1",this.localNodeId),this.root=Hl()}static arbiter(e,t){return e.vectorClock>t.vectorClock?e:t}static distance(e,t){let r=0,n=0;const i=Math.min(e.length,t.length),a=Math.max(e.length,t.length);for(;n<i;++n)r=r*256+(e[n]^t[n]);for(;n<a;++n)r=r*256+255;return r}add(e){Qs("contact.id",(e||{}).id);let t=0,r=this.root;for(;r.contacts===null;)r=this._determineNode(r,e.id,t++);const n=this._indexOf(r,e.id);return n>=0?(this._update(r,n,e),this):r.contacts.length<this.numberOfNodesPerKBucket?(r.contacts.push(e),this.emit("added",e),this):r.dontSplit?(this.emit("ping",r.contacts.slice(0,this.numberOfNodesToPing),e),this):(this._split(r,t),this.add(e))}closest(e,t=Infinity){if(Qs("id",e),!Number.isInteger(t)&&t!==Infinity||t<=0)throw new TypeError("n is not positive number");let r=[];for(let n=[this.root],i=0;n.length>0&&r.length<t;){const a=n.pop();if(a.contacts===null){const s=this._determineNode(a,e,i++);n.push(a.left===s?a.right:a.left),n.push(s)}else r=r.concat(a.contacts)}return r.map(n=>[this.distance(n.id,e),n]).sort((n,i)=>n[0]-i[0]).slice(0,t).map(n=>n[1])}count(){let e=0;for(const t=[this.root];t.length>0;){const r=t.pop();r.contacts===null?t.push(r.right,r.left):e+=r.contacts.length}return e}_determineNode(e,t,r){const n=r>>3,i=r%8;if(t.length<=n&&i!==0)return e.left;const a=t[n];return a&1<<7-i?e.right:e.left}get(e){Qs("id",e);let t=0,r=this.root;for(;r.contacts===null;)r=this._determineNode(r,e,t++);const n=this._indexOf(r,e);return n>=0?r.contacts[n]:null}_indexOf(e,t){for(let r=0;r<e.contacts.length;++r)if(tg(e.contacts[r].id,t))return r;return-1}remove(e){Qs("the id as parameter 1",e);let t=0,r=this.root;for(;r.contacts===null;)r=this._determineNode(r,e,t++);const n=this._indexOf(r,e);if(n>=0){const i=r.contacts.splice(n,1)[0];this.emit("removed",i)}return this}_split(e,t){e.left=Hl(),e.right=Hl();for(const i of e.contacts)this._determineNode(e,i.id,t).contacts.push(i);e.contacts=null;const r=this._determineNode(e,this.localNodeId,t),n=e.left===r?e.right:e.left;n.dontSplit=!0}toArray(){let e=[];for(const t=[this.root];t.length>0;){const r=t.pop();r.contacts===null?t.push(r.right,r.left):e=e.concat(r.contacts)}return e}_update(e,t,r){if(!tg(e.contacts[t].id,r.id))throw new Error("wrong index for _update");const n=e.contacts[t],i=this.arbiter(n,r);if(i===n&&n!==r)return;e.contacts.splice(t,1),e.contacts.push(i),this.emit("updated",n,i)}}var RP=zl,rg=re(function(e,t){var r=function(o,u){return u||(u={}),o.split("").forEach(function(l,h){l in u||(u[l]=h)}),u},n={alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",charmap:{0:14,1:8}};n.charmap=r(n.alphabet,n.charmap);var i={alphabet:"0123456789ABCDEFGHJKMNPQRSTVWXYZ",charmap:{O:0,I:1,L:1}};i.charmap=r(i.alphabet,i.charmap);var a={alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",charmap:{}};a.charmap=r(a.alphabet,a.charmap);function s(o){if(this.buf=[],this.shift=8,this.carry=0,o){switch(o.type){case"rfc4648":this.charmap=t.rfc4648.charmap;break;case"crockford":this.charmap=t.crockford.charmap;break;case"base32hex":this.charmap=t.base32hex.charmap;break;default:throw new Error("invalid type")}o.charmap&&(this.charmap=o.charmap)}}s.prototype.charmap=n.charmap,s.prototype.write=function(o){var u=this.charmap,l=this.buf,h=this.shift,w=this.carry;return o.toUpperCase().split("").forEach(function(f){if(f=="=")return;var A=u[f]&255;h-=5,h>0?w|=A<<h:h<0?(l.push(w|A>>-h),h+=8,w=A<<h&255):(l.push(w|A),h=8,w=0)}),this.shift=h,this.carry=w,this},s.prototype.finalize=function(o){return o&&this.write(o),this.shift!==8&&this.carry!==0&&(this.buf.push(this.carry),this.shift=8,this.carry=0),this.buf};function c(o){if(this.buf="",this.shift=3,this.carry=0,o){switch(o.type){case"rfc4648":this.alphabet=t.rfc4648.alphabet;break;case"crockford":this.alphabet=t.crockford.alphabet;break;case"base32hex":this.alphabet=t.base32hex.alphabet;break;default:throw new Error("invalid type")}o.alphabet?this.alphabet=o.alphabet:o.lc&&(this.alphabet=this.alphabet.toLowerCase())}}c.prototype.alphabet=n.alphabet,c.prototype.write=function(o){var u=this.shift,l=this.carry,h,w,f;for(f=0;f<o.length;f++)w=o[f],h=l|w>>u,this.buf+=this.alphabet[h&31],u>5&&(u-=5,h=w>>u,this.buf+=this.alphabet[h&31]),u=5-u,l=w<<u,u=8-u;return this.shift=u,this.carry=l,this},c.prototype.finalize=function(o){return o&&this.write(o),this.shift!==3&&(this.buf+=this.alphabet[this.carry&31],this.shift=3,this.carry=0),this.buf},t.encode=function(o,u){return new c(u).finalize(o)},t.decode=function(o,u){return new s(u).finalize(o)},t.Decoder=s,t.Encoder=c,t.charmap=r,t.crockford=i,t.rfc4648=n,t.base32hex=a}),ia=Pi;function Pi(e,t){if(e.length!==t.length)throw new Error("Inputs should have the same length");for(var r=Buffer.allocUnsafe(e.length),n=0;n<e.length;n++)r[n]=e[n]^t[n];return r}Pi.compare=function(t,r){if(t.length!==r.length)throw new Error("Inputs should have the same length");for(var n=0;n<t.length;n++){if(t[n]===r[n])continue;return t[n]<r[n]?-1:1}return 0},Pi.gt=function(t,r){return Pi.compare(t,r)===1},Pi.lt=function(t,r){return Pi.compare(t,r)===-1},Pi.eq=function(t,r){return Pi.compare(t,r)===0};var ng=async(e,t,{concurrency:r=Infinity,stopOnError:n=!0}={})=>new Promise((i,a)=>{if(typeof t!="function")throw new TypeError("Mapper function is required");if(!((Number.isSafeInteger(r)||r===Infinity)&&r>=1))throw new TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${r}\` (${typeof r})`);const s=[],c=[],o=e[Symbol.iterator]();let u=!1,l=!1,h=0,w=0;const f=()=>{if(u)return;const A=o.next(),p=w;if(w++,A.done){l=!0,h===0&&(!n&&c.length!==0?a(new so(c)):i(s));return}h++,(async()=>{try{const y=await A.value;s[p]=await t(y,p),h--,f()}catch(y){n?(u=!0,a(y)):(c.push(y),h--,f())}})()};for(let A=0;A<r&&!(f(),l);A++);}),ve=re(function(e,t){const r=ta.multihash,{Key:n}=Ea,{Record:i}=Dn;t.convertBuffer=a=>ta.digest(a,"sha2-256"),t.convertPeerId=a=>ta.digest(a.id,"sha2-256"),t.bufferToKey=a=>new n("/"+t.encodeBase32(a),!1),t.keyForPublicKey=a=>nr([at("/pk/"),a.id]),t.isPublicKeyKey=a=>De(a.slice(0,4))==="/pk/",t.fromPublicKeyKey=a=>new we(a.slice(4)),t.now=()=>Date.now(),t.encodeBase32=a=>{const s=new rg.Encoder;return s.write(a).finalize()},t.decodeBase32=a=>{const s=new rg.Decoder;return Uint8Array.from(s.write(a).finalize())},t.sortClosestPeers=async(a,s)=>{const c=await ng(a,async o=>{const u=await t.convertPeerId(o);return{peer:o,distance:ia(u,s)}});return c.sort(t.xorCompare).map(o=>o.peer)},t.xorCompare=(a,s)=>ia.compare(a.distance,s.distance),t.pathSize=(a,s)=>Math.ceil(a/s),t.createPutRecord=(a,s)=>{const c=new Date,o=new i(a,s,c);return o.serialize()},t.logger=(a,s)=>{const c=["libp2p","dht"];s&&c.push(s),a&&c.push(`${a.toB58String().slice(0,8)}`),te.formatters.b=u=>r.toB58String(u);const o=te(c.join(":"));return o.error=te(c.concat(["error"]).join(":")),o},t.TimeoutError=class extends Error{get code(){return"ETIMEDOUT"}},t.withTimeout=(a,s)=>async(...c)=>Promise.race([a(...c),new Promise((o,u)=>{setTimeout(()=>{u(U(new Error("Async function did not complete before timeout"),"ETIMEDOUT"))},s)})]),t.mapParallel=async function(a,s){const c=[];for await(const o of a)c.push(s(o));return Promise.all(c)}});class PP{constructor(e,t){this.self=e,this._onPing=this._onPing.bind(this),this._onInit(t)}async _onInit(e){const t=await ve.convertPeerId(this.self);this.kb=new RP({localNodeId:t,numberOfNodesPerKBucket:e,numberOfNodesToPing:1}),this.kb.on("ping",this._onPing)}_onPing(e,t){const r=e[0];this.kb.remove(r.id),this.kb.add(t)}get size(){return this.kb.count()}async find(e){const t=await ve.convertPeerId(e),r=this.closestPeer(t);if(r&&r.isEqual(e))return r}closestPeer(e){const t=this.closestPeers(e,1);if(t.length>0)return t[0]}closestPeers(e,t){return this.kb.closest(e,t).map(r=>r.peer)}async add(e){const t=await ve.convertPeerId(e);this.kb.add({id:t,peer:e})}async remove(e){const t=await ve.convertPeerId(e);this.kb.remove(t)}}var NP=PP,st=re(function(e,t){const r=t.second=1e3,n=t.minute=60*r,i=t.hour=60*n;t.MAX_RECORD_AGE=36*i,t.PROTOCOL_DHT="/ipfs/kad/1.0.0",t.PROVIDERS_KEY_PREFIX="/providers/",t.PROVIDERS_LRU_CACHE_SIZE=256,t.PROVIDERS_VALIDITY=24*i,t.PROVIDERS_CLEANUP_INTERVAL=i,t.READ_MESSAGE_TIMEOUT=10*r,t.GET_MANY_RECORD_COUNT=16,t.K=20,t.ALPHA=3,t.defaultRandomWalk={enabled:!0,queriesPerPeriod:1,interval:5*n,timeout:10*r,delay:10*r}});const ig=()=>{};class OP{constructor({min:e=0,max:t=Infinity,handlers:r={}}){this.min=e,this.max=t,this._onConnect=r.onConnect||ig,this._onDisconnect=r.onDisconnect||ig,this.peers=new Set}set registrar(e){this._registrar=e}disconnect(e){this._onDisconnect(e)}}var DP=Pr(OP,{className:"Topology",symbolName:"@libp2p/js-interfaces/topology"});class MP extends DP{constructor({min:e,max:t,multicodecs:r,handlers:n}){super({min:e,max:t,handlers:n});if(!r)throw new Error("one or more multicodec should be provided");if(!n)throw new Error("the handlers should be provided");if(typeof n.onConnect!="function")throw new Error("the 'onConnect' handler must be provided");if(typeof n.onDisconnect!="function")throw new Error("the 'onDisconnect' handler must be provided");this.multicodecs=Array.isArray(r)?r:[r],this._registrar=void 0,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerConnect=this._onPeerConnect.bind(this)}set registrar(e){this._registrar=e,this._registrar.peerStore.on("change:protocols",this._onProtocolChange),this._registrar.connectionManager.on("peer:connect",this._onPeerConnect),this._updatePeers(this._registrar.peerStore.peers.values())}_updatePeers(e){for(const{id:t,protocols:r}of e)if(this.multicodecs.filter(n=>r.includes(n)).length){this.peers.add(t.toB58String());const n=this._registrar.getConnection(t);n&&this._onConnect(t,n)}else this.peers.delete(t.toB58String())}_onProtocolChange({peerId:e,protocols:t}){const r=this.peers.has(e.toB58String()),n=t.filter(i=>this.multicodecs.includes(i));r&&n.length===0&&this._onDisconnect(e);for(const i of t)if(this.multicodecs.includes(i)){const a=this._registrar.peerStore.get(e);this._updatePeers([a]);return}}_onPeerConnect(e){const t=e.remotePeer,r=this._registrar.peerStore.protoBook.get(t);if(!r)return;this.multicodecs.find(n=>r.includes(n))&&(this.peers.add(t.toB58String()),this._onConnect(t,e))}}var xP=Pr(MP,{className:"MulticodecTopology",symbolName:"@libp2p/js-interfaces/topology/multicodec-topology"}),BP=`// can't use, because protocol-buffers doesn't support imports
// so we have to duplicate for now :(
// import "record.proto";

message Record {
  // adjusted for javascript
  optional bytes key = 1;
  optional bytes value = 2;
  optional bytes author = 3;
  optional bytes signature = 4;
  optional string timeReceived = 5;
}

message Message {
  enum MessageType {
    PUT_VALUE = 0;
    GET_VALUE = 1;
    ADD_PROVIDER = 2;
    GET_PROVIDERS = 3;
    FIND_NODE = 4;
    PING = 5;
  }

  enum ConnectionType {
    // sender does not have a connection to peer, and no extra information (default)
    NOT_CONNECTED = 0;

    // sender has a live connection to peer
    CONNECTED = 1;

    // sender recently connected to peer
    CAN_CONNECT = 2;

    // sender recently tried to connect to peer repeatedly but failed to connect
    // ("try" here is loose, but this should signal "made strong effort, failed")
    CANNOT_CONNECT = 3;
  }

  message Peer {
    // ID of a given peer.
    optional bytes id = 1;

    // multiaddrs for a given peer
    repeated bytes addrs = 2;

    // used to signal the sender's connection capabilities to the peer
    optional ConnectionType connection = 3;
  }

  // defines what type of message it is.
  optional MessageType type = 1;

  // defines what coral cluster level this query/response belongs to.
  // in case we want to implement coral's cluster rings in the future.
  optional int32 clusterLevelRaw = 10;

  // Used to specify the key associated with this message.
  // PUT_VALUE, GET_VALUE, ADD_PROVIDER, GET_PROVIDERS
  // adjusted for javascript
  optional bytes key = 2;

  // Used to return a value
  // PUT_VALUE, GET_VALUE
  // adjusted Record to bytes for js
  optional bytes record = 3;

  // Used to return peers closer to a key in a query
  // GET_VALUE, GET_PROVIDERS, FIND_NODE
  repeated Peer closerPeers = 8;

  // Used to return Providers
  // GET_VALUE, ADD_PROVIDER, GET_PROVIDERS
  repeated Peer providerPeers = 9;
}`;const{Record:LP}=Dn,Rc=Nr(BP),jP=Rc.Message.MessageType,ag=Rc.Message.ConnectionType;class Pc{constructor(e,t,r){if(t&&!(t instanceof Uint8Array))throw new Error("Key must be a Uint8Array");this.type=e,this.key=t,this._clusterLevelRaw=r,this.closerPeers=[],this.providerPeers=[],this.record=null}get clusterLevel(){const e=this._clusterLevelRaw-1;return e<0?0:e}set clusterLevel(e){this._clusterLevelRaw=e}serialize(){const e={key:this.key,type:this.type,clusterLevelRaw:this._clusterLevelRaw,closerPeers:this.closerPeers.map(sg),providerPeers:this.providerPeers.map(sg)};return this.record&&(this.record instanceof Uint8Array?e.record=this.record:e.record=this.record.serialize()),Rc.Message.encode(e)}static deserialize(e){const t=Rc.Message.decode(e),r=new Pc(t.type,t.key,t.clusterLevelRaw);return r.closerPeers=t.closerPeers.map(og),r.providerPeers=t.providerPeers.map(og),t.record&&(r.record=LP.deserialize(t.record)),r}}Pc.TYPES=jP,Pc.CONNECTION_TYPES=ag;function sg(e){return{id:e.id.id,addrs:(e.multiaddrs||[]).map(t=>t.bytes),connection:ag.CONNECTED}}function og(e){return{id:new we(e.id),multiaddrs:e.addrs.map(t=>Ne(t))}}var _t=Pc;const{Record:UP}=Dn;var FP=e=>{const t=ve.logger(e.peerId,"rpc:get-value");return async function(n,i){const a=i.key;if(t("key: %b",a),!a||a.length===0)throw U(new Error("Invalid key"),"ERR_INVALID_KEY");const s=new _t(_t.TYPES.GET_VALUE,a,i.clusterLevel);if(ve.isPublicKeyKey(a)){t("is public key");const u=ve.fromPublicKeyKey(a);let l;if(e._isSelf(u))l=e.peerId;else{const h=e.peerStore.get(u);l=h&&h.id}if(l&&l.pubKey)return t("returning found public key"),s.record=new UP(a,l.pubKey.bytes),s}const[c,o]=await Promise.all([e._checkLocalDatastore(a),e._betterPeersToQuery(i,n)]);return c&&(t("got record"),s.record=c),o.length>0&&(t("got closer %s",o.length),s.closerPeers=o),s}},qP=e=>{const t=ve.logger(e.peerId,"rpc:put-value");return async function(n,i){const a=i.key;t("key: %b",a);const s=i.record;if(!s){const o=`Empty record from: ${n.toB58String()}`;throw t.error(o),U(new Error(o),"ERR_EMPTY_RECORD")}await e._verifyRecordLocally(s),s.timeReceived=new Date;const c=ve.bufferToKey(s.key);return await e.datastore.put(c,s.serialize()),i}},GP=e=>{const t=ve.logger(e.peerId,"rpc:find-node");return async function(n,i){t("start");let a;ir(i.key,e.peerId.id)?a=[{id:e.peerId}]:a=await e._betterPeersToQuery(i,n);const s=new _t(i.type,new Uint8Array(0),i.clusterLevel);return a.length>0?s.closerPeers=a:t("handle FindNode %s: could not find anything",n.toB58String()),s}},$P=e=>{const t=ve.logger(e.peerId,"rpc:add-provider");return async function(n,i){if(t("start"),!i.key||i.key.length===0)throw U(new Error("Missing key"),"ERR_MISSING_KEY");let a;try{a=new io(i.key)}catch(s){const c=`Invalid CID: ${s.message}`;throw U(new Error(c),"ERR_INVALID_CID")}return i.providerPeers.forEach(s=>{if(!s.id.isEqual(n)){t("invalid provider peer %s from %s",s.id.toB58String(),n.toB58String());return}if(s.multiaddrs.length<1){t("no valid addresses for provider %s. Ignore",n.toB58String());return}if(t("received provider %s for %s (addrs %s)",n.toB58String(),a.toBaseEncodedString(),s.multiaddrs.map(c=>c.toString())),!e._isSelf(s.id))return e.peerStore.addressBook.add(s.id,s.multiaddrs),e.providers.addProvider(a,s.id)}),e.providers.addProvider(a,n)}},VP=e=>{const t=ve.logger(e.peerId,"rpc:get-providers");return async function(n,i){let a;try{a=new io(i.key)}catch(f){throw U(new Error(`Invalid CID: ${f.message}`),"ERR_INVALID_CID")}t("%s",a.toBaseEncodedString());const s=ve.bufferToKey(a.bytes),[c,o,u]=await Promise.all([e.datastore.has(s),e.providers.getProviders(a),e._betterPeersToQuery(i,n)]),l=o.map(f=>({id:f})),h=u.map(f=>({id:f.id}));c&&l.push({id:e.peerId});const w=new _t(i.type,i.key,i.clusterLevel);return l.length>0&&(w.providerPeers=l),h.length>0&&(w.closerPeers=h),t("got %s providers %s closerPeers",l.length,h.length),w}},HP=e=>{const t=ve.logger(e.peerId,"rpc:ping");return function(n,i){return t("from %s",n.toB58String()),i}};const Qa=_t.TYPES;var zP=e=>{const t={[Qa.GET_VALUE]:FP(e),[Qa.PUT_VALUE]:qP(e),[Qa.FIND_NODE]:GP(e),[Qa.ADD_PROVIDER]:$P(e),[Qa.GET_PROVIDERS]:VP(e),[Qa.PING]:HP(e)};return function(n){return t[n]}},KP=e=>{const t=ve.logger(e.peerId,"rpc"),r=zP(e);async function n(i,a){const s=r(a.type);try{await e._add(i)}catch(c){t.error("Failed to update the kbucket store",c)}if(!s){t.error(`no handler found for message type: ${a.type}`);return}return s(i,a)}return async function({stream:a,connection:s}){const c=s.remotePeer;try{await e._add(c)}catch(u){t.error(u)}const o=c.toB58String();t("from: %s",o),await bt(a.source,Je.decode(),u=>async function*(){for await(const l of u){const h=_t.deserialize(l.slice()),w=await n(c,h);w&&(yield w.serialize())}}(),Je.encode(),a.sink)}};const{consume:WP}=Po;class XP{constructor(e){this.dht=e,this.readMessageTimeout=st.READ_MESSAGE_TIMEOUT,this._log=ve.logger(this.dht.peerId,"net"),this._rpc=KP(this.dht),this._onPeerConnected=this._onPeerConnected.bind(this),this._running=!1}async start(){if(this._running)return;if(!this.dht.isStarted)throw U(new Error("Can not start network"),"ERR_CANNOT_START_NETWORK");this._running=!0,this.dht._clientMode===!1&&this.dht.registrar.handle(st.PROTOCOL_DHT,this._rpc);const e=new xP({multicodecs:[st.PROTOCOL_DHT],handlers:{onConnect:this._onPeerConnected,onDisconnect:()=>{}}});this._registrarId=await this.dht.registrar.register(e)}async stop(){if(!this.dht.isStarted&&!this.isStarted)return;this._running=!1,await this.dht.registrar.unregister(this._registrarId)}get isStarted(){return this._running}get isConnected(){return this.dht.isStarted&&this.isStarted}async _onPeerConnected(e){await this.dht._add(e),this._log("added to the routing table: %s",e.toB58String())}async sendRequest(e,t){if(!this.isConnected)throw U(new Error("Network is offline"),"ERR_NETWORK_OFFLINE");const r=e.toB58String();this._log("sending to: %s",r);let n=this.dht.registrar.connectionManager.get(e);n||(n=await this.dht.dialer.connectToPeer(e));const{stream:i}=await n.newStream(st.PROTOCOL_DHT);return this._writeReadMessage(i,t.serialize())}async sendMessage(e,t){if(!this.isConnected)throw U(new Error("Network is offline"),"ERR_NETWORK_OFFLINE");const r=e.toB58String();this._log("sending to: %s",r);let n=this.dht.registrar.connectionManager.get(e);n||(n=await this.dht.dialer.connectToPeer(e));const{stream:i}=await n.newStream(st.PROTOCOL_DHT);return this._writeMessage(i,t.serialize())}async _writeReadMessage(e,t){return kn(QP(e,t),this.readMessageTimeout)}_writeMessage(e,t){return bt([t],Je.encode(),e,WP)}}async function QP(e,t){const r=await bt([t],Je.encode(),e,Je.decode(),async n=>{for await(const i of n)return i.slice()});if(r.length===0)throw U(new Error("No message received"),"ERR_NO_MESSAGE_RECEIVED");return _t.deserialize(r)}var YP=XP;class JP{constructor(e,t){this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peerId)}async add(e){if(this.peerDistances.find(n=>ir(n.peerId.id,e.id)))return;const t=await ve.convertPeerId(e),r={peerId:e,distance:ia(this.originDhtKey,t)};this.peerDistances.push(r),this.peerDistances.sort((n,i)=>ia.compare(n.distance,i.distance)),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async anyCloser(e){if(!e.length)return!1;if(!this.length)return!0;const t=await ng(e,n=>ve.convertPeerId(n)),r=this.peerDistances[this.peerDistances.length-1].distance;for(const n of t){const i=ia(this.originDhtKey,n);if(ia.compare(i,r)<0)return!0}return!1}}var ZP=JP,eN=re(function(e,t){(function(){var r,n,i,a,s,c,o,u,l,h,w,f,A,p,y;i=Math.floor,h=Math.min,n=function(v,O){return v<O?-1:v>O?1:0},l=function(v,O,R,m,g){var S;if(R==null&&(R=0),g==null&&(g=n),R<0)throw new Error("lo must be non-negative");for(m==null&&(m=v.length);R<m;)S=i((R+m)/2),g(O,v[S])<0?m=S:R=S+1;return[].splice.apply(v,[R,R-R].concat(O)),O},c=function(v,O,R){return R==null&&(R=n),v.push(O),p(v,0,v.length-1,R)},s=function(v,O){var R,m;return O==null&&(O=n),R=v.pop(),v.length?(m=v[0],v[0]=R,y(v,0,O)):m=R,m},u=function(v,O,R){var m;return R==null&&(R=n),m=v[0],v[0]=O,y(v,0,R),m},o=function(v,O,R){var m;return R==null&&(R=n),v.length&&R(v[0],O)<0&&(m=[v[0],O],O=m[0],v[0]=m[1],y(v,0,R)),O},a=function(v,O){var R,m,g,S,d,b;for(O==null&&(O=n),S=function(){b=[];for(var E=0,_=i(v.length/2);0<=_?E<_:E>_;0<=_?E++:E--)b.push(E);return b}.apply(this).reverse(),d=[],m=0,g=S.length;m<g;m++)R=S[m],d.push(y(v,R,O));return d},A=function(v,O,R){var m;return R==null&&(R=n),m=v.indexOf(O),m===-1?void 0:(p(v,0,m,R),y(v,m,R))},w=function(v,O,R){var m,g,S,d,b;if(R==null&&(R=n),g=v.slice(0,O),!g.length)return g;for(a(g,R),b=v.slice(O),S=0,d=b.length;S<d;S++)m=b[S],o(g,m,R);return g.sort(R).reverse()},f=function(v,O,R){var m,g,S,d,b,E,_,P,M,j;if(R==null&&(R=n),O*10<=v.length){if(d=v.slice(0,O).sort(R),!d.length)return d;for(S=d[d.length-1],P=v.slice(O),b=0,_=P.length;b<_;b++)m=P[b],R(m,S)<0&&(l(d,m,0,null,R),d.pop(),S=d[d.length-1]);return d}for(a(v,R),j=[],g=E=0,M=h(O,v.length);0<=M?E<M:E>M;g=0<=M?++E:--E)j.push(s(v,R));return j},p=function(v,O,R,m){var g,S,d;for(m==null&&(m=n),g=v[R];R>O;){if(d=R-1>>1,S=v[d],m(g,S)<0){v[R]=S,R=d;continue}break}return v[R]=g},y=function(v,O,R){var m,g,S,d,b;for(R==null&&(R=n),g=v.length,b=O,S=v[O],m=2*O+1;m<g;)d=m+1,d<g&&!(R(v[m],v[d])<0)&&(m=d),v[O]=v[m],O=m,m=2*O+1;return v[O]=S,p(v,b,O,R)},r=function(){v.push=c,v.pop=s,v.replace=u,v.pushpop=o,v.heapify=a,v.updateItem=A,v.nlargest=w,v.nsmallest=f;function v(O){this.cmp=O??n,this.nodes=[]}return v.prototype.push=function(O){return c(this.nodes,O,this.cmp)},v.prototype.pop=function(){return s(this.nodes,this.cmp)},v.prototype.peek=function(){return this.nodes[0]},v.prototype.contains=function(O){return this.nodes.indexOf(O)!==-1},v.prototype.replace=function(O){return u(this.nodes,O,this.cmp)},v.prototype.pushpop=function(O){return o(this.nodes,O,this.cmp)},v.prototype.heapify=function(){return a(this.nodes,this.cmp)},v.prototype.updateItem=function(O){return A(this.nodes,O,this.cmp)},v.prototype.clear=function(){return this.nodes=[]},v.prototype.empty=function(){return this.nodes.length===0},v.prototype.size=function(){return this.nodes.length},v.prototype.clone=function(){var O;return O=new v,O.nodes=this.nodes.slice(0),O},v.prototype.toArray=function(){return this.nodes.slice(0)},v.prototype.insert=v.prototype.push,v.prototype.top=v.prototype.peek,v.prototype.front=v.prototype.peek,v.prototype.has=v.prototype.contains,v.prototype.copy=v.prototype.clone,v}(),function(v,O){return e.exports=O()}(this,function(){return r})}).call(ge)}),tN=eN;const Kl=te("libp2p:dht:peer-queue");class Wl{static async fromPeerId(e){const t=await ve.convertPeerId(e);return new Wl(t)}static async fromKey(e){const t=await ve.convertBuffer(e);return new Wl(t)}constructor(e){Kl("create: %b",e),this.from=e,this.heap=new tN(ve.xorCompare)}async enqueue(e){Kl("enqueue %s",e.toB58String());const t=await ve.convertPeerId(e),r={id:e,distance:ia(this.from,t)};this.heap.push(r)}dequeue(){const e=this.heap.pop();return Kl("dequeue %s",e.id.toB58String()),e.id}get length(){return this.heap.size()}}var rN=Wl;const nN=3e4;class iN{constructor(e,t){if(this.run=e,this.queryFunc=ve.withTimeout(t,nN),!this.queryFunc)throw new Error("Path requires a `queryFn` to be specified");if(typeof this.queryFunc!="function")throw new Error("Path expected `queryFn` to be a function. Got "+typeof this.queryFunc);this.initialPeers=[],this.peersToQuery=null}addInitialPeer(e){this.initialPeers.push(e)}async execute(){const e=await rN.fromKey(this.run.query.key);this.peersToQuery=e,await Promise.all(this.initialPeers.map(t=>this.addPeerToQuery(t))),await this.run.workerQueue(this)}async addPeerToQuery(e){if(this.run.query.dht._isSelf(e))return;if(this.run.peersSeen.has(e.toB58String()))return;await this.peersToQuery.enqueue(e)}}var aN=iN;function sN(e,t,r,n){for(var i=e.length,a=r+(n?1:-1);n?a--:++a<i;)if(t(e[a],a,e))return a;return-1}var oN=sN;function cN(e){return e!==e}var uN=cN;function lN(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}var dN=lN;function hN(e,t,r){return t===t?dN(e,t,r):oN(e,uN,r)}var pN=hN,fN=Array.isArray,mN=fN;function gN(){}var yN=gN,bN=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n){return function(){if(n===null)throw new Error("Callback was already called.");var i=n;n=null,i.apply(this,arguments)}}e.exports=t.default}),cg=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n,i){i=i|0;for(var a=Math.max(n.length-i,0),s=Array(a),c=0;c<a;c++)s[c]=n[i+c];return s}e.exports=t.default}),ug=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.hasNextTick=t.hasSetImmediate=void 0,t.fallback=s,t.wrap=c;var r=n(cg);function n(u){return u&&u.__esModule?u:{default:u}}var i=t.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,a=t.hasNextTick=typeof _e=="object"&&typeof _e.nextTick=="function";function s(u){setTimeout(u,0)}function c(u){return function(l){var h=(0,r.default)(arguments,1);u(function(){l.apply(null,h)})}}var o;i?o=setImmediate:a?o=_e.nextTick:o=s,t.default=c(o)}),vN=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(){this.head=this.tail=null,this.length=0}function n(i,a){i.length=1,i.head=i.tail=a}r.prototype.removeLink=function(i){return i.prev?i.prev.next=i.next:this.head=i.next,i.next?i.next.prev=i.prev:this.tail=i.prev,i.prev=i.next=null,this.length-=1,i},r.prototype.empty=function(){for(;this.head;)this.shift();return this},r.prototype.insertAfter=function(i,a){a.prev=i,a.next=i.next,i.next?i.next.prev=a:this.tail=a,i.next=a,this.length+=1},r.prototype.insertBefore=function(i,a){a.prev=i.prev,a.next=i,i.prev?i.prev.next=a:this.head=a,i.prev=a,this.length+=1},r.prototype.unshift=function(i){this.head?this.insertBefore(this.head,i):n(this,i)},r.prototype.push=function(i){this.tail?this.insertAfter(this.tail,i):n(this,i)},r.prototype.shift=function(){return this.head&&this.removeLink(this.head)},r.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)},r.prototype.toArray=function(){for(var i=Array(this.length),a=this.head,s=0;s<this.length;s++)i[s]=a.data,a=a.next;return i},r.prototype.remove=function(i){for(var a=this.head;a;){var s=a.next;i(a)&&this.removeLink(a),a=s}return this},e.exports=t.default});function wN(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var _N=wN,EN=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(i){return function(){var a=(0,r.default)(arguments),s=a.pop();i.call(this,a,s)}};var r=n(cg);function n(i){return i&&i.__esModule?i:{default:i}}e.exports=t.default}),SN=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var r=a(_N),n=a(EN),i=a(ug);function a(u){return u&&u.__esModule?u:{default:u}}function s(u){return(0,n.default)(function(l,h){var w;try{w=u.apply(this,l)}catch(f){return h(f)}(0,r.default)(w)&&typeof w.then=="function"?w.then(function(f){c(h,null,f)},function(f){c(h,f.message?f:new Error(f))}):h(null,w)})}function c(u,l,h){try{u(l,h)}catch(w){(0,i.default)(o,w)}}function o(u){throw u}e.exports=t.default}),lg=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isAsync=void 0;var r=n(SN);function n(c){return c&&c.__esModule?c:{default:c}}var i=typeof Symbol=="function";function a(c){return i&&c[Symbol.toStringTag]==="AsyncFunction"}function s(c){return a(c)?(0,r.default)(c):c}t.default=s,t.isAsync=a}),AN=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=l;var r=u(pN),n=u(mN),i=u(yN),a=u(bN),s=u(ug),c=u(vN),o=u(lg);function u(h){return h&&h.__esModule?h:{default:h}}function l(h,w,f){if(w==null)w=1;else if(w===0)throw new Error("Concurrency must not be zero");var A=(0,o.default)(h),p=0,y=[],v=!1;function O(S,d,b){if(b!=null&&typeof b!="function")throw new Error("task callback must be a function");if(g.started=!0,(0,n.default)(S)||(S=[S]),S.length===0&&g.idle())return(0,s.default)(function(){g.drain()});for(var E=0,_=S.length;E<_;E++){var P={data:S[E],callback:b||i.default};d?g._tasks.unshift(P):g._tasks.push(P)}v||(v=!0,(0,s.default)(function(){v=!1,g.process()}))}function R(S){return function(d){p-=1;for(var b=0,E=S.length;b<E;b++){var _=S[b],P=(0,r.default)(y,_,0);P===0?y.shift():P>0&&y.splice(P,1),_.callback.apply(_,arguments),d!=null&&g.error(d,_.data)}p<=g.concurrency-g.buffer&&g.unsaturated(),g.idle()&&g.drain(),g.process()}}var m=!1,g={_tasks:new c.default,concurrency:w,payload:f,saturated:i.default,unsaturated:i.default,buffer:w/4,empty:i.default,drain:i.default,error:i.default,started:!1,paused:!1,push:function(S,d){O(S,!1,d)},kill:function(){g.drain=i.default,g._tasks.empty()},unshift:function(S,d){O(S,!0,d)},remove:function(S){g._tasks.remove(S)},process:function(){if(m)return;for(m=!0;!g.paused&&p<g.concurrency&&g._tasks.length;){var S=[],d=[],b=g._tasks.length;g.payload&&(b=Math.min(b,g.payload));for(var E=0;E<b;E++){var _=g._tasks.shift();S.push(_),y.push(_),d.push(_.data)}p+=1,g._tasks.length===0&&g.empty(),p===g.concurrency&&g.saturated();var P=(0,a.default)(R(S));A(d,P)}m=!1},length:function(){return g._tasks.length},running:function(){return p},workersList:function(){return y},idle:function(){return g._tasks.length+p===0},pause:function(){g.paused=!0},resume:function(){if(g.paused===!1)return;g.paused=!1,(0,s.default)(g.process)}};return g}e.exports=t.default}),TN=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(a,s){var c=(0,n.default)(a);return(0,r.default)(function(o,u){c(o[0],u)},s,1)};var r=i(AN),n=i(lg);function i(a){return a&&a.__esModule?a:{default:a}}e.exports=t.default}),IN=Object.prototype.toString,CN=function(e){return IN.call(e)==="[object Function]"},dg=typeof setImmediate=="function"?setImmediate:function(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)},kN=function(e){if(!CN(e.then))throw new TypeError("Expected a promise");return function(t){e.then(function(r){dg(t,null,r)},function(r){dg(t,r)})}};class RN{constructor(e,t,r,n){this.dht=e,this.run=t,this.path=r,this.log=n,this.concurrency=this.dht.concurrency,this.queue=this.setupQueue(),this.execution=null}setupQueue(){const e=TN((t,r)=>{kN(this.processNext(t))(r)},this.concurrency);return e.error=t=>{this.log.error("queue",t),this.stop(t)},e.drain=()=>{this.log("queue:drain"),this.stop()},e.unsaturated=()=>{this.running&&this.fill()},e.buffer=0,e}stop(e){if(!this.running)return;this.running=!1,this.queue.kill(),this.log("worker:stop, %d workers still running",this.run.workers.filter(t=>t.running).length),e?this.execution.reject(e):this.execution.resolve()}async execute(){this.running=!0,this.execution={};const e=new Promise((t,r)=>Object.assign(this.execution,{resolve:t,reject:r}));this.fill(),await e}fill(){for(;this.queue.running()+this.queue.length()<this.concurrency&&this.path.peersToQuery.length>0;)this.queue.push(this.path.peersToQuery.dequeue())}async processNext(e){if(!this.running)return;if(this.run.peersSeen.has(e.toB58String()))return;let t,r;try{t=await this.run.continueQuerying(this)}catch(a){r=a}if(!this.running)return;if(r)throw r;if(!t){this.stop();return}if(this.run.peersSeen.has(e.toB58String()))return;this.run.peersSeen.add(e.toB58String()),this.log("queue:work");let n,i;try{n=await this.execQuery(e)}catch(a){i=a}if(!this.running)return;if(this.log("queue:work:done",i,n),i)throw i;if(n&&n.queryComplete){this.log("query:complete"),this.run.stop();return}n&&n.pathComplete&&this.stop()}async execQuery(e){let t,r;try{t=await this.path.queryFunc(e)}catch(n){r=n}if(!this.running)return;if(r){this.run.errors.push(r);return}if(await this.run.peersQueried.add(e),t.pathComplete||t.queryComplete)return this.path.res=t,{pathComplete:t.pathComplete,queryComplete:t.queryComplete};t.closerPeers&&t.closerPeers.length>0&&await Promise.all(t.closerPeers.map(async n=>{if(this.dht._isSelf(n.id))return;this.dht._peerDiscovered(n.id,n.multiaddrs),await this.path.addPeerToQuery(n.id)}))}}var PN=RN;class NN extends At{constructor(e){super();this.query=e,this.running=!1,this.workers=[],this.peersSeen=new Set,this.errors=[],this.peersQueried=null}stop(){if(!this.running)return;this.running=!1;for(const e of this.workers)e.stop()}async execute(e){const t=[],r=Math.min(this.query.dht.disjointPaths,e.length);for(let i=0;i<r;i++)t.push(new aN(this,this.query.makePath(i,r)));e.forEach((i,a)=>{t[a%r].addInitialPeer(i)}),await this.executePaths(t);const n={finalSet:new Set(this.peersQueried.peers),paths:[]};for(const i of t)i.res&&(i.res.pathComplete||i.res.queryComplete)&&(i.res.success=!0,n.paths.push(i.res));return n}async executePaths(e){this.running=!0,this.emit("start");try{await Promise.all(e.map(t=>t.execute()))}finally{this.stop(),this.emit("complete")}if(this.errors.length===this.peersSeen.size)throw this.errors[0]}async workerQueue(e){await this.init(),await this.startWorker(e)}async startWorker(e){const t=new PN(this.query.dht,this,e,this.query._log);this.workers.push(t),await t.execute()}async init(){if(this.peersQueried)return;if(this.peersQueriedPromise){await this.peersQueriedPromise;return}this.peersQueriedPromise=(async()=>{const e=await ve.convertBuffer(this.query.key);this.peersQueried=new ZP(e,this.query.dht.kBucketSize)})(),await this.peersQueriedPromise,delete this.peersQueriedPromise}async continueQuerying(e){if(this.peersQueried.length<this.peersQueried.capacity)return!0;const t=e.queue.workersList().map(n=>n.data),r=await this.peersQueried.anyCloser(t);return!!r}}var ON=NN;const DN=ta.multihash;class MN{constructor(e,t,r){this.dht=e,this.key=t,this.makePath=r,this._log=ve.logger(this.dht.peerId,"query:"+DN.toB58String(t)),this.running=!1,this._onStart=this._onStart.bind(this),this._onComplete=this._onComplete.bind(this)}async run(e){return this.dht._queryManager.running?e.length===0?(this._log.error("Running query with no peers"),{finalSet:new Set,paths:[]}):(this._run=new ON(this),this._log(`query running with K=${this.dht.kBucketSize}, A=${this.dht.concurrency}, D=${Math.min(this.dht.disjointPaths,e.length)}`),this._run.once("start",this._onStart),this._run.once("complete",this._onComplete),this._run.execute(e)):(this._log.error("Attempt to run query after shutdown"),{finalSet:new Set,paths:[]})}_onStart(){this.running=!0,this._startTime=Date.now(),this._log("query:start"),this.dht._queryManager.queryStarted(this)}_onComplete(){this.stop()}stop(){if(this._log(`query:done in ${Date.now()-this._startTime}ms`),this._run&&this._log(`${this._run.errors.length} of ${this._run.peersSeen.size} peers errored (${this._run.errors.length/this._run.peersSeen.size*100}% fail rate)`),!this.running)return;this._run.removeListener("start",this._onStart),this._run.removeListener("complete",this._onComplete),this.running=!1,this._run&&this._run.stop(),this.dht._queryManager.queryCompleted(this)}}var Nc=MN;const xN=Dn.Record;var BN=e=>{const t=async(i,a)=>e.datastore.put(ve.bufferToKey(i),a),r=async i=>{e._log("getLocal %b",i);const a=await e.datastore.get(ve.bufferToKey(i));e._log("found %b in local datastore",i);const s=xN.deserialize(a);return await e._verifyRecordLocally(s),s},n=async(i,a,s)=>{const c=await ve.createPutRecord(i,s);return Promise.all(a.map(async o=>{if(ir(o.val,s))return;if(e._isSelf(o.from)){try{await e._putLocal(i,c)}catch(u){e._log.error("Failed error correcting self",u)}return}try{await e._putValueToPeer(i,c,o.from)}catch(u){e._log.error("Failed error correcting entry",u)}}))};return{async _putLocal(i,a){return t(i,a)},async put(i,a,s={}){e._log("PutValue %b",i);const c=await ve.createPutRecord(i,a);await t(i,c);let o=0,u=0;await ve.mapParallel(e.getClosestPeers(i,{shallow:!0}),async h=>{try{o+=1,await e._putValueToPeer(i,c,h),u+=1}catch(w){e._log.error("Failed to put to peer (%b): %s",h.id,w)}});const l=s.minPeers||o;if(l>u){const h=U(new Error(`Failed to put value to enough peers: ${u}/${l}`),"ERR_NOT_ENOUGH_PUT_PEERS");throw e._log.error(h),h}},async get(i,a={}){a.timeout=a.timeout||st.minute,e._log("_get %b",i);const s=await e.getMany(i,st.GET_MANY_RECORD_COUNT,a),c=s.map(l=>l.val);let o=0;try{o=Dn.selection.bestRecord(e.selectors,i,c)}catch(l){if(l.code!=="ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")throw l}const u=c[o];if(e._log("GetValue %b %s",i,u),!u)throw U(new Error("best value was not found"),"ERR_NOT_FOUND");return await n(i,s,u),u},async getMany(i,a,s={}){s.timeout=s.timeout||st.minute,e._log("getMany %b (%s)",i,a);let c=[],o;try{o=await r(i)}catch(A){if(a===0)throw A}if(o&&c.push({val:o.value,from:e.peerId}),c.length>=a)return c;const u=[],l=await ve.convertBuffer(i),h=e.routingTable.closestPeers(l,this.kBucketSize);if(e._log("peers in rt: %d",h.length),h.length===0){const A="Failed to lookup key! No peers from routing table!";if(e._log.error(A),c.length===0)throw U(new Error(A),"ERR_NO_PEERS_IN_ROUTING_TABLE");return c}const w=new Nc(e,i,(A,p)=>{const y=ve.pathSize(a-c.length,p),v=[];return u.push(v),async O=>{let R,m,g;try{const d=await e._getValueOrPeers(O,i);R=d.record,m=d.peers}catch(d){if(d.code!=="ERR_INVALID_RECORD")throw d;g=d}const S={closerPeers:m};return(R&&R.value||g)&&v.push({val:R&&R.value,from:O}),v.length>=y&&(S.pathComplete=!0),S}});let f;try{await kn(w.run(h),s.timeout)}catch(A){f=A}if(w.stop(),c=[].concat.apply(c,u).slice(0,a),f&&c.length===0)throw f;return c}}};class LN{constructor(){this.list=[]}push(e){return this.has(e.id)?!1:(this.list.push(e),!0)}has(e){const t=this.list.find(r=>r.id.isEqual(e));return Boolean(t)}toArray(){return this.list.slice()}pop(){return this.list.pop()}get length(){return this.list.length}}var jN=LN;class UN extends jN{constructor(e){super();this.limit=e}push(e){return this.length<this.limit?super.push(e):!1}}var hg=UN,FN=e=>{const t=async(r,n)=>{const i=new _t(_t.TYPES.GET_PROVIDERS,n.bytes,0);return e.network.sendRequest(r,i)};return{async provide(r){e._log("provide: %s",r.toBaseEncodedString());const n=[];await e.providers.addProvider(r,e.peerId);const i=e.libp2p?e.libp2p.multiaddrs:[],a=new _t(_t.TYPES.ADD_PROVIDER,r.bytes,0);if(a.providerPeers=[{id:e.peerId,multiaddrs:i}],await ve.mapParallel(e.getClosestPeers(r.bytes),async s=>{e._log("putProvider %s to %s",r.toBaseEncodedString(),s.toB58String());try{await e.network.sendMessage(s,a)}catch(c){n.push(c)}}),n.length)throw U(new Error(`Failed to provide to ${n.length} of ${e.kBucketSize} peers`,"ERR_SOME_PROVIDES_FAILED"),{errors:n})},async*findProviders(r,n={}){const i=n.timeout||st.minute,a=n.maxNumProviders||st.K;e._log("findProviders %s",r.toBaseEncodedString());const s=new hg(a),c=await e.providers.getProviders(r);if(c.forEach(h=>{const w=e.peerStore.get(h)||{};s.push({id:w.id||h,multiaddrs:(w.addresses||[]).map(f=>f.multiaddr)})}),s.length>=a){for(const h of s.toArray())yield h;return}const o=[],u=new Nc(e,r.bytes,(h,w)=>{const f=ve.pathSize(a-s.length,w),A=new hg(f);return o.push(A),async p=>{const y=await t(p,r),v=y.providerPeers;return e._log("(%s) found %s provider entries",e.peerId.toB58String(),v.length),v.forEach(O=>{A.push({id:O.id})}),A.length>=f?{pathComplete:!0}:{closerPeers:y.closerPeers}}}),l=e.routingTable.closestPeers(r.bytes,e.kBucketSize);try{await kn(u.run(l),i)}catch(h){if(h.name!==kn.TimeoutError.name)throw h}finally{u.stop()}if(o.forEach(h=>{h.toArray().forEach(w=>{s.push(w)})}),s.length===0)throw U(new Error("no providers found"),"ERR_NOT_FOUND");for(const h of s.toArray())yield h}}},qN=e=>{const t=async a=>{e._log("findPeerLocal %s",a.toB58String());const s=await e.routingTable.find(a),c=s&&e.peerStore.get(s);if(c)return{id:c.id,multiaddrs:c.addresses.map(o=>o.multiaddr)}},r=async(a,s)=>{const c=new _t(_t.TYPES.GET_VALUE,s,0);return e.network.sendRequest(a,c)},n=async(a,s)=>{e._log("closerPeersSingle %b from %s",a,s.toB58String());const c=await e.peerRouting._findPeerSingle(s,new we(a));return c.closerPeers.filter(o=>!e._isSelf(o.id)).map(o=>(e.peerStore.addressBook.add(o.id,o.multiaddrs),o))},i=async a=>{const s=ve.keyForPublicKey(a),c=await r(a,s);if(!c.record||!c.record.value)throw U(`Node not responding with its public key: ${a.toB58String()}`,"ERR_INVALID_RECORD");const o=we.createFromPubKey(c.record.value);if(!o.isEqual(a))throw U("public key does not match id","ERR_PUBLIC_KEY_DOES_NOT_MATCH_ID");return o.pubKey};return{async _findPeerSingle(a,s){e._log("findPeerSingle %s",a.toB58String());const c=new _t(_t.TYPES.FIND_NODE,s.id,0);return e.network.sendRequest(a,c)},async findPeer(a,s={}){s.timeout=s.timeout||st.minute,e._log("findPeer %s",a.toB58String());const c=await t(a);if(c!=null)return e._log("found local"),c;const o=await ve.convertPeerId(a),u=e.routingTable.closestPeers(o,e.kBucketSize);if(u.length===0)throw U(new Error("Peer lookup failed"),"ERR_LOOKUP_FAILED");const l=u.find(y=>y.isEqual(a));if(l){const y=e.peerStore.get(a);if(y)return e._log("found in peerStore"),{id:y.id,multiaddrs:y.addresses.map(v=>v.multiaddr)}}const h=new Nc(e,a.id,()=>async y=>{const v=await this._findPeerSingle(y,a),O=v.closerPeers.find(R=>R.id.isEqual(a));return O?{peer:O,queryComplete:!0}:{closerPeers:v.closerPeers}});let w,f;try{f=await kn(h.run(u),s.timeout)}catch(y){w=y}if(h.stop(),w)throw w;let A=!1;if(f.paths.forEach(y=>{y.success&&(A=!0,e.peerStore.addressBook.add(y.peer.id,y.peer.multiaddrs))}),e._log("findPeer %s: %s",a.toB58String(),A),!A)throw U(new Error("No peer found"),"ERR_NOT_FOUND");const p=e.peerStore.get(a);return{id:p.id,multiaddrs:p.addresses.map(y=>y.multiaddr)}},async*getClosestPeers(a,s={shallow:!1}){e._log("getClosestPeers to %b",a);const c=await ve.convertBuffer(a),o=e.routingTable.closestPeers(c,e.kBucketSize),u=new Nc(e,a,()=>async w=>{const f=await n(a,w);return{closerPeers:f,pathComplete:s.shallow?!0:void 0}}),l=await u.run(o);if(!l||!l.finalSet)return[];const h=await ve.sortClosestPeers(Array.from(l.finalSet),c);for(const w of h.slice(0,e.kBucketSize))yield w},async getPublicKey(a){e._log("getPublicKey %s",a.toB58String());const s=e.peerStore.get(a);if(s&&s.id.pubKey)return e._log("getPublicKey: found local copy"),s.id.pubKey;let c;try{c=await i(a)}catch(u){const l=ve.keyForPublicKey(a),h=await e.get(l);c=sr.keys.unmarshalPublicKey(h)}s.id=new we(a.id,null,c);const o=s.addresses.map(u=>u.multiaddr);return e.peerStore.addressBook.add(s.id,o),e.peerStore.keyBook.set(s.id,c),c}}},GN=re(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function i(o,u,l){this.fn=o,this.context=u,this.once=l||!1}function a(o,u,l,h,w){if(typeof l!="function")throw new TypeError("The listener must be a function");var f=new i(l,h||o,w),A=r?r+u:u;return o._events[A]?o._events[A].fn?o._events[A]=[o._events[A],f]:o._events[A].push(f):(o._events[A]=f,o._eventsCount++),o}function s(o,u){--o._eventsCount===0?o._events=new n:delete o._events[u]}function c(){this._events=new n,this._eventsCount=0}c.prototype.eventNames=function(){var u=[],l,h;if(this._eventsCount===0)return u;for(h in l=this._events)t.call(l,h)&&u.push(r?h.slice(1):h);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},c.prototype.listeners=function(u){var l=r?r+u:u,h=this._events[l];if(!h)return[];if(h.fn)return[h.fn];for(var w=0,f=h.length,A=new Array(f);w<f;w++)A[w]=h[w].fn;return A},c.prototype.listenerCount=function(u){var l=r?r+u:u,h=this._events[l];return h?h.fn?1:h.length:0},c.prototype.emit=function(u,l,h,w,f,A){var p=r?r+u:u;if(!this._events[p])return!1;var y=this._events[p],v=arguments.length,O,R;if(y.fn){y.once&&this.removeListener(u,y.fn,void 0,!0);switch(v){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,l),!0;case 3:return y.fn.call(y.context,l,h),!0;case 4:return y.fn.call(y.context,l,h,w),!0;case 5:return y.fn.call(y.context,l,h,w,f),!0;case 6:return y.fn.call(y.context,l,h,w,f,A),!0}for(R=1,O=new Array(v-1);R<v;R++)O[R-1]=arguments[R];y.fn.apply(y.context,O)}else{var m=y.length,g;for(R=0;R<m;R++){y[R].once&&this.removeListener(u,y[R].fn,void 0,!0);switch(v){case 1:y[R].fn.call(y[R].context);break;case 2:y[R].fn.call(y[R].context,l);break;case 3:y[R].fn.call(y[R].context,l,h);break;case 4:y[R].fn.call(y[R].context,l,h,w);break;default:if(!O)for(g=1,O=new Array(v-1);g<v;g++)O[g-1]=arguments[g];y[R].fn.apply(y[R].context,O)}}}return!0},c.prototype.on=function(u,l,h){return a(this,u,l,h,!1)},c.prototype.once=function(u,l,h){return a(this,u,l,h,!0)},c.prototype.removeListener=function(u,l,h,w){var f=r?r+u:u;if(!this._events[f])return this;if(!l)return s(this,f),this;var A=this._events[f];if(A.fn)A.fn===l&&(!w||A.once)&&(!h||A.context===h)&&s(this,f);else{for(var p=0,y=[],v=A.length;p<v;p++)(A[p].fn!==l||w&&!A[p].once||h&&A[p].context!==h)&&y.push(A[p]);y.length?this._events[f]=y.length===1?y[0]:y:s(this,f)}return this},c.prototype.removeAllListeners=function(u){var l;return u?(l=r?r+u:u,this._events[l]&&s(this,l)):(this._events=new n,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=r,c.EventEmitter=c,e.exports=c}),$N=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function r(n,i,a){let s=0,c=n.length;for(;c>0;){const o=c/2|0;let u=s+o;a(n[u],i)<=0?(s=++u,c-=o+1):c=o}return s}t.default=r}),VN=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this._queue=[]}enqueue(n,i){i=Object.assign({priority:0},i);const a={priority:i.priority,run:n};if(this.size&&this._queue[this.size-1].priority>=i.priority){this._queue.push(a);return}const s=$N.default(this._queue,a,(c,o)=>o.priority-c.priority);this._queue.splice(s,0,a)}dequeue(){const n=this._queue.shift();return n==null?void 0:n.run}filter(n){return this._queue.filter(i=>i.priority===n.priority).map(i=>i.run)}get size(){return this._queue.length}}t.default=r}),HN=re(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const r=()=>{},n=new kn.TimeoutError;class i extends GN{constructor(a){var s,c,o,u;super();if(this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=r,this._resolveIdle=r,a=Object.assign({carryoverConcurrencyCount:!1,intervalCap:Infinity,interval:0,concurrency:Infinity,autoStart:!0,queueClass:VN.default},a),!(typeof a.intervalCap=="number"&&a.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(c=(s=a.intervalCap)===null||s===void 0?void 0:s.toString())!==null&&c!==void 0?c:""}\` (${typeof a.intervalCap})`);if(a.interval===void 0||!(Number.isFinite(a.interval)&&a.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(u=(o=a.interval)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:""}\` (${typeof a.interval})`);this._carryoverConcurrencyCount=a.carryoverConcurrencyCount,this._isIntervalIgnored=a.intervalCap===Infinity||a.interval===0,this._intervalCap=a.intervalCap,this._interval=a.interval,this._queue=new a.queueClass,this._queueClass=a.queueClass,this.concurrency=a.concurrency,this._timeout=a.timeout,this._throwOnTimeout=a.throwOnTimeout===!0,this._isPaused=a.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=r,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=r,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const a=Date.now();if(this._intervalId===void 0){const s=this._intervalEnd-a;if(s<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},s)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const a=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const s=this._queue.dequeue();return s?(this.emit("active"),s(),a&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){if(this._isIntervalIgnored||this._intervalId!==void 0)return;this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(a){if(!(typeof a=="number"&&a>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${a}\` (${typeof a})`);this._concurrency=a,this._processQueue()}async add(a,s={}){return new Promise((c,o)=>{const u=async()=>{this._pendingCount++,this._intervalCount++;try{const l=this._timeout===void 0&&s.timeout===void 0?a():kn.default(Promise.resolve(a()),s.timeout===void 0?this._timeout:s.timeout,()=>{(s.throwOnTimeout===void 0?this._throwOnTimeout:s.throwOnTimeout)&&o(n);return});c(await l)}catch(l){o(l)}this._next()};this._queue.enqueue(u,s),this._tryToStartAnother(),this.emit("add")})}async addAll(a,s){return Promise.all(a.map(async c=>this.add(c,s)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){return this._queue.size===0?void 0:new Promise(a=>{const s=this._resolveEmpty;this._resolveEmpty=()=>{s(),a()}})}async onIdle(){return this._pendingCount===0&&this._queue.size===0?void 0:new Promise(a=>{const s=this._resolveIdle;this._resolveIdle=()=>{s(),a()}})}get size(){return this._queue.size}sizeBy(a){return this._queue.filter(a).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(a){this._timeout=a}}t.default=i});const{Key:zN}=Ea,{default:KN}=HN;class WN{constructor(e,t,r){this.datastore=e,this._log=ve.logger(t,"providers"),this.cleanupInterval=st.PROVIDERS_CLEANUP_INTERVAL,this.provideValidity=st.PROVIDERS_VALIDITY,this.lruCacheSize=r||st.PROVIDERS_LRU_CACHE_SIZE,this.providers=Gh(this.lruCacheSize),this.syncQueue=new KN({concurrency:1})}start(){this._cleaner=setInterval(()=>this._cleanup(),this.cleanupInterval)}stop(){clearInterval(this._cleaner),this._cleaner=null}_cleanup(){return this.syncQueue.add(async()=>{this._log("start cleanup");const e=Date.now();let t=0,r=0;const n=new Map,i=this.datastore.batch(),a=this.datastore.query({prefix:st.PROVIDERS_KEY_PREFIX});for await(const s of a)try{const{cid:c,peerId:o}=pg(s.key),u=fg(s.value),l=Date.now(),h=l-u,w=h>this.provideValidity;if(this._log("comparing: %d - %d = %d > %d %s",l,u,h,this.provideValidity,w?"(expired)":""),w){r++,i.delete(s.key);const f=n.get(c)||new Set;f.add(o),n.set(c,f)}t++}catch(c){this._log.error(c.message)}this._log("deleting %d / %d entries",r,t),n.size&&await i.commit();for(const[s,c]of n){const o=Ys(s),u=this.providers.get(o);if(u){for(const l of c)u.delete(l);u.size===0?this.providers.remove(o):this.providers.set(o,u)}}this._log("Cleanup successful (%dms)",Date.now()-e)})}async _getProvidersMap(e){const t=Ys(e);let r=this.providers.get(t);return r||(r=await QN(this.datastore,e),this.providers.set(t,r)),r}async addProvider(e,t){return this.syncQueue.add(async()=>{this._log("addProvider %s",e.toBaseEncodedString());const r=await this._getProvidersMap(e);this._log("loaded %s provs",r.size);const n=Date.now();r.set(ve.encodeBase32(t.id),n);const i=Ys(e);return this.providers.set(i,r),XN(this.datastore,e,t,n)})}async getProviders(e){return this.syncQueue.add(async()=>{this._log("getProviders %s",e.toBaseEncodedString());const t=await this._getProvidersMap(e);return[...t.keys()].map(r=>new we(ve.decodeBase32(r)))})}}function Ys(e){return e=typeof e=="string"?e:ve.encodeBase32(e.bytes),st.PROVIDERS_KEY_PREFIX+e}async function XN(e,t,r,n){const i=[Ys(t),"/",ve.encodeBase32(r.id)].join(""),a=new zN(i),s=Uint8Array.from($e.encode(n));return e.put(a,s)}function pg(e){const t=e.toString().split("/");if(t.length!==4)throw new Error("incorrectly formatted provider entry key in datastore: "+e);return{cid:t[2],peerId:t[3]}}async function QN(e,t){const r=new Map,n=e.query({prefix:Ys(t)});for await(const i of n){const{peerId:a}=pg(i.key);r.set(a,fg(i.value))}return r}function fg(e){return $e.decode(e)}var YN=WN,JN=async(e,t,{concurrency:r=Infinity,stopOnError:n=!0}={})=>new Promise((i,a)=>{if(typeof t!="function")throw new TypeError("Mapper function is required");if(!((Number.isSafeInteger(r)||r===Infinity)&&r>=1))throw new TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${r}\` (${typeof r})`);const s=[],c=[],o=e[Symbol.iterator]();let u=!1,l=!1,h=0,w=0;const f=()=>{if(u)return;const A=o.next(),p=w;if(w++,A.done){l=!0,h===0&&(!n&&c.length!==0?a(new so(c)):i(s));return}h++,(async()=>{try{const y=await A.value;s[p]=await t(y,p),h--,f()}catch(y){n?(u=!0,a(y)):(c.push(y),h--,f())}})()};for(let A=0;A<r&&!(f(),l);A++);});const mg=async(e,t,r)=>JN(new Array(e).fill(),(n,i)=>t(i),r);var gg=mg,ZN=mg;gg.default=ZN;const{logger:eO}=ve;class tO{constructor(e,t){if(!e)throw new Error("Random Walk needs an instance of the Kademlia DHT");this._kadDHT=e,this._options={...st.defaultRandomWalk,...t},this.log=eO(e.peerId,"random-walk"),this._timeoutId=void 0}start(){if(this._timeoutId||!this._options.enabled)return;this._timeoutId=setTimeout(()=>{this._runPeriodically()},this._options.delay)}stop(){this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0),this._controller&&this._controller.abort()}async _runPeriodically(){for(;this._timeoutId;){try{await this._walk(this._options.queriesPerPeriod,this._options.timeout)}catch(e){this._kadDHT._log.error("random-walk:error",e)}await new Promise(e=>{this._timeoutId=setTimeout(e,this._options.interval)})}}async _walk(e,t){this.log("start"),this._controller=new hi;try{await gg(e,async r=>{this.log("running query %d",r);try{const n=await this._randomPeerId();if(!this._controller)return;await this._query(n,{timeout:t,signal:this._controller.signal})}catch(n){if(n&&n.code!=="ETIMEDOUT")throw this.log.error("query %d finished with error",r,n),n}this.log("finished query %d",r)})}finally{this._controller=null,this.log("finished queries")}}async _query(e,t){this.log("query:%s",e.toB58String());let r;try{r=await this._kadDHT.findPeer(e,t)}catch(n){if(n&&n.code==="ERR_NOT_FOUND")return;throw n}throw this.log("query:found",r),U(`random-walk: ACTUALLY FOUND PEER: ${r}, ${e.toB58String()}`,"ERR_FOUND_RANDOM_PEER")}async _randomPeerId(){const e=await ta(sr.randomBytes(16),"sha2-256");return new we(e)}}var rO=tO;class nO{constructor(){this.queries=new Set,this.running=!1}queryStarted(e){this.queries.add(e)}queryCompleted(e){this.queries.delete(e)}start(){this.running=!0}stop(){this.running=!1;for(const e of this.queries)e.stop();this.queries.clear()}}var iO=nO;const{EventEmitter:aO}=At,{MemoryDatastore:sO}=Ea,yg=Dn.Record;class oO extends aO{constructor({libp2p:e,dialer:t,peerId:r,peerStore:n,registrar:i,datastore:a=new sO,kBucketSize:s=st.K,clientMode:c=!1,concurrency:o=st.ALPHA,validators:u={},selectors:l={},randomWalk:h={}}){super();if(!t)throw new Error("libp2p-kad-dht requires an instance of Dialer");this.libp2p=e,this.dialer=t,this.peerId=r,this.peerStore=n,this.registrar=i,this.kBucketSize=s,this._clientMode=c,this.concurrency=o,this.disjointPaths=Math.ceil(this.kBucketSize/2),this.routingTable=new NP(this.peerId,this.kBucketSize),this.datastore=a,this.providers=new YN(this.datastore,this.peerId),this.validators={pk:Dn.validator.validators.pk,...u},this.selectors={pk:Dn.selection.selectors.pk,...l},this.network=new YP(this),this._log=ve.logger(this.peerId),this.randomWalk=new rO(this,h),this._queryManager=new iO,this._running=!1,this.contentFetching=BN(this),this.contentRouting=FN(this),this.peerRouting=qN(this)}get isStarted(){return this._running}async start(){this._running=!0,this.providers.start(),this._queryManager.start(),await this.network.start(),this.randomWalk.start()}stop(){return this._running=!1,this.randomWalk.stop(),this.providers.stop(),this._queryManager.stop(),this.network.stop()}async put(e,t,r={}){return this.contentFetching.put(e,t,r)}async get(e,t={}){return this.contentFetching.get(e,t)}async getMany(e,t,r={}){return this.contentFetching.getMany(e,t,r)}async provide(e){return this.contentRouting.provide(e)}async*findProviders(e,t={}){for await(const r of this.contentRouting.findProviders(e,t))yield r}async findPeer(e,t={}){return this.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t={shallow:!1}){for await(const r of this.peerRouting.getClosestPeers(e,t))yield r}async getPublicKey(e){return this.peerRouting.getPublicKey(e)}_peerDiscovered(e,t){this.emit("peer",{id:e,multiaddrs:t})}async _nearestPeersToQuery(e){const t=await ve.convertBuffer(e.key),r=this.routingTable.closestPeers(t,this.kBucketSize);return r.map(n=>{const i=this.peerStore.get(n);return{id:n,multiaddrs:i?i.addresses.map(a=>a.multiaddr):[]}})}async _betterPeersToQuery(e,t){this._log("betterPeersToQuery");const r=await this._nearestPeersToQuery(e);return r.filter(n=>this._isSelf(n.id)?(this._log.error("trying to return self as closer"),!1):!n.id.isEqual(t))}async _checkLocalDatastore(e){this._log("checkLocalDatastore: %b",e);const t=ve.bufferToKey(e);let r;try{r=await this.datastore.get(t)}catch(i){if(i.code==="ERR_NOT_FOUND")return;throw i}const n=yg.deserialize(r);if(!n)throw U("Invalid record","ERR_INVALID_RECORD");if(n.timeReceived==null||ve.now()-n.timeReceived>st.MAX_RECORD_AGE){await this.datastore.delete(t);return}return n}async _add(e){await this.routingTable.add(e)}async _verifyRecordLocally(e){this._log("verifyRecordLocally"),await Dn.validator.verifyRecord(this.validators,e)}_isSelf(e){return e&&ir(this.peerId.id,e.id)}async _putValueToPeer(e,t,r){const n=new _t(_t.TYPES.PUT_VALUE,e,0);n.record=t;const i=await this.network.sendRequest(r,n);if(!i.record.value.equals(yg.deserialize(t).value))throw U(new Error("value not put correctly"),"ERR_PUT_VALUE_INVALID")}async _getValueOrPeers(e,t){const r=await this._getValueSingle(e,t),n=r.closerPeers,i=r.record;if(i){try{await this._verifyRecordOnline(i)}catch(a){const s="invalid record received, discarded";throw this._log(s),U(new Error(s),"ERR_INVALID_RECORD")}return{record:i,peers:n}}if(n.length>0)return{peers:n};throw U(new Error("Not found"),"ERR_NOT_FOUND")}async _getValueSingle(e,t){const r=new _t(_t.TYPES.GET_VALUE,t,0);return this.network.sendRequest(e,r)}async _verifyRecordOnline(e){await Dn.validator.verifyRecord(this.validators,e)}}var bg=oO,cO=st.PROTOCOL_DHT;bg.multicodec=cO;var uO=window.MediaStream,lO=window.MediaStreamTrack,dO=window.RTCDataChannel,hO=window.RTCDataChannelEvent,pO=window.RTCDtlsTransport,fO=window.RTCIceCandidate,mO=window.RTCIceTransport,gO=window.RTCPeerConnection,yO=window.RTCPeerConnectionIceEvent,bO=window.RTCRtpReceiver,vO=window.RTCRtpSender,wO=window.RTCRtpTransceiver,_O=window.RTCSctpTransport,EO=window.RTCSessionDescription,SO=window.getUserMedia,AO=navigator.mediaDevices,TO={MediaStream:uO,MediaStreamTrack:lO,RTCDataChannel:dO,RTCDataChannelEvent:hO,RTCDtlsTransport:pO,RTCIceCandidate:fO,RTCIceTransport:mO,RTCPeerConnection:gO,RTCPeerConnectionIceEvent:yO,RTCRtpReceiver:bO,RTCRtpSender:vO,RTCRtpTransceiver:wO,RTCSctpTransport:_O,RTCSessionDescription:EO,getUserMedia:SO,mediaDevices:AO};async function vg(){return{addresses:{listen:["/dns4/boiling-hamlet-91904.herokuapp.com/tcp/443/wss/p2p-webrtc-star"]},modules:{transport:[sk,eT,lm],streamMuxer:[Sk],connEncryption:[bR],dht:bg,pubsub:pP},config:{transport:{[lm.prototype[Symbol.toStringTag]]:{wrtc:TO}},dht:{kBucketSize:10,enabled:!0,randomWalk:{enabled:!0,interval:3e5,timeout:1e4}}}}}async function IO(e={}){const t=await mE.create(await vg());return await t.start(),t}export default IO;export{vg as config};
