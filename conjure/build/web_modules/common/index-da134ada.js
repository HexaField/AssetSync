import{p as A}from"./process-e9e98960.js";import{s as He}from"./index-939e5c34.js";import{r as q}from"./__node-resolve:empty-8495aa00.js";import{u as he}from"./util-8448a06b.js";import{n as u}from"./empty-add391ca.js";import{p as f}from"./path-d977e441.js";var Xe=function(e,t){for(var n=[],a=0;a<e.length;a++){var r=t(e[a],a);Ve(r)?n.push.apply(n,r):n.push(r)}return n},Ve=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},le=ue;function ue(e,t,n){e instanceof RegExp&&(e=de(e,n)),t instanceof RegExp&&(t=de(t,n));var a=fe(e,t,n);return a&&{start:a[0],end:a[1],pre:n.slice(0,a[0]),body:n.slice(a[0]+e.length,a[1]),post:n.slice(a[1]+t.length)}}function de(e,t){var n=t.match(e);return n?n[0]:null}ue.range=fe;function fe(e,t,n){var a,r,i,o,l,s=n.indexOf(e),c=n.indexOf(t,s+1),h=s;if(s>=0&&c>0){for(a=[],i=n.length;h>=0&&!l;)h==s?(a.push(h),s=n.indexOf(e,h+1)):a.length==1?l=[a.pop(),c]:(r=a.pop(),r<i&&(i=r,o=c),c=n.indexOf(t,h+1)),h=s<c&&s>=0?s:c;a.length&&(l=[i,o])}return l}var Je=Ye,me="\0SLASH"+Math.random()+"\0",pe="\0OPEN"+Math.random()+"\0",W="\0CLOSE"+Math.random()+"\0",ye="\0COMMA"+Math.random()+"\0",ge="\0PERIOD"+Math.random()+"\0";function H(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function Ze(e){return e.split("\\\\").join(me).split("\\{").join(pe).split("\\}").join(W).split("\\,").join(ye).split("\\.").join(ge)}function Qe(e){return e.split(me).join("\\").split(pe).join("{").split(W).join("}").split(ye).join(",").split(ge).join(".")}function we(e){if(!e)return[""];var t=[],n=le("{","}",e);if(!n)return e.split(",");var a=n.pre,r=n.body,i=n.post,o=a.split(",");o[o.length-1]+="{"+r+"}";var l=we(i);return i.length&&(o[o.length-1]+=l.shift(),o.push.apply(o,l)),t.push.apply(t,o),t}function Ye(e){return e?(e.substr(0,2)==="{}"&&(e="\\{\\}"+e.substr(2)),N(Ze(e),!0).map(Qe)):[]}function et(e){return"{"+e+"}"}function tt(e){return/^-?0\d/.test(e)}function at(e,t){return e<=t}function nt(e,t){return e>=t}function N(e,t){var n=[],a=le("{","}",e);if(!a||/\$$/.test(a.pre))return[e];var r=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(a.body),i=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(a.body),o=r||i,l=a.body.indexOf(",")>=0;if(!o&&!l)return a.post.match(/,.*\}/)?(e=a.pre+"{"+a.body+W+a.post,N(e)):[e];var s;if(o)s=a.body.split(/\.\./);else if(s=we(a.body),s.length===1&&(s=N(s[0],!1).map(et),s.length===1)){var h=a.post.length?N(a.post,!1):[""];return h.map(function(B){return a.pre+s[0]+B})}var c=a.pre,h=a.post.length?N(a.post,!1):[""],p;if(o){var x=H(s[0]),v=H(s[1]),b=Math.max(s[0].length,s[1].length),g=s.length==3?Math.abs(H(s[2])):1,D=at,d=v<x;d&&(g*=-1,D=nt);var y=s.some(tt);p=[];for(var E=x;D(E,v);E+=g){var w;if(i)w=String.fromCharCode(E),w==="\\"&&(w="");else if(w=String(E),y){var O=b-w.length;if(O>0){var C=new Array(O+1).join("0");E<0?w="-"+C+w.slice(1):w=C+w}}p.push(w)}}else p=Xe(s,function(L){return N(L,!1)});for(var _=0;_<p.length;_++)for(var j=0;j<h.length;j++){var S=c+p[_]+h[j];(!t||o||S)&&n.push(S)}return n}var X=k;k.Minimatch=m;var P={sep:"/"};try{P=f}catch(e){}var V=k.GLOBSTAR=m.GLOBSTAR={},ve={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},J="[^/]",Z=J+"*?",rt="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",it="(?:(?!(?:\\/|^)\\.).)*?",be=st("().*{}+?[]^$\\!");function st(e){return e.split("").reduce(function(t,n){return t[n]=!0,t},{})}var ke=/\/+/;k.filter=ot;function ot(e,t){return t=t||{},function(n,a,r){return k(n,e,t)}}function xe(e,t){e=e||{},t=t||{};var n={};return Object.keys(t).forEach(function(a){n[a]=t[a]}),Object.keys(e).forEach(function(a){n[a]=e[a]}),n}k.defaults=function(e){if(!e||!Object.keys(e).length)return k;var t=k,n=function(r,i,o){return t.minimatch(r,i,xe(e,o))};return n.Minimatch=function(r,i){return new t.Minimatch(r,xe(e,i))},n},m.defaults=function(e){return!e||!Object.keys(e).length?m:k.defaults(e).Minimatch};function k(e,t,n){if(typeof t!="string")throw new TypeError("glob pattern string required");return n||(n={}),!n.nocomment&&t.charAt(0)==="#"?!1:t.trim()===""?e==="":new m(t,n).match(e)}function m(e,t){if(!(this instanceof m))return new m(e,t);if(typeof e!="string")throw new TypeError("glob pattern string required");t||(t={}),e=e.trim(),P.sep!=="/"&&(e=e.split(P.sep).join("/")),this.options=t,this.set=[],this.pattern=e,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.make()}m.prototype.debug=function(){},m.prototype.make=ct;function ct(){if(this._made)return;var e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate();var n=this.globSet=this.braceExpand();t.debug&&(this.debug=console.error),this.debug(this.pattern,n),n=this.globParts=n.map(function(a){return a.split(ke)}),this.debug(this.pattern,n),n=n.map(function(a,r,i){return a.map(this.parse,this)},this),this.debug(this.pattern,n),n=n.filter(function(a){return a.indexOf(!1)===-1}),this.debug(this.pattern,n),this.set=n}m.prototype.parseNegate=ht;function ht(){var e=this.pattern,t=!1,n=this.options,a=0;if(n.nonegate)return;for(var r=0,i=e.length;r<i&&e.charAt(r)==="!";r++)t=!t,a++;a&&(this.pattern=e.substr(a)),this.negate=t}k.braceExpand=function(e,t){return Ee(e,t)},m.prototype.braceExpand=Ee;function Ee(e,t){if(t||(this instanceof m?t=this.options:t={}),e=typeof e=="undefined"?this.pattern:e,typeof e=="undefined")throw new TypeError("undefined pattern");return t.nobrace||!e.match(/\{.*\}/)?[e]:Je(e)}m.prototype.parse=lt;var F={};function lt(e,t){if(e.length>1024*64)throw new TypeError("pattern is too long");var n=this.options;if(!n.noglobstar&&e==="**")return V;if(e==="")return"";var a="",r=!!n.nocase,i=!1,o=[],l=[],s,c=!1,h=-1,p=-1,x=e.charAt(0)==="."?"":n.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",v=this;function b(){if(s){switch(s){case"*":a+=Z,r=!0;break;case"?":a+=J,r=!0;break;default:a+="\\"+s;break}v.debug("clearStateChar %j %j",s,a),s=!1}}for(var g=0,D=e.length,d;g<D&&(d=e.charAt(g));g++){if(this.debug("%s	%s %s %j",e,g,a,d),i&&be[d]){a+="\\"+d,i=!1;continue}switch(d){case"/":return!1;case"\\":b(),i=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",e,g,a,d),c){this.debug("  in class"),d==="!"&&g===p+1&&(d="^"),a+=d;continue}v.debug("call clearStateChar %j",s),b(),s=d,n.noext&&b();continue;case"(":if(c){a+="(";continue}if(!s){a+="\\(";continue}o.push({type:s,start:g-1,reStart:a.length,open:ve[s].open,close:ve[s].close}),a+=s==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",s,a),s=!1;continue;case")":if(c||!o.length){a+="\\)";continue}b(),r=!0;var y=o.pop();a+=y.close,y.type==="!"&&l.push(y),y.reEnd=a.length;continue;case"|":if(c||!o.length||i){a+="\\|",i=!1;continue}b(),a+="|";continue;case"[":if(b(),c){a+="\\"+d;continue}c=!0,p=g,h=a.length,a+=d;continue;case"]":if(g===p+1||!c){a+="\\"+d,i=!1;continue}if(c){var E=e.substring(p+1,g);try{RegExp("["+E+"]")}catch(oe){var w=this.parse(E,F);a=a.substr(0,h)+"\\["+w[0]+"\\]",r=r||w[1],c=!1;continue}}r=!0,c=!1,a+=d;continue;default:b(),i?i=!1:be[d]&&!(d==="^"&&c)&&(a+="\\"),a+=d}}for(c&&(E=e.substr(p+1),w=this.parse(E,F),a=a.substr(0,h)+"\\["+w[0],r=r||w[1]),y=o.pop();y;y=o.pop()){var O=a.slice(y.reStart+y.open.length);this.debug("setting tail",a,y),O=O.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(oe,ce,U){return U||(U="\\"),ce+ce+U+"|"}),this.debug(`tail=%j
   %s`,O,O,y,a);var C=y.type==="*"?Z:y.type==="?"?J:"\\"+y.type;r=!0,a=a.slice(0,y.reStart)+C+"\\("+O}b(),i&&(a+="\\\\");var _=!1;switch(a.charAt(0)){case".":case"[":case"(":_=!0}for(var j=l.length-1;j>-1;j--){var S=l[j],L=a.slice(0,S.reStart),B=a.slice(S.reStart,S.reEnd-8),ie=a.slice(S.reEnd-8,S.reEnd),$=a.slice(S.reEnd);ie+=$;var Ue=L.split("(").length-1,G=$;for(g=0;g<Ue;g++)G=G.replace(/\)[+*?]?/,"");$=G;var se="";$===""&&t!==F&&(se="$");var qe=L+B+$+se+ie;a=qe}if(a!==""&&r&&(a="(?=.)"+a),_&&(a=x+a),t===F)return[a,r];if(!r)return ft(e);var We=n.nocase?"i":"";try{var K=new RegExp("^"+a+"$",We)}catch(oe){return new RegExp("$.")}return K._glob=e,K._src=a,K}k.makeRe=function(e,t){return new m(e,t||{}).makeRe()},m.prototype.makeRe=ut;function ut(){if(this.regexp||this.regexp===!1)return this.regexp;var e=this.set;if(!e.length)return this.regexp=!1,this.regexp;var t=this.options,n=t.noglobstar?Z:t.dot?rt:it,a=t.nocase?"i":"",r=e.map(function(i){return i.map(function(o){return o===V?n:typeof o=="string"?mt(o):o._src}).join("\\/")}).join("|");r="^(?:"+r+")$",this.negate&&(r="^(?!"+r+").*$");try{this.regexp=new RegExp(r,a)}catch(i){this.regexp=!1}return this.regexp}k.match=function(e,t,n){n=n||{};var a=new m(t,n);return e=e.filter(function(r){return a.match(r)}),a.options.nonull&&!e.length&&e.push(t),e},m.prototype.match=dt;function dt(e,t){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;var n=this.options;P.sep!=="/"&&(e=e.split(P.sep).join("/")),e=e.split(ke),this.debug(this.pattern,"split",e);var a=this.set;this.debug(this.pattern,"set",a);var r,i;for(i=e.length-1;i>=0&&!(r=e[i],r);i--);for(i=0;i<a.length;i++){var o=a[i],l=e;n.matchBase&&o.length===1&&(l=[r]);var s=this.matchOne(l,o,t);if(s)return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate}m.prototype.matchOne=function(e,t,n){var a=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var r=0,i=0,o=e.length,l=t.length;r<o&&i<l;r++,i++){this.debug("matchOne loop");var s=t[i],c=e[r];if(this.debug(t,s,c),s===!1)return!1;if(s===V){this.debug("GLOBSTAR",[t,s,c]);var h=r,p=i+1;if(p===l){for(this.debug("** at the end");r<o;r++)if(e[r]==="."||e[r]===".."||!a.dot&&e[r].charAt(0)===".")return!1;return!0}for(;h<o;){var x=e[h];if(this.debug(`
globstar while`,e,h,t,p,x),this.matchOne(e.slice(h),t.slice(p),n))return this.debug("globstar found match!",h,o,x),!0;if(x==="."||x===".."||!a.dot&&x.charAt(0)==="."){this.debug("dot detected!",e,h,t,p);break}this.debug("globstar swallow a segment, and continue"),h++}return!!(n&&(this.debug(`
>>> no match, partial?`,e,h,t,p),h===o))}var v;if(typeof s=="string"?(a.nocase?v=c.toLowerCase()===s.toLowerCase():v=c===s,this.debug("string match",s,c,v)):(v=c.match(s),this.debug("pattern match",s,c,v)),!v)return!1}if(r===o&&i===l)return!0;if(r===o)return n;if(i===l){var b=r===o-1&&e[r]==="";return b}throw new Error("wtf?")};function ft(e){return e.replace(/\\(.)/g,"$1")}function mt(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}var pt=async function*(t,n,a={}){const r=f.resolve(t),i=f.relative(a.cwd||A.cwd(),t),o=await q.stat(r);if(o.isDirectory()){for await(const l of Se(r,"",n,a))yield l;return}X(i,n)&&(yield a.absolute?r:i)};async function*Se(e,t,n,a){for await(const r of await q.readdir(f.join(e,t))){const i=f.join(t,r),o=f.join(e,t,r),l=await q.stat(o);let s=X(i,n,a);a.ignore&&s&&a.ignore.reduce((c,h)=>c||X(i,h,a),!1)&&(s=!1),s&&!(l.isDirectory()&&a.nodir)&&(yield a.absolute?o:i),l.isDirectory()&&(yield*Se(e,i,n,a))}}const{promisify:Oe}=he,yt=e=>{if(!e)e={mode:511,fs:u};else if(typeof e=="object")e={mode:511,fs:u,...e};else if(typeof e=="number")e={mode:e,fs:u};else if(typeof e=="string")e={mode:parseInt(e,8),fs:u};else throw new TypeError("invalid options argument");return e.mkdir=e.mkdir||e.fs.mkdir||u.mkdir,e.mkdirAsync=Oe(e.mkdir),e.stat=e.stat||e.fs.stat||u.stat,e.statAsync=Oe(e.stat),e.statSync=e.statSync||e.fs.statSync||u.statSync,e.mkdirSync=e.mkdirSync||e.fs.mkdirSync||u.mkdirSync,e};var M=yt;const gt=A.env.__TESTING_MKDIRP_PLATFORM__||A.platform,{resolve:wt,parse:vt}=f,bt=e=>{if(/\0/.test(e))throw Object.assign(new TypeError("path must be a string without null bytes"),{path:e,code:"ERR_INVALID_ARG_VALUE"});if(e=wt(e),gt==="win32"){const t=/[*|"<>?:]/,{root:n}=vt(e);if(t.test(e.substr(n.length)))throw Object.assign(new Error("Illegal characters in path."),{path:e,code:"EINVAL"})}return e};var I=bt;const{dirname:je}=f,_e=(e,t,n=void 0)=>n===t?Promise.resolve():e.statAsync(t).then(a=>a.isDirectory()?n:void 0,a=>a.code==="ENOENT"?_e(e,je(t),t):void 0),Ae=(e,t,n=void 0)=>{if(n===t)return;try{return e.statSync(t).isDirectory()?n:void 0}catch(a){return a.code==="ENOENT"?Ae(e,je(t),t):void 0}};var kt={findMade:_e,findMadeSync:Ae};const{dirname:Ne}=f,Q=(e,t,n)=>{t.recursive=!1;const a=Ne(e);return a===e?t.mkdirAsync(e,t).catch(r=>{if(r.code!=="EISDIR")throw r}):t.mkdirAsync(e,t).then(()=>n||e,r=>{if(r.code==="ENOENT")return Q(a,t).then(i=>Q(e,t,i));if(r.code!=="EEXIST"&&r.code!=="EROFS")throw r;return t.statAsync(e).then(i=>{if(i.isDirectory())return n;throw r},()=>{throw r})})},Y=(e,t,n)=>{const a=Ne(e);if(t.recursive=!1,a===e)try{return t.mkdirSync(e,t)}catch(r){if(r.code!=="EISDIR")throw r;return}try{return t.mkdirSync(e,t),n||e}catch(r){if(r.code==="ENOENT")return Y(e,t,Y(a,t,n));if(r.code!=="EEXIST"&&r.code!=="EROFS")throw r;try{if(!t.statSync(e).isDirectory())throw r}catch(i){throw r}}};var Me={mkdirpManual:Q,mkdirpManualSync:Y};const{dirname:Ie}=f,{findMade:xt,findMadeSync:Et}=kt,{mkdirpManual:St,mkdirpManualSync:Ot}=Me,jt=(e,t)=>{t.recursive=!0;const n=Ie(e);return n===e?t.mkdirAsync(e,t):xt(t,e).then(a=>t.mkdirAsync(e,t).then(()=>a).catch(r=>{if(r.code==="ENOENT")return St(e,t);throw r}))},_t=(e,t)=>{t.recursive=!0;const n=Ie(e);if(n===e)return t.mkdirSync(e,t);const a=Et(t,e);try{return t.mkdirSync(e,t),a}catch(r){if(r.code==="ENOENT")return Ot(e,t);throw r}};var At={mkdirpNative:jt,mkdirpNativeSync:_t};const Nt=A.env.__TESTING_MKDIRP_NODE_VERSION__||A.version,ee=Nt.replace(/^v/,"").split("."),Re=+ee[0]>10||+ee[0]===10&&+ee[1]>=12,Mt=Re?e=>e.mkdir===u.mkdir:()=>!1,It=Re?e=>e.mkdirSync===u.mkdirSync:()=>!1;var Rt={useNative:Mt,useNativeSync:It};const{mkdirpNative:Te,mkdirpNativeSync:$e}=At,{mkdirpManual:Pe,mkdirpManualSync:De}=Me,{useNative:Tt,useNativeSync:$t}=Rt,R=(e,t)=>(e=I(e),t=M(t),Tt(t)?Te(e,t):Pe(e,t)),Pt=(e,t)=>(e=I(e),t=M(t),$t(t)?$e(e,t):De(e,t));R.sync=Pt,R.native=(e,t)=>Te(I(e),M(t)),R.manual=(e,t)=>Pe(I(e),M(t)),R.nativeSync=(e,t)=>$e(I(e),M(t)),R.manualSync=(e,t)=>De(I(e),M(t));var te=R;const{open:Dt,write:Ct,close:Ce,rename:Lt,fsync:Ft,unlink:zt}=u,{join:Bt,dirname:Gt}=f;var Kt=0;function ae(e,t,n){zt(e,function(){n(t)})}function Le(e,t,n,a){Ce(e,ae.bind(null,t,n,a))}function Fe(e,t,n,a,r){Ct(e,t,a,function(i,o){if(i){r(i);return}return o<n-a?Fe(e,t,n,a+o,r):r(null)})}function ze(e,t){Dt(e,"w",function(n,a){if(n)return n.code==="EMFILE"?ze(e,t):t(n);t(null,a)})}function Ut(e,t,n){const a=Bt(Gt(e),"."+A.pid+"."+Kt++);ze(a,function(r,i){if(r){n(r);return}const o=Buffer.byteLength(t);Fe(i,t,o,0,function(l){if(l){Le(i,a,l,n);return}Ft(i,function(s){if(s){Le(i,a,s,n);return}Ce(i,function(c){if(c){ae(a,c,n);return}Lt(a,e,h=>{if(h){ae(a,h,n);return}n(null)})})})}),t=null})}var qt=Ut;const z=he.promisify,Wt=z(qt),{Adapter:Ht,Key:Xt,Errors:T,utils:{map:Vt}}=He,ne=()=>{},Be=z(u.access||ne),re=z(u.readFile||ne),Jt=z(u.unlink||ne);async function Ge(e,t){try{await Wt(e,t)}catch(n){if(n.code==="EPERM"&&n.syscall==="rename"){await Be(e,u.constants.F_OK|u.constants.W_OK);return}throw n}}class Zt extends Ht{constructor(e,t){super();this.path=f.resolve(e),this.opts=Object.assign({},{createIfMissing:!0,errorIfExists:!1,extension:".data"},t)}open(){try{if(!u.existsSync(this.path))throw T.notFoundError(new Error(`Datastore directory: ${this.path} does not exist`));if(this.opts.errorIfExists)throw T.dbOpenFailedError(new Error(`Datastore directory: ${this.path} already exists`))}catch(e){if(e.code==="ERR_NOT_FOUND"&&this.opts.createIfMissing){te.sync(this.path,{fs:u});return}throw e}}_encode(e){const t=e.parent().toString(),n=f.join(this.path,t),a=e.toString().slice(t.length),r=f.join(n,a+this.opts.extension);return{dir:n,file:r}}_decode(e){const t=this.opts.extension;if(f.extname(e)!==t)throw new Error(`Invalid extension: ${f.extname(e)}`);const n=e.slice(this.path.length,-t.length).split(f.sep).join("/");return new Xt(n)}async putRaw(e,t){const n=this._encode(e);let a=n.file;this.opts.extension.length&&(a=n.file.slice(0,-this.opts.extension.length)),await te(n.dir,{fs:u}),await Ge(a,t)}async put(e,t){const n=this._encode(e);try{await te(n.dir,{fs:u}),await Ge(n.file,t)}catch(a){throw T.dbWriteFailedError(a)}}async getRaw(e){const t=this._encode(e);let n=t.file;this.opts.extension.length&&(n=n.slice(0,-this.opts.extension.length));let a;try{a=await re(n)}catch(r){throw T.notFoundError(r)}return a}async get(e){const t=this._encode(e);let n;try{n=await re(t.file)}catch(a){throw T.notFoundError(a)}return n}async has(e){const t=this._encode(e);try{await Be(t.file)}catch(n){return!1}return!0}async delete(e){const t=this._encode(e);try{await Jt(t.file)}catch(n){if(n.code==="ENOENT")return;throw T.dbDeleteFailedError(n)}}async*_all(e){let t=e.prefix||"**";t=t.replace(/^\/+/,"");const n=`${t}/*${this.opts.extension}`.split(f.sep).join("/"),a=pt(this.path,n,{absolute:!0});if(e.keysOnly)yield*Vt(a,r=>({key:this._decode(r)}));else for await(const r of a)try{const i=await re(r);yield{key:this._decode(r),value:i}}catch(i){if(i.code!=="ENOENT")throw i}}}var Ke=Zt,Qt=Object.freeze(Object.assign(Object.create(null),Ke,{default:Ke}));export{Qt as i};
