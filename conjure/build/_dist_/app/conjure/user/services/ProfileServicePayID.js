import c from"./ProfileService.js";import d from"./payid/PayIDHandler.js";export default class D extends c{constructor(e){super(e,"PayID");this.payIDHandler=new d(this),this.openPayIDScreen=this.openPayIDScreen.bind(this)}async initialise(){super.initialise(),await this.payIDHandler.initialise()}openPayIDScreen(){this.profile.conjure.getScreens().showScreen(this.profile.conjure.getScreens().screenPayID)}getPreferredID(){return this.payIDHandler.activeID}getBalanceOnPreferred(){return this.payIDHandler.getBalance(this.getPreferredID())}sendPayment(e,n,t){this.payIDHandler.sendPayment(e,n,t)&&this.conjure.getGlobalHUD().log("Successfully sent "+e+" from "+t+" to "+n)}getSchema(){return{linkButton:{type:"button",buttonText:"Edit Info",ignoreLabel:!0,callback:this.openPayIDScreen}}}toJson(){let e={domains:{},activeID:this.payIDHandler.activeID};for(let n of this.payIDHandler.domains){e.domains[n.getDomain()]={};for(let t of n.accounts){e.domains[n.getDomain()][t.getAccount()]={};for(let a of t.wallets)e.domains[n.getDomain()][t.getAccount()][a.getAddress()]=a.getInfo()}}return console.log("PayID toJson",e),e}async readFromJson(e){let n=Object.keys(e.domains);for(let t of n){let a=this.payIDHandler.addDomain(t)||this.payIDHandler.getDomain(t);if(a){let s=Object.keys(e.domains[t]);for(let o of s){let r=await this.payIDHandler.addAccount(a,o);if(r){let l=Object.keys(e.domains[t][o]);for(let i of l)console.log(i,e.domains[t][o][i]),await this.payIDHandler.addWallet(a,r,e.domains[t][o][i])}}}}this.payIDHandler.activeID=e.activeID}}
