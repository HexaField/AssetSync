import{RegionConfig as I}from"./RegionConfig.js";import{InlineWorker as O}from"../../../../web_modules/@AssetSync/common.js";const W={scale:.1,regionSize:I.regionSize};export class HeightmapGenerator{constructor(){this.generatorThread=new O(L)}async generate(C,P){return await this.generatorThread.makeRequest({coords:C,config:Object.assign({},P,W)})}}function L(){const C=.78,P=2,j=6,Y=.001,A=4;function J(n,r,a=1){var t=0;let o=1,s=1;for(var c=0;c<j;c++)t+=k(n*o*Y,r*o*Y)*s,s*=C,o*=P;return t}self.onmessage=n=>{const{data:r,timestamp:a}=n.data,{coords:t,config:o}=r,s=o.regionSize,c=o.scale;var i=[],l=[];let h=0;var d=s+1,g=s+1;const S=t.x*o.regionSize,q=t.y*o.regionSize;for(let v=0;v<d;v++)for(let p=0;p<g;p++){let M=0;for(let D=1;D<=A;D++){const T=D*D;M+=J((v+S+.5)/T,(p+q+.5)/T)*T}i.push(v,M*10,p),v<d-1&&p<g-1&&(l.push(h,h+d+1,h+d),l.push(h+d+1,h,h+1)),h++}self.postMessage({timestamp:a,data:{vertices:i,indices:l}})};for(var R=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],e=new Array(512),w=0;w<256;w++)e[256+w]=e[w]=R[w];function b(n){return n*n*n*(n*(n*6-15)+10)}function u(n,r,a){return r+n*(a-r)}function _(n,r){return(n&1)==0?r:-r}function X(n,r,a){switch(n&3){case 0:return r+a;case 1:return-r+a;case 2:return r-a;case 3:return-r-a;default:return 0}}function m(n,r,a,t){switch(n&15){case 0:return r+a;case 1:return-r+a;case 2:return r-a;case 3:return-r-a;case 4:return r+t;case 5:return-r+t;case 6:return r-t;case 7:return-r-t;case 8:return a+t;case 9:return-a+t;case 10:return a-t;case 11:return-a-t;case 12:return a+r;case 13:return-a+t;case 14:return a-r;case 15:return-a-t;default:return 0}}function f(n,r,a,t,o){switch(n&31){case 0:return r+a;case 1:return-r+a;case 2:return r-a;case 3:return-r-a;case 4:return r+t;case 5:return-r+t;case 6:return r-t;case 7:return-r-t;case 8:return r+o;case 9:return-r+o;case 10:return r-o;case 11:return-r-o;case 12:return a+t;case 13:return-a+t;case 14:return a-t;case 15:return-a-t;case 16:return a+o;case 17:return-a+o;case 18:return a-o;case 19:return-a-o;case 20:return a+r;case 21:return a-r;case 22:return a+t;case 23:return a-t;case 24:return a+o;case 25:return a-o;case 26:return-a+r;case 27:return-a-r;case 28:return-a+t;case 29:return-a-t;case 30:return-a+o;case 31:return-a-o;default:return 0}}var Q=function(n){var r=Math.floor(n)&255;n-=Math.floor(n);var a=b(n),t=e[r],o=e[r+1];return u(a,_(t,n),_(o,n-1))},k=function(n,r){var a=Math.floor(n)&255,t=Math.floor(r)&255;n-=Math.floor(n),r-=Math.floor(r);var o=b(n),s=b(r),c=e[e[a]+t],i=e[e[a]+t+1],l=e[e[a+1]+t],h=e[e[a+1]+t+1];return u(s,u(o,X(c,n,r),X(l,n-1,r)),u(o,X(i,n,r-1),X(h,n-1,r-1)))},U=function(n,r,a){var t=Math.floor(n)&255,o=Math.floor(r)&255,s=Math.floor(a)&255;n-=Math.floor(n),r-=Math.floor(r),a-=Math.floor(a);var c=b(n),i=b(r),l=b(a),h=e[e[e[t]+o]+s],d=e[e[e[t]+o]+s+1],g=e[e[e[t]+o+1]+s],S=e[e[e[t]+o+1]+s+1],q=e[e[e[t+1]+o]+s],v=e[e[e[t+1]+o]+s+1],p=e[e[e[t+1]+o+1]+s],M=e[e[e[t+1]+o+1]+s+1];return u(l,u(i,u(c,m(h,n,r,a),m(q,n-1,r,a)),u(c,m(g,n,r-1,a),m(p,n-1,r-1,a))),u(i,u(c,m(d,n,r,a-1),m(v,n-1,r,a-1)),u(c,m(S,n,r-1,a-1),m(M,n-1,r-1,a-1))))},V=function(n,r,a,t){var o=Math.floor(n)&255,s=Math.floor(r)&255,c=Math.floor(a)&255,i=Math.floor(t)&255;n-=Math.floor(n),r-=Math.floor(r),a-=Math.floor(a),t-=Math.floor(t);var l=b(n),h=b(r),d=b(a);_t=b(t);var g=e[e[e[e[o]+s]+c]+i],S=e[e[e[e[o]+s]+c]+i+1],q=e[e[e[e[o]+s]+c+1]+i],v=e[e[e[e[o]+s]+c+1]+i+1],p=e[e[e[e[o]+s+1]+c]+i],M=e[e[e[e[o]+s+1]+c]+i+1],D=e[e[e[e[o]+s+1]+c+1]+i],T=e[e[e[e[o]+s+1]+c+1]+i+1],E=e[e[e[e[o+1]+s]+c]+i],F=e[e[e[e[o+1]+s]+c]+i+1],K=e[e[e[e[o+1]+s]+c+1]+i],N=e[e[e[e[o+1]+s]+c+1]+i+1],Z=e[e[e[e[o+1]+s+1]+c]+i],B=e[e[e[e[o+1]+s+1]+c]+i+1],G=e[e[e[e[o+1]+s+1]+c+1]+i],H=e[e[e[e[o+1]+s+1]+c+1]+i+1];return u(_t,u(d,u(h,u(l,f(g,n,r,a,t),f(E,n-1,r,a,t)),u(l,f(p,n,r-1,a,t),f(Z,n-1,r-1,a,t))),u(h,u(l,f(q,n,r,a-1,t),f(K,n-1,r,a-1,t)),u(l,f(D,n,r-1,a-1,t),f(G,n-1,r-1,a-1,t)))),u(d,u(h,u(l,f(S,n,r,a,t-1),f(F,n-1,r,a,t-1)),u(l,f(M,n,r-1,a,t-1),f(B,n-1,r-1,a,t-1))),u(h,u(l,f(v,n,r,a-1,t-1),f(N,n-1,r,a-1,t-1)),u(l,f(T,n,r-1,a-1,t-1),f(H,n-1,r-1,a-1,t-1)))))}}
