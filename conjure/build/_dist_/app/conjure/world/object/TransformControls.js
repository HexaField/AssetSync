import{BoxBufferGeometry as U,BufferGeometry as me,Color as le,CylinderBufferGeometry as A,DoubleSide as ye,Euler as Me,Float32BufferAttribute as ve,Line as p,LineBasicMaterial as xe,Matrix4 as be,Mesh as o,MeshBasicMaterial as ge,Object3D as B,OctahedronBufferGeometry as H,PlaneBufferGeometry as K,Quaternion as I,Raycaster as je,SphereBufferGeometry as Pe,TorusBufferGeometry as ce,Vector3 as h}from" https://cdn.skypack.dev/pin/three@v0.123.0-STd7XeVUbImsNuMmqKGL/min/three.js";var de=function(x,c){c===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),c=document),this.objects=[],B.call(this),this.visible=!1,this.domElement=c;var u=new he;this.add(u);var v=new ue;this.add(v);var l=this;n("camera",x),n("object",void 0),n("enabled",!0),n("axis",null),n("mode","translate"),n("translationSnap",null),n("rotationSnap",null),n("scaleSnap",null),n("space","world"),n("size",1),n("dragging",!1),n("showX",!0),n("showY",!0),n("showZ",!0);var y={type:"change"},Q={type:"mouseDown"},b={type:"mouseUp",mode:l.mode},W={type:"objectChange"},k=new je;function D(t,i,s){for(var r=i.intersectObject(t,!0),e=r.length;e--;)if(r[e].object.visible||s)return r[e];return!1}var Z=new h,Y=new h,G=new I,V={X:new h(1,0,0),Y:new h(0,1,0),Z:new h(0,0,1)},g=new h,M=new h,d=new h,z=new h,L=new h,F=new h,m=0,f=new h,R=new I,pe=new h,fe=new h,ne=new I,ee=new I,te=new h,J=new h,re=new I,we=new h,$=new h,_=new I,j=new I,ie=new h,T=new h,w=[],q=[],oe=[];n("worldPosition",$),n("worldPositionStart",J),n("worldQuaternion",_),n("worldQuaternionStart",re),n("cameraPosition",f),n("cameraQuaternion",R),n("pointStart",g),n("pointEnd",M),n("rotationAxis",z),n("rotationAngle",m),n("eye",T),c.addEventListener("mousedown",C,!1),c.addEventListener("touchstart",C,!1),c.addEventListener("mousemove",N,!1),c.addEventListener("touchmove",N,!1),c.addEventListener("touchmove",S,!1),document.addEventListener("mouseup",P,!1),c.addEventListener("touchend",P,!1),c.addEventListener("touchcancel",P,!1),c.addEventListener("touchleave",P,!1),this.dispose=function(){c.removeEventListener("mousedown",C),c.removeEventListener("touchstart",C),c.removeEventListener("mousemove",N),document.removeEventListener("mousemove",S),c.removeEventListener("touchmove",N),c.removeEventListener("touchmove",S),document.removeEventListener("mouseup",P),c.removeEventListener("touchend",P),c.removeEventListener("touchcancel",P),c.removeEventListener("touchleave",P),this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})},this.hasAnyAttached=function(){return this.objects.length>0},this.getIndex=function(t){for(let i=0;i<this.objects.length;i++)if(this.objects[i]===t)return i;return-1},this.isAttached=function(t){for(let i of this.objects)if(i.uuid===t.uuid)return!0;return!1},this.attach=function(t){return this.isAttached(t)?void 0:(this.objects.push(t),this.visible=!0,this)},this.detachAll=function(){this.objects=[],this.visible=!1,this.axis=null;return},this.detach=function(t){if(this.isAttached(t)){let i=this.getIndex(t);return this.objects.splice(i,1),this.objects.length===0&&(this.visible=!1,this.axis=null),this}return};function n(t,i){var s=i;Object.defineProperty(l,t,{get:function(){return s!==void 0?s:i},set:function(r){s!==r&&(s=r,v[t]=r,u[t]=r,l.dispatchEvent({type:t+"-changed",value:r}),l.dispatchEvent(y))}}),l[t]=i,v[t]=i,u[t]=i}this.updateMatrixWorld=function(){for(let t of this.objects)t!==void 0&&(t.updateMatrixWorld(),t.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):t.parent.matrixWorld.decompose(fe,ne,te),t.matrixWorld.decompose($,_,ie),ee.copy(ne).invert(),j.copy(_).invert());this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(f,R,pe),T.copy(f).sub($).normalize(),B.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(t){if(this.objects.length===0||this.dragging===!0||t.button!==void 0&&t.button!==0)return;k.setFromCamera(t,this.camera);var i=D(u.picker[this.mode],k);i?this.axis=i.object.name:this.axis=null},this.pointerDown=function(t){if(this.objects.length===0||this.dragging===!0||t.button!==void 0&&t.button!==0)return;if((t.button===0||t.button===void 0)&&this.axis!==null){k.setFromCamera(t,this.camera);var i=D(v,k,!0);if(i){var s=this.space;this.mode==="scale"?s="local":(this.axis==="E"||this.axis==="XYZE"||this.axis==="XYZ")&&(s="world");for(let e in this.objects){if(s==="local"&&this.mode==="rotate"){var r=this.rotationSnap;this.axis==="X"&&r&&(this.objects[e].rotation.x=Math.round(this.objects[e].rotation.x/r)*r),this.axis==="Y"&&r&&(this.objects[e].rotation.y=Math.round(this.objects[e].rotation.y/r)*r),this.axis==="Z"&&r&&(this.objects[e].rotation.z=Math.round(this.objects[e].rotation.z/r)*r)}this.objects[e].updateMatrixWorld(),this.objects[e].parent.updateMatrixWorld(),w[e]=new h().copy(this.objects[e].position),q[e]=new I().copy(this.objects[e].quaternion),oe[e]=new h().copy(this.objects[e].scale),this.objects[e].matrixWorld.decompose(J,re,we),g.copy(i.point).sub(J)}}this.dragging=!0,Q.mode=this.mode,this.dispatchEvent(Q)}},this.updateObjectMatrixWorld=function(t){t.updateMatrixWorld()},this.pointerMove=function(t){for(let a in this.objects){var i=this.axis,s=this.mode,r=this.space;if(s==="scale"?r="local":(i==="E"||i==="XYZE"||i==="XYZ")&&(r="world"),this.objects[a]===void 0||i===null||this.dragging===!1||t.button!==void 0&&t.button!==0)return;k.setFromCamera(t,this.camera);var e=D(v,k,!0);if(!e)return;if(M.copy(e.point).sub(J),s==="translate")d.copy(M).sub(g),r==="local"&&i!=="XYZ"&&d.applyQuaternion(j),i.indexOf("X")===-1&&(d.x=0),i.indexOf("Y")===-1&&(d.y=0),i.indexOf("Z")===-1&&(d.z=0),r==="local"&&i!=="XYZ"?d.applyQuaternion(q[a]).divide(te):d.applyQuaternion(ee).divide(te),this.objects[a].position.copy(d).add(w[a]),this.translationSnap&&(r==="local"&&(this.objects[a].position.applyQuaternion(G.copy(q[a]).invert()),i.search("X")!==-1&&(this.objects[a].position.x=Math.round(this.objects[a].position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(this.objects[a].position.y=Math.round(this.objects[a].position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(this.objects[a].position.z=Math.round(this.objects[a].position.z/this.translationSnap)*this.translationSnap),this.objects[a].position.applyQuaternion(q[a])),r==="world"&&(this.objects[a].parent&&this.objects[a].position.add(Z.setFromMatrixPosition(this.objects[a].parent.matrixWorld)),i.search("X")!==-1&&(this.objects[a].position.x=Math.round(this.objects[a].position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(this.objects[a].position.y=Math.round(this.objects[a].position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(this.objects[a].position.z=Math.round(this.objects[a].position.z/this.translationSnap)*this.translationSnap),this.objects[a].parent&&this.objects[a].position.sub(Z.setFromMatrixPosition(this.objects[a].parent.matrixWorld))));else if(s==="scale"){if(i.search("XYZ")!==-1){var X=M.length()/g.length();M.dot(g)<0&&(X*=-1),Y.set(X,X,X)}else Z.copy(g),Y.copy(M),Z.applyQuaternion(j),Y.applyQuaternion(j),Y.divide(Z),i.search("X")===-1&&(Y.x=1),i.search("Y")===-1&&(Y.y=1),i.search("Z")===-1&&(Y.z=1);this.objects[a].scale.copy(oe[a]).multiply(Y),this.scaleSnap&&(i.search("X")!==-1&&(this.objects[a].scale.x=Math.round(this.objects[a].scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(this.objects[a].scale.y=Math.round(this.objects[a].scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(this.objects[a].scale.z=Math.round(this.objects[a].scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){d.copy(M).sub(g);var E=20/$.distanceTo(Z.setFromMatrixPosition(this.camera.matrixWorld));i==="E"?(z.copy(T),m=M.angleTo(g),L.copy(g).normalize(),F.copy(M).normalize(),m*=F.cross(L).dot(T)<0?1:-1):i==="XYZE"?(z.copy(d).cross(T).normalize(),m=d.dot(Z.copy(z).cross(this.eye))*E):(i==="X"||i==="Y"||i==="Z")&&(z.copy(V[i]),Z.copy(V[i]),r==="local"&&Z.applyQuaternion(_),m=d.dot(Z.cross(T).normalize())*E),this.rotationSnap&&(m=Math.round(m/this.rotationSnap)*this.rotationSnap),this.rotationAngle=m,r==="local"&&i!=="E"&&i!=="XYZE"?(this.objects[a].quaternion.copy(q[a]),this.objects[a].quaternion.multiply(G.setFromAxisAngle(z,m)).normalize()):(z.applyQuaternion(ee),this.objects[a].quaternion.copy(G.setFromAxisAngle(z,m)),this.objects[a].quaternion.multiply(q[a]).normalize())}}this.dispatchEvent(y),this.dispatchEvent(W)},this.pointerUp=function(t){if(t.button!==void 0&&t.button!==0)return;this.dragging&&this.axis!==null&&(b.mode=this.mode,this.dispatchEvent(b)),this.dragging=!1,t.button===void 0&&(this.axis=null)};function O(t){if(document.pointerLockElement)return{x:0,y:0,button:t.button};var i=t.changedTouches?t.changedTouches[0]:t,s=c.getBoundingClientRect();return{x:(i.clientX-s.left)/s.width*2-1,y:-(i.clientY-s.top)/s.height*2+1,button:t.button}}function N(t){if(!l.enabled)return;l.pointerHover(O(t))}function C(t){if(!l.enabled)return;document.addEventListener("mousemove",S,!1),l.pointerHover(O(t)),l.pointerDown(O(t))}function S(t){if(!l.enabled)return;l.pointerMove(O(t))}function P(t){if(!l.enabled)return;document.removeEventListener("mousemove",S,!1),l.pointerUp(O(t))}this.getMode=function(){return l.mode},this.setMode=function(t){l.mode=t},this.setTranslationSnap=function(t){l.translationSnap=t},this.setRotationSnap=function(t){l.rotationSnap=t},this.setScaleSnap=function(t){l.scaleSnap=t},this.setSize=function(t){l.size=t},this.setSpace=function(t){l.space=t},this.update=function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}};de.prototype=Object.assign(Object.create(B.prototype),{constructor:de,isTransformControls:!0});var he=function(){B.call(this),this.type="TransformControlsGizmo";var x=new ge({depthTest:!1,depthWrite:!1,transparent:!0,side:ye,fog:!1}),c=new xe({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),u=x.clone();u.opacity=.15;var v=x.clone();v.opacity=.33;var l=x.clone();l.color.set(16711680);var y=x.clone();y.color.set(65280);var Q=x.clone();Q.color.set(255);var b=x.clone();b.opacity=.25;var W=b.clone();W.color.set(16776960);var k=b.clone();k.color.set(65535);var D=b.clone();D.color.set(16711935);var Z=x.clone();Z.color.set(16776960);var Y=c.clone();Y.color.set(16711680);var G=c.clone();G.color.set(65280);var V=c.clone();V.color.set(255);var g=c.clone();g.color.set(65535);var M=c.clone();M.color.set(16711935);var d=c.clone();d.color.set(16776960);var z=c.clone();z.color.set(7895160);var L=d.clone();L.opacity=.25;var F=new A(0,.05,.2,12,1,!1),m=new U(.125,.125,.125),f=new me;f.setAttribute("position",new ve([0,0,0,1,0,0],3));var R=function(t,i){for(var s=new me,r=[],e=0;e<=64*i;++e)r.push(0,Math.cos(e/32*Math.PI)*t,Math.sin(e/32*Math.PI)*t);return s.setAttribute("position",new ve(r,3)),s},pe=function(){var t=new me;return t.setAttribute("position",new ve([0,0,0,1,1,1],3)),t},fe={X:[[new o(F,l),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new o(F,l),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new p(f,Y)]],Y:[[new o(F,y),[0,1,0],null,null,"fwd"],[new o(F,y),[0,1,0],[Math.PI,0,0],null,"bwd"],[new p(f,G),null,[0,0,Math.PI/2]]],Z:[[new o(F,Q),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new o(F,Q),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new p(f,V),null,[0,-Math.PI/2,0]]],XYZ:[[new o(new H(.1,0),b.clone()),[0,0,0],[0,0,0]]],XY:[[new o(new K(.295,.295),W.clone()),[.15,.15,0]],[new p(f,d),[.18,.3,0],null,[.125,1,1]],[new p(f,d),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new o(new K(.295,.295),k.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new p(f,g),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new p(f,g),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new o(new K(.295,.295),D.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new p(f,M),[.18,0,.3],null,[.125,1,1]],[new p(f,M),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},ne={X:[[new o(new A(.2,0,1,4,1,!1),u),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new o(new A(.2,0,1,4,1,!1),u),[0,.6,0]]],Z:[[new o(new A(.2,0,1,4,1,!1),u),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new o(new H(.2,0),u)]],XY:[[new o(new K(.4,.4),u),[.2,.2,0]]],YZ:[[new o(new K(.4,.4),u),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new o(new K(.4,.4),u),[.2,0,.2],[-Math.PI/2,0,0]]]},ee={START:[[new o(new H(.01,2),v),null,null,null,"helper"]],END:[[new o(new H(.01,2),v),null,null,null,"helper"]],DELTA:[[new p(pe(),v),null,null,null,"helper"]],X:[[new p(f,v.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new p(f,v.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new p(f,v.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},te={X:[[new p(R(1,.5),Y)],[new o(new H(.04,0),l),[0,0,.99],null,[1,3,1]]],Y:[[new p(R(1,.5),G),null,[0,0,-Math.PI/2]],[new o(new H(.04,0),y),[0,0,.99],null,[3,1,1]]],Z:[[new p(R(1,.5),V),null,[0,Math.PI/2,0]],[new o(new H(.04,0),Q),[.99,0,0],null,[1,3,1]]],E:[[new p(R(1.25,1),L),null,[0,Math.PI/2,0]],[new o(new A(.03,0,.15,4,1,!1),L),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new o(new A(.03,0,.15,4,1,!1),L),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new o(new A(.03,0,.15,4,1,!1),L),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new o(new A(.03,0,.15,4,1,!1),L),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new p(R(1,1),z),null,[0,Math.PI/2,0]]]},J={AXIS:[[new p(f,v.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},re={X:[[new o(new ce(1,.1,4,24),u),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new o(new ce(1,.1,4,24),u),[0,0,0],[Math.PI/2,0,0]]],Z:[[new o(new ce(1,.1,4,24),u),[0,0,0],[0,0,-Math.PI/2]]],E:[[new o(new ce(1.25,.1,2,24),u)]],XYZE:[[new o(new Pe(.7,10,8),u)]]},we={X:[[new o(m,l),[.8,0,0],[0,0,-Math.PI/2]],[new p(f,Y),null,null,[.8,1,1]]],Y:[[new o(m,y),[0,.8,0]],[new p(f,G),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new o(m,Q),[0,0,.8],[Math.PI/2,0,0]],[new p(f,V),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new o(m,W),[.85,.85,0],null,[2,2,.2]],[new p(f,d),[.855,.98,0],null,[.125,1,1]],[new p(f,d),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new o(m,k),[0,.85,.85],null,[.2,2,2]],[new p(f,g),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new p(f,g),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new o(m,D),[.85,0,.85],null,[2,.2,2]],[new p(f,M),[.855,0,.98],null,[.125,1,1]],[new p(f,M),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new o(new U(.125,.125,.125),b.clone()),[1.1,0,0]]],XYZY:[[new o(new U(.125,.125,.125),b.clone()),[0,1.1,0]]],XYZZ:[[new o(new U(.125,.125,.125),b.clone()),[0,0,1.1]]]},$={X:[[new o(new A(.2,0,.8,4,1,!1),u),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new o(new A(.2,0,.8,4,1,!1),u),[0,.5,0]]],Z:[[new o(new A(.2,0,.8,4,1,!1),u),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new o(m,u),[.85,.85,0],null,[3,3,.2]]],YZ:[[new o(m,u),[0,.85,.85],null,[.2,3,3]]],XZ:[[new o(m,u),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new o(new U(.2,.2,.2),u),[1.1,0,0]]],XYZY:[[new o(new U(.2,.2,.2),u),[0,1.1,0]]],XYZZ:[[new o(new U(.2,.2,.2),u),[0,0,1.1]]]},_={X:[[new p(f,v.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new p(f,v.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new p(f,v.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},j=function(t){var i=new B;for(var s in t)for(var r=t[s].length;r--;){var e=t[s][r][0].clone(),X=t[s][r][1],E=t[s][r][2],a=t[s][r][3],ae=t[s][r][4];e.name=s,e.tag=ae,X&&e.position.set(X[0],X[1],X[2]),E&&e.rotation.set(E[0],E[1],E[2]),a&&e.scale.set(a[0],a[1],a[2]),e.updateMatrix();var se=e.geometry.clone();se.applyMatrix4(e.matrix),e.geometry=se,e.renderOrder=Infinity,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1),i.add(e)}return i},ie=new h(0,0,0),T=new Me,w=new h(0,1,0),q=new h(0,0,0),oe=new be,n=new I,O=new I,N=new I,C=new h(1,0,0),S=new h(0,1,0),P=new h(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=j(fe)),this.add(this.gizmo.rotate=j(te)),this.add(this.gizmo.scale=j(we)),this.add(this.picker.translate=j(ne)),this.add(this.picker.rotate=j(re)),this.add(this.picker.scale=j($)),this.add(this.helper.translate=j(ee)),this.add(this.helper.rotate=j(J)),this.add(this.helper.scale=j(_)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var t=this.space;this.mode==="scale"&&(t="local");var i=t==="local"?this.worldQuaternion:N;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";var s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(var r=0;r<s.length;r++){var e=s[r];e.visible=!0,e.rotation.set(0,0,0),e.position.copy(this.worldPosition);var X;if(this.camera.isOrthographicCamera?X=(this.camera.top-this.camera.bottom)/this.camera.zoom:X=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),e.scale.set(1,1,1).multiplyScalar(X*this.size/7),e.tag==="helper"){e.visible=!1,e.name==="AXIS"?(e.position.copy(this.worldPositionStart),e.visible=!!this.axis,this.axis==="X"&&(n.setFromEuler(T.set(0,0,0)),e.quaternion.copy(i).multiply(n),Math.abs(w.copy(C).applyQuaternion(i).dot(this.eye))>.9&&(e.visible=!1)),this.axis==="Y"&&(n.setFromEuler(T.set(0,0,Math.PI/2)),e.quaternion.copy(i).multiply(n),Math.abs(w.copy(S).applyQuaternion(i).dot(this.eye))>.9&&(e.visible=!1)),this.axis==="Z"&&(n.setFromEuler(T.set(0,Math.PI/2,0)),e.quaternion.copy(i).multiply(n),Math.abs(w.copy(P).applyQuaternion(i).dot(this.eye))>.9&&(e.visible=!1)),this.axis==="XYZE"&&(n.setFromEuler(T.set(0,Math.PI/2,0)),w.copy(this.rotationAxis),e.quaternion.setFromRotationMatrix(oe.lookAt(q,w,S)),e.quaternion.multiply(n),e.visible=this.dragging),this.axis==="E"&&(e.visible=!1)):e.name==="START"?(e.position.copy(this.worldPositionStart),e.visible=this.dragging):e.name==="END"?(e.position.copy(this.worldPosition),e.visible=this.dragging):e.name==="DELTA"?(e.position.copy(this.worldPositionStart),e.quaternion.copy(this.worldQuaternionStart),ie.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),ie.applyQuaternion(this.worldQuaternionStart.clone().invert()),e.scale.copy(ie),e.visible=this.dragging):(e.quaternion.copy(i),this.dragging?e.position.copy(this.worldPositionStart):e.position.copy(this.worldPosition),this.axis&&(e.visible=this.axis.search(e.name)!==-1));continue}if(e.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"){var E=.99,a=.2,ae=0;(e.name==="X"||e.name==="XYZX")&&(Math.abs(w.copy(C).applyQuaternion(i).dot(this.eye))>E&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)),(e.name==="Y"||e.name==="XYZY")&&(Math.abs(w.copy(S).applyQuaternion(i).dot(this.eye))>E&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)),(e.name==="Z"||e.name==="XYZZ")&&(Math.abs(w.copy(P).applyQuaternion(i).dot(this.eye))>E&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)),e.name==="XY"&&(Math.abs(w.copy(P).applyQuaternion(i).dot(this.eye))<a&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)),e.name==="YZ"&&(Math.abs(w.copy(C).applyQuaternion(i).dot(this.eye))<a&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)),e.name==="XZ"&&(Math.abs(w.copy(S).applyQuaternion(i).dot(this.eye))<a&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)),e.name.search("X")!==-1&&(w.copy(C).applyQuaternion(i).dot(this.eye)<ae?e.tag==="fwd"?e.visible=!1:e.scale.x*=-1:e.tag==="bwd"&&(e.visible=!1)),e.name.search("Y")!==-1&&(w.copy(S).applyQuaternion(i).dot(this.eye)<ae?e.tag==="fwd"?e.visible=!1:e.scale.y*=-1:e.tag==="bwd"&&(e.visible=!1)),e.name.search("Z")!==-1&&(w.copy(P).applyQuaternion(i).dot(this.eye)<ae?e.tag==="fwd"?e.visible=!1:e.scale.z*=-1:e.tag==="bwd"&&(e.visible=!1))}else this.mode==="rotate"&&(O.copy(i),w.copy(this.eye).applyQuaternion(n.copy(i).invert()),e.name.search("E")!==-1&&e.quaternion.setFromRotationMatrix(oe.lookAt(this.eye,q,S)),e.name==="X"&&(n.setFromAxisAngle(C,Math.atan2(-w.y,w.z)),n.multiplyQuaternions(O,n),e.quaternion.copy(n)),e.name==="Y"&&(n.setFromAxisAngle(S,Math.atan2(w.x,w.z)),n.multiplyQuaternions(O,n),e.quaternion.copy(n)),e.name==="Z"&&(n.setFromAxisAngle(P,Math.atan2(w.y,w.x)),n.multiplyQuaternions(O,n),e.quaternion.copy(n)));e.visible=e.visible&&(e.name.indexOf("X")===-1||this.showX),e.visible=e.visible&&(e.name.indexOf("Y")===-1||this.showY),e.visible=e.visible&&(e.name.indexOf("Z")===-1||this.showZ),e.visible=e.visible&&(e.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),e.material._opacity=e.material._opacity||e.material.opacity,e.material._color=e.material._color||e.material.color.clone(),e.material.color.copy(e.material._color),e.material.opacity=e.material._opacity,this.enabled?this.axis&&(e.name===this.axis?(e.material.opacity=1,e.material.color.lerp(new le(1,1,1),.5)):this.axis.split("").some(function(se){return e.name===se})?(e.material.opacity=1,e.material.color.lerp(new le(1,1,1),.5)):(e.material.opacity*=.25,e.material.color.lerp(new le(1,1,1),.5))):(e.material.opacity*=.5,e.material.color.lerp(new le(1,1,1),.5))}B.prototype.updateMatrixWorld.call(this)}};he.prototype=Object.assign(Object.create(B.prototype),{constructor:he,isTransformControlsGizmo:!0});var ue=function(){o.call(this,new K(1e5,1e5,2,2),new ge({visible:!1,wireframe:!0,side:ye,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var x=new h(1,0,0),c=new h(0,1,0),u=new h(0,0,1),v=new h,l=new h,y=new h,Q=new be,b=new I;this.updateMatrixWorld=function(){var W=this.space;this.position.copy(this.worldPosition),this.mode==="scale"&&(W="local"),x.set(1,0,0).applyQuaternion(W==="local"?this.worldQuaternion:b),c.set(0,1,0).applyQuaternion(W==="local"?this.worldQuaternion:b),u.set(0,0,1).applyQuaternion(W==="local"?this.worldQuaternion:b),y.copy(c);switch(this.mode){case"translate":case"scale":switch(this.axis){case"X":y.copy(this.eye).cross(x),l.copy(x).cross(y);break;case"Y":y.copy(this.eye).cross(c),l.copy(c).cross(y);break;case"Z":y.copy(this.eye).cross(u),l.copy(u).cross(y);break;case"XY":l.copy(u);break;case"YZ":l.copy(x);break;case"XZ":y.copy(u),l.copy(c);break;case"XYZ":case"E":l.set(0,0,0);break}break;case"rotate":default:l.set(0,0,0)}l.length()===0?this.quaternion.copy(this.cameraQuaternion):(Q.lookAt(v.set(0,0,0),l,y),this.quaternion.setFromRotationMatrix(Q)),B.prototype.updateMatrixWorld.call(this)}};ue.prototype=Object.assign(Object.create(o.prototype),{constructor:ue,isTransformControlsPlane:!0});export{de as TransformControls,he as TransformControlsGizmo,ue as TransformControlsPlane};
