import i from"./ScreenBase.js";import n from"./elements/ScreenElementJSONTree.js";import s from"./elements/ScreenElementButton.js";export default class h extends i{constructor(e,t){super(e,t);this.group.add(this.background),this.frameBorder=.05,this.updateObjects=this.updateObjects.bind(this),this.groupingCallback=this.groupingCallback.bind(this),this.itemSelected=this.itemSelected.bind(this),this.itemHover=this.itemHover.bind(this),this.onCreateObject=this.onCreateObject.bind(this),this.onDestroyObject=this.onDestroyObject.bind(this),this.jsonTree=new n(this,this,{y:.05,width:this.width-this.frameBorder,height:this.height-this.frameBorder-.1,collapsibleDragCallback:this.groupingCallback,itemSelected:this.itemSelected,itemHover:this.itemHover}),this.registerElement(this.jsonTree),this.jsonTree.setSchema(this.getSchema()),this.createButton=new s(this,this,{x:-this.width/4,y:-this.height/2+this.frameBorder+.05,width:.2,height:.1,text:"Create"}),this.createButton.setOnClickCallback(this.onCreateObject),this.registerElement(this.createButton),this.destroyButton=new s(this,this,{x:this.width/4,y:-this.height/2+this.frameBorder+.05,width:.2,height:.1,text:"Destroy"}),this.destroyButton.setOnClickCallback(this.onDestroyObject),this.registerElement(this.destroyButton)}onCreateObject(){this.screenManager.showScreen(this.screenManager.screenObjectCreate)}onDestroyObject(){this.screenManager.conjure.world.objectControls.detachAll({isDeleting:!0})}updateObjects(){if(!this.active)return;this.jsonTree.updateTree(this.screenManager.conjure.getWorld().getObjects(),this.updateObjects)}groupingCallback(e,t){return!!this.screenManager.conjure.getWorld().realm.getObjectManager().groupObjects(e,t)}itemSelected(e,t){e?this.screenManager.conjure.world.objectControls.attach(t,{ignoreScreenUpdate:!0,detachOthers:!this.screen.screenManager.conjure.input.isDown("SHIFT",!0)}):this.screenManager.conjure.world.objectControls.detach(t,{ignoreScreenUpdate:!0})}itemHover(e,t){e&&this.screenManager.conjure.postProcessing.setHoverObject(t)}selectObject(e,t){if(!this.active)return;let r=this.jsonTree.getItemByReference(this.jsonTree.scrollPanel.items,t);r&&r.setSelected(e,{ignoreCallback:!0})}getSchema(){return{type:"array",label:"name",items:{children:{type:"array",items:"root"}}}}showScreen(e){super.showScreen(e),this.jsonTree.setActive(e),e&&this.updateObjects()}update(e){super.update(e)}}
