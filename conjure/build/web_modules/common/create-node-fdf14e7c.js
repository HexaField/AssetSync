import{e as _r}from"./events-18451fd5.js";import{b as le,s as en,a as ke,m as cy,k as dy,c as Pf,d as rc,i as Yr,f as V,o as Nf,e as Ka,r as ly}from"./index-83680324.js";import{p as Ce}from"./process-e9e98960.js";import"./EventDispatcher-68e7f1a9.js";import{b as pe}from"./buffer-es6-e6024076.js";import{c as ne,a as se,g as uy,d as xf,b as fy}from"./_commonjsHelpers-c99fd594.js";import"./constants-83de7adf.js";import{c as mt,v as be,a as kn,e as li,b as tn,k as hy,s as py}from"./datastore-utils-a4f1683f.js";import{t as Ae}from"./to-string-b6e14ed9.js";import{f as St}from"./from-string-5d106fde.js";import{e as G,c as rn,s as Pd}from"./index-19b99eb6.js";import{r as os}from"./__node-resolve:empty-8495aa00.js";import"./util-17dff6c2.js";import{a as Wa}from"./url-8d978716.js";import{n as Nd}from"./empty-add391ca.js";import{p as my}from"./path-d977e441.js";import{r as gy}from"./_node-fetch_commonjs-proxy-271b4446.js";import{a as Of,b as qr,s as Er,B as Ar,c as lr,d as Ya,e as cs,h as by,r as xd,p as yy,f as vy,g as Df,j as wy}from"./index-ab11cbe0.js";import{d as Sy}from"./dhtConfig-73de4e98.js";(function(){if(typeof globalThis=="object")return;Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__})();var Pn=globalThis;const _y=async e=>{const t=[];for await(const r of e)t.push(r);return t};var Bf=_y;class Lf extends Error{constructor(e){super(e||"Promise was canceled");this.name="CancelError"}get isCanceled(){return!0}}class Od{static fn(e){return(...t)=>new Od((r,i,n)=>{t.push(n),e(...t).then(r,i)})}constructor(e){this._cancelHandlers=[],this._isPending=!0,this._isCanceled=!1,this._rejectOnCancel=!0,this._promise=new Promise((t,r)=>{this._reject=r;const i=a=>{this._isPending=!1,t(a)},n=a=>{this._isPending=!1,r(a)},s=a=>{if(!this._isPending)throw new Error("The `onCancel` handler was attached after the promise settled.");this._cancelHandlers.push(a)};return Object.defineProperties(s,{shouldReject:{get:()=>this._rejectOnCancel,set:a=>{this._rejectOnCancel=a}}}),e(i,n,s)})}then(e,t){return this._promise.then(e,t)}catch(e){return this._promise.catch(e)}finally(e){return this._promise.finally(e)}cancel(e){if(!this._isPending||this._isCanceled)return;if(this._cancelHandlers.length>0)try{for(const t of this._cancelHandlers)t()}catch(t){this._reject(t)}this._isCanceled=!0,this._rejectOnCancel&&this._reject(new Lf(e))}get isCanceled(){return this._isCanceled}}Object.setPrototypeOf(Od.prototype,Promise.prototype);var Dd=Od,Ey=Lf;Dd.CancelError=Ey;class jf extends Error{}const Ay=(e,t)=>new Dd((r,i,n)=>{const{count:s,filter:a=()=>!0}=t;if(!Number.isFinite(s)){i(new TypeError(`Expected a finite number, got ${typeof t.count}`));return}const c=[],o=[];let d=0,l=!1;const u=new Set,p=()=>(c.length===s&&(r(c),l=!0),d-o.length<s&&(i(new Of(o)),l=!0),l),f=()=>{for(const g of e)!u.has(g)&&typeof g.cancel=="function"&&g.cancel()};n(f);for(const g of e)d++,(async()=>{try{const v=await g;if(l)return;if(!a(v))throw new jf("Value does not satisfy filter");c.push(v)}catch(v){o.push(v)}finally{u.add(g),!l&&p()&&f()}})();s>d&&(i(new RangeError(`Expected input to contain at least ${t.count} items, but contains ${d} items`)),f())});var ic=Ay,Iy=Of,Ty=jf;ic.AggregateError=Iy,ic.FilterError=Ty;var Za=(e,t)=>{const r=ic(e,{...t,count:1});return Dd.fn(async i=>{i(()=>{r.cancel()});const[n]=await r;return n})()},Cy=ic.AggregateError;Za.AggregateError=Cy;const js=new Map,Ry=()=>`${Date.now()}:${Math.floor(Math.random()*1e6)}`;async function My(e,t,r){for(;js.get(r);){try{await e()}catch(i){setTimeout(()=>{throw i},1);break}if(!js.get(r))break;await new Promise(i=>{const n=setTimeout(i,t);js.set(r,n)})}}function ky(e,t,r){r=r||t;const i=Ry(),n=setTimeout(()=>{My(e,t,i)},r);return js.set(i,n),i}function Py(e){const t=js.get(e);t&&(clearTimeout(t),js.delete(e))}var Ff={setDelayedInterval:ky,clearDelayedInterval:Py};const Ny=Object.assign(le("libp2p:peer-routing"),{error:le("libp2p:peer-routing:err")}),{setDelayedInterval:xy,clearDelayedInterval:Oy}=Ff;class Dy{constructor(e){this._peerId=e.peerId,this._peerStore=e.peerStore,this._routers=e._modules.peerRouting||[],e._dht&&this._routers.unshift(e._dht),this._refreshManagerOptions=e._options.peerRouting.refreshManager,this._findClosestPeersTask=this._findClosestPeersTask.bind(this)}start(){if(!this._routers.length||this._timeoutId||!this._refreshManagerOptions.enabled)return;this._timeoutId=xy(this._findClosestPeersTask,this._refreshManagerOptions.interval,this._refreshManagerOptions.bootDelay)}async _findClosestPeersTask(){try{for await(const{id:e,multiaddrs:t}of this.getClosestPeers(this._peerId.id))this._peerStore.addressBook.add(e,t)}catch(e){Ny.error(e)}}stop(){Oy(this._timeoutId)}async findPeer(e,t){if(!this._routers.length)throw G(new Error("No peer routers available"),"NO_ROUTERS_AVAILABLE");return Za(this._routers.map(async r=>{const i=await r.findPeer(e,t);if(!i||Object.keys(i).length===0)throw G(new Error("not found"),"NOT_FOUND");return i}))}async*getClosestPeers(e,t={timeout:3e4}){if(!this._routers.length)throw G(new Error("No peer routers available"),"NO_ROUTERS_AVAILABLE");const r=await Za(this._routers.map(async i=>{const n=await Bf(i.getClosestPeers(e,t));if(!n||!n.length)throw G(new Error("not found"),"NOT_FOUND");return n}));for(const i of r)yield i}}var By=Dy,Ly={NOT_STARTED_YET:"The libp2p node is not started yet",DHT_DISABLED:"DHT is not available",CONN_ENCRYPTION_REQUIRED:"At least one connection encryption module is required"},jy={DHT_DISABLED:"ERR_DHT_DISABLED",PUBSUB_NOT_STARTED:"ERR_PUBSUB_NOT_STARTED",DHT_NOT_STARTED:"ERR_DHT_NOT_STARTED",CONN_ENCRYPTION_REQUIRED:"ERR_CONN_ENCRYPTION_REQUIRED",ERR_CONNECTION_ENDED:"ERR_CONNECTION_ENDED",ERR_CONNECTION_FAILED:"ERR_CONNECTION_FAILED",ERR_NODE_NOT_STARTED:"ERR_NODE_NOT_STARTED",ERR_ALREADY_ABORTED:"ERR_ALREADY_ABORTED",ERR_NO_VALID_ADDRESSES:"ERR_NO_VALID_ADDRESSES",ERR_DIALED_SELF:"ERR_DIALED_SELF",ERR_DISCOVERED_SELF:"ERR_DISCOVERED_SELF",ERR_DUPLICATE_TRANSPORT:"ERR_DUPLICATE_TRANSPORT",ERR_ENCRYPTION_FAILED:"ERR_ENCRYPTION_FAILED",ERR_HOP_REQUEST_FAILED:"ERR_HOP_REQUEST_FAILED",ERR_INVALID_KEY:"ERR_INVALID_KEY",ERR_INVALID_MESSAGE:"ERR_INVALID_MESSAGE",ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS",ERR_INVALID_PEER:"ERR_INVALID_PEER",ERR_MUXER_UNAVAILABLE:"ERR_MUXER_UNAVAILABLE",ERR_TIMEOUT:"ERR_TIMEOUT",ERR_TRANSPORT_UNAVAILABLE:"ERR_TRANSPORT_UNAVAILABLE",ERR_TRANSPORT_DIAL_FAILED:"ERR_TRANSPORT_DIAL_FAILED",ERR_UNSUPPORTED_PROTOCOL:"ERR_UNSUPPORTED_PROTOCOL",ERR_INVALID_MULTIADDR:"ERR_INVALID_MULTIADDR",ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"},tr={messages:Ly,codes:jy};const{messages:Bd,codes:Ld}=tr;class Fy{constructor(e){this.libp2p=e,this.routers=e._modules.contentRouting||[],this.dht=e._dht,this.dht&&this.routers.unshift(this.dht)}async*findProviders(e,t){if(!this.routers.length)throw G(new Error("No content this.routers available"),"NO_ROUTERS_AVAILABLE");const r=await Za(this.routers.map(async i=>{const n=await Bf(i.findProviders(e,t));if(!n||!n.length)throw G(new Error("not found"),"NOT_FOUND");return n}));for(const i of r)yield i}async provide(e){if(!this.routers.length)throw G(new Error("No content routers available"),"NO_ROUTERS_AVAILABLE");await Promise.all(this.routers.map(t=>t.provide(e)))}put(e,t,r){if(!this.libp2p.isStarted()||!this.dht.isStarted)throw G(new Error(Bd.NOT_STARTED_YET),Ld.DHT_NOT_STARTED);return this.dht.put(e,t,r)}get(e,t){if(!this.libp2p.isStarted()||!this.dht.isStarted)throw G(new Error(Bd.NOT_STARTED_YET),Ld.DHT_NOT_STARTED);return this.dht.get(e,t)}async getMany(e,t,r){if(!this.libp2p.isStarted()||!this.dht.isStarted)throw G(new Error(Bd.NOT_STARTED_YET),Ld.DHT_NOT_STARTED);return this.dht.getMany(e,t,r)}}var Uy=Fy;const qy=qr,jd=qr.v4,Uf=qr.v6,qf=function(e,t,r){r=~~r;var i;if(jd(e))i=t||new Uint8Array(r+4),e.split(/\./g).map(function(l){i[r++]=parseInt(l,10)&255});else if(Uf(e)){var n=e.split(":",8),s;for(s=0;s<n.length;s++){var a=jd(n[s]),c;a&&(c=qf(n[s]),n[s]=Ae(c.slice(0,2),"base16")),c&&++s<8&&n.splice(s,0,Ae(c.slice(2,4),"base16"))}if(n[0]==="")for(;n.length<8;)n.unshift("0");else if(n[n.length-1]==="")for(;n.length<8;)n.push("0");else if(n.length<8){for(s=0;s<n.length&&n[s]!=="";s++);var o=[s,"1"];for(s=9-n.length;s>0;s--)o.push("0");n.splice.apply(n,o)}for(i=t||new Uint8Array(r+16),s=0;s<n.length;s++){var d=parseInt(n[s],16);i[r++]=d>>8&255,i[r++]=d&255}}if(!i)throw Error("Invalid ip address: "+e);return i},zy=function(e,t,r){t=~~t,r=r||e.length-t;var i=[],n;const s=new DataView(e.buffer);if(r===4){for(let a=0;a<r;a++)i.push(e[t+a]);n=i.join(".")}else if(r===16){for(let a=0;a<r;a+=2)i.push(s.getUint16(t+a).toString(16));n=i.join(":"),n=n.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),n=n.replace(/:{3,4}/,"::")}return n};var nc={isIP:qy,isV4:jd,isV6:Uf,toBytes:qf,toString:zy};function kr(e){if(typeof e=="number"){if(kr.codes[e])return kr.codes[e];throw new Error("no protocol with code: "+e)}else if(typeof e=="string"||e instanceof String){if(kr.names[e])return kr.names[e];throw new Error("no protocol with name: "+e)}throw new Error("invalid protocol id type: "+e)}const Zr=-1;kr.lengthPrefixedVarSize=Zr,kr.V=Zr,kr.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Zr,"ip6zone"],[53,Zr,"dns","resolvable"],[54,Zr,"dns4","resolvable"],[55,Zr,"dns6","resolvable"],[56,Zr,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Zr,"unix",!1,"path"],[421,Zr,"ipfs"],[421,Zr,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Zr,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Zr,"memory"]],kr.names={},kr.codes={},kr.table.map(e=>{const t=zf.apply(null,e);kr.codes[t.code]=t,kr.names[t.name]=t}),kr.object=zf;function zf(e,t,r,i,n){return{code:e,size:t,name:r,resolvable:Boolean(i),path:Boolean(n)}}var ui=kr,$f=Ja;function Ja(e,t){return t instanceof Uint8Array?Ja.toString(e,t):Ja.toBytes(e,t)}Ja.toString=function(t,r){t=ui(t);switch(t.code){case 4:case 41:return $y(r);case 6:case 273:case 33:case 132:return Vf(r);case 53:case 54:case 55:case 56:case 400:case 777:return Vy(r);case 421:return Xy(r);case 444:return Gf(r);case 445:return Gf(r);default:return Ae(r,"base16")}},Ja.toBytes=function(t,r){t=ui(t);switch(t.code){case 4:return Hf(r);case 41:return Hf(r);case 6:case 273:case 33:case 132:return Fd(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return Hy(r);case 421:return Gy(r);case 444:return Ky(r);case 445:return Wy(r);default:return St(r,"base16")}};function Hf(e){if(!nc.isIP(e))throw new Error("invalid ip address");return nc.toBytes(e)}function $y(e){const t=nc.toString(e);if(!t||!nc.isIP(t))throw new Error("invalid ip address");return t}function Fd(e){const t=new ArrayBuffer(2),r=new DataView(t);return r.setUint16(0,e),new Uint8Array(t)}function Vf(e){const t=new DataView(e.buffer);return t.getUint16(0)}function Hy(e){const t=St(e),r=Uint8Array.from(be.encode(t.length));return mt([r,t],r.length+t.length)}function Vy(e){const t=be.decode(e);if(e=e.slice(be.decode.bytes),e.length!==t)throw new Error("inconsistent lengths");return Ae(e)}function Gy(e){const t=new en(e).multihash,r=Uint8Array.from(be.encode(t.length));return mt([r,t],r.length+t.length)}function Xy(e){const t=be.decode(e),r=e.slice(be.decode.bytes);if(r.length!==t)throw new Error("inconsistent lengths");return Ae(r,"base58btc")}function Ky(e){const t=e.split(":");if(t.length!==2)throw new Error("failed to parse onion addr: "+t+" does not contain a port number");if(t[0].length!==16)throw new Error("failed to parse onion addr: "+t[0]+" not a Tor onion address.");const r=kn.decode("b"+t[0]),i=parseInt(t[1],10);if(i<1||i>65536)throw new Error("Port number is not in range(1, 65536)");const n=Fd(i);return mt([r,n],r.length+n.length)}function Wy(e){const t=e.split(":");if(t.length!==2)throw new Error("failed to parse onion addr: "+t+" does not contain a port number");if(t[0].length!==56)throw new Error("failed to parse onion addr: "+t[0]+" not a Tor onion3 address.");const r=kn.decode("b"+t[0]),i=parseInt(t[1],10);if(i<1||i>65536)throw new Error("Port number is not in range(1, 65536)");const n=Fd(i);return mt([r,n],r.length+n.length)}function Gf(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2),i=Ae(t,"base32"),n=Vf(r);return i+":"+n}var fi={stringToStringTuples:Xf,stringTuplesToString:Kf,tuplesToStringTuples:Yf,stringTuplesToTuples:Wf,bytesToTuples:Ud,tuplesToBytes:Zf,bytesToString:Yy,stringToBytes:Qf,fromString:Zy,fromBytes:eh,validateBytes:qd,isValidBytes:Jy,cleanPath:sc,ParseError:zd,protoFromTuple:Qa,sizeForAddr:Jf};function Xf(e){const t=[],r=e.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let i=0;i<r.length;i++){const n=r[i],s=ui(n);if(s.size===0){t.push([n]);continue}if(i++,i>=r.length)throw zd("invalid address: "+e);if(s.path){t.push([n,sc(r.slice(i).join("/"))]);break}t.push([n,r[i]])}return t}function Kf(e){const t=[];return e.map(r=>{const i=Qa(r);t.push(i.name),r.length>1&&t.push(r[1])}),sc(t.join("/"))}function Wf(e){return e.map(t=>{Array.isArray(t)||(t=[t]);const r=Qa(t);return t.length>1?[r.code,$f.toBytes(r.code,t[1])]:[r.code]})}function Yf(e){return e.map(t=>{const r=Qa(t);return t.length>1?[r.code,$f.toString(r.code,t[1])]:[r.code]})}function Zf(e){return eh(mt(e.map(t=>{const r=Qa(t);let i=Uint8Array.from(be.encode(r.code));return t.length>1&&(i=mt([i,t[1]])),i})))}function Jf(e,t){if(e.size>0)return e.size/8;if(e.size===0)return 0;{const r=be.decode(t);return r+be.decode.bytes}}function Ud(e){const t=[];let r=0;for(;r<e.length;){const i=be.decode(e,r),n=be.decode.bytes,s=ui(i),a=Jf(s,e.slice(r+n));if(a===0){t.push([i]),r+=n;continue}const c=e.slice(r+n,r+n+a);if(r+=a+n,r>e.length)throw zd("Invalid address Uint8Array: "+Ae(e,"base16"));t.push([i,c])}return t}function Yy(e){const t=Ud(e),r=Yf(t);return Kf(r)}function Qf(e){e=sc(e);const t=Xf(e),r=Wf(t);return Zf(r)}function Zy(e){return Qf(e)}function eh(e){const t=qd(e);if(t)throw t;return Uint8Array.from(e)}function qd(e){try{Ud(e)}catch(t){return t}}function Jy(e){return qd(e)===void 0}function sc(e){return"/"+e.trim().split("/").filter(t=>t).join("/")}function zd(e){return new Error("Error parsing address: "+e)}function Qa(e){const t=ui(e[0]);return t}var kt=ne(function(e,t){const r=Symbol.for("nodejs.util.inspect.custom"),i=new Map,n=rn.proto(function(s){if(!(this instanceof n))return new n(s);if(s==null&&(s=""),s instanceof Uint8Array)this.bytes=fi.fromBytes(s);else if(typeof s=="string"||s instanceof String){if(s.length>0&&s.charAt(0)!=="/")throw new Error(`multiaddr "${s}" must start with a "/"`);this.bytes=fi.fromString(s)}else if(s.bytes&&s.protos&&s.protoCodes)this.bytes=fi.fromBytes(s.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});n.prototype.toString=function(){return fi.bytesToString(this.bytes)},n.prototype.toJSON=n.prototype.toString,n.prototype.toOptions=function(){const a={},c=this.toString().split("/");return a.family=c[1]==="ip4"?"ipv4":"ipv6",a.host=c[2],a.transport=c[3],a.port=parseInt(c[4]),a},n.prototype[r]=function(){return"<Multiaddr "+Ae(this.bytes,"base16")+" - "+fi.bytesToString(this.bytes)+">"},n.prototype.inspect=function(){return"<Multiaddr "+Ae(this.bytes,"base16")+" - "+fi.bytesToString(this.bytes)+">"},n.prototype.protos=function(){return this.protoCodes().map(a=>Object.assign({},ui(a)))},n.prototype.protoCodes=function(){const a=[],c=this.bytes;let o=0;for(;o<c.length;){const d=be.decode(c,o),l=be.decode.bytes,u=ui(d),p=fi.sizeForAddr(u,c.slice(o+l));o+=p+l,a.push(d)}return a},n.prototype.protoNames=function(){return this.protos().map(a=>a.name)},n.prototype.tuples=function(){return fi.bytesToTuples(this.bytes)},n.prototype.stringTuples=function(){const a=fi.bytesToTuples(this.bytes);return fi.tuplesToStringTuples(a)},n.prototype.encapsulate=function(a){return a=n(a),n(this.toString()+a.toString())},n.prototype.decapsulate=function(a){a=a.toString();const c=this.toString(),o=c.lastIndexOf(a);if(o<0)throw new Error("Address "+this+" does not contain subaddress: "+a);return n(c.slice(0,o))},n.prototype.decapsulateCode=function(a){const c=this.tuples();for(let o=c.length-1;o>=0;o--)if(c[o][0]===a)return n(fi.tuplesToBytes(c.slice(0,o)));return this},n.prototype.getPeerId=function(){let a=null;try{const c=this.stringTuples().filter(o=>{if(o[0]===ui.names.ipfs.code)return!0});a=c.pop()[1],a=Ae(new en(a).multihash,"base58btc")}catch(c){a=null}return a},n.prototype.getPath=function(){let a=null;try{a=this.stringTuples().filter(c=>{const o=ui(c[0]);if(o.path)return!0})[0][1]}catch(c){a=null}return a},n.prototype.equals=function(a){return li(this.bytes,a.bytes)},n.prototype.resolve=async function(){const a=this.protos().find(d=>d.resolvable);if(!a)return[this];const c=i.get(a.name);if(!c)throw G(new Error(`no available resolver for ${a.name}`),"ERR_NO_AVAILABLE_RESOLVER");const o=await c(this);return o.map(d=>n(d))},n.prototype.nodeAddress=function(){const a=this.protoCodes(),c=this.protoNames(),o=this.toString().split("/").slice(1);if(o.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(a[0]!==4&&a[0]!==41&&a[0]!==54&&a[0]!==55)throw new Error(`no protocol with name: "'${c[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(o[2]!=="tcp"&&o[2]!=="udp")throw new Error(`no protocol with name: "'${c[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:a[0]===41||a[0]===55?6:4,address:o[1],port:parseInt(o[3])}},n.fromNodeAddress=function(a,c){if(!a)throw new Error("requires node address object");if(!c)throw new Error("requires transport protocol");let o;switch(a.family){case"IPv4":o="ip4";break;case"IPv6":o="ip6";break;default:throw Error(`Invalid addr family. Got '${a.family}' instead of 'IPv4' or 'IPv6'`)}return n("/"+[o,a.address,c,a.port].join("/"))},n.prototype.isThinWaistAddress=function(a){const c=(a||this).protos();return c.length!==2||c[0].code!==4&&c[0].code!==41?!1:!(c[1].code!==6&&c[1].code!==273)},n.protocols=ui,n.isName=function(a){return n.isMultiaddr(a)?a.protos().some(c=>c.resolvable):!1},n.resolve=function(a){return!n.isMultiaddr(a)||!n.isName(a)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},n.resolvers=i,t=e.exports=n});const{codes:Qy}=tr;function ev(e){typeof e=="string"&&(e=kt(e));let t;if(kt.isMultiaddr(e)){t=e;try{e=ke.createFromB58String(e.getPeerId())}catch(r){throw G(new Error(`${e} is not a valid peer type`),Qy.ERR_INVALID_MULTIADDR)}}return{id:e,multiaddrs:t?[t]:void 0}}var ac=ev,tv=th,Nn=th.prototype,rv=new Date%1e9;function iv(){return(Math.random()*1e9>>>0)+rv++}function th(e){e=e||{},this.id=e.id||iv(),this.max=e.max||Infinity,this.items=e.items||[],this._lookup={},this.size=this.items.length,this.lastModified=new Date(e.lastModified||new Date);for(var t,r,i=this.items.length;i--;)t=this.items[i],r=new Date(t.expires)-new Date,this._lookup[t.key]=t,r>0?this.expire(t.key,r):r<=0&&this.delete(t.key)}Nn.has=function(e){return e in this._lookup},Nn.get=function(e){if(!this.has(e))return null;var t=this._lookup[e];return t.refresh&&this.expire(e,t.refresh),this.items.splice(this.items.indexOf(t),1),this.items.push(t),t.value},Nn.meta=function(e){if(!this.has(e))return null;var t=this._lookup[e];return"meta"in t?t.meta:null},Nn.set=function(e,t,r){var i=this._lookup[e],n=this._lookup[e]={key:e,value:t};return this.lastModified=new Date,i?(clearTimeout(i.timeout),this.items.splice(this.items.indexOf(i),1,n)):(this.size>=this.max&&this.delete(this.items[0].key),this.items.push(n),this.size++),r&&("ttl"in r&&this.expire(e,r.ttl),"meta"in r&&(n.meta=r.meta),r.refresh&&(n.refresh=r.ttl)),this},Nn.delete=function(e){var t=this._lookup[e];return t?(this.lastModified=new Date,this.items.splice(this.items.indexOf(t),1),clearTimeout(t.timeout),delete this._lookup[e],this.size--,this):!1},Nn.expire=function(e,t){var r=t||0,i=this._lookup[e];if(!i)return this;if(typeof r=="string"&&(r=cy(t)),typeof r!="number")throw new TypeError("Expiration time must be a string or number.");return clearTimeout(i.timeout),i.timeout=setTimeout(this.delete.bind(this,i.key),r),i.expires=Number(new Date)+r,this},Nn.clear=function(){for(var e=this.items.length;e--;)this.delete(this.items[e].key);return this},Nn.toJSON=function(){for(var e=new Array(this.items.length),t,r=e.length;r--;)t=this.items[r],e[r]={key:t.key,meta:t.meta,value:t.value,expires:t.expires,refresh:t.refresh};return{id:this.id,max:isFinite(this.max)?this.max:void 0,lastModified:this.lastModified,items:e}};var rh=Object.prototype.toString,ih=function(t){var r=rh.call(t),i=r==="[object Arguments]";return i||(i=r!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&rh.call(t.callee)==="[object Function]"),i},nh;if(!Object.keys){var oc=Object.prototype.hasOwnProperty,sh=Object.prototype.toString,nv=ih,ah=Object.prototype.propertyIsEnumerable,sv=!ah.call({toString:null},"toString"),av=ah.call(function(){},"prototype"),cc=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],$d=function(e){var t=e.constructor;return t&&t.prototype===e},ov={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},cv=function(){if(typeof window=="undefined")return!1;for(var e in window)try{if(!ov["$"+e]&&oc.call(window,e)&&window[e]!==null&&typeof window[e]=="object")try{$d(window[e])}catch(t){return!0}}catch(t){return!0}return!1}(),dv=function(e){if(typeof window=="undefined"||!cv)return $d(e);try{return $d(e)}catch(t){return!1}};nh=function(t){var r=t!==null&&typeof t=="object",i=sh.call(t)==="[object Function]",n=nv(t),s=r&&sh.call(t)==="[object String]",a=[];if(!r&&!i&&!n)throw new TypeError("Object.keys called on a non-object");var c=av&&i;if(s&&t.length>0&&!oc.call(t,0))for(var o=0;o<t.length;++o)a.push(String(o));if(n&&t.length>0)for(var d=0;d<t.length;++d)a.push(String(d));else for(var l in t)!(c&&l==="prototype")&&oc.call(t,l)&&a.push(String(l));if(sv)for(var u=dv(t),p=0;p<cc.length;++p)!(u&&cc[p]==="constructor")&&oc.call(t,cc[p])&&a.push(cc[p]);return a}}var lv=nh,uv=Array.prototype.slice,oh=Object.keys,dc=oh?function(t){return oh(t)}:lv,ch=Object.keys;dc.shim=function(){if(Object.keys){var t=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);t||(Object.keys=function(i){return ih(i)?ch(uv.call(i)):ch(i)})}else Object.keys=dc;return Object.keys||dc};var fv=dc,hv=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",pv=Object.prototype.toString,mv=Array.prototype.concat,Hd=Object.defineProperty,gv=function(e){return typeof e=="function"&&pv.call(e)==="[object Function]"},bv=function(){var e={};try{Hd(e,"x",{enumerable:!1,value:e});for(var t in e)return!1;return e.x===e}catch(r){return!1}},dh=Hd&&bv(),yv=function(e,t,r,i){if(t in e&&(!gv(i)||!i()))return;dh?Hd(e,t,{configurable:!0,enumerable:!1,value:r,writable:!0}):e[t]=r},lh=function(e,t){var r=arguments.length>2?arguments[2]:{},i=fv(t);hv&&(i=mv.call(i,Object.getOwnPropertySymbols(t)));for(var n=0;n<i.length;n+=1)yv(e,i[n],t[i[n]],r[i[n]])};lh.supportsDescriptors=!!dh;var uh=lh,fh=ne(function(e){typeof self!="undefined"?e.exports=self:typeof window!="undefined"?e.exports=window:e.exports=Function("return this")()}),Vd=function(){return typeof se!="object"||!se||se.Math!==Math||se.Array!==Array?fh:se},vv=function(){var t=Vd();if(uh.supportsDescriptors){var r=Object.getOwnPropertyDescriptor(t,"globalThis");(!r||r.configurable&&(r.enumerable||r.writable||globalThis!==t))&&Object.defineProperty(t,"globalThis",{configurable:!0,enumerable:!1,value:t,writable:!1})}else(typeof globalThis!="object"||globalThis!==t)&&(t.globalThis=t);return t},wv=Vd(),hh=function(){return wv};uh(hh,{getPolyfill:Vd,implementation:fh,shim:vv});var Sv=hh,_v=ne(function(e){const t=Sv();t.fetch&&t.Headers&&t.Request&&t.Response?(e.exports=function(...i){return t.fetch(...i)},e.exports.Headers=t.Headers,e.exports.Request=t.Request,e.exports.Response=t.Response,e.exports.default=e.exports):e.exports=gy});const{default:Ev,Headers:Av}=_v;function Iv({serverResolver:e,hostname:t,recordType:r}){return`${e}?name=${t}&type=${r}`}var Tv=Iv;function Cv(e){return Ev(e,{headers:new Av({accept:"application/dns-json"})})}var Rv=Cv;function Mv(e,t){return`${t}_${e}`}var kv=Mv,Pv={buildResource:Tv,fetch:Rv,getCacheKey:kv};const lc=le("dns-over-http-resolver");lc.error=le("dns-over-http-resolver:error");const{buildResource:Gd,fetch:Xd,getCacheKey:Fs}=Pv;class Kd{constructor({maxCache:e=100}={}){this._cache=new tv({max:e}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"]}getServers(){return this._servers}_getShuffledServers(){const e=[].concat(this._servers);for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*t),i=e[t];e[t]=e[r],e[r]=i}return e}setServers(e){this._servers=e}resolve(e,t="A"){switch(t){case"A":return this.resolve4(e);case"AAAA":return this.resolve6(e);case"TXT":return this.resolveTxt(e);default:throw new Error(`${t} is not supported`)}}async resolve4(e){const t="A",r=this._cache.get(Fs(e,t));if(r)return r;for(const i of this._getShuffledServers())try{const n=await Xd(Gd({serverResolver:i,hostname:e,recordType:t})),s=await n.json(),a=s.Answer.map(o=>o.data),c=Math.min(s.Answer.map(o=>o.TTL));return this._cache.set(Fs(e,t),a,{ttl:c}),a}catch(n){lc.error(`${i} could not resolve ${e} record ${t}`)}throw new Error(`Could not resolve ${e} record ${t}`)}async resolve6(e){const t="AAAA",r=this._cache.get(Fs(e,t));if(r)return r;for(const i of this._getShuffledServers())try{const n=await Xd(Gd({serverResolver:i,hostname:e,recordType:t})),s=await n.json(),a=s.Answer.map(o=>o.data),c=Math.min(s.Answer.map(o=>o.TTL));return this._cache.set(Fs(e,t),a,{ttl:c}),a}catch(n){lc.error(`${i} could not resolve ${e} record ${t}`)}throw new Error(`Could not resolve ${e} record ${t}`)}async resolveTxt(e){const t="TXT",r=this._cache.get(Fs(e,t));if(r)return r;for(const i of this._getShuffledServers())try{const n=await Xd(Gd({serverResolver:i,hostname:e,recordType:t})),s=await n.json(),a=s.Answer.map(o=>[o.data.replace(/['"]+/g,"")]),c=Math.min(s.Answer.map(o=>o.TTL));return this._cache.set(Fs(e,t),a,{ttl:c}),a}catch(n){lc.error(`${i} could not resolve ${e} record ${t}`)}throw new Error(`Could not resolve ${e} record ${t}`)}}Kd.Resolver=Kd;var Nv=Kd;let uc;try{if(uc=Nd.promises,!uc)throw new Error("no dns available")}catch(e){uc=Nv}var xv=uc;const{code:Ov}=ui("dnsaddr");async function Dv(e){const{Resolver:t}=xv,r=new t,i=e.getPeerId(),[,n]=e.stringTuples().find(([c])=>c===Ov)||[],s=await r.resolveTxt(`_dnsaddr.${n}`);let a=s.flat().map(c=>c.split("=")[1]);return i&&(a=a.filter(c=>c.includes(i))),a}var Bv={dnsaddrResolver:Dv},eo={DIAL_TIMEOUT:3e4,MAX_PARALLEL_DIALS:100,MAX_PER_PEER_DIALS:4,METRICS:{computeThrottleMaxQueueSize:1e3,computeThrottleTimeout:2e3,movingAverageIntervals:[60*1e3,5*60*1e3,15*60*1e3],maxOldPeersRetention:50}};const Lv="libp2p",jv="0.30.0",Fv="JavaScript implementation of libp2p, a modular peer to peer network stack",Uv="Jacob Heun <jacobheun@gmail.com>",qv="src/index.js",zv="dist/src/index.d.ts",$v={"*":{"src/*":["dist/src/*","dist/src/*/index"]}},Hv=["dist","src"],Vv={lint:"aegir lint",build:"aegir build",test:"npm run test:node && npm run test:browser","test:node":'aegir test -t node -f "./test/**/*.{node,spec}.js"',"test:browser":"aegir test -t browser","test:examples":"cd examples && npm run test:all",release:"aegir release -t node -t browser","release-minor":"aegir release --type minor -t node -t browser","release-major":"aegir release --type major -t node -t browser",coverage:"nyc --reporter=text --reporter=lcov npm run test:node"},Gv={type:"git",url:"https://github.com/libp2p/js-libp2p.git"},Xv=["libp2p","network","p2p","peer","peer-to-peer","IPFS"],Kv={url:"https://github.com/libp2p/js-libp2p/issues"},Wv="https://libp2p.io",Yv="MIT",Zv={node:">=12.0.0",npm:">=6.0.0"},Jv={"abort-controller":"^3.0.0","aggregate-error":"^3.0.1","any-signal":"^1.1.0","bignumber.js":"^9.0.0",cids:"^1.0.0","class-is":"^1.1.0",debug:"^4.1.1","err-code":"^2.0.0",events:"^3.1.0",hashlru:"^2.3.0","interface-datastore":"^2.0.0","ipfs-utils":"^5.0.1","it-all":"^1.0.1","it-buffer":"^0.1.2","it-handshake":"^1.0.1","it-length-prefixed":"^3.0.1","it-pipe":"^1.1.0","it-protocol-buffers":"^0.2.0","libp2p-crypto":"^0.18.0","libp2p-interfaces":"^0.8.1","libp2p-utils":"^0.2.2",mafmt:"^8.0.0","merge-options":"^2.0.0","moving-average":"^1.0.0",multiaddr:"^8.1.0",multicodec:"^2.0.0","multihashing-async":"^2.0.1","multistream-select":"^1.0.0","mutable-proxy":"^1.0.0","node-forge":"^0.9.1","p-any":"^3.0.0","p-fifo":"^1.0.0","p-settle":"^4.0.1","peer-id":"^0.14.2",protons:"^2.0.0",retimer:"^2.0.0","sanitize-filename":"^1.6.3","set-delayed-interval":"^1.0.0","streaming-iterables":"^5.0.2","timeout-abort-controller":"^1.1.1",varint:"^5.0.0",xsalsa20:"^1.0.2"},Qv={"@nodeutils/defaults-deep":"^1.1.0","abortable-iterator":"^3.0.0",aegir:"^29.2.0","chai-bytes":"^0.1.2","chai-string":"^1.5.0",delay:"^4.3.0","interop-libp2p":"^0.3.0","into-stream":"^6.0.0","ipfs-http-client":"^47.0.1","it-concat":"^1.0.0","it-pair":"^1.0.0","it-pushable":"^1.4.0",libp2p:".","libp2p-bootstrap":"^0.12.0","libp2p-delegated-content-routing":"^0.8.0","libp2p-delegated-peer-routing":"^0.8.0","libp2p-floodsub":"^0.24.0","libp2p-gossipsub":"^0.7.0","libp2p-kad-dht":"^0.20.0","libp2p-mdns":"^0.15.0","libp2p-mplex":"^0.10.1","libp2p-noise":"^2.0.0","libp2p-secio":"^0.13.1","libp2p-tcp":"^0.15.1","libp2p-webrtc-star":"^0.20.0","libp2p-websockets":"^0.15.0",multihashes:"^3.0.1",nock:"^13.0.3","p-defer":"^3.0.0","p-times":"^3.0.0","p-wait-for":"^3.1.0","promisify-es6":"^1.0.3",rimraf:"^3.0.2",sinon:"^9.0.2",uint8arrays:"^1.1.0"},e1=["David Dias <daviddias.p@gmail.com>","Jacob Heun <jacobheun@gmail.com>","Vasco Santos <vasco.santos@moxy.studio>","Alan Shaw <alan@tableflip.io>","Alex Potsides <alex@achingbrain.net>","Cayman <caymannava@gmail.com>","Pedro Teixeira <i@pgte.me>","Friedel Ziegelmayer <dignifiedquire@gmail.com>","Maciej Kr\xFCger <mkg20001@gmail.com>","Hugo Dias <mail@hugodias.me>","dirkmc <dirkmdev@gmail.com>","Volker Mische <volker.mische@gmail.com>","Richard Littauer <richard.littauer@gmail.com>","a1300 <matthias-knopp@gmx.net>","Elven <mon.samuel@qq.com>","Andrew Nesbitt <andrewnez@gmail.com>","Giovanni T. Parra <fiatjaf@gmail.com>","Ryan Bell <ryan@piing.net>","Thomas Eizinger <thomas@eizinger.io>","\u1D20\u026A\u1D04\u1D1B\u1D0F\u0280 \u0299\u1D0A\u1D07\u029F\u1D0B\u029C\u1D0F\u029F\u1D0D <victorbjelkholm@gmail.com>","Didrik Nordstr\xF6m <didrik@betamos.se>","Irakli Gozalishvili <rfobic@gmail.com>","Ethan Lam <elmemphis2000@gmail.com>","Joel Gustafson <joelg@mit.edu>","Julien Bouquillon <contact@revolunet.com>","Kevin Kwok <antimatter15@gmail.com>","Nuno Nogueira <nunofmn@gmail.com>","Dmitriy Ryajov <dryajov@gmail.com>","RasmusErik Voel Jensen <github@solsort.com>","Diogo Silva <fsdiogo@gmail.com>","Samlior <samlior@foxmail.com>","Smite Chow <xiaopengyou@live.com>","Soeren <nikorpoulsen@gmail.com>","S\xF6nke Hahn <soenkehahn@gmail.com>","robertkiel <robert.kiel@validitylabs.org>","Tiago Alves <alvesjtiago@gmail.com>","Daijiro Wachi <daijiro.wachi@gmail.com>","Yusef Napora <yusef@napora.org>","Zane Starr <zcstarr@gmail.com>","Cindy Wu <ciindy.wu@gmail.com>","Chris Bratlien <chrisbratlien@gmail.com>","ebinks <elizabethjbinks@gmail.com>","Bernd Strehl <bernd.strehl@gmail.com>","Florian-Merle <florian.david.merle@gmail.com>","Francis Gulotta <wizard@roborooter.com>","Felipe Martins <felipebrasil93@gmail.com>","isan_rivkin <isanrivkin@gmail.com>","Henrique Dias <hacdias@gmail.com>","Fei Liu <liu.feiwood@gmail.com>"];var t1={name:Lv,version:jv,description:Fv,leadMaintainer:Uv,main:qv,types:zv,typesVersions:$v,files:Hv,scripts:Vv,repository:Gv,keywords:Xv,bugs:Kv,homepage:Wv,license:Yv,engines:Zv,dependencies:Jv,devDependencies:Qv,contributors:e1};const r1=t1.version;var i1="ipfs/0.1.0",n1=`js-libp2p/${r1}`,s1="/ipfs/id/1.0.0",a1="/ipfs/id/push/1.0.0",ph={PROTOCOL_VERSION:i1,AGENT_VERSION:n1,MULTICODEC_IDENTIFY:s1,MULTICODEC_IDENTIFY_PUSH:a1};const mh=60*1e3;var fc={ADVERTISE_BOOT_DELAY:15*mh,ADVERTISE_TTL:30*mh,CIRCUIT_PROTO_CODE:290,HOP_METADATA_KEY:"hop_relay",HOP_METADATA_VALUE:"true",RELAY_RENDEZVOUS_NS:"/libp2p/relay"},o1=ne(function(e,t){(function(){var r,i,n;n=function(s){var a,c,o,d;return a=(s&255<<24)>>>24,c=(s&255<<16)>>>16,o=(s&255<<8)>>>8,d=s&255,[a,c,o,d].join(".")},i=function(s){var a,c,o,d,l;if(a=(s+"").split("."),a.length===0||a.length>4)throw new Error("Invalid IP");for(o=d=0,l=a.length;d<l;o=++d){if(c=a[o],isNaN(parseInt(c,10)))throw new Error("Invalid byte: "+c);if(c<0||c>255)throw new Error("Invalid byte: "+c)}return((a[0]||0)<<24|(a[1]||0)<<16|(a[2]||0)<<8|(a[3]||0))>>>0},r=function(){function s(a,c){var o,d,l;if(typeof a!="string")throw new Error("Missing `net' parameter");if(c||(l=a.split("/",2),a=l[0],c=l[1]),!c)switch(a.split(".").length){case 1:c=8;break;case 2:c=16;break;case 3:c=24;break;case 4:c=32;break;default:throw new Error("Invalid net address: "+a)}if(typeof c=="string"&&c.indexOf(".")>-1){try{this.maskLong=i(c)}catch(u){throw new Error("Invalid mask: "+c)}for(o=d=32;d>=0;o=--d)if(this.maskLong===4294967295<<32-o>>>0){this.bitmask=o;break}}else if(c)this.bitmask=parseInt(c,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(i(a)&this.maskLong)>>>0}catch(u){throw new Error("Invalid net address: "+a)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+c);this.size=Math.pow(2,32-this.bitmask),this.base=n(this.netLong),this.mask=n(this.maskLong),this.hostmask=n(~this.maskLong),this.first=this.bitmask<=30?n(this.netLong+1):this.base,this.last=this.bitmask<=30?n(this.netLong+this.size-2):n(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?n(this.netLong+this.size-1):void 0}return s.prototype.contains=function(a){return typeof a=="string"&&(a.indexOf("/")>0||a.split(".").length!==4)&&(a=new s(a)),a instanceof s?this.contains(a.base)&&this.contains(a.broadcast||a.last):(i(a)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},s.prototype.next=function(a){return a==null&&(a=1),new s(n(this.netLong+this.size*a),this.mask)},s.prototype.forEach=function(a){var c,o,d,l,u,p,f,g;for(u=function(){f=[];for(var v=p=i(this.first),S=i(this.last);p<=S?v<=S:v>=S;p<=S?v++:v--)f.push(v);return f}.apply(this),g=[],c=o=0,d=u.length;o<d;c=++o)l=u[c],g.push(a(n(l),l,c));return g},s.prototype.toString=function(){return this.base+"/"+this.bitmask},s}(),t.ip2long=i,t.long2ip=n,t.Netmask=r}).call(se)}),c1=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=o1.Netmask;function i(s){var a=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"].map(function(f){return new r(f)}),c=!0,o=!1,d=void 0;try{for(var l=a[Symbol.iterator](),u;!(c=(u=l.next()).done);c=!0){var p=u.value;if(p.contains(s))return!0}}catch(f){o=!0,d=f}finally{try{!c&&l.return&&l.return()}finally{if(o)throw d}}return!1}function n(s){return/^::$/.test(s)||/^::1$/.test(s)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(s)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(s)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(s)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(s)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(s)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(s)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(s)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(s)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(s)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(s)||/^ff([0-9a-fA-F]{2,2}):/i.test(s)}t.default=function(s){return qr.v4(s)||s.startsWith("0")?i(s):n(s)}}),d1=c1.default;function l1(e){const{address:t}=e.nodeAddress();return d1(t)}var gh=l1;function u1(e,t){const r=gh(e.multiaddr),i=gh(t.multiaddr);return r&&!i?1:!r&&i||e.isCertified&&!t.isCertified?-1:!e.isCertified&&t.isCertified?1:0}function f1(e){return[...e].sort(u1)}var h1=f1,bh={publicAddressesFirst:h1};const yh=async e=>{try{const t=await e;return{isFulfilled:!0,isRejected:!1,value:t}}catch(t){return{isFulfilled:!1,isRejected:!0,reason:t}}};var hc=yh,p1=yh;hc.default=p1;const vh=(e,...t)=>new Promise(r=>{r(e(...t))});var wh=vh,m1=vh;wh.default=m1;const Sh=e=>{if(!((Number.isInteger(e)||e===Infinity)&&e>0))return Promise.reject(new TypeError("Expected `concurrency` to be a number from 1 and up"));const t=[];let r=0;const i=()=>{r--,t.length>0&&t.shift()()},n=(c,o,...d)=>{r++;const l=wh(c,...d);o(l),l.then(i,i)},s=(c,o,...d)=>{r<e?n(c,o,...d):t.push(n.bind(null,c,o,...d))},a=(c,...o)=>new Promise(d=>s(c,d,...o));return Object.defineProperties(a,{activeCount:{get:()=>r},pendingCount:{get:()=>t.length},clearQueue:{value:()=>{t.length=0}}}),a};var _h=Sh,g1=Sh;_h.default=g1;var b1=async(e,t={})=>{const{concurrency:r=Infinity}=t,i=_h(r);return Promise.all(e.map(n=>n&&typeof n.then=="function"?hc(n):typeof n=="function"?hc(i(()=>n())):hc(Promise.resolve(n))))},Eh=tn(`
message Envelope {
  // public_key is the public key of the keypair the enclosed payload was
  // signed with.
  bytes public_key = 1;

  // payload_type encodes the type of payload, so that it can be deserialized
  // deterministically.
  bytes payload_type = 2;

  // payload is the actual payload carried inside this envelope.
  bytes payload = 3;

  // signature is the signature produced by the private key corresponding to
  // the enclosed public key, over the payload, prefixing a domain string for
  // additional security.
  bytes signature = 5;
}
`);const{codes:y1}=tr;class ds{constructor({peerId:e,payloadType:t,payload:r,signature:i}){this.peerId=e,this.payloadType=t,this.payload=r,this.signature=i,this._marshal=void 0}marshal(){if(this._marshal)return this._marshal;const e=dy.marshalPublicKey(this.peerId.pubKey);return this._marshal=Eh.Envelope.encode({public_key:e,payload_type:this.payloadType,payload:this.payload,signature:this.signature}),this._marshal}equals(e){return li(this.peerId.pubKey.bytes,e.peerId.pubKey.bytes)&&li(this.payloadType,e.payloadType)&&li(this.payload,e.payload)&&li(this.signature,e.signature)}validate(e){const t=Ah(e,this.payloadType,this.payload);return this.peerId.pubKey.verify(t,this.signature)}}const Ah=(e,t,r)=>{const i=St(e),n=be.encode(i.byteLength),s=be.encode(t.length),a=be.encode(r.length);return mt([new Uint8Array(n),i,new Uint8Array(s),t,new Uint8Array(a),r])};ds.createFromProtobuf=async e=>{const t=Eh.Envelope.decode(e),r=await ke.createFromPubKey(t.public_key);return new ds({peerId:r,payloadType:t.payload_type,payload:t.payload,signature:t.signature})},ds.seal=async(e,t)=>{const r=e.domain,i=e.codec,n=e.marshal(),s=Ah(r,i,n),a=await t.privKey.sign(s);return new ds({peerId:t,payloadType:i,payload:n,signature:a})},ds.openAndCertify=async(e,t)=>{const r=await ds.createFromProtobuf(e),i=await r.validate(t);if(!i)throw G(new Error("envelope signature is not valid for the given domain"),y1.ERR_SIGNATURE_NOT_VALID);return r};var to=ds;function v1(e,t){return e.length===t.length&&t.sort()&&e.sort().every((r,i)=>t[i].equals(r))}var w1=v1,Ih=tn(`
message PeerRecord {
    // AddressInfo is a wrapper around a binary multiaddr. It is defined as a
    // separate message to allow us to add per-address metadata in the future.
    message AddressInfo {
        bytes multiaddr = 1;
    }

    // peer_id contains a libp2p peer id in its binary representation.
    bytes peer_id = 1;

    // seq contains a monotonically-increasing sequence counter to order PeerRecords in time.
    uint64 seq = 2;

    // addresses is a list of public listen addresses for the peer.
    repeated AddressInfo addresses = 3;
}
`);const S1=Pf.getName(Pf.LIBP2P_PEER_RECORD)||"libp2p-peer-record",_1=Uint8Array.from([3,1]);var E1={ENVELOPE_DOMAIN_PEER_RECORD:S1,ENVELOPE_PAYLOAD_TYPE_PEER_RECORD:_1};const{ENVELOPE_DOMAIN_PEER_RECORD:Th,ENVELOPE_PAYLOAD_TYPE_PEER_RECORD:A1}=E1;class ro{constructor({peerId:e,multiaddrs:t=[],seqNumber:r=Date.now()}){this.domain=Th,this.codec=A1,this.peerId=e,this.multiaddrs=t,this.seqNumber=r,this._marshal=void 0}marshal(){return this._marshal?this._marshal:(this._marshal=Ih.PeerRecord.encode({peer_id:this.peerId.toBytes(),seq:this.seqNumber,addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))}),this._marshal)}equals(e){return e instanceof ro&&this.peerId.equals(e.peerId)?this.seqNumber!==e.seqNumber?!1:!!w1(this.multiaddrs,e.multiaddrs):!1}}ro.createFromProtobuf=e=>{const t=Ih.PeerRecord.decode(e),r=ke.createFromBytes(t.peer_id),i=(t.addresses||[]).map(s=>kt(s.multiaddr)),n=t.seq;return new ro({peerId:r,multiaddrs:i,seqNumber:n})},ro.DOMAIN=Th;var pc=ro;async function I1(e){const t=new pc({peerId:e.peerId,multiaddrs:e.multiaddrs}),r=await to.seal(t,e.peerId);e.peerStore.addressBook.consumePeerRecord(r)}var T1=I1,C1={updateSelfPeerRecord:T1};const ls=Object.assign(le("libp2p:transports"),{error:le("libp2p:transports:err")}),{codes:Us}=tr,{updateSelfPeerRecord:Ch}=C1;class Rh{constructor({libp2p:e,upgrader:t,faultTolerance:r=Wd.FATAL_ALL}){this.libp2p=e,this.upgrader=t,this._transports=new Map,this._listeners=new Map,this._listenerOptions=new Map,this.faultTolerance=r}add(e,t,r={}){if(ls("adding %s",e),!e)throw G(new Error(`Transport must have a valid key, was given '${e}'`),Us.ERR_INVALID_KEY);if(this._transports.has(e))throw G(new Error("There is already a transport with this key"),Us.ERR_DUPLICATE_TRANSPORT);const i=new t({...r,libp2p:this.libp2p,upgrader:this.upgrader});this._transports.set(e,i),this._listenerOptions.set(e,r.listenerOptions||{}),this._listeners.has(e)||this._listeners.set(e,[])}async close(){const e=[];for(const[t,r]of this._listeners)for(ls("closing listeners for %s",t);r.length;){const i=r.pop();i.removeAllListeners("listening"),i.removeAllListeners("close"),e.push(i.close())}await Promise.all(e),ls("all listeners closed");for(const t of this._listeners.keys())this._listeners.set(t,[])}async dial(e,t){const r=this.transportForMultiaddr(e);if(!r)throw G(new Error(`No transport available for address ${String(e)}`),Us.ERR_TRANSPORT_UNAVAILABLE);try{return await r.dial(e,t)}catch(i){throw i.code||(i.code=Us.ERR_TRANSPORT_DIAL_FAILED),i}}getAddrs(){let e=[];for(const t of this._listeners.values())for(const r of t)e=[...e,...r.getAddrs()];return e}getTransports(){return this._transports.values()}transportForMultiaddr(e){for(const t of this._transports.values()){const r=t.filter([e]);if(r.length)return t}return null}async listen(e){if(!e||e.length===0){ls("no addresses were provided for listening, this node is dial only");return}const t=[];for(const[r,i]of this._transports.entries()){const n=i.filter(e),s=[];for(const o of n){ls("creating listener for %s on %s",r,o);const d=i.createListener(this._listenerOptions.get(r));this._listeners.get(r).push(d),d.on("listening",()=>Ch(this.libp2p)),d.on("close",()=>Ch(this.libp2p)),s.push(d.listen(o))}if(s.length===0){t.push(r);continue}const a=await b1(s),c=a.find(o=>o.isFulfilled===!0);if(!c)throw G(new Error(`Transport (${r}) could not listen on any available address`),Us.ERR_NO_VALID_ADDRESSES)}if(t.length===this._transports.size){const r=`no valid addresses were provided for transports [${t}]`;if(this.faultTolerance===Wd.FATAL_ALL)throw G(new Error(r),Us.ERR_NO_VALID_ADDRESSES);ls(`libp2p in dial mode only: ${r}`)}}async remove(e){if(ls("removing %s",e),this._listeners.has(e))for(const t of this._listeners.get(e))t.removeAllListeners("listening"),t.removeAllListeners("close"),await t.close();this._transports.delete(e),this._listeners.delete(e)}async removeAll(){const e=[];for(const t of this._transports.keys())e.push(this.remove(t));await Promise.all(e)}}const Wd={FATAL_ALL:0,NO_FATAL:1};Rh.FaultTolerance=Wd;var Mh=Rh;const{dnsaddrResolver:R1}=Bv,{AGENT_VERSION:M1}=ph,{publicAddressesFirst:k1}=bh,{FaultTolerance:P1}=Mh,N1={addresses:{listen:[],announce:[],noAnnounce:[]},connectionManager:{minConnections:25},transportManager:{faultTolerance:P1.FATAL_ALL},dialer:{maxParallelDials:eo.MAX_PARALLEL_DIALS,maxDialsPerPeer:eo.MAX_PER_PEER_DIALS,dialTimeout:eo.DIAL_TIMEOUT,resolvers:{dnsaddr:R1},addressSorter:k1},host:{agentVersion:M1},metrics:{enabled:!1},peerStore:{persistence:!1,threshold:5},peerRouting:{refreshManager:{enabled:!0,interval:6e5,bootDelay:1e4}},config:{dht:{enabled:!1,kBucketSize:20,randomWalk:{enabled:!1,queriesPerPeriod:1,interval:3e5,timeout:1e4}},peerDiscovery:{autoDial:!0},pubsub:{enabled:!0},relay:{enabled:!0,advertise:{bootDelay:fc.ADVERTISE_BOOT_DELAY,enabled:!1,ttl:fc.ADVERTISE_TTL},hop:{enabled:!1,active:!1},autoRelay:{enabled:!1,maxListeners:2}},transport:{}}};var x1=e=>{if(e=rc(N1,e),e.modules.transport.length<1)throw new Error("'options.modules.transport' must contain at least 1 transport");return e},O1={validate:x1};class D1{constructor({listen:e=[],announce:t=[]}={}){this.listen=new Set(e),this.announce=new Set(t)}getListenAddrs(){return Array.from(this.listen).map(e=>kt(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>kt(e))}}var B1=D1;const{EventEmitter:L1}=_r,Yd=le("latency-monitor:VisibilityChangeEmitter");class j1 extends L1{constructor(){super();if(typeof document=="undefined"){Yd('This is not a browser, no "document" found. Stopping.');return}this._initializeVisibilityVarNames(),this._addVisibilityChangeListener()}_initializeVisibilityVarNames(){let e,t;typeof document.hidden!="undefined"?(e="hidden",t="visibilitychange"):typeof document.mozHidden!="undefined"?(e="mozHidden",t="mozvisibilitychange"):typeof document.msHidden!="undefined"?(e="msHidden",t="msvisibilitychange"):typeof document.webkitHidden!="undefined"&&(e="webkitHidden",t="webkitvisibilitychange"),this._hidden=e,this._visibilityChange=t}_addVisibilityChangeListener(){typeof document.addEventListener=="undefined"||typeof document[this._hidden]=="undefined"?Yd("Checking page visibility requires a browser that supports the Page Visibility API."):document.addEventListener(this._visibilityChange,this._handleVisibilityChange.bind(this),!1)}isVisible(){return this._hidden===void 0||document[this._hidden]===void 0?void 0:!document[this._hidden]}_handleVisibilityChange(){const e=!document[this._hidden];Yd(e?"Page Visible":"Page Hidden"),this.emit("visibilityChange",e)}}var F1=j1;const{EventEmitter:U1}=_r,nn=le("latency-monitor:LatencyMonitor");class q1 extends U1{constructor({latencyCheckIntervalMs:e,dataEmitIntervalMs:t,asyncTestFn:r,latencyRandomPercentage:i}={}){super();const n=this;n.latencyCheckIntervalMs=e||500,n.latencyRandomPercentage=i||10,n._latecyCheckMultiply=2*(n.latencyRandomPercentage/100)*n.latencyCheckIntervalMs,n._latecyCheckSubtract=n._latecyCheckMultiply/2,n.dataEmitIntervalMs=t===null||t===0?void 0:t||5*1e3,nn("latencyCheckIntervalMs: %s dataEmitIntervalMs: %s",n.latencyCheckIntervalMs,n.dataEmitIntervalMs),n.dataEmitIntervalMs?nn("Expecting ~%s events per summary",n.latencyCheckIntervalMs/n.dataEmitIntervalMs):nn("Not emitting summaries"),n.asyncTestFn=r,Pn.process&&Pn.process.hrtime?(nn("Using process.hrtime for timing"),n.now=Pn.process.hrtime,n.getDeltaMS=s=>{const a=n.now(s);return a[0]*1e3+a[1]/1e6}):typeof window!="undefined"&&window.performance&&window.performance.now?(nn("Using performance.now for timing"),n.now=window.performance.now.bind(window.performance),n.getDeltaMS=s=>Math.round(n.now()-s)):(nn("Using Date.now for timing"),n.now=Date.now,n.getDeltaMS=s=>n.now()-s),n._latencyData=n._initLatencyData(),z1()&&(n._visibilityChangeEmitter=new F1,n._visibilityChangeEmitter.on("visibilityChange",s=>{s?n._startTimers():(n._emitSummary(),n._stopTimers())})),(!n._visibilityChangeEmitter||n._visibilityChangeEmitter.isVisible())&&n._startTimers()}_startTimers(){if(this._checkLatencyID)return;this._checkLatency(),this.dataEmitIntervalMs&&(this._emitIntervalID=setInterval(()=>this._emitSummary(),this.dataEmitIntervalMs),typeof this._emitIntervalID.unref=="function"&&this._emitIntervalID.unref())}_stopTimers(){this._checkLatencyID&&(clearTimeout(this._checkLatencyID),this._checkLatencyID=void 0),this._emitIntervalID&&(clearInterval(this._emitIntervalID),this._emitIntervalID=void 0)}_emitSummary(){const e=this.getSummary();e.events>0&&this.emit("data",e)}getSummary(){const e={events:this._latencyData.events,minMs:this._latencyData.minMs,maxMs:this._latencyData.maxMs,avgMs:this._latencyData.events?this._latencyData.totalMs/this._latencyData.events:Number.POSITIVE_INFINITY,lengthMs:this.getDeltaMS(this._latencyData.startTime)};return this._latencyData=this._initLatencyData(),nn("Summary: %O",e),e}_checkLatency(){const e=this,t=Math.random()*e._latecyCheckMultiply-e._latecyCheckSubtract,r={deltaOffset:Math.ceil(e.latencyCheckIntervalMs+t),startTime:e.now()},i=()=>{if(!this._checkLatencyID)return;const n=e.getDeltaMS(r.startTime)-r.deltaOffset;e._checkLatency(),e._latencyData.events++,e._latencyData.minMs=Math.min(e._latencyData.minMs,n),e._latencyData.maxMs=Math.max(e._latencyData.maxMs,n),e._latencyData.totalMs+=n,nn("MS: %s Data: %O",n,e._latencyData)};nn("localData: %O",r),this._checkLatencyID=setTimeout(()=>{e.asyncTestFn?(r.deltaOffset=0,r.startTime=e.now(),e.asyncTestFn(i)):(r.deltaOffset-=1,i())},r.deltaOffset),typeof this._checkLatencyID.unref=="function"&&this._checkLatencyID.unref()}_initLatencyData(){return{startTime:this.now(),minMs:Number.POSITIVE_INFINITY,maxMs:Number.NEGATIVE_INFINITY,events:0,totalMs:0}}}function z1(){return typeof window!="undefined"}var $1=q1,Zd=function(){return Date.now()};function Jd(e,t,r){var i=this;this._started=Zd(),this._rescheduled=0,this._scheduled=t,this._args=r,this._timer=setTimeout(n,t);function n(){i._rescheduled>0?(i._scheduled=i._rescheduled-(Zd()-i._started),i._timer=setTimeout(n,i._scheduled),i._rescheduled=0):e.apply(null,i._args)}}Jd.prototype.reschedule=function(e){var t=Zd();return t+e-(this._started+this._scheduled)<0?!1:(this._started=t,this._rescheduled=e,!0)},Jd.prototype.clear=function(){clearTimeout(this._timer)};function H1(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("timeout needed");var e;if(arguments.length>0){e=new Array(arguments.length-2);for(var t=0;t<e.length;t++)e[t]=arguments[t+2]}return new Jd(arguments[0],arguments[1],e)}var us=H1;const hi=Object.assign(le("libp2p:connection-manager"),{error:le("libp2p:connection-manager:err")}),{EventEmitter:V1}=_r,{codes:{ERR_INVALID_PARAMETERS:kh}}=tr,G1={maxConnections:Infinity,minConnections:0,maxData:Infinity,maxSentData:Infinity,maxReceivedData:Infinity,maxEventLoopDelay:Infinity,pollInterval:2e3,autoDialInterval:1e4,movingAverageInterval:6e4,defaultPeerValue:1};class X1 extends V1{constructor(e,t={}){super();if(this._libp2p=e,this._peerId=e.peerId.toB58String(),this._options=rc.call({ignoreUndefined:!0},G1,t),this._options.maxConnections<this._options.minConnections)throw G(new Error("Connection Manager maxConnections must be greater than minConnections"),kh);hi("options: %j",this._options),this._peerValues=new Map,this.connections=new Map,this._started=!1,this._timer=null,this._autoDialTimeout=null,this._checkMetrics=this._checkMetrics.bind(this),this._autoDial=this._autoDial.bind(this)}get size(){return Array.from(this.connections.values()).reduce((e,t)=>e+t.length,0)}start(){this._libp2p.metrics&&(this._timer=this._timer||us(this._checkMetrics,this._options.pollInterval)),this._latencyMonitor=new $1({latencyCheckIntervalMs:this._options.pollInterval,dataEmitIntervalMs:this._options.pollInterval}),this._onLatencyMeasure=this._onLatencyMeasure.bind(this),this._latencyMonitor.on("data",this._onLatencyMeasure),this._started=!0,hi("started"),this._options.autoDial&&this._autoDial()}async stop(){this._autoDialTimeout&&this._autoDialTimeout.clear(),this._timer&&this._timer.clear(),this._latencyMonitor&&this._latencyMonitor.removeListener("data",this._onLatencyMeasure),this._started=!1,await this._close(),hi("stopped")}async _close(){const e=[];for(const t of this.connections.values())for(const r of t)e.push(r.close());await e,this.connections.clear()}setPeerValue(e,t){if(t<0||t>1)throw new Error("value should be a number between 0 and 1");this._peerValues.set(e.toB58String(),t)}_checkMetrics(){if(this._libp2p.metrics){const e=this._libp2p.metrics.global.movingAverages,t=e.dataReceived[this._options.movingAverageInterval].movingAverage();this._checkMaxLimit("maxReceivedData",t);const r=e.dataSent[this._options.movingAverageInterval].movingAverage();this._checkMaxLimit("maxSentData",r);const i=t+r;this._checkMaxLimit("maxData",i),hi("metrics update",i),this._timer=us(this._checkMetrics,this._options.pollInterval)}}onConnect(e){const t=e.remotePeer,r=t.toB58String(),i=this.connections.get(r);this.emit("peer:connect",e),i?i.push(e):this.connections.set(r,[e]),this._libp2p.peerStore.keyBook.set(t,t.pubKey),this._peerValues.has(r)||this._peerValues.set(r,this._options.defaultPeerValue),this._checkMaxLimit("maxConnections",this.size)}onDisconnect(e){const t=e.remotePeer.toB58String();let r=this.connections.get(t);r&&r.length>1?(r=r.filter(i=>i.id!==e.id),this.connections.set(t,r)):r&&(this.connections.delete(t),this._peerValues.delete(e.remotePeer.toB58String()),this.emit("peer:disconnect",e))}get(e){const t=this.getAll(e);return t.length?t[0]:null}getAll(e){if(!ke.isPeerId(e))throw G(new Error("peerId must be an instance of peer-id"),kh);const t=e.toB58String(),r=this.connections.get(t);return r?r.filter(i=>i.stat.status==="open"):[]}_onLatencyMeasure(e){this._checkMaxLimit("maxEventLoopDelay",e.avgMs)}_checkMaxLimit(e,t){const r=this._options[e];hi("checking limit of %s. current value: %d of %d",e,t,r),t>r&&(hi("%s: limit exceeded: %s, %d",this._peerId,e,t),this._maybeDisconnectOne())}async _autoDial(){const e=this._options.minConnections;if(this.size>=e){this._autoDialTimeout=us(this._autoDial,this._options.autoDialInterval);return}const t=Array.from(this._libp2p.peerStore.peers.values()).sort((r,i)=>i.protocols&&i.protocols.length&&(!r.protocols||!r.protocols.length)||i.id.pubKey&&!r.id.pubKey?1:-1);for(let r=0;r<t.length&&this.size<e;r++)if(!this.get(t[r].id)){hi("connecting to a peerStore stored peer %s",t[r].id.toB58String());try{if(await this._libp2p.dialer.connectToPeer(t[r].id),!this._started)return}catch(i){hi.error("could not connect to peerStore stored peer",i)}}this._autoDialTimeout=us(this._autoDial,this._options.autoDialInterval)}_maybeDisconnectOne(){if(this._options.minConnections<this.connections.size){const e=Array.from(this._peerValues).sort(W1);hi("%s: sorted peer values: %j",this._peerId,e);const t=e[0];if(t){const r=t[0];hi("%s: lowest value peer is %s",this._peerId,r),hi("%s: closing a connection to %j",this._peerId,r);for(const i of this.connections.values())if(i[0].remotePeer.toB58String()===r){i[0].close();break}}}}}var K1=X1;function W1(e,t){return e[1]-t[1]}const Ph=Re("dns4"),Nh=Re("dns6"),qs=ur(Re("dns"),Re("dnsaddr"),Ph,Nh),io=ur(Re("ip4"),Re("ip6")),zs=ur(je(io,Re("tcp")),je(qs,Re("tcp"))),xh=je(io,Re("udp")),Oh=je(xh,Re("utp")),$s=ur(je(zs,Re("ws")),je(qs,Re("ws"))),Hs=ur(je(zs,Re("wss")),je(qs,Re("wss"))),Qd=ur(je(zs,Re("http")),je(io,Re("http")),je(qs,Re("http"))),el=ur(je(zs,Re("https")),je(io,Re("https")),je(qs,Re("https"))),tl=ur(je($s,Re("p2p-webrtc-star"),Re("p2p")),je(Hs,Re("p2p-webrtc-star"),Re("p2p")),je($s,Re("p2p-webrtc-star")),je(Hs,Re("p2p-webrtc-star"))),Y1=ur(je($s,Re("p2p-websocket-star"),Re("p2p")),je(Hs,Re("p2p-websocket-star"),Re("p2p")),je($s,Re("p2p-websocket-star")),je(Hs,Re("p2p-websocket-star"))),Dh=ur(je(Qd,Re("p2p-webrtc-direct")),je(el,Re("p2p-webrtc-direct"))),Vs=ur($s,Hs,Qd,el,tl,Dh,zs,Oh),Z1=ur(je(Vs,Re("p2p-stardust"),Re("p2p")),je(Vs,Re("p2p-stardust"))),xn=ur(je(Vs,Re("p2p")),tl,Re("p2p")),Bh=ur(je(xn,Re("p2p-circuit"),xn),je(xn,Re("p2p-circuit")),je(Re("p2p-circuit"),xn),je(Vs,Re("p2p-circuit")),je(Re("p2p-circuit"),Vs),Re("p2p-circuit")),Lh=()=>ur(je(Bh,Lh),Bh),Gs=Lh(),jh=ur(je(Gs,xn,Gs),je(xn,Gs),je(Gs,xn),Gs,xn);var J1=qs,Q1=Ph,ew=Nh,tw=io,rw=zs,iw=xh,nw=Oh,sw=Qd,aw=el,ow=$s,cw=Hs,dw=Y1,lw=tl,uw=Dh,fw=Vs,hw=Z1,pw=Gs,mw=jh,gw=jh;function Fh(e){return function(r){if(!Er.isMultiaddr(r))try{r=Er(r)}catch(n){return!1}const i=e(r.protoNames());return i===null?!1:i.length===0}}function je(){const e=Array.from(arguments);function t(r){return r.length<e.length?null:(e.some(i=>{if(r=typeof i=="function"?i().partialMatch(r):i.partialMatch(r),r===null)return!0}),r)}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:Fh(t),partialMatch:t}}function ur(){const e=Array.from(arguments);function t(i){let n=null;return e.some(s=>{const a=typeof s=="function"?s().partialMatch(i):s.partialMatch(i);if(a)return n=a,!0}),n}const r={toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:Fh(t),partialMatch:t};return r}function Re(e){const t=e;function r(n){if(typeof n=="string")try{n=Er(n)}catch(a){return!1}const s=n.protoNames();return s.length===1&&s[0]===t}function i(n){return n.length===0?null:n[0]===t?n.slice(1):null}return{toString:function(){return t},matches:r,partialMatch:i}}var rl={DNS:J1,DNS4:Q1,DNS6:ew,IP:tw,TCP:rw,UDP:iw,UTP:nw,HTTP:sw,HTTPS:aw,WebSockets:ow,WebSocketsSecure:cw,WebSocketStar:dw,WebRTCStar:lw,WebRTCDirect:uw,Reliable:fw,Stardust:hw,Circuit:pw,P2P:mw,IPFS:gw},no=tn(`
message CircuitRelay {

  enum Status {
    SUCCESS                    = 100;
    HOP_SRC_ADDR_TOO_LONG      = 220;
    HOP_DST_ADDR_TOO_LONG      = 221;
    HOP_SRC_MULTIADDR_INVALID  = 250;
    HOP_DST_MULTIADDR_INVALID  = 251;
    HOP_NO_CONN_TO_DST         = 260;
    HOP_CANT_DIAL_DST          = 261;
    HOP_CANT_OPEN_DST_STREAM   = 262;
    HOP_CANT_SPEAK_RELAY       = 270;
    HOP_CANT_RELAY_TO_SELF     = 280;
    STOP_SRC_ADDR_TOO_LONG     = 320;
    STOP_DST_ADDR_TOO_LONG     = 321;
    STOP_SRC_MULTIADDR_INVALID = 350;
    STOP_DST_MULTIADDR_INVALID = 351;
    STOP_RELAY_REFUSED         = 390;
    MALFORMED_MESSAGE          = 400;
  }

  enum Type { // RPC identifier, either HOP, STOP or STATUS
    HOP = 1;
    STOP = 2;
    STATUS = 3;
    CAN_HOP = 4;
  }

  message Peer {
    required bytes id = 1;    // peer id
    repeated bytes addrs = 2; // peer's known addresses
  }

  optional Type type = 1;     // Type of the message

  optional Peer srcPeer = 2;  // srcPeer and dstPeer are used when Type is HOP or STATUS
  optional Peer dstPeer = 3;

  optional Status code = 4;   // Status code, used when Type is STATUS
}
`),il=function(t){if(t){if(typeof t[Symbol.iterator]=="function")return t[Symbol.iterator]();if(typeof t[Symbol.asyncIterator]=="function")return t[Symbol.asyncIterator]();if(typeof t.next=="function")return t}throw new Error("argument is not an iterator or iterable")},nl=class extends Error{constructor(t,r){super(t||"The operation was aborted");this.type="aborted",this.code=r||"ABORT_ERR"}};const Uh=(e,t,r)=>sl(e,Array.isArray(t)?t:[{signal:t,options:r}]),sl=(e,t)=>{e=il(e),t=t.map(({signal:i,options:n})=>({signal:i,options:n||{}}));async function*r(){let i;const n=()=>{i&&i()};for(const{signal:s}of t)s.addEventListener("abort",n);for(;;){let s;try{for(const{signal:c,options:o}of t)if(c.aborted){const{abortMessage:d,abortCode:l}=o;throw new nl(d,l)}const a=new Promise((c,o)=>{i=()=>{const{options:d}=t.find(({signal:p})=>p.aborted),{abortMessage:l,abortCode:u}=d;o(new nl(l,u))}});s=await Promise.race([a,e.next()]),i=null}catch(a){for(const{signal:d}of t)d.removeEventListener("abort",n);const c=t.find(({signal:d})=>d.aborted),o=a.type==="aborted"&&c;if(o&&c.options.onAbort&&await c.options.onAbort(e),typeof e.return=="function"&&await e.return(),o&&c.options.returnOnAbort)return;throw a}if(s.done)break;yield s.value}for(const{signal:s}of t)s.removeEventListener("abort",n)}return r()},qh=(e,t,r)=>zh(e,Array.isArray(t)?t:[{signal:t,options:r}]),zh=(e,t)=>r=>e(sl(r,t)),bw=(e,t,r)=>yw(e,Array.isArray(t)?t:[{signal:t,options:r}]),yw=(e,t)=>({sink:zh(e.sink,t),source:sl(e.source,t)});var zt=Uh,vw=nl,ww=Uh,Sw=qh,_w=qh,Ew=bw;zt.AbortError=vw,zt.source=ww,zt.sink=Sw,zt.transform=_w,zt.duplex=Ew;const Aw=le("libp2p:stream:converter");function Iw({stream:e,remoteAddr:t,localAddr:r},i={}){const{sink:n,source:s}=e,a={async sink(o){i.signal&&(o=zt(o,i.signal));try{await n(o)}catch(d){d.type!=="aborted"&&Aw(d)}c()},source:i.signal?zt(s,i.signal):s,conn:e,localAddr:r,remoteAddr:t,timeline:{open:Date.now()},close(){n([]),c()}};function c(){a.timeline.close||(a.timeline.close=Date.now())}return a}var $h=Iw,so={relay:"/libp2p/circuit/relay/0.1.0"};const{EventEmitter:Tw}=_r;var Cw=e=>{const t=new Map;async function r(s){const a=String(s).split("/p2p-circuit").find(d=>d!==""),c=await e.dial(kt(a)),o=c.remoteAddr.encapsulate("/p2p-circuit");t.set(c.remotePeer.toB58String(),o),n.emit("listening")}function i(){const s=[];for(const a of t.values())s.push(a);return s}const n=Object.assign(new Tw,{close:()=>Promise.resolve(),listen:r,getAddrs:i});return e.connectionManager.on("peer:disconnect",s=>{const a=t.delete(s.remotePeer.toB58String());a&&n.emit("close")}),n};const{CircuitRelay:fs}=no;function Hh(e,t){e.write({type:fs.Type.STATUS,code:t})}function Rw(e,t){try{e.dstPeer.addrs.forEach(r=>kt(r))}catch(r){throw Hh(t,e.type===fs.Type.HOP?fs.Status.HOP_DST_MULTIADDR_INVALID:fs.Status.STOP_DST_MULTIADDR_INVALID),r}try{e.srcPeer.addrs.forEach(r=>kt(r))}catch(r){throw Hh(t,e.type===fs.Type.HOP?fs.Status.HOP_SRC_MULTIADDR_INVALID:fs.Status.STOP_SRC_MULTIADDR_INVALID),r}}var Vh={validateAddrs:Rw},Gh=e=>{const t=async function*(){let r=yield,i=new Ar;for await(const n of e){if(!r){r=yield i.append(n),i=new Ar;continue}for(i.append(n);i.length>=r;){const s=i.shallowSlice(0,r);if(i.consume(r),r=yield s,!r){i.length&&(r=yield i,i=new Ar);break}}}if(r)throw Object.assign(new Error(`stream ended before ${r} bytes became available`),{code:"ERR_UNDER_READ",buffer:i})}();return t.next(),t},Xh=class{constructor(t){if(!(t>0)||(t-1&t)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];return t===void 0?void 0:(this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t)}isEmpty(){return this.buffer[this.btm]===void 0}},ao=class{constructor(t){this.hwm=t||16,this.head=new Xh(this.hwm),this.tail=this.head}push(t){if(!this.head.push(t)){const r=this.head;this.head=r.next=new Xh(2*this.head.buffer.length),this.head.push(t)}}shift(){const t=this.tail.shift();if(t===void 0&&this.tail.next){const r=this.tail.next;return this.tail.next=null,this.tail=r,this.tail.shift()}return t}isEmpty(){return this.head.isEmpty()}},mc=e=>{e=e||{};let t;typeof e=="function"?(t=e,e={}):t=e.onEnd;let r=new ao,i,n,s;const a=()=>{if(!r.isEmpty()){if(e.writev){let v;const S=[];for(;!r.isEmpty();){if(v=r.shift(),v.error)throw v.error;S.push(v.value)}return{done:v.done,value:S}}const g=r.shift();if(g.error)throw g.error;return g}return s?{done:!0}:new Promise((g,v)=>{n=S=>(n=null,S.error?v(S.error):e.writev&&!S.done?g({done:S.done,value:[S.value]}):g(S),i)})},c=g=>n?n(g):(r.push(g),i),o=g=>(r=new ao,n?n({error:g}):(r.push({error:g}),i)),d=g=>s?i:c({done:!1,value:g}),l=g=>s?i:(s=!0,g?o(g):c({done:!0})),u=()=>(r=new ao,l(),{done:!0}),p=g=>(l(g),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:a,return:u,throw:p,push:d,end:l},!t)return i;const f=i;return i={[Symbol.asyncIterator](){return this},next(){return f.next()},throw(g){return f.throw(g),t&&(t(g),t=null),{done:!0}},return(){return f.return(),t&&(t(),t=null),{done:!0}},push:d,end(g){return f.end(g),t&&(t(g),t=null),i}},i};const Mw=()=>{const e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e};var gc=Mw,oo=e=>{const t=mc(),r=Gh(e.source),i=gc();let n;const s=e.sink(async function*(){yield*t;const c=await i.promise;yield*c}());s.catch(c=>{n=c});const a={sink:c=>n?Promise.reject(n):(i.resolve(c),s),source:r};return{reader:r,writer:t,stream:a,rest:()=>t.end(),write:t.push,read:async()=>(await r.next()).value}};const bc=Object.assign(le("libp2p:circuit:stream-handler"),{error:le("libp2p:circuit:stream-handler:err")}),{CircuitRelay:Kh}=no;class kw{constructor({stream:e,maxLength:t=4096}){this.stream=e,this.shake=oo(this.stream),this.decoder=lr.decode.fromReader(this.shake.reader,{maxDataLength:t})}async read(){const e=await this.decoder.next();if(e.value){const t=Kh.decode(e.value.slice());return bc("read message type",t.type),t}bc("read received no value, closing stream"),this.close()}write(e){bc("write message type %s",e.type),this.shake.write(lr.encode.single(Kh.encode(e)))}rest(){return this.shake.rest(),this.shake.stream}end(e){this.write(e),this.close()}close(){bc("closing the stream"),this.rest().sink([])}}var yc=kw;const co=Object.assign(le("libp2p:circuit:stop"),{error:le("libp2p:circuit:stop:err")}),{CircuitRelay:al}=no,{validateAddrs:Pw}=Vh;var Nw=function({connection:t,request:r,streamHandler:i}){try{Pw(r,i)}catch(n){return co.error("invalid stop request via peer %s",t.remotePeer.toB58String(),n)}return co("stop request is valid"),i.write({type:al.Type.STATUS,code:al.Status.SUCCESS}),i.rest()},xw=async function({connection:t,request:r}){const{stream:i}=await t.newStream([so.relay]);co("starting stop request to %s",t.remotePeer.toB58String());const n=new yc({stream:i});n.write(r);const s=await n.read();if(s.code===al.Status.SUCCESS)return co("stop request to %s was successful",t.remotePeer.toB58String()),n.rest();co("stop request failed with code %d",s.code),n.close()},Wh={handleStop:Nw,stop:xw};const On=Object.assign(le("libp2p:circuit:hop"),{error:le("libp2p:circuit:hop:err")}),{validateAddrs:Ow}=Vh,{CircuitRelay:zr}=no,{pipe:Dw}=Yr,{codes:Bw}=tr,{stop:Lw}=Wh;async function jw({connection:e,request:t,streamHandler:r,circuit:i}){if(!i._options.hop.enabled)return On("HOP request received but we are not acting as a relay"),r.end({type:zr.Type.STATUS,code:zr.Status.HOP_CANT_SPEAK_RELAY});try{Ow(t,r)}catch(d){return On.error("invalid hop request via peer %s",e.remotePeer.toB58String(),d)}const n=new ke(t.dstPeer.id),s=i._connectionManager.get(n);if(!s&&!i._options.hop.active)return On("HOP request received but we are not connected to the destination peer"),r.end({type:zr.Type.STATUS,code:zr.Status.HOP_NO_CONN_TO_DST});if(!s)return;const a={type:zr.Type.STOP,dstPeer:t.dstPeer,srcPeer:t.srcPeer};let c;try{c=await Lw({connection:s,request:a})}catch(d){return On.error(d)}On("hop request from %s is valid",e.remotePeer.toB58String()),r.write({type:zr.Type.STATUS,code:zr.Status.SUCCESS});const o=r.rest();return Dw(o,c,o)}async function Fw({connection:e,request:t}){const{stream:r}=await e.newStream([so.relay]),i=new yc({stream:r});i.write(t);const n=await i.read();if(n.code===zr.Status.SUCCESS)return On("hop request was successful"),i.rest();throw On("hop request failed with code %d, closing stream",n.code),i.close(),G(new Error(`HOP request failed with code ${n.code}`),Bw.ERR_HOP_REQUEST_FAILED)}async function Uw({connection:e}){const{stream:t}=await e.newStream([so.relay]),r=new yc({stream:t});r.write({type:zr.Type.CAN_HOP});const i=await r.read();return await r.close(),!(i.code!==zr.Status.SUCCESS)}function qw({connection:e,streamHandler:t,circuit:r}){const i=r._options.hop.enabled;On("can hop (%s) request from %s",i,e.remotePeer.toB58String()),t.end({type:zr.Type.STATUS,code:i?zr.Status.SUCCESS:zr.Status.HOP_CANT_SPEAK_RELAY})}var Yh={handleHop:jw,hop:Fw,canHop:Uw,handleCanHop:qw};const Dn=Object.assign(le("libp2p:circuit"),{error:le("libp2p:circuit:err")}),{CircuitRelay:lo}=no,{relay:zw}=so,{handleCanHop:$w,handleHop:Hw,hop:Vw}=Yh,{handleStop:Gw}=Wh,Xw=Symbol.for("@libp2p/js-libp2p-circuit/circuit");class Kw{constructor({libp2p:e,upgrader:t}){this._dialer=e.dialer,this._registrar=e.registrar,this._connectionManager=e.connectionManager,this._upgrader=t,this._options=e._config.relay,this._libp2p=e,this.peerId=e.peerId,this._registrar.handle(zw,this._onProtocol.bind(this))}async _onProtocol({connection:e,stream:t}){const r=new yc({stream:t}),i=await r.read();if(!i)return;const n=this;let s;switch(i.type){case lo.Type.CAN_HOP:{Dn("received CAN_HOP request from %s",e.remotePeer.toB58String()),await $w({circuit:n,connection:e,streamHandler:r});break}case lo.Type.HOP:{Dn("received HOP request from %s",e.remotePeer.toB58String()),s=await Hw({connection:e,request:i,streamHandler:r,circuit:n});break}case lo.Type.STOP:{Dn("received STOP request from %s",e.remotePeer.toB58String()),s=await Gw({connection:e,request:i,streamHandler:r});break}default:Dn("Request of type %s not supported",i.type)}if(s){const a=kt(i.dstPeer.addrs[0]),c=kt(i.srcPeer.addrs[0]),o=$h({stream:s,remoteAddr:a,localAddr:c}),d=i.type===lo.Type.HOP?"relay":"inbound";Dn("new %s connection %s",d,o.remoteAddr);const l=await this._upgrader.upgradeInbound(o);Dn("%s connection %s upgraded",d,o.remoteAddr),this.handler&&this.handler(l)}}async dial(e,t){const r=e.toString().split("/p2p-circuit"),i=kt(r[0]),n=kt(r[r.length-1]),s=ke.createFromCID(i.getPeerId()),a=ke.createFromCID(n.getPeerId());let c=!1,o=this._connectionManager.get(s);o||(o=await this._dialer.connectToPeer(i,t),c=!0);try{const d=await Vw({connection:o,request:{type:lo.Type.HOP,srcPeer:{id:this.peerId.toBytes(),addrs:this._libp2p.multiaddrs.map(p=>p.bytes)},dstPeer:{id:a.toBytes(),addrs:[kt(n).bytes]}}}),l=i.encapsulate(`/p2p-circuit/p2p/${this.peerId.toB58String()}`),u=$h({stream:d,remoteAddr:e,localAddr:l});return Dn("new outbound connection %s",u.remoteAddr),this._upgrader.upgradeOutbound(u)}catch(d){throw Dn.error("Circuit relay dial failed",d),c&&await o.close(),d}}createListener(e,t){return typeof e=="function"&&(t=e,e={}),this.handler=t,Cw(this._libp2p)}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>rl.Circuit.matches(t))}get[Symbol.toStringTag](){return"Circuit"}static isTransport(e){return Boolean(e&&e[Xw])}}var Zh=Kw,Ww=Pn.TextEncoder,Yw=async e=>{const t=new Ww("utf8").encode(e),r=await hy(t,"sha2-256");return new en(r)},Jh={namespaceToCid:Yw};const vc=Object.assign(le("libp2p:auto-relay"),{error:le("libp2p:auto-relay:err")}),{relay:Zw}=so,{canHop:Jw}=Yh,{namespaceToCid:Qw}=Jh,{CIRCUIT_PROTO_CODE:e2,HOP_METADATA_KEY:Qh,HOP_METADATA_VALUE:ep,RELAY_RENDEZVOUS_NS:t2}=fc;class r2{constructor({libp2p:e,maxListeners:t=1}){this._libp2p=e,this._peerId=e.peerId,this._peerStore=e.peerStore,this._connectionManager=e.connectionManager,this._transportManager=e.transportManager,this._addressSorter=e.dialer.addressSorter,this.maxListeners=t,this._listenRelays=new Set,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this),this._peerStore.on("change:protocols",this._onProtocolChange),this._connectionManager.on("peer:disconnect",this._onPeerDisconnected)}async _onProtocolChange({peerId:e,protocols:t}){const r=e.toB58String(),i=t.find(n=>n===Zw);if(!i&&this._listenRelays.has(r)){this._removeListenRelay(r);return}else if(!i||this._listenRelays.has(r))return;try{const n=this._connectionManager.get(e);if(!n)return;if(n.remoteAddr.protoCodes().includes(e2)){vc(`relayed connection to ${r} will not be used to hop on`);return}const s=await Jw({connection:n});s&&(this._peerStore.metadataBook.set(e,Qh,St(ep)),await this._addListenRelay(n,r))}catch(n){vc.error(n)}}_onPeerDisconnected(e){const t=e.remotePeer,r=t.toB58String();if(!this._listenRelays.has(r))return;this._removeListenRelay(r)}async _addListenRelay(e,t){if(this._listenRelays.size>=this.maxListeners)return;const r=this._peerStore.addressBook.getMultiaddrsForPeer(e.remotePeer,this._addressSorter);if(!r||!r.length)return;const i=`${r[0].toString()}/p2p-circuit`;this._listenRelays.add(t);try{await this._transportManager.listen([kt(i)])}catch(n){vc.error(n),this._listenRelays.delete(t)}}_removeListenRelay(e){this._listenRelays.delete(e)&&this._listenOnAvailableHopRelays([e])}async _listenOnAvailableHopRelays(e=[]){if(this._listenRelays.size>=this.maxListeners)return;const t=[];for(const[r,i]of this._peerStore.metadataBook.data.entries()){if(this._listenRelays.has(r)||e.includes(r))continue;const n=i.get(Qh);if(!n||Ae(n)!==ep)continue;const s=ke.createFromCID(r),a=this._connectionManager.get(s);if(!a){t.push(s);continue}if(await this._addListenRelay(a,r),this._listenRelays.size>=this.maxListeners)return}for(const r of t){const i=await this._libp2p.dial(r);if(await this._addListenRelay(i,r.toB58String()),this._listenRelays.size>=this.maxListeners)return}try{const r=await Qw(t2);for await(const i of this._libp2p.contentRouting.findProviders(r)){if(!i.multiaddrs.length)continue;const n=i.id;this._peerStore.addressBook.add(n,i.multiaddrs);const s=await this._libp2p.dial(n);if(await this._addListenRelay(s,n.toB58String()),this._listenRelays.size>=this.maxListeners)return}}catch(r){vc.error(r)}}}var i2=r2;const tp=Object.assign(le("libp2p:relay"),{error:le("libp2p:relay:err")}),{setDelayedInterval:n2,clearDelayedInterval:s2}=Ff,{namespaceToCid:a2}=Jh,{ADVERTISE_BOOT_DELAY:o2,ADVERTISE_TTL:c2,RELAY_RENDEZVOUS_NS:d2}=fc;class l2{constructor(e){this._libp2p=e,this._options={advertise:{bootDelay:o2,enabled:!0,ttl:c2,...e._config.relay.advertise},...e._config.relay},this._autoRelay=this._options.autoRelay.enabled&&new i2({libp2p:e,...this._options.autoRelay}),this._advertiseService=this._advertiseService.bind(this)}start(){const e=this._options.hop.enabled;e&&this._options.advertise.enabled&&(this._timeout=n2(this._advertiseService,this._options.advertise.ttl,this._options.advertise.bootDelay))}stop(){s2(this._timeout)}async _advertiseService(){try{const e=await a2(d2);await this._libp2p.contentRouting.provide(e)}catch(e){e.code==="NO_ROUTERS_AVAILABLE"?(tp.error("a content router, such as a DHT, must be provided in order to advertise the relay service",e),this.stop()):tp.error(e)}}}var u2=l2;const{AbortController:f2}=typeof self!="undefined"?self:typeof window!="undefined"?window:Ya;class ol extends f2{constructor(e){super();this._ms=e,this._timer=us(()=>this.abort(),e),Object.setPrototypeOf(this,ol.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=us(()=>this.abort(),this._ms)}}var rp=ol,h2=ol;rp.TimeoutController=h2;var p2=AbortController;function ip(e){const t=new p2;function r(){t.abort();for(const i of e){if(!i||!i.removeEventListener)continue;i.removeEventListener("abort",r)}}for(const i of e){if(!i||!i.addEventListener)continue;if(i.aborted){r();break}i.addEventListener("abort",r)}return t.signal}var cl=ip,m2=ip;cl.anySignal=m2;var g2=class{constructor(){this._buffer=new ao,this._waitingConsumers=new ao}push(t){const{promise:r,resolve:i}=gc();return this._buffer.push({chunk:t,resolve:i}),this._consume(),r}_consume(){for(;!this._waitingConsumers.isEmpty()&&!this._buffer.isEmpty();){const t=this._waitingConsumers.shift(),r=this._buffer.shift();t.resolve(r.chunk),r.resolve()}}shift(){const{promise:t,resolve:r}=gc();return this._waitingConsumers.push({resolve:r}),this._consume(),t}isEmpty(){return this._buffer.isEmpty()}};const b2=Ya.default;class y2{constructor({addrs:e,dialAction:t,dialer:r}){this.addrs=e,this.dialer=r,this.dialAction=t}async run(e={}){const t=this.dialer.getTokens(this.addrs.length);if(t.length<1)throw G(new Error("No dial tokens available"),"ERR_NO_DIAL_TOKENS");const r=new g2;t.forEach(s=>r.push(s));const i=this.addrs.map(()=>new b2);let n=0;try{return await Za(this.addrs.map(async(s,a)=>{const c=await r.shift();let o;try{const d=i[a].signal;o=await this.dialAction(s,{...e,signal:cl([d,e.signal])}),i.splice(a,1)}finally{n++,this.addrs.length-n>=t.length?r.push(c):this.dialer.releaseToken(t.splice(t.indexOf(c),1)[0])}return o}))}finally{i.map(s=>s.abort()),t.forEach(s=>this.dialer.releaseToken(s))}}}var v2=y2;const Xs=Object.assign(le("libp2p:dialer"),{error:le("libp2p:dialer:err")}),{publicAddressesFirst:w2}=bh,{codes:dl}=tr,{DIAL_TIMEOUT:S2,MAX_PARALLEL_DIALS:_2,MAX_PER_PEER_DIALS:E2}=eo;class A2{constructor({transportManager:e,peerStore:t,addressSorter:r=w2,concurrency:i=_2,timeout:n=S2,perPeerLimit:s=E2,resolvers:a={}}){this.transportManager=e,this.peerStore=t,this.addressSorter=r,this.concurrency=i,this.timeout=n,this.perPeerLimit=s,this.tokens=[...new Array(i)].map((c,o)=>o),this._pendingDials=new Map;for(const[c,o]of Object.entries(a))kt.resolvers.set(c,o)}destroy(){for(const e of this._pendingDials.values())try{e.controller.abort()}catch(t){Xs.error(t)}this._pendingDials.clear()}async connectToPeer(e,t={}){const r=await this._createDialTarget(e);if(!r.addrs.length)throw G(new Error("The dial request has no addresses"),dl.ERR_NO_VALID_ADDRESSES);const i=this._pendingDials.get(r.id)||this._createPendingDial(r,t);try{const n=await i.promise;return Xs("dial succeeded to %s",r.id),n}catch(n){throw i.controller.signal.aborted&&(n.code=dl.ERR_TIMEOUT),Xs.error(n),n}finally{i.destroy()}}async _createDialTarget(e){const{id:t,multiaddrs:r}=ac(e);r&&this.peerStore.addressBook.add(t,r);let i=this.peerStore.addressBook.getMultiaddrsForPeer(t,this.addressSorter)||[];kt.isMultiaddr(e)&&(i=i.filter(s=>!e.equals(s)),i.unshift(e));const n=[];for(const s of i){const a=await this._resolve(s);a.forEach(c=>n.push(c))}return{id:t.toB58String(),addrs:n}}_createPendingDial(e,t={}){const r=(o,d)=>{if(d.signal.aborted)throw G(new Error("already aborted"),dl.ERR_ALREADY_ABORTED);return this.transportManager.dial(o,d)},i=new v2({addrs:e.addrs,dialAction:r,dialer:this}),n=new rp(this.timeout),s=[n.signal];t.signal&&s.push(t.signal);const a=cl(s),c={dialRequest:i,controller:n,promise:i.run({...t,signal:a}),destroy:()=>{n.clear(),this._pendingDials.delete(e.id)}};return this._pendingDials.set(e.id,c),c}getTokens(e){const t=Math.min(e,this.perPeerLimit,this.tokens.length),r=this.tokens.splice(0,t);return Xs("%d tokens request, returning %d, %d remaining",e,t,this.tokens.length),r}releaseToken(e){if(this.tokens.indexOf(e)>-1)return;Xs("token %d released",e),this.tokens.push(e)}async _resolve(e){const t=e.protoNames().includes("dnsaddr");if(!t)return[e];const r=await this._resolveRecord(e),i=await Promise.all(r.map(s=>this._resolve(s))),n=i.flat();return n.reduce((s,a)=>(s.find(c=>c.equals(a))||s.push(a),s),[])}async _resolveRecord(e){try{e=kt(e.toString());const t=await e.resolve();return t}catch(t){return Xs.error(`multiaddr ${e} could not be resolved`),[]}}}var I2=A2;function T2(e){return e>=55296&&e<=56319}function C2(e){return e>=56320&&e<=57343}var R2=function(t,r,i){if(typeof r!="string")throw new Error("Input must be string");for(var n=r.length,s=0,a,c,o=0;o<n;o+=1){if(a=r.charCodeAt(o),c=r[o],T2(a)&&C2(r.charCodeAt(o+1))&&(o+=1,c+=r[o]),s+=t(c),s===i)return r.slice(0,o+1);if(s>i)return r.slice(0,o-c.length+1)}return r};function M2(e){return e>=55296&&e<=56319}function k2(e){return e>=56320&&e<=57343}var P2=function(t){if(typeof t!="string")throw new Error("Input must be string");for(var r=t.length,i=0,n=null,s=null,a=0;a<r;a++)n=t.charCodeAt(a),k2(n)?s!=null&&M2(s)?i+=1:i+=3:n<=127?i+=1:n>=128&&n<=2047?i+=2:n>=2048&&n<=65535&&(i+=3),s=n;return i},N2=R2.bind(null,P2),x2=/[\/\?<>\\:\*\|"]/g,O2=/[\x00-\x1f\x80-\x9f]/g,D2=/^\.+$/,B2=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,L2=/[\. ]+$/;function np(e,t){if(typeof e!="string")throw new Error("Input must be string");var r=e.replace(x2,t).replace(O2,t).replace(D2,t).replace(B2,t).replace(L2,t);return N2(r,255)}var j2=function(e,t){var r=t&&t.replacement||"",i=np(e,r);return r===""?i:np(i,"")},oP=ne(function(e){var t=V.asn1,r=e.exports=V.pkcs7asn1=V.pkcs7asn1||{};V.pkcs7=V.pkcs7||{},V.pkcs7.asn1=r;var i={name:"ContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};r.contentInfoValidator=i;var n={name:"EncryptedContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};r.envelopedDataValidator={name:"EnvelopedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(n)},r.encryptedDataValidator={name:"EncryptedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"}].concat(n)};var s={name:"SignerInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};r.signedDataValidator={name:"SignedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},i,{name:"SignedData.Certificates",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,capture:"signerInfos",optional:!0,value:[s]}]},r.recipientInfoValidator={name:"RecipientInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter"}]},{name:"RecipientInfo.encryptedKey",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}}),cP=ne(function(e){V.mgf=V.mgf||{};var t=e.exports=V.mgf.mgf1=V.mgf1=V.mgf1||{};t.create=function(r){var i={generate:function(n,s){for(var a=new V.util.ByteBuffer,c=Math.ceil(s/r.digestLength),o=0;o<c;o++){var d=new V.util.ByteBuffer;d.putInt32(o),r.start(),r.update(n+d.getBytes()),a.putBuffer(r.digest())}return a.truncate(a.length()-s),a.getBytes()}};return i}}),dP=V.mgf=V.mgf||{};V.mgf.mgf1=V.mgf1;var lP=ne(function(e){var t=e.exports=V.pss=V.pss||{};t.create=function(r){arguments.length===3&&(r={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var i=r.md,n=r.mgf,s=i.digestLength,a=r.salt||null;typeof a=="string"&&(a=V.util.createBuffer(a));var c;if("saltLength"in r)c=r.saltLength;else if(a!==null)c=a.length();else throw new Error("Salt length not specified or specific salt not given.");if(a!==null&&a.length()!==c)throw new Error("Given salt length does not match length of given salt.");var o=r.prng||V.random,d={};return d.encode=function(l,u){var p,f=u-1,g=Math.ceil(f/8),v=l.digest().getBytes();if(g<s+c+2)throw new Error("Message is too long to encrypt.");var S;a===null?S=o.getBytesSync(c):S=a.bytes();var C=new V.util.ByteBuffer;C.fillWithByte(0,8),C.putBytes(v),C.putBytes(S),i.start(),i.update(C.getBytes());var D=i.digest().getBytes(),j=new V.util.ByteBuffer;j.fillWithByte(0,g-c-s-2),j.putByte(1),j.putBytes(S);var m=j.getBytes(),w=g-s-1,R=n.generate(D,w),h="";for(p=0;p<w;p++)h+=String.fromCharCode(m.charCodeAt(p)^R.charCodeAt(p));var b=65280>>8*g-f&255;return h=String.fromCharCode(h.charCodeAt(0)&~b)+h.substr(1),h+D+String.fromCharCode(188)},d.verify=function(l,u,p){var f,g=p-1,v=Math.ceil(g/8);if(u=u.substr(-v),v<s+c+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(u.charCodeAt(v-1)!==188)throw new Error("Encoded message does not end in 0xBC.");var S=v-s-1,C=u.substr(0,S),D=u.substr(S,s),j=65280>>8*v-g&255;if((C.charCodeAt(0)&j)!==0)throw new Error("Bits beyond keysize not zero as expected.");var m=n.generate(D,S),w="";for(f=0;f<S;f++)w+=String.fromCharCode(C.charCodeAt(f)^m.charCodeAt(f));w=String.fromCharCode(w.charCodeAt(0)&~j)+w.substr(1);var R=v-s-c-2;for(f=0;f<R;f++)if(w.charCodeAt(f)!==0)throw new Error("Leftmost octets not zero as expected");if(w.charCodeAt(R)!==1)throw new Error("Inconsistent PSS signature, 0x01 marker not found");var h=w.substr(-c),b=new V.util.ByteBuffer;b.fillWithByte(0,8),b.putBytes(l),b.putBytes(h),i.start(),i.update(b.getBytes());var A=i.digest().getBytes();return D===A},d}}),uP=ne(function(e){var t=V.asn1,r=e.exports=V.pki=V.pki||{},i=r.oids,n={};n.CN=i.commonName,n.commonName="CN",n.C=i.countryName,n.countryName="C",n.L=i.localityName,n.localityName="L",n.ST=i.stateOrProvinceName,n.stateOrProvinceName="ST",n.O=i.organizationName,n.organizationName="O",n.OU=i.organizationalUnitName,n.organizationalUnitName="OU",n.E=i.emailAddress,n.emailAddress="E";var s=V.pki.rsa.publicKeyValidator,a={name:"Certificate",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:t.Class.UNIVERSAL,type:t.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:t.Class.UNIVERSAL,type:t.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:t.Class.UNIVERSAL,type:t.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:t.Class.UNIVERSAL,type:t.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},s,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:t.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:t.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},c={name:"rsapss",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:t.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:t.Class.UNIVERSAL,type:t.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:t.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:t.Class.UNIVERSAL,type:t.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},o={name:"CertificationRequestInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},s,{name:"CertificationRequestInfo.attributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0}]}]}]},d={name:"CertificationRequest",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[o,{name:"CertificationRequest.signatureAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};r.RDNAttributesAsArray=function(m,w){for(var R=[],h,b,A,y=0;y<m.value.length;++y){h=m.value[y];for(var P=0;P<h.value.length;++P)A={},b=h.value[P],A.type=t.derToOid(b.value[0].value),A.value=b.value[1].value,A.valueTagClass=b.value[1].type,A.type in i&&(A.name=i[A.type],A.name in n&&(A.shortName=n[A.name])),w&&(w.update(A.type),w.update(A.value)),R.push(A)}return R},r.CRIAttributesAsArray=function(m){for(var w=[],R=0;R<m.length;++R)for(var h=m[R],b=t.derToOid(h.value[0].value),A=h.value[1].value,y=0;y<A.length;++y){var P={};if(P.type=b,P.value=A[y].value,P.valueTagClass=A[y].type,P.type in i&&(P.name=i[P.type],P.name in n&&(P.shortName=n[P.name])),P.type===i.extensionRequest){P.extensions=[];for(var N=0;N<P.value.length;++N)P.extensions.push(r.certificateExtensionFromAsn1(P.value[N]))}w.push(P)}return w};function l(m,w){typeof w=="string"&&(w={shortName:w});for(var R=null,h,b=0;R===null&&b<m.attributes.length;++b)h=m.attributes[b],(w.type&&w.type===h.type||(w.name&&w.name===h.name||w.shortName&&w.shortName===h.shortName))&&(R=h);return R}var u=function(m,w,R){var h={};if(m!==i["RSASSA-PSS"])return h;R&&(h={hash:{algorithmOid:i.sha1},mgf:{algorithmOid:i.mgf1,hash:{algorithmOid:i.sha1}},saltLength:20});var b={},A=[];if(!t.validate(w,c,b,A)){var y=new Error("Cannot read RSASSA-PSS parameter block.");throw y.errors=A,y}return b.hashOid!==void 0&&(h.hash=h.hash||{},h.hash.algorithmOid=t.derToOid(b.hashOid)),b.maskGenOid!==void 0&&(h.mgf=h.mgf||{},h.mgf.algorithmOid=t.derToOid(b.maskGenOid),h.mgf.hash=h.mgf.hash||{},h.mgf.hash.algorithmOid=t.derToOid(b.maskGenHashOid)),b.saltLength!==void 0&&(h.saltLength=b.saltLength.charCodeAt(0)),h};r.certificateFromPem=function(m,w,R){var h=V.pem.decode(m)[0];if(h.type!=="CERTIFICATE"&&h.type!=="X509 CERTIFICATE"&&h.type!=="TRUSTED CERTIFICATE"){var b=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw b.headerType=h.type,b}if(h.procType&&h.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var A=t.fromDer(h.body,R);return r.certificateFromAsn1(A,w)},r.certificateToPem=function(m,w){var R={type:"CERTIFICATE",body:t.toDer(r.certificateToAsn1(m)).getBytes()};return V.pem.encode(R,{maxline:w})},r.publicKeyFromPem=function(m){var w=V.pem.decode(m)[0];if(w.type!=="PUBLIC KEY"&&w.type!=="RSA PUBLIC KEY"){var R=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw R.headerType=w.type,R}if(w.procType&&w.procType.type==="ENCRYPTED")throw new Error("Could not convert public key from PEM; PEM is encrypted.");var h=t.fromDer(w.body);return r.publicKeyFromAsn1(h)},r.publicKeyToPem=function(m,w){var R={type:"PUBLIC KEY",body:t.toDer(r.publicKeyToAsn1(m)).getBytes()};return V.pem.encode(R,{maxline:w})},r.publicKeyToRSAPublicKeyPem=function(m,w){var R={type:"RSA PUBLIC KEY",body:t.toDer(r.publicKeyToRSAPublicKey(m)).getBytes()};return V.pem.encode(R,{maxline:w})},r.getPublicKeyFingerprint=function(m,w){w=w||{};var R=w.md||V.md.sha1.create(),h=w.type||"RSAPublicKey",b;switch(h){case"RSAPublicKey":b=t.toDer(r.publicKeyToRSAPublicKey(m)).getBytes();break;case"SubjectPublicKeyInfo":b=t.toDer(r.publicKeyToAsn1(m)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+w.type+'".')}R.start(),R.update(b);var A=R.digest();if(w.encoding==="hex"){var y=A.toHex();return w.delimiter?y.match(/.{2}/g).join(w.delimiter):y}else{if(w.encoding==="binary")return A.getBytes();if(w.encoding)throw new Error('Unknown encoding "'+w.encoding+'".')}return A},r.certificationRequestFromPem=function(m,w,R){var h=V.pem.decode(m)[0];if(h.type!=="CERTIFICATE REQUEST"){var b=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw b.headerType=h.type,b}if(h.procType&&h.procType.type==="ENCRYPTED")throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var A=t.fromDer(h.body,R);return r.certificationRequestFromAsn1(A,w)},r.certificationRequestToPem=function(m,w){var R={type:"CERTIFICATE REQUEST",body:t.toDer(r.certificationRequestToAsn1(m)).getBytes()};return V.pem.encode(R,{maxline:w})},r.createCertificate=function(){var m={};return m.version=2,m.serialNumber="00",m.signatureOid=null,m.signature=null,m.siginfo={},m.siginfo.algorithmOid=null,m.validity={},m.validity.notBefore=new Date,m.validity.notAfter=new Date,m.issuer={},m.issuer.getField=function(w){return l(m.issuer,w)},m.issuer.addField=function(w){f([w]),m.issuer.attributes.push(w)},m.issuer.attributes=[],m.issuer.hash=null,m.subject={},m.subject.getField=function(w){return l(m.subject,w)},m.subject.addField=function(w){f([w]),m.subject.attributes.push(w)},m.subject.attributes=[],m.subject.hash=null,m.extensions=[],m.publicKey=null,m.md=null,m.setSubject=function(w,R){f(w),m.subject.attributes=w,delete m.subject.uniqueId,R&&(m.subject.uniqueId=R),m.subject.hash=null},m.setIssuer=function(w,R){f(w),m.issuer.attributes=w,delete m.issuer.uniqueId,R&&(m.issuer.uniqueId=R),m.issuer.hash=null},m.setExtensions=function(w){for(var R=0;R<w.length;++R)g(w[R],{cert:m});m.extensions=w},m.getExtension=function(w){typeof w=="string"&&(w={name:w});for(var R=null,h,b=0;R===null&&b<m.extensions.length;++b)h=m.extensions[b],(w.id&&h.id===w.id||w.name&&h.name===w.name)&&(R=h);return R},m.sign=function(w,R){m.md=R||V.md.sha1.create();var h=i[m.md.algorithm+"WithRSAEncryption"];if(!h){var b=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw b.algorithm=m.md.algorithm,b}m.signatureOid=m.siginfo.algorithmOid=h,m.tbsCertificate=r.getTBSCertificate(m);var A=t.toDer(m.tbsCertificate);m.md.update(A.getBytes()),m.signature=w.sign(m.md)},m.verify=function(w){var R=!1;if(!m.issued(w)){var h=w.issuer,b=m.subject,A=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw A.expectedIssuer=h.attributes,A.actualIssuer=b.attributes,A}var y=w.md;if(y===null){if(w.signatureOid in i){var P=i[w.signatureOid];switch(P){case"sha1WithRSAEncryption":y=V.md.sha1.create();break;case"md5WithRSAEncryption":y=V.md.md5.create();break;case"sha256WithRSAEncryption":y=V.md.sha256.create();break;case"sha384WithRSAEncryption":y=V.md.sha384.create();break;case"sha512WithRSAEncryption":y=V.md.sha512.create();break;case"RSASSA-PSS":y=V.md.sha256.create();break}}if(y===null){var A=new Error("Could not compute certificate digest. Unknown signature OID.");throw A.signatureOid=w.signatureOid,A}var N=w.tbsCertificate||r.getTBSCertificate(w),B=t.toDer(N);y.update(B.getBytes())}if(y!==null){var L;switch(w.signatureOid){case i.sha1WithRSAEncryption:L=void 0;break;case i["RSASSA-PSS"]:var F,z;if(F=i[w.signatureParameters.mgf.hash.algorithmOid],F===void 0||V.md[F]===void 0){var A=new Error("Unsupported MGF hash function.");throw A.oid=w.signatureParameters.mgf.hash.algorithmOid,A.name=F,A}if(z=i[w.signatureParameters.mgf.algorithmOid],z===void 0||V.mgf[z]===void 0){var A=new Error("Unsupported MGF function.");throw A.oid=w.signatureParameters.mgf.algorithmOid,A.name=z,A}if(z=V.mgf[z].create(V.md[F].create()),F=i[w.signatureParameters.hash.algorithmOid],F===void 0||V.md[F]===void 0)throw{message:"Unsupported RSASSA-PSS hash function.",oid:w.signatureParameters.hash.algorithmOid,name:F};L=V.pss.create(V.md[F].create(),z,w.signatureParameters.saltLength);break}R=m.publicKey.verify(y.digest().getBytes(),w.signature,L)}return R},m.isIssuer=function(w){var R=!1,h=m.issuer,b=w.subject;if(h.hash&&b.hash)R=h.hash===b.hash;else if(h.attributes.length===b.attributes.length){R=!0;for(var A,y,P=0;R&&P<h.attributes.length;++P)A=h.attributes[P],y=b.attributes[P],(A.type!==y.type||A.value!==y.value)&&(R=!1)}return R},m.issued=function(w){return w.isIssuer(m)},m.generateSubjectKeyIdentifier=function(){return r.getPublicKeyFingerprint(m.publicKey,{type:"RSAPublicKey"})},m.verifySubjectKeyIdentifier=function(){for(var w=i.subjectKeyIdentifier,R=0;R<m.extensions.length;++R){var h=m.extensions[R];if(h.id===w){var b=m.generateSubjectKeyIdentifier().getBytes();return V.util.hexToBytes(h.subjectKeyIdentifier)===b}}return!1},m},r.certificateFromAsn1=function(m,w){var R={},h=[];if(!t.validate(m,a,R,h)){var b=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw b.errors=h,b}var A=t.derToOid(R.publicKeyOid);if(A!==r.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var y=r.createCertificate();y.version=R.certVersion?R.certVersion.charCodeAt(0):0;var P=V.util.createBuffer(R.certSerialNumber);y.serialNumber=P.toHex(),y.signatureOid=V.asn1.derToOid(R.certSignatureOid),y.signatureParameters=u(y.signatureOid,R.certSignatureParams,!0),y.siginfo.algorithmOid=V.asn1.derToOid(R.certinfoSignatureOid),y.siginfo.parameters=u(y.siginfo.algorithmOid,R.certinfoSignatureParams,!1),y.signature=R.certSignature;var N=[];if(R.certValidity1UTCTime!==void 0&&N.push(t.utcTimeToDate(R.certValidity1UTCTime)),R.certValidity2GeneralizedTime!==void 0&&N.push(t.generalizedTimeToDate(R.certValidity2GeneralizedTime)),R.certValidity3UTCTime!==void 0&&N.push(t.utcTimeToDate(R.certValidity3UTCTime)),R.certValidity4GeneralizedTime!==void 0&&N.push(t.generalizedTimeToDate(R.certValidity4GeneralizedTime)),N.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(N.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(y.validity.notBefore=N[0],y.validity.notAfter=N[1],y.tbsCertificate=R.tbsCertificate,w){if(y.md=null,y.signatureOid in i){var A=i[y.signatureOid];switch(A){case"sha1WithRSAEncryption":y.md=V.md.sha1.create();break;case"md5WithRSAEncryption":y.md=V.md.md5.create();break;case"sha256WithRSAEncryption":y.md=V.md.sha256.create();break;case"sha384WithRSAEncryption":y.md=V.md.sha384.create();break;case"sha512WithRSAEncryption":y.md=V.md.sha512.create();break;case"RSASSA-PSS":y.md=V.md.sha256.create();break}}if(y.md===null){var b=new Error("Could not compute certificate digest. Unknown signature OID.");throw b.signatureOid=y.signatureOid,b}var B=t.toDer(y.tbsCertificate);y.md.update(B.getBytes())}var L=V.md.sha1.create();y.issuer.getField=function(z){return l(y.issuer,z)},y.issuer.addField=function(z){f([z]),y.issuer.attributes.push(z)},y.issuer.attributes=r.RDNAttributesAsArray(R.certIssuer,L),R.certIssuerUniqueId&&(y.issuer.uniqueId=R.certIssuerUniqueId),y.issuer.hash=L.digest().toHex();var F=V.md.sha1.create();return y.subject.getField=function(z){return l(y.subject,z)},y.subject.addField=function(z){f([z]),y.subject.attributes.push(z)},y.subject.attributes=r.RDNAttributesAsArray(R.certSubject,F),R.certSubjectUniqueId&&(y.subject.uniqueId=R.certSubjectUniqueId),y.subject.hash=F.digest().toHex(),R.certExtensions?y.extensions=r.certificateExtensionsFromAsn1(R.certExtensions):y.extensions=[],y.publicKey=r.publicKeyFromAsn1(R.subjectPublicKeyInfo),y},r.certificateExtensionsFromAsn1=function(m){for(var w=[],R=0;R<m.value.length;++R)for(var h=m.value[R],b=0;b<h.value.length;++b)w.push(r.certificateExtensionFromAsn1(h.value[b]));return w},r.certificateExtensionFromAsn1=function(m){var w={};if(w.id=t.derToOid(m.value[0].value),w.critical=!1,m.value[1].type===t.Type.BOOLEAN?(w.critical=m.value[1].value.charCodeAt(0)!==0,w.value=m.value[2].value):w.value=m.value[1].value,w.id in i){if(w.name=i[w.id],w.name==="keyUsage"){var R=t.fromDer(w.value),h=0,b=0;R.value.length>1&&(h=R.value.charCodeAt(1),b=R.value.length>2?R.value.charCodeAt(2):0),w.digitalSignature=(h&128)===128,w.nonRepudiation=(h&64)===64,w.keyEncipherment=(h&32)===32,w.dataEncipherment=(h&16)===16,w.keyAgreement=(h&8)===8,w.keyCertSign=(h&4)===4,w.cRLSign=(h&2)===2,w.encipherOnly=(h&1)===1,w.decipherOnly=(b&128)===128}else if(w.name==="basicConstraints"){var R=t.fromDer(w.value);R.value.length>0&&R.value[0].type===t.Type.BOOLEAN?w.cA=R.value[0].value.charCodeAt(0)!==0:w.cA=!1;var A=null;R.value.length>0&&R.value[0].type===t.Type.INTEGER?A=R.value[0].value:R.value.length>1&&(A=R.value[1].value),A!==null&&(w.pathLenConstraint=t.derToInteger(A))}else if(w.name==="extKeyUsage")for(var R=t.fromDer(w.value),y=0;y<R.value.length;++y){var P=t.derToOid(R.value[y].value);P in i?w[i[P]]=!0:w[P]=!0}else if(w.name==="nsCertType"){var R=t.fromDer(w.value),h=0;R.value.length>1&&(h=R.value.charCodeAt(1)),w.client=(h&128)===128,w.server=(h&64)===64,w.email=(h&32)===32,w.objsign=(h&16)===16,w.reserved=(h&8)===8,w.sslCA=(h&4)===4,w.emailCA=(h&2)===2,w.objCA=(h&1)===1}else if(w.name==="subjectAltName"||w.name==="issuerAltName"){w.altNames=[];for(var N,R=t.fromDer(w.value),B=0;B<R.value.length;++B){N=R.value[B];var L={type:N.type,value:N.value};w.altNames.push(L);switch(N.type){case 1:case 2:case 6:break;case 7:L.ip=V.util.bytesToIP(N.value);break;case 8:L.oid=t.derToOid(N.value);break}}}else if(w.name==="subjectKeyIdentifier"){var R=t.fromDer(w.value);w.subjectKeyIdentifier=V.util.bytesToHex(R.value)}}return w},r.certificationRequestFromAsn1=function(m,w){var R={},h=[];if(!t.validate(m,d,R,h)){var b=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw b.errors=h,b}var A=t.derToOid(R.publicKeyOid);if(A!==r.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var y=r.createCertificationRequest();if(y.version=R.csrVersion?R.csrVersion.charCodeAt(0):0,y.signatureOid=V.asn1.derToOid(R.csrSignatureOid),y.signatureParameters=u(y.signatureOid,R.csrSignatureParams,!0),y.siginfo.algorithmOid=V.asn1.derToOid(R.csrSignatureOid),y.siginfo.parameters=u(y.siginfo.algorithmOid,R.csrSignatureParams,!1),y.signature=R.csrSignature,y.certificationRequestInfo=R.certificationRequestInfo,w){if(y.md=null,y.signatureOid in i){var A=i[y.signatureOid];switch(A){case"sha1WithRSAEncryption":y.md=V.md.sha1.create();break;case"md5WithRSAEncryption":y.md=V.md.md5.create();break;case"sha256WithRSAEncryption":y.md=V.md.sha256.create();break;case"sha384WithRSAEncryption":y.md=V.md.sha384.create();break;case"sha512WithRSAEncryption":y.md=V.md.sha512.create();break;case"RSASSA-PSS":y.md=V.md.sha256.create();break}}if(y.md===null){var b=new Error("Could not compute certification request digest. Unknown signature OID.");throw b.signatureOid=y.signatureOid,b}var P=t.toDer(y.certificationRequestInfo);y.md.update(P.getBytes())}var N=V.md.sha1.create();return y.subject.getField=function(B){return l(y.subject,B)},y.subject.addField=function(B){f([B]),y.subject.attributes.push(B)},y.subject.attributes=r.RDNAttributesAsArray(R.certificationRequestInfoSubject,N),y.subject.hash=N.digest().toHex(),y.publicKey=r.publicKeyFromAsn1(R.subjectPublicKeyInfo),y.getAttribute=function(B){return l(y,B)},y.addAttribute=function(B){f([B]),y.attributes.push(B)},y.attributes=r.CRIAttributesAsArray(R.certificationRequestInfoAttributes||[]),y},r.createCertificationRequest=function(){var m={};return m.version=0,m.signatureOid=null,m.signature=null,m.siginfo={},m.siginfo.algorithmOid=null,m.subject={},m.subject.getField=function(w){return l(m.subject,w)},m.subject.addField=function(w){f([w]),m.subject.attributes.push(w)},m.subject.attributes=[],m.subject.hash=null,m.publicKey=null,m.attributes=[],m.getAttribute=function(w){return l(m,w)},m.addAttribute=function(w){f([w]),m.attributes.push(w)},m.md=null,m.setSubject=function(w){f(w),m.subject.attributes=w,m.subject.hash=null},m.setAttributes=function(w){f(w),m.attributes=w},m.sign=function(w,R){m.md=R||V.md.sha1.create();var h=i[m.md.algorithm+"WithRSAEncryption"];if(!h){var b=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw b.algorithm=m.md.algorithm,b}m.signatureOid=m.siginfo.algorithmOid=h,m.certificationRequestInfo=r.getCertificationRequestInfo(m);var A=t.toDer(m.certificationRequestInfo);m.md.update(A.getBytes()),m.signature=w.sign(m.md)},m.verify=function(){var w=!1,R=m.md;if(R===null){if(m.signatureOid in i){var h=i[m.signatureOid];switch(h){case"sha1WithRSAEncryption":R=V.md.sha1.create();break;case"md5WithRSAEncryption":R=V.md.md5.create();break;case"sha256WithRSAEncryption":R=V.md.sha256.create();break;case"sha384WithRSAEncryption":R=V.md.sha384.create();break;case"sha512WithRSAEncryption":R=V.md.sha512.create();break;case"RSASSA-PSS":R=V.md.sha256.create();break}}if(R===null){var b=new Error("Could not compute certification request digest. Unknown signature OID.");throw b.signatureOid=m.signatureOid,b}var A=m.certificationRequestInfo||r.getCertificationRequestInfo(m),y=t.toDer(A);R.update(y.getBytes())}if(R!==null){var P;switch(m.signatureOid){case i.sha1WithRSAEncryption:break;case i["RSASSA-PSS"]:var N,B;if(N=i[m.signatureParameters.mgf.hash.algorithmOid],N===void 0||V.md[N]===void 0){var b=new Error("Unsupported MGF hash function.");throw b.oid=m.signatureParameters.mgf.hash.algorithmOid,b.name=N,b}if(B=i[m.signatureParameters.mgf.algorithmOid],B===void 0||V.mgf[B]===void 0){var b=new Error("Unsupported MGF function.");throw b.oid=m.signatureParameters.mgf.algorithmOid,b.name=B,b}if(B=V.mgf[B].create(V.md[N].create()),N=i[m.signatureParameters.hash.algorithmOid],N===void 0||V.md[N]===void 0){var b=new Error("Unsupported RSASSA-PSS hash function.");throw b.oid=m.signatureParameters.hash.algorithmOid,b.name=N,b}P=V.pss.create(V.md[N].create(),B,m.signatureParameters.saltLength);break}w=m.publicKey.verify(R.digest().getBytes(),m.signature,P)}return w},m};function p(m){for(var w=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),R,h,b=m.attributes,A=0;A<b.length;++A){R=b[A];var y=R.value,P=t.Type.PRINTABLESTRING;"valueTagClass"in R&&(P=R.valueTagClass,P===t.Type.UTF8&&(y=V.util.encodeUtf8(y))),h=t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(R.type).getBytes()),t.create(t.Class.UNIVERSAL,P,!1,y)])]),w.value.push(h)}return w}function f(m){for(var w,R=0;R<m.length;++R){if(w=m[R],typeof w.name=="undefined"&&(w.type&&w.type in r.oids?w.name=r.oids[w.type]:w.shortName&&w.shortName in n&&(w.name=r.oids[n[w.shortName]])),typeof w.type=="undefined")if(w.name&&w.name in r.oids)w.type=r.oids[w.name];else{var h=new Error("Attribute type not specified.");throw h.attribute=w,h}if(typeof w.shortName=="undefined"&&(w.name&&w.name in n&&(w.shortName=n[w.name])),w.type===i.extensionRequest&&(w.valueConstructed=!0,w.valueTagClass=t.Type.SEQUENCE,!w.value&&w.extensions)){w.value=[];for(var b=0;b<w.extensions.length;++b)w.value.push(r.certificateExtensionToAsn1(g(w.extensions[b])))}if(typeof w.value=="undefined"){var h=new Error("Attribute value not specified.");throw h.attribute=w,h}}}function g(m,w){if(w=w||{},typeof m.name=="undefined"&&(m.id&&m.id in r.oids&&(m.name=r.oids[m.id])),typeof m.id=="undefined")if(m.name&&m.name in r.oids)m.id=r.oids[m.name];else{var R=new Error("Extension ID not specified.");throw R.extension=m,R}if(typeof m.value!="undefined")return m;if(m.name==="keyUsage"){var h=0,b=0,A=0;m.digitalSignature&&(b|=128,h=7),m.nonRepudiation&&(b|=64,h=6),m.keyEncipherment&&(b|=32,h=5),m.dataEncipherment&&(b|=16,h=4),m.keyAgreement&&(b|=8,h=3),m.keyCertSign&&(b|=4,h=2),m.cRLSign&&(b|=2,h=1),m.encipherOnly&&(b|=1,h=0),m.decipherOnly&&(A|=128,h=7);var y=String.fromCharCode(h);A!==0?y+=String.fromCharCode(b)+String.fromCharCode(A):b!==0&&(y+=String.fromCharCode(b)),m.value=t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,y)}else if(m.name==="basicConstraints")m.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),m.cA&&m.value.value.push(t.create(t.Class.UNIVERSAL,t.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in m&&m.value.value.push(t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(m.pathLenConstraint).getBytes()));else if(m.name==="extKeyUsage"){m.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);var P=m.value.value;for(var N in m){if(m[N]!==!0)continue;N in i?P.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i[N]).getBytes())):N.indexOf(".")!==-1&&P.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(N).getBytes()))}}else if(m.name==="nsCertType"){var h=0,b=0;m.client&&(b|=128,h=7),m.server&&(b|=64,h=6),m.email&&(b|=32,h=5),m.objsign&&(b|=16,h=4),m.reserved&&(b|=8,h=3),m.sslCA&&(b|=4,h=2),m.emailCA&&(b|=2,h=1),m.objCA&&(b|=1,h=0);var y=String.fromCharCode(h);b!==0&&(y+=String.fromCharCode(b)),m.value=t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,y)}else if(m.name==="subjectAltName"||m.name==="issuerAltName"){m.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);for(var B,L=0;L<m.altNames.length;++L){B=m.altNames[L];var y=B.value;if(B.type===7&&B.ip){if(y=V.util.bytesFromIP(B.ip),y===null){var R=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw R.extension=m,R}}else B.type===8&&(B.oid?y=t.oidToDer(t.oidToDer(B.oid)):y=t.oidToDer(y));m.value.value.push(t.create(t.Class.CONTEXT_SPECIFIC,B.type,!1,y))}}else if(m.name==="nsComment"&&w.cert){if(!/^[\x00-\x7F]*$/.test(m.comment)||m.comment.length<1||m.comment.length>128)throw new Error('Invalid "nsComment" content.');m.value=t.create(t.Class.UNIVERSAL,t.Type.IA5STRING,!1,m.comment)}else if(m.name==="subjectKeyIdentifier"&&w.cert){var F=w.cert.generateSubjectKeyIdentifier();m.subjectKeyIdentifier=F.toHex(),m.value=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,F.getBytes())}else if(m.name==="authorityKeyIdentifier"&&w.cert){m.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);var P=m.value.value;if(m.keyIdentifier){var z=m.keyIdentifier===!0?w.cert.generateSubjectKeyIdentifier().getBytes():m.keyIdentifier;P.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!1,z))}if(m.authorityCertIssuer){var X=[t.create(t.Class.CONTEXT_SPECIFIC,4,!0,[p(m.authorityCertIssuer===!0?w.cert.issuer:m.authorityCertIssuer)])];P.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,X))}if(m.serialNumber){var Z=V.util.hexToBytes(m.serialNumber===!0?w.cert.serialNumber:m.serialNumber);P.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!1,Z))}}else if(m.name==="cRLDistributionPoints"){m.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);for(var P=m.value.value,re=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),ue=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[]),B,L=0;L<m.altNames.length;++L){B=m.altNames[L];var y=B.value;if(B.type===7&&B.ip){if(y=V.util.bytesFromIP(B.ip),y===null){var R=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw R.extension=m,R}}else B.type===8&&(B.oid?y=t.oidToDer(t.oidToDer(B.oid)):y=t.oidToDer(y));ue.value.push(t.create(t.Class.CONTEXT_SPECIFIC,B.type,!1,y))}re.value.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[ue])),P.push(re)}if(typeof m.value=="undefined"){var R=new Error("Extension value not specified.");throw R.extension=m,R}return m}function v(m,w){switch(m){case i["RSASSA-PSS"]:var R=[];return w.hash.algorithmOid!==void 0&&R.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(w.hash.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])])),w.mgf.algorithmOid!==void 0&&R.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(w.mgf.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(w.mgf.hash.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])])])),w.saltLength!==void 0&&R.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(w.saltLength).getBytes())])),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,R);default:return t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")}}function S(m){var w=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[]);if(m.attributes.length===0)return w;for(var R=m.attributes,h=0;h<R.length;++h){var b=R[h],A=b.value,y=t.Type.UTF8;"valueTagClass"in b&&(y=b.valueTagClass),y===t.Type.UTF8&&(A=V.util.encodeUtf8(A));var P=!1;"valueConstructed"in b&&(P=b.valueConstructed);var N=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(b.type).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,y,P,A)])]);w.value.push(N)}return w}var C=new Date("1950-01-01T00:00:00Z"),D=new Date("2050-01-01T00:00:00Z");function j(m){return m>=C&&m<D?t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(m)):t.create(t.Class.UNIVERSAL,t.Type.GENERALIZEDTIME,!1,t.dateToGeneralizedTime(m))}r.getTBSCertificate=function(m){var w=j(m.validity.notBefore),R=j(m.validity.notAfter),h=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(m.version).getBytes())]),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,V.util.hexToBytes(m.serialNumber)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(m.siginfo.algorithmOid).getBytes()),v(m.siginfo.algorithmOid,m.siginfo.parameters)]),p(m.issuer),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[w,R]),p(m.subject),r.publicKeyToAsn1(m.publicKey)]);return m.issuer.uniqueId&&h.value.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+m.issuer.uniqueId)])),m.subject.uniqueId&&h.value.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!0,[t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+m.subject.uniqueId)])),m.extensions.length>0&&h.value.push(r.certificateExtensionsToAsn1(m.extensions)),h},r.getCertificationRequestInfo=function(m){var w=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(m.version).getBytes()),p(m.subject),r.publicKeyToAsn1(m.publicKey),S(m)]);return w},r.distinguishedNameToAsn1=function(m){return p(m)},r.certificateToAsn1=function(m){var w=m.tbsCertificate||r.getTBSCertificate(m);return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[w,t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(m.signatureOid).getBytes()),v(m.signatureOid,m.signatureParameters)]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+m.signature)])},r.certificateExtensionsToAsn1=function(m){var w=t.create(t.Class.CONTEXT_SPECIFIC,3,!0,[]),R=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);w.value.push(R);for(var h=0;h<m.length;++h)R.value.push(r.certificateExtensionToAsn1(m[h]));return w},r.certificateExtensionToAsn1=function(m){var w=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);w.value.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(m.id).getBytes())),m.critical&&w.value.push(t.create(t.Class.UNIVERSAL,t.Type.BOOLEAN,!1,String.fromCharCode(255)));var R=m.value;return typeof m.value!="string"&&(R=t.toDer(R).getBytes()),w.value.push(t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,R)),w},r.certificationRequestToAsn1=function(m){var w=m.certificationRequestInfo||r.getCertificationRequestInfo(m);return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[w,t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(m.signatureOid).getBytes()),v(m.signatureOid,m.signatureParameters)]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+m.signature)])},r.createCaStore=function(m){var w={certs:{}};w.getIssuer=function(y){var P=R(y.issuer);return P},w.addCertificate=function(y){if(typeof y=="string"&&(y=V.pki.certificateFromPem(y)),h(y.subject),!w.hasCertificate(y))if(y.subject.hash in w.certs){var P=w.certs[y.subject.hash];V.util.isArray(P)||(P=[P]),P.push(y),w.certs[y.subject.hash]=P}else w.certs[y.subject.hash]=y},w.hasCertificate=function(y){typeof y=="string"&&(y=V.pki.certificateFromPem(y));var P=R(y.subject);if(!P)return!1;V.util.isArray(P)||(P=[P]);for(var N=t.toDer(r.certificateToAsn1(y)).getBytes(),B=0;B<P.length;++B){var L=t.toDer(r.certificateToAsn1(P[B])).getBytes();if(N===L)return!0}return!1},w.listAllCertificates=function(){var y=[];for(var P in w.certs)if(w.certs.hasOwnProperty(P)){var N=w.certs[P];if(!V.util.isArray(N))y.push(N);else for(var B=0;B<N.length;++B)y.push(N[B])}return y},w.removeCertificate=function(y){var P;if(typeof y=="string"&&(y=V.pki.certificateFromPem(y)),h(y.subject),!w.hasCertificate(y))return null;var N=R(y.subject);if(!V.util.isArray(N))return P=w.certs[y.subject.hash],delete w.certs[y.subject.hash],P;for(var B=t.toDer(r.certificateToAsn1(y)).getBytes(),L=0;L<N.length;++L){var F=t.toDer(r.certificateToAsn1(N[L])).getBytes();B===F&&(P=N[L],N.splice(L,1))}return N.length===0&&delete w.certs[y.subject.hash],P};function R(y){return h(y),w.certs[y.hash]||null}function h(y){if(!y.hash){var P=V.md.sha1.create();y.attributes=r.RDNAttributesAsArray(p(y),P),y.hash=P.digest().toHex()}}if(m)for(var b=0;b<m.length;++b){var A=m[b];w.addCertificate(A)}return w},r.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},r.verifyCertificateChain=function(m,w,R){typeof R=="function"&&(R={verify:R}),R=R||{},w=w.slice(0);var h=w.slice(0),b=R.validityCheckDate;typeof b=="undefined"&&(b=new Date);var A=!0,y=null,P=0;do{var N=w.shift(),B=null,L=!1;if(b&&((b<N.validity.notBefore||b>N.validity.notAfter)&&(y={message:"Certificate is not valid yet or has expired.",error:r.certificateError.certificate_expired,notBefore:N.validity.notBefore,notAfter:N.validity.notAfter,now:b})),y===null){if(B=w[0]||m.getIssuer(N),B===null&&(N.isIssuer(N)&&(L=!0,B=N)),B){var F=B;V.util.isArray(F)||(F=[F]);for(var z=!1;!z&&F.length>0;){B=F.shift();try{z=B.verify(N)}catch(we){}}z||(y={message:"Certificate signature is invalid.",error:r.certificateError.bad_certificate})}y===null&&(!B||L)&&!m.hasCertificate(N)&&(y={message:"Certificate is not trusted.",error:r.certificateError.unknown_ca})}if(y===null&&B&&!N.isIssuer(B)&&(y={message:"Certificate issuer is invalid.",error:r.certificateError.bad_certificate}),y===null)for(var X={keyUsage:!0,basicConstraints:!0},Z=0;y===null&&Z<N.extensions.length;++Z){var re=N.extensions[Z];re.critical&&!(re.name in X)&&(y={message:"Certificate has an unsupported critical extension.",error:r.certificateError.unsupported_certificate})}if(y===null&&(!A||w.length===0&&(!B||L))){var ue=N.getExtension("basicConstraints"),ge=N.getExtension("keyUsage");if(ge!==null&&((!ge.keyCertSign||ue===null)&&(y={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:r.certificateError.bad_certificate})),y===null&&ue!==null&&!ue.cA&&(y={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:r.certificateError.bad_certificate}),y===null&&ge!==null&&"pathLenConstraint"in ue){var ye=P-1;ye>ue.pathLenConstraint&&(y={message:"Certificate basicConstraints pathLenConstraint violated.",error:r.certificateError.bad_certificate})}}var ve=y===null?!0:y.error,ce=R.verify?R.verify(ve,P,h):ve;if(ce===!0)y=null;else throw ve===!0&&(y={message:"The application rejected the certificate.",error:r.certificateError.bad_certificate}),(ce||ce===0)&&(typeof ce=="object"&&!V.util.isArray(ce)?(ce.message&&(y.message=ce.message),ce.error&&(y.error=ce.error)):typeof ce=="string"&&(y.error=ce)),y;A=!1,++P}while(w.length>0);return!0}}),fP=ne(function(e){var t=V.asn1,r=e.exports=V.pkcs7=V.pkcs7||{};r.messageFromPem=function(f){var g=V.pem.decode(f)[0];if(g.type!=="PKCS7"){var v=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw v.headerType=g.type,v}if(g.procType&&g.procType.type==="ENCRYPTED")throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var S=t.fromDer(g.body);return r.messageFromAsn1(S)},r.messageToPem=function(f,g){var v={type:"PKCS7",body:t.toDer(f.toAsn1()).getBytes()};return V.pem.encode(v,{maxline:g})},r.messageFromAsn1=function(f){var g={},v=[];if(!t.validate(f,r.asn1.contentInfoValidator,g,v)){var S=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw S.errors=v,S}var C=t.derToOid(g.contentType),D;switch(C){case V.pki.oids.envelopedData:D=r.createEnvelopedData();break;case V.pki.oids.encryptedData:D=r.createEncryptedData();break;case V.pki.oids.signedData:D=r.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+C+" is not (yet) supported.")}return D.fromAsn1(g.content.value[0]),D},r.createSignedData=function(){var f=null;return f={type:V.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(S){if(u(f,S,r.asn1.signedDataValidator),f.certificates=[],f.crls=[],f.digestAlgorithmIdentifiers=[],f.contentInfo=null,f.signerInfos=[],f.rawCapture.certificates)for(var C=f.rawCapture.certificates.value,D=0;D<C.length;++D)f.certificates.push(V.pki.certificateFromAsn1(C[D]))},toAsn1:function(){f.contentInfo||f.sign();for(var S=[],C=0;C<f.certificates.length;++C)S.push(V.pki.certificateToAsn1(f.certificates[C]));var D=[],j=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(f.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,f.digestAlgorithmIdentifiers),f.contentInfo])]);return S.length>0&&j.value[0].value.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,S)),D.length>0&&j.value[0].value.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,D)),j.value[0].value.push(t.create(t.Class.UNIVERSAL,t.Type.SET,!0,f.signerInfos)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.type).getBytes()),j])},addSigner:function(S){var C=S.issuer,D=S.serialNumber;if(S.certificate){var j=S.certificate;typeof j=="string"&&(j=V.pki.certificateFromPem(j)),C=j.issuer.attributes,D=j.serialNumber}var m=S.key;if(!m)throw new Error("Could not add PKCS#7 signer; no private key specified.");typeof m=="string"&&(m=V.pki.privateKeyFromPem(m));var w=S.digestAlgorithm||V.pki.oids.sha1;switch(w){case V.pki.oids.sha1:case V.pki.oids.sha256:case V.pki.oids.sha384:case V.pki.oids.sha512:case V.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+w)}var R=S.authenticatedAttributes||[];if(R.length>0){for(var h=!1,b=!1,A=0;A<R.length;++A){var y=R[A];if(!h&&y.type===V.pki.oids.contentType){if(h=!0,b)break;continue}if(!b&&y.type===V.pki.oids.messageDigest){if(b=!0,h)break;continue}}if(!h||!b)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}f.signers.push({key:m,version:1,issuer:C,serialNumber:D,digestAlgorithm:w,signatureAlgorithm:V.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:R,unauthenticatedAttributes:[]})},sign:function(S){if(S=S||{},(typeof f.content!="object"||f.contentInfo===null)&&(f.contentInfo=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(V.pki.oids.data).getBytes())]),"content"in f)){var C;f.content instanceof V.util.ByteBuffer?C=f.content.bytes():typeof f.content=="string"&&(C=V.util.encodeUtf8(f.content)),S.detached?f.detachedContent=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,C):f.contentInfo.value.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,C)]))}if(f.signers.length===0)return;var D=g();v(D)},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(S){typeof S=="string"&&(S=V.pki.certificateFromPem(S)),f.certificates.push(S)},addCertificateRevokationList:function(S){throw new Error("PKCS#7 CRL support not yet implemented.")}},f;function g(){for(var S={},C=0;C<f.signers.length;++C){var D=f.signers[C],j=D.digestAlgorithm;j in S||(S[j]=V.md[V.pki.oids[j]].create()),D.authenticatedAttributes.length===0?D.md=S[j]:D.md=V.md[V.pki.oids[j]].create()}f.digestAlgorithmIdentifiers=[];for(var j in S)f.digestAlgorithmIdentifiers.push(t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(j).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]));return S}function v(S){var C;if(f.detachedContent?C=f.detachedContent:(C=f.contentInfo.value[1],C=C.value[0]),!C)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var D=t.derToOid(f.contentInfo.value[0].value),j=t.toDer(C);j.getByte(),t.getBerValueLength(j),j=j.getBytes();for(var m in S)S[m].start().update(j);for(var w=new Date,R=0;R<f.signers.length;++R){var h=f.signers[R];if(h.authenticatedAttributes.length===0){if(D!==V.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{h.authenticatedAttributesAsn1=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var b=t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[]),A=0;A<h.authenticatedAttributes.length;++A){var y=h.authenticatedAttributes[A];y.type===V.pki.oids.messageDigest?y.value=S[h.digestAlgorithm].digest():y.type===V.pki.oids.signingTime&&(y.value||(y.value=w)),b.value.push(d(y)),h.authenticatedAttributesAsn1.value.push(d(y))}j=t.toDer(b).getBytes(),h.md.start().update(j)}h.signature=h.key.sign(h.md,"RSASSA-PKCS1-V1_5")}f.signerInfos=o(f.signers)}},r.createEncryptedData=function(){var f=null;return f={type:V.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:V.pki.oids["aes256-CBC"]},fromAsn1:function(g){u(f,g,r.asn1.encryptedDataValidator)},decrypt:function(g){g!==void 0&&(f.encryptedContent.key=g),p(f)}},f},r.createEnvelopedData=function(){var f=null;return f={type:V.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:V.pki.oids["aes256-CBC"]},fromAsn1:function(g){var v=u(f,g,r.asn1.envelopedDataValidator);f.recipients=s(v.recipientInfos.value)},toAsn1:function(){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.type).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(f.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,a(f.recipients)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,l(f.encryptedContent))])])])},findRecipient:function(g){for(var v=g.issuer.attributes,S=0;S<f.recipients.length;++S){var C=f.recipients[S],D=C.issuer;if(C.serialNumber!==g.serialNumber)continue;if(D.length!==v.length)continue;for(var j=!0,m=0;m<v.length;++m)if(D[m].type!==v[m].type||D[m].value!==v[m].value){j=!1;break}if(j)return C}return null},decrypt:function(g,v){if(f.encryptedContent.key===void 0&&g!==void 0&&v!==void 0)switch(g.encryptedContent.algorithm){case V.pki.oids.rsaEncryption:case V.pki.oids.desCBC:var S=v.decrypt(g.encryptedContent.content);f.encryptedContent.key=V.util.createBuffer(S);break;default:throw new Error("Unsupported asymmetric cipher, OID "+g.encryptedContent.algorithm)}p(f)},addRecipient:function(g){f.recipients.push({version:0,issuer:g.issuer.attributes,serialNumber:g.serialNumber,encryptedContent:{algorithm:V.pki.oids.rsaEncryption,key:g.publicKey}})},encrypt:function(g,v){if(f.encryptedContent.content===void 0){v=v||f.encryptedContent.algorithm,g=g||f.encryptedContent.key;var S,C,D;switch(v){case V.pki.oids["aes128-CBC"]:S=16,C=16,D=V.aes.createEncryptionCipher;break;case V.pki.oids["aes192-CBC"]:S=24,C=16,D=V.aes.createEncryptionCipher;break;case V.pki.oids["aes256-CBC"]:S=32,C=16,D=V.aes.createEncryptionCipher;break;case V.pki.oids["des-EDE3-CBC"]:S=24,C=8,D=V.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+v)}if(g===void 0)g=V.util.createBuffer(V.random.getBytes(S));else if(g.length()!=S)throw new Error("Symmetric key has wrong length; got "+g.length()+" bytes, expected "+S+".");f.encryptedContent.algorithm=v,f.encryptedContent.key=g,f.encryptedContent.parameter=V.util.createBuffer(V.random.getBytes(C));var j=D(g);if(j.start(f.encryptedContent.parameter.copy()),j.update(f.content),!j.finish())throw new Error("Symmetric encryption failed.");f.encryptedContent.content=j.output}for(var m=0;m<f.recipients.length;++m){var w=f.recipients[m];if(w.encryptedContent.content!==void 0)continue;switch(w.encryptedContent.algorithm){case V.pki.oids.rsaEncryption:w.encryptedContent.content=w.encryptedContent.key.encrypt(f.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+w.encryptedContent.algorithm)}}}},f};function i(f){var g={},v=[];if(!t.validate(f,r.asn1.recipientInfoValidator,g,v)){var S=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw S.errors=v,S}return{version:g.version.charCodeAt(0),issuer:V.pki.RDNAttributesAsArray(g.issuer),serialNumber:V.util.createBuffer(g.serial).toHex(),encryptedContent:{algorithm:t.derToOid(g.encAlgorithm),parameter:g.encParameter.value,content:g.encKey}}}function n(f){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(f.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[V.pki.distinguishedNameToAsn1({attributes:f.issuer}),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,V.util.hexToBytes(f.serialNumber))]),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.encryptedContent.algorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,f.encryptedContent.content)])}function s(f){for(var g=[],v=0;v<f.length;++v)g.push(i(f[v]));return g}function a(f){for(var g=[],v=0;v<f.length;++v)g.push(n(f[v]));return g}function c(f){var g=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(f.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[V.pki.distinguishedNameToAsn1({attributes:f.issuer}),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,V.util.hexToBytes(f.serialNumber))]),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.digestAlgorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])]);if(f.authenticatedAttributesAsn1&&g.value.push(f.authenticatedAttributesAsn1),g.value.push(t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.signatureAlgorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])),g.value.push(t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,f.signature)),f.unauthenticatedAttributes.length>0){for(var v=t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[]),S=0;S<f.unauthenticatedAttributes.length;++S){var C=f.unauthenticatedAttributes[S];v.values.push(d(C))}g.value.push(v)}return g}function o(f){for(var g=[],v=0;v<f.length;++v)g.push(c(f[v]));return g}function d(f){var g;if(f.type===V.pki.oids.contentType)g=t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.value).getBytes());else if(f.type===V.pki.oids.messageDigest)g=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,f.value.bytes());else if(f.type===V.pki.oids.signingTime){var v=new Date("1950-01-01T00:00:00Z"),S=new Date("2050-01-01T00:00:00Z"),C=f.value;if(typeof C=="string"){var D=Date.parse(C);isNaN(D)?C.length===13?C=t.utcTimeToDate(C):C=t.generalizedTimeToDate(C):C=new Date(D)}C>=v&&C<S?g=t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(C)):g=t.create(t.Class.UNIVERSAL,t.Type.GENERALIZEDTIME,!1,t.dateToGeneralizedTime(C))}return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.type).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[g])])}function l(f){return[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(V.pki.oids.data).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.algorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,f.parameter.getBytes())]),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,f.content.getBytes())])]}function u(f,g,v){var S={},C=[];if(!t.validate(g,v,S,C)){var D=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw D.errors=D,D}var j=t.derToOid(S.contentType);if(j!==V.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(S.encryptedContent){var m="";if(V.util.isArray(S.encryptedContent))for(var w=0;w<S.encryptedContent.length;++w){if(S.encryptedContent[w].type!==t.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");m+=S.encryptedContent[w].value}else m=S.encryptedContent;f.encryptedContent={algorithm:t.derToOid(S.encAlgorithm),parameter:V.util.createBuffer(S.encParameter.value),content:V.util.createBuffer(m)}}if(S.content){var m="";if(V.util.isArray(S.content))for(var w=0;w<S.content.length;++w){if(S.content[w].type!==t.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");m+=S.content[w].value}else m=S.content;f.content=V.util.createBuffer(m)}return f.version=S.version.charCodeAt(0),f.rawCapture=S,S}function p(f){if(f.encryptedContent.key===void 0)throw new Error("Symmetric key not available.");if(f.content===void 0){var g;switch(f.encryptedContent.algorithm){case V.pki.oids["aes128-CBC"]:case V.pki.oids["aes192-CBC"]:case V.pki.oids["aes256-CBC"]:g=V.aes.createDecryptionCipher(f.encryptedContent.key);break;case V.pki.oids.desCBC:case V.pki.oids["des-EDE3-CBC"]:g=V.des.createDecryptionCipher(f.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+f.encryptedContent.algorithm)}if(g.start(f.encryptedContent.parameter),g.update(f.encryptedContent.content),!g.finish())throw new Error("Symmetric decryption failed.");f.content=g.output}}}),F2=ne(function(e,t){const r=V.pki;t=e.exports,t.certificateForKey=(n,s)=>{const a=r.setRsaPublicKey(s.n,s.e),c=r.createCertificate();c.publicKey=a,c.serialNumber="01",c.validity.notBefore=new Date,c.validity.notAfter=new Date,c.validity.notAfter.setFullYear(c.validity.notBefore.getFullYear()+10);const o=[{name:"organizationName",value:"ipfs"},{shortName:"OU",value:"keystore"},{name:"commonName",value:n.id}];return c.setSubject(o),c.setIssuer(o),c.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"extKeyUsage",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:"nsCertType",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),c.sign(s),c};async function i(n,s){const a=n.map(s),c=await Promise.all(a),o=c.findIndex(d=>d);return n[o]}e.exports.findAsync=i});const{certificateForKey:U2,findAsync:q2}=F2,ll=new WeakMap;class z2{constructor(e,t){if(!e)throw G(new Error("keychain is required"),"ERR_KEYCHAIN_REQUIRED");this.keychain=e,ll.set(this,{dek:t})}async encrypt(e,t){if(!(t instanceof Uint8Array))throw G(new Error("Plain data must be a Uint8Array"),"ERR_INVALID_PARAMS");const r=await this.keychain.findKeyByName(e),i=await this.keychain._getPrivateKey(e),n=ll.get(this).dek,s=V.pki.decryptRsaPrivateKey(i,n),a=await U2(r,s),c=V.pkcs7.createEnvelopedData();c.addRecipient(a),c.content=V.util.createBuffer(t),c.encrypt();const o=V.asn1.toDer(c.toAsn1()).getBytes();return St(o,"ascii")}async decrypt(e){if(!(e instanceof Uint8Array))throw G(new Error("CMS data is required"),"ERR_INVALID_PARAMS");let t;try{const o=V.util.createBuffer(Ae(e,"ascii")),d=V.asn1.fromDer(o);t=V.pkcs7.messageFromAsn1(d)}catch(o){throw G(new Error("Invalid CMS: "+o.message),"ERR_INVALID_CMS")}const r=t.recipients.filter(o=>o.issuer.find(d=>d.shortName==="O"&&d.value==="ipfs")).filter(o=>o.issuer.find(d=>d.shortName==="CN")).map(o=>({recipient:o,keyId:o.issuer.find(d=>d.shortName==="CN").value})),i=await q2(r,async o=>{try{const d=await this.keychain.findKeyById(o.keyId);if(d)return!0}catch(d){return!1}return!1});if(!i){const o=r.map(d=>d.keyId);throw G(new Error("Decryption needs one of the key(s): "+o.join(", ")),"ERR_MISSING_KEYS",{missingKeys:o})}const n=await this.keychain.findKeyById(i.keyId);if(!n)throw G(new Error("No key available to decrypto"),"ERR_NO_KEY");const s=await this.keychain._getPrivateKey(n.name),a=ll.get(this).dek,c=V.pki.decryptRsaPrivateKey(s,a);return t.decrypt(i.recipient,c),St(t.content.getBytes(),"ascii")}}var $2=z2;const{Number:H2}=Pn,V2="/pkcs8/",sp="/info/",Ks=new WeakMap,hs={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},ul={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function sn(e){return e?typeof e!="string"?!1:e===j2(e.trim()):!1}async function gt(e){const t=200,r=1e3,i=Math.random()*(r-t)+t;throw await new Promise(n=>setTimeout(n,i)),e}function Bn(e){return new Pd.Key(V2+e)}function ps(e){return new Pd.Key(sp+e)}class G2{constructor(e,t){if(!e)throw new Error("store is required");if(this.store=e,this.opts=rc(ul,t),this.opts.passPhrase&&this.opts.passPhrase.length<20)throw new Error("passPhrase must be least 20 characters");if(this.opts.dek.keyLength<hs.minKeyLength)throw new Error(`dek.keyLength must be least ${hs.minKeyLength} bytes`);if(this.opts.dek.salt.length<hs.minSaltLength)throw new Error(`dek.saltLength must be least ${hs.minSaltLength} bytes`);if(this.opts.dek.iterationCount<hs.minIterationCount)throw new Error(`dek.iterationCount must be least ${hs.minIterationCount}`);const r=this.opts.passPhrase?cs.pbkdf2(this.opts.passPhrase,this.opts.dek.salt,this.opts.dek.iterationCount,this.opts.dek.keyLength,this.opts.dek.hash):"";Ks.set(this,{dek:r})}get cms(){return new $2(this,Ks.get(this).dek)}static generateOptions(){const e=Object.assign({},ul),t=Math.ceil(hs.minSaltLength/3)*3;return e.dek.salt=Ae(cs.randomBytes(t),"base64"),e}static get options(){return ul}async createKey(e,t,r=2048){const i=this;if(!sn(e)||e==="self")return gt(G(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));if(typeof t!="string")return gt(G(new Error(`Invalid key type '${t}'`),"ERR_INVALID_KEY_TYPE"));const n=Bn(e),s=await i.store.has(n);if(s)return gt(G(new Error(`Key '${e}' already exists`),"ERR_KEY_ALREADY_EXISTS"));switch(t.toLowerCase()){case"rsa":if(!H2.isSafeInteger(r)||r<2048)return gt(G(new Error(`Invalid RSA key size ${r}`),"ERR_INVALID_KEY_SIZE"));break}let a;try{const c=await cs.keys.generateKeyPair(t,r),o=await c.id(),d=Ks.get(this).dek,l=await c.export(d);a={name:e,id:o};const u=i.store.batch();u.put(n,St(l)),u.put(ps(e),St(JSON.stringify(a))),await u.commit()}catch(c){return gt(c)}return a}async listKeys(){const e=this,t={prefix:sp},r=[];for await(const i of e.store.query(t))r.push(JSON.parse(Ae(i.value)));return r}async findKeyById(e){try{const t=await this.listKeys();return t.find(r=>r.id===e)}catch(t){return gt(t)}}async findKeyByName(e){if(!sn(e))return gt(G(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));const t=ps(e);try{const r=await this.store.get(t);return JSON.parse(Ae(r))}catch(r){return gt(G(new Error(`Key '${e}' does not exist. ${r.message}`),"ERR_KEY_NOT_FOUND"))}}async removeKey(e){const t=this;if(!sn(e)||e==="self")return gt(G(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));const r=Bn(e),i=await t.findKeyByName(e),n=t.store.batch();return n.delete(r),n.delete(ps(e)),await n.commit(),i}async renameKey(e,t){const r=this;if(!sn(e)||e==="self")return gt(G(new Error(`Invalid old key name '${e}'`),"ERR_OLD_KEY_NAME_INVALID"));if(!sn(t)||t==="self")return gt(G(new Error(`Invalid new key name '${t}'`),"ERR_NEW_KEY_NAME_INVALID"));const i=Bn(e),n=Bn(t),s=ps(e),a=ps(t),c=await r.store.has(n);if(c)return gt(G(new Error(`Key '${t}' already exists`),"ERR_KEY_ALREADY_EXISTS"));try{const o=await r.store.get(i),d=await r.store.get(s),l=JSON.parse(Ae(d));l.name=t;const u=r.store.batch();return u.put(n,o),u.put(a,St(JSON.stringify(l))),u.delete(i),u.delete(s),await u.commit(),l}catch(o){return gt(o)}}async exportKey(e,t){if(!sn(e))return gt(G(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));if(!t)return gt(G(new Error("Password is required"),"ERR_PASSWORD_REQUIRED"));const r=Bn(e);try{const i=await this.store.get(r),n=Ae(i),s=Ks.get(this).dek,a=await cs.keys.import(n,s);return a.export(t)}catch(i){return gt(i)}}async importKey(e,t,r){const i=this;if(!sn(e)||e==="self")return gt(G(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));if(!t)return gt(G(new Error("PEM encoded key is required"),"ERR_PEM_REQUIRED"));const n=Bn(e),s=await i.store.has(n);if(s)return gt(G(new Error(`Key '${e}' already exists`),"ERR_KEY_ALREADY_EXISTS"));let a;try{a=await cs.keys.import(t,r)}catch(l){return gt(G(new Error("Cannot read the key, most likely the password is wrong"),"ERR_CANNOT_READ_KEY"))}let c;try{c=await a.id();const l=Ks.get(this).dek;t=await a.export(l)}catch(l){return gt(l)}const o={name:e,id:c},d=i.store.batch();return d.put(n,St(t)),d.put(ps(e),St(JSON.stringify(o))),await d.commit(),o}async importPeer(e,t){const r=this;if(!sn(e))return gt(G(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));if(!t||!t.privKey)return gt(G(new Error("Peer.privKey is required"),"ERR_MISSING_PRIVATE_KEY"));const i=t.privKey,n=Bn(e),s=await r.store.has(n);if(s)return gt(G(new Error(`Key '${e}' already exists`),"ERR_KEY_ALREADY_EXISTS"));try{const a=await i.id(),c=Ks.get(this).dek,o=await i.export(c),d={name:e,id:a},l=r.store.batch();return l.put(n,St(o)),l.put(ps(e),St(JSON.stringify(d))),await l.commit(),d}catch(a){return gt(a)}}async _getPrivateKey(e){if(!sn(e))return gt(G(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));try{const t=Bn(e),r=await this.store.get(t);return Ae(r)}catch(t){return gt(G(new Error(`Key '${e}' does not exist. ${t.message}`),"ERR_KEY_NOT_FOUND"))}}}var ap=G2,X2=e=>{const t=by(e);return t.delete=t.remove,t},K2=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,fl=Math.ceil,xi=Math.floor,Pr="[BigNumber Error] ",op=Pr+"Number primitive has more than 15 significant digits: ",pi=1e14,Pe=14,hl=9007199254740991,pl=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Ln=1e7,Wt=1e9;function cp(e){var t,r,i,n=C.prototype={constructor:C,toString:null,valueOf:null},s=new C(1),a=20,c=4,o=-7,d=21,l=-1e7,u=1e7,p=!1,f=1,g=0,v={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},S="0123456789abcdefghijklmnopqrstuvwxyz";function C(h,b){var A,y,P,N,B,L,F,z,X=this;if(!(X instanceof C))return new C(h,b);if(b==null){if(h&&h._isBigNumber===!0){X.s=h.s,!h.c||h.e>u?X.c=X.e=null:h.e<l?X.c=[X.e=0]:(X.e=h.e,X.c=h.c.slice());return}if((L=typeof h=="number")&&h*0==0){if(X.s=1/h<0?(h=-h,-1):1,h===~~h){for(N=0,B=h;B>=10;B/=10,N++);N>u?X.c=X.e=null:(X.e=N,X.c=[h]);return}z=String(h)}else{if(!K2.test(z=String(h)))return i(X,z,L);X.s=z.charCodeAt(0)==45?(z=z.slice(1),-1):1}(N=z.indexOf("."))>-1&&(z=z.replace(".","")),(B=z.search(/e/i))>0?(N<0&&(N=B),N+=+z.slice(B+1),z=z.substring(0,B)):N<0&&(N=z.length)}else{if(Tt(b,2,S.length,"Base"),b==10)return X=new C(h),w(X,a+X.e+1,c);if(z=String(h),L=typeof h=="number"){if(h*0!=0)return i(X,z,L,b);if(X.s=1/h<0?(z=z.slice(1),-1):1,C.DEBUG&&z.replace(/^0\.0*|\./,"").length>15)throw Error(op+h)}else X.s=z.charCodeAt(0)===45?(z=z.slice(1),-1):1;for(A=S.slice(0,b),N=B=0,F=z.length;B<F;B++)if(A.indexOf(y=z.charAt(B))<0){if(y=="."){if(B>N){N=F;continue}}else if(!P&&(z==z.toUpperCase()&&(z=z.toLowerCase())||z==z.toLowerCase()&&(z=z.toUpperCase()))){P=!0,B=-1,N=0;continue}return i(X,String(h),L,b)}L=!1,z=r(z,b,10,X.s),(N=z.indexOf("."))>-1?z=z.replace(".",""):N=z.length}for(B=0;z.charCodeAt(B)===48;B++);for(F=z.length;z.charCodeAt(--F)===48;);if(z=z.slice(B,++F)){if(F-=B,L&&C.DEBUG&&F>15&&(h>hl||h!==xi(h)))throw Error(op+X.s*h);if((N=N-B-1)>u)X.c=X.e=null;else if(N<l)X.c=[X.e=0];else{if(X.e=N,X.c=[],B=(N+1)%Pe,N<0&&(B+=Pe),B<F){for(B&&X.c.push(+z.slice(0,B)),F-=Pe;B<F;)X.c.push(+z.slice(B,B+=Pe));B=Pe-(z=z.slice(B)).length}else B-=F;for(;B--;z+="0");X.c.push(+z)}}else X.c=[X.e=0]}C.clone=cp,C.ROUND_UP=0,C.ROUND_DOWN=1,C.ROUND_CEIL=2,C.ROUND_FLOOR=3,C.ROUND_HALF_UP=4,C.ROUND_HALF_DOWN=5,C.ROUND_HALF_EVEN=6,C.ROUND_HALF_CEIL=7,C.ROUND_HALF_FLOOR=8,C.EUCLID=9,C.config=C.set=function(h){var b,A;if(h!=null)if(typeof h=="object"){if(h.hasOwnProperty(b="DECIMAL_PLACES")&&(A=h[b],Tt(A,0,Wt,b),a=A),h.hasOwnProperty(b="ROUNDING_MODE")&&(A=h[b],Tt(A,0,8,b),c=A),h.hasOwnProperty(b="EXPONENTIAL_AT")&&(A=h[b],A&&A.pop?(Tt(A[0],-Wt,0,b),Tt(A[1],0,Wt,b),o=A[0],d=A[1]):(Tt(A,-Wt,Wt,b),o=-(d=A<0?-A:A))),h.hasOwnProperty(b="RANGE"))if(A=h[b],A&&A.pop)Tt(A[0],-Wt,-1,b),Tt(A[1],1,Wt,b),l=A[0],u=A[1];else if(Tt(A,-Wt,Wt,b),A)l=-(u=A<0?-A:A);else throw Error(Pr+b+" cannot be zero: "+A);if(h.hasOwnProperty(b="CRYPTO"))if(A=h[b],A===!!A)if(A)if(typeof crypto!="undefined"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))p=A;else throw p=!A,Error(Pr+"crypto unavailable");else p=A;else throw Error(Pr+b+" not true or false: "+A);if(h.hasOwnProperty(b="MODULO_MODE")&&(A=h[b],Tt(A,0,9,b),f=A),h.hasOwnProperty(b="POW_PRECISION")&&(A=h[b],Tt(A,0,Wt,b),g=A),h.hasOwnProperty(b="FORMAT"))if(A=h[b],typeof A=="object")v=A;else throw Error(Pr+b+" not an object: "+A);if(h.hasOwnProperty(b="ALPHABET"))if(A=h[b],typeof A=="string"&&!/^.$|[+-.\s]|(.).*\1/.test(A))S=A;else throw Error(Pr+b+" invalid: "+A)}else throw Error(Pr+"Object expected: "+h);return{DECIMAL_PLACES:a,ROUNDING_MODE:c,EXPONENTIAL_AT:[o,d],RANGE:[l,u],CRYPTO:p,MODULO_MODE:f,POW_PRECISION:g,FORMAT:v,ALPHABET:S}},C.isBigNumber=function(h){if(!h||h._isBigNumber!==!0)return!1;if(!C.DEBUG)return!0;var b,A,y=h.c,P=h.e,N=h.s;e:if({}.toString.call(y)=="[object Array]"){if((N===1||N===-1)&&P>=-Wt&&P<=Wt&&P===xi(P)){if(y[0]===0){if(P===0&&y.length===1)return!0;break e}if(b=(P+1)%Pe,b<1&&(b+=Pe),String(y[0]).length==b){for(b=0;b<y.length;b++)if(A=y[b],A<0||A>=pi||A!==xi(A))break e;if(A!==0)return!0}}}else if(y===null&&P===null&&(N===null||N===1||N===-1))return!0;throw Error(Pr+"Invalid BigNumber: "+h)},C.maximum=C.max=function(){return j(arguments,n.lt)},C.minimum=C.min=function(){return j(arguments,n.gt)},C.random=function(){var h=9007199254740992,b=Math.random()*h&2097151?function(){return xi(Math.random()*h)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(A){var y,P,N,B,L,F=0,z=[],X=new C(s);if(A==null?A=a:Tt(A,0,Wt),B=fl(A/Pe),p)if(crypto.getRandomValues){for(y=crypto.getRandomValues(new Uint32Array(B*=2));F<B;)L=y[F]*131072+(y[F+1]>>>11),L>=9e15?(P=crypto.getRandomValues(new Uint32Array(2)),y[F]=P[0],y[F+1]=P[1]):(z.push(L%1e14),F+=2);F=B/2}else if(crypto.randomBytes){for(y=crypto.randomBytes(B*=7);F<B;)L=(y[F]&31)*281474976710656+y[F+1]*1099511627776+y[F+2]*4294967296+y[F+3]*16777216+(y[F+4]<<16)+(y[F+5]<<8)+y[F+6],L>=9e15?crypto.randomBytes(7).copy(y,F):(z.push(L%1e14),F+=7);F=B/7}else throw p=!1,Error(Pr+"crypto unavailable");if(!p)for(;F<B;)L=b(),L<9e15&&(z[F++]=L%1e14);for(B=z[--F],A%=Pe,B&&A&&(L=pl[Pe-A],z[F]=xi(B/L)*L);z[F]===0;z.pop(),F--);if(F<0)z=[N=0];else{for(N=-1;z[0]===0;z.splice(0,1),N-=Pe);for(F=1,L=z[0];L>=10;L/=10,F++);F<Pe&&(N-=Pe-F)}return X.e=N,X.c=z,X}}(),C.sum=function(){for(var h=1,b=arguments,A=new C(b[0]);h<b.length;)A=A.plus(b[h++]);return A},r=function(){var h="0123456789";function b(A,y,P,N){for(var B,L=[0],F,z=0,X=A.length;z<X;){for(F=L.length;F--;L[F]*=y);for(L[0]+=N.indexOf(A.charAt(z++)),B=0;B<L.length;B++)L[B]>P-1&&(L[B+1]==null&&(L[B+1]=0),L[B+1]+=L[B]/P|0,L[B]%=P)}return L.reverse()}return function(A,y,P,N,B){var L,F,z,X,Z,re,ue,ge,ye=A.indexOf("."),ve=a,ce=c;for(ye>=0&&(X=g,g=0,A=A.replace(".",""),ge=new C(y),re=ge.pow(A.length-ye),g=X,ge.c=b(an(Qr(re.c),re.e,"0"),10,P,h),ge.e=ge.c.length),ue=b(A,y,P,B?(L=S,h):(L=h,S)),z=X=ue.length;ue[--X]==0;ue.pop());if(!ue[0])return L.charAt(0);if(ye<0?--z:(re.c=ue,re.e=z,re.s=N,re=t(re,ge,ve,ce,P),ue=re.c,Z=re.r,z=re.e),F=z+ve+1,ye=ue[F],X=P/2,Z=Z||F<0||ue[F+1]!=null,Z=ce<4?(ye!=null||Z)&&(ce==0||ce==(re.s<0?3:2)):ye>X||ye==X&&(ce==4||Z||ce==6&&ue[F-1]&1||ce==(re.s<0?8:7)),F<1||!ue[0])A=Z?an(L.charAt(1),-ve,L.charAt(0)):L.charAt(0);else{if(ue.length=F,Z)for(--P;++ue[--F]>P;)ue[F]=0,F||(++z,ue=[1].concat(ue));for(X=ue.length;!ue[--X];);for(ye=0,A="";ye<=X;A+=L.charAt(ue[ye++]));A=an(A,z,L.charAt(0))}return A}}(),t=function(){function h(y,P,N){var B,L,F,z,X=0,Z=y.length,re=P%Ln,ue=P/Ln|0;for(y=y.slice();Z--;)F=y[Z]%Ln,z=y[Z]/Ln|0,B=ue*F+z*re,L=re*F+B%Ln*Ln+X,X=(L/N|0)+(B/Ln|0)+ue*z,y[Z]=L%N;return X&&(y=[X].concat(y)),y}function b(y,P,N,B){var L,F;if(N!=B)F=N>B?1:-1;else for(L=F=0;L<N;L++)if(y[L]!=P[L]){F=y[L]>P[L]?1:-1;break}return F}function A(y,P,N,B){for(var L=0;N--;)y[N]-=L,L=y[N]<P[N]?1:0,y[N]=L*B+y[N]-P[N];for(;!y[0]&&y.length>1;y.splice(0,1));}return function(y,P,N,B,L){var F,z,X,Z,re,ue,ge,ye,ve,ce,we,nt,Ge,ze,jt,Oe,$e,Mt=y.s==P.s?1:-1,Ne=y.c,de=P.c;if(!Ne||!Ne[0]||!de||!de[0])return new C(!y.s||!P.s||(Ne?de&&Ne[0]==de[0]:!de)?NaN:Ne&&Ne[0]==0||!de?Mt*0:Mt/0);for(ye=new C(Mt),ve=ye.c=[],z=y.e-P.e,Mt=N+z+1,L||(L=pi,z=Jr(y.e/Pe)-Jr(P.e/Pe),Mt=Mt/Pe|0),X=0;de[X]==(Ne[X]||0);X++);if(de[X]>(Ne[X]||0)&&z--,Mt<0)ve.push(1),Z=!0;else{for(ze=Ne.length,Oe=de.length,X=0,Mt+=2,re=xi(L/(de[0]+1)),re>1&&(de=h(de,re,L),Ne=h(Ne,re,L),Oe=de.length,ze=Ne.length),Ge=Oe,ce=Ne.slice(0,Oe),we=ce.length;we<Oe;ce[we++]=0);$e=de.slice(),$e=[0].concat($e),jt=de[0],de[1]>=L/2&&jt++;do{if(re=0,F=b(de,ce,Oe,we),F<0){if(nt=ce[0],Oe!=we&&(nt=nt*L+(ce[1]||0)),re=xi(nt/jt),re>1)for(re>=L&&(re=L-1),ue=h(de,re,L),ge=ue.length,we=ce.length;b(ue,ce,ge,we)==1;)re--,A(ue,Oe<ge?$e:de,ge,L),ge=ue.length,F=1;else re==0&&(F=re=1),ue=de.slice(),ge=ue.length;if(ge<we&&(ue=[0].concat(ue)),A(ce,ue,we,L),we=ce.length,F==-1)for(;b(de,ce,Oe,we)<1;)re++,A(ce,Oe<we?$e:de,we,L),we=ce.length}else F===0&&(re++,ce=[0]);ve[X++]=re,ce[0]?ce[we++]=Ne[Ge]||0:(ce=[Ne[Ge]],we=1)}while((Ge++<ze||ce[0]!=null)&&Mt--);Z=ce[0]!=null,ve[0]||ve.splice(0,1)}if(L==pi){for(X=1,Mt=ve[0];Mt>=10;Mt/=10,X++);w(ye,N+(ye.e=X+z*Pe-1)+1,B,Z)}else ye.e=z,ye.r=+Z;return ye}}();function D(h,b,A,y){var P,N,B,L,F;if(A==null?A=c:Tt(A,0,8),!h.c)return h.toString();if(P=h.c[0],B=h.e,b==null)F=Qr(h.c),F=y==1||y==2&&(B<=o||B>=d)?Sc(F,B):an(F,B,"0");else if(h=w(new C(h),b,A),N=h.e,F=Qr(h.c),L=F.length,y==1||y==2&&(b<=N||N<=o)){for(;L<b;F+="0",L++);F=Sc(F,N)}else if(b-=B,F=an(F,N,"0"),N+1>L){if(--b>0)for(F+=".";b--;F+="0");}else if(b+=N-L,b>0)for(N+1==L&&(F+=".");b--;F+="0");return h.s<0&&P?"-"+F:F}function j(h,b){for(var A,y=1,P=new C(h[0]);y<h.length;y++)if(A=new C(h[y]),A.s)b.call(P,A)&&(P=A);else{P=A;break}return P}function m(h,b,A){for(var y=1,P=b.length;!b[--P];b.pop());for(P=b[0];P>=10;P/=10,y++);return(A=y+A*Pe-1)>u?h.c=h.e=null:A<l?h.c=[h.e=0]:(h.e=A,h.c=b),h}i=function(){var h=/^(-?)0([xbo])(?=\w[\w.]*$)/i,b=/^([^.]+)\.$/,A=/^\.([^.]+)$/,y=/^-?(Infinity|NaN)$/,P=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(N,B,L,F){var z,X=L?B:B.replace(P,"");if(y.test(X))N.s=isNaN(X)?null:X<0?-1:1;else{if(!L&&(X=X.replace(h,function(Z,re,ue){return z=(ue=ue.toLowerCase())=="x"?16:ue=="b"?2:8,!F||F==z?re:Z}),F&&(z=F,X=X.replace(b,"$1").replace(A,"0.$1")),B!=X))return new C(X,z);if(C.DEBUG)throw Error(Pr+"Not a"+(F?" base "+F:"")+" number: "+B);N.s=null}N.c=N.e=null}}();function w(h,b,A,y){var P,N,B,L,F,z,X,Z=h.c,re=pl;if(Z){e:{for(P=1,L=Z[0];L>=10;L/=10,P++);if(N=b-P,N<0)N+=Pe,B=b,F=Z[z=0],X=F/re[P-B-1]%10|0;else if(z=fl((N+1)/Pe),z>=Z.length)if(y){for(;Z.length<=z;Z.push(0));F=X=0,P=1,N%=Pe,B=N-Pe+1}else break e;else{for(F=L=Z[z],P=1;L>=10;L/=10,P++);N%=Pe,B=N-Pe+P,X=B<0?0:F/re[P-B-1]%10|0}if(y=y||b<0||Z[z+1]!=null||(B<0?F:F%re[P-B-1]),y=A<4?(X||y)&&(A==0||A==(h.s<0?3:2)):X>5||X==5&&(A==4||y||A==6&&(N>0?B>0?F/re[P-B]:0:Z[z-1])%10&1||A==(h.s<0?8:7)),b<1||!Z[0])return Z.length=0,y?(b-=h.e+1,Z[0]=re[(Pe-b%Pe)%Pe],h.e=-b||0):Z[0]=h.e=0,h;if(N==0?(Z.length=z,L=1,z--):(Z.length=z+1,L=re[Pe-N],Z[z]=B>0?xi(F/re[P-B]%re[B])*L:0),y)for(;;)if(z==0){for(N=1,B=Z[0];B>=10;B/=10,N++);for(B=Z[0]+=L,L=1;B>=10;B/=10,L++);N!=L&&(h.e++,Z[0]==pi&&(Z[0]=1));break}else{if(Z[z]+=L,Z[z]!=pi)break;Z[z--]=0,L=1}for(N=Z.length;Z[--N]===0;Z.pop());}h.e>u?h.c=h.e=null:h.e<l&&(h.c=[h.e=0])}return h}function R(h){var b,A=h.e;return A===null?h.toString():(b=Qr(h.c),b=A<=o||A>=d?Sc(b,A):an(b,A,"0"),h.s<0?"-"+b:b)}return n.absoluteValue=n.abs=function(){var h=new C(this);return h.s<0&&(h.s=1),h},n.comparedTo=function(h,b){return Ws(this,new C(h,b))},n.decimalPlaces=n.dp=function(h,b){var A,y,P,N=this;if(h!=null)return Tt(h,0,Wt),b==null?b=c:Tt(b,0,8),w(new C(N),h+N.e+1,b);if(!(A=N.c))return null;if(y=((P=A.length-1)-Jr(this.e/Pe))*Pe,P=A[P])for(;P%10==0;P/=10,y--);return y<0&&(y=0),y},n.dividedBy=n.div=function(h,b){return t(this,new C(h,b),a,c)},n.dividedToIntegerBy=n.idiv=function(h,b){return t(this,new C(h,b),0,1)},n.exponentiatedBy=n.pow=function(h,b){var A,y,P,N,B,L,F,z,X,Z=this;if(h=new C(h),h.c&&!h.isInteger())throw Error(Pr+"Exponent not an integer: "+R(h));if(b!=null&&(b=new C(b)),L=h.e>14,!Z.c||!Z.c[0]||Z.c[0]==1&&!Z.e&&Z.c.length==1||!h.c||!h.c[0])return X=new C(Math.pow(+R(Z),L?2-wc(h):+R(h))),b?X.mod(b):X;if(F=h.s<0,b){if(b.c?!b.c[0]:!b.s)return new C(NaN);y=!F&&Z.isInteger()&&b.isInteger(),y&&(Z=Z.mod(b))}else{if(h.e>9&&(Z.e>0||Z.e<-1||(Z.e==0?Z.c[0]>1||L&&Z.c[1]>=24e7:Z.c[0]<8e13||L&&Z.c[0]<=9999975e7)))return N=(Z.s<0&&wc(h),-0),Z.e>-1&&(N=1/N),new C(F?1/N:N);g&&(N=fl(g/Pe+2))}for(L?(A=new C(.5),F&&(h.s=1),z=wc(h)):(P=Math.abs(+R(h)),z=P%2),X=new C(s);;){if(z){if(X=X.times(Z),!X.c)break;N?X.c.length>N&&(X.c.length=N):y&&(X=X.mod(b))}if(P){if(P=xi(P/2),P===0)break;z=P%2}else if(h=h.times(A),w(h,h.e+1,1),h.e>14)z=wc(h);else{if(P=+R(h),P===0)break;z=P%2}Z=Z.times(Z),N?Z.c&&Z.c.length>N&&(Z.c.length=N):y&&(Z=Z.mod(b))}return y?X:(F&&(X=s.div(X)),b?X.mod(b):N?w(X,g,c,B):X)},n.integerValue=function(h){var b=new C(this);return h==null?h=c:Tt(h,0,8),w(b,b.e+1,h)},n.isEqualTo=n.eq=function(h,b){return Ws(this,new C(h,b))===0},n.isFinite=function(){return!!this.c},n.isGreaterThan=n.gt=function(h,b){return Ws(this,new C(h,b))>0},n.isGreaterThanOrEqualTo=n.gte=function(h,b){return(b=Ws(this,new C(h,b)))===1||b===0},n.isInteger=function(){return!!this.c&&Jr(this.e/Pe)>this.c.length-2},n.isLessThan=n.lt=function(h,b){return Ws(this,new C(h,b))<0},n.isLessThanOrEqualTo=n.lte=function(h,b){return(b=Ws(this,new C(h,b)))===-1||b===0},n.isNaN=function(){return!this.s},n.isNegative=function(){return this.s<0},n.isPositive=function(){return this.s>0},n.isZero=function(){return!!this.c&&this.c[0]==0},n.minus=function(h,b){var A,y,P,N,B=this,L=B.s;if(h=new C(h,b),b=h.s,!L||!b)return new C(NaN);if(L!=b)return h.s=-b,B.plus(h);var F=B.e/Pe,z=h.e/Pe,X=B.c,Z=h.c;if(!F||!z){if(!X||!Z)return X?(h.s=-b,h):new C(Z?B:NaN);if(!X[0]||!Z[0])return Z[0]?(h.s=-b,h):new C(X[0]?B:(c==3,-0))}if(F=Jr(F),z=Jr(z),X=X.slice(),L=F-z){for((N=L<0)?(L=-L,P=X):(z=F,P=Z),P.reverse(),b=L;b--;P.push(0));P.reverse()}else for(y=(N=(L=X.length)<(b=Z.length))?L:b,L=b=0;b<y;b++)if(X[b]!=Z[b]){N=X[b]<Z[b];break}if(N&&(P=X,X=Z,Z=P,h.s=-h.s),b=(y=Z.length)-(A=X.length),b>0)for(;b--;X[A++]=0);for(b=pi-1;y>L;){if(X[--y]<Z[y]){for(A=y;A&&!X[--A];X[A]=b);--X[A],X[y]+=pi}X[y]-=Z[y]}for(;X[0]==0;X.splice(0,1),--z);return X[0]?m(h,X,z):(h.s=c==3?-1:1,h.c=[h.e=0],h)},n.modulo=n.mod=function(h,b){var A,y,P=this;return h=new C(h,b),!P.c||!h.s||h.c&&!h.c[0]?new C(NaN):!h.c||P.c&&!P.c[0]?new C(P):(f==9?(y=h.s,h.s=1,A=t(P,h,0,3),h.s=y,A.s*=y):A=t(P,h,0,f),h=P.minus(A.times(h)),!h.c[0]&&f==1&&(h.s=P.s),h)},n.multipliedBy=n.times=function(h,b){var A,y,P,N,B,L,F,z,X,Z,re,ue,ge,ye,ve,ce=this,we=ce.c,nt=(h=new C(h,b)).c;if(!we||!nt||!we[0]||!nt[0])return!ce.s||!h.s||we&&!we[0]&&!nt||nt&&!nt[0]&&!we?h.c=h.e=h.s=null:(h.s*=ce.s,!we||!nt?h.c=h.e=null:(h.c=[0],h.e=0)),h;for(y=Jr(ce.e/Pe)+Jr(h.e/Pe),h.s*=ce.s,F=we.length,Z=nt.length,F<Z&&(ge=we,we=nt,nt=ge,P=F,F=Z,Z=P),P=F+Z,ge=[];P--;ge.push(0));for(ye=pi,ve=Ln,P=Z;--P>=0;){for(A=0,re=nt[P]%ve,ue=nt[P]/ve|0,B=F,N=P+B;N>P;)z=we[--B]%ve,X=we[B]/ve|0,L=ue*z+X*re,z=re*z+L%ve*ve+ge[N]+A,A=(z/ye|0)+(L/ve|0)+ue*X,ge[N--]=z%ye;ge[N]=A}return A?++y:ge.splice(0,1),m(h,ge,y)},n.negated=function(){var h=new C(this);return h.s=-h.s||null,h},n.plus=function(h,b){var A,y=this,P=y.s;if(h=new C(h,b),b=h.s,!P||!b)return new C(NaN);if(P!=b)return h.s=-b,y.minus(h);var N=y.e/Pe,B=h.e/Pe,L=y.c,F=h.c;if(!N||!B){if(!L||!F)return new C(P/0);if(!L[0]||!F[0])return F[0]?h:new C(L[0]?y:P*0)}if(N=Jr(N),B=Jr(B),L=L.slice(),P=N-B){for(P>0?(B=N,A=F):(P=-P,A=L),A.reverse();P--;A.push(0));A.reverse()}for(P=L.length,b=F.length,P-b<0&&(A=F,F=L,L=A,b=P),P=0;b;)P=(L[--b]=L[b]+F[b]+P)/pi|0,L[b]=pi===L[b]?0:L[b]%pi;return P&&(L=[P].concat(L),++B),m(h,L,B)},n.precision=n.sd=function(h,b){var A,y,P,N=this;if(h!=null&&h!==!!h)return Tt(h,1,Wt),b==null?b=c:Tt(b,0,8),w(new C(N),h,b);if(!(A=N.c))return null;if(P=A.length-1,y=P*Pe+1,P=A[P]){for(;P%10==0;P/=10,y--);for(P=A[0];P>=10;P/=10,y++);}return h&&N.e+1>y&&(y=N.e+1),y},n.shiftedBy=function(h){return Tt(h,-hl,hl),this.times("1e"+h)},n.squareRoot=n.sqrt=function(){var h,b,A,y,P,N=this,B=N.c,L=N.s,F=N.e,z=a+4,X=new C("0.5");if(L!==1||!B||!B[0])return new C(!L||L<0&&(!B||B[0])?NaN:B?N:1/0);if(L=Math.sqrt(+R(N)),L==0||L==1/0?(b=Qr(B),(b.length+F)%2==0&&(b+="0"),L=Math.sqrt(+b),F=Jr((F+1)/2)-(F<0||F%2),L==1/0?b="5e"+F:(b=L.toExponential(),b=b.slice(0,b.indexOf("e")+1)+F),A=new C(b)):A=new C(L+""),A.c[0]){for(F=A.e,L=F+z,L<3&&(L=0);;)if(P=A,A=X.times(P.plus(t(N,P,z,1))),Qr(P.c).slice(0,L)===(b=Qr(A.c)).slice(0,L))if(A.e<F&&--L,b=b.slice(L-3,L+1),b=="9999"||!y&&b=="4999"){if(!y&&(w(P,P.e+a+2,0),P.times(P).eq(N))){A=P;break}z+=4,L+=4,y=1}else{(!+b||!+b.slice(1)&&b.charAt(0)=="5")&&(w(A,A.e+a+2,1),h=!A.times(A).eq(N));break}}return w(A,A.e+a+1,c,h)},n.toExponential=function(h,b){return h!=null&&(Tt(h,0,Wt),h++),D(this,h,b,1)},n.toFixed=function(h,b){return h!=null&&(Tt(h,0,Wt),h=h+this.e+1),D(this,h,b)},n.toFormat=function(h,b,A){var y,P=this;if(A==null)h!=null&&b&&typeof b=="object"?(A=b,b=null):h&&typeof h=="object"?(A=h,h=b=null):A=v;else if(typeof A!="object")throw Error(Pr+"Argument not an object: "+A);if(y=P.toFixed(h,b),P.c){var N,B=y.split("."),L=+A.groupSize,F=+A.secondaryGroupSize,z=A.groupSeparator||"",X=B[0],Z=B[1],re=P.s<0,ue=re?X.slice(1):X,ge=ue.length;if(F&&(N=L,L=F,F=N,ge-=N),L>0&&ge>0){for(N=ge%L||L,X=ue.substr(0,N);N<ge;N+=L)X+=z+ue.substr(N,L);F>0&&(X+=z+ue.slice(N)),re&&(X="-"+X)}y=Z?X+(A.decimalSeparator||"")+((F=+A.fractionGroupSize)?Z.replace(new RegExp("\\d{"+F+"}\\B","g"),"$&"+(A.fractionGroupSeparator||"")):Z):X}return(A.prefix||"")+y+(A.suffix||"")},n.toFraction=function(h){var b,A,y,P,N,B,L,F,z,X,Z,re,ue=this,ge=ue.c;if(h!=null&&(L=new C(h),!L.isInteger()&&(L.c||L.s!==1)||L.lt(s)))throw Error(Pr+"Argument "+(L.isInteger()?"out of range: ":"not an integer: ")+R(L));if(!ge)return new C(ue);for(b=new C(s),z=A=new C(s),y=F=new C(s),re=Qr(ge),N=b.e=re.length-ue.e-1,b.c[0]=pl[(B=N%Pe)<0?Pe+B:B],h=!h||L.comparedTo(b)>0?N>0?b:z:L,B=u,u=1/0,L=new C(re),F.c[0]=0;!(X=t(L,b,0,1),P=A.plus(X.times(y)),P.comparedTo(h)==1);)A=y,y=P,z=F.plus(X.times(P=z)),F=P,b=L.minus(X.times(P=b)),L=P;return P=t(h.minus(A),y,0,1),F=F.plus(P.times(z)),A=A.plus(P.times(y)),F.s=z.s=ue.s,N=N*2,Z=t(z,y,N,c).minus(ue).abs().comparedTo(t(F,A,N,c).minus(ue).abs())<1?[z,y]:[F,A],u=B,Z},n.toNumber=function(){return+R(this)},n.toPrecision=function(h,b){return h!=null&&Tt(h,1,Wt),D(this,h,b,2)},n.toString=function(h){var b,A=this,y=A.s,P=A.e;return P===null?y?(b="Infinity",y<0&&(b="-"+b)):b="NaN":(h==null?b=P<=o||P>=d?Sc(Qr(A.c),P):an(Qr(A.c),P,"0"):h===10?(A=w(new C(A),a+P+1,c),b=an(Qr(A.c),A.e,"0")):(Tt(h,2,S.length,"Base"),b=r(an(Qr(A.c),P,"0"),10,h,y,!0)),y<0&&A.c[0]&&(b="-"+b)),b},n.valueOf=n.toJSON=function(){return R(this)},n._isBigNumber=!0,n[Symbol.toStringTag]="BigNumber",n[Symbol.for("nodejs.util.inspect.custom")]=n.valueOf,e!=null&&C.set(e),C}function Jr(e){var t=e|0;return e>0||e===t?t:t-1}function Qr(e){for(var t,r,i=1,n=e.length,s=e[0]+"";i<n;){for(t=e[i++]+"",r=Pe-t.length;r--;t="0"+t);s+=t}for(n=s.length;s.charCodeAt(--n)===48;);return s.slice(0,n+1||1)}function Ws(e,t){var r,i,n=e.c,s=t.c,a=e.s,c=t.s,o=e.e,d=t.e;if(!a||!c)return null;if(r=n&&!n[0],i=s&&!s[0],r||i)return r?i?0:-c:a;if(a!=c)return a;if(r=a<0,i=o==d,!n||!s)return i?0:!n^r?1:-1;if(!i)return o>d^r?1:-1;for(c=(o=n.length)<(d=s.length)?o:d,a=0;a<c;a++)if(n[a]!=s[a])return n[a]>s[a]^r?1:-1;return o==d?0:o>d^r?1:-1}function Tt(e,t,r,i){if(e<t||e>r||e!==xi(e))throw Error(Pr+(i||"Argument")+(typeof e=="number"?e<t||e>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function wc(e){var t=e.c.length-1;return Jr(e.e/Pe)==t&&e.c[t]%2!=0}function Sc(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function an(e,t,r){var i,n;if(t<0){for(n=r+".";++t;n+=r);e=n+e}else if(i=e.length,++t>i){for(n=r,t-=i;--t;n+=r);e+=n}else t<i&&(e=e.slice(0,t)+"."+e.slice(t));return e}var dp=cp(),W2=Object.freeze({__proto__:null,BigNumber:dp,default:dp}),lp=ne(function(e,t){const r=Math.exp;t=e.exports=function(n){if(typeof n!="number")throw new Error("must provide a timespan to the moving average constructor");if(n<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let s,a=0,c=0,o=0,d,l={};function u(p,f){return 1-r(-(p-f)/n)}return l.push=function(f,g){if(d){const v=u(f,d),S=g-s,C=v*S;s=v*g+(1-v)*s,a=(1-v)*(a+S*C),c=Math.sqrt(a),o=s+v*S}else s=g;d=f},l.movingAverage=function(){return s},l.variance=function(){return a},l.deviation=function(){return c},l.forecast=function(){return o},l}}),up=uy(W2);const{EventEmitter:Y2}=_r;class Z2 extends Y2{constructor(e,t){super();this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this);const r=this._options.movingAverageIntervals;for(var i=0;i<e.length;i++){var n=e[i];this._stats[n]=up(0),this._movingAverages[n]={};for(var s=0;s<r.length;s++){var a=r[s],c=this._movingAverages[n][a]=lp(a);c.push(this._frequencyLastTime,0)}}}start(){this._queue.length&&this._resetComputeTimeout()}stop(){this._timeout&&(this._timeout.clear(),this._timeout=null)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}toJSON(){const e=this.snapshot,t=this.movingAverages,r={dataReceived:e.dataReceived.toString(),dataSent:e.dataSent.toString(),movingAverages:{}},i=Object.keys(t);for(const n of i){r.movingAverages[n]={};for(const s of Object.keys(t[n]))r.movingAverages[n][s]=t[n][s].movingAverage()}return r}push(e,t){this._queue.push([e,t,Date.now()]),this._resetComputeTimeout()}_resetComputeTimeout(){this._timeout=us(this._update,this._nextTimeout())}_nextTimeout(){const e=this._queue.length/this._options.computeThrottleMaxQueueSize,t=Math.max(this._options.computeThrottleTimeout*(1-e),0);return t}_update(){if(this._timeout=null,this._queue.length){let e;for(e of this._queue)this._applyOp(e);this._queue=[],this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){const t=e-this._frequencyLastTime;Object.keys(this._stats).forEach(r=>{this._updateFrequencyFor(r,t,e)}),this._frequencyLastTime=e}_updateFrequencyFor(e,t,r){const i=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;const n=t||1,s=i/n*1e3;let a=this._movingAverages[e];a||(a=this._movingAverages[e]={});const c=this._options.movingAverageIntervals;for(var o=0;o<c.length;o++){var d=c[o],l=a[d];l||(l=a[d]=lp(d)),l.push(r,s)}}_applyOp(e){const t=e[0],r=e[1];if(typeof r!="number")throw new Error(`invalid increment number: ${r}`);let i;Object.prototype.hasOwnProperty.call(this._stats,t)?i=this._stats[t]:i=this._stats[t]=up(0),this._stats[t]=i.plus(r),this._frequencyAccumulators[t]||(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=r}}var ml=Z2;const{pipe:J2}=Yr,{tap:fp}=xd,{METRICS:Q2}=eo,gl=["dataReceived","dataSent"],eS={in:"dataReceived",out:"dataSent"};class hp{constructor(e){this._options=rc(Q2,e),this._globalStats=new ml(gl,this._options),this._peerStats=new Map,this._protocolStats=new Map,this._oldPeers=X2(this._options.maxOldPeersRetention),this._running=!1,this._onMessage=this._onMessage.bind(this),this._connectionManager=e.connectionManager,this._connectionManager.on("peer:disconnect",t=>{this.onPeerDisconnected(t.remotePeer)})}start(){this._running=!0}stop(){this._running=!1,this._globalStats.stop();for(const e of this._peerStats.values())e.stop();for(const e of this._protocolStats.values())e.stop()}get global(){return this._globalStats}get peers(){return Array.from(this._peerStats.keys())}forPeer(e){const t=e.toB58String();return this._peerStats.get(t)||this._oldPeers.get(t)}get protocols(){return Array.from(this._protocolStats.keys())}forProtocol(e){return this._protocolStats.get(e)}onPeerDisconnected(e){const t=e.toB58String(),r=this._peerStats.get(t);r&&(r.stop(),this._peerStats.delete(t),this._oldPeers.set(t,r))}_onMessage({remotePeer:e,protocol:t,direction:r,dataLength:i}){if(!this._running)return;const n=eS[r];let s=this.forPeer(e);if(s||(s=new ml(gl,this._options),this._peerStats.set(e.toB58String(),s)),s.push(n,i),this._globalStats.push(n,i),t){let a=this.forProtocol(t);a||(a=new ml(gl,this._options),this._protocolStats.set(t,a)),a.push(n,i)}}updatePlaceholder(e,t){if(!this._running)return;const r=this.forPeer(e),i=t.toB58String(),n=this.forPeer(t);let s=r;n&&(s=hp.mergeStats(n,s),this._oldPeers.delete(i)),this._peerStats.delete(e.toB58String()),this._peerStats.set(i,s),s.start()}trackStream({stream:e,remotePeer:t,protocol:r}){const i=this,n=e.source;e.source=fp(a=>i._onMessage({remotePeer:t,protocol:r,direction:"in",dataLength:a.length}))(n);const s=e.sink;return e.sink=a=>J2(a,fp(c=>i._onMessage({remotePeer:t,protocol:r,direction:"out",dataLength:c.length})),s),e}static mergeStats(e,t){return e.stop(),t.stop(),e._queue=[...e._queue,...t._queue],e}}var tS=hp,Nr=ne(function(e,t){const r=St(`
`);async function i(n){for await(const s of n)return s}t.encode=n=>lr.encode.single(new Ar([n,r])),t.write=(n,s)=>n.push(t.encode(s)),t.writeAll=(n,s)=>{n.push(s.reduce((a,c)=>a.append(t.encode(c)),new Ar))},t.read=async n=>{let s=1;const a={[Symbol.asyncIterator](){return this},next:()=>n.next(s)},c=d=>{s=d},o=await Yr(a,lr.decode({onLength:c}),i);if(o.get(o.length-1)!==r[0])throw G(new Error("missing newline"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return o.shallowSlice(0,-1)}});const Ys=le("mss:select");var pp=async(e,t,r)=>{t=Array.isArray(t)?[...t]:[t];const{reader:i,writer:n,rest:s,stream:a}=oo(e),c=t.shift();r?(Ys('select: write ["%s", "%s"]',r,c),Nr.writeAll(n,[r,c])):(Ys('select: write "%s"',c),Nr.write(n,c));let o=(await Nr.read(i)).toString();if(Ys('select: read "%s"',o),o===r&&(o=(await Nr.read(i)).toString(),Ys('select: read "%s"',o)),o===c)return s(),{stream:a,protocol:c};for(const d of t){Ys('select: write "%s"',d),Nr.write(n,d);const l=(await Nr.read(i)).toString();if(Ys('select: read "%s" for "%s"',l,d),l===d)return s(),{stream:a,protocol:d}}throw s(),G(new Error("protocol selection failed"),"ERR_UNSUPPORTED_PROTOCOL")},rS="/multistream/1.0.0",mp={PROTOCOL_ID:rS};const uo=le("mss:handle"),{PROTOCOL_ID:bl}=mp;var iS=async(e,t)=>{t=Array.isArray(t)?t:[t];const{writer:r,reader:i,rest:n,stream:s}=oo(e);for(;;){const a=(await Nr.read(i)).toString();if(uo('read "%s"',a),a===bl){uo('respond with "%s" for "%s"',bl,a),Nr.write(r,bl);continue}if(t.includes(a))return Nr.write(r,a),uo('respond with "%s" for "%s"',a,a),n(),{stream:s,protocol:a};if(a==="ls"){Nr.write(r,new Ar(t.map(c=>Nr.encode(c)))),uo('respond with "%s" for %s',t,a);continue}Nr.write(r,"na"),uo('respond with "na" for "%s"',a)}};const nS=le("it-multistream-select:ls");var sS=async e=>{const{reader:t,writer:r,rest:i,stream:n}=oo(e);nS('write "ls"'),Nr.write(r,"ls"),i();const s=await Nr.read(t),a=Gh([s]),c=[];return await Yr(a,lr.decode(),async o=>{for await(const d of o)c.push(d.shallowSlice(0,-1).toString())}),{stream:n,protocols:c}};const{PROTOCOL_ID:yl}=mp;var aS=yl;class gp{constructor(e){this._stream=e,this._shaken=!1}async _handshake(){if(this._shaken)return;const{stream:e}=await pp(this._stream,yl);this._stream=e,this._shaken=!0}}class oS extends gp{select(e){return pp(this._stream,e,this._shaken?null:yl)}async ls(){await this._handshake();const{stream:e,protocols:t}=await sS(this._stream);return this._stream=e,t}}var cS=oS;class dS extends gp{handle(e){return iS(this._stream,e)}}var lS=dS,Zs={PROTOCOL_ID:aS,Dialer:cS,Listener:lS};const uS=qr,vl=qr.v4,bp=qr.v6,yp=function(e,t,r){r=~~r;var i;if(vl(e))i=t||new Uint8Array(r+4),e.split(/\./g).map(function(l){i[r++]=parseInt(l,10)&255});else if(bp(e)){var n=e.split(":",8),s;for(s=0;s<n.length;s++){var a=vl(n[s]),c;a&&(c=yp(n[s]),n[s]=Ae(c.slice(0,2),"base16")),c&&++s<8&&n.splice(s,0,Ae(c.slice(2,4),"base16"))}if(n[0]==="")for(;n.length<8;)n.unshift("0");else if(n[n.length-1]==="")for(;n.length<8;)n.push("0");else if(n.length<8){for(s=0;s<n.length&&n[s]!=="";s++);var o=[s,"1"];for(s=9-n.length;s>0;s--)o.push("0");n.splice.apply(n,o)}for(i=t||new Uint8Array(r+16),s=0;s<n.length;s++){var d=parseInt(n[s],16);i[r++]=d>>8&255,i[r++]=d&255}}if(!i)throw Error("Invalid ip address: "+e);return i},fS=function(e,t,r){t=~~t,r=r||e.length-t;var i=[],n;const s=new DataView(e.buffer);if(r===4){for(let a=0;a<r;a++)i.push(e[t+a]);n=i.join(".")}else if(r===16){for(let a=0;a<r;a+=2)i.push(s.getUint16(t+a).toString(16));n=i.join(":"),n=n.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),n=n.replace(/:{3,4}/,"::")}return n};var _c={isIP:uS,isV4:vl,isV6:bp,toBytes:yp,toString:fS};function xr(e){if(typeof e=="number"){if(xr.codes[e])return xr.codes[e];throw new Error("no protocol with code: "+e)}else if(typeof e=="string"||e instanceof String){if(xr.names[e])return xr.names[e];throw new Error("no protocol with name: "+e)}throw new Error("invalid protocol id type: "+e)}const ei=-1;xr.lengthPrefixedVarSize=ei,xr.V=ei,xr.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,ei,"ip6zone"],[53,ei,"dns","resolvable"],[54,ei,"dns4","resolvable"],[55,ei,"dns6","resolvable"],[56,ei,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,ei,"unix",!1,"path"],[421,ei,"ipfs"],[421,ei,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,ei,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,ei,"memory"]],xr.names={},xr.codes={},xr.table.map(e=>{const t=vp.apply(null,e);xr.codes[t.code]=t,xr.names[t.name]=t}),xr.object=vp;function vp(e,t,r,i,n){return{code:e,size:t,name:r,resolvable:Boolean(i),path:Boolean(n)}}var Oi=xr,wp=fo;function fo(e,t){return t instanceof Uint8Array?fo.toString(e,t):fo.toBytes(e,t)}fo.toString=function(t,r){t=Oi(t);switch(t.code){case 4:case 41:return hS(r);case 6:case 273:case 33:case 132:return _p(r);case 53:case 54:case 55:case 56:case 400:case 777:return mS(r);case 421:return bS(r);case 444:return Ep(r);case 445:return Ep(r);default:return Ae(r,"base16")}},fo.toBytes=function(t,r){t=Oi(t);switch(t.code){case 4:return Sp(r);case 41:return Sp(r);case 6:case 273:case 33:case 132:return wl(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return pS(r);case 421:return gS(r);case 444:return yS(r);case 445:return vS(r);default:return St(r,"base16")}};function Sp(e){if(!_c.isIP(e))throw new Error("invalid ip address");return _c.toBytes(e)}function hS(e){const t=_c.toString(e);if(!t||!_c.isIP(t))throw new Error("invalid ip address");return t}function wl(e){const t=new ArrayBuffer(2),r=new DataView(t);return r.setUint16(0,e),new Uint8Array(t)}function _p(e){const t=new DataView(e.buffer);return t.getUint16(0)}function pS(e){const t=St(e),r=Uint8Array.from(be.encode(t.length));return mt([r,t],r.length+t.length)}function mS(e){const t=be.decode(e);if(e=e.slice(be.decode.bytes),e.length!==t)throw new Error("inconsistent lengths");return Ae(e)}function gS(e){const t=new en(e).multihash,r=Uint8Array.from(be.encode(t.length));return mt([r,t],r.length+t.length)}function bS(e){const t=be.decode(e),r=e.slice(be.decode.bytes);if(r.length!==t)throw new Error("inconsistent lengths");return Ae(r,"base58btc")}function yS(e){const t=e.split(":");if(t.length!==2)throw new Error("failed to parse onion addr: "+t+" does not contain a port number");if(t[0].length!==16)throw new Error("failed to parse onion addr: "+t[0]+" not a Tor onion address.");const r=kn.decode("b"+t[0]),i=parseInt(t[1],10);if(i<1||i>65536)throw new Error("Port number is not in range(1, 65536)");const n=wl(i);return mt([r,n],r.length+n.length)}function vS(e){const t=e.split(":");if(t.length!==2)throw new Error("failed to parse onion addr: "+t+" does not contain a port number");if(t[0].length!==56)throw new Error("failed to parse onion addr: "+t[0]+" not a Tor onion3 address.");const r=kn.decode("b"+t[0]),i=parseInt(t[1],10);if(i<1||i>65536)throw new Error("Port number is not in range(1, 65536)");const n=wl(i);return mt([r,n],r.length+n.length)}function Ep(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2),i=Ae(t,"base32"),n=_p(r);return i+":"+n}var mi={stringToStringTuples:Ap,stringTuplesToString:Ip,tuplesToStringTuples:Cp,stringTuplesToTuples:Tp,bytesToTuples:Sl,tuplesToBytes:Rp,bytesToString:wS,stringToBytes:kp,fromString:SS,fromBytes:Pp,validateBytes:_l,isValidBytes:_S,cleanPath:Ec,ParseError:El,protoFromTuple:ho,sizeForAddr:Mp};function Ap(e){const t=[],r=e.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let i=0;i<r.length;i++){const n=r[i],s=Oi(n);if(s.size===0){t.push([n]);continue}if(i++,i>=r.length)throw El("invalid address: "+e);if(s.path){t.push([n,Ec(r.slice(i).join("/"))]);break}t.push([n,r[i]])}return t}function Ip(e){const t=[];return e.map(r=>{const i=ho(r);t.push(i.name),r.length>1&&t.push(r[1])}),Ec(t.join("/"))}function Tp(e){return e.map(t=>{Array.isArray(t)||(t=[t]);const r=ho(t);return t.length>1?[r.code,wp.toBytes(r.code,t[1])]:[r.code]})}function Cp(e){return e.map(t=>{const r=ho(t);return t.length>1?[r.code,wp.toString(r.code,t[1])]:[r.code]})}function Rp(e){return Pp(mt(e.map(t=>{const r=ho(t);let i=Uint8Array.from(be.encode(r.code));return t.length>1&&(i=mt([i,t[1]])),i})))}function Mp(e,t){if(e.size>0)return e.size/8;if(e.size===0)return 0;{const r=be.decode(t);return r+be.decode.bytes}}function Sl(e){const t=[];let r=0;for(;r<e.length;){const i=be.decode(e,r),n=be.decode.bytes,s=Oi(i),a=Mp(s,e.slice(r+n));if(a===0){t.push([i]),r+=n;continue}const c=e.slice(r+n,r+n+a);if(r+=a+n,r>e.length)throw El("Invalid address Uint8Array: "+Ae(e,"base16"));t.push([i,c])}return t}function wS(e){const t=Sl(e),r=Cp(t);return Ip(r)}function kp(e){e=Ec(e);const t=Ap(e),r=Tp(t);return Rp(r)}function SS(e){return kp(e)}function Pp(e){const t=_l(e);if(t)throw t;return Uint8Array.from(e)}function _l(e){try{Sl(e)}catch(t){return t}}function _S(e){return _l(e)===void 0}function Ec(e){return"/"+e.trim().split("/").filter(t=>t).join("/")}function El(e){return new Error("Error parsing address: "+e)}function ho(e){const t=Oi(e[0]);return t}var ES=ne(function(e,t){const r=Symbol.for("nodejs.util.inspect.custom"),i=rn.proto(function(n){if(!(this instanceof i))return new i(n);if(n==null&&(n=""),n instanceof Uint8Array)this.bytes=mi.fromBytes(n);else if(typeof n=="string"||n instanceof String){if(n.length>0&&n.charAt(0)!=="/")throw new Error(`multiaddr "${n}" must start with a "/"`);this.bytes=mi.fromString(n)}else if(n.bytes&&n.protos&&n.protoCodes)this.bytes=mi.fromBytes(n.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});i.prototype.toString=function(){return mi.bytesToString(this.bytes)},i.prototype.toJSON=i.prototype.toString,i.prototype.toOptions=function(){const s={},a=this.toString().split("/");return s.family=a[1]==="ip4"?"ipv4":"ipv6",s.host=a[2],s.transport=a[3],s.port=parseInt(a[4]),s},i.prototype[r]=function(){return"<Multiaddr "+Ae(this.bytes,"base16")+" - "+mi.bytesToString(this.bytes)+">"},i.prototype.inspect=function(){return"<Multiaddr "+Ae(this.bytes,"base16")+" - "+mi.bytesToString(this.bytes)+">"},i.prototype.protos=function(){return this.protoCodes().map(s=>Object.assign({},Oi(s)))},i.prototype.protoCodes=function(){const s=[],a=this.bytes;let c=0;for(;c<a.length;){const o=be.decode(a,c),d=be.decode.bytes,l=Oi(o),u=mi.sizeForAddr(l,a.slice(c+d));c+=u+d,s.push(o)}return s},i.prototype.protoNames=function(){return this.protos().map(s=>s.name)},i.prototype.tuples=function(){return mi.bytesToTuples(this.bytes)},i.prototype.stringTuples=function(){const s=mi.bytesToTuples(this.bytes);return mi.tuplesToStringTuples(s)},i.prototype.encapsulate=function(s){return s=i(s),i(this.toString()+s.toString())},i.prototype.decapsulate=function(s){s=s.toString();const a=this.toString(),c=a.lastIndexOf(s);if(c<0)throw new Error("Address "+this+" does not contain subaddress: "+s);return i(a.slice(0,c))},i.prototype.decapsulateCode=function(s){const a=this.tuples();for(let c=a.length-1;c>=0;c--)if(a[c][0]===s)return i(mi.tuplesToBytes(a.slice(0,c)));return this},i.prototype.getPeerId=function(){let s=null;try{const a=this.stringTuples().filter(c=>{if(c[0]===Oi.names.ipfs.code)return!0});s=a.pop()[1],s=Ae(new en(s).multihash,"base58btc")}catch(a){s=null}return s},i.prototype.getPath=function(){let s=null;try{s=this.stringTuples().filter(a=>{const c=Oi(a[0]);if(c.path)return!0})[0][1]}catch(a){s=null}return s},i.prototype.equals=function(s){return li(this.bytes,s.bytes)},i.prototype.nodeAddress=function(){const s=this.protoCodes(),a=this.protoNames(),c=this.toString().split("/").slice(1);if(c.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(s[0]!==4&&s[0]!==41&&s[0]!==54&&s[0]!==55)throw new Error(`no protocol with name: "'${a[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(c[2]!=="tcp"&&c[2]!=="udp")throw new Error(`no protocol with name: "'${a[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:s[0]===41||s[0]===55?6:4,address:c[1],port:parseInt(c[3])}},i.fromNodeAddress=function(s,a){if(!s)throw new Error("requires node address object");if(!a)throw new Error("requires transport protocol");let c;switch(s.family){case"IPv4":c="ip4";break;case"IPv6":c="ip6";break;default:throw Error(`Invalid addr family. Got '${s.family}' instead of 'IPv4' or 'IPv6'`)}return i("/"+[c,s.address,a,s.port].join("/"))},i.prototype.isThinWaistAddress=function(s){const a=(s||this).protos();return a.length!==2||a[0].code!==4&&a[0].code!==41?!1:!(a[1].code!==6&&a[1].code!==273)},i.protocols=Oi,i.isName=function(s){return i.isMultiaddr(s)?s.protos().some(a=>a.resolvable):!1},i.resolve=function(s){return!i.isMultiaddr(s)||!i.isName(s)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},t=e.exports=i});const AS={OPEN:"open",CLOSING:"closing",CLOSED:"closed"};var IS=AS;const{OPEN:TS,CLOSING:Np,CLOSED:Al}=IS,xp=Symbol.for("@libp2p/interface-connection/connection");class CS{constructor({localAddr:e,remoteAddr:t,localPeer:r,remotePeer:i,newStream:n,close:s,getStreams:a,stat:c}){MS(e,r,i,n,s,a,c),this.id=parseInt(String(Math.random()*1e9)).toString(36)+Date.now(),this.localAddr=e,this.remoteAddr=t,this.localPeer=r,this.remotePeer=i,this._stat={...c,status:TS},this._newStream=n,this._close=s,this._getStreams=a,this.registry=new Map,this.tags=[]}get[Symbol.toStringTag](){return"Connection"}get[xp](){return!0}static isConnection(e){return Boolean(e&&e[xp])}get stat(){return this._stat}get streams(){return this._getStreams()}async newStream(e){if(this.stat.status===Np)throw G(new Error("the connection is being closed"),"ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===Al)throw G(new Error("the connection is closed"),"ERR_CONNECTION_CLOSED");Array.isArray(e)||(e=[e]);const{stream:t,protocol:r}=await this._newStream(e);return this.addStream(t,{protocol:r}),{stream:t,protocol:r}}addStream(e,{protocol:t,metadata:r={}}){this.registry.set(e.id,{protocol:t,...r})}removeStream(e){this.registry.delete(e)}async close(){if(this.stat.status===Al)return;if(this._closing)return this._closing;this.stat.status=Np,this._closing=await this._close(),this._stat.timeline.close=Date.now(),this.stat.status=Al}}var RS=CS;function MS(e,t,r,i,n,s,a){if(e&&!ES.isMultiaddr(e))throw G(new Error("localAddr must be an instance of multiaddr"),"ERR_INVALID_PARAMETERS");if(!ke.isPeerId(t))throw G(new Error("localPeer must be an instance of peer-id"),"ERR_INVALID_PARAMETERS");if(!ke.isPeerId(r))throw G(new Error("remotePeer must be an instance of peer-id"),"ERR_INVALID_PARAMETERS");if(typeof i!="function")throw G(new Error("new stream must be a function"),"ERR_INVALID_PARAMETERS");if(typeof n!="function")throw G(new Error("close must be a function"),"ERR_INVALID_PARAMETERS");if(typeof s!="function")throw G(new Error("getStreams must be a function"),"ERR_INVALID_PARAMETERS");if(!a)throw G(new Error("connection metadata object must be provided"),"ERR_INVALID_PARAMETERS");if(a.direction!=="inbound"&&a.direction!=="outbound")throw G(new Error('direction must be "inbound" or "outbound"'),"ERR_INVALID_PARAMETERS");if(!a.timeline)throw G(new Error("connection timeline object must be provided in the stat object"),"ERR_INVALID_PARAMETERS");if(!a.timeline.open)throw G(new Error("connection open timestamp must be provided"),"ERR_INVALID_PARAMETERS");if(!a.timeline.upgraded)throw G(new Error("connection upgraded timestamp must be provided"),"ERR_INVALID_PARAMETERS")}var kS=RS,PS={Connection:kS};function NS(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}else return Array.from(e)}var Op=function(t){var r=void 0,i=void 0;function n(c){if(!(c instanceof Object))throw new Error('Target "'+c+'" is not an object');i=c}function s(c){Object.keys(c).forEach(function(o){var d=c[o];if(typeof d!="function")throw new Error('Trap "'+o+": "+d+'" is not a function');if(!Reflect[o])throw new Error('Trap "'+o+": "+d+'" is not a valid trap')}),r=c}n(function(){}),t&&n(t),s(Reflect);var a=new Proxy({},{get:function(o,d){return function(){for(var l=arguments.length,u=Array(l),p=0;p<l;p++)u[p]=arguments[p];return r[d].apply(null,[i].concat(NS(u.slice(1))))}}});return{setTarget:n,setHandler:s,getTarget:function(){return i},getHandler:function(){return r},proxy:new Proxy(i,a)}};const $t=Object.assign(le("libp2p:upgrader"),{error:le("libp2p:upgrader:err")}),{Connection:xS}=PS,{pipe:OS}=Yr,{codes:po}=tr;class DS{constructor({localPeer:e,metrics:t,cryptos:r=new Map,muxers:i=new Map,onConnectionEnd:n=()=>{},onConnection:s=()=>{}}){this.localPeer=e,this.metrics=t,this.cryptos=r,this.muxers=i,this.protector=null,this.protocols=new Map,this.onConnection=s,this.onConnectionEnd=n}async upgradeInbound(e){let t,r,i,n,s,a,c;if(this.metrics){({setTarget:a,proxy:c}=Op());const d=(Math.random()*1e9).toString(36)+Date.now();a({toB58String:()=>d}),e=this.metrics.trackStream({stream:e,remotePeer:c})}$t("Starting the inbound connection upgrade");let o=e;this.protector&&(o=await this.protector.protect(e));try{({conn:t,remotePeer:r,protocol:s}=await this._encryptInbound(this.localPeer,o,this.cryptos)),this.muxers.size?{stream:i,Muxer:n}=await this._multiplexInbound(t,this.muxers):i=t}catch(d){throw $t.error("Failed to upgrade inbound connection",d),await e.close(d),d}return this.metrics&&(this.metrics.updatePlaceholder(c,r),a(r)),$t("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:s,direction:"inbound",maConn:e,upgradedConn:i,Muxer:n,remotePeer:r})}async upgradeOutbound(e){const t=ke.createFromB58String(e.remoteAddr.getPeerId());let r,i,n,s,a,c,o;if(this.metrics){({setTarget:c,proxy:o}=Op());const l=(Math.random()*1e9).toString(36)+Date.now();c({toB58String:()=>l}),e=this.metrics.trackStream({stream:e,remotePeer:o})}$t("Starting the outbound connection upgrade");let d=e;this.protector&&(d=await this.protector.protect(e));try{({conn:r,remotePeer:i,protocol:s}=await this._encryptOutbound(this.localPeer,d,t,this.cryptos)),this.muxers.size?{stream:n,Muxer:a}=await this._multiplexOutbound(r,this.muxers):n=r}catch(l){throw $t.error("Failed to upgrade outbound connection",l),await e.close(l),l}return this.metrics&&(this.metrics.updatePlaceholder(o,i),c(i)),$t("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:s,direction:"outbound",maConn:e,upgradedConn:n,Muxer:a,remotePeer:i})}_createConnection({cryptoProtocol:e,direction:t,maConn:r,upgradedConn:i,Muxer:n,remotePeer:s}){let a,c,o;n&&(a=new n({onStream:async u=>{const p=new Zs.Listener(u);try{const{stream:f,protocol:g}=await p.handle(Array.from(this.protocols.keys()));$t("%s: incoming stream opened on %s",t,g),this.metrics&&this.metrics.trackStream({stream:f,remotePeer:s,protocol:g}),o.addStream(u,{protocol:g}),this._onStream({connection:o,stream:{...u,...f},protocol:g})}catch(f){$t.error(f)}},onStreamEnd:u=>{o.removeStream(u.id)}}),c=async u=>{$t("%s: starting new stream on %s",t,u);const p=a.newStream(),f=new Zs.Dialer(p);try{const{stream:g,protocol:v}=await f.select(u);return this.metrics&&this.metrics.trackStream({stream:g,remotePeer:s,protocol:v}),{stream:{...p,...g},protocol:v}}catch(g){throw $t.error("could not create new stream",g),G(g,po.ERR_UNSUPPORTED_PROTOCOL)}},OS(i,a,i).catch($t.error));const d=r.timeline;r.timeline=new Proxy(d,{set:(...u)=>(o&&u[1]==="close"&&u[2]&&!d.close&&(async()=>{try{o.stat.status==="open"&&await o.close()}catch(p){$t.error(p)}finally{this.onConnectionEnd(o)}})(),Reflect.set(...u))}),r.timeline.upgraded=Date.now();const l=()=>{throw G(new Error("connection is not multiplexed"),"ERR_CONNECTION_NOT_MULTIPLEXED")};return o=new xS({localAddr:r.localAddr,remoteAddr:r.remoteAddr,localPeer:this.localPeer,remotePeer:s,stat:{direction:t,timeline:r.timeline,multiplexer:n&&n.multicodec,encryption:e},newStream:c||l,getStreams:()=>a?a.streams:l,close:async u=>{await r.close(u),a&&a.streams.map(p=>p.abort(u))}}),this.onConnection(o),o}_onStream({connection:e,stream:t,protocol:r}){const i=this.protocols.get(r);i({connection:e,stream:t,protocol:r})}async _encryptInbound(e,t,r){const i=new Zs.Listener(t),n=Array.from(r.keys());$t("handling inbound crypto protocol selection",n);try{const{stream:s,protocol:a}=await i.handle(n),c=r.get(a);if($t("encrypting inbound connection..."),!c)throw new Error(`no crypto module found for ${a}`);return{...await c.secureInbound(e,s),protocol:a}}catch(s){throw G(s,po.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(e,t,r,i){const n=new Zs.Dialer(t),s=Array.from(i.keys());$t("selecting outbound crypto protocol",s);try{const{stream:a,protocol:c}=await n.select(s),o=i.get(c);if($t("encrypting outbound connection to %j",r),!o)throw new Error(`no crypto module found for ${c}`);return{...await o.secureOutbound(e,a,r),protocol:c}}catch(a){throw G(a,po.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(e,t){const r=new Zs.Dialer(e),i=Array.from(t.keys());$t("outbound selecting muxer %s",i);try{const{stream:n,protocol:s}=await r.select(i);$t("%s selected as muxer protocol",s);const a=t.get(s);return{stream:n,Muxer:a}}catch(n){throw G(n,po.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(e,t){const r=new Zs.Listener(e),i=Array.from(t.keys());$t("inbound handling muxers %s",i);try{const{stream:n,protocol:s}=await r.handle(i),a=t.get(s);return{stream:n,Muxer:a}}catch(n){throw G(n,po.ERR_MUXER_UNAVAILABLE)}}}var BS=DS;const{codes:{ERR_INVALID_PARAMETERS:Dp}}=tr,LS=e=>e;class jS{constructor({peerStore:e,eventName:t,eventProperty:r,eventTransformer:i=LS}){this._ps=e,this.eventName=t,this.eventProperty=r,this.eventTransformer=i,this.data=new Map}set(e,t){throw G(new Error("set must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}_setData(e,t,{emit:r=!0}={}){const i=e.toB58String();this.data.set(i,t),r&&this._emit(e,t)}_emit(e,t){this._ps.emit(this.eventName,{peerId:e,[this.eventProperty]:this.eventTransformer(t)})}get(e){if(!ke.isPeerId(e))throw G(new Error("peerId must be an instance of peer-id"),Dp);const t=this.data.get(e.toB58String());return t?[...t]:void 0}delete(e){if(!ke.isPeerId(e))throw G(new Error("peerId must be an instance of peer-id"),Dp);return this.data.delete(e.toB58String())?(this._emit(e,[]),!0):!1}}var Ac=jS;const gi=Object.assign(le("libp2p:peer-store:address-book"),{error:le("libp2p:peer-store:address-book:err")}),{codes:{ERR_INVALID_PARAMETERS:Js}}=tr;class FS extends Ac{constructor(e){super({peerStore:e,eventName:"change:multiaddrs",eventProperty:"multiaddrs",eventTransformer:t=>t.addresses?t.addresses.map(r=>r.multiaddr):[]});this.data=new Map}consumePeerRecord(e){let t;try{t=pc.createFromProtobuf(e.payload)}catch(c){return gi.error("invalid peer record received"),!1}if(!t.peerId.equals(e.peerId))return gi("signing key does not match PeerId in the PeerRecord"),!1;if(!t.multiaddrs||!t.multiaddrs.length)return!1;const r=t.peerId,i=r.toB58String(),n=this.data.get(i)||{record:void 0},s=n.record;if(s&&s.seqNumber>=t.seqNumber)return!1;const a=this._toAddresses(t.multiaddrs,!0);return this._setData(r,{addresses:a,record:{raw:e.marshal(),seqNumber:t.seqNumber}}),gi(`stored provided peer record for ${i}`),!0}getRawEnvelope(e){const t=this.data.get(e.toB58String());return!t||!t.record||!t.record.raw?void 0:t.record.raw}getPeerRecord(e){const t=this.getRawEnvelope(e);return t?to.createFromProtobuf(t):void 0}set(e,t){if(!ke.isPeerId(e))throw gi.error("peerId must be an instance of peer-id to store data"),G(new Error("peerId must be an instance of peer-id"),Js);const r=this._toAddresses(t);if(!r.length)return this;const i=e.toB58String(),n=this.data.get(i);if(n&&n.addresses&&n.addresses.length===r.length){const s=n.addresses.filter(a=>r.some(c=>a.multiaddr.equals(c.multiaddr)));if(s.length===n.addresses.length)return gi(`the addresses provided to store are equal to the already stored for ${i}`),this}return this._setData(e,{addresses:r,record:n&&n.record}),gi(`stored provided multiaddrs for ${i}`),n||this._ps.emit("peer",e),this}add(e,t){if(!ke.isPeerId(e))throw gi.error("peerId must be an instance of peer-id to store data"),G(new Error("peerId must be an instance of peer-id"),Js);const r=this._toAddresses(t),i=e.toB58String(),n=this.data.get(i);return n&&n.addresses&&(n.addresses.forEach(s=>{r.find(a=>a.multiaddr.equals(s.multiaddr))||r.push(s)}),n.addresses.length===r.length)?(gi(`the addresses provided to store are already stored for ${i}`),this):(this._setData(e,{addresses:r,record:n&&n.record}),gi(`added provided multiaddrs for ${i}`),n&&n.addresses||this._ps.emit("peer",e),this)}get(e){if(!ke.isPeerId(e))throw G(new Error("peerId must be an instance of peer-id"),Js);const t=this.data.get(e.toB58String());return t&&t.addresses?[...t.addresses]:void 0}_toAddresses(e,t=!1){if(!e)throw gi.error("multiaddrs must be provided to store data"),G(new Error("multiaddrs must be provided"),Js);const r=[];return e.forEach(i=>{if(!kt.isMultiaddr(i))throw gi.error(`multiaddr ${i} must be an instance of multiaddr`),G(new Error(`multiaddr ${i} must be an instance of multiaddr`),Js);r.push({multiaddr:i,isCertified:t})}),r}getMultiaddrsForPeer(e,t=r=>r){if(!ke.isPeerId(e))throw G(new Error("peerId must be an instance of peer-id"),Js);const r=this.data.get(e.toB58String());return!r||!r.addresses?void 0:t(r.addresses||[]).map(i=>{const n=i.multiaddr,s=n.getPeerId();return s&&s===e.toB58String()?n:n.encapsulate(`/p2p/${e.toB58String()}`)})}}var US=FS;const Bp=Object.assign(le("libp2p:peer-store:key-book"),{error:le("libp2p:peer-store:key-book:err")}),{codes:{ERR_INVALID_PARAMETERS:Lp}}=tr;class qS extends Ac{constructor(e){super({peerStore:e,eventName:"change:pubkey",eventProperty:"pubkey",eventTransformer:t=>t.pubKey});this.data=new Map}set(e,t){if(!ke.isPeerId(e))throw Bp.error("peerId must be an instance of peer-id to store data"),G(new Error("peerId must be an instance of peer-id"),Lp);const r=e.toB58String(),i=this.data.get(r);return!i&&t&&(e.pubKey=t,this._setData(e,e),Bp(`stored provided public key for ${r}`)),this}get(e){if(!ke.isPeerId(e))throw G(new Error("peerId must be an instance of peer-id"),Lp);const t=this.data.get(e.toB58String());return t?t.pubKey:void 0}}var zS=qS;const Il=Object.assign(le("libp2p:peer-store:proto-book"),{error:le("libp2p:peer-store:proto-book:err")}),{codes:{ERR_INVALID_PARAMETERS:Qs}}=tr;class $S extends Ac{constructor(e){super({peerStore:e,eventName:"change:metadata",eventProperty:"metadata"});this.data=new Map}set(e,t,r){if(!ke.isPeerId(e))throw Il.error("peerId must be an instance of peer-id to store data"),G(new Error("peerId must be an instance of peer-id"),Qs);if(typeof t!="string"||!(r instanceof Uint8Array))throw Il.error("valid key and value must be provided to store data"),G(new Error("valid key and value must be provided"),Qs);return this._setValue(e,t,r),this}_setValue(e,t,r,{emit:i=!0}={}){const n=e.toB58String(),s=this.data.get(n)||new Map,a=s.get(t);if(a&&li(r,a)){Il(`the metadata provided to store is equal to the already stored for ${n} on ${t}`);return}s.set(t,r),this.data.set(n,s),i&&this._emit(e,t)}get(e){if(!ke.isPeerId(e))throw G(new Error("peerId must be an instance of peer-id"),Qs);return this.data.get(e.toB58String())}getValue(e,t){if(!ke.isPeerId(e))throw G(new Error("peerId must be an instance of peer-id"),Qs);const r=this.data.get(e.toB58String());return r&&r.get(t)}delete(e){if(!ke.isPeerId(e))throw G(new Error("peerId must be an instance of peer-id"),Qs);return this.data.delete(e.toB58String())?(this._emit(e),!0):!1}deleteValue(e,t){if(!ke.isPeerId(e))throw G(new Error("peerId must be an instance of peer-id"),Qs);const r=this.data.get(e.toB58String());return!r||!r.delete(t)?!1:(this._emit(e,t),!0)}}var HS=$S;const bi=Object.assign(le("libp2p:peer-store:proto-book"),{error:le("libp2p:peer-store:proto-book:err")}),{codes:{ERR_INVALID_PARAMETERS:ea}}=tr;class VS extends Ac{constructor(e){super({peerStore:e,eventName:"change:protocols",eventProperty:"protocols",eventTransformer:t=>Array.from(t)});this.data=new Map}set(e,t){if(!ke.isPeerId(e))throw bi.error("peerId must be an instance of peer-id to store data"),G(new Error("peerId must be an instance of peer-id"),ea);if(!t)throw bi.error("protocols must be provided to store data"),G(new Error("protocols must be provided"),ea);const r=e.toB58String(),i=this.data.get(r),n=new Set(t),s=(a,c)=>a.size===c.size&&[...a].every(o=>c.has(o));return i&&s(i,n)?(bi(`the protocols provided to store are equal to the already stored for ${r}`),this):(this._setData(e,n),bi(`stored provided protocols for ${r}`),this)}add(e,t){if(!ke.isPeerId(e))throw bi.error("peerId must be an instance of peer-id to store data"),G(new Error("peerId must be an instance of peer-id"),ea);if(!t)throw bi.error("protocols must be provided to store data"),G(new Error("protocols must be provided"),ea);const r=e.toB58String(),i=this.data.get(r)||new Set,n=new Set([...i,...t]);return i.size===n.size?(bi(`the protocols provided to store are already stored for ${r}`),this):(this._setData(e,n),bi(`added provided protocols for ${r}`),this)}remove(e,t){if(!ke.isPeerId(e))throw bi.error("peerId must be an instance of peer-id to store data"),G(new Error("peerId must be an instance of peer-id"),ea);if(!t)throw bi.error("protocols must be provided to store data"),G(new Error("protocols must be provided"),ea);const r=e.toB58String(),i=this.data.get(r);if(i){const n=new Set([...i].filter(s=>!t.includes(s)));if(i.size===n.size)return this;this._setData(e,n),bi(`removed provided protocols for ${r}`)}return this}}var GS=VS;const{EventEmitter:XS}=_r,{codes:{ERR_INVALID_PARAMETERS:KS}}=tr;class WS extends XS{constructor({peerId:e}){super();this._peerId=e,this.addressBook=new US(this),this.keyBook=new zS(this),this.metadataBook=new HS(this),this.protoBook=new GS(this)}start(){}stop(){}get peers(){const e=new Set([...this.addressBook.data.keys(),...this.keyBook.data.keys(),...this.protoBook.data.keys(),...this.metadataBook.data.keys()]);this._peerId&&e.delete(this._peerId.toB58String());const t=new Map;return e.forEach(r=>{t.set(r,this.get(ke.createFromCID(r)))}),t}delete(e){const t=this.addressBook.delete(e),r=this.keyBook.delete(e),i=this.protoBook.delete(e),n=this.metadataBook.delete(e);return t||r||i||n}get(e){if(!ke.isPeerId(e))throw G(new Error("peerId must be an instance of peer-id"),KS);const t=this.keyBook.data.get(e.toB58String()),r=this.addressBook.get(e),i=this.metadataBook.get(e),n=this.protoBook.get(e);return!t&&!r&&!i&&!n?void 0:{id:t||e,addresses:r||[],protocols:n||[],metadata:i}}}var jp=WS;function YS(e,t,r){const i=new e(t,r);i._subscribeAdapter=i.subscribe,i._unsubscribeAdapter=i.unsubscribe;function n(a,c){c&&i.on(a,c),i._subscribeAdapter(a)}function s(a,c){c?i.removeListener(a,c):i.removeAllListeners(a),i.listenerCount(a)===0&&i._unsubscribeAdapter(a)}return i.subscribe=n,i.unsubscribe=s,i}var ZS=YS,JS="/peers/",QS="/peers/addrs/",e_="/peers/keys/",t_="/peers/metadata/",r_="/peers/protos/",i_={NAMESPACE_COMMON:JS,NAMESPACE_ADDRESS:QS,NAMESPACE_KEYS:e_,NAMESPACE_METADATA:t_,NAMESPACE_PROTOCOL:r_};const n_=`
message Addresses {
  // Address represents a single multiaddr.
  message Address {
    required bytes multiaddr = 1;

    // Flag to indicate if the address comes from a certified source.
    optional bool isCertified = 2;
  }

  // CertifiedRecord contains a serialized signed PeerRecord used to
  // populate the signedAddrs list.
  message CertifiedRecord {
    // The Seq counter from the signed PeerRecord envelope
    uint64 seq = 1;

    // The serialized bytes of the SignedEnvelope containing the PeerRecord.
    bytes raw = 2;
  }

  // The known multiaddrs.
  repeated Address addrs = 1;

  // The most recently received signed PeerRecord.
  CertifiedRecord certified_record = 2;
}
`;var Fp=tn(n_).Addresses;const s_=`
message Protocols {
  repeated string protocols = 1;
}
`;var Up=tn(s_).Protocols;const Yt=Object.assign(le("libp2p:persistent-peer-store"),{error:le("libp2p:persistent-peer-store:err")}),{Key:Ic}=Pd,{NAMESPACE_ADDRESS:a_,NAMESPACE_COMMON:o_,NAMESPACE_KEYS:c_,NAMESPACE_METADATA:d_,NAMESPACE_PROTOCOL:l_}=i_;class u_ extends jp{constructor({peerId:e,datastore:t,threshold:r=5}){super({peerId:e});this._datastore=t,this._dirtyPeers=new Set,this._dirtyMetadata=new Map,this.threshold=r,this._addDirtyPeer=this._addDirtyPeer.bind(this)}async start(){Yt("PeerStore is starting"),this.on("change:protocols",this._addDirtyPeer),this.on("change:multiaddrs",this._addDirtyPeer),this.on("change:pubkey",this._addDirtyPeerKey),this.on("change:metadata",this._addDirtyPeerMetadata);for await(const e of this._datastore.query({prefix:o_}))await this._processDatastoreEntry(e);Yt("PeerStore started")}async stop(){Yt("PeerStore is stopping"),this.removeAllListeners(),await this._commitData(),Yt("PeerStore stopped")}_addDirtyPeer({peerId:e}){const t=e.toB58String();Yt("add dirty peer",t),this._dirtyPeers.add(t),this._dirtyPeers.size>=this.threshold&&this._commitData().catch(r=>{Yt.error("error committing data",r)})}_addDirtyPeerKey({peerId:e}){if(e.hasInlinePublicKey())return;const t=e.toB58String();Yt("add dirty peer key",t),this._dirtyPeers.add(t),this._dirtyPeers.size>=this.threshold&&this._commitData().catch(r=>{Yt.error("error committing data",r)})}_addDirtyPeerMetadata({peerId:e,metadata:t}){const r=e.toB58String();Yt("add dirty metadata peer",r),this._dirtyPeers.add(r);const i=this._dirtyMetadata.get(r)||new Set;i.add(t),this._dirtyMetadata.set(r,i),this._dirtyPeers.size>=this.threshold&&this._commitData().catch(n=>{Yt.error("error committing data",n)})}async _commitData(){const e=Array.from(this._dirtyPeers);if(!e.length)return;this._dirtyPeers.clear(),Yt("create batch commit");const t=this._datastore.batch();for(const r of e){const i=this.keyBook.data.get(r)||ke.createFromCID(r);this._batchAddressBook(i,t),!i.hasInlinePublicKey()&&this._batchKeyBook(i,t),this._batchMetadataBook(i,t),this._batchProtoBook(i,t)}await t.commit(),Yt("batch committed")}_batchAddressBook(e,t){const r=e.toString(),i=new Ic(`${a_}${r}`),n=this.addressBook.data.get(e.toB58String());try{if(!n){t.delete(i);return}const s=Fp.encode({addrs:n.addresses.map(a=>({multiaddr:a.multiaddr.bytes,isCertified:a.isCertified})),certified_record:n.record?{seq:n.record.seqNumber,raw:n.record.raw}:void 0});t.put(i,s)}catch(s){Yt.error(s)}}_batchKeyBook(e,t){const r=e.toString(),i=new Ic(`${c_}${r}`);try{if(!e.pubKey){t.delete(i);return}const n=e.marshalPubKey();t.put(i,n)}catch(n){Yt.error(n)}}_batchMetadataBook(e,t){const r=e.toString(),i=this._dirtyMetadata.get(e.toB58String())||[];try{i.forEach(n=>{const s=new Ic(`${d_}${r}/${n}`),a=this.metadataBook.getValue(e,n);a?t.put(s,a):t.delete(s)})}catch(n){Yt.error(n)}}_batchProtoBook(e,t){const r=e.toString(),i=new Ic(`${l_}${r}`),n=this.protoBook.get(e);try{if(!n){t.delete(i);return}const s=Up.encode({protocols:n});t.put(i,s)}catch(s){Yt.error(s)}}async _processDatastoreEntry({key:e,value:t}){try{const r=e.toString().split("/"),i=ke.createFromCID(r[3]);let n;switch(r[2]){case"addrs":n=Fp.decode(t),this.addressBook._setData(i,{addresses:n.addrs.map(s=>({multiaddr:kt(s.multiaddr),isCertified:Boolean(s.isCertified)})),record:n.certified_record?{raw:n.certified_record.raw,seqNumber:n.certified_record.seq}:void 0},{emit:!1});break;case"keys":n=await ke.createFromPubKey(t),this.keyBook._setData(n,n,{emit:!1});break;case"metadata":this.metadataBook._setValue(i,r[4],t,{emit:!1});break;case"protos":n=Up.decode(t),this.protoBook._setData(i,new Set(n.protocols),{emit:!1});break;default:Yt("invalid data persisted for: ",e.toString())}}catch(r){Yt.error(r)}}}var f_=u_;const qp=()=>{},zp=Symbol.for("@libp2p/js-interfaces/topology");class h_{constructor({min:e=0,max:t=Infinity,handlers:r={}}){this.min=e,this.max=t,this._onConnect=r.onConnect||qp,this._onDisconnect=r.onDisconnect||qp,this.peers=new Set}get[Symbol.toStringTag](){return"Topology"}get[zp](){return!0}static isTopology(e){return Boolean(e&&e[zp])}set registrar(e){this._registrar=e}disconnect(e){this._onDisconnect(e)}}var p_=h_;const m_=Object.assign(le("libp2p:peer-store"),{error:le("libp2p:peer-store:err")}),{codes:{ERR_INVALID_PARAMETERS:g_}}=tr;class b_{constructor({peerStore:e,connectionManager:t}){this.peerStore=e,this.connectionManager=t,this.topologies=new Map,this._handle=void 0,this._onDisconnect=this._onDisconnect.bind(this),this.connectionManager.on("peer:disconnect",this._onDisconnect)}get handle(){return this._handle}set handle(e){this._handle=e}getConnection(e){return this.connectionManager.get(e)}register(e){if(!p_.isTopology(e))throw m_.error("topology must be an instance of interfaces/topology"),G(new Error("topology must be an instance of interfaces/topology"),g_);const t=(Math.random()*1e9).toString(36)+Date.now();return this.topologies.set(t,e),e.registrar=this,t}unregister(e){return this.topologies.delete(e)}_onDisconnect(e,t){for(const[,r]of this.topologies)r.disconnect(e.remotePeer,t)}}var y_=b_,Tc=ne(function(e){const{Buffer:t}=pe;e.exports=async function*(r){for await(const i of r)t.isBuffer(i)?yield i:Ar.isBufferList(i)?yield i.slice():yield t.from(i)},e.exports.toBuffer=e.exports,e.exports.toList=async function*(r){for await(const i of r)t.isBuffer(i)?yield new Ar().append(i):Ar.isBufferList(i)?yield i:yield new Ar().append(t.from(i))}}),v_={PROTOCOL:"/ipfs/ping/1.0.0",PING_LENGTH:32},Cc=ne(function(e,t){const r=Object.assign(le("libp2p:ping"),{error:le("libp2p:ping:err")}),{pipe:i}=Yr,{toBuffer:n}=Tc,{collect:s,take:a}=xd,{PROTOCOL:c,PING_LENGTH:o}=v_;async function d(p,f){r("dialing %s to %s",c,f.toB58String?f.toB58String():f);const{stream:g}=await p.dialProtocol(f,c),v=Date.now(),S=cs.randomBytes(o),[C]=await i([S],g,j=>a(1,j),n,s),D=Date.now();if(!li(S,C))throw G(new Error("Received wrong ping ack"),"ERR_WRONG_PING_ACK");return D-v}function l(p){p.handle(c,({stream:f})=>i(f,f))}function u(p){p.unhandle(c)}t=e.exports=d,t.mount=l,t.unmount=u}),w_=e=>t=>async function*(){for await(const r of t)yield e.encode(r)}(),S_=e=>t=>async function*(){for await(const r of t)yield e.decode(r)}(),Tl={encode:w_,decode:S_},__=e=>t=>lr.encode()(Tl.encode(e)(t)),E_=e=>t=>Tl.decode(e)(Tc(lr.decode()(t))),A_=Tl,I_={encode:__,decode:E_,it:A_};const T_=`
message Identify {
  // protocolVersion determines compatibility between peers
  optional string protocolVersion = 5; // e.g. ipfs/1.0.0

  // agentVersion is like a UserAgent string in browsers, or client version in bittorrent
  // includes the client name and client.
  optional string agentVersion = 6; // e.g. go-ipfs/0.1.0

  // publicKey is this node's public key (which also gives its node.ID)
  // - may not need to be sent, as secure channel implies it has been sent.
  // - then again, if we change / disable secure channel, may still want it.
  optional bytes publicKey = 1;

  // listenAddrs are the multiaddrs the sender node listens for open connections on
  repeated bytes listenAddrs = 2;

  // oservedAddr is the multiaddr of the remote endpoint that the sender node perceives
  // this is useful information to convey to the other side, as it helps the remote endpoint
  // determine whether its connection to the local peer goes through NAT.
  optional bytes observedAddr = 4;

  repeated string protocols = 3;

  // signedPeerRecord contains a serialized SignedEnvelope containing a PeerRecord,
  // signed by the sending node. It contains the same addresses as the listenAddrs field, but
  // in a form that lets us share authenticated addrs with other peers.
  optional bytes signedPeerRecord = 8;
}
`;var mo=tn(T_).Identify;const Di=Object.assign(le("libp2p:identify"),{error:le("libp2p:identify:err")}),{pipe:Rc}=Yr,{collect:$p,take:Hp,consume:Vp}=xd,{toBuffer:Gp}=Tc,{MULTICODEC_IDENTIFY:Cl,MULTICODEC_IDENTIFY_PUSH:Mc,AGENT_VERSION:C_,PROTOCOL_VERSION:R_}=ph,{codes:Rl}=tr;class kc{constructor({libp2p:e}){this._libp2p=e,this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.peerId=e.peerId,this.handleMessage=this.handleMessage.bind(this),this._host={agentVersion:C_,protocolVersion:R_,...e._options.host},this.peerStore.metadataBook.set(this.peerId,"AgentVersion",St(this._host.agentVersion)),this.peerStore.metadataBook.set(this.peerId,"ProtocolVersion",St(this._host.protocolVersion)),this.connectionManager.on("peer:connect",t=>{this.identify(t).catch(Di.error)}),this.peerStore.on("change:multiaddrs",({peerId:t})=>{t.toString()===this.peerId.toString()&&this.pushToPeerStore()}),this.peerStore.on("change:protocols",({peerId:t})=>{t.toString()===this.peerId.toString()&&this.pushToPeerStore()})}async push(e){const t=await this.peerStore.addressBook.getRawEnvelope(this.peerId),r=this._libp2p.multiaddrs.map(s=>s.bytes),i=this.peerStore.protoBook.get(this.peerId)||[],n=e.map(async s=>{try{const{stream:a}=await s.newStream(Mc);await Rc([{listenAddrs:r,signedPeerRecord:t,protocols:i}],I_.encode(mo),a,Vp)}catch(a){Di.error("could not push identify update to peer",a)}});return Promise.all(n)}pushToPeerStore(){if(!this._libp2p.isStarted())return;const e=[];let t;for(const r of this.peerStore.peers.values())r.protocols.includes(Mc)&&(t=this.connectionManager.get(r.id))&&e.push(t);this.push(e)}async identify(e){const{stream:t}=await e.newStream(Cl),[r]=await Rc([],t,lr.decode(),Hp(1),Gp,$p);if(!r)throw G(new Error("No data could be retrieved"),Rl.ERR_CONNECTION_ENDED);let i;try{i=mo.decode(r)}catch(l){throw G(l,Rl.ERR_INVALID_MESSAGE)}let{publicKey:n,listenAddrs:s,protocols:a,observedAddr:c,signedPeerRecord:o}=i;const d=await ke.createFromPubKey(n);if(e.remotePeer.toB58String()!==d.toB58String())throw G(new Error("identified peer does not match the expected peer"),Rl.ERR_INVALID_PEER);c=kc.getCleanMultiaddr(c);try{const l=await to.openAndCertify(o,pc.DOMAIN);if(this.peerStore.addressBook.consumePeerRecord(l)){this.peerStore.protoBook.set(d,a);return}}catch(l){Di("received invalid envelope, discard it and fallback to listenAddrs is available",l)}try{this.peerStore.addressBook.set(d,s.map(l=>kt(l)))}catch(l){Di.error("received invalid addrs",l)}this.peerStore.protoBook.set(d,a),this.peerStore.metadataBook.set(d,"AgentVersion",St(i.agentVersion)),Di("received observed address of %s",c)}handleMessage({connection:e,stream:t,protocol:r}){switch(r){case Cl:return this._handleIdentify({connection:e,stream:t});case Mc:return this._handlePush({connection:e,stream:t});default:Di.error("cannot handle unknown protocol %s",r)}}async _handleIdentify({connection:e,stream:t}){let r=new Uint8Array(0);this.peerId.pubKey&&(r=this.peerId.pubKey.bytes);const i=await this.peerStore.addressBook.getRawEnvelope(this.peerId),n=this.peerStore.protoBook.get(this.peerId)||[],s=mo.encode({protocolVersion:this._host.protocolVersion,agentVersion:this._host.agentVersion,publicKey:r,listenAddrs:this._libp2p.multiaddrs.map(a=>a.bytes),signedPeerRecord:i,observedAddr:e.remoteAddr.bytes,protocols:n});try{await Rc([s],lr.encode(),t,Vp)}catch(a){Di.error("could not respond to identify request",a)}}async _handlePush({connection:e,stream:t}){let r;try{const[n]=await Rc([],t,lr.decode(),Hp(1),Gp,$p);r=mo.decode(n)}catch(n){return Di.error("received invalid message",n)}const i=e.remotePeer;try{const n=await to.openAndCertify(r.signedPeerRecord,pc.DOMAIN);if(this.peerStore.addressBook.consumePeerRecord(n)){this.peerStore.protoBook.set(i,r.protocols);return}}catch(n){Di("received invalid envelope, discard it and fallback to listenAddrs is available",n)}try{this.peerStore.addressBook.set(i,r.listenAddrs.map(n=>kt(n)))}catch(n){Di.error("received invalid addrs",n)}this.peerStore.protoBook.set(i,r.protocols)}static getCleanMultiaddr(e){if(e&&e.length>0)try{return kt(e)}catch(t){return null}return null}}const M_={IDENTIFY:Cl,IDENTIFY_PUSH:Mc};kc.multicodecs=M_,kc.Messsage=mo;var Xp=kc;const ti=Object.assign(le("libp2p"),{error:le("libp2p:err")}),{EventEmitter:k_}=_r,{validate:P_}=O1,{codes:Ml,messages:N_}=tr,x_=Xp.multicodecs;class kl extends k_{static async create(e){if(e.peerId)return new kl(e);const t=await ke.create();return e.peerId=t,new kl(e)}constructor(e){super();if(this._options=P_(e),this.peerId=this._options.peerId,this.datastore=this._options.datastore,this.peerStore=this.datastore&&this._options.peerStore.persistence?new f_({peerId:this.peerId,datastore:this.datastore,...this._options.peerStore}):new jp({peerId:this.peerId}),this.addresses=this._options.addresses,this.addressManager=new B1(this._options.addresses),this._modules=this._options.modules,this._config=this._options.config,this._transport=[],this._discovery=new Map,this._options.connectionManager.minPeers&&(this._options.connectionManager.minConnections=this._options.connectionManager.minPeers),this.connectionManager=new K1(this,{autoDial:this._config.peerDiscovery.autoDial,...this._options.connectionManager}),this._options.metrics.enabled&&(this.metrics=new tS({...this._options.metrics,connectionManager:this.connectionManager})),this._options.keychain&&this._options.keychain.datastore){ti("creating keychain");const r=ap.generateOptions();this.keychain=new ap(this._options.keychain.datastore,{passPhrase:this._options.keychain.pass,...r,...this._options.keychain}),ti("keychain constructed")}if(this.upgrader=new BS({localPeer:this.peerId,metrics:this.metrics,onConnection:r=>this.connectionManager.onConnect(r),onConnectionEnd:r=>this.connectionManager.onDisconnect(r)}),this.transportManager=new Mh({libp2p:this,upgrader:this.upgrader,faultTolerance:this._options.transportManager.faultTolerance}),this.registrar=new y_({peerStore:this.peerStore,connectionManager:this.connectionManager}),this.handle=this.handle.bind(this),this.registrar.handle=this.handle,!this._modules.connEncryption||!this._modules.connEncryption.length)throw G(new Error(N_.CONN_ENCRYPTION_REQUIRED),Ml.CONN_ENCRYPTION_REQUIRED);const t=this._modules.connEncryption;if(t.forEach(r=>{this.upgrader.cryptos.set(r.protocol,r)}),this.dialer=new I2({transportManager:this.transportManager,peerStore:this.peerStore,concurrency:this._options.dialer.maxParallelDials,perPeerLimit:this._options.dialer.maxDialsPerPeer,timeout:this._options.dialer.dialTimeout,resolvers:this._options.dialer.resolvers,addressSorter:this._options.dialer.addressSorter}),this._modules.transport.forEach(r=>{const i=r.prototype[Symbol.toStringTag],n=this._config.transport[i];this.transportManager.add(i,r,n)}),this._config.relay.enabled&&(this.transportManager.add(Zh.prototype[Symbol.toStringTag],Zh),this.relay=new u2(this)),this._modules.streamMuxer){const r=this._modules.streamMuxer;r.forEach(i=>{this.upgrader.muxers.set(i.multicodec,i)}),this.identifyService=new Xp({libp2p:this}),this.handle(Object.values(x_),this.identifyService.handleMessage)}if(this._modules.connProtector)this.upgrader.protector=this._modules.connProtector;else if(Pn.process!==void 0&&Pn.process.env&&Pn.process.env.LIBP2P_FORCE_PNET)throw new Error("Private network is enforced, but no protector was provided");if(this._modules.dht){const r=this._modules.dht;this._dht=new r({libp2p:this,dialer:this.dialer,peerId:this.peerId,peerStore:this.peerStore,registrar:this.registrar,datastore:this.datastore,...this._config.dht})}if(this._modules.pubsub){const r=this._modules.pubsub;this.pubsub=ZS(r,this,this._config.pubsub)}this.peerRouting=new By(this),this.contentRouting=new Uy(this),Cc.mount(this),this._onDiscoveryPeer=this._onDiscoveryPeer.bind(this)}emit(e,...t){return e==="error"&&!this._events.error?(ti.error(t),!1):super.emit(e,...t)}async start(){ti("libp2p is starting");try{await this._onStarting(),await this._onDidStart(),ti("libp2p has started")}catch(e){throw this.emit("error",e),ti.error("An error occurred starting libp2p",e),await this.stop(),e}}async stop(){ti("libp2p is stopping");try{this._isStarted=!1,this.relay&&this.relay.stop(),this.peerRouting.stop();for(const e of this._discovery.values())e.removeListener("peer",this._onDiscoveryPeer);await Promise.all(Array.from(this._discovery.values(),e=>e.stop())),this._discovery=new Map,await this.peerStore.stop(),await this.connectionManager.stop(),await Promise.all([this.pubsub&&this.pubsub.stop(),this._dht&&this._dht.stop(),this.metrics&&this.metrics.stop()]),await this.transportManager.close(),Cc.unmount(this),this.dialer.destroy()}catch(e){e&&(ti.error(e),this.emit("error",e))}ti("libp2p has stopped")}async loadKeychain(){if(!this.keychain)return;try{await this.keychain.findKeyByName("self")}catch(e){await this.keychain.importPeer("self",this.peerId)}}isStarted(){return this._isStarted}get connections(){return this.connectionManager.connections}dial(e,t){return this.dialProtocol(e,[],t)}async dialProtocol(e,t,r){const{id:i,multiaddrs:n}=ac(e);if(i.equals(this.peerId))throw G(new Error("Cannot dial self"),Ml.ERR_DIALED_SELF);let s=this.connectionManager.get(i);return s?n&&this.peerStore.addressBook.add(i,n):s=await this.dialer.connectToPeer(e,r),t&&t.length?s.newStream(t):s}get multiaddrs(){const e=this.addressManager.getAnnounceAddrs();if(e.length)return e;const t=this._options.addresses.announceFilter||(r=>r);return t(this.transportManager.getAddrs())}async hangUp(e){const{id:t}=ac(e),r=this.connectionManager.connections.get(t.toB58String());if(!r)return;await Promise.all(r.map(i=>i.close()))}ping(e){const{id:t,multiaddrs:r}=ac(e);return r?Cc(this,r[0]):Cc(this,t)}handle(e,t){e=Array.isArray(e)?e:[e],e.forEach(r=>{this.upgrader.protocols.set(r,t)}),this.peerStore.protoBook.add(this.peerId,e)}unhandle(e){e=Array.isArray(e)?e:[e],e.forEach(t=>{this.upgrader.protocols.delete(t)}),this.peerStore.protoBook.remove(this.peerId,e)}async _onStarting(){const e=this.addressManager.getListenAddrs();await this.transportManager.listen(e),await this.peerStore.start(),this._config.pubsub.enabled&&(this.pubsub&&this.pubsub.start()),this._config.dht.enabled&&(this._dht&&this._dht.start(),this._dht.on("peer",this._onDiscoveryPeer)),this.metrics&&this.metrics.start()}async _onDidStart(){this._isStarted=!0,this.peerStore.on("peer",e=>{this.emit("peer:discovery",e),this._maybeConnect(e)});for(const e of this.peerStore.peers.values())this.emit("peer:discovery",e.id);this.connectionManager.start(),await this._setupPeerDiscovery(),this.relay&&this.relay.start(),this.peerRouting.start()}_onDiscoveryPeer(e){if(e.id.toB58String()===this.peerId.toB58String()){ti.error(new Error(Ml.ERR_DISCOVERED_SELF));return}e.multiaddrs&&this.peerStore.addressBook.add(e.id,e.multiaddrs),e.protocols&&this.peerStore.protoBook.set(e.id,e.protocols)}async _maybeConnect(e){if(this._config.peerDiscovery.autoDial===!0&&!this.connectionManager.get(e)){const t=this._options.connectionManager.minConnections||0;if(t>this.connectionManager.size){ti("connecting to discovered peer %s",e.toB58String());try{await this.dialer.connectToPeer(e)}catch(r){ti.error("could not connect to discovered peer",r)}}}}async _setupPeerDiscovery(){const e=t=>{let r={enabled:!0};if(t.tag&&this._config.peerDiscovery&&this._config.peerDiscovery[t.tag]&&(r={...r,...this._config.peerDiscovery[t.tag]}),r.enabled&&!this._discovery.has(t.tag)){let i;typeof t=="function"?i=new t(Object.assign({},r,{peerId:this.peerId,libp2p:this})):i=t,i.on("peer",this._onDiscoveryPeer),this._discovery.set(t.tag,i)}};for(const t of this._modules.peerDiscovery||[])e(t);for(const t of this.transportManager.getTransports())t.discovery&&e(t.discovery);await Promise.all(Array.from(this._discovery.values(),t=>t.start()))}}var O_=kl,D_=typeof WebSocket=="undefined"?os:WebSocket,Pl=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(n){if(this.isStopped)return;const s={value:n,done:!1};if(this.pullQueue.length){const a=this.pullQueue.shift();a&&a.resolve(s)}else this.pushQueue.push(Promise.resolve(s)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(this.isStopped)return;this.isStopped=!0,this.remove();for(const n of this.pullQueue)n.resolve({value:void 0,done:!0});this.pullQueue.length=0}fail(n){if(this.isStopped)return;if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const s of this.pullQueue)s.reject(n);this.pullQueue.length=0}else{const s=Promise.reject(n);s.catch(()=>{}),this.pushQueue.push(s)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:n=>{const s=this.pushQueue.shift();return s?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),s):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((a,c)=>{this.pullQueue.push({resolve:a,reject:c})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class i{constructor(n,{highWaterMark:s=100,lowWaterMark:a=1}={}){const c=new r;c.highWaterMark=s,c.lowWaterMark=a,c.removeCallback=n({push:o=>c.push(o),stop:()=>c.stop(),fail:o=>c.fail(o),on:(o,d)=>{c.eventHandlers[o]=d}})||(()=>{}),this[Symbol.asyncIterator]=()=>c[Symbol.asyncIterator](),Object.freeze(this)}}t.EventIterator=i,t.default=i}),B_=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventIterator=Pl.EventIterator;function r(i,n,s){return new Pl.EventIterator(({push:a})=>(this.addEventListener(i,a,n),()=>this.removeEventListener(i,a,n)),s)}t.subscribe=r,t.default=Pl.EventIterator});const{Buffer:L_}=pe,{EventIterator:j_}=B_;function F_(e){return e instanceof ArrayBuffer||e!=null&&e.constructor!=null&&e.constructor.name==="ArrayBuffer"&&typeof e.byteLength=="number"}var Kp=e=>{const t=e.removeEventListener||e.removeListener,r=async function*(){const s=new j_(({push:a,stop:c,fail:o})=>(e.addEventListener("message",a),e.addEventListener("error",o),e.addEventListener("close",c),()=>{t.call(e,"message",a),t.call(e,"error",o),t.call(e,"close",c)}),{highWaterMark:Infinity});for await(const{data:a}of s)yield F_(a)?L_.from(a):a}();let i=e.readyState===1,n;return e.addEventListener("open",()=>{i=!0,n=null}),e.addEventListener("close",()=>{i=!1,n=null}),e.addEventListener("error",s=>{i||(n=s)}),r.connected=()=>new Promise((s,a)=>{if(i)return s();if(n)return a(n);const c=l=>{t.call(e,"open",o),t.call(e,"error",d),l()},o=()=>c(s),d=l=>c(()=>a(l));e.addEventListener("open",o),e.addEventListener("error",d)}),r},U_=async e=>{if(e.readyState>=2)throw new Error("socket closed");return e.readyState===1?void 0:new Promise((t,r)=>{const i=e&&(e.removeEventListener||e.removeListener);function n(){typeof i=="function"&&(i.call(e,"open",s),i.call(e,"error",a))}function s(){n(),t()}function a(c){n(),r(c)}e.addEventListener("open",s),e.addEventListener("error",a)})},Wp=(e,t)=>(t=t||{},t.closeOnEnd=t.closeOnEnd!==!1,async r=>{for await(const i of r){try{await U_(e)}catch(n){if(n.message==="socket closed")break;throw n}e.send(i)}if(t.closeOnEnd&&e.readyState<=1)return new Promise((i,n)=>{e.addEventListener("close",s=>{if(s.wasClean||s.code===1006)i();else{const a=Object.assign(new Error("ws error"),{event:s});n(a)}}),setTimeout(()=>e.close())})}),Yp=(e,t)=>{t=t||{},t.binaryType?e.binaryType=t.binaryType:t.binary&&(e.binaryType="arraybuffer");const r={sink:Wp(e,t),source:Kp(e),connected:()=>r.source.connected()};return r},q_=function(e,t,r,i){r=r||{};var e=Wa.parse(e,!1,!0),n;return e.protocol?n=e.protocol:(n=t.protocol?t.protocol.replace(/:$/,""):"http",n=(r[n]||i||n)+":"),e.host&&e.host[0]===":"&&(e.host=null),e.hostname?Wa.format({protocol:n,slashes:!0,hostname:e.hostname,port:e.port,pathname:e.pathname,search:e.search}):(e.host=t.host,e.port?Wa.format({protocol:n,slashes:!0,host:t.hostname+":"+e.port,port:e.port,pathname:e.pathname,search:e.search}):e.pathname?Wa.format({protocol:n,slashes:!0,host:e.host,pathname:e.pathname,search:e.search}):(e.pathname=t.pathname,e.search?Wa.format({protocol:n,slashes:!0,host:e.host,pathname:e.pathname,search:e.search}):(e.search=t.search,e.format(e))))};const z_={http:"ws",https:"wss"},$_="ws";var H_=(e,t)=>q_(e,t,z_,$_),Zp=ne(function(e){e.exports=function(t,r={}){const i=typeof window=="undefined"?{}:window.location,n=H_(t,i),s=new D_(n,r.websocket),a=Yp(s,r);return a.remoteAddress=n,a.close=()=>new Promise((c,o)=>{s.addEventListener("close",c),s.close()}),a.destroy=()=>{s.terminate?s.terminate():s.close()},a.socket=s,a},e.exports.connect=e.exports});const Pc=(e,t)=>t,V_=(e,t,r,i)=>{if(i&&i.assumeHttp===!1)return`tcp://${e}:${t}`;let n="tcp",s=`:${t}`;const a=r[r.length-1];return a.protocol==="tcp"&&(n=t==="443"?"https":"http",s=t==="443"||t==="80"?"":s),`${n}://${e}${s}`},G_={ip4:Pc,ip6:(e,t,r,i)=>i.length===1&&i[0].protocol==="ip6"?t:`[${t}]`,tcp:(e,t,r,i,n)=>i.some(s=>["http","https","ws","wss"].includes(s.protocol))?`${e}:${t}`:V_(e,t,i,n),udp:(e,t)=>`udp://${e}:${t}`,dnsaddr:Pc,dns4:Pc,dns6:Pc,ipfs:(e,t)=>`${e}/ipfs/${t}`,p2p:(e,t)=>`${e}/p2p/${t}`,http:e=>`http://${e}`,https:e=>`https://${e}`,ws:e=>`ws://${e}`,wss:e=>`wss://${e}`,"p2p-websocket-star":e=>`${e}/p2p-websocket-star`,"p2p-webrtc-star":e=>`${e}/p2p-webrtc-star`,"p2p-webrtc-direct":e=>`${e}/p2p-webrtc-direct`};var X_=(e,t)=>{const r=Er(e),i=e.toString().split("/").slice(1);return r.tuples().map(n=>({protocol:i.shift(),content:n[1]?i.shift():null})).reduce((n,s,a,c)=>{const o=G_[s.protocol];if(!o)throw new Error(`Unsupported protocol ${s.protocol}`);return o(n,s.content,a,c,t)},"")};function K_(){return typeof window!="undefined"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof Ce!="undefined"&&typeof Ce.versions=="object"&&!!Ce.versions.electron?!0:typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0}var W_=K_;const Nc=typeof window=="object"&&typeof document=="object"&&document.nodeType===9,go=W_(),Y_=Nc&&!go,Z_=go&&!Nc,J_=go&&Nc,Q_=typeof xf=="function"&&typeof Ce!="undefined"&&typeof Ce.release!="undefined"&&Ce.release.name==="node"&&!go,eE=typeof importScripts=="function"&&typeof self!="undefined"&&typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope,tE=typeof Ce!="undefined"&&typeof Ce.env!="undefined"&&!1;var Jp={isTest:tE,isElectron:go,isElectronMain:Z_,isElectronRenderer:J_,isNode:Q_,isBrowser:Y_,isWebWorker:eE,isEnvWithDom:Nc};const rE=qr,Nl=qr.v4,Qp=qr.v6,em=function(e,t,r){r=~~r;var i;if(Nl(e))i=t||new Uint8Array(r+4),e.split(/\./g).map(function(l){i[r++]=parseInt(l,10)&255});else if(Qp(e)){var n=e.split(":",8),s;for(s=0;s<n.length;s++){var a=Nl(n[s]),c;a&&(c=em(n[s]),n[s]=Ae(c.slice(0,2),"base16")),c&&++s<8&&n.splice(s,0,Ae(c.slice(2,4),"base16"))}if(n[0]==="")for(;n.length<8;)n.unshift("0");else if(n[n.length-1]==="")for(;n.length<8;)n.push("0");else if(n.length<8){for(s=0;s<n.length&&n[s]!=="";s++);var o=[s,"1"];for(s=9-n.length;s>0;s--)o.push("0");n.splice.apply(n,o)}for(i=t||new Uint8Array(r+16),s=0;s<n.length;s++){var d=parseInt(n[s],16);i[r++]=d>>8&255,i[r++]=d&255}}if(!i)throw Error("Invalid ip address: "+e);return i},iE=function(e,t,r){t=~~t,r=r||e.length-t;var i=[],n;const s=new DataView(e.buffer);if(r===4){for(let a=0;a<r;a++)i.push(e[t+a]);n=i.join(".")}else if(r===16){for(let a=0;a<r;a+=2)i.push(s.getUint16(t+a).toString(16));n=i.join(":"),n=n.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),n=n.replace(/:{3,4}/,"::")}return n};var xc={isIP:rE,isV4:Nl,isV6:Qp,toBytes:em,toString:iE};function Or(e){if(typeof e=="number"){if(Or.codes[e])return Or.codes[e];throw new Error("no protocol with code: "+e)}else if(typeof e=="string"||e instanceof String){if(Or.names[e])return Or.names[e];throw new Error("no protocol with name: "+e)}throw new Error("invalid protocol id type: "+e)}const ri=-1;Or.lengthPrefixedVarSize=ri,Or.V=ri,Or.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,ri,"ip6zone"],[53,ri,"dns","resolvable"],[54,ri,"dns4","resolvable"],[55,ri,"dns6","resolvable"],[56,ri,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,ri,"unix",!1,"path"],[421,ri,"ipfs"],[421,ri,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,ri,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,ri,"memory"]],Or.names={},Or.codes={},Or.table.map(e=>{const t=tm.apply(null,e);Or.codes[t.code]=t,Or.names[t.name]=t}),Or.object=tm;function tm(e,t,r,i,n){return{code:e,size:t,name:r,resolvable:Boolean(i),path:Boolean(n)}}var Bi=Or,rm=bo;function bo(e,t){return t instanceof Uint8Array?bo.toString(e,t):bo.toBytes(e,t)}bo.toString=function(t,r){t=Bi(t);switch(t.code){case 4:case 41:return nE(r);case 6:case 273:case 33:case 132:return nm(r);case 53:case 54:case 55:case 56:case 400:case 777:return aE(r);case 421:return cE(r);case 444:return sm(r);case 445:return sm(r);default:return Ae(r,"base16")}},bo.toBytes=function(t,r){t=Bi(t);switch(t.code){case 4:return im(r);case 41:return im(r);case 6:case 273:case 33:case 132:return xl(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return sE(r);case 421:return oE(r);case 444:return dE(r);case 445:return lE(r);default:return St(r,"base16")}};function im(e){if(!xc.isIP(e))throw new Error("invalid ip address");return xc.toBytes(e)}function nE(e){const t=xc.toString(e);if(!t||!xc.isIP(t))throw new Error("invalid ip address");return t}function xl(e){const t=new ArrayBuffer(2),r=new DataView(t);return r.setUint16(0,e),new Uint8Array(t)}function nm(e){const t=new DataView(e.buffer);return t.getUint16(0)}function sE(e){const t=St(e),r=Uint8Array.from(be.encode(t.length));return mt([r,t],r.length+t.length)}function aE(e){const t=be.decode(e);if(e=e.slice(be.decode.bytes),e.length!==t)throw new Error("inconsistent lengths");return Ae(e)}function oE(e){const t=new en(e).multihash,r=Uint8Array.from(be.encode(t.length));return mt([r,t],r.length+t.length)}function cE(e){const t=be.decode(e),r=e.slice(be.decode.bytes);if(r.length!==t)throw new Error("inconsistent lengths");return Ae(r,"base58btc")}function dE(e){const t=e.split(":");if(t.length!==2)throw new Error("failed to parse onion addr: "+t+" does not contain a port number");if(t[0].length!==16)throw new Error("failed to parse onion addr: "+t[0]+" not a Tor onion address.");const r=kn.decode("b"+t[0]),i=parseInt(t[1],10);if(i<1||i>65536)throw new Error("Port number is not in range(1, 65536)");const n=xl(i);return mt([r,n],r.length+n.length)}function lE(e){const t=e.split(":");if(t.length!==2)throw new Error("failed to parse onion addr: "+t+" does not contain a port number");if(t[0].length!==56)throw new Error("failed to parse onion addr: "+t[0]+" not a Tor onion3 address.");const r=kn.decode("b"+t[0]),i=parseInt(t[1],10);if(i<1||i>65536)throw new Error("Port number is not in range(1, 65536)");const n=xl(i);return mt([r,n],r.length+n.length)}function sm(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2),i=Ae(t,"base32"),n=nm(r);return i+":"+n}var yi={stringToStringTuples:am,stringTuplesToString:om,tuplesToStringTuples:dm,stringTuplesToTuples:cm,bytesToTuples:Ol,tuplesToBytes:lm,bytesToString:uE,stringToBytes:fm,fromString:fE,fromBytes:hm,validateBytes:Dl,isValidBytes:hE,cleanPath:Oc,ParseError:Bl,protoFromTuple:yo,sizeForAddr:um};function am(e){const t=[],r=e.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let i=0;i<r.length;i++){const n=r[i],s=Bi(n);if(s.size===0){t.push([n]);continue}if(i++,i>=r.length)throw Bl("invalid address: "+e);if(s.path){t.push([n,Oc(r.slice(i).join("/"))]);break}t.push([n,r[i]])}return t}function om(e){const t=[];return e.map(r=>{const i=yo(r);t.push(i.name),r.length>1&&t.push(r[1])}),Oc(t.join("/"))}function cm(e){return e.map(t=>{Array.isArray(t)||(t=[t]);const r=yo(t);return t.length>1?[r.code,rm.toBytes(r.code,t[1])]:[r.code]})}function dm(e){return e.map(t=>{const r=yo(t);return t.length>1?[r.code,rm.toString(r.code,t[1])]:[r.code]})}function lm(e){return hm(mt(e.map(t=>{const r=yo(t);let i=Uint8Array.from(be.encode(r.code));return t.length>1&&(i=mt([i,t[1]])),i})))}function um(e,t){if(e.size>0)return e.size/8;if(e.size===0)return 0;{const r=be.decode(t);return r+be.decode.bytes}}function Ol(e){const t=[];let r=0;for(;r<e.length;){const i=be.decode(e,r),n=be.decode.bytes,s=Bi(i),a=um(s,e.slice(r+n));if(a===0){t.push([i]),r+=n;continue}const c=e.slice(r+n,r+n+a);if(r+=a+n,r>e.length)throw Bl("Invalid address Uint8Array: "+Ae(e,"base16"));t.push([i,c])}return t}function uE(e){const t=Ol(e),r=dm(t);return om(r)}function fm(e){e=Oc(e);const t=am(e),r=cm(t);return lm(r)}function fE(e){return fm(e)}function hm(e){const t=Dl(e);if(t)throw t;return Uint8Array.from(e)}function Dl(e){try{Ol(e)}catch(t){return t}}function hE(e){return Dl(e)===void 0}function Oc(e){return"/"+e.trim().split("/").filter(t=>t).join("/")}function Bl(e){return new Error("Error parsing address: "+e)}function yo(e){const t=Bi(e[0]);return t}var pE=ne(function(e,t){const r=Symbol.for("nodejs.util.inspect.custom"),i=new Map,n=rn.proto(function(s){if(!(this instanceof n))return new n(s);if(s==null&&(s=""),s instanceof Uint8Array)this.bytes=yi.fromBytes(s);else if(typeof s=="string"||s instanceof String){if(s.length>0&&s.charAt(0)!=="/")throw new Error(`multiaddr "${s}" must start with a "/"`);this.bytes=yi.fromString(s)}else if(s.bytes&&s.protos&&s.protoCodes)this.bytes=yi.fromBytes(s.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});n.prototype.toString=function(){return yi.bytesToString(this.bytes)},n.prototype.toJSON=n.prototype.toString,n.prototype.toOptions=function(){const a={},c=this.toString().split("/");return a.family=c[1]==="ip4"?"ipv4":"ipv6",a.host=c[2],a.transport=c[3],a.port=parseInt(c[4]),a},n.prototype[r]=function(){return"<Multiaddr "+Ae(this.bytes,"base16")+" - "+yi.bytesToString(this.bytes)+">"},n.prototype.inspect=function(){return"<Multiaddr "+Ae(this.bytes,"base16")+" - "+yi.bytesToString(this.bytes)+">"},n.prototype.protos=function(){return this.protoCodes().map(a=>Object.assign({},Bi(a)))},n.prototype.protoCodes=function(){const a=[],c=this.bytes;let o=0;for(;o<c.length;){const d=be.decode(c,o),l=be.decode.bytes,u=Bi(d),p=yi.sizeForAddr(u,c.slice(o+l));o+=p+l,a.push(d)}return a},n.prototype.protoNames=function(){return this.protos().map(a=>a.name)},n.prototype.tuples=function(){return yi.bytesToTuples(this.bytes)},n.prototype.stringTuples=function(){const a=yi.bytesToTuples(this.bytes);return yi.tuplesToStringTuples(a)},n.prototype.encapsulate=function(a){return a=n(a),n(this.toString()+a.toString())},n.prototype.decapsulate=function(a){a=a.toString();const c=this.toString(),o=c.lastIndexOf(a);if(o<0)throw new Error("Address "+this+" does not contain subaddress: "+a);return n(c.slice(0,o))},n.prototype.decapsulateCode=function(a){const c=this.tuples();for(let o=c.length-1;o>=0;o--)if(c[o][0]===a)return n(yi.tuplesToBytes(c.slice(0,o)));return this},n.prototype.getPeerId=function(){let a=null;try{const c=this.stringTuples().filter(o=>{if(o[0]===Bi.names.ipfs.code)return!0});a=c.pop()[1],a=Ae(new en(a).multihash,"base58btc")}catch(c){a=null}return a},n.prototype.getPath=function(){let a=null;try{a=this.stringTuples().filter(c=>{const o=Bi(c[0]);if(o.path)return!0})[0][1]}catch(c){a=null}return a},n.prototype.equals=function(a){return li(this.bytes,a.bytes)},n.prototype.resolve=async function(){const a=this.protos().find(d=>d.resolvable);if(!a)return[this];const c=i.get(a.name);if(!c)throw G(new Error(`no available resolver for ${a.name}`),"ERR_NO_AVAILABLE_RESOLVER");const o=await c(this);return o.map(d=>n(d))},n.prototype.nodeAddress=function(){const a=this.protoCodes(),c=this.protoNames(),o=this.toString().split("/").slice(1);if(o.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(a[0]!==4&&a[0]!==41&&a[0]!==54&&a[0]!==55)throw new Error(`no protocol with name: "'${c[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(o[2]!=="tcp"&&o[2]!=="udp")throw new Error(`no protocol with name: "'${c[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:a[0]===41||a[0]===55?6:4,address:o[1],port:parseInt(o[3])}},n.fromNodeAddress=function(a,c){if(!a)throw new Error("requires node address object");if(!c)throw new Error("requires transport protocol");let o;switch(a.family){case"IPv4":o="ip4";break;case"IPv6":o="ip6";break;default:throw Error(`Invalid addr family. Got '${a.family}' instead of 'IPv4' or 'IPv6'`)}return n("/"+[o,a.address,c,a.port].join("/"))},n.prototype.isThinWaistAddress=function(a){const c=(a||this).protos();return c.length!==2||c[0].code!==4&&c[0].code!==41?!1:!(c[1].code!==6&&c[1].code!==273)},n.protocols=Bi,n.isName=function(a){return n.isMultiaddr(a)?a.protos().some(c=>c.resolvable):!1},n.resolve=function(a){return!n.isMultiaddr(a)||!n.isName(a)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},n.resolvers=i,t=e.exports=n}),mE=ne(function(e,t){t=e.exports=Yp,t.source=Kp,t.sink=Wp,t.createServer=os,t.connect=Zp}),gE=421,bE=290,yE=6,vE=477,wE=478,SE=2e3,pm={CODE_P2P:gE,CODE_CIRCUIT:bE,CODE_TCP:yE,CODE_WS:vE,CODE_WSS:wE,CLOSE_TIMEOUT:SE},mm=ne(function(e,t){(function(){var r,i=244837814094590,n=(i&16777215)==15715070;function s(E,M,k){E!=null&&(typeof E=="number"?this.fromNumber(E,M,k):M==null&&typeof E!="string"?this.fromString(E,256):this.fromString(E,M))}function a(){return new s(null)}function c(E,M,k,$,ee,te){for(;--te>=0;){var ae=M*this[E++]+k[$]+ee;ee=Math.floor(ae/67108864),k[$++]=ae&67108863}return ee}function o(E,M,k,$,ee,te){for(var ae=M&32767,oe=M>>15;--te>=0;){var Xe=this[E]&32767,At=this[E++]>>15,Ut=oe*Xe+At*ae;Xe=ae*Xe+((Ut&32767)<<15)+k[$]+(ee&1073741823),ee=(Xe>>>30)+(Ut>>>15)+oe*At+(ee>>>30),k[$++]=Xe&1073741823}return ee}function d(E,M,k,$,ee,te){for(var ae=M&16383,oe=M>>14;--te>=0;){var Xe=this[E]&16383,At=this[E++]>>14,Ut=oe*Xe+At*ae;Xe=ae*Xe+((Ut&16383)<<14)+k[$]+ee,ee=(Xe>>28)+(Ut>>14)+oe*At,k[$++]=Xe&268435455}return ee}var l=typeof navigator!="undefined";l&&n&&navigator.appName=="Microsoft Internet Explorer"?(s.prototype.am=o,r=30):l&&n&&navigator.appName!="Netscape"?(s.prototype.am=c,r=26):(s.prototype.am=d,r=28),s.prototype.DB=r,s.prototype.DM=(1<<r)-1,s.prototype.DV=1<<r;var u=52;s.prototype.FV=Math.pow(2,u),s.prototype.F1=u-r,s.prototype.F2=2*r-u;var p="0123456789abcdefghijklmnopqrstuvwxyz",f=new Array,g,v;for(g="0".charCodeAt(0),v=0;v<=9;++v)f[g++]=v;for(g="a".charCodeAt(0),v=10;v<36;++v)f[g++]=v;for(g="A".charCodeAt(0),v=10;v<36;++v)f[g++]=v;function S(E){return p.charAt(E)}function C(E,M){var k=f[E.charCodeAt(M)];return k??-1}function D(E){for(var M=this.t-1;M>=0;--M)E[M]=this[M];E.t=this.t,E.s=this.s}function j(E){this.t=1,this.s=E<0?-1:0,E>0?this[0]=E:E<-1?this[0]=E+this.DV:this.t=0}function m(E){var M=a();return M.fromInt(E),M}function w(E,M){var k;if(M==16)k=4;else if(M==8)k=3;else if(M==256)k=8;else if(M==2)k=1;else if(M==32)k=5;else if(M==4)k=2;else{this.fromRadix(E,M);return}this.t=0,this.s=0;for(var $=E.length,ee=!1,te=0;--$>=0;){var ae=k==8?E[$]&255:C(E,$);if(ae<0){E.charAt($)=="-"&&(ee=!0);continue}ee=!1,te==0?this[this.t++]=ae:te+k>this.DB?(this[this.t-1]|=(ae&(1<<this.DB-te)-1)<<te,this[this.t++]=ae>>this.DB-te):this[this.t-1]|=ae<<te,te+=k,te>=this.DB&&(te-=this.DB)}k==8&&(E[0]&128)!=0&&(this.s=-1,te>0&&(this[this.t-1]|=(1<<this.DB-te)-1<<te)),this.clamp(),ee&&s.ZERO.subTo(this,this)}function R(){for(var E=this.s&this.DM;this.t>0&&this[this.t-1]==E;)--this.t}function h(E){if(this.s<0)return"-"+this.negate().toString(E);var M;if(E==16)M=4;else if(E==8)M=3;else if(E==2)M=1;else if(E==32)M=5;else if(E==4)M=2;else return this.toRadix(E);var k=(1<<M)-1,$,ee=!1,te="",ae=this.t,oe=this.DB-ae*this.DB%M;if(ae-- >0)for(oe<this.DB&&($=this[ae]>>oe)>0&&(ee=!0,te=S($));ae>=0;)oe<M?($=(this[ae]&(1<<oe)-1)<<M-oe,$|=this[--ae]>>(oe+=this.DB-M)):($=this[ae]>>(oe-=M)&k,oe<=0&&(oe+=this.DB,--ae)),$>0&&(ee=!0),ee&&(te+=S($));return ee?te:"0"}function b(){var E=a();return s.ZERO.subTo(this,E),E}function A(){return this.s<0?this.negate():this}function y(E){var M=this.s-E.s;if(M!=0)return M;var k=this.t;if(M=k-E.t,M!=0)return this.s<0?-M:M;for(;--k>=0;)if((M=this[k]-E[k])!=0)return M;return 0}function P(E){var M=1,k;return(k=E>>>16)!=0&&(E=k,M+=16),(k=E>>8)!=0&&(E=k,M+=8),(k=E>>4)!=0&&(E=k,M+=4),(k=E>>2)!=0&&(E=k,M+=2),(k=E>>1)!=0&&(E=k,M+=1),M}function N(){return this.t<=0?0:this.DB*(this.t-1)+P(this[this.t-1]^this.s&this.DM)}function B(E,M){var k;for(k=this.t-1;k>=0;--k)M[k+E]=this[k];for(k=E-1;k>=0;--k)M[k]=0;M.t=this.t+E,M.s=this.s}function L(E,M){for(var k=E;k<this.t;++k)M[k-E]=this[k];M.t=Math.max(this.t-E,0),M.s=this.s}function F(E,M){var k=E%this.DB,$=this.DB-k,ee=(1<<$)-1,te=Math.floor(E/this.DB),ae=this.s<<k&this.DM,oe;for(oe=this.t-1;oe>=0;--oe)M[oe+te+1]=this[oe]>>$|ae,ae=(this[oe]&ee)<<k;for(oe=te-1;oe>=0;--oe)M[oe]=0;M[te]=ae,M.t=this.t+te+1,M.s=this.s,M.clamp()}function z(E,M){M.s=this.s;var k=Math.floor(E/this.DB);if(k>=this.t){M.t=0;return}var $=E%this.DB,ee=this.DB-$,te=(1<<$)-1;M[0]=this[k]>>$;for(var ae=k+1;ae<this.t;++ae)M[ae-k-1]|=(this[ae]&te)<<ee,M[ae-k]=this[ae]>>$;$>0&&(M[this.t-k-1]|=(this.s&te)<<ee),M.t=this.t-k,M.clamp()}function X(E,M){for(var k=0,$=0,ee=Math.min(E.t,this.t);k<ee;)$+=this[k]-E[k],M[k++]=$&this.DM,$>>=this.DB;if(E.t<this.t){for($-=E.s;k<this.t;)$+=this[k],M[k++]=$&this.DM,$>>=this.DB;$+=this.s}else{for($+=this.s;k<E.t;)$-=E[k],M[k++]=$&this.DM,$>>=this.DB;$-=E.s}M.s=$<0?-1:0,$<-1?M[k++]=this.DV+$:$>0&&(M[k++]=$),M.t=k,M.clamp()}function Z(E,M){var k=this.abs(),$=E.abs(),ee=k.t;for(M.t=ee+$.t;--ee>=0;)M[ee]=0;for(ee=0;ee<$.t;++ee)M[ee+k.t]=k.am(0,$[ee],M,ee,0,k.t);M.s=0,M.clamp(),this.s!=E.s&&s.ZERO.subTo(M,M)}function re(E){for(var M=this.abs(),k=E.t=2*M.t;--k>=0;)E[k]=0;for(k=0;k<M.t-1;++k){var $=M.am(k,M[k],E,2*k,0,1);(E[k+M.t]+=M.am(k+1,2*M[k],E,2*k+1,$,M.t-k-1))>=M.DV&&(E[k+M.t]-=M.DV,E[k+M.t+1]=1)}E.t>0&&(E[E.t-1]+=M.am(k,M[k],E,2*k,0,1)),E.s=0,E.clamp()}function ue(E,M,k){var $=E.abs();if($.t<=0)return;var ee=this.abs();if(ee.t<$.t){M!=null&&M.fromInt(0),k!=null&&this.copyTo(k);return}k==null&&(k=a());var te=a(),ae=this.s,oe=E.s,Xe=this.DB-P($[$.t-1]);Xe>0?($.lShiftTo(Xe,te),ee.lShiftTo(Xe,k)):($.copyTo(te),ee.copyTo(k));var At=te.t,Ut=te[At-1];if(Ut==0)return;var er=Ut*(1<<this.F1)+(At>1?te[At-2]>>this.F2:0),Rr=this.FV/er,Ur=(1<<this.F1)/er,cr=1<<this.F2,vt=k.t,qt=vt-At,Xr=M??a();for(te.dlShiftTo(qt,Xr),k.compareTo(Xr)>=0&&(k[k.t++]=1,k.subTo(Xr,k)),s.ONE.dlShiftTo(At,Xr),Xr.subTo(te,te);te.t<At;)te[te.t++]=0;for(;--qt>=0;){var Ji=k[--vt]==Ut?this.DM:Math.floor(k[vt]*Rr+(k[vt-1]+cr)*Ur);if((k[vt]+=te.am(0,Ji,k,qt,0,At))<Ji)for(te.dlShiftTo(qt,Xr),k.subTo(Xr,k);k[vt]<--Ji;)k.subTo(Xr,k)}M!=null&&(k.drShiftTo(At,M),ae!=oe&&s.ZERO.subTo(M,M)),k.t=At,k.clamp(),Xe>0&&k.rShiftTo(Xe,k),ae<0&&s.ZERO.subTo(k,k)}function ge(E){var M=a();return this.abs().divRemTo(E,null,M),this.s<0&&M.compareTo(s.ZERO)>0&&E.subTo(M,M),M}function ye(E){this.m=E}function ve(E){return E.s<0||E.compareTo(this.m)>=0?E.mod(this.m):E}function ce(E){return E}function we(E){E.divRemTo(this.m,null,E)}function nt(E,M,k){E.multiplyTo(M,k),this.reduce(k)}function Ge(E,M){E.squareTo(M),this.reduce(M)}ye.prototype.convert=ve,ye.prototype.revert=ce,ye.prototype.reduce=we,ye.prototype.mulTo=nt,ye.prototype.sqrTo=Ge;function ze(){if(this.t<1)return 0;var E=this[0];if((E&1)==0)return 0;var M=E&3;return M=M*(2-(E&15)*M)&15,M=M*(2-(E&255)*M)&255,M=M*(2-((E&65535)*M&65535))&65535,M=M*(2-E*M%this.DV)%this.DV,M>0?this.DV-M:-M}function jt(E){this.m=E,this.mp=E.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<E.DB-15)-1,this.mt2=2*E.t}function Oe(E){var M=a();return E.abs().dlShiftTo(this.m.t,M),M.divRemTo(this.m,null,M),E.s<0&&M.compareTo(s.ZERO)>0&&this.m.subTo(M,M),M}function $e(E){var M=a();return E.copyTo(M),this.reduce(M),M}function Mt(E){for(;E.t<=this.mt2;)E[E.t++]=0;for(var M=0;M<this.m.t;++M){var k=E[M]&32767,$=k*this.mpl+((k*this.mph+(E[M]>>15)*this.mpl&this.um)<<15)&E.DM;for(k=M+this.m.t,E[k]+=this.m.am(0,$,E,M,0,this.m.t);E[k]>=E.DV;)E[k]-=E.DV,E[++k]++}E.clamp(),E.drShiftTo(this.m.t,E),E.compareTo(this.m)>=0&&E.subTo(this.m,E)}function Ne(E,M){E.squareTo(M),this.reduce(M)}function de(E,M,k){E.multiplyTo(M,k),this.reduce(k)}jt.prototype.convert=Oe,jt.prototype.revert=$e,jt.prototype.reduce=Mt,jt.prototype.mulTo=de,jt.prototype.sqrTo=Ne;function yn(){return(this.t>0?this[0]&1:this.s)==0}function lt(E,M){if(E>4294967295||E<1)return s.ONE;var k=a(),$=a(),ee=M.convert(this),te=P(E)-1;for(ee.copyTo(k);--te>=0;)if(M.sqrTo(k,$),(E&1<<te)>0)M.mulTo($,ee,k);else{var ae=k;k=$,$=ae}return M.revert(k)}function bt(E,M){var k;return E<256||M.isEven()?k=new ye(M):k=new jt(M),this.exp(E,k)}s.prototype.copyTo=D,s.prototype.fromInt=j,s.prototype.fromString=w,s.prototype.clamp=R,s.prototype.dlShiftTo=B,s.prototype.drShiftTo=L,s.prototype.lShiftTo=F,s.prototype.rShiftTo=z,s.prototype.subTo=X,s.prototype.multiplyTo=Z,s.prototype.squareTo=re,s.prototype.divRemTo=ue,s.prototype.invDigit=ze,s.prototype.isEven=yn,s.prototype.exp=lt,s.prototype.toString=h,s.prototype.negate=b,s.prototype.abs=A,s.prototype.compareTo=y,s.prototype.bitLength=N,s.prototype.mod=ge,s.prototype.modPowInt=bt,s.ZERO=m(0),s.ONE=m(1);function br(){var E=a();return this.copyTo(E),E}function ut(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function et(){return this.t==0?this.s:this[0]<<24>>24}function Ci(){return this.t==0?this.s:this[0]<<16>>16}function tt(E){return Math.floor(Math.LN2*this.DB/Math.log(E))}function Ue(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function Ri(E){if(E==null&&(E=10),this.signum()==0||E<2||E>36)return"0";var M=this.chunkSize(E),k=Math.pow(E,M),$=m(k),ee=a(),te=a(),ae="";for(this.divRemTo($,ee,te);ee.signum()>0;)ae=(k+te.intValue()).toString(E).substr(1)+ae,ee.divRemTo($,ee,te);return te.intValue().toString(E)+ae}function ft(E,M){this.fromInt(0),M==null&&(M=10);for(var k=this.chunkSize(M),$=Math.pow(M,k),ee=!1,te=0,ae=0,oe=0;oe<E.length;++oe){var Xe=C(E,oe);if(Xe<0){E.charAt(oe)=="-"&&this.signum()==0&&(ee=!0);continue}ae=M*ae+Xe,++te>=k&&(this.dMultiply($),this.dAddOffset(ae,0),te=0,ae=0)}te>0&&(this.dMultiply(Math.pow(M,te)),this.dAddOffset(ae,0)),ee&&s.ZERO.subTo(this,this)}function yt(E,M,k){if(typeof M=="number")if(E<2)this.fromInt(1);else for(this.fromNumber(E,k),this.testBit(E-1)||this.bitwiseTo(s.ONE.shiftLeft(E-1),ai,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(M);)this.dAddOffset(2,0),this.bitLength()>E&&this.subTo(s.ONE.shiftLeft(E-1),this);else{var $=new Array,ee=E&7;$.length=(E>>3)+1,M.nextBytes($),ee>0?$[0]&=(1<<ee)-1:$[0]=0,this.fromString($,256)}}function vn(){var E=this.t,M=new Array;M[0]=this.s;var k=this.DB-E*this.DB%8,$,ee=0;if(E-- >0)for(k<this.DB&&($=this[E]>>k)!=(this.s&this.DM)>>k&&(M[ee++]=$|this.s<<this.DB-k);E>=0;)k<8?($=(this[E]&(1<<k)-1)<<8-k,$|=this[--E]>>(k+=this.DB-8)):($=this[E]>>(k-=8)&255,k<=0&&(k+=this.DB,--E)),($&128)!=0&&($|=-256),ee==0&&(this.s&128)!=($&128)&&++ee,(ee>0||$!=this.s)&&(M[ee++]=$);return M}function st(E){return this.compareTo(E)==0}function ht(E){return this.compareTo(E)<0?this:E}function Te(E){return this.compareTo(E)>0?this:E}function U(E,M,k){var $,ee,te=Math.min(E.t,this.t);for($=0;$<te;++$)k[$]=M(this[$],E[$]);if(E.t<this.t){for(ee=E.s&this.DM,$=te;$<this.t;++$)k[$]=M(this[$],ee);k.t=this.t}else{for(ee=this.s&this.DM,$=te;$<E.t;++$)k[$]=M(ee,E[$]);k.t=E.t}k.s=M(this.s,E.s),k.clamp()}function _(E,M){return E&M}function q(E){var M=a();return this.bitwiseTo(E,_,M),M}function ai(E,M){return E|M}function Hi(E){var M=a();return this.bitwiseTo(E,ai,M),M}function sr(E,M){return E^M}function yr(E){var M=a();return this.bitwiseTo(E,sr,M),M}function Gr(E,M){return E&~M}function oi(E){var M=a();return this.bitwiseTo(E,Gr,M),M}function Mi(){for(var E=a(),M=0;M<this.t;++M)E[M]=this.DM&~this[M];return E.t=this.t,E.s=~this.s,E}function Vt(E){var M=a();return E<0?this.rShiftTo(-E,M):this.lShiftTo(E,M),M}function Gt(E){var M=a();return E<0?this.lShiftTo(-E,M):this.rShiftTo(E,M),M}function Vi(E){if(E==0)return-1;var M=0;return(E&65535)==0&&(E>>=16,M+=16),(E&255)==0&&(E>>=8,M+=8),(E&15)==0&&(E>>=4,M+=4),(E&3)==0&&(E>>=2,M+=2),(E&1)==0&&++M,M}function ar(){for(var E=0;E<this.t;++E)if(this[E]!=0)return E*this.DB+Vi(this[E]);return this.s<0?this.t*this.DB:-1}function ki(E){for(var M=0;E!=0;)E&=E-1,++M;return M}function Gi(){for(var E=0,M=this.s&this.DM,k=0;k<this.t;++k)E+=ki(this[k]^M);return E}function Xi(E){var M=Math.floor(E/this.DB);return M>=this.t?this.s!=0:(this[M]&1<<E%this.DB)!=0}function Ki(E,M){var k=s.ONE.shiftLeft(E);return this.bitwiseTo(k,M,k),k}function Wi(E){return this.changeBit(E,ai)}function Ft(E){return this.changeBit(E,Gr)}function Br(E){return this.changeBit(E,sr)}function ci(E,M){for(var k=0,$=0,ee=Math.min(E.t,this.t);k<ee;)$+=this[k]+E[k],M[k++]=$&this.DM,$>>=this.DB;if(E.t<this.t){for($+=E.s;k<this.t;)$+=this[k],M[k++]=$&this.DM,$>>=this.DB;$+=this.s}else{for($+=this.s;k<E.t;)$+=E[k],M[k++]=$&this.DM,$>>=this.DB;$+=E.s}M.s=$<0?-1:0,$>0?M[k++]=$:$<-1&&(M[k++]=this.DV+$),M.t=k,M.clamp()}function Zn(E){var M=a();return this.addTo(E,M),M}function Jn(E){var M=a();return this.subTo(E,M),M}function Yi(E){var M=a();return this.multiplyTo(E,M),M}function Pi(){var E=a();return this.squareTo(E),E}function Pa(E){var M=a();return this.divRemTo(E,M,null),M}function Na(E){var M=a();return this.divRemTo(E,null,M),M}function xa(E){var M=a(),k=a();return this.divRemTo(E,M,k),new Array(M,k)}function Oa(E){this[this.t]=this.am(0,E-1,this,0,0,this.t),++this.t,this.clamp()}function wn(E,M){if(E==0)return;for(;this.t<=M;)this[this.t++]=0;for(this[M]+=E;this[M]>=this.DV;)this[M]-=this.DV,++M>=this.t&&(this[this.t++]=0),++this[M]}function or(){}function Qn(E){return E}function di(E,M,k){E.multiplyTo(M,k)}function Da(E,M){E.squareTo(M)}or.prototype.convert=Qn,or.prototype.revert=Qn,or.prototype.mulTo=di,or.prototype.sqrTo=Da;function Ba(E){return this.exp(E,new or)}function La(E,M,k){var $=Math.min(this.t+E.t,M);for(k.s=0,k.t=$;$>0;)k[--$]=0;var ee;for(ee=k.t-this.t;$<ee;++$)k[$+this.t]=this.am(0,E[$],k,$,0,this.t);for(ee=Math.min(E.t,M);$<ee;++$)this.am(0,E[$],k,$,0,M-$);k.clamp()}function ja(E,M,k){--M;var $=k.t=this.t+E.t-M;for(k.s=0;--$>=0;)k[$]=0;for($=Math.max(M-this.t,0);$<E.t;++$)k[this.t+$-M]=this.am(M-$,E[$],k,0,0,this.t+$-M);k.clamp(),k.drShiftTo(1,k)}function Lr(E){this.r2=a(),this.q3=a(),s.ONE.dlShiftTo(2*E.t,this.r2),this.mu=this.r2.divide(E),this.m=E}function jr(E){if(E.s<0||E.t>2*this.m.t)return E.mod(this.m);if(E.compareTo(this.m)<0)return E;var M=a();return E.copyTo(M),this.reduce(M),M}function Sn(E){return E}function es(E){for(E.drShiftTo(this.m.t-1,this.r2),E.t>this.m.t+1&&(E.t=this.m.t+1,E.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);E.compareTo(this.r2)<0;)E.dAddOffset(1,this.m.t+1);for(E.subTo(this.r2,E);E.compareTo(this.m)>=0;)E.subTo(this.m,E)}function Fa(E,M){E.squareTo(M),this.reduce(M)}function _n(E,M,k){E.multiplyTo(M,k),this.reduce(k)}Lr.prototype.convert=jr,Lr.prototype.revert=Sn,Lr.prototype.reduce=es,Lr.prototype.mulTo=_n,Lr.prototype.sqrTo=Fa;function Os(E,M){var k=E.bitLength(),$,ee=m(1),te;if(k<=0)return ee;k<18?$=1:k<48?$=3:k<144?$=4:k<768?$=5:$=6,k<8?te=new ye(M):M.isEven()?te=new Lr(M):te=new jt(M);var ae=new Array,oe=3,Xe=$-1,At=(1<<$)-1;if(ae[1]=te.convert(this),$>1){var Ut=a();for(te.sqrTo(ae[1],Ut);oe<=At;)ae[oe]=a(),te.mulTo(Ut,ae[oe-2],ae[oe]),oe+=2}var er=E.t-1,Rr,Ur=!0,cr=a(),vt;for(k=P(E[er])-1;er>=0;){for(k>=Xe?Rr=E[er]>>k-Xe&At:(Rr=(E[er]&(1<<k+1)-1)<<Xe-k,er>0&&(Rr|=E[er-1]>>this.DB+k-Xe)),oe=$;(Rr&1)==0;)Rr>>=1,--oe;if((k-=oe)<0&&(k+=this.DB,--er),Ur)ae[Rr].copyTo(ee),Ur=!1;else{for(;oe>1;)te.sqrTo(ee,cr),te.sqrTo(cr,ee),oe-=2;oe>0?te.sqrTo(ee,cr):(vt=ee,ee=cr,cr=vt),te.mulTo(cr,ae[Rr],ee)}for(;er>=0&&(E[er]&1<<k)==0;)te.sqrTo(ee,cr),vt=ee,ee=cr,cr=vt,--k<0&&(k=this.DB-1,--er)}return te.revert(ee)}function Fr(E){var M=this.s<0?this.negate():this.clone(),k=E.s<0?E.negate():E.clone();if(M.compareTo(k)<0){var $=M;M=k,k=$}var ee=M.getLowestSetBit(),te=k.getLowestSetBit();if(te<0)return M;for(ee<te&&(te=ee),te>0&&(M.rShiftTo(te,M),k.rShiftTo(te,k));M.signum()>0;)(ee=M.getLowestSetBit())>0&&M.rShiftTo(ee,M),(ee=k.getLowestSetBit())>0&&k.rShiftTo(ee,k),M.compareTo(k)>=0?(M.subTo(k,M),M.rShiftTo(1,M)):(k.subTo(M,k),k.rShiftTo(1,k));return te>0&&k.lShiftTo(te,k),k}function Ua(E){if(E<=0)return 0;var M=this.DV%E,k=this.s<0?E-1:0;if(this.t>0)if(M==0)k=this[0]%E;else for(var $=this.t-1;$>=0;--$)k=(M*k+this[$])%E;return k}function qa(E){var M=E.isEven();if(this.isEven()&&M||E.signum()==0)return s.ZERO;for(var k=E.clone(),$=this.clone(),ee=m(1),te=m(0),ae=m(0),oe=m(1);k.signum()!=0;){for(;k.isEven();)k.rShiftTo(1,k),M?((!ee.isEven()||!te.isEven())&&(ee.addTo(this,ee),te.subTo(E,te)),ee.rShiftTo(1,ee)):te.isEven()||te.subTo(E,te),te.rShiftTo(1,te);for(;$.isEven();)$.rShiftTo(1,$),M?((!ae.isEven()||!oe.isEven())&&(ae.addTo(this,ae),oe.subTo(E,oe)),ae.rShiftTo(1,ae)):oe.isEven()||oe.subTo(E,oe),oe.rShiftTo(1,oe);k.compareTo($)>=0?(k.subTo($,k),M&&ee.subTo(ae,ee),te.subTo(oe,te)):($.subTo(k,$),M&&ae.subTo(ee,ae),oe.subTo(te,oe))}if($.compareTo(s.ONE)!=0)return s.ZERO;if(oe.compareTo(E)>=0)return oe.subtract(E);if(oe.signum()<0)oe.addTo(E,oe);else return oe;return oe.signum()<0?oe.add(E):oe}var Dt=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],za=(1<<26)/Dt[Dt.length-1];function $a(E){var M,k=this.abs();if(k.t==1&&k[0]<=Dt[Dt.length-1]){for(M=0;M<Dt.length;++M)if(k[0]==Dt[M])return!0;return!1}if(k.isEven())return!1;for(M=1;M<Dt.length;){for(var $=Dt[M],ee=M+1;ee<Dt.length&&$<za;)$*=Dt[ee++];for($=k.modInt($);M<ee;)if($%Dt[M++]==0)return!1}return k.millerRabin(E)}function En(E){var M=this.subtract(s.ONE),k=M.getLowestSetBit();if(k<=0)return!1;var $=M.shiftRight(k);E=E+1>>1,E>Dt.length&&(E=Dt.length);for(var ee=a(),te=0;te<E;++te){ee.fromInt(Dt[Math.floor(Math.random()*Dt.length)]);var ae=ee.modPow($,this);if(ae.compareTo(s.ONE)!=0&&ae.compareTo(M)!=0){for(var oe=1;oe++<k&&ae.compareTo(M)!=0;)if(ae=ae.modPowInt(2,this),ae.compareTo(s.ONE)==0)return!1;if(ae.compareTo(M)!=0)return!1}}return!0}s.prototype.chunkSize=tt,s.prototype.toRadix=Ri,s.prototype.fromRadix=ft,s.prototype.fromNumber=yt,s.prototype.bitwiseTo=U,s.prototype.changeBit=Ki,s.prototype.addTo=ci,s.prototype.dMultiply=Oa,s.prototype.dAddOffset=wn,s.prototype.multiplyLowerTo=La,s.prototype.multiplyUpperTo=ja,s.prototype.modInt=Ua,s.prototype.millerRabin=En,s.prototype.clone=br,s.prototype.intValue=ut,s.prototype.byteValue=et,s.prototype.shortValue=Ci,s.prototype.signum=Ue,s.prototype.toByteArray=vn,s.prototype.equals=st,s.prototype.min=ht,s.prototype.max=Te,s.prototype.and=q,s.prototype.or=Hi,s.prototype.xor=yr,s.prototype.andNot=oi,s.prototype.not=Mi,s.prototype.shiftLeft=Vt,s.prototype.shiftRight=Gt,s.prototype.getLowestSetBit=ar,s.prototype.bitCount=Gi,s.prototype.testBit=Xi,s.prototype.setBit=Wi,s.prototype.clearBit=Ft,s.prototype.flipBit=Br,s.prototype.add=Zn,s.prototype.subtract=Jn,s.prototype.multiply=Yi,s.prototype.divide=Pa,s.prototype.remainder=Na,s.prototype.divideAndRemainder=xa,s.prototype.modPow=Os,s.prototype.modInverse=qa,s.prototype.pow=Ba,s.prototype.gcd=Fr,s.prototype.isProbablePrime=$a,s.prototype.square=Pi,s.prototype.Barrett=Lr;var An,Qt,rt;function Ha(E){Qt[rt++]^=E&255,Qt[rt++]^=E>>8&255,Qt[rt++]^=E>>16&255,Qt[rt++]^=E>>24&255,rt>=Cn&&(rt-=Cn)}function Ds(){Ha(new Date().getTime())}if(Qt==null){Qt=new Array,rt=0;var vr;if(typeof window!="undefined"&&window.crypto){if(window.crypto.getRandomValues){var Bs=new Uint8Array(32);for(window.crypto.getRandomValues(Bs),vr=0;vr<32;++vr)Qt[rt++]=Bs[vr]}else if(navigator.appName=="Netscape"&&navigator.appVersion<"5"){var Zi=window.crypto.random(32);for(vr=0;vr<Zi.length;++vr)Qt[rt++]=Zi.charCodeAt(vr)&255}}for(;rt<Cn;)vr=Math.floor(65536*Math.random()),Qt[rt++]=vr>>>8,Qt[rt++]=vr&255;rt=0,Ds()}function ts(){if(An==null){for(Ds(),An=Ga(),An.init(Qt),rt=0;rt<Qt.length;++rt)Qt[rt]=0;rt=0}return An.next()}function In(E){var M;for(M=0;M<E.length;++M)E[M]=ts()}function rs(){}rs.prototype.nextBytes=In;function Tn(){this.i=0,this.j=0,this.S=new Array}function Va(E){var M,k,$;for(M=0;M<256;++M)this.S[M]=M;for(k=0,M=0;M<256;++M)k=k+this.S[M]+E[M%E.length]&255,$=this.S[M],this.S[M]=this.S[k],this.S[k]=$;this.i=0,this.j=0}function is(){var E;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,E=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=E,this.S[E+this.S[this.i]&255]}Tn.prototype.init=Va,Tn.prototype.next=is;function Ga(){return new Tn}var Cn=256;t=e.exports={default:s,BigInteger:s,SecureRandom:rs}}).call(se)}),vi=ne(function(e,t){var r=t.falseIfInvalid=function(i){return function(){return this.valid?i.apply(this,arguments):!1}};t.isInSubnet=r(function(i){return this.subnetMask<i.subnetMask?!1:this.mask(i.subnetMask)===i.mask()}),t.isCorrect=function(i){return r(function(){return this.addressMinusSuffix!==this.correctForm()?!1:this.subnetMask===i&&!this.parsedSubnet?!0:this.parsedSubnet===String(this.subnetMask)})}}),vo=ne(function(e,t){!function(){var r={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function i(o){return s(c(o),arguments)}function n(o,d){return i.apply(null,[o].concat(d||[]))}function s(o,d){var l=1,u=o.length,p,f="",g,v,S,C,D,j,m,w;for(g=0;g<u;g++)if(typeof o[g]=="string")f+=o[g];else if(typeof o[g]=="object"){if(S=o[g],S.keys)for(p=d[l],v=0;v<S.keys.length;v++){if(p==null)throw new Error(i('[sprintf] Cannot access property "%s" of undefined value "%s"',S.keys[v],S.keys[v-1]));p=p[S.keys[v]]}else S.param_no?p=d[S.param_no]:p=d[l++];if(r.not_type.test(S.type)&&r.not_primitive.test(S.type)&&p instanceof Function&&(p=p()),r.numeric_arg.test(S.type)&&typeof p!="number"&&isNaN(p))throw new TypeError(i("[sprintf] expecting number but found %T",p));r.number.test(S.type)&&(m=p>=0);switch(S.type){case"b":p=parseInt(p,10).toString(2);break;case"c":p=String.fromCharCode(parseInt(p,10));break;case"d":case"i":p=parseInt(p,10);break;case"j":p=JSON.stringify(p,null,S.width?parseInt(S.width):0);break;case"e":p=S.precision?parseFloat(p).toExponential(S.precision):parseFloat(p).toExponential();break;case"f":p=S.precision?parseFloat(p).toFixed(S.precision):parseFloat(p);break;case"g":p=S.precision?String(Number(p.toPrecision(S.precision))):parseFloat(p);break;case"o":p=(parseInt(p,10)>>>0).toString(8);break;case"s":p=String(p),p=S.precision?p.substring(0,S.precision):p;break;case"t":p=String(!!p),p=S.precision?p.substring(0,S.precision):p;break;case"T":p=Object.prototype.toString.call(p).slice(8,-1).toLowerCase(),p=S.precision?p.substring(0,S.precision):p;break;case"u":p=parseInt(p,10)>>>0;break;case"v":p=p.valueOf(),p=S.precision?p.substring(0,S.precision):p;break;case"x":p=(parseInt(p,10)>>>0).toString(16);break;case"X":p=(parseInt(p,10)>>>0).toString(16).toUpperCase();break}r.json.test(S.type)?f+=p:(r.number.test(S.type)&&(!m||S.sign)?(w=m?"+":"-",p=p.toString().replace(r.sign,"")):w="",D=S.pad_char?S.pad_char==="0"?"0":S.pad_char.charAt(1):" ",j=S.width-(w+p).length,C=S.width&&j>0?D.repeat(j):"",f+=S.align?w+p+C:D==="0"?w+C+p:C+w+p)}return f}var a=Object.create(null);function c(o){if(a[o])return a[o];for(var d=o,l,u=[],p=0;d;){if((l=r.text.exec(d))!==null)u.push(l[0]);else if((l=r.modulo.exec(d))!==null)u.push("%");else if((l=r.placeholder.exec(d))!==null){if(l[2]){p|=1;var f=[],g=l[2],v=[];if((v=r.key.exec(g))!==null)for(f.push(v[1]);(g=g.substring(v[0].length))!=="";)if((v=r.key_access.exec(g))!==null)f.push(v[1]);else if((v=r.index_access.exec(g))!==null)f.push(v[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");l[2]=f}else p|=2;if(p===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");u.push({placeholder:l[0],param_no:l[1],keys:l[2],sign:l[3],pad_char:l[4],align:l[5],width:l[6],precision:l[7],type:l[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");d=d.substring(l[0].length)}return a[o]=u}t.sprintf=i,t.vsprintf=n,typeof window!="undefined"&&(window.sprintf=i,window.vsprintf=n)}()}),Ll=1/0,_E=9007199254740991,EE=17976931348623157e292,gm=0/0,AE="[object Symbol]",IE=/^\s+|\s+$/g,TE=/^[-+]0x[0-9a-f]+$/i,CE=/^0b[01]+$/i,RE=/^0o[0-7]+$/i,jl="\\ud800-\\udfff",bm="\\u0300-\\u036f\\ufe20-\\ufe23",ym="\\u20d0-\\u20f0",vm="\\ufe0e\\ufe0f",ME="["+jl+"]",Fl="["+bm+ym+"]",Ul="\\ud83c[\\udffb-\\udfff]",kE="(?:"+Fl+"|"+Ul+")",wm="[^"+jl+"]",Sm="(?:\\ud83c[\\udde6-\\uddff]){2}",_m="[\\ud800-\\udbff][\\udc00-\\udfff]",Em="\\u200d",Am=kE+"?",Im="["+vm+"]?",PE="(?:"+Em+"(?:"+[wm,Sm,_m].join("|")+")"+Im+Am+")*",NE=Im+Am+PE,xE="(?:"+[wm+Fl+"?",Fl,Sm,_m,ME].join("|")+")",ql=RegExp(Ul+"(?="+Ul+")|"+xE+NE,"g"),OE=RegExp("["+Em+jl+bm+ym+vm+"]"),DE=parseInt,BE=typeof se=="object"&&se&&se.Object===Object&&se,LE=typeof self=="object"&&self&&self.Object===Object&&self,jE=BE||LE||Function("return this")(),FE=qE("length");function UE(e){return e.split("")}function qE(e){return function(t){return t==null?void 0:t[e]}}function zl(e){return OE.test(e)}function Tm(e){return zl(e)?$E(e):FE(e)}function zE(e){return zl(e)?HE(e):UE(e)}function $E(e){for(var t=ql.lastIndex=0;ql.test(e);)t++;return t}function HE(e){return e.match(ql)||[]}var VE=Object.prototype,GE=VE.toString,Cm=jE.Symbol,XE=Math.ceil,KE=Math.floor,Rm=Cm?Cm.prototype:void 0,Mm=Rm?Rm.toString:void 0;function km(e,t){var r="";if(!e||t<1||t>_E)return r;do t%2&&(r+=e),t=KE(t/2),t&&(e+=e);while(t);return r}function WE(e,t,r){var i=-1,n=e.length;t<0&&(t=-t>n?0:n+t),r=r>n?n:r,r<0&&(r+=n),n=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(n);++i<n;)s[i]=e[i+t];return s}function Pm(e){if(typeof e=="string")return e;if(xm(e))return Mm?Mm.call(e):"";var t=e+"";return t=="0"&&1/e==-Ll?"-0":t}function YE(e,t,r){var i=e.length;return r=r===void 0?i:r,!t&&r>=i?e:WE(e,t,r)}function ZE(e,t){t=t===void 0?" ":Pm(t);var r=t.length;if(r<2)return r?km(t,e):t;var i=km(t,XE(e/Tm(t)));return zl(t)?YE(zE(i),0,e).join(""):i.slice(0,e)}function Nm(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function JE(e){return!!e&&typeof e=="object"}function xm(e){return typeof e=="symbol"||JE(e)&&GE.call(e)==AE}function QE(e){if(!e)return e===0?e:0;if(e=tA(e),e===Ll||e===-Ll){var t=e<0?-1:1;return t*EE}return e===e?e:0}function eA(e){var t=QE(e),r=t%1;return t===t?r?t-r:t:0}function tA(e){if(typeof e=="number")return e;if(xm(e))return gm;if(Nm(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Nm(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(IE,"");var r=CE.test(e);return r||RE.test(e)?DE(e.slice(2),r?2:8):TE.test(e)?gm:+e}function rA(e){return e==null?"":Pm(e)}function iA(e,t,r){e=rA(e),t=eA(t);var i=t?Tm(e):0;return t&&i<t?ZE(t-i,r)+e:e}var wo=iA,$l=1/0,Hl=9007199254740991,nA=17976931348623157e292,Om=0/0,sA="[object Function]",aA="[object GeneratorFunction]",oA="[object Symbol]",cA=/^\s+|\s+$/g,dA=/^[-+]0x[0-9a-f]+$/i,lA=/^0b[01]+$/i,uA=/^0o[0-7]+$/i,fA=/^(?:0|[1-9]\d*)$/,hA=parseInt,pA=typeof se=="object"&&se&&se.Object===Object&&se,mA=typeof self=="object"&&self&&self.Object===Object&&self,gA=pA||mA||Function("return this")(),bA=Object.prototype,Dm=bA.toString,Bm=gA.Symbol,yA=Math.floor,Lm=Bm?Bm.prototype:void 0,jm=Lm?Lm.toString:void 0;function vA(e,t){var r="";if(!e||t<1||t>Hl)return r;do t%2&&(r+=e),t=yA(t/2),t&&(e+=e);while(t);return r}function wA(e){if(typeof e=="string")return e;if(Fm(e))return jm?jm.call(e):"";var t=e+"";return t=="0"&&1/e==-$l?"-0":t}function SA(e,t){return t=t??Hl,!!t&&(typeof e=="number"||fA.test(e))&&(e>-1&&e%1==0)&&e<t}function _A(e,t,r){if(!Dc(r))return!1;var i=typeof t;return(i=="number"?AA(r)&&SA(t,r.length):i=="string"&&t in r)?EA(r[t],e):!1}function EA(e,t){return e===t||e!==e&&t!==t}function AA(e){return e!=null&&TA(e.length)&&!IA(e)}function IA(e){var t=Dc(e)?Dm.call(e):"";return t==sA||t==aA}function TA(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Hl}function Dc(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function CA(e){return!!e&&typeof e=="object"}function Fm(e){return typeof e=="symbol"||CA(e)&&Dm.call(e)==oA}function RA(e){if(!e)return e===0?e:0;if(e=kA(e),e===$l||e===-$l){var t=e<0?-1:1;return t*nA}return e===e?e:0}function MA(e){var t=RA(e),r=t%1;return t===t?r?t-r:t:0}function kA(e){if(typeof e=="number")return e;if(Fm(e))return Om;if(Dc(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Dc(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(cA,"");var r=lA.test(e);return r||uA.test(e)?hA(e.slice(2),r?2:8):dA.test(e)?Om:+e}function PA(e){return e==null?"":wA(e)}function NA(e,t,r){return(r?_A(e,t,r):t===void 0)?t=1:t=MA(t),vA(PA(e),t)}var Bc=NA,xA=32,OA=4,DA=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/g,BA=/\/\d{1,2}$/,Ir={BITS:xA,GROUPS:OA,RE_ADDRESS:DA,RE_SUBNET_STRING:BA},So=mm.BigInteger,Lc=vo.sprintf;function Je(e){this.valid=!1,this.address=e,this.groups=Ir.GROUPS,this.v4=!0,this.subnet="/32",this.subnetMask=32;var t=Ir.RE_SUBNET_STRING.exec(e);if(t){if(this.parsedSubnet=t[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,this.subnetMask<0||this.subnetMask>Ir.BITS){this.valid=!1,this.error="Invalid subnet mask.";return}e=e.replace(Ir.RE_SUBNET_STRING,"")}this.addressMinusSuffix=e,this.parsedAddress=this.parse(e)}Je.prototype.parse=function(e){var t=e.split(".");return e.match(Ir.RE_ADDRESS)?this.valid=!0:this.error="Invalid IPv4 address.",t},Je.prototype.isValid=function(){return this.valid},Je.prototype.correctForm=function(){return this.parsedAddress.map(function(e){return parseInt(e,10)}).join(".")},Je.prototype.isCorrect=vi.isCorrect(Ir.BITS),Je.fromHex=function(e){var t=wo(e.replace(/:/g,""),8,"0"),r=[],i;for(i=0;i<8;i+=2){var n=t.slice(i,i+2);r.push(parseInt(n,16))}return new Je(r.join("."))},Je.fromInteger=function(e){return Je.fromHex(e.toString(16))},Je.prototype.toHex=function(){return this.parsedAddress.map(function(e){return Lc("%02x",parseInt(e,10))}).join(":")},Je.prototype.toArray=function(){return this.parsedAddress.map(function(e){return parseInt(e,10)})},Je.prototype.toGroup6=function(){var e=[],t;for(t=0;t<Ir.GROUPS;t+=2){var r=Lc("%02x%02x",parseInt(this.parsedAddress[t],10),parseInt(this.parsedAddress[t+1],10));e.push(Lc("%x",parseInt(r,16)))}return e.join(":")},Je.prototype.bigInteger=function(){return this.valid?new So(this.parsedAddress.map(function(e){return Lc("%02x",parseInt(e,10))}).join(""),16):null},Je.prototype._startAddress=function(){return new So(this.mask()+Bc("0",Ir.BITS-this.subnetMask),2)},Je.prototype.startAddress=function(){return Je.fromBigInteger(this._startAddress())},Je.prototype.startAddressExclusive=function(){var e=new So("1");return Je.fromBigInteger(this._startAddress().add(e))},Je.prototype._endAddress=function(){return new So(this.mask()+Bc("1",Ir.BITS-this.subnetMask),2)},Je.prototype.endAddress=function(){return Je.fromBigInteger(this._endAddress())},Je.prototype.endAddressExclusive=function(){var e=new So("1");return Je.fromBigInteger(this._endAddress().subtract(e))},Je.fromBigInteger=function(e){return Je.fromInteger(parseInt(e.toString(),10))},Je.prototype.mask=function(e){return e===void 0&&(e=this.subnetMask),this.getBitsBase2(0,e)},Je.prototype.getBitsBase2=function(e,t){return this.binaryZeroPad().slice(e,t)},Je.prototype.isInSubnet=vi.isInSubnet,Je.prototype.isMulticast=function(){return this.isInSubnet(new Je("224.0.0.0/4"))},Je.prototype.binaryZeroPad=function(){return wo(this.bigInteger().toString(2),Ir.BITS,"0")};var ms=Je,Vl=ne(function(e,t){var r=200,i="__lodash_hash_undefined__",n=800,s=16,a=9007199254740991,c="[object Arguments]",o="[object Array]",d="[object AsyncFunction]",l="[object Boolean]",u="[object Date]",p="[object Error]",f="[object Function]",g="[object GeneratorFunction]",v="[object Map]",S="[object Number]",C="[object Null]",D="[object Object]",j="[object Proxy]",m="[object RegExp]",w="[object Set]",R="[object String]",h="[object Undefined]",b="[object WeakMap]",A="[object ArrayBuffer]",y="[object DataView]",P="[object Float32Array]",N="[object Float64Array]",B="[object Int8Array]",L="[object Int16Array]",F="[object Int32Array]",z="[object Uint8Array]",X="[object Uint8ClampedArray]",Z="[object Uint16Array]",re="[object Uint32Array]",ue=/[\\^$.*+?()[\]{}|]/g,ge=/^\[object .+?Constructor\]$/,ye=/^(?:0|[1-9]\d*)$/,ve={};ve[P]=ve[N]=ve[B]=ve[L]=ve[F]=ve[z]=ve[X]=ve[Z]=ve[re]=!0,ve[c]=ve[o]=ve[A]=ve[l]=ve[y]=ve[u]=ve[p]=ve[f]=ve[v]=ve[S]=ve[D]=ve[m]=ve[w]=ve[R]=ve[b]=!1;var ce=typeof se=="object"&&se&&se.Object===Object&&se,we=typeof self=="object"&&self&&self.Object===Object&&self,nt=ce||we||Function("return this")(),Ge=t&&!t.nodeType&&t,ze=Ge&&!0&&e&&!e.nodeType&&e,jt=ze&&ze.exports===Ge,Oe=jt&&ce.process,$e=function(){try{var x=ze&&ze.require&&ze.require("util").types;return x||Oe&&Oe.binding&&Oe.binding("util")}catch(H){}}(),Mt=$e&&$e.isTypedArray;function Ne(x,H,Y){switch(Y.length){case 0:return x.call(H);case 1:return x.call(H,Y[0]);case 2:return x.call(H,Y[0],Y[1]);case 3:return x.call(H,Y[0],Y[1],Y[2])}return x.apply(H,Y)}function de(x,H){for(var Y=-1,he=Array(x);++Y<x;)he[Y]=H(Y);return he}function yn(x){return function(H){return x(H)}}function lt(x,H){return x==null?void 0:x[H]}function bt(x,H){return function(Y){return x(H(Y))}}var br=Array.prototype,ut=Function.prototype,et=Object.prototype,Ci=nt["__core-js_shared__"],tt=ut.toString,Ue=et.hasOwnProperty,Ri=function(){var x=/[^.]+$/.exec(Ci&&Ci.keys&&Ci.keys.IE_PROTO||"");return x?"Symbol(src)_1."+x:""}(),ft=et.toString,yt=tt.call(Object),vn=RegExp("^"+tt.call(Ue).replace(ue,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),st=jt?nt.Buffer:void 0,ht=nt.Symbol,Te=nt.Uint8Array,U=st?st.allocUnsafe:void 0,_=bt(Object.getPrototypeOf,Object),q=Object.create,ai=et.propertyIsEnumerable,Hi=br.splice,sr=ht?ht.toStringTag:void 0,yr=function(){try{var x=ts(Object,"defineProperty");return x({},"",{}),x}catch(H){}}(),Gr=st?st.isBuffer:void 0,oi=Math.max,Mi=Date.now,Vt=ts(nt,"Map"),Gt=ts(Object,"create"),Vi=function(){function x(){}return function(H){if(!vt(H))return{};if(q)return q(H);x.prototype=H;var Y=new x;return x.prototype=void 0,Y}}();function ar(x){var H=-1,Y=x==null?0:x.length;for(this.clear();++H<Y;){var he=x[H];this.set(he[0],he[1])}}function ki(){this.__data__=Gt?Gt(null):{},this.size=0}function Gi(x){var H=this.has(x)&&delete this.__data__[x];return this.size-=H?1:0,H}function Xi(x){var H=this.__data__;if(Gt){var Y=H[x];return Y===i?void 0:Y}return Ue.call(H,x)?H[x]:void 0}function Ki(x){var H=this.__data__;return Gt?H[x]!==void 0:Ue.call(H,x)}function Wi(x,H){var Y=this.__data__;return this.size+=this.has(x)?0:1,Y[x]=Gt&&H===void 0?i:H,this}ar.prototype.clear=ki,ar.prototype.delete=Gi,ar.prototype.get=Xi,ar.prototype.has=Ki,ar.prototype.set=Wi;function Ft(x){var H=-1,Y=x==null?0:x.length;for(this.clear();++H<Y;){var he=x[H];this.set(he[0],he[1])}}function Br(){this.__data__=[],this.size=0}function ci(x){var H=this.__data__,Y=Sn(H,x);if(Y<0)return!1;var he=H.length-1;return Y==he?H.pop():Hi.call(H,Y,1),--this.size,!0}function Zn(x){var H=this.__data__,Y=Sn(H,x);return Y<0?void 0:H[Y][1]}function Jn(x){return Sn(this.__data__,x)>-1}function Yi(x,H){var Y=this.__data__,he=Sn(Y,x);return he<0?(++this.size,Y.push([x,H])):Y[he][1]=H,this}Ft.prototype.clear=Br,Ft.prototype.delete=ci,Ft.prototype.get=Zn,Ft.prototype.has=Jn,Ft.prototype.set=Yi;function Pi(x){var H=-1,Y=x==null?0:x.length;for(this.clear();++H<Y;){var he=x[H];this.set(he[0],he[1])}}function Pa(){this.size=0,this.__data__={hash:new ar,map:new(Vt||Ft),string:new ar}}function Na(x){var H=Zi(this,x).delete(x);return this.size-=H?1:0,H}function xa(x){return Zi(this,x).get(x)}function Oa(x){return Zi(this,x).has(x)}function wn(x,H){var Y=Zi(this,x),he=Y.size;return Y.set(x,H),this.size+=Y.size==he?0:1,this}Pi.prototype.clear=Pa,Pi.prototype.delete=Na,Pi.prototype.get=xa,Pi.prototype.has=Oa,Pi.prototype.set=wn;function or(x){var H=this.__data__=new Ft(x);this.size=H.size}function Qn(){this.__data__=new Ft,this.size=0}function di(x){var H=this.__data__,Y=H.delete(x);return this.size=H.size,Y}function Da(x){return this.__data__.get(x)}function Ba(x){return this.__data__.has(x)}function La(x,H){var Y=this.__data__;if(Y instanceof Ft){var he=Y.__data__;if(!Vt||he.length<r-1)return he.push([x,H]),this.size=++Y.size,this;Y=this.__data__=new Pi(he)}return Y.set(x,H),this.size=Y.size,this}or.prototype.clear=Qn,or.prototype.delete=di,or.prototype.get=Da,or.prototype.has=Ba,or.prototype.set=La;function ja(x,H){var Y=At(x),he=!Y&&Xe(x),Le=!Y&&!he&&Rr(x),Ze=!Y&&!he&&!Le&&Ji(x),pt=Y||he||Le||Ze,De=pt?de(x.length,String):[],Ke=De.length;for(var dr in x)(H||Ue.call(x,dr))&&!(pt&&(dr=="length"||Le&&(dr=="offset"||dr=="parent")||Ze&&(dr=="buffer"||dr=="byteLength"||dr=="byteOffset")||Tn(dr,Ke)))&&De.push(dr);return De}function Lr(x,H,Y){(Y!==void 0&&!oe(x[H],Y)||Y===void 0&&!(H in x))&&es(x,H,Y)}function jr(x,H,Y){var he=x[H];(!(Ue.call(x,H)&&oe(he,Y))||Y===void 0&&!(H in x))&&es(x,H,Y)}function Sn(x,H){for(var Y=x.length;Y--;)if(oe(x[Y][0],H))return Y;return-1}function es(x,H,Y){H=="__proto__"&&yr?yr(x,H,{configurable:!0,enumerable:!0,value:Y,writable:!0}):x[H]=Y}var Fa=Bs();function _n(x){return x==null?x===void 0?h:C:sr&&sr in Object(x)?In(x):M(x)}function Os(x){return qt(x)&&_n(x)==c}function Fr(x){if(!vt(x)||Ga(x))return!1;var H=Ur(x)?vn:ge;return H.test(ae(x))}function Ua(x){return qt(x)&&cr(x.length)&&!!ve[_n(x)]}function qa(x){if(!vt(x))return E(x);var H=Cn(x),Y=[];for(var he in x)he=="constructor"&&(H||!Ue.call(x,he))||Y.push(he);return Y}function Dt(x,H,Y,he,Le){if(x===H)return;Fa(H,function(Ze,pt){if(Le||(Le=new or),vt(Ze))za(x,H,pt,Y,Dt,he,Le);else{var De=he?he($(x,pt),Ze,pt+"",x,H,Le):void 0;De===void 0&&(De=Ze),Lr(x,pt,De)}},Yo)}function za(x,H,Y,he,Le,Ze,pt){var De=$(x,Y),Ke=$(H,Y),dr=pt.get(Ke);if(dr){Lr(x,Y,dr);return}var wr=Ze?Ze(De,Ke,Y+"",x,H,pt):void 0,Rn=wr===void 0;if(Rn){var ns=At(Ke),Ni=!ns&&Rr(Ke),ss=!ns&&!Ni&&Ji(Ke);wr=Ke,ns||Ni||ss?At(De)?wr=De:er(De)?wr=Ha(De):Ni?(Rn=!1,wr=An(Ke,!0)):ss?(Rn=!1,wr=rt(Ke,!0)):wr=[]:Xr(Ke)||Xe(Ke)?(wr=De,Xe(De)?wr=Ls(De):(!vt(De)||Ur(De))&&(wr=rs(Ke))):Rn=!1}Rn&&(pt.set(Ke,wr),Le(wr,Ke,he,Ze,pt),pt.delete(Ke)),Lr(x,Y,wr)}function $a(x,H){return ee(k(x,H,Xa),x+"")}var En=yr?function(x,H){return yr(x,"toString",{configurable:!0,enumerable:!1,value:kd(H),writable:!0})}:Xa;function An(x,H){if(H)return x.slice();var Y=x.length,he=U?U(Y):new x.constructor(Y);return x.copy(he),he}function Qt(x){var H=new x.constructor(x.byteLength);return new Te(H).set(new Te(x)),H}function rt(x,H){var Y=H?Qt(x.buffer):x.buffer;return new x.constructor(Y,x.byteOffset,x.length)}function Ha(x,H){var Y=-1,he=x.length;for(H||(H=Array(he));++Y<he;)H[Y]=x[Y];return H}function Ds(x,H,Y,he){var Le=!Y;Y||(Y={});for(var Ze=-1,pt=H.length;++Ze<pt;){var De=H[Ze],Ke=he?he(Y[De],x[De],De,Y,x):void 0;Ke===void 0&&(Ke=x[De]),Le?es(Y,De,Ke):jr(Y,De,Ke)}return Y}function vr(x){return $a(function(H,Y){var he=-1,Le=Y.length,Ze=Le>1?Y[Le-1]:void 0,pt=Le>2?Y[2]:void 0;for(Ze=x.length>3&&typeof Ze=="function"?(Le--,Ze):void 0,pt&&Va(Y[0],Y[1],pt)&&(Ze=Le<3?void 0:Ze,Le=1),H=Object(H);++he<Le;){var De=Y[he];De&&x(H,De,he,Ze)}return H})}function Bs(x){return function(H,Y,he){for(var Le=-1,Ze=Object(H),pt=he(H),De=pt.length;De--;){var Ke=pt[x?De:++Le];if(Y(Ze[Ke],Ke,Ze)===!1)break}return H}}function Zi(x,H){var Y=x.__data__;return is(H)?Y[typeof H=="string"?"string":"hash"]:Y.map}function ts(x,H){var Y=lt(x,H);return Fr(Y)?Y:void 0}function In(x){var H=Ue.call(x,sr),Y=x[sr];try{x[sr]=void 0;var he=!0}catch(Ze){}var Le=ft.call(x);return he&&(H?x[sr]=Y:delete x[sr]),Le}function rs(x){return typeof x.constructor=="function"&&!Cn(x)?Vi(_(x)):{}}function Tn(x,H){var Y=typeof x;return H=H??a,!!H&&(Y=="number"||Y!="symbol"&&ye.test(x))&&(x>-1&&x%1==0)&&x<H}function Va(x,H,Y){if(!vt(Y))return!1;var he=typeof H;return(he=="number"?Ut(Y)&&Tn(H,Y.length):he=="string"&&H in Y)?oe(Y[H],x):!1}function is(x){var H=typeof x;return H=="string"||H=="number"||H=="symbol"||H=="boolean"?x!=="__proto__":x===null}function Ga(x){return!!Ri&&Ri in x}function Cn(x){var H=x&&x.constructor,Y=typeof H=="function"&&H.prototype||et;return x===Y}function E(x){var H=[];if(x!=null)for(var Y in Object(x))H.push(Y);return H}function M(x){return ft.call(x)}function k(x,H,Y){return H=oi(H===void 0?x.length-1:H,0),function(){for(var he=arguments,Le=-1,Ze=oi(he.length-H,0),pt=Array(Ze);++Le<Ze;)pt[Le]=he[H+Le];Le=-1;for(var De=Array(H+1);++Le<H;)De[Le]=he[Le];return De[H]=Y(pt),Ne(x,this,De)}}function $(x,H){return H==="constructor"&&typeof x[H]=="function"||H=="__proto__"?void 0:x[H]}var ee=te(En);function te(x){var H=0,Y=0;return function(){var he=Mi(),Le=s-(he-Y);if(Y=he,Le>0){if(++H>=n)return arguments[0]}else H=0;return x.apply(void 0,arguments)}}function ae(x){if(x!=null){try{return tt.call(x)}catch(H){}try{return x+""}catch(H){}}return""}function oe(x,H){return x===H||x!==x&&H!==H}var Xe=Os(function(){return arguments}())?Os:function(x){return qt(x)&&Ue.call(x,"callee")&&!ai.call(x,"callee")},At=Array.isArray;function Ut(x){return x!=null&&cr(x.length)&&!Ur(x)}function er(x){return qt(x)&&Ut(x)}var Rr=Gr||Zo;function Ur(x){if(!vt(x))return!1;var H=_n(x);return H==f||H==g||H==d||H==j}function cr(x){return typeof x=="number"&&x>-1&&x%1==0&&x<=a}function vt(x){var H=typeof x;return x!=null&&(H=="object"||H=="function")}function qt(x){return x!=null&&typeof x=="object"}function Xr(x){if(!qt(x)||_n(x)!=D)return!1;var H=_(x);if(H===null)return!0;var Y=Ue.call(H,"constructor")&&H.constructor;return typeof Y=="function"&&Y instanceof Y&&tt.call(Y)==yt}var Ji=Mt?yn(Mt):Ua;function Ls(x){return Ds(x,Yo(x))}function Yo(x){return Ut(x)?ja(x,!0):qa(x)}var Md=vr(function(x,H,Y){Dt(x,H,Y)});function kd(x){return function(){return x}}function Xa(x){return x}function Zo(){return!1}e.exports=Md}),LA=ne(function(e,t){var r=200,i="Expected a function",n="__lodash_hash_undefined__",s=1,a=2,c=1/0,o=9007199254740991,d=17976931348623157e292,l=0/0,u="[object Arguments]",p="[object Array]",f="[object Boolean]",g="[object Date]",v="[object Error]",S="[object Function]",C="[object GeneratorFunction]",D="[object Map]",j="[object Number]",m="[object Object]",w="[object Promise]",R="[object RegExp]",h="[object Set]",b="[object String]",A="[object Symbol]",y="[object WeakMap]",P="[object ArrayBuffer]",N="[object DataView]",B="[object Float32Array]",L="[object Float64Array]",F="[object Int8Array]",z="[object Int16Array]",X="[object Int32Array]",Z="[object Uint8Array]",re="[object Uint8ClampedArray]",ue="[object Uint16Array]",ge="[object Uint32Array]",ye=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ve=/^\w*$/,ce=/^\./,we=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,nt=/[\\^$.*+?()[\]{}|]/g,Ge=/^\s+|\s+$/g,ze=/\\(\\)?/g,jt=/^[-+]0x[0-9a-f]+$/i,Oe=/^0b[01]+$/i,$e=/^\[object .+?Constructor\]$/,Mt=/^0o[0-7]+$/i,Ne=/^(?:0|[1-9]\d*)$/,de={};de[B]=de[L]=de[F]=de[z]=de[X]=de[Z]=de[re]=de[ue]=de[ge]=!0,de[u]=de[p]=de[P]=de[f]=de[N]=de[g]=de[v]=de[S]=de[D]=de[j]=de[m]=de[R]=de[h]=de[b]=de[y]=!1;var yn=parseInt,lt=typeof se=="object"&&se&&se.Object===Object&&se,bt=typeof self=="object"&&self&&self.Object===Object&&self,br=lt||bt||Function("return this")(),ut=t&&!t.nodeType&&t,et=ut&&!0&&e&&!e.nodeType&&e,Ci=et&&et.exports===ut,tt=Ci&&lt.process,Ue=function(){try{return tt&&tt.binding("util")}catch(T){}}(),Ri=Ue&&Ue.isTypedArray;function ft(T,O){for(var Q=-1,ie=T?T.length:0;++Q<ie;)if(O(T[Q],Q,T))return!0;return!1}function yt(T,O,Q,ie){for(var Ee=T.length,me=Q+(ie?1:-1);ie?me--:++me<Ee;)if(O(T[me],me,T))return me;return-1}function vn(T){return function(O){return O==null?void 0:O[T]}}function st(T,O){for(var Q=-1,ie=Array(T);++Q<T;)ie[Q]=O(Q);return ie}function ht(T){return function(O){return T(O)}}function Te(T,O){return T==null?void 0:T[O]}function U(T){var O=!1;if(T!=null&&typeof T.toString!="function")try{O=!!(T+"")}catch(Q){}return O}function _(T){var O=-1,Q=Array(T.size);return T.forEach(function(ie,Ee){Q[++O]=[Ee,ie]}),Q}function q(T,O){return function(Q){return T(O(Q))}}function ai(T){var O=-1,Q=Array(T.size);return T.forEach(function(ie){Q[++O]=ie}),Q}var Hi=Array.prototype,sr=Function.prototype,yr=Object.prototype,Gr=br["__core-js_shared__"],oi=function(){var T=/[^.]+$/.exec(Gr&&Gr.keys&&Gr.keys.IE_PROTO||"");return T?"Symbol(src)_1."+T:""}(),Mi=sr.toString,Vt=yr.hasOwnProperty,Gt=yr.toString,Vi=RegExp("^"+Mi.call(Vt).replace(nt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ar=br.Symbol,ki=br.Uint8Array,Gi=yr.propertyIsEnumerable,Xi=Hi.splice,Ki=q(Object.keys,Object),Wi=Math.max,Ft=vt(br,"DataView"),Br=vt(br,"Map"),ci=vt(br,"Promise"),Zn=vt(br,"Set"),Jn=vt(br,"WeakMap"),Yi=vt(Object,"create"),Pi=Y(Ft),Pa=Y(Br),Na=Y(ci),xa=Y(Zn),Oa=Y(Jn),wn=ar?ar.prototype:void 0,or=wn?wn.valueOf:void 0,Qn=wn?wn.toString:void 0;function di(T){var O=-1,Q=T?T.length:0;for(this.clear();++O<Q;){var ie=T[O];this.set(ie[0],ie[1])}}function Da(){this.__data__=Yi?Yi(null):{}}function Ba(T){return this.has(T)&&delete this.__data__[T]}function La(T){var O=this.__data__;if(Yi){var Q=O[T];return Q===n?void 0:Q}return Vt.call(O,T)?O[T]:void 0}function ja(T){var O=this.__data__;return Yi?O[T]!==void 0:Vt.call(O,T)}function Lr(T,O){var Q=this.__data__;return Q[T]=Yi&&O===void 0?n:O,this}di.prototype.clear=Da,di.prototype.delete=Ba,di.prototype.get=La,di.prototype.has=ja,di.prototype.set=Lr;function jr(T){var O=-1,Q=T?T.length:0;for(this.clear();++O<Q;){var ie=T[O];this.set(ie[0],ie[1])}}function Sn(){this.__data__=[]}function es(T){var O=this.__data__,Q=In(O,T);if(Q<0)return!1;var ie=O.length-1;return Q==ie?O.pop():Xi.call(O,Q,1),!0}function Fa(T){var O=this.__data__,Q=In(O,T);return Q<0?void 0:O[Q][1]}function _n(T){return In(this.__data__,T)>-1}function Os(T,O){var Q=this.__data__,ie=In(Q,T);return ie<0?Q.push([T,O]):Q[ie][1]=O,this}jr.prototype.clear=Sn,jr.prototype.delete=es,jr.prototype.get=Fa,jr.prototype.has=_n,jr.prototype.set=Os;function Fr(T){var O=-1,Q=T?T.length:0;for(this.clear();++O<Q;){var ie=T[O];this.set(ie[0],ie[1])}}function Ua(){this.__data__={hash:new di,map:new(Br||jr),string:new di}}function qa(T){return Ur(this,T).delete(T)}function Dt(T){return Ur(this,T).get(T)}function za(T){return Ur(this,T).has(T)}function $a(T,O){return Ur(this,T).set(T,O),this}Fr.prototype.clear=Ua,Fr.prototype.delete=qa,Fr.prototype.get=Dt,Fr.prototype.has=za,Fr.prototype.set=$a;function En(T){var O=-1,Q=T?T.length:0;for(this.__data__=new Fr;++O<Q;)this.add(T[O])}function An(T){return this.__data__.set(T,n),this}function Qt(T){return this.__data__.has(T)}En.prototype.add=En.prototype.push=An,En.prototype.has=Qt;function rt(T){this.__data__=new jr(T)}function Ha(){this.__data__=new jr}function Ds(T){return this.__data__.delete(T)}function vr(T){return this.__data__.get(T)}function Bs(T){return this.__data__.has(T)}function Zi(T,O){var Q=this.__data__;if(Q instanceof jr){var ie=Q.__data__;if(!Br||ie.length<r-1)return ie.push([T,O]),this;Q=this.__data__=new Fr(ie)}return Q.set(T,O),this}rt.prototype.clear=Ha,rt.prototype.delete=Ds,rt.prototype.get=vr,rt.prototype.has=Bs,rt.prototype.set=Zi;function ts(T,O){var Q=Ke(T)||De(T)?st(T.length,String):[],ie=Q.length,Ee=!!ie;for(var me in T)(O||Vt.call(T,me))&&!(Ee&&(me=="length"||Ji(me,ie)))&&Q.push(me);return Q}function In(T,O){for(var Q=T.length;Q--;)if(pt(T[Q][0],O))return Q;return-1}function rs(T,O){O=Ls(O,T)?[O]:Xe(O);for(var Q=0,ie=O.length;T!=null&&Q<ie;)T=T[H(O[Q++])];return Q&&Q==ie?T:void 0}function Tn(T){return Gt.call(T)}function Va(T,O){return T!=null&&O in Object(T)}function is(T,O,Q,ie,Ee){return T===O?!0:T==null||O==null||!Ni(T)&&!ss(O)?T!==T&&O!==O:Ga(T,O,is,Q,ie,Ee)}function Ga(T,O,Q,ie,Ee,me){var at=Ke(T),wt=Ke(O),Bt=p,Xt=p;at||(Bt=qt(T),Bt=Bt==u?m:Bt),wt||(Xt=qt(O),Xt=Xt==u?m:Xt);var Sr=Bt==m&&!U(T),Mr=Xt==m&&!U(O),Kt=Bt==Xt;if(Kt&&!Sr)return me||(me=new rt),at||Qb(T)?Ut(T,O,Q,ie,Ee,me):er(T,O,Bt,Q,ie,Ee,me);if(!(Ee&a)){var Kr=Sr&&Vt.call(T,"__wrapped__"),Wr=Mr&&Vt.call(O,"__wrapped__");if(Kr||Wr){var Mn=Kr?T.value():T,Qi=Wr?O.value():O;return me||(me=new rt),Q(Mn,Qi,ie,Ee,me)}}return Kt?(me||(me=new rt),Rr(T,O,Q,ie,Ee,me)):!1}function Cn(T,O,Q,ie){var Ee=Q.length,me=Ee,at=!ie;if(T==null)return!me;for(T=Object(T);Ee--;){var wt=Q[Ee];if(at&&wt[2]?wt[1]!==T[wt[0]]:!(wt[0]in T))return!1}for(;++Ee<me;){wt=Q[Ee];var Bt=wt[0],Xt=T[Bt],Sr=wt[1];if(at&&wt[2]){if(Xt===void 0&&!(Bt in T))return!1}else{var Mr=new rt;if(ie)var Kt=ie(Xt,Sr,Bt,T,O,Mr);if(!(Kt===void 0?is(Sr,Xt,ie,s|a,Mr):Kt))return!1}}return!0}function E(T){if(!Ni(T)||Md(T))return!1;var O=Rn(T)||U(T)?Vi:$e;return O.test(Y(T))}function M(T){return ss(T)&&ns(T.length)&&!!de[Gt.call(T)]}function k(T){return typeof T=="function"?T:T==null?ay:typeof T=="object"?Ke(T)?te(T[0],T[1]):ee(T):oy(T)}function $(T){if(!kd(T))return Ki(T);var O=[];for(var Q in Object(T))Vt.call(T,Q)&&Q!="constructor"&&O.push(Q);return O}function ee(T){var O=cr(T);return O.length==1&&O[0][2]?Zo(O[0][0],O[0][1]):function(Q){return Q===T||Cn(Q,T,O)}}function te(T,O){return Ls(T)&&Xa(O)?Zo(H(T),O):function(Q){var ie=ny(Q,T);return ie===void 0&&ie===O?sy(Q,T):is(O,ie,void 0,s|a)}}function ae(T){return function(O){return rs(O,T)}}function oe(T){if(typeof T=="string")return T;if(Jo(T))return Qn?Qn.call(T):"";var O=T+"";return O=="0"&&1/T==-c?"-0":O}function Xe(T){return Ke(T)?T:x(T)}function At(T){return function(O,Q,ie){var Ee=Object(O);if(!dr(O)){var me=k(Q);O=Qo(O),Q=function(wt){return me(Ee[wt],wt,Ee)}}var at=T(O,Q,ie);return at>-1?Ee[me?O[at]:at]:void 0}}function Ut(T,O,Q,ie,Ee,me){var at=Ee&a,wt=T.length,Bt=O.length;if(wt!=Bt&&!(at&&Bt>wt))return!1;var Xt=me.get(T);if(Xt&&me.get(O))return Xt==O;var Sr=-1,Mr=!0,Kt=Ee&s?new En:void 0;for(me.set(T,O),me.set(O,T);++Sr<wt;){var Kr=T[Sr],Wr=O[Sr];if(ie)var Mn=at?ie(Wr,Kr,Sr,O,T,me):ie(Kr,Wr,Sr,T,O,me);if(Mn!==void 0){if(Mn)continue;Mr=!1;break}if(Kt){if(!ft(O,function(Qi,as){if(!Kt.has(as)&&(Kr===Qi||Q(Kr,Qi,ie,Ee,me)))return Kt.add(as)})){Mr=!1;break}}else if(!(Kr===Wr||Q(Kr,Wr,ie,Ee,me))){Mr=!1;break}}return me.delete(T),me.delete(O),Mr}function er(T,O,Q,ie,Ee,me,at){switch(Q){case N:if(T.byteLength!=O.byteLength||T.byteOffset!=O.byteOffset)return!1;T=T.buffer,O=O.buffer;case P:return!(T.byteLength!=O.byteLength||!ie(new ki(T),new ki(O)));case f:case g:case j:return pt(+T,+O);case v:return T.name==O.name&&T.message==O.message;case R:case b:return T==O+"";case D:var wt=_;case h:var Bt=me&a;if(wt||(wt=ai),T.size!=O.size&&!Bt)return!1;var Xt=at.get(T);if(Xt)return Xt==O;me|=s,at.set(T,O);var Sr=Ut(wt(T),wt(O),ie,Ee,me,at);return at.delete(T),Sr;case A:if(or)return or.call(T)==or.call(O)}return!1}function Rr(T,O,Q,ie,Ee,me){var at=Ee&a,wt=Qo(T),Bt=wt.length,Xt=Qo(O),Sr=Xt.length;if(Bt!=Sr&&!at)return!1;for(var Mr=Bt;Mr--;){var Kt=wt[Mr];if(!(at?Kt in O:Vt.call(O,Kt)))return!1}var Kr=me.get(T);if(Kr&&me.get(O))return Kr==O;var Wr=!0;me.set(T,O),me.set(O,T);for(var Mn=at;++Mr<Bt;){Kt=wt[Mr];var Qi=T[Kt],as=O[Kt];if(ie)var kf=at?ie(as,Qi,Kt,O,T,me):ie(Qi,as,Kt,T,O,me);if(!(kf===void 0?Qi===as||Q(Qi,as,ie,Ee,me):kf)){Wr=!1;break}Mn||(Mn=Kt=="constructor")}if(Wr&&!Mn){var ec=T.constructor,tc=O.constructor;ec!=tc&&"constructor"in T&&"constructor"in O&&!(typeof ec=="function"&&ec instanceof ec&&typeof tc=="function"&&tc instanceof tc)&&(Wr=!1)}return me.delete(T),me.delete(O),Wr}function Ur(T,O){var Q=T.__data__;return Yo(O)?Q[typeof O=="string"?"string":"hash"]:Q.map}function cr(T){for(var O=Qo(T),Q=O.length;Q--;){var ie=O[Q],Ee=T[ie];O[Q]=[ie,Ee,Xa(Ee)]}return O}function vt(T,O){var Q=Te(T,O);return E(Q)?Q:void 0}var qt=Tn;(Ft&&qt(new Ft(new ArrayBuffer(1)))!=N||Br&&qt(new Br)!=D||ci&&qt(ci.resolve())!=w||Zn&&qt(new Zn)!=h||Jn&&qt(new Jn)!=y)&&(qt=function(T){var O=Gt.call(T),Q=O==m?T.constructor:void 0,ie=Q?Y(Q):void 0;if(ie)switch(ie){case Pi:return N;case Pa:return D;case Na:return w;case xa:return h;case Oa:return y}return O});function Xr(T,O,Q){O=Ls(O,T)?[O]:Xe(O);for(var ie,Ee=-1,me=O.length;++Ee<me;){var at=H(O[Ee]);if(!(ie=T!=null&&Q(T,at)))break;T=T[at]}if(ie)return ie;var me=T?T.length:0;return!!me&&ns(me)&&Ji(at,me)&&(Ke(T)||De(T))}function Ji(T,O){return O=O??o,!!O&&(typeof T=="number"||Ne.test(T))&&(T>-1&&T%1==0)&&T<O}function Ls(T,O){if(Ke(T))return!1;var Q=typeof T;return Q=="number"||Q=="symbol"||Q=="boolean"||T==null||Jo(T)?!0:ve.test(T)||!ye.test(T)||O!=null&&T in Object(O)}function Yo(T){var O=typeof T;return O=="string"||O=="number"||O=="symbol"||O=="boolean"?T!=="__proto__":T===null}function Md(T){return!!oi&&oi in T}function kd(T){var O=T&&T.constructor,Q=typeof O=="function"&&O.prototype||yr;return T===Q}function Xa(T){return T===T&&!Ni(T)}function Zo(T,O){return function(Q){return Q==null?!1:Q[T]===O&&(O!==void 0||T in Object(Q))}}var x=Ze(function(T){T=iy(T);var O=[];return ce.test(T)&&O.push(""),T.replace(we,function(Q,ie,Ee,me){O.push(Ee?me.replace(ze,"$1"):ie||Q)}),O});function H(T){if(typeof T=="string"||Jo(T))return T;var O=T+"";return O=="0"&&1/T==-c?"-0":O}function Y(T){if(T!=null){try{return Mi.call(T)}catch(O){}try{return T+""}catch(O){}}return""}function he(T,O,Q){var ie=T?T.length:0;if(!ie)return-1;var Ee=Q==null?0:ty(Q);return Ee<0&&(Ee=Wi(ie+Ee,0)),yt(T,k(O),Ee)}var Le=At(he);function Ze(T,O){if(typeof T!="function"||O&&typeof O!="function")throw new TypeError(i);var Q=function(){var ie=arguments,Ee=O?O.apply(this,ie):ie[0],me=Q.cache;if(me.has(Ee))return me.get(Ee);var at=T.apply(this,ie);return Q.cache=me.set(Ee,at),at};return Q.cache=new(Ze.Cache||Fr),Q}Ze.Cache=Fr;function pt(T,O){return T===O||T!==T&&O!==O}function De(T){return wr(T)&&Vt.call(T,"callee")&&(!Gi.call(T,"callee")||Gt.call(T)==u)}var Ke=Array.isArray;function dr(T){return T!=null&&ns(T.length)&&!Rn(T)}function wr(T){return ss(T)&&dr(T)}function Rn(T){var O=Ni(T)?Gt.call(T):"";return O==S||O==C}function ns(T){return typeof T=="number"&&T>-1&&T%1==0&&T<=o}function Ni(T){var O=typeof T;return!!T&&(O=="object"||O=="function")}function ss(T){return!!T&&typeof T=="object"}function Jo(T){return typeof T=="symbol"||ss(T)&&Gt.call(T)==A}var Qb=Ri?ht(Ri):M;function ey(T){if(!T)return T===0?T:0;if(T=ry(T),T===c||T===-c){var O=T<0?-1:1;return O*d}return T===T?T:0}function ty(T){var O=ey(T),Q=O%1;return O===O?Q?O-Q:O:0}function ry(T){if(typeof T=="number")return T;if(Jo(T))return l;if(Ni(T)){var O=typeof T.valueOf=="function"?T.valueOf():T;T=Ni(O)?O+"":O}if(typeof T!="string")return T===0?T:+T;T=T.replace(Ge,"");var Q=Oe.test(T);return Q||Mt.test(T)?yn(T.slice(2),Q?2:8):jt.test(T)?l:+T}function iy(T){return T==null?"":oe(T)}function ny(T,O,Q){var ie=T==null?void 0:rs(T,O);return ie===void 0?Q:ie}function sy(T,O){return T!=null&&Xr(T,O,Va)}function Qo(T){return dr(T)?ts(T):$(T)}function ay(T){return T}function oy(T){return Ls(T)?vn(H(T)):ae(T)}e.exports=Le}),jA="[object Symbol]",FA=Object.prototype,UA=FA.toString;function qA(e,t,r){for(var i=-1,n=e.length;++i<n;){var s=e[i],a=t(s);if(a!=null&&(c===void 0?a===a&&!HA(a):r(a,c)))var c=a,o=s}return o}function zA(e,t){return e>t}function $A(e){return!!e&&typeof e=="object"}function HA(e){return typeof e=="symbol"||$A(e)&&UA.call(e)==jA}function VA(e){return e}function GA(e){return e&&e.length?qA(e,VA,zA):void 0}var XA=GA,KA=128,WA=8,YA={0:"Reserved",1:"Interface local",2:"Link local",4:"Admin local",5:"Site local",8:"Organization local",14:"Global",15:"Reserved"},ZA={"ff01::1/128":"Multicast (All nodes on this interface)","ff01::2/128":"Multicast (All routers on this interface)","ff02::1/128":"Multicast (All nodes on this link)","ff02::2/128":"Multicast (All routers on this link)","ff05::2/128":"Multicast (All routers in this site)","ff02::5/128":"Multicast (OSPFv3 AllSPF routers)","ff02::6/128":"Multicast (OSPFv3 AllDR routers)","ff02::9/128":"Multicast (RIP routers)","ff02::a/128":"Multicast (EIGRP routers)","ff02::d/128":"Multicast (PIM routers)","ff02::16/128":"Multicast (MLDv2 reports)","ff01::fb/128":"Multicast (mDNSv6)","ff02::fb/128":"Multicast (mDNSv6)","ff05::fb/128":"Multicast (mDNSv6)","ff02::1:2/128":"Multicast (All DHCP servers and relay agents on this link)","ff05::1:2/128":"Multicast (All DHCP servers and relay agents in this site)","ff02::1:3/128":"Multicast (All DHCP servers on this link)","ff05::1:3/128":"Multicast (All DHCP servers in this site)","::/128":"Unspecified","::1/128":"Loopback","ff00::/8":"Multicast","fe80::/10":"Link-local unicast"},JA=/([^0-9a-f:\/%])/ig,QA=/([0-9a-f]{5,}|:{3,}|[^:]:$|^:[^:]|\/$)/ig,eI=/\/\d{1,3}(?=%|$)/,tI=/%.*$/,rI=new RegExp(/^\[{0,1}([0-9a-f:]+)\]{0,1}/),iI=new RegExp(/\[([0-9a-f:]+)\]:([0-9]{1,5})/),_t={BITS:KA,GROUPS:WA,SCOPES:YA,TYPES:ZA,RE_BAD_CHARACTERS:JA,RE_BAD_ADDRESS:QA,RE_SUBNET_STRING:eI,RE_ZONE_STRING:tI,RE_URL:rI,RE_URL_WITH_PORT:iI},nI=function(){return this.valid},sI=vi.isInSubnet,aI=vi.isCorrect(_t.BITS),oI=vi.falseIfInvalid(function(){return this.addressMinusSuffix===this.canonicalForm()}),cI=vi.falseIfInvalid(function(){return this.getBitsBase2(0,64)==="1111111010000000000000000000000000000000000000000000000000000000"}),dI=vi.falseIfInvalid(function(){return this.getType()==="Multicast"}),lI=vi.falseIfInvalid(function(){return this.v4}),uI=vi.falseIfInvalid(function(){return this.isInSubnet(new this.constructor("2001::/32"))}),fI=vi.falseIfInvalid(function(){return this.isInSubnet(new this.constructor("2002::/16"))}),hI=vi.falseIfInvalid(function(){return this.getType()==="Loopback"}),pI={isValid:nI,isInSubnet:sI,isCorrect:aI,isCanonical:oI,isLinkLocal:cI,isMulticast:dI,is4:lI,isTeredo:uI,is6to4:fI,isLoopback:hI},jc=ne(function(e,t){var r=vo.sprintf,i=t.spanAllZeroes=function(s){return s.replace(/(0+)/g,'<span class="zero">$1</span>')};t.spanAll=function(s,a){a===void 0&&(a=0);var c=s.split("");return c.map(function(o,d){return r('<span class="digit value-%s position-%d">%s</span>',o,d+a,i(o))}).join("")};function n(s){return s.replace(/^(0+)/,'<span class="zero">$1</span>')}t.spanLeadingZeroes=function(s){var a=s.split(":");return a.map(function(c){return n(c)}).join(":")},t.simpleGroup=function(s,a){var c=s.split(":");return a||(a=0),c.map(function(o,d){return/group-v4/.test(o)?o:r('<span class="hover-group group-%d">%s</span>',d+a,n(o))}).join(":")}}),gs=vo.sprintf,mI=function(e){return e===void 0?e="":e=gs(":%s",e),gs("http://[%s]%s/",this.correctForm(),e)},gI=function(e){e||(e={}),e.className===void 0&&(e.className=""),e.prefix===void 0&&(e.prefix="/#address="),e.v4===void 0&&(e.v4=!1);var t=this.correctForm;return e.v4&&(t=this.to4in6),e.className?gs('<a href="%1$s%2$s" class="%3$s">%2$s</a>',e.prefix,t.call(this),e.className):gs('<a href="%1$s%2$s">%2$s</a>',e.prefix,t.call(this))},bI=function(){var e=this.address.match(Ir.RE_ADDRESS),t;if(e){var r=e[0].split(".");this.address=this.address.replace(Ir.RE_ADDRESS,gs('<span class="hover-group group-v4 group-6">%s</span>.<span class="hover-group group-v4 group-7">%s</span>',r.slice(0,2).join("."),r.slice(2,4).join(".")))}if(this.elidedGroups===0)return jc.simpleGroup(this.address);var i=[],n=this.address.split("::");n[0].length?i.push(jc.simpleGroup(n[0])):i.push("");var s=["hover-group"];for(t=this.elisionBegin;t<this.elisionBegin+this.elidedGroups;t++)s.push(gs("group-%d",t));return i.push(gs('<span class="%s"></span>',s.join(" "))),n[1].length?i.push(jc.simpleGroup(n[1],this.elisionEnd)):i.push(""),i.join(":")},yI={href:mI,link:gI,group:bI},ta=vo.sprintf;function Gl(e){return ta("(%s)",e.join("|"))}function Xl(e){return e.length<4?ta("0{0,%d}%s",4-e.length,e):e}var Um="[^A-Fa-f0-9:]";function Kl(e){var t=[];e.forEach(function(i,n){var s=parseInt(i,16);s===0&&t.push(n)});var r=t.map(function(i){return e.map(function(n,s){if(s===i){var a=s===0||s===_t.GROUPS-1?":":"";return Gl([Xl(n),a])}return Xl(n)}).join(":")});return r.push(e.map(Xl).join(":")),Gl(r)}function qm(e,t,r){var i=t?"":":",n=r?"":":",s=[];!t&&!r&&s.push("::"),t&&r&&s.push(""),(r&&!t||!r&&t)&&s.push(":"),s.push(ta("%s(:0{1,4}){1,%d}",i,e-1)),s.push(ta("(0{1,4}:){1,%d}%s",e-1,n)),s.push(ta("(0{1,4}:){%d}0{1,4}",e-1));for(var a=1;a<e-1;a++)for(var c=1;c<e-a;c++)s.push(ta("(0{1,4}:){%d}:(0{1,4}:){%d}0{1,4}",c,e-c-a-1));return Gl(s)}var vI=function(e){e===void 0&&(e=!1);var t=[],r=new this.constructor(this.correctForm());if(r.elidedGroups===0)t.push(Kl(r.parsedAddress));else if(r.elidedGroups===_t.GROUPS)t.push(qm(_t.GROUPS));else{var i=r.address.split("::");i[0].length&&t.push(Kl(i[0].split(":"))),t.push(qm(r.elidedGroups,i[0].length!==0,i[1].length!==0)),i[1].length&&t.push(Kl(i[1].split(":"))),t=[t.join(":")]}return e||(t=[].concat("(?=^|",Um,"|[^\\w\\:])(",t,")(?=[^\\w\\:]|",Um,"|$)")),t.join("")},wI=function(e){return new RegExp(this.regularExpressionString(e),"i")},SI={regularExpressionString:vI,regularExpression:wI},Tr=mm.BigInteger,on=vo.sprintf;function _I(e){for(var t=/(\d+)(\d{3})/;t.test(e);)e=e.replace(t,"$1,$2");return e}function EI(e){return e=e.replace(/^(0{1,})([1-9]+)$/,'<span class="parse-error">$1</span>$2'),e=e.replace(/^(0{1,})(0)$/,'<span class="parse-error">$1</span>$2'),e}function _e(e,t){t===void 0?this.groups=_t.GROUPS:this.groups=t,this.v4=!1,this.subnet="/128",this.subnetMask=128,this.zone="",this.address=e;var r=_t.RE_SUBNET_STRING.exec(e);if(r){if(this.parsedSubnet=r[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,isNaN(this.subnetMask)||this.subnetMask<0||this.subnetMask>_t.BITS){this.valid=!1,this.error="Invalid subnet mask.";return}e=e.replace(_t.RE_SUBNET_STRING,"")}else if(/\//.test(e)){this.valid=!1,this.error="Invalid subnet mask.";return}var i=_t.RE_ZONE_STRING.exec(e);i&&(this.zone=i[0],e=e.replace(_t.RE_ZONE_STRING,"")),this.addressMinusSuffix=e,this.parsedAddress=this.parse(this.addressMinusSuffix)}Vl(_e.prototype,pI),Vl(_e.prototype,yI),Vl(_e.prototype,SI),_e.fromBigInteger=function(e){var t=wo(e.toString(16),32,"0"),r=[],i;for(i=0;i<_t.GROUPS;i++)r.push(t.slice(i*4,(i+1)*4));return new _e(r.join(":"))},_e.fromURL=function(e){var t,r,i;if(e.indexOf("[")!==-1&&e.indexOf("]:")!==-1){if(i=_t.RE_URL_WITH_PORT.exec(e),i===null)return{error:"failed to parse address with port",address:null,port:null};t=i[1],r=i[2]}else if(e.indexOf("/")!==-1){if(e=e.replace(/^[a-z0-9]+:\/\//,""),i=_t.RE_URL.exec(e),i===null)return{error:"failed to parse address from URL",address:null,port:null};t=i[1]}else t=e;return r?(r=parseInt(r,10),(r<0||r>65536)&&(r=null)):r=null,{address:new _e(t),port:r}},_e.fromAddress4=function(e){var e=new ms(e),t=_t.BITS-(Ir.BITS-e.subnetMask);return new _e("::ffff:"+e.correctForm()+"/"+t)},_e.fromArpa=function(e){var t=e.replace(/(\.ip6\.arpa)?\.$/,""),r=7;if(t.length!==63)return t={error:"Not Valid 'ip6.arpa' form",address:null},t;t=t.split(".").reverse();for(var i=r;i>0;i--){var n=i*4;t.splice(n,0,":")}return t=t.join(""),new _e(t)};function AI(e,t){var r=[],i=[],n;for(n=0;n<e.length;n++)n<t[0]?r.push(e[n]):n>t[1]&&i.push(e[n]);return r.concat(["compact"]).concat(i)}_e.prototype.microsoftTranscription=function(){return on("%s.ipv6-literal.net",this.correctForm().replace(/:/g,"-"))},_e.prototype.mask=function(e){return e===void 0&&(e=this.subnetMask),this.getBitsBase2(0,e)},_e.prototype.possibleSubnets=function(e){e===void 0&&(e=128);var t=_t.BITS-this.subnetMask,r=Math.abs(e-_t.BITS),i=t-r;return i<0?"0":_I(new Tr("2",10).pow(i).toString(10))},_e.prototype._startAddress=function(){return new Tr(this.mask()+Bc("0",_t.BITS-this.subnetMask),2)},_e.prototype.startAddress=function(){return _e.fromBigInteger(this._startAddress())},_e.prototype.startAddressExclusive=function(){var e=new Tr("1");return _e.fromBigInteger(this._startAddress().add(e))},_e.prototype._endAddress=function(){return new Tr(this.mask()+Bc("1",_t.BITS-this.subnetMask),2)},_e.prototype.endAddress=function(){return _e.fromBigInteger(this._endAddress())},_e.prototype.endAddressExclusive=function(){var e=new Tr("1");return _e.fromBigInteger(this._endAddress().subtract(e))},_e.prototype.getScope=function(){var e=_t.SCOPES[this.getBits(12,16)];return this.getType()==="Global unicast"&&e!=="Link local"&&(e="Global"),e},_e.prototype.getType=function(){var e=this;function t(r,i){return e.isInSubnet(new _e(i))}return LA(_t.TYPES,t)||"Global unicast"},_e.prototype.getBits=function(e,t){return new Tr(this.getBitsBase2(e,t),2)},_e.prototype.getBitsBase2=function(e,t){return this.binaryZeroPad().slice(e,t)},_e.prototype.getBitsBase16=function(e,t){var r=t-e;return r%4!==0?null:wo(this.getBits(e,t).toString(16),r/4,"0")},_e.prototype.getBitsPastSubnet=function(){return this.getBitsBase2(this.subnetMask,_t.BITS)},_e.prototype.reverseForm=function(e){e||(e={});var t=Math.floor(this.subnetMask/4),r=this.canonicalForm().replace(/:/g,"").split("").slice(0,t).reverse().join(".");return t>0?e.omitSuffix?r:on("%s.ip6.arpa.",r):e.omitSuffix?"":"ip6.arpa."},_e.prototype.correctForm=function(){if(!this.parsedAddress)return null;var e,t=[],r=0,i=[];for(e=0;e<this.parsedAddress.length;e++){var n=parseInt(this.parsedAddress[e],16);n===0&&r++,n!==0&&r>0&&(r>1&&i.push([e-r,e-1]),r=0)}r>1&&i.push([this.parsedAddress.length-r,this.parsedAddress.length-1]);var s=i.map(function(o){return o[1]-o[0]+1});if(i.length>0){var a=s.indexOf(XA(s));t=AI(this.parsedAddress,i[a])}else t=this.parsedAddress;for(e=0;e<t.length;e++)t[e]!=="compact"&&(t[e]=parseInt(t[e],16).toString(16));var c=t.join(":");return c=c.replace(/^compact$/,"::"),c=c.replace(/^compact|compact$/,":"),c=c.replace(/compact/,""),c},_e.prototype.binaryZeroPad=function(){return wo(this.bigInteger().toString(2),_t.BITS,"0")},_e.prototype.parse4in6=function(e){var t=e.split(":"),r=t.slice(-1)[0],i=r.match(Ir.RE_ADDRESS);if(i){for(var n=new ms(i[0]),s=0;s<n.groups;s++)if(/^0[0-9]+/.test(n.parsedAddress[s]))return this.valid=!1,this.error="IPv4 addresses can not have leading zeroes.",this.parseError=e.replace(Ir.RE_ADDRESS,n.parsedAddress.map(EI).join(".")),null;this.v4=!0,t[t.length-1]=n.toGroup6(),e=t.join(":")}return e},_e.prototype.parse=function(e){if(e=this.parse4in6(e),this.error)return null;var t=e.match(_t.RE_BAD_CHARACTERS);if(t)return this.valid=!1,this.error=on("Bad character%s detected in address: %s",t.length>1?"s":"",t.join("")),this.parseError=e.replace(_t.RE_BAD_CHARACTERS,'<span class="parse-error">$1</span>'),null;var r=e.match(_t.RE_BAD_ADDRESS);if(r)return this.valid=!1,this.error=on("Address failed regex: %s",r.join("")),this.parseError=e.replace(_t.RE_BAD_ADDRESS,'<span class="parse-error">$1</span>'),null;var i=[],n=e.split("::");if(n.length===2){var s=n[0].split(":"),a=n[1].split(":");s.length===1&&s[0]===""&&(s=[]),a.length===1&&a[0]===""&&(a=[]);var c=this.groups-(s.length+a.length);if(!c)return this.valid=!1,this.error="Error parsing groups",null;this.elidedGroups=c,this.elisionBegin=s.length,this.elisionEnd=s.length+this.elidedGroups,s.forEach(function(d){i.push(d)});for(var o=0;o<c;o++)i.push(0);a.forEach(function(d){i.push(d)})}else if(n.length===1)i=e.split(":"),this.elidedGroups=0;else return this.valid=!1,this.error="Too many :: groups found",null;return i=i.map(function(d){return on("%x",parseInt(d,16))}),i.length!==this.groups?(this.valid=!1,this.error="Incorrect number of groups found",null):(this.valid=!0,i)};function zm(e){return on("%04x",parseInt(e,16))}_e.prototype.canonicalForm=function(){return this.valid?this.parsedAddress.map(zm).join(":"):null},_e.prototype.decimal=function(){return this.valid?this.parsedAddress.map(function(e){return on("%05d",parseInt(e,16))}).join(":"):null},_e.prototype.bigInteger=function(){return this.valid?new Tr(this.parsedAddress.map(zm).join(""),16):null},_e.prototype.to4=function(){var e=this.binaryZeroPad().split("");return ms.fromHex(new Tr(e.slice(96,128).join(""),2).toString(16))},_e.prototype.to4in6=function(){var e=this.to4(),t=new _e(this.parsedAddress.slice(0,6).join(":"),6),r=t.correctForm(),i="";return/:$/.test(r)||(i=":"),t.correctForm()+i+e.address},_e.prototype.inspectTeredo=function(){var e=this.getBitsBase16(0,32),t=this.getBits(80,96).xor(new Tr("ffff",16)).toString(),r=ms.fromHex(this.getBitsBase16(32,64)),i=ms.fromHex(this.getBits(96,128).xor(new Tr("ffffffff",16)).toString(16)),n=this.getBits(64,80),s=this.getBitsBase2(64,80),a=n.testBit(15),c=n.testBit(14),o=n.testBit(8),d=n.testBit(9),l=new Tr(s.slice(2,6)+s.slice(8,16),2).toString(10);return{prefix:on("%s:%s",e.slice(0,4),e.slice(4,8)),server4:r.address,client4:i.address,flags:s,coneNat:a,microsoft:{reserved:c,universalLocal:d,groupIndividual:o,nonce:l},udpPort:t}},_e.prototype.inspect6to4=function(){var e=this.getBitsBase16(0,16),t=ms.fromHex(this.getBitsBase16(16,48));return{prefix:on("%s",e.slice(0,4)),gateway:t.address}},_e.prototype.to6to4=function(){if(!this.is4())return null;var e=["2002",this.getBitsBase16(96,112),this.getBitsBase16(112,128),"","/16"].join(":");return new _e(e)},_e.prototype.toByteArray=function(){var e=this.bigInteger().toByteArray();return e.length===17&&e[0]===0?e.slice(1):e};function $m(e){return e&255}_e.prototype.toUnsignedByteArray=function(){return this.toByteArray().map($m)},_e.fromByteArray=function(e){return this.fromUnsignedByteArray(e.map($m))},_e.fromUnsignedByteArray=function(e){for(var t=new Tr("256",10),r=new Tr("0",10),i=new Tr("1",10),n=e.length-1;n>=0;n--)r=r.add(i.multiply(new Tr(e[n].toString(10),10))),i=i.multiply(t);return _e.fromBigInteger(r)};var II=_e,TI=ms,CI=II,RI={helpers:jc},Hm={Address4:TI,Address6:CI,v6:RI};const{Address4:MI,Address6:kI}=Hm,Fc={ERR_INVALID_IP_PARAMETER:"ERR_INVALID_IP_PARAMETER",ERR_INVALID_PORT_PARAMETER:"ERR_INVALID_PORT_PARAMETER",ERR_INVALID_IP:"ERR_INVALID_IP"};function PI(e,t){if(typeof e!="string")throw G(new Error(`invalid ip provided: ${e}`),Fc.ERR_INVALID_IP_PARAMETER);if(t=parseInt(t),isNaN(t))throw G(new Error(`invalid port provided: ${t}`),Fc.ERR_INVALID_PORT_PARAMETER);if(new MI(e).isValid())return Er(`/ip4/${e}/tcp/${t}`);const r=new kI(e);if(r.isValid())return r.is4()?Er(`/ip4/${r.to4().correctForm()}/tcp/${t}`):Er(`/ip6/${e}/tcp/${t}`);throw G(new Error(`invalid ip:port for creating a multiaddr: ${e}:${t}`),Fc.ERR_INVALID_IP)}var _o=PI,NI=Fc;_o.Errors=NI;const{CLOSE_TIMEOUT:xI}=pm,Wl=le("libp2p:websockets:socket");Wl.error=le("libp2p:websockets:socket:error");var Vm=(e,t={})=>{const r={async sink(i){t.signal&&(i=zt(i,t.signal));try{await e.sink(async function*(){for await(const n of i)yield n instanceof Uint8Array?n:n.slice()}())}catch(n){n.type!=="aborted"&&Wl.error(n)}},source:t.signal?zt(e.source,t.signal):e.source,conn:e,localAddr:t.localAddr||(e.localAddress&&e.localPort?_o(e.localAddress,e.localPort):void 0),remoteAddr:t.remoteAddr||_o(e.remoteAddress,e.remotePort),timeline:{open:Date.now()},async close(){const i=Date.now();try{await yy(e.close(),xI)}catch(n){const{host:s,port:a}=r.remoteAddr.toOptions();Wl("timeout closing stream to %s:%s after %dms, destroying it manually",s,a,Date.now()-i),e.destroy()}finally{r.timeline.close=Date.now()}}};return e.socket.once&&e.socket.once("close",()=>{r.timeline.close||(r.timeline.close=Date.now())}),r};const{createServer:OI}=mE,Uc=le("libp2p:websockets:listener");Uc.error=le("libp2p:websockets:listener:error");var DI=({handler:e,upgrader:t},r={})=>{const i=new _r,n=OI(r,async a=>{let c,o;try{c=Vm(a),Uc("new inbound connection %s",c.remoteAddr),o=await t.upgradeInbound(c)}catch(d){return Uc.error("inbound connection failed to upgrade",d),c&&c.close()}Uc("inbound connection %s upgraded",c.remoteAddr),BI(n,c),e&&e(o),i.emit("connection",o)});n.on("listening",()=>i.emit("listening")).on("error",a=>i.emit("error",a)).on("close",()=>i.emit("close")),n.__connections=[];let s;return i.close=()=>(n.__connections.forEach(a=>a.close()),n.close()),i.listen=a=>(s=a,n.listen(a.toOptions())),i.getAddrs=()=>{const a=[],c=n.address();if(!c)throw new Error("Listener is not ready yet");const o=s.getPeerId();if(s.toString().indexOf("ip4")!==-1){let d=s.decapsulate("tcp");if(d=d.encapsulate("/tcp/"+c.port+"/ws"),s.getPeerId()&&(d=d.encapsulate("/p2p/"+o)),d.toString().indexOf("0.0.0.0")!==-1){const l=Nf.networkInterfaces();Object.keys(l).forEach(u=>{l[u].forEach(p=>{p.family==="IPv4"&&a.push(pE(d.toString().replace("0.0.0.0",p.address)))})})}else a.push(d)}return a},i};function BI(e,t){e.__connections.push(t)}const LI=qr,Yl=qr.v4,Gm=qr.v6,Xm=function(e,t,r){r=~~r;var i;if(Yl(e))i=t||new Uint8Array(r+4),e.split(/\./g).map(function(l){i[r++]=parseInt(l,10)&255});else if(Gm(e)){var n=e.split(":",8),s;for(s=0;s<n.length;s++){var a=Yl(n[s]),c;a&&(c=Xm(n[s]),n[s]=Ae(c.slice(0,2),"base16")),c&&++s<8&&n.splice(s,0,Ae(c.slice(2,4),"base16"))}if(n[0]==="")for(;n.length<8;)n.unshift("0");else if(n[n.length-1]==="")for(;n.length<8;)n.push("0");else if(n.length<8){for(s=0;s<n.length&&n[s]!=="";s++);var o=[s,"1"];for(s=9-n.length;s>0;s--)o.push("0");n.splice.apply(n,o)}for(i=t||new Uint8Array(r+16),s=0;s<n.length;s++){var d=parseInt(n[s],16);i[r++]=d>>8&255,i[r++]=d&255}}if(!i)throw Error("Invalid ip address: "+e);return i},jI=function(e,t,r){t=~~t,r=r||e.length-t;var i=[],n;const s=new DataView(e.buffer);if(r===4){for(let a=0;a<r;a++)i.push(e[t+a]);n=i.join(".")}else if(r===16){for(let a=0;a<r;a+=2)i.push(s.getUint16(t+a).toString(16));n=i.join(":"),n=n.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),n=n.replace(/:{3,4}/,"::")}return n};var qc={isIP:LI,isV4:Yl,isV6:Gm,toBytes:Xm,toString:jI};function Dr(e){if(typeof e=="number"){if(Dr.codes[e])return Dr.codes[e];throw new Error("no protocol with code: "+e)}else if(typeof e=="string"||e instanceof String){if(Dr.names[e])return Dr.names[e];throw new Error("no protocol with name: "+e)}throw new Error("invalid protocol id type: "+e)}const ii=-1;Dr.lengthPrefixedVarSize=ii,Dr.V=ii,Dr.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,ii,"ip6zone"],[53,ii,"dns","resolvable"],[54,ii,"dns4","resolvable"],[55,ii,"dns6","resolvable"],[56,ii,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,ii,"unix",!1,"path"],[421,ii,"ipfs"],[421,ii,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,ii,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,ii,"memory"]],Dr.names={},Dr.codes={},Dr.table.map(e=>{const t=Km.apply(null,e);Dr.codes[t.code]=t,Dr.names[t.name]=t}),Dr.object=Km;function Km(e,t,r,i,n){return{code:e,size:t,name:r,resolvable:Boolean(i),path:Boolean(n)}}var Li=Dr,Wm=Eo;function Eo(e,t){return t instanceof Uint8Array?Eo.toString(e,t):Eo.toBytes(e,t)}Eo.toString=function(t,r){t=Li(t);switch(t.code){case 4:case 41:return FI(r);case 6:case 273:case 33:case 132:return Zm(r);case 53:case 54:case 55:case 56:case 400:case 777:return qI(r);case 421:return $I(r);case 444:return Jm(r);case 445:return Jm(r);default:return Ae(r,"base16")}},Eo.toBytes=function(t,r){t=Li(t);switch(t.code){case 4:return Ym(r);case 41:return Ym(r);case 6:case 273:case 33:case 132:return Zl(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return UI(r);case 421:return zI(r);case 444:return HI(r);case 445:return VI(r);default:return St(r,"base16")}};function Ym(e){if(!qc.isIP(e))throw new Error("invalid ip address");return qc.toBytes(e)}function FI(e){const t=qc.toString(e);if(!t||!qc.isIP(t))throw new Error("invalid ip address");return t}function Zl(e){const t=new ArrayBuffer(2),r=new DataView(t);return r.setUint16(0,e),new Uint8Array(t)}function Zm(e){const t=new DataView(e.buffer);return t.getUint16(0)}function UI(e){const t=St(e),r=Uint8Array.from(be.encode(t.length));return mt([r,t],r.length+t.length)}function qI(e){const t=be.decode(e);if(e=e.slice(be.decode.bytes),e.length!==t)throw new Error("inconsistent lengths");return Ae(e)}function zI(e){const t=new en(e).multihash,r=Uint8Array.from(be.encode(t.length));return mt([r,t],r.length+t.length)}function $I(e){const t=be.decode(e),r=e.slice(be.decode.bytes);if(r.length!==t)throw new Error("inconsistent lengths");return Ae(r,"base58btc")}function HI(e){const t=e.split(":");if(t.length!==2)throw new Error("failed to parse onion addr: "+t+" does not contain a port number");if(t[0].length!==16)throw new Error("failed to parse onion addr: "+t[0]+" not a Tor onion address.");const r=kn.decode("b"+t[0]),i=parseInt(t[1],10);if(i<1||i>65536)throw new Error("Port number is not in range(1, 65536)");const n=Zl(i);return mt([r,n],r.length+n.length)}function VI(e){const t=e.split(":");if(t.length!==2)throw new Error("failed to parse onion addr: "+t+" does not contain a port number");if(t[0].length!==56)throw new Error("failed to parse onion addr: "+t[0]+" not a Tor onion3 address.");const r=kn.decode("b"+t[0]),i=parseInt(t[1],10);if(i<1||i>65536)throw new Error("Port number is not in range(1, 65536)");const n=Zl(i);return mt([r,n],r.length+n.length)}function Jm(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2),i=Ae(t,"base32"),n=Zm(r);return i+":"+n}var wi={stringToStringTuples:Qm,stringTuplesToString:e0,tuplesToStringTuples:r0,stringTuplesToTuples:t0,bytesToTuples:Jl,tuplesToBytes:i0,bytesToString:GI,stringToBytes:s0,fromString:XI,fromBytes:a0,validateBytes:Ql,isValidBytes:KI,cleanPath:zc,ParseError:eu,protoFromTuple:Ao,sizeForAddr:n0};function Qm(e){const t=[],r=e.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let i=0;i<r.length;i++){const n=r[i],s=Li(n);if(s.size===0){t.push([n]);continue}if(i++,i>=r.length)throw eu("invalid address: "+e);if(s.path){t.push([n,zc(r.slice(i).join("/"))]);break}t.push([n,r[i]])}return t}function e0(e){const t=[];return e.map(r=>{const i=Ao(r);t.push(i.name),r.length>1&&t.push(r[1])}),zc(t.join("/"))}function t0(e){return e.map(t=>{Array.isArray(t)||(t=[t]);const r=Ao(t);return t.length>1?[r.code,Wm.toBytes(r.code,t[1])]:[r.code]})}function r0(e){return e.map(t=>{const r=Ao(t);return t.length>1?[r.code,Wm.toString(r.code,t[1])]:[r.code]})}function i0(e){return a0(mt(e.map(t=>{const r=Ao(t);let i=Uint8Array.from(be.encode(r.code));return t.length>1&&(i=mt([i,t[1]])),i})))}function n0(e,t){if(e.size>0)return e.size/8;if(e.size===0)return 0;{const r=be.decode(t);return r+be.decode.bytes}}function Jl(e){const t=[];let r=0;for(;r<e.length;){const i=be.decode(e,r),n=be.decode.bytes,s=Li(i),a=n0(s,e.slice(r+n));if(a===0){t.push([i]),r+=n;continue}const c=e.slice(r+n,r+n+a);if(r+=a+n,r>e.length)throw eu("Invalid address Uint8Array: "+Ae(e,"base16"));t.push([i,c])}return t}function GI(e){const t=Jl(e),r=r0(t);return e0(r)}function s0(e){e=zc(e);const t=Qm(e),r=t0(t);return i0(r)}function XI(e){return s0(e)}function a0(e){const t=Ql(e);if(t)throw t;return Uint8Array.from(e)}function Ql(e){try{Jl(e)}catch(t){return t}}function KI(e){return Ql(e)===void 0}function zc(e){return"/"+e.trim().split("/").filter(t=>t).join("/")}function eu(e){return new Error("Error parsing address: "+e)}function Ao(e){const t=Li(e[0]);return t}var tu=ne(function(e,t){const r=Symbol.for("nodejs.util.inspect.custom"),i=rn.proto(function(n){if(!(this instanceof i))return new i(n);if(n==null&&(n=""),n instanceof Uint8Array)this.bytes=wi.fromBytes(n);else if(typeof n=="string"||n instanceof String){if(n.length>0&&n.charAt(0)!=="/")throw new Error(`multiaddr "${n}" must start with a "/"`);this.bytes=wi.fromString(n)}else if(n.bytes&&n.protos&&n.protoCodes)this.bytes=wi.fromBytes(n.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});i.prototype.toString=function(){return wi.bytesToString(this.bytes)},i.prototype.toJSON=i.prototype.toString,i.prototype.toOptions=function(){const s={},a=this.toString().split("/");return s.family=a[1]==="ip4"?"ipv4":"ipv6",s.host=a[2],s.transport=a[3],s.port=parseInt(a[4]),s},i.prototype[r]=function(){return"<Multiaddr "+Ae(this.bytes,"base16")+" - "+wi.bytesToString(this.bytes)+">"},i.prototype.inspect=function(){return"<Multiaddr "+Ae(this.bytes,"base16")+" - "+wi.bytesToString(this.bytes)+">"},i.prototype.protos=function(){return this.protoCodes().map(s=>Object.assign({},Li(s)))},i.prototype.protoCodes=function(){const s=[],a=this.bytes;let c=0;for(;c<a.length;){const o=be.decode(a,c),d=be.decode.bytes,l=Li(o),u=wi.sizeForAddr(l,a.slice(c+d));c+=u+d,s.push(o)}return s},i.prototype.protoNames=function(){return this.protos().map(s=>s.name)},i.prototype.tuples=function(){return wi.bytesToTuples(this.bytes)},i.prototype.stringTuples=function(){const s=wi.bytesToTuples(this.bytes);return wi.tuplesToStringTuples(s)},i.prototype.encapsulate=function(s){return s=i(s),i(this.toString()+s.toString())},i.prototype.decapsulate=function(s){s=s.toString();const a=this.toString(),c=a.lastIndexOf(s);if(c<0)throw new Error("Address "+this+" does not contain subaddress: "+s);return i(a.slice(0,c))},i.prototype.decapsulateCode=function(s){const a=this.tuples();for(let c=a.length-1;c>=0;c--)if(a[c][0]===s)return i(wi.tuplesToBytes(a.slice(0,c)));return this},i.prototype.getPeerId=function(){let s=null;try{const a=this.stringTuples().filter(c=>{if(c[0]===Li.names.ipfs.code)return!0});s=a.pop()[1],s=Ae(new en(s).multihash,"base58btc")}catch(a){s=null}return s},i.prototype.getPath=function(){let s=null;try{s=this.stringTuples().filter(a=>{const c=Li(a[0]);if(c.path)return!0})[0][1]}catch(a){s=null}return s},i.prototype.equals=function(s){return li(this.bytes,s.bytes)},i.prototype.nodeAddress=function(){const s=this.protoCodes(),a=this.protoNames(),c=this.toString().split("/").slice(1);if(c.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(s[0]!==4&&s[0]!==41&&s[0]!==54&&s[0]!==55)throw new Error(`no protocol with name: "'${a[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(c[2]!=="tcp"&&c[2]!=="udp")throw new Error(`no protocol with name: "'${a[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:s[0]===41||s[0]===55?6:4,address:c[1],port:parseInt(c[3])}},i.fromNodeAddress=function(s,a){if(!s)throw new Error("requires node address object");if(!a)throw new Error("requires transport protocol");let c;switch(s.family){case"IPv4":c="ip4";break;case"IPv6":c="ip6";break;default:throw Error(`Invalid addr family. Got '${s.family}' instead of 'IPv4' or 'IPv6'`)}return i("/"+[c,s.address,a,s.port].join("/"))},i.prototype.isThinWaistAddress=function(s){const a=(s||this).protos();return a.length!==2||a[0].code!==4&&a[0].code!==41?!1:!(a[1].code!==6&&a[1].code!==273)},i.protocols=Li,i.isName=function(s){return i.isMultiaddr(s)?s.protos().some(a=>a.resolvable):!1},i.resolve=function(s){return!i.isMultiaddr(s)||!i.isName(s)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},t=e.exports=i});const o0=Me("dns4"),c0=Me("dns6"),d0=Me("dnsaddr"),bs=fr(Me("dns"),d0,o0,c0),Io=fr(Me("ip4"),Me("ip6")),ra=fr(Fe(Io,Me("tcp")),Fe(bs,Me("tcp"))),l0=Fe(Io,Me("udp")),u0=Fe(l0,Me("utp")),ia=fr(Fe(ra,Me("ws")),Fe(bs,Me("ws"))),na=fr(Fe(ra,Me("wss")),Fe(bs,Me("wss"))),ru=fr(Fe(ra,Me("http")),Fe(Io,Me("http")),Fe(bs,Me("http"))),iu=fr(Fe(ra,Me("https")),Fe(Io,Me("https")),Fe(bs,Me("https"))),nu=fr(Fe(ia,Me("p2p-webrtc-star"),Me("p2p")),Fe(na,Me("p2p-webrtc-star"),Me("p2p")),Fe(ia,Me("p2p-webrtc-star")),Fe(na,Me("p2p-webrtc-star"))),WI=fr(Fe(ia,Me("p2p-websocket-star"),Me("p2p")),Fe(na,Me("p2p-websocket-star"),Me("p2p")),Fe(ia,Me("p2p-websocket-star")),Fe(na,Me("p2p-websocket-star"))),f0=fr(Fe(ru,Me("p2p-webrtc-direct")),Fe(iu,Me("p2p-webrtc-direct"))),sa=fr(ia,na,ru,iu,nu,f0,ra,u0,bs),YI=fr(Fe(sa,Me("p2p-stardust"),Me("p2p")),Fe(sa,Me("p2p-stardust"))),jn=fr(Fe(sa,Me("p2p")),nu,Me("p2p")),h0=fr(Fe(jn,Me("p2p-circuit"),jn),Fe(jn,Me("p2p-circuit")),Fe(Me("p2p-circuit"),jn),Fe(sa,Me("p2p-circuit")),Fe(Me("p2p-circuit"),sa),Me("p2p-circuit")),p0=()=>fr(Fe(h0,p0),h0),aa=p0(),m0=fr(Fe(aa,jn,aa),Fe(jn,aa),Fe(aa,jn),aa,jn);var ZI=bs,JI=o0,QI=c0,e3=d0,t3=Io,r3=ra,i3=l0,n3=u0,s3=ru,a3=iu,o3=ia,c3=na,d3=WI,l3=nu,u3=f0,f3=sa,h3=YI,p3=aa,m3=m0,g3=m0;function g0(e){return function(r){if(!tu.isMultiaddr(r))try{r=tu(r)}catch(n){return!1}const i=e(r.protoNames());return i===null?!1:i.length===0}}function Fe(){const e=Array.from(arguments);function t(r){return r.length<e.length?null:(e.some(i=>{if(r=typeof i=="function"?i().partialMatch(r):i.partialMatch(r),r===null)return!0}),r)}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:g0(t),partialMatch:t}}function fr(){const e=Array.from(arguments);function t(i){let n=null;return e.some(s=>{const a=typeof s=="function"?s().partialMatch(i):s.partialMatch(i);if(a)return n=a,!0}),n}const r={toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:g0(t),partialMatch:t};return r}function Me(e){const t=e;function r(n){if(typeof n=="string")try{n=tu(n)}catch(a){return!1}const s=n.protoNames();return s.length===1&&s[0]===t}function i(n){return n.length===0?null:n[0]===t?n.slice(1):null}return{toString:function(){return t},matches:r,partialMatch:i}}var Fn={DNS:ZI,DNS4:JI,DNS6:QI,DNSADDR:e3,IP:t3,TCP:r3,UDP:i3,UTP:n3,HTTP:s3,HTTPS:a3,WebSockets:o3,WebSocketsSecure:c3,WebSocketStar:d3,WebRTCStar:l3,WebRTCDirect:u3,Reliable:f3,Stardust:h3,Circuit:p3,P2P:m3,IPFS:g3};const{CODE_CIRCUIT:su,CODE_P2P:au,CODE_TCP:ou,CODE_WS:b3,CODE_WSS:b0}=pm;var cu={all:e=>e.filter(t=>{if(t.protoCodes().includes(su))return!1;const r=t.decapsulateCode(au);return Fn.WebSockets.matches(r)||Fn.WebSocketsSecure.matches(r)}),dnsWss:e=>e.filter(t=>{if(t.protoCodes().includes(su))return!1;const r=t.decapsulateCode(au);return Fn.WebSocketsSecure.matches(r)&&Fn.DNS.matches(r.decapsulateCode(ou).decapsulateCode(b0))}),dnsWsOrWss:e=>e.filter(t=>{if(t.protoCodes().includes(su))return!1;const r=t.decapsulateCode(au);return Fn.WebSockets.matches(r)?Fn.DNS.matches(r.decapsulateCode(ou).decapsulateCode(b3)):Fn.WebSocketsSecure.matches(r)&&Fn.DNS.matches(r.decapsulateCode(ou).decapsulateCode(b0))})};const{AbortError:y0}=zt,oa=le("libp2p:websockets");class y3{constructor({upgrader:e,filter:t}){if(!e)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=e,this._filter=t}async dial(e,t={}){oa("dialing %s",e);const r=await this._connect(e,t),i=Vm(r,{remoteAddr:e,signal:t.signal});oa("new outbound connection %s",i.remoteAddr);const n=await this._upgrader.upgradeOutbound(i);return oa("outbound connection %s upgraded",i.remoteAddr),n}async _connect(e,t={}){if(t.signal&&t.signal.aborted)throw new y0;const r=e.toOptions();oa("dialing %s:%s",r.host,r.port);const i=Zp(X_(e),Object.assign({binary:!0},t));if(!t.signal)return await i.connected(),oa("connected %s",e),i;let n;const s=new Promise((a,c)=>{if(n=()=>{c(new y0),i.close()},t.signal.aborted)return n();t.signal.addEventListener("abort",n)});try{await Promise.race([s,i.connected()])}finally{t.signal.removeEventListener("abort",n)}return oa("connected %s",e),i}createListener(e={},t){return typeof e=="function"&&(t=e,e={}),DI({handler:t,upgrader:this._upgrader},e)}filter(e){return e=Array.isArray(e)?e:[e],this._filter?this._filter(e):Jp.isBrowser||Jp.isWebWorker?cu.dnsWss(e):cu.all(e)}}var v0=rn(y3,{className:"WebSockets",symbolName:"@libp2p/js-libp2p-websockets/websockets"}),w0=function(){if(typeof window=="undefined")return null;var t={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return t.RTCPeerConnection?t:null},ys=_r.EventEmitter;function S0(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function v3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?S0(Object(r),!0).forEach(function(i){w3(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function w3(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function S3(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _0(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _3(e,t,r){return t&&_0(e.prototype,t),r&&_0(e,r),e}var $c=pe.Buffer,du=os.inspect,E3=du&&du.custom||"inspect";function A3(e,t,r){$c.prototype.copy.call(e,t,r)}var I3=function(){function e(){S3(this,e),this.head=null,this.tail=null,this.length=0}return _3(e,[{key:"push",value:function(r){var i={data:r,next:null};this.length>0?this.tail.next=i:this.head=i,this.tail=i,++this.length}},{key:"unshift",value:function(r){var i={data:r,next:this.head};this.length===0&&(this.tail=i),this.head=i,++this.length}},{key:"shift",value:function(){if(this.length===0)return;var r=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,r}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(r){if(this.length===0)return"";for(var i=this.head,n=""+i.data;i=i.next;)n+=r+i.data;return n}},{key:"concat",value:function(r){if(this.length===0)return $c.alloc(0);for(var i=$c.allocUnsafe(r>>>0),n=this.head,s=0;n;)A3(n.data,i,s),s+=n.data.length,n=n.next;return i}},{key:"consume",value:function(r,i){var n;return r<this.head.data.length?(n=this.head.data.slice(0,r),this.head.data=this.head.data.slice(r)):r===this.head.data.length?n=this.shift():n=i?this._getString(r):this._getBuffer(r),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(r){var i=this.head,n=1,s=i.data;for(r-=s.length;i=i.next;){var a=i.data,c=r>a.length?a.length:r;if(c===a.length?s+=a:s+=a.slice(0,r),r-=c,r===0){c===a.length?(++n,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=a.slice(c));break}++n}return this.length-=n,s}},{key:"_getBuffer",value:function(r){var i=$c.allocUnsafe(r),n=this.head,s=1;for(n.data.copy(i),r-=n.data.length;n=n.next;){var a=n.data,c=r>a.length?a.length:r;if(a.copy(i,i.length-r,0,c),r-=c,r===0){c===a.length?(++s,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=a.slice(c));break}++s}return this.length-=s,i}},{key:E3,value:function(r,i){return du(this,v3({},i,{depth:0,customInspect:!1}))}}]),e}();function T3(e,t){var r=this,i=this._readableState&&this._readableState.destroyed,n=this._writableState&&this._writableState.destroyed;return i||n?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,Ce.nextTick(lu,this,e)):Ce.nextTick(lu,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(s){!t&&s?r._writableState?r._writableState.errorEmitted?Ce.nextTick(Hc,r):(r._writableState.errorEmitted=!0,Ce.nextTick(E0,r,s)):Ce.nextTick(E0,r,s):t?(Ce.nextTick(Hc,r),t(s)):Ce.nextTick(Hc,r)}),this)}function E0(e,t){lu(e,t),Hc(e)}function Hc(e){if(e._writableState&&!e._writableState.emitClose)return;if(e._readableState&&!e._readableState.emitClose)return;e.emit("close")}function C3(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function lu(e,t){e.emit("error",t)}function R3(e,t){var r=e._readableState,i=e._writableState;r&&r.autoDestroy||i&&i.autoDestroy?e.destroy(t):e.emit("error",t)}var ca={destroy:T3,undestroy:C3,errorOrDestroy:R3};function M3(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var A0={};function ni(e,t,r){r||(r=Error);function i(s,a,c){return typeof t=="string"?t:t(s,a,c)}var n=function(s){M3(a,s);function a(c,o,d){return s.call(this,i(c,o,d))||this}return a}(r);n.prototype.name=r.name,n.prototype.code=e,A0[e]=n}function I0(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map(function(i){return String(i)}),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:r===2?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}else return"of ".concat(t," ").concat(String(e))}function k3(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}function P3(e,t,r){return(r===void 0||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function N3(e,t,r){return typeof r!="number"&&(r=0),r+t.length>e.length?!1:e.indexOf(t,r)!==-1}ni("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),ni("ERR_INVALID_ARG_TYPE",function(e,t,r){var i;typeof t=="string"&&k3(t,"not ")?(i="must not be",t=t.replace(/^not /,"")):i="must be";var n;if(P3(e," argument"))n="The ".concat(e," ").concat(i," ").concat(I0(t,"type"));else{var s=N3(e,".")?"property":"argument";n='The "'.concat(e,'" ').concat(s," ").concat(i," ").concat(I0(t,"type"))}return n+=". Received type ".concat(typeof r),n},TypeError),ni("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),ni("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),ni("ERR_STREAM_PREMATURE_CLOSE","Premature close"),ni("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),ni("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),ni("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),ni("ERR_STREAM_WRITE_AFTER_END","write after end"),ni("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),ni("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),ni("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");var x3=A0,da={codes:x3},O3=da.codes.ERR_INVALID_OPT_VALUE;function D3(e,t,r){return e.highWaterMark!=null?e.highWaterMark:t?e[r]:null}function B3(e,t,r,i){var n=D3(t,i,r);if(n!=null){if(!(isFinite(n)&&Math.floor(n)===n)||n<0){var s=i?r:"highWaterMark";throw new O3(s,n)}return Math.floor(n)}return e.objectMode?16:16*1024}var T0={getHighWaterMark:B3},L3=j3;function j3(e,t){if(uu("noDeprecation"))return e;var r=!1;function i(){if(!r){if(uu("throwDeprecation"))throw new Error(t);uu("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}return i}function uu(e){try{if(!se.localStorage)return!1}catch(r){return!1}var t=se.localStorage[e];return t==null?!1:String(t).toLowerCase()==="true"}var Vc=Pt;function C0(e){var t=this;this.next=null,this.entry=null,this.finish=function(){lT(t,e)}}var la;Pt.WritableState=To;var F3={deprecate:L3},Gc=pe.Buffer,U3=se.Uint8Array||function(){};function q3(e){return Gc.from(e)}function z3(e){return Gc.isBuffer(e)||e instanceof U3}var $3=T0.getHighWaterMark,Un=da.codes,H3=Un.ERR_INVALID_ARG_TYPE,V3=Un.ERR_METHOD_NOT_IMPLEMENTED,G3=Un.ERR_MULTIPLE_CALLBACK,X3=Un.ERR_STREAM_CANNOT_PIPE,K3=Un.ERR_STREAM_DESTROYED,W3=Un.ERR_STREAM_NULL_VALUES,Y3=Un.ERR_STREAM_WRITE_AFTER_END,Z3=Un.ERR_UNKNOWN_ENCODING,ua=ca.errorOrDestroy;Ka(Pt,ys);function J3(){}function To(e,t,r){la=la||cn,e=e||{},typeof r!="boolean"&&(r=t instanceof la),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=$3(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var i=e.decodeStrings===!1;this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(n){sT(t,n)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=e.emitClose!==!1,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new C0(this)}To.prototype.getBuffer=function(){for(var t=this.bufferedRequest,r=[];t;)r.push(t),t=t.next;return r},function(){try{Object.defineProperty(To.prototype,"buffer",{get:F3.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}();var Xc;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Xc=Function.prototype[Symbol.hasInstance],Object.defineProperty(Pt,Symbol.hasInstance,{value:function(t){return Xc.call(this,t)?!0:this!==Pt?!1:t&&t._writableState instanceof To}})):Xc=function(t){return t instanceof this};function Pt(e){la=la||cn;var t=this instanceof la;if(!t&&!Xc.call(Pt,this))return new Pt(e);this._writableState=new To(e,this,t),this.writable=!0,e&&(typeof e.write=="function"&&(this._write=e.write),typeof e.writev=="function"&&(this._writev=e.writev),typeof e.destroy=="function"&&(this._destroy=e.destroy),typeof e.final=="function"&&(this._final=e.final)),ys.call(this)}Pt.prototype.pipe=function(){ua(this,new X3)};function Q3(e,t){var r=new Y3;ua(e,r),Ce.nextTick(t,r)}function eT(e,t,r,i){var n;return r===null?n=new W3:typeof r!="string"&&!t.objectMode&&(n=new H3("chunk",["string","Buffer"],r)),n?(ua(e,n),Ce.nextTick(i,n),!1):!0}Pt.prototype.write=function(e,t,r){var i=this._writableState,n=!1,s=!i.objectMode&&z3(e);return s&&!Gc.isBuffer(e)&&(e=q3(e)),typeof t=="function"&&(r=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),typeof r!="function"&&(r=J3),i.ending?Q3(this,r):(s||eT(this,i,e,r))&&(i.pendingcb++,n=rT(this,i,s,e,t,r)),n},Pt.prototype.cork=function(){this._writableState.corked++},Pt.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,!e.writing&&!e.corked&&!e.bufferProcessing&&e.bufferedRequest&&M0(this,e))},Pt.prototype.setDefaultEncoding=function(t){if(typeof t=="string"&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new Z3(t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(Pt.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function tT(e,t,r){return!e.objectMode&&e.decodeStrings!==!1&&typeof t=="string"&&(t=Gc.from(t,r)),t}Object.defineProperty(Pt.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function rT(e,t,r,i,n,s){if(!r){var a=tT(t,i,n);i!==a&&(r=!0,n="buffer",i=a)}var c=t.objectMode?1:i.length;t.length+=c;var o=t.length<t.highWaterMark;if(o||(t.needDrain=!0),t.writing||t.corked){var d=t.lastBufferedRequest;t.lastBufferedRequest={chunk:i,encoding:n,isBuf:r,callback:s,next:null},d?d.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else fu(e,t,!1,c,i,n,s);return o}function fu(e,t,r,i,n,s,a){t.writelen=i,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new K3("write")):r?e._writev(n,t.onwrite):e._write(n,s,t.onwrite),t.sync=!1}function iT(e,t,r,i,n){--t.pendingcb,r?(Ce.nextTick(n,i),Ce.nextTick(Co,e,t),e._writableState.errorEmitted=!0,ua(e,i)):(n(i),e._writableState.errorEmitted=!0,ua(e,i),Co(e,t))}function nT(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function sT(e,t){var r=e._writableState,i=r.sync,n=r.writecb;if(typeof n!="function")throw new G3;if(nT(r),t)iT(e,r,i,t,n);else{var s=k0(r)||e.destroyed;!s&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&M0(e,r),i?Ce.nextTick(R0,e,r,s,n):R0(e,r,s,n)}}function R0(e,t,r,i){r||aT(e,t),t.pendingcb--,i(),Co(e,t)}function aT(e,t){t.length===0&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function M0(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var i=t.bufferedRequestCount,n=new Array(i),s=t.corkedRequestsFree;s.entry=r;for(var a=0,c=!0;r;)n[a]=r,r.isBuf||(c=!1),r=r.next,a+=1;n.allBuffers=c,fu(e,t,!0,t.length,n,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new C0(t),t.bufferedRequestCount=0}else{for(;r;){var o=r.chunk,d=r.encoding,l=r.callback,u=t.objectMode?1:o.length;if(fu(e,t,!1,u,o,d,l),r=r.next,t.bufferedRequestCount--,t.writing)break}r===null&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}Pt.prototype._write=function(e,t,r){r(new V3("_write()"))},Pt.prototype._writev=null,Pt.prototype.end=function(e,t,r){var i=this._writableState;return typeof e=="function"?(r=e,e=null,t=null):typeof t=="function"&&(r=t,t=null),e!=null&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||dT(this,i,r),this},Object.defineProperty(Pt.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function k0(e){return e.ending&&e.length===0&&e.bufferedRequest===null&&!e.finished&&!e.writing}function oT(e,t){e._final(function(r){t.pendingcb--,r&&ua(e,r),t.prefinished=!0,e.emit("prefinish"),Co(e,t)})}function cT(e,t){!t.prefinished&&!t.finalCalled&&(typeof e._final=="function"&&!t.destroyed?(t.pendingcb++,t.finalCalled=!0,Ce.nextTick(oT,e,t)):(t.prefinished=!0,e.emit("prefinish")))}function Co(e,t){var r=k0(t);if(r&&(cT(e,t),t.pendingcb===0&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var i=e._readableState;(!i||i.autoDestroy&&i.endEmitted)&&e.destroy()}return r}function dT(e,t,r){t.ending=!0,Co(e,t),r&&(t.finished?Ce.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function lT(e,t,r){var i=e.entry;for(e.entry=null;i;){var n=i.callback;t.pendingcb--,n(r),i=i.next}t.corkedRequestsFree.next=e}Object.defineProperty(Pt.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(t){if(!this._writableState)return;this._writableState.destroyed=t}}),Pt.prototype.destroy=ca.destroy,Pt.prototype._undestroy=ca.undestroy,Pt.prototype._destroy=function(e,t){t(e)};var uT=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t},cn=ji;Ka(ji,vu);for(var P0=uT(Vc.prototype),hu=0;hu<P0.length;hu++){var pu=P0[hu];ji.prototype[pu]||(ji.prototype[pu]=Vc.prototype[pu])}function ji(e){if(!(this instanceof ji))return new ji(e);vu.call(this,e),Vc.call(this,e),this.allowHalfOpen=!0,e&&(e.readable===!1&&(this.readable=!1),e.writable===!1&&(this.writable=!1),e.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",fT)))}Object.defineProperty(ji.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(ji.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(ji.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function fT(){if(this._writableState.ended)return;Ce.nextTick(hT,this)}function hT(e){e.end()}Object.defineProperty(ji.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(t){if(this._readableState===void 0||this._writableState===void 0)return;this._readableState.destroyed=t,this._writableState.destroyed=t}});var mu=vy.Buffer,N0=mu.isEncoding||function(e){e=""+e;switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function pT(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function mT(e){var t=pT(e);if(typeof t!="string"&&(mu.isEncoding===N0||!N0(e)))throw new Error("Unknown encoding: "+e);return t||e}var gT=Ro;function Ro(e){this.encoding=mT(e);var t;switch(this.encoding){case"utf16le":this.text=_T,this.end=ET,t=4;break;case"utf8":this.fillLast=vT,t=4;break;case"base64":this.text=AT,this.end=IT,t=3;break;default:this.write=TT,this.end=CT;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=mu.allocUnsafe(t)}Ro.prototype.write=function(e){if(e.length===0)return"";var t,r;if(this.lastNeed){if(t=this.fillLast(e),t===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},Ro.prototype.end=ST,Ro.prototype.text=wT,Ro.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length};function gu(e){return e<=127?0:e>>5===6?2:e>>4===14?3:e>>3===30?4:e>>6===2?-1:-2}function bT(e,t,r){var i=t.length-1;if(i<r)return 0;var n=gu(t[i]);return n>=0?(n>0&&(e.lastNeed=n-1),n):--i<r||n===-2?0:(n=gu(t[i]),n>=0?(n>0&&(e.lastNeed=n-2),n):--i<r||n===-2?0:(n=gu(t[i]),n>=0?(n>0&&(n===2?n=0:e.lastNeed=n-3),n):0))}function yT(e,t,r){if((t[0]&192)!==128)return e.lastNeed=0,"\uFFFD";if(e.lastNeed>1&&t.length>1){if((t[1]&192)!==128)return e.lastNeed=1,"\uFFFD";if(e.lastNeed>2&&t.length>2&&(t[2]&192)!==128)return e.lastNeed=2,"\uFFFD"}}function vT(e){var t=this.lastTotal-this.lastNeed,r=yT(this,e);if(r!==void 0)return r;if(this.lastNeed<=e.length)return e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length}function wT(e,t){var r=bT(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var i=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,i),e.toString("utf8",t,i)}function ST(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\uFFFD":t}function _T(e,t){if((e.length-t)%2===0){var r=e.toString("utf16le",t);if(r){var i=r.charCodeAt(r.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function ET(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function AT(e,t){var r=(e.length-t)%3;return r===0?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function IT(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function TT(e){return e.toString(this.encoding)}function CT(e){return e&&e.length?this.write(e):""}var x0={StringDecoder:gT},O0=da.codes.ERR_STREAM_PREMATURE_CLOSE;function RT(e){var t=!1;return function(){if(t)return;t=!0;for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];e.apply(this,i)}}function MT(){}function kT(e){return e.setHeader&&typeof e.abort=="function"}function D0(e,t,r){if(typeof t=="function")return D0(e,null,t);t||(t={}),r=RT(r||MT);var i=t.readable||t.readable!==!1&&e.readable,n=t.writable||t.writable!==!1&&e.writable,s=function(){e.writable||c()},a=e._writableState&&e._writableState.finished,c=function(){n=!1,a=!0,i||r.call(e)},o=e._readableState&&e._readableState.endEmitted,d=function(){i=!1,o=!0,n||r.call(e)},l=function(g){r.call(e,g)},u=function(){var g;if(i&&!o)return(!e._readableState||!e._readableState.ended)&&(g=new O0),r.call(e,g);if(n&&!a)return(!e._writableState||!e._writableState.ended)&&(g=new O0),r.call(e,g)},p=function(){e.req.on("finish",c)};return kT(e)?(e.on("complete",c),e.on("abort",u),e.req?p():e.on("request",p)):n&&!e._writableState&&(e.on("end",s),e.on("close",s)),e.on("end",d),e.on("finish",c),t.error!==!1&&e.on("error",l),e.on("close",u),function(){e.removeListener("complete",c),e.removeListener("abort",u),e.removeListener("request",p),e.req&&e.req.removeListener("finish",c),e.removeListener("end",s),e.removeListener("close",s),e.removeListener("finish",c),e.removeListener("end",d),e.removeListener("error",l),e.removeListener("close",u)}}var bu=D0,Kc;function qn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var zn=Symbol("lastResolve"),vs=Symbol("lastReject"),Mo=Symbol("error"),Wc=Symbol("ended"),ws=Symbol("lastPromise"),yu=Symbol("handlePromise"),Ss=Symbol("stream");function $n(e,t){return{value:e,done:t}}function PT(e){var t=e[zn];if(t!==null){var r=e[Ss].read();r!==null&&(e[ws]=null,e[zn]=null,e[vs]=null,t($n(r,!1)))}}function NT(e){Ce.nextTick(PT,e)}function xT(e,t){return function(r,i){e.then(function(){if(t[Wc]){r($n(void 0,!0));return}t[yu](r,i)},i)}}var OT=Object.getPrototypeOf(function(){}),DT=Object.setPrototypeOf((Kc={get stream(){return this[Ss]},next:function(){var t=this,r=this[Mo];if(r!==null)return Promise.reject(r);if(this[Wc])return Promise.resolve($n(void 0,!0));if(this[Ss].destroyed)return new Promise(function(a,c){Ce.nextTick(function(){t[Mo]?c(t[Mo]):a($n(void 0,!0))})});var i=this[ws],n;if(i)n=new Promise(xT(i,this));else{var s=this[Ss].read();if(s!==null)return Promise.resolve($n(s,!1));n=new Promise(this[yu])}return this[ws]=n,n}},qn(Kc,Symbol.asyncIterator,function(){return this}),qn(Kc,"return",function(){var t=this;return new Promise(function(r,i){t[Ss].destroy(null,function(n){if(n){i(n);return}r($n(void 0,!0))})})}),Kc),OT),BT=function(t){var r,i=Object.create(DT,(r={},qn(r,Ss,{value:t,writable:!0}),qn(r,zn,{value:null,writable:!0}),qn(r,vs,{value:null,writable:!0}),qn(r,Mo,{value:null,writable:!0}),qn(r,Wc,{value:t._readableState.endEmitted,writable:!0}),qn(r,yu,{value:function(s,a){var c=i[Ss].read();c?(i[ws]=null,i[zn]=null,i[vs]=null,s($n(c,!1))):(i[zn]=s,i[vs]=a)},writable:!0}),r));return i[ws]=null,bu(t,function(n){if(n&&n.code!=="ERR_STREAM_PREMATURE_CLOSE"){var s=i[vs];s!==null&&(i[ws]=null,i[zn]=null,i[vs]=null,s(n)),i[Mo]=n;return}var a=i[zn];a!==null&&(i[ws]=null,i[zn]=null,i[vs]=null,a($n(void 0,!0))),i[Wc]=!0}),t.on("readable",NT.bind(null,i)),i},LT=BT,jT=function(){throw new Error("Readable.from is not available in the browser")},vu=He,fa;He.ReadableState=L0;var hP=_r.EventEmitter,B0=function(t,r){return t.listeners(r).length},Yc=pe.Buffer,FT=se.Uint8Array||function(){};function UT(e){return Yc.from(e)}function qT(e){return Yc.isBuffer(e)||e instanceof FT}var Be;os&&os.debuglog?Be=os.debuglog("stream"):Be=function(){};var zT=T0.getHighWaterMark,Zc=da.codes,$T=Zc.ERR_INVALID_ARG_TYPE,HT=Zc.ERR_STREAM_PUSH_AFTER_EOF,VT=Zc.ERR_METHOD_NOT_IMPLEMENTED,GT=Zc.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,ha,wu,Su;Ka(He,ys);var ko=ca.errorOrDestroy,_u=["error","close","destroy","pause","resume"];function XT(e,t,r){if(typeof e.prependListener=="function")return e.prependListener(t,r);!e._events||!e._events[t]?e.on(t,r):Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]}function L0(e,t,r){fa=fa||cn,e=e||{},typeof r!="boolean"&&(r=t instanceof fa),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=zT(this,e,"readableHighWaterMark",r),this.buffer=new I3,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=e.emitClose!==!1,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(ha||(ha=x0.StringDecoder),this.decoder=new ha(e.encoding),this.encoding=e.encoding)}function He(e){if(fa=fa||cn,!(this instanceof He))return new He(e);var t=this instanceof fa;this._readableState=new L0(e,this,t),this.readable=!0,e&&(typeof e.read=="function"&&(this._read=e.read),typeof e.destroy=="function"&&(this._destroy=e.destroy)),ys.call(this)}Object.defineProperty(He.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(t){if(!this._readableState)return;this._readableState.destroyed=t}}),He.prototype.destroy=ca.destroy,He.prototype._undestroy=ca.undestroy,He.prototype._destroy=function(e,t){t(e)},He.prototype.push=function(e,t){var r=this._readableState,i;return r.objectMode?i=!0:typeof e=="string"&&(t=t||r.defaultEncoding,t!==r.encoding&&(e=Yc.from(e,t),t=""),i=!0),j0(this,e,t,!1,i)},He.prototype.unshift=function(e){return j0(this,e,null,!0,!1)};function j0(e,t,r,i,n){Be("readableAddChunk",t);var s=e._readableState;if(t===null)s.reading=!1,YT(e,s);else{var a;if(n||(a=KT(s,t)),a)ko(e,a);else if(s.objectMode||t&&t.length>0)if(typeof t!="string"&&!s.objectMode&&Object.getPrototypeOf(t)!==Yc.prototype&&(t=UT(t)),i)s.endEmitted?ko(e,new GT):Eu(e,s,t,!0);else if(s.ended)ko(e,new HT);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!r?(t=s.decoder.write(t),s.objectMode||t.length!==0?Eu(e,s,t,!1):Au(e,s)):Eu(e,s,t,!1)}else i||(s.reading=!1,Au(e,s))}return!s.ended&&(s.length<s.highWaterMark||s.length===0)}function Eu(e,t,r,i){t.flowing&&t.length===0&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,i?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&Jc(e)),Au(e,t)}function KT(e,t){var r;return!qT(t)&&typeof t!="string"&&t!==void 0&&!e.objectMode&&(r=new $T("chunk",["string","Buffer","Uint8Array"],t)),r}He.prototype.isPaused=function(){return this._readableState.flowing===!1},He.prototype.setEncoding=function(e){ha||(ha=x0.StringDecoder);var t=new ha(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,i="";r!==null;)i+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),i!==""&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var F0=1073741824;function WT(e){return e>=F0?e=F0:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function U0(e,t){return e<=0||t.length===0&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=WT(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}He.prototype.read=function(e){Be("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(e!==0&&(t.emittedReadable=!1),e===0&&t.needReadable&&((t.highWaterMark!==0?t.length>=t.highWaterMark:t.length>0)||t.ended))return Be("read: emitReadable",t.length,t.ended),t.length===0&&t.ended?Tu(this):Jc(this),null;if(e=U0(e,t),e===0&&t.ended)return t.length===0&&Tu(this),null;var i=t.needReadable;Be("need readable",i),(t.length===0||t.length-e<t.highWaterMark)&&(i=!0,Be("length less than watermark",i)),t.ended||t.reading?(i=!1,Be("reading or ended",i)):i&&(Be("do read"),t.reading=!0,t.sync=!0,t.length===0&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=U0(r,t)));var n;return e>0?n=$0(e,t):n=null,n===null?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),t.length===0&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&Tu(this)),n!==null&&this.emit("data",n),n};function YT(e,t){if(Be("onEofChunk"),t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?Jc(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,q0(e)))}function Jc(e){var t=e._readableState;Be("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(Be("emitReadable",t.flowing),t.emittedReadable=!0,Ce.nextTick(q0,e))}function q0(e){var t=e._readableState;Be("emitReadable_",t.destroyed,t.length,t.ended),!t.destroyed&&(t.length||t.ended)&&(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,Iu(e)}function Au(e,t){t.readingMore||(t.readingMore=!0,Ce.nextTick(ZT,e,t))}function ZT(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&t.length===0);){var r=t.length;if(Be("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}He.prototype._read=function(e){ko(this,new VT("_read()"))},He.prototype.pipe=function(e,t){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e);break}i.pipesCount+=1,Be("pipe count=%d opts=%j",i.pipesCount,t);var n=(!t||t.end!==!1)&&e!==Ce.stdout&&e!==Ce.stderr,s=n?c:v;i.endEmitted?Ce.nextTick(s):r.once("end",s),e.on("unpipe",a);function a(S,C){Be("onunpipe"),S===r&&(C&&C.hasUnpiped===!1&&(C.hasUnpiped=!0,l()))}function c(){Be("onend"),e.end()}var o=JT(r);e.on("drain",o);var d=!1;function l(){Be("cleanup"),e.removeListener("close",f),e.removeListener("finish",g),e.removeListener("drain",o),e.removeListener("error",p),e.removeListener("unpipe",a),r.removeListener("end",c),r.removeListener("end",v),r.removeListener("data",u),d=!0,i.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&o()}r.on("data",u);function u(S){Be("ondata");var C=e.write(S);Be("dest.write",C),C===!1&&((i.pipesCount===1&&i.pipes===e||i.pipesCount>1&&H0(i.pipes,e)!==-1)&&!d&&(Be("false write response, pause",i.awaitDrain),i.awaitDrain++),r.pause())}function p(S){Be("onerror",S),v(),e.removeListener("error",p),B0(e,"error")===0&&ko(e,S)}XT(e,"error",p);function f(){e.removeListener("finish",g),v()}e.once("close",f);function g(){Be("onfinish"),e.removeListener("close",f),v()}e.once("finish",g);function v(){Be("unpipe"),r.unpipe(e)}return e.emit("pipe",r),i.flowing||(Be("pipe resume"),r.resume()),e};function JT(e){return function(){var r=e._readableState;Be("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&B0(e,"data")&&(r.flowing=!0,Iu(e))}}He.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(t.pipesCount===0)return this;if(t.pipesCount===1)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var i=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<n;s++)i[s].emit("unpipe",this,{hasUnpiped:!1});return this}var a=H0(t.pipes,e);return a===-1?this:(t.pipes.splice(a,1),t.pipesCount-=1,t.pipesCount===1&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)},He.prototype.on=function(e,t){var r=ys.prototype.on.call(this,e,t),i=this._readableState;return e==="data"?(i.readableListening=this.listenerCount("readable")>0,i.flowing!==!1&&this.resume()):e==="readable"&&(!i.endEmitted&&!i.readableListening&&(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,Be("on readable",i.length,i.reading),i.length?Jc(this):i.reading||Ce.nextTick(QT,this))),r},He.prototype.addListener=He.prototype.on,He.prototype.removeListener=function(e,t){var r=ys.prototype.removeListener.call(this,e,t);return e==="readable"&&Ce.nextTick(z0,this),r},He.prototype.removeAllListeners=function(e){var t=ys.prototype.removeAllListeners.apply(this,arguments);return(e==="readable"||e===void 0)&&Ce.nextTick(z0,this),t};function z0(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function QT(e){Be("readable nexttick read 0"),e.read(0)}He.prototype.resume=function(){var e=this._readableState;return e.flowing||(Be("resume"),e.flowing=!e.readableListening,eC(this,e)),e.paused=!1,this};function eC(e,t){t.resumeScheduled||(t.resumeScheduled=!0,Ce.nextTick(tC,e,t))}function tC(e,t){Be("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),Iu(e),t.flowing&&!t.reading&&e.read(0)}He.prototype.pause=function(){return Be("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(Be("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Iu(e){var t=e._readableState;for(Be("flow",t.flowing);t.flowing&&e.read()!==null;);}He.prototype.wrap=function(e){var t=this,r=this._readableState,i=!1;e.on("end",function(){if(Be("wrapped end"),r.decoder&&!r.ended){var a=r.decoder.end();a&&a.length&&t.push(a)}t.push(null)}),e.on("data",function(a){if(Be("wrapped data"),r.decoder&&(a=r.decoder.write(a)),r.objectMode&&a==null)return;if(!r.objectMode&&(!a||!a.length))return;var c=t.push(a);c||(i=!0,e.pause())});for(var n in e)this[n]===void 0&&typeof e[n]=="function"&&(this[n]=function(c){return function(){return e[c].apply(e,arguments)}}(n));for(var s=0;s<_u.length;s++)e.on(_u[s],this.emit.bind(this,_u[s]));return this._read=function(a){Be("wrapped _read",a),i&&(i=!1,e.resume())},this},typeof Symbol=="function"&&(He.prototype[Symbol.asyncIterator]=function(){return wu===void 0&&(wu=LT),wu(this)}),Object.defineProperty(He.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(He.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(He.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(t){this._readableState&&(this._readableState.flowing=t)}}),He._fromList=$0,Object.defineProperty(He.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function $0(e,t){if(t.length===0)return null;var r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(t.decoder?r=t.buffer.join(""):t.buffer.length===1?r=t.buffer.first():r=t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r}function Tu(e){var t=e._readableState;Be("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,Ce.nextTick(rC,t,e))}function rC(e,t){if(Be("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&e.length===0&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}typeof Symbol=="function"&&(He.from=function(e,t){return Su===void 0&&(Su=jT),Su(He,e,t)});function H0(e,t){for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1}var Cu=dn,Qc=da.codes,iC=Qc.ERR_METHOD_NOT_IMPLEMENTED,nC=Qc.ERR_MULTIPLE_CALLBACK,sC=Qc.ERR_TRANSFORM_ALREADY_TRANSFORMING,aC=Qc.ERR_TRANSFORM_WITH_LENGTH_0;Ka(dn,cn);function oC(e,t){var r=this._transformState;r.transforming=!1;var i=r.writecb;if(i===null)return this.emit("error",new nC);r.writechunk=null,r.writecb=null,t!=null&&this.push(t),i(e);var n=this._readableState;n.reading=!1,(n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}function dn(e){if(!(this instanceof dn))return new dn(e);cn.call(this,e),this._transformState={afterTransform:oC.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&(typeof e.transform=="function"&&(this._transform=e.transform),typeof e.flush=="function"&&(this._flush=e.flush)),this.on("prefinish",cC)}function cC(){var e=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(t,r){V0(e,t,r)}):V0(this,null,null)}dn.prototype.push=function(e,t){return this._transformState.needTransform=!1,cn.prototype.push.call(this,e,t)},dn.prototype._transform=function(e,t,r){r(new iC("_transform()"))},dn.prototype._write=function(e,t,r){var i=this._transformState;if(i.writecb=r,i.writechunk=e,i.writeencoding=t,!i.transforming){var n=this._readableState;(i.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},dn.prototype._read=function(e){var t=this._transformState;t.writechunk!==null&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},dn.prototype._destroy=function(e,t){cn.prototype._destroy.call(this,e,function(r){t(r)})};function V0(e,t,r){if(t)return e.emit("error",t);if(r!=null&&e.push(r),e._writableState.length)throw new aC;if(e._transformState.transforming)throw new sC;return e.push(null)}var dC=Po;Ka(Po,Cu);function Po(e){if(!(this instanceof Po))return new Po(e);Cu.call(this,e)}Po.prototype._transform=function(e,t,r){r(null,e)};var Ru;function lC(e){var t=!1;return function(){if(t)return;t=!0,e.apply(void 0,arguments)}}var G0=da.codes,uC=G0.ERR_MISSING_ARGS,fC=G0.ERR_STREAM_DESTROYED;function X0(e){if(e)throw e}function hC(e){return e.setHeader&&typeof e.abort=="function"}function pC(e,t,r,i){i=lC(i);var n=!1;e.on("close",function(){n=!0}),Ru===void 0&&(Ru=bu),Ru(e,{readable:t,writable:r},function(a){if(a)return i(a);n=!0,i()});var s=!1;return function(a){if(n)return;if(s)return;if(s=!0,hC(e))return e.abort();if(typeof e.destroy=="function")return e.destroy();i(a||new fC("pipe"))}}function K0(e){e()}function mC(e,t){return e.pipe(t)}function gC(e){return e.length?typeof e[e.length-1]!="function"?X0:e.pop():X0}function bC(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=gC(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new uC("streams");var n,s=t.map(function(a,c){var o=c<t.length-1,d=c>0;return pC(a,o,d,function(l){if(n||(n=l),l&&s.forEach(K0),o)return;s.forEach(K0),i(n)})});return t.reduce(mC)}var yC=bC,vC=ne(function(e,t){t=e.exports=vu,t.Stream=t,t.Readable=t,t.Writable=Vc,t.Duplex=cn,t.Transform=Cu,t.PassThrough=dC,t.finished=bu,t.pipeline=yC});/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let W0;var Mu=typeof queueMicrotask=="function"?queueMicrotask:e=>(W0||(W0=Promise.resolve())).then(e).catch(t=>setTimeout(()=>{throw t},0));/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var wC=le("simple-peer"),ku=64*1024,SC=5*1e3,_C=5*1e3;function Y0(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}function EC(e){console.warn(e)}class pa extends vC.Duplex{constructor(e){if(e=Object.assign({allowHalfOpen:!1},e),super(e),this._id=Df(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||Df(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||pa.channelConfig,this.negotiated=this.channelConfig.negotiated,this.config=Object.assign({},pa.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(t=>t),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||SC,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:w0(),!this._wrtc)throw typeof window=="undefined"?G(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):G(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=this.negotiated?!1:!this.initiator,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._firstStable=!0,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(t){Mu(()=>this.destroy(G(t,"ERR_PC_CONSTRUCTOR")));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=t=>{this._onIceCandidate(t)},this.initiator||this.negotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=t=>{this._setupData(t)},this.streams&&this.streams.forEach(t=>{this.addStream(t)}),this._pc.ontrack=t=>{this._onTrack(t)},this.initiator&&this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(this.destroyed)throw G(new Error("cannot signal after peer is destroyed"),"ERR_SIGNALING");if(typeof e=="string")try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{if(this.destroyed)return;this._pendingCandidates.forEach(t=>{this._addIceCandidate(t)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer()}).catch(t=>{this.destroy(G(t,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(G(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}_addIceCandidate(e){var t=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(t).catch(r=>{!t.address||t.address.endsWith(".local")?EC("Ignoring unsupported ICE candidate."):this.destroy(G(r,"ERR_ADD_ICE_CANDIDATE"))})}send(e){this._channel.send(e)}addTransceiver(e,t){if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(r){this.destroy(G(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{transceiverRequest:{kind:e,init:t}})}addStream(e){this._debug("addStream()"),e.getTracks().forEach(t=>{this.addTrack(t,e)})}addTrack(e,t){this._debug("addTrack()");var r=this._senderMap.get(e)||new Map,i=r.get(t);if(!i)i=this._pc.addTrack(e,t),r.set(t,i),this._senderMap.set(e,r),this._needsNegotiation();else throw i.removed?G(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):G(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,t,r){this._debug("replaceTrack()");var i=this._senderMap.get(e),n=i?i.get(r):null;if(!n)throw G(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,i),n.replaceTrack!=null?n.replaceTrack(t):this.destroy(G(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,t){this._debug("removeSender()");var r=this._senderMap.get(e),i=r?r.get(t):null;if(!i)throw G(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{i.removed=!0,this._pc.removeTrack(i)}catch(n){n.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(i):this.destroy(G(n,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){this._debug("removeSenders()"),e.getTracks().forEach(t=>{this.removeTrack(t,e)})}_needsNegotiation(){if(this._debug("_needsNegotiation"),this._batchedNegotiation)return;this._batchedNegotiation=!0,Mu(()=>{this._batchedNegotiation=!1,this._debug("starting batched negotiation"),this.negotiate()})}negotiate(){this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{renegotiate:!0})),this._isNegotiating=!0}_destroy(e,t){if(this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(r){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(r){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,t(e)}_setupData(e){if(!e.channel)return this.destroy(G(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=ku),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{this.destroy(G(r,"ERR_DATA_CHANNEL"))};var t=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(t&&this._onChannelClose(),t=!0):t=!1},_C)}_read(){}_write(e,t,r){if(this.destroyed)return r(G(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(i){return this.destroy(G(i,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>ku?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){if(this.destroyed)return;if(this._iceCompleteTimer)return;this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout)}_createOffer(){if(this.destroyed)return;this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Y0(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;var n=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:n.type,sdp:n.sdp})},r=()=>{if(this._debug("createOffer success"),this.destroyed)return;this.trickle||this._iceComplete?t():this.once("_iceComplete",t)},i=n=>{this.destroy(G(n,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(i)}).catch(e=>{this.destroy(G(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){if(this.destroyed)return;this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Y0(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;var n=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:n.type,sdp:n.sdp}),this.initiator||this._requestMissingTransceivers()},r=()=>{if(this.destroyed)return;this.trickle||this._iceComplete?t():this.once("_iceComplete",t)},i=n=>{this.destroy(G(n,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(i)}).catch(e=>{this.destroy(G(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){if(this.destroyed)return;this._pc.connectionState==="failed"&&this.destroy(G(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(G(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(G(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const t=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(i=>{Object.assign(r,i)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{var i=[];r.forEach(n=>{i.push(t(n))}),e(null,i)},r=>e(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;var i=[];r.result().forEach(n=>{var s={};n.names().forEach(a=>{s[a]=n.stat(a)}),s.id=n.id,s.type=n.type,s.timestamp=n.timestamp,i.push(t(s))}),e(null,i)},r=>e(r)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{if(this.destroyed)return;this.getStats((t,r)=>{if(this.destroyed)return;t&&(r=[]);var i={},n={},s={},a=!1;r.forEach(d=>{(d.type==="remotecandidate"||d.type==="remote-candidate")&&(i[d.id]=d),(d.type==="localcandidate"||d.type==="local-candidate")&&(n[d.id]=d),(d.type==="candidatepair"||d.type==="candidate-pair")&&(s[d.id]=d)});const c=d=>{a=!0;var l=n[d.localCandidateId];l&&(l.ip||l.address)?(this.localAddress=l.ip||l.address,this.localPort=Number(l.port)):l&&l.ipAddress?(this.localAddress=l.ipAddress,this.localPort=Number(l.portNumber)):typeof d.googLocalAddress=="string"&&(l=d.googLocalAddress.split(":"),this.localAddress=l[0],this.localPort=Number(l[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");var u=i[d.remoteCandidateId];u&&(u.ip||u.address)?(this.remoteAddress=u.ip||u.address,this.remotePort=Number(u.port)):u&&u.ipAddress?(this.remoteAddress=u.ipAddress,this.remotePort=Number(u.portNumber)):typeof d.googRemoteAddress=="string"&&(u=d.googRemoteAddress.split(":"),this.remoteAddress=u[0],this.remotePort=Number(u[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(d=>{d.type==="transport"&&d.selectedCandidatePairId&&c(s[d.selectedCandidatePairId]),(d.type==="googCandidatePair"&&d.googActiveConnection==="true"||(d.type==="candidatepair"||d.type==="candidate-pair")&&d.selected)&&c(d)}),!a&&(!Object.keys(s).length||Object.keys(n).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(d){return this.destroy(G(d,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');var o=this._cb;this._cb=null,o(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){if(!this._cb||!this._channel||this._channel.bufferedAmount>ku)return;this._onChannelBufferedAmountLow()}_onSignalingStateChange(){if(this.destroyed)return;this._pc.signalingState==="stable"&&!this._firstStable&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation&&(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()),this._debug("negotiate"),this.emit("negotiate")),this._firstStable=!1,this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState)}_onIceCandidate(e){if(this.destroyed)return;e.candidate&&this.trickle?this.emit("signal",{candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout()}_onChannelMessage(e){if(this.destroyed)return;var t=e.data;t instanceof ArrayBuffer&&(t=new Uint8Array(t)),this.push(t)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var e=this._cb;this._cb=null,e(null)}_onChannelOpen(){if(this._connected||this.destroyed)return;this._debug("on channel open"),this._channelReady=!0,this._maybeReady()}_onChannelClose(){if(this.destroyed)return;this._debug("on channel close"),this.destroy()}_onTrack(e){if(this.destroyed)return;e.streams.forEach(t=>{if(this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),this._remoteStreams.some(r=>r.id===t.id))return;this._remoteStreams.push(t),Mu(()=>{this.emit("stream",t)})})}_debug(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],wC.apply(null,e)}}pa.WEBRTC_SUPPORT=!!w0(),pa.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},pa.channelConfig={};var Z0=pa;(function(){if(typeof globalThis=="object")return;Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__})();var J0=globalThis,AC={supportsFileReader:typeof self!="undefined"&&"FileReader"in self,supportsWebRTC:"RTCPeerConnection"in J0&&(typeof navigator!="undefined"&&typeof navigator.mediaDevices!="undefined")&&"getUserMedia"in navigator.mediaDevices,supportsWebRTCDataChannels:"RTCPeerConnection"in J0},IC=421,TC=290,CC=2e3,Pu={CODE_P2P:IC,CODE_CIRCUIT:TC,CLOSE_TIMEOUT:CC},RC=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,MC=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Nu=function(t){var r=t,i=t.indexOf("["),n=t.indexOf("]");i!=-1&&n!=-1&&(t=t.substring(0,i)+t.substring(i,n).replace(/:/g,";")+t.substring(n,t.length));for(var s=RC.exec(t||""),a={},c=14;c--;)a[MC[c]]=s[c]||"";return i!=-1&&n!=-1&&(a.source=r,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=kC(a,a.path),a.queryKey=PC(a,a.query),a};function kC(e,t){var r=/\/{2,9}/g,i=t.replace(r,"/").split("/");return(t.substr(0,1)=="/"||t.length===0)&&i.splice(0,1),t.substr(t.length-1,1)=="/"&&i.splice(i.length-1,1),i}function PC(e,t){var r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,n,s){n&&(r[n]=s)}),r}var No=1e3,xo=No*60,Oo=xo*60,Do=Oo*24,NC=Do*365.25,xC=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return OC(e);if(r==="number"&&isNaN(e)===!1)return t.long?BC(e):DC(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function OC(e){if(e=String(e),e.length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]),i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return r*NC;case"days":case"day":case"d":return r*Do;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Oo;case"minutes":case"minute":case"mins":case"min":case"m":return r*xo;case"seconds":case"second":case"secs":case"sec":case"s":return r*No;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}function DC(e){return e>=Do?Math.round(e/Do)+"d":e>=Oo?Math.round(e/Oo)+"h":e>=xo?Math.round(e/xo)+"m":e>=No?Math.round(e/No)+"s":e+"ms"}function BC(e){return ed(e,Do,"day")||ed(e,Oo,"hour")||ed(e,xo,"minute")||ed(e,No,"second")||e+" ms"}function ed(e,t,r){return e<t?void 0:e<t*1.5?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var LC=ne(function(e,t){t=e.exports=i.debug=i.default=i,t.coerce=o,t.disable=a,t.enable=s,t.enabled=c,t.humanize=xC,t.instances=[],t.names=[],t.skips=[],t.formatters={};function r(d){var l=0,u;for(u in d)l=(l<<5)-l+d.charCodeAt(u),l|=0;return t.colors[Math.abs(l)%t.colors.length]}function i(d){var l;function u(){if(!u.enabled)return;var p=u,f=+new Date,g=f-(l||f);p.diff=g,p.prev=l,p.curr=f,l=f;for(var v=new Array(arguments.length),S=0;S<v.length;S++)v[S]=arguments[S];v[0]=t.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");var C=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,function(j,m){if(j==="%%")return j;C++;var w=t.formatters[m];if(typeof w=="function"){var R=v[C];j=w.call(p,R),v.splice(C,1),C--}return j}),t.formatArgs.call(p,v);var D=u.log||t.log||console.log.bind(console);D.apply(p,v)}return u.namespace=d,u.enabled=t.enabled(d),u.useColors=t.useColors(),u.color=r(d),u.destroy=n,typeof t.init=="function"&&t.init(u),t.instances.push(u),u}function n(){var d=t.instances.indexOf(this);return d!==-1?(t.instances.splice(d,1),!0):!1}function s(d){t.save(d),t.names=[],t.skips=[];var l,u=(typeof d=="string"?d:"").split(/[\s,]+/),p=u.length;for(l=0;l<p;l++){if(!u[l])continue;d=u[l].replace(/\*/g,".*?"),d[0]==="-"?t.skips.push(new RegExp("^"+d.substr(1)+"$")):t.names.push(new RegExp("^"+d+"$"))}for(l=0;l<t.instances.length;l++){var f=t.instances[l];f.enabled=t.enabled(f.namespace)}}function a(){t.enable("")}function c(d){if(d[d.length-1]==="*")return!0;var l,u;for(l=0,u=t.skips.length;l<u;l++)if(t.skips[l].test(d))return!1;for(l=0,u=t.names.length;l<u;l++)if(t.names[l].test(d))return!0;return!1}function o(d){return d instanceof Error?d.stack||d.message:d}}),td=ne(function(e,t){t=e.exports=LC,t.log=n,t.formatArgs=i,t.save=s,t.load=a,t.useColors=r,t.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:c(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&window.process.type==="renderer"?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}t.formatters.j=function(o){try{return JSON.stringify(o)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}};function i(o){var d=this.useColors;if(o[0]=(d?"%c":"")+this.namespace+(d?" %c":" ")+o[0]+(d?"%c ":" ")+"+"+t.humanize(this.diff),!d)return;var l="color: "+this.color;o.splice(1,0,l,"color: inherit");var u=0,p=0;o[0].replace(/%[a-zA-Z%]/g,function(f){if(f==="%%")return;u++,f==="%c"&&(p=u)}),o.splice(p,0,l)}function n(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(o){try{o==null?t.storage.removeItem("debug"):t.storage.debug=o}catch(d){}}function a(){var o;try{o=t.storage.debug}catch(d){}return!o&&typeof Ce!="undefined"&&"env"in Ce&&(o=Ce.env.DEBUG),o}t.enable(a());function c(){try{return window.localStorage}catch(o){}}}),Q0=td("socket.io-client:url"),jC=FC;function FC(e,t){var r=e;t=t||typeof location!="undefined"&&location,e==null&&(e=t.protocol+"//"+t.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=t.protocol+e:e=t.host+e),/^(https?|wss?):\/\//.test(e)||(Q0("protocol-less url %s",e),typeof t!="undefined"?e=t.protocol+"//"+e:e="https://"+e),Q0("parse %s",e),r=Nu(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var i=r.host.indexOf(":")!==-1,n=i?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+n+":"+r.port,r.href=r.protocol+"://"+n+(t&&t.port===r.port?"":":"+r.port),r}var Bo=1e3,Lo=Bo*60,jo=Lo*60,Fo=jo*24,UC=Fo*365.25,qC=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return zC(e);if(r==="number"&&isNaN(e)===!1)return t.long?HC(e):$C(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function zC(e){if(e=String(e),e.length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]),i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return r*UC;case"days":case"day":case"d":return r*Fo;case"hours":case"hour":case"hrs":case"hr":case"h":return r*jo;case"minutes":case"minute":case"mins":case"min":case"m":return r*Lo;case"seconds":case"second":case"secs":case"sec":case"s":return r*Bo;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}function $C(e){return e>=Fo?Math.round(e/Fo)+"d":e>=jo?Math.round(e/jo)+"h":e>=Lo?Math.round(e/Lo)+"m":e>=Bo?Math.round(e/Bo)+"s":e+"ms"}function HC(e){return rd(e,Fo,"day")||rd(e,jo,"hour")||rd(e,Lo,"minute")||rd(e,Bo,"second")||e+" ms"}function rd(e,t,r){return e<t?void 0:e<t*1.5?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var VC=ne(function(e,t){t=e.exports=i.debug=i.default=i,t.coerce=o,t.disable=a,t.enable=s,t.enabled=c,t.humanize=qC,t.instances=[],t.names=[],t.skips=[],t.formatters={};function r(d){var l=0,u;for(u in d)l=(l<<5)-l+d.charCodeAt(u),l|=0;return t.colors[Math.abs(l)%t.colors.length]}function i(d){var l;function u(){if(!u.enabled)return;var p=u,f=+new Date,g=f-(l||f);p.diff=g,p.prev=l,p.curr=f,l=f;for(var v=new Array(arguments.length),S=0;S<v.length;S++)v[S]=arguments[S];v[0]=t.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");var C=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,function(j,m){if(j==="%%")return j;C++;var w=t.formatters[m];if(typeof w=="function"){var R=v[C];j=w.call(p,R),v.splice(C,1),C--}return j}),t.formatArgs.call(p,v);var D=u.log||t.log||console.log.bind(console);D.apply(p,v)}return u.namespace=d,u.enabled=t.enabled(d),u.useColors=t.useColors(),u.color=r(d),u.destroy=n,typeof t.init=="function"&&t.init(u),t.instances.push(u),u}function n(){var d=t.instances.indexOf(this);return d!==-1?(t.instances.splice(d,1),!0):!1}function s(d){t.save(d),t.names=[],t.skips=[];var l,u=(typeof d=="string"?d:"").split(/[\s,]+/),p=u.length;for(l=0;l<p;l++){if(!u[l])continue;d=u[l].replace(/\*/g,".*?"),d[0]==="-"?t.skips.push(new RegExp("^"+d.substr(1)+"$")):t.names.push(new RegExp("^"+d+"$"))}for(l=0;l<t.instances.length;l++){var f=t.instances[l];f.enabled=t.enabled(f.namespace)}}function a(){t.enable("")}function c(d){if(d[d.length-1]==="*")return!0;var l,u;for(l=0,u=t.skips.length;l<u;l++)if(t.skips[l].test(d))return!1;for(l=0,u=t.names.length;l<u;l++)if(t.names[l].test(d))return!0;return!1}function o(d){return d instanceof Error?d.stack||d.message:d}}),GC=ne(function(e,t){t=e.exports=VC,t.log=n,t.formatArgs=i,t.save=s,t.load=a,t.useColors=r,t.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:c(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&window.process.type==="renderer"?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}t.formatters.j=function(o){try{return JSON.stringify(o)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}};function i(o){var d=this.useColors;if(o[0]=(d?"%c":"")+this.namespace+(d?" %c":" ")+o[0]+(d?"%c ":" ")+"+"+t.humanize(this.diff),!d)return;var l="color: "+this.color;o.splice(1,0,l,"color: inherit");var u=0,p=0;o[0].replace(/%[a-zA-Z%]/g,function(f){if(f==="%%")return;u++,f==="%c"&&(p=u)}),o.splice(p,0,l)}function n(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(o){try{o==null?t.storage.removeItem("debug"):t.storage.debug=o}catch(d){}}function a(){var o;try{o=t.storage.debug}catch(d){}return!o&&typeof Ce!="undefined"&&"env"in Ce&&(o=Ce.env.DEBUG),o}t.enable(a());function c(){try{return window.localStorage}catch(o){}}}),_s=ne(function(e){e.exports=t;function t(i){if(i)return r(i)}function r(i){for(var n in t.prototype)i[n]=t.prototype[n];return i}t.prototype.on=t.prototype.addEventListener=function(i,n){return this._callbacks=this._callbacks||{},(this._callbacks["$"+i]=this._callbacks["$"+i]||[]).push(n),this},t.prototype.once=function(i,n){function s(){this.off(i,s),n.apply(this,arguments)}return s.fn=n,this.on(i,s),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(i,n){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var s=this._callbacks["$"+i];if(!s)return this;if(arguments.length==1)return delete this._callbacks["$"+i],this;for(var a,c=0;c<s.length;c++)if(a=s[c],a===n||a.fn===n){s.splice(c,1);break}return s.length===0&&delete this._callbacks["$"+i],this},t.prototype.emit=function(i){this._callbacks=this._callbacks||{};for(var n=new Array(arguments.length-1),s=this._callbacks["$"+i],a=1;a<arguments.length;a++)n[a-1]=arguments[a];if(s){s=s.slice(0);for(var a=0,c=s.length;a<c;++a)s[a].apply(this,n)}return this},t.prototype.listeners=function(i){return this._callbacks=this._callbacks||{},this._callbacks["$"+i]||[]},t.prototype.hasListeners=function(i){return!!this.listeners(i).length}}),XC={}.toString,Uo=Array.isArray||function(e){return XC.call(e)=="[object Array]"},xu=ZC,KC=typeof Buffer=="function"&&typeof Buffer.isBuffer=="function",WC=typeof ArrayBuffer=="function",YC=function(e){return typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer};function ZC(e){return KC&&Buffer.isBuffer(e)||WC&&(e instanceof ArrayBuffer||YC(e))}var eg=Object.prototype.toString,JC=typeof Blob=="function"||typeof Blob!="undefined"&&eg.call(Blob)==="[object BlobConstructor]",QC=typeof File=="function"||typeof File!="undefined"&&eg.call(File)==="[object FileConstructor]",e4=function(e){var t=[],r=e.data,i=e;return i.data=Ou(r,t),i.attachments=t.length,{packet:i,buffers:t}};function Ou(e,t){if(!e)return e;if(xu(e)){var r={_placeholder:!0,num:t.length};return t.push(e),r}else if(Uo(e)){for(var i=new Array(e.length),n=0;n<e.length;n++)i[n]=Ou(e[n],t);return i}else if(typeof e=="object"&&!(e instanceof Date)){var i={};for(var s in e)i[s]=Ou(e[s],t);return i}return e}var t4=function(e,t){return e.data=Du(e.data,t),e.attachments=void 0,e};function Du(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(Uo(e))for(var r=0;r<e.length;r++)e[r]=Du(e[r],t);else if(typeof e=="object")for(var i in e)e[i]=Du(e[i],t);return e}var r4=function(e,t){function r(s,a,c){if(!s)return s;if(JC&&s instanceof Blob||QC&&s instanceof File){i++;var o=new FileReader;o.onload=function(){c?c[a]=this.result:n=this.result,--i||t(n)},o.readAsArrayBuffer(s)}else if(Uo(s))for(var d=0;d<s.length;d++)r(s[d],d,s);else if(typeof s=="object"&&!xu(s))for(var l in s)r(s[l],l,s)}var i=0,n=e;r(n),i||t(n)},Bu={deconstructPacket:e4,reconstructPacket:t4,removeBlobs:r4},rr=ne(function(e,t){var r=GC("socket.io-parser");t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=i,t.Decoder=o;function i(){}var n=t.ERROR+'"encode error"';i.prototype.encode=function(f,g){if(r("encoding packet %j",f),t.BINARY_EVENT===f.type||t.BINARY_ACK===f.type)c(f,g);else{var v=s(f);g([v])}};function s(f){var g=""+f.type;if((t.BINARY_EVENT===f.type||t.BINARY_ACK===f.type)&&(g+=f.attachments+"-"),f.nsp&&f.nsp!=="/"&&(g+=f.nsp+","),f.id!=null&&(g+=f.id),f.data!=null){var v=a(f.data);if(v!==!1)g+=v;else return n}return r("encoded %j as %s",f,g),g}function a(f){try{return JSON.stringify(f)}catch(g){return!1}}function c(f,g){function v(S){var C=Bu.deconstructPacket(S),D=s(C.packet),j=C.buffers;j.unshift(D),g(j)}Bu.removeBlobs(f,v)}function o(){this.reconstructor=null}_s(o.prototype),o.prototype.add=function(f){var g;if(typeof f=="string")g=d(f),t.BINARY_EVENT===g.type||t.BINARY_ACK===g.type?(this.reconstructor=new u(g),this.reconstructor.reconPack.attachments===0&&this.emit("decoded",g)):this.emit("decoded",g);else if(xu(f)||f.base64)if(this.reconstructor)g=this.reconstructor.takeBinaryData(f),g&&(this.reconstructor=null,this.emit("decoded",g));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+f)};function d(f){var g=0,v={type:Number(f.charAt(0))};if(t.types[v.type]==null)return p("unknown packet type "+v.type);if(t.BINARY_EVENT===v.type||t.BINARY_ACK===v.type){for(var S="";f.charAt(++g)!=="-"&&!(S+=f.charAt(g),g==f.length););if(S!=Number(S)||f.charAt(g)!=="-")throw new Error("Illegal attachments");v.attachments=Number(S)}if(f.charAt(g+1)==="/")for(v.nsp="";++g;){var C=f.charAt(g);if(C===",")break;if(v.nsp+=C,g===f.length)break}else v.nsp="/";var D=f.charAt(g+1);if(D!==""&&Number(D)==D){for(v.id="";++g;){var C=f.charAt(g);if(C==null||Number(C)!=C){--g;break}if(v.id+=f.charAt(g),g===f.length)break}v.id=Number(v.id)}if(f.charAt(++g)){var j=l(f.substr(g)),m=j!==!1&&(v.type===t.ERROR||Uo(j));if(m)v.data=j;else return p("invalid payload")}return r("decoded %s as %j",f,v),v}function l(f){try{return JSON.parse(f)}catch(g){return!1}}o.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};function u(f){this.reconPack=f,this.buffers=[]}u.prototype.takeBinaryData=function(f){if(this.buffers.push(f),this.buffers.length===this.reconPack.attachments){var g=Bu.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),g}return null},u.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]};function p(f){return{type:t.ERROR,data:"parser error: "+f}}}),i4=ne(function(e){try{e.exports=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}}),id=function(){return typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")()}(),Lu=function(e){var t=e.xdomain,r=e.xscheme,i=e.enablesXDR;try{if(typeof XMLHttpRequest!="undefined"&&(!t||i4))return new XMLHttpRequest}catch(n){}try{if(typeof XDomainRequest!="undefined"&&!r&&i)return new XDomainRequest}catch(n){}if(!t)try{return new id[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(n){}},n4=Object.keys||function(t){var r=[],i=Object.prototype.hasOwnProperty;for(var n in t)i.call(t,n)&&r.push(n);return r},tg=Object.prototype.toString,s4=typeof Blob=="function"||typeof Blob!="undefined"&&tg.call(Blob)==="[object BlobConstructor]",a4=typeof File=="function"||typeof File!="undefined"&&tg.call(File)==="[object FileConstructor]",ju=nd;function nd(e){if(!e||typeof e!="object")return!1;if(Uo(e)){for(var t=0,r=e.length;t<r;t++)if(nd(e[t]))return!0;return!1}if(typeof Buffer=="function"&&Buffer.isBuffer&&Buffer.isBuffer(e)||typeof ArrayBuffer=="function"&&e instanceof ArrayBuffer||s4&&e instanceof Blob||a4&&e instanceof File)return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return nd(e.toJSON(),!0);for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&nd(e[i]))return!0;return!1}var sd=function(e,t,r){var i=e.byteLength;if(t=t||0,r=r||i,e.slice)return e.slice(t,r);if(t<0&&(t+=i),r<0&&(r+=i),r>i&&(r=i),t>=i||t>=r||i===0)return new ArrayBuffer(0);for(var n=new Uint8Array(e),s=new Uint8Array(r-t),a=t,c=0;a<r;a++,c++)s[c]=n[a];return s.buffer},o4=c4;function c4(e,t,r){var i=!1;return r=r||d4,n.count=e,e===0?t():n;function n(s,a){if(n.count<=0)throw new Error("after called too many times");--n.count,s?(i=!0,t(s),t=r):n.count===0&&!i&&t(null,a)}}function d4(){}/*! https://mths.be/utf8js v2.1.2 by @mathias */var Hn=String.fromCharCode;function rg(e){for(var t=[],r=0,i=e.length,n,s;r<i;)n=e.charCodeAt(r++),n>=55296&&n<=56319&&r<i?(s=e.charCodeAt(r++),(s&64512)==56320?t.push(((n&1023)<<10)+(s&1023)+65536):(t.push(n),r--)):t.push(n);return t}function l4(e){for(var t=e.length,r=-1,i,n="";++r<t;)i=e[r],i>65535&&(i-=65536,n+=Hn(i>>>10&1023|55296),i=56320|i&1023),n+=Hn(i);return n}function ig(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function Fu(e,t){return Hn(e>>t&63|128)}function u4(e,t){if((e&4294967168)==0)return Hn(e);var r="";return(e&4294965248)==0?r=Hn(e>>6&31|192):(e&4294901760)==0?(ig(e,t)||(e=65533),r=Hn(e>>12&15|224),r+=Fu(e,6)):(e&4292870144)==0&&(r=Hn(e>>18&7|240),r+=Fu(e,12),r+=Fu(e,6)),r+=Hn(e&63|128),r}function f4(e,t){t=t||{};for(var r=t.strict!==!1,i=rg(e),n=i.length,s=-1,a,c="";++s<n;)a=i[s],c+=u4(a,r);return c}function ma(){if(Vn>=od)throw Error("Invalid byte index");var e=ad[Vn]&255;if(Vn++,(e&192)==128)return e&63;throw Error("Invalid continuation byte")}function h4(e){var t,r,i,n,s;if(Vn>od)throw Error("Invalid byte index");if(Vn==od)return!1;if(t=ad[Vn]&255,Vn++,(t&128)==0)return t;if((t&224)==192){if(r=ma(),s=(t&31)<<6|r,s>=128)return s;throw Error("Invalid continuation byte")}if((t&240)==224){if(r=ma(),i=ma(),s=(t&15)<<12|r<<6|i,s>=2048)return ig(s,e)?s:65533;throw Error("Invalid continuation byte")}if((t&248)==240&&(r=ma(),i=ma(),n=ma(),s=(t&7)<<18|r<<12|i<<6|n,s>=65536&&s<=1114111))return s;throw Error("Invalid UTF-8 detected")}var ad,od,Vn;function p4(e,t){t=t||{};var r=t.strict!==!1;ad=rg(e),od=ad.length,Vn=0;for(var i=[],n;(n=h4(r))!==!1;)i.push(n);return l4(i)}var ng={version:"2.1.2",encode:f4,decode:p4},m4=ne(function(e,t){(function(r){t.encode=function(i){var n=new Uint8Array(i),s,a=n.length,c="";for(s=0;s<a;s+=3)c+=r[n[s]>>2],c+=r[(n[s]&3)<<4|n[s+1]>>4],c+=r[(n[s+1]&15)<<2|n[s+2]>>6],c+=r[n[s+2]&63];return a%3===2?c=c.substring(0,c.length-1)+"=":a%3===1&&(c=c.substring(0,c.length-2)+"=="),c},t.decode=function(i){var n=i.length*.75,s=i.length,a,c=0,o,d,l,u;i[i.length-1]==="="&&(n--,i[i.length-2]==="="&&n--);var p=new ArrayBuffer(n),f=new Uint8Array(p);for(a=0;a<s;a+=4)o=r.indexOf(i[a]),d=r.indexOf(i[a+1]),l=r.indexOf(i[a+2]),u=r.indexOf(i[a+3]),f[c++]=o<<2|d>>4,f[c++]=(d&15)<<4|l>>2,f[c++]=(l&3)<<6|u&63;return p}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")}),ga=typeof ga!="undefined"?ga:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:!1,sg=function(){try{var e=new Blob(["hi"]);return e.size===2}catch(t){return!1}}(),g4=sg&&function(){try{var e=new Blob([new Uint8Array([1,2])]);return e.size===2}catch(t){return!1}}(),b4=ga&&ga.prototype.append&&ga.prototype.getBlob;function ag(e){return e.map(function(t){if(t.buffer instanceof ArrayBuffer){var r=t.buffer;if(t.byteLength!==r.byteLength){var i=new Uint8Array(t.byteLength);i.set(new Uint8Array(r,t.byteOffset,t.byteLength)),r=i.buffer}return r}return t})}function og(e,t){t=t||{};var r=new ga;return ag(e).forEach(function(i){r.append(i)}),t.type?r.getBlob(t.type):r.getBlob()}function cg(e,t){return new Blob(ag(e),t||{})}typeof Blob!="undefined"&&(og.prototype=Blob.prototype,cg.prototype=Blob.prototype);var $r=function(){return sg?g4?Blob:cg:b4?og:void 0}(),Gn=ne(function(e,t){var r;typeof ArrayBuffer!="undefined"&&(r=m4);var i=typeof navigator!="undefined"&&/Android/i.test(navigator.userAgent),n=typeof navigator!="undefined"&&/PhantomJS/i.test(navigator.userAgent),s=i||n;t.protocol=3;var a=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},c=n4(a),o={type:"error",data:"parser error"};t.encodePacket=function(v,S,C,D){typeof S=="function"&&(D=S,S=!1),typeof C=="function"&&(D=C,C=null);var j=v.data===void 0?void 0:v.data.buffer||v.data;if(typeof ArrayBuffer!="undefined"&&j instanceof ArrayBuffer)return l(v,S,D);if(typeof $r!="undefined"&&j instanceof $r)return p(v,S,D);if(j&&j.base64)return d(v,D);var m=a[v.type];return v.data!==void 0&&(m+=C?ng.encode(String(v.data),{strict:!1}):String(v.data)),D(""+m)};function d(v,S){var C="b"+t.packets[v.type]+v.data.data;return S(C)}function l(v,S,C){if(!S)return t.encodeBase64Packet(v,C);var D=v.data,j=new Uint8Array(D),m=new Uint8Array(1+D.byteLength);m[0]=a[v.type];for(var w=0;w<j.length;w++)m[w+1]=j[w];return C(m.buffer)}function u(v,S,C){if(!S)return t.encodeBase64Packet(v,C);var D=new FileReader;return D.onload=function(){t.encodePacket({type:v.type,data:D.result},S,!0,C)},D.readAsArrayBuffer(v.data)}function p(v,S,C){if(!S)return t.encodeBase64Packet(v,C);if(s)return u(v,S,C);var D=new Uint8Array(1);D[0]=a[v.type];var j=new $r([D.buffer,v.data]);return C(j)}t.encodeBase64Packet=function(v,S){var C="b"+t.packets[v.type];if(typeof $r!="undefined"&&v.data instanceof $r){var D=new FileReader;return D.onload=function(){var h=D.result.split(",")[1];S(C+h)},D.readAsDataURL(v.data)}var j;try{j=String.fromCharCode.apply(null,new Uint8Array(v.data))}catch(h){for(var m=new Uint8Array(v.data),w=new Array(m.length),R=0;R<m.length;R++)w[R]=m[R];j=String.fromCharCode.apply(null,w)}return C+=btoa(j),S(C)},t.decodePacket=function(v,S,C){if(v===void 0)return o;if(typeof v=="string"){if(v.charAt(0)==="b")return t.decodeBase64Packet(v.substr(1),S);if(C&&(v=f(v),v===!1))return o;var j=v.charAt(0);return Number(j)!=j||!c[j]?o:v.length>1?{type:c[j],data:v.substring(1)}:{type:c[j]}}var D=new Uint8Array(v),j=D[0],m=sd(v,1);return $r&&S==="blob"&&(m=new $r([m])),{type:c[j],data:m}};function f(v){try{v=ng.decode(v,{strict:!1})}catch(S){return!1}return v}t.decodeBase64Packet=function(v,S){var C=c[v.charAt(0)];if(!r)return{type:C,data:{base64:!0,data:v.substr(1)}};var D=r.decode(v.substr(1));return S==="blob"&&$r&&(D=new $r([D])),{type:C,data:D}},t.encodePayload=function(v,S,C){typeof S=="function"&&(C=S,S=null);var D=ju(v);if(S&&D)return $r&&!s?t.encodePayloadAsBlob(v,C):t.encodePayloadAsArrayBuffer(v,C);if(!v.length)return C("0:");function j(w){return w.length+":"+w}function m(w,R){t.encodePacket(w,D?S:!1,!1,function(h){R(null,j(h))})}g(v,m,function(w,R){return C(R.join(""))})};function g(v,S,C){for(var D=new Array(v.length),j=o4(v.length,C),m=function(R,h,b){S(h,function(A,y){D[R]=y,b(A,D)})},w=0;w<v.length;w++)m(w,v[w],j)}t.decodePayload=function(v,S,C){if(typeof v!="string")return t.decodePayloadAsBinary(v,S,C);typeof S=="function"&&(C=S,S=null);var D;if(v==="")return C(o,0,1);for(var j="",m,w,R=0,h=v.length;R<h;R++){var b=v.charAt(R);if(b!==":"){j+=b;continue}if(j===""||j!=(m=Number(j)))return C(o,0,1);if(w=v.substr(R+1,m),j!=w.length)return C(o,0,1);if(w.length){if(D=t.decodePacket(w,S,!1),o.type===D.type&&o.data===D.data)return C(o,0,1);var A=C(D,R+m,h);if(A===!1)return}R+=m,j=""}if(j!=="")return C(o,0,1)},t.encodePayloadAsArrayBuffer=function(v,S){if(!v.length)return S(new ArrayBuffer(0));function C(D,j){t.encodePacket(D,!0,!0,function(m){return j(null,m)})}g(v,C,function(D,j){var m=j.reduce(function(h,b){var A;return typeof b=="string"?A=b.length:A=b.byteLength,h+A.toString().length+A+2},0),w=new Uint8Array(m),R=0;return j.forEach(function(h){var b=typeof h=="string",A=h;if(b){for(var N=new Uint8Array(h.length),y=0;y<h.length;y++)N[y]=h.charCodeAt(y);A=N.buffer}b?w[R++]=0:w[R++]=1;for(var P=A.byteLength.toString(),y=0;y<P.length;y++)w[R++]=parseInt(P[y]);w[R++]=255;for(var N=new Uint8Array(A),y=0;y<N.length;y++)w[R++]=N[y]}),S(w.buffer)})},t.encodePayloadAsBlob=function(v,S){function C(D,j){t.encodePacket(D,!0,!0,function(m){var w=new Uint8Array(1);if(w[0]=1,typeof m=="string"){for(var R=new Uint8Array(m.length),h=0;h<m.length;h++)R[h]=m.charCodeAt(h);m=R.buffer,w[0]=0}for(var b=m instanceof ArrayBuffer?m.byteLength:m.size,A=b.toString(),y=new Uint8Array(A.length+1),h=0;h<A.length;h++)y[h]=parseInt(A[h]);if(y[A.length]=255,$r){var P=new $r([w.buffer,y.buffer,m]);j(null,P)}})}g(v,C,function(D,j){return S(new $r(j))})},t.decodePayloadAsBinary=function(v,S,C){typeof S=="function"&&(C=S,S=null);for(var D=v,j=[];D.byteLength>0;){for(var m=new Uint8Array(D),w=m[0]===0,R="",h=1;!(m[h]===255);h++){if(R.length>310)return C(o,0,1);R+=m[h]}D=sd(D,2+R.length),R=parseInt(R);var b=sd(D,0,R);if(w)try{b=String.fromCharCode.apply(null,new Uint8Array(b))}catch(P){var A=new Uint8Array(b);b="";for(var h=0;h<A.length;h++)b+=String.fromCharCode(A[h])}j.push(b),D=sd(D,R)}var y=j.length;j.forEach(function(P,N){C(t.decodePacket(P,S,!0),N,y)})}}),ba=Fi;function Fi(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}_s(Fi.prototype),Fi.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},Fi.prototype.open=function(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this},Fi.prototype.close=function(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this},Fi.prototype.send=function(e){if(this.readyState==="open")this.write(e);else throw new Error("Transport not open")},Fi.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},Fi.prototype.onData=function(e){var t=Gn.decodePacket(e,this.socket.binaryType);this.onPacket(t)},Fi.prototype.onPacket=function(e){this.emit("packet",e)},Fi.prototype.onClose=function(){this.readyState="closed",this.emit("close")};var y4=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},v4=function(e){for(var t={},r=e.split("&"),i=0,n=r.length;i<n;i++){var s=r[i].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t},cd={encode:y4,decode:v4},dd=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e},dg="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),ld=64,lg={},ug=0,Xn=0,fg;function Uu(e){var t="";do t=dg[e%ld]+t,e=Math.floor(e/ld);while(e>0);return t}function w4(e){var t=0;for(Xn=0;Xn<e.length;Xn++)t=t*ld+lg[e.charAt(Xn)];return t}function qu(){var e=Uu(+new Date);return e!==fg?(ug=0,fg=e):e+"."+Uu(ug++)}for(;Xn<ld;Xn++)lg[dg[Xn]]=Xn;qu.encode=Uu,qu.decode=w4;var hg=qu,qo=1e3,zo=qo*60,$o=zo*60,Ho=$o*24,S4=Ho*365.25,_4=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return E4(e);if(r==="number"&&isNaN(e)===!1)return t.long?I4(e):A4(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function E4(e){if(e=String(e),e.length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]),i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return r*S4;case"days":case"day":case"d":return r*Ho;case"hours":case"hour":case"hrs":case"hr":case"h":return r*$o;case"minutes":case"minute":case"mins":case"min":case"m":return r*zo;case"seconds":case"second":case"secs":case"sec":case"s":return r*qo;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}function A4(e){return e>=Ho?Math.round(e/Ho)+"d":e>=$o?Math.round(e/$o)+"h":e>=zo?Math.round(e/zo)+"m":e>=qo?Math.round(e/qo)+"s":e+"ms"}function I4(e){return ud(e,Ho,"day")||ud(e,$o,"hour")||ud(e,zo,"minute")||ud(e,qo,"second")||e+" ms"}function ud(e,t,r){return e<t?void 0:e<t*1.5?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var T4=ne(function(e,t){t=e.exports=i.debug=i.default=i,t.coerce=o,t.disable=a,t.enable=s,t.enabled=c,t.humanize=_4,t.instances=[],t.names=[],t.skips=[],t.formatters={};function r(d){var l=0,u;for(u in d)l=(l<<5)-l+d.charCodeAt(u),l|=0;return t.colors[Math.abs(l)%t.colors.length]}function i(d){var l;function u(){if(!u.enabled)return;var p=u,f=+new Date,g=f-(l||f);p.diff=g,p.prev=l,p.curr=f,l=f;for(var v=new Array(arguments.length),S=0;S<v.length;S++)v[S]=arguments[S];v[0]=t.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");var C=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,function(j,m){if(j==="%%")return j;C++;var w=t.formatters[m];if(typeof w=="function"){var R=v[C];j=w.call(p,R),v.splice(C,1),C--}return j}),t.formatArgs.call(p,v);var D=u.log||t.log||console.log.bind(console);D.apply(p,v)}return u.namespace=d,u.enabled=t.enabled(d),u.useColors=t.useColors(),u.color=r(d),u.destroy=n,typeof t.init=="function"&&t.init(u),t.instances.push(u),u}function n(){var d=t.instances.indexOf(this);return d!==-1?(t.instances.splice(d,1),!0):!1}function s(d){t.save(d),t.names=[],t.skips=[];var l,u=(typeof d=="string"?d:"").split(/[\s,]+/),p=u.length;for(l=0;l<p;l++){if(!u[l])continue;d=u[l].replace(/\*/g,".*?"),d[0]==="-"?t.skips.push(new RegExp("^"+d.substr(1)+"$")):t.names.push(new RegExp("^"+d+"$"))}for(l=0;l<t.instances.length;l++){var f=t.instances[l];f.enabled=t.enabled(f.namespace)}}function a(){t.enable("")}function c(d){if(d[d.length-1]==="*")return!0;var l,u;for(l=0,u=t.skips.length;l<u;l++)if(t.skips[l].test(d))return!1;for(l=0,u=t.names.length;l<u;l++)if(t.names[l].test(d))return!0;return!1}function o(d){return d instanceof Error?d.stack||d.message:d}}),fd=ne(function(e,t){t=e.exports=T4,t.log=n,t.formatArgs=i,t.save=s,t.load=a,t.useColors=r,t.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:c(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&window.process.type==="renderer"?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}t.formatters.j=function(o){try{return JSON.stringify(o)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}};function i(o){var d=this.useColors;if(o[0]=(d?"%c":"")+this.namespace+(d?" %c":" ")+o[0]+(d?"%c ":" ")+"+"+t.humanize(this.diff),!d)return;var l="color: "+this.color;o.splice(1,0,l,"color: inherit");var u=0,p=0;o[0].replace(/%[a-zA-Z%]/g,function(f){if(f==="%%")return;u++,f==="%c"&&(p=u)}),o.splice(p,0,l)}function n(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(o){try{o==null?t.storage.removeItem("debug"):t.storage.debug=o}catch(d){}}function a(){var o;try{o=t.storage.debug}catch(d){}return!o&&typeof Ce!="undefined"&&"env"in Ce&&(o=Ce.env.DEBUG),o}t.enable(a());function c(){try{return window.localStorage}catch(o){}}}),Si=fd("engine.io-client:polling"),Vo=Ui,C4=function(){var e=Lu,t=new e({xdomain:!1});return t.responseType!=null}();function Ui(e){var t=e&&e.forceBase64;(!C4||t)&&(this.supportsBinary=!1),ba.call(this,e)}dd(Ui,ba),Ui.prototype.name="polling",Ui.prototype.doOpen=function(){this.poll()},Ui.prototype.pause=function(e){var t=this;this.readyState="pausing";function r(){Si("paused"),t.readyState="paused",e()}if(this.polling||!this.writable){var i=0;this.polling&&(Si("we are currently polling - waiting to pause"),i++,this.once("pollComplete",function(){Si("pre-pause polling complete"),--i||r()})),this.writable||(Si("we are currently writing - waiting to pause"),i++,this.once("drain",function(){Si("pre-pause writing complete"),--i||r()}))}else r()},Ui.prototype.poll=function(){Si("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},Ui.prototype.onData=function(e){var t=this;Si("polling got data %s",e);var r=function(i,n,s){if(t.readyState==="opening"&&t.onOpen(),i.type==="close")return t.onClose(),!1;t.onPacket(i)};Gn.decodePayload(e,this.socket.binaryType,r),this.readyState!=="closed"&&(this.polling=!1,this.emit("pollComplete"),this.readyState==="open"?this.poll():Si('ignoring poll - transport state "%s"',this.readyState))},Ui.prototype.doClose=function(){var e=this;function t(){Si("writing close packet"),e.write([{type:"close"}])}this.readyState==="open"?(Si("transport open - closing"),t()):(Si("transport not open - deferring close"),this.once("open",t))},Ui.prototype.write=function(e){var t=this;this.writable=!1;var r=function(){t.writable=!0,t.emit("drain")};Gn.encodePayload(e,this.supportsBinary,function(i){t.doWrite(i,r)})},Ui.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";this.timestampRequests!==!1&&(e[this.timestampParam]=hg()),!this.supportsBinary&&!e.sid&&(e.b64=1),e=cd.encode(e),this.port&&(t==="https"&&Number(this.port)!==443||t==="http"&&Number(this.port)!==80)&&(r=":"+this.port),e.length&&(e="?"+e);var i=this.hostname.indexOf(":")!==-1;return t+"://"+(i?"["+this.hostname+"]":this.hostname)+r+this.path+e};var zu=fd("engine.io-client:polling-xhr"),pg=ya,R4=Ht;function mg(){}function ya(e){if(Vo.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,typeof location!="undefined"){var t=location.protocol==="https:",r=location.port;r||(r=t?443:80),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}}dd(ya,Vo),ya.prototype.supportsBinary=!0,ya.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.withCredentials=this.withCredentials,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new Ht(e)},ya.prototype.doWrite=function(e,t){var r=typeof e!="string"&&e!==void 0,i=this.request({method:"POST",data:e,isBinary:r}),n=this;i.on("success",t),i.on("error",function(s){n.onError("xhr post error",s)}),this.sendXhr=i},ya.prototype.doPoll=function(){zu("xhr poll");var e=this.request(),t=this;e.on("data",function(r){t.onData(r)}),e.on("error",function(r){t.onError("xhr poll error",r)}),this.pollXhr=e};function Ht(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=e.async!==!1,this.data=e.data!==void 0?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}if(_s(Ht.prototype),Ht.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new Lu(e),r=this;try{zu("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(var i in this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&t.setRequestHeader(i,this.extraHeaders[i])}}catch(n){}if(this.method==="POST")try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(n){}try{t.setRequestHeader("Accept","*/*")}catch(n){}"withCredentials"in t&&(t.withCredentials=this.withCredentials),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){r.onLoad()},t.onerror=function(){r.onError(t.responseText)}):t.onreadystatechange=function(){if(t.readyState===2)try{var n=t.getResponseHeader("Content-Type");(r.supportsBinary&&n==="application/octet-stream"||n==="application/octet-stream; charset=UTF-8")&&(t.responseType="arraybuffer")}catch(s){}if(t.readyState!==4)return;t.status===200||t.status===1223?r.onLoad():setTimeout(function(){r.onError(typeof t.status=="number"?t.status:0)},0)},zu("xhr data %s",this.data),t.send(this.data)}catch(n){setTimeout(function(){r.onError(n)},0);return}typeof document!="undefined"&&(this.index=Ht.requestsCount++,Ht.requests[this.index]=this)},Ht.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},Ht.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},Ht.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},Ht.prototype.cleanup=function(e){if(typeof this.xhr=="undefined"||this.xhr===null)return;if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=mg:this.xhr.onreadystatechange=mg,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete Ht.requests[this.index],this.xhr=null},Ht.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(r){}t==="application/octet-stream"||t==="application/octet-stream; charset=UTF-8"?e=this.xhr.response||this.xhr.responseText:e=this.xhr.responseText}catch(r){this.onError(r)}e!=null&&this.onData(e)},Ht.prototype.hasXDR=function(){return typeof XDomainRequest!="undefined"&&!this.xs&&this.enablesXDR},Ht.prototype.abort=function(){this.cleanup()},Ht.requestsCount=0,Ht.requests={},typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",gg);else if(typeof addEventListener=="function"){var M4="onpagehide"in id?"pagehide":"unload";addEventListener(M4,gg,!1)}}function gg(){for(var e in Ht.requests)Ht.requests.hasOwnProperty(e)&&Ht.requests[e].abort()}pg.Request=R4;var k4=va,P4=/\n/g,N4=/\\n/g,hd;function x4(){}function va(e){Vo.call(this,e),this.query=this.query||{},hd||(hd=id.___eio=id.___eio||[]),this.index=hd.length;var t=this;hd.push(function(r){t.onData(r)}),this.query.j=this.index,typeof addEventListener=="function"&&addEventListener("beforeunload",function(){t.script&&(t.script.onerror=x4)},!1)}dd(va,Vo),va.prototype.supportsBinary=!1,va.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),Vo.prototype.doClose.call(this)},va.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(n){e.onError("jsonp poll error",n)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t;var i=typeof navigator!="undefined"&&/gecko/i.test(navigator.userAgent);i&&setTimeout(function(){var n=document.createElement("iframe");document.body.appendChild(n),document.body.removeChild(n)},100)},va.prototype.doWrite=function(e,t){var r=this;if(!this.form){var i=document.createElement("form"),n=document.createElement("textarea"),s=this.iframeId="eio_iframe_"+this.index,a;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=s,i.method="POST",i.setAttribute("accept-charset","utf-8"),n.name="d",i.appendChild(n),document.body.appendChild(i),this.form=i,this.area=n}this.form.action=this.uri();function c(){o(),t()}function o(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(l){r.onError("jsonp polling iframe removal error",l)}try{var d='<iframe src="javascript:0" name="'+r.iframeId+'">';a=document.createElement(d)}catch(l){a=document.createElement("iframe"),a.name=r.iframeId,a.src="javascript:0"}a.id=r.iframeId,r.form.appendChild(a),r.iframe=a}o(),e=e.replace(N4,`\\
`),this.area.value=e.replace(P4,"\\n");try{this.form.submit()}catch(d){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){r.iframe.readyState==="complete"&&c()}:this.iframe.onload=c};var O4=fd("engine.io-client:websocket"),pd,$u;if(typeof WebSocket!="undefined"?pd=WebSocket:typeof self!="undefined"&&(pd=self.WebSocket||self.MozWebSocket),typeof window=="undefined")try{$u=os}catch(e){}var wa=pd||$u,D4=si;function si(e){var t=e&&e.forceBase64;t&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=pd&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(wa=$u),ba.call(this,e)}dd(si,ba),si.prototype.name="websocket",si.prototype.supportsBinary=!0,si.prototype.doOpen=function(){if(!this.check())return;var e=this.uri(),t=this.protocols,r={};this.isReactNative||(r.agent=this.agent,r.perMessageDeflate=this.perMessageDeflate,r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized),this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new wa(e,t):new wa(e):new wa(e,t,r)}catch(i){return this.emit("error",i)}this.ws.binaryType===void 0&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()},si.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},si.prototype.write=function(e){var t=this;this.writable=!1;for(var r=e.length,i=0,n=r;i<n;i++)(function(a){Gn.encodePacket(a,t.supportsBinary,function(c){if(!t.usingBrowserWebSocket){var o={};if(a.options&&(o.compress=a.options.compress),t.perMessageDeflate){var d=typeof c=="string"?Buffer.byteLength(c):c.length;d<t.perMessageDeflate.threshold&&(o.compress=!1)}}try{t.usingBrowserWebSocket?t.ws.send(c):t.ws.send(c,o)}catch(l){O4("websocket closed before onclose event")}--r||s()})})(e[i]);function s(){t.emit("flush"),setTimeout(function(){t.writable=!0,t.emit("drain")},0)}},si.prototype.onClose=function(){ba.prototype.onClose.call(this)},si.prototype.doClose=function(){typeof this.ws!="undefined"&&this.ws.close()},si.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";this.port&&(t==="wss"&&Number(this.port)!==443||t==="ws"&&Number(this.port)!==80)&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=hg()),this.supportsBinary||(e.b64=1),e=cd.encode(e),e.length&&(e="?"+e);var i=this.hostname.indexOf(":")!==-1;return t+"://"+(i?"["+this.hostname+"]":this.hostname)+r+this.path+e},si.prototype.check=function(){return!!wa&&!("__initialize"in wa&&this.name===si.prototype.name)};var B4=j4,L4=D4;function j4(e){var t,r=!1,i=!1,n=e.jsonp!==!1;if(typeof location!="undefined"){var s=location.protocol==="https:",a=location.port;a||(a=s?443:80),r=e.hostname!==location.hostname||a!==e.port,i=e.secure!==s}if(e.xdomain=r,e.xscheme=i,t=new Lu(e),"open"in t&&!e.forceJSONP)return new pg(e);if(!n)throw new Error("JSONP disabled");return new k4(e)}var bg={polling:B4,websocket:L4},F4=[].indexOf,Hu=function(e,t){if(F4)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1},Lt=fd("engine.io-client:socket"),U4=qe;function qe(e,t){if(!(this instanceof qe))return new qe(e,t);t=t||{},e&&typeof e=="object"&&(t=e,e=null),e?(e=Nu(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Nu(t.host).host),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?443:80),this.query=t.query||{},typeof this.query=="string"&&(this.query=cd.decode(this.query)),this.upgrade=t.upgrade!==!1,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=t.jsonp!==!1,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.withCredentials=t.withCredentials!==!1,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=t.perMessageDeflate!==!1?t.perMessageDeflate||{}:!1,this.perMessageDeflate===!0&&(this.perMessageDeflate={}),this.perMessageDeflate&&this.perMessageDeflate.threshold==null&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=t.rejectUnauthorized===void 0?!0:t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",(typeof self=="undefined"||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}qe.priorWebsocketSuccess=!1,_s(qe.prototype),qe.protocol=Gn.protocol,qe.Socket=qe,qe.Transport=ba,qe.transports=bg,qe.parser=Gn,qe.prototype.createTransport=function(e){Lt('creating transport "%s"',e);var t=q4(this.query);t.EIO=Gn.protocol,t.transport=e;var r=this.transportOptions[e]||{};this.id&&(t.sid=this.id);var i=new bg[e]({query:t,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,withCredentials:r.withCredentials||this.withCredentials,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0,isReactNative:this.isReactNative});return i};function q4(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}qe.prototype.open=function(){var e;if(this.rememberUpgrade&&qe.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){var t=this;setTimeout(function(){t.emit("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(r){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)},qe.prototype.setTransport=function(e){Lt("setting transport %s",e.name);var t=this;this.transport&&(Lt("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(r){t.onPacket(r)}).on("error",function(r){t.onError(r)}).on("close",function(){t.onClose("transport close")})},qe.prototype.probe=function(e){Lt('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),r=!1,i=this;qe.priorWebsocketSuccess=!1;function n(){if(i.onlyBinaryUpgrades){var u=!this.supportsBinary&&i.transport.supportsBinary;r=r||u}if(r)return;Lt('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(p){if(r)return;if(p.type==="pong"&&p.data==="probe"){if(Lt('probe transport "%s" pong',e),i.upgrading=!0,i.emit("upgrading",t),!t)return;qe.priorWebsocketSuccess=t.name==="websocket",Lt('pausing current transport "%s"',i.transport.name),i.transport.pause(function(){if(r)return;if(i.readyState==="closed")return;Lt("changing transport and sending upgrade packet"),l(),i.setTransport(t),t.send([{type:"upgrade"}]),i.emit("upgrade",t),t=null,i.upgrading=!1,i.flush()})}else{Lt('probe transport "%s" failed',e);var f=new Error("probe error");f.transport=t.name,i.emit("upgradeError",f)}})}function s(){if(r)return;r=!0,l(),t.close(),t=null}function a(u){var p=new Error("probe error: "+u);p.transport=t.name,s(),Lt('probe transport "%s" failed because of error: %s',e,u),i.emit("upgradeError",p)}function c(){a("transport closed")}function o(){a("socket closed")}function d(u){t&&u.name!==t.name&&(Lt('"%s" works - aborting "%s"',u.name,t.name),s())}function l(){t.removeListener("open",n),t.removeListener("error",a),t.removeListener("close",c),i.removeListener("close",o),i.removeListener("upgrading",d)}t.once("open",n),t.once("error",a),t.once("close",c),this.once("close",o),this.once("upgrading",d),t.open()},qe.prototype.onOpen=function(){if(Lt("socket open"),this.readyState="open",qe.priorWebsocketSuccess=this.transport.name==="websocket",this.emit("open"),this.flush(),this.readyState==="open"&&this.upgrade&&this.transport.pause){Lt("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},qe.prototype.onPacket=function(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){Lt('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat");switch(e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data);break}}else Lt('packet received with socket readyState "%s"',this.readyState)},qe.prototype.onHandshake=function(e){if(this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),this.readyState==="closed")return;this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat)},qe.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){if(t.readyState==="closed")return;t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},qe.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){Lt("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},qe.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},qe.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emit("drain"):this.flush()},qe.prototype.flush=function(){this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(Lt("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},qe.prototype.write=qe.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},qe.prototype.sendPacket=function(e,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;var n={type:e,data:t,options:r};this.emit("packetCreate",n),this.writeBuffer.push(n),i&&this.once("flush",i),this.flush()},qe.prototype.close=function(){if(this.readyState==="opening"||this.readyState==="open"){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?i():t()}):this.upgrading?i():t()}function t(){e.onClose("forced close"),Lt("socket closing - telling transport to close"),e.transport.close()}function r(){e.removeListener("upgrade",r),e.removeListener("upgradeError",r),t()}function i(){e.once("upgrade",r),e.once("upgradeError",r)}return this},qe.prototype.onError=function(e){Lt("socket error %j",e),qe.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},qe.prototype.onClose=function(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){Lt('socket close with reason: "%s"',e);var r=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),r.writeBuffer=[],r.prevBufferLen=0}},qe.prototype.filterUpgrades=function(e){for(var t=[],r=0,i=e.length;r<i;r++)~Hu(this.transports,e[r])&&t.push(e[r]);return t};var yg=U4,z4=Gn;yg.parser=z4;var Vu=$4;function $4(e,t){var r=[];t=t||0;for(var i=t||0;i<e.length;i++)r[i-t]=e[i];return r}var _i=H4;function H4(e,t,r){return e.on(t,r),{destroy:function(){e.removeListener(t,r)}}}var vg=[].slice,ln=function(e,t){if(typeof t=="string"&&(t=e[t]),typeof t!="function")throw new Error("bind() requires a function");var r=vg.call(arguments,2);return function(){return t.apply(e,r.concat(vg.call(arguments)))}},wg=ne(function(e,t){var r=td("socket.io-client:socket");e.exports=t=s;var i={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},n=_s.prototype.emit;function s(a,c,o){this.io=a,this.nsp=c,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},o&&o.query&&(this.query=o.query),this.io.autoConnect&&this.open()}_s(s.prototype),s.prototype.subEvents=function(){if(this.subs)return;var a=this.io;this.subs=[_i(a,"open",ln(this,"onopen")),_i(a,"packet",ln(this,"onpacket")),_i(a,"close",ln(this,"onclose"))]},s.prototype.open=s.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.reconnecting||this.io.open(),this.io.readyState==="open"&&this.onopen(),this.emit("connecting"),this)},s.prototype.send=function(){var a=Vu(arguments);return a.unshift("message"),this.emit.apply(this,a),this},s.prototype.emit=function(a){if(i.hasOwnProperty(a))return n.apply(this,arguments),this;var c=Vu(arguments),o={type:(this.flags.binary!==void 0?this.flags.binary:ju(c))?rr.BINARY_EVENT:rr.EVENT,data:c};return o.options={},o.options.compress=!this.flags||this.flags.compress!==!1,typeof c[c.length-1]=="function"&&(r("emitting packet with ack id %d",this.ids),this.acks[this.ids]=c.pop(),o.id=this.ids++),this.connected?this.packet(o):this.sendBuffer.push(o),this.flags={},this},s.prototype.packet=function(a){a.nsp=this.nsp,this.io.packet(a)},s.prototype.onopen=function(){if(r("transport is open - connecting"),this.nsp!=="/")if(this.query){var a=typeof this.query=="object"?cd.encode(this.query):this.query;r("sending connect packet with query %s",a),this.packet({type:rr.CONNECT,query:a})}else this.packet({type:rr.CONNECT})},s.prototype.onclose=function(a){r("close (%s)",a),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",a)},s.prototype.onpacket=function(a){var c=a.nsp===this.nsp,o=a.type===rr.ERROR&&a.nsp==="/";if(!c&&!o)return;switch(a.type){case rr.CONNECT:this.onconnect();break;case rr.EVENT:this.onevent(a);break;case rr.BINARY_EVENT:this.onevent(a);break;case rr.ACK:this.onack(a);break;case rr.BINARY_ACK:this.onack(a);break;case rr.DISCONNECT:this.ondisconnect();break;case rr.ERROR:this.emit("error",a.data);break}},s.prototype.onevent=function(a){var c=a.data||[];r("emitting event %j",c),a.id!=null&&(r("attaching ack callback to event"),c.push(this.ack(a.id))),this.connected?n.apply(this,c):this.receiveBuffer.push(c)},s.prototype.ack=function(a){var c=this,o=!1;return function(){if(o)return;o=!0;var d=Vu(arguments);r("sending ack %j",d),c.packet({type:ju(d)?rr.BINARY_ACK:rr.ACK,id:a,data:d})}},s.prototype.onack=function(a){var c=this.acks[a.id];typeof c=="function"?(r("calling ack %s with %j",a.id,a.data),c.apply(this,a.data),delete this.acks[a.id]):r("bad ack %s",a.id)},s.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},s.prototype.emitBuffered=function(){var a;for(a=0;a<this.receiveBuffer.length;a++)n.apply(this,this.receiveBuffer[a]);for(this.receiveBuffer=[],a=0;a<this.sendBuffer.length;a++)this.packet(this.sendBuffer[a]);this.sendBuffer=[]},s.prototype.ondisconnect=function(){r("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},s.prototype.destroy=function(){if(this.subs){for(var a=0;a<this.subs.length;a++)this.subs[a].destroy();this.subs=null}this.io.destroy(this)},s.prototype.close=s.prototype.disconnect=function(){return this.connected&&(r("performing disconnect (%s)",this.nsp),this.packet({type:rr.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},s.prototype.compress=function(a){return this.flags.compress=a,this},s.prototype.binary=function(a){return this.flags.binary=a,this}}),V4=Sa;function Sa(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Sa.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=(Math.floor(t*10)&1)==0?e-r:e+r}return Math.min(e,this.max)|0},Sa.prototype.reset=function(){this.attempts=0},Sa.prototype.setMin=function(e){this.ms=e},Sa.prototype.setMax=function(e){this.max=e},Sa.prototype.setJitter=function(e){this.jitter=e};var hr=td("socket.io-client:manager"),Sg=Object.prototype.hasOwnProperty,Gu=We;function We(e,t){if(!(this instanceof We))return new We(e,t);e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||Infinity),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new V4({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=t.parser||rr;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=t.autoConnect!==!1,this.autoConnect&&this.open()}We.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var e in this.nsps)Sg.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},We.prototype.updateSocketIds=function(){for(var e in this.nsps)Sg.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},We.prototype.generateId=function(e){return(e==="/"?"":e+"#")+this.engine.id},_s(We.prototype),We.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},We.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},We.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},We.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},We.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},We.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},We.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()},We.prototype.open=We.prototype.connect=function(e,t){if(hr("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;hr("opening %s",this.uri),this.engine=yg(this.uri,this.opts);var r=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var n=_i(r,"open",function(){i.onopen(),e&&e()}),s=_i(r,"error",function(o){if(hr("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",o),e){var d=new Error("Connection error");d.data=o,e(d)}else i.maybeReconnectOnOpen()});if(this._timeout!==!1){var a=this._timeout;hr("connect attempt will timeout after %d",a),a===0&&n.destroy();var c=setTimeout(function(){hr("connect attempt timed out after %d",a),n.destroy(),r.close(),r.emit("error","timeout"),i.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(c)}})}return this.subs.push(n),this.subs.push(s),this},We.prototype.onopen=function(){hr("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(_i(e,"data",ln(this,"ondata"))),this.subs.push(_i(e,"ping",ln(this,"onping"))),this.subs.push(_i(e,"pong",ln(this,"onpong"))),this.subs.push(_i(e,"error",ln(this,"onerror"))),this.subs.push(_i(e,"close",ln(this,"onclose"))),this.subs.push(_i(this.decoder,"decoded",ln(this,"ondecoded")))},We.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},We.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},We.prototype.ondata=function(e){this.decoder.add(e)},We.prototype.ondecoded=function(e){this.emit("packet",e)},We.prototype.onerror=function(e){hr("error",e),this.emitAll("error",e)},We.prototype.socket=function(e,t){var r=this.nsps[e];if(!r){r=new wg(this,e,t),this.nsps[e]=r;var i=this;r.on("connecting",n),r.on("connect",function(){r.id=i.generateId(e)}),this.autoConnect&&n()}function n(){~Hu(i.connecting,r)||i.connecting.push(r)}return r},We.prototype.destroy=function(e){var t=Hu(this.connecting,e);if(~t&&this.connecting.splice(t,1),this.connecting.length)return;this.close()},We.prototype.packet=function(e){hr("writing packet %j",e);var t=this;e.query&&e.type===0&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(r){for(var i=0;i<r.length;i++)t.engine.write(r[i],e.options);t.encoding=!1,t.processPacketQueue()}))},We.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},We.prototype.cleanup=function(){hr("cleanup");for(var e=this.subs.length,t=0;t<e;t++){var r=this.subs.shift();r.destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},We.prototype.close=We.prototype.disconnect=function(){hr("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,this.readyState==="opening"&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},We.prototype.onclose=function(e){hr("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},We.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)hr("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();hr("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var r=setTimeout(function(){if(e.skipReconnect)return;if(hr("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect)return;e.open(function(i){i?(hr("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",i.data)):(hr("reconnect success"),e.onreconnect())})},t);this.subs.push({destroy:function(){clearTimeout(r)}})}},We.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)};var G4=ne(function(e,t){var r=td("socket.io-client");e.exports=t=n;var i=t.managers={};function n(s,a){typeof s=="object"&&(a=s,s=void 0),a=a||{};var c=jC(s),o=c.source,d=c.id,l=c.path,u=i[d]&&l in i[d].nsps,p=a.forceNew||a["force new connection"]||a.multiplex===!1||u,f;return p?(r("ignoring socket cache for %s",o),f=Gu(o,a)):(i[d]||(r("new io instance for %s",o),i[d]=Gu(o,a)),f=i[d]),c.query&&!a.query&&(a.query=c.query),f.socket(c.path,a)}t.protocol=rr.protocol,t.connect=n,t.Manager=Gu,t.Socket=wg}),Xu=e=>{if(e[Symbol.asyncIterator])return e;if(e.getReader)return async function*(){const t=e.getReader();try{for(;;){const{done:r,value:i}=await t.read();if(r)return;yield i}}finally{t.releaseLock()}}();throw new Error("unknown stream")},_g=e=>async t=>{t=il(t);const r=C=>{typeof C.return=="function"&&C.return()};let i=null,n=null;const s=C=>{i=C,n&&n(C),r(t)};let a=null,c=!1;const o=()=>{c=!0,a&&a()};let d=null,l=!1;const u=()=>{l=!0,d&&d()};let p=null;const f=()=>{p&&p()},g=()=>new Promise((C,D)=>{a=p=C,n=D,e.once("drain",f)}),v=()=>(r(t),new Promise((C,D)=>{if(c||l||i)return C();d=a=C,n=D})),S=()=>{e.removeListener("error",s),e.removeListener("close",o),e.removeListener("finish",u),e.removeListener("drain",f)};e.once("error",s),e.once("close",o),e.once("finish",u);try{for await(const C of t){if(!e.writable||e.destroyed||i)break;e.write(C)===!1&&await g()}}catch(C){i||e.destroy(),i=C}try{if(e.writable&&e.end(),await v(),i)throw i}finally{S()}},Eg=e=>({sink:_g(e),source:Xu(e)}),X4=e=>async function*(t){const r=Eg(e);r.sink(t).catch(i=>{}),yield*r.source},_a=Xu,K4=Xu,W4=_g,Y4=X4,Z4=Eg;_a.source=K4,_a.sink=W4,_a.transform=Y4,_a.duplex=Z4;const{CLOSE_TIMEOUT:J4}=Pu,md=le("libp2p:webrtc-star:socket");md.error=le("libp2p:webrtc-star:socket:error");const Ag=(e,t)=>{if(!e||!t)return;try{return _o(e,t)}catch(r){return md.error(r),_o("0.0.0.0",t)}};var Ig=(e,t={})=>{const{sink:r,source:i}=_a.duplex(e),n=t.remoteAddr||Ag(e.remoteAddress,e.remotePort),s=Ag(e.localAddress,e.localPort),a={async sink(c){t.signal&&(c=zt(c,t.signal));try{await r(async function*(){for await(const o of c)yield o instanceof Uint8Array?o:o.slice()}())}catch(o){o.type!=="aborted"&&md.error(o)}},source:t.signal?zt(i,t.signal):i,conn:e,localAddr:s,remoteAddr:n,timeline:{open:Date.now()},close(){return e.destroyed?void 0:new Promise((c,o)=>{const d=Date.now(),l=setTimeout(()=>{if(a.remoteAddr){const{host:u,port:p}=a.remoteAddr.toOptions();md("timeout closing socket to %s:%s after %dms, destroying it manually",u,p,Date.now()-d)}e.destroyed||e.destroy()},J4);e.once("close",()=>{c()}),e.end(u=>{if(clearTimeout(l),a.timeline.close=Date.now(),u)return o(u)})})}};return e.once("close",()=>{a.timeline.close||(a.timeline.close=Date.now())}),a},Tg=ne(function(e,t){function r(n){const s=n.toString().split("/"),a=n.protos()[1].name,c=n.protos()[2].name,o=n.stringTuples()[1][1];if(a!=="tcp"||c!=="ws"&&c!=="wss")throw new Error("invalid multiaddr: "+n.toString());if(!Er.isName(n))return"http://"+s[2]+":"+s[4];if(c==="ws")return"http://"+s[2]+(o===80?"":":"+o);if(c==="wss")return"https://"+s[2]+(o===443?"":":"+o)}function i(n){const s="/libp2p-webrtc-star";if(n.indexOf(s)!==-1){n=n.substring(s.length,n.length);let a=Er(n);const c=a.stringTuples().filter(o=>o[0]===421)[0];a=a.decapsulate("p2p"),a=a.encapsulate("/p2p-webrtc-star"),a=a.encapsulate(`/p2p/${c[1]}`),n=a.toString()}return n}t=e.exports,t.cleanUrlSIO=r,t.cleanMultiaddr=i});const Es=le("libp2p:webrtc-star:listener");Es.error=le("libp2p:webrtc-star:listener:error");const{cleanUrlSIO:Q4}=Tg,{CODE_P2P:Cg}=Pu,eR={transports:["websocket"],"force new connection":!0};var tR=({handler:e,upgrader:t},r,i={})=>{const n=new _r;let s;return n.__connections=[],n.__spChannels=new Map,n.__pendingIntents=new Map,n.listen=a=>{const c=gc();s=a,!a.protoCodes().includes(Cg)&&t.localPeer?r._signallingAddr=a.encapsulate(`/p2p/${t.localPeer.toB58String()}`):r._signallingAddr=a;const o=Q4(a);Es("Dialing to Signalling Server on: "+o),n.io=G4.connect(o,eR);const d=l=>{if(l.answer||l.err||!l.intentId)return;const u=l.intentId;let p=n.__pendingIntents.get(u);p||(p=[],n.__pendingIntents.set(u,p));let f=n.__spChannels.get(u);if(f){f.signal(l.signal);return}else if(l.signal.type!=="offer"){p.push(l);return}const g={trickle:!1,...i};r.wrtc&&(g.wrtc=r.wrtc),f=new Z0(g);const v=S=>{Es.error("incoming connectioned errored",S)};f.on("error",v),f.once("close",(...S)=>{f.removeListener("error",v)}),f.on("signal",S=>{l.signal=S,l.answer=!0,n.io.emit("ss-handshake",l)}),f.signal(l.signal);for(const S of p)f.signal(S.signal);n.__pendingIntents.set(u,[]),f.once("connect",async()=>{const S=Ig(f);Es("new inbound connection %s",S.remoteAddr);let C;try{C=await t.upgradeInbound(S)}catch(D){return Es.error("inbound connection failed to upgrade",D),S.close()}if(!C.remoteAddr)try{C.remoteAddr=a.decapsulateCode(Cg).encapsulate(`/p2p/${C.remotePeer.toB58String()}`)}catch(D){Es.error("could not determine remote address",D)}Es("inbound connection %s upgraded",S.remoteAddr),rR(n,S,u),n.emit("connection",C),e(C)}),n.__spChannels.set(u,f)};return n.io.once("connect_error",l=>c.reject(l)),n.io.once("error",l=>{n.emit("error",l),n.emit("close")}),n.io.on("ws-handshake",d),n.io.on("ws-peer",r._peerDiscovered),n.io.on("connect",()=>{n.io.emit("ss-join",r._signallingAddr.toString())}),n.io.once("connect",()=>{n.emit("listening"),c.resolve()}),c.promise},n.close=async()=>{n.io&&n.io.emit("ss-leave"),await Promise.all(n.__connections.map(a=>a.close())),n.emit("close")},n.getAddrs=()=>[s],r.listenersRefs[Er.toString()]=n,n};function rR(e,t,r){e.__connections.push(t);const i=()=>{e.__connections=e.__connections.filter(n=>n!==t),e.__spChannels.delete(r),e.__pendingIntents.delete(r)};t.conn.once("close",i)}const un=le("libp2p:webrtc-star");un.error=le("libp2p:webrtc-star:error");const{EventEmitter:iR}=_r,{AbortError:Rg}=zt,{supportsWebRTCDataChannels:nR}=AC,{CODE_CIRCUIT:sR}=Pu,{cleanMultiaddr:aR}=Tg;function oR(){}class cR{constructor(e={}){if(!e.upgrader)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=e.upgrader,this._signallingAddr=void 0,this.sioOptions={transports:["websocket"],"force new connection":!0},e.wrtc&&(this.wrtc=e.wrtc),this.listenersRefs={},this.discovery=new iR,this.discovery.tag="webRTCStar",this.discovery._isStarted=!1,this.discovery.start=()=>{this.discovery._isStarted=!0},this.discovery.stop=()=>{this.discovery._isStarted=!1},this._peerDiscovered=this._peerDiscovered.bind(this)}async dial(e,t={}){const r=await this._connect(e,t),i=Ig(r,{remoteAddr:e,signal:t.signal});un("new outbound connection %s",i.remoteAddr);const n=await this._upgrader.upgradeOutbound(i);return un("outbound connection %s upgraded",i.remoteAddr),n}_connect(e,t={}){if(t.signal&&t.signal.aborted)throw new Rg;const r={initiator:!0,trickle:!1,...t.spOptions||{}};this.wrtc&&(r.wrtc=this.wrtc);const i=e.toOptions(),n=(~~(Math.random()*1e9)).toString(36)+Date.now(),s=this.listenersRefs[Object.keys(this.listenersRefs)[0]].io;return new Promise((a,c)=>{const o=Date.now();let d;un("dialing %s:%s",i.host,i.port);const l=new Z0(r),u=S=>{if(!d){const C=`connection error ${i.host}:${i.port}: ${S.message}`;un.error(C),v(S)}},p=()=>{un("connnection timeout %s:%s",i.host,i.port);const S=G(new Error(`connection timeout after ${Date.now()-o}ms`),"ERR_CONNECT_TIMEOUT");l.emit("error",S)},f=()=>{d=!0,un("connection opened %s:%s",i.host,i.port),v(null)},g=()=>{un.error("connection aborted %s:%s",i.host,i.port),l.destroy(),v(new Rg)},v=S=>{l.removeListener("timeout",p),l.removeListener("connect",f),t.signal&&t.signal.removeEventListener("abort",g),S?c(S):a(l)};l.on("error",u),l.once("timeout",p),l.once("connect",f),l.on("close",()=>{l.removeListener("error",u)}),t.signal&&t.signal.addEventListener("abort",g),l.on("signal",S=>{s.emit("ss-handshake",{intentId:n,srcMultiaddr:this._signallingAddr.toString(),dstMultiaddr:e.toString(),signal:S})}),s.on("ws-handshake",S=>{if(S.intentId===n&&S.err&&c(G(S.err instanceof Error?S.err:new Error(S.err),"ERR_SIGNALLING_FAILED")),S.intentId!==n||!S.answer||l.destroyed)return;l.signal(S.signal)})})}createListener(e={},t){if(!nR&&!this.wrtc)throw G(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");return typeof e=="function"&&(t=e,e={}),t=t||oR,tR({handler:t,upgrader:this._upgrader},this,e)}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>t.protoCodes().includes(sR)?!1:rl.WebRTCStar.matches(t))}_peerDiscovered(e){if(!this.discovery._isStarted)return;un("Peer Discovered:",e),e=aR(e);const t=Er(e),r=ke.createFromB58String(t.getPeerId());this.discovery.emit("peer",{id:r,multiaddrs:[t]})}}var Mg=rn(cR,{className:"WebRTCStar",symbolName:"@libp2p/js-libp2p-webrtc-star/webrtcstar"});const{Address4:dR,Address6:lR}=Hm,gd={ERR_INVALID_IP_PARAMETER:"ERR_INVALID_IP_PARAMETER",ERR_INVALID_PORT_PARAMETER:"ERR_INVALID_PORT_PARAMETER",ERR_INVALID_IP:"ERR_INVALID_IP"};function uR(e,t){if(typeof e!="string")throw G(new Error(`invalid ip provided: ${e}`),gd.ERR_INVALID_IP_PARAMETER);if(t=parseInt(t),isNaN(t))throw G(new Error(`invalid port provided: ${t}`),gd.ERR_INVALID_PORT_PARAMETER);if(new dR(e).isValid())return Er(`/ip4/${e}/tcp/${t}`);const r=new lR(e);if(r.isValid())return r.is4()?Er(`/ip4/${r.to4().correctForm()}/tcp/${t}`):Er(`/ip6/${e}/tcp/${t}`);throw G(new Error(`invalid ip:port for creating a multiaddr: ${e}:${t}`),gd.ERR_INVALID_IP)}var Ku=uR,fR=gd;Ku.Errors=fR;var hR=421,pR=290,mR=2e3,Wu={CODE_P2P:hR,CODE_CIRCUIT:pR,CLOSE_TIMEOUT:mR};const Yu=le("libp2p:tcp:socket"),{CLOSE_TIMEOUT:gR}=Wu;var kg=(e,t)=>{t=t||{},t.listeningAddr&&t.listeningAddr.getPath()&&(t.remoteAddr=t.listeningAddr),t.remoteAddr&&t.remoteAddr.getPath()&&(t.localAddr=t.remoteAddr);const{sink:r,source:i}=_a.duplex(e),n={async sink(s){t.signal&&(s=zt(s,t.signal));try{await r(async function*(){for await(const a of s)yield Buffer.isBuffer(a)?a:a.slice()}())}catch(a){a.type!=="aborted"&&Yu(a)}},source:t.signal?zt(i,t.signal):i,conn:e,localAddr:t.localAddr||Ku(e.localAddress,e.localPort),remoteAddr:t.remoteAddr||Ku(e.remoteAddress,e.remotePort),timeline:{open:Date.now()},close(){return e.destroyed?void 0:new Promise((s,a)=>{const c=Date.now(),o=setTimeout(()=>{const{host:d,port:l}=n.remoteAddr.toOptions();Yu("timeout closing socket to %s:%s after %dms, destroying it manually",d,l,Date.now()-c),e.destroyed?Yu("%s:%s is already destroyed",d,l):e.destroy(),s()},gR);e.once("close",()=>clearTimeout(o)),e.end(d=>{if(n.timeline.close=Date.now(),d)return a(d);s()})})}};return e.once("close",()=>{n.timeline.close||(n.timeline.close=Date.now())}),n};const{resolve:bR}=my,yR={ip4:"IPv4",ip6:"IPv6"};function vR(e){const t=e.getPath();return t?bR(t):e.toOptions()}function wR(e,t,r){const i=n=>Er(`/${e}/${n}/tcp/${r}`);return(Pg(t)?SR(yR[e]):[t]).map(i)}function Pg(e){return["0.0.0.0","::"].includes(e)}function SR(e){return Object.values(Nf.networkInterfaces()).reduce((t,r)=>(r.forEach(i=>{i.family===e&&t.push(i.address)}),t),[])}var Ng={multiaddrToNetConfig:vR,isAnyAddr:Pg,getMultiaddrs:wR};const As=le("libp2p:tcp:listener");As.error=le("libp2p:tcp:listener:error");const{CODE_P2P:_R}=Wu,{getMultiaddrs:xg,multiaddrToNetConfig:ER}=Ng;async function Og(e){try{e&&await e.close()}catch(t){As.error("an error occurred closing the connection",t)}}var AR=({handler:e,upgrader:t},r)=>{const i=new _r,n=Nd.createServer(async c=>{c.on("error",l=>As("socket error",l));let o,d;try{o=kg(c,{listeningAddr:a}),As("new inbound connection %s",o.remoteAddr),d=await t.upgradeInbound(o)}catch(l){return As.error("inbound connection failed",l),Og(o)}As("inbound connection %s upgraded",o.remoteAddr),IR(n,o),e&&e(d),i.emit("connection",d)});n.on("listening",()=>i.emit("listening")).on("error",c=>i.emit("error",c)).on("close",()=>i.emit("close")),n.__connections=[],i.close=()=>n.listening?new Promise((c,o)=>{n.__connections.forEach(d=>Og(d)),n.close(d=>d?o(d):c())}):void 0;let s,a;return i.listen=c=>(a=c,s=c.getPeerId(),s&&(a=c.decapsulateCode(_R)),new Promise((o,d)=>{const l=ER(a);n.listen(l,u=>{if(u)return d(u);As("Listening on %s",n.address()),o()})})),i.getAddrs=()=>{let c=[];const o=n.address();if(!o)throw new Error("Listener is not ready yet");return a.toString().startsWith("/ip4")?c=c.concat(xg("ip4",o.address,o.port)):o.family==="IPv6"&&(c=c.concat(xg("ip6",o.address,o.port))),c.map(d=>s?d.encapsulate(`/p2p/${s}`):d)},i};function IR(e,t){e.__connections.push(t);const r=()=>{e.__connections=e.__connections.filter(i=>i!==t)};t.conn.once("close",r)}const Ea=le("libp2p:tcp"),{multiaddrToNetConfig:TR}=Ng,{AbortError:Dg}=zt,{CODE_CIRCUIT:CR,CODE_P2P:RR}=Wu;class MR{constructor({upgrader:e}){if(!e)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=e}async dial(e,t){t=t||{};const r=await this._connect(e,t),i=kg(r,{remoteAddr:e,signal:t.signal});Ea("new outbound connection %s",i.remoteAddr);const n=await this._upgrader.upgradeOutbound(i);return Ea("outbound connection %s upgraded",i.remoteAddr),n}_connect(e,t={}){if(t.signal&&t.signal.aborted)throw new Dg;return new Promise((r,i)=>{const n=Date.now(),s=TR(e);Ea("dialing %j",s);const a=Nd.connect(s),c=p=>{p.message=`connection error ${s.host}:${s.port}: ${p.message}`,u(p)},o=()=>{Ea("connnection timeout %s:%s",s.host,s.port);const p=G(new Error(`connection timeout after ${Date.now()-n}ms`),"ERR_CONNECT_TIMEOUT");a.emit("error",p)},d=()=>{Ea("connection opened %j",s),u()},l=()=>{Ea("connection aborted %j",s),a.destroy(),u(new Dg)},u=p=>{if(a.removeListener("error",c),a.removeListener("timeout",o),a.removeListener("connect",d),t.signal&&t.signal.removeEventListener("abort",l),p)return i(p);r(a)};a.on("error",c),a.on("timeout",o),a.on("connect",d),t.signal&&t.signal.addEventListener("abort",l)})}createListener(e,t){return typeof e=="function"&&(t=e,e={}),e=e||{},AR({handler:t,upgrader:this._upgrader})}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>t.protoCodes().includes(CR)?!1:rl.TCP.matches(t.decapsulateCode(RR)))}}var kR=rn(MR,{className:"TCP",symbolName:"@libp2p/js-libp2p-tcp/tcp"});const Zu=10*1024;class PR{constructor(){this._pool=new Uint8Array(Zu),this._poolOffset=0}write(e){const t=this._pool;let r=this._poolOffset;be.encode(e.id<<3|e.type,t,r),r+=be.encode.bytes,be.encode(e.data?e.data.length:0,t,r),r+=be.encode.bytes;const i=t.subarray(this._poolOffset,r);return Zu-r<100?(this._pool=new Uint8Array(Zu),this._poolOffset=0):this._poolOffset=r,e.data?[i,e.data]:i}}const Bg=new PR;var NR=e=>async function*(){for await(const r of e)Array.isArray(r)?yield new Ar(r.map(i=>Bg.write(i))):yield new Ar(Bg.write(r))}(),xR=e=>async function*(){const r=new OR;for await(const i of e){const n=r.write(i);n.length&&(yield n)}}();class OR{constructor(){this._buffer=new Ar,this._bufferProxy=new Proxy({},{get:(e,t)=>t[0]==="l"?this._buffer[t]:this._buffer.get(parseInt(t))}),this._headerInfo=null}write(e){if(!e||!e.length)return[];this._buffer.append(e);const t=[];for(;;){if(!this._headerInfo)try{this._headerInfo=this._decodeHeader(this._bufferProxy)}catch(c){break}const{id:r,type:i,length:n,offset:s}=this._headerInfo,a=this._buffer.length-s;if(a<n)break;t.push({id:r,type:i,data:this._buffer.shallowSlice(s,s+n)}),this._buffer.consume(s+n),this._headerInfo=null}return t}_decodeHeader(e){const t=be.decode(e);let r=be.decode.bytes;const i=be.decode(e,r);return r+=be.decode.bytes,{id:t>>3,type:t&7,offset:r,length:i}}}var DR=NR,BR=xR,Lg={encode:DR,decode:BR};const jg=1<<20;var Ju=e=>{e=e||jg;const t=r=>{if(r.data&&r.data.length>e)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"})};return r=>async function*(){for await(const n of r)Array.isArray(n)?n.forEach(t):t(n),yield n}()},LR=jg;Ju.MAX_MSG_SIZE=LR;const fn=Object.freeze({NEW_STREAM:0,MESSAGE_RECEIVER:1,MESSAGE_INITIATOR:2,CLOSE_RECEIVER:3,CLOSE_INITIATOR:4,RESET_RECEIVER:5,RESET_INITIATOR:6});var jR=fn,FR=Object.freeze({NEW_STREAM:fn.NEW_STREAM,MESSAGE:fn.MESSAGE_INITIATOR,CLOSE:fn.CLOSE_INITIATOR,RESET:fn.RESET_INITIATOR}),UR=Object.freeze({MESSAGE:fn.MESSAGE_RECEIVER,CLOSE:fn.CLOSE_RECEIVER,RESET:fn.RESET_RECEIVER}),qR=Object.freeze(Object.entries(fn).reduce((e,t)=>(e[t[1]]=t[0],e),{})),Fg={MessageTypes:jR,InitiatorMessageTypes:FR,ReceiverMessageTypes:UR,MessageTypeNames:qR};const Go=le("libp2p:mplex:stream"),{MAX_MSG_SIZE:zR}=Ju,{InitiatorMessageTypes:$R,ReceiverMessageTypes:HR}=Fg,Qu="ERR_MPLEX_STREAM_RESET",VR="ERR_MPLEX_STREAM_ABORT";var GR=({id:e,name:t,send:r,onEnd:i=()=>{},type:n="initiator",maxMsgSize:s=zR})=>{const a=new Ya,c=new Ya,o=n==="initiator"?$R:HR,d=n==="initiator"?`i${e}`:`r${e}`;t=String(t??e);let l=!1,u=!1,p;const f=S=>{if(l)return;l=!0,Go("%s stream %s source end",n,t,S),S&&!p&&(p=S),u&&(v.timeline.close=Date.now(),i(p))},g=S=>{if(u)return;u=!0,Go("%s stream %s sink end",n,t,S),S&&!p&&(p=S),l&&(v.timeline.close=Date.now(),i(p))},v={close:()=>v.source.end(),abort:S=>{Go("%s stream %s abort",n,t,S),v.source.end(S),a.abort(),g(S)},reset:()=>{const S=G(new Error("stream reset"),Qu);c.abort(),v.source.end(S),g(S)},sink:async S=>{S=zt(S,[{signal:a.signal,options:{abortMessage:"stream aborted",abortCode:VR}},{signal:c.signal,options:{abortMessage:"stream reset",abortCode:Qu}}]),n==="initiator"&&r({id:e,type:o.NEW_STREAM,data:t});try{for await(let C of S)for(;C.length;){if(C.length<=s){r({id:e,type:o.MESSAGE,data:C});break}C=Ar.isBufferList(C)?C:new Ar(C),r({id:e,type:o.MESSAGE,data:C.shallowSlice(0,s)}),C.consume(s)}}catch(C){return C.code===Qu?Go("%s stream %s reset",n,t):(Go("%s stream %s error",n,t,C),r({id:e,type:o.RESET})),v.source.end(C),g(C)}r({id:e,type:o.CLOSE}),g()},source:mc(f),timeline:{open:Date.now(),close:null},id:d};return v};const hn=le("libp2p:mplex"),{MessageTypes:Is,MessageTypeNames:Ug}=Fg;class qg{constructor(e){e=e||{},e=typeof e=="function"?{onStream:e}:e,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._options=e,this.sink=this._createSink(),this.source=this._createSource(),this.onStream=e.onStream,this.onStreamEnd=e.onStreamEnd}get streams(){const e=[];return this._streams.initiators.forEach(t=>{e.push(t)}),this._streams.receivers.forEach(t=>{e.push(t)}),e}newStream(e){const t=this._streamId++;e=e==null?t.toString():String(e);const r=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:r})}_newReceiverStream({id:e,name:t}){const r=this._streams.receivers;return this._newStream({id:e,name:t,type:"receiver",registry:r})}_newStream({id:e,name:t,type:r,registry:i}){if(i.has(e))throw new Error(`${r} stream ${e} already exists!`);hn("new %s stream %s %s",r,e,t);const n=c=>(hn.enabled&&hn("%s stream %s %s send",r,e,t,{...c,type:Ug[c.type],data:c.data&&c.data.slice()}),this.source.push(c)),s=()=>{hn("%s stream %s %s ended",r,e,t),i.delete(e),this.onStreamEnd&&this.onStreamEnd(a)},a=GR({id:e,name:t,send:n,type:r,onEnd:s,maxMsgSize:this._options.maxMsgSize});return i.set(e,a),a}_createSink(){return async e=>{this._options.signal&&(e=zt(e,this._options.signal));try{await Yr(e,Lg.decode,Ju(this._options.maxMsgSize),async t=>{for await(const r of t)for(const i of r)this._handleIncoming(i)})}catch(t){return hn("error in sink",t),this.source.end(t)}this.source.end()}}_createSource(){const e=r=>{const{initiators:i,receivers:n}=this._streams;for(const s of i.values())s.abort(r);for(const s of n.values())s.abort(r)},t=mc({onEnd:e,writev:!0});return Object.assign(Lg.encode(t),{push:t.push,end:t.end,return:t.return})}_handleIncoming({id:e,type:t,data:r}){if(hn.enabled&&hn("incoming message",{id:e,type:Ug[t],data:r.slice()}),t===Is.NEW_STREAM&&this.onStream){const s=this._newReceiverStream({id:e,name:r.toString()});return this.onStream(s)}const i=t&1?this._streams.initiators:this._streams.receivers,n=i.get(e);if(!n)return hn("missing stream %s",e);switch(t){case Is.MESSAGE_INITIATOR:case Is.MESSAGE_RECEIVER:n.source.push(r);break;case Is.CLOSE_INITIATOR:case Is.CLOSE_RECEIVER:n.close();break;case Is.RESET_INITIATOR:case Is.RESET_RECEIVER:n.reset();break;default:hn("unknown message type %s",t)}}}qg.multicodec="/mplex/6.7.0";var XR=qg,KR=XR;/*!
 * assert.js - assert for bcrypto
 * Copyright (c) 2020, Christopher Jeffrey (MIT License).
 * https://github.com/bcoin-org/bcrypto
 */function zg(e,t){if(!e){const r=new Error(t||"Assertion failed");throw Error.captureStackTrace&&Error.captureStackTrace(r,zg),r}}var fe=zg;/*!
 * custom.js - custom inspect symbol for bcrypto
 * Copyright (c) 2018-2019, Christopher Jeffrey (MIT License).
 * https://github.com/bcoin-org/bcrypto
 */var WR="inspect",$g={custom:WR};const{custom:Hg}=$g,Vg=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],YR=[0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],ZR=[0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176],ef={p192:null,p224:null,p521:null,k256:null,p251:null,p25519:null,p448:null},Ct={NONE:0,QUO:1,REM:2,BOTH:3,EUCLID:4,ALL:7},Ei=4,Kn=1<<Ei-1,Ts=typeof BigInt=="function";class K{constructor(e,t,r){this.words=[0],this.length=1,this.negative=0,this.red=null,this.from(e,t,r)}_iadd(e,t){let r=0,i=0;for(e.length<t.length&&([e,t]=[t,e]),e!==this&&this._alloc(e.length);i<t.length;i++){const n=(e.words[i]|0)+(t.words[i]|0)+r;this.words[i]=n&67108863,r=n>>>26}for(;r!==0&&i<e.length;i++){const n=(e.words[i]|0)+r;this.words[i]=n&67108863,r=n>>>26}if(this.length=e.length,r!==0)this._alloc(this.length+1),this.words[this.length++]=r;else if(e!==this)for(;i<e.length;i++)this.words[i]=e.words[i];return this}_iaddn(e){if(this.words[0]+=e,this.words[0]<67108864)return this;let t=0;for(this._alloc(this.length+1),this.words[this.length]=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,this.words[t+1]+=1;return this.length=Math.max(this.length,t+1),this}iadd(e){if(J(K.isBN(e),"num","bignum"),this.negative===e.negative)this._iadd(this,e);else{const t=this.ucmp(e);if(t===0)return this.words[0]=0,this.length=1,this.negative=0,this;t<0?(this._isub(e,this),this.negative^=1):this._isub(this,e)}return this}iaddn(e){J(dt(e),"num","smi");const t=e<0|0;return t&&(e=-e),this.negative===t?this._iaddn(e):this.length===1&&this.words[0]<e?(this.words[0]=e-this.words[0],this.negative^=1):this._isubn(e),this}add(e){return J(K.isBN(e),"num","bignum"),e.length>this.length?e.clone().iadd(this):this.clone().iadd(e)}addn(e){return this.clone().iaddn(e)}_isub(e,t){let r=0,i=0;for(Rt(e.length>=t.length),e!==this&&this._alloc(e.length);i<t.length;i++){const n=(e.words[i]|0)-(t.words[i]|0)+r;r=n>>26,this.words[i]=n&67108863}for(;r!==0&&i<e.length;i++){const n=(e.words[i]|0)+r;r=n>>26,this.words[i]=n&67108863}if(Rt(r===0),e!==this)for(;i<e.length;i++)this.words[i]=e.words[i];return this.length=Math.max(this.length,i),this._strip()}_isubn(e){if(this.words[0]-=e,this.words[0]>=0)return this._normalize();Rt(this.length!==1),this._alloc(this.length+1);for(let t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.words[this.length]=0,this._strip()}isub(e){if(J(K.isBN(e),"num","bignum"),this.negative!==e.negative)this._iadd(this,e);else{const t=this.ucmp(e);if(t===0)return this.words[0]=0,this.length=1,this.negative=0,this;t<0?(this._isub(e,this),this.negative^=1):this._isub(this,e)}return this}isubn(e){J(dt(e),"num","smi");const t=e<0|0;return t&&(e=-e),this.negative!==t?this._iaddn(e):this.length===1&&this.words[0]<e?(this.words[0]=e-this.words[0],this.negative^=1):this._isubn(e),this}sub(e){return this.clone().isub(e)}subn(e){return this.clone().isubn(e)}_mul(e,t){if(J(K.isBN(e),"num","bignum"),J(K.isBN(t),"out","bignum"),this.length===10&&e.length===10)return eb(this,e,t);const r=this.length+e.length;return r<63?Jg(this,e,t):r<1024?Qg(this,e,t):dM(this,e,t)}imul(e){return this.mul(e)._move(this)}imuln(e){J(dt(e),"num","smi");const t=e<0|0;t&&(e=-e);let r=0;for(let i=0;i<this.length;i++){const n=this.words[i]*e,s=(n&67108863)+(r&67108863);r>>=26,r+=n/67108864|0,r+=s>>>26,this.words[i]=s&67108863}return this.negative^=t,r!==0?(this._alloc(this.length+1),this.words[this.length++]=r):this._strip(),this}mul(e){J(K.isBN(e),"num","bignum");const t=this.length+e.length,r=new K;r.words=new Array(t);for(let i=0;i<t;i++)r.words[i]=0;return this._mul(e,r)}muln(e){return this.clone().imuln(e)}mulShift(e,t){J(K.isBN(e),"num","bignum"),J(t>>>0===t,"bits","uint32");const r=this.mul(e),i=r.utestn(t-1);return r.iushrn(t),this.negative^e.negative?r.isubn(i):r.iaddn(i)}_div(e,t){J(K.isBN(e),"num","bignum"),Rt((t&Ct.ALL)===t),Rt(t!==Ct.NONE);const r=this,i=e;if(bd(!i.isZero()),r.isZero())return[new K(0),new K(0)];const n=r.negative,s=i.negative;r.negative=0,i.negative=0;let a=null,c=null;return r.ucmp(i)<0?(t&Ct.QUO&&(a=new K(0)),t&Ct.REM&&(c=r.clone())):i.length===1?(t&Ct.QUO&&(a=r.quon(i.words[0])),t&Ct.REM&&(c=r.remn(i.words[0]))):[a,c]=r._wordDiv(i,t),r.negative=n,i.negative=s,t&Ct.QUO&&(a.negative=r.negative^i.negative,a._normalize()),t&Ct.REM&&(c.negative=r.negative,c._normalize()),t&Ct.EUCLID&&(t&Ct.QUO&&(Rt((t&Ct.REM)!==0),c.negative!==0&&(i.negative!==0?a.iaddn(1):a.isubn(1))),t&Ct.REM&&(c.negative!==0&&(i.negative!==0?c.isub(i):c.iadd(i)))),[a,c]}_wordDiv(e,t){let r=this.clone(),i=e,n=null,s;const a=i.words[i.length-1]|0,c=26-Ta(a);c!==0?(i=i.clone(),r.iushln(c),i.iushln(c),s=i.words[i.length-1]|0):s=a;const o=r.length-i.length;if(Rt(o>=0),t&Ct.QUO){n=new K(0),n.length=o+1,n.words=new Array(n.length);for(let l=0;l<n.length;l++)n.words[l]=0}const d=r.clone();d._ishlnsubmul(i,1,o),d.negative===0&&(n&&(n.words[o]=1),r=d);for(let l=o-1;l>=0;l--){const u=r.words[i.length+l],p=r.words[i.length+l-1],f=(u*67108864+p)/s|0;let g=Math.min(f,67108863);for(r._ishlnsubmul(i,g,l);r.negative!==0;)g-=1,r.negative=0,r._ishlnsubmul(i,1,l),r.ineg();n&&(n.words[l]=g)}return n&&n._strip(),t&Ct.REM&&c!==0&&r.iushrn(c),[n,r]}_ishlnsubmul(e,t,r){let i=0,n=0;for(this._expand(e.length+r);n<e.length;n++){const s=(this.words[n+r]|0)+i,a=e.words[n]*t,c=s-(a&67108863);i=(c>>26)-(a/67108864|0),this.words[n+r]=c&67108863}for(;n<this.length-r;n++){const s=(this.words[n+r]|0)+i;i=s>>26,this.words[n+r]=s&67108863}if(i===0)return this._strip();Rt(i===-1),i=0;for(let s=0;s<this.length;s++){const a=-(this.words[s]|0)+i;i=a>>26,this.words[s]=a&67108863}return this.negative=1,this._strip()}quorem(e){return this._div(e,Ct.BOTH)}iquo(e){return this.quo(e)._move(this)}iquon(e){J(dt(e),"num","smi"),bd(e!==0);const t=e<0|0;t&&(e=-e);let r=0;for(let i=this.length-1;i>=0;i--){const n=(this.words[i]|0)+r*67108864;this.words[i]=n/e|0,r=n%e}return this.negative^=t,this._strip()}quo(e){return this._div(e,Ct.QUO)[0]}quon(e){return this.clone().iquon(e)}irem(e){return this.rem(e)._move(this)}iremn(e){let t=this.remrn(e);return t<0&&(t=-t),this.words[0]=t,this.length=1,this._normalize()}rem(e){return this._div(e,Ct.REM)[1]}remn(e){return this.clone().iremn(e)}remrn(e){J(dt(e),"num","smi"),bd(e!==0),e<0&&(e=-e);const t=(1<<26)%e;let r=0;for(let i=this.length-1;i>=0;i--)r=(t*r+(this.words[i]|0))%e;return this.negative!==0?-r|0:r}divmod(e){return this._div(e,Ct.BOTH|Ct.EUCLID)}idiv(e){return this.div(e)._move(this)}idivn(e){if(this.negative===0)return this.iquon(e);const t=this.remrn(e);return this.iquon(e),t<0&&(e<0?this.iaddn(1):this.isubn(1)),this}div(e){return this._div(e,Ct.BOTH|Ct.EUCLID)[0]}divn(e){return this.clone().idivn(e)}imod(e){return this.ucmp(e)<0?(this.negative!==0&&(this._isub(e,this),this.negative=0),this):this.mod(e)._move(this)}imodn(e){return this.words[0]=this.modrn(e),this.length=1,this.negative=0,this}mod(e){return this._div(e,Ct.REM|Ct.EUCLID)[1]}modn(e){return this.clone().imodn(e)}modrn(e){J(dt(e),"num","smi");let t=this.remrn(e);return t<0&&(e<0?t-=e:t+=e),t}divRound(e){const[t,r]=this.quorem(e);if(r.isZero())return t;const i=e.words[0]&1;e.iushrn(1);const n=r.ucmp(e);return e.iushln(1),e.words[0]|=i,n<0||e.isOdd()&&n===0?t:this.negative^e.negative?t.isubn(1):t.iaddn(1)}ipow(e){return this.pow(e)._move(this)}ipown(e){return this.pown(e)._move(this)}pow(e){J(K.isBN(e),"num","bignum");let t=Ta(e.words[e.length-1]),r=new K(1);for(let i=e.length-1;i>=0;i--){const n=e.words[i];for(let s=t-1;s>=0;s--)r=r.sqr(),n>>s&1&&(r=r.mul(this));t=26}return r}pown(e){if(J(dt(e),"num","smi"),e<0&&(e=-e),e===0)return new K(1);if(e===1)return this.clone();const t=Ta(e);let r=this;for(let i=t-2;i>=0;i--)r=r.sqr(),e>>i&1&&(r=r.mul(this));return r}isqr(){return this.imul(this)}sqr(){return this.mul(this)}_rootrem(e,t){if(J(e>>>0===e,"num","uint32"),e===0)throw new RangeError("Zeroth root.");if(~e&this.negative)throw new RangeError("Negative with even root.");if(this.ucmpn(1)<=0)return[this.clone(),new K(0)];let r=new K(0),i=K.shift(1,this.bitLength()/e+1|0),n,s;if(this.negative!==0&&i.ineg(),e===2)do r=i,i=this.quo(r),i.iadd(r),i.iushrn(1);while(i.ucmp(r)<0);else do r=i,i=r.pown(e-1),i=this.quo(i),n=r.muln(e-1),i.iadd(n),i=i.quon(e);while(i.ucmp(r)<0);return t&&(i=r.pown(e),s=this.sub(i)),[r,s]}rootrem(e){return this._rootrem(e,1)}iroot(e){return this.root(e)._move(this)}root(e){return this._rootrem(e,0)[0]}isPower(e){if(J(e>>>0===e,"num","uint32"),e===0||~e&this.negative)return!1;const[,t]=this.rootrem(e);return t.sign()===0}sqrtrem(){return this.rootrem(2)}isqrt(){return this.sqrt()._move(this)}sqrt(){return this.root(2)}isSquare(){return this.isPower(2)}iand(e){J(K.isBN(e),"num","bignum");let t=this,r=e;if(t===r)return t;if((t.negative|r.negative)===0)return t.iuand(r);if((t.negative&r.negative)===1)return t.iaddn(1),r.iaddn(1),t.iuor(r),t.isubn(1),r.isubn(1),t;t.negative!==0&&([t,r]=[r.clone(),t]);const i=t.bitLength();return r.iaddn(1),r.inotn(i),t.iuand(r),r.inotn(i),r.isubn(1),t._move(this)}iandn(e){return J(dt(e),"num","smi"),(this.negative|e<0)!==0?this.iand(new K(e)):(this.words[0]&=e,this.length=1,this)}and(e){return this.clone().iand(e)}andn(e){return this.clone().iandn(e)}andrn(e){if(J(dt(e),"num","smi"),(this.negative|e<0)!==0){const t=this.iand(new K(e));if(t.length>1)throw new RangeError("Number exceeds 26 bits.");return t.negative!==0?-t.words[0]:t.words[0]}return this.words[0]&e}iuand(e){J(K.isBN(e),"num","bignum"),this.length=Math.min(this.length,e.length);for(let t=0;t<this.length;t++)this.words[t]&=e.words[t];return this._strip()}iuandn(e){return J(dt(e),"num","smi"),this.words[0]&=Math.abs(e),this.length=1,this._normalize()}uand(e){return this.clone().iuand(e)}uandn(e){return this.clone().iuandn(e)}uandrn(e){J(dt(e),"num","smi");const t=this.words[0]&Math.abs(e);return this.negative!==0?-t|0:t}ior(e){J(K.isBN(e),"num","bignum");let t=this,r=e;return t===r?t:(t.negative|r.negative)===0?t.iuor(r):(t.negative&r.negative)===1?(t.iaddn(1),r.iaddn(1),t.iuand(r),t.isubn(1),r.isubn(1),t):(r=r.clone(),t.negative!==0&&([t,r]=[r,t]),r.iaddn(1),t.inotn(r.bitLength()),r.iuand(t),r.isubn(1),r._move(this))}iorn(e){return J(dt(e),"num","smi"),(this.negative|e<0)!==0?this.ior(new K(e)):(this.words[0]|=e,this)}or(e){return this.clone().ior(e)}orn(e){return this.clone().iorn(e)}iuor(e){J(K.isBN(e),"num","bignum"),this._expand(e.length);for(let t=0;t<e.length;t++)this.words[t]|=e.words[t];return this}iuorn(e){return J(dt(e),"num","smi"),this.words[0]|=Math.abs(e),this}uor(e){return this.clone().iuor(e)}uorn(e){return this.clone().iuorn(e)}ixor(e){J(K.isBN(e),"num","bignum");let t=this,r=e;return t===r?(t.words[0]=0,t.length=1,t.negative=0,t):(t.negative|r.negative)===0?t.iuxor(r):(t.negative&r.negative)===1?(t.iaddn(1),r.iaddn(1),t.iuxor(r),t.ineg(),r.isubn(1),t):(t.negative!==0&&([t,r]=[r.clone(),t]),r.iaddn(1),t.iuxor(r),t.iaddn(1),t.ineg(),r.isubn(1),t._move(this))}ixorn(e){return J(dt(e),"num","smi"),(this.negative|e<0)!==0?this.ixor(new K(e)):(this.words[0]^=e,this)}xor(e){return this.clone().ixor(e)}xorn(e){return this.clone().ixorn(e)}iuxor(e){J(K.isBN(e),"num","bignum");let t=this,r=e;t.length<r.length&&([t,r]=[r,t]);let i=0;for(;i<r.length;i++)this.words[i]=t.words[i]^r.words[i];if(t!==this)for(this._alloc(t.length);i<t.length;i++)this.words[i]=t.words[i];return this.length=t.length,this._strip()}iuxorn(e){return J(dt(e),"num","smi"),this.words[0]^=Math.abs(e),this._normalize()}uxor(e){return this.clone().iuxor(e)}uxorn(e){return this.clone().iuxorn(e)}inot(){return this.negative!==0?this.ineg().isubn(1):this.iaddn(1).ineg(),this}not(){return this.clone().inot()}inotn(e){J(e>>>0===e,"width","uint32");const t=e%26;let r=Math.ceil(e/26),i=0;for(this._expand(r),t>0&&(r-=1);i<r;i++)this.words[i]^=67108863;return t>0&&(this.words[i]^=(1<<t)-1),this._strip()}notn(e){return this.clone().inotn(e)}ishl(e){return J(K.isBN(e),"bits","bignum"),J(e.bitLength()<=32,"bits","uint32"),this.ishln(e.toNumber())}ishln(e){return this.iushln(e)}shl(e){return this.clone().ishl(e)}shln(e){return this.clone().ishln(e)}iushl(e){return J(K.isBN(e),"bits","bignum"),J(e.bitLength()<=32,"bits","uint32"),this.iushln(e.toNumber())}iushln(e){J(e>>>0===e,"bits","uint32");const t=e%26,r=(e-t)/26,i=(1<<t)-1<<26-t;if(t!==0){let n=0;for(let s=0;s<this.length;s++){const a=this.words[s]&i,c=(this.words[s]|0)-a<<t;this.words[s]=c|n,n=a>>>26-t}n!==0&&(this._alloc(this.length+1),this.words[this.length++]=n)}if(r!==0){this._alloc(this.length+r);for(let n=this.length-1;n>=0;n--)this.words[n+r]=this.words[n];for(let n=0;n<r;n++)this.words[n]=0;this.length+=r}return this._strip()}ushl(e){return this.clone().iushl(e)}ushln(e){return this.clone().iushln(e)}_split(e,t){const r=e%26,i=Math.min((e-r)/26,this.length),n=(1<<r)-1;if(t){t._alloc(i);for(let a=0;a<i;a++)t.words[a]=this.words[a];t.length=i}if(!(i===0))if(this.length>i){this.length-=i;for(let a=0;a<this.length;a++)this.words[a]=this.words[a+i]}else this.words[0]=0,this.length=1;let s=0;if(r!==0)for(let a=this.length-1;a>=0;a--){const c=this.words[a]|0;this.words[a]=s<<26-r|c>>>r,s=c&n}return t&&(s!==0?(t._alloc(t.length+1),t.words[t.length++]=s):(t.length===0&&(t.words[t.length++]=0),t._strip())),this._strip()}ishr(e){return J(K.isBN(e),"bits","bignum"),J(e.bitLength()<=32,"bits","uint32"),this.ishrn(e.toNumber())}ishrn(e){return J(e>>>0===e,"bits","uint32"),this.negative!==0?(this.iaddn(1),this.iushrn(e),this.isubn(1),this):this.iushrn(e)}shr(e){return this.clone().ishr(e)}shrn(e){return this.clone().ishrn(e)}iushr(e){return J(K.isBN(e),"bits","bignum"),J(e.bitLength()<=32,"bits","uint32"),this.iushrn(e.toNumber())}iushrn(e){return J(e>>>0===e,"bits","uint32"),this._split(e,null)}ushr(e){return this.clone().iushr(e)}ushrn(e){return this.clone().iushrn(e)}setn(e,t){return J(e>>>0===e,"bit","uint32"),this.negative!==0?(this.iaddn(1),this.usetn(e,!t),this.isubn(1),this):this.usetn(e,t)}usetn(e,t){J(e>>>0===e,"bit","uint32");const r=e%26,i=(e-r)/26;return this._expand(i+1),t?this.words[i]|=1<<r:this.words[i]&=~(1<<r),this._strip()}testn(e){J(e>>>0===e,"bit","uint32");const t=e%26,r=(e-t)/26;if(this.length<=r)return this.negative;const i=this.words[r],n=i>>t&1;if(this.negative!==0){if(t>0&&i&(1<<t)-1)return n^1;let s=r;for(;s--;)if(this.words[s]>0)return n^1}return n}utestn(e){J(e>>>0===e,"bit","uint32");const t=e%26,r=(e-t)/26;return this.length<=r?0:this.words[r]>>t&1}imaskn(e){return J(e>>>0===e,"bits","uint32"),this.negative!==0&&(this.iaddn(1),this.inotn(e+1),this.ineg()),this.iumaskn(e)}maskn(e){return this.clone().imaskn(e)}iumaskn(e){J(e>>>0===e,"bits","uint32");const t=e%26;let r=(e-t)/26;return this.length<=r?this:(t!==0&&(r+=1),this.length=Math.min(r,this.length),t!==0&&(this.words[this.length-1]&=(1<<t)-1),this.length===0&&(this.words[this.length++]=0),this._strip())}umaskn(e){return this.clone().iumaskn(e)}andln(e){return this.words[0]&e}bit(e){return this.utestn(e)}bits(e,t){J(e>>>0===e,"pos","uint32"),J(t>>>0===t,"width","uint32"),J(t<=26,"width","width");const r=e%26,i=(e-r)/26;if(i>=this.length)return 0;let n=this.words[i]>>r&(1<<t)-1;if(r+t>26&&i+1<this.length){const s=r+t-26,a=this.words[i+1]&(1<<s)-1;n|=a<<26-r}return n}ineg(){return this.isZero()||(this.negative^=1),this}neg(){return this.clone().ineg()}iabs(){return this.negative=0,this}abs(){return this.clone().iabs()}cmp(e){if(J(K.isBN(e),"num","bignum"),this.negative!==e.negative)return e.negative-this.negative;const t=this.ucmp(e);return this.negative!==0?-t|0:t}cmpn(e){J(dt(e),"num","smi");const t=e<0|0;if(this.negative!==t)return t-this.negative;const r=this.ucmpn(e);return this.negative!==0?-r|0:r}eq(e){return this.cmp(e)===0}eqn(e){return this.cmpn(e)===0}gt(e){return this.cmp(e)>0}gtn(e){return this.cmpn(e)>0}gte(e){return this.cmp(e)>=0}gten(e){return this.cmpn(e)>=0}lt(e){return this.cmp(e)<0}ltn(e){return this.cmpn(e)<0}lte(e){return this.cmp(e)<=0}lten(e){return this.cmpn(e)<=0}sign(){return this.negative!==0?-1:this.length===1&&this.words[0]===0?0:1}isZero(){return this.length===1&&this.words[0]===0}isNeg(){return this.negative!==0}isPos(){return this.negative===0}isOdd(){return(this.words[0]&1)===1}isEven(){return(this.words[0]&1)===0}ucmp(e){if(J(K.isBN(e),"num","bignum"),this.length<e.length)return-1;if(this.length>e.length)return 1;for(let t=this.length-1;t>=0;t--){const r=this.words[t]|0,i=e.words[t]|0;if(r===i)continue;return(r>i)-(r<i)}return 0}ucmpn(e){if(J(dt(e),"num","smi"),this.length>1)return 1;const t=this.words[0]|0;return e<0&&(e=-e),(t>e)-(t<e)}legendre(e){const t=Ts?K.red(e):K.mont(e);return this.toRed(t).redLegendre()}jacobi(e){if(J(K.isBN(e),"num","bignum"),e.isZero()||e.isEven())throw new Error("jacobi: `num` must be odd.");let t=this._cloneNormal(),r=e.clone(),i=1;for(r.isNeg()&&(t.isNeg()&&(i=-1),r.ineg()),(t.isNeg()||t.ucmp(r)>=0)&&t.imod(r);!t.isZero();){const n=t._makeOdd();if(n&1){const a=r.andln(7);(a===3||a===5)&&(i=-i)}t.ucmp(r)<0&&([t,r]=[r,t],t.andln(3)===3&&r.andln(3)===3&&(i=-i)),t._isub(t,r).iushrn(1);const s=r.andln(7);(s===3||s===5)&&(i=-i)}return r.cmpn(1)!==0?0:i}kronecker(e){J(K.isBN(e),"num","bignum");const t=[0,1,0,-1,0,-1,0,1];let r=this._cloneNormal(),i=e.clone(),n=1;if(i.isZero())return r.ucmpn(1)===0?n:0;if(!r.isOdd()&&!i.isOdd())return 0;const s=i._makeOdd();for(s&1&&(n=t[r.andln(7)]),i.isNeg()&&(r.isNeg()&&(n=-n),i.ineg());!r.isZero();){const a=r._makeOdd();a&1&&(n*=t[i.andln(7)]);const c=r.words[0]^r.negative*67108863;c&i.words[0]&2&&(n=-n),i.imod(r),[r,i]=[i,r],i.negative=0}return i.cmpn(1)!==0?0:n}igcd(e){return this.gcd(e)._move(this)}gcd(e){if(J(K.isBN(e),"num","bignum"),this.isZero())return e.abs();if(e.isZero())return this.abs();let t=this.clone(),r=e.clone();t.negative=0,r.negative=0;const i=t._factor2(r);for(i!==0&&(t.iushrn(i),r.iushrn(i));;){t._makeOdd(),r._makeOdd();const n=t.ucmp(r);if(n<0)[t,r]=[r,t];else if(n===0||r.ucmpn(1)===0)break;t._isub(t,r)}return r.iushln(i)}ilcm(e){return this.lcm(e)._move(this)}lcm(e){return J(K.isBN(e),"num","bignum"),this.isZero()||e.isZero()?new K(0):this.quo(this.gcd(e)).mul(e).iabs()}egcd(e){if(J(K.isBN(e),"num","bignum"),this.isZero())return[new K(0),new K(e.sign()),e.abs()];if(e.isZero())return[new K(this.sign()),new K(0),this.abs()];const t=this.clone(),r=e.clone();t.negative=0,r.negative=0;const i=new K(1),n=new K(0),s=new K(0),a=new K(1),c=t._factor2(r);c!==0&&(t.iushrn(c),r.iushrn(c));const o=r.clone(),d=t.clone();for(;!t.isZero();){let l=t._makeOdd(),u=r._makeOdd();for(;l--;)(i.isOdd()||n.isOdd())&&(i.iadd(o),n.isub(d)),i.iushrn(1),n.iushrn(1);for(;u--;)(s.isOdd()||a.isOdd())&&(s.iadd(o),a.isub(d)),s.iushrn(1),a.iushrn(1);t.cmp(r)>=0?(t.isub(r),i.isub(s),n.isub(a)):(r.isub(t),s.isub(i),a.isub(n))}return this.negative!==0&&s.ineg(),e.negative!==0&&a.ineg(),[s,a,r.iushln(c)]}iinvert(e){return this.invert(e)._move(this)}invert(e){if(J(K.isBN(e),"num","bignum"),qi(e.sign()>0,"invert"),e.isOdd())return this._invertp(e);if(e.cmpn(1)===0)throw new RangeError("Not invertible.");const[t,,r]=this.egcd(e);if(r.cmpn(1)!==0)throw new RangeError("Not invertible.");return t.imod(e)}ifermat(e){return this.fermat(e)._move(this)}fermat(e){const t=Ts?K.red(e):K.mont(e);return this.toRed(t).redFermat().fromRed()}ipowm(e,t,r){return this.powm(e,t,r)._move(this)}powm(e,t,r){const i=!Ts&&r?K.mont(t):K.red(t);return this.toRed(i).redPow(e).fromRed()}ipowmn(e,t,r){return this.powmn(e,t,r)._move(this)}powmn(e,t,r){const i=r?K.mont(t):K.red(t);return this.toRed(i).redPown(e).fromRed()}isqrtm(e){return this.sqrtm(e)._move(this)}sqrtm(e){J(K.isBN(e),"p","bignum");let t;return e.andln(3)===3||e.andln(7)===5?t=K.red(e):t=K.mont(e),this.toRed(t).redSqrt().fromRed()}isqrtpq(e,t){return this.sqrtpq(e,t)._move(this)}sqrtpq(e,t){const r=this.sqrtm(e),i=this.sqrtm(t),[n,s]=e.egcd(t),a=i.mul(n).mul(e),c=r.mul(s).mul(t),o=e.mul(t);return a.iadd(c).imod(o)}isPrime(e,t,r){return J(t>>>0===t,"reps","uint32"),this.isPrimeMR(e,t+1,!0)?!!this.isPrimeLucas(r):!1}isPrimeMR(e,t,r=!1){J(t>>>0===t,"reps","uint32"),J(t>0,"reps","integer"),J(typeof r=="boolean","force2","boolean");const i=this;if(i.cmpn(7)<0)return i.cmpn(2)===0||i.cmpn(3)===0||i.cmpn(5)===0;if(i.isEven())return!1;const n=i.subn(1),s=n.subn(2),a=n.zeroBits(),c=n.ushrn(a),o=K.red(i),d=n.toRed(o),l=new K(1).toRed(o);e:for(let u=0;u<t;u++){let p;u===t-1&&r?p=new K(2):(p=K.random(e,0,s),p.iaddn(2));let f=p.toRed(o).redPow(c);if(f.cmp(l)===0||f.cmp(d)===0)continue;for(let g=1;g<a;g++){if(f=f.redSqr(),f.cmp(d)===0)continue e;if(f.cmp(l)===0)return!1}return!1}return!0}isPrimeLucas(e=0){J(e>>>0===e,"limit","uint32");const t=this;if(t.cmpn(1)<=0)return!1;if(t.isEven())return t.cmpn(2)===0;let r=3;for(;;){if(r>1e4)throw new Error(`Cannot find (D/n) = -1 for ${t.toString(10)}.`);if(e!==0&&r>e)return!1;const o=new K(r*r-4),d=o.jacobi(t);if(d===-1)break;if(d===0)return t.cmpn(r+2)===0;if(r===40&&t.isSquare())return!1;r+=1}const i=t.addn(1),n=i._makeOdd(),s=t.subn(2);let a=new K(2),c=new K(r);for(let o=i.bitLength();o>=0;o--)i.utestn(o)?(a=a.mul(c).iadd(t).isubn(r).imod(t),c=c.sqr().iadd(s).imod(t)):(c=c.mul(a).iadd(t).isubn(r).imod(t),a=a.sqr().iadd(s).imod(t));if(a.cmpn(2)===0||a.cmp(s)===0){let o=a.muln(r),d=c.ushln(1);if(o.cmp(d)<0&&([o,d]=[d,o]),o.isub(d).imod(t).isZero())return!0}for(let o=0;o<n-1;o++){if(a.isZero())return!0;if(a.cmpn(2)===0)return!1;a=a.sqr().isubn(2).imod(t)}return!1}toTwos(e){return this.negative!==0?this.abs().inotn(e).iaddn(1):this.clone()}fromTwos(e){return J(e>>>0===e,"width","uint32"),qi(e>0,"width"),this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()}toRed(e){if(J(e instanceof Aa,"ctx","reduction context"),this.red)throw new Error("Already in reduction context.");return e.convertTo(this)}fromRed(){return Ie(this.red,"fromRed"),this.red.convertFrom(this)}forceRed(e){if(J(e instanceof Aa,"ctx","reduction context"),this.red){if(!e.m.eq(this.red.m)||e.mont!==this.red.mont)throw new Error("Already in reduction context.")}else qi(this.negative===0,"red"),qi(this.ucmp(e.m)<0,"red");return this.clone()._forceRed(e)}redIAdd(e){return J(K.isBN(e),"num","bignum"),Ie(this.red,"redIAdd"),this.red.iadd(this,e)}redAdd(e){return J(K.isBN(e),"num","bignum"),Ie(this.red,"redAdd"),this.red.add(this,e)}redIAddn(e){return J(dt(e),"num","smi"),Ie(this.red,"redIAddn"),this.red.iaddn(this,e)}redAddn(e){return J(dt(e),"num","smi"),Ie(this.red,"redAddn"),this.red.addn(this,e)}redISub(e){return J(K.isBN(e),"num","bignum"),Ie(this.red,"redISub"),this.red.isub(this,e)}redSub(e){return J(K.isBN(e),"num","bignum"),Ie(this.red,"redSub"),this.red.sub(this,e)}redISubn(e){return J(dt(e),"num","smi"),Ie(this.red,"redISubn"),this.red.isubn(this,e)}redSubn(e){return J(dt(e),"num","smi"),Ie(this.red,"redSubn"),this.red.subn(this,e)}redIMul(e){return J(K.isBN(e),"num","bignum"),Ie(this.red,"redIMul"),this.red.imul(this,e)}redMul(e){return J(K.isBN(e),"num","bignum"),Ie(this.red,"redMul"),this.red.mul(this,e)}redIMuln(e){return J(dt(e),"num","smi"),Ie(this.red,"redIMuln"),this.red.imuln(this,e)}redMuln(e){return J(dt(e),"num","smi"),Ie(this.red,"redMuln"),this.red.muln(this,e)}redIDiv(e){return J(K.isBN(e),"num","bignum"),Ie(this.red,"redIDiv"),this.red.idiv(this,e)}redDiv(e){return J(K.isBN(e),"num","bignum"),Ie(this.red,"redDiv"),this.red.div(this,e)}redIDivn(e){return J(dt(e),"num","smi"),Ie(this.red,"redIDivn"),this.red.idivn(this,e)}redDivn(e){return J(dt(e),"num","smi"),Ie(this.red,"redDivn"),this.red.divn(this,e)}redIPow(e){return J(K.isBN(e),"num","bignum"),Ie(this.red,"redIPow"),Rs(!e.red,"redIPow"),this.red.ipow(this,e)}redPow(e){return J(K.isBN(e),"num","bignum"),Ie(this.red,"redPow"),Rs(!e.red,"redPow"),this.red.pow(this,e)}redIPown(e){return J(dt(e),"num","smi"),Ie(this.red,"redIPown"),this.red.ipown(this,e)}redPown(e){return J(dt(e),"num","smi"),Ie(this.red,"redPown"),this.red.pown(this,e)}redISqr(){return Ie(this.red,"redISqr"),this.red.isqr(this)}redSqr(){return Ie(this.red,"redSqr"),this.red.sqr(this)}redISqrt(){return Ie(this.red,"redISqrt"),this.red.isqrt(this)}redSqrt(){return Ie(this.red,"redSqrt"),this.red.sqrt(this)}redIDivSqrt(e){return Ie(this.red,"redIDivSqrt"),this.red.idivsqrt(this,e)}redDivSqrt(e){return Ie(this.red,"redDivSqrt"),this.red.divsqrt(this,e)}redIsSquare(){return Ie(this.red,"redIsSquare"),this.red.isSquare(this)}redIShl(e){return J(K.isBN(e),"num","bignum"),Ie(this.red,"redIShl"),Rs(!e.red,"redIShl"),this.red.ishl(this,e)}redShl(e){return J(K.isBN(e),"num","bignum"),Ie(this.red,"redShl"),Rs(!e.red,"redShl"),this.red.shl(this,e)}redIShln(e){return J(e>>>0===e,"num","uint32"),Ie(this.red,"redIShln"),this.red.ishln(this,e)}redShln(e){return J(e>>>0===e,"num","uint32"),Ie(this.red,"redShln"),this.red.shln(this,e)}redINeg(){return Ie(this.red,"redINeg"),this.red.ineg(this)}redNeg(){return Ie(this.red,"redNeg"),this.red.neg(this)}redEq(e){return J(K.isBN(e),"num","bignum"),Ie(this.red,"redEq"),this.red.eq(this,e)}redEqn(e){return J(dt(e),"num","smi"),Ie(this.red,"redEqn"),this.red.eqn(this,e)}redIsHigh(){return Ie(this.red,"redIsHigh"),this.red.isHigh(this)}redIsLow(){return Ie(this.red,"redIsLow"),this.red.isLow(this)}redIsOdd(){return Ie(this.red,"redIsOdd"),this.red.isOdd(this)}redIsEven(){return Ie(this.red,"redIsEven"),this.red.isEven(this)}redLegendre(){return Ie(this.red,"redLegendre"),this.red.legendre(this)}redJacobi(){return Ie(this.red,"redJacobi"),this.red.jacobi(this)}redKronecker(){return Ie(this.red,"redKronecker"),this.red.kronecker(this)}redIInvert(){return Ie(this.red,"redIInvert"),this.red.iinvert(this)}redInvert(){return Ie(this.red,"redInvert"),this.red.invert(this)}redIFermat(){return Ie(this.red,"redIFermat"),this.red.ifermat(this)}redFermat(){return Ie(this.red,"redFermat"),this.red.fermat(this)}_move(e){return e.words=this.words,e.length=this.length,e.negative=this.negative,e.red=this.red,e}_alloc(e){for(;this.words.length<e;)this.words.push(0);return this}_expand(e){for(this._alloc(e);this.length<e;)this.words[this.length++]=0;return this}_strip(){for(;this.length>1&&this.words[this.length-1]===0;)this.length-=1;return this._normalize()}_normalize(){return Rt(this.length>0),this.length===1&&this.words[0]===0&&(this.negative=0),this}_check(){return Rt(this.length>0),Rt(this.length<=this.words.length),this.length===1?(this.words[0]===0&&Rt(this.negative===0),this):(Rt(this.words[this.length-1]!==0),this)}_invertp(e){if(J(K.isBN(e),"p","bignum"),qi(e.sign()>0,"invert"),Rt(e.isOdd()),e.cmpn(1)===0)throw new RangeError("Not invertible.");const t=this.clone(),r=e.clone(),i=new K(1),n=new K(0);for((t.isNeg()||t.ucmp(r)>=0)&&t.imod(r);!t.isZero();){let s=t._makeOdd(),a=r._makeOdd();for(;s--;)i.isOdd()&&i._iadd(i,e),i.iushrn(1);for(;a--;)n.isOdd()&&n._iadd(n,e),n.iushrn(1);t.ucmp(r)>=0?(t._isub(t,r),i.ucmp(n)<0?(i._isub(n,i),i._isub(e,i)):i._isub(i,n)):(r._isub(r,t),n.ucmp(i)<0?(n._isub(i,n),n._isub(e,n)):n._isub(n,i))}if(r.cmpn(1)!==0)throw new RangeError("Not invertible.");return Rt(n.negative===0),Rt(n.ucmp(e)<0),n}_makeOdd(){const e=this.zeroBits();return e>0&&this.iushrn(e),e}_factor2(e){if((this.words[0]|e.words[0])&1)return 0;const t=Math.min(this.length,e.length);let r=0;for(let i=0;i<t;i++){const n=Kg(this.words[i]|e.words[i]);if(r+=n,n!==26)break}return r}_cloneNormal(){return this.red?this.fromRed():this.clone()}_forceRed(e){return this.red=e,this}clone(){const e=new K;e.words=new Array(this.length);for(let t=0;t<this.length;t++)e.words[t]=this.words[t];return e.length=this.length,e.negative=this.negative,e.red=this.red,e}inject(e){J(K.isBN(e),"num","bignum"),this._alloc(e.length);for(let t=0;t<e.length;t++)this.words[t]=e.words[t];return this.length=e.length,this.negative=e.negative,this.red=e.red,this}set(e,t){return this.fromNumber(e,t)}swap(e){J(K.isBN(e),"num","bignum");const t=this,r=e;return[t.words,r.words]=[r.words,t.words],[t.length,r.length]=[r.length,t.length],[t.negative,r.negative]=[r.negative,t.negative],[t.red,r.red]=[r.red,t.red],t}reverse(){const e=this.negative;return this.fromBuffer(this.toBuffer("be"),"le"),this.negative=e,this}byteLength(){return Math.ceil(this.bitLength()/8)}bitLength(){const e=this.words[this.length-1],t=Ta(e);return(this.length-1)*26+t}zeroBits(){if(this.isZero())return 0;if(this.isOdd())return 0;let e=0;for(let t=0;t<this.length;t++){const r=Kg(this.words[t]);if(e+=r,r!==26)break}return e}isSafe(){return this.length<=2?!0:this.length===3&&this.words[2]===1}word(e){return J(e>>>0===e,"pos","uint32"),e>=this.length?0:this.words[e]}[Hg](){let e="BN";return this.red&&(e="BN-R"),`<${e}: ${this.toString(10)}>`}csign(){return this.negative*-2+1-this.czero()}czero(){const e=this.words[0]-1>>>31;return this.length-2>>>31&e}cneg(){return this.negative}cpos(){return this.negative^1}ceq(e){J(K.isBN(e),"num","bignum");let t=0;for(let r=0;r<e.length;r++)t|=this.words[r%this.length]^e.words[r];return t|=this.length^e.length,t|=this.negative^e.negative,t-1>>>31}ceqn(e){const t=e>>31&1,r=(e|0)*(-t|1)&67108863;let i=0;return i|=this.words[0]^r,i|=this.length^1,i|=this.negative^t,i-1>>>31}cswap(e,t){J(K.isBN(e),"num","bignum");const r=this,i=e,n=(t>>31|-t>>31)&1,s=-n&67108863;r._alloc(i.words.length),i._alloc(r.words.length);for(let o=0;o<r.words.length;o++){const d=(r.words[o]^i.words[o])&s;r.words[o]^=d,i.words[o]^=d}const a=(r.length^i.length)&s,c=(r.negative^i.negative)&s;return r.length^=a,i.length^=a,r.negative^=c,i.negative^=c,this}cinject(e,t){J(K.isBN(e),"num","bignum");const r=this,i=e,n=(t>>31|-t>>31)&1,s=n-1&67108863,a=~(n-1)&67108863;r._alloc(i.length);for(let c=0;c<i.length;c++)r.words[c]=r.words[c]&s|i.words[c]&a;return r.length=r.length&s|i.length&a,r.negative=r.negative&s|i.negative&a,this}cset(e,t){const r=(t>>31|-t>>31)&1,i=r-1&67108863,n=~(r-1)&67108863,s=e>>31&1,a=(e|0)*(-s|1)&67108863;return this.words[0]=this.words[0]&i|a&n,this.length=this.length&i|1&n,this.negative=this.negative&i|s&n,this}toNumber(){let e=this.words[0];if(this.length===2)e+=this.words[1]*67108864;else if(this.length===3&&this.words[2]===1)e+=4503599627370496+this.words[1]*67108864;else if(this.length>2)throw new RangeError("Number can only safely store up to 53 bits.");return this.negative!==0?-e:e}toDouble(){let e=0;for(let t=this.length-1;t>=0;t--)e=e*67108864+this.words[t];return this.negative!==0?-e:e}valueOf(){return this.toDouble()}toBigInt(){if(!Ts)throw new Error("BigInt is not supported!");const e=BigInt(52),t=BigInt(26);let r=this.length-1,i=BigInt(0);for(;r>=1;r-=2){const n=this.words[r]*67108864,s=this.words[r-1];i=i<<e|BigInt(n+s)}return r>=0&&(i=i<<t|BigInt(this.words[0])),this.negative!==0?-i:i}toBool(){return!this.isZero()}toString(e,t){if(e=Xg(e),t==null&&(t=0),t===0&&(t=1),J(e>>>0===e,"base","uint32"),J(t>>>0===t,"padding","uint32"),e<2||e>36)throw new RangeError("Base ranges between 2 and 36.");if(this._check(),e===16){let a="",c=0,o=0;for(let d=0;d<this.length;d++){const l=this.words[d],u=((l<<c|o)&16777215).toString(16);o=l>>>24-c&16777215,o!==0||d!==this.length-1?a=Vg[6-u.length]+u+a:a=u+a,c+=2,c>=26&&(c-=26,d-=1)}for(o!==0&&(a=o.toString(16)+a);a.length%t!==0;)a="0"+a;return this.negative!==0&&(a="-"+a),a}const r=YR[e-1],i=ZR[e-1],n=this.clone();let s="";for(n.negative=0;!n.isZero();){const a=n.remrn(i).toString(e);n.iquon(i),n.isZero()?s=a+s:s=Vg[r-a.length]+a+s}for(this.isZero()&&(s="0");s.length%t!==0;)s="0"+s;return this.negative!==0&&(s="-"+s),s}toJSON(){return this.toString(16,2)}toArray(e,t){return this.toArrayLike(Array,e,t)}toBuffer(e,t){return this.toArrayLike(Buffer,e,t)}toArrayLike(e,t,r){t==null&&(t="be"),r==null&&(r=0),J(typeof e=="function","ArrayType","function"),J(t==="be"||t==="le","endian","endianness"),J(r>>>0===r,"length","uint32"),this._check();const i=this.byteLength(),n=r||Math.max(1,i);if(i>n)throw new RangeError("Byte array longer than desired length.");const s=oM(e,n);if(t==="be"){let a=s.length-1,c=0;for(let o=0;o<this.length;o++){const d=(o&3)<<1,l=this.words[o]<<d|c;s[a--]=l&255,a>=0&&(s[a--]=l>>>8&255),a>=0&&(s[a--]=l>>>16&255),d===6?(a>=0&&(s[a--]=l>>>24&255),c=0):c=l>>>24}if(a>=0){for(s[a--]=c;a>=0;)s[a--]=0;c=0}Rt(c===0)}else{let a=0,c=0;for(let o=0;o<this.length;o++){const d=(o&3)<<1,l=this.words[o]<<d|c;s[a++]=l&255,a<s.length&&(s[a++]=l>>>8&255),a<s.length&&(s[a++]=l>>>16&255),d===6?(a<s.length&&(s[a++]=l>>>24&255),c=0):c=l>>>24}if(a<s.length){for(s[a++]=c;a<s.length;)s[a++]=0;c=0}Rt(c===0)}return s}encode(e,t){return this.toBuffer(e,t)}of(e,t){return this.fromNumber(e,t)}fromNumber(e,t){t==null&&(t="be"),J(Gg(e),"num","integer"),J(t==="be"||t==="le","endian","endianness");const r=e<0|0;return r&&(e=-e),e<67108864?(this.words[0]=e&67108863,this.length=1):e<4503599627370496?(this.words=[e&67108863,e/67108864&67108863],this.length=2):(this.words=[e&67108863,e/67108864&67108863,1],this.length=3),this.negative=r,t==="le"&&this.reverse(),this}fromDouble(e,t){t==null&&(t="be"),J(typeof e=="number","num","double"),J(t==="be"||t==="le","endian","endianness"),isFinite(e)||(e=0);const r=e<=-1|0;for(e<0&&(e=-e),e=Math.floor(e),this.words=[];e>0;){const i=e%67108864,n=(e-i)/67108864;this.words.push(i),e=n}return this.words.length===0&&this.words.push(0),this.length=this.words.length,this.negative=r,t==="le"&&this.reverse(),this}fromBigInt(e,t){if(t==null&&(t="be"),J(typeof e=="bigint","num","bigint"),J(t==="be"||t==="le","endian","endianness"),!Ts)throw new Error("BigInt is not supported!");const r=e<BigInt(0)|0;return this._fromHex(e.toString(16),r),this.negative=r,t==="le"&&this.reverse(),this}fromBool(e){return J(typeof e=="boolean","value","boolean"),this.words[0]=e|0,this.length=1,this.negative=0,this}fromString(e,t,r){if((t==="le"||t==="be")&&([t,r]=[r,t]),t=Xg(t),r==null&&(r="be"),J(typeof e=="string","string","string"),J(t>>>0===t,"base","uint32"),J(r==="be"||r==="le","endian","endianness"),t<2||t>36)throw new Error("Base ranges between 2 and 36.");e=e.replace(/\s+/g,"");let i=0;return e.length>0&&e.charCodeAt(0)===45&&(i=1),t===16?this._fromHex(e,i):this._fromBase(e,t,i),this.negative=i,this._normalize(),r==="le"&&this.reverse(),this}_fromHex(e,t){this.length=Math.max(2,Math.ceil((e.length-t)/6)),this.words=new Array(this.length);for(let s=0;s<this.length;s++)this.words[s]=0;let r=0,i=e.length-6,n=0;for(;i>=t;i-=6){const s=Wg(e,i,i+6);this.words[n]|=s<<r&67108863,this.words[n+1]|=s>>>26-r&4194303,r+=24,r>=26&&(r-=26,n+=1)}if(i+6!==t){const s=Wg(e,t,i+6);this.words[n]|=s<<r&67108863,this.words[n+1]|=s>>>26-r&4194303}return this._strip()}_fromBase(e,t,r){this.words[0]=0,this.length=1,this.negative=0;let i=0,n=1;for(;n<=67108863;n*=t)i+=1;i-=1,n=n/t|0;const s=e.length-r,a=s%i,c=Math.min(s,s-a)+r;let o=r;for(;o<c;o+=i){const d=Yg(e,o,o+i,t);this.imuln(n),this._iaddn(d)}if(a!==0){const d=Math.pow(t,a),l=Yg(e,o,e.length,t);this.imuln(d),this._iaddn(l)}return this}fromJSON(e){if(K.isBN(e))return e.red?e.fromRed():e.clone();if(Array.isArray(e)){for(const t of e)J(typeof t=="string","chunk","string");e=e.join("")}return this.fromString(e,16)}fromBN(e){return this.inject(e)}fromArray(e,t){return J(Array.isArray(e),"data","array"),this.fromArrayLike(e,t)}fromBuffer(e,t){return J(Buffer.isBuffer(e),"data","buffer"),this.fromArrayLike(e,t)}fromArrayLike(e,t){if(t==null&&(t="be"),J(e&&e.length>>>0===e.length,"data","array-like"),J(t==="be"||t==="le","endian","endianness"),e.length===0)return this.words[0]=0,this.length=1,this.negative=0,this;this.length=Math.max(2,Math.ceil(e.length/3)),this.words=new Array(this.length),this.negative=0;for(let a=0;a<this.length;a++)this.words[a]=0;const r=e.length%3;let i=0,n=0,s=0;if(t==="be"){for(let a=e.length-1;a>=2;a-=3){const c=e[a]|e[a-1]<<8|e[a-2]<<16;this.words[n]|=c<<i&67108863,this.words[n+1]=c>>>26-i&67108863,i+=24,i>=26&&(i-=26,n+=1)}switch(r){case 2:s=e[1]|e[0]<<8;break;case 1:s=e[0];break}}else{const a=e.length-r;for(let c=0;c<a;c+=3){const o=e[c]|e[c+1]<<8|e[c+2]<<16;this.words[n]|=o<<i&67108863,this.words[n+1]=o>>>26-i&67108863,i+=24,i>=26&&(i-=26,n+=1)}switch(r){case 2:s=e[a]|e[a+1]<<8;break;case 1:s=e[a];break}}return r>0&&(this.words[n]|=s<<i&67108863,this.words[n+1]=s>>>26-i&67108863),this._strip()}decode(e,t){return this.fromBuffer(e,t)}from(e,t,r){if(e==null)return this;if((t==="le"||t==="be")&&([t,r]=[r,t]),typeof e=="number")return this.fromNumber(e,r);if(typeof e=="bigint")return this.fromBigInt(e,r);if(typeof e=="string")return this.fromString(e,t,r);if(typeof e=="object"){if(K.isBN(e))return this.fromBN(e,r);if(e.length>>>0===e.length)return this.fromArrayLike(e,r)}if(typeof e=="boolean")return this.fromBool(e);throw new TypeError("Non-numeric object passed to BN.")}static min(...e){let t=null;for(const r of e)J(K.isBN(r),"num","bignum"),(!t||r.cmp(t)<0)&&(t=r);return t||new K(0)}static max(...e){let t=null;for(const r of e)J(K.isBN(r),"num","bignum"),(!t||r.cmp(t)>0)&&(t=r);return t||new K(0)}static cmp(e,t){return J(K.isBN(e),"a","bignum"),e.cmp(t)}static ucmp(e,t){return J(K.isBN(e),"a","bignum"),e.ucmp(t)}static red(e){return new Aa(e)}static barrett(e){return new sM(e)}static mont(e){return new aM(e)}static _prime(e){if(ef[e])return ef[e];let t;if(e==="p192")t=new JR;else if(e==="p224")t=new QR;else if(e==="p521")t=new eM;else if(e==="k256")t=new tM;else if(e==="p251")t=new rM;else if(e==="p25519")t=new iM;else if(e==="p448")t=new nM;else throw new Error(`Unknown prime: "${e}".`);return ef[e]=t,t}static prime(e){return K._prime(e).p.clone()}static pow(e,t){return e===2?K.shift(1,t):new K().fromNumber(e).pown(t)}static shift(e,t){return e===1?new K(0).usetn(t,1):new K().fromNumber(e).ishln(t)}static mask(e){return K.shift(1,e).isubn(1)}static randomBits(e,t){if(J(e!=null,"rng","rng"),J(t>>>0===t,"bits","uint32"),typeof e=="object"){J(typeof e.randomBytes=="function","rng","rng");const i=t+7>>>3,n=i*8,s=e.randomBytes(i);if(J(Buffer.isBuffer(s),"bytes","buffer"),s.length!==i)throw new RangeError("Invalid number of bytes returned from RNG.");const a=K.fromBuffer(s);return n>t&&a.iushrn(n-t),a}J(typeof e=="function","rng","rng");const r=e(t);if(J(K.isBN(r),"num","bignum"),qi(r.negative===0,"RNG"),Rs(!r.red,"RNG"),r.bitLength()>t)throw new RangeError("Invalid number of bits returned from RNG.");return r}static random(e,t,r){if(t=K.cast(t,16),r=K.cast(r,16),t.cmp(r)>0)throw new RangeError("Minimum cannot be greater than maximum.");const i=r.sub(t).iabs(),n=i.bitLength();if(n===0)return t.clone();for(;;){const s=K.randomBits(e,n);if(s.cmp(i)>=0)continue;return s.iadd(t),s}}static of(e,t){return new K().of(e,t)}static fromNumber(e,t){return new K().fromNumber(e,t)}static fromDouble(e,t){return new K().fromDouble(e,t)}static fromBigInt(e,t){return new K().fromBigInt(e,t)}static fromBool(e){return new K().fromBool(e)}static fromString(e,t,r){return new K().fromString(e,t,r)}static fromJSON(e){return new K().fromJSON(e)}static fromBN(e){return new K().fromBN(e)}static fromArray(e,t){return new K().fromArray(e,t)}static fromBuffer(e,t){return new K().fromBuffer(e,t)}static fromArrayLike(e,t){return new K().fromArrayLike(e,t)}static decode(e,t){return new K().decode(e,t)}static from(e,t,r){return new K().from(e,t,r)}static cast(e,t,r){return K.isBN(e)?e:new K(e,t,r)}static isBN(e){return e instanceof K}}K.BN=K,K.wordSize=26,K.native=0;class Cs{constructor(e,t){this.name=e,this.p=new K(t,16),this.n=this.p.bitLength(),this.k=K.shift(1,this.n).isub(this.p),this.lo=this.p.clone(),this.one=this.p.clone()}ireduce(e){const t=e.negative!==0;let r=e.bitLength();for(Rt(r<=this.n*2),e.negative=0;r>this.n;)this.split(e,this.lo),this.imulK(e),e._iadd(e,this.lo),r=e.bitLength();const i=r<this.n?-1:e.ucmp(this.p);return i===0?(e.words[0]=0,e.length=1):i>0&&e._isub(e,this.p),t&&!e.isZero()&&e._isub(this.p,e),e}split(e,t){e._split(this.n,t)}imulK(e){return e.imul(this.k)}}class JR extends Cs{constructor(){super("p192","ffffffff ffffffff ffffffff fffffffeffffffff ffffffff")}imulK(e){const t=this.one.inject(e);return e.iushln(64)._iadd(e,t)}}class QR extends Cs{constructor(){super("p224","ffffffff ffffffff ffffffff ffffffff00000000 00000000 00000001")}imulK(e){const t=this.one.inject(e);return e.iushln(96)._isub(e,t)}}class eM extends Cs{constructor(){super("p521","000001ff ffffffff ffffffff ffffffffffffffff ffffffff ffffffff ffffffffffffffff ffffffff ffffffff ffffffffffffffff ffffffff ffffffff ffffffffffffffff")}imulK(e){return e}}class tM extends Cs{constructor(){super("k256","ffffffff ffffffff ffffffff ffffffffffffffff ffffffff fffffffe fffffc2f")}split(e,t){const r=4194303,i=Math.min(e.length,9);t._alloc(i+1);for(let a=0;a<i;a++)t.words[a]=e.words[a];if(t.length=i,e.length<=9){t._strip(),e.words[0]=0,e.length=1;return}let n=e.words[9],s=10;for(t.words[t.length++]=n&r,t._strip();s<e.length;s++){const a=e.words[s]|0;e.words[s-10]=(a&r)<<4|n>>>22,n=a}n>>>=22,e.words[s-10]=n,n===0&&e.length>10?e.length-=10:e.length-=9,e._strip()}imulK(e){e._expand(e.length+2);let t=0;for(let r=0;r<e.length;r++){const i=e.words[r];t+=i*977,e.words[r]=t&67108863,t=i*64+Math.floor(t/67108864)}return e.words[e.length-1]===0&&(e.length-=1,e.words[e.length-1]===0&&(e.length-=1)),e}}class rM extends Cs{constructor(){super("p251","07ffffff ffffffff ffffffff ffffffffffffffff ffffffff ffffffff fffffff7")}imulK(e){if(e.isZero())return e;let t=0;for(let r=0;r<e.length;r++){const i=e.words[r]*9+t;t=i>>>26,e.words[r]=i&67108863}return t!==0&&(e._alloc(e.length+1),e.words[e.length++]=t),e}}class iM extends Cs{constructor(){super("p25519","7fffffff ffffffff ffffffff ffffffffffffffff ffffffff ffffffff ffffffed")}imulK(e){let t=0;for(let r=0;r<e.length;r++){const i=e.words[r]*19+t;t=i>>>26,e.words[r]=i&67108863}return t!==0&&(e._alloc(e.length+1),e.words[e.length++]=t),e}}class nM extends Cs{constructor(){super("p448","ffffffff ffffffff ffffffff ffffffffffffffff ffffffff fffffffe ffffffffffffffff ffffffff ffffffff ffffffffffffffff ffffffff")}imulK(e){const t=this.one.inject(e);return e.iushln(224)._iadd(e,t)}}class Aa{constructor(e){let t=null;typeof e=="string"&&(t=K._prime(e),e=t.p),J(K.isBN(e),"m","bignum"),Rs(!e.red,"reduction"),qi(e.sign()>0,"reduction"),this.m=e,this.prime=t,this.mb=null,this.sm1=null}_verify1(e){qi(e.negative===0,"red"),Ie(e.red!=null,"red")}_verify2(e,t){qi((e.negative|t.negative)===0,"red"),Ie(e.red!=null&&e.red===t.red,"red")}get mont(){return!1}precompute(){if(this.sm1===null&&this.m.andln(7)===5){const e=new K(2).toRed(this),t=this.m.subn(1).iushrn(2);this.sm1=this.pow(e,t)}return this}convertTo(e){const t=e.mod(this.m);return t.red=this,t}convertFrom(e){const t=e.clone();return t.red=null,t}intTo(e){return e}intFrom(e){return e}imod(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.imod(this.m)._forceRed(this)}iadd(e,t){return this._verify2(e,t),e._iadd(e,t),e.ucmp(this.m)>=0&&e._isub(e,this.m),e}add(e,t){return e.length<t.length?this.iadd(t.clone(),e):this.iadd(e.clone(),t)}iaddn(e,t){return this._verify1(e),t<0?this.isubn(e,-t):(this.m.length===1&&(t%=this.m.words[0]),e._iaddn(t),e.ucmp(this.m)>=0&&e._isub(e,this.m),e)}addn(e,t){return this.iaddn(e.clone(),t)}isub(e,t){this._verify2(e,t);const r=e.ucmp(t);return r===0?(e.words[0]=0,e.length=1,e):(r<0?(e._isub(t,e),e._isub(this.m,e)):e._isub(e,t),e)}sub(e,t){return this.isub(e.clone(),t)}isubn(e,t){return this._verify1(e),t<0?this.iaddn(e,-t):(this.m.length===1&&(t%=this.m.words[0]),e.length===1&&e.words[0]<t?(e.words[0]=t-e.words[0],e._isub(this.m,e)):e._isubn(t),e)}subn(e,t){return this.isubn(e.clone(),t)}imul(e,t){return this._verify2(e,t),this.imod(e.imul(t))}mul(e,t){return this._verify2(e,t),this.imod(e.mul(t))}imuln(e,t){if(this._verify1(e),e.isZero())return e;if(t===0)return e.words[0]=0,e.length=1,e;const r=t<0;if(r&&(t=-t),this.m.length===1&&(t%=this.m.words[0]),e.imuln(t),t<=16)for(;e.ucmp(this.m)>=0;)e._isub(e,this.m);else this.imod(e);return r&&this.ineg(e),e}muln(e,t){return this.imuln(e.clone(),t)}idiv(e,t){return this.div(e,t)._move(e)}div(e,t){return this.mul(e,this.invert(t))}idivn(e,t){return this.divn(e,t)._move(e)}divn(e,t){return this.div(e,this.convertTo(new K(t)))}ipow(e,t){return this.pow(e,t)._move(e)}pow(e,t){return this._verify1(e),t.isNeg()&&(e=this.invert(e)),t.length===1?this.pown(e,t.words[0]):Ts&&!this.prime?this.powInt(e,t):this.powNum(e,t)}powNum(e,t){const r=new Array(Kn);r[0]=this.sqrn(e,Ei-1);for(let s=1;s<Kn;s++)r[s]=this.mul(r[s-1],e);let i=t.bitLength(),n=new K(1).toRed(this);for(;i>=Ei;){const s=i-Ei,a=t.bits(s,Ei);if(a<Kn){n=this.sqr(n),i-=1;continue}n=this.sqrn(n,Ei),n=this.mul(n,r[a&~Kn]),i=s}if(i>0){const s=t.bits(0,i);for(;i--;)n=this.sqr(n),s>>i&1&&(n=this.mul(n,e))}return n}powInt(e,t){this.mb===null&&(this.mb=this.m.toBigInt());const r=this.intFrom(e.toBigInt()),i=cM(r,t,this.mb),n=this.intTo(i);return K.fromBigInt(n)._forceRed(this)}sqrn(e,t){for(let r=0;r<t;r++)e=this.sqr(e);return e}ipown(e,t){return this.pown(e,t)._move(e)}pown(e,t){if(this._verify1(e),t<0&&(e=this.invert(e),t=-t),t===0)return new K(1).toRed(this);if(t===1)return e.clone();const r=Ta(t);let i=e;for(let n=r-2;n>=0;n--)i=this.sqr(i),t>>n&1&&(i=this.mul(i,e));return i}isqr(e){return this.imul(e,e)}sqr(e){return this.mul(e,e)}isqrt(e){return this.sqrt(e)._move(e)}sqrt(e){return this._verify1(e),this.m.andln(3)===3?this.sqrt3mod4(e):this.m.andln(7)===5?this.sm1!=null?this.sqrt5mod8sm1(e):this.sqrt5mod8(e):this.sqrt0(e)}sqrt3mod4(e){const t=this.m.addn(1).iushrn(2),r=this.pow(e,t);if(!this.sqr(r).eq(e))throw new Error("X is not a square mod P.");return r}sqrt5mod8(e){const t=new K(1).toRed(this),r=this.m.ushrn(3),i=this.add(e,e),n=this.pow(i,r),s=this.mul(i,this.sqr(n)),a=this.mul(this.mul(n,e),this.isub(s,t));if(!this.sqr(a).eq(e))throw new Error("X is not a square mod P.");return a}sqrt5mod8sm1(e){const t=this.m.addn(3).iushrn(3),r=this.pow(e,t);if(this.sqr(r).eq(e))return r;const i=this.mul(r,this.sm1);if(this.sqr(i).eq(e))return i;throw new Error("X is not a square mod P.")}sqrt0(e){if(this.m.cmpn(1)===0||!this.m.isOdd())throw new Error("Invalid prime.");switch(this.jacobi(e)){case-1:throw new Error("X is not a square mod P.");case 0:return new K(0)._forceRed(this)}const t=new K(1).toRed(this),r=this.m.subn(1),i=r._makeOdd(),n=new K(2).toRed(this);for(;this.jacobi(n)!==-1;)this.iadd(n,t);let s=this.pow(e,r),a=this.pow(n,r),c=this.pow(e,r.iaddn(1).iushrn(1)),o=i;for(;;){let d=s,l=0;for(;d.cmp(t)!==0&&l<o;)d=this.sqr(d),l+=1;if(l===0)break;Rt(l<o),d=this.sqrn(a,o-l-1),a=this.sqr(d),c=this.mul(c,d),s=this.mul(s,a),o=l}return c}idivsqrt(e,t){return this.divsqrt(e,t)._move(e)}divsqrt(e,t){if(this._verify2(e,t),t.isZero())throw new RangeError("Not invertible.");return this.m.andln(3)===3?this.divsqrt3mod4(e,t):this.sm1!=null&&this.m.andln(7)===5?this.divsqrt5mod8(e,t):this.sqrt(this.div(e,t))}divsqrt3mod4(e,t){const r=this.m.subn(3).iushrn(2),i=this.sqr(e),n=this.mul(i,e),s=this.mul(n,i),a=this.mul(this.sqr(t),t),c=this.pow(this.mul(s,a),r),o=this.mul(this.mul(n,t),c),d=this.mul(t,this.sqr(o));if(d.cmp(e)===0)return o;throw new Error("X is not a square mod P.")}divsqrt5mod8(e,t){const r=this.m.subn(5).iushrn(3),i=this.mul(this.sqr(t),t),n=this.mul(this.sqr(i),t),s=this.pow(this.mul(e,n),r),a=this.mul(this.mul(e,i),s),c=this.mul(t,this.sqr(a));if(c.cmp(e)===0)return a;if(this.ineg(c).cmp(e)===0)return this.mul(a,this.sm1);throw new Error("X is not a square mod P.")}isSquare(e){let t;return this.prime?t=this.legendre(e):this.m.isOdd()?t=this.jacobi(e):t=this.kronecker(e),Boolean(~t>>>31)}ishl(e,t){return this._verify1(e),this.imod(e.iushl(t))}shl(e,t){return this.ishl(e.clone(),t)}ishln(e,t){if(this._verify1(e),e.iushln(t),t<=4)for(;e.ucmp(this.m)>=0;)e._isub(e,this.m);else this.imod(e);return e}shln(e,t){return this.ishln(e.clone(),t)}ineg(e){return this._verify1(e),e.isZero()||e._isub(this.m,e),e}neg(e){return this.ineg(e.clone())}eq(e,t){return this._verify2(e,t),e.ucmp(t)===0}eqn(e,t){if(this._verify1(e),this.m.length===1)return t%=this.m.words[0],t<0&&(t+=this.m.words[0]),e.ucmpn(t)===0;if(t<0){this.m._isubn(-t);const r=e.ucmp(this.m);return this.m._iaddn(-t),r===0}return e.ucmpn(t)===0}isHigh(e){return!this.isLow(e)}isLow(e){return this._verify1(e),e.ucmp(this.m.ushrn(1))<=0}isOdd(e){return this._verify1(e),e.isOdd()}isEven(e){return this._verify1(e),e.isEven()}legendre(e){if(this._verify1(e),this.m.isEven())throw new Error("legendre: `num` must be odd.");const t=this.m.subn(1).iushrn(1),r=this.pow(e,t),i=new K(1).toRed(this),n=r.czero(),s=r.ceq(i),a=r.ceq(this.ineg(i));if((n|s|a)===0)throw new Error("Invalid prime.");return Rt(n+s+a===1),s-a}jacobi(e){return this._verify1(e),e.jacobi(this.m)}kronecker(e){return this._verify1(e),e.kronecker(this.m)}iinvert(e){return this.invert(e)._move(e)}invert(e){return this._verify1(e),e.invert(this.m)._forceRed(this)}ifermat(e){return this.fermat(e)._move(e)}fermat(e){if(this._verify1(e),e.isZero()||this.m.cmpn(1)===0)throw new RangeError("Not invertible.");return this.pow(e,this.m.subn(2))}[Hg](){return this.prime?`<Red: ${this.prime.name}>`:`<Red: ${this.m.toString(10)}>`}}class sM extends Aa{constructor(e){super(e);this.prime=null,this.n=this.m.bitLength(),this.n%26!==0&&(this.n+=26-this.n%26),this.k=this.n*2,this.w=this.k/26,this.b=K.shift(1,this.k).div(this.m)}convertTo(e){return e.length>this.w?super.convertTo(e):this.imod(e.clone())}_shift(e){let t=0,r=this.w;for(;r<e.length;)e.words[t++]=e.words[r++];t===0&&(e.words[t++]=0),e.length=t}imod(e){const t=e.negative;Rt(e.length<=this.w),e.negative=0;const r=e.mul(this.b);return this._shift(r),e._isub(e,r.mul(this.m)),e.ucmp(this.m)>=0&&e._isub(e,this.m),t&&!e.isZero()&&e._isub(this.m,e),e.red=this,e}}class aM extends Aa{constructor(e){super(e);this.prime=null,this.n=this.m.length*26,this.r=K.shift(1,this.n),this.r2=K.shift(1,this.n*2).imod(this.m),this.ri=this.r.invert(this.m),this.mi=this.r.mul(this.ri).isubn(1).div(this.m),this.rib=null}get mont(){return!0}convertTo(e){return e.isNeg()||e.ucmp(this.m)>=0?this.imod(e.ushln(this.n)):this.mul(e,this.r2)}convertFrom(e){const t=this.mul(e,new K(1));return t.red=null,t}intTo(e){return(e<<BigInt(this.n))%this.mb}intFrom(e){return this.rib===null&&(this.rib=this.ri.toBigInt()),e*this.rib%this.mb}iaddn(e,t){return this.iadd(e,this.convertTo(new K(t)))}isubn(e,t){return this.isub(e,this.convertTo(new K(t)))}imul(e,t){return this.mul(e,t)._move(e)}mul(e,t){if(e.isZero()||t.isZero())return new K(0)._forceRed(this);const r=e.mul(t),i=r.umaskn(this.n).mul(this.mi).iumaskn(this.n),n=r.iadd(i.mul(this.m)).iushrn(this.n);return n.ucmp(this.m)>=0&&n._isub(n,this.m),n._forceRed(this)}imuln(e,t){if(this._verify1(e),e.isZero())return e;if(t===0)return e.words[0]=0,e.length=1,e;const r=t<0;r&&(t=-t),this.m.length===1&&(t%=this.m.words[0]);const i=Ta(t);if(i>5)this.imul(e,this.convertTo(new K(t)));else if((t&t-1)===0)for(let n=0;n<i-1;n++)this.iadd(e,e);else{const n=e.clone();for(let s=i-2;s>=0;s--)this.iadd(e,e),t>>s&1&&this.iadd(e,n)}return r&&this.ineg(e),e}eqn(e,t){return this._verify1(e),t===0?e.isZero():e.ucmp(this.convertTo(new K(t)))===0}isLow(e){return this._verify1(e),this.convertFrom(e).ucmp(this.m.ushrn(1))<=0}isOdd(e){return this._verify1(e),this.convertFrom(e).isOdd()}isEven(e){return this._verify1(e),this.convertFrom(e).isEven()}invert(e){return this._verify1(e),this.imod(e.invert(this.m).mul(this.r2))}}function Ia(e,t,r){const i=new e(t);return e.captureStackTrace&&e.captureStackTrace(i,r),i}function Rt(e,t){if(!e){const r=t||"Assertion failed.";throw Ia(Error,r,Rt)}}function J(e,t,r){if(!e){const i=`"${t}" must be a(n) ${r}.`;throw Ia(TypeError,i,J)}}function qi(e,t){if(!e){const r=`"${t}" only works with positive numbers.`;throw Ia(RangeError,r,qi)}}function Ie(e,t){if(!e){const r=`"${t}" only works with red numbers.`;throw Ia(TypeError,r,Ie)}}function Rs(e,t){if(!e){const r=`"${t}" only works with normal numbers.`;throw Ia(TypeError,r,Rs)}}function bd(e){if(!e){const t="Cannot divide by zero.";throw Ia(RangeError,t,bd)}}function Gg(e){return Number.isSafeInteger(e)}function dt(e){return Gg(e)&&e>=-67108863&&e<=67108863}function oM(e,t){return e.allocUnsafeSlow?e.allocUnsafeSlow(t):new e(t)}function Xg(e){if(e==null)return 10;if(typeof e=="number")return e;switch(e){case"bin":return 2;case"oct":return 8;case"dec":return 10;case"hex":return 16}return 0}function Ta(e){if(Math.clz32)return 32-Math.clz32(e);let t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t}function Kg(e){if(e===0)return 26;let t=e,r=0;return(t&8191)===0&&(r+=13,t>>>=13),(t&127)===0&&(r+=7,t>>>=7),(t&15)===0&&(r+=4,t>>>=4),(t&3)===0&&(r+=2,t>>>=2),(t&1)===0&&(r+=1),r}function Wg(e,t,r){const i=Math.min(e.length,r);let n=0,s=0;for(let a=t;a<i;a++){const c=e.charCodeAt(a)-48;n<<=4;let o;c>=49&&c<=54?o=c-49+10:c>=17&&c<=22?o=c-17+10:o=c,n|=o,s|=o}if(s&~15)throw new Error("Invalid string.");return n}function Yg(e,t,r,i){const n=Math.min(e.length,r);let s=0;for(let a=t;a<n;a++){const c=e.charCodeAt(a)-48;s*=i;let o;if(c>=49?o=c-49+10:c>=17?o=c-17+10:o=c,c<0||c>207||o>=i)throw new Error("Invalid string.");s+=o}return s}function cM(e,t,r){const i=new Array(Kn);i[0]=Zg(e,Ei-1,r);for(let a=1;a<Kn;a++)i[a]=i[a-1]*e%r;let n=t.bitLength(),s=BigInt(1);for(;n>=Ei;){const a=n-Ei,c=t.bits(a,Ei);if(c<Kn){s=s*s%r,n-=1;continue}s=Zg(s,Ei,r),s=s*i[c&~Kn]%r,n=a}if(n>0){const a=t.bits(0,n);for(;n--;)s=s*s%r,a>>n&1&&(s=s*e%r)}return s}function Zg(e,t,r){for(let i=0;i<t;i++)e=e*e%r;return e}function Jg(e,t,r){const i=e.length+t.length;r.negative=e.negative^t.negative,r._alloc(i),r.length=i;const n=e.words[0],s=t.words[0],a=n*s,c=a&67108863;let o=a/67108864|0,d=1;for(r.words[0]=c;d<r.length-1;d++){let l=o>>>26,u=o&67108863;const p=Math.max(0,d-e.length+1),f=Math.min(d,t.length-1);for(let g=p;g<=f;g++){const v=d-g,S=e.words[v],C=t.words[g],D=S*C+u;l+=D/67108864|0,u=D&67108863}r.words[d]=u|0,o=l|0}return o!==0?r.words[d]=o|0:r.length-=1,r._strip()}function Qg(e,t,r){const i=e.length+t.length;r.negative=e.negative^t.negative,r._alloc(i),r.length=i;let n=0,s=0,a=0;for(;a<r.length-1;a++){let c=s;s=0;let o=n&67108863;const d=Math.max(0,a-e.length+1),l=Math.min(a,t.length-1);for(let u=d;u<=l;u++){const p=a-u,f=e.words[p],g=t.words[u],v=f*g;let S=v&67108863;c=c+(v/67108864|0)|0,S=S+o|0,o=S&67108863,c=c+(S>>>26)|0,s+=c>>>26,c&=67108863}r.words[a]=o,n=c,c=s}return n!==0?r.words[a]=n:r.length-=1,r._strip()}function dM(e,t,r){if(!Ts||e.length+t.length>82595519)return Qg(e,t,r);const i=BigInt(0),n=BigInt(67108863),s=BigInt(26);let a=e.toBigInt()*t.toBigInt();const c=a<i|0;c&&(a=-a);let o=0;for(;a>i;)r.words[o++]=Number(a&n),a>>=s;return o===0&&(r.words[o++]=0),r.length=o,r.negative=c,r}function eb(e,t,r){const i=e.words,n=t.words,s=r.words,a=i[0]|0,c=a&8191,o=a>>>13,d=i[1]|0,l=d&8191,u=d>>>13,p=i[2]|0,f=p&8191,g=p>>>13,v=i[3]|0,S=v&8191,C=v>>>13,D=i[4]|0,j=D&8191,m=D>>>13,w=i[5]|0,R=w&8191,h=w>>>13,b=i[6]|0,A=b&8191,y=b>>>13,P=i[7]|0,N=P&8191,B=P>>>13,L=i[8]|0,F=L&8191,z=L>>>13,X=i[9]|0,Z=X&8191,re=X>>>13,ue=n[0]|0,ge=ue&8191,ye=ue>>>13,ve=n[1]|0,ce=ve&8191,we=ve>>>13,nt=n[2]|0,Ge=nt&8191,ze=nt>>>13,jt=n[3]|0,Oe=jt&8191,$e=jt>>>13,Mt=n[4]|0,Ne=Mt&8191,de=Mt>>>13,yn=n[5]|0,lt=yn&8191,bt=yn>>>13,br=n[6]|0,ut=br&8191,et=br>>>13,Ci=n[7]|0,tt=Ci&8191,Ue=Ci>>>13,Ri=n[8]|0,ft=Ri&8191,yt=Ri>>>13,vn=n[9]|0,st=vn&8191,ht=vn>>>13;let Te=0,U,_,q;r.negative=e.negative^t.negative,r._alloc(20),r.length=19,U=Math.imul(c,ge),_=Math.imul(c,ye),_=_+Math.imul(o,ge)|0,q=Math.imul(o,ye);let ai=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(ai>>>26)|0,ai&=67108863,U=Math.imul(l,ge),_=Math.imul(l,ye),_=_+Math.imul(u,ge)|0,q=Math.imul(u,ye),U=U+Math.imul(c,ce)|0,_=_+Math.imul(c,we)|0,_=_+Math.imul(o,ce)|0,q=q+Math.imul(o,we)|0;let Hi=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(Hi>>>26)|0,Hi&=67108863,U=Math.imul(f,ge),_=Math.imul(f,ye),_=_+Math.imul(g,ge)|0,q=Math.imul(g,ye),U=U+Math.imul(l,ce)|0,_=_+Math.imul(l,we)|0,_=_+Math.imul(u,ce)|0,q=q+Math.imul(u,we)|0,U=U+Math.imul(c,Ge)|0,_=_+Math.imul(c,ze)|0,_=_+Math.imul(o,Ge)|0,q=q+Math.imul(o,ze)|0;let sr=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(sr>>>26)|0,sr&=67108863,U=Math.imul(S,ge),_=Math.imul(S,ye),_=_+Math.imul(C,ge)|0,q=Math.imul(C,ye),U=U+Math.imul(f,ce)|0,_=_+Math.imul(f,we)|0,_=_+Math.imul(g,ce)|0,q=q+Math.imul(g,we)|0,U=U+Math.imul(l,Ge)|0,_=_+Math.imul(l,ze)|0,_=_+Math.imul(u,Ge)|0,q=q+Math.imul(u,ze)|0,U=U+Math.imul(c,Oe)|0,_=_+Math.imul(c,$e)|0,_=_+Math.imul(o,Oe)|0,q=q+Math.imul(o,$e)|0;let yr=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(yr>>>26)|0,yr&=67108863,U=Math.imul(j,ge),_=Math.imul(j,ye),_=_+Math.imul(m,ge)|0,q=Math.imul(m,ye),U=U+Math.imul(S,ce)|0,_=_+Math.imul(S,we)|0,_=_+Math.imul(C,ce)|0,q=q+Math.imul(C,we)|0,U=U+Math.imul(f,Ge)|0,_=_+Math.imul(f,ze)|0,_=_+Math.imul(g,Ge)|0,q=q+Math.imul(g,ze)|0,U=U+Math.imul(l,Oe)|0,_=_+Math.imul(l,$e)|0,_=_+Math.imul(u,Oe)|0,q=q+Math.imul(u,$e)|0,U=U+Math.imul(c,Ne)|0,_=_+Math.imul(c,de)|0,_=_+Math.imul(o,Ne)|0,q=q+Math.imul(o,de)|0;let Gr=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(Gr>>>26)|0,Gr&=67108863,U=Math.imul(R,ge),_=Math.imul(R,ye),_=_+Math.imul(h,ge)|0,q=Math.imul(h,ye),U=U+Math.imul(j,ce)|0,_=_+Math.imul(j,we)|0,_=_+Math.imul(m,ce)|0,q=q+Math.imul(m,we)|0,U=U+Math.imul(S,Ge)|0,_=_+Math.imul(S,ze)|0,_=_+Math.imul(C,Ge)|0,q=q+Math.imul(C,ze)|0,U=U+Math.imul(f,Oe)|0,_=_+Math.imul(f,$e)|0,_=_+Math.imul(g,Oe)|0,q=q+Math.imul(g,$e)|0,U=U+Math.imul(l,Ne)|0,_=_+Math.imul(l,de)|0,_=_+Math.imul(u,Ne)|0,q=q+Math.imul(u,de)|0,U=U+Math.imul(c,lt)|0,_=_+Math.imul(c,bt)|0,_=_+Math.imul(o,lt)|0,q=q+Math.imul(o,bt)|0;let oi=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(oi>>>26)|0,oi&=67108863,U=Math.imul(A,ge),_=Math.imul(A,ye),_=_+Math.imul(y,ge)|0,q=Math.imul(y,ye),U=U+Math.imul(R,ce)|0,_=_+Math.imul(R,we)|0,_=_+Math.imul(h,ce)|0,q=q+Math.imul(h,we)|0,U=U+Math.imul(j,Ge)|0,_=_+Math.imul(j,ze)|0,_=_+Math.imul(m,Ge)|0,q=q+Math.imul(m,ze)|0,U=U+Math.imul(S,Oe)|0,_=_+Math.imul(S,$e)|0,_=_+Math.imul(C,Oe)|0,q=q+Math.imul(C,$e)|0,U=U+Math.imul(f,Ne)|0,_=_+Math.imul(f,de)|0,_=_+Math.imul(g,Ne)|0,q=q+Math.imul(g,de)|0,U=U+Math.imul(l,lt)|0,_=_+Math.imul(l,bt)|0,_=_+Math.imul(u,lt)|0,q=q+Math.imul(u,bt)|0,U=U+Math.imul(c,ut)|0,_=_+Math.imul(c,et)|0,_=_+Math.imul(o,ut)|0,q=q+Math.imul(o,et)|0;let Mi=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(Mi>>>26)|0,Mi&=67108863,U=Math.imul(N,ge),_=Math.imul(N,ye),_=_+Math.imul(B,ge)|0,q=Math.imul(B,ye),U=U+Math.imul(A,ce)|0,_=_+Math.imul(A,we)|0,_=_+Math.imul(y,ce)|0,q=q+Math.imul(y,we)|0,U=U+Math.imul(R,Ge)|0,_=_+Math.imul(R,ze)|0,_=_+Math.imul(h,Ge)|0,q=q+Math.imul(h,ze)|0,U=U+Math.imul(j,Oe)|0,_=_+Math.imul(j,$e)|0,_=_+Math.imul(m,Oe)|0,q=q+Math.imul(m,$e)|0,U=U+Math.imul(S,Ne)|0,_=_+Math.imul(S,de)|0,_=_+Math.imul(C,Ne)|0,q=q+Math.imul(C,de)|0,U=U+Math.imul(f,lt)|0,_=_+Math.imul(f,bt)|0,_=_+Math.imul(g,lt)|0,q=q+Math.imul(g,bt)|0,U=U+Math.imul(l,ut)|0,_=_+Math.imul(l,et)|0,_=_+Math.imul(u,ut)|0,q=q+Math.imul(u,et)|0,U=U+Math.imul(c,tt)|0,_=_+Math.imul(c,Ue)|0,_=_+Math.imul(o,tt)|0,q=q+Math.imul(o,Ue)|0;let Vt=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(Vt>>>26)|0,Vt&=67108863,U=Math.imul(F,ge),_=Math.imul(F,ye),_=_+Math.imul(z,ge)|0,q=Math.imul(z,ye),U=U+Math.imul(N,ce)|0,_=_+Math.imul(N,we)|0,_=_+Math.imul(B,ce)|0,q=q+Math.imul(B,we)|0,U=U+Math.imul(A,Ge)|0,_=_+Math.imul(A,ze)|0,_=_+Math.imul(y,Ge)|0,q=q+Math.imul(y,ze)|0,U=U+Math.imul(R,Oe)|0,_=_+Math.imul(R,$e)|0,_=_+Math.imul(h,Oe)|0,q=q+Math.imul(h,$e)|0,U=U+Math.imul(j,Ne)|0,_=_+Math.imul(j,de)|0,_=_+Math.imul(m,Ne)|0,q=q+Math.imul(m,de)|0,U=U+Math.imul(S,lt)|0,_=_+Math.imul(S,bt)|0,_=_+Math.imul(C,lt)|0,q=q+Math.imul(C,bt)|0,U=U+Math.imul(f,ut)|0,_=_+Math.imul(f,et)|0,_=_+Math.imul(g,ut)|0,q=q+Math.imul(g,et)|0,U=U+Math.imul(l,tt)|0,_=_+Math.imul(l,Ue)|0,_=_+Math.imul(u,tt)|0,q=q+Math.imul(u,Ue)|0,U=U+Math.imul(c,ft)|0,_=_+Math.imul(c,yt)|0,_=_+Math.imul(o,ft)|0,q=q+Math.imul(o,yt)|0;let Gt=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(Gt>>>26)|0,Gt&=67108863,U=Math.imul(Z,ge),_=Math.imul(Z,ye),_=_+Math.imul(re,ge)|0,q=Math.imul(re,ye),U=U+Math.imul(F,ce)|0,_=_+Math.imul(F,we)|0,_=_+Math.imul(z,ce)|0,q=q+Math.imul(z,we)|0,U=U+Math.imul(N,Ge)|0,_=_+Math.imul(N,ze)|0,_=_+Math.imul(B,Ge)|0,q=q+Math.imul(B,ze)|0,U=U+Math.imul(A,Oe)|0,_=_+Math.imul(A,$e)|0,_=_+Math.imul(y,Oe)|0,q=q+Math.imul(y,$e)|0,U=U+Math.imul(R,Ne)|0,_=_+Math.imul(R,de)|0,_=_+Math.imul(h,Ne)|0,q=q+Math.imul(h,de)|0,U=U+Math.imul(j,lt)|0,_=_+Math.imul(j,bt)|0,_=_+Math.imul(m,lt)|0,q=q+Math.imul(m,bt)|0,U=U+Math.imul(S,ut)|0,_=_+Math.imul(S,et)|0,_=_+Math.imul(C,ut)|0,q=q+Math.imul(C,et)|0,U=U+Math.imul(f,tt)|0,_=_+Math.imul(f,Ue)|0,_=_+Math.imul(g,tt)|0,q=q+Math.imul(g,Ue)|0,U=U+Math.imul(l,ft)|0,_=_+Math.imul(l,yt)|0,_=_+Math.imul(u,ft)|0,q=q+Math.imul(u,yt)|0,U=U+Math.imul(c,st)|0,_=_+Math.imul(c,ht)|0,_=_+Math.imul(o,st)|0,q=q+Math.imul(o,ht)|0;let Vi=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(Vi>>>26)|0,Vi&=67108863,U=Math.imul(Z,ce),_=Math.imul(Z,we),_=_+Math.imul(re,ce)|0,q=Math.imul(re,we),U=U+Math.imul(F,Ge)|0,_=_+Math.imul(F,ze)|0,_=_+Math.imul(z,Ge)|0,q=q+Math.imul(z,ze)|0,U=U+Math.imul(N,Oe)|0,_=_+Math.imul(N,$e)|0,_=_+Math.imul(B,Oe)|0,q=q+Math.imul(B,$e)|0,U=U+Math.imul(A,Ne)|0,_=_+Math.imul(A,de)|0,_=_+Math.imul(y,Ne)|0,q=q+Math.imul(y,de)|0,U=U+Math.imul(R,lt)|0,_=_+Math.imul(R,bt)|0,_=_+Math.imul(h,lt)|0,q=q+Math.imul(h,bt)|0,U=U+Math.imul(j,ut)|0,_=_+Math.imul(j,et)|0,_=_+Math.imul(m,ut)|0,q=q+Math.imul(m,et)|0,U=U+Math.imul(S,tt)|0,_=_+Math.imul(S,Ue)|0,_=_+Math.imul(C,tt)|0,q=q+Math.imul(C,Ue)|0,U=U+Math.imul(f,ft)|0,_=_+Math.imul(f,yt)|0,_=_+Math.imul(g,ft)|0,q=q+Math.imul(g,yt)|0,U=U+Math.imul(l,st)|0,_=_+Math.imul(l,ht)|0,_=_+Math.imul(u,st)|0,q=q+Math.imul(u,ht)|0;let ar=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(ar>>>26)|0,ar&=67108863,U=Math.imul(Z,Ge),_=Math.imul(Z,ze),_=_+Math.imul(re,Ge)|0,q=Math.imul(re,ze),U=U+Math.imul(F,Oe)|0,_=_+Math.imul(F,$e)|0,_=_+Math.imul(z,Oe)|0,q=q+Math.imul(z,$e)|0,U=U+Math.imul(N,Ne)|0,_=_+Math.imul(N,de)|0,_=_+Math.imul(B,Ne)|0,q=q+Math.imul(B,de)|0,U=U+Math.imul(A,lt)|0,_=_+Math.imul(A,bt)|0,_=_+Math.imul(y,lt)|0,q=q+Math.imul(y,bt)|0,U=U+Math.imul(R,ut)|0,_=_+Math.imul(R,et)|0,_=_+Math.imul(h,ut)|0,q=q+Math.imul(h,et)|0,U=U+Math.imul(j,tt)|0,_=_+Math.imul(j,Ue)|0,_=_+Math.imul(m,tt)|0,q=q+Math.imul(m,Ue)|0,U=U+Math.imul(S,ft)|0,_=_+Math.imul(S,yt)|0,_=_+Math.imul(C,ft)|0,q=q+Math.imul(C,yt)|0,U=U+Math.imul(f,st)|0,_=_+Math.imul(f,ht)|0,_=_+Math.imul(g,st)|0,q=q+Math.imul(g,ht)|0;let ki=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(ki>>>26)|0,ki&=67108863,U=Math.imul(Z,Oe),_=Math.imul(Z,$e),_=_+Math.imul(re,Oe)|0,q=Math.imul(re,$e),U=U+Math.imul(F,Ne)|0,_=_+Math.imul(F,de)|0,_=_+Math.imul(z,Ne)|0,q=q+Math.imul(z,de)|0,U=U+Math.imul(N,lt)|0,_=_+Math.imul(N,bt)|0,_=_+Math.imul(B,lt)|0,q=q+Math.imul(B,bt)|0,U=U+Math.imul(A,ut)|0,_=_+Math.imul(A,et)|0,_=_+Math.imul(y,ut)|0,q=q+Math.imul(y,et)|0,U=U+Math.imul(R,tt)|0,_=_+Math.imul(R,Ue)|0,_=_+Math.imul(h,tt)|0,q=q+Math.imul(h,Ue)|0,U=U+Math.imul(j,ft)|0,_=_+Math.imul(j,yt)|0,_=_+Math.imul(m,ft)|0,q=q+Math.imul(m,yt)|0,U=U+Math.imul(S,st)|0,_=_+Math.imul(S,ht)|0,_=_+Math.imul(C,st)|0,q=q+Math.imul(C,ht)|0;let Gi=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(Gi>>>26)|0,Gi&=67108863,U=Math.imul(Z,Ne),_=Math.imul(Z,de),_=_+Math.imul(re,Ne)|0,q=Math.imul(re,de),U=U+Math.imul(F,lt)|0,_=_+Math.imul(F,bt)|0,_=_+Math.imul(z,lt)|0,q=q+Math.imul(z,bt)|0,U=U+Math.imul(N,ut)|0,_=_+Math.imul(N,et)|0,_=_+Math.imul(B,ut)|0,q=q+Math.imul(B,et)|0,U=U+Math.imul(A,tt)|0,_=_+Math.imul(A,Ue)|0,_=_+Math.imul(y,tt)|0,q=q+Math.imul(y,Ue)|0,U=U+Math.imul(R,ft)|0,_=_+Math.imul(R,yt)|0,_=_+Math.imul(h,ft)|0,q=q+Math.imul(h,yt)|0,U=U+Math.imul(j,st)|0,_=_+Math.imul(j,ht)|0,_=_+Math.imul(m,st)|0,q=q+Math.imul(m,ht)|0;let Xi=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(Xi>>>26)|0,Xi&=67108863,U=Math.imul(Z,lt),_=Math.imul(Z,bt),_=_+Math.imul(re,lt)|0,q=Math.imul(re,bt),U=U+Math.imul(F,ut)|0,_=_+Math.imul(F,et)|0,_=_+Math.imul(z,ut)|0,q=q+Math.imul(z,et)|0,U=U+Math.imul(N,tt)|0,_=_+Math.imul(N,Ue)|0,_=_+Math.imul(B,tt)|0,q=q+Math.imul(B,Ue)|0,U=U+Math.imul(A,ft)|0,_=_+Math.imul(A,yt)|0,_=_+Math.imul(y,ft)|0,q=q+Math.imul(y,yt)|0,U=U+Math.imul(R,st)|0,_=_+Math.imul(R,ht)|0,_=_+Math.imul(h,st)|0,q=q+Math.imul(h,ht)|0;let Ki=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(Ki>>>26)|0,Ki&=67108863,U=Math.imul(Z,ut),_=Math.imul(Z,et),_=_+Math.imul(re,ut)|0,q=Math.imul(re,et),U=U+Math.imul(F,tt)|0,_=_+Math.imul(F,Ue)|0,_=_+Math.imul(z,tt)|0,q=q+Math.imul(z,Ue)|0,U=U+Math.imul(N,ft)|0,_=_+Math.imul(N,yt)|0,_=_+Math.imul(B,ft)|0,q=q+Math.imul(B,yt)|0,U=U+Math.imul(A,st)|0,_=_+Math.imul(A,ht)|0,_=_+Math.imul(y,st)|0,q=q+Math.imul(y,ht)|0;let Wi=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(Wi>>>26)|0,Wi&=67108863,U=Math.imul(Z,tt),_=Math.imul(Z,Ue),_=_+Math.imul(re,tt)|0,q=Math.imul(re,Ue),U=U+Math.imul(F,ft)|0,_=_+Math.imul(F,yt)|0,_=_+Math.imul(z,ft)|0,q=q+Math.imul(z,yt)|0,U=U+Math.imul(N,st)|0,_=_+Math.imul(N,ht)|0,_=_+Math.imul(B,st)|0,q=q+Math.imul(B,ht)|0;let Ft=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(Ft>>>26)|0,Ft&=67108863,U=Math.imul(Z,ft),_=Math.imul(Z,yt),_=_+Math.imul(re,ft)|0,q=Math.imul(re,yt),U=U+Math.imul(F,st)|0,_=_+Math.imul(F,ht)|0,_=_+Math.imul(z,st)|0,q=q+Math.imul(z,ht)|0;let Br=(Te+U|0)+((_&8191)<<13)|0;Te=(q+(_>>>13)|0)+(Br>>>26)|0,Br&=67108863,U=Math.imul(Z,st),_=Math.imul(Z,ht),_=_+Math.imul(re,st)|0,q=Math.imul(re,ht);let ci=(Te+U|0)+((_&8191)<<13)|0;return Te=(q+(_>>>13)|0)+(ci>>>26)|0,ci&=67108863,s[0]=ai,s[1]=Hi,s[2]=sr,s[3]=yr,s[4]=Gr,s[5]=oi,s[6]=Mi,s[7]=Vt,s[8]=Gt,s[9]=Vi,s[10]=ar,s[11]=ki,s[12]=Gi,s[13]=Xi,s[14]=Ki,s[15]=Wi,s[16]=Ft,s[17]=Br,s[18]=ci,Te!==0&&(s[19]=Te,r.length+=1),r}Math.imul||(eb=Jg),K.Red=Aa;var lM=K,W=lM;const{custom:Ca}=$g,zi={AFFINE:0,JACOBIAN:1,PROJECTIVE:2,EXTENDED:3},uM=[-3,-1,-5,-7,0,7,5,1,3];let fM=0;class Hr{constructor(e,t,r){this.Point=null,this.id=null,this.uid=fM++,this.ossl=null,this.type="base",this.endian="be",this.hash=null,this.prefix=null,this.context=!1,this.prime=null,this.p=null,this.red=null,this.fieldSize=0,this.fieldBits=0,this.adjustedSize=0,this.signBit=0,this.mask=0,this.n=null,this.h=null,this.q=null,this.z=null,this.g=null,this.nh=null,this.scalarSize=0,this.scalarBits=0,this.zero=null,this.one=null,this.two=null,this.three=null,this.four=null,this.i2=null,this.i3=null,this.i4=null,this.i6=null,this.torsion=null,this.endo=null,this.hi=null,this._init(e,t,r)}_init(e,t,r){I(typeof e=="function"),I(typeof t=="string"),I(r&&typeof r=="object"),I(r.red==null||r.red instanceof W.Red),I(r.p!=null,"Must pass a prime."),I(r.id==null||typeof r.id=="string"),I(r.ossl==null||typeof r.ossl=="string"),I(r.endian==null||typeof r.endian=="string"),I(r.hash==null||typeof r.hash=="string"),I(r.prefix==null||typeof r.prefix=="string"),I(r.context==null||typeof r.context=="boolean"),I(r.prime==null||typeof r.prime=="string"),I(r.torsion==null||Array.isArray(r.torsion)),this.Point=e,this.id=r.id||null,this.ossl=r.ossl||null,this.type=t,this.endian=r.endian||(t==="short"?"be":"le"),this.hash=r.hash||null,this.prefix=r.prefix?Buffer.from(r.prefix,"binary"):null,this.context=r.context||!1,this.prime=r.prime||null,this.p=W.fromJSON(r.p),r.red?this.red=r.red:(this.red=r.prime?W.red(r.prime):W.mont(this.p),this.red.precompute()),this.fieldSize=this.p.byteLength(),this.fieldBits=this.p.bitLength(),this.adjustedSize=this.fieldSize+((this.fieldBits&7)===0),this.signBit=this.adjustedSize*8-1,this.mask=255,(this.fieldBits&7)!==0&&(this.mask=(1<<(this.fieldBits&7))-1),this.n=W.fromJSON(r.n||"0"),this.h=W.fromJSON(r.h||"1"),this.q=this.n.mul(this.h),this.z=W.fromJSON(r.z||"0").toRed(this.red),this.g=null,this.nh=this.n.ushrn(1),this.scalarSize=this.n.byteLength(),this.scalarBits=this.n.bitLength(),this.zero=new W(0).toRed(this.red),this.one=new W(1).toRed(this.red),this.two=new W(2).toRed(this.red),this.three=new W(3).toRed(this.red),this.four=new W(4).toRed(this.red),this.i2=this.two.redInvert(),this.i3=this.three.redInvert(),this.i4=this.i2.redSqr(),this.i6=this.i2.redMul(this.i3),this.torsion=new Array(this.h.word(0));for(let i=0;i<this.torsion.length;i++)this.torsion[i]=this.point();return this.endo=null,this.hi=null,this._scale=sf(this._scale,this),this.isIsomorphic=sf(this.isIsomorphic,this),this.isIsogenous=sf(this.isIsogenous,this),I(this.p.sign()>0&&this.p.isOdd()),I(this.n.sign()>=0),I(this.h.sign()>0&&this.h.cmpn(255)<=0),I(this.endian==="be"||this.endian==="le"),this}_finalize(e){if(I(e&&typeof e=="object"),this.g=e.g?this.pointFromJSON(e.g):this.point(),e.torsion){I(e.torsion.length===this.torsion.length);for(let t=0;t<this.torsion.length;t++)this.torsion[t]=this.pointFromJSON(e.torsion[t])}return this}_findTorsion(){I(!this.n.isZero());const e=this.h.word(0),t=this.one.redNeg(),r=[this.point()],i=new Set;let n=e;for(;r.length<n;){let s;t.redIAdd(this.one);try{s=this.pointFromX(t.clone())}catch(a){continue}try{s=s.mul(this.n)}catch(a){n=2;continue}if(s.isInfinity())continue;s.normalize();for(const a of[s,s.neg()]){const c=a.key();i.has(c)||(r.push(a),i.add(c))}}for(r.sort((s,a)=>s.cmp(a));r.length<e;)r.push(this.point());return r}_simpleMul(e,t){I(e instanceof Qe),I(t instanceof W),I(!t.red);const r=t.bitLength();t.isNeg()&&(e=e.neg());let i=this.jpoint();for(let n=r-1;n>=0;n--){const s=t.bit(n);i=i.dbl(),s===1&&(i=i.add(e))}return i}_simpleMulAdd(e,t){I(Array.isArray(e)),I(Array.isArray(t)),I(e.length===t.length);const r=e.length,i=new Array(r),n=t;let s=0;for(let c=0;c<r;c++){const o=e[c],d=t[c];if(I(o instanceof Qe),I(d instanceof W),I(!d.red),c>0&&o.type!==e[c-1].type)throw new Error("Cannot mix points.");i[c]=d.isNeg()?o.neg():o,s=Math.max(s,d.bitLength())}let a=this.jpoint();for(let c=s-1;c>=0;c--){a=a.dbl();for(let o=0;o<r;o++){const d=i[o],l=n[o],u=l.bit(c);u===1&&(a=a.add(d))}}return a}_constMul(e,t,r){return I(e instanceof Qe),this.n.isZero()?this._simpleMul(e,t):this.type==="short"&&this.h.cmpn(1)===0?this._coZLadderMul(e,t):this._ladderMul(e,t)}_ladderMul(e,t){I(e instanceof Qe),I(t instanceof W),I(!t.red);const[r,i,n]=xM(t,this.q);let s=e.toJ().clone(),a=this.jpoint().clone(),c=0;for(let o=i-1;o>=0;o--){const d=n[o>>3]>>(o&7)&1;s.swap(a,c^d),s=s.uadd(a),a=a.udbl(),c=d}return s.swap(a,c),a.swap(a.neg(),r),a}_coZLadderMul(e,t){I(e instanceof Qe),I(t instanceof W),I(!t.red);const r=e.toJ().clone(),[i,n,s,a]=OM(t,this.n);let[c,o]=r.zdblu(),d=0;for(let l=n-2;l>=0;l--){const u=s[l>>3]>>(l&7)&1;c.swap(o,d^u),[c,o]=o.zaddc(c),[o,c]=c.zaddu(o),d=u}return c.swap(o,d),o.swap(r.neg(),a),o.swap(o.neg(),i),o}_fixedMul(e,t){I(e instanceof Qe),I(t instanceof W),I(e.pre&&e.pre.windows);const{width:r,bits:i,points:n}=e._getWindows(0,0),s=1<<r,a=(i+r-1)/r>>>0;let c=this.jpoint();for(let o=0;o<a;o++){const d=t.bits(o*r,r);c=c.add(n[o*s+d])}return t.isNeg()&&(c=c.neg()),c}_fixedNafMul(e,t){I(e instanceof Qe),I(t instanceof W),I(e.pre&&e.pre.doubles);const{step:r,points:i}=e._getDoubles(0,0),n=kM(t,2,t.bitLength()+1,r),s=((1<<r+1)-(r%2===0?2:1))/3;let a=this.jpoint(),c=this.jpoint();for(let o=s;o>0;o--){for(let d=0;d<n.length;d++){const l=n[d];l===o?c=c.add(i[d]):l===-o&&(c=c.sub(i[d]))}a=a.add(c)}return a}_windowMul(e,t,r){I(e>>>0===e),I(t instanceof Qe),I(r instanceof W);const i=1<<e,n=Math.max(r.bitLength(),this.n.bitLength()),s=(n+e-1)/e>>>0,a=new Array(i),c=t.toJ();a[0]=this.jpoint(),a[1]=c;for(let d=2;d<i;d+=2)a[d+0]=a[d>>1].dbl(),a[d+1]=a[d].add(c);let o=this.jpoint();for(let d=s-1;d>=0;d--){const l=r.bits(d*e,e);d===s-1?o=a[l]:(o=o.dblp(e),o=o.add(a[l]))}return r.isNeg()&&(o=o.neg()),o}_slideMul(e,t,r){I(e>>>0===e),I(t instanceof Qe),I(r instanceof W);const i=1<<e-1,n=new Array(i),s=t.toJ();n[0]=s.dblp(e-1);for(let o=1;o<i;o++)n[o]=n[o-1].add(s);let a=r.bitLength(),c=this.jpoint();for(;a>=e;){const o=a-e,d=r.bits(o,e);if(d<i){c=c.dbl(),a-=1;continue}c=c.dblp(e),c=c.add(n[d&~i]),a=o}if(a>0){const o=r.bits(0,a);for(;a--;)c=c.dbl(),o>>a&1&&(c=c.add(t))}return r.isNeg()&&(c=c.neg()),c}_wnafMul(e,t,r){I(t instanceof Qe),I(r instanceof W);const{width:i,points:n}=t._safeNAF(e),s=vd(r,i,r.bitLength()+1);let a=this.jpoint();for(let c=s.length-1;c>=0;c--){const o=s[c];c!==s.length-1&&(a=a.dbl()),o>0?a=a.add(n[o-1>>1]):o<0&&(a=a.sub(n[-o-1>>1]))}return a}_wnafMulAdd(e,t,r){I(e>>>0===e),I(Array.isArray(t)),I(Array.isArray(r)),I(t.length===r.length);const i=t.length,n=new Array(i),s=new Array(i);let a=0;for(let u=0;u<i;u++){const p=t[u],f=r[u];if(I(p instanceof Qe),I(f instanceof W),u>0&&p.type!==t[u-1].type)throw new Error("Cannot mix points.");n[u]=null,s[u]=null,a=Math.max(a,f.bitLength()+1)}let c=null,o=null,d=0;for(let u=0;u<i;u++){const p=t[u],f=r[u],g=p._getNAF(0);if(g){n[d]=g.points,s[d]=vd(f,g.width,a),d+=1;continue}if(!c){c=p,o=f;continue}n[d]=c._getJNAF(p),s[d]=NM(o,f,a),c=null,o=null,d+=1}if(c){const u=c._safeNAF(e);n[d]=u.points,s[d]=vd(o,u.width,a),d+=1}let l=this.jpoint();for(let u=a-1;u>=0;u--){u!==a-1&&(l=l.dbl());for(let p=0;p<d;p++){const f=s[p][u];f>0?l=l.add(n[p][f-1>>1]):f<0&&(l=l.sub(n[p][-f-1>>1]))}}return l}_endoWnafMulAdd(e,t){throw new Error("Not implemented.")}_scale(e,t){I(e instanceof Hr),I(e.p.eq(this.p));switch(e.type){case"short":return this._scaleShort(e,t);case"mont":return this._scaleMont(e,t);case"edwards":return this._scaleEdwards(e,t);default:throw new Error("Not implemented.")}}_scaleShort(e,t){throw new Error("Not implemented.")}_scaleMont(e,t){throw new Error("Not implemented.")}_scaleEdwards(e,t){throw new Error("Not implemented.")}isElliptic(){throw new Error("Not implemented.")}jinv(){throw new Error("Not implemented.")}isComplete(){return!1}precompute(e){return I(!this.g.isInfinity(),"Must have base point."),I(!this.n.isZero(),"Must have order."),this.g.precompute(this.n.bitLength(),e),this}scalar(e,t,r){const i=new W(e,t,r);return I(!i.red),this.n.isZero()?i:i.imod(this.n)}field(e,t,r){const i=W.cast(e,t,r);return i.red?i.forceRed(this.red):i.toRed(this.red)}point(e,t){throw new Error("Not implemented.")}jpoint(e,t,r){throw new Error("Not implemented.")}xpoint(e,t){throw new Error("Not implemented.")}cpoint(e,t,r,i){if(I(e instanceof W),I(t instanceof W),I(r instanceof W),I(i instanceof W),t.isZero()||i.isZero())return this.point();const n=t.redMul(i).redInvert(),s=e.redMul(i).redMul(n),a=r.redMul(t).redMul(n);return this.point(s,a)}solveX2(e){throw new Error("Not implemented.")}solveX(e){return this.solveX2(e).redSqrt()}solveY2(e){throw new Error("Not implemented.")}solveY(e){return this.solveY2(e).redSqrt()}validate(e){throw new Error("Not implemented.")}pointFromX(e,t){throw new Error("Not implemented.")}pointFromY(e,t){throw new Error("Not implemented.")}isIsomorphic(e){throw new Error("Not implemented.")}isIsogenous(e){throw new Error("Not implemented.")}pointFromShort(e){throw new Error("Not implemented.")}pointFromMont(e,t){throw new Error("Not implemented.")}pointFromEdwards(e){throw new Error("Not implemented.")}pointFromUniform(e){throw new Error("Not implemented.")}pointToUniform(e){throw new Error("Not implemented.")}pointFromHash(e,t=!1){if(I(Buffer.isBuffer(e)),I(typeof t=="boolean"),e.length!==this.fieldSize*2)throw new Error("Invalid hash size.");const r=e.slice(0,this.fieldSize),i=e.slice(this.fieldSize),n=this.decodeUniform(r),s=this.decodeUniform(i),a=this.pointFromUniform(n),c=this.pointFromUniform(s),o=a.uadd(c);return t?o.mulH():o}pointToHash(e,t,r){I(e instanceof this.Point),I(t>>>0===t);const i=t%this.torsion.length,n=e.add(this.torsion[i]);for(;;){const s=this.randomField(r),a=this.pointFromUniform(s);if(a.neg().eq(a))continue;const c=n.usub(a),o=db(r);let d;try{d=this.pointToUniform(c,o&15)}catch(p){if(p.message==="Invalid point.")continue;throw p}const l=this.encodeUniform(s,o>>>8),u=this.encodeUniform(d,o>>>16);return Buffer.concat([l,u])}}randomScalar(e){const t=this.n.isZero()?this.p:this.n;return W.random(e,1,t)}randomField(e){return W.random(e,1,this.p).toRed(this.red)}randomPoint(e){let t;for(;;){const r=this.randomField(e),i=(db(e)&1)!==0;try{t=this.pointFromX(r,i)}catch(n){continue}return I(t.validate()),t.mulH()}}mulAll(e,t){return this.jmulAll(e,t)}mulAllSimple(e,t){return this.jmulAllSimple(e,t)}jmulAll(e,t){return I(Array.isArray(e)),I(e.length===0||e[0]instanceof Qe),this.endo&&e.length>0&&e[0].type===zi.AFFINE?this._endoWnafMulAdd(e,t):this._wnafMulAdd(5,e,t)}jmulAllSimple(e,t){return this._simpleMulAdd(e,t)}mulH(e){return I(e instanceof W),this.imulH(e.clone())}imulH(e){I(e instanceof W),I(!e.red);const t=this.h.word(0);if((t&t-1)===0){const r=this.h.bitLength();return e.iushln(r-1).imod(this.n)}return e.imuln(t).imod(this.n)}clamp(e){I(Buffer.isBuffer(e)),I(e.length===this.scalarSize),I(this.scalarSize<=this.fieldSize);let t=this.fieldBits&7||8,r=0,i=this.scalarSize-1;return this.endian==="be"&&([r,i]=[i,r]),this.scalarSize<this.fieldSize&&(t=8),e[r]&=-this.h.word(0)&255,e[i]&=(1<<t)-1,e[i]|=1<<t-1,e}splitHash(e){I(Buffer.isBuffer(e)),I(e.length===this.adjustedSize*2),I(this.scalarSize<=this.adjustedSize);let t=0;this.endian==="be"&&(t=this.adjustedSize-this.scalarSize);const r=e.slice(t,t+this.scalarSize),i=e.slice(this.adjustedSize);return this.clamp(r),[r,i]}encodeField(e){return I(e instanceof W),I(!e.red),e.encode(this.endian,this.fieldSize)}decodeField(e){if(I(Buffer.isBuffer(e)),e.length!==this.fieldSize)throw new Error("Invalid field element size.");return W.decode(e,this.endian)}encodeAdjusted(e){return I(e instanceof W),I(!e.red),e.encode(this.endian,this.adjustedSize)}decodeAdjusted(e){if(I(Buffer.isBuffer(e)),e.length!==this.adjustedSize)throw new Error("Invalid field element size.");return W.decode(e,this.endian)}encodeScalar(e){return I(e instanceof W),I(!e.red),e.encode(this.endian,this.scalarSize)}decodeScalar(e){if(I(Buffer.isBuffer(e)),e.length!==this.scalarSize)throw new Error("Invalid scalar size.");return W.decode(e,this.endian)}encodeClamped(e){return this.clamp(this.encodeScalar(e))}decodeClamped(e){if(I(Buffer.isBuffer(e)),e.length!==this.scalarSize)throw new Error("Invalid scalar size.");const t=this.clamp(Buffer.from(e));return W.decode(t,this.endian)}encodeUniform(e,t){I(e instanceof W),I(t>>>0===t);const r=this.endian==="le"?this.fieldSize-1:0,i=e.fromRed().encode(this.endian,this.fieldSize);return i[r]|=t&~this.mask&255,i}decodeUniform(e){if(I(Buffer.isBuffer(e)),e.length!==this.fieldSize)throw new Error("Invalid field size.");const t=W.decode(e,this.endian);return t.iumaskn(this.fieldBits),t.toRed(this.red)}encodePoint(e,t){return I(e instanceof Qe),e.encode(t)}decodePoint(e){throw new Error("Not implemented.")}encodeX(e){throw new Error("Not implemented.")}decodeX(e){throw new Error("Not implemented.")}decodeEven(e){throw new Error("Not implemented.")}decodeSquare(e){throw new Error("Not implemented.")}toShort(){throw new Error("Not implemented.")}toMont(e){throw new Error("Not implemented.")}toEdwards(e){throw new Error("Not implemented.")}pointToJSON(e,t){return I(e instanceof Qe),e.toJSON(t)}pointFromJSON(e){throw new Error("Not implemented.")}toJSON(e){let t,r,i,n,s;return this.type==="edwards"&&(t=this.prefix?this.prefix.toString():null,r=this.context),this.n.isZero()||(i=this.n.toJSON()),this.z.isZero()||(n=this.z.fromRed(),this.z.redIsHigh()&&n.isub(this.p),n=n.toString(16)),this.endo&&(s=this.endo.toJSON()),{id:this.id,ossl:this.ossl,type:this.type,endian:this.endian,hash:this.hash,prefix:t,context:r,prime:this.prime,p:this.p.toJSON(),a:void 0,b:void 0,d:void 0,n:i,h:this.h.toString(16),s:void 0,z:n,c:void 0,g:this.g.toJSON(e),endo:s}}static fromJSON(e){return new this(e)}}class Qe{constructor(e,t){I(e instanceof Hr),I(t>>>0===t),this.curve=e,this.type=t,this.pre=null}_init(){throw new Error("Not implemented.")}_getNAF(e){if(I(e>>>0===e),this.pre&&this.pre.naf)return this.pre.naf;if(e===0)return null;const t=1<<e-2,r=new Array(t),i=t===1?null:this.dbl();r[0]=this;for(let n=1;n<t;n++)r[n]=r[n-1].add(i);return new tb(e,r)}_safeNAF(e){return this._getNAF(e)}_getWindows(e,t){if(I(e>>>0===e),I(t>>>0===t),this.pre&&this.pre.windows)return this.pre.windows;if(e===0)return null;const r=1<<e,i=(t+e-1)/e>>>0,n=new Array(i*r);let s=this.toP();for(let a=0;a<i;a++){n[a*r]=this.curve.point();for(let c=1;c<r;c++)n[a*r+c]=n[a*r+c-1].add(s);s=s.dblp(e)}return new rb(e,t,n)}_getDoubles(e,t){if(I(e>>>0===e),I(t>>>0===t),this.pre&&this.pre.doubles)return this.pre.doubles;if(e===0)return null;const r=Math.ceil(t/e)+1,i=new Array(r);let n=this,s=0;i[s++]=n;for(let a=0;a<t;a+=e){for(let c=0;c<e;c++)n=n.dbl();i[s++]=n}return I(s===r),new ib(e,i)}_getBeta(){return null}_getBlinding(e){if(this.pre&&this.pre.blinding)return this.pre.blinding;if(!e)return null;if(this.curve.n.isZero())return null;const t=this.curve.randomScalar(e),r=this.mul(t);return new nb(t,r)}_hasWindows(e){if(I(e instanceof W),!this.pre||!this.pre.windows)return!1;const{bits:t}=this.pre.windows;return t>=e.bitLength()}_hasDoubles(e){if(I(e instanceof W),!this.pre||!this.pre.doubles)return!1;const{step:t,points:r}=this.pre.doubles,i=e.bitLength()+1;return r.length>=Math.ceil(i/t)+1}_getJNAF(e){return I(e instanceof Qe),I(e.type===this.type),[this,this.add(e),this.sub(e),e]}_blind(e,t){if(I(e instanceof W),I(!e.red),this.pre&&this.pre.blinding){const{blind:i,unblind:n}=this.pre.blinding,s=e.sub(i);return[this,s,n]}if(!t)return[this,e,null];if(this.pre){if(this.curve.n.isZero())return[this,e,null];const i=this.curve.randomScalar(t),n=i.mul(this.curve.n),s=n.iadd(e);return[this,s,null]}const r=this.randomize(t);return[r,e,null]}clone(){throw new Error("Not implemented.")}swap(e,t){throw new Error("Not implemented.")}precompute(e,t){return I(e>>>0===e),this.pre||(this.pre=new tf),this.pre.naf||(this.pre.naf=this._getNAF(9)),this.pre.doubles||(this.pre.doubles=this._getDoubles(4,e+1)),this.pre.beta||(this.pre.beta=this._getBeta()),this.pre.blinding||(this.pre.blinding=this._getBlinding(t)),this}validate(){return this.curve.validate(this)}normalize(){return this}scale(e){throw new Error("Not implemented.")}randomize(e){const t=this.curve.randomField(e);return this.scale(t)}neg(){throw new Error("Not implemented.")}add(e){throw new Error("Not implemented.")}sub(e){return I(e instanceof Qe),this.add(e.neg())}dbl(){throw new Error("Not implemented.")}dblp(e){I(e>>>0===e);let t=this;for(let r=0;r<e;r++)t=t.dbl();return t}uadd(e){throw new Error("Not implemented.")}usub(e){return I(e instanceof Qe),this.uadd(e.neg())}udbl(){throw new Error("Not implemented.")}zaddu(e){throw new Error("Not implemented.")}zaddc(e){throw new Error("Not implemented.")}zdblu(){throw new Error("Not implemented.")}diffAdd(e,t){throw new Error("Not implemented.")}diffAddDbl(e,t){throw new Error("Not implemented.")}recover(){throw new Error("Not implemented.")}getX(){throw new Error("Not implemented.")}getY(){throw new Error("Not implemented.")}eq(e){throw new Error("Not implemented.")}cmp(e){throw new Error("Not implemented.")}isInfinity(){throw new Error("Not implemented.")}isOrder2(){throw new Error("Not implemented.")}isOdd(){throw new Error("Not implemented.")}isEven(){throw new Error("Not implemented.")}isSquare(){throw new Error("Not implemented.")}eqX(e){throw new Error("Not implemented.")}eqR(e){throw new Error("Not implemented.")}isSmall(){return this.isInfinity()?!1:this.jmulH().isInfinity()}hasTorsion(){return this.isInfinity()?!1:!this.jmul(this.curve.n).isInfinity()}order(){const{h:e,n:t}=this.curve;let r=this.toJ(),i=new W(1);for(;!r.isInfinity();){if(i.iaddn(1),i.cmp(e)>0){i=t.clone();break}r=r.add(this)}return i}mul(e){return this.jmul(e)}muln(e){return this.jmuln(e)}mulSimple(e){return this.jmulSimple(e)}mulBlind(e,t){return this.jmulBlind(e,t)}mulConst(e,t){return this.jmulConst(e,t)}mulAdd(e,t,r){return this.jmulAdd(e,t,r)}mulAddSimple(e,t,r){return this.jmulAddSimple(e,t,r)}mulH(){return this.jmulH()}div(e){return this.jdiv(e)}divn(e){return this.jdivn(e)}divH(){return this.jdivH()}jmul(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo&&this.type===zi.AFFINE?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(5,this,e)}jmuln(e){return I((e|0)===e),this.jmulSimple(new W(e))}jmulSimple(e){return this.curve._simpleMul(this,e)}jmulBlind(e,t=null){const[r,i,n]=this._blind(e,t),s=r.jmul(i);return n?s.add(n):s}jmulConst(e,t=null){const[r,i,n]=this._blind(e,t),s=this.curve._constMul(r,i,t);return n?s.uadd(n):s}jmulAdd(e,t,r){return this.curve.endo&&this.type===zi.AFFINE?this.curve._endoWnafMulAdd([this,t],[e,r]):this.curve._wnafMulAdd(5,[this,t],[e,r])}jmulAddSimple(e,t,r){return this.curve._simpleMulAdd([this,t],[e,r])}jmulH(){const e=this.curve.h.word(0);if((e&e-1)===0){const t=this.curve.h.bitLength();return this.toJ().dblp(t-1)}return this.jmulSimple(this.curve.h)}jdiv(e){return I(e instanceof W),I(!e.red),this.jmul(e.invert(this.curve.n))}jdivn(e){return I(!this.curve.n.isZero()),this.curve.h.cmpn(e)===0?this.jdivH():this.jdiv(new W(e))}jdivH(){return this.curve.n.isZero()?this.toJ():this.curve.h.cmpn(1)===0?this.toJ():(this.curve.hi===null&&(this.curve.hi=this.curve.h.invert(this.curve.n)),this.jmul(this.curve.hi))}ladder(e){throw new Error("Not implemented.")}ladderSimple(e){throw new Error("Not implemented.")}ladderBlind(e,t){throw new Error("Not implemented.")}ladderConst(e,t){throw new Error("Not implemented.")}toP(){return this.normalize()}toJ(){return this}toX(){return this}key(){if(this.isInfinity())return`${this.curve.uid}:oo`;this.normalize();const e=this.getX().toString(16),t=this.getY().toString(16);return`${this.curve.uid}:${e},${t}`}encode(e){throw new Error("Not implemented.")}static decode(e,t){throw new Error("Not implemented.")}encodeX(){throw new Error("Not implemented.")}static decodeX(e,t){throw new Error("Not implemented.")}static decodeEven(e,t){throw new Error("Not implemented.")}static decodeSquare(e,t){throw new Error("Not implemented.")}toJSON(e){throw new Error("Not implemented.")}static fromJSON(e,t){throw new Error("Not implemented.")}[Ca](){return"<Point>"}}class Et extends Hr{constructor(e){super(It,"short",e);this.a=W.fromJSON(e.a).toRed(this.red),this.b=W.fromJSON(e.b).toRed(this.red),this.c=W.fromJSON(e.c||"0").toRed(this.red),this.ai=this.a.isZero()?this.zero:this.a.redInvert(),this.zi=this.z.isZero()?this.zero:this.z.redInvert(),this.zeroA=this.a.isZero(),this.threeA=this.a.eq(this.three.redNeg()),this.redN=this.n.toRed(this.red),this.pmodn=this.p.clone(),this.highOrder=this.n.cmp(this.p)>=0,this.smallGap=!1,this._finalize(e)}_finalize(e){return super._finalize(e),e.endo!=null?this.endo=sb.fromJSON(this,e.endo):this.endo=this._getEndomorphism(),this.n.isZero()||(this.pmodn=this.p.mod(this.n),this.smallGap=this.p.div(this.n).cmpn(1)<=0),this}static _isomorphism(e,t,r,i){if(I(e instanceof W),I(t instanceof W),I(r instanceof W),I(i==null||typeof i=="boolean"),I(!e.isZero()||!t.isZero()),r.isZero())throw new Error("Invalid coefficient.");if(e.isZero()){const l=r,u=l.redDiv(t),p=cb(u);return I(p.redJacobi()===1),[e.clone(),l.clone()]}if(t.isZero()){const l=r,u=l.redDiv(e),p=u.redSqrt();if(p.redJacobi()!==1&&p.redINeg(),p.redJacobi()!==1)throw new Error("Invalid `a` coefficient.");return[l.clone(),t.clone()]}const n=r,s=n.redDiv(e),a=s.redSqrt();if(i!=null?a.redIsOdd()!==i&&a.redINeg():a.redJacobi()!==1&&a.redINeg(),a.redJacobi()!==1)throw new Error("Invalid `a` coefficient.");const c=s.redMul(a),o=e.redMul(s),d=t.redMul(c);return I(o.eq(n)),[o,d]}_short(e,t){return Et._isomorphism(this.a,this.b,e,t)}_mont(e,t){const[r,i]=this._findRS(t),n=i.redInvert(),s=r.redMuln(3).redMul(n);return e!=null?Nt._isomorphism(s,n,e):[s,n]}_edwards(e,t){const[r,i]=this._findRS(t),n=r.redMuln(3),s=i.redMuln(2),a=n.redAdd(s),c=n.redSub(s);return e!=null?pr._isomorphism(a,c,e):[a,c]}_findRS(e){I(e==null||typeof e=="boolean"),I(this.h.word(0)>=4),I(!this.n.isZero());const t=this.one.redNeg();let r;for(;;){t.redIAdd(this.one);try{r=this.pointFromX(t.clone())}catch(a){continue}if(r=r.mul(this.n),r.isInfinity())continue;if(!r.y.isZero())continue;break}const i=r.x,n=i.redSqr(),s=n.redMuln(3).redIAdd(this.a).redSqrt();return e!=null&&(s.redIsOdd()!==e&&s.redINeg()),[i,s]}_scale0(e,t){if(I(this.a.isZero()===e.isZero()),I(this.b.isZero()===t.isZero()),this.a.isZero()){const c=this.b.redDiv(this.field(t)),o=cb(c),d=o.redSqrt(),l=o.redMul(d);return I(l.redSqr().eq(c)),I(!d.isZero()),[o,l]}if(this.b.isZero()){const c=this.a.redDiv(this.field(e)),o=c.redSqrt();o.redJacobi()!==1&&o.redINeg();const d=o.redSqrt(),l=o.redMul(d);return I(l.redMul(d).eq(c)),I(!d.isZero()),[o,l]}const r=this.a.redDiv(this.field(e)),i=this.b.redDiv(this.field(t)),n=r.redSqrt();r.redMul(n).eq(i)||n.redINeg(),I(r.redMul(n).eq(i));const s=n.redSqrt(),a=n.redMul(s);return I(!s.isZero()),[n,a]}_scale1(e,t){const r=this.g.x.redDiv(this.field(e)),i=this.g.y.redDiv(this.field(t)),n=r.redSqrt();return r.redMul(n).eq(i)||n.redINeg(),I(r.redMul(n).eq(i)),I(!n.isZero()),[r,i]}_scaleShort(e){return I(e instanceof Et),this.g.isInfinity()||e.g.isInfinity()?this._scale0(e.a,e.b):this._scale1(e.g.x,e.g.y)}_scaleMont(e){if(I(e instanceof Nt),this.g.isInfinity()||e.g.isInfinity()){const[s,a]=e._short();return this._scale0(s,a)}const{x:t,y:r}=e.g,i=t.redAdd(e.a3).redMul(e.bi),n=r.redMul(e.bi);return this._scale1(i,n)}_scaleEdwards(e){if(I(e instanceof pr),this.g.isInfinity()||e.g.isInfinity()){const[D,j]=e._short();return this._scale0(D,j)}const{x:t,y:r,z:i}=e.g,n=e.a.redMuln(5),s=e.d.redMuln(5),a=e.d.redSub(e.a),c=s.redSub(e.a),o=e.d.redSub(n),d=r.redAdd(i),l=r.redSub(i),u=c.redMul(r).redIAdd(o.redMul(i)),p=l.redMuln(12),f=a.redMul(d).redMul(i),g=l.redMul(t).redIMuln(4),v=p.redMul(g).redInvert(),S=u.redMul(g).redMul(v),C=f.redMul(p).redMul(v);return this._scale1(S,C)}_getEndomorphism(e=0){if(this.n.isZero()||this.g.isInfinity())return null;if(!this.zeroA||this.p.modrn(3)!==1||this.n.modrn(3)!==1)return null;const[t,r]=this._getEndoRoots(this.p),i=[t,r][e&1].toRed(this.red),[n,s]=this._getEndoRoots(this.n),a=this.point(this.g.x.redMul(i),this.g.y);let c;this.g.mul(n).eq(a)?c=n:(I(this.g.mul(s).eq(a)),c=s);const o=this._getEndoBasis(c),d=this._getEndoPrecomp(o);return new sb(i,c,o,d)}_getEndoRoots(e){const t=e===this.p?this.red:W.mont(e),r=new W(2).toRed(t),i=new W(3).toRed(t),n=r.redInvert(),s=i.redNeg().redSqrt().redMul(n),a=s.redNeg(),c=s.redSub(n).fromRed(),o=a.redSub(n).fromRed();return[c,o].sort(W.cmp)}_getEndoBasis(e){const[t,r,i,n,s,a]=this._egcdSqrt(e),c=i,o=n.neg(),d=t.sqr().iadd(r.sqr()),l=s.sqr().iadd(a.sqr());let u,p;return d.cmp(l)<=0?(u=t,p=r.neg()):(u=s,p=a.neg()),[new Ra(c,o),new Ra(u,p)]}_egcdSqrt(e){I(e instanceof W),I(!e.red),I(e.sign()>0),I(this.n.sign()>0);const t=this.n.ushrn(this.n.bitLength()>>>1);let r=e,i=this.n.clone(),n=new W(1),s=new W(0),a=new W(0),c=new W(1),o,d,l,u,p=0,f=0,g;for(;!r.isZero()&&p<2;){const C=i.quo(r),D=i.sub(C.mul(r)),j=a.sub(C.mul(n)),m=c.sub(C.mul(s));f===0&&D.cmp(t)<0&&(o=g,d=n,l=D,u=j,f=1),g=D,i=r,r=D,a=n,n=j,c=s,s=m,p+=f}I(f!==0,"Could not find r < sqrt(n).");const v=a,S=n;return[o,d,l,u,v,S]}_getEndoPrecomp(e){I(Array.isArray(e)),I(e.length===2),I(e[0]instanceof Ra),I(e[1]instanceof Ra);const[t,r]=e,i=t.a.mul(r.b).isub(t.b.mul(r.a)),n=i.bitLength()+16,s=W.shift(1,n),a=s.mul(r.b).divRound(i),c=s.mul(t.b).divRound(i);return I(i.eq(this.n)),[a,c]}_endoSplit(e){I(e instanceof W),I(!e.red),I(!this.n.isZero());const[t,r]=this.endo.basis,i=r.b.mul(e).divRound(this.n),n=t.b.neg().mul(e).divRound(this.n),s=i.mul(t.a),a=n.mul(r.a),c=i.ineg().mul(t.b),o=n.mul(r.b),d=e.sub(s).isub(a),l=c.isub(o);return[d,l]}_endoBeta(e){return I(e instanceof It),[e,e._getBeta()]}_endoWnafMulAdd(e,t){I(Array.isArray(e)),I(Array.isArray(t)),I(e.length===t.length),I(this.endo!=null);const r=e.length,i=new Array(r*2),n=new Array(r*2);for(let s=0;s<r;s++){const[a,c]=this._endoBeta(e[s]),[o,d]=this._endoSplit(t[s]);i[s*2+0]=a,n[s*2+0]=o,i[s*2+1]=c,n[s*2+1]=d}return this._wnafMulAdd(5,i,n)}_icart(e){const{a:t,b:r,i3:i,one:n}=this,s=i.redSqr().redMul(i),a=this.p.ushln(1).isubn(1).idivn(3),c=e.clone();c.cinject(n,c.czero());const o=c.redSqr(),d=o.redSqr(),l=d.redMul(o),u=c.redMuln(6).redFermat(),p=t.redMuln(3).redISub(d).redMul(u),f=p.redSqr(),g=l.redMul(s),v=o.redMul(i),S=f.redISub(r).redISub(g).redPow(a).redIAdd(v),C=c.redMul(S).redIAdd(p);return this.point(S,C)}_sswu(e){const{b:t,z:r,ai:i,zi:n,one:s}=this,a=this.p.subn(2),c=r.redSqr(),o=t.redNeg().redMul(i),d=t.redMul(n).redMul(i),l=e.redSqr(),u=l.redSqr(),p=c.redMul(u).redIAdd(r.redMul(l)).redPow(a),f=o.redMul(s.redAdd(p));f.cinject(d,p.czero());const g=r.redMul(l).redMul(f),v=this.solveY2(f),S=this.solveY2(g),C=v.redIsSquare()|0,D=f.cinject(g,C^1),j=v.cinject(S,C^1).redSqrt();return j.cinject(j.redNeg(),j.redIsOdd()^e.redIsOdd()),this.point(D,j)}_sswui(e,t){const{a:r,b:i,z:n}=this,{x:s,y:a}=e,c=t&3,o=r.redSqr().redMul(s.redSqr()),d=r.redMul(i).redMul(s).redIMuln(2),l=i.redSqr().redMuln(3),u=r.redMul(s).redIAdd(i),[p,f]=ab(o.redISub(d).redISub(l)),g=u.redSub(f).redINeg(),v=u.redAdd(f).redINeg(),S=u.redMul(n).redIMuln(2),C=i.redMul(n).redIMuln(2);g.cinject(v,c&1),S.cinject(C,c>>>1);const[D,j]=nf(g,S);if(j.cinject(j.redNeg(),j.redIsOdd()^a.redIsOdd()),!(p&D))throw new Error("Invalid point.");return j}_svdwf(e){const{c:t,z:r,zi:i,i2:n,i3:s}=this,a=this.p.subn(2),c=this.solveY2(r),o=s.redMul(i.redSqr()),d=e.redSqr(),l=d.redSqr(),u=d.redAdd(c),p=d.redMul(u).redPow(a),f=l.redMul(p).redMul(t),g=u.redSqr().redMul(u),v=t.redSub(r).redMul(n).redISub(f),S=f.redSub(t.redAdd(r).redMul(n)),C=r.redSub(g.redMul(p).redMul(o)),D=this.solveY2(v),j=this.solveY2(S),m=this.solveY2(C),w=D.redIsSquare()|0,R=j.redIsSquare()|0;return v.cinject(S,(w^1)&R),D.cinject(j,(w^1)&R),v.cinject(C,(w^1)&(R^1)),D.cinject(m,(w^1)&(R^1)),[v,D]}_svdw(e){const[t,r]=this._svdwf(e),i=r.redSqrt();return i.cinject(i.redNeg(),i.redIsOdd()^e.redIsOdd()),this.point(t,i)}_svdwi(e,t){const{b:r,c:i,z:n,two:s}=this,{x:a,y:c}=e,o=t&3,d=n.redSqr(),l=d.redMul(n),u=d.redSqr(),p=l.redAdd(r),f=p.redMuln(2),g=a.redSqr(),v=a.redMuln(2).redIAdd(n),S=a.redMul(d),C=i.redSub(v),D=i.redAdd(v),j=g.redMul(d).redIAdd(u).redIMuln(9),m=a.redMul(l).redIMuln(18),w=p.redMul(a.redSub(n)).redIMuln(12),[R,h]=ab(j.redISub(m).redIAdd(w)),b=o-2>>>31|R,A=h.redMul(n),y=l.redISub(S).redIMuln(3).redISub(f),P=p.redMul(C),N=p.redMul(D),B=y.redAdd(A),L=y.redSub(A),F=s.clone();P.cinject(N,(o^1)-1>>>31),P.cinject(B,(o^2)-1>>>31),P.cinject(L,(o^3)-1>>>31),F.cinject(D,(o^0)-1>>>31),F.cinject(C,(o^1)-1>>>31);const[z,X]=nf(P,F),[Z]=this._svdwf(X),re=Z.ceq(a);if(X.cinject(X.redNeg(),X.redIsOdd()^c.redIsOdd()),!(b&z&re))throw new Error("Invalid point.");return X}isElliptic(){const{a:e,b:t}=this,r=e.redSqr(),i=r.redMul(e),n=t.redSqr(),s=n.redMuln(27).redIAdd(i.redMuln(4));return!s.isZero()}jinv(){const{a:e,b:t}=this,r=e.redSqr(),i=r.redMul(e),n=t.redSqr(),s=i.redMuln(4),a=s.redMuln(1728),c=n.redMuln(27).redIAdd(s);if(c.isZero())throw new Error("Curve is not elliptic.");return a.redDiv(c).fromRed()}point(e,t,r=0){return new It(this,e,t,r)}jpoint(e,t,r){return new pn(this,e,t,r)}solveX(e){if(I(e instanceof W),!this.a.isZero())throw new Error("Not implemented.");const t=e.redSqr(),r=t.redSub(this.b);return ob(r)}solveY2(e){I(e instanceof W);const t=e.redSqr().redMul(e),r=t.redIAdd(this.b);return this.zeroA||(this.threeA?r.redIAdd(e.redMuln(-3)):r.redIAdd(this.a.redMul(e))),r}validate(e){if(I(e instanceof It),e.inf)return!0;const{x:t,y:r}=e,i=this.solveY2(t);return r.redSqr().eq(i)}pointFromX(e,t=null){I(e instanceof W),I(t==null||typeof t=="boolean"),e.red||(e=e.toRed(this.red));const r=this.solveY(e);if(t!=null){if(this.h.cmpn(1)>0&&(r.isZero()&&t))throw new Error("Invalid point.");r.redIsOdd()!==t&&r.redINeg()}return this.point(e,r)}pointFromY(e,t=0){I(e instanceof W),I(t>>>0===t),e.red||(e=e.toRed(this.red));const r=this.solveX(e);if(t>=r.length)throw new Error("Invalid X coordinate index.");const i=r[t];return this.point(i,e)}isIsomorphic(e){if(I(e instanceof Hr),!e.p.eq(this.p))return!1;let t,r;try{[t,r]=this._scale(e)}catch(i){return!1}if(e.type==="short"){const i=this.field(e.a).redMul(t.redSqr()),n=this.field(e.b).redMul(r.redSqr());return this.a.eq(i)&&this.b.eq(n)}if(e.type==="mont"){const{a3:i,bi:n}=e,s=this.field(i.redMul(n)).redMul(t),a=this.solveY2(s);return a.isZero()}if(e.type==="edwards"){const i=this.field(e.ad6).redMul(t),n=this.solveY2(i);return n.isZero()}return!1}isIsogenous(e){return I(e instanceof Hr),!1}pointFromShort(e){if(I(e instanceof It),this.isIsomorphic(e.curve)){if(e.isInfinity())return this.point();const[t,r]=this._scale(e.curve),i=this.field(e.x),n=this.field(e.y),s=i.redMul(t),a=n.redMul(r);return this.point(s,a)}throw new Error("Not implemented.")}pointFromMont(e){if(I(e instanceof ir),this.isIsomorphic(e.curve)){if(e.isInfinity())return this.point();const{a3:t,bi:r}=e.curve,[i,n]=this._scale(e.curve),s=e.x.redAdd(t).redMul(r),a=e.y.redMul(r);return this.point(this.field(s).redMul(i),this.field(a).redMul(n))}throw new Error("Not implemented.")}pointFromEdwards(e){if(I(e instanceof mr),this.isIsomorphic(e.curve)){const{a:t,d:r,ad6:i}=e.curve,[n,s]=this._scale(e.curve);if(e.isInfinity())return this.point();if(e.x.isZero()){const m=this.field(i).redMul(n);return this.point(m,this.zero)}const{x:a,y:c,z:o}=e,d=t.redMuln(5),l=r.redMuln(5),u=r.redSub(t),p=l.redSub(t),f=r.redSub(d),g=c.redAdd(o),v=c.redSub(o),S=p.redMul(c).redIAdd(f.redMul(o)),C=v.redMuln(12),D=u.redMul(g).redMul(o),j=v.redMul(a).redIMuln(4);return this.cpoint(this.field(S).redMul(n),this.field(C),this.field(D).redMul(s),this.field(j))}throw new Error("Not implemented.")}pointFromUniform(e){if(I(e instanceof W),this.z.isZero()||this.b.isZero())throw new Error("Not implemented.");if(!this.a.isZero())return this._sswu(e);if(!this.c.isZero())return this._svdw(e);throw new Error("Not implemented.")}pointToUniform(e,t){if(I(e instanceof It),I(t>>>0===t),this.z.isZero()||this.b.isZero())throw new Error("Not implemented.");if(e.isInfinity())throw new Error("Invalid point.");const r=(t>>>4&15)%this.torsion.length,i=e.add(this.torsion[r]);if(!this.a.isZero())return this._sswui(i,t);if(!this.c.isZero())return this._svdwi(i,t);throw new Error("Not implemented.")}mulAll(e,t){return super.mulAll(e,t).toP()}mulAllSimple(e,t){return super.mulAllSimple(e,t).toP()}decodePoint(e){return It.decode(this,e)}encodeX(e){return I(e instanceof Qe),e.encodeX()}decodeEven(e){return It.decodeEven(this,e)}decodeSquare(e){return It.decodeSquare(this,e)}toShort(e,t,r=null){const[i,n]=this._short(e,t),s=new Et({red:this.red,prime:this.prime,p:this.p,a:i,b:n,n:this.n,h:this.h});if(r!=null){const[,a]=s._scale(this);a.redIsOdd()!==r&&a.redINeg()}this.g.isInfinity()||(s.g=s.pointFromShort(this.g));for(let a=0;a<this.h.word(0);a++)s.torsion[a]=s.pointFromShort(this.torsion[a]);return s}toMont(e,t,r=null){const[i,n]=this._mont(e,t),s=new Nt({red:this.red,prime:this.prime,p:this.p,a:i,b:n,n:this.n,h:this.h});if(r!=null){const[,a]=this._scale(s);a.redIsOdd()!==r&&a.redINeg()}this.g.isInfinity()||(s.g=s.pointFromShort(this.g));for(let a=0;a<this.h.word(0);a++)s.torsion[a]=s.pointFromShort(this.torsion[a]);return s}toEdwards(e,t,r=null){const[i,n]=this._edwards(e,t),s=new pr({red:this.red,prime:this.prime,p:this.p,a:i,d:n,n:this.n,h:this.h});if(r!=null){const[,a]=this._scale(s);a.redIsOdd()!==r&&a.redINeg()}if(this.g.isInfinity()||(s.g=s.pointFromShort(this.g),s.g.normalize()),s.isComplete())for(let a=0;a<this.h.word(0);a++)s.torsion[a]=s.pointFromShort(this.torsion[a]),s.torsion[a].normalize();return s}pointFromJSON(e){return It.fromJSON(this,e)}toJSON(e){const t=super.toJSON(e);return t.a=this.a.fromRed().toJSON(),t.b=this.b.fromRed().toJSON(),this.c.isZero()||(t.c=this.c.fromRed().toJSON()),t}}class It extends Qe{constructor(e,t,r,i){I(e instanceof Et),super(e,zi.AFFINE),this.x=this.curve.zero,this.y=this.curve.zero,this.inf=1,t!=null&&this._init(t,r,i)}_init(e,t,r){I(e instanceof W),I(t instanceof W),this.x=e,this.y=t,this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=r|0}_safeNAF(e){return I(e>>>0===e),this.pre&&this.pre.naf?this.pre.naf:e>1?this.toJ()._getNAF(e):this._getNAF(e)}_getBeta(){if(!this.curve.endo)return null;if(this.pre&&this.pre.beta)return this.pre.beta;const e=this.x.redMul(this.curve.endo.beta),t=this.curve.point(e,this.y);return this.pre&&(t.pre=this.pre.map(r=>{const i=r.x.redMul(this.curve.endo.beta);return this.curve.point(i,r.y)}),this.pre.beta=t),t}_getJNAF(e){if(I(e instanceof It),this.inf|e.inf)return super._getJNAF(e);const t=[this,null,null,e];return this.y.eq(e.y)?(t[1]=this.add(e),t[2]=this.toJ().sub(e)):this.y.eq(e.y.redNeg())?(t[1]=this.toJ().add(e),t[2]=this.sub(e)):(t[1]=this.toJ().add(e),t[2]=this.toJ().sub(e)),t}clone(){return this.curve.point(this.x.clone(),this.y.clone(),this.inf)}swap(e,t){I(e instanceof It);const r=(t>>31|-t>>31)&1,i=this.inf,n=e.inf;return this.x.cswap(e.x,t),this.y.cswap(e.y,t),this.inf=i&(r^1)|n&r,e.inf=n&(r^1)|i&r,this}scale(e){return this.toJ().scale(e)}neg(){return this.inf?this:this.curve.point(this.x,this.y.redNeg())}add(e){if(I(e instanceof It),this.inf)return e;if(e.inf)return this;if(this.x.eq(e.x))return this.y.eq(e.y)?this.dbl():this.curve.point();if(this.y.eq(e.y)){const a=this.x.redNeg().redISub(e.x),c=this.y.redNeg();return this.curve.point(a,c)}const t=this.x.redSub(e.x),r=this.y.redSub(e.y),i=r.redDiv(t),n=i.redSqr().redISub(this.x).redISub(e.x),s=i.redMul(this.x.redSub(n)).redISub(this.y);return this.curve.point(n,s)}dbl(){if(this.inf)return this;if(this.y.isZero())return this.curve.point();const e=this.x.redSqr(),t=e.redIMuln(3).redIAdd(this.curve.a),r=this.y.redMuln(2),i=t.redDiv(r),n=i.redSqr().redISub(this.x).redISub(this.x),s=i.redMul(this.x.redSub(n)).redISub(this.y);return this.curve.point(n,s)}dblp(e){return this.toJ().dblp(e).toP()}uadd(e){I(e instanceof It);const t=this.y.redAdd(e.y),r=this.x.redAdd(e.x).redSqr(),i=this.x.redMul(e.x),n=r.redISub(i).redIAdd(this.curve.a),s=t.czero()&n.czero();t.cinject(this.x.redSub(e.x),s),n.cinject(this.y.redSub(e.y),s);const a=t.czero()&((this.inf|e.inf)^1);t.cinject(this.curve.one,t.czero());const c=n.redMul(t.redFermat()),o=c.redSqr().redISub(this.x).redISub(e.x),d=c.redMul(this.x.redSub(o)).redISub(this.y),l=a|this.inf&e.inf;return o.cinject(e.x,this.inf),d.cinject(e.y,this.inf),o.cinject(this.x,e.inf),d.cinject(this.y,e.inf),o.cinject(this.curve.zero,l),d.cinject(this.curve.zero,l),this.curve.point(o,d,l)}udbl(){return this.uadd(this)}recover(e,t,r,i){if(I(e instanceof W),I(t instanceof W),I(r instanceof W),I(i instanceof W),this.inf)return this.curve.jpoint();const n=t.redMul(i),s=n.redSqr(),a=s.redMul(n),c=this.x.redMul(n),o=e.redMul(i),d=r.redMul(t),l=this.curve.b.redMul(a).redIMuln(2),u=c.redMul(o).redIAdd(this.curve.a.redMul(s)),p=c.redAdd(o),f=c.redISub(o),g=l.redIAdd(u.redMul(p)),v=d.redMul(f.redSqr()),S=g.redISub(v),C=this.y.redMul(a).redIMuln(2),D=e.redMul(C),j=S.redMul(t),m=t.redMul(C),w=D.redMul(m),R=j.redMul(m.redSqr()),h=m;return this.curve.jpoint(w,R,h)}getX(){if(this.inf)throw new Error("Invalid point.");return this.x.fromRed()}getY(){if(this.inf)throw new Error("Invalid point.");return this.y.fromRed()}eq(e){return I(e instanceof It),this===e?!0:this.inf?e.inf!==0:e.inf?!1:this.x.eq(e.x)&&this.y.eq(e.y)}cmp(e){return I(e instanceof It),this.inf&&!e.inf?-1:!this.inf&&e.inf?1:this.inf&&e.inf?0:this.order().cmp(e.order())||this.getX().cmp(e.getX())||this.getY().cmp(e.getY())}isInfinity(){return this.inf!==0}isOrder2(){return this.inf?!1:this.y.isZero()}isOdd(){return this.inf?!1:this.y.redIsOdd()}isEven(){return this.inf?!1:this.y.redIsEven()}isSquare(){return this.inf?!1:this.y.redJacobi()!==-1}eqX(e){return I(e instanceof W),I(!e.red),this.inf?!1:this.getX().eq(e)}eqR(e){return I(e instanceof W),I(!e.red),I(!this.curve.n.isZero()),this.inf?!1:this.getX().imod(this.curve.n).eq(e)}mul(e){return super.mul(e).toP()}muln(e){return super.muln(e).toP()}mulSimple(e){return super.mulSimple(e).toP()}mulBlind(e,t){return super.mulBlind(e,t).toP()}mulConst(e,t){return super.mulConst(e,t).toP()}mulAdd(e,t,r){return super.mulAdd(e,t,r).toP()}mulAddSimple(e,t,r){return super.mulAddSimple(e,t,r).toP()}mulH(){return super.mulH().toP()}div(e){return super.div(e).toP()}divn(e){return super.divn(e).toP()}divH(){return super.divH().toP()}toP(){return this}toJ(){return this.inf?this.curve.jpoint():this.curve.jpoint(this.x,this.y,this.curve.one)}encode(e){e==null&&(e=!0),I(typeof e=="boolean");const{fieldSize:t}=this.curve;if(this.inf)throw new Error("Invalid point.");if(e){const s=Buffer.alloc(1+t),a=this.curve.encodeField(this.getX());return s[0]=2|this.y.redIsOdd(),a.copy(s,1),s}const r=Buffer.alloc(1+t*2),i=this.curve.encodeField(this.getX()),n=this.curve.encodeField(this.getY());return r[0]=4,i.copy(r,1),n.copy(r,1+t),r}static decode(e,t){I(e instanceof Et),I(Buffer.isBuffer(t));const r=e.fieldSize;if(t.length<1+r)throw new Error("Not a point.");const i=t[0];switch(i){case 2:case 3:{if(t.length!==1+r)throw new Error("Invalid point size for compressed.");const n=e.decodeField(t.slice(1,1+r));if(n.cmp(e.p)>=0)throw new Error("Invalid point.");const s=e.pointFromX(n,i===3);return I(!s.isInfinity()),s}case 4:case 6:case 7:{if(t.length!==1+r*2)throw new Error("Invalid point size for uncompressed.");const n=e.decodeField(t.slice(1,1+r)),s=e.decodeField(t.slice(1+r,1+2*r));if(n.cmp(e.p)>=0||s.cmp(e.p)>=0)throw new Error("Invalid point.");if(i!==4&&i!==(6|s.isOdd()))throw new Error("Invalid hybrid encoding.");const a=e.point(n,s);if(!a.validate())throw new Error("Invalid point.");return I(!a.isInfinity()),a}default:throw new Error("Unknown point format.")}}encodeX(){return this.curve.encodeField(this.getX())}static decodeEven(e,t){I(e instanceof Et);const r=e.decodeField(t);if(r.cmp(e.p)>=0)throw new Error("Invalid point.");return e.pointFromX(r,!1)}static decodeSquare(e,t){I(e instanceof Et);const r=e.decodeField(t);if(r.cmp(e.p)>=0)throw new Error("Invalid point.");return e.pointFromX(r)}toJSON(e){if(this.inf)return[];const t=this.getX().toJSON(),r=this.getY().toJSON();return e===!0&&this.pre?[t,r,this.pre.toJSON()]:[t,r]}toPretty(){if(this.inf)return[];const e=this.curve.fieldSize*2,t=Ma(this.getX(),e),r=Ma(this.getY(),e);return[t,r]}static fromJSON(e,t){if(I(e instanceof Et),I(Array.isArray(t)),I(t.length===0||t.length===2||t.length===3),t.length===0)return e.point();const r=W.fromJSON(t[0]),i=W.fromJSON(t[1]),n=e.point(r,i);return t.length>2&&t[2]!=null&&(n.pre=tf.fromJSON(n,t[2])),n}[Ca](){return this.inf?"<ShortPoint: Infinity>":"<ShortPoint: x="+this.x.fromRed().toString(16,2)+" y="+this.y.fromRed().toString(16,2)+">"}}class pn extends Qe{constructor(e,t,r,i){I(e instanceof Et),super(e,zi.JACOBIAN),this.x=this.curve.one,this.y=this.curve.one,this.z=this.curve.zero,this.zOne=0,t!=null&&this._init(t,r,i)}_init(e,t,r){I(e instanceof W),I(t instanceof W),I(r==null||r instanceof W),this.x=e,this.y=t,this.z=r||this.curve.one,this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z.eq(this.curve.one)|0}clone(){return this.curve.jpoint(this.x.clone(),this.y.clone(),this.z.clone())}swap(e,t){I(e instanceof pn);const r=(t>>31|-t>>31)&1,i=this.zOne,n=e.zOne;return this.x.cswap(e.x,t),this.y.cswap(e.y,t),this.z.cswap(e.z,t),this.zOne=i&(r^1)|n&r,e.zOne=n&(r^1)|i&r,this}validate(){const{a:e,b:t}=this.curve;if(this.isInfinity())return!0;if(this.zOne)return this.curve.validate(this.toP());const r=this.y.redSqr(),i=this.x.redSqr().redMul(this.x),n=this.z.redSqr(),s=n.redSqr(),a=s.redMul(n),c=i.redIAdd(t.redMul(a));return this.curve.zeroA||(this.curve.threeA?c.redIAdd(s.redIMuln(-3).redMul(this.x)):c.redIAdd(e.redMul(s).redMul(this.x))),r.eq(c)}normalize(){if(this.zOne)return this;if(this.isInfinity())return this;const e=this.z.redInvert(),t=e.redSqr();return this.x=this.x.redMul(t),this.y=this.y.redMul(t).redMul(e),this.z=this.curve.one,this.zOne=1,this}scale(e){if(I(e instanceof W),this.isInfinity())return this.curve.jpoint();const t=e.redSqr(),r=this.x.redMul(t),i=this.y.redMul(t).redMul(e),n=this.z.redMul(e);return this.curve.jpoint(r,i,n)}neg(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)}add(e){return I(e instanceof Qe),e.type===zi.AFFINE?this._mixedAdd(e):this._add(e)}_add(e){return I(e instanceof pn),this.isInfinity()?e:e.isInfinity()?this:this.zOne&&e.zOne?this._addAA(e):this.zOne?e._addJA(this):e.zOne?this._addJA(e):this._addJJ(e)}_mixedAdd(e){return I(e instanceof It),this.isInfinity()?e.toJ():e.isInfinity()?this:this.zOne?this._addAA(e):this._addJA(e)}_addJJ(e){const t=this.z.redSqr(),r=e.z.redSqr(),i=this.x.redMul(r),n=e.x.redMul(t),s=this.y.redMul(e.z).redMul(r),a=e.y.redMul(this.z).redMul(t),c=n.redISub(i),o=a.redISub(s);if(c.isZero())return o.isZero()?this.dbl():this.curve.jpoint();const d=c.redSqr(),l=c.redMul(d),u=i.redMul(d),p=o.redSqr().redISub(l).redISub(u).redISub(u),f=o.redMul(u.redISub(p)).redISub(s.redMul(l)),g=this.z.redMul(e.z).redMul(c);return this.curve.jpoint(p,f,g)}_addJA(e){const t=this.z.redSqr(),r=e.x.redMul(t),i=e.y.redMul(this.z).redMul(t),n=r.redISub(this.x),s=i.redISub(this.y).redIMuln(2);if(n.isZero())return s.isZero()?this.dbl():this.curve.jpoint();const a=n.redMuln(2).redSqr(),c=n.redMul(a),o=this.x.redMul(a),d=s.redSqr().redISub(c).redISub(o).redISub(o),l=s.redMul(o.redISub(d)).redISub(this.y.redMul(c).redIMuln(2)),u=this.z.redMul(n).redIMuln(2);return this.curve.jpoint(d,l,u)}_addAA(e){const t=e.x.redSub(this.x),r=e.y.redSub(this.y).redIMuln(2);if(t.isZero())return r.isZero()?this.dbl():this.curve.jpoint();const i=t.redSqr(),n=i.redIMuln(4),s=t.redMul(n),a=this.x.redMul(n),c=r.redSqr().redISub(s).redISub(a).redISub(a),o=r.redMul(a.redISub(c)).redISub(this.y.redMul(s).redIMuln(2)),d=t.redIMuln(2);return this.curve.jpoint(c,o,d)}dbl(){return this.isInfinity()?this:this.y.isZero()?this.curve.jpoint():this.zOne?this._dblA():this.curve.zeroA?this._dbl0():this.curve.threeA?this._dbl3():this._dblJ()}_dblJ(){const e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr(),i=this.x.redMul(t).redIMuln(4),n=e.redIMuln(3).redIAdd(this.curve.a.redMul(r.redSqr())),s=n.redSqr().redISub(i).redISub(i),a=s,c=n.redMul(i.redISub(s)).redISub(t.redSqr().redIMuln(8)),o=this.y.redMul(this.z).redIMuln(2);return this.curve.jpoint(a,c,o)}_dblA(){const e=this.x.redSqr(),t=this.y.redSqr(),r=t.redSqr(),i=t.redIAdd(this.x).redSqr(),n=i.redISub(e).redISub(r).redIMuln(2),s=e.redIMuln(3).redIAdd(this.curve.a),a=s.redSqr().redISub(n).redISub(n),c=a,o=s.redMul(n.redISub(a)).redISub(r.redIMuln(8)),d=this.y.redMuln(2);return this.curve.jpoint(c,o,d)}_dbl0(){const e=this.x.redSqr(),t=this.y.redSqr(),r=t.redSqr(),i=t.redIAdd(this.x).redSqr(),n=i.redISub(e).redISub(r).redIMuln(2),s=e.redIMuln(3),a=s.redSqr(),c=a.redISub(n).redISub(n),o=s.redMul(n.redISub(c)).redISub(r.redIMuln(8)),d=this.y.redMul(this.z).redIMuln(2);return this.curve.jpoint(c,o,d)}_dbl3(){const e=this.z.redSqr(),t=this.y.redSqr(),r=this.x.redMul(t),i=this.x.redSub(e),n=this.x.redAdd(e),s=i.redMul(n).redIMuln(3),a=r.redIMuln(4),c=a.redMuln(2),o=t.redSqr().redIMuln(8),d=s.redSqr().redISub(c),l=this.y.redAdd(this.z).redSqr().redISub(t).redISub(e),u=s.redMul(a.redISub(d)).redISub(o);return this.curve.jpoint(d,u,l)}dblp(e){return I(e>>>0===e),this.curve.zeroA||this.curve.threeA?super.dblp(e):e===0?this:this.isInfinity()?this:this._dblp(e)}_dblp(e){const{a:t,i2:r}=this.curve;let i=this.x,n=this.z,s=this.y.redMuln(2),a=n.redPown(4);for(let c=0;c<e;c++){if(s.isZero())return this.curve.jpoint();const o=i.redSqr(),d=s.redSqr(),l=d.redSqr(),u=o.redIMuln(3).redIAdd(t.redMul(a)),p=i.redMul(d),f=u.redSqr().redISub(p).redISub(p),g=f,v=u.redMul(p.redISub(f)).redIMuln(2).redISub(l),S=s.redMul(n);c+1<e&&(a=a.redMul(l)),i=g,s=v,n=S}return this.curve.jpoint(i,s.redMul(r),n)}uadd(e){return I(e instanceof Qe),e.type===zi.AFFINE?this._uadd(e.toJ()):this._uadd(e)}_uadd(e){I(e instanceof pn);const{zero:t,one:r}=this.curve,i=this.z.redSqr(),n=e.z.redSqr(),s=this.x.redMul(n),a=e.x.redMul(i),c=this.y.redMul(n).redMul(e.z),o=e.y.redMul(i).redMul(this.z),d=this.z.redMul(e.z),l=s.redAdd(a),u=c.redAdd(o),p=l.redSqr().redISub(s.redMul(a));if(!this.curve.zeroA){const y=d.redPown(4);this.curve.threeA?p.redIAdd(y.redIMuln(-3)):p.redIAdd(this.curve.a.redMul(y))}const f=u.czero()&p.czero();u.cinject(s.redSub(a),f),p.cinject(c.redSub(o),f);const g=u.redSqr(),v=l.redMul(g),S=g.redSqr();S.cinject(t,f);const C=p.redSqr(),D=d.redMul(u),j=v.redMuln(3).redISub(C).redISub(C),m=C.redISub(v).redIMuln(4),w=p.redMul(j).redISub(S).redIMuln(4),R=D.redIMuln(2),h=this.z.czero(),b=e.z.czero(),A=R.czero()&((h|b)^1);return m.cinject(e.x,h),w.cinject(e.y,h),R.cinject(e.z,h),m.cinject(this.x,b),w.cinject(this.y,b),R.cinject(this.z,b),m.cinject(r,A),w.cinject(r,A),R.cinject(t,A),this.curve.jpoint(m,w,R)}udbl(){const e=this._udbl(),t=this.z.czero()|this.y.czero();return e.x.cinject(this.curve.one,t),e.y.cinject(this.curve.one,t),e.z.cinject(this.curve.zero,t),e}_udbl(){return this.curve.zeroA?this._dbl0():this.curve.threeA?this._dbl3():this._dblJ()}zaddu(e){I(e instanceof pn);const t=this.x.redSub(e.x),r=this.y.redSub(e.y),i=t.redSqr(),n=this.x.redMul(i),s=e.x.redMul(i),a=n,c=r.redSqr().redISub(n).redISub(s),o=this.y.redMul(n.redSub(s)),d=r.redMul(a.redSub(c)).redISub(o),l=this.z.redMul(t),u=l;return[this.curve.jpoint(c,d,u),this.curve.jpoint(a,o,l)]}zaddc(e){I(e instanceof pn);const t=this.x.redSub(e.x),r=this.y.redSub(e.y),i=this.y.redAdd(e.y),n=t.redSqr(),s=this.x.redMul(n),a=e.x.redMul(n),c=i.redSqr().redISub(s).redISub(a),o=r.redSqr().redISub(s).redISub(a),d=this.y.redMul(a.redISub(s)),l=e.y.redMuln(2).redIAdd(r),u=s.redISub(c),p=c.redAdd(u).redISub(o),f=l.redMul(u).redIAdd(d),g=r.redMul(p).redIAdd(d),v=this.z.redMul(t),S=v;return[this.curve.jpoint(o,g,S),this.curve.jpoint(c,f,v)]}zdblu(){const e=this.x.redSqr(),t=this.y.redSqr(),r=t.redSqr(),i=this.x.redAdd(t).redSqr(),n=e.redMuln(3);if(!this.curve.zeroA){const u=this.z.redPown(4);this.curve.threeA?n.redIAdd(u.redIMuln(-3)):n.redIAdd(this.curve.a.redMul(u))}const s=i.redISub(e).redISub(r).redIMuln(2),a=n.redSqr().redISub(s).redISub(s),c=r.redIMuln(8),o=s.redSub(a).redMul(n).redISub(c),d=this.y.redMul(this.z).redIMuln(2),l=d;return[this.curve.jpoint(a,o,l),this.curve.jpoint(s,c,d)]}recover(e,t,r,i){return this.toP().recover(e,t,r,i)}getX(){if(this.isInfinity())throw new Error("Invalid point.");return this.normalize(),this.x.fromRed()}getY(){if(this.isInfinity())throw new Error("Invalid point.");return this.normalize(),this.y.fromRed()}eq(e){if(I(e instanceof pn),this===e)return!0;if(this.isInfinity())return e.isInfinity();if(e.isInfinity())return!1;if(this.z.eq(e.z))return this.x.eq(e.x)&&this.y.eq(e.y);const t=this.z.redSqr(),r=e.z.redSqr(),i=this.x.redMul(r),n=e.x.redMul(t);if(!i.eq(n))return!1;const s=t.redMul(this.z),a=r.redMul(e.z),c=this.y.redMul(a),o=e.y.redMul(s);return c.eq(o)}cmp(e){I(e instanceof pn);const t=this.isInfinity(),r=e.isInfinity();return t&&!r?-1:!t&&r?1:t&&r?0:this.order().cmp(e.order())||this.getX().cmp(e.getX())||this.getY().cmp(e.getY())}isInfinity(){return this.z.isZero()}isOrder2(){return this.isInfinity()?!1:this.y.isZero()}isOdd(){return this.isInfinity()?!1:(this.normalize(),this.y.redIsOdd())}isEven(){return this.isInfinity()?!1:(this.normalize(),this.y.redIsEven())}isSquare(){return this.isInfinity()?!1:this.y.redMul(this.z).redJacobi()!==-1}eqX(e){if(I(e instanceof W),I(!e.red),this.isInfinity())return!1;const t=this.z.redSqr(),r=e.toRed(this.curve.red).redMul(t);return this.x.eq(r)}eqR(e){if(I(e instanceof W),I(!e.red),!this.curve.smallGap)return this.toP().eqR(e);if(this.isInfinity())return!1;if(e.cmp(this.curve.p)>=0)return!1;const t=this.z.redSqr(),r=e.toRed(this.curve.red).redMul(t);if(this.x.eq(r))return!0;if(this.curve.highOrder)return!1;if(e.cmp(this.curve.pmodn)>=0)return!1;const i=this.curve.redN.redMul(t);return r.redIAdd(i),this.x.eq(r)}toP(){return this.isInfinity()?this.curve.point():(this.normalize(),this.curve.point(this.x,this.y))}toJ(){return this}encode(e){return this.toP().encode(e)}static decode(e,t){return It.decode(e,t).toJ()}encodeX(){return this.toP().encodeX()}static decodeEven(e,t){return It.decodeEven(e,t).toJ()}static decodeSquare(e,t){return It.decodeSquare(e,t).toJ()}toJSON(e){return this.toP().toJSON(e)}toPretty(){return this.toP().toPretty()}static fromJSON(e,t){return It.fromJSON(e,t).toJ()}[Ca](){return this.isInfinity()?"<JPoint: Infinity>":"<JPoint: x="+this.x.fromRed().toString(16,2)+" y="+this.y.fromRed().toString(16,2)+" z="+this.z.fromRed().toString(16,2)+">"}}class Nt extends Hr{constructor(e){super(ir,"mont",e);this.a=W.fromJSON(e.a).toRed(this.red),this.b=W.fromJSON(e.b).toRed(this.red),this.bi=this.b.redInvert(),this.a2=this.a.redAdd(this.two),this.a24=this.a2.redMul(this.i4),this.a3=this.a.redMul(this.i3),this.a0=this.a.redMul(this.bi),this.b0=this.bi.redSqr(),this._finalize(e)}static _isomorphism(e,t,r){I(e instanceof W),I(t instanceof W),I(r instanceof W);const i=e.clone(),n=r.clone(),s=t.redDiv(r);if(s.redJacobi()!==1)throw new Error("Invalid `b` coefficient.");return[i,n]}_short(e,t){const{a:r,b:i,three:n}=this,s=r.redSqr(),a=s.redMul(r),c=i.redSqr(),o=c.redMul(i),d=n.redSub(s),l=c.redMuln(3),u=a.redMuln(2).redISub(r.redMuln(9)),p=o.redMuln(27),f=d.redDiv(l),g=u.redDiv(p);return e!=null?Et._isomorphism(f,g,e,t):[f,g]}_mont(e){return Nt._isomorphism(this.a,this.b,e)}_edwards(e,t=!1){I(typeof t=="boolean");const{two:r,bi:i}=this,n=this.a.redAdd(r).redMul(i),s=this.a.redSub(r).redMul(i);return t&&n.swap(s),e!=null?pr._isomorphism(n,s,e):[n,s]}_scaleShort(e){I(e instanceof Et);const[t,r]=e._scale(this);return[this.field(t.redInvert()),this.field(r.redInvert())]}_scaleMont(e){return I(e instanceof Nt),this.g.isInfinity()||e.g.isInfinity()?this.field(e.b).redDivSqrt(this.b):this.g.y.redDiv(this.field(e.g.y))}_scaleEdwards(e,t){I(e instanceof pr);const r=e._scale(this,t);return this.field(r)}_solveY0(e){I(e instanceof W);const t=this.a0,r=this.b0,i=e.redSqr(),n=i.redMul(e),s=n.redIAdd(t.redMul(i)).redIAdd(r.redMul(e));return s}_elligator2(e){const t=this.a0.redNeg(),r=this.one.redAdd(this.z.redMul(e.redSqr()));r.cinject(this.one,r.czero());const i=t.redMul(r.redFermat()),n=i.redNeg().redISub(this.a0),s=this._solveY0(i),a=this._solveY0(n),c=s.redIsSquare()|0,o=i.cinject(n,c^1),d=s.cinject(a,c^1).redSqrt();d.cinject(d.redNeg(),d.redIsOdd()^e.redIsOdd());const l=this.b.redMul(o),u=this.b.redMul(d);return this.point(l,u)}_invert2(e,t){const{x:r,y:i}=e,n=t&1,s=r.redMul(this.bi),a=i.redMul(this.bi),c=s.redAdd(this.a0),o=s;c.cswap(o,n);const d=c.redINeg(),l=o.redMul(this.z),[u,p]=nf(d,l);if(p.cinject(p.redNeg(),p.redIsOdd()^a.redIsOdd()),!u)throw new Error("Invalid point.");return p}_constMul(e,t,r){I(e instanceof ir);const i=e.toX(),[n,s]=i.ladderConst(t,r),a=e.recover(n,s);return t.isNeg()?a.neg():a}isElliptic(){const e=this.a.redSqr(),t=this.b.redMul(e.redSub(this.four));return!t.isZero()}jinv(){const{a:e,three:t,four:r}=this,i=e.redSqr(),n=i.redSub(t),s=n.redPown(3).redIMuln(256),a=i.redSub(r);if(a.isZero())throw new Error("Curve is not elliptic.");return s.redDiv(a).fromRed()}point(e,t,r=0){return new ir(this,e,t,r)}jpoint(e,t,r){return I(e==null&&t==null&&r==null),this.point()}xpoint(e,t){return new Vr(this,e,t)}solveY2(e){I(e instanceof W);const t=e.redSqr(),r=t.redMul(e),i=r.redIAdd(this.a.redMul(t)).redIAdd(e),n=i.redMul(this.bi);return n}validate(e){if(I(e instanceof ir),e.isInfinity())return!0;const{x:t,y:r}=e,i=this.solveY2(t);return r.redSqr().eq(i)}pointFromX(e,t=null){I(e instanceof W),I(t==null||typeof t=="boolean"),e.red||(e=e.toRed(this.red));const r=this.solveY(e);if(t!=null){if(r.isZero()&&t)throw new Error("Invalid point.");r.redIsOdd()!==t&&r.redINeg()}return this.point(e,r)}isIsomorphic(e,t){if(I(e instanceof Hr),!e.p.eq(this.p))return!1;if(e.type==="mont"){const r=this.field(e.a),i=this.field(e.b);if(!this.a.eq(r))return!1;if(this.b.isZero())return!1;const n=i.redDiv(this.b);return n.redJacobi()===1}return e.isIsomorphic(this,t)}isIsogenous(e){return I(e instanceof Hr),e.type==="mont"?!1:e.isIsogenous(this)}pointFromShort(e){if(I(e instanceof It),this.isIsomorphic(e.curve)){if(e.isInfinity())return this.point();const{a3:t,b:r}=this,[i,n]=this._scale(e.curve),s=this.field(e.x).redMul(i),a=this.field(e.y).redMul(n),c=r.redMul(s).redISub(t),o=r.redMul(a);return this.point(c,o)}throw new Error("Not implemented.")}pointFromMont(e){if(I(e instanceof ir),this.isIsomorphic(e.curve)){if(e.isInfinity())return this.point();const t=this._scale(e.curve),r=this.field(e.x),i=this.field(e.y),n=r,s=t.redMul(i);return this.point(n,s)}throw new Error("Not implemented.")}pointFromEdwards(e){I(e instanceof mr),I(e.curve.p.eq(this.p));const t=this.field(e.x),r=this.field(e.y),i=this.field(e.z);if(this.isIsogenous(e.curve)){if(e.isInfinity())return this.point();if(e.x.isZero())return this.point(this.zero,this.zero);const n=i.redSqr().redIMuln(2),s=r.redSqr(),a=t.redSqr(),c=n.redISub(a).redISub(s).redMul(r),o=a.redMul(t);return this.cpoint(s,a,c,o)}if(this.isIsomorphic(e.curve,!0)){if(e.isInfinity())return this.point();if(e.x.isZero())return this.point(this.zero,this.zero);const n=this._scale(e.curve,!0),s=r.redAdd(i),a=r.redSub(i),c=n.redMul(i).redMul(s),o=t.redMul(a);return this.cpoint(s,a,c,o)}if(this.isIsomorphic(e.curve,!1)){if(e.isInfinity())return this.point();if(e.x.isZero())return this.point(this.zero,this.zero);const n=this._scale(e.curve,!1),s=i.redAdd(r),a=i.redSub(r),c=n.redMul(i).redMul(s),o=t.redMul(a);return this.cpoint(s,a,c,o)}throw new Error("Not implemented.")}pointFromUniform(e){if(I(e instanceof W),this.z.isZero()||this.a.isZero())throw new Error("Not implemented.");return this._elligator2(e)}pointToUniform(e,t){if(I(e instanceof ir),I(t>>>0===t),this.z.isZero()||this.a.isZero())throw new Error("Not implemented.");if(e.isInfinity())throw new Error("Invalid point.");const r=(t>>>4&15)%this.torsion.length,i=e.add(this.torsion[r]);return this._invert2(i,t)}decodePoint(e,t){return ir.decode(this,e,t)}encodeX(e){return I(e instanceof Vr),e.encode()}decodeX(e){return Vr.decode(this,e)}toShort(e,t,r=null){const[i,n]=this._short(e,t),s=new Et({red:this.red,prime:this.prime,p:this.p,a:i,b:n,n:this.n,h:this.h});if(r!=null){const[,a]=s._scale(this);a.redIsOdd()!==r&&a.redINeg()}this.g.isInfinity()||(s.g=s.pointFromMont(this.g));for(let a=0;a<this.h.word(0);a++)s.torsion[a]=s.pointFromMont(this.torsion[a]);return s}toMont(e,t=null){const[r,i]=this._mont(e),n=new Nt({red:this.red,prime:this.prime,p:this.p,a:r,b:i,n:this.n,h:this.h,z:this.z});if(t!=null){const s=n._scale(this);s.redIsOdd()!==t&&s.redINeg()}this.g.isInfinity()||(n.g=n.pointFromMont(this.g));for(let s=0;s<this.h.word(0);s++)n.torsion[s]=n.pointFromMont(this.torsion[s]);return n}toEdwards(e,t,r=null){const[i,n]=this._edwards(e,t),s=new pr({red:this.red,prime:this.prime,p:this.p,a:i,d:n,n:this.n,h:this.h,z:this.z});if(r!=null){const a=s._scale(this,t);a.redIsOdd()!==r&&a.redINeg()}if(this.g.isInfinity()||(s.g=s.pointFromMont(this.g),s.g.normalize()),s.isComplete())for(let a=0;a<this.h.word(0);a++)s.torsion[a]=s.pointFromMont(this.torsion[a]),s.torsion[a].normalize();return s}pointFromJSON(e){return ir.fromJSON(this,e)}toJSON(e){const t=super.toJSON(e);return t.a=this.a.fromRed().toJSON(),t.b=this.b.fromRed().toJSON(),t}}class ir extends Qe{constructor(e,t,r,i){I(e instanceof Nt),super(e,zi.AFFINE),this.x=this.curve.zero,this.y=this.curve.zero,this.inf=1,t!=null&&this._init(t,r,i)}_init(e,t,r){I(e instanceof W),I(t instanceof W),this.x=e,this.y=t,this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=r|0}clone(){return this.curve.point(this.x.clone(),this.y.clone(),this.inf)}swap(e,t){I(e instanceof ir);const r=(t>>31|-t>>31)&1,i=this.inf,n=e.inf;return this.x.cswap(e.x,t),this.y.cswap(e.y,t),this.inf=i&(r^1)|n&r,e.inf=n&(r^1)|i&r,this}scale(e){return this.clone()}randomize(e){return this.clone()}neg(){return this.inf?this:this.curve.point(this.x,this.y.redNeg())}add(e){if(I(e instanceof ir),this.inf)return e;if(e.inf)return this;if(this.x.eq(e.x))return this.y.eq(e.y)?this.dbl():this.curve.point();const t=e.x.redSub(this.x),r=e.y.redSub(this.y),i=r.redDiv(t),n=this.curve.b.redMul(i.redSqr()),s=n.redISub(this.curve.a).redISub(this.x).redISub(e.x),a=i.redMul(this.x.redSub(s)).redISub(this.y);return this.curve.point(s,a)}dbl(){if(this.inf)return this;if(this.y.isZero())return this.curve.point();const e=this.x.redSqr().redIMuln(3),t=this.curve.a.redMul(this.x).redIMuln(2),r=e.redIAdd(t).redIAdd(this.curve.one),i=this.curve.b.redMul(this.y).redIMuln(2),n=r.redDiv(i),s=this.curve.b.redMul(n.redSqr()),a=s.redISub(this.curve.a).redISub(this.x).redISub(this.x),c=n.redMul(this.x.redSub(a)).redISub(this.y);return this.curve.point(a,c)}uadd(e){I(e instanceof ir);const t=e.x.redSub(this.x),r=e.y.redSub(this.y),i=this.x.redSqr().redIMuln(3),n=this.curve.a.redMul(this.x).redIMuln(2),s=i.redIAdd(n).redIAdd(this.curve.one),a=this.curve.b.redMul(this.y).redIMuln(2),c=t.czero()&r.czero();r.cinject(s,c),t.cinject(a,c);const o=t.czero()&((this.inf|e.inf)^1);t.cinject(this.curve.one,t.czero());const d=r.redMul(t.redFermat()),l=this.curve.b.redMul(d.redSqr()),u=l.redISub(this.curve.a).redISub(this.x).redISub(e.x),p=d.redMul(this.x.redSub(u)).redISub(this.y),f=o|this.inf&e.inf;return u.cinject(e.x,this.inf),p.cinject(e.y,this.inf),u.cinject(this.x,e.inf),p.cinject(this.y,e.inf),u.cinject(this.curve.zero,f),p.cinject(this.curve.zero,f),this.curve.point(u,p,f)}udbl(){return this.uadd(this)}recover(e,t){if(I(e instanceof Vr),I(t instanceof Vr),this.inf)return this.curve.point();const r=this.x.redMul(e.z),i=e.x.redAdd(r),n=e.x.redSub(r).redSqr().redMul(t.x),s=this.curve.a.redMul(e.z).redIMuln(2),a=i.redIAdd(s),c=this.x.redMul(e.x).redIAdd(e.z),o=a.redMul(c),d=s.redMul(e.z),l=o.redISub(d).redMul(t.z),u=this.curve.b.redMul(this.y).redIMuln(2),p=u.redMul(e.z).redMul(t.z),f=p.redMul(e.x),g=l.redISub(n),v=p.redMul(e.z);if(v.isZero())return this.curve.point();const S=v.redInvert(),C=f.redMul(S),D=g.redMul(S);return this.curve.point(C,D)}getX(){if(this.inf)throw new Error("Invalid point.");return this.x.fromRed()}getY(){if(this.inf)throw new Error("Invalid point.");return this.y.fromRed()}eq(e){return I(e instanceof ir),this===e?!0:this.inf?e.inf!==0:e.inf?!1:this.x.eq(e.x)&&this.y.eq(e.y)}cmp(e){return I(e instanceof ir),this.inf&&!e.inf?-1:!this.inf&&e.inf?1:this.inf&&e.inf?0:this.order().cmp(e.order())||this.getX().cmp(e.getX())||this.getY().cmp(e.getY())}isInfinity(){return this.inf!==0}isOrder2(){return this.inf?!1:this.y.isZero()}isOdd(){return this.inf?!1:this.y.redIsOdd()}isEven(){return this.inf?!1:this.y.redIsEven()}toP(){return this}toJ(){return this}toX(){return this.inf?this.curve.xpoint():this.curve.xpoint(this.x,this.curve.one)}encode(){return this.toX().encode()}static decode(e,t,r){return I(e instanceof Nt),e.decodeX(t).toP(r)}toJSON(e){if(this.inf)return[];const t=this.getX().toJSON(),r=this.getY().toJSON();return[t,r]}toPretty(){if(this.inf)return[];const e=this.curve.fieldSize*2,t=Ma(this.getX(),e),r=Ma(this.getY(),e);return[t,r]}static fromJSON(e,t){if(I(e instanceof Nt),I(Array.isArray(t)),I(t.length===0||t.length===2||t.length===3),t.length===0)return e.point();const r=W.fromJSON(t[0]),i=W.fromJSON(t[1]);return e.point(r,i)}[Ca](){return this.inf?"<MontPoint: Infinity>":"<MontPoint: x="+this.x.fromRed().toString(16,2)+" y="+this.y.fromRed().toString(16,2)+">"}}class Vr extends Qe{constructor(e,t,r){I(e instanceof Nt),super(e,zi.PROJECTIVE),this.x=this.curve.one,this.z=this.curve.zero,t!=null&&this._init(t,r)}_init(e,t){I(e instanceof W),I(t==null||t instanceof W),this.x=e,this.z=t||this.curve.one,this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red))}clone(){return this.curve.xpoint(this.x.clone(),this.z.clone())}swap(e,t){return I(e instanceof Vr),this.x.cswap(e.x,t),this.z.cswap(e.z,t),this}precompute(e,t){return this}validate(){if(this.isInfinity())return!0;const{x:e,z:t}=this,r=e.redSqr(),i=r.redMul(e),n=t.redSqr(),s=this.curve.a.redMul(r).redMul(t),a=i.redIAdd(s).redIAdd(e.redMul(n)),c=a.redMul(this.curve.bi);return c.redMul(t).redJacobi()!==-1}normalize(){return this.isInfinity()?this:this.z.eq(this.curve.one)?this:(this.x=this.x.redDiv(this.z),this.z=this.curve.one,this)}scale(e){if(I(e instanceof W),this.isInfinity())return this.curve.xpoint();const t=this.x.redMul(e),r=this.z.redMul(e);return this.curve.xpoint(t,r)}neg(){return this}dbl(){const e=this.x.redAdd(this.z),t=e.redSqr(),r=this.x.redSub(this.z),i=r.redSqr(),n=t.redSub(i),s=t.redMul(i),a=n.redMul(i.redIAdd(this.curve.a24.redMul(n)));return this.curve.xpoint(s,a)}diffAdd(e,t){I(e instanceof Vr),I(t instanceof Vr);const r=e.x.redAdd(e.z),i=e.x.redSub(e.z),n=t.x.redAdd(t.z),s=t.x.redSub(t.z),a=s.redMul(r),c=n.redMul(i),o=this.z.redMul(a.redAdd(c).redSqr()),d=this.x.redMul(a.redISub(c).redSqr());return this.curve.xpoint(o,d)}diffAddDbl(e,t){I(e instanceof Vr),I(t instanceof Vr);const r=e.x.redAdd(e.z),i=r.redSqr(),n=e.x.redSub(e.z),s=n.redSqr(),a=i.redSub(s),c=t.x.redAdd(t.z),o=t.x.redSub(t.z),d=o.redMul(r),l=c.redMul(n),u=this.z.redMul(d.redAdd(l).redSqr()),p=this.x.redMul(d.redISub(l).redSqr()),f=i.redMul(s),g=a.redMul(s.redIAdd(this.curve.a24.redMul(a)));return[this.curve.xpoint(f,g),this.curve.xpoint(u,p)]}getX(){if(this.isInfinity())throw new Error("Invalid point.");return this.normalize(),this.x.fromRed()}getY(e){return this.toP(e).getY()}eq(e){if(I(e instanceof Vr),this===e)return!0;if(this.isInfinity())return e.isInfinity();if(e.isInfinity())return!1;if(this.z.eq(e.z))return this.x.eq(e.x);const t=this.x.redMul(e.z),r=e.x.redMul(this.z);return t.eq(r)}cmp(e){I(e instanceof Vr);const t=this.isInfinity(),r=e.isInfinity();return t&&!r?-1:!t&&r?1:t&&r?0:this.order().cmp(e.order())||this.getX().cmp(e.getX())}isInfinity(){return this.z.isZero()}isOrder2(){return this.isInfinity()?!1:this.x.isZero()}isOdd(){return!1}isEven(){return!1}hasTorsion(){return this.isInfinity()?!1:this.x.isZero()?!0:super.hasTorsion()}order(){try{return this.toP().order()}catch(e){return new W(1)}}jmul(e){return this.ladder(e)[0]}jmulSimple(e){return this.ladderSimple(e)[0]}jmulBlind(e,t){return this.ladderBlind(e,t)[0]}jmulConst(e,t){return this.ladderConst(e,t)[0]}jmulAdd(e,t,r){throw new Error("Not implemented.")}jmulAddSimple(e,t,r){throw new Error("Not implemented.")}ladder(e){I(e instanceof W),I(!e.red);const t=e.bitLength();let r=this.curve.xpoint(),i=this;for(let n=t-1;n>=0;n--){const s=e.bit(n);s===0?[r,i]=this.diffAddDbl(r,i):[i,r]=this.diffAddDbl(i,r)}return[r,i]}ladderSimple(e){I(e instanceof W),I(!e.red);const t=e.bitLength();let r=this.curve.xpoint(),i=this;for(let n=t-1;n>=0;n--){const s=e.bit(n);s===0?(i=this.diffAdd(i,r),r=r.dbl()):(r=this.diffAdd(r,i),i=i.dbl())}return[r,i]}ladderBlind(e,t){return t?this.randomize(t).ladder(e):this.ladder(e)}ladderConst(e,t){I(e instanceof W),I(!e.red);const r=Math.max(e.bitLength(),this.curve.fieldBits),i=r+7>>>3,n=e.toArray("le",i),s=t?this.randomize(t):this;let a=this.curve.xpoint().clone(),c=s.clone(),o=0;for(let d=r-1;d>=0;d--){const l=n[d>>3]>>(d&7)&1;a.swap(c,o^l),[a,c]=s.diffAddDbl(a,c),o=l}return a.swap(c,o),[a,c]}toP(e=null){return I(e==null||typeof e=="boolean"),this.isInfinity()?this.curve.point():(this.normalize(),this.curve.pointFromX(this.x,e))}toJ(){return this}toX(){return this}key(){if(this.isInfinity())return`${this.curve.uid}:oo`;this.normalize();const e=this.getX().toString(16);return`${this.curve.uid}:${e}`}encode(){return this.curve.encodeField(this.getX())}static decode(e,t){I(e instanceof Nt);const r=e.decodeField(t);r.iumaskn(e.fieldBits);const i=e.xpoint(r,e.one);return I(!i.isInfinity()),i}toJSON(e){return this.toP().toJSON(e)}toPretty(){return this.toP().toPretty()}static fromJSON(e,t){return ir.fromJSON(e,t).toX()}[Ca](){return this.isInfinity()?"<XPoint: Infinity>":"<XPoint: x="+this.x.fromRed().toString(16,2)+" z="+this.z.fromRed().toString(16,2)+">"}}class pr extends Hr{constructor(e){super(mr,"edwards",e);this.a=W.fromJSON(e.a).toRed(this.red),this.d=W.fromJSON(e.d).toRed(this.red),this.s=W.fromJSON(e.s||"0").toRed(this.red),this.si=this.s.isZero()?this.zero:this.s.redInvert(),this.k=this.d.redMuln(2),this.smi=-this.d.redNeg().word(0),this.ad6=this.a.redAdd(this.d).redMul(this.i6),this.twisted=!this.a.eq(this.one),this.oneA=this.a.eq(this.one),this.mOneA=this.a.eq(this.one.redNeg()),this.smallD=this.prime!=null&&this.d.redNeg().length===1,this.alt=null,this._finalize(e)}static _isomorphism(e,t,r){I(e instanceof W),I(t instanceof W),I(r instanceof W);const i=r.clone(),n=r.redMul(t).redDiv(e),s=e.redDiv(r);if(s.redJacobi()!==1)throw new Error("Invalid `a` coefficient.");return[i,n]}_short(e,t){const{a:r,d:i}=this,n=r.redSqr(),s=n.redMul(r),a=i.redSqr(),c=a.redMul(i),o=r.redMul(i).redIMuln(14),d=n.redMul(i),l=r.redMul(a),u=d.redIAdd(l).redIMuln(33),p=n.redAdd(o).redIAdd(a).redDivn(-48),f=u.redISub(s).redISub(c).redDivn(864);return e!=null?Et._isomorphism(p,f,e,t):[p,f]}_mont(e,t=!1){I(typeof t=="boolean");let r,i;t?(r=this.d.redAdd(this.a),i=this.d.redSub(this.a)):(r=this.a.redAdd(this.d),i=this.a.redSub(this.d));const n=i.redInvert(),s=r.redMuln(2).redMul(n),a=n.redMuln(4);return e!=null?Nt._isomorphism(s,a,e):[s,a]}_edwards(e){return pr._isomorphism(this.a,this.d,e)}_scaleShort(e){I(e instanceof Et);const[t,r]=e._scale(this);return[this.field(t.redInvert()),this.field(r.redInvert())]}_scaleMont(e,t=!1){if(I(e instanceof Nt),I(typeof t=="boolean"),this.g.isInfinity()||e.g.isInfinity()){const[i]=e._edwards(null,t);return this.field(i).redDivSqrt(this.a)}const r=e.g.x.redDiv(e.g.y);return this.g.x.redDiv(this.field(r))}_scaleEdwards(e){return I(e instanceof pr),this.g.isInfinity()||e.g.isInfinity()?this.field(e.a).redDivSqrt(this.a):this.g.x.redDiv(this.field(e.g.x))}_mulA(e){return I(e instanceof W),this.oneA?e.clone():this.mOneA?e.redNeg():this.a.redMul(e)}_mulD(e){return I(e instanceof W),this.smallD?e.redMuln(this.smi):this.d.redMul(e)}_elligator1(e){const{s:t,si:r,i2:i,one:n,two:s}=this,a=r.redSqr().redIMuln(2),c=t.redSqr().redMul(i),o=c.redSqr(),d=a.redAdd(c),l=d.redSqr().redISub(s),u=a.redSub(n),p=this.p.subn(2),f=this.p.subn(1).iushrn(1),g=this.p.addn(1).iushrn(2),v=n.redSub(e),S=n.redAdd(e),C=v.redMul(S.redPow(p)),D=C.redSqr(),j=D.redMul(C),m=j.redMul(D),w=m.redAdd(l.redMul(j)).redIAdd(C),R=w.redPow(f),h=D.redAdd(o).redPow(f),b=R.redMul(h),A=R.redMul(C),y=R.redMul(w).redPow(g).redMul(b),P=n.redAdd(A),N=d.redMul(A),B=P.redSqr(),L=u.redMul(t).redMul(A).redMul(P),F=y.cinject(this.one,C.czero()),z=N.redSub(B),X=N.redAdd(B);return this.cpoint(L,F,z,X)}_invert1(e,t){const{s:r,si:i,i2:n,one:s}=this,{x:a,y:c,z:o}=e,d=t&1,l=i.redSqr().redIMuln(2),u=r.redSqr().redMul(n),p=u.redSqr(),f=l.redAdd(u),g=l.redSub(s),v=this.p.subn(2),S=this.p.subn(1).iushrn(1),C=this.p.addn(1).iushrn(2),D=c.redSub(o),j=c.redAdd(o).redIMuln(2),m=D.redMul(j.redPow(v)),w=s.redAdd(m.redMul(f)),R=w.redSqr().redISub(s),h=R.redPow(C),b=h.redSqr().ceq(R),A=h.redSub(w),y=s.redAdd(A),P=g.redMul(r).redMul(A).redMul(y),N=P.redMul(a.redMul(o)),B=A.redSqr().redIAdd(p),L=N.redMul(B).redPow(S),F=L.redMul(A),z=s.redSub(F),X=s.redAdd(F),Z=z.redMul(X.redPow(v));if(Z.cinject(Z.redNeg(),Z.redIsOdd()^d),!b)throw new Error("Invalid point.");return Z}_alt(){return this.alt||(this.alt=this.toMont()),this.alt}isElliptic(){const e=this.a.redMul(this.d),t=this.a.redSub(this.d);return!e.redMul(t).isZero()}jinv(){const{a:e,d:t}=this,r=e.redMul(t),i=e.redSub(t).redPown(4),n=e.redSqr(),s=t.redSqr(),a=n.redAdd(r.redMuln(14)).redIAdd(s),c=a.redPown(3).redIMuln(16),o=r.redMul(i);if(o.isZero())throw new Error("Curve is not elliptic.");return c.redDiv(o).fromRed()}isComplete(){return this.a.redJacobi()===1&&this.d.redJacobi()===-1}point(e,t,r,i){return new mr(this,e,t,r,i)}jpoint(e,t,r){return I(e==null&&t==null&&r==null),this.point()}cpoint(e,t,r,i){I(e instanceof W),I(t instanceof W),I(r instanceof W),I(i instanceof W);const n=e.redMul(i),s=r.redMul(t),a=t.redMul(i),c=e.redMul(r);return this.point(n,s,a,c)}solveX2(e){I(e instanceof W);const t=e.redSqr(),r=this._mulD(t).redISub(this.a),i=t.redISub(this.one),n=i.redDiv(r);return n}solveX(e){const t=e.redSqr(),r=this._mulD(t).redISub(this.a),i=t.redISub(this.one);return i.redDivSqrt(r)}solveY2(e){I(e instanceof W);const t=e.redSqr(),r=this._mulA(t).redISub(this.one),i=this._mulD(t).redISub(this.one),n=r.redDiv(i);return n}solveY(e){const t=e.redSqr(),r=this._mulA(t).redISub(this.one),i=this._mulD(t).redISub(this.one);return r.redDivSqrt(i)}validate(e){if(I(e instanceof mr),e.zOne){const l=e.x.redSqr(),u=e.y.redSqr(),p=this._mulD(l).redMul(u),f=this._mulA(l).redIAdd(u),g=this.one.redAdd(p),v=e.t,S=e.x.redMul(e.y);return f.eq(g)&&v.eq(S)}const t=e.x.redSqr(),r=e.y.redSqr(),i=e.z.redSqr(),n=i.redSqr(),s=this._mulD(t).redMul(r),a=this._mulA(t).redIAdd(r).redMul(i),c=n.redIAdd(s),o=e.t.redMul(e.z),d=e.x.redMul(e.y);return a.eq(c)&&o.eq(d)}pointFromX(e,t=null){I(e instanceof W),I(t==null||typeof t=="boolean"),e.red||(e=e.toRed(this.red));const r=this.solveY(e);if(t!=null){if(r.isZero()&&t)throw new Error("Invalid point.");r.redIsOdd()!==t&&r.redINeg()}return this.point(e,r)}pointFromY(e,t=null){I(e instanceof W),I(t==null||typeof t=="boolean"),e.red||(e=e.toRed(this.red));const r=this.solveX(e);if(t!=null){if(r.isZero()&&t)throw new Error("Invalid point.");r.redIsOdd()!==t&&r.redINeg()}return this.point(r,e)}isIsomorphic(e,t=!1){if(I(e instanceof Hr),I(typeof t=="boolean"),!e.p.eq(this.p))return!1;if(e.type==="short")return e.isIsomorphic(this);if(e.type==="mont"){const r=this.field(e.a);let i,n;return t?(i=this.d.redAdd(this.a),n=this.d.redSub(this.a)):(i=this.a.redAdd(this.d),n=this.a.redSub(this.d)),r.redMul(n).eq(i.redIMuln(2))}if(e.type==="edwards"){const r=this.field(e.a),i=this.field(e.d);return this.a.redMul(i).eq(r.redMul(this.d))}return!1}isIsogenous(e){if(I(e instanceof Hr),!e.p.eq(this.p))return!1;if(e.type==="mont"){if(!this.a.eq(this.one))return!1;const t=this.field(e.a),r=this.field(e.b),i=this.two.redSub(this.d.redMuln(4));return t.eq(i)&&r.eq(this.one)}if(e.type==="edwards"){const t=this.field(e.a),r=this.field(e.d);return t.eq(this.a.redNeg())&&r.eq(this.d.redSub(this.a))}return!1}pointFromShort(e){if(I(e instanceof It),this.isIsomorphic(e.curve)){if(e.isInfinity())return this.point();if(e.y.isZero())return this.point(this.zero,this.one.redNeg());const{a:t,d:r}=this,[i,n]=this._scale(e.curve),s=t.redMuln(5),a=r.redMuln(5),c=this.field(e.x).redMul(i),o=this.field(e.y).redMul(n),d=c.redMuln(6),l=c.redMuln(12),u=d.redSub(t).redISub(r),p=o.redMuln(6),f=l.redSub(s).redIAdd(r),g=l.redAdd(t).redISub(a);return this.cpoint(u,p,f,g)}throw new Error("Not implemented.")}pointFromMont(e){I(e instanceof ir),I(e.curve.p.eq(this.p));const t=this.field(e.x),r=this.field(e.y);if(this.isIsogenous(e.curve)){if(e.isInfinity())return this.point();if(e.x.isZero())return this.point();const i=t.redSqr(),n=i.redMul(t),s=n.redMul(t),a=s.redMul(t),c=r.redSqr(),o=r.redMuln(4),d=i.redSub(this.one),l=i.redMuln(2),u=c.redMuln(4),p=n.redIMuln(2),f=t.redMul(c).redIMuln(4),g=i.redMul(c).redIMuln(2),v=c.redIMuln(2),S=o.redMul(d),C=s.redISub(l).redIAdd(u).redIAdd(this.one),D=a.redSub(p).redISub(f).redIAdd(t).redINeg(),j=a.redISub(g).redISub(p).redISub(v).redIAdd(t);return this.cpoint(S,C,D,j).divn(4)}if(this.isIsomorphic(e.curve,!0)){if(e.isInfinity())return this.point();if(e.x.isZero())return this.point(this.zero,this.one.redNeg());const i=this._scale(e.curve,!0),n=i.redMul(t),s=r,a=t.redAdd(this.one),c=t.redSub(this.one);return this.cpoint(n,s,a,c)}if(this.isIsomorphic(e.curve,!1)){if(e.isInfinity())return this.point();if(e.x.isZero())return this.point(this.zero,this.one.redNeg());const i=this._scale(e.curve,!1),n=i.redMul(t),s=r,a=t.redSub(this.one),c=t.redAdd(this.one);return this.cpoint(n,s,a,c)}throw new Error("Not implemented.")}pointFromEdwards(e){I(e instanceof mr),I(e.curve.p.eq(this.p));const t=this.field(e.curve.a),r=this.field(e.x),i=this.field(e.y),n=this.field(e.z),s=this.field(e.t);if(this.isIsogenous(e.curve)){const a=r.redMul(i),c=r.redSqr(),o=i.redSqr(),d=n.redSqr(),l=t.redMul(c),u=a.redIMuln(2),p=o.redSub(l),f=o.redAdd(l),g=d.redIMuln(2).redISub(f),v=this.cpoint(u,p,f,g);return this.twisted?v:v.divn(4)}if(this.isIsomorphic(e.curve)){const a=this._scale(e.curve),c=a.redMul(r),o=i,d=n,l=a.redMul(s);return this.point(c,o,d,l)}throw new Error("Not implemented.")}pointFromUniform(e,t=null){I(e instanceof W),I(e.red===this.red),I(t==null||t instanceof Nt),t||(t=this._alt());const r=t.field(e),i=t.pointFromUniform(r);return this.pointFromMont(i)}pointToUniform(e,t,r=null){I(e instanceof mr),I(t>>>0===t),I(r==null||r instanceof Nt),r||(r=this._alt());const i=(t>>4&15)%this.torsion.length,n=e.add(this.torsion[i]),s=r.pointFromEdwards(n),a=r.pointToUniform(s,t&15);return this.field(a)}pointFromHash(e,t,r=null){I(r==null||r instanceof Nt),r||(r=this._alt());const i=r.pointFromHash(e,t);return this.pointFromMont(i)}pointToHash(e,t,r,i=null){I(e instanceof mr),I(t>>>0===t),I(i==null||i instanceof Nt),i||(i=this._alt());const n=t%this.torsion.length,s=e.add(this.torsion[n]),a=i.pointFromEdwards(s);return i.pointToHash(a,0,r)}decodePoint(e){return mr.decode(this,e)}toShort(e,t,r=null){const[i,n]=this._short(e,t),s=new Et({red:this.red,prime:this.prime,p:this.p,a:i,b:n,n:this.n,h:this.h});if(r!=null){const[,a]=s._scale(this);a.redIsOdd()!==r&&a.redINeg()}this.g.isInfinity()||(s.g=s.pointFromEdwards(this.g));for(let a=0;a<this.h.word(0);a++)s.torsion[a]=s.pointFromEdwards(this.torsion[a]);return s}toMont(e,t,r=null){const[i,n]=this._mont(e,t),s=new Nt({red:this.red,prime:this.prime,p:this.p,a:i,b:n,n:this.n,h:this.h,z:this.z});if(r!=null){const a=this._scale(s,t);a.redIsOdd()!==r&&a.redINeg()}this.g.isInfinity()||(s.g=s.pointFromEdwards(this.g));for(let a=0;a<this.h.word(0);a++)s.torsion[a]=s.pointFromEdwards(this.torsion[a]);return s}toEdwards(e,t=null){const[r,i]=this._edwards(e),n=new pr({red:this.red,prime:this.prime,p:this.p,a:r,d:i,n:this.n,h:this.h,z:this.z});if(t!=null){const s=n._scale(this);s.redIsOdd()!==t&&s.redINeg()}if(this.g.isInfinity()||(n.g=n.pointFromEdwards(this.g),n.g.normalize()),n.isComplete())for(let s=0;s<this.h.word(0);s++)n.torsion[s]=n.pointFromEdwards(this.torsion[s]),n.torsion[s].normalize();return n}pointFromJSON(e){return mr.fromJSON(this,e)}toJSON(e){const t=super.toJSON(e);return t.a=this.a.fromRed().toJSON(),t.d=this.d.fromRed().toJSON(),this.s.isZero()||(t.s=this.s.fromRed().toJSON()),t}}class mr extends Qe{constructor(e,t,r,i,n){I(e instanceof pr),super(e,zi.EXTENDED),this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=1,t!=null&&this._init(t,r,i,n)}_init(e,t,r,i){I(e instanceof W),I(t instanceof W),I(r==null||r instanceof W),I(i==null||i instanceof W),this.x=e,this.y=t,this.z=r||this.curve.one,this.t=i||null,this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z.eq(this.curve.one)|0,this._check(),this.t||(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redDiv(this.z)))}_check(){if(this.z.isZero())throw new Error("Invalid point.")}clone(){return this.curve.point(this.x.clone(),this.y.clone(),this.z.clone(),this.t.clone())}swap(e,t){I(e instanceof mr);const r=(t>>31|-t>>31)&1,i=this.zOne,n=e.zOne;return this.x.cswap(e.x,t),this.y.cswap(e.y,t),this.z.cswap(e.z,t),this.t.cswap(e.t,t),this.zOne=i&(r^1)|n&r,e.zOne=n&(r^1)|i&r,this}normalize(){if(this.zOne)return this;const e=this.z.redInvert();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t=this.t.redMul(e),this.z=this.curve.one,this.zOne=1,this}scale(e){I(e instanceof W);const t=this.x.redMul(e),r=this.y.redMul(e),i=this.z.redMul(e),n=this.t.redMul(e);return this.curve.point(t,r,i,n)}neg(){const e=this.x.redNeg(),t=this.y,r=this.z,i=this.t.redNeg();return this.curve.point(e,t,r,i)}add(e){return I(e instanceof mr),this.isInfinity()?e:e.isInfinity()?this:this.zOne?e._add(this,0):this._add(e,0)}_add(e,t){return this.curve.mOneA?this._addM1(e,t):this._addA(e,t)}_addM1(e,t){const r=e.zOne&(t^1),i=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),n=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),s=this.t.redMul(this.curve.k).redMul(e.t),a=r?this.z.redAdd(this.z):this.z.redMul(e.z).redIMuln(2),c=n.redSub(i),o=a.redSub(s),d=a.redIAdd(s),l=n.redIAdd(i),u=c.redMul(o),p=d.redMul(l),f=c.redMul(l),g=o.redMul(d);return this.curve.point(u,p,g,f)}_addA(e,t){const r=e.zOne&(t^1),i=this.x.redMul(e.x),n=this.y.redMul(e.y),s=this.curve._mulD(this.t).redMul(e.t),a=r?this.z.clone():this.z.redMul(e.z),c=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)),o=c.redISub(i).redISub(n),d=a.redSub(s),l=a.redIAdd(s),u=n.redISub(this.curve._mulA(i)),p=o.redMul(d),f=l.redMul(u),g=o.redMul(u),v=d.redMul(l);return this.curve.point(p,f,v,g)}dbl(){return this.isInfinity()?this:this._dbl(0)}_dbl(e){const t=this.zOne&(e^1),r=this.x.redSqr(),i=this.y.redSqr(),n=t?this.curve.two:this.z.redSqr().redIMuln(2),s=this.curve._mulA(r),a=this.x.redAdd(this.y).redSqr().redISub(r).redISub(i),c=s.redAdd(i),o=c.redSub(n),d=s.redISub(i),l=a.redMul(o),u=c.redMul(d),p=a.redMul(d),f=o.redMul(c);return this.curve.point(l,u,f,p)}uadd(e){return I(e instanceof mr),this._add(e,1)}udbl(){return this._dbl(1)}getX(){return this.normalize(),this.x.fromRed()}getY(){return this.normalize(),this.y.fromRed()}eq(e){if(I(e instanceof mr),I(!this.z.isZero()),I(!e.z.isZero()),this===e)return!0;if(this.z.eq(e.z))return this.x.eq(e.x)&&this.y.eq(e.y);const t=this.x.redMul(e.z),r=e.x.redMul(this.z);if(!t.eq(r))return!1;const i=this.y.redMul(e.z),n=e.y.redMul(this.z);return i.eq(n)}cmp(e){return I(e instanceof mr),this.order().cmp(e.order())||this.getY().cmp(e.getY())||this.getX().cmp(e.getX())}isInfinity(){return I(!this.z.isZero()),this.x.isZero()?this.y.eq(this.z):!1}isOrder2(){return this.isInfinity()?!1:this.x.isZero()}isOdd(){return this.normalize(),this.x.redIsOdd()}isEven(){return this.normalize(),this.x.redIsEven()}toP(){return this.normalize()}toJ(){return this}encode(){const e=this.getY();return e.setn(this.curve.signBit,this.x.redIsOdd()),this.curve.encodeAdjusted(e)}static decode(e,t){I(e instanceof pr);const r=e.decodeAdjusted(t),i=r.testn(e.signBit)!==0;if(r.setn(e.signBit,0),r.cmp(e.p)>=0)throw new Error("Invalid point.");return e.pointFromY(r,i)}toJSON(e){if(this.isInfinity())return[];const t=this.getX().toJSON(),r=this.getY().toJSON();return e===!0&&this.pre?[t,r,this.pre.toJSON()]:[t,r]}toPretty(){const e=this.curve.fieldSize*2,t=Ma(this.getX(),e),r=Ma(this.getY(),e);return[t,r]}static fromJSON(e,t){if(I(e instanceof pr),I(Array.isArray(t)),I(t.length===0||t.length===2||t.length===3),t.length===0)return e.point();const r=W.fromJSON(t[0]),i=W.fromJSON(t[1]),n=e.point(r,i);return t.length>2&&t[2]!=null&&(n.pre=tf.fromJSON(n,t[2])),n}[Ca](){return this.isInfinity()?"<EdwardsPoint: Infinity>":"<EdwardsPoint: x="+this.x.fromRed().toString(16,2)+" y="+this.y.fromRed().toString(16,2)+" z="+this.z.fromRed().toString(16,2)+">"}}class tf{constructor(){this.naf=null,this.windows=null,this.doubles=null,this.blinding=null,this.beta=null}map(e){I(typeof e=="function");const t=new this.constructor;return this.naf&&(t.naf=this.naf.map(e)),this.doubles&&(t.doubles=this.doubles.map(e)),t}toJSON(){return{naf:this.naf?this.naf.toJSON():null,windows:this.windows?this.windows.toJSON():null,doubles:this.doubles?this.doubles.toJSON():null,blinding:this.blinding?this.blinding.toJSON():void 0}}fromJSON(e,t){return I(e instanceof Qe),I(t&&typeof t=="object"),t.naf!=null&&(this.naf=tb.fromJSON(e,t.naf)),t.windows!=null&&(this.windows=rb.fromJSON(e,t.windows)),t.doubles!=null&&(this.doubles=ib.fromJSON(e,t.doubles)),t.blinding!=null&&(this.blinding=nb.fromJSON(e,t.blinding)),this}static fromJSON(e,t){return new this().fromJSON(e,t)}}class tb{constructor(e,t){this.width=e,this.points=t}map(e){I(typeof e=="function");const{width:t}=this,r=[];for(const i of this.points)r.push(e(i));return new this.constructor(t,r)}toJSON(){return{width:this.width,points:this.points.slice(1).map(e=>e.toJSON())}}static fromJSON(e,t){I(e instanceof Qe),I(t&&typeof t=="object"),I(t.width>>>0===t.width),I(Array.isArray(t.points));const{curve:r}=e,{width:i}=t,n=[e];for(const s of t.points)n.push(r.pointFromJSON(s));return new this(i,n)}}class rb{constructor(e,t,r){this.width=e,this.bits=t,this.points=r}toJSON(){return{width:this.width,bits:this.bits,points:this.points.slice(1).map(e=>e.toJSON())}}static fromJSON(e,t){I(e instanceof Qe),I(t&&typeof t=="object"),I(t.width>>>0===t.width),I(t.bits>>>0===t.bits),I(Array.isArray(t.points));const{curve:r}=e,{width:i,bits:n}=t,s=[e];for(const a of t.points)s.push(r.pointFromJSON(a));return new this(i,n,s)}}class ib{constructor(e,t){this.step=e,this.points=t}map(e){I(typeof e=="function");const{step:t}=this,r=[];for(const i of this.points)r.push(e(i));return new this.constructor(t,r)}toJSON(){return{step:this.step,points:this.points.slice(1).map(e=>e.toJSON())}}static fromJSON(e,t){I(e instanceof Qe),I(t&&typeof t=="object"),I(t.step>>>0===t.step),I(Array.isArray(t.points));const{curve:r}=e,{step:i}=t,n=[e];for(const s of t.points)n.push(r.pointFromJSON(s));return new this(i,n)}}class nb{constructor(e,t){this.blind=e,this.unblind=t}toJSON(){return{blind:this.blind.toJSON(),unblind:this.unblind.toJSON()}}static fromJSON(e,t){I(e instanceof Qe),I(t&&typeof t=="object");const{curve:r}=e,i=W.fromJSON(t.blind),n=r.pointFromJSON(t.unblind);return new this(i,n)}}class sb{constructor(e,t,r,i){this.beta=e,this.lambda=t,this.basis=r,this.pre=i}toJSON(){return{beta:this.beta.fromRed().toJSON(),lambda:this.lambda.toJSON(),basis:[this.basis[0].toJSON(),this.basis[1].toJSON()],pre:[this.pre[0].toJSON(),this.pre[1].toJSON()]}}static fromJSON(e,t){I(e instanceof Hr),I(t&&typeof t=="object"),I(Array.isArray(t.basis)),I(Array.isArray(t.pre)),I(t.basis.length===2),I(t.pre.length===2);const r=W.fromJSON(t.beta).toRed(e.red),i=W.fromJSON(t.lambda),n=[Ra.fromJSON(t.basis[0]),Ra.fromJSON(t.basis[1])],s=[W.fromJSON(t.pre[0]),W.fromJSON(t.pre[1])];return new this(r,i,n,s)}}class Ra{constructor(e,t){this.a=e,this.b=t}toJSON(){return{a:this.a.toJSON(),b:this.b.toJSON()}}static fromJSON(e){I(e&&typeof e=="object");const t=W.fromJSON(e.a),r=W.fromJSON(e.b);return new this(t,r)}}class hM extends Et{constructor(e){super({id:"P192",ossl:"prime192v1",type:"short",endian:"be",hash:"SHA256",prime:"p192",p:["ffffffff ffffffff ffffffff fffffffe","ffffffff ffffffff"],a:["ffffffff ffffffff ffffffff fffffffe","ffffffff fffffffc"],b:["64210519 e59c80e7 0fa7e9ab 72243049","feb8deec c146b9b1"],n:["ffffffff ffffffff ffffffff 99def836","146bc9b1 b4d22831"],h:"1",z:"-5",g:[["188da80e b03090f6 7cbf20eb 43a18800","f4ff0afd 82ff1012"],["07192b95 ffc8da78 631011ed 6b24cdd5","73f977a1 1e794811"],e]})}}class pM extends Et{constructor(e){super({id:"P224",ossl:"secp224r1",type:"short",endian:"be",hash:"SHA256",prime:"p224",p:["ffffffff ffffffff ffffffff ffffffff","00000000 00000000 00000001"],a:["ffffffff ffffffff ffffffff fffffffe","ffffffff ffffffff fffffffe"],b:["b4050a85 0c04b3ab f5413256 5044b0b7","d7bfd8ba 270b3943 2355ffb4"],n:["ffffffff ffffffff ffffffff ffff16a2","e0b8f03e 13dd2945 5c5c2a3d"],h:"1",z:"1f",g:[["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3","56c21122 343280d6 115c1d21"],["bd376388 b5f723fb 4c22dfe6 cd4375a0","5a074764 44d58199 85007e34"],e]})}}class mM extends Et{constructor(e){super({id:"P256",ossl:"prime256v1",type:"short",endian:"be",hash:"SHA256",prime:null,p:["ffffffff 00000001 00000000 00000000","00000000 ffffffff ffffffff ffffffff"],a:["ffffffff 00000001 00000000 00000000","00000000 ffffffff ffffffff fffffffc"],b:["5ac635d8 aa3a93e7 b3ebbd55 769886bc","651d06b0 cc53b0f6 3bce3c3e 27d2604b"],n:["ffffffff 00000000 ffffffff ffffffff","bce6faad a7179e84 f3b9cac2 fc632551"],h:"1",z:"-a",g:[["6b17d1f2 e12c4247 f8bce6e5 63a440f2","77037d81 2deb33a0 f4a13945 d898c296"],["4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16","2bce3357 6b315ece cbb64068 37bf51f5"],e]})}}class gM extends Et{constructor(e){super({id:"P384",ossl:"secp384r1",type:"short",endian:"be",hash:"SHA384",prime:null,p:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff fffffffe","ffffffff 00000000 00000000 ffffffff"],a:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff fffffffe","ffffffff 00000000 00000000 fffffffc"],b:["b3312fa7 e23ee7e4 988e056b e3f82d19","181d9c6e fe814112 0314088f 5013875a","c656398d 8a2ed19d 2a85c8ed d3ec2aef"],n:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff c7634d81 f4372ddf","581a0db2 48b0a77a ecec196a ccc52973"],h:"1",z:"-c",g:[["aa87ca22 be8b0537 8eb1c71e f320ad74","6e1d3b62 8ba79b98 59f741e0 82542a38","5502f25d bf55296c 3a545e38 72760ab7"],["3617de4a 96262c6f 5d9e98bf 9292dc29","f8f41dbd 289a147c e9da3113 b5f0b8c0","0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"],e]})}}class bM extends Et{constructor(e){super({id:"P521",ossl:"secp521r1",type:"short",endian:"be",hash:"SHA512",prime:"p521",p:["000001ff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff"],a:["000001ff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffff","fffffffc"],b:["00000051 953eb961 8e1c9a1f 929a21a0","b68540ee a2da725b 99b315f3 b8b48991","8ef109e1 56193951 ec7e937b 1652c0bd","3bb1bf07 3573df88 3d2c34f1 ef451fd4","6b503f00"],n:["000001ff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffff","fffffffa 51868783 bf2f966b 7fcc0148","f709a5d0 3bb5c9b8 899c47ae bb6fb71e","91386409"],h:"1",z:"-4",g:[["000000c6 858e06b7 0404e9cd 9e3ecb66","2395b442 9c648139 053fb521 f828af60","6b4d3dba a14b5e77 efe75928 fe1dc127","a2ffa8de 3348b3c1 856a429b f97e7e31","c2e5bd66"],["00000118 39296a78 9a3bc004 5c8a5fb4","2c7d1bd9 98f54449 579b4468 17afbd17","273e662c 97ee7299 5ef42640 c550b901","3fad0761 353c7086 a272c240 88be9476","9fd16650"],e]})}}class yM extends Et{constructor(e){super({id:"SECP256K1",ossl:"secp256k1",type:"short",endian:"be",hash:"SHA256",prime:"k256",p:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe fffffc2f"],a:"0",b:"7",n:["ffffffff ffffffff ffffffff fffffffe","baaedce6 af48a03b bfd25e8c d0364141"],h:"1",z:"1",c:["0a2d2ba9 3507f1df 233770c2 a797962c","c61f6d15 da14ecd4 7d8d27ae 1cd5f852"],g:[["79be667e f9dcbbac 55a06295 ce870b07","029bfcdb 2dce28d9 59f2815b 16f81798"],["483ada77 26a3c465 5da4fbfc 0e1108a8","fd17b448 a6855419 9c47d08f fb10d4b8"],e],endo:{beta:["7ae96a2b 657c0710 6e64479e ac3434e9","9cf04975 12f58995 c1396c28 719501ee"],lambda:["5363ad4c c05c30e0 a5261c02 8812645a","122e22ea 20816678 df02967c 1b23bd72"],basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],pre:["3086d221a7d46bcde86c90e49284eb153dab","-e4437ed6010e88286f547fa90abfe4c42212"]}})}}class vM extends Et{constructor(e){super({id:"BRAINPOOLP256",ossl:"brainpoolP256r1",type:"short",endian:"be",hash:"SHA256",prime:null,p:["a9fb57db a1eea9bc 3e660a90 9d838d72","6e3bf623 d5262028 2013481d 1f6e5377"],a:["7d5a0975 fc2c3057 eef67530 417affe7","fb8055c1 26dc5c6c e94a4b44 f330b5d9"],b:["26dc5c6c e94a4b44 f330b5d9 bbd77cbf","95841629 5cf7e1ce 6bccdc18 ff8c07b6"],n:["a9fb57db a1eea9bc 3e660a90 9d838d71","8c397aa3 b561a6f7 901e0e82 974856a7"],h:"1",z:"-2",g:[["8bd2aeb9 cb7e57cb 2c4b482f fc81b7af","b9de27e1 e3bd23c2 3a4453bd 9ace3262"],["547ef835 c3dac4fd 97f8461a 14611dc9","c2774513 2ded8e54 5c1d54c7 2f046997"],e]})}}class wM extends Et{constructor(e){super({id:"BRAINPOOLP384",ossl:"brainpoolP384r1",type:"short",endian:"be",hash:"SHA384",prime:null,p:["8cb91e82 a3386d28 0f5d6f7e 50e641df","152f7109 ed5456b4 12b1da19 7fb71123","acd3a729 901d1a71 87470013 3107ec53"],a:["7bc382c6 3d8c150c 3c72080a ce05afa0","c2bea28e 4fb22787 139165ef ba91f90f","8aa5814a 503ad4eb 04a8c7dd 22ce2826"],b:["04a8c7dd 22ce2826 8b39b554 16f0447c","2fb77de1 07dcd2a6 2e880ea5 3eeb62d5","7cb43902 95dbc994 3ab78696 fa504c11"],n:["8cb91e82 a3386d28 0f5d6f7e 50e641df","152f7109 ed5456b3 1f166e6c ac0425a7","cf3ab6af 6b7fc310 3b883202 e9046565"],h:"1",z:"-5",g:[["1d1c64f0 68cf45ff a2a63a81 b7c13f6b","8847a3e7 7ef14fe3 db7fcafe 0cbd10e8","e826e034 36d646aa ef87b2e2 47d4af1e"],["8abe1d75 20f9c2a4 5cb1eb8e 95cfd552","62b70b29 feec5864 e19c054f f9912928","0e464621 77918111 42820341 263c5315"],e]})}}class SM extends Et{constructor(e){super({id:"BRAINPOOLP512",ossl:"brainpoolP512r1",type:"short",endian:"be",hash:"SHA512",prime:null,p:["aadd9db8 dbe9c48b 3fd4e6ae 33c9fc07","cb308db3 b3c9d20e d6639cca 70330871","7d4d9b00 9bc66842 aecda12a e6a380e6","2881ff2f 2d82c685 28aa6056 583a48f3"],a:["7830a331 8b603b89 e2327145 ac234cc5","94cbdd8d 3df91610 a83441ca ea9863bc","2ded5d5a a8253aa1 0a2ef1c9 8b9ac8b5","7f1117a7 2bf2c7b9 e7c1ac4d 77fc94ca"],b:["3df91610 a83441ca ea9863bc 2ded5d5a","a8253aa1 0a2ef1c9 8b9ac8b5 7f1117a7","2bf2c7b9 e7c1ac4d 77fc94ca dc083e67","984050b7 5ebae5dd 2809bd63 8016f723"],n:["aadd9db8 dbe9c48b 3fd4e6ae 33c9fc07","cb308db3 b3c9d20e d6639cca 70330870","553e5c41 4ca92619 41866119 7fac1047","1db1d381 085ddadd b5879682 9ca90069"],h:"1",z:"7",g:[["81aee4bd d82ed964 5a21322e 9c4c6a93","85ed9f70 b5d916c1 b43b62ee f4d0098e","ff3b1f78 e2d0d48d 50d1687b 93b97d5f","7c6d5047 406a5e68 8b352209 bcb9f822"],["7dde385d 566332ec c0eabfa9 cf7822fd","f209f700 24a57b1a a000c55b 881f8111","b2dcde49 4a5f485e 5bca4bd8 8a2763ae","d1ca2b2f a8f05406 78cd1e0f 3ad80892"],e]})}}class _M extends Nt{constructor(){super({id:"X25519",ossl:"X25519",type:"mont",endian:"le",hash:"SHA512",prime:"p25519",p:["7fffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffed"],a:"76d06",b:"1",n:["10000000 00000000 00000000 00000000","14def9de a2f79cd6 5812631a 5cf5d3ed"],h:"8",z:"2",g:[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000009"],["5f51e65e 475f794b 1fe122d3 88b72eb3","6dc2b281 92839e4d d6163a5d 81312c14"]],torsion:[[],[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000"],["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000"]],[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000001"],["6be4f497 f9a9c2af c21fa77a d7f4a6ef","635a11c7 284a9363 e9a248ef 9c884415"]],[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000001"],["141b0b68 06563d50 3de05885 280b5910","9ca5ee38 d7b56c9c 165db710 6377bbd8"]],[["57119fd0 dd4e22d8 868e1c58 c45c4404","5bef839c 55b1d0b1 248c50a3 bc959c5f"],["68c59389 3d458e64 31c6ca00 45fb5015","20a44346 8eaa68dd 0f103842 048065b7"]],[["57119fd0 dd4e22d8 868e1c58 c45c4404","5bef839c 55b1d0b1 248c50a3 bc959c5f"],["173a6c76 c2ba719b ce3935ff ba04afea","df5bbcb9 71559722 f0efc7bd fb7f9a36"]],[["00b8495f 16056286 fdb1329c eb8d09da","6ac49ff1 fae35616 aeb8413b 7c7aebe0"],["3931c129 569e83a5 29482c14 e628b457","933bfc29 ed801b4d 68871483 92507b1a"]],[["00b8495f 16056286 fdb1329c eb8d09da","6ac49ff1 fae35616 aeb8413b 7c7aebe0"],["46ce3ed6 a9617c5a d6b7d3eb 19d74ba8","6cc403d6 127fe4b2 9778eb7c 6daf84d3"]]]})}}class EM extends Nt{constructor(){super({id:"X448",ossl:"X448",type:"mont",endian:"le",hash:"SHAKE256",prime:"p448",p:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff"],a:"262a6",b:"1",n:["3fffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff 7cca23e9","c44edb49 aed63690 216cc272 8dc58f55","2378c292 ab5844f3"],h:"4",z:"-1",g:[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000005"],["7d235d12 95f5b1f6 6c98ab6e 58326fce","cbae5d34 f55545d0 60f75dc2 8df3f6ed","b8027e23 46430d21 1312c4b1 50677af7","6fd7223d 457b5b1a"]],torsion:[[],[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000"],["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000"]],[["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff fffffffe"],["ba4d3a08 29b6112f 8812e51b a0bb2abe","bc1cb08e b48e5569 36ba50fd d2e7d68a","f8cb3216 0522425b 3f990812 abbe635a","d37a21e1 7551b193"]],[["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff fffffffe"],["45b2c5f7 d649eed0 77ed1ae4 5f44d541","43e34f71 4b71aa96 c945af01 2d182975","0734cde9 faddbda4 c066f7ed 54419ca5","2c85de1e 8aae4e6c"]]]})}}class AM extends Nt{constructor(){super({id:"MONT448",ossl:null,type:"mont",endian:"le",hash:"SHAKE256",prime:"p448",p:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff"],a:["b2cf97d2 d43459a9 31ed36b1 fc4e3cb5","5d93f8d2 22746997 60ccffc6 49961ed6","c5b05fca c24864ed 6fb59697 931b78da","84ddecd8 ca2b5cfb"],b:"1",n:["3fffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff 7cca23e9","c44edb49 aed63690 216cc272 8dc58f55","2378c292 ab5844f3"],h:"4",z:"-1",g:[["ac0d24cc c6c75cb0 eb71f81e 7a6edf51","48e88aee 009a2a24 e795687e c28e125a","3e6730a6 0d46367b aa7fe99d 152128dc","41321bc7 7817f059"],["5a4437f6 80c0d0db 9b061276 d5d0ffcc","e786ff33 b6a53d30 98746425 82e66f09","4433dae7 7244a6e2 6b11e905 7228f483","556c41a5 913f55fe"]],torsion:[[],[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000"],["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000"]],[["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff fffffffe"],["bec92fd0 6da2acf2 b4e261e8 7cef0d34","22e75c18 3c589857 b71924e5 73c2f9ce","e18da5f2 466e2f39 3c2eedf0 f105a60a","b40c717d 4f1e1fd7"]],[["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff fffffffe"],["4136d02f 925d530d 4b1d9e17 8310f2cb","dd18a3e7 c3a767a8 48e6db19 8c3d0631","1e725a0d b991d0c6 c3d1120f 0efa59f5","4bf38e82 b0e1e028"]]]})}}class IM extends pr{constructor(e){super({id:"ED25519",ossl:"ED25519",type:"edwards",endian:"le",hash:"SHA512",prefix:"SigEd25519 no Ed25519 collisions",context:!1,prime:"p25519",p:["7fffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffed"],a:"-1",d:["52036cee 2b6ffe73 8cc74079 7779e898","00700a4d 4141d8ab 75eb4dca 135978a3"],n:["10000000 00000000 00000000 00000000","14def9de a2f79cd6 5812631a 5cf5d3ed"],h:"8",z:"2",g:[["216936d3 cd6e53fe c0a4e231 fdd6dc5c","692cc760 9525a7b2 c9562d60 8f25d51a"],["66666666 66666666 66666666 66666666","66666666 66666666 66666666 66666658"],e],torsion:[[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000"],["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000001"]],[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000"],["7fffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffec"]],[["2b832480 4fc1df0b 2b4d0099 3dfbd7a7","2f431806 ad2fe478 c4ee1b27 4a0ea0b0"],["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000"]],[["547cdb7f b03e20f4 d4b2ff66 c2042858","d0bce7f9 52d01b87 3b11e4d8 b5f15f3d"],["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000"]],[["1fd5b9a0 06394a28 e9339932 38de4abb","5c193c70 13e5e238 dea14646 c545d14a"],["05fc536d 880238b1 3933c6d3 05acdfd5","f098eff2 89f4c345 b027b2c2 8f95e826"]],[["602a465f f9c6b5d7 16cc66cd c721b544","a3e6c38f ec1a1dc7 215eb9b9 3aba2ea3"],["05fc536d 880238b1 3933c6d3 05acdfd5","f098eff2 89f4c345 b027b2c2 8f95e826"]],[["1fd5b9a0 06394a28 e9339932 38de4abb","5c193c70 13e5e238 dea14646 c545d14a"],["7a03ac92 77fdc74e c6cc392c fa53202a","0f67100d 760b3cba 4fd84d3d 706a17c7"]],[["602a465f f9c6b5d7 16cc66cd c721b544","a3e6c38f ec1a1dc7 215eb9b9 3aba2ea3"],["7a03ac92 77fdc74e c6cc392c fa53202a","0f67100d 760b3cba 4fd84d3d 706a17c7"]]]})}}class TM extends pr{constructor(e){super({id:"ISO448",ossl:null,type:"edwards",endian:"le",hash:"SHAKE256",prefix:"SigEd448",context:!0,prime:"p448",p:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff"],a:"1",d:["d78b4bdc 7f0daf19 f24f38c2 9373a2cc","ad461572 42a50f37 809b1da3 412a12e7","9ccc9c81 264cfe9a d0809970 58fb61c4","243cc32d baa156b9"],n:["3fffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff 7cca23e9","c44edb49 aed63690 216cc272 8dc58f55","2378c292 ab5844f3"],h:"4",z:"-1",g:[["79a70b2b 70400553 ae7c9df4 16c792c6","1128751a c9296924 0c25a07d 728bdc93","e21f7787 ed697224 9de732f3 8496cd11","69871309 3e9c04fc"],["7fffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff 80000000","00000000 00000000 00000000 00000000","00000000 00000001"],e],torsion:[[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000"],["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000001"]],[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000"],["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff fffffffe"]],[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000001"],["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000"]],[["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff fffffffe"],["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000"]]]})}}class CM extends pr{constructor(e){super({id:"ED448",ossl:"ED448",type:"edwards",endian:"le",hash:"SHAKE256",prefix:"SigEd448",context:!0,prime:"p448",p:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff"],a:"1",d:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffff6756"],n:["3fffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff 7cca23e9","c44edb49 aed63690 216cc272 8dc58f55","2378c292 ab5844f3"],h:"4",z:"-1",g:[["4f1970c6 6bed0ded 221d15a6 22bf36da","9e146570 470f1767 ea6de324 a3d3a464","12ae1af7 2ab66511 433b80e1 8b00938e","2626a82b c70cc05e"],["693f4671 6eb6bc24 88762037 56c9c762","4bea7373 6ca39840 87789c1e 05a0c2d7","3ad3ff1c e67c39c4 fdbd132c 4ed7c8ad","9808795b f230fa14"],e],torsion:[[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000"],["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000001"]],[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000"],["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff fffffffe"]],[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000001"],["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000"]],[["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff fffffffe"],["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000"]]]})}}const yd={__proto__:null,P192:hM,P224:pM,P256:mM,P384:gM,P521:bM,SECP256K1:yM,BRAINPOOLP256:vM,BRAINPOOLP384:wM,BRAINPOOLP512:SM,X25519:_M,X448:EM,MONT448:AM,ED25519:IM,ISO448:TM,ED448:CM},rf={__proto__:null,P192:null,P224:null,P256:null,P384:null,P521:null,SECP256K1:null,BRAINPOOLP256:null,BRAINPOOLP384:null,BRAINPOOLP512:null,X25519:null,X448:null,MONT448:null,ED25519:null,ISO448:null,ED448:null};function RM(e,...t){I(typeof e=="string");const r=e.toUpperCase();let i=rf[r];if(!i){const n=yd[r];if(!n)throw new Error(`Curve not found: "${e}".`);i=new n(...t),rf[r]=i}return i}function MM(e,t){I(typeof e=="string"),I(typeof t=="function");const r=e.toUpperCase();if(yd[r])throw new Error(`Curve already registered: "${e}".`);yd[r]=t,rf[r]=null}function vd(e,t,r){I(e instanceof W),I(!e.red),I(t>>>0===t),I(r>>>0===r);const i=new Array(r),n=e.bitLength()+1,s=e.sign()|1;I(n<=r);for(let d=0;d<r;d++)i[d]=0;let a=0,c=0,o;for(;a<n;){if(e.bit(a)===c){a+=1;continue}o=e.bits(a,t)+c,c=o>>t-1&1,o-=c<<t,i[a]=s*o,a+=t}return I(c===0),i}function kM(e,t,r,i){I(i>>>0===i);const n=vd(e,t,r),s=Math.ceil(n.length/i),a=new Array(s);let c=0;for(let o=0;o<n.length;o+=i){let d=0;for(let l=o+i-1;l>=o;l--)d=(d<<1)+n[l];a[c++]=d}return I(c===s),a}function PM(e,t,r){I(e instanceof W),I(t instanceof W),I(!e.red),I(!t.red),I(r>>>0===r);const i=[new Array(r),new Array(r)],n=Math.max(e.bitLength(),t.bitLength())+1,s=e.sign()|1,a=t.sign()|1;I(n<=r);let c=0,o=0;for(let d=0;d<n;d++){const l=e.bits(d,3),u=t.bits(d,3);let p=(l&3)+c&3,f=(u&3)+o&3,g=0,v=0;if(p===3&&(p=-1),f===3&&(f=-1),p&1){const S=(l&7)+c&7;(S===3||S===5)&&f===2?g=-p:g=p}if(f&1){const S=(u&7)+o&7;(S===3||S===5)&&p===2?v=-f:v=f}i[0][d]=g*s,i[1][d]=v*a,2*c===g+1&&(c=1-c),2*o===v+1&&(o=1-o)}for(let d=n;d<r;d++)i[0][d]=0,i[1][d]=0;return i}function NM(e,t,r){const i=PM(e,t,r),n=new Array(r);for(let s=0;s<r;s++){const a=i[0][s],c=i[1][s];n[s]=uM[(a+1)*3+(c+1)]}return n}function xM(e,t){I(e instanceof W),I(t instanceof W);const r=e.abs(),i=r.add(t),n=i.add(t),s=i.bitLength(),a=t.bitLength();i.cinject(n,s-a-1>>>31);const c=e.isNeg()&1,o=i.bitLength(),d=i.toArray("le");return[c,o,d]}function OM(e,t){I(e instanceof W),I(t instanceof W);const r=e.mod(t),i=t.sub(r),n=r.bitLength(),s=i.bitLength(),a=n-s>>>31;r.cinject(i,a);const c=r.bitLength(),o=r.toArray("le"),d=r.ceq(t.subn(1));return[a,c,o,d]}function I(e,t){if(!e){const r=new Error(t||"Assertion failed");throw Error.captureStackTrace&&Error.captureStackTrace(r,I),r}}function ab(e){I(e instanceof W);try{return[1,e.redSqrt()]}catch(t){if(t.message==="X is not a square mod P.")return[0,e.clone()];throw t}}function nf(e,t){I(e instanceof W),I(t instanceof W);try{return[1,e.redDivSqrt(t)]}catch(r){if(r.message==="Not invertible."||r.message==="X is not a square mod P.")return[0,e.clone()];throw r}}function DM(e){I(e instanceof W),I(e.red);const t=e.red.m;if(t.cmpn(3)<=0)return e.clone();if(t.modrn(3)===2){const i=t.ushln(1).isubn(1).idivn(3);return e.redPow(i)}const r=t.modrn(9);if(r===4){const i=t.ushln(1).iaddn(1).idivn(9),n=e.redPow(i),s=n.redSqr().redMul(n);if(!s.eq(e))throw new Error("X is not a cube mod P.");return n}if(r===7){const i=t.addn(2).idivn(9),n=e.redPow(i),s=n.redSqr().redMul(n);if(!s.eq(e))throw new Error("X is not a cube mod P.");return n}throw new Error("Not implemented.")}function ob(e){const t=DM(e);if(e.red.m.modrn(3)===1){const r=new W(2).toRed(e.red),i=new W(3).toRed(e.red),n=r.redInvert(),s=i.redNeg().redSqrt().redMul(n),a=s.redNeg(),c=s.redSub(n),o=a.redSub(n),d=t.redMul(c),l=t.redMul(o);return[t,d,l]}return[t]}function cb(e){for(const t of ob(e))if(t.redJacobi()>=0)return t;throw new Error("X^(1/3) is not a square mod P.")}function db(e){return W.randomBits(e,32).toNumber()}function sf(e,t){const r=new WeakMap;return function(n,s){const a=s&1,c=r.get(n);if(c&&c[a]!==null)return c[a];const o=e.call(t,n,s);return r.has(n)||r.set(n,[null,null]),r.get(n)[a]=o,o}}function Ma(e,t){I(e instanceof W),I(t>>>0===t),t&7&&(t+=8-(t&7));const r=e.toString(16,t),i=[],n=[];I((r.length&7)===0);for(let s=0;s<r.length;s+=8)i.push(r.slice(s,s+8));for(let s=0;s<i.length;s+=4)n.push(i.slice(s,s+4).join(" "));return n}var BM=Hr,LM=Qe,jM=Et,FM=It,UM=pn,qM=Nt,zM=ir,$M=Vr,HM=pr,VM=mr,GM=yd,XM=RM,KM=MM,lb={Curve:BM,Point:LM,ShortCurve:jM,ShortPoint:FM,JPoint:UM,MontCurve:qM,MontPoint:zM,XPoint:$M,EdwardsCurve:HM,EdwardsPoint:VM,curves:GM,curve:XM,register:KM};const wd=se.crypto||se.msCrypto,ub=wd&&typeof wd.getRandomValues=="function",WM=ub?wd.getRandomValues.bind(wd):null,fb=new Uint32Array(16),af=65536;let of=0;function YM(e){fe(e>>>0===e);const t=Buffer.alloc(e);return pb(t,0,e),t}function ZM(e,t,r){return fe(Buffer.isBuffer(e)),t==null&&(t=0),fe(t>>>0===t),r==null&&(r=e.length-t),fe(r>>>0===r),fe(t+r<=e.length),pb(e,t,r),e}function hb(){return(of&15)===0&&(cf(fb),of=0),fb[of++]}function JM(e,t){fe(e>>>0===e),fe(t>>>0===t),fe(t>=e);const r=t-e;if(r===0)return e;const i=-r>>>0;let n,s;do n=hb(),s=n%r;while(n-s>i);return s+e}function cf(e){if(!ub)throw new Error("Entropy source not available.");return WM(e)}function pb(e,t,r){if(fe(Buffer.isBuffer(e)),fe(e.buffer instanceof ArrayBuffer),fe(e.byteOffset>>>0===e.byteOffset),fe(e.byteLength>>>0===e.byteLength),fe(t>>>0===t),fe(r>>>0===r),fe(t+r<=e.byteLength),r>2**31-1)throw new RangeError('The value "size" is out of range.');const i=e.byteOffset+t,n=new Uint8Array(e.buffer,i,r);if(n.length>af)for(let s=0;s<n.length;s+=af){let a=s+af;a>n.length&&(a=n.length),cf(n.subarray(s,a))}else n.length>0&&cf(n)}var QM=0,e8=YM,t8=ZM,r8=hb,i8=JM,n8={native:QM,randomBytes:e8,randomFill:t8,randomInt:r8,randomRange:i8},Ms=n8;function s8(e){fe(Buffer.isBuffer(e));let t=0;for(;t<e.length&&e[t]===0;)t+=1;let r=(e.length-t)*8;if(r===0)return 0;r-=8;let i=e[t];for(;i;)r+=1,i>>>=1;return r}function a8(e){fe(Buffer.isBuffer(e));let t=e.length;for(;t>0&&e[t-1]===0;)t-=1;let r=t*8;if(r===0)return 0;r-=8;let i=e[t-1];for(;i;)r+=1,i>>>=1;return r}function o8(e,t){fe(Buffer.isBuffer(e)),fe(Buffer.isBuffer(t));let r=0,i=e.length,n=0,s=t.length;for(;i>0&&e[r]===0;)r+=1,i-=1;for(;s>0&&t[n]===0;)n+=1,s-=1;if(i<s)return-1;if(i>s)return 1;for(let a=0;a<i;a++){if(e[r+a]<t[n+a])return-1;if(e[r+a]>t[n+a])return 1}return 0}function c8(e,t){fe(Buffer.isBuffer(e)),fe(Buffer.isBuffer(t));let r=e.length,i=t.length;for(;r>0&&e[r-1]===0;)r-=1;for(;i>0&&t[i-1]===0;)i-=1;if(r<i)return-1;if(r>i)return 1;for(let n=r-1;n>=0;n--){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1}return 0}function mb(e){fe(Buffer.isBuffer(e));let t=0;for(;t<e.length&&e[t]===0;)t+=1;return e.slice(t)}function gb(e){fe(Buffer.isBuffer(e));let t=e.length;for(;t>0&&e[t-1]===0;)t-=1;return e.slice(0,t)}function d8(e,t){if(fe(Buffer.isBuffer(e)),fe(t>>>0===t),e.length>t&&(e=mb(e)),e.length>t)throw new RangeError(`Buffer expected to be ${t} bytes in size.`);const r=Buffer.alloc(t,0);return e.copy(r,t-e.length),r}function l8(e,t){if(fe(Buffer.isBuffer(e)),fe(t>>>0===t),e.length>t&&(e=gb(e)),e.length>t)throw new RangeError(`Buffer expected to be ${t} bytes in size.`);const r=Buffer.alloc(t,0);return e.copy(r,0),r}var u8=s8,f8=a8,h8=o8,p8=c8,m8=mb,g8=gb,b8=d8,y8=l8,v8={countLeft:u8,countRight:f8,compareLeft:h8,compareRight:p8,trimLeft:m8,trimRight:g8,padLeft:b8,padRight:y8};const{padRight:bb}=v8;class w8{constructor(e,t,r){fe(typeof e=="string"),fe(!t||typeof t=="string"),this.id=e,this.type="ecdh",this.eid=t||null,this._pre=r||null,this._curve=null,this._edwards=null,this.native=0}get curve(){return this._curve||(this._curve=lb.curve(this.id)),this._curve}get edwards(){return this.eid&&!this._edwards&&(this._edwards=lb.curve(this.eid,this._pre),this._edwards.precompute(Ms),this._pre=null),this._edwards}get size(){return this.curve.fieldSize}get bits(){return this.curve.fieldBits}privateKeyGenerate(){const e=Ms.randomBytes(this.curve.scalarSize);return this.curve.clamp(e)}privateKeyVerify(e){return fe(Buffer.isBuffer(e)),e.length===this.curve.scalarSize}privateKeyExport(e,t){const r=this.publicKeyCreate(e),{x:i,y:n}=this.publicKeyExport(r,t);return{d:Buffer.from(e),x:i,y:n}}privateKeyImport(e){return fe(e&&typeof e=="object"),bb(e.d,this.curve.scalarSize)}publicKeyCreate(e){const t=this.curve.decodeClamped(e);if(this.edwards&&this.edwards.g.pre){const n=this.edwards.g.mulBlind(t),s=this.curve.pointFromEdwards(n);return s.encode()}const r=this.curve.g.toX(),i=r.mulBlind(t,Ms);return i.encode()}publicKeyConvert(e,t){if(fe(t==null||typeof t=="boolean"),!this.edwards)throw new Error("No equivalent edwards curve.");const r=this.curve.decodePoint(e),i=this.edwards.pointFromMont(r);return t!=null&&i.isOdd()!==t?i.neg().encode():i.encode()}publicKeyFromUniform(e){const t=this.curve.decodeUniform(e),r=this.curve.pointFromUniform(t);return r.encode()}publicKeyToUniform(e,t=Ms.randomInt()){const r=this.curve.decodePoint(e),i=this.curve.pointToUniform(r,t);return this.curve.encodeUniform(i,t>>>8)}publicKeyFromHash(e,t=!1){const r=this.curve.pointFromHash(e,t);return r.encode()}publicKeyToHash(e,t=Ms.randomInt()){const r=this.curve.decodePoint(e);return this.curve.pointToHash(r,t,Ms)}publicKeyVerify(e){fe(Buffer.isBuffer(e));let t;try{t=this.curve.decodeX(e)}catch(r){return!1}return t.validate()}publicKeyIsSmall(e){fe(Buffer.isBuffer(e));let t;try{t=this.curve.decodeX(e)}catch(r){return!1}return t.validate()?t.isSmall():!1}publicKeyHasTorsion(e){fe(Buffer.isBuffer(e));let t;try{t=this.curve.decodeX(e)}catch(r){return!1}return t.validate()?t.hasTorsion():!1}publicKeyExport(e,t){const{x:r,y:i}=this.curve.decodePoint(e,t);return{x:this.curve.encodeField(r.fromRed()),y:this.curve.encodeField(i.fromRed())}}publicKeyImport(e){fe(e&&typeof e=="object");const t=bb(e.x,this.curve.fieldSize),r=this.curve.decodeX(t);if(!r.validate())throw new Error("Invalid point.");return r.encode()}derive(e,t){const r=this.curve.decodeX(e),i=this.curve.decodeClamped(t),n=r.mulConst(i,Ms);return n.encode()}}var S8=w8;const _8={width:9,points:[["67ae9c4a22928f491ff4ae743edac83a6343981981624886ac62485fd3f8e25c","1267b1d177ee69aba126a18e60269ef79f16ec176724030402c3684878f5b4d4"],["49fda73eade3587bfcef7cf7d12da5de5c2819f93e1be1a591409cc0322ef233","5f4825b298feae6fe02c6e148992466631282eca89430b5d10d21f83d676c8ed"],["14568685fcf4bd4ee9e3ee194b1d810783e809f3bbf1ce955855981af50e4107","31c563e32b47d52f87ce6468dd36ad41f0882b46f7abf23d12c4c4b59f4062b8"],["357cc970c80071651bf336e06f9422b886d80e5c2e4e0294d3e023065185715c","7f3d23c2c2dd0df4b2befce956f2d2fd1f789013236e4430c74e44845522f1c0"],["14e528b1154be417b6cf078dd6712438d381a5b2c593d552ff2fd2c1207cf3cb","2d9082313f21ab975a6f7ce340ff0fce1258591c3c9c58d4308f2dc36a033713"],["107427e0d5f366ccdb33adf0282d304f8843e3e88d22b7b83780e073b7c05fed","12dbb00ded538b7478466022d2da89b83740cfb2289a272387efe1aeea401f80"],["4f162deaec2ec435dc5ac6f95d20419ed9631374770189cb90617f3e66a18dc1","12cbfb2d04ff22f55162f70164d29331ace5af18a19a9aa1946d4cc4ad2e5cdf"],["7dc52d5a7db816e9b850741ea2fd72918d94985b85a20b4dc5597853a876df6a","6f6d2bca60003ef9f24ac245cc919fb717b188723b34f901cd6cfe9bec97be04"],["1d81f74a5ba45c7022e8c140d763b9c1b0e281a5304696e74f791a3a04a94472","3f185a93d95a4347227c5bb6ddd65cf42e1830823f435f3083fe6102691d55b9"],["6f0ac78e5eb90e87958588f9d47541edf252cb1dde3d073cc45e3e7ef9365716","6628d116b7975ae5f323e5ddf4f8cc35ae06d5c5c7d8a56effc66051336d289e"],["2188ac423c67db5625915e05222a391bcaf91f05d9b7cc2cab5798b2d2e14d95","23240c559c57b79a4df69a23fc46e50504277b1fa49369ab663d79782b33c0ee"],["794241471ed9ceb009384b370cb8790fca98552ecb822dc06b19362c36353455","71e918c03cdfca7207772e8d18ee8f9d92d79a0a83f378912362bc68d311dcd0"],["163bc180c22dfc5da23c5c052107bba93a88b4360aa1d4e729611d8f5a7f8079","631107a6ba83f7458194b9766a0a54f638ca20daf800384dbae1498677501939"],["39a32a30f3eb1da0eb7e3903b8ace3da3890b24b61a3a9e79db663b5db0f7a5d","4d4c54675dc1f1c9a1af9ca0010045dc803c16af345823136dd203715d67c491"],["38085391a0e2831f59c33fcce7591515784d359925f11ff958e0e4658efac0e9","42918001a829f49b5634e34ab7fac21b30e24660669ed91955cc31944a19e62a"],["5e3573b049d6135ffbbbbd9a480617434f2455b4a591f719e91153eeb75a32a1","54bc665420c789da1105d53983c1a0fc33bcc2690cd9b37d6566e21a85892871"],["7ed068b25b82c05fdc0e46bd80a357f3acd2f5c3b9330bc8d474e5b28270f6eb","01da83a187da8ccca704d46557a462551d70df7f943a681c3b97b1db6a21b7d3"],["05ca3370e7516f6686111b72650aab4c5484407f14b515ade03951c6a14a0aa3","6f407fc537b95277966e7f0f5e64b86904bf7baee091cee6011a3611834c6903"],["624cb312b698bbd6dbca79b8d2b53cb5d8b3ab33c19306e87c18211f095ab9c3","5b3336b2751e97c793731ac9b9a2243b6229f6d0bbea6b619395d0e5200bd8a3"],["1ddf6ece608fe2901b34b7e4f47cfcb75e947e293c704d8121b11a31a051b5f9","5e2dc58e9a48a749ce5296d229cfb34f96a147a8246d2e9844d52b52112ea94e"],["396b384f3d61cfc060308fbb1c941ebc9418e2d9abd81316e08d625f48c0e101","7223e5f7b66d1ca24962bac273a7aa6618cc60cb8a64a8837e0261107e7ad644"],["53cc3dca3410277fb38d75e4ac0dde8e77a99c817170dbc9696cffe7890fbd50","2592a3aafce64d7c69f4de468d5d5aa19845f5ca08f64a0a40e37d23ececbbe1"],["34705fe600f5aed77b29d3eacdffcd45d886904156d43dc550bb7fc889cc1368","299153c141a8950ffbcc8e9352993e642fa39a476200dd4acf42e158dbe3b01e"],["5969255bd089181b991fce96b1792ba330a14f8a0b061f8118c9c336b8504618","680a805fa0ae93c2a12b193517fb1147d355547e4ab18a9d6ca21575bbb4d7a4"],["27d1d57fa8808d3d452df14bda4248b37902752163b1fd499a92456c59918ecb","0a42f1c0f4c5d7de9e82904f0b4ff63988d31fedb8aad9d8ae009c7a1dff09c3"],["0811d14bfdfdcf2144edd9cf55bce584a9ba17aec3eac8aaa82987ad703d9b8a","42bea70d46f3ee0df0ec77d24c5495ea56ada2e0415920470c4746b68306376e"],["4de090761b863cb0f0650297f154a8e66d00c5119c38e5dd05303d905d527a4a","5eef0efd105361ce198a30e09e7e7edffbe3d70189e63ca68cf6057b9772baa8"],["1d45517858ce45556aaee056ebab7e0ef3dc9ae3740aed570f3e76bfb4fc4817","0b5a9d8fe8b7ccb04c0a5ef77798a3ec6e1bc1138604eb05e83844f0d4c5c699"],["4285edbe9117f30aae1ef5ee419eb1d472106c6b3d7f3ce3701e39324b0eeafc","503aa6104a682bcf2c0a60c84f4c22b50b0caa0fed8db87dedc7173eae04bdbd"],["3ef830cbeff9b79039b1b6bd9bb52bbcfa56d008d91b9703ea1c80351f8687d6","62349ff5d8dbd216a874769eec152ef9734bea9240eed623992c7553dc8ee4c8"],["649a996e6d4d3b60ccb526939ed8929134107e03e2fd4648eaa2fa9830822c1a","1648311b942fe95d492a1ace5e5235c1aea860d036d2475cc8964cd1acedee9c"],["3a95596d97770d050d1ecc075d58a74f5fe6b4b8222740534ba22c8be73f9d56","15a80cdcc03317a830fa4a7461de6bac136993e0a797f83b405c161a34c98fd7"],["2d265d3fe1c88903ca93685209418deec5af886bf0d9fdb3f499d831cbb76ce1","08376fb0663d3aa220948612b519af4a6a1f956622b15a305fb2e60a84210b3c"],["642cb15498d8c6b25803f3e56b98e2ea185ac808cbeab5eb0a610ed5babb9385","21b5ca5020a9e5a2334c0bee15193ea16c909963ffa6e1d93df4b239abeaeb3e"],["38e576301ff6cdd0822a19c6d610d445d3967e2bada903abb6220f68c6e79bef","458fe689e31a24952d2817dda4349109c1b26ef31699fa36c4f8389eeb60eac0"],["372bec78d75011a0ef2233cd08790a7f15c1ec1e3a78cac8d6652678641780db","32e9e47cf2f48612ed3e2c2006ea0c0c8476d3562aa88cefb67ec97abdb538e8"],["1aa3756aabcc3eb65afee34e0a15dd67bfb9fb199eb131f4cc6a3ca9ec4d1c77","42333e27831add6eb49af80e17347c63c26dd684758096ee3dbdbe03a49159ae"],["38db16447d79d3590c4a36e20286beadfbae91a4eed2e5e7dd4f975ac0537dc5","1c48ccaed60ec12ce862ea71165bba7df1739845df2a857f4ef0a0f714f96daa"],["176b78984cddfddef90bae619c6a98e951d9a7ac7d6af218ae7e76b273212fb7","7b5b93eda77443f366e2a127abe12212aad8536767ec1c5861143f777db85852"],["042d154bf7b4a7bd73897ae528c6bc552ea58d74f8109e8e4052d3e9d38bb0f6","42d1831323e279f9f7ee9e3470ba20ca7edc3245eca5d8ffa182de120a71fc90"],["1f8d28dd4f286a8d0687b626b01204434bf5874a9550d6e375116490c154e108","1ce82e2360367e06f41757fd45239f9bc2c61609139446b09b55a9c43da98bb8"],["613eb914c015076e9ae8356bf508c289e50b1c87d9e2546f6e406362e248e5e5","3edbaafcd8c41ef4aa18b254137d201a2ef0ca4ca28807156bc949e920b97353"],["27bf43826bf0310b4b3e3a405eff790a1d77a8d48b04891246cff8e193cb03a9","16a24d749cc1d234fbe8af9cfd782c3aaa5869d6db0afa7b4d4c67037514f2ea"],["769a6a59746d7bead417bdd9c3b5f5ae1dbd924083ffd9e88df7714f57a675c2","22dc1267cfb2b41c590abb7dc3df45619af688d0421f2bdfb50748335ec5da25"],["795734ee4fcc24194219d25d41a2889cdb942f765848e9df63bff0b158c7224d","756420ab5c71127d39d2e79907634a177af0e483e08484ea4d7b76f7100669b5"],["644d12fc5e7fcac5aeb5911d8240971a99fc59fdd2903f46958e6896aefbcf46","173450789fcd40172e8124fea56f7aedad2ee13fa8fc5209cc8cb572175216dc"],["5deca767ef17b9e8d4f351f5c8ad1fcc50e97a2ed687516bf5210679fd6c1110","4ddf2207da12f700708089989da016f3307ce5721c9e27c952599d67898aa396"],["296dcb24cb3185d037a94bef93c97cacd09fc7050ba8472da59d4a689d9d2848","0b17dc85a4acf73833fab728f15abccac97cd09e57975bd996d3e1dd8b060f7b"],["408a3f1af2e77dfe94f8e225b40dfc146abb1002db7bcf15fde61c1a6cf1b93f","4f01ec38854c15a879e7c7924f048e2ec951dcdf04a614088b68fbcc0954e1c8"],["07d2d9234970cdc9483e0a7c5ec52c49077c440e0a993a1e624f90b8fafbbf07","6ac2190030c210ae3e07b9239f6ee7affba263866ee7831a564c511f703f2295"],["2982d553002082320aa899b9b6887e40dedf11868fa931689795d93d58452873","215e16ca447978624cad0ea6bf45aada4eca914425ee275db2a26e980dc349b6"],["1d8649515cb49e136d2895b6276569e5c711fe1a343eeb5a3daaa8d0e7b42d1a","5b21e2f2978f343a3e9ec3316cdc111af3b55f34afa5fc3fcbf6c26c1bb7fb6c"],["5460df4d607147939cdbc04dbdcbdffd37c5eafdd501b50a67213a23ee724a97","69dfc7004263ccb52487d34ab134b80bb3030273999739cb9cdc16d71b9abcd8"],["24623476f0af9f42ca15a0697ad23abeaf5ed9dc4d2b44f7e8175486598125bb","6aebe4a1a22d9e31194dcde6d33ff3af77dda15c22b2ecba9329849b8c042687"],["64e507a02bfd8a8413117bac253b17f94b2911681ebc07c92da0de6a651dd538","513ac992d72b463da110afb612fbae36590248a0507d845ee95fab2d1caa03a4"],["47f3bd11324f6bee230a22a5bb06a3ccddbc0473b810689efaeef894a654bf0e","7e05db9b3ff886bf32608dfc8d14eaa91e2e2ef230e7c75618060e4285c492be"],["4a6d22703a7045d02d656015ea2d168385d42963a739a895e4fd87b3e55c5e0f","4c58d7a8c6ded0451798e51f16ffa5b637a87aa5defb119ba868d8cccf61776d"],["3e22af70a548097244d7798964598172a90391f84c59b04cea7af283ba368eb5","689d8b7cda23b8dea197c5119fbbbd81dd4b59a36cc283dbe292b5b6519a2968"],["61a6ba2ca42d9d557b3a2ff0867c1b8bb8fc40192d31ff637431a302bc065a10","63d805f5a79f845ea2915a25cf0a8cab2e0255212a1bd3c8852b25579b63721d"],["03d963eeae48556e88305f91c478efcfd2168c346b9ba185884ec8621e8cb414","74b75cc839a944ad8c639719d20fd9d48d2099ef24c8633eabec7a9ec1e7e183"],["0f04da69e0202f7b44c58b103c88de09a0599951fedb17e7f2152d6b93a58ae9","1fbc1c9cd03c4cfd46e8e90019debf86e8036587eade038346f91070c800b8c4"],["797899e488353ed0c6666aff11913b33be0190833766e809b2a68cbc671a9cfe","5dd70a33ff94a84b3fe660f7070e6179e86b5c846689265bf985ce424b8909cc"],["735b64bb872606510e4e7d57833eb7ffdc4aa0dbaa242439806be68379f77cdd","384aaaee3ca7ba2436fcb65910859ca5ec30c10af11df7d777d287bc1a2bce2c"],["6f6ea532a62cf4766f55a0a72a86b55e73fe9d3328ee94bfc271e122f99dc1ac","61d8203ef6da5d0b584541c02331c7f58617cf8d4f26d11776236ce8b113ac10"],["5d99a2a3d4aed730b827b68ed836a9910dce4e7b93faf456981ad6cd85748773","7eeacf5680fb6108a8b7edb45f7134644111b08e17c236469685af5a79474b9e"],["31d0b4bb57bd7b69363c064a49bf3c3b9d7635bcc287e7b3059d3d99fd8382e8","1592e581034e13d47d02b8966f5359097e652391be8fb1e803f4219a22aba2c0"],["424cf5c498bbbe8fa7e5c3247049cc3f45946d0e5f38c44a36a6c84b60a84aa0","34acd712d334a2315dc8fd00c5c9b7c5c9f29bca27380a018882a5ab4a0fcb43"],["33a6ae0522936ba774837aa7959972f9804e3ef02ae84c8039be6595598be247","37022798cc08be9b4ded34c1c5062ab3a26081d375cadf517972fb48135a6602"],["5939635b72aeba595b5f6e376d11a3e07d4b1153ab4d0a7ab267b8bcc47cc3cb","382162eb33db2322cbe01a38fa4d13720b6d8edfaf8116a628725ef4293a6c27"],["3649e78d2ae9fb0ee86b691c27386efce4f3e383790e3cfee2bd59c2e85c4036","09b0d9e0dd82e697b9be9d61ce0d1410e281122b483125c48f7942b22f5d5be4"],["62c7585d1677b7619d8200175346ec99118416d8fdf0103730d165934e96a973","5fef7955ee07304429995433a468d68dec4ecf6b08bbe8cd06869080094044de"],["0c94537d311e17f5b0c58989b5be7e40c88b978a8c074a1e9bb07a713f77f6d3","6deaaa5001bcbbbe9ae436fe42f7042ce74fbf83c14058427fad4587ed33c4e2"],["6f5c6894a8d3877312e608c11809c15dffec3df551711095c8cfc810533e1b3e","74eadab9389b40d6ac6cc0d6e333d628ced60a9ef7617751c20630d23477af7b"],["4e16e88e171f9a07e11f97bba65c0fe5483501f255343afb3335ed47fbcee08f","41bcd7dd328871247cb7995bc6bd2e1961e94b0fb12e5fb2f264f9ad2cf47d4c"],["65d8484cef146e6c232fb262c2ac8200a52c63ccec26ff6f038aa5c74982c741","67283346bbae9391952b141e57ca8e3a36f0363d3b81b1c0f2b3c30a92c74235"],["1c588485b64be8cb99bf97f065e75a82138ea2e035ba90b63745354e9cf729f8","7c9a18d6ebf5465a197989cfb9b5b2a66a5402f46c4708ac04187c6b157a0d77"],["2c80c4ad0aebcafab7e9d2519a329f8a1c7df21cb6b1acec7403c0204d6dce71","7f8e62983160756e35356df95d44467e621c7274372997ca74a9fb760b4db36f"],["1e1e5fc87fa2c49e2c44d5718e3d73c73a91a64ac1374652080bd9004291b9c6","153828e90ed8d94c0f86e0eb54ccb31073cd29ed62c34cd9f2dbc5d98872e597"],["0ce0488a30ed446d445efb1bd21ba32ec3d05d538e6393bc0e58e0849ad57129","7278074ac66ac779136f4d6a334b27633645dea0fc98d137e3dbd4015d12b5a1"],["01a6b81f7285f293f19ba019b009aed8280ce285af42fab91e87fb0bbfa6dea4","60f910dc7c9a82e7836f36acfe7ec26b9babfa8bf26b2945b3c1a43b0c19b4dc"],["79b4ce3c6990023859646690c9ea800174902acfa1aad7ff34eca032dbde7150","53a1053d3fc6c749bf8a928854f392d09fa851ba963ca661bffbe74f012ba45b"],["220ee355b5c39c1901ed34c0f50f7778ad1bedcd7259ae167c16514ffe333498","05fd9374986e1e06035dbfada0117035b96b159354262f2b2695af1256d6aa2a"],["1e2f97d2cb4a19ca40403b364253da71f65d2d4665894267e3c6a9db8b4a3a18","22804fb035acb519210ff99ed7a974a725d896a77933789b4dd45a37dea3466d"],["35b8699fa20987876ac3b3086965b05f8cc809d71cab45e017c68ac96e24ed5b","155079de21981778dc438353bf2c6a65967a1a33ebb74c866fb42f4e3cce3e39"],["3cb40c55f5f19c52958e8c4ecd9c459b1d3268b3971b2286d3e58d1fc6b6a6bd","379e1f1f59df05c74485615b87441ba6203f0cdddc6873a883d4cc6dd1b75921"],["6ad916290e0d003ce5c961679f77704dcd768589d7cb728c60f56852031803bf","1e602b4a6725832a56944234f84c4f85f79911b55beef903549089925f2ccbea"],["7c0162492ae668160aa56a60e8bd43ec088555f750d2223cc37362dead5de123","34e60b446eae100d4c3abc6cb02e4ca559457fb5a9030a290a2568fa4cbf118f"],["354c25bf7b3e83dd0c5e1f39b82e3567edeb5337634056c1091cd6a016caacdf","7abb271ef121630f85a9a1049b3ad78d5b889f533b37a713b8801de46770fc3a"],["1e581a4bcf7504f33f4342b2097504d13f9b5a27f4790a6cdde1242209862850","2164d56564360fd2b5dba2f2c6ef1045ab448c3b60b2f2196c2f74625fc39e07"],["533b56f18283ee79b9a180b887c298961bd9aaa6fa3ef97fcb0d5688e694bc3d","6011366753812df2bce83634a92dbac18dd1cffdbf9a97fa1b1d5b49e0026764"],["4b508b94e6e2e6cd260a20664ea7d727ad20587b63ebe826032e0d20cdc6627b","1e8ecd6ff5aabae78172a0214d07a5013992d133af58afa74049de726df2a6c4"],["3398c0c0219f5ac87a8c73fcd17b89311d120a53f5231cb761030c194fed4265","025b234a1dc8662c068c4ba903939c2f79f3f7a3ae64e5edbf667b13599142d9"],["5941a17b04cd3465031cb6745cb94eed24e1ff8d38a6e832f1637ae8e89c78e6","5309792c546b6cda458be331957763b5adb5d535d54a4a61023678faa2ee02ee"],["2cb490d2c0047fcbaffe1df26640bee73c158af6fec91343d606ce9d124a20c9","2e2952ebf089200aebfa3947f241e2fe85797afebdc1ea06d9d26de1b446a964"],["79305236b583232a91c63c7d9ca3750be7ee21711e4d6d257c39ae398212bde1","6f9ecdfa953e302c2014fd8512405e4be0d48302acd15e93936e8dba7d01053b"],["57d9fcb884b94664f35387fa6665cd9bc8136f90d804d77416ea99c3c653ee63","14197e65f0a3599c0b9fcef75b5fbb93580d1b2457b59fb70ce7b9bac88d0fbc"],["6d99df2c28c9fa1e38acddefd3e0931109143d873f3330377a9926bdacdd6523","2f21987905f397f092fc56c5ccd301a1e6afa3c4611627e25017b2e68d07c150"],["749d19591f1755bd481fa12a288166aac42911654c8c551395b265116269ceb9","7ec145aa7558d0342cd87b1750933cb6f3717e727a86a1cc1f2b0c274213688d"],["340f7f5ae19292957902635a5786d14fa38036b324ae759da501e32b8c4073f1","64e231a413f1379a26f4e8223ff91fe2ccd865549571d3c6c28871964b40a0ea"],["4aa33e00bf6e92cac4e84384e5dde0727394233afd5d24d357a8afeb94b08109","3385bb4fbc441937ee01b671d506227a654fd6c1c532cf5221710c6c56ec7e21"],["34b2ffca05f01088de266306c5cc122661e9308eab16929774e58565afc0e4eb","7662faf0f70e82c062c2b835fc6da3353d3cb20b80611ffa6ef2982cf62fa605"],["820fcb51326f1536ddb8dc1052aa198406c7e48f2c81e7664d15f8f9d3715e","756574c23bb01170b97d9fa1663a8ff2f5b97eaa5cd53f34140c1bcec8c262d9"],["0861d7e84cec6d6e33641ff6c85202fc0e9160797809ddc2193802499caf05d3","34936e0a5dc7e2a6217d475fbb8c1c607fb8b3565908a04fd5948abdd399c59f"],["5b4a1dc887ef684d7b4b165b70acb70842a2fa105935af15ecb4a097e33b8f2b","54d21511c05805e5298a72372b8289e9d59c46dc8b5c368bbfda620b68aa652c"],["755493ed60b13f03f9c019362a5af73fb49842dd6916e2572b1b6a312cd20cfc","0750bcbf7e449cec422b93ace1489e1b177d4dbbaa781d315c74d54bb444e9a9"],["5f1c341065b6a81ed2edb6bc38ba81b4c2e3fe2058e5baa13e1406eb2c5b4b4b","6179ebfa7f8086f26820fc99ca2f94c1be19bca672d79cea5b02a836119e06ba"],["1915024ee86acfba3f61ced9707521197195166fb1c4639bf3b3fcf0bf0ded46","5f2e0547032221d2b00937cf524590e3d90901ef0286ea0b032c1a81461b6d92"],["4e942d95930f38c8786ff4a8e576e7a29fb7627afe1fff91cda5006ba0624f5d","45902f695d512d70ce4c1e0520c0060896b94e14d2960b2fcf2ed5e138e0217b"],["63e45f3d91ab915d412bbaa17d1d249e1a1445077fbfaa6be7d35041c5116a91","46dad5a4ec2ad0b86938f5e09f1c03b53b660fc5137648b08527cd20708003da"],["5e2ddd2175417f72c9962c503ac5adf94ed11f28b9d41fccb6a4512886f3cc87","3523b218478911145af1dc431feb7db0a04066eb6e2ade3c7b67d11bc55323aa"],["62ff30a6b179a26e7247a8312cb3af3289e5d722f76a29f203aa623889aa05ec","562beb7999019346beaa80dfd5b95d614e1ff96c1cb1037f65c44997b797d066"],["14988b5d62084fb8335c2f261cdeddc1b634b09cedfce713ff5f0a0bb588a556","447068731fb98e821b8e413b3b48f2d1c8bea308f05aac877006b0f4c3b0cab3"],["1ac777f708a5942cc434236920e82ccc6af920c0a0676712255aa7082b37a5b6","52a6f88d92af1887c781501c6e3a88169a2831b74aefd416f22b47e8335ce317"],["5959792833b71bd5042b78e42212af671f5f87a08eafd8cdde2dcec8140e4bb3","41ce94633eabb8a1b08fac66f762997ed8c9e2af3558e1f6586ad6a5bf5b7b64"],["4464a7962e6722b457336fe98c91765b1ff178f9e892e90129e65fa7688a0607","3d1510b92fd33c501f058a7a86bddedf1b83f9b6e4f04829d321117013f891fe"],["62906d81e7f800e662519f4324ab4c8aac197661c729eed3e744d09efe721c08","4b68efb5b1b709ab86e3253d70bee87ba07875c04a64ecf7e35cd8cdc6c0f7d8"],["4300ff025ac78ef36e58ee7d0d732cf76cd0929fe265b3a093a57f23fc326757","2f92880570846ff2e90d91f16bce3705c9c3ca8011cc543091463b623e4b3c01"],["5427ba28d94652527a9b0c76f57a451e46bdc06cbc8a2481df17f66ffb1524e3","547a97c4afc8d1f74a5d51f7e524f68472f589cc0b396b21368628721537d722"],["424c4493810bfd5e3ffa21776326d8ff62bf8fe74504d7a2db5d3f74e5ce1015","74d0daa832d40405d01551a58b330ffc5abd5356230d6d7cabeb5b1a55046f32"],["54e10980d81b4ae8778896684295fa5c5475e8d68ec2a26e1b0a65383507b3cd","6b1eb48da6886c4d88cea720e9dc8b0d8c51a8f0e1943afa31a40eeb553c0676"],["732eb9e9ebb556e9f024c5574166738f4707b0fd005f568212ab575c1db71ddb","1fc6b00c89e48114d6b13d9920a0c78093994f2b08df147bdbb56bead2cea165"],["74029c04b34b7f314855fee42a04d0ddfdeb92ef3bf7cff629928a97733d96fb","501f63a252dfbc090733b5a208bfe08f81c91419ce3d2d6c0de8cdc5a5625014"],["04524402ebb71a60bf1055001000203a6d4917f112e50dd766cdd7b718a6edd7","71c9e2d15cdc47c565a696ffbe55277570930ed7ade13b9a254059365d5bf338"],["2555c620a50f2bbeeacac66228a96941fa733aa6070855331613578ed7c12794","2b3c1bc5cda7f93242561dbf7572237ac43bf013553230633a5e18b7e71597e5"],["555ea607b0ad18afaf70d7450543d7ffb5b883a3cad3e2778826ca97bf3211a6","6df903158f51aa530d411720a760f8ad0ce9904d54955fda74a349be58eddf5f"],["4db3cfa284207a250a9c83e1fec07e804d70065da586ff2c2a7d2bcb92e6fca6","2a4fbf1c51dc0b2a7783db2be3bd35c2d6462470c88c8b73ae3ce8503fa07154"],["5174e33ffdf28a87184a4d6427d821cbaa3b88ac293a90ca7e1eeae8c5050b16","315ca6bc8e35e4a3d06f89e1db1575b16197963ee8e64746fa998ccd403561cc"]]},E8={step:4,points:[["23a4860627e53aeeb8e22b1508249c9109578d33e7bf237459b2596d6c28f9f8","709696f2827fc3729f980f2e3aad6e78b06a11ff8e079c27d87aab37c16727eb"],["5e7e07ed4e1decbfe6e9cbc126905449d4b578fbb561576d20b8bcdd0cc2a556","0f55755c51f102796bf5ebaa81d3260e7d1b3d9ac127d9a80e142031566cf6c7"],["7d13c0248b891b47eb524f2692008e2f97b199bac426cb5902b9003a29ded6ea","59a976ab2c01a81a91f1a56c75ccc77a9e1e9e878e9fe9c3952080a6805b20d5"],["5de7faa2ee4e70132f541f79ca07cd54a39fe1347a6844d19e9d678a8411a565","2c9f23641e1c2e0aab8ea9926b432d92c0e8bc08901d6ff6df85e4cef854ec36"],["06b349eebfed4dad4a805b63a6ed2231a565cda752d9477ff427dd9a8c9ab5ed","07a09289ff3e1f9aab68aa374c48df65f550c2323607b97744dee990608b64f8"],["0af367956af630266b1cc760154256ed79da960dddca9d72a1e8cf27d8d43a77","21108d900134d3b3708dd28ace96b0b23dda9100e4b6a62a8131bd2f2ba408c5"],["1e45a60140a3b2dee9b8dc6ff307154a1b410bcd38e0e38fb10b2f6da1afbe2b","0e730da473dffd60d2f3241a85e68acb47d26e5043ad047d893f072c8dda0a76"],["4d1e116d136158c5ddabd4276832800f2c081c1072de6f2d931797a46abc0cbb","6d415be49d4e35b65cc51354b5008f8c43e84b7b5e8a4b84f44e1efb10c9b91a"],["2b6b892ae94b454b2c2d92bb947fc4d506d173d281779c2c153c001ded42d3d0","7f1cf64e0e180fc4d6e12c1b5c5285f376e979616a52c94a0dea4d48c5880cd2"],["0f6c3a96e0032a9394337a02ffb2c83ba70efb8f566feab530fc90fa3b4710e5","3d4e97e286378675038a4b58e84224ee515e1d6697ac79389f78479be167635a"],["52ee53b981dfbc41ddaa5ddc2754c4175f4811aa45f8e2b19a425657c238a83e","7eb0a1be3400dec87b388cad51613957643cdf0595b891cc6f925fb36da7f1c3"],["52a837bc7a7bc9459bcc2ecf80f74d9ed99def0342e18cfbe8e799fbc504fd52","50d6460185d8924e5485f23f36a98c86053514d163547adab6fe91478a411196"],["6b2bd5d00fab38ceca21a27d6aaec82626b14b555d859527718f8ca404eba4","727340c27a15f6ab3d80547f0827c56ab1ba33bc30d1ef3909ea9a3af10c67e5"],["71dd75fe35761c01a48597ec730bc33237902fd4ad8612cbed1031eebdf40de4","39674a4532078e34378667beae5cb55f814ead9bbaf7e01b3b69533e9f88a411"],["57426aefc21be9ccf162e23d25ac3002ba8534351e65613f870f690f2fd46cf5","6b45b002fb4e8a6f59a6ffb006ed71f75434217333b266325204c7d1ac2e1f34"],["6222bd88bf2df9d5d44b60cfb4a08a960078db7ed51a35eb3e0b6b8ff4eda202","0325bb42ea4ed025dd6bdaed261b7c4f5410b608ba902b068f1efa5782e45313"],["71ac99647b61b9eca6f0c23432a518f738aee708d5932d4ef0f172240250a226","3a96c2c028ebe5f48913be30147e41bc5e1cab9595d5404138a9aa1b5574cf25"],["1f6a1fd8cc0e05b2742ba0fc0369b5247670543637dd033e64dbce90b2f23e9f","779964401ee869a9b31c0ef874a86440ba85d25c2ce932bd31a0865869605e19"],["22e2c039067920c42980dcb3a905fc91601c2b34e819ce1532ada4a5fc39d5cc","631cf9945a09bf26d7e595b3f8e3390696870512820df63c5418577089e1a8bb"],["608de273a9f6a534219d7aaede3cf65a81e4dc03d7a2765eced1d2b7be4610f4","3b31d0113f98d81ab1312fb2837aa9c8dcc7960f84eb371358c6d841f67144fa"],["3f748617ca63ab3e44c6e34f63e7328ea56a2a146da34368a57dca181254fe02","0fed89e6420fc47b3938a2891ba9acee4cbb2899ee4e9ca15a13dc527dc1641e"],["69d98b5ecc35d56c97c0bf312955d199befe116b417d70f5f57e2dfd0af81ce5","3e26d487fbfe36ab44e0ca3b248fe94bce92a69b8154d50e2d5481f8259f4e8e"],["1e34443347f9e627b3531157faab6eaca1bc3114df4a1423cc12bf8417b5d622","295955a5ed061eca7f87b9485666ba9489ec20a9c484224dc920350bb4a6fc79"],["51f4ff8c599b1c96da82941520a9f5abf4a31eb8b84fc95056145ceb3b5775d0","35ac9588d46e41f3f6f99aee3852eeb4b12e807807d4bd1b7f8406b0d7863ac1"],["3faa2a093a19a02424f65a10955101f4dc015c43b2dfce8e001507abd741b845","7a1de10dacfda389ca663b15574bdc8ae8c5b6e7cee647e77b11ddbfc6eb8edc"],["1924416956ea2c1269062588569b18178011ea7cba1a3266284f48aa01d5a90f","0c8e28127b7dcdd206fb6fee96eb88cfc7db7319826ac8cdb8b1fb8adaf021de"],["49761c57ce3c8c4f1435d495903e2f536f3be3712e76af8d0b5a8b7d1ebc8fac","3225035e1065094ef32d7f3e7a6f8ff2748025f96e0c0b44eb35576b61e150a8"],["4339fa86a23242851a16afc3ab05b352a7b4bf53599a49dd7e29d364fc3a757b","6d07cc3462bae9160bbebb997510817040767faa9dbd13f158a5fe8a63a34b0e"],["6bda13918dcbaf8529d6326ae7a9c278b72417c2188c5ea4f062fc50639295fb","2c3fa803b162ee887d0d97a6734866f992f846625f314117075da54bb6c20a36"],["4da4821314574d4fed4dcf692c8b15b99b73f13633210333ce7871359b6e6424","314016034673d2d20529bc93a2dab6e462bcb5f66e1f4a6bf2170759a40a6e65"],["0b2cea0029ee963c0034b61bf19e384435f14554a7d297b5144838c38e375586","47ea95da28d39aaade5edb8ed941c687603cfdd1508776e96d6683199e99daea"],["4c27afff3c45f32c952d3984e14e29a098e685c9c2e723e5fc8047ae60b7e824","5f2c99e6526dc87d95f11eb626c29c3a90d0be1e51a4c49e5bbabd114bf5a66b"],["53e2a4ed1bbb48bd016c524a02f797654cfc969849f867681da94e341f377534","5a2334fdda642732a3c9520ce06581aa7f0f082882554c37b8d390a25a9bd559"],["7b8d2c823baafe0d878a55e8af1db150dec85b1424a4901f9beffd3a6196e3d6","1c45a557b3624f9b89ed15b3c3e1a065f1b453d948f7cf45d9494483f8af0c85"],["78877b5d8777410997dacaeea59400fc9db4421fac02c4282301c67d35fb7ffe","0341b46c328333e4484ce8607619014d41775c408c88856d2f9e19812d90fbf5"],["2b556bbc070b5c4bae9e575836d1d68ee9fbe800448c0d2c233f78185eed3f91","7ba01332807ebd892e00ddb368c0fa1b3f19b5b32efd90b178d984e1d7174d6f"],["0f72556998b0044799f0fd03210ded3d984e3843bbaf3c1d5d692bc94d43c4e7","16c19c5037c103d447caef4efe6bd81a490e7c668f6870f1b080863b5315df5e"],["1cd96ef237b213cd446f13b3ec40d32ecc593bc6ea71e77efc284341a5f3da1a","7a626aeb91efcb5f9777264f5e17ced8b411f68c713673ef0f184a5ccd60dbe3"],["31a75b21cb532622a7caf9e29e652ac4e47b1450edf6655acaf3797b55a7ca46","77006e7cf104982f8865081a2ff8a6911546755e31c3586353b0bd0826c5d790"],["543d84cb04fb2bf787b7aa382eaab5cd8d050ad8ee52aa8a285b945652014031","0358fdc5b63ed49e693d838f182b275846f42dd49a42ec2e6e932ba4de59ef20"],["0a2818f5f5d8937800c30ac6b847db2cdef655b864126302249144a5a15b205a","187c76a49af10851bb049ba97c0fbbb14b2621522a4e8d9670ea46e56c9a1bd6"],["7efb45d3a2851109d7a8d50ddb08fe308bbf674c019b965cdad4570a141e648a","0fe1198b11a1bf56867091c69d71f8b7792257dda321d43652e818acd0c28cda"],["472e960dd122a534f52377235350549df4a1dd7a08cfc580bff5fb4b0a70aa7b","10585d04fc529fef4c0c0776154fc7ebbaedbae8a99937e47598d0578932b7cc"],["04892cfff7f94ff7f07c1241e3ac4945bc46ea9d6a3c1c3adbce109a9afceb6a","3ae2aa25e2555135a7a3251c11a3f8eebe81758bc1c3e2cbc6e6ca461a543130"],["2401d311a3abfd2583f1c6aa519c1f18ff730a0abf730ddcc9c9739b04d8a85e","653224f3488cae1ae19a414a9932035a2bf2c46803b5532bbb645e62387ee34d"],["0ea2c846a535a115972161612a192588d92d68a3c9050eae91b2817b94e68325","3b82a8337b05f11bbac176a113be183a50a0331f3d3116f24b971b5a8b0d031b"],["0fb3f87c2c6c89c65b74299b77f3736546a8b9e41b19197476bff27354e1c128","1034d42c15a2bfe3e682fad49dbc2812caadf0c584bc30b51625b85d74e9d5f7"],["1bc7af1e38185e7c2d8d04371c7e177d7a9ddee1b81d7d26db7ad644c7dad28d","61d909d855661f2f7a5eef87795dc0491d027e12631b270fcaf2f65900314833"],["469d0960dbd0ef9c91c4597ccf7c209549b187ff63bd378b7dac577198d74a4d","0b5f21c7f86832241f2157c288bdc9394f83f8d57457f6d9f6b345e4909478cb"],["5e9ac4ab2f4a3c3526e1317f913d69e3826fe862efd0c80d9310319170c5cbeb","505f00fa8aee03ccbd2f33529ae1e4e4bcf2644fe673d0b0290ec32be5b51bab"],["11cd80e1fdcbc565efed81d17f3f54643ffeed1cff38f3825e115adbd82759f1","43f11943f7ef3fa68b980fee45e98134f1df22263b2d14419d61ffe62822dbe0"],["3328bc121616a9477165ed282053d203c24f4826076c638a2c6723d42c9bfadb","2bbf3f26c21b5cb273e5f4f0114c6718c5eb7291939b7697c74333cdfafac039"],["0ba774bb605dd804cae6887e81f6bd2c59e024fac8bf5f5c48a841a037c28398","54ba013ad2d04dcdfb5a151b7347ee9a10067ddd0a3907e9bc337a77bf911321"],["1074ff0267662dc2b4ce65aaa0229c375a3d0d843ce9349233949581c869b64c","299be0decb680ec28923da4d049770107d42c180b460da13a7b1efc7e6d5b022"],["25ed76d78c87c3bd64b4331902c5a853734283e25f19f320295667b80a340d35","179b5f92f545c7b326b3a63fb0b32a0f52b4159988436d5af50c1d0d76373947"],["75d942c04210dcde5d1bd4fabfc732d3f95568e399382c0423c83c41cb05dc3f","696cc14856cdc13c8fd7e2c5771731cbf38e3fad47a424679765c4874e35ab2d"],["5d9324f56975477d5945599eeeccec67708c996cd3f3f2818bf2591507e3502a","10985a3cfd573205281aec24e2c8b41f5cd8cdfc9d7be34675cf306bbe1b4f6a"],["7511066c0e12105a7b937c7ecef367d5afe6e621e5cabf4e490b09b7ada7ee07","604df365b8391cbca8848f88daa700b770da5bb136f70bfb0a3ea33ba386fcd5"],["2596e5b3cf5494e60d2a750d03c66abc2e0183af53620b893f9cf9fc3b76dc26","68a0a7ac9a0cc093884a6b84f45a2cde595194e0f48dbd566fa78a3174b182fe"],["28bd38d44030dd9ca028b2a2f31a795f4c7a5e85a785df7847e3d525e99d4787","552dd7405c4183733ad3c4e7ccb999b4fed81b7a4444aab499d41d6d78d5bbfc"],["59233a3346f61135f431f96cf0197e24ad38240b222c010a6ce538cf4c24347b","3cce55908611d2b93f221613f09cfc4dbcd2e2b609233eea5439ad1908a10b20"],["5830f025f1078d408948f73096af97de1e9e70b3be85890acb21132c34ff961f","67d451752c2433ffe66e47242e301e56db2b2f8203553cab9de717e25793d41e"],["6a0c8b194571e874b82d904da36d43096bbe36d512e24ff8dcb2b00b57ffd3ec","5f85adb7749cc735ec838bcccfe7d4b52902c6132998d7ac8e032cad031c42b8"],["53b3f967bff8760948dec5e9282f35d1434a5503790b9012e17faefbe7c4d699","404462283c8664a17daa5b4059dcd10e2699fd86d0140de9f3e8ad0566098ae5"]]};var A8={naf:_8,doubles:E8},df=new S8("X25519","ED25519",A8);/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var I8=function(t){return t!=null&&t.constructor!=null&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)},T8=(e,t={})=>{const r=oo(e),i=lr.decode.fromReader(r.reader,t),n={read:async s=>{const{value:a,done:c}=await r.reader.next(s);if(c&&a.length<s)throw new Error("Couldn't read enough bytes");if(!a)throw new Error("Value is null");return a},readLP:async()=>{const{value:s,done:a}=await i.next();if(!s)throw new Error("Value is null");return s},readPB:async s=>{const a=await n.readLP();if(!a)throw new Error("Value is null");const c=I8(a)?a:a.slice();return s.decode(c)},write:s=>{r.writer.push(s)},writeLP:s=>{n.write(lr.encode.single(s,t))},writePB:(s,a)=>{n.writeLP(a.encode(s))},pb:s=>({read:()=>n.readPB(s),write:a=>n.writePB(a,s)}),unwrap:()=>(r.rest(),r.stream)};return n},yb=function(){let t,r;const i=async s=>{if(t)throw new Error("already piped");t=il(s),r&&r(t)},n={[Symbol.asyncIterator](){return this},next(){return t?t.next():new Promise(s=>{r=a=>{r=null,s(a.next())}})}};return{sink:i,source:n}},C8=function(){var e=yb(),t=yb();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]};function vb(e,t,r){return fe(e&&typeof e.id=="string"),t==null&&(t=Buffer.alloc(0)),r==null&&(r=Buffer.alloc(e.size,0)),e.mac(t,r)}function wb(e,t,r,i){if(r==null&&(r=Buffer.alloc(0)),fe(e&&typeof e.id=="string"),fe(Buffer.isBuffer(t)),fe(Buffer.isBuffer(r)),fe(i>>>0===i),t.length!==e.size)throw new RangeError("Invalid PRK length.");const n=Math.ceil(i/e.size);if(n>255)throw new RangeError("Invalid output length.");const s=Buffer.alloc(n*e.size),a=Buffer.from([0]),c=e.hmac();let o=Buffer.alloc(0),d=0;for(let l=0;l<n;l++)a[0]+=1,c.init(t),c.update(o),c.update(r),c.update(a),o=c.final(),d+=o.copy(s,d);return s.slice(0,i)}function R8(e,t,r,i,n){const s=vb(e,t,r);return wb(e,s,i,n)}var M8=0,k8=vb,P8=wb,N8=R8,x8={native:M8,extract:k8,expand:P8,derive:N8},O8=x8;class D8{constructor(e,t,r=[],i=[]){fe(typeof e=="function"),fe(t>>>0===t),fe(Array.isArray(r)),fe(Array.isArray(i)),this.hash=e,this.size=t,this.x=r,this.y=i,this.inner=new e,this.outer=new e}init(e){if(fe(Buffer.isBuffer(e)),e.length>this.size){const r=this.hash,i=new r;i.init(...this.x),i.update(e),e=i.final(...this.y),fe(e.length<=this.size)}const t=Buffer.alloc(this.size);for(let r=0;r<e.length;r++)t[r]=e[r]^54;for(let r=e.length;r<t.length;r++)t[r]=54;this.inner.init(...this.x),this.inner.update(t);for(let r=0;r<e.length;r++)t[r]=e[r]^92;for(let r=e.length;r<t.length;r++)t[r]=92;return this.outer.init(...this.x),this.outer.update(t),this}update(e){return this.inner.update(e),this}final(){return this.outer.update(this.inner.final(...this.y)),this.outer.final(...this.y)}}var B8=D8;const Sd=-1,lf=Buffer.alloc(8,0),Sb=Buffer.alloc(64,0);Sb[0]=128;const L8=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);class Cr{constructor(){this.state=new Uint32Array(8),this.msg=new Uint32Array(64),this.block=Buffer.alloc(64),this.size=Sd}init(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.size=0,this}update(e){return fe(Buffer.isBuffer(e)),this._update(e,e.length),this}final(){return this._final(Buffer.alloc(32))}_update(e,t){fe(this.size!==Sd,"Context is not initialized.");let r=this.size&63,i=0;if(this.size+=t,r>0){let n=64-r;if(n>t&&(n=t),e.copy(this.block,r,i,i+n),r+=n,t-=n,i+=n,r<64)return;this._transform(this.block,0)}for(;t>=64;)this._transform(e,i),i+=64,t-=64;t>0&&e.copy(this.block,0,i,i+t)}_final(e){fe(this.size!==Sd,"Context is not initialized.");const t=this.size&63,r=this.size*8;uf(lf,r*(1/4294967296)>>>0,0),uf(lf,r>>>0,4),this._update(Sb,1+(119-t&63)),this._update(lf,8);for(let i=0;i<8;i++)uf(e,this.state[i],i*4),this.state[i]=0;for(let i=0;i<64;i++)this.msg[i]=0;for(let i=0;i<64;i++)this.block[i]=0;return this.size=Sd,e}_transform(e,t){const r=this.msg;let i=this.state[0],n=this.state[1],s=this.state[2],a=this.state[3],c=this.state[4],o=this.state[5],d=this.state[6],l=this.state[7],u=0;for(;u<16;u++)r[u]=H8(e,t+u*4);for(;u<64;u++)r[u]=q8(r[u-2])+r[u-7]+U8(r[u-15])+r[u-16];for(u=0;u<64;u++){const p=l+F8(c)+z8(c,o,d)+L8[u]+r[u],f=j8(i)+$8(i,n,s);l=d,d=o,o=c,c=a+p>>>0,a=s,s=n,n=i,i=p+f>>>0}this.state[0]+=i,this.state[1]+=n,this.state[2]+=s,this.state[3]+=a,this.state[4]+=c,this.state[5]+=o,this.state[6]+=d,this.state[7]+=l}static hash(){return new Cr}static hmac(){return new B8(Cr,64)}static digest(e){return Cr.ctx.init().update(e).final()}static root(e,t){return fe(Buffer.isBuffer(e)&&e.length===32),fe(Buffer.isBuffer(t)&&t.length===32),Cr.ctx.init().update(e).update(t).final()}static multi(e,t,r){const{ctx:i}=Cr;return i.init(),i.update(e),i.update(t),r&&i.update(r),i.final()}static mac(e,t){return Cr.hmac().init(t).update(e).final()}}Cr.native=0,Cr.id="SHA256",Cr.size=32,Cr.bits=256,Cr.blockSize=64,Cr.zero=Buffer.alloc(32,0),Cr.ctx=new Cr;function j8(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function F8(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function U8(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}function q8(e){return(e>>>17|e<<15)^(e>>>19|e<<13)^e>>>10}function z8(e,t,r){return r^e&(t^r)}function $8(e,t,r){return e&t|r&(e|t)}function H8(e,t){return e[t++]*16777216+e[t++]*65536+e[t++]*256+e[t]}function uf(e,t,r){return e[r++]=t>>>24,e[r++]=t>>>16,e[r++]=t>>>8,e[r++]=t,r}var _b=Cr,V8=G8;function G8(e,t){for(var r=new Array(arguments.length-1),i=0,n=2,s=!0;n<arguments.length;)r[i++]=arguments[n++];return new Promise(function(c,o){r[i]=function(l){if(s)if(s=!1,l)o(l);else{for(var u=new Array(arguments.length-1),p=0;p<u.length;)u[p++]=arguments[p];c.apply(null,u)}};try{e.apply(t||null,r)}catch(d){s&&(s=!1,o(d))}})}var X8=ne(function(e,t){var r=t;r.length=function(o){var d=o.length;if(!d)return 0;for(var l=0;--d%4>1&&o.charAt(d)==="=";)++l;return Math.ceil(o.length*3)/4-l};for(var i=new Array(64),n=new Array(123),s=0;s<64;)n[i[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;r.encode=function(o,d,l){for(var u=null,p=[],f=0,g=0,v;d<l;){var S=o[d++];switch(g){case 0:p[f++]=i[S>>2],v=(S&3)<<4,g=1;break;case 1:p[f++]=i[v|S>>4],v=(S&15)<<2,g=2;break;case 2:p[f++]=i[v|S>>6],p[f++]=i[S&63],g=0;break}f>8191&&((u||(u=[])).push(String.fromCharCode.apply(String,p)),f=0)}return g&&(p[f++]=i[v],p[f++]=61,g===1&&(p[f++]=61)),u?(f&&u.push(String.fromCharCode.apply(String,p.slice(0,f))),u.join("")):String.fromCharCode.apply(String,p.slice(0,f))};var a="invalid encoding";r.decode=function(o,d,l){for(var u=l,p=0,f,g=0;g<o.length;){var v=o.charCodeAt(g++);if(v===61&&p>1)break;if((v=n[v])===void 0)throw Error(a);switch(p){case 0:f=v,p=1;break;case 1:d[l++]=f<<2|(v&48)>>4,f=v,p=2;break;case 2:d[l++]=(f&15)<<4|(v&60)>>2,f=v,p=3;break;case 3:d[l++]=(f&3)<<6|v,p=0;break}}if(p===1)throw Error(a);return l-u},r.test=function(o){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(o)}}),K8=_d;function _d(){this._listeners={}}_d.prototype.on=function(t,r,i){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:r,ctx:i||this}),this},_d.prototype.off=function(t,r){if(t===void 0)this._listeners={};else if(r===void 0)this._listeners[t]=[];else for(var i=this._listeners[t],n=0;n<i.length;)i[n].fn===r?i.splice(n,1):++n;return this},_d.prototype.emit=function(t){var r=this._listeners[t];if(r){for(var i=[],n=1;n<arguments.length;)i.push(arguments[n++]);for(n=0;n<r.length;)r[n].fn.apply(r[n++].ctx,i)}return this};var W8=Eb(Eb);function Eb(e){return typeof Float32Array!="undefined"?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),i=r[3]===128;function n(o,d,l){t[0]=o,d[l]=r[0],d[l+1]=r[1],d[l+2]=r[2],d[l+3]=r[3]}function s(o,d,l){t[0]=o,d[l]=r[3],d[l+1]=r[2],d[l+2]=r[1],d[l+3]=r[0]}e.writeFloatLE=i?n:s,e.writeFloatBE=i?s:n;function a(o,d){return r[0]=o[d],r[1]=o[d+1],r[2]=o[d+2],r[3]=o[d+3],t[0]}function c(o,d){return r[3]=o[d],r[2]=o[d+1],r[1]=o[d+2],r[0]=o[d+3],t[0]}e.readFloatLE=i?a:c,e.readFloatBE=i?c:a}():function(){function t(i,n,s,a){var c=n<0?1:0;if(c&&(n=-n),n===0)i(1/n>0?0:2147483648,s,a);else if(isNaN(n))i(2143289344,s,a);else if(n>34028234663852886e22)i((c<<31|2139095040)>>>0,s,a);else if(n<11754943508222875e-54)i((c<<31|Math.round(n/1401298464324817e-60))>>>0,s,a);else{var o=Math.floor(Math.log(n)/Math.LN2),d=Math.round(n*Math.pow(2,-o)*8388608)&8388607;i((c<<31|o+127<<23|d)>>>0,s,a)}}e.writeFloatLE=t.bind(null,Ab),e.writeFloatBE=t.bind(null,Ib);function r(i,n,s){var a=i(n,s),c=(a>>31)*2+1,o=a>>>23&255,d=a&8388607;return o===255?d?NaN:c*Infinity:o===0?c*1401298464324817e-60*d:c*Math.pow(2,o-150)*(d+8388608)}e.readFloatLE=r.bind(null,Tb),e.readFloatBE=r.bind(null,Cb)}(),typeof Float64Array!="undefined"?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),i=r[7]===128;function n(o,d,l){t[0]=o,d[l]=r[0],d[l+1]=r[1],d[l+2]=r[2],d[l+3]=r[3],d[l+4]=r[4],d[l+5]=r[5],d[l+6]=r[6],d[l+7]=r[7]}function s(o,d,l){t[0]=o,d[l]=r[7],d[l+1]=r[6],d[l+2]=r[5],d[l+3]=r[4],d[l+4]=r[3],d[l+5]=r[2],d[l+6]=r[1],d[l+7]=r[0]}e.writeDoubleLE=i?n:s,e.writeDoubleBE=i?s:n;function a(o,d){return r[0]=o[d],r[1]=o[d+1],r[2]=o[d+2],r[3]=o[d+3],r[4]=o[d+4],r[5]=o[d+5],r[6]=o[d+6],r[7]=o[d+7],t[0]}function c(o,d){return r[7]=o[d],r[6]=o[d+1],r[5]=o[d+2],r[4]=o[d+3],r[3]=o[d+4],r[2]=o[d+5],r[1]=o[d+6],r[0]=o[d+7],t[0]}e.readDoubleLE=i?a:c,e.readDoubleBE=i?c:a}():function(){function t(i,n,s,a,c,o){var d=a<0?1:0;if(d&&(a=-a),a===0)i(0,c,o+n),i(1/a>0?0:2147483648,c,o+s);else if(isNaN(a))i(0,c,o+n),i(2146959360,c,o+s);else if(a>17976931348623157e292)i(0,c,o+n),i((d<<31|2146435072)>>>0,c,o+s);else{var l;if(a<22250738585072014e-324)l=a/5e-324,i(l>>>0,c,o+n),i((d<<31|l/4294967296)>>>0,c,o+s);else{var u=Math.floor(Math.log(a)/Math.LN2);u===1024&&(u=1023),l=a*Math.pow(2,-u),i(l*4503599627370496>>>0,c,o+n),i((d<<31|u+1023<<20|l*1048576&1048575)>>>0,c,o+s)}}}e.writeDoubleLE=t.bind(null,Ab,0,4),e.writeDoubleBE=t.bind(null,Ib,4,0);function r(i,n,s,a,c){var o=i(a,c+n),d=i(a,c+s),l=(d>>31)*2+1,u=d>>>20&2047,p=4294967296*(d&1048575)+o;return u===2047?p?NaN:l*Infinity:u===0?l*5e-324*p:l*Math.pow(2,u-1075)*(p+4503599627370496)}e.readDoubleLE=r.bind(null,Tb,0,4),e.readDoubleBE=r.bind(null,Cb,4,0)}(),e}function Ab(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function Ib(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=e&255}function Tb(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function Cb(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var Y8=Z8;function Z8(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var J8=ne(function(e,t){var r=t;r.length=function(n){for(var s=0,a=0,c=0;c<n.length;++c)a=n.charCodeAt(c),a<128?s+=1:a<2048?s+=2:(a&64512)===55296&&(n.charCodeAt(c+1)&64512)===56320?(++c,s+=4):s+=3;return s},r.read=function(n,s,a){var c=a-s;if(c<1)return"";for(var o=null,d=[],l=0,u;s<a;)u=n[s++],u<128?d[l++]=u:u>191&&u<224?d[l++]=(u&31)<<6|n[s++]&63:u>239&&u<365?(u=((u&7)<<18|(n[s++]&63)<<12|(n[s++]&63)<<6|n[s++]&63)-65536,d[l++]=55296+(u>>10),d[l++]=56320+(u&1023)):d[l++]=(u&15)<<12|(n[s++]&63)<<6|n[s++]&63,l>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,d)),l=0);return o?(l&&o.push(String.fromCharCode.apply(String,d.slice(0,l))),o.join("")):String.fromCharCode.apply(String,d.slice(0,l))},r.write=function(n,s,a){for(var c=a,o,d,l=0;l<n.length;++l)o=n.charCodeAt(l),o<128?s[a++]=o:o<2048?(s[a++]=o>>6|192,s[a++]=o&63|128):(o&64512)===55296&&((d=n.charCodeAt(l+1))&64512)===56320?(o=65536+((o&1023)<<10)+(d&1023),++l,s[a++]=o>>18|240,s[a++]=o>>12&63|128,s[a++]=o>>6&63|128,s[a++]=o&63|128):(s[a++]=o>>12|224,s[a++]=o>>6&63|128,s[a++]=o&63|128);return a-c}}),Q8=e6;function e6(e,t,r){var i=r||8192,n=i>>>1,s=null,a=i;return function(o){if(o<1||o>n)return e(o);a+o>i&&(s=e(i),a=0);var d=t.call(s,a,a+=o);return a&7&&(a=(a|7)+1),d}}var t6=Zt;function Zt(e,t){this.lo=e>>>0,this.hi=t>>>0}var ks=Zt.zero=new Zt(0,0);ks.toNumber=function(){return 0},ks.zzEncode=ks.zzDecode=function(){return this},ks.length=function(){return 1};var r6=Zt.zeroHash="\0\0\0\0\0\0\0\0";Zt.fromNumber=function(t){if(t===0)return ks;var r=t<0;r&&(t=-t);var i=t>>>0,n=(t-i)/4294967296>>>0;return r&&(n=~n>>>0,i=~i>>>0,++i>4294967295&&(i=0,++n>4294967295&&(n=0))),new Zt(i,n)},Zt.from=function(t){if(typeof t=="number")return Zt.fromNumber(t);if(xe.isString(t))if(xe.Long)t=xe.Long.fromString(t);else return Zt.fromNumber(parseInt(t,10));return t.low||t.high?new Zt(t.low>>>0,t.high>>>0):ks},Zt.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var r=~this.lo+1>>>0,i=~this.hi>>>0;return r||(i=i+1>>>0),-(r+i*4294967296)}return this.lo+this.hi*4294967296},Zt.prototype.toLong=function(t){return xe.Long?new xe.Long(this.lo|0,this.hi|0,Boolean(t)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(t)}};var Wn=String.prototype.charCodeAt;Zt.fromHash=function(t){return t===r6?ks:new Zt((Wn.call(t,0)|Wn.call(t,1)<<8|Wn.call(t,2)<<16|Wn.call(t,3)<<24)>>>0,(Wn.call(t,4)|Wn.call(t,5)<<8|Wn.call(t,6)<<16|Wn.call(t,7)<<24)>>>0)},Zt.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Zt.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},Zt.prototype.zzDecode=function(){var t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},Zt.prototype.length=function(){var t=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return i===0?r===0?t<16384?t<128?1:2:t<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:i<128?9:10};var xe=ne(function(e,t){var r=t;r.asPromise=V8,r.base64=X8,r.EventEmitter=K8,r.float=W8,r.inquire=Y8,r.utf8=J8,r.pool=Q8,r.LongBits=t6,r.isNode=Boolean(typeof se!="undefined"&&se&&se.process&&se.process.versions&&se.process.versions.node),r.global=r.isNode&&se||typeof window!="undefined"&&window||typeof self!="undefined"&&self||se,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(a){return typeof a=="number"&&isFinite(a)&&Math.floor(a)===a},r.isString=function(a){return typeof a=="string"||a instanceof String},r.isObject=function(a){return a&&typeof a=="object"},r.isset=r.isSet=function(a,c){var o=a[c];return o!=null&&a.hasOwnProperty(c)?typeof o!="object"||(Array.isArray(o)?o.length:Object.keys(o).length)>0:!1},r.Buffer=function(){try{var s=r.inquire("buffer").Buffer;return s.prototype.utf8Write?s:null}catch(a){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(a){return typeof a=="number"?r.Buffer?r._Buffer_allocUnsafe(a):new r.Array(a):r.Buffer?r._Buffer_from(a):typeof Uint8Array=="undefined"?a:new Uint8Array(a)},r.Array=typeof Uint8Array!="undefined"?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(a){return a?r.LongBits.from(a).toHash():r.LongBits.zeroHash},r.longFromHash=function(a,c){var o=r.LongBits.fromHash(a);return r.Long?r.Long.fromBits(o.lo,o.hi,c):o.toNumber(Boolean(c))};function i(s,a,c){for(var o=Object.keys(a),d=0;d<o.length;++d)(s[o[d]]===void 0||!c)&&(s[o[d]]=a[o[d]]);return s}r.merge=i,r.lcFirst=function(a){return a.charAt(0).toLowerCase()+a.substring(1)};function n(s){function a(c,o){if(!(this instanceof a))return new a(c,o);Object.defineProperty(this,"message",{get:function(){return c}}),Error.captureStackTrace?Error.captureStackTrace(this,a):Object.defineProperty(this,"stack",{value:new Error().stack||""}),o&&i(this,o)}return(a.prototype=Object.create(Error.prototype)).constructor=a,Object.defineProperty(a.prototype,"name",{get:function(){return s}}),a.prototype.toString=function(){return this.name+": "+this.message},a}r.newError=n,r.ProtocolError=n("ProtocolError"),r.oneOfGetter=function(a){for(var c={},o=0;o<a.length;++o)c[a[o]]=1;return function(){for(var d=Object.keys(this),l=d.length-1;l>-1;--l)if(c[d[l]]===1&&this[d[l]]!==void 0&&this[d[l]]!==null)return d[l]}},r.oneOfSetter=function(a){return function(c){for(var o=0;o<a.length;++o)a[o]!==c&&delete this[a[o]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var s=r.Buffer;if(!s){r._Buffer_from=r._Buffer_allocUnsafe=null;return}r._Buffer_from=s.from!==Uint8Array.from&&s.from||function(c,o){return new s(c,o)},r._Buffer_allocUnsafe=s.allocUnsafe||function(c){return new s(c)}}}),ff=Ve,hf,Ed=xe.LongBits,Rb=xe.base64,Mb=xe.utf8;function Xo(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function pf(){}function i6(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Ve(){this.len=0,this.head=new Xo(pf,0,0),this.tail=this.head,this.states=null}var kb=function(){return xe.Buffer?function(){return(Ve.create=function(){return new hf})()}:function(){return new Ve}};Ve.create=kb(),Ve.alloc=function(t){return new xe.Array(t)},xe.Array!==Array&&(Ve.alloc=xe.pool(Ve.alloc,xe.Array.prototype.subarray)),Ve.prototype._push=function(t,r,i){return this.tail=this.tail.next=new Xo(t,r,i),this.len+=r,this};function mf(e,t,r){t[r]=e&255}function n6(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}function gf(e,t){this.len=e,this.next=void 0,this.val=t}gf.prototype=Object.create(Xo.prototype),gf.prototype.fn=n6,Ve.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new gf((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},Ve.prototype.int32=function(t){return t<0?this._push(bf,10,Ed.fromNumber(t)):this.uint32(t)},Ve.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)};function bf(e,t,r){for(;e.hi;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}Ve.prototype.uint64=function(t){var r=Ed.from(t);return this._push(bf,r.length(),r)},Ve.prototype.int64=Ve.prototype.uint64,Ve.prototype.sint64=function(t){var r=Ed.from(t).zzEncode();return this._push(bf,r.length(),r)},Ve.prototype.bool=function(t){return this._push(mf,1,t?1:0)};function yf(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}Ve.prototype.fixed32=function(t){return this._push(yf,4,t>>>0)},Ve.prototype.sfixed32=Ve.prototype.fixed32,Ve.prototype.fixed64=function(t){var r=Ed.from(t);return this._push(yf,4,r.lo)._push(yf,4,r.hi)},Ve.prototype.sfixed64=Ve.prototype.fixed64,Ve.prototype.float=function(t){return this._push(xe.float.writeFloatLE,4,t)},Ve.prototype.double=function(t){return this._push(xe.float.writeDoubleLE,8,t)};var s6=xe.Array.prototype.set?function(t,r,i){r.set(t,i)}:function(t,r,i){for(var n=0;n<t.length;++n)r[i+n]=t[n]};Ve.prototype.bytes=function(t){var r=t.length>>>0;if(!r)return this._push(mf,1,0);if(xe.isString(t)){var i=Ve.alloc(r=Rb.length(t));Rb.decode(t,i,0),t=i}return this.uint32(r)._push(s6,r,t)},Ve.prototype.string=function(t){var r=Mb.length(t);return r?this.uint32(r)._push(Mb.write,r,t):this._push(mf,1,0)},Ve.prototype.fork=function(){return this.states=new i6(this),this.head=this.tail=new Xo(pf,0,0),this.len=0,this},Ve.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Xo(pf,0,0),this.len=0),this},Ve.prototype.ldelim=function(){var t=this.head,r=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=t.next,this.tail=r,this.len+=i),this},Ve.prototype.finish=function(){for(var t=this.head.next,r=this.constructor.alloc(this.len),i=0;t;)t.fn(t.val,r,i),i+=t.len,t=t.next;return r},Ve._configure=function(e){hf=e,Ve.create=kb(),hf._configure()};var a6=$i;($i.prototype=Object.create(ff.prototype)).constructor=$i;function $i(){ff.call(this)}$i._configure=function(){$i.alloc=xe._Buffer_allocUnsafe,$i.writeBytesBuffer=xe.Buffer&&xe.Buffer.prototype instanceof Uint8Array&&xe.Buffer.prototype.set.name==="set"?function(t,r,i){r.set(t,i)}:function(t,r,i){if(t.copy)t.copy(r,i,0,t.length);else for(var n=0;n<t.length;)r[i++]=t[n++]}},$i.prototype.bytes=function(t){xe.isString(t)&&(t=xe._Buffer_from(t,"base64"));var r=t.length>>>0;return this.uint32(r),r&&this._push($i.writeBytesBuffer,r,t),this};function o6(e,t,r){e.length<40?xe.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}$i.prototype.string=function(t){var r=xe.Buffer.byteLength(t);return this.uint32(r),r&&this._push(o6,r,t),this},$i._configure();var vf=Ot,wf,Pb=xe.LongBits,c6=xe.utf8;function Ai(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Ot(e){this.buf=e,this.pos=0,this.len=e.length}var Nb=typeof Uint8Array!="undefined"?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new Ot(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new Ot(t);throw Error("illegal buffer")},xb=function(){return xe.Buffer?function(r){return(Ot.create=function(n){return xe.Buffer.isBuffer(n)?new wf(n):Nb(n)})(r)}:Nb};Ot.create=xb(),Ot.prototype._slice=xe.Array.prototype.subarray||xe.Array.prototype.slice,Ot.prototype.uint32=function(){var t=4294967295;return function(){if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128)return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Ai(this,10);return t}}(),Ot.prototype.int32=function(){return this.uint32()|0},Ot.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(t&1)|0};function Sf(){var e=new Pb(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw Ai(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw Ai(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}Ot.prototype.bool=function(){return this.uint32()!==0};function Ad(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}Ot.prototype.fixed32=function(){if(this.pos+4>this.len)throw Ai(this,4);return Ad(this.buf,this.pos+=4)},Ot.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Ai(this,4);return Ad(this.buf,this.pos+=4)|0};function Ob(){if(this.pos+8>this.len)throw Ai(this,8);return new Pb(Ad(this.buf,this.pos+=4),Ad(this.buf,this.pos+=4))}Ot.prototype.float=function(){if(this.pos+4>this.len)throw Ai(this,4);var t=xe.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},Ot.prototype.double=function(){if(this.pos+8>this.len)throw Ai(this,4);var t=xe.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},Ot.prototype.bytes=function(){var t=this.uint32(),r=this.pos,i=this.pos+t;if(i>this.len)throw Ai(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(r,i):r===i?new this.buf.constructor(0):this._slice.call(this.buf,r,i)},Ot.prototype.string=function(){var t=this.bytes();return c6.read(t,0,t.length)},Ot.prototype.skip=function(t){if(typeof t=="number"){if(this.pos+t>this.len)throw Ai(this,t);this.pos+=t}else do if(this.pos>=this.len)throw Ai(this);while(this.buf[this.pos++]&128);return this},Ot.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Ot._configure=function(e){wf=e,Ot.create=xb(),wf._configure();var t=xe.Long?"toLong":"toNumber";xe.merge(Ot.prototype,{int64:function(){return Sf.call(this)[t](!1)},uint64:function(){return Sf.call(this)[t](!0)},sint64:function(){return Sf.call(this).zzDecode()[t](!1)},fixed64:function(){return Ob.call(this)[t](!0)},sfixed64:function(){return Ob.call(this)[t](!1)}})};var d6=Ps;(Ps.prototype=Object.create(vf.prototype)).constructor=Ps;function Ps(e){vf.call(this,e)}Ps._configure=function(){xe.Buffer&&(Ps.prototype._slice=xe.Buffer.prototype.slice)},Ps.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},Ps._configure();var l6=Ko;(Ko.prototype=Object.create(xe.EventEmitter.prototype)).constructor=Ko;function Ko(e,t,r){if(typeof e!="function")throw TypeError("rpcImpl must be a function");xe.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}Ko.prototype.rpcCall=function e(t,r,i,n,s){if(!n)throw TypeError("request must be specified");var a=this;if(!s)return xe.asPromise(e,a,t,r,i,n);if(!a.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](n).finish(),function(o,d){if(o)return a.emit("error",o,t),s(o);if(d===null){a.end(!0);return}if(!(d instanceof i))try{d=i[a.responseDelimited?"decodeDelimited":"decode"](d)}catch(l){return a.emit("error",l,t),s(l)}return a.emit("data",d,t),s(null,d)})}catch(c){a.emit("error",c,t),setTimeout(function(){s(c)},0);return}},Ko.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var u6=ne(function(e,t){var r=t;r.Service=l6}),f6={},h6=ne(function(e,t){var r=t;r.build="minimal",r.Writer=ff,r.BufferWriter=a6,r.Reader=vf,r.BufferReader=d6,r.util=xe,r.rpc=u6,r.roots=f6,r.configure=i;function i(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}i()}),p6=h6,m6=ne(function(e){(function(t,r){typeof xf=="function"&&!0&&e&&e.exports&&(e.exports=r(p6))})(se,function(t){var r=t.Reader,i=t.Writer,n=t.util,s=t.roots.default||(t.roots.default={});return s.pb=function(){var a={};return a.NoiseHandshakePayload=function(){function c(o){if(o)for(var d=Object.keys(o),l=0;l<d.length;++l)o[d[l]]!=null&&(this[d[l]]=o[d[l]])}return c.prototype.identityKey=n.newBuffer([]),c.prototype.identitySig=n.newBuffer([]),c.prototype.data=n.newBuffer([]),c.create=function(d){return new c(d)},c.encode=function(d,l){return l||(l=i.create()),d.identityKey!=null&&d.hasOwnProperty("identityKey")&&l.uint32(10).bytes(d.identityKey),d.identitySig!=null&&d.hasOwnProperty("identitySig")&&l.uint32(18).bytes(d.identitySig),d.data!=null&&d.hasOwnProperty("data")&&l.uint32(26).bytes(d.data),l},c.encodeDelimited=function(d,l){return this.encode(d,l).ldelim()},c.decode=function(d,l){d instanceof r||(d=r.create(d));for(var u=l===void 0?d.len:d.pos+l,p=new s.pb.NoiseHandshakePayload;d.pos<u;){var f=d.uint32();switch(f>>>3){case 1:p.identityKey=d.bytes();break;case 2:p.identitySig=d.bytes();break;case 3:p.data=d.bytes();break;default:d.skipType(f&7);break}}return p},c.decodeDelimited=function(d){return d instanceof r||(d=new r(d)),this.decode(d,d.uint32())},c.verify=function(d){return typeof d!="object"||d===null?"object expected":d.identityKey!=null&&d.hasOwnProperty("identityKey")&&!(d.identityKey&&typeof d.identityKey.length=="number"||n.isString(d.identityKey))?"identityKey: buffer expected":d.identitySig!=null&&d.hasOwnProperty("identitySig")&&!(d.identitySig&&typeof d.identitySig.length=="number"||n.isString(d.identitySig))?"identitySig: buffer expected":d.data!=null&&d.hasOwnProperty("data")&&!(d.data&&typeof d.data.length=="number"||n.isString(d.data))?"data: buffer expected":null},c.fromObject=function(d){if(d instanceof s.pb.NoiseHandshakePayload)return d;var l=new s.pb.NoiseHandshakePayload;return d.identityKey!=null&&(typeof d.identityKey=="string"?n.base64.decode(d.identityKey,l.identityKey=n.newBuffer(n.base64.length(d.identityKey)),0):d.identityKey.length&&(l.identityKey=d.identityKey)),d.identitySig!=null&&(typeof d.identitySig=="string"?n.base64.decode(d.identitySig,l.identitySig=n.newBuffer(n.base64.length(d.identitySig)),0):d.identitySig.length&&(l.identitySig=d.identitySig)),d.data!=null&&(typeof d.data=="string"?n.base64.decode(d.data,l.data=n.newBuffer(n.base64.length(d.data)),0):d.data.length&&(l.data=d.data)),l},c.toObject=function(d,l){l||(l={});var u={};return l.defaults&&(l.bytes===String?u.identityKey="":(u.identityKey=[],l.bytes!==Array&&(u.identityKey=n.newBuffer(u.identityKey))),l.bytes===String?u.identitySig="":(u.identitySig=[],l.bytes!==Array&&(u.identitySig=n.newBuffer(u.identitySig))),l.bytes===String?u.data="":(u.data=[],l.bytes!==Array&&(u.data=n.newBuffer(u.data)))),d.identityKey!=null&&d.hasOwnProperty("identityKey")&&(u.identityKey=l.bytes===String?n.base64.encode(d.identityKey,0,d.identityKey.length):l.bytes===Array?Array.prototype.slice.call(d.identityKey):d.identityKey),d.identitySig!=null&&d.hasOwnProperty("identitySig")&&(u.identitySig=l.bytes===String?n.base64.encode(d.identitySig,0,d.identitySig.length):l.bytes===Array?Array.prototype.slice.call(d.identitySig):d.identitySig),d.data!=null&&d.hasOwnProperty("data")&&(u.data=l.bytes===String?n.base64.encode(d.data,0,d.data.length):l.bytes===Array?Array.prototype.slice.call(d.data):d.data),u},c.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},c}(),a}(),s})}),it=ne(function(e,t){var r=se&&se.__importDefault||function(m){return m&&m.__esModule?m:{default:m}};Object.defineProperty(t,"__esModule",{value:!0}),t.isValidPublicKey=t.getHkdf=t.verifySignedPayload=t.getHandshakePayload=t.decodePayload=t.getPeerIdFromPayload=t.signPayload=t.createHandshakePayload=t.getPayload=t.generateKeypair=void 0;const i=r(O8),n=r(df),s=r(_b),a=r(ke),c=r(li),o=m6.pb.NoiseHandshakePayload;function d(){const m=n.default.privateKeyGenerate(),w=n.default.publicKeyCreate(m);return{publicKey:w,privateKey:m}}t.generateKeypair=d;async function l(m,w,R){const h=await p(m,v(w)),b=R||pe.Buffer.alloc(0);return await u(m.marshalPubKey(),h,b)}t.getPayload=l;function u(m,w,R){const h=o.create({identityKey:pe.Buffer.from(m),identitySig:w,data:R||null});return pe.Buffer.from(o.encode(h).finish())}t.createHandshakePayload=u;async function p(m,w){return pe.Buffer.from(await m.privKey.sign(w))}t.signPayload=p;async function f(m){return await a.default.createFromPubKey(pe.Buffer.from(m.identityKey))}t.getPeerIdFromPayload=f;function g(m){return o.toObject(o.decode(pe.Buffer.from(m)))}t.decodePayload=g;function v(m){return pe.Buffer.concat([pe.Buffer.from("noise-libp2p-static-key:"),m])}t.getHandshakePayload=v;async function S(m,w){const R=await a.default.createFromPubKey(w);return c.default(R.id,m)}async function C(m,w,R){const h=pe.Buffer.from(w.identityKey);if(!await S(R.id,h))throw new Error("Peer ID doesn't match libp2p public key.");const b=v(m),A=cs.keys.unmarshalPublicKey(h);if(!w.identitySig||!A.verify(b,pe.Buffer.from(w.identitySig)))throw new Error("Static key doesn't match to peer that signed payload!");return a.default.createFromPubKey(h)}t.verifySignedPayload=C;function D(m,w){const R=pe.Buffer.alloc(0),h=i.default.extract(s.default,w,m),b=i.default.expand(s.default,h,R,96),A=b.slice(0,32),y=b.slice(32,64),P=b.slice(64,96);return[A,y,P]}t.getHkdf=D;function j(m){return n.default.publicKeyVerify(m.slice(0,32))}t.isValidPublicKey=j});const _f=new Int8Array(new Int16Array([1]).buffer)[0]===0;class Ef{constructor(){this.state=new Uint32Array(16),this.stream=new Uint32Array(16),this.bytes=new Uint8Array(this.stream.buffer),this.pos=-1,_f&&(this.bytes=Buffer.alloc(64))}init(e,t,r){if(r==null&&(r=0),fe(Buffer.isBuffer(e)),fe(Buffer.isBuffer(t)),fe(Number.isSafeInteger(r)),e.length!==16&&e.length!==32)throw new RangeError("Invalid key size.");if(t.length>=24&&(e=Ef.derive(e,t.slice(0,16)),t=t.slice(16)),this.state[0]=1634760805,this.state[1]=e.length<32?824206446:857760878,this.state[2]=e.length<32?2036477238:2036477234,this.state[3]=1797285236,this.state[4]=ot(e,0),this.state[5]=ot(e,4),this.state[6]=ot(e,8),this.state[7]=ot(e,12),this.state[8]=ot(e,16%e.length),this.state[9]=ot(e,20%e.length),this.state[10]=ot(e,24%e.length),this.state[11]=ot(e,28%e.length),this.state[12]=r>>>0,t.length===8)this.state[13]=r/4294967296>>>0,this.state[14]=ot(t,0),this.state[15]=ot(t,4);else if(t.length===12)this.state[13]=ot(t,0),this.state[14]=ot(t,4),this.state[15]=ot(t,8);else if(t.length===16)this.state[12]=ot(t,0),this.state[13]=ot(t,4),this.state[14]=ot(t,8),this.state[15]=ot(t,12);else throw new RangeError("Invalid nonce size.");return this.pos=0,this}encrypt(e){if(fe(Buffer.isBuffer(e)),this.pos===-1)throw new Error("Context is not initialized.");for(let t=0;t<e.length;t++)(this.pos&63)===0&&(this._block(),this.pos=0),e[t]^=this.bytes[this.pos++];return e}_block(){for(let e=0;e<16;e++)this.stream[e]=this.state[e];for(let e=0;e<10;e++)gr(this.stream,0,4,8,12),gr(this.stream,1,5,9,13),gr(this.stream,2,6,10,14),gr(this.stream,3,7,11,15),gr(this.stream,0,5,10,15),gr(this.stream,1,6,11,12),gr(this.stream,2,7,8,13),gr(this.stream,3,4,9,14);for(let e=0;e<16;e++)this.stream[e]+=this.state[e];if(_f)for(let e=0;e<16;e++)mn(this.bytes,this.stream[e],e*4);this.state[12]+=1,this.state[12]===0&&(this.state[13]+=1)}destroy(){for(let e=0;e<16;e++)this.state[e]=0,this.stream[e]=0;if(_f)for(let e=0;e<64;e++)this.bytes[e]=0;return this.pos=-1,this}static derive(e,t){if(fe(Buffer.isBuffer(e)),fe(Buffer.isBuffer(t)),e.length!==16&&e.length!==32)throw new RangeError("Invalid key size.");if(t.length!==16)throw new RangeError("Invalid nonce size.");const r=new Uint32Array(16);r[0]=1634760805,r[1]=e.length<32?824206446:857760878,r[2]=e.length<32?2036477238:2036477234,r[3]=1797285236,r[4]=ot(e,0),r[5]=ot(e,4),r[6]=ot(e,8),r[7]=ot(e,12),r[8]=ot(e,16%e.length),r[9]=ot(e,20%e.length),r[10]=ot(e,24%e.length),r[11]=ot(e,28%e.length),r[12]=ot(t,0),r[13]=ot(t,4),r[14]=ot(t,8),r[15]=ot(t,12);for(let n=0;n<10;n++)gr(r,0,4,8,12),gr(r,1,5,9,13),gr(r,2,6,10,14),gr(r,3,7,11,15),gr(r,0,5,10,15),gr(r,1,6,11,12),gr(r,2,7,8,13),gr(r,3,4,9,14);const i=Buffer.alloc(32);return mn(i,r[0],0),mn(i,r[1],4),mn(i,r[2],8),mn(i,r[3],12),mn(i,r[12],16),mn(i,r[13],20),mn(i,r[14],24),mn(i,r[15],28),i}}Ef.native=0;function gr(e,t,r,i,n){e[t]+=e[r],e[n]=Id(e[n]^e[t],16),e[i]+=e[n],e[r]=Id(e[r]^e[i],12),e[t]+=e[r],e[n]=Id(e[n]^e[t],8),e[i]+=e[n],e[r]=Id(e[r]^e[i],7)}function Id(e,t){return e<<t|e>>>32-t}function ot(e,t){return e[t++]+e[t++]*256+e[t++]*65536+e[t]*16777216}function mn(e,t,r){return e[r++]=t,t>>>=8,e[r++]=t,t>>>=8,e[r++]=t,t>>>=8,e[r++]=t,r}var Db=Ef;class Bb{constructor(){this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.buffer=Buffer.alloc(16),this.fin=-1,this.leftover=0}init(e){fe(Buffer.isBuffer(e)&&e.length>=32);const t=nr(e,0),r=nr(e,2),i=nr(e,4),n=nr(e,6),s=nr(e,8),a=nr(e,10),c=nr(e,12),o=nr(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|n<<9)&8191,this.r[4]=(n>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|o<<8)&8191,this.r[9]=o>>>5&127;for(let d=0;d<10;d++)this.h[d]=0;for(let d=0;d<8;d++)this.pad[d]=nr(e,16+2*d);return this.fin=0,this.leftover=0,this}_blocks(e,t,r){const i=this.fin?0:1<<11,n=new Uint32Array(10);for(;t>=16;){const s=nr(e,r+0),a=nr(e,r+2),c=nr(e,r+4),o=nr(e,r+6),d=nr(e,r+8),l=nr(e,r+10),u=nr(e,r+12),p=nr(e,r+14);this.h[0]+=s&8191,this.h[1]+=(s>>>13|a<<3)&8191,this.h[2]+=(a>>>10|c<<6)&8191,this.h[3]+=(c>>>7|o<<9)&8191,this.h[4]+=(o>>>4|d<<12)&8191,this.h[5]+=d>>>1&8191,this.h[6]+=(d>>>14|l<<2)&8191,this.h[7]+=(l>>>11|u<<5)&8191,this.h[8]+=(u>>>8|p<<8)&8191,this.h[9]+=p>>>5|i;let f=0;for(let g=0;g<10;g++){n[g]=f;for(let v=0;v<10;v++){let S=this.h[v];v<=g?S*=this.r[g-v]:S*=5*this.r[g+10-v],n[g]+=S,v===4&&(f=n[g]>>>13,n[g]&=8191)}f+=n[g]>>>13,n[g]&=8191}f=(f<<2)+f,f+=n[0],n[0]=f&8191,f=f>>>13,n[1]+=f;for(let g=0;g<10;g++)this.h[g]=n[g];r+=16,t-=16}}update(e){if(fe(Buffer.isBuffer(e)),this.fin===-1)throw new Error("Context is not initialized.");let t=e.length,r=0;if(this.leftover){let i=16-this.leftover;i>t&&(i=t);for(let n=0;n<i;n++)this.buffer[this.leftover+n]=e[r+n];if(t-=i,r+=i,this.leftover+=i,this.leftover<16)return this;this._blocks(this.buffer,16,0),this.leftover=0}if(t>=16){const i=t&~(16-1);this._blocks(e,i,r),r+=i,t-=i}if(t){for(let i=0;i<t;i++)this.buffer[this.leftover+i]=e[r+i];this.leftover+=t}return this}final(){if(this.fin===-1)throw new Error("Context is not initialized.");const e=Buffer.alloc(16),t=new Uint16Array(10);if(this.leftover){let s=this.leftover;for(this.buffer[s++]=1;s<16;s++)this.buffer[s]=0;this.fin=1,this._blocks(this.buffer,16,0)}let r=this.h[1]>>>13;this.h[1]&=8191;for(let s=2;s<10;s++)this.h[s]+=r,r=this.h[s]>>>13,this.h[s]&=8191;this.h[0]+=r*5,r=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=r,r=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=r,t[0]=this.h[0]+5,r=t[0]>>>13,t[0]&=8191;for(let s=1;s<10;s++)t[s]=this.h[s]+r,r=t[s]>>>13,t[s]&=8191;let i=(r^1)-1;for(let s=0;s<10;s++)t[s]&=i;i=~i;for(let s=0;s<10;s++)this.h[s]=this.h[s]&i|t[s];this.h[0]=(this.h[0]|this.h[1]<<13)&65535,this.h[1]=(this.h[1]>>>3|this.h[2]<<10)&65535,this.h[2]=(this.h[2]>>>6|this.h[3]<<7)&65535,this.h[3]=(this.h[3]>>>9|this.h[4]<<4)&65535,this.h[4]=(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14)&65535,this.h[5]=(this.h[6]>>>2|this.h[7]<<11)&65535,this.h[6]=(this.h[7]>>>5|this.h[8]<<8)&65535,this.h[7]=(this.h[8]>>>8|this.h[9]<<5)&65535;let n=this.h[0]+this.pad[0];this.h[0]=n;for(let s=1;s<8;s++)n=this.h[s]+this.pad[s]+(n>>>16),this.h[s]=n;for(let s=0;s<8;s++)g6(e,this.h[s],s*2);return this.destroy(),e}destroy(){for(let e=0;e<10;e++)this.r[e]=0,this.h[e]=0;for(let e=0;e<8;e++)this.pad[e]=0;for(let e=0;e<16;e++)this.buffer[e]=0;this.fin=-1,this.leftover=0}verify(e){fe(Buffer.isBuffer(e)),fe(e.length===16);const t=this.final();let r=0;for(let i=0;i<16;i++)r|=t[i]^e[i];return r-1>>>31!==0}}Bb.native=0;function nr(e,t){return e[t++]+e[t]*256}function g6(e,t,r){return e[r++]=t,e[r++]=t>>>8,r}var b6=Bb;const y6=Buffer.alloc(16,0);class Wo{constructor(){this.chacha=new Db,this.poly=new b6,this.key=Buffer.alloc(64),this.mode=-1,this.aadLen=0,this.cipherLen=0}init(e,t){return fe(Buffer.isBuffer(e)),fe(Buffer.isBuffer(t)),this.key.fill(0),this.chacha.init(e,t,0),this.chacha.encrypt(this.key),this.poly.init(this.key),this.mode=0,this.aadLen=0,this.cipherLen=0,this}aad(e){if(this.mode===-1)throw new Error("Context is not initialized.");if(this.mode!==0)throw new Error("Invalid state for aad.");return this.poly.update(e),this.aadLen+=e.length,this}encrypt(e){if(this.mode===-1)throw new Error("Context is not initialized.");if(this.mode!==0&&this.mode!==1)throw new Error("Invalid state for encrypt.");return this.mode===0&&(this._pad16(this.aadLen),this.mode=1),this.chacha.encrypt(e),this.poly.update(e),this.cipherLen+=e.length,e}decrypt(e){if(fe(Buffer.isBuffer(e)),this.mode===-1)throw new Error("Context is not initialized.");if(this.mode!==0&&this.mode!==2)throw new Error("Invalid state for decrypt.");return this.mode===0&&(this._pad16(this.aadLen),this.mode=2),this.cipherLen+=e.length,this.poly.update(e),this.chacha.encrypt(e),e}auth(e){if(fe(Buffer.isBuffer(e)),this.mode===-1)throw new Error("Context is not initialized.");if(this.mode!==0&&this.mode!==3)throw new Error("Invalid state for auth.");return this.mode===0&&(this._pad16(this.aadLen),this.mode=3),this.cipherLen+=e.length,this.poly.update(e),e}final(){if(this.mode===-1)throw new Error("Context is not initialized.");const e=Buffer.alloc(16);jb(e,this.aadLen,0),jb(e,this.cipherLen,8),this.mode===0&&this._pad16(this.aadLen),this._pad16(this.cipherLen),this.poly.update(e);const t=this.poly.final();return this.destroy(),t}destroy(){this.chacha.destroy(),this.poly.destroy();for(let e=0;e<64;e++)this.key[e]=0;return this.mode=-1,this.aadLen=0,this.cipherLen=0,this}verify(e){fe(Buffer.isBuffer(e)),fe(e.length===16);const t=this.final();let r=0;for(let i=0;i<16;i++)r|=t[i]^e[i];return r-1>>>31!==0}_pad16(e){const t=e&15;t>0&&this.poly.update(y6.slice(0,16-t))}static encrypt(e,t,r,i){const n=new Wo;return n.init(e,t),i&&n.aad(i),n.encrypt(r),n.final()}static decrypt(e,t,r,i,n){const s=new Wo;return s.init(e,t),n&&s.aad(n),s.decrypt(r),s.verify(i)}static auth(e,t,r,i,n){const s=new Wo;return s.init(e,t),n&&s.aad(n),s.auth(r),s.verify(i)}}Wo.native=Db.native;function Lb(e,t,r){return e[r++]=t,t>>>=8,e[r++]=t,t>>>=8,e[r++]=t,t>>>=8,e[r++]=t,r}function jb(e,t,r){const i=t*(1/4294967296)>>>0,n=t>>>0;return Lb(e,n,r+0),Lb(e,i,r+4),r+8}var v6=Wo,Ns=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DUMP_SESSION_KEYS=t.NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG=t.NOISE_MSG_MAX_LENGTH_BYTES=void 0,t.NOISE_MSG_MAX_LENGTH_BYTES=65535,t.NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG=t.NOISE_MSG_MAX_LENGTH_BYTES-16,t.DUMP_SESSION_KEYS=Ce.env.DUMP_SESSION_KEYS}),Se=ne(function(e,t){var r=se&&se.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(t,"__esModule",{value:!0}),t.logCipherState=t.logRemoteEphemeralKey=t.logRemoteStaticKey=t.logLocalEphemeralKeys=t.logLocalStaticKeys=t.logger=void 0;const i=r(le);t.logger=i.default("libp2p:noise");let n;Ns.DUMP_SESSION_KEYS?n=t.logger:n=()=>{};function s(l){n(`LOCAL_STATIC_PUBLIC_KEY ${l.publicKey.toString("hex")}`),n(`LOCAL_STATIC_PRIVATE_KEY ${l.privateKey.toString("hex")}`)}t.logLocalStaticKeys=s;function a(l){l?(n(`LOCAL_PUBLIC_EPHEMERAL_KEY ${l.publicKey.toString("hex")}`),n(`LOCAL_PRIVATE_EPHEMERAL_KEY ${l.privateKey.toString("hex")}`)):n("Missing local ephemeral keys.")}t.logLocalEphemeralKeys=a;function c(l){n(`REMOTE_STATIC_PUBLIC_KEY ${l.toString("hex")}`)}t.logRemoteStaticKey=c;function o(l){n(`REMOTE_EPHEMERAL_PUBLIC_KEY ${l.toString("hex")}`)}t.logRemoteEphemeralKey=o;function d(l){l.cs1&&l.cs2?(n(`CIPHER_STATE_1 ${l.cs1.n} ${l.cs1.k.toString("hex")}`),n(`CIPHER_STATE_2 ${l.cs2.n} ${l.cs2.k.toString("hex")}`)):n("Missing cipher state.")}t.logCipherState=d}),Fb=ne(function(e,t){var r=se&&se.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractHandshake=t.MIN_NONCE=void 0;const i=r(v6),n=r(df),s=r(_b);t.MIN_NONCE=0;class a{encryptWithAd(c,o,d){const l=this.encrypt(c.k,c.n,o,d);return this.setNonce(c,this.incrementNonce(c.n)),l}decryptWithAd(c,o,d){const{plaintext:l,valid:u}=this.decrypt(c.k,c.n,o,d);return this.setNonce(c,this.incrementNonce(c.n)),{plaintext:l,valid:u}}hasKey(c){return!this.isEmptyKey(c.k)}setNonce(c,o){c.n=o}createEmptyKey(){return pe.Buffer.alloc(32)}isEmptyKey(c){const o=this.createEmptyKey();return o.equals(c)}incrementNonce(c){return c+1}nonceToBytes(c){const o=pe.Buffer.alloc(12);return o.writeUInt32LE(c,4),o}encrypt(c,o,d,l){const u=this.nonceToBytes(o),p=new i.default;return l=pe.Buffer.from(l),p.init(c,u),p.aad(d),p.encrypt(l),pe.Buffer.concat([l,p.final()])}encryptAndHash(c,o){let d;return this.hasKey(c.cs)?d=this.encryptWithAd(c.cs,c.h,o):d=o,this.mixHash(c,d),d}decrypt(c,o,d,l){const u=this.nonceToBytes(o),p=new i.default;l=pe.Buffer.from(l);const f=l.slice(l.length-16);return l=l.slice(0,l.length-16),p.init(c,u),p.aad(d),p.decrypt(l),{plaintext:l,valid:p.verify(f)}}decryptAndHash(c,o){let d,l=!0;return this.hasKey(c.cs)?{plaintext:d,valid:l}=this.decryptWithAd(c.cs,c.h,o):d=o,this.mixHash(c,o),{plaintext:d,valid:l}}dh(c,o){try{const d=n.default.derive(o,c),l=pe.Buffer.alloc(32);return d.copy(l),l}catch(d){return Se.logger(d.message),pe.Buffer.alloc(32)}}mixHash(c,o){c.h=this.getHash(c.h,o)}getHash(c,o){return s.default.digest(pe.Buffer.from([...c,...o]))}mixKey(c,o){const[d,l]=it.getHkdf(c.ck,o);c.cs=this.initializeKey(l),c.ck=d}initializeKey(c){const o=t.MIN_NONCE;return{k:c,n:o}}initializeSymmetric(c){const o=pe.Buffer.from(c,"utf-8"),d=this.hashProtocolName(o),l=d,u=this.createEmptyKey(),p=this.initializeKey(u);return{cs:p,ck:l,h:d}}hashProtocolName(c){if(c.length<=32){const o=pe.Buffer.alloc(32);return c.copy(o),o}else return this.getHash(c,pe.Buffer.alloc(0))}split(c){const[o,d]=it.getHkdf(c.ck,pe.Buffer.alloc(0)),l=this.initializeKey(o),u=this.initializeKey(d);return{cs1:l,cs2:u}}writeMessageRegular(c,o){const d=this.encryptWithAd(c,pe.Buffer.alloc(0),o),l=this.createEmptyKey(),u=pe.Buffer.alloc(0);return{ne:l,ns:u,ciphertext:d}}readMessageRegular(c,o){return this.decryptWithAd(c,pe.Buffer.alloc(0),o.ciphertext)}}t.AbstractHandshake=a}),w6=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.XX=void 0;class r extends Fb.AbstractHandshake{initializeInitiator(i,n,s,a){const c="Noise_XX_25519_ChaChaPoly_SHA256",o=this.initializeSymmetric(c);this.mixHash(o,i);const d=pe.Buffer.alloc(32);return{ss:o,s:n,rs:s,psk:a,re:d}}initializeResponder(i,n,s,a){const c="Noise_XX_25519_ChaChaPoly_SHA256",o=this.initializeSymmetric(c);this.mixHash(o,i);const d=pe.Buffer.alloc(32);return{ss:o,s:n,rs:s,psk:a,re:d}}writeMessageA(i,n,s){const a=pe.Buffer.alloc(0);s?i.e=s:i.e=it.generateKeypair();const c=i.e.publicKey;this.mixHash(i.ss,c);const o=this.encryptAndHash(i.ss,n);return{ne:c,ns:a,ciphertext:o}}writeMessageB(i,n){i.e=it.generateKeypair();const s=i.e.publicKey;this.mixHash(i.ss,s),this.mixKey(i.ss,this.dh(i.e.privateKey,i.re));const a=pe.Buffer.from(i.s.publicKey),c=this.encryptAndHash(i.ss,a);this.mixKey(i.ss,this.dh(i.s.privateKey,i.re));const o=this.encryptAndHash(i.ss,n);return{ne:s,ns:c,ciphertext:o}}writeMessageC(i,n){const s=pe.Buffer.from(i.s.publicKey),a=this.encryptAndHash(i.ss,s);this.mixKey(i.ss,this.dh(i.s.privateKey,i.re));const c=this.encryptAndHash(i.ss,n),o=this.createEmptyKey(),d={ne:o,ns:a,ciphertext:c},{cs1:l,cs2:u}=this.split(i.ss);return{h:i.ss.h,messageBuffer:d,cs1:l,cs2:u}}readMessageA(i,n){return it.isValidPublicKey(n.ne)&&(i.re=n.ne),this.mixHash(i.ss,i.re),this.decryptAndHash(i.ss,n.ciphertext)}readMessageB(i,n){if(it.isValidPublicKey(n.ne)&&(i.re=n.ne),this.mixHash(i.ss,i.re),!i.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(i.ss,this.dh(i.e.privateKey,i.re));const{plaintext:s,valid:a}=this.decryptAndHash(i.ss,n.ns);a&&s.length===32&&it.isValidPublicKey(s)&&(i.rs=s),this.mixKey(i.ss,this.dh(i.e.privateKey,i.rs));const{plaintext:c,valid:o}=this.decryptAndHash(i.ss,n.ciphertext);return{plaintext:c,valid:a&&o}}readMessageC(i,n){const{plaintext:s,valid:a}=this.decryptAndHash(i.ss,n.ns);if(a&&s.length===32&&it.isValidPublicKey(s)&&(i.rs=s),!i.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(i.ss,this.dh(i.e.privateKey,i.rs));const{plaintext:c,valid:o}=this.decryptAndHash(i.ss,n.ciphertext),{cs1:d,cs2:l}=this.split(i.ss);return{h:i.ss.h,plaintext:c,valid:a&&o,cs1:d,cs2:l}}initSession(i,n,s){const a=this.createEmptyKey(),c=pe.Buffer.alloc(32);let o;return i?o=this.initializeInitiator(n,s,c,a):o=this.initializeResponder(n,s,c,a),{hs:o,i,mc:0}}sendMessage(i,n,s){let a;if(i.mc===0)a=this.writeMessageA(i.hs,n,s);else if(i.mc===1)a=this.writeMessageB(i.hs,n);else if(i.mc===2){const{h:c,messageBuffer:o,cs1:d,cs2:l}=this.writeMessageC(i.hs,n);a=o,i.h=c,i.cs1=d,i.cs2=l}else if(i.mc>2)if(i.i){if(!i.cs1)throw new Error("CS1 (cipher state) is not defined");a=this.writeMessageRegular(i.cs1,n)}else{if(!i.cs2)throw new Error("CS2 (cipher state) is not defined");a=this.writeMessageRegular(i.cs2,n)}else throw new Error("Session invalid.");return i.mc++,a}recvMessage(i,n){let s=pe.Buffer.alloc(0),a=!1;if(i.mc===0)({plaintext:s,valid:a}=this.readMessageA(i.hs,n));else if(i.mc===1)({plaintext:s,valid:a}=this.readMessageB(i.hs,n));else if(i.mc===2){const{h:c,plaintext:o,valid:d,cs1:l,cs2:u}=this.readMessageC(i.hs,n);s=o,a=d,i.h=c,i.cs1=l,i.cs2=u}return i.mc++,{plaintext:s,valid:a}}}t.XX=r}),Jt=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.decode2=t.decode1=t.decode0=t.encode2=t.encode1=t.encode0=t.uint16BEDecode=t.uint16BEEncode=void 0,t.uint16BEEncode=(o,d,l)=>(d=d||pe.Buffer.allocUnsafe(2),d.writeUInt16BE(o,l),d),t.uint16BEEncode.bytes=2,t.uint16BEDecode=o=>{if(o.length<2)throw RangeError("Could not decode int16BE");return o.readUInt16BE(0)},t.uint16BEDecode.bytes=2;function r(o){return pe.Buffer.concat([o.ne,o.ciphertext])}t.encode0=r;function i(o){return pe.Buffer.concat([o.ne,o.ns,o.ciphertext])}t.encode1=i;function n(o){return pe.Buffer.concat([o.ns,o.ciphertext])}t.encode2=n;function s(o){if(o.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:o.slice(0,32),ciphertext:o.slice(32,o.length),ns:pe.Buffer.alloc(0)}}t.decode0=s;function a(o){if(o.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:o.slice(0,32),ns:o.slice(32,80),ciphertext:o.slice(80,o.length)}}t.decode1=a;function c(o){if(o.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:pe.Buffer.alloc(0),ns:o.slice(0,48),ciphertext:o.slice(48,o.length)}}t.decode2=c}),Ub=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.XXHandshake=void 0;class r{constructor(i,n,s,a,c,o,d){this.isInitiator=i,this.payload=n,this.prologue=s,this.staticKeypair=a,this.connection=c,o&&(this.remotePeer=o),this.xx=d||new w6.XX,this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair),this.remoteEarlyData=pe.Buffer.alloc(0)}async propose(){if(Se.logLocalStaticKeys(this.session.hs.s),this.isInitiator){Se.logger("Stage 0 - Initiator starting to send first message.");const i=this.xx.sendMessage(this.session,pe.Buffer.alloc(0));this.connection.writeLP(Jt.encode0(i)),Se.logger("Stage 0 - Initiator finished sending first message."),Se.logLocalEphemeralKeys(this.session.hs.e)}else{Se.logger("Stage 0 - Responder waiting to receive first message...");const i=Jt.decode0((await this.connection.readLP()).slice()),{valid:n}=this.xx.recvMessage(this.session,i);if(!n)throw new Error("xx handshake stage 0 validation fail");Se.logger("Stage 0 - Responder received first message."),Se.logRemoteEphemeralKey(this.session.hs.re)}}async exchange(){if(this.isInitiator){Se.logger("Stage 1 - Initiator waiting to receive first message from responder...");const i=Jt.decode1((await this.connection.readLP()).slice()),{plaintext:n,valid:s}=this.xx.recvMessage(this.session,i);if(!s)throw new Error("xx handshake stage 1 validation fail");Se.logger("Stage 1 - Initiator received the message."),Se.logRemoteEphemeralKey(this.session.hs.re),Se.logRemoteStaticKey(this.session.hs.rs),Se.logger("Initiator going to check remote's signature...");try{const a=await it.decodePayload(n);this.remotePeer=this.remotePeer||await it.getPeerIdFromPayload(a),this.remotePeer=await it.verifySignedPayload(i.ns,a,this.remotePeer),this.setRemoteEarlyData(a.data)}catch(a){throw new Error(`Error occurred while verifying signed payload: ${a.message}`)}Se.logger("All good with the signature!")}else{Se.logger("Stage 1 - Responder sending out first message with signed payload and static key.");const i=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(Jt.encode1(i)),Se.logger("Stage 1 - Responder sent the second handshake message with signed payload."),Se.logLocalEphemeralKeys(this.session.hs.e)}}async finish(){if(this.isInitiator){Se.logger("Stage 2 - Initiator sending third handshake message.");const i=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(Jt.encode2(i)),Se.logger("Stage 2 - Initiator sent message with signed payload.")}else{Se.logger("Stage 2 - Responder waiting for third handshake message...");const i=Jt.decode2((await this.connection.readLP()).slice()),{plaintext:n,valid:s}=this.xx.recvMessage(this.session,i);if(!s)throw new Error("xx handshake stage 2 validation fail");Se.logger("Stage 2 - Responder received the message, finished handshake.");try{const a=await it.decodePayload(n);this.remotePeer=this.remotePeer||await it.getPeerIdFromPayload(a),await it.verifySignedPayload(this.session.hs.rs,a,this.remotePeer),this.setRemoteEarlyData(a.data)}catch(a){throw new Error(`Error occurred while verifying signed payload: ${a.message}`)}}Se.logCipherState(this.session)}encrypt(i,n){const s=this.getCS(n);return this.xx.encryptWithAd(s,pe.Buffer.alloc(0),i)}decrypt(i,n){const s=this.getCS(n,!1);return this.xx.decryptWithAd(s,pe.Buffer.alloc(0),i)}getRemoteStaticKey(){return this.session.hs.rs}getCS(i,n=!0){if(!i.cs1||!i.cs2)throw new Error("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?n?i.cs1:i.cs2:n?i.cs2:i.cs1}setRemoteEarlyData(i){i&&(this.remoteEarlyData=pe.Buffer.from(i.buffer,i.byteOffset,i.length))}}t.XXHandshake=r}),S6=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.IK=void 0;class r extends Fb.AbstractHandshake{initSession(i,n,s,a){const c=this.createEmptyKey();let o;return i?o=this.initializeInitiator(n,s,a,c):o=this.initializeResponder(n,s,a,c),{hs:o,i,mc:0}}sendMessage(i,n){let s;if(i.mc===0)s=this.writeMessageA(i.hs,n);else if(i.mc===1){const{messageBuffer:a,h:c,cs1:o,cs2:d}=this.writeMessageB(i.hs,n);s=a,i.h=c,i.cs1=o,i.cs2=d}else if(i.mc>1)if(i.i){if(!i.cs1)throw new Error("CS1 (cipher state) is not defined");s=this.writeMessageRegular(i.cs1,n)}else{if(!i.cs2)throw new Error("CS2 (cipher state) is not defined");s=this.writeMessageRegular(i.cs2,n)}else throw new Error("Session invalid.");return i.mc++,s}recvMessage(i,n){let s=pe.Buffer.alloc(0),a=!1;if(i.mc===0&&({plaintext:s,valid:a}=this.readMessageA(i.hs,n)),i.mc===1){const{plaintext:c,valid:o,h:d,cs1:l,cs2:u}=this.readMessageB(i.hs,n);s=c,a=o,i.h=d,i.cs1=l,i.cs2=u}return i.mc++,{plaintext:s,valid:a}}writeMessageA(i,n){i.e=it.generateKeypair();const s=i.e.publicKey;this.mixHash(i.ss,s),this.mixKey(i.ss,this.dh(i.e.privateKey,i.rs));const a=pe.Buffer.from(i.s.publicKey),c=this.encryptAndHash(i.ss,a);this.mixKey(i.ss,this.dh(i.s.privateKey,i.rs));const o=this.encryptAndHash(i.ss,n);return{ne:s,ns:c,ciphertext:o}}writeMessageB(i,n){i.e=it.generateKeypair();const s=i.e.publicKey;this.mixHash(i.ss,s),this.mixKey(i.ss,this.dh(i.e.privateKey,i.re)),this.mixKey(i.ss,this.dh(i.e.privateKey,i.rs));const a=this.encryptAndHash(i.ss,n),c=this.createEmptyKey(),o={ne:s,ns:c,ciphertext:a},{cs1:d,cs2:l}=this.split(i.ss);return{messageBuffer:o,cs1:d,cs2:l,h:i.ss.h}}readMessageA(i,n){it.isValidPublicKey(n.ne)&&(i.re=n.ne),this.mixHash(i.ss,i.re),this.mixKey(i.ss,this.dh(i.s.privateKey,i.re));const{plaintext:s,valid:a}=this.decryptAndHash(i.ss,n.ns);a&&s.length===32&&it.isValidPublicKey(s)&&(i.rs=s),this.mixKey(i.ss,this.dh(i.s.privateKey,i.rs));const{plaintext:c,valid:o}=this.decryptAndHash(i.ss,n.ciphertext);return{plaintext:c,valid:a&&o}}readMessageB(i,n){if(it.isValidPublicKey(n.ne)&&(i.re=n.ne),this.mixHash(i.ss,i.re),!i.e)throw new Error("Handshake state should contain ephemeral key by now.");this.mixKey(i.ss,this.dh(i.e.privateKey,i.re)),this.mixKey(i.ss,this.dh(i.s.privateKey,i.re));const{plaintext:s,valid:a}=this.decryptAndHash(i.ss,n.ciphertext),{cs1:c,cs2:o}=this.split(i.ss);return{h:i.ss.h,valid:a,plaintext:s,cs1:c,cs2:o}}initializeInitiator(i,n,s,a){const c="Noise_IK_25519_ChaChaPoly_SHA256",o=this.initializeSymmetric(c);this.mixHash(o,i),this.mixHash(o,s);const d=pe.Buffer.alloc(32);return{ss:o,s:n,rs:s,re:d,psk:a}}initializeResponder(i,n,s,a){const c="Noise_IK_25519_ChaChaPoly_SHA256",o=this.initializeSymmetric(c);this.mixHash(o,i),this.mixHash(o,n.publicKey);const d=pe.Buffer.alloc(32);return{ss:o,s:n,rs:s,re:d,psk:a}}}t.IK=r}),qb=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.FailedIKError=void 0;class r extends Error{constructor(i,n){super(n);this.initialMsg=i,this.name="FailedIKhandshake"}}t.FailedIKError=r}),_6=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.IKHandshake=void 0;class r{constructor(i,n,s,a,c,o,d,l){this.isInitiator=i,this.payload=pe.Buffer.from(n),this.prologue=s,this.staticKeypair=a,this.connection=c,d&&(this.remotePeer=d),this.ik=l||new S6.IK,this.session=this.ik.initSession(this.isInitiator,this.prologue,this.staticKeypair,o),this.remoteEarlyData=pe.Buffer.alloc(0)}async stage0(){if(Se.logLocalStaticKeys(this.session.hs.s),Se.logRemoteStaticKey(this.session.hs.rs),this.isInitiator){Se.logger("IK Stage 0 - Initiator sending message...");const i=this.ik.sendMessage(this.session,this.payload);this.connection.writeLP(Jt.encode1(i)),Se.logger("IK Stage 0 - Initiator sent message."),Se.logLocalEphemeralKeys(this.session.hs.e)}else{Se.logger("IK Stage 0 - Responder receiving message...");const i=await this.connection.readLP();try{const n=Jt.decode1(i.slice()),{plaintext:s,valid:a}=this.ik.recvMessage(this.session,n);if(!a)throw new Error("ik handshake stage 0 decryption validation fail");Se.logger("IK Stage 0 - Responder got message, going to verify payload.");const c=await it.decodePayload(s);this.remotePeer=this.remotePeer||await it.getPeerIdFromPayload(c),await it.verifySignedPayload(this.session.hs.rs,c,this.remotePeer),this.setRemoteEarlyData(c.data),Se.logger("IK Stage 0 - Responder successfully verified payload!"),Se.logRemoteEphemeralKey(this.session.hs.re)}catch(n){throw Se.logger("Responder breaking up with IK handshake in stage 0."),new qb.FailedIKError(i,`Error occurred while verifying initiator's signed payload: ${n.message}`)}}}async stage1(){if(this.isInitiator){Se.logger("IK Stage 1 - Initiator receiving message...");const i=(await this.connection.readLP()).slice(),n=Jt.decode0(pe.Buffer.from(i)),{plaintext:s,valid:a}=this.ik.recvMessage(this.session,n);Se.logger("IK Stage 1 - Initiator got message, going to verify payload.");try{if(!a)throw new Error("ik stage 1 decryption validation fail");const c=await it.decodePayload(s);this.remotePeer=this.remotePeer||await it.getPeerIdFromPayload(c),await it.verifySignedPayload(n.ns.slice(0,32),c,this.remotePeer),this.setRemoteEarlyData(c.data),Se.logger("IK Stage 1 - Initiator successfully verified payload!"),Se.logRemoteEphemeralKey(this.session.hs.re)}catch(c){throw Se.logger("Initiator breaking up with IK handshake in stage 1."),new qb.FailedIKError(i,`Error occurred while verifying responder's signed payload: ${c.message}`)}}else{Se.logger("IK Stage 1 - Responder sending message...");const i=this.ik.sendMessage(this.session,this.payload);this.connection.writeLP(Jt.encode0(i)),Se.logger("IK Stage 1 - Responder sent message..."),Se.logLocalEphemeralKeys(this.session.hs.e)}Se.logCipherState(this.session)}decrypt(i,n){const s=this.getCS(n,!1);return this.ik.decryptWithAd(s,pe.Buffer.alloc(0),i)}encrypt(i,n){const s=this.getCS(n);return this.ik.encryptWithAd(s,pe.Buffer.alloc(0),i)}getLocalEphemeralKeys(){if(!this.session.hs.e)throw new Error("Ephemeral keys do not exist.");return this.session.hs.e}getCS(i,n=!0){if(!i.cs1||!i.cs2)throw new Error("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?n?i.cs1:i.cs2:n?i.cs2:i.cs1}setRemoteEarlyData(i){i&&(this.remoteEarlyData=pe.Buffer.from(i.buffer,i.byteOffset,i.length))}}t.IKHandshake=r}),E6=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.XXFallbackHandshake=void 0;class r extends Ub.XXHandshake{constructor(i,n,s,a,c,o,d,l,u){super(i,n,s,a,c,d,u);l&&(this.ephemeralKeys=l),this.initialMsg=o}async propose(){if(this.isInitiator)this.xx.sendMessage(this.session,pe.Buffer.alloc(0),this.ephemeralKeys),Se.logger("XX Fallback Stage 0 - Initialized state as the first message was sent by initiator."),Se.logLocalEphemeralKeys(this.session.hs.e);else{Se.logger("XX Fallback Stage 0 - Responder decoding initial msg from IK.");const i=Jt.decode0(this.initialMsg),{valid:n}=this.xx.recvMessage(this.session,{ne:i.ne,ns:pe.Buffer.alloc(0),ciphertext:pe.Buffer.alloc(0)});if(!n)throw new Error("xx fallback stage 0 decryption validation fail");Se.logger("XX Fallback Stage 0 - Responder used received message from IK."),Se.logRemoteEphemeralKey(this.session.hs.re)}}async exchange(){if(this.isInitiator){const i=Jt.decode1(this.initialMsg),{plaintext:n,valid:s}=this.xx.recvMessage(this.session,i);if(!s)throw new Error("xx fallback stage 1 decryption validation fail");Se.logger("XX Fallback Stage 1 - Initiator used received message from IK."),Se.logRemoteEphemeralKey(this.session.hs.re),Se.logRemoteStaticKey(this.session.hs.rs),Se.logger("Initiator going to check remote's signature...");try{const a=await it.decodePayload(n);this.remotePeer=this.remotePeer||await it.getPeerIdFromPayload(a),await it.verifySignedPayload(this.session.hs.rs,a,this.remotePeer),this.setRemoteEarlyData(a.data)}catch(a){throw new Error(`Error occurred while verifying signed payload from responder: ${a.message}`)}Se.logger("All good with the signature!")}else Se.logger("XX Fallback Stage 1 - Responder start"),await super.exchange(),Se.logger("XX Fallback Stage 1 - Responder end")}}t.XXFallbackHandshake=r}),zb=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.decryptStream=t.encryptStream=void 0;function r(n){return async function*(s){for await(const a of s){const c=pe.Buffer.from(a.buffer,a.byteOffset,a.length);for(let o=0;o<c.length;o+=Ns.NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG){let d=o+Ns.NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG;d>c.length&&(d=c.length);const l=n.encrypt(c.slice(o,d),n.session);yield l}}}}t.encryptStream=r;function i(n){return async function*(s){for await(const a of s){const c=pe.Buffer.from(a.buffer,a.byteOffset,a.length);for(let o=0;o<c.length;o+=Ns.NOISE_MSG_MAX_LENGTH_BYTES){let d=o+Ns.NOISE_MSG_MAX_LENGTH_BYTES;d>c.length&&(d=c.length);const l=c.slice(o,d),{plaintext:u,valid:p}=await n.decrypt(l,n.session);if(!p)throw new Error("Failed to validate decrypted chunk");yield u}}}}t.decryptStream=i}),Af=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.KeyCache=void 0;class r{constructor(){this.storage=new Map}store(n,s){this.storage.set(n.id,s)}load(n){return n&&this.storage.get(n.id)||null}resetStorage(){this.storage.clear()}}const i=new r;t.KeyCache=i}),$b=ne(function(e,t){var r=se&&se.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(t,"__esModule",{value:!0}),t.Noise=void 0;const i=r(df),n=r(T8),s=r(C8),a=r(Tc),c=r(Yr);class o{constructor(d,l){if(this.protocol="/noise",this.prologue=pe.Buffer.alloc(0),this.earlyData=l||pe.Buffer.alloc(0),this.useNoisePipes=!1,d){const u=i.default.publicKeyCreate(d);this.staticKeys={privateKey:d,publicKey:u}}else this.staticKeys=it.generateKeypair()}async secureOutbound(d,l,u){const p=n.default(l,{lengthEncoder:Jt.uint16BEEncode,lengthDecoder:Jt.uint16BEDecode,maxDataLength:Ns.NOISE_MSG_MAX_LENGTH_BYTES}),f=await this.performHandshake({connection:p,isInitiator:!0,localPeer:d,remotePeer:u}),g=await this.createSecureConnection(p,f);return{conn:g,remoteEarlyData:f.remoteEarlyData,remotePeer:f.remotePeer}}async secureInbound(d,l,u){const p=n.default(l,{lengthEncoder:Jt.uint16BEEncode,lengthDecoder:Jt.uint16BEDecode,maxDataLength:Ns.NOISE_MSG_MAX_LENGTH_BYTES}),f=await this.performHandshake({connection:p,isInitiator:!1,localPeer:d,remotePeer:u}),g=await this.createSecureConnection(p,f);return{conn:g,remoteEarlyData:f.remoteEarlyData,remotePeer:f.remotePeer}}async performHandshake(d){const l=await it.getPayload(d.localPeer,this.staticKeys.publicKey,this.earlyData);let u=this.useNoisePipes;if(d.isInitiator&&Af.KeyCache.load(d.remotePeer)===null&&(u=!1),u){const{remotePeer:p,connection:f,isInitiator:g}=d,v=new _6.IKHandshake(g,l,this.prologue,this.staticKeys,f,Af.KeyCache.load(d.remotePeer)||pe.Buffer.alloc(32),p);try{return await this.performIKHandshake(v)}catch(S){let C;return d.isInitiator&&(C=v.getLocalEphemeralKeys()),await this.performXXFallbackHandshake(d,l,S.initialMsg,C)}}else return await this.performXXHandshake(d,l)}async performXXFallbackHandshake(d,l,u,p){const{isInitiator:f,remotePeer:g,connection:v}=d,S=new E6.XXFallbackHandshake(f,l,this.prologue,this.staticKeys,v,u,g,p);try{await S.propose(),await S.exchange(),await S.finish()}catch(C){throw Se.logger(C),new Error(`Error occurred during XX Fallback handshake: ${C.message}`)}return S}async performXXHandshake(d,l){const{isInitiator:u,remotePeer:p,connection:f}=d,g=new Ub.XXHandshake(u,l,this.prologue,this.staticKeys,f,p);try{await g.propose(),await g.exchange(),await g.finish(),this.useNoisePipes&&g.remotePeer&&Af.KeyCache.store(g.remotePeer,g.getRemoteStaticKey())}catch(v){throw new Error(`Error occurred during XX handshake: ${v.message}`)}return g}async performIKHandshake(d){return await d.stage0(),await d.stage1(),d}async createSecureConnection(d,l){const[u,p]=s.default(),f=d.unwrap();return await c.default(u,a.default,zb.encryptStream(l),lr.encode({lengthEncoder:Jt.uint16BEEncode}),f,lr.decode({lengthDecoder:Jt.uint16BEDecode}),a.default,zb.decryptStream(l),u),p}}t.Noise=o}),A6=ne(function(e,t){var r=se&&se.__createBinding||(Object.create?function(n,s,a,c){c===void 0&&(c=a),Object.defineProperty(n,c,{enumerable:!0,get:function(){return s[a]}})}:function(n,s,a,c){c===void 0&&(c=a),n[c]=s[a]}),i=se&&se.__exportStar||function(n,s){for(var a in n)a!=="default"&&!s.hasOwnProperty(a)&&r(s,n,a)};Object.defineProperty(t,"__esModule",{value:!0}),t.NOISE=void 0,i($b,t),t.NOISE=new $b.Noise});const Hb=()=>{};class I6{constructor({min:e=0,max:t=Infinity,handlers:r={}}){this.min=e,this.max=t,this._onConnect=r.onConnect||Hb,this._onDisconnect=r.onDisconnect||Hb,this.peers=new Set}set registrar(e){this._registrar=e}disconnect(e){this._onDisconnect(e)}}var T6=rn(I6,{className:"Topology",symbolName:"@libp2p/js-interfaces/topology"});class C6 extends T6{constructor({min:e,max:t,multicodecs:r,handlers:i}){super({min:e,max:t,handlers:i});if(!r)throw new Error("one or more multicodec should be provided");if(!i)throw new Error("the handlers should be provided");if(typeof i.onConnect!="function")throw new Error("the 'onConnect' handler must be provided");if(typeof i.onDisconnect!="function")throw new Error("the 'onDisconnect' handler must be provided");this.multicodecs=Array.isArray(r)?r:[r],this._registrar=void 0,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerConnect=this._onPeerConnect.bind(this)}set registrar(e){this._registrar=e,this._registrar.peerStore.on("change:protocols",this._onProtocolChange),this._registrar.connectionManager.on("peer:connect",this._onPeerConnect),this._updatePeers(this._registrar.peerStore.peers.values())}_updatePeers(e){for(const{id:t,protocols:r}of e)if(this.multicodecs.filter(i=>r.includes(i)).length){this.peers.add(t.toB58String());const i=this._registrar.getConnection(t);i&&this._onConnect(t,i)}else this.peers.delete(t.toB58String())}_onProtocolChange({peerId:e,protocols:t}){const r=this.peers.has(e.toB58String()),i=t.filter(n=>this.multicodecs.includes(n));r&&i.length===0&&this._onDisconnect(e);for(const n of t)if(this.multicodecs.includes(n)){const s=this._registrar.peerStore.get(e);this._updatePeers([s]);return}}_onPeerConnect(e){const t=e.remotePeer,r=this._registrar.peerStore.protoBook.get(t);if(!r)return;this.multicodecs.find(i=>r.includes(i))&&(this.peers.add(t.toB58String()),this._onConnect(t,e))}}var R6=rn(C6,{className:"MulticodecTopology",symbolName:"@libp2p/js-interfaces/topology/multicodec-topology"}),M6={ERR_INVALID_SIGNATURE_POLICY:"ERR_INVALID_SIGNATURE_POLICY",ERR_UNHANDLED_SIGNATURE_POLICY:"ERR_UNHANDLED_SIGNATURE_POLICY",ERR_MISSING_SIGNATURE:"ERR_MISSING_SIGNATURE",ERR_MISSING_SEQNO:"ERR_MISSING_SEQNO",ERR_INVALID_SIGNATURE:"ERR_INVALID_SIGNATURE",ERR_UNEXPECTED_FROM:"ERR_UNEXPECTED_FROM",ERR_UNEXPECTED_SIGNATURE:"ERR_UNEXPECTED_SIGNATURE",ERR_UNEXPECTED_KEY:"ERR_UNEXPECTED_KEY",ERR_UNEXPECTED_SEQNO:"ERR_UNEXPECTED_SEQNO"},If={codes:M6},k6=`
message RPC {
  repeated SubOpts subscriptions = 1;
  repeated Message msgs = 2;

  message SubOpts {
    optional bool subscribe = 1; // subscribe or unsubcribe
    optional string topicID = 2;
  }

  message Message {
    optional bytes from = 1;
    optional bytes data = 2;
    optional bytes seqno = 3;
    repeated string topicIDs = 4;
    optional bytes signature = 5;
    optional bytes key = 6;
  }
}`,P6=`
// topicCID = cid(merkledag_protobuf(topicDescriptor)); (not the topic.name)
message TopicDescriptor {
  optional string name = 1;
  optional AuthOpts auth = 2;
  optional EncOpts enc = 2;

  message AuthOpts {
    optional AuthMode mode = 1;
    repeated bytes keys = 2; // root keys to trust

    enum AuthMode {
      NONE = 0; // no authentication, anyone can publish
      KEY = 1; // only messages signed by keys in the topic descriptor are accepted
      WOT = 2; // web of trust, certificates can allow publisher set to grow
    }
  }

  message EncOpts {
    optional EncMode mode = 1;
    repeated bytes keyHashes = 2; // the hashes of the shared keys used (salted)

    enum EncMode {
      NONE = 0; // no encryption, anyone can read
      SHAREDKEY = 1; // messages are encrypted with shared key
      WOT = 2; // web of trust, certificates can allow publisher set to grow
    }
  }
}`,Td=ne(function(e,t){const r=tn(k6),i=r.RPC,n=tn(P6);t=e.exports,t.rpc=r,t.td=n,t.RPC=i,t.Message=i.Message,t.SubOpts=i.SubOpts});const Vb=le("libp2p-pubsub:peer-streams");Vb.error=le("libp2p-pubsub:peer-streams:error");class N6 extends _r{constructor({id:e,protocol:t}){super();this.id=e,this.protocol=t,this._rawOutboundStream=null,this._rawInboundStream=null,this._inboundAbortController=null,this.outboundStream=null,this.inboundStream=null}get isReadable(){return Boolean(this.inboundStream)}get isWritable(){return Boolean(this.outboundStream)}write(e){if(!this.isWritable){const t=this.id.toB58String();throw new Error("No writable connection to "+t)}this.outboundStream.push(e)}attachInboundStream(e){this._inboundAbortController=new Ya,this._rawInboundStream=e,this.inboundStream=zt(Yr(this._rawInboundStream,lr.decode()),this._inboundAbortController.signal,{returnOnAbort:!0}),this.emit("stream:inbound")}async attachOutboundStream(e){const t=this.outboundStream;t&&await this.outboundStream.end(!1),this._rawOutboundStream=e,this.outboundStream=mc({onEnd:r=>{this._rawOutboundStream.reset&&this._rawOutboundStream.reset(),this._rawOutboundStream=null,this.outboundStream=null,r!==!1&&this.emit("close")}}),Yr(this.outboundStream,lr.encode(),this._rawOutboundStream).catch(r=>{Vb.error(r)}),t||this.emit("stream:outbound")}close(){this.outboundStream&&this.outboundStream.end(),this.inboundStream&&this._inboundAbortController.abort(),this._rawOutboundStream=null,this.outboundStream=null,this._rawInboundStream=null,this.inboundStream=null,this.emit("close")}}var x6=N6,O6={StrictSign:"StrictSign",StrictNoSign:"StrictNoSign"},D6={SignaturePolicy:O6},gn=ne(function(e,t){t=e.exports,t.randomSeqno=()=>ly(8),t.msgId=(r,i)=>{const n=ke.createFromB58String(r).id,s=new Uint8Array(n.length+i.length);return s.set(n,0),s.set(i,n.length),s},t.noSignMsgId=r=>py.encode(r,"sha2-256"),t.anyMatch=(r,i)=>{let n;Array.isArray(i)?n=s=>i.indexOf(s)>-1:n=s=>i.has(s);for(const s of r)if(n(s))return!0;return!1},t.ensureArray=r=>Array.isArray(r)?r:[r],t.normalizeInRpcMessage=(r,i)=>{const n=Object.assign({},r);return r.from instanceof Uint8Array&&(n.from=Ae(r.from,"base58btc")),i&&(n.receivedFrom=i),n},t.normalizeOutRpcMessage=r=>{const i=Object.assign({},r);return(typeof r.from=="string"||r.from instanceof String)&&(i.from=St(r.from,"base58btc")),(typeof r.data=="string"||r.data instanceof String)&&(i.data=St(r.data)),i}});const{Message:Gb}=Td,Tf=St("libp2p-pubsub:");async function B6(e,t){const r=mt([Tf,Gb.encode(t)]),i=await e.privKey.sign(r);return{...t,signature:i,key:e.pubKey.bytes}}async function L6(e){const t={...e};delete t.signature,delete t.key,t.from=ke.createFromCID(t.from).toBytes();const r=mt([Tf,Gb.encode(t)]),i=await Xb(e);return i.verify(r,e.signature)}async function Xb(e){const t=ke.createFromCID(e.from);if(e.key){const r=await ke.createFromPubKey(e.key);if(r.isEqual(t))return r.pubKey;throw new Error("Public Key does not match the originator")}else{if(t.pubKey)return t.pubKey;throw new Error("Could not get the public key from the originator id")}}var j6={messagePublicKey:Xb,signMessage:B6,SignPrefix:Tf,verifySignature:L6};const{codes:Ii}=If,{SignaturePolicy:bn}=D6,{signMessage:F6,verifySignature:U6}=j6;class q6 extends _r{constructor({debugName:e,multicodecs:t,libp2p:r,globalSignaturePolicy:i=bn.StrictSign,canRelayMessage:n=!1,emitSelf:s=!1}){if(typeof e!="string")throw new Error("a debugname `string` is required");if(!t)throw new Error("multicodecs are required");if(!r)throw new Error("libp2p is required");super();if(this.log=le(e),this.log.err=le(`${e}:error`),this.multicodecs=gn.ensureArray(t),this._libp2p=r,this.registrar=r.registrar,this.peerId=r.peerId,this.started=!1,this.topics=new Map,this.subscriptions=new Set,this.peers=new Map,!bn[i])throw G(new Error("Invalid global signature policy"),Ii.ERR_INVALID_SIGUATURE_POLICY);this.globalSignaturePolicy=i,this.canRelayMessage=n,this.emitSelf=s,this.topicValidators=new Map,this._registrarId=void 0,this._onIncomingStream=this._onIncomingStream.bind(this),this._onPeerConnected=this._onPeerConnected.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this)}start(){if(this.started)return;this.log("starting"),this.registrar.handle(this.multicodecs,this._onIncomingStream);const e=new R6({multicodecs:this.multicodecs,handlers:{onConnect:this._onPeerConnected,onDisconnect:this._onPeerDisconnected}});this._registrarId=this.registrar.register(e),this.log("started"),this.started=!0}stop(){if(!this.started)return;this.registrar.unregister(this._registrarId),this.log("stopping"),this.peers.forEach(e=>e.close()),this.peers=new Map,this.subscriptions=new Set,this.started=!1,this.log("stopped")}_onIncomingStream({protocol:e,stream:t,connection:r}){const i=r.remotePeer,n=i.toB58String(),s=this._addPeer(i,e);s.attachInboundStream(t),this._processMessages(n,s.inboundStream,s)}async _onPeerConnected(e,t){const r=e.toB58String();this.log("connected",r);try{const{stream:i,protocol:n}=await t.newStream(this.multicodecs),s=this._addPeer(e,n);await s.attachOutboundStream(i)}catch(i){this.log.err(i)}this._sendSubscriptions(r,Array.from(this.subscriptions),!0)}_onPeerDisconnected(e,t){const r=e.toB58String();this.log("connection ended",r,t?t.message:""),this._removePeer(e)}_addPeer(e,t){const r=e.toB58String(),i=this.peers.get(r);if(i)return i;this.log("new peer",r);const n=new x6({id:e,protocol:t});return this.peers.set(r,n),n.once("close",()=>this._removePeer(e)),n}_removePeer(e){if(!e)return;const t=e.toB58String(),r=this.peers.get(t);if(!r)return;r.removeAllListeners(),r.close(),this.log("delete peer",t),this.peers.delete(t);for(const i of this.topics.values())i.delete(t);return r}async _processMessages(e,t,r){try{await Yr(t,async i=>{for await(const n of i){const s=n instanceof Uint8Array?n:n.slice(),a=this._decodeRpc(s);this._processRpc(e,r,a)}})}catch(i){this._onPeerDisconnected(r.id,i)}}_processRpc(e,t,r){this.log("rpc from",e);const i=r.subscriptions,n=r.msgs;return i.length&&(i.forEach(s=>this._processRpcSubOpt(e,s)),this.emit("pubsub:subscription-change",t.id,i)),this._acceptFrom(e)?(n.length&&n.forEach(s=>{if(!(this.canRelayMessage||s.topicIDs.some(c=>this.subscriptions.has(c)))){this.log("received message we didn't subscribe to. Dropping.");return}const a=gn.normalizeInRpcMessage(s,e);this._processRpcMessage(a)}),!0):(this.log("received message from unacceptable peer %s",e),!1)}_processRpcSubOpt(e,t){const r=t.topicID;let i=this.topics.get(r);i||(i=new Set,this.topics.set(r,i)),t.subscribe?i.add(e):i.delete(e)}async _processRpcMessage(e){if(this.peerId.toB58String()===e.from&&!this.emitSelf)return;try{await this.validate(e)}catch(t){this.log("Message is invalid, dropping it. %O",t);return}this._emitMessage(e),this._publish(gn.normalizeOutRpcMessage(e))}_emitMessage(e){e.topicIDs.forEach(t=>{this.subscriptions.has(t)&&this.emit(t,e)})}getMsgId(e){const t=this.globalSignaturePolicy;switch(t){case bn.StrictSign:return gn.msgId(e.from,e.seqno);case bn.StrictNoSign:return gn.noSignMsgId(e.data);default:throw G(new Error("Cannot get message id: unhandled signature policy: "+t),Ii.ERR_UNHANDLED_SIGNATURE_POLICY)}}_acceptFrom(e){return!0}_decodeRpc(e){return Td.rpc.RPC.decode(e)}_encodeRpc(e){return Td.rpc.RPC.encode(e)}_sendRpc(e,t){const r=this.peers.get(e);if(!r||!r.isWritable){const i=`Cannot send RPC to ${e} as there is no open stream to it available`;this.log.err(i);return}r.write(this._encodeRpc(t))}_sendSubscriptions(e,t,r){return this._sendRpc(e,{subscriptions:t.map(i=>({topicID:i,subscribe:r}))})}async validate(e){const t=this.globalSignaturePolicy;switch(t){case bn.StrictNoSign:if(e.from)throw G(new Error("StrictNoSigning: from should not be present"),Ii.ERR_UNEXPECTED_FROM);if(e.signature)throw G(new Error("StrictNoSigning: signature should not be present"),Ii.ERR_UNEXPECTED_SIGNATURE);if(e.key)throw G(new Error("StrictNoSigning: key should not be present"),Ii.ERR_UNEXPECTED_KEY);if(e.seqno)throw G(new Error("StrictNoSigning: seqno should not be present"),Ii.ERR_UNEXPECTED_SEQNO);break;case bn.StrictSign:if(!e.signature)throw G(new Error("StrictSigning: Signing required and no signature was present"),Ii.ERR_MISSING_SIGNATURE);if(!e.seqno)throw G(new Error("StrictSigning: Signing required and no seqno was present"),Ii.ERR_MISSING_SEQNO);if(!await U6(e))throw G(new Error("StrictSigning: Invalid message signature"),Ii.ERR_INVALID_SIGNATURE);break;default:throw G(new Error("Cannot validate message: unhandled signature policy: "+t),Ii.ERR_UNHANDLED_SIGNATURE_POLICY)}for(const r of e.topicIDs){const i=this.topicValidators.get(r);if(!i)continue;await i(r,e)}}_buildMessage(e){const t=this.globalSignaturePolicy;switch(t){case bn.StrictSign:return e.from=this.peerId.toB58String(),e.seqno=gn.randomSeqno(),F6(this.peerId,gn.normalizeOutRpcMessage(e));case bn.StrictNoSign:return e;default:throw G(new Error("Cannot build message: unhandled signature policy: "+t),Ii.ERR_UNHANDLED_SIGNATURE_POLICY)}}getSubscribers(e){if(!this.started)throw G(new Error("not started yet"),"ERR_NOT_STARTED_YET");if(!e||typeof e!="string")throw G(new Error("a string topic must be provided"),"ERR_NOT_VALID_TOPIC");const t=this.topics.get(e);return t?Array.from(t):[]}async publish(e,t){if(!this.started)throw new Error("Pubsub has not started");this.log("publish",e,t);const r=this.peerId.toB58String();let i={receivedFrom:r,data:t,topicIDs:[e]};const n=await this._buildMessage(i);i=gn.normalizeInRpcMessage(n),this.emitSelf&&this._emitMessage(i),await this._publish(i)}_publish(e){throw G(new Error("publish must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}subscribe(e){if(!this.started)throw new Error("Pubsub has not started");this.subscriptions.has(e)||(this.subscriptions.add(e),this.peers.forEach((t,r)=>this._sendSubscriptions(r,[e],!0)))}unsubscribe(e){if(!this.started)throw new Error("Pubsub is not started");this.subscriptions.has(e)&&this.listenerCount(e)===0&&(this.subscriptions.delete(e),this.peers.forEach((t,r)=>this._sendSubscriptions(r,[e],!1)))}getTopics(){if(!this.started)throw new Error("Pubsub is not started");return Array.from(this.subscriptions)}}var Cd=q6,z6=Td,$6=gn,H6=bn;Cd.message=z6,Cd.utils=$6,Cd.SignaturePolicy=H6;var V6=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createGossipRpc=void 0;function r(i=[],n={}){return{subscriptions:[],msgs:i,control:Object.assign({ihave:[],iwant:[],graft:[],prune:[]},n)}}t.createGossipRpc=r}),G6=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.shuffle=void 0;function r(i){if(i.length<=1)return i;const n=()=>Math.floor(Math.random()*Math.floor(i.length));for(let s=0;s<i.length;s++){const a=n(),c=i[s];i[s]=i[a],i[a]=c}return i}t.shuffle=r}),xs=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ERR_TOPIC_VALIDATOR_IGNORE=t.ERR_TOPIC_VALIDATOR_REJECT=t.TimeCacheDuration=t.GossipsubIWantFollowupTime=t.GossipsubMaxIHaveMessages=t.GossipsubMaxIHaveLength=t.GossipsubGraftFloodThreshold=t.GossipsubOpportunisticGraftPeers=t.GossipsubOpportunisticGraftTicks=t.GossipsubDirectConnectInitialDelay=t.GossipsubDirectConnectTicks=t.GossipsubConnectionTimeout=t.GossipsubMaxPendingConnections=t.GossipsubConnectors=t.GossipsubPruneBackoffTicks=t.GossipsubPruneBackoff=t.GossipsubPrunePeers=t.GossipsubFanoutTTL=t.GossipsubHeartbeatInterval=t.GossipsubHeartbeatInitialDelay=t.GossipsubGossipRetransmission=t.GossipsubGossipFactor=t.GossipsubDlazy=t.GossipsubHistoryGossip=t.GossipsubHistoryLength=t.GossipsubDout=t.GossipsubDscore=t.GossipsubDhi=t.GossipsubDlo=t.GossipsubD=t.GossipsubIDv11=t.GossipsubIDv10=t.FloodsubID=t.minute=t.second=void 0,t.second=1e3,t.minute=60*t.second,t.FloodsubID="/floodsub/1.0.0",t.GossipsubIDv10="/meshsub/1.0.0",t.GossipsubIDv11="/meshsub/1.1.0",t.GossipsubD=6,t.GossipsubDlo=4,t.GossipsubDhi=12,t.GossipsubDscore=4,t.GossipsubDout=2,t.GossipsubHistoryLength=5,t.GossipsubHistoryGossip=3,t.GossipsubDlazy=6,t.GossipsubGossipFactor=.25,t.GossipsubGossipRetransmission=3,t.GossipsubHeartbeatInitialDelay=100,t.GossipsubHeartbeatInterval=t.second,t.GossipsubFanoutTTL=t.minute,t.GossipsubPrunePeers=16,t.GossipsubPruneBackoff=t.minute,t.GossipsubPruneBackoffTicks=15,t.GossipsubConnectors=8,t.GossipsubMaxPendingConnections=128,t.GossipsubConnectionTimeout=30*t.second,t.GossipsubDirectConnectTicks=300,t.GossipsubDirectConnectInitialDelay=t.second,t.GossipsubOpportunisticGraftTicks=60,t.GossipsubOpportunisticGraftPeers=2,t.GossipsubGraftFloodThreshold=10*t.second,t.GossipsubMaxIHaveLength=5e3,t.GossipsubMaxIHaveMessages=10,t.GossipsubIWantFollowupTime=3*t.second,t.TimeCacheDuration=120*1e3,t.ERR_TOPIC_VALIDATOR_REJECT="ERR_TOPIC_VALIDATOR_REJECT",t.ERR_TOPIC_VALIDATOR_IGNORE="ERR_TOPIC_VALIDATOR_IGNORE"}),X6=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.hasGossipProtocol=void 0;function r(i){return i===xs.GossipsubIDv10||i===xs.GossipsubIDv11}t.hasGossipProtocol=r}),K6=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.messageIdToString=void 0;function r(i){return Ae(i,"base64")}t.messageIdToString=r}),ct=ne(function(e,t){var r=se&&se.__createBinding||(Object.create?function(n,s,a,c){c===void 0&&(c=a),Object.defineProperty(n,c,{enumerable:!0,get:function(){return s[a]}})}:function(n,s,a,c){c===void 0&&(c=a),n[c]=s[a]}),i=se&&se.__exportStar||function(n,s){for(var a in n)a!=="default"&&!s.hasOwnProperty(a)&&r(s,n,a)};Object.defineProperty(t,"__esModule",{value:!0}),i(V6,t),i(G6,t),i(X6,t),i(K6,t)}),W6=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MessageCache=void 0;class r{constructor(i,n,s){this.msgs=new Map,this.peertx=new Map,this.history=[];for(let a=0;a<n;a++)this.history[a]=[];this.gossip=i,this.msgIdFn=s}put(i){const n=this.getMsgId(i),s=ct.messageIdToString(n);this.msgs.set(s,i),this.history[0].push({msgID:n,topics:i.topicIDs})}getMsgId(i){return this.msgIdFn(i)}get(i){return this.msgs.get(ct.messageIdToString(i))}getForPeer(i,n){const s=ct.messageIdToString(i),a=this.msgs.get(s);if(!a)return[void 0,0];let c=this.peertx.get(s);c||(c=new Map,this.peertx.set(s,c));const o=(c.get(n)||0)+1;return c.set(n,o),[a,o]}getGossipIDs(i){const n=[];for(let s=0;s<this.gossip;s++)this.history[s].forEach(a=>{for(const c of a.topics)if(c===i){n.push(a.msgID);break}});return n}shift(){const i=this.history[this.history.length-1];i.forEach(n=>{const s=ct.messageIdToString(n.msgID);this.msgs.delete(s),this.peertx.delete(s)}),this.history.pop(),this.history.unshift([])}}t.MessageCache=r}),Y6=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=`
message RPC {
  repeated SubOpts subscriptions = 1;
  repeated Message msgs = 2;
  optional ControlMessage control = 3;

  message SubOpts {
    optional bool subscribe = 1; // subscribe or unsubcribe
    optional string topicID = 2;
  }

  message Message {
    optional bytes from = 1;
    optional bytes data = 2;
    optional bytes seqno = 3;
    repeated string topicIDs = 4; 
    optional bytes signature = 5;
    optional bytes key = 6;
  }

  message ControlMessage {
    repeated ControlIHave ihave = 1;
    repeated ControlIWant iwant = 2;
    repeated ControlGraft graft = 3;
    repeated ControlPrune prune = 4;
  }

  message ControlIHave {
    optional string topicID = 1;
    repeated bytes messageIDs = 2;
  }

  message ControlIWant {
    repeated bytes messageIDs = 1;  
  }

  message ControlGraft {
    optional string topicID = 1;
  }

  message ControlPrune {
    optional string topicID = 1;
    repeated PeerInfo peers = 2;
    optional uint64 backoff = 3;
  }

  message PeerInfo {
    optional bytes peerID = 1;
    optional bytes signedPeerRecord = 2;
  }
}`}),Cf=ne(function(e,t){var r=se&&se.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(t,"__esModule",{value:!0}),t.RPCCodec=void 0;const i=r(Y6),n=tn(i.default);t.RPCCodec=n.RPC}),Yn=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getGossipPeers=void 0;function r(i,n,s,a=()=>!0){const c=i.topics.get(n);if(!c)return new Set;let o=[];return c.forEach(d=>{const l=i.peers.get(d);if(!l)return;ct.hasGossipProtocol(l.protocol)&&a(d)&&o.push(d)}),o=ct.shuffle(o),s>0&&o.length>s&&(o=o.slice(0,s)),new Set(o)}t.getGossipPeers=r}),Z6=ne(function(e,t){var r=se&&se.__createBinding||(Object.create?function(c,o,d,l){l===void 0&&(l=d),Object.defineProperty(c,l,{enumerable:!0,get:function(){return o[d]}})}:function(c,o,d,l){l===void 0&&(l=d),c[l]=o[d]}),i=se&&se.__setModuleDefault||(Object.create?function(c,o){Object.defineProperty(c,"default",{enumerable:!0,value:o})}:function(c,o){c.default=o}),n=se&&se.__importStar||function(c){if(c&&c.__esModule)return c;var o={};if(c!=null)for(var d in c)d!=="default"&&Object.hasOwnProperty.call(c,d)&&r(o,c,d);return i(o,c),o};Object.defineProperty(t,"__esModule",{value:!0}),t.Heartbeat=void 0;const s=n(xs);class a{constructor(c){this.gossipsub=c}start(){if(this._heartbeatTimer)return;const c=this._heartbeat.bind(this),o=setTimeout(()=>{c(),this._heartbeatTimer.runPeriodically(c,s.GossipsubHeartbeatInterval)},s.GossipsubHeartbeatInitialDelay);this._heartbeatTimer={_intervalId:void 0,runPeriodically:(d,l)=>{this._heartbeatTimer._intervalId=setInterval(d,l)},cancel:()=>{clearTimeout(o),clearInterval(this._heartbeatTimer._intervalId)}}}stop(){if(!this._heartbeatTimer)return;this._heartbeatTimer.cancel(),this._heartbeatTimer=null}_heartbeat(){const{D:c,Dlo:o,Dhi:d,Dscore:l,Dout:u}=this.gossipsub._options;this.gossipsub.heartbeatTicks++;const p=new Map,f=D=>{let j=p.get(D);return j===void 0&&(j=this.gossipsub.score.score(D),p.set(D,j)),j},g=new Map,v=new Map,S=new Map;this.gossipsub._clearBackoff(),this.gossipsub.peerhave.clear(),this.gossipsub.iasked.clear(),this.gossipsub._applyIwantPenalties(),this.gossipsub._directConnect(),this.gossipsub.mesh.forEach((D,j)=>{const m=R=>{this.gossipsub.log("HEARTBEAT: Remove mesh link to %s in %s",R,j),this.gossipsub.score.prune(R,j),this.gossipsub._addBackoff(R,j),D.delete(R);const h=v.get(R);h?h.push(j):v.set(R,[j])},w=R=>{this.gossipsub.log("HEARTBEAT: Add mesh link to %s in %s",R,j),this.gossipsub.score.graft(R,j),D.add(R);const h=g.get(R);h?h.push(j):g.set(R,[j])};if(D.forEach(R=>{const h=f(R);h<0&&(this.gossipsub.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",R,h,j),m(R),S.set(R,!0))}),D.size<o){const R=this.gossipsub.backoff.get(j),h=c-D.size,b=Yn.getGossipPeers(this.gossipsub,j,h,A=>!D.has(A)&&!this.gossipsub.direct.has(A)&&(!R||!R.has(A))&&f(A)>=0);b.forEach(w)}if(D.size>d){let R=Array.from(D);R.sort((b,A)=>f(A)-f(b)),R=R.slice(0,l).concat(ct.shuffle(R.slice(l)));let h=0;if(R.slice(0,c).forEach(b=>{this.gossipsub.outbound.get(b)&&h++}),h<u){const b=y=>{const P=R[y];for(let N=y;N>0;N--)R[N]=R[N-1];R[0]=P};if(h>0){let y=h;for(let P=1;P<c&&y>0;P++)this.gossipsub.outbound.get(R[P])&&(b(P),y--)}let A=c-h;for(let y=c;y<R.length&&A>0;y++)this.gossipsub.outbound.get(R[y])&&(b(y),A--)}R.slice(c).forEach(m)}if(D.size>=o){let R=0;if(D.forEach(h=>{this.gossipsub.outbound.get(h)&&R++}),R<u){const h=u-R,b=this.gossipsub.backoff.get(j);Yn.getGossipPeers(this.gossipsub,j,h,A=>!D.has(A)&&!this.gossipsub.direct.has(A)&&(!b||!b.has(A))&&f(A)>=0).forEach(w)}}if(this.gossipsub.heartbeatTicks%s.GossipsubOpportunisticGraftTicks===0&&D.size>1){const R=Array.from(D).sort((A,y)=>f(A)-f(y)),h=D.size/2,b=f(R[h]);if(b<this.gossipsub._options.scoreThresholds.opportunisticGraftThreshold){const A=this.gossipsub.backoff.get(j),y=Yn.getGossipPeers(this.gossipsub,j,s.GossipsubOpportunisticGraftPeers,P=>D.has(P)&&!this.gossipsub.direct.has(P)&&(!A||!A.has(P))&&f(P)>b);y.forEach(P=>{this.gossipsub.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",P,j),w(P)})}}this.gossipsub._emitGossip(j,D)});const C=this.gossipsub._now();this.gossipsub.lastpub.forEach((D,j)=>{D+s.GossipsubFanoutTTL<C&&(this.gossipsub.fanout.delete(j),this.gossipsub.lastpub.delete(j))}),this.gossipsub.fanout.forEach((D,j)=>{const m=this.gossipsub.topics.get(j);if(D.forEach(w=>{(!m.has(w)||f(w)<this.gossipsub._options.scoreThresholds.publishThreshold)&&D.delete(w)}),D.size<c){const w=c-D.size,R=Yn.getGossipPeers(this.gossipsub,j,w,h=>!D.has(h)&&!this.gossipsub.direct.has(h)&&f(h)>=this.gossipsub._options.scoreThresholds.publishThreshold);R.forEach(h=>{D.add(h)})}this.gossipsub._emitGossip(j,D)}),this.gossipsub._sendGraftPrune(g,v,S),this.gossipsub._flush(),this.gossipsub.messageCache.shift(),this.gossipsub.emit("gossipsub:heartbeat")}}t.Heartbeat=a}),Ye=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ERR_INVALID_PEER_SCORE_THRESHOLDS=t.ERR_INVALID_PEER_SCORE_PARAMS=void 0,t.ERR_INVALID_PEER_SCORE_PARAMS="ERR_INVALID_PEER_SCORE_PARAMS",t.ERR_INVALID_PEER_SCORE_THRESHOLDS="ERR_INVALID_PEER_SCORE_THRESHOLDS"}),Kb=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validateTopicScoreParams=t.validatePeerScoreParams=t.createTopicScoreParams=t.createPeerScoreParams=t.defaultTopicScoreParams=t.defaultPeerScoreParams=void 0,t.defaultPeerScoreParams={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},t.defaultTopicScoreParams={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function r(a={}){return Object.assign(Object.assign(Object.assign({},t.defaultPeerScoreParams),a),{topics:a.topics?Object.entries(a.topics).reduce((c,[o,d])=>(c[o]=i(d),c),{}):{}})}t.createPeerScoreParams=r;function i(a={}){return Object.assign(Object.assign({},t.defaultTopicScoreParams),a)}t.createTopicScoreParams=i;function n(a){for(const[c,o]of Object.entries(a.topics))try{s(o)}catch(d){throw G(new Error(`invalid score parameters for topic ${c}: ${d.message}`),Ye.ERR_INVALID_PEER_SCORE_PARAMS)}if(a.topicScoreCap<0)throw G(new Error("invalid topic score cap; must be positive (or 0 for no cap)"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.appSpecificScore===null||a.appSpecificScore===void 0)throw G(new Error("missing application specific score function"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.IPColocationFactorWeight>0)throw G(new Error("invalid IPColocationFactorWeight; must be negative (or 0 to disable)"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.IPColocationFactorWeight!==0&&a.IPColocationFactorThreshold<1)throw G(new Error("invalid IPColocationFactorThreshold; must be at least 1"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.behaviourPenaltyWeight>0)throw G(new Error("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.behaviourPenaltyWeight!==0&&(a.behaviourPenaltyDecay<=0||a.behaviourPenaltyDecay>=1))throw G(new Error("invalid BehaviourPenaltyDecay; must be between 0 and 1"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.decayInterval<1e3)throw G(new Error("invalid DecayInterval; must be at least 1s"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.decayToZero<=0||a.decayToZero>=1)throw G(new Error("invalid DecayToZero; must be between 0 and 1"),Ye.ERR_INVALID_PEER_SCORE_PARAMS)}t.validatePeerScoreParams=n;function s(a){if(a.topicWeight<0)throw G(new Error("invalid topic weight; must be >= 0"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.timeInMeshQuantum===0)throw G(new Error("invalid TimeInMeshQuantum; must be non zero"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.timeInMeshWeight<0)throw G(new Error("invalid TimeInMeshWeight; must be positive (or 0 to disable)"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.timeInMeshWeight!==0&&a.timeInMeshQuantum<=0)throw G(new Error("invalid TimeInMeshQuantum; must be positive"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.timeInMeshWeight!==0&&a.timeInMeshCap<=0)throw G(new Error("invalid TimeInMeshCap; must be positive"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.firstMessageDeliveriesWeight<0)throw G(new Error("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.firstMessageDeliveriesWeight!==0&&(a.firstMessageDeliveriesDecay<=0||a.firstMessageDeliveriesDecay>=1))throw G(new Error("invalid FirstMessageDeliveriesDecay; must be between 0 and 1"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.firstMessageDeliveriesWeight!==0&&a.firstMessageDeliveriesCap<=0)throw G(new Error("invalid FirstMessageDeliveriesCap; must be positive"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight>0)throw G(new Error("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight!==0&&(a.meshMessageDeliveriesDecay<=0||a.meshMessageDeliveriesDecay>=1))throw G(new Error("invalid MeshMessageDeliveriesDecay; must be between 0 and 1"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight!==0&&a.meshMessageDeliveriesCap<=0)throw G(new Error("invalid MeshMessageDeliveriesCap; must be positive"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight!==0&&a.meshMessageDeliveriesThreshold<=0)throw G(new Error("invalid MeshMessageDeliveriesThreshold; must be positive"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWindow<0)throw G(new Error("invalid MeshMessageDeliveriesWindow; must be non-negative"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight!==0&&a.meshMessageDeliveriesActivation<1e3)throw G(new Error("invalid MeshMessageDeliveriesActivation; must be at least 1s"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshFailurePenaltyWeight>0)throw G(new Error("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshFailurePenaltyWeight!==0&&(a.meshFailurePenaltyDecay<=0||a.meshFailurePenaltyDecay>=1))throw G(new Error("invalid MeshFailurePenaltyDecay; must be between 0 and 1"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.invalidMessageDeliveriesWeight>0)throw G(new Error("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)"),Ye.ERR_INVALID_PEER_SCORE_PARAMS);if(a.invalidMessageDeliveriesDecay<=0||a.invalidMessageDeliveriesDecay>=1)throw G(new Error("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1"),Ye.ERR_INVALID_PEER_SCORE_PARAMS)}t.validateTopicScoreParams=s}),J6=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validatePeerScoreThresholds=t.createPeerScoreThresholds=t.defaultPeerScoreThresholds=void 0,t.defaultPeerScoreThresholds={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function r(n={}){return Object.assign(Object.assign({},t.defaultPeerScoreThresholds),n)}t.createPeerScoreThresholds=r;function i(n){if(n.gossipThreshold>0)throw G(new Error("invalid gossip threshold; it must be <= 0"),Ye.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(n.publishThreshold>0||n.publishThreshold>n.gossipThreshold)throw G(new Error("invalid publish threshold; it must be <= 0 and <= gossip threshold"),Ye.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(n.graylistThreshold>0||n.graylistThreshold>n.publishThreshold)throw G(new Error("invalid graylist threshold; it must be <= 0 and <= publish threshold"),Ye.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(n.acceptPXThreshold<0)throw G(new Error("invalid accept PX threshold; it must be >= 0"),Ye.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(n.opportunisticGraftThreshold<0)throw G(new Error("invalid opportunistic grafting threshold; it must be >= 0"),Ye.ERR_INVALID_PEER_SCORE_THRESHOLDS)}t.validatePeerScoreThresholds=i}),ka=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ensureTopicStats=t.createTopicStats=t.createPeerStats=void 0;function r(s={}){return Object.assign(Object.assign({connected:!1,expire:0,ips:[],behaviourPenalty:0},s),{topics:s.topics?Object.entries(s.topics).reduce((a,[c,o])=>(a[c]=i(o),a),{}):{}})}t.createPeerStats=r;function i(s={}){return Object.assign({inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},s)}t.createTopicStats=i;function n(s,a,c){let o=a.topics[s];return o||(c.topics[s]?(a.topics[s]=o=i(),o):void 0)}t.ensureTopicStats=n}),Q6=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.computeScore=void 0;function r(i,n,s,a){let c=0;Object.entries(n.topics).forEach(([l,u])=>{const p=s.topics[l];if(!p)return;let f=0;if(u.inMesh){let C=u.meshTime/p.timeInMeshQuantum;C>p.timeInMeshCap&&(C=p.timeInMeshCap),f+=C*p.timeInMeshWeight}const g=u.firstMessageDeliveries;if(f+=g*p.firstMessageDeliveriesWeight,u.meshMessageDeliveriesActive&&u.meshMessageDeliveries<p.meshMessageDeliveriesThreshold){const C=p.meshMessageDeliveriesThreshold-u.meshMessageDeliveries,D=C*C;f+=D*p.meshMessageDeliveriesWeight}const v=u.meshFailurePenalty;f+=v*p.meshFailurePenaltyWeight;const S=u.invalidMessageDeliveries*u.invalidMessageDeliveries;f+=S*p.invalidMessageDeliveriesWeight,c+=f*p.topicWeight}),s.topicScoreCap>0&&c>s.topicScoreCap&&(c=s.topicScoreCap);const o=s.appSpecificScore(i);c+=o*s.appSpecificWeight,n.ips.forEach(l=>{if(s.IPColocationFactorWhitelist.has(l))return;const u=a.get(l),p=u?u.size:0;if(p>s.IPColocationFactorThreshold){const f=p-s.IPColocationFactorThreshold,g=f*f;c+=g*s.IPColocationFactorWeight}});const d=n.behaviourPenalty*n.behaviourPenalty;return c+=d*s.behaviourPenaltyWeight,c}t.computeScore=r});function xt(e){this._head=0,this._tail=0,this._capacityMask=3,this._list=new Array(4),Array.isArray(e)&&this._fromArray(e)}xt.prototype.peekAt=function(t){var r=t;if(r!==(r|0))return;var i=this.size();return r>=i||r<-i?void 0:(r<0&&(r+=i),r=this._head+r&this._capacityMask,this._list[r])},xt.prototype.get=function(t){return this.peekAt(t)},xt.prototype.peek=function(){return this._head===this._tail?void 0:this._list[this._head]},xt.prototype.peekFront=function(){return this.peek()},xt.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(xt.prototype,"length",{get:function(){return this.size()}}),xt.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},xt.prototype.unshift=function(t){if(t===void 0)return this.size();var r=this._list.length;return this._head=this._head-1+r&this._capacityMask,this._list[this._head]=t,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},xt.prototype.shift=function(){var t=this._head;if(t===this._tail)return;var r=this._list[t];return this._list[t]=void 0,this._head=t+1&this._capacityMask,t<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),r},xt.prototype.push=function(t){if(t===void 0)return this.size();var r=this._tail;return this._list[r]=t,this._tail=r+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},xt.prototype.pop=function(){var t=this._tail;if(t===this._head)return;var r=this._list.length;this._tail=t-1+r&this._capacityMask;var i=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&t>1e4&&t<=r>>>2&&this._shrinkArray(),i},xt.prototype.removeOne=function(t){var r=t;if(r!==(r|0))return;if(this._head===this._tail)return;var i=this.size(),n=this._list.length;if(r>=i||r<-i)return;r<0&&(r+=i),r=this._head+r&this._capacityMask;var s=this._list[r],a;if(t<i/2){for(a=t;a>0;a--)this._list[r]=this._list[r=r-1+n&this._capacityMask];this._list[r]=void 0,this._head=this._head+1+n&this._capacityMask}else{for(a=i-1-t;a>0;a--)this._list[r]=this._list[r=r+1+n&this._capacityMask];this._list[r]=void 0,this._tail=this._tail-1+n&this._capacityMask}return s},xt.prototype.remove=function(t,r){var i=t,n,s=r;if(i!==(i|0))return;if(this._head===this._tail)return;var a=this.size(),c=this._list.length;if(i>=a||i<-a||r<1)return;if(i<0&&(i+=a),r===1||!r)return n=new Array(1),n[0]=this.removeOne(i),n;if(i===0&&i+r>=a)return n=this.toArray(),this.clear(),n;i+r>a&&(r=a-i);var o;for(n=new Array(r),o=0;o<r;o++)n[o]=this._list[this._head+i+o&this._capacityMask];if(i=this._head+i&this._capacityMask,t+r===a){for(this._tail=this._tail-r+c&this._capacityMask,o=r;o>0;o--)this._list[i=i+1+c&this._capacityMask]=void 0;return n}if(t===0){for(this._head=this._head+r+c&this._capacityMask,o=r-1;o>0;o--)this._list[i=i+1+c&this._capacityMask]=void 0;return n}if(i<a/2){for(this._head=this._head+t+r+c&this._capacityMask,o=t;o>0;o--)this.unshift(this._list[i=i-1+c&this._capacityMask]);for(i=this._head-1+c&this._capacityMask;s>0;)this._list[i=i-1+c&this._capacityMask]=void 0,s--;t<0&&(this._tail=i)}else{for(this._tail=i,i=i+r+c&this._capacityMask,o=a-(r+t);o>0;o--)this.push(this._list[i++]);for(i=this._tail;s>0;)this._list[i=i+1+c&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=c>>>2&&this._shrinkArray(),n},xt.prototype.splice=function(t,r){var i=t;if(i!==(i|0))return;var n=this.size();if(i<0&&(i+=n),i>n)return;if(arguments.length>2){var s,a,c,o=arguments.length,d=this._list.length,l=2;if(!n||i<n/2){for(a=new Array(i),s=0;s<i;s++)a[s]=this._list[this._head+s&this._capacityMask];for(r===0?(c=[],i>0&&(this._head=this._head+i+d&this._capacityMask)):(c=this.remove(i,r),this._head=this._head+i+d&this._capacityMask);o>l;)this.unshift(arguments[--o]);for(s=i;s>0;s--)this.unshift(a[s-1])}else{a=new Array(n-(i+r));var u=a.length;for(s=0;s<u;s++)a[s]=this._list[this._head+i+r+s&this._capacityMask];for(r===0?(c=[],i!=n&&(this._tail=this._head+i+d&this._capacityMask)):(c=this.remove(i,r),this._tail=this._tail-u+d&this._capacityMask);l<o;)this.push(arguments[l++]);for(s=0;s<u;s++)this.push(a[s])}return c}else return this.remove(i,r)},xt.prototype.clear=function(){this._head=0,this._tail=0},xt.prototype.isEmpty=function(){return this._head===this._tail},xt.prototype.toArray=function(){return this._copyArray(!1)},xt.prototype._fromArray=function(t){for(var r=0;r<t.length;r++)this.push(t[r])},xt.prototype._copyArray=function(t){var r=[],i=this._list,n=i.length,s;if(t||this._head>this._tail){for(s=this._head;s<n;s++)r.push(i[s]);for(s=0;s<this._tail;s++)r.push(i[s])}else for(s=this._head;s<this._tail;s++)r.push(i[s]);return r},xt.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length*=2,this._capacityMask=this._capacityMask<<1|1},xt.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};var ek=xt,Ti=ne(function(e,t){var r=se&&se.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageDeliveries=t.DeliveryRecordStatus=void 0;const i=r(ek);var n;(function(a){a[a.unknown=0]="unknown",a[a.valid=1]="valid",a[a.invalid=2]="invalid",a[a.ignored=3]="ignored"})(n=t.DeliveryRecordStatus||(t.DeliveryRecordStatus={}));class s{constructor(){this.records=new Map,this.queue=new i.default}ensureRecord(a){const c=ct.messageIdToString(a);let o=this.records.get(c);if(o)return o;o={status:n.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(c,o);const d={msgId:c,expire:Date.now()+xs.TimeCacheDuration};return this.queue.push(d),o}gc(){const a=Date.now();let c=this.queue.peekFront();for(;c&&c.expire<a;)this.records.delete(c.msgId),this.queue.shift(),c=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}t.MessageDeliveries=s}),tk=ne(function(e,t){var r=se&&se.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0}),t.PeerScore=void 0;const i=r(ke),{ERR_INVALID_SIGNATURE:n,ERR_MISSING_SIGNATURE:s}=If.codes,a=le("libp2p:gossipsub:score");class c{constructor(o,d,l){Kb.validatePeerScoreParams(o),this.params=o,this._connectionManager=d,this.peerStats=new Map,this.peerIPs=new Map,this.deliveryRecords=new Ti.MessageDeliveries,this.msgId=l}start(){if(this._backgroundInterval){a("Peer score already running");return}this._backgroundInterval=setInterval(()=>this.background(),this.params.decayInterval),a("started")}stop(){if(!this._backgroundInterval){a("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),a("stopped")}background(){this._refreshScores(),this._updateIPs(),this.deliveryRecords.gc()}_refreshScores(){const o=Date.now(),d=this.params.decayToZero;this.peerStats.forEach((l,u)=>{if(!l.connected){o>l.expire&&(this._removeIPs(u,l.ips),this.peerStats.delete(u));return}Object.entries(l.topics).forEach(([p,f])=>{const g=this.params.topics[p];if(!g)return;f.firstMessageDeliveries*=g.firstMessageDeliveriesDecay,f.firstMessageDeliveries<d&&(f.firstMessageDeliveries=0),f.meshMessageDeliveries*=g.meshMessageDeliveriesDecay,f.meshMessageDeliveries<d&&(f.meshMessageDeliveries=0),f.meshFailurePenalty*=g.meshFailurePenaltyDecay,f.meshFailurePenalty<d&&(f.meshFailurePenalty=0),f.invalidMessageDeliveries*=g.invalidMessageDeliveriesDecay,f.invalidMessageDeliveries<d&&(f.invalidMessageDeliveries=0),f.inMesh&&(f.meshTime=o-f.graftTime,f.meshTime>g.meshMessageDeliveriesActivation&&(f.meshMessageDeliveriesActive=!0))}),l.behaviourPenalty*=this.params.behaviourPenaltyDecay,l.behaviourPenalty<d&&(l.behaviourPenalty=0)})}score(o){const d=this.peerStats.get(o);return d?Q6.computeScore(o,d,this.params,this.peerIPs):0}addPenalty(o,d){const l=this.peerStats.get(o);if(!l)return;l.behaviourPenalty+=d}addPeer(o){const d=ka.createPeerStats({connected:!0});this.peerStats.set(o,d);const l=this._getIPs(o);this._setIPs(o,l,d.ips),d.ips=l}removePeer(o){const d=this.peerStats.get(o);if(!d)return;if(this.score(o)>0){this._removeIPs(o,d.ips),this.peerStats.delete(o);return}Object.entries(d.topics).forEach(([l,u])=>{u.firstMessageDeliveries=0;const p=this.params.topics[l].meshMessageDeliveriesThreshold;if(u.inMesh&&u.meshMessageDeliveriesActive&&u.meshMessageDeliveries<p){const f=p-u.meshMessageDeliveries;u.meshFailurePenalty+=f*f}u.inMesh=!1}),d.connected=!1,d.expire=Date.now()+this.params.retainScore}graft(o,d){const l=this.peerStats.get(o);if(!l)return;const u=ka.ensureTopicStats(d,l,this.params);if(!u)return;u.inMesh=!0,u.graftTime=Date.now(),u.meshTime=0,u.meshMessageDeliveriesActive=!1}prune(o,d){const l=this.peerStats.get(o);if(!l)return;const u=ka.ensureTopicStats(d,l,this.params);if(!u)return;const p=this.params.topics[d].meshMessageDeliveriesThreshold;if(u.meshMessageDeliveriesActive&&u.meshMessageDeliveries<p){const f=p-u.meshMessageDeliveries;u.meshFailurePenalty+=f*f}u.inMesh=!1}validateMessage(o){this.deliveryRecords.ensureRecord(this.msgId(o))}deliverMessage(o){const d=o.receivedFrom;this._markFirstMessageDelivery(d,o);const l=this.deliveryRecords.ensureRecord(this.msgId(o)),u=Date.now();if(l.status!==Ti.DeliveryRecordStatus.unknown){a("unexpected delivery: message from %s was first seen %s ago and has delivery status %d",d,u-l.firstSeen,Ti.DeliveryRecordStatus[l.status]);return}l.status=Ti.DeliveryRecordStatus.valid,l.validated=u,l.peers.forEach(p=>{p!==d&&this._markDuplicateMessageDelivery(p,o)})}rejectMessage(o,d){const l=o.receivedFrom;switch(d){case s:case n:this._markInvalidMessageDelivery(l,o);return}const u=this.deliveryRecords.ensureRecord(this.msgId(o));if(u.status!==Ti.DeliveryRecordStatus.unknown){a("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",l,Date.now()-u.firstSeen,Ti.DeliveryRecordStatus[u.status]);return}switch(d){case xs.ERR_TOPIC_VALIDATOR_IGNORE:u.status=Ti.DeliveryRecordStatus.ignored;return}u.status=Ti.DeliveryRecordStatus.invalid,this._markInvalidMessageDelivery(l,o),u.peers.forEach(p=>{this._markInvalidMessageDelivery(p,o)})}duplicateMessage(o){const d=o.receivedFrom,l=this.deliveryRecords.ensureRecord(this.msgId(o));if(l.peers.has(d))return;switch(l.status){case Ti.DeliveryRecordStatus.unknown:l.peers.add(d);break;case Ti.DeliveryRecordStatus.valid:l.peers.add(d),this._markDuplicateMessageDelivery(d,o,l.validated);break;case Ti.DeliveryRecordStatus.invalid:this._markInvalidMessageDelivery(d,o);break}}_markInvalidMessageDelivery(o,d){const l=this.peerStats.get(o);if(!l)return;d.topicIDs.forEach(u=>{const p=ka.ensureTopicStats(u,l,this.params);if(!p)return;p.invalidMessageDeliveries+=1})}_markFirstMessageDelivery(o,d){const l=this.peerStats.get(o);if(!l)return;d.topicIDs.forEach(u=>{const p=ka.ensureTopicStats(u,l,this.params);if(!p)return;let f=this.params.topics[u].firstMessageDeliveriesCap;if(p.firstMessageDeliveries+=1,p.firstMessageDeliveries>f&&(p.firstMessageDeliveries=f),!p.inMesh)return;f=this.params.topics[u].meshMessageDeliveriesCap,p.meshMessageDeliveries+=1,p.meshMessageDeliveries>f&&(p.meshMessageDeliveries=f)})}_markDuplicateMessageDelivery(o,d,l=0){const u=this.peerStats.get(o);if(!u)return;const p=l?Date.now():0;d.topicIDs.forEach(f=>{const g=ka.ensureTopicStats(f,u,this.params);if(!g)return;if(!g.inMesh)return;const v=this.params.topics[f];if(l&&p>l+v.meshMessageDeliveriesWindow)return;const S=v.meshMessageDeliveriesCap;g.meshMessageDeliveries+=1,g.meshMessageDeliveries>S&&(g.meshMessageDeliveries=S)})}_getIPs(o){return this._connectionManager.getAll(i.default.createFromB58String(o)).map(d=>d.remoteAddr.toOptions().host)}_setIPs(o,d,l){e:for(const u of d){for(const f of l)if(u===f)continue e;let p=this.peerIPs.get(u);p||(p=new Set,this.peerIPs.set(u,p)),p.add(o)}e:for(const u of l){for(const f of d)if(u===f)continue e;const p=this.peerIPs.get(u);if(!p)continue;p.delete(o),p.size||this.peerIPs.delete(u)}}_removeIPs(o,d){d.forEach(l=>{const u=this.peerIPs.get(l);if(!u)return;u.delete(o),u.size||this.peerIPs.delete(l)})}_updateIPs(){this.peerStats.forEach((o,d)=>{const l=this._getIPs(d);this._setIPs(d,l,o.ips),o.ips=l})}}t.PeerScore=c}),Rf=ne(function(e,t){var r=se&&se.__createBinding||(Object.create?function(n,s,a,c){c===void 0&&(c=a),Object.defineProperty(n,c,{enumerable:!0,get:function(){return s[a]}})}:function(n,s,a,c){c===void 0&&(c=a),n[c]=s[a]}),i=se&&se.__exportStar||function(n,s){for(var a in n)a!=="default"&&!s.hasOwnProperty(a)&&r(s,n,a)};Object.defineProperty(t,"__esModule",{value:!0}),i(Kb,t),i(J6,t),i(tk,t)}),rk=ne(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.IWantTracer=void 0;const{ERR_INVALID_SIGNATURE:r,ERR_MISSING_SIGNATURE:i}=If.codes;class n{constructor(s){this.getMsgId=s,this.promises=new Map}addPromise(s,a){const c=Math.floor(Math.random()*a.length),o=a[c],d=ct.messageIdToString(o);let l=this.promises.get(d);l||(l=new Map,this.promises.set(d,l)),l.has(s)||l.set(s,Date.now()+xs.GossipsubIWantFollowupTime)}getBrokenPromises(){const s=Date.now(),a=new Map;return this.promises.forEach((c,o)=>{c.forEach((d,l)=>{d<s&&(a.set(l,(a.get(l)||0)+1),c.delete(l))}),c.size||this.promises.delete(o)}),a}deliverMessage(s){const a=this.getMsgId(s),c=ct.messageIdToString(a);this.promises.delete(c)}rejectMessage(s,a){switch(a){case r:case i:return}const c=this.getMsgId(s),o=ct.messageIdToString(c);this.promises.delete(o)}clear(){this.promises.clear()}}t.IWantTracer=n}),Wb="Expected a function",Yb=0/0,ik="[object Symbol]",nk=/^\s+|\s+$/g,sk=/^[-+]0x[0-9a-f]+$/i,ak=/^0b[01]+$/i,ok=/^0o[0-7]+$/i,ck=parseInt,dk=typeof se=="object"&&se&&se.Object===Object&&se,lk=typeof self=="object"&&self&&self.Object===Object&&self,uk=dk||lk||Function("return this")(),fk=Object.prototype,hk=fk.toString,pk=Math.max,mk=Math.min,Mf=function(){return uk.Date.now()};function gk(e,t,r){var i,n,s,a,c,o,d=0,l=!1,u=!1,p=!0;if(typeof e!="function")throw new TypeError(Wb);t=Zb(t)||0,Rd(r)&&(l=!!r.leading,u="maxWait"in r,s=u?pk(Zb(r.maxWait)||0,t):s,p="trailing"in r?!!r.trailing:p);function f(R){var h=i,b=n;return i=n=void 0,d=R,a=e.apply(b,h),a}function g(R){return d=R,c=setTimeout(C,t),l?f(R):a}function v(R){var h=R-o,b=R-d,A=t-h;return u?mk(A,s-b):A}function S(R){var h=R-o,b=R-d;return o===void 0||h>=t||h<0||u&&b>=s}function C(){var R=Mf();if(S(R))return D(R);c=setTimeout(C,v(R))}function D(R){return c=void 0,p&&i?f(R):(i=n=void 0,a)}function j(){c!==void 0&&clearTimeout(c),d=0,i=o=n=c=void 0}function m(){return c===void 0?a:D(Mf())}function w(){var R=Mf(),h=S(R);if(i=arguments,n=this,o=R,h){if(c===void 0)return g(o);if(u)return c=setTimeout(C,t),f(o)}return c===void 0&&(c=setTimeout(C,t)),a}return w.cancel=j,w.flush=m,w}function bk(e,t,r){var i=!0,n=!0;if(typeof e!="function")throw new TypeError(Wb);return Rd(r)&&(i="leading"in r?!!r.leading:i,n="trailing"in r?!!r.trailing:n),gk(e,t,{leading:i,maxWait:t,trailing:n})}function Rd(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function yk(e){return!!e&&typeof e=="object"}function vk(e){return typeof e=="symbol"||yk(e)&&hk.call(e)==ik}function Zb(e){if(typeof e=="number")return e;if(vk(e))return Yb;if(Rd(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Rd(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(nk,"");var r=ak.test(e);return r||ok.test(e)?ck(e.slice(2),r?2:8):sk.test(e)?Yb:+e}var wk=bk,Sk=ne(function(e,t){t=e.exports=r;function r(n){if(!(this instanceof r))return new r(n);n=n||{};const s=n.validity||30,a=new Map,c=wk(()=>{a.forEach((o,d)=>{const l=o.validity||s,u=i(o.timestamp);u>l&&a.delete(d)})},200);this.put=(o,d,l)=>{this.has(o)||a.set(o,{value:d,timestamp:new Date,validity:l}),c()},this.get=o=>{if(a.has(o))return a.get(o).value;throw new Error("key does not exist")},this.has=o=>a.has(o)}function i(n){const s=new Date,a=s.getTime()-n.getTime();return Math.floor(a/1e3)}}),_k=ne(function(e){var t=se&&se.__createBinding||(Object.create?function(o,d,l,u){u===void 0&&(u=l),Object.defineProperty(o,u,{enumerable:!0,get:function(){return d[l]}})}:function(o,d,l,u){u===void 0&&(u=l),o[u]=d[l]}),r=se&&se.__setModuleDefault||(Object.create?function(o,d){Object.defineProperty(o,"default",{enumerable:!0,value:d})}:function(o,d){o.default=d}),i=se&&se.__importStar||function(o){if(o&&o.__esModule)return o;var d={};if(o!=null)for(var l in o)l!=="default"&&Object.hasOwnProperty.call(o,l)&&t(d,o,l);return r(d,o),d},n=se&&se.__awaiter||function(o,d,l,u){function p(f){return f instanceof l?f:new l(function(g){g(f)})}return new(l||(l=Promise))(function(f,g){function v(D){try{C(u.next(D))}catch(j){g(j)}}function S(D){try{C(u.throw(D))}catch(j){g(j)}}function C(D){D.done?f(D.value):p(D.value).then(v,S)}C((u=u.apply(o,d||[])).next())})};const s=i(Cd),a=i(xs);class c extends s.default{constructor(o,d={}){const l=[a.GossipsubIDv11,a.GossipsubIDv10],u=Object.assign(Object.assign({gossipIncoming:!0,fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:a.GossipsubD,Dlo:a.GossipsubDlo,Dhi:a.GossipsubDhi,Dscore:a.GossipsubDscore,Dout:a.GossipsubDout,Dlazy:a.GossipsubDlazy},d),{scoreParams:Rf.createPeerScoreParams(d.scoreParams),scoreThresholds:Rf.createPeerScoreThresholds(d.scoreThresholds)});u.fallbackToFloodsub&&l.push(a.FloodsubID),super(Object.assign({debugName:"libp2p:gossipsub",multicodecs:l,libp2p:o},u)),this._options=u,this.direct=new Set(u.directPeers.map(p=>p.id.toB58String())),u.directPeers.forEach(p=>{o.peerStore.addressBook.add(p.id,p.addrs)}),this.seenCache=new Sk,this.mesh=new Map,this.fanout=new Map,this.lastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.messageCache=d.messageCache||new W6.MessageCache(a.GossipsubHistoryGossip,a.GossipsubHistoryLength,this.getMsgId.bind(this)),this.heartbeat=new Z6.Heartbeat(this),this.heartbeatTicks=0,this.gossipTracer=new rk.IWantTracer(this.getMsgId.bind(this)),this._libp2p=o,this.score=new Rf.PeerScore(this._options.scoreParams,o.connectionManager,this.getMsgId.bind(this))}_decodeRpc(o){return Cf.RPCCodec.decode(o)}_encodeRpc(o){return Cf.RPCCodec.encode(o)}_addPeer(o,d){const l=super._addPeer(o,d);this.score.addPeer(o.toB58String());let u=!1;for(const p of this._libp2p.connectionManager.getAll(o))if(p.stat.direction==="outbound"&&Array.from(p.registry.values()).some(f=>d===f.protocol)){u=!0;break}return this.outbound.set(l.id.toB58String(),u),l}_removePeer(o){const d=super._removePeer(o),l=o.toB58String();for(const u of this.mesh.values())u.delete(l);for(const u of this.fanout.values())u.delete(l);return this.gossip.delete(l),this.control.delete(l),this.outbound.delete(l),this.score.removePeer(l),d}_processRpc(o,d,l){return super._processRpc(o,d,l)?(l.control&&this._processRpcControlMessage(o,l.control),!0):!1}_processRpcControlMessage(o,d){if(!d)return;const l=this._handleIHave(o,d.ihave),u=this._handleIWant(o,d.iwant),p=this._handleGraft(o,d.graft);if(this._handlePrune(o,d.prune),!l.length&&!u.length&&!p.length)return;const f=ct.createGossipRpc(u,{iwant:l,prune:p});this._sendRpc(o,f)}_processRpcMessage(o){const d=Object.create(null,{_processRpcMessage:{get:()=>super._processRpcMessage}});return n(this,void 0,void 0,function*(){const l=this.getMsgId(o),u=ct.messageIdToString(l);if(this.seenCache.has(u)){this.score.duplicateMessage(o);return}this.seenCache.put(u),this.score.validateMessage(o),yield d._processRpcMessage.call(this,o)})}_acceptFrom(o){return this.direct.has(o)||this.score.score(o)>=this._options.scoreThresholds.graylistThreshold}validate(o){const d=Object.create(null,{validate:{get:()=>super.validate}});return n(this,void 0,void 0,function*(){try{yield d.validate.call(this,o)}catch(l){throw this.score.rejectMessage(o,l.code),this.gossipTracer.rejectMessage(o,l.code),l}})}_handleIHave(o,d){if(!d.length)return[];const l=this.score.score(o);if(l<this._options.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",o,l),[];const u=(this.peerhave.get(o)||0)+1;if(this.peerhave.set(o,u),u>a.GossipsubMaxIHaveMessages)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",o,u),[];const p=this.iasked.get(o)||0;if(p>=a.GossipsubMaxIHaveLength)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",o,p),[];const f=new Map;if(d.forEach(({topicID:S,messageIDs:C})=>{if(!S||!this.mesh.has(S))return;C.forEach(D=>{const j=ct.messageIdToString(D);if(this.seenCache.has(j))return;f.set(j,D)})}),!f.size)return[];let g=f.size;g+p>a.GossipsubMaxIHaveLength&&(g=a.GossipsubMaxIHaveLength-p),this.log("IHAVE: Asking for %d out of %d messages from %s",g,f.size,o);let v=Array.from(f.values());return ct.shuffle(v),v=v.slice(0,g),this.iasked.set(o,p+g),this.gossipTracer.addPromise(o,v),[{messageIDs:v}]}_handleIWant(o,d){if(!d.length)return[];const l=this.score.score(o);if(l<this._options.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",o,l),[];const u=new Map;return d.forEach(({messageIDs:p})=>{p.forEach(f=>{const[g,v]=this.messageCache.getForPeer(f,o);if(!g)return;if(v>a.GossipsubGossipRetransmission){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",o,f);return}u.set(ct.messageIdToString(f),g)})}),u.size?(this.log("IWANT: Sending %d messages to %s",u.size,o),Array.from(u.values()).map(s.utils.normalizeOutRpcMessage)):[]}_handleGraft(o,d){const l=[],u=this.score.score(o),p=this._now();let f=this._options.doPX;return d.forEach(({topicID:g})=>{var v;if(!g)return;const S=this.mesh.get(g);if(!S){f=!1;return}if(S.has(o))return;if(this.direct.has(o)){this.log("GRAFT: ignoring request from direct peer %s",o),l.push(g),f=!1;return}const C=(v=this.backoff.get(g))===null||v===void 0?void 0:v.get(o);if(typeof C=="number"&&p<C){this.log("GRAFT: ignoring backed off peer %s",o),this.score.addPenalty(o,1),f=!1;const D=C+a.GossipsubGraftFloodThreshold-a.GossipsubPruneBackoff;p<D&&this.score.addPenalty(o,1),this._addBackoff(o,g),l.push(g);return}if(u<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",o,u,g),l.push(g),f=!1,this._addBackoff(o,g);return}if(S.size>=this._options.Dhi&&!this.outbound.get(o)){l.push(g),this._addBackoff(o,g);return}this.log("GRAFT: Add mesh link from %s in %s",o,g),this.score.graft(o,g),S.add(o)}),l.length?l.map(g=>this._makePrune(o,g,f)):[]}_handlePrune(o,d){const l=this.score.score(o);d.forEach(({topicID:u,backoff:p,peers:f})=>{if(!u)return;const g=this.mesh.get(u);if(!g)return;if(this.log("PRUNE: Remove mesh link to %s in %s",o,u),this.score.prune(o,u),g.delete(o),typeof p=="number"&&p>0?this._doAddBackoff(o,u,p*1e3):this._addBackoff(o,u),f&&f.length){if(l<this._options.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",o,l,u);return}this._pxConnect(f)}})}_addBackoff(o,d){this._doAddBackoff(o,d,a.GossipsubPruneBackoff)}_doAddBackoff(o,d,l){let u=this.backoff.get(d);u||(u=new Map,this.backoff.set(d,u));const p=this._now()+l,f=u.get(o)||0;f<p&&u.set(o,p)}_applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((o,d)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",d,o),this.score.addPenalty(d,o)})}_clearBackoff(){if(this.heartbeatTicks%a.GossipsubPruneBackoffTicks!==0)return;const o=this._now();this.backoff.forEach((d,l)=>{d.forEach((u,p)=>{u<o&&d.delete(p)}),d.size===0&&this.backoff.delete(l)})}_directConnect(){if(this.heartbeatTicks%a.GossipsubDirectConnectTicks!==0)return;const o=[];this.direct.forEach(d=>{const l=this.peers.get(d);(!l||!l.isWritable)&&o.push(d)}),o.length&&o.forEach(d=>{this._connect(d)})}_pxConnect(o){return n(this,void 0,void 0,function*(){o.length>a.GossipsubPrunePeers&&(ct.shuffle(o),o=o.slice(0,a.GossipsubPrunePeers));const d=[];if(yield Promise.all(o.map(l=>n(this,void 0,void 0,function*(){if(!l.peerID)return;const u=ke.createFromBytes(l.peerID),p=u.toB58String();if(this.peers.has(p))return;if(!l.signedPeerRecord){d.push(p);return}try{const f=yield to.openAndCertify(l.signedPeerRecord,"libp2p-peer-record"),g=f.peerId.toB58String();if(p!==g){this.log("bogus peer record obtained through px: peer ID %s doesn't match expected peer %s",g,p);return}if(!this._libp2p.peerStore.addressBook.consumePeerRecord(f)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}d.push(p)}catch(f){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}))),!d.length)return;d.forEach(l=>this._connect(l))})}start(){super.start(),this.heartbeat.start(),this.score.start(),this._directPeerInitial=setTimeout(()=>{this.direct.forEach(o=>{this._connect(o)})},a.GossipsubDirectConnectInitialDelay)}stop(){super.stop(),this.heartbeat.stop(),this.score.stop(),this.mesh=new Map,this.fanout=new Map,this.lastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.gossipTracer.clear(),clearTimeout(this._directPeerInitial)}_connect(o){this.log("Initiating connection with %s",o),this._libp2p.dialProtocol(ke.createFromB58String(o),this.multicodecs)}subscribe(o){super.subscribe(o),this.join(o)}unsubscribe(o){super.unsubscribe(o),this.leave(o)}join(o){if(!this.started)throw new Error("Gossipsub has not started");this.log("JOIN %s",o);const d=this.fanout.get(o);if(d)d.forEach(l=>{this.score.score(l)<0&&d.delete(l)}),d.size<this._options.D&&Yn.getGossipPeers(this,o,this._options.D-d.size,l=>!d.has(l)&&!this.direct.has(l)&&this.score.score(l)>=0).forEach(l=>d.add(l)),this.mesh.set(o,d),this.fanout.delete(o),this.lastpub.delete(o);else{const l=Yn.getGossipPeers(this,o,this._options.D,u=>!this.direct.has(u)&&this.score.score(u)>=0);this.mesh.set(o,l)}this.mesh.get(o).forEach(l=>{this.log("JOIN: Add mesh link to %s in %s",l,o),this._sendGraft(l,o)})}leave(o){if(!this.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",o);const d=this.mesh.get(o);d&&(d.forEach(l=>{this.log("LEAVE: Remove mesh link to %s in %s",l,o),this._sendPrune(l,o)}),this.mesh.delete(o))}_publish(o){return n(this,void 0,void 0,function*(){o.receivedFrom!==this.peerId.toB58String()&&(this.score.deliverMessage(o),this.gossipTracer.deliverMessage(o));const d=this.getMsgId(o),l=ct.messageIdToString(d);this.seenCache.put(l),this.messageCache.put(o);const u=new Set;o.topicIDs.forEach(f=>{const g=this.topics.get(f);if(!g)return;if(this._options.floodPublish&&o.from===this.peerId.toB58String())g.forEach(v=>{(this.direct.has(v)||this.score.score(v)>=this._options.scoreThresholds.publishThreshold)&&u.add(v)});else{this.direct.forEach(S=>{u.add(S)}),g.forEach(S=>{const C=this.score.score(S),D=this.peers.get(S);if(!D)return;D.protocol===a.FloodsubID&&C>=this._options.scoreThresholds.publishThreshold&&u.add(S)});let v=this.mesh.get(f);if(!v||!v.size){if(v=this.fanout.get(f),!v){const S=Yn.getGossipPeers(this,f,this._options.D,C=>this.score.score(C)>=this._options.scoreThresholds.publishThreshold);S.size>0?(v=S,this.fanout.set(f,S)):v=new Set}this.lastpub.set(f,this._now())}v.forEach(S=>{u.add(S)})}});const p=ct.createGossipRpc([s.utils.normalizeOutRpcMessage(o)]);u.forEach(f=>{if(f===o.from)return;this._sendRpc(f,p)})})}_sendGraft(o,d){const l=[{topicID:d}],u=ct.createGossipRpc([],{graft:l});this._sendRpc(o,u)}_sendPrune(o,d){const l=[this._makePrune(o,d,this._options.doPX)],u=ct.createGossipRpc([],{prune:l});this._sendRpc(o,u)}_sendRpc(o,d){const l=this.peers.get(o);if(!l||!l.isWritable)return;const u=this.control.get(o);u&&(this._piggybackControl(o,d,u),this.control.delete(o));const p=this.gossip.get(o);p&&(this._piggybackGossip(o,d,p),this.gossip.delete(o)),l.write(Cf.RPCCodec.encode(d))}_piggybackControl(o,d,l){const u=(l.graft||[]).filter(({topicID:f})=>(f&&this.mesh.get(f)||new Set).has(o)),p=(l.prune||[]).filter(({topicID:f})=>!(f&&this.mesh.get(f)||new Set).has(o));if(!u.length&&!p.length)return;d.control?(d.control.graft=d.control.graft.concat(u),d.control.prune=d.control.prune.concat(p)):d.control={ihave:[],iwant:[],graft:u,prune:p}}_piggybackGossip(o,d,l){d.control||(d.control={ihave:[],iwant:[],graft:[],prune:[]}),d.control.ihave=l}_sendGraftPrune(o,d,l){const u=this._options.doPX;for(const[p,f]of o){const g=f.map(D=>({topicID:D}));let v=[];const S=d.get(p);S&&(v=S.map(D=>this._makePrune(p,D,u&&!l.get(p))),d.delete(p));const C=ct.createGossipRpc([],{graft:g,prune:v});this._sendRpc(p,C)}for(const[p,f]of d){const g=f.map(S=>this._makePrune(p,S,u&&!l.get(p))),v=ct.createGossipRpc([],{prune:g});this._sendRpc(p,v)}}_emitGossip(o,d){const l=this.messageCache.getGossipIDs(o);if(!l.length)return;ct.shuffle(l),l.length>a.GossipsubMaxIHaveLength&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",l.length);const u=[],p=this.topics.get(o);if(!p)return;p.forEach(v=>{const S=this.peers.get(v);if(!S)return;!d.has(v)&&!this.direct.has(v)&&ct.hasGossipProtocol(S.protocol)&&this.score.score(v)>=this._options.scoreThresholds.gossipThreshold&&u.push(v)});let f=this._options.Dlazy;const g=a.GossipsubGossipFactor*u.length;g>f&&(f=g),f>u.length?f=u.length:ct.shuffle(u),u.slice(0,f).forEach(v=>{let S=l;l.length>a.GossipsubMaxIHaveLength&&(S=ct.shuffle(S.slice()).slice(0,a.GossipsubMaxIHaveLength)),this._pushGossip(v,{topicID:o,messageIDs:S})})}_flush(){for(const[o,d]of this.gossip.entries()){this.gossip.delete(o);const l=ct.createGossipRpc([],{ihave:d});this._sendRpc(o,l)}for(const[o,d]of this.control.entries()){this.control.delete(o);const l=ct.createGossipRpc([],{graft:d.graft,prune:d.prune});this._sendRpc(o,l)}}_pushGossip(o,d){this.log("Add gossip to %s",o);const l=this.gossip.get(o)||[];this.gossip.set(o,l.concat(d))}_now(){return Date.now()}_makePrune(o,d,l){if(this.peers.get(o).protocol===a.GossipsubIDv10)return{topicID:d,peers:[]};const u=a.GossipsubPruneBackoff/1e3,p=[];if(l){const f=Yn.getGossipPeers(this,d,a.GossipsubPrunePeers,g=>g!==o&&this.score.score(g)>=0);f.forEach(g=>{const v=ke.createFromB58String(g);p.push({peerID:v.toBytes(),signedPeerRecord:this._libp2p.peerStore.addressBook.getRawEnvelope(v)})})}return{topicID:d,peers:p,backoff:u}}}c.multicodec=a.GossipsubIDv11,e.exports=c}),Ek=fy(_k),Ak=window.MediaStream,Ik=window.MediaStreamTrack,Tk=window.RTCDataChannel,Ck=window.RTCDataChannelEvent,Rk=window.RTCDtlsTransport,Mk=window.RTCIceCandidate,kk=window.RTCIceTransport,Pk=window.RTCPeerConnection,Nk=window.RTCPeerConnectionIceEvent,xk=window.RTCRtpReceiver,Ok=window.RTCRtpSender,Dk=window.RTCRtpTransceiver,Bk=window.RTCSctpTransport,Lk=window.RTCSessionDescription,jk=window.getUserMedia,Fk=navigator.mediaDevices,Uk={MediaStream:Ak,MediaStreamTrack:Ik,RTCDataChannel:Tk,RTCDataChannelEvent:Ck,RTCDtlsTransport:Rk,RTCIceCandidate:Mk,RTCIceTransport:kk,RTCPeerConnection:Pk,RTCPeerConnectionIceEvent:Nk,RTCRtpReceiver:xk,RTCRtpSender:Ok,RTCRtpTransceiver:Dk,RTCSctpTransport:Bk,RTCSessionDescription:Lk,getUserMedia:jk,mediaDevices:Fk};function Jb(){return{addresses:{listen:["/dns4/boiling-hamlet-91904.herokuapp.com/tcp/443/wss/p2p-webrtc-star"]},modules:{transport:[kR,v0,Mg],streamMuxer:[KR],connEncryption:[A6.NOISE],dht:wy,pubsub:Ek},config:{transport:{[Mg.prototype[Symbol.toStringTag]]:{wrtc:Uk},[v0.prototype[Symbol.toStringTag]]:{filter:cu.all}},dht:Sy,exposeRawConn:!0}}}async function qk(e){const t=await O_.create(e||Jb());return await t.start(),t}export default qk;export{Jb as defaultNodeConfig};
