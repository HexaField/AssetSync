import{e as _t}from"./events-18451fd5.js";import{s as aa,a as pe,m as oa,b as Q,c as ca,i as ft,f as B,d as El,k as tf,o as Sl,e as Es,r as rf}from"./index-f214b2ff.js";import{p as ve}from"./process-e9e98960.js";import"./EventDispatcher-68e7f1a9.js";import{b as Ss}from"./buffer-es6-e6024076.js";import{c as re,a as ie,g as nf,b as sf}from"./_commonjsHelpers-c99fd594.js";import"./constants-83de7adf.js";import{c as Ze,v as ge,a as la,e as Nr,b as gr,g as af,s as of}from"./index-c4e59f80.js";import{t as Ee}from"./to-string-b6e14ed9.js";import{f as $e}from"./from-string-5d106fde.js";import{c as br,g as Ln}from"./key-6d7f3d3d.js";import{d as mi}from"./__node-resolve:empty-d7309c3b.js";import{e as U}from"./index-4f726977.js";import{s as mo}from"./index-85b101c8.js";import"./base32-ae13e88d.js";import"./util-8448a06b.js";import{a as Ts}from"./url-e7878f21.js";import{n as go}from"./empty-add391ca.js";import{p as cf}from"./path-d977e441.js";import{b as lf,g as Tl}from"./browser-343ae908.js";import{s as uf,b as Al}from"./browser-f3be077b.js";import{r as df}from"./_node-fetch_commonjs-proxy-271b4446.js";import{a as Cl,b as gi,s as mt,B as ct,c as Xe,d as As,e as Kt,h as hf,r as bo,p as pf,f as ff}from"./index-7b50d778.js";import{d as mf}from"./dhtConfig-73de4e98.js";class Il extends Error{constructor(t){super(t||"Promise was canceled");this.name="CancelError"}get isCanceled(){return!0}}class yo{static fn(t){return(...e)=>new yo((r,n,i)=>{e.push(i),t(...e).then(r,n)})}constructor(t){this._cancelHandlers=[],this._isPending=!0,this._isCanceled=!1,this._rejectOnCancel=!0,this._promise=new Promise((e,r)=>{this._reject=r;const n=a=>{this._isPending=!1,e(a)},i=a=>{this._isPending=!1,r(a)},s=a=>{if(!this._isPending)throw new Error("The `onCancel` handler was attached after the promise settled.");this._cancelHandlers.push(a)};return Object.defineProperties(s,{shouldReject:{get:()=>this._rejectOnCancel,set:a=>{this._rejectOnCancel=a}}}),t(n,i,s)})}then(t,e){return this._promise.then(t,e)}catch(t){return this._promise.catch(t)}finally(t){return this._promise.finally(t)}cancel(t){if(!this._isPending||this._isCanceled)return;if(this._cancelHandlers.length>0)try{for(const e of this._cancelHandlers)e()}catch(e){this._reject(e)}this._isCanceled=!0,this._rejectOnCancel&&this._reject(new Il(t))}get isCanceled(){return this._isCanceled}}Object.setPrototypeOf(yo.prototype,Promise.prototype);var vo=yo,gf=Il;vo.CancelError=gf;class Rl extends Error{}const bf=(t,e)=>new vo((r,n,i)=>{const{count:s,filter:a=()=>!0}=e;if(!Number.isFinite(s)){n(new TypeError(`Expected a finite number, got ${typeof e.count}`));return}const c=[],o=[];let l=0,u=!1;const h=new Set,f=()=>(c.length===s&&(r(c),u=!0),l-o.length<s&&(n(new Cl(o)),u=!0),u),p=()=>{for(const S of t)!h.has(S)&&typeof S.cancel=="function"&&S.cancel()};i(p);for(const S of t)l++,(async()=>{try{const D=await S;if(u)return;if(!a(D))throw new Rl("Value does not satisfy filter");c.push(D)}catch(D){o.push(D)}finally{h.add(S),!u&&f()&&p()}})();s>l&&(n(new RangeError(`Expected input to contain at least ${e.count} items, but contains ${l} items`)),p())});var ua=bf,yf=Cl,vf=Rl;ua.AggregateError=yf,ua.FilterError=vf;var da=(t,e)=>{const r=ua(t,{...e,count:1});return vo.fn(async n=>{n(()=>{r.cancel()});const[i]=await r;return i})()},wf=ua.AggregateError;da.AggregateError=wf;var _f=t=>{const e=t._modules.peerRouting||[];return t._dht&&e.unshift(t._dht),{findPeer:async(r,n)=>{if(!e.length)throw U(new Error("No peer routers available"),"NO_ROUTERS_AVAILABLE");return da(e.map(async i=>{const s=await i.findPeer(r,n);if(!s||Object.keys(s).length===0)throw U(new Error("not found"),"NOT_FOUND");return s}))}}},Ef={NOT_STARTED_YET:"The libp2p node is not started yet",DHT_DISABLED:"DHT is not available",CONN_ENCRYPTION_REQUIRED:"At least one connection encryption module is required"},Sf={DHT_DISABLED:"ERR_DHT_DISABLED",PUBSUB_NOT_STARTED:"ERR_PUBSUB_NOT_STARTED",DHT_NOT_STARTED:"ERR_DHT_NOT_STARTED",CONN_ENCRYPTION_REQUIRED:"ERR_CONN_ENCRYPTION_REQUIRED",ERR_CONNECTION_ENDED:"ERR_CONNECTION_ENDED",ERR_CONNECTION_FAILED:"ERR_CONNECTION_FAILED",ERR_NODE_NOT_STARTED:"ERR_NODE_NOT_STARTED",ERR_ALREADY_ABORTED:"ERR_ALREADY_ABORTED",ERR_NO_VALID_ADDRESSES:"ERR_NO_VALID_ADDRESSES",ERR_DIALED_SELF:"ERR_DIALED_SELF",ERR_DISCOVERED_SELF:"ERR_DISCOVERED_SELF",ERR_DUPLICATE_TRANSPORT:"ERR_DUPLICATE_TRANSPORT",ERR_ENCRYPTION_FAILED:"ERR_ENCRYPTION_FAILED",ERR_HOP_REQUEST_FAILED:"ERR_HOP_REQUEST_FAILED",ERR_INVALID_KEY:"ERR_INVALID_KEY",ERR_INVALID_MESSAGE:"ERR_INVALID_MESSAGE",ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS",ERR_INVALID_PEER:"ERR_INVALID_PEER",ERR_MUXER_UNAVAILABLE:"ERR_MUXER_UNAVAILABLE",ERR_TIMEOUT:"ERR_TIMEOUT",ERR_TRANSPORT_UNAVAILABLE:"ERR_TRANSPORT_UNAVAILABLE",ERR_TRANSPORT_DIAL_FAILED:"ERR_TRANSPORT_DIAL_FAILED",ERR_UNSUPPORTED_PROTOCOL:"ERR_UNSUPPORTED_PROTOCOL",ERR_INVALID_MULTIADDR:"ERR_INVALID_MULTIADDR",ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"},lt={messages:Ef,codes:Sf};const Tf=async t=>{const e=[];for await(const r of t)e.push(r);return e};var Af=Tf;const{messages:wo,codes:_o}=lt;var Cf=t=>{const e=t._modules.contentRouting||[],r=t._dht;return r&&e.unshift(r),{async*findProviders(n,i){if(!e.length)throw U(new Error("No content routers available"),"NO_ROUTERS_AVAILABLE");const s=await da(e.map(async a=>{const c=await Af(a.findProviders(n,i));if(!c||!c.length)throw U(new Error("not found"),"NOT_FOUND");return c}));for(const a of s)yield a},async provide(n){if(!e.length)throw U(new Error("No content routers available"),"NO_ROUTERS_AVAILABLE");return Promise.all(e.map(i=>i.provide(n)))},async put(n,i,s){if(!t.isStarted()||!r.isStarted)throw U(new Error(wo.NOT_STARTED_YET),_o.DHT_NOT_STARTED);return r.put(n,i,s)},async get(n,i){if(!t.isStarted()||!r.isStarted)throw U(new Error(wo.NOT_STARTED_YET),_o.DHT_NOT_STARTED);return r.get(n,i)},async getMany(n,i,s){if(!t.isStarted()||!r.isStarted)throw U(new Error(wo.NOT_STARTED_YET),_o.DHT_NOT_STARTED);return r.getMany(n,i,s)}}};const If=gi,Eo=gi.v4,kl=gi.v6,Pl=function(t,e,r){r=~~r;var n;if(Eo(t))n=e||new Uint8Array(r+4),t.split(/\./g).map(function(u){n[r++]=parseInt(u,10)&255});else if(kl(t)){var i=t.split(":",8),s;for(s=0;s<i.length;s++){var a=Eo(i[s]),c;a&&(c=Pl(i[s]),i[s]=Ee(c.slice(0,2),"base16")),c&&++s<8&&i.splice(s,0,Ee(c.slice(2,4),"base16"))}if(i[0]==="")for(;i.length<8;)i.unshift("0");else if(i[i.length-1]==="")for(;i.length<8;)i.push("0");else if(i.length<8){for(s=0;s<i.length&&i[s]!=="";s++);var o=[s,"1"];for(s=9-i.length;s>0;s--)o.push("0");i.splice.apply(i,o)}for(n=e||new Uint8Array(r+16),s=0;s<i.length;s++){var l=parseInt(i[s],16);n[r++]=l>>8&255,n[r++]=l&255}}if(!n)throw Error("Invalid ip address: "+t);return n},Rf=function(t,e,r){e=~~e,r=r||t.length-e;var n=[],i;const s=new DataView(t.buffer);if(r===4){for(let a=0;a<r;a++)n.push(t[e+a]);i=n.join(".")}else if(r===16){for(let a=0;a<r;a+=2)n.push(s.getUint16(e+a).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i};var ha={isIP:If,isV4:Eo,isV6:kl,toBytes:Pl,toString:Rf};function kt(t){if(typeof t=="number"){if(kt.codes[t])return kt.codes[t];throw new Error("no protocol with code: "+t)}else if(typeof t=="string"||t instanceof String){if(kt.names[t])return kt.names[t];throw new Error("no protocol with name: "+t)}throw new Error("invalid protocol id type: "+t)}const Wt=-1;kt.lengthPrefixedVarSize=Wt,kt.V=Wt,kt.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Wt,"ip6zone"],[53,Wt,"dns","resolvable"],[54,Wt,"dns4","resolvable"],[55,Wt,"dns6","resolvable"],[56,Wt,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Wt,"unix",!1,"path"],[421,Wt,"ipfs"],[421,Wt,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Wt,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Wt,"memory"]],kt.names={},kt.codes={},kt.table.map(t=>{const e=Nl.apply(null,t);kt.codes[e.code]=e,kt.names[e.name]=e}),kt.object=Nl;function Nl(t,e,r,n,i){return{code:t,size:e,name:r,resolvable:Boolean(n),path:Boolean(i)}}var sr=kt,Ol=Cs;function Cs(t,e){return e instanceof Uint8Array?Cs.toString(t,e):Cs.toBytes(t,e)}Cs.toString=function(e,r){e=sr(e);switch(e.code){case 4:case 41:return kf(r);case 6:case 273:case 33:case 132:return Ml(r);case 53:case 54:case 55:case 56:case 400:case 777:return Nf(r);case 421:return Df(r);case 444:return xl(r);case 445:return xl(r);default:return Ee(r,"base16")}},Cs.toBytes=function(e,r){e=sr(e);switch(e.code){case 4:return Dl(r);case 41:return Dl(r);case 6:case 273:case 33:case 132:return So(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return Pf(r);case 421:return Of(r);case 444:return Mf(r);case 445:return xf(r);default:return $e(r,"base16")}};function Dl(t){if(!ha.isIP(t))throw new Error("invalid ip address");return ha.toBytes(t)}function kf(t){const e=ha.toString(t);if(!e||!ha.isIP(e))throw new Error("invalid ip address");return e}function So(t){const e=new ArrayBuffer(2),r=new DataView(e);return r.setUint16(0,t),new Uint8Array(e)}function Ml(t){const e=new DataView(t.buffer);return e.getUint16(0)}function Pf(t){const e=$e(t),r=Uint8Array.from(ge.encode(e.length));return Ze([r,e],r.length+e.length)}function Nf(t){const e=ge.decode(t);if(t=t.slice(ge.decode.bytes),t.length!==e)throw new Error("inconsistent lengths");return Ee(t)}function Of(t){const e=new aa(t).multihash,r=Uint8Array.from(ge.encode(e.length));return Ze([r,e],r.length+e.length)}function Df(t){const e=ge.decode(t),r=t.slice(ge.decode.bytes);if(r.length!==e)throw new Error("inconsistent lengths");return Ee(r,"base58btc")}function Mf(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==16)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion address.");const r=la.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=So(n);return Ze([r,i],r.length+i.length)}function xf(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==56)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion3 address.");const r=la.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=So(n);return Ze([r,i],r.length+i.length)}function xl(t){const e=t.slice(0,t.length-2),r=t.slice(t.length-2),n=Ee(e,"base32"),i=Ml(r);return n+":"+i}var ar={stringToStringTuples:Ll,stringTuplesToString:jl,tuplesToStringTuples:Ul,stringTuplesToTuples:Bl,bytesToTuples:To,tuplesToBytes:Fl,bytesToString:Lf,stringToBytes:Gl,fromString:jf,fromBytes:Vl,validateBytes:Ao,isValidBytes:Bf,cleanPath:pa,ParseError:Co,protoFromTuple:Is,sizeForAddr:ql};function Ll(t){const e=[],r=t.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let n=0;n<r.length;n++){const i=r[n],s=sr(i);if(s.size===0){e.push([i]);continue}if(n++,n>=r.length)throw Co("invalid address: "+t);if(s.path){e.push([i,pa(r.slice(n).join("/"))]);break}e.push([i,r[n]])}return e}function jl(t){const e=[];return t.map(r=>{const n=Is(r);e.push(n.name),r.length>1&&e.push(r[1])}),pa(e.join("/"))}function Bl(t){return t.map(e=>{Array.isArray(e)||(e=[e]);const r=Is(e);return e.length>1?[r.code,Ol.toBytes(r.code,e[1])]:[r.code]})}function Ul(t){return t.map(e=>{const r=Is(e);return e.length>1?[r.code,Ol.toString(r.code,e[1])]:[r.code]})}function Fl(t){return Vl(Ze(t.map(e=>{const r=Is(e);let n=Uint8Array.from(ge.encode(r.code));return e.length>1&&(n=Ze([n,e[1]])),n})))}function ql(t,e){if(t.size>0)return t.size/8;if(t.size===0)return 0;{const r=ge.decode(e);return r+ge.decode.bytes}}function To(t){const e=[];let r=0;for(;r<t.length;){const n=ge.decode(t,r),i=ge.decode.bytes,s=sr(n),a=ql(s,t.slice(r+i));if(a===0){e.push([n]),r+=i;continue}const c=t.slice(r+i,r+i+a);if(r+=a+i,r>t.length)throw Co("Invalid address Uint8Array: "+Ee(t,"base16"));e.push([n,c])}return e}function Lf(t){const e=To(t),r=Ul(e);return jl(r)}function Gl(t){t=pa(t);const e=Ll(t),r=Bl(e);return Fl(r)}function jf(t){return Gl(t)}function Vl(t){const e=Ao(t);if(e)throw e;return Uint8Array.from(t)}function Ao(t){try{To(t)}catch(e){return e}}function Bf(t){return Ao(t)===void 0}function pa(t){return"/"+t.trim().split("/").filter(e=>e).join("/")}function Co(t){return new Error("Error parsing address: "+t)}function Is(t){const e=sr(t[0]);return e}var Fe=re(function(t,e){const r=Symbol.for("nodejs.util.inspect.custom"),n=new Map,i=br.proto(function(s){if(!(this instanceof i))return new i(s);if(s==null&&(s=""),s instanceof Uint8Array)this.bytes=ar.fromBytes(s);else if(typeof s=="string"||s instanceof String){if(s.length>0&&s.charAt(0)!=="/")throw new Error(`multiaddr "${s}" must start with a "/"`);this.bytes=ar.fromString(s)}else if(s.bytes&&s.protos&&s.protoCodes)this.bytes=ar.fromBytes(s.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});i.prototype.toString=function(){return ar.bytesToString(this.bytes)},i.prototype.toJSON=i.prototype.toString,i.prototype.toOptions=function(){const a={},c=this.toString().split("/");return a.family=c[1]==="ip4"?"ipv4":"ipv6",a.host=c[2],a.transport=c[3],a.port=parseInt(c[4]),a},i.prototype[r]=function(){return"<Multiaddr "+Ee(this.bytes,"base16")+" - "+ar.bytesToString(this.bytes)+">"},i.prototype.inspect=function(){return"<Multiaddr "+Ee(this.bytes,"base16")+" - "+ar.bytesToString(this.bytes)+">"},i.prototype.protos=function(){return this.protoCodes().map(a=>Object.assign({},sr(a)))},i.prototype.protoCodes=function(){const a=[],c=this.bytes;let o=0;for(;o<c.length;){const l=ge.decode(c,o),u=ge.decode.bytes,h=sr(l),f=ar.sizeForAddr(h,c.slice(o+u));o+=f+u,a.push(l)}return a},i.prototype.protoNames=function(){return this.protos().map(a=>a.name)},i.prototype.tuples=function(){return ar.bytesToTuples(this.bytes)},i.prototype.stringTuples=function(){const a=ar.bytesToTuples(this.bytes);return ar.tuplesToStringTuples(a)},i.prototype.encapsulate=function(a){return a=i(a),i(this.toString()+a.toString())},i.prototype.decapsulate=function(a){a=a.toString();const c=this.toString(),o=c.lastIndexOf(a);if(o<0)throw new Error("Address "+this+" does not contain subaddress: "+a);return i(c.slice(0,o))},i.prototype.decapsulateCode=function(a){const c=this.tuples();for(let o=c.length-1;o>=0;o--)if(c[o][0]===a)return i(ar.tuplesToBytes(c.slice(0,o)));return this},i.prototype.getPeerId=function(){let a=null;try{const c=this.stringTuples().filter(o=>{if(o[0]===sr.names.ipfs.code)return!0});a=c.pop()[1],a=Ee(new aa(a).multihash,"base58btc")}catch(c){a=null}return a},i.prototype.getPath=function(){let a=null;try{a=this.stringTuples().filter(c=>{const o=sr(c[0]);if(o.path)return!0})[0][1]}catch(c){a=null}return a},i.prototype.equals=function(a){return Nr(this.bytes,a.bytes)},i.prototype.resolve=async function(){const a=this.protos().find(l=>l.resolvable);if(!a)return[this];const c=n.get(a.name);if(!c)throw U(new Error(`no available resolver for ${a.name}`),"ERR_NO_AVAILABLE_RESOLVER");const o=await c(this);return o.map(l=>i(l))},i.prototype.nodeAddress=function(){const a=this.protoCodes(),c=this.protoNames(),o=this.toString().split("/").slice(1);if(o.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(a[0]!==4&&a[0]!==41&&a[0]!==54&&a[0]!==55)throw new Error(`no protocol with name: "'${c[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(o[2]!=="tcp"&&o[2]!=="udp")throw new Error(`no protocol with name: "'${c[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:a[0]===41||a[0]===55?6:4,address:o[1],port:parseInt(o[3])}},i.fromNodeAddress=function(a,c){if(!a)throw new Error("requires node address object");if(!c)throw new Error("requires transport protocol");let o;switch(a.family){case"IPv4":o="ip4";break;case"IPv6":o="ip6";break;default:throw Error(`Invalid addr family. Got '${a.family}' instead of 'IPv4' or 'IPv6'`)}return i("/"+[o,a.address,c,a.port].join("/"))},i.prototype.isThinWaistAddress=function(a){const c=(a||this).protos();return c.length!==2||c[0].code!==4&&c[0].code!==41?!1:!(c[1].code!==6&&c[1].code!==273)},i.protocols=sr,i.isName=function(a){return i.isMultiaddr(a)?a.protos().some(c=>c.resolvable):!1},i.resolve=function(a){return!i.isMultiaddr(a)||!i.isName(a)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},i.resolvers=n,e=t.exports=i});const{codes:Uf}=lt;function Ff(t){typeof t=="string"&&(t=Fe(t));let e;if(Fe.isMultiaddr(t)){e=t;try{t=pe.createFromB58String(t.getPeerId())}catch(r){throw U(new Error(`${t} is not a valid peer type`),Uf.ERR_INVALID_MULTIADDR)}}return{id:t,multiaddrs:e?[e]:void 0}}var fa=Ff,qf=$l,an=$l.prototype,Gf=new Date%1e9;function Vf(){return(Math.random()*1e9>>>0)+Gf++}function $l(t){t=t||{},this.id=t.id||Vf(),this.max=t.max||Infinity,this.items=t.items||[],this._lookup={},this.size=this.items.length,this.lastModified=new Date(t.lastModified||new Date);for(var e,r,n=this.items.length;n--;)e=this.items[n],r=new Date(e.expires)-new Date,this._lookup[e.key]=e,r>0?this.expire(e.key,r):r<=0&&this.delete(e.key)}an.has=function(t){return t in this._lookup},an.get=function(t){if(!this.has(t))return null;var e=this._lookup[t];return e.refresh&&this.expire(t,e.refresh),this.items.splice(this.items.indexOf(e),1),this.items.push(e),e.value},an.meta=function(t){if(!this.has(t))return null;var e=this._lookup[t];return"meta"in e?e.meta:null},an.set=function(t,e,r){var n=this._lookup[t],i=this._lookup[t]={key:t,value:e};return this.lastModified=new Date,n?(clearTimeout(n.timeout),this.items.splice(this.items.indexOf(n),1,i)):(this.size>=this.max&&this.delete(this.items[0].key),this.items.push(i),this.size++),r&&("ttl"in r&&this.expire(t,r.ttl),"meta"in r&&(i.meta=r.meta),r.refresh&&(i.refresh=r.ttl)),this},an.delete=function(t){var e=this._lookup[t];return e?(this.lastModified=new Date,this.items.splice(this.items.indexOf(e),1),clearTimeout(e.timeout),delete this._lookup[t],this.size--,this):!1},an.expire=function(t,e){var r=e||0,n=this._lookup[t];if(!n)return this;if(typeof r=="string"&&(r=oa(e)),typeof r!="number")throw new TypeError("Expiration time must be a string or number.");return clearTimeout(n.timeout),n.timeout=setTimeout(this.delete.bind(this,n.key),r),n.expires=Number(new Date)+r,this},an.clear=function(){for(var t=this.items.length;t--;)this.delete(this.items[t].key);return this},an.toJSON=function(){for(var t=new Array(this.items.length),e,r=t.length;r--;)e=this.items[r],t[r]={key:e.key,meta:e.meta,value:e.value,expires:e.expires,refresh:e.refresh};return{id:this.id,max:isFinite(this.max)?this.max:void 0,lastModified:this.lastModified,items:t}};var Hl=Object.prototype.toString,zl=function(e){var r=Hl.call(e),n=r==="[object Arguments]";return n||(n=r!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Hl.call(e.callee)==="[object Function]"),n},Kl;if(!Object.keys){var ma=Object.prototype.hasOwnProperty,Wl=Object.prototype.toString,$f=zl,Xl=Object.prototype.propertyIsEnumerable,Hf=!Xl.call({toString:null},"toString"),zf=Xl.call(function(){},"prototype"),ga=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Io=function(t){var e=t.constructor;return e&&e.prototype===t},Kf={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Wf=function(){if(typeof window=="undefined")return!1;for(var t in window)try{if(!Kf["$"+t]&&ma.call(window,t)&&window[t]!==null&&typeof window[t]=="object")try{Io(window[t])}catch(e){return!0}}catch(e){return!0}return!1}(),Xf=function(t){if(typeof window=="undefined"||!Wf)return Io(t);try{return Io(t)}catch(e){return!1}};Kl=function(e){var r=e!==null&&typeof e=="object",n=Wl.call(e)==="[object Function]",i=$f(e),s=r&&Wl.call(e)==="[object String]",a=[];if(!r&&!n&&!i)throw new TypeError("Object.keys called on a non-object");var c=zf&&n;if(s&&e.length>0&&!ma.call(e,0))for(var o=0;o<e.length;++o)a.push(String(o));if(i&&e.length>0)for(var l=0;l<e.length;++l)a.push(String(l));else for(var u in e)!(c&&u==="prototype")&&ma.call(e,u)&&a.push(String(u));if(Hf)for(var h=Xf(e),f=0;f<ga.length;++f)!(h&&ga[f]==="constructor")&&ma.call(e,ga[f])&&a.push(ga[f]);return a}}var Qf=Kl,Yf=Array.prototype.slice,Ql=Object.keys,ba=Ql?function(e){return Ql(e)}:Qf,Yl=Object.keys;ba.shim=function(){if(Object.keys){var e=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);e||(Object.keys=function(n){return zl(n)?Yl(Yf.call(n)):Yl(n)})}else Object.keys=ba;return Object.keys||ba};var Jf=ba,Zf=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",em=Object.prototype.toString,tm=Array.prototype.concat,Ro=Object.defineProperty,rm=function(t){return typeof t=="function"&&em.call(t)==="[object Function]"},nm=function(){var t={};try{Ro(t,"x",{enumerable:!1,value:t});for(var e in t)return!1;return t.x===t}catch(r){return!1}},Jl=Ro&&nm(),im=function(t,e,r,n){if(e in t&&(!rm(n)||!n()))return;Jl?Ro(t,e,{configurable:!0,enumerable:!1,value:r,writable:!0}):t[e]=r},Zl=function(t,e){var r=arguments.length>2?arguments[2]:{},n=Jf(e);Zf&&(n=tm.call(n,Object.getOwnPropertySymbols(e)));for(var i=0;i<n.length;i+=1)im(t,n[i],e[n[i]],r[n[i]])};Zl.supportsDescriptors=!!Jl;var eu=Zl,tu=re(function(t){typeof self!="undefined"?t.exports=self:typeof window!="undefined"?t.exports=window:t.exports=Function("return this")()}),ko=function(){return typeof ie!="object"||!ie||ie.Math!==Math||ie.Array!==Array?tu:ie},sm=function(){var e=ko();if(eu.supportsDescriptors){var r=Object.getOwnPropertyDescriptor(e,"globalThis");(!r||r.configurable&&(r.enumerable||r.writable||globalThis!==e))&&Object.defineProperty(e,"globalThis",{configurable:!0,enumerable:!1,value:e,writable:!1})}else(typeof globalThis!="object"||globalThis!==e)&&(e.globalThis=e);return e},am=ko(),ru=function(){return am};eu(ru,{getPolyfill:ko,implementation:tu,shim:sm});var om=ru,cm=re(function(t){const e=om();e.fetch&&e.Headers&&e.Request&&e.Response?(t.exports=function(...n){return e.fetch(...n)},t.exports.Headers=e.Headers,t.exports.Request=e.Request,t.exports.Response=e.Response,t.exports.default=t.exports):t.exports=df});const{default:lm,Headers:um}=cm;function dm({serverResolver:t,hostname:e,recordType:r}){return`${t}?name=${e}&type=${r}`}var hm=dm;function pm(t){return lm(t,{headers:new um({accept:"application/dns-json"})})}var fm=pm;function mm(t,e){return`${e}_${t}`}var gm=mm,bm={buildResource:hm,fetch:fm,getCacheKey:gm};const ya=Q("dns-over-http-resolver");ya.error=Q("dns-over-http-resolver:error");const{buildResource:Po,fetch:No,getCacheKey:bi}=bm;class Oo{constructor({maxCache:t=100}={}){this._cache=new qf({max:t}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"]}getServers(){return this._servers}_getShuffledServers(){const t=[].concat(this._servers);for(let e=t.length-1;e>0;e--){const r=Math.floor(Math.random()*e),n=t[e];t[e]=t[r],t[r]=n}return t}setServers(t){this._servers=t}resolve(t,e="A"){switch(e){case"A":return this.resolve4(t);case"AAAA":return this.resolve6(t);case"TXT":return this.resolveTxt(t);default:throw new Error(`${e} is not supported`)}}async resolve4(t){const e="A",r=this._cache.get(bi(t,e));if(r)return r;for(const n of this._getShuffledServers())try{const i=await No(Po({serverResolver:n,hostname:t,recordType:e})),s=await i.json(),a=s.Answer.map(o=>o.data),c=Math.min(s.Answer.map(o=>o.TTL));return this._cache.set(bi(t,e),a,{ttl:c}),a}catch(i){ya.error(`${n} could not resolve ${t} record ${e}`)}throw new Error(`Could not resolve ${t} record ${e}`)}async resolve6(t){const e="AAAA",r=this._cache.get(bi(t,e));if(r)return r;for(const n of this._getShuffledServers())try{const i=await No(Po({serverResolver:n,hostname:t,recordType:e})),s=await i.json(),a=s.Answer.map(o=>o.data),c=Math.min(s.Answer.map(o=>o.TTL));return this._cache.set(bi(t,e),a,{ttl:c}),a}catch(i){ya.error(`${n} could not resolve ${t} record ${e}`)}throw new Error(`Could not resolve ${t} record ${e}`)}async resolveTxt(t){const e="TXT",r=this._cache.get(bi(t,e));if(r)return r;for(const n of this._getShuffledServers())try{const i=await No(Po({serverResolver:n,hostname:t,recordType:e})),s=await i.json(),a=s.Answer.map(o=>[o.data.replace(/['"]+/g,"")]),c=Math.min(s.Answer.map(o=>o.TTL));return this._cache.set(bi(t,e),a,{ttl:c}),a}catch(i){ya.error(`${n} could not resolve ${t} record ${e}`)}throw new Error(`Could not resolve ${t} record ${e}`)}}Oo.Resolver=Oo;var ym=Oo;let va;try{if(va=go.promises,!va)throw new Error("no dns available")}catch(t){va=ym}var vm=va;const{code:wm}=sr("dnsaddr");async function _m(t){const{Resolver:e}=vm,r=new e,n=t.getPeerId(),[,i]=t.stringTuples().find(([c])=>c===wm)||[],s=await r.resolveTxt(`_dnsaddr.${i}`);let a=s.flat().map(c=>c.split("=")[1]);return n&&(a=a.filter(c=>c.includes(n))),a}var Em={dnsaddrResolver:_m},Rs={DIAL_TIMEOUT:3e4,MAX_PARALLEL_DIALS:100,MAX_PER_PEER_DIALS:4,METRICS:{computeThrottleMaxQueueSize:1e3,computeThrottleTimeout:2e3,movingAverageIntervals:[60*1e3,5*60*1e3,15*60*1e3],maxOldPeersRetention:50}};const Sm="libp2p",Tm="0.29.4",Am="JavaScript implementation of libp2p, a modular peer to peer network stack",Cm="Jacob Heun <jacobheun@gmail.com>",Im="src/index.js",Rm=["dist","src"],km={lint:"aegir lint",build:"aegir build",test:"npm run test:node && npm run test:browser","test:node":'aegir test -t node -f "./test/**/*.{node,spec}.js"',"test:browser":"aegir test -t browser",release:"aegir release -t node -t browser","release-minor":"aegir release --type minor -t node -t browser","release-major":"aegir release --type major -t node -t browser",coverage:"nyc --reporter=text --reporter=lcov npm run test:node"},Pm={type:"git",url:"https://github.com/libp2p/js-libp2p.git"},Nm=["libp2p","network","p2p","peer","peer-to-peer","IPFS"],Om={url:"https://github.com/libp2p/js-libp2p/issues"},Dm="https://libp2p.io",Mm="MIT",xm={node:">=12.0.0",npm:">=6.0.0"},Lm={"abort-controller":"^3.0.0","aggregate-error":"^3.0.1","any-signal":"^1.1.0","bignumber.js":"^9.0.0","class-is":"^1.1.0",debug:"^4.1.1","err-code":"^2.0.0",events:"^3.1.0",hashlru:"^2.3.0","interface-datastore":"^2.0.0","ipfs-utils":"^2.2.0","it-all":"^1.0.1","it-buffer":"^0.1.2","it-handshake":"^1.0.1","it-length-prefixed":"^3.0.1","it-pipe":"^1.1.0","it-protocol-buffers":"^0.2.0","libp2p-crypto":"^0.18.0","libp2p-interfaces":"^0.5.1","libp2p-utils":"^0.2.0",mafmt:"^8.0.0","merge-options":"^2.0.0","moving-average":"^1.0.0",multiaddr:"^8.1.0",multicodec:"^2.0.0","multistream-select":"^1.0.0","mutable-proxy":"^1.0.0","node-forge":"^0.9.1","p-any":"^3.0.0","p-fifo":"^1.0.0","p-settle":"^4.0.1","peer-id":"^0.14.2",protons:"^2.0.0",retimer:"^2.0.0","sanitize-filename":"^1.6.3","streaming-iterables":"^5.0.2","timeout-abort-controller":"^1.1.1",varint:"^5.0.0",xsalsa20:"^1.0.2"},jm={"@nodeutils/defaults-deep":"^1.1.0","abortable-iterator":"^3.0.0",aegir:"^27.0.0",chai:"^4.2.0","chai-as-promised":"^7.1.1","chai-bytes":"^0.1.2","chai-string":"^1.5.0",cids:"^1.0.0",delay:"^4.3.0","dirty-chai":"^2.0.1","interop-libp2p":"^0.3.0","ipfs-http-client":"^47.0.1","it-concat":"^1.0.0","it-pair":"^1.0.0","it-pushable":"^1.4.0",libp2p:".","libp2p-bootstrap":"^0.12.0","libp2p-delegated-content-routing":"^0.7.0","libp2p-delegated-peer-routing":"^0.7.0","libp2p-floodsub":"^0.23.0","libp2p-gossipsub":"^0.6.0","libp2p-kad-dht":"^0.20.0","libp2p-mdns":"^0.15.0","libp2p-mplex":"^0.10.1","libp2p-noise":"^2.0.0","libp2p-secio":"^0.13.1","libp2p-tcp":"^0.15.1","libp2p-webrtc-star":"^0.20.0","libp2p-websockets":"^0.14.0",multihashes:"^3.0.1",nock:"^13.0.3","p-defer":"^3.0.0","p-times":"^3.0.0","p-wait-for":"^3.1.0","promisify-es6":"^1.0.3",rimraf:"^3.0.2",sinon:"^9.0.2",uint8arrays:"^1.1.0"},Bm=["David Dias <daviddias.p@gmail.com>","Jacob Heun <jacobheun@gmail.com>","Vasco Santos <vasco.santos@moxy.studio>","Alan Shaw <alan@tableflip.io>","Alex Potsides <alex@achingbrain.net>","Cayman <caymannava@gmail.com>","Pedro Teixeira <i@pgte.me>","Friedel Ziegelmayer <dignifiedquire@gmail.com>","Maciej Kr\xFCger <mkg20001@gmail.com>","Hugo Dias <mail@hugodias.me>","dirkmc <dirkmdev@gmail.com>","Volker Mische <volker.mische@gmail.com>","Richard Littauer <richard.littauer@gmail.com>","a1300 <matthias-knopp@gmx.net>","Elven <mon.samuel@qq.com>","Andrew Nesbitt <andrewnez@gmail.com>","Giovanni T. Parra <fiatjaf@gmail.com>","Ryan Bell <ryan@piing.net>","Thomas Eizinger <thomas@eizinger.io>","\u1D20\u026A\u1D04\u1D1B\u1D0F\u0280 \u0299\u1D0A\u1D07\u029F\u1D0B\u029C\u1D0F\u029F\u1D0D <victorbjelkholm@gmail.com>","Didrik Nordstr\xF6m <didrik@betamos.se>","Irakli Gozalishvili <rfobic@gmail.com>","Ethan Lam <elmemphis2000@gmail.com>","Joel Gustafson <joelg@mit.edu>","Julien Bouquillon <contact@revolunet.com>","Kevin Kwok <antimatter15@gmail.com>","Nuno Nogueira <nunofmn@gmail.com>","Dmitriy Ryajov <dryajov@gmail.com>","RasmusErik Voel Jensen <github@solsort.com>","Diogo Silva <fsdiogo@gmail.com>","Samlior <samlior@foxmail.com>","Smite Chow <xiaopengyou@live.com>","Soeren <nikorpoulsen@gmail.com>","S\xF6nke Hahn <soenkehahn@gmail.com>","robertkiel <robert.kiel@validitylabs.org>","Tiago Alves <alvesjtiago@gmail.com>","Daijiro Wachi <daijiro.wachi@gmail.com>","Yusef Napora <yusef@napora.org>","Zane Starr <zcstarr@gmail.com>","Cindy Wu <ciindy.wu@gmail.com>","Chris Bratlien <chrisbratlien@gmail.com>","ebinks <elizabethjbinks@gmail.com>","Bernd Strehl <bernd.strehl@gmail.com>","Florian-Merle <florian.david.merle@gmail.com>","Francis Gulotta <wizard@roborooter.com>","Felipe Martins <felipebrasil93@gmail.com>","isan_rivkin <isanrivkin@gmail.com>","Henrique Dias <hacdias@gmail.com>","Fei Liu <liu.feiwood@gmail.com>"];var Um={name:Sm,version:Tm,description:Am,leadMaintainer:Cm,main:Im,files:Rm,scripts:km,repository:Pm,keywords:Nm,bugs:Om,homepage:Dm,license:Mm,engines:xm,dependencies:Lm,devDependencies:jm,contributors:Bm};const Fm=Um.version;var qm="ipfs/0.1.0",Gm=`js-libp2p/${Fm}`,Vm="/ipfs/id/1.0.0",$m="/ipfs/id/push/1.0.0",nu={PROTOCOL_VERSION:qm,AGENT_VERSION:Gm,MULTICODEC_IDENTIFY:Vm,MULTICODEC_IDENTIFY_PUSH:$m};const iu=async t=>{try{const e=await t;return{isFulfilled:!0,isRejected:!1,value:e}}catch(e){return{isFulfilled:!1,isRejected:!0,reason:e}}};var wa=iu,Hm=iu;wa.default=Hm;const su=(t,...e)=>new Promise(r=>{r(t(...e))});var au=su,zm=su;au.default=zm;const ou=t=>{if(!((Number.isInteger(t)||t===Infinity)&&t>0))return Promise.reject(new TypeError("Expected `concurrency` to be a number from 1 and up"));const e=[];let r=0;const n=()=>{r--,e.length>0&&e.shift()()},i=(c,o,...l)=>{r++;const u=au(c,...l);o(u),u.then(n,n)},s=(c,o,...l)=>{r<t?i(c,o,...l):e.push(i.bind(null,c,o,...l))},a=(c,...o)=>new Promise(l=>s(c,l,...o));return Object.defineProperties(a,{activeCount:{get:()=>r},pendingCount:{get:()=>e.length},clearQueue:{value:()=>{e.length=0}}}),a};var cu=ou,Km=ou;cu.default=Km;var Wm=async(t,e={})=>{const{concurrency:r=Infinity}=e,n=cu(r);return Promise.all(t.map(i=>i&&typeof i.then=="function"?wa(i):typeof i=="function"?wa(n(()=>i())):wa(Promise.resolve(i))))};const{codes:yi}=lt,on=Q("libp2p:transports");on.error=Q("libp2p:transports:error");class lu{constructor({libp2p:t,upgrader:e,faultTolerance:r=Do.FATAL_ALL}){this.libp2p=t,this.upgrader=e,this._transports=new Map,this._listeners=new Map,this._listenerOptions=new Map,this.faultTolerance=r}add(t,e,r={}){if(on("adding %s",t),!t)throw U(new Error(`Transport must have a valid key, was given '${t}'`),yi.ERR_INVALID_KEY);if(this._transports.has(t))throw U(new Error("There is already a transport with this key"),yi.ERR_DUPLICATE_TRANSPORT);const n=new e({...r,libp2p:this.libp2p,upgrader:this.upgrader});this._transports.set(t,n),this._listenerOptions.set(t,r.listenerOptions||{}),this._listeners.has(t)||this._listeners.set(t,[])}async close(){const t=[];for(const[e,r]of this._listeners)for(on("closing listeners for %s",e);r.length;){const n=r.pop();t.push(n.close())}await Promise.all(t),on("all listeners closed");for(const e of this._listeners.keys())this._listeners.set(e,[])}async dial(t,e){const r=this.transportForMultiaddr(t);if(!r)throw U(new Error(`No transport available for address ${String(t)}`),yi.ERR_TRANSPORT_UNAVAILABLE);try{return await r.dial(t,e)}catch(n){throw n.code||(n.code=yi.ERR_TRANSPORT_DIAL_FAILED),n}}getAddrs(){let t=[];for(const e of this._listeners.values())for(const r of e)t=[...t,...r.getAddrs()];return t}getTransports(){return this._transports.values()}transportForMultiaddr(t){for(const e of this._transports.values()){const r=e.filter([t]);if(r.length)return e}return null}async listen(){const t=this.libp2p.addressManager.getListenAddrs();if(t.length===0){on("no addresses were provided for listening, this node is dial only");return}const e=[];for(const[r,n]of this._transports.entries()){const i=n.filter(t),s=[];for(const o of i){on("creating listener for %s on %s",r,o);const l=n.createListener(this._listenerOptions.get(r),this.onConnection);this._listeners.get(r).push(l),s.push(l.listen(o))}if(s.length===0){e.push(r);continue}const a=await Wm(s),c=a.find(o=>o.isFulfilled===!0);if(!c)throw U(new Error(`Transport (${r}) could not listen on any available address`),yi.ERR_NO_VALID_ADDRESSES)}if(e.length===this._transports.size){const r=`no valid addresses were provided for transports [${e}]`;if(this.faultTolerance===Do.FATAL_ALL)throw U(new Error(r),yi.ERR_NO_VALID_ADDRESSES);on(`libp2p in dial mode only: ${r}`)}}async remove(t){if(on("removing %s",t),this._listeners.has(t))for(const e of this._listeners.get(t))await e.close();this._transports.delete(t),this._listeners.delete(t)}async removeAll(){const t=[];for(const e of this._transports.keys())t.push(this.remove(e));await Promise.all(t)}}const Do={FATAL_ALL:0,NO_FATAL:1};lu.FaultTolerance=Do;var uu=lu;const{dnsaddrResolver:Xm}=Em,{AGENT_VERSION:Qm}=nu,{FaultTolerance:Ym}=uu,Jm={addresses:{listen:[],announce:[],noAnnounce:[]},connectionManager:{minConnections:25},transportManager:{faultTolerance:Ym.FATAL_ALL},dialer:{maxParallelDials:Rs.MAX_PARALLEL_DIALS,maxDialsPerPeer:Rs.MAX_PER_PEER_DIALS,dialTimeout:Rs.DIAL_TIMEOUT,resolvers:{dnsaddr:Xm}},host:{agentVersion:Qm},metrics:{enabled:!1},peerStore:{persistence:!1,threshold:5},config:{dht:{enabled:!1,kBucketSize:20,randomWalk:{enabled:!1,queriesPerPeriod:1,interval:3e5,timeout:1e4}},peerDiscovery:{autoDial:!0},pubsub:{enabled:!0,emitSelf:!0,signMessages:!0,strictSigning:!0},relay:{enabled:!0,hop:{enabled:!1,active:!1}},transport:{}}};var Zm=t=>{if(t=ca(Jm,t),t.modules.transport.length<1)throw new Error("'options.modules.transport' must contain at least 1 transport");return t},eg={validate:Zm};const tg=Q("libp2p:addresses");tg.error=Q("libp2p:addresses:error");class rg{constructor({listen:t=[],announce:e=[],noAnnounce:r=[]}={}){this.listen=new Set(t),this.announce=new Set(e),this.noAnnounce=new Set(r)}getListenAddrs(){return Array.from(this.listen).map(t=>Fe(t))}getAnnounceAddrs(){return Array.from(this.announce).map(t=>Fe(t))}getNoAnnounceAddrs(){return Array.from(this.noAnnounce).map(t=>Fe(t))}}var ng=rg;const Mo=Q("latency-monitor:VisibilityChangeEmitter");var ig=class extends _t{constructor(){super();if(typeof document=="undefined"){Mo('This is not a browser, no "document" found. Stopping.');return}this._initializeVisibilityVarNames(),this._addVisibilityChangeListener()}_initializeVisibilityVarNames(){let e,r;typeof document.hidden!="undefined"?(e="hidden",r="visibilitychange"):typeof document.mozHidden!="undefined"?(e="mozHidden",r="mozvisibilitychange"):typeof document.msHidden!="undefined"?(e="msHidden",r="msvisibilitychange"):typeof document.webkitHidden!="undefined"&&(e="webkitHidden",r="webkitvisibilitychange"),this._hidden=e,this._visibilityChange=r}_addVisibilityChangeListener(){typeof document.addEventListener=="undefined"||typeof document[this._hidden]=="undefined"?Mo("Checking page visibility requires a browser that supports the Page Visibility API."):document.addEventListener(this._visibilityChange,this._handleVisibilityChange.bind(this),!1)}isVisible(){return this._hidden===void 0||document[this._hidden]===void 0?void 0:!document[this._hidden]}_handleVisibilityChange(){const e=!document[this._hidden];Mo(e?"Page Visible":"Page Hidden"),this.emit("visibilityChange",e)}};const Or=Q("latency-monitor:LatencyMonitor");class sg extends _t{constructor({latencyCheckIntervalMs:t,dataEmitIntervalMs:e,asyncTestFn:r,latencyRandomPercentage:n}={}){super();const i=this;i.latencyCheckIntervalMs=t||500,i.latencyRandomPercentage=n||10,i._latecyCheckMultiply=2*(i.latencyRandomPercentage/100)*i.latencyCheckIntervalMs,i._latecyCheckSubtract=i._latecyCheckMultiply/2,i.dataEmitIntervalMs=e===null||e===0?void 0:e||5*1e3,Or("latencyCheckIntervalMs: %s dataEmitIntervalMs: %s",i.latencyCheckIntervalMs,i.dataEmitIntervalMs),i.dataEmitIntervalMs?Or("Expecting ~%s events per summary",i.latencyCheckIntervalMs/i.dataEmitIntervalMs):Or("Not emitting summaries"),i.asyncTestFn=r,Ln.process&&Ln.process.hrtime?(Or("Using process.hrtime for timing"),i.now=Ln.process.hrtime,i.getDeltaMS=s=>{const a=i.now(s);return a[0]*1e3+a[1]/1e6}):typeof window!="undefined"&&window.performance&&window.performance.now?(Or("Using performance.now for timing"),i.now=window.performance.now.bind(window.performance),i.getDeltaMS=s=>Math.round(i.now()-s)):(Or("Using Date.now for timing"),i.now=Date.now,i.getDeltaMS=s=>i.now()-s),i._latencyData=i._initLatencyData(),ag()&&(i._visibilityChangeEmitter=new ig,i._visibilityChangeEmitter.on("visibilityChange",s=>{s?i._startTimers():(i._emitSummary(),i._stopTimers())})),(!i._visibilityChangeEmitter||i._visibilityChangeEmitter.isVisible())&&i._startTimers()}_startTimers(){if(this._checkLatencyID)return;this._checkLatency(),this.dataEmitIntervalMs&&(this._emitIntervalID=setInterval(()=>this._emitSummary(),this.dataEmitIntervalMs),typeof this._emitIntervalID.unref=="function"&&this._emitIntervalID.unref())}_stopTimers(){this._checkLatencyID&&(clearTimeout(this._checkLatencyID),this._checkLatencyID=void 0),this._emitIntervalID&&(clearInterval(this._emitIntervalID),this._emitIntervalID=void 0)}_emitSummary(){const t=this.getSummary();t.events>0&&this.emit("data",t)}getSummary(){const t={events:this._latencyData.events,minMs:this._latencyData.minMs,maxMs:this._latencyData.maxMs,avgMs:this._latencyData.events?this._latencyData.totalMs/this._latencyData.events:Number.POSITIVE_INFINITY,lengthMs:this.getDeltaMS(this._latencyData.startTime)};return this._latencyData=this._initLatencyData(),Or("Summary: %O",t),t}_checkLatency(){const t=this,e=Math.random()*t._latecyCheckMultiply-t._latecyCheckSubtract,r={deltaOffset:Math.ceil(t.latencyCheckIntervalMs+e),startTime:t.now()},n=()=>{if(!this._checkLatencyID)return;const i=t.getDeltaMS(r.startTime)-r.deltaOffset;t._checkLatency(),t._latencyData.events++,t._latencyData.minMs=Math.min(t._latencyData.minMs,i),t._latencyData.maxMs=Math.max(t._latencyData.maxMs,i),t._latencyData.totalMs+=i,Or("MS: %s Data: %O",i,t._latencyData)};Or("localData: %O",r),this._checkLatencyID=setTimeout(()=>{t.asyncTestFn?(r.deltaOffset=0,r.startTime=t.now(),t.asyncTestFn(n)):(r.deltaOffset-=1,n())},r.deltaOffset),typeof this._checkLatencyID.unref=="function"&&this._checkLatencyID.unref()}_initLatencyData(){return{startTime:this.now(),minMs:Number.POSITIVE_INFINITY,maxMs:Number.NEGATIVE_INFINITY,events:0,totalMs:0}}}function ag(){return typeof window!="undefined"}var og=sg,xo=function(){return Date.now()};function Lo(t,e,r){var n=this;this._started=xo(),this._rescheduled=0,this._scheduled=e,this._args=r,this._timer=setTimeout(i,e);function i(){n._rescheduled>0?(n._scheduled=n._rescheduled-(xo()-n._started),n._timer=setTimeout(i,n._scheduled),n._rescheduled=0):t.apply(null,n._args)}}Lo.prototype.reschedule=function(t){var e=xo();return e+t-(this._started+this._scheduled)<0?!1:(this._started=e,this._rescheduled=t,!0)},Lo.prototype.clear=function(){clearTimeout(this._timer)};function cg(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("timeout needed");var t;if(arguments.length>0){t=new Array(arguments.length-2);for(var e=0;e<t.length;e++)t[e]=arguments[e+2]}return new Lo(arguments[0],arguments[1],t)}var jn=cg;const Xt=Q("libp2p:connection-manager");Xt.error=Q("libp2p:connection-manager:error");const{EventEmitter:lg}=_t,{ERR_INVALID_PARAMETERS:du}=lt,ug={maxConnections:Infinity,minConnections:0,maxData:Infinity,maxSentData:Infinity,maxReceivedData:Infinity,maxEventLoopDelay:Infinity,pollInterval:2e3,autoDialInterval:1e4,movingAverageInterval:6e4,defaultPeerValue:1};class dg extends lg{constructor(t,e){super();if(this._libp2p=t,this._peerId=t.peerId.toB58String(),this._options=ca.call({ignoreUndefined:!0},ug,e),this._options.maxConnections<this._options.minConnections)throw U(new Error("Connection Manager maxConnections must be greater than minConnections"),du);Xt("options: %j",this._options),this._libp2p=t,this._peerValues=new Map,this.connections=new Map,this._started=!1,this._timer=null,this._autoDialTimeout=null,this._checkMetrics=this._checkMetrics.bind(this),this._autoDial=this._autoDial.bind(this)}get size(){return Array.from(this.connections.values()).reduce((t,e)=>t+e.length,0)}start(){this._libp2p.metrics&&(this._timer=this._timer||jn(this._checkMetrics,this._options.pollInterval)),this._latencyMonitor=new og({latencyCheckIntervalMs:this._options.pollInterval,dataEmitIntervalMs:this._options.pollInterval}),this._onLatencyMeasure=this._onLatencyMeasure.bind(this),this._latencyMonitor.on("data",this._onLatencyMeasure),this._started=!0,Xt("started"),this._options.autoDial&&this._autoDial()}async stop(){this._autoDialTimeout&&this._autoDialTimeout.clear(),this._timer&&this._timer.clear(),this._latencyMonitor&&this._latencyMonitor.removeListener("data",this._onLatencyMeasure),this._started=!1,await this._close(),Xt("stopped")}async _close(){const t=[];for(const e of this.connections.values())for(const r of e)t.push(r.close());await t,this.connections.clear()}setPeerValue(t,e){if(e<0||e>1)throw new Error("value should be a number between 0 and 1");t.toB58String&&(t=t.toB58String()),this._peerValues.set(t,e)}_checkMetrics(){const t=this._libp2p.metrics.global.movingAverages,e=t.dataReceived[this._options.movingAverageInterval].movingAverage();this._checkMaxLimit("maxReceivedData",e);const r=t.dataSent[this._options.movingAverageInterval].movingAverage();this._checkMaxLimit("maxSentData",r);const n=e+r;this._checkMaxLimit("maxData",n),Xt("metrics update",n),this._timer=jn(this._checkMetrics,this._options.pollInterval)}onConnect(t){const e=t.remotePeer,r=e.toB58String(),n=this.connections.get(r);this.emit("peer:connect",t),n?n.push(t):this.connections.set(r,[t]),this._libp2p.peerStore.keyBook.set(e,e.pubKey),this._peerValues.has(r)||this._peerValues.set(r,this._options.defaultPeerValue),this._checkMaxLimit("maxConnections",this.size)}onDisconnect(t){const e=t.remotePeer.toB58String();let r=this.connections.get(e);r&&r.length>1?(r=r.filter(n=>n.id!==t.id),this.connections.set(e,r)):r&&(this.connections.delete(e),this._peerValues.delete(t.remotePeer.toB58String()),this.emit("peer:disconnect",t))}get(t){const e=this.getAll(t);return e.length?e[0]:null}getAll(t){if(!pe.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),du);const e=t.toB58String(),r=this.connections.get(e);return r?r.filter(n=>n.stat.status==="open"):[]}_onLatencyMeasure(t){this._checkMaxLimit("maxEventLoopDelay",t.avgMs)}_checkMaxLimit(t,e){const r=this._options[t];Xt("checking limit of %s. current value: %d of %d",t,e,r),e>r&&(Xt("%s: limit exceeded: %s, %d",this._peerId,t,e),this._maybeDisconnectOne())}async _autoDial(){const t=this._options.minConnections;if(this.size>=t){this._autoDialTimeout=jn(this._autoDial,this._options.autoDialInterval);return}const e=Array.from(this._libp2p.peerStore.peers.values()).sort((r,n)=>n.protocols&&n.protocols.length&&(!r.protocols||!r.protocols.length)||n.id.pubKey&&!r.id.pubKey?1:-1);for(let r=0;r<e.length&&this.size<t;r++)if(!this.get(e[r].id)){Xt("connecting to a peerStore stored peer %s",e[r].id.toB58String());try{if(await this._libp2p.dialer.connectToPeer(e[r].id),!this._started)return}catch(n){Xt.error("could not connect to peerStore stored peer",n)}}this._autoDialTimeout=jn(this._autoDial,this._options.autoDialInterval)}_maybeDisconnectOne(){if(this._options.minConnections<this.connections.size){const t=Array.from(this._peerValues).sort(pg);Xt("%s: sorted peer values: %j",this._peerId,t);const e=t[0];if(e){const r=e[0];Xt("%s: lowest value peer is %s",this._peerId,r),Xt("%s: closing a connection to %j",this._peerId,r);for(const n of this.connections.values())if(n[0].remotePeer.toB58String()===r){n[0].close();break}}}}}var hg=dg;function pg(t,e){return t[1]-e[1]}const hu=ue("dns4"),pu=ue("dns6"),vi=gt(ue("dns"),ue("dnsaddr"),hu,pu),ks=gt(ue("ip4"),ue("ip6")),wi=gt(we(ks,ue("tcp")),we(vi,ue("tcp"))),fu=we(ks,ue("udp")),mu=we(fu,ue("utp")),_i=gt(we(wi,ue("ws")),we(vi,ue("ws"))),Ei=gt(we(wi,ue("wss")),we(vi,ue("wss"))),jo=gt(we(wi,ue("http")),we(ks,ue("http")),we(vi,ue("http"))),Bo=gt(we(wi,ue("https")),we(ks,ue("https")),we(vi,ue("https"))),Uo=gt(we(_i,ue("p2p-webrtc-star"),ue("p2p")),we(Ei,ue("p2p-webrtc-star"),ue("p2p")),we(_i,ue("p2p-webrtc-star")),we(Ei,ue("p2p-webrtc-star"))),fg=gt(we(_i,ue("p2p-websocket-star"),ue("p2p")),we(Ei,ue("p2p-websocket-star"),ue("p2p")),we(_i,ue("p2p-websocket-star")),we(Ei,ue("p2p-websocket-star"))),gu=gt(we(jo,ue("p2p-webrtc-direct")),we(Bo,ue("p2p-webrtc-direct"))),Si=gt(_i,Ei,jo,Bo,Uo,gu,wi,mu),mg=gt(we(Si,ue("p2p-stardust"),ue("p2p")),we(Si,ue("p2p-stardust"))),cn=gt(we(Si,ue("p2p")),Uo,ue("p2p")),bu=gt(we(cn,ue("p2p-circuit"),cn),we(cn,ue("p2p-circuit")),we(ue("p2p-circuit"),cn),we(Si,ue("p2p-circuit")),we(ue("p2p-circuit"),Si),ue("p2p-circuit")),yu=()=>gt(we(bu,yu),bu),Ti=yu(),vu=gt(we(Ti,cn,Ti),we(cn,Ti),we(Ti,cn),Ti,cn);var gg=vi,bg=hu,yg=pu,vg=ks,wg=wi,_g=fu,Eg=mu,Sg=jo,Tg=Bo,Ag=_i,Cg=Ei,Ig=fg,Rg=Uo,kg=gu,Pg=Si,Ng=mg,Og=Ti,Dg=vu,Mg=vu;function wu(t){return function(r){if(!mt.isMultiaddr(r))try{r=mt(r)}catch(i){return!1}const n=t(r.protoNames());return n===null?!1:n.length===0}}function we(){const t=Array.from(arguments);function e(r){return r.length<t.length?null:(t.some(n=>{if(r=typeof n=="function"?n().partialMatch(r):n.partialMatch(r),r===null)return!0}),r)}return{toString:function(){return"{ "+t.join(" ")+" }"},input:t,matches:wu(e),partialMatch:e}}function gt(){const t=Array.from(arguments);function e(n){let i=null;return t.some(s=>{const a=typeof s=="function"?s().partialMatch(n):s.partialMatch(n);if(a)return i=a,!0}),i}const r={toString:function(){return"{ "+t.join(" ")+" }"},input:t,matches:wu(e),partialMatch:e};return r}function ue(t){const e=t;function r(i){if(typeof i=="string")try{i=mt(i)}catch(a){return!1}const s=i.protoNames();return s.length===1&&s[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:r,partialMatch:n}}var Ps={DNS:gg,DNS4:bg,DNS6:yg,IP:vg,TCP:wg,UDP:_g,UTP:Eg,HTTP:Sg,HTTPS:Tg,WebSockets:Ag,WebSocketsSecure:Cg,WebSocketStar:Ig,WebRTCStar:Rg,WebRTCDirect:kg,Reliable:Pg,Stardust:Ng,Circuit:Og,P2P:Dg,IPFS:Mg},Ns=gr(`
message CircuitRelay {

  enum Status {
    SUCCESS                    = 100;
    HOP_SRC_ADDR_TOO_LONG      = 220;
    HOP_DST_ADDR_TOO_LONG      = 221;
    HOP_SRC_MULTIADDR_INVALID  = 250;
    HOP_DST_MULTIADDR_INVALID  = 251;
    HOP_NO_CONN_TO_DST         = 260;
    HOP_CANT_DIAL_DST          = 261;
    HOP_CANT_OPEN_DST_STREAM   = 262;
    HOP_CANT_SPEAK_RELAY       = 270;
    HOP_CANT_RELAY_TO_SELF     = 280;
    STOP_SRC_ADDR_TOO_LONG     = 320;
    STOP_DST_ADDR_TOO_LONG     = 321;
    STOP_SRC_MULTIADDR_INVALID = 350;
    STOP_DST_MULTIADDR_INVALID = 351;
    STOP_RELAY_REFUSED         = 390;
    MALFORMED_MESSAGE          = 400;
  }

  enum Type { // RPC identifier, either HOP, STOP or STATUS
    HOP = 1;
    STOP = 2;
    STATUS = 3;
    CAN_HOP = 4;
  }

  message Peer {
    required bytes id = 1;    // peer id
    repeated bytes addrs = 2; // peer's known addresses
  }

  optional Type type = 1;     // Type of the message

  optional Peer srcPeer = 2;  // srcPeer and dstPeer are used when Type is HOP or STATUS
  optional Peer dstPeer = 3;

  optional Status code = 4;   // Status code, used when Type is STATUS
}
`),Fo=function(e){if(e){if(typeof e[Symbol.iterator]=="function")return e[Symbol.iterator]();if(typeof e[Symbol.asyncIterator]=="function")return e[Symbol.asyncIterator]();if(typeof e.next=="function")return e}throw new Error("argument is not an iterator or iterable")},qo=class extends Error{constructor(e,r){super(e||"The operation was aborted");this.type="aborted",this.code=r||"ABORT_ERR"}};const _u=(t,e,r)=>Go(t,Array.isArray(e)?e:[{signal:e,options:r}]),Go=(t,e)=>{t=Fo(t),e=e.map(({signal:n,options:i})=>({signal:n,options:i||{}}));async function*r(){let n;const i=()=>{n&&n()};for(const{signal:s}of e)s.addEventListener("abort",i);for(;;){let s;try{for(const{signal:c,options:o}of e)if(c.aborted){const{abortMessage:l,abortCode:u}=o;throw new qo(l,u)}const a=new Promise((c,o)=>{n=()=>{const{options:l}=e.find(({signal:f})=>f.aborted),{abortMessage:u,abortCode:h}=l;o(new qo(u,h))}});s=await Promise.race([a,t.next()]),n=null}catch(a){for(const{signal:l}of e)l.removeEventListener("abort",i);const c=e.find(({signal:l})=>l.aborted),o=a.type==="aborted"&&c;if(o&&c.options.onAbort&&await c.options.onAbort(t),typeof t.return=="function"&&await t.return(),o&&c.options.returnOnAbort)return;throw a}if(s.done)break;yield s.value}for(const{signal:s}of e)s.removeEventListener("abort",i)}return r()},Eu=(t,e,r)=>Su(t,Array.isArray(e)?e:[{signal:e,options:r}]),Su=(t,e)=>r=>t(Go(r,e)),xg=(t,e,r)=>Lg(t,Array.isArray(e)?e:[{signal:e,options:r}]),Lg=(t,e)=>({sink:Su(t.sink,e),source:Go(t.source,e)});var et=_u,jg=qo,Bg=_u,Ug=Eu,Fg=Eu,qg=xg;et.AbortError=jg,et.source=Bg,et.sink=Ug,et.transform=Fg,et.duplex=qg;const Gg=Q("libp2p:stream:converter");function Vg({stream:t,remoteAddr:e,localAddr:r},n={}){const{sink:i,source:s}=t,a={async sink(o){n.signal&&(o=et(o,n.signal));try{await i(o)}catch(l){l.type!=="aborted"&&Gg(l)}c()},source:n.signal?et(s,n.signal):s,conn:t,localAddr:r,remoteAddr:e,timeline:{open:Date.now()},close(){i([]),c()}};function c(){a.timeline.close||(a.timeline.close=Date.now())}return a}var Tu=Vg,Vo={relay:"/libp2p/circuit/relay/0.1.0"};const $g=Q("libp2p:circuit:listener");$g.err=Q("libp2p:circuit:error:listener");var Hg=t=>{const e=new _t,r=new Map;return e.listen=async n=>{const i=String(n).split("/p2p-circuit").find(c=>c!==""),s=await t._dialer.connectToPeer(Fe(i)),a=s.remoteAddr.encapsulate("/p2p-circuit");r.set(s.remotePeer.toB58String(),a),e.emit("listening")},e.close=()=>{},e.getAddrs=()=>{const n=[];for(const i of r.values())n.push(i);return n},e};const{CircuitRelay:Bn}=Ns;function Au(t,e){t.write({type:Bn.Type.STATUS,code:e})}function zg(t,e){try{t.dstPeer.addrs.forEach(r=>Fe(r))}catch(r){throw Au(e,t.type===Bn.Type.HOP?Bn.Status.HOP_DST_MULTIADDR_INVALID:Bn.Status.STOP_DST_MULTIADDR_INVALID),r}try{t.srcPeer.addrs.forEach(r=>Fe(r))}catch(r){throw Au(e,t.type===Bn.Type.HOP?Bn.Status.HOP_SRC_MULTIADDR_INVALID:Bn.Status.STOP_SRC_MULTIADDR_INVALID),r}}var Cu={validateAddrs:zg},Iu=t=>{const e=async function*(){let r=yield,n=new ct;for await(const i of t){if(!r){r=yield n.append(i),n=new ct;continue}for(n.append(i);n.length>=r;){const s=n.shallowSlice(0,r);if(n.consume(r),r=yield s,!r){n.length&&(r=yield n,n=new ct);break}}}if(r)throw Object.assign(new Error(`stream ended before ${r} bytes became available`),{code:"ERR_UNDER_READ",buffer:n})}();return e.next(),e},Ru=class{constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];return e===void 0?void 0:(this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e)}isEmpty(){return this.buffer[this.btm]===void 0}},Os=class{constructor(e){this.hwm=e||16,this.head=new Ru(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){const r=this.head;this.head=r.next=new Ru(2*this.head.buffer.length),this.head.push(e)}}shift(){const e=this.tail.shift();if(e===void 0&&this.tail.next){const r=this.tail.next;return this.tail.next=null,this.tail=r,this.tail.shift()}return e}isEmpty(){return this.head.isEmpty()}},_a=t=>{t=t||{};let e;typeof t=="function"?(e=t,t={}):e=t.onEnd;let r=new Os,n,i,s;const a=()=>{if(!r.isEmpty()){if(t.writev){let D;const I=[];for(;!r.isEmpty();){if(D=r.shift(),D.error)throw D.error;I.push(D.value)}return{done:D.done,value:I}}const S=r.shift();if(S.error)throw S.error;return S}return s?{done:!0}:new Promise((S,D)=>{i=I=>(i=null,I.error?D(I.error):t.writev&&!I.done?S({done:I.done,value:[I.value]}):S(I),n)})},c=S=>i?i(S):(r.push(S),n),o=S=>(r=new Os,i?i({error:S}):(r.push({error:S}),n)),l=S=>s?n:c({done:!1,value:S}),u=S=>s?n:(s=!0,S?o(S):c({done:!0})),h=()=>(r=new Os,u(),{done:!0}),f=S=>(u(S),{done:!0});if(n={[Symbol.asyncIterator](){return this},next:a,return:h,throw:f,push:l,end:u},!e)return n;const p=n;return n={[Symbol.asyncIterator](){return this},next(){return p.next()},throw(S){return p.throw(S),e&&(e(S),e=null),{done:!0}},return(){return p.return(),e&&(e(),e=null),{done:!0}},push:l,end(S){return p.end(S),e&&(e(S),e=null),n}},n};const Kg=()=>{const t={};return t.promise=new Promise((e,r)=>{t.resolve=e,t.reject=r}),t};var Ea=Kg,Ds=t=>{const e=_a(),r=Iu(t.source),n=Ea();let i;const s=t.sink(async function*(){yield*e;const c=await n.promise;yield*c}());s.catch(c=>{i=c});const a={sink:c=>i?Promise.reject(i):(n.resolve(c),s),source:r};return{reader:r,writer:e,stream:a,rest:()=>e.end(),write:e.push,read:async()=>(await r.next()).value}};const{CircuitRelay:ku}=Ns,Ms=Q("libp2p:circuit:stream-handler");Ms.error=Q("libp2p:circuit:stream-handler:error");class Wg{constructor({stream:t,maxLength:e=4096}){this.stream=t,this.shake=Ds(this.stream),this.decoder=Xe.decode.fromReader(this.shake.reader,{maxDataLength:e})}async read(){const t=await this.decoder.next();if(t.value){const e=ku.decode(t.value.slice());return Ms("read message type",e.type),e}Ms("read received no value, closing stream"),this.close()}write(t){Ms("write message type %s",t.type),this.shake.write(Xe.encode.single(ku.encode(t)))}rest(){return this.shake.rest(),this.shake.stream}end(t){this.write(t),this.close()}close(){Ms("closing the stream"),this.rest().sink([])}}var $o=Wg;const{CircuitRelay:Ho}=Ns,{validateAddrs:Xg}=Cu,Ai=Q("libp2p:circuit:stop");Ai.error=Q("libp2p:circuit:stop:error");var Qg=function({connection:e,request:r,streamHandler:n}){try{Xg(r,n)}catch(i){return Ai.error("invalid stop request via peer %s",e.remotePeer.toB58String(),i)}return Ai("stop request is valid"),n.write({type:Ho.Type.STATUS,code:Ho.Status.SUCCESS}),n.rest()},Yg=async function({connection:e,request:r}){const{stream:n}=await e.newStream([Vo.relay]);Ai("starting stop request to %s",e.remotePeer.toB58String());const i=new $o({stream:n});i.write(r);const s=await i.read();if(s.code===Ho.Status.SUCCESS)return Ai("stop request to %s was successful",e.remotePeer.toB58String()),i.rest();Ai("stop request failed with code %d",s.code),i.close()},Pu={handleStop:Qg,stop:Yg};const Dr=Q("libp2p:circuit:hop");Dr.error=Q("libp2p:circuit:hop:error");const{validateAddrs:Jg}=Cu,{CircuitRelay:or}=Ns,{codes:Zg}=lt,{stop:eb}=Pu;var tb=async function({connection:e,request:r,streamHandler:n,circuit:i}){if(!i._options.hop.enabled)return Dr("HOP request received but we are not acting as a relay"),n.end({type:or.Type.STATUS,code:or.Status.HOP_CANT_SPEAK_RELAY});try{Jg(r,n)}catch(u){return Dr.error("invalid hop request via peer %s",e.remotePeer.toB58String(),u)}const s=new pe(r.dstPeer.id),a=i._connectionManager.get(s);if(!a&&!i._options.hop.active)return Dr("HOP request received but we are not connected to the destination peer"),n.end({type:or.Type.STATUS,code:or.Status.HOP_NO_CONN_TO_DST});const c={type:or.Type.STOP,dstPeer:r.dstPeer,srcPeer:r.srcPeer};let o;try{o=await eb({connection:a,request:c,circuit:i})}catch(u){return Dr.error(u)}Dr("hop request from %s is valid",e.remotePeer.toB58String()),n.write({type:or.Type.STATUS,code:or.Status.SUCCESS});const l=n.rest();return ft(l,o,l)},rb=async function({connection:e,request:r}){const{stream:n}=await e.newStream([Vo.relay]),i=new $o({stream:n});i.write(r);const s=await i.read();if(s.code===or.Status.SUCCESS)return Dr("hop request was successful"),i.rest();throw Dr("hop request failed with code %d, closing stream",s.code),i.close(),U(new Error(`HOP request failed with code ${s.code}`),Zg.ERR_HOP_REQUEST_FAILED)},nb=function({connection:e,streamHandler:r,circuit:n}){const i=n._options.hop.enabled;Dr("can hop (%s) request from %s",i,e.remotePeer.toB58String()),r.end({type:or.Type.STATUS,code:i?or.Status.SUCCESS:or.Status.HOP_CANT_SPEAK_RELAY})},ib={handleHop:tb,hop:rb,handleCanHop:nb};const{CircuitRelay:Ci}=Ns,Mr=Q("libp2p:circuit");Mr.error=Q("libp2p:circuit:error");const{relay:sb}=Vo,{handleCanHop:ab,handleHop:ob,hop:cb}=ib,{handleStop:lb}=Pu;class ub{constructor({libp2p:t,upgrader:e}){this._dialer=t.dialer,this._registrar=t.registrar,this._connectionManager=t.connectionManager,this._upgrader=e,this._options=t._config.relay,this._libp2p=t,this.peerId=t.peerId,this._registrar.handle(sb,this._onProtocol.bind(this))}async _onProtocol({connection:t,stream:e,protocol:r}){const n=new $o({stream:e}),i=await n.read(),s=this;let a;switch(i.type){case Ci.Type.CAN_HOP:{Mr("received CAN_HOP request from %s",t.remotePeer.toB58String()),await ab({circuit:s,connection:t,streamHandler:n});break}case Ci.Type.HOP:{Mr("received HOP request from %s",t.remotePeer.toB58String()),a=await ob({connection:t,request:i,streamHandler:n,circuit:s});break}case Ci.Type.STOP:{Mr("received STOP request from %s",t.remotePeer.toB58String()),a=await lb({connection:t,request:i,streamHandler:n,circuit:s});break}default:Mr("Request of type %s not supported",i.type)}if(a){const c=Fe(i.dstPeer.addrs[0]),o=Fe(i.srcPeer.addrs[0]),l=Tu({stream:a,remoteAddr:c,localAddr:o}),u=Ci.Type===Ci.Type.HOP?"relay":"inbound";Mr("new %s connection %s",u,l.remoteAddr);const h=await this._upgrader.upgradeInbound(l);Mr("%s connection %s upgraded",u,l.remoteAddr),this.handler&&this.handler(h)}}async dial(t,e){const r=t.toString().split("/p2p-circuit"),n=Fe(r[0]),i=Fe(r[r.length-1]),s=pe.createFromCID(n.getPeerId()),a=pe.createFromCID(i.getPeerId());let c=!1,o=this._connectionManager.get(s);o||(o=await this._dialer.connectToPeer(n,e),c=!0);try{const l=await cb({connection:o,circuit:this,request:{type:Ci.Type.HOP,srcPeer:{id:this.peerId.toBytes(),addrs:this._libp2p.multiaddrs.map(f=>f.bytes)},dstPeer:{id:a.toBytes(),addrs:[Fe(i).bytes]}}}),u=n.encapsulate(`/p2p-circuit/p2p/${this.peerId.toB58String()}`),h=Tu({stream:l,remoteAddr:t,localAddr:u});return Mr("new outbound connection %s",h.remoteAddr),this._upgrader.upgradeOutbound(h)}catch(l){throw Mr.error("Circuit relay dial failed",l),c&&await o.close(),l}}createListener(t,e){return typeof t=="function"&&(e=t,t={}),this.handler=e,Hg(this)}filter(t){return t=Array.isArray(t)?t:[t],t.filter(e=>Ps.Circuit.matches(e))}}var Nu=br(ub,{className:"Circuit",symbolName:"@libp2p/js-libp2p-circuit/circuit"});const{AbortController:db}=typeof self!="undefined"?self:typeof window!="undefined"?window:As;class zo extends db{constructor(t){super();this._ms=t,this._timer=jn(()=>this.abort(),t),Object.setPrototypeOf(this,zo.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=jn(()=>this.abort(),this._ms)}}var Ou=zo,hb=zo;Ou.TimeoutController=hb;var pb=AbortController;function Du(t){const e=new pb;function r(){e.abort();for(const n of t){if(!n||!n.removeEventListener)continue;n.removeEventListener("abort",r)}}for(const n of t){if(!n||!n.addEventListener)continue;if(n.aborted){r();break}n.addEventListener("abort",r)}return e.signal}var Ko=Du,fb=Du;Ko.anySignal=fb;var mb=class{constructor(){this._buffer=new Os,this._waitingConsumers=new Os}push(e){const{promise:r,resolve:n}=Ea();return this._buffer.push({chunk:e,resolve:n}),this._consume(),r}_consume(){for(;!this._waitingConsumers.isEmpty()&&!this._buffer.isEmpty();){const e=this._waitingConsumers.shift(),r=this._buffer.shift();e.resolve(r.chunk),r.resolve()}}shift(){const{promise:e,resolve:r}=Ea();return this._waitingConsumers.push({resolve:r}),this._consume(),e}isEmpty(){return this._buffer.isEmpty()}};const gb=Q("libp2p:dialer:request");gb.error=Q("libp2p:dialer:request:error");class bb{constructor({addrs:t,dialAction:e,dialer:r}){this.addrs=t,this.dialer=r,this.dialAction=e}async run(t){const e=this.dialer.getTokens(this.addrs.length);if(e.length<1)throw U(new Error("No dial tokens available"),"ERR_NO_DIAL_TOKENS");const r=new mb;e.forEach(s=>r.push(s));const n=this.addrs.map(()=>new As);let i=0;try{return await da(this.addrs.map(async(s,a)=>{const c=await r.shift();let o;try{const l=n[a].signal;o=await this.dialAction(s,{...t,signal:Ko([l,t.signal])}),n.splice(a,1)}finally{i++,this.addrs.length-i>=e.length?r.push(c):this.dialer.releaseToken(e.splice(e.indexOf(c),1)[0])}return o}))}finally{n.map(s=>s.abort()),e.forEach(s=>this.dialer.releaseToken(s))}}}var yb=bb,vb={DialRequest:yb};const Un=Q("libp2p:dialer");Un.error=Q("libp2p:dialer:error");const{DialRequest:wb}=vb,{codes:Wo}=lt,{DIAL_TIMEOUT:_b,MAX_PARALLEL_DIALS:Eb,MAX_PER_PEER_DIALS:Sb}=Rs;class Tb{constructor({transportManager:t,peerStore:e,concurrency:r=Eb,timeout:n=_b,perPeerLimit:i=Sb,resolvers:s={}}){this.transportManager=t,this.peerStore=e,this.concurrency=r,this.timeout=n,this.perPeerLimit=i,this.tokens=[...new Array(r)].map((a,c)=>c),this._pendingDials=new Map;for(const[a,c]of Object.entries(s))Fe.resolvers.set(a,c)}destroy(){for(const t of this._pendingDials.values())try{t.controller.abort()}catch(e){Un.error(e)}this._pendingDials.clear()}async connectToPeer(t,e={}){const r=await this._createDialTarget(t);if(!r.addrs.length)throw U(new Error("The dial request has no addresses"),Wo.ERR_NO_VALID_ADDRESSES);const n=this._pendingDials.get(r.id)||this._createPendingDial(r,e);try{const i=await n.promise;return Un("dial succeeded to %s",r.id),i}catch(i){throw n.controller.signal.aborted&&(i.code=Wo.ERR_TIMEOUT),Un.error(i),i}finally{n.destroy()}}async _createDialTarget(t){const{id:e,multiaddrs:r}=fa(t);r&&this.peerStore.addressBook.add(e,r);let n=this.peerStore.addressBook.getMultiaddrsForPeer(e)||[];Fe.isMultiaddr(t)&&(n=n.filter(s=>!t.equals(s)),n.unshift(t));const i=[];for(const s of n){const a=await this._resolve(s);a.forEach(c=>i.push(c))}return{id:e.toB58String(),addrs:i}}_createPendingDial(t,e){const r=(o,l)=>{if(l.signal.aborted)throw U(new Error("already aborted"),Wo.ERR_ALREADY_ABORTED);return this.transportManager.dial(o,l)},n=new wb({addrs:t.addrs,dialAction:r,dialer:this}),i=new Ou(this.timeout),s=[i.signal];e.signal&&s.push(e.signal);const a=Ko(s),c={dialRequest:n,controller:i,promise:n.run({...e,signal:a}),destroy:()=>{i.clear(),this._pendingDials.delete(t.id)}};return this._pendingDials.set(t.id,c),c}getTokens(t){const e=Math.min(t,this.perPeerLimit,this.tokens.length),r=this.tokens.splice(0,e);return Un("%d tokens request, returning %d, %d remaining",t,e,this.tokens.length),r}releaseToken(t){if(this.tokens.indexOf(t)>-1)return;Un("token %d released",t),this.tokens.push(t)}async _resolve(t){const e=t.protoNames().includes("dnsaddr");if(!e)return[t];const r=await this._resolveRecord(t),n=await Promise.all(r.map(i=>this._resolve(i)));return n.flat().reduce((i,s)=>(i.find(a=>a.equals(s))||i.push(s),i),[])}async _resolveRecord(t){try{t=Fe(t.toString());const e=await t.resolve();return e}catch(e){return Un.error(`multiaddr ${t} could not be resolved`),[]}}}var Ab=Tb;function Cb(t){return t>=55296&&t<=56319}function Ib(t){return t>=56320&&t<=57343}var Rb=function(e,r,n){if(typeof r!="string")throw new Error("Input must be string");for(var i=r.length,s=0,a,c,o=0;o<i;o+=1){if(a=r.charCodeAt(o),c=r[o],Cb(a)&&Ib(r.charCodeAt(o+1))&&(o+=1,c+=r[o]),s+=e(c),s===n)return r.slice(0,o+1);if(s>n)return r.slice(0,o-c.length+1)}return r};function kb(t){return t>=55296&&t<=56319}function Pb(t){return t>=56320&&t<=57343}var Nb=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var r=e.length,n=0,i=null,s=null,a=0;a<r;a++)i=e.charCodeAt(a),Pb(i)?s!=null&&kb(s)?n+=1:n+=3:i<=127?n+=1:i>=128&&i<=2047?n+=2:i>=2048&&i<=65535&&(n+=3),s=i;return n},Ob=Rb.bind(null,Nb),Db=/[\/\?<>\\:\*\|"]/g,Mb=/[\x00-\x1f\x80-\x9f]/g,xb=/^\.+$/,Lb=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,jb=/[\. ]+$/;function Mu(t,e){if(typeof t!="string")throw new Error("Input must be string");var r=t.replace(Db,e).replace(Mb,e).replace(xb,e).replace(Lb,e).replace(jb,e);return Ob(r,255)}var Bb=function(t,e){var r=e&&e.replacement||"",n=Mu(t,r);return r===""?n:Mu(n,"")},eR=re(function(t){var e=B.asn1,r=t.exports=B.pkcs7asn1=B.pkcs7asn1||{};B.pkcs7=B.pkcs7||{},B.pkcs7.asn1=r;var n={name:"ContentInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};r.contentInfoValidator=n;var i={name:"EncryptedContentInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:e.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};r.envelopedDataValidator={name:"EnvelopedData",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(i)},r.encryptedDataValidator={name:"EncryptedData",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"}].concat(i)};var s={name:"SignerInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:e.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};r.signedDataValidator={name:"SignedData",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},n,{name:"SignedData.Certificates",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,capture:"signerInfos",optional:!0,value:[s]}]},r.recipientInfoValidator={name:"RecipientInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:e.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter"}]},{name:"RecipientInfo.encryptedKey",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}}),tR=re(function(t){B.mgf=B.mgf||{};var e=t.exports=B.mgf.mgf1=B.mgf1=B.mgf1||{};e.create=function(r){var n={generate:function(i,s){for(var a=new B.util.ByteBuffer,c=Math.ceil(s/r.digestLength),o=0;o<c;o++){var l=new B.util.ByteBuffer;l.putInt32(o),r.start(),r.update(i+l.getBytes()),a.putBuffer(r.digest())}return a.truncate(a.length()-s),a.getBytes()}};return n}}),rR=B.mgf=B.mgf||{};B.mgf.mgf1=B.mgf1;var nR=re(function(t){var e=t.exports=B.pss=B.pss||{};e.create=function(r){arguments.length===3&&(r={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var n=r.md,i=r.mgf,s=n.digestLength,a=r.salt||null;typeof a=="string"&&(a=B.util.createBuffer(a));var c;if("saltLength"in r)c=r.saltLength;else if(a!==null)c=a.length();else throw new Error("Salt length not specified or specific salt not given.");if(a!==null&&a.length()!==c)throw new Error("Given salt length does not match length of given salt.");var o=r.prng||B.random,l={};return l.encode=function(u,h){var f,p=h-1,S=Math.ceil(p/8),D=u.digest().getBytes();if(S<s+c+2)throw new Error("Message is too long to encrypt.");var I;a===null?I=o.getBytesSync(c):I=a.bytes();var k=new B.util.ByteBuffer;k.fillWithByte(0,8),k.putBytes(D),k.putBytes(I),n.start(),n.update(k.getBytes());var V=n.digest().getBytes(),H=new B.util.ByteBuffer;H.fillWithByte(0,S-c-s-2),H.putByte(1),H.putBytes(I);var v=H.getBytes(),_=S-s-1,A=i.generate(V,_),d="";for(f=0;f<_;f++)d+=String.fromCharCode(v.charCodeAt(f)^A.charCodeAt(f));var g=65280>>8*S-p&255;return d=String.fromCharCode(d.charCodeAt(0)&~g)+d.substr(1),d+V+String.fromCharCode(188)},l.verify=function(u,h,f){var p,S=f-1,D=Math.ceil(S/8);if(h=h.substr(-D),D<s+c+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(h.charCodeAt(D-1)!==188)throw new Error("Encoded message does not end in 0xBC.");var I=D-s-1,k=h.substr(0,I),V=h.substr(I,s),H=65280>>8*D-S&255;if((k.charCodeAt(0)&H)!==0)throw new Error("Bits beyond keysize not zero as expected.");var v=i.generate(V,I),_="";for(p=0;p<I;p++)_+=String.fromCharCode(k.charCodeAt(p)^v.charCodeAt(p));_=String.fromCharCode(_.charCodeAt(0)&~H)+_.substr(1);var A=D-s-c-2;for(p=0;p<A;p++)if(_.charCodeAt(p)!==0)throw new Error("Leftmost octets not zero as expected");if(_.charCodeAt(A)!==1)throw new Error("Inconsistent PSS signature, 0x01 marker not found");var d=_.substr(-c),g=new B.util.ByteBuffer;g.fillWithByte(0,8),g.putBytes(u),g.putBytes(d),n.start(),n.update(g.getBytes());var E=n.digest().getBytes();return V===E},l}}),iR=re(function(t){var e=B.asn1,r=t.exports=B.pki=B.pki||{},n=r.oids,i={};i.CN=n.commonName,i.commonName="CN",i.C=n.countryName,i.countryName="C",i.L=n.localityName,i.localityName="L",i.ST=n.stateOrProvinceName,i.stateOrProvinceName="ST",i.O=n.organizationName,i.organizationName="O",i.OU=n.organizationalUnitName,i.organizationalUnitName="OU",i.E=n.emailAddress,i.emailAddress="E";var s=B.pki.rsa.publicKeyValidator,a={name:"Certificate",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:e.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:e.Class.UNIVERSAL,type:e.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:e.Class.UNIVERSAL,type:e.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:e.Class.UNIVERSAL,type:e.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:e.Class.UNIVERSAL,type:e.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},s,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:e.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:e.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:e.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},c={name:"rsapss",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:e.Class.UNIVERSAL,type:e.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:e.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:e.Class.UNIVERSAL,type:e.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:e.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:e.Class.UNIVERSAL,type:e.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:e.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:e.Class.UNIVERSAL,type:e.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},o={name:"CertificationRequestInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},s,{name:"CertificationRequestInfo.attributes",tagClass:e.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,constructed:!0}]}]}]},l={name:"CertificationRequest",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[o,{name:"CertificationRequest.signatureAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:e.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:e.Class.UNIVERSAL,type:e.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};r.RDNAttributesAsArray=function(v,_){for(var A=[],d,g,E,b=0;b<v.value.length;++b){d=v.value[b];for(var C=0;C<d.value.length;++C)E={},g=d.value[C],E.type=e.derToOid(g.value[0].value),E.value=g.value[1].value,E.valueTagClass=g.value[1].type,E.type in n&&(E.name=n[E.type],E.name in i&&(E.shortName=i[E.name])),_&&(_.update(E.type),_.update(E.value)),A.push(E)}return A},r.CRIAttributesAsArray=function(v){for(var _=[],A=0;A<v.length;++A)for(var d=v[A],g=e.derToOid(d.value[0].value),E=d.value[1].value,b=0;b<E.length;++b){var C={};if(C.type=g,C.value=E[b].value,C.valueTagClass=E[b].type,C.type in n&&(C.name=n[C.type],C.name in i&&(C.shortName=i[C.name])),C.type===n.extensionRequest){C.extensions=[];for(var P=0;P<C.value.length;++P)C.extensions.push(r.certificateExtensionFromAsn1(C.value[P]))}_.push(C)}return _};function u(v,_){typeof _=="string"&&(_={shortName:_});for(var A=null,d,g=0;A===null&&g<v.attributes.length;++g)d=v.attributes[g],(_.type&&_.type===d.type||(_.name&&_.name===d.name||_.shortName&&_.shortName===d.shortName))&&(A=d);return A}var h=function(v,_,A){var d={};if(v!==n["RSASSA-PSS"])return d;A&&(d={hash:{algorithmOid:n.sha1},mgf:{algorithmOid:n.mgf1,hash:{algorithmOid:n.sha1}},saltLength:20});var g={},E=[];if(!e.validate(_,c,g,E)){var b=new Error("Cannot read RSASSA-PSS parameter block.");throw b.errors=E,b}return g.hashOid!==void 0&&(d.hash=d.hash||{},d.hash.algorithmOid=e.derToOid(g.hashOid)),g.maskGenOid!==void 0&&(d.mgf=d.mgf||{},d.mgf.algorithmOid=e.derToOid(g.maskGenOid),d.mgf.hash=d.mgf.hash||{},d.mgf.hash.algorithmOid=e.derToOid(g.maskGenHashOid)),g.saltLength!==void 0&&(d.saltLength=g.saltLength.charCodeAt(0)),d};r.certificateFromPem=function(v,_,A){var d=B.pem.decode(v)[0];if(d.type!=="CERTIFICATE"&&d.type!=="X509 CERTIFICATE"&&d.type!=="TRUSTED CERTIFICATE"){var g=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw g.headerType=d.type,g}if(d.procType&&d.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var E=e.fromDer(d.body,A);return r.certificateFromAsn1(E,_)},r.certificateToPem=function(v,_){var A={type:"CERTIFICATE",body:e.toDer(r.certificateToAsn1(v)).getBytes()};return B.pem.encode(A,{maxline:_})},r.publicKeyFromPem=function(v){var _=B.pem.decode(v)[0];if(_.type!=="PUBLIC KEY"&&_.type!=="RSA PUBLIC KEY"){var A=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw A.headerType=_.type,A}if(_.procType&&_.procType.type==="ENCRYPTED")throw new Error("Could not convert public key from PEM; PEM is encrypted.");var d=e.fromDer(_.body);return r.publicKeyFromAsn1(d)},r.publicKeyToPem=function(v,_){var A={type:"PUBLIC KEY",body:e.toDer(r.publicKeyToAsn1(v)).getBytes()};return B.pem.encode(A,{maxline:_})},r.publicKeyToRSAPublicKeyPem=function(v,_){var A={type:"RSA PUBLIC KEY",body:e.toDer(r.publicKeyToRSAPublicKey(v)).getBytes()};return B.pem.encode(A,{maxline:_})},r.getPublicKeyFingerprint=function(v,_){_=_||{};var A=_.md||B.md.sha1.create(),d=_.type||"RSAPublicKey",g;switch(d){case"RSAPublicKey":g=e.toDer(r.publicKeyToRSAPublicKey(v)).getBytes();break;case"SubjectPublicKeyInfo":g=e.toDer(r.publicKeyToAsn1(v)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+_.type+'".')}A.start(),A.update(g);var E=A.digest();if(_.encoding==="hex"){var b=E.toHex();return _.delimiter?b.match(/.{2}/g).join(_.delimiter):b}else{if(_.encoding==="binary")return E.getBytes();if(_.encoding)throw new Error('Unknown encoding "'+_.encoding+'".')}return E},r.certificationRequestFromPem=function(v,_,A){var d=B.pem.decode(v)[0];if(d.type!=="CERTIFICATE REQUEST"){var g=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw g.headerType=d.type,g}if(d.procType&&d.procType.type==="ENCRYPTED")throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var E=e.fromDer(d.body,A);return r.certificationRequestFromAsn1(E,_)},r.certificationRequestToPem=function(v,_){var A={type:"CERTIFICATE REQUEST",body:e.toDer(r.certificationRequestToAsn1(v)).getBytes()};return B.pem.encode(A,{maxline:_})},r.createCertificate=function(){var v={};return v.version=2,v.serialNumber="00",v.signatureOid=null,v.signature=null,v.siginfo={},v.siginfo.algorithmOid=null,v.validity={},v.validity.notBefore=new Date,v.validity.notAfter=new Date,v.issuer={},v.issuer.getField=function(_){return u(v.issuer,_)},v.issuer.addField=function(_){p([_]),v.issuer.attributes.push(_)},v.issuer.attributes=[],v.issuer.hash=null,v.subject={},v.subject.getField=function(_){return u(v.subject,_)},v.subject.addField=function(_){p([_]),v.subject.attributes.push(_)},v.subject.attributes=[],v.subject.hash=null,v.extensions=[],v.publicKey=null,v.md=null,v.setSubject=function(_,A){p(_),v.subject.attributes=_,delete v.subject.uniqueId,A&&(v.subject.uniqueId=A),v.subject.hash=null},v.setIssuer=function(_,A){p(_),v.issuer.attributes=_,delete v.issuer.uniqueId,A&&(v.issuer.uniqueId=A),v.issuer.hash=null},v.setExtensions=function(_){for(var A=0;A<_.length;++A)S(_[A],{cert:v});v.extensions=_},v.getExtension=function(_){typeof _=="string"&&(_={name:_});for(var A=null,d,g=0;A===null&&g<v.extensions.length;++g)d=v.extensions[g],(_.id&&d.id===_.id||_.name&&d.name===_.name)&&(A=d);return A},v.sign=function(_,A){v.md=A||B.md.sha1.create();var d=n[v.md.algorithm+"WithRSAEncryption"];if(!d){var g=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw g.algorithm=v.md.algorithm,g}v.signatureOid=v.siginfo.algorithmOid=d,v.tbsCertificate=r.getTBSCertificate(v);var E=e.toDer(v.tbsCertificate);v.md.update(E.getBytes()),v.signature=_.sign(v.md)},v.verify=function(_){var A=!1;if(!v.issued(_)){var d=_.issuer,g=v.subject,E=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw E.expectedIssuer=d.attributes,E.actualIssuer=g.attributes,E}var b=_.md;if(b===null){if(_.signatureOid in n){var C=n[_.signatureOid];switch(C){case"sha1WithRSAEncryption":b=B.md.sha1.create();break;case"md5WithRSAEncryption":b=B.md.md5.create();break;case"sha256WithRSAEncryption":b=B.md.sha256.create();break;case"sha384WithRSAEncryption":b=B.md.sha384.create();break;case"sha512WithRSAEncryption":b=B.md.sha512.create();break;case"RSASSA-PSS":b=B.md.sha256.create();break}}if(b===null){var E=new Error("Could not compute certificate digest. Unknown signature OID.");throw E.signatureOid=_.signatureOid,E}var P=_.tbsCertificate||r.getTBSCertificate(_),M=e.toDer(P);b.update(M.getBytes())}if(b!==null){var O;switch(_.signatureOid){case n.sha1WithRSAEncryption:O=void 0;break;case n["RSASSA-PSS"]:var x,F;if(x=n[_.signatureParameters.mgf.hash.algorithmOid],x===void 0||B.md[x]===void 0){var E=new Error("Unsupported MGF hash function.");throw E.oid=_.signatureParameters.mgf.hash.algorithmOid,E.name=x,E}if(F=n[_.signatureParameters.mgf.algorithmOid],F===void 0||B.mgf[F]===void 0){var E=new Error("Unsupported MGF function.");throw E.oid=_.signatureParameters.mgf.algorithmOid,E.name=F,E}if(F=B.mgf[F].create(B.md[x].create()),x=n[_.signatureParameters.hash.algorithmOid],x===void 0||B.md[x]===void 0)throw{message:"Unsupported RSASSA-PSS hash function.",oid:_.signatureParameters.hash.algorithmOid,name:x};O=B.pss.create(B.md[x].create(),F,_.signatureParameters.saltLength);break}A=v.publicKey.verify(b.digest().getBytes(),_.signature,O)}return A},v.isIssuer=function(_){var A=!1,d=v.issuer,g=_.subject;if(d.hash&&g.hash)A=d.hash===g.hash;else if(d.attributes.length===g.attributes.length){A=!0;for(var E,b,C=0;A&&C<d.attributes.length;++C)E=d.attributes[C],b=g.attributes[C],(E.type!==b.type||E.value!==b.value)&&(A=!1)}return A},v.issued=function(_){return _.isIssuer(v)},v.generateSubjectKeyIdentifier=function(){return r.getPublicKeyFingerprint(v.publicKey,{type:"RSAPublicKey"})},v.verifySubjectKeyIdentifier=function(){for(var _=n.subjectKeyIdentifier,A=0;A<v.extensions.length;++A){var d=v.extensions[A];if(d.id===_){var g=v.generateSubjectKeyIdentifier().getBytes();return B.util.hexToBytes(d.subjectKeyIdentifier)===g}}return!1},v},r.certificateFromAsn1=function(v,_){var A={},d=[];if(!e.validate(v,a,A,d)){var g=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw g.errors=d,g}var E=e.derToOid(A.publicKeyOid);if(E!==r.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var b=r.createCertificate();b.version=A.certVersion?A.certVersion.charCodeAt(0):0;var C=B.util.createBuffer(A.certSerialNumber);b.serialNumber=C.toHex(),b.signatureOid=B.asn1.derToOid(A.certSignatureOid),b.signatureParameters=h(b.signatureOid,A.certSignatureParams,!0),b.siginfo.algorithmOid=B.asn1.derToOid(A.certinfoSignatureOid),b.siginfo.parameters=h(b.siginfo.algorithmOid,A.certinfoSignatureParams,!1),b.signature=A.certSignature;var P=[];if(A.certValidity1UTCTime!==void 0&&P.push(e.utcTimeToDate(A.certValidity1UTCTime)),A.certValidity2GeneralizedTime!==void 0&&P.push(e.generalizedTimeToDate(A.certValidity2GeneralizedTime)),A.certValidity3UTCTime!==void 0&&P.push(e.utcTimeToDate(A.certValidity3UTCTime)),A.certValidity4GeneralizedTime!==void 0&&P.push(e.generalizedTimeToDate(A.certValidity4GeneralizedTime)),P.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(P.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(b.validity.notBefore=P[0],b.validity.notAfter=P[1],b.tbsCertificate=A.tbsCertificate,_){if(b.md=null,b.signatureOid in n){var E=n[b.signatureOid];switch(E){case"sha1WithRSAEncryption":b.md=B.md.sha1.create();break;case"md5WithRSAEncryption":b.md=B.md.md5.create();break;case"sha256WithRSAEncryption":b.md=B.md.sha256.create();break;case"sha384WithRSAEncryption":b.md=B.md.sha384.create();break;case"sha512WithRSAEncryption":b.md=B.md.sha512.create();break;case"RSASSA-PSS":b.md=B.md.sha256.create();break}}if(b.md===null){var g=new Error("Could not compute certificate digest. Unknown signature OID.");throw g.signatureOid=b.signatureOid,g}var M=e.toDer(b.tbsCertificate);b.md.update(M.getBytes())}var O=B.md.sha1.create();b.issuer.getField=function(F){return u(b.issuer,F)},b.issuer.addField=function(F){p([F]),b.issuer.attributes.push(F)},b.issuer.attributes=r.RDNAttributesAsArray(A.certIssuer,O),A.certIssuerUniqueId&&(b.issuer.uniqueId=A.certIssuerUniqueId),b.issuer.hash=O.digest().toHex();var x=B.md.sha1.create();return b.subject.getField=function(F){return u(b.subject,F)},b.subject.addField=function(F){p([F]),b.subject.attributes.push(F)},b.subject.attributes=r.RDNAttributesAsArray(A.certSubject,x),A.certSubjectUniqueId&&(b.subject.uniqueId=A.certSubjectUniqueId),b.subject.hash=x.digest().toHex(),A.certExtensions?b.extensions=r.certificateExtensionsFromAsn1(A.certExtensions):b.extensions=[],b.publicKey=r.publicKeyFromAsn1(A.subjectPublicKeyInfo),b},r.certificateExtensionsFromAsn1=function(v){for(var _=[],A=0;A<v.value.length;++A)for(var d=v.value[A],g=0;g<d.value.length;++g)_.push(r.certificateExtensionFromAsn1(d.value[g]));return _},r.certificateExtensionFromAsn1=function(v){var _={};if(_.id=e.derToOid(v.value[0].value),_.critical=!1,v.value[1].type===e.Type.BOOLEAN?(_.critical=v.value[1].value.charCodeAt(0)!==0,_.value=v.value[2].value):_.value=v.value[1].value,_.id in n){if(_.name=n[_.id],_.name==="keyUsage"){var A=e.fromDer(_.value),d=0,g=0;A.value.length>1&&(d=A.value.charCodeAt(1),g=A.value.length>2?A.value.charCodeAt(2):0),_.digitalSignature=(d&128)===128,_.nonRepudiation=(d&64)===64,_.keyEncipherment=(d&32)===32,_.dataEncipherment=(d&16)===16,_.keyAgreement=(d&8)===8,_.keyCertSign=(d&4)===4,_.cRLSign=(d&2)===2,_.encipherOnly=(d&1)===1,_.decipherOnly=(g&128)===128}else if(_.name==="basicConstraints"){var A=e.fromDer(_.value);A.value.length>0&&A.value[0].type===e.Type.BOOLEAN?_.cA=A.value[0].value.charCodeAt(0)!==0:_.cA=!1;var E=null;A.value.length>0&&A.value[0].type===e.Type.INTEGER?E=A.value[0].value:A.value.length>1&&(E=A.value[1].value),E!==null&&(_.pathLenConstraint=e.derToInteger(E))}else if(_.name==="extKeyUsage")for(var A=e.fromDer(_.value),b=0;b<A.value.length;++b){var C=e.derToOid(A.value[b].value);C in n?_[n[C]]=!0:_[C]=!0}else if(_.name==="nsCertType"){var A=e.fromDer(_.value),d=0;A.value.length>1&&(d=A.value.charCodeAt(1)),_.client=(d&128)===128,_.server=(d&64)===64,_.email=(d&32)===32,_.objsign=(d&16)===16,_.reserved=(d&8)===8,_.sslCA=(d&4)===4,_.emailCA=(d&2)===2,_.objCA=(d&1)===1}else if(_.name==="subjectAltName"||_.name==="issuerAltName"){_.altNames=[];for(var P,A=e.fromDer(_.value),M=0;M<A.value.length;++M){P=A.value[M];var O={type:P.type,value:P.value};_.altNames.push(O);switch(P.type){case 1:case 2:case 6:break;case 7:O.ip=B.util.bytesToIP(P.value);break;case 8:O.oid=e.derToOid(P.value);break}}}else if(_.name==="subjectKeyIdentifier"){var A=e.fromDer(_.value);_.subjectKeyIdentifier=B.util.bytesToHex(A.value)}}return _},r.certificationRequestFromAsn1=function(v,_){var A={},d=[];if(!e.validate(v,l,A,d)){var g=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw g.errors=d,g}var E=e.derToOid(A.publicKeyOid);if(E!==r.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var b=r.createCertificationRequest();if(b.version=A.csrVersion?A.csrVersion.charCodeAt(0):0,b.signatureOid=B.asn1.derToOid(A.csrSignatureOid),b.signatureParameters=h(b.signatureOid,A.csrSignatureParams,!0),b.siginfo.algorithmOid=B.asn1.derToOid(A.csrSignatureOid),b.siginfo.parameters=h(b.siginfo.algorithmOid,A.csrSignatureParams,!1),b.signature=A.csrSignature,b.certificationRequestInfo=A.certificationRequestInfo,_){if(b.md=null,b.signatureOid in n){var E=n[b.signatureOid];switch(E){case"sha1WithRSAEncryption":b.md=B.md.sha1.create();break;case"md5WithRSAEncryption":b.md=B.md.md5.create();break;case"sha256WithRSAEncryption":b.md=B.md.sha256.create();break;case"sha384WithRSAEncryption":b.md=B.md.sha384.create();break;case"sha512WithRSAEncryption":b.md=B.md.sha512.create();break;case"RSASSA-PSS":b.md=B.md.sha256.create();break}}if(b.md===null){var g=new Error("Could not compute certification request digest. Unknown signature OID.");throw g.signatureOid=b.signatureOid,g}var C=e.toDer(b.certificationRequestInfo);b.md.update(C.getBytes())}var P=B.md.sha1.create();return b.subject.getField=function(M){return u(b.subject,M)},b.subject.addField=function(M){p([M]),b.subject.attributes.push(M)},b.subject.attributes=r.RDNAttributesAsArray(A.certificationRequestInfoSubject,P),b.subject.hash=P.digest().toHex(),b.publicKey=r.publicKeyFromAsn1(A.subjectPublicKeyInfo),b.getAttribute=function(M){return u(b,M)},b.addAttribute=function(M){p([M]),b.attributes.push(M)},b.attributes=r.CRIAttributesAsArray(A.certificationRequestInfoAttributes||[]),b},r.createCertificationRequest=function(){var v={};return v.version=0,v.signatureOid=null,v.signature=null,v.siginfo={},v.siginfo.algorithmOid=null,v.subject={},v.subject.getField=function(_){return u(v.subject,_)},v.subject.addField=function(_){p([_]),v.subject.attributes.push(_)},v.subject.attributes=[],v.subject.hash=null,v.publicKey=null,v.attributes=[],v.getAttribute=function(_){return u(v,_)},v.addAttribute=function(_){p([_]),v.attributes.push(_)},v.md=null,v.setSubject=function(_){p(_),v.subject.attributes=_,v.subject.hash=null},v.setAttributes=function(_){p(_),v.attributes=_},v.sign=function(_,A){v.md=A||B.md.sha1.create();var d=n[v.md.algorithm+"WithRSAEncryption"];if(!d){var g=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw g.algorithm=v.md.algorithm,g}v.signatureOid=v.siginfo.algorithmOid=d,v.certificationRequestInfo=r.getCertificationRequestInfo(v);var E=e.toDer(v.certificationRequestInfo);v.md.update(E.getBytes()),v.signature=_.sign(v.md)},v.verify=function(){var _=!1,A=v.md;if(A===null){if(v.signatureOid in n){var d=n[v.signatureOid];switch(d){case"sha1WithRSAEncryption":A=B.md.sha1.create();break;case"md5WithRSAEncryption":A=B.md.md5.create();break;case"sha256WithRSAEncryption":A=B.md.sha256.create();break;case"sha384WithRSAEncryption":A=B.md.sha384.create();break;case"sha512WithRSAEncryption":A=B.md.sha512.create();break;case"RSASSA-PSS":A=B.md.sha256.create();break}}if(A===null){var g=new Error("Could not compute certification request digest. Unknown signature OID.");throw g.signatureOid=v.signatureOid,g}var E=v.certificationRequestInfo||r.getCertificationRequestInfo(v),b=e.toDer(E);A.update(b.getBytes())}if(A!==null){var C;switch(v.signatureOid){case n.sha1WithRSAEncryption:break;case n["RSASSA-PSS"]:var P,M;if(P=n[v.signatureParameters.mgf.hash.algorithmOid],P===void 0||B.md[P]===void 0){var g=new Error("Unsupported MGF hash function.");throw g.oid=v.signatureParameters.mgf.hash.algorithmOid,g.name=P,g}if(M=n[v.signatureParameters.mgf.algorithmOid],M===void 0||B.mgf[M]===void 0){var g=new Error("Unsupported MGF function.");throw g.oid=v.signatureParameters.mgf.algorithmOid,g.name=M,g}if(M=B.mgf[M].create(B.md[P].create()),P=n[v.signatureParameters.hash.algorithmOid],P===void 0||B.md[P]===void 0){var g=new Error("Unsupported RSASSA-PSS hash function.");throw g.oid=v.signatureParameters.hash.algorithmOid,g.name=P,g}C=B.pss.create(B.md[P].create(),M,v.signatureParameters.saltLength);break}_=v.publicKey.verify(A.digest().getBytes(),v.signature,C)}return _},v};function f(v){for(var _=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]),A,d,g=v.attributes,E=0;E<g.length;++E){A=g[E];var b=A.value,C=e.Type.PRINTABLESTRING;"valueTagClass"in A&&(C=A.valueTagClass,C===e.Type.UTF8&&(b=B.util.encodeUtf8(b))),d=e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(A.type).getBytes()),e.create(e.Class.UNIVERSAL,C,!1,b)])]),_.value.push(d)}return _}function p(v){for(var _,A=0;A<v.length;++A){if(_=v[A],typeof _.name=="undefined"&&(_.type&&_.type in r.oids?_.name=r.oids[_.type]:_.shortName&&_.shortName in i&&(_.name=r.oids[i[_.shortName]])),typeof _.type=="undefined")if(_.name&&_.name in r.oids)_.type=r.oids[_.name];else{var d=new Error("Attribute type not specified.");throw d.attribute=_,d}if(typeof _.shortName=="undefined"&&(_.name&&_.name in i&&(_.shortName=i[_.name])),_.type===n.extensionRequest&&(_.valueConstructed=!0,_.valueTagClass=e.Type.SEQUENCE,!_.value&&_.extensions)){_.value=[];for(var g=0;g<_.extensions.length;++g)_.value.push(r.certificateExtensionToAsn1(S(_.extensions[g])))}if(typeof _.value=="undefined"){var d=new Error("Attribute value not specified.");throw d.attribute=_,d}}}function S(v,_){if(_=_||{},typeof v.name=="undefined"&&(v.id&&v.id in r.oids&&(v.name=r.oids[v.id])),typeof v.id=="undefined")if(v.name&&v.name in r.oids)v.id=r.oids[v.name];else{var A=new Error("Extension ID not specified.");throw A.extension=v,A}if(typeof v.value!="undefined")return v;if(v.name==="keyUsage"){var d=0,g=0,E=0;v.digitalSignature&&(g|=128,d=7),v.nonRepudiation&&(g|=64,d=6),v.keyEncipherment&&(g|=32,d=5),v.dataEncipherment&&(g|=16,d=4),v.keyAgreement&&(g|=8,d=3),v.keyCertSign&&(g|=4,d=2),v.cRLSign&&(g|=2,d=1),v.encipherOnly&&(g|=1,d=0),v.decipherOnly&&(E|=128,d=7);var b=String.fromCharCode(d);E!==0?b+=String.fromCharCode(g)+String.fromCharCode(E):g!==0&&(b+=String.fromCharCode(g)),v.value=e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,b)}else if(v.name==="basicConstraints")v.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]),v.cA&&v.value.value.push(e.create(e.Class.UNIVERSAL,e.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in v&&v.value.value.push(e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(v.pathLenConstraint).getBytes()));else if(v.name==="extKeyUsage"){v.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);var C=v.value.value;for(var P in v){if(v[P]!==!0)continue;P in n?C.push(e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(n[P]).getBytes())):P.indexOf(".")!==-1&&C.push(e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(P).getBytes()))}}else if(v.name==="nsCertType"){var d=0,g=0;v.client&&(g|=128,d=7),v.server&&(g|=64,d=6),v.email&&(g|=32,d=5),v.objsign&&(g|=16,d=4),v.reserved&&(g|=8,d=3),v.sslCA&&(g|=4,d=2),v.emailCA&&(g|=2,d=1),v.objCA&&(g|=1,d=0);var b=String.fromCharCode(d);g!==0&&(b+=String.fromCharCode(g)),v.value=e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,b)}else if(v.name==="subjectAltName"||v.name==="issuerAltName"){v.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);for(var M,O=0;O<v.altNames.length;++O){M=v.altNames[O];var b=M.value;if(M.type===7&&M.ip){if(b=B.util.bytesFromIP(M.ip),b===null){var A=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw A.extension=v,A}}else M.type===8&&(M.oid?b=e.oidToDer(e.oidToDer(M.oid)):b=e.oidToDer(b));v.value.value.push(e.create(e.Class.CONTEXT_SPECIFIC,M.type,!1,b))}}else if(v.name==="nsComment"&&_.cert){if(!/^[\x00-\x7F]*$/.test(v.comment)||v.comment.length<1||v.comment.length>128)throw new Error('Invalid "nsComment" content.');v.value=e.create(e.Class.UNIVERSAL,e.Type.IA5STRING,!1,v.comment)}else if(v.name==="subjectKeyIdentifier"&&_.cert){var x=_.cert.generateSubjectKeyIdentifier();v.subjectKeyIdentifier=x.toHex(),v.value=e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,x.getBytes())}else if(v.name==="authorityKeyIdentifier"&&_.cert){v.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);var C=v.value.value;if(v.keyIdentifier){var F=v.keyIdentifier===!0?_.cert.generateSubjectKeyIdentifier().getBytes():v.keyIdentifier;C.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!1,F))}if(v.authorityCertIssuer){var q=[e.create(e.Class.CONTEXT_SPECIFIC,4,!0,[f(v.authorityCertIssuer===!0?_.cert.issuer:v.authorityCertIssuer)])];C.push(e.create(e.Class.CONTEXT_SPECIFIC,1,!0,q))}if(v.serialNumber){var z=B.util.hexToBytes(v.serialNumber===!0?_.cert.serialNumber:v.serialNumber);C.push(e.create(e.Class.CONTEXT_SPECIFIC,2,!1,z))}}else if(v.name==="cRLDistributionPoints"){v.value=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);for(var C=v.value.value,ee=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]),Z=e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[]),M,O=0;O<v.altNames.length;++O){M=v.altNames[O];var b=M.value;if(M.type===7&&M.ip){if(b=B.util.bytesFromIP(M.ip),b===null){var A=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw A.extension=v,A}}else M.type===8&&(M.oid?b=e.oidToDer(e.oidToDer(M.oid)):b=e.oidToDer(b));Z.value.push(e.create(e.Class.CONTEXT_SPECIFIC,M.type,!1,b))}ee.value.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[Z])),C.push(ee)}if(typeof v.value=="undefined"){var A=new Error("Extension value not specified.");throw A.extension=v,A}return v}function D(v,_){switch(v){case n["RSASSA-PSS"]:var A=[];return _.hash.algorithmOid!==void 0&&A.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(_.hash.algorithmOid).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")])])),_.mgf.algorithmOid!==void 0&&A.push(e.create(e.Class.CONTEXT_SPECIFIC,1,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(_.mgf.algorithmOid).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(_.mgf.hash.algorithmOid).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")])])])),_.saltLength!==void 0&&A.push(e.create(e.Class.CONTEXT_SPECIFIC,2,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(_.saltLength).getBytes())])),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,A);default:return e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")}}function I(v){var _=e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[]);if(v.attributes.length===0)return _;for(var A=v.attributes,d=0;d<A.length;++d){var g=A[d],E=g.value,b=e.Type.UTF8;"valueTagClass"in g&&(b=g.valueTagClass),b===e.Type.UTF8&&(E=B.util.encodeUtf8(E));var C=!1;"valueConstructed"in g&&(C=g.valueConstructed);var P=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(g.type).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[e.create(e.Class.UNIVERSAL,b,C,E)])]);_.value.push(P)}return _}var k=new Date("1950-01-01T00:00:00Z"),V=new Date("2050-01-01T00:00:00Z");function H(v){return v>=k&&v<V?e.create(e.Class.UNIVERSAL,e.Type.UTCTIME,!1,e.dateToUtcTime(v)):e.create(e.Class.UNIVERSAL,e.Type.GENERALIZEDTIME,!1,e.dateToGeneralizedTime(v))}r.getTBSCertificate=function(v){var _=H(v.validity.notBefore),A=H(v.validity.notAfter),d=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(v.version).getBytes())]),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,B.util.hexToBytes(v.serialNumber)),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(v.siginfo.algorithmOid).getBytes()),D(v.siginfo.algorithmOid,v.siginfo.parameters)]),f(v.issuer),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[_,A]),f(v.subject),r.publicKeyToAsn1(v.publicKey)]);return v.issuer.uniqueId&&d.value.push(e.create(e.Class.CONTEXT_SPECIFIC,1,!0,[e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,String.fromCharCode(0)+v.issuer.uniqueId)])),v.subject.uniqueId&&d.value.push(e.create(e.Class.CONTEXT_SPECIFIC,2,!0,[e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,String.fromCharCode(0)+v.subject.uniqueId)])),v.extensions.length>0&&d.value.push(r.certificateExtensionsToAsn1(v.extensions)),d},r.getCertificationRequestInfo=function(v){var _=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(v.version).getBytes()),f(v.subject),r.publicKeyToAsn1(v.publicKey),I(v)]);return _},r.distinguishedNameToAsn1=function(v){return f(v)},r.certificateToAsn1=function(v){var _=v.tbsCertificate||r.getTBSCertificate(v);return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[_,e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(v.signatureOid).getBytes()),D(v.signatureOid,v.signatureParameters)]),e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,String.fromCharCode(0)+v.signature)])},r.certificateExtensionsToAsn1=function(v){var _=e.create(e.Class.CONTEXT_SPECIFIC,3,!0,[]),A=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);_.value.push(A);for(var d=0;d<v.length;++d)A.value.push(r.certificateExtensionToAsn1(v[d]));return _},r.certificateExtensionToAsn1=function(v){var _=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[]);_.value.push(e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(v.id).getBytes())),v.critical&&_.value.push(e.create(e.Class.UNIVERSAL,e.Type.BOOLEAN,!1,String.fromCharCode(255)));var A=v.value;return typeof v.value!="string"&&(A=e.toDer(A).getBytes()),_.value.push(e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,A)),_},r.certificationRequestToAsn1=function(v){var _=v.certificationRequestInfo||r.getCertificationRequestInfo(v);return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[_,e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(v.signatureOid).getBytes()),D(v.signatureOid,v.signatureParameters)]),e.create(e.Class.UNIVERSAL,e.Type.BITSTRING,!1,String.fromCharCode(0)+v.signature)])},r.createCaStore=function(v){var _={certs:{}};_.getIssuer=function(b){var C=A(b.issuer);return C},_.addCertificate=function(b){if(typeof b=="string"&&(b=B.pki.certificateFromPem(b)),d(b.subject),!_.hasCertificate(b))if(b.subject.hash in _.certs){var C=_.certs[b.subject.hash];B.util.isArray(C)||(C=[C]),C.push(b),_.certs[b.subject.hash]=C}else _.certs[b.subject.hash]=b},_.hasCertificate=function(b){typeof b=="string"&&(b=B.pki.certificateFromPem(b));var C=A(b.subject);if(!C)return!1;B.util.isArray(C)||(C=[C]);for(var P=e.toDer(r.certificateToAsn1(b)).getBytes(),M=0;M<C.length;++M){var O=e.toDer(r.certificateToAsn1(C[M])).getBytes();if(P===O)return!0}return!1},_.listAllCertificates=function(){var b=[];for(var C in _.certs)if(_.certs.hasOwnProperty(C)){var P=_.certs[C];if(!B.util.isArray(P))b.push(P);else for(var M=0;M<P.length;++M)b.push(P[M])}return b},_.removeCertificate=function(b){var C;if(typeof b=="string"&&(b=B.pki.certificateFromPem(b)),d(b.subject),!_.hasCertificate(b))return null;var P=A(b.subject);if(!B.util.isArray(P))return C=_.certs[b.subject.hash],delete _.certs[b.subject.hash],C;for(var M=e.toDer(r.certificateToAsn1(b)).getBytes(),O=0;O<P.length;++O){var x=e.toDer(r.certificateToAsn1(P[O])).getBytes();M===x&&(C=P[O],P.splice(O,1))}return P.length===0&&delete _.certs[b.subject.hash],C};function A(b){return d(b),_.certs[b.hash]||null}function d(b){if(!b.hash){var C=B.md.sha1.create();b.attributes=r.RDNAttributesAsArray(f(b),C),b.hash=C.digest().toHex()}}if(v)for(var g=0;g<v.length;++g){var E=v[g];_.addCertificate(E)}return _},r.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},r.verifyCertificateChain=function(v,_,A){typeof A=="function"&&(A={verify:A}),A=A||{},_=_.slice(0);var d=_.slice(0),g=A.validityCheckDate;typeof g=="undefined"&&(g=new Date);var E=!0,b=null,C=0;do{var P=_.shift(),M=null,O=!1;if(g&&((g<P.validity.notBefore||g>P.validity.notAfter)&&(b={message:"Certificate is not valid yet or has expired.",error:r.certificateError.certificate_expired,notBefore:P.validity.notBefore,notAfter:P.validity.notAfter,now:g})),b===null){if(M=_[0]||v.getIssuer(P),M===null&&(P.isIssuer(P)&&(O=!0,M=P)),M){var x=M;B.util.isArray(x)||(x=[x]);for(var F=!1;!F&&x.length>0;){M=x.shift();try{F=M.verify(P)}catch(_e){}}F||(b={message:"Certificate signature is invalid.",error:r.certificateError.bad_certificate})}b===null&&(!M||O)&&!v.hasCertificate(P)&&(b={message:"Certificate is not trusted.",error:r.certificateError.unknown_ca})}if(b===null&&M&&!P.isIssuer(M)&&(b={message:"Certificate issuer is invalid.",error:r.certificateError.bad_certificate}),b===null)for(var q={keyUsage:!0,basicConstraints:!0},z=0;b===null&&z<P.extensions.length;++z){var ee=P.extensions[z];ee.critical&&!(ee.name in q)&&(b={message:"Certificate has an unsupported critical extension.",error:r.certificateError.unsupported_certificate})}if(b===null&&(!E||_.length===0&&(!M||O))){var Z=P.getExtension("basicConstraints"),he=P.getExtension("keyUsage");if(he!==null&&((!he.keyCertSign||Z===null)&&(b={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:r.certificateError.bad_certificate})),b===null&&Z!==null&&!Z.cA&&(b={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:r.certificateError.bad_certificate}),b===null&&he!==null&&"pathLenConstraint"in Z){var be=C-1;be>Z.pathLenConstraint&&(b={message:"Certificate basicConstraints pathLenConstraint violated.",error:r.certificateError.bad_certificate})}}var se=b===null?!0:b.error,ae=A.verify?A.verify(se,C,d):se;if(ae===!0)b=null;else throw se===!0&&(b={message:"The application rejected the certificate.",error:r.certificateError.bad_certificate}),(ae||ae===0)&&(typeof ae=="object"&&!B.util.isArray(ae)?(ae.message&&(b.message=ae.message),ae.error&&(b.error=ae.error)):typeof ae=="string"&&(b.error=ae)),b;E=!1,++C}while(_.length>0);return!0}}),sR=re(function(t){var e=B.asn1,r=t.exports=B.pkcs7=B.pkcs7||{};r.messageFromPem=function(p){var S=B.pem.decode(p)[0];if(S.type!=="PKCS7"){var D=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw D.headerType=S.type,D}if(S.procType&&S.procType.type==="ENCRYPTED")throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var I=e.fromDer(S.body);return r.messageFromAsn1(I)},r.messageToPem=function(p,S){var D={type:"PKCS7",body:e.toDer(p.toAsn1()).getBytes()};return B.pem.encode(D,{maxline:S})},r.messageFromAsn1=function(p){var S={},D=[];if(!e.validate(p,r.asn1.contentInfoValidator,S,D)){var I=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw I.errors=D,I}var k=e.derToOid(S.contentType),V;switch(k){case B.pki.oids.envelopedData:V=r.createEnvelopedData();break;case B.pki.oids.encryptedData:V=r.createEncryptedData();break;case B.pki.oids.signedData:V=r.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+k+" is not (yet) supported.")}return V.fromAsn1(S.content.value[0]),V},r.createSignedData=function(){var p=null;return p={type:B.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(I){if(h(p,I,r.asn1.signedDataValidator),p.certificates=[],p.crls=[],p.digestAlgorithmIdentifiers=[],p.contentInfo=null,p.signerInfos=[],p.rawCapture.certificates)for(var k=p.rawCapture.certificates.value,V=0;V<k.length;++V)p.certificates.push(B.pki.certificateFromAsn1(k[V]))},toAsn1:function(){p.contentInfo||p.sign();for(var I=[],k=0;k<p.certificates.length;++k)I.push(B.pki.certificateToAsn1(p.certificates[k]));var V=[],H=e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(p.version).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,p.digestAlgorithmIdentifiers),p.contentInfo])]);return I.length>0&&H.value[0].value.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!0,I)),V.length>0&&H.value[0].value.push(e.create(e.Class.CONTEXT_SPECIFIC,1,!0,V)),H.value[0].value.push(e.create(e.Class.UNIVERSAL,e.Type.SET,!0,p.signerInfos)),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.type).getBytes()),H])},addSigner:function(I){var k=I.issuer,V=I.serialNumber;if(I.certificate){var H=I.certificate;typeof H=="string"&&(H=B.pki.certificateFromPem(H)),k=H.issuer.attributes,V=H.serialNumber}var v=I.key;if(!v)throw new Error("Could not add PKCS#7 signer; no private key specified.");typeof v=="string"&&(v=B.pki.privateKeyFromPem(v));var _=I.digestAlgorithm||B.pki.oids.sha1;switch(_){case B.pki.oids.sha1:case B.pki.oids.sha256:case B.pki.oids.sha384:case B.pki.oids.sha512:case B.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+_)}var A=I.authenticatedAttributes||[];if(A.length>0){for(var d=!1,g=!1,E=0;E<A.length;++E){var b=A[E];if(!d&&b.type===B.pki.oids.contentType){if(d=!0,g)break;continue}if(!g&&b.type===B.pki.oids.messageDigest){if(g=!0,d)break;continue}}if(!d||!g)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}p.signers.push({key:v,version:1,issuer:k,serialNumber:V,digestAlgorithm:_,signatureAlgorithm:B.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:A,unauthenticatedAttributes:[]})},sign:function(I){if(I=I||{},(typeof p.content!="object"||p.contentInfo===null)&&(p.contentInfo=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(B.pki.oids.data).getBytes())]),"content"in p)){var k;p.content instanceof B.util.ByteBuffer?k=p.content.bytes():typeof p.content=="string"&&(k=B.util.encodeUtf8(p.content)),I.detached?p.detachedContent=e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,k):p.contentInfo.value.push(e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,k)]))}if(p.signers.length===0)return;var V=S();D(V)},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(I){typeof I=="string"&&(I=B.pki.certificateFromPem(I)),p.certificates.push(I)},addCertificateRevokationList:function(I){throw new Error("PKCS#7 CRL support not yet implemented.")}},p;function S(){for(var I={},k=0;k<p.signers.length;++k){var V=p.signers[k],H=V.digestAlgorithm;H in I||(I[H]=B.md[B.pki.oids[H]].create()),V.authenticatedAttributes.length===0?V.md=I[H]:V.md=B.md[B.pki.oids[H]].create()}p.digestAlgorithmIdentifiers=[];for(var H in I)p.digestAlgorithmIdentifiers.push(e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(H).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")]));return I}function D(I){var k;if(p.detachedContent?k=p.detachedContent:(k=p.contentInfo.value[1],k=k.value[0]),!k)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var V=e.derToOid(p.contentInfo.value[0].value),H=e.toDer(k);H.getByte(),e.getBerValueLength(H),H=H.getBytes();for(var v in I)I[v].start().update(H);for(var _=new Date,A=0;A<p.signers.length;++A){var d=p.signers[A];if(d.authenticatedAttributes.length===0){if(V!==B.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{d.authenticatedAttributesAsn1=e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var g=e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[]),E=0;E<d.authenticatedAttributes.length;++E){var b=d.authenticatedAttributes[E];b.type===B.pki.oids.messageDigest?b.value=I[d.digestAlgorithm].digest():b.type===B.pki.oids.signingTime&&(b.value||(b.value=_)),g.value.push(l(b)),d.authenticatedAttributesAsn1.value.push(l(b))}H=e.toDer(g).getBytes(),d.md.start().update(H)}d.signature=d.key.sign(d.md,"RSASSA-PKCS1-V1_5")}p.signerInfos=o(p.signers)}},r.createEncryptedData=function(){var p=null;return p={type:B.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:B.pki.oids["aes256-CBC"]},fromAsn1:function(S){h(p,S,r.asn1.encryptedDataValidator)},decrypt:function(S){S!==void 0&&(p.encryptedContent.key=S),f(p)}},p},r.createEnvelopedData=function(){var p=null;return p={type:B.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:B.pki.oids["aes256-CBC"]},fromAsn1:function(S){var D=h(p,S,r.asn1.envelopedDataValidator);p.recipients=s(D.recipientInfos.value)},toAsn1:function(){return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.type).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(p.version).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,a(p.recipients)),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,u(p.encryptedContent))])])])},findRecipient:function(S){for(var D=S.issuer.attributes,I=0;I<p.recipients.length;++I){var k=p.recipients[I],V=k.issuer;if(k.serialNumber!==S.serialNumber)continue;if(V.length!==D.length)continue;for(var H=!0,v=0;v<D.length;++v)if(V[v].type!==D[v].type||V[v].value!==D[v].value){H=!1;break}if(H)return k}return null},decrypt:function(S,D){if(p.encryptedContent.key===void 0&&S!==void 0&&D!==void 0)switch(S.encryptedContent.algorithm){case B.pki.oids.rsaEncryption:case B.pki.oids.desCBC:var I=D.decrypt(S.encryptedContent.content);p.encryptedContent.key=B.util.createBuffer(I);break;default:throw new Error("Unsupported asymmetric cipher, OID "+S.encryptedContent.algorithm)}f(p)},addRecipient:function(S){p.recipients.push({version:0,issuer:S.issuer.attributes,serialNumber:S.serialNumber,encryptedContent:{algorithm:B.pki.oids.rsaEncryption,key:S.publicKey}})},encrypt:function(S,D){if(p.encryptedContent.content===void 0){D=D||p.encryptedContent.algorithm,S=S||p.encryptedContent.key;var I,k,V;switch(D){case B.pki.oids["aes128-CBC"]:I=16,k=16,V=B.aes.createEncryptionCipher;break;case B.pki.oids["aes192-CBC"]:I=24,k=16,V=B.aes.createEncryptionCipher;break;case B.pki.oids["aes256-CBC"]:I=32,k=16,V=B.aes.createEncryptionCipher;break;case B.pki.oids["des-EDE3-CBC"]:I=24,k=8,V=B.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+D)}if(S===void 0)S=B.util.createBuffer(B.random.getBytes(I));else if(S.length()!=I)throw new Error("Symmetric key has wrong length; got "+S.length()+" bytes, expected "+I+".");p.encryptedContent.algorithm=D,p.encryptedContent.key=S,p.encryptedContent.parameter=B.util.createBuffer(B.random.getBytes(k));var H=V(S);if(H.start(p.encryptedContent.parameter.copy()),H.update(p.content),!H.finish())throw new Error("Symmetric encryption failed.");p.encryptedContent.content=H.output}for(var v=0;v<p.recipients.length;++v){var _=p.recipients[v];if(_.encryptedContent.content!==void 0)continue;switch(_.encryptedContent.algorithm){case B.pki.oids.rsaEncryption:_.encryptedContent.content=_.encryptedContent.key.encrypt(p.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+_.encryptedContent.algorithm)}}}},p};function n(p){var S={},D=[];if(!e.validate(p,r.asn1.recipientInfoValidator,S,D)){var I=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw I.errors=D,I}return{version:S.version.charCodeAt(0),issuer:B.pki.RDNAttributesAsArray(S.issuer),serialNumber:B.util.createBuffer(S.serial).toHex(),encryptedContent:{algorithm:e.derToOid(S.encAlgorithm),parameter:S.encParameter.value,content:S.encKey}}}function i(p){return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(p.version).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[B.pki.distinguishedNameToAsn1({attributes:p.issuer}),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,B.util.hexToBytes(p.serialNumber))]),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.encryptedContent.algorithm).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")]),e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.encryptedContent.content)])}function s(p){for(var S=[],D=0;D<p.length;++D)S.push(n(p[D]));return S}function a(p){for(var S=[],D=0;D<p.length;++D)S.push(i(p[D]));return S}function c(p){var S=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(p.version).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[B.pki.distinguishedNameToAsn1({attributes:p.issuer}),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,B.util.hexToBytes(p.serialNumber))]),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.digestAlgorithm).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")])]);if(p.authenticatedAttributesAsn1&&S.value.push(p.authenticatedAttributesAsn1),S.value.push(e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.signatureAlgorithm).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")])),S.value.push(e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.signature)),p.unauthenticatedAttributes.length>0){for(var D=e.create(e.Class.CONTEXT_SPECIFIC,1,!0,[]),I=0;I<p.unauthenticatedAttributes.length;++I){var k=p.unauthenticatedAttributes[I];D.values.push(l(k))}S.value.push(D)}return S}function o(p){for(var S=[],D=0;D<p.length;++D)S.push(c(p[D]));return S}function l(p){var S;if(p.type===B.pki.oids.contentType)S=e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.value).getBytes());else if(p.type===B.pki.oids.messageDigest)S=e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.value.bytes());else if(p.type===B.pki.oids.signingTime){var D=new Date("1950-01-01T00:00:00Z"),I=new Date("2050-01-01T00:00:00Z"),k=p.value;if(typeof k=="string"){var V=Date.parse(k);isNaN(V)?k.length===13?k=e.utcTimeToDate(k):k=e.generalizedTimeToDate(k):k=new Date(V)}k>=D&&k<I?S=e.create(e.Class.UNIVERSAL,e.Type.UTCTIME,!1,e.dateToUtcTime(k)):S=e.create(e.Class.UNIVERSAL,e.Type.GENERALIZEDTIME,!1,e.dateToGeneralizedTime(k))}return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.type).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[S])])}function u(p){return[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(B.pki.oids.data).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(p.algorithm).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.parameter.getBytes())]),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,p.content.getBytes())])]}function h(p,S,D){var I={},k=[];if(!e.validate(S,D,I,k)){var V=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw V.errors=V,V}var H=e.derToOid(I.contentType);if(H!==B.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(I.encryptedContent){var v="";if(B.util.isArray(I.encryptedContent))for(var _=0;_<I.encryptedContent.length;++_){if(I.encryptedContent[_].type!==e.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");v+=I.encryptedContent[_].value}else v=I.encryptedContent;p.encryptedContent={algorithm:e.derToOid(I.encAlgorithm),parameter:B.util.createBuffer(I.encParameter.value),content:B.util.createBuffer(v)}}if(I.content){var v="";if(B.util.isArray(I.content))for(var _=0;_<I.content.length;++_){if(I.content[_].type!==e.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");v+=I.content[_].value}else v=I.content;p.content=B.util.createBuffer(v)}return p.version=I.version.charCodeAt(0),p.rawCapture=I,I}function f(p){if(p.encryptedContent.key===void 0)throw new Error("Symmetric key not available.");if(p.content===void 0){var S;switch(p.encryptedContent.algorithm){case B.pki.oids["aes128-CBC"]:case B.pki.oids["aes192-CBC"]:case B.pki.oids["aes256-CBC"]:S=B.aes.createDecryptionCipher(p.encryptedContent.key);break;case B.pki.oids.desCBC:case B.pki.oids["des-EDE3-CBC"]:S=B.des.createDecryptionCipher(p.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+p.encryptedContent.algorithm)}if(S.start(p.encryptedContent.parameter),S.update(p.encryptedContent.content),!S.finish())throw new Error("Symmetric decryption failed.");p.content=S.output}}}),Ub=re(function(t,e){const r=B.pki;e=t.exports,e.certificateForKey=(i,s)=>{const a=r.setRsaPublicKey(s.n,s.e),c=r.createCertificate();c.publicKey=a,c.serialNumber="01",c.validity.notBefore=new Date,c.validity.notAfter=new Date,c.validity.notAfter.setFullYear(c.validity.notBefore.getFullYear()+10);const o=[{name:"organizationName",value:"ipfs"},{shortName:"OU",value:"keystore"},{name:"commonName",value:i.id}];return c.setSubject(o),c.setIssuer(o),c.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"extKeyUsage",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:"nsCertType",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),c.sign(s),c};async function n(i,s){const a=i.map(s),c=await Promise.all(a),o=c.findIndex(l=>l);return i[o]}t.exports.findAsync=n});const{certificateForKey:Fb,findAsync:qb}=Ub;class Gb{constructor(t){if(!t)throw U(new Error("keychain is required"),"ERR_KEYCHAIN_REQUIRED");this.keychain=t}async encrypt(t,e){if(!(e instanceof Uint8Array))throw U(new Error("Plain data must be a Uint8Array"),"ERR_INVALID_PARAMS");const r=await this.keychain.findKeyByName(t),n=await this.keychain._getPrivateKey(t),i=B.pki.decryptRsaPrivateKey(n,this.keychain._()),s=await Fb(r,i),a=B.pkcs7.createEnvelopedData();a.addRecipient(s),a.content=B.util.createBuffer(e),a.encrypt();const c=B.asn1.toDer(a.toAsn1()).getBytes();return $e(c,"ascii")}async decrypt(t){if(!(t instanceof Uint8Array))throw U(new Error("CMS data is required"),"ERR_INVALID_PARAMS");let e;try{const c=B.util.createBuffer(Ee(t,"ascii")),o=B.asn1.fromDer(c);e=B.pkcs7.messageFromAsn1(o)}catch(c){throw U(new Error("Invalid CMS: "+c.message),"ERR_INVALID_CMS")}const r=e.recipients.filter(c=>c.issuer.find(o=>o.shortName==="O"&&o.value==="ipfs")).filter(c=>c.issuer.find(o=>o.shortName==="CN")).map(c=>({recipient:c,keyId:c.issuer.find(o=>o.shortName==="CN").value})),n=await qb(r,async c=>{try{const o=await this.keychain.findKeyById(c.keyId);if(o)return!0}catch(o){return!1}return!1});if(!n){const c=r.map(o=>o.keyId);throw U(new Error("Decryption needs one of the key(s): "+c.join(", ")),"ERR_MISSING_KEYS",{missingKeys:c})}const i=await this.keychain.findKeyById(n.keyId),s=await this.keychain._getPrivateKey(i.name),a=B.pki.decryptRsaPrivateKey(s,this.keychain._());return e.decrypt(n.recipient,a),$e(e.content.getBytes(),"ascii")}}var Vb=Gb;const{Number:$b}=Ln,Hb="/pkcs8/",xu="/info/",Fn={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},Xo={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function xr(t){return t?typeof t!="string"?!1:t===Bb(t.trim()):!1}async function De(t){const e=200,r=1e3,n=Math.random()*(r-e)+e;throw await new Promise(i=>setTimeout(i,n)),t}function ln(t){return new mo.Key(Hb+t)}function qn(t){return new mo.Key(xu+t)}class zb{constructor(t,e){if(!t)throw new Error("store is required");if(this.store=t,this.opts=ca(Xo,e),this.opts.passPhrase&&this.opts.passPhrase.length<20)throw new Error("passPhrase must be least 20 characters");if(this.opts.dek.keyLength<Fn.minKeyLength)throw new Error(`dek.keyLength must be least ${Fn.minKeyLength} bytes`);if(this.opts.dek.salt.length<Fn.minSaltLength)throw new Error(`dek.saltLength must be least ${Fn.minSaltLength} bytes`);if(this.opts.dek.iterationCount<Fn.minIterationCount)throw new Error(`dek.iterationCount must be least ${Fn.minIterationCount}`);const r=this.opts.passPhrase?Kt.pbkdf2(this.opts.passPhrase,this.opts.dek.salt,this.opts.dek.iterationCount,this.opts.dek.keyLength,this.opts.dek.hash):"";Object.defineProperty(this,"_",{value:()=>r})}get cms(){return new Vb(this)}static generateOptions(){const t=Object.assign({},Xo),e=Math.ceil(Fn.minSaltLength/3)*3;return t.dek.salt=Ee(Kt.randomBytes(e),"base64"),t}static get options(){return Xo}async createKey(t,e,r){const n=this;if(!xr(t)||t==="self")return De(U(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));if(typeof e!="string")return De(U(new Error(`Invalid key type '${e}'`),"ERR_INVALID_KEY_TYPE"));const i=ln(t),s=await n.store.has(i);if(s)return De(U(new Error(`Key '${t}' already exists`),"ERR_KEY_ALREADY_EXISTS"));switch(e.toLowerCase()){case"rsa":if(!$b.isSafeInteger(r)||r<2048)return De(U(new Error(`Invalid RSA key size ${r}`),"ERR_INVALID_KEY_SIZE"));break}let a;try{const c=await Kt.keys.generateKeyPair(e,r),o=await c.id(),l=await c.export(this._());a={name:t,id:o};const u=n.store.batch();u.put(i,$e(l)),u.put(qn(t),$e(JSON.stringify(a))),await u.commit()}catch(c){return De(c)}return a}async listKeys(){const t=this,e={prefix:xu},r=[];for await(const n of t.store.query(e))r.push(JSON.parse(Ee(n.value)));return r}async findKeyById(t){try{const e=await this.listKeys();return e.find(r=>r.id===t)}catch(e){return De(e)}}async findKeyByName(t){if(!xr(t))return De(U(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));const e=qn(t);try{const r=await this.store.get(e);return JSON.parse(Ee(r))}catch(r){return De(U(new Error(`Key '${t}' does not exist. ${r.message}`),"ERR_KEY_NOT_FOUND"))}}async removeKey(t){const e=this;if(!xr(t)||t==="self")return De(U(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));const r=ln(t),n=await e.findKeyByName(t),i=e.store.batch();return i.delete(r),i.delete(qn(t)),await i.commit(),n}async renameKey(t,e){const r=this;if(!xr(t)||t==="self")return De(U(new Error(`Invalid old key name '${t}'`),"ERR_OLD_KEY_NAME_INVALID"));if(!xr(e)||e==="self")return De(U(new Error(`Invalid new key name '${e}'`),"ERR_NEW_KEY_NAME_INVALID"));const n=ln(t),i=ln(e),s=qn(t),a=qn(e),c=await r.store.has(i);if(c)return De(U(new Error(`Key '${e}' already exists`),"ERR_KEY_ALREADY_EXISTS"));try{const o=await r.store.get(n),l=await r.store.get(s),u=JSON.parse(Ee(l));u.name=e;const h=r.store.batch();return h.put(i,o),h.put(a,$e(JSON.stringify(u))),h.delete(n),h.delete(s),await h.commit(),u}catch(o){return De(o)}}async exportKey(t,e){if(!xr(t))return De(U(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));if(!e)return De(U(new Error("Password is required"),"ERR_PASSWORD_REQUIRED"));const r=ln(t);try{const n=await this.store.get(r),i=Ee(n),s=await Kt.keys.import(i,this._());return s.export(e)}catch(n){return De(n)}}async importKey(t,e,r){const n=this;if(!xr(t)||t==="self")return De(U(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));if(!e)return De(U(new Error("PEM encoded key is required"),"ERR_PEM_REQUIRED"));const i=ln(t),s=await n.store.has(i);if(s)return De(U(new Error(`Key '${t}' already exists`),"ERR_KEY_ALREADY_EXISTS"));let a;try{a=await Kt.keys.import(e,r)}catch(u){return De(U(new Error("Cannot read the key, most likely the password is wrong"),"ERR_CANNOT_READ_KEY"))}let c;try{c=await a.id(),e=await a.export(this._())}catch(u){return De(u)}const o={name:t,id:c},l=n.store.batch();return l.put(i,$e(e)),l.put(qn(t),$e(JSON.stringify(o))),await l.commit(),o}async importPeer(t,e){const r=this;if(!xr(t))return De(U(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));if(!e||!e.privKey)return De(U(new Error("Peer.privKey is required"),"ERR_MISSING_PRIVATE_KEY"));const n=e.privKey,i=ln(t),s=await r.store.has(i);if(s)return De(U(new Error(`Key '${t}' already exists`),"ERR_KEY_ALREADY_EXISTS"));try{const a=await n.id(),c=await n.export(this._()),o={name:t,id:a},l=r.store.batch();return l.put(i,$e(c)),l.put(qn(t),$e(JSON.stringify(o))),await l.commit(),o}catch(a){return De(a)}}async _getPrivateKey(t){if(!xr(t))return De(U(new Error(`Invalid key name '${t}'`),"ERR_INVALID_KEY_NAME"));try{const e=ln(t),r=await this.store.get(e);return Ee(r)}catch(e){return De(U(new Error(`Key '${t}' does not exist. ${e.message}`),"ERR_KEY_NOT_FOUND"))}}}var Lu=zb,Kb=t=>{const e=hf(t);return e.delete=e.remove,e},Wb=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Qo=Math.ceil,yr=Math.floor,Pt="[BigNumber Error] ",ju=Pt+"Number primitive has more than 15 significant digits: ",cr=1e14,de=14,Yo=9007199254740991,Jo=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],un=1e7,st=1e9;function Bu(t){var e,r,n,i=k.prototype={constructor:k,toString:null,valueOf:null},s=new k(1),a=20,c=4,o=-7,l=21,u=-1e7,h=1e7,f=!1,p=1,S=0,D={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},I="0123456789abcdefghijklmnopqrstuvwxyz";function k(d,g){var E,b,C,P,M,O,x,F,q=this;if(!(q instanceof k))return new k(d,g);if(g==null){if(d&&d._isBigNumber===!0){q.s=d.s,!d.c||d.e>h?q.c=q.e=null:d.e<u?q.c=[q.e=0]:(q.e=d.e,q.c=d.c.slice());return}if((O=typeof d=="number")&&d*0==0){if(q.s=1/d<0?(d=-d,-1):1,d===~~d){for(P=0,M=d;M>=10;M/=10,P++);P>h?q.c=q.e=null:(q.e=P,q.c=[d]);return}F=String(d)}else{if(!Wb.test(F=String(d)))return n(q,F,O);q.s=F.charCodeAt(0)==45?(F=F.slice(1),-1):1}(P=F.indexOf("."))>-1&&(F=F.replace(".","")),(M=F.search(/e/i))>0?(P<0&&(P=M),P+=+F.slice(M+1),F=F.substring(0,M)):P<0&&(P=F.length)}else{if(Ue(g,2,I.length,"Base"),g==10)return q=new k(d),_(q,a+q.e+1,c);if(F=String(d),O=typeof d=="number"){if(d*0!=0)return n(q,F,O,g);if(q.s=1/d<0?(F=F.slice(1),-1):1,k.DEBUG&&F.replace(/^0\.0*|\./,"").length>15)throw Error(ju+d)}else q.s=F.charCodeAt(0)===45?(F=F.slice(1),-1):1;for(E=I.slice(0,g),P=M=0,x=F.length;M<x;M++)if(E.indexOf(b=F.charAt(M))<0){if(b=="."){if(M>P){P=x;continue}}else if(!C&&(F==F.toUpperCase()&&(F=F.toLowerCase())||F==F.toLowerCase()&&(F=F.toUpperCase()))){C=!0,M=-1,P=0;continue}return n(q,String(d),O,g)}O=!1,F=r(F,g,10,q.s),(P=F.indexOf("."))>-1?F=F.replace(".",""):P=F.length}for(M=0;F.charCodeAt(M)===48;M++);for(x=F.length;F.charCodeAt(--x)===48;);if(F=F.slice(M,++x)){if(x-=M,O&&k.DEBUG&&x>15&&(d>Yo||d!==yr(d)))throw Error(ju+q.s*d);if((P=P-M-1)>h)q.c=q.e=null;else if(P<u)q.c=[q.e=0];else{if(q.e=P,q.c=[],M=(P+1)%de,P<0&&(M+=de),M<x){for(M&&q.c.push(+F.slice(0,M)),x-=de;M<x;)q.c.push(+F.slice(M,M+=de));M=de-(F=F.slice(M)).length}else M-=x;for(;M--;F+="0");q.c.push(+F)}}else q.c=[q.e=0]}k.clone=Bu,k.ROUND_UP=0,k.ROUND_DOWN=1,k.ROUND_CEIL=2,k.ROUND_FLOOR=3,k.ROUND_HALF_UP=4,k.ROUND_HALF_DOWN=5,k.ROUND_HALF_EVEN=6,k.ROUND_HALF_CEIL=7,k.ROUND_HALF_FLOOR=8,k.EUCLID=9,k.config=k.set=function(d){var g,E;if(d!=null)if(typeof d=="object"){if(d.hasOwnProperty(g="DECIMAL_PLACES")&&(E=d[g],Ue(E,0,st,g),a=E),d.hasOwnProperty(g="ROUNDING_MODE")&&(E=d[g],Ue(E,0,8,g),c=E),d.hasOwnProperty(g="EXPONENTIAL_AT")&&(E=d[g],E&&E.pop?(Ue(E[0],-st,0,g),Ue(E[1],0,st,g),o=E[0],l=E[1]):(Ue(E,-st,st,g),o=-(l=E<0?-E:E))),d.hasOwnProperty(g="RANGE"))if(E=d[g],E&&E.pop)Ue(E[0],-st,-1,g),Ue(E[1],1,st,g),u=E[0],h=E[1];else if(Ue(E,-st,st,g),E)u=-(h=E<0?-E:E);else throw Error(Pt+g+" cannot be zero: "+E);if(d.hasOwnProperty(g="CRYPTO"))if(E=d[g],E===!!E)if(E)if(typeof crypto!="undefined"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))f=E;else throw f=!E,Error(Pt+"crypto unavailable");else f=E;else throw Error(Pt+g+" not true or false: "+E);if(d.hasOwnProperty(g="MODULO_MODE")&&(E=d[g],Ue(E,0,9,g),p=E),d.hasOwnProperty(g="POW_PRECISION")&&(E=d[g],Ue(E,0,st,g),S=E),d.hasOwnProperty(g="FORMAT"))if(E=d[g],typeof E=="object")D=E;else throw Error(Pt+g+" not an object: "+E);if(d.hasOwnProperty(g="ALPHABET"))if(E=d[g],typeof E=="string"&&!/^.$|[+-.\s]|(.).*\1/.test(E))I=E;else throw Error(Pt+g+" invalid: "+E)}else throw Error(Pt+"Object expected: "+d);return{DECIMAL_PLACES:a,ROUNDING_MODE:c,EXPONENTIAL_AT:[o,l],RANGE:[u,h],CRYPTO:f,MODULO_MODE:p,POW_PRECISION:S,FORMAT:D,ALPHABET:I}},k.isBigNumber=function(d){if(!d||d._isBigNumber!==!0)return!1;if(!k.DEBUG)return!0;var g,E,b=d.c,C=d.e,P=d.s;e:if({}.toString.call(b)=="[object Array]"){if((P===1||P===-1)&&C>=-st&&C<=st&&C===yr(C)){if(b[0]===0){if(C===0&&b.length===1)return!0;break e}if(g=(C+1)%de,g<1&&(g+=de),String(b[0]).length==g){for(g=0;g<b.length;g++)if(E=b[g],E<0||E>=cr||E!==yr(E))break e;if(E!==0)return!0}}}else if(b===null&&C===null&&(P===null||P===1||P===-1))return!0;throw Error(Pt+"Invalid BigNumber: "+d)},k.maximum=k.max=function(){return H(arguments,i.lt)},k.minimum=k.min=function(){return H(arguments,i.gt)},k.random=function(){var d=9007199254740992,g=Math.random()*d&2097151?function(){return yr(Math.random()*d)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(E){var b,C,P,M,O,x=0,F=[],q=new k(s);if(E==null?E=a:Ue(E,0,st),M=Qo(E/de),f)if(crypto.getRandomValues){for(b=crypto.getRandomValues(new Uint32Array(M*=2));x<M;)O=b[x]*131072+(b[x+1]>>>11),O>=9e15?(C=crypto.getRandomValues(new Uint32Array(2)),b[x]=C[0],b[x+1]=C[1]):(F.push(O%1e14),x+=2);x=M/2}else if(crypto.randomBytes){for(b=crypto.randomBytes(M*=7);x<M;)O=(b[x]&31)*281474976710656+b[x+1]*1099511627776+b[x+2]*4294967296+b[x+3]*16777216+(b[x+4]<<16)+(b[x+5]<<8)+b[x+6],O>=9e15?crypto.randomBytes(7).copy(b,x):(F.push(O%1e14),x+=7);x=M/7}else throw f=!1,Error(Pt+"crypto unavailable");if(!f)for(;x<M;)O=g(),O<9e15&&(F[x++]=O%1e14);for(M=F[--x],E%=de,M&&E&&(O=Jo[de-E],F[x]=yr(M/O)*O);F[x]===0;F.pop(),x--);if(x<0)F=[P=0];else{for(P=-1;F[0]===0;F.splice(0,1),P-=de);for(x=1,O=F[0];O>=10;O/=10,x++);x<de&&(P-=de-x)}return q.e=P,q.c=F,q}}(),k.sum=function(){for(var d=1,g=arguments,E=new k(g[0]);d<g.length;)E=E.plus(g[d++]);return E},r=function(){var d="0123456789";function g(E,b,C,P){for(var M,O=[0],x,F=0,q=E.length;F<q;){for(x=O.length;x--;O[x]*=b);for(O[0]+=P.indexOf(E.charAt(F++)),M=0;M<O.length;M++)O[M]>C-1&&(O[M+1]==null&&(O[M+1]=0),O[M+1]+=O[M]/C|0,O[M]%=C)}return O.reverse()}return function(E,b,C,P,M){var O,x,F,q,z,ee,Z,he,be=E.indexOf("."),se=a,ae=c;for(be>=0&&(q=S,S=0,E=E.replace(".",""),he=new k(b),ee=he.pow(E.length-be),S=q,he.c=g(Lr(Yt(ee.c),ee.e,"0"),10,C,d),he.e=he.c.length),Z=g(E,b,C,M?(O=I,d):(O=d,I)),F=q=Z.length;Z[--q]==0;Z.pop());if(!Z[0])return O.charAt(0);if(be<0?--F:(ee.c=Z,ee.e=F,ee.s=P,ee=e(ee,he,se,ae,C),Z=ee.c,z=ee.r,F=ee.e),x=F+se+1,be=Z[x],q=C/2,z=z||x<0||Z[x+1]!=null,z=ae<4?(be!=null||z)&&(ae==0||ae==(ee.s<0?3:2)):be>q||be==q&&(ae==4||z||ae==6&&Z[x-1]&1||ae==(ee.s<0?8:7)),x<1||!Z[0])E=z?Lr(O.charAt(1),-se,O.charAt(0)):O.charAt(0);else{if(Z.length=x,z)for(--C;++Z[--x]>C;)Z[x]=0,x||(++F,Z=[1].concat(Z));for(q=Z.length;!Z[--q];);for(be=0,E="";be<=q;E+=O.charAt(Z[be++]));E=Lr(E,F,O.charAt(0))}return E}}(),e=function(){function d(b,C,P){var M,O,x,F,q=0,z=b.length,ee=C%un,Z=C/un|0;for(b=b.slice();z--;)x=b[z]%un,F=b[z]/un|0,M=Z*x+F*ee,O=ee*x+M%un*un+q,q=(O/P|0)+(M/un|0)+Z*F,b[z]=O%P;return q&&(b=[q].concat(b)),b}function g(b,C,P,M){var O,x;if(P!=M)x=P>M?1:-1;else for(O=x=0;O<P;O++)if(b[O]!=C[O]){x=b[O]>C[O]?1:-1;break}return x}function E(b,C,P,M){for(var O=0;P--;)b[P]-=O,O=b[P]<C[P]?1:0,b[P]=O*M+b[P]-C[P];for(;!b[0]&&b.length>1;b.splice(0,1));}return function(b,C,P,M,O){var x,F,q,z,ee,Z,he,be,se,ae,_e,Me,rr,Mt,ut,rt,Ft,Qe=b.s==C.s?1:-1,Ve=b.c,oe=C.c;if(!Ve||!Ve[0]||!oe||!oe[0])return new k(!b.s||!C.s||(Ve?oe&&Ve[0]==oe[0]:!oe)?NaN:Ve&&Ve[0]==0||!oe?Qe*0:Qe/0);for(be=new k(Qe),se=be.c=[],F=b.e-C.e,Qe=P+F+1,O||(O=cr,F=Qt(b.e/de)-Qt(C.e/de),Qe=Qe/de|0),q=0;oe[q]==(Ve[q]||0);q++);if(oe[q]>(Ve[q]||0)&&F--,Qe<0)se.push(1),z=!0;else{for(Mt=Ve.length,rt=oe.length,q=0,Qe+=2,ee=yr(O/(oe[0]+1)),ee>1&&(oe=d(oe,ee,O),Ve=d(Ve,ee,O),rt=oe.length,Mt=Ve.length),rr=rt,ae=Ve.slice(0,rt),_e=ae.length;_e<rt;ae[_e++]=0);Ft=oe.slice(),Ft=[0].concat(Ft),ut=oe[0],oe[1]>=O/2&&ut++;do{if(ee=0,x=g(oe,ae,rt,_e),x<0){if(Me=ae[0],rt!=_e&&(Me=Me*O+(ae[1]||0)),ee=yr(Me/ut),ee>1)for(ee>=O&&(ee=O-1),Z=d(oe,ee,O),he=Z.length,_e=ae.length;g(Z,ae,he,_e)==1;)ee--,E(Z,rt<he?Ft:oe,he,O),he=Z.length,x=1;else ee==0&&(x=ee=1),Z=oe.slice(),he=Z.length;if(he<_e&&(Z=[0].concat(Z)),E(ae,Z,_e,O),_e=ae.length,x==-1)for(;g(oe,ae,rt,_e)<1;)ee++,E(ae,rt<_e?Ft:oe,_e,O),_e=ae.length}else x===0&&(ee++,ae=[0]);se[q++]=ee,ae[0]?ae[_e++]=Ve[rr]||0:(ae=[Ve[rr]],_e=1)}while((rr++<Mt||ae[0]!=null)&&Qe--);z=ae[0]!=null,se[0]||se.splice(0,1)}if(O==cr){for(q=1,Qe=se[0];Qe>=10;Qe/=10,q++);_(be,P+(be.e=q+F*de-1)+1,M,z)}else be.e=F,be.r=+z;return be}}();function V(d,g,E,b){var C,P,M,O,x;if(E==null?E=c:Ue(E,0,8),!d.c)return d.toString();if(C=d.c[0],M=d.e,g==null)x=Yt(d.c),x=b==1||b==2&&(M<=o||M>=l)?Ta(x,M):Lr(x,M,"0");else if(d=_(new k(d),g,E),P=d.e,x=Yt(d.c),O=x.length,b==1||b==2&&(g<=P||P<=o)){for(;O<g;x+="0",O++);x=Ta(x,P)}else if(g-=M,x=Lr(x,P,"0"),P+1>O){if(--g>0)for(x+=".";g--;x+="0");}else if(g+=P-O,g>0)for(P+1==O&&(x+=".");g--;x+="0");return d.s<0&&C?"-"+x:x}function H(d,g){for(var E,b=1,C=new k(d[0]);b<d.length;b++)if(E=new k(d[b]),E.s)g.call(C,E)&&(C=E);else{C=E;break}return C}function v(d,g,E){for(var b=1,C=g.length;!g[--C];g.pop());for(C=g[0];C>=10;C/=10,b++);return(E=b+E*de-1)>h?d.c=d.e=null:E<u?d.c=[d.e=0]:(d.e=E,d.c=g),d}n=function(){var d=/^(-?)0([xbo])(?=\w[\w.]*$)/i,g=/^([^.]+)\.$/,E=/^\.([^.]+)$/,b=/^-?(Infinity|NaN)$/,C=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(P,M,O,x){var F,q=O?M:M.replace(C,"");if(b.test(q))P.s=isNaN(q)?null:q<0?-1:1;else{if(!O&&(q=q.replace(d,function(z,ee,Z){return F=(Z=Z.toLowerCase())=="x"?16:Z=="b"?2:8,!x||x==F?ee:z}),x&&(F=x,q=q.replace(g,"$1").replace(E,"0.$1")),M!=q))return new k(q,F);if(k.DEBUG)throw Error(Pt+"Not a"+(x?" base "+x:"")+" number: "+M);P.s=null}P.c=P.e=null}}();function _(d,g,E,b){var C,P,M,O,x,F,q,z=d.c,ee=Jo;if(z){e:{for(C=1,O=z[0];O>=10;O/=10,C++);if(P=g-C,P<0)P+=de,M=g,x=z[F=0],q=x/ee[C-M-1]%10|0;else if(F=Qo((P+1)/de),F>=z.length)if(b){for(;z.length<=F;z.push(0));x=q=0,C=1,P%=de,M=P-de+1}else break e;else{for(x=O=z[F],C=1;O>=10;O/=10,C++);P%=de,M=P-de+C,q=M<0?0:x/ee[C-M-1]%10|0}if(b=b||g<0||z[F+1]!=null||(M<0?x:x%ee[C-M-1]),b=E<4?(q||b)&&(E==0||E==(d.s<0?3:2)):q>5||q==5&&(E==4||b||E==6&&(P>0?M>0?x/ee[C-M]:0:z[F-1])%10&1||E==(d.s<0?8:7)),g<1||!z[0])return z.length=0,b?(g-=d.e+1,z[0]=ee[(de-g%de)%de],d.e=-g||0):z[0]=d.e=0,d;if(P==0?(z.length=F,O=1,F--):(z.length=F+1,O=ee[de-P],z[F]=M>0?yr(x/ee[C-M]%ee[M])*O:0),b)for(;;)if(F==0){for(P=1,M=z[0];M>=10;M/=10,P++);for(M=z[0]+=O,O=1;M>=10;M/=10,O++);P!=O&&(d.e++,z[0]==cr&&(z[0]=1));break}else{if(z[F]+=O,z[F]!=cr)break;z[F--]=0,O=1}for(P=z.length;z[--P]===0;z.pop());}d.e>h?d.c=d.e=null:d.e<u&&(d.c=[d.e=0])}return d}function A(d){var g,E=d.e;return E===null?d.toString():(g=Yt(d.c),g=E<=o||E>=l?Ta(g,E):Lr(g,E,"0"),d.s<0?"-"+g:g)}return i.absoluteValue=i.abs=function(){var d=new k(this);return d.s<0&&(d.s=1),d},i.comparedTo=function(d,g){return Ii(this,new k(d,g))},i.decimalPlaces=i.dp=function(d,g){var E,b,C,P=this;if(d!=null)return Ue(d,0,st),g==null?g=c:Ue(g,0,8),_(new k(P),d+P.e+1,g);if(!(E=P.c))return null;if(b=((C=E.length-1)-Qt(this.e/de))*de,C=E[C])for(;C%10==0;C/=10,b--);return b<0&&(b=0),b},i.dividedBy=i.div=function(d,g){return e(this,new k(d,g),a,c)},i.dividedToIntegerBy=i.idiv=function(d,g){return e(this,new k(d,g),0,1)},i.exponentiatedBy=i.pow=function(d,g){var E,b,C,P,M,O,x,F,q,z=this;if(d=new k(d),d.c&&!d.isInteger())throw Error(Pt+"Exponent not an integer: "+A(d));if(g!=null&&(g=new k(g)),O=d.e>14,!z.c||!z.c[0]||z.c[0]==1&&!z.e&&z.c.length==1||!d.c||!d.c[0])return q=new k(Math.pow(+A(z),O?2-Sa(d):+A(d))),g?q.mod(g):q;if(x=d.s<0,g){if(g.c?!g.c[0]:!g.s)return new k(NaN);b=!x&&z.isInteger()&&g.isInteger(),b&&(z=z.mod(g))}else{if(d.e>9&&(z.e>0||z.e<-1||(z.e==0?z.c[0]>1||O&&z.c[1]>=24e7:z.c[0]<8e13||O&&z.c[0]<=9999975e7)))return P=(z.s<0&&Sa(d),-0),z.e>-1&&(P=1/P),new k(x?1/P:P);S&&(P=Qo(S/de+2))}for(O?(E=new k(.5),x&&(d.s=1),F=Sa(d)):(C=Math.abs(+A(d)),F=C%2),q=new k(s);;){if(F){if(q=q.times(z),!q.c)break;P?q.c.length>P&&(q.c.length=P):b&&(q=q.mod(g))}if(C){if(C=yr(C/2),C===0)break;F=C%2}else if(d=d.times(E),_(d,d.e+1,1),d.e>14)F=Sa(d);else{if(C=+A(d),C===0)break;F=C%2}z=z.times(z),P?z.c&&z.c.length>P&&(z.c.length=P):b&&(z=z.mod(g))}return b?q:(x&&(q=s.div(q)),g?q.mod(g):P?_(q,S,c,M):q)},i.integerValue=function(d){var g=new k(this);return d==null?d=c:Ue(d,0,8),_(g,g.e+1,d)},i.isEqualTo=i.eq=function(d,g){return Ii(this,new k(d,g))===0},i.isFinite=function(){return!!this.c},i.isGreaterThan=i.gt=function(d,g){return Ii(this,new k(d,g))>0},i.isGreaterThanOrEqualTo=i.gte=function(d,g){return(g=Ii(this,new k(d,g)))===1||g===0},i.isInteger=function(){return!!this.c&&Qt(this.e/de)>this.c.length-2},i.isLessThan=i.lt=function(d,g){return Ii(this,new k(d,g))<0},i.isLessThanOrEqualTo=i.lte=function(d,g){return(g=Ii(this,new k(d,g)))===-1||g===0},i.isNaN=function(){return!this.s},i.isNegative=function(){return this.s<0},i.isPositive=function(){return this.s>0},i.isZero=function(){return!!this.c&&this.c[0]==0},i.minus=function(d,g){var E,b,C,P,M=this,O=M.s;if(d=new k(d,g),g=d.s,!O||!g)return new k(NaN);if(O!=g)return d.s=-g,M.plus(d);var x=M.e/de,F=d.e/de,q=M.c,z=d.c;if(!x||!F){if(!q||!z)return q?(d.s=-g,d):new k(z?M:NaN);if(!q[0]||!z[0])return z[0]?(d.s=-g,d):new k(q[0]?M:(c==3,-0))}if(x=Qt(x),F=Qt(F),q=q.slice(),O=x-F){for((P=O<0)?(O=-O,C=q):(F=x,C=z),C.reverse(),g=O;g--;C.push(0));C.reverse()}else for(b=(P=(O=q.length)<(g=z.length))?O:g,O=g=0;g<b;g++)if(q[g]!=z[g]){P=q[g]<z[g];break}if(P&&(C=q,q=z,z=C,d.s=-d.s),g=(b=z.length)-(E=q.length),g>0)for(;g--;q[E++]=0);for(g=cr-1;b>O;){if(q[--b]<z[b]){for(E=b;E&&!q[--E];q[E]=g);--q[E],q[b]+=cr}q[b]-=z[b]}for(;q[0]==0;q.splice(0,1),--F);return q[0]?v(d,q,F):(d.s=c==3?-1:1,d.c=[d.e=0],d)},i.modulo=i.mod=function(d,g){var E,b,C=this;return d=new k(d,g),!C.c||!d.s||d.c&&!d.c[0]?new k(NaN):!d.c||C.c&&!C.c[0]?new k(C):(p==9?(b=d.s,d.s=1,E=e(C,d,0,3),d.s=b,E.s*=b):E=e(C,d,0,p),d=C.minus(E.times(d)),!d.c[0]&&p==1&&(d.s=C.s),d)},i.multipliedBy=i.times=function(d,g){var E,b,C,P,M,O,x,F,q,z,ee,Z,he,be,se,ae=this,_e=ae.c,Me=(d=new k(d,g)).c;if(!_e||!Me||!_e[0]||!Me[0])return!ae.s||!d.s||_e&&!_e[0]&&!Me||Me&&!Me[0]&&!_e?d.c=d.e=d.s=null:(d.s*=ae.s,!_e||!Me?d.c=d.e=null:(d.c=[0],d.e=0)),d;for(b=Qt(ae.e/de)+Qt(d.e/de),d.s*=ae.s,x=_e.length,z=Me.length,x<z&&(he=_e,_e=Me,Me=he,C=x,x=z,z=C),C=x+z,he=[];C--;he.push(0));for(be=cr,se=un,C=z;--C>=0;){for(E=0,ee=Me[C]%se,Z=Me[C]/se|0,M=x,P=C+M;P>C;)F=_e[--M]%se,q=_e[M]/se|0,O=Z*F+q*ee,F=ee*F+O%se*se+he[P]+E,E=(F/be|0)+(O/se|0)+Z*q,he[P--]=F%be;he[P]=E}return E?++b:he.splice(0,1),v(d,he,b)},i.negated=function(){var d=new k(this);return d.s=-d.s||null,d},i.plus=function(d,g){var E,b=this,C=b.s;if(d=new k(d,g),g=d.s,!C||!g)return new k(NaN);if(C!=g)return d.s=-g,b.minus(d);var P=b.e/de,M=d.e/de,O=b.c,x=d.c;if(!P||!M){if(!O||!x)return new k(C/0);if(!O[0]||!x[0])return x[0]?d:new k(O[0]?b:C*0)}if(P=Qt(P),M=Qt(M),O=O.slice(),C=P-M){for(C>0?(M=P,E=x):(C=-C,E=O),E.reverse();C--;E.push(0));E.reverse()}for(C=O.length,g=x.length,C-g<0&&(E=x,x=O,O=E,g=C),C=0;g;)C=(O[--g]=O[g]+x[g]+C)/cr|0,O[g]=cr===O[g]?0:O[g]%cr;return C&&(O=[C].concat(O),++M),v(d,O,M)},i.precision=i.sd=function(d,g){var E,b,C,P=this;if(d!=null&&d!==!!d)return Ue(d,1,st),g==null?g=c:Ue(g,0,8),_(new k(P),d,g);if(!(E=P.c))return null;if(C=E.length-1,b=C*de+1,C=E[C]){for(;C%10==0;C/=10,b--);for(C=E[0];C>=10;C/=10,b++);}return d&&P.e+1>b&&(b=P.e+1),b},i.shiftedBy=function(d){return Ue(d,-Yo,Yo),this.times("1e"+d)},i.squareRoot=i.sqrt=function(){var d,g,E,b,C,P=this,M=P.c,O=P.s,x=P.e,F=a+4,q=new k("0.5");if(O!==1||!M||!M[0])return new k(!O||O<0&&(!M||M[0])?NaN:M?P:1/0);if(O=Math.sqrt(+A(P)),O==0||O==1/0?(g=Yt(M),(g.length+x)%2==0&&(g+="0"),O=Math.sqrt(+g),x=Qt((x+1)/2)-(x<0||x%2),O==1/0?g="5e"+x:(g=O.toExponential(),g=g.slice(0,g.indexOf("e")+1)+x),E=new k(g)):E=new k(O+""),E.c[0]){for(x=E.e,O=x+F,O<3&&(O=0);;)if(C=E,E=q.times(C.plus(e(P,C,F,1))),Yt(C.c).slice(0,O)===(g=Yt(E.c)).slice(0,O))if(E.e<x&&--O,g=g.slice(O-3,O+1),g=="9999"||!b&&g=="4999"){if(!b&&(_(C,C.e+a+2,0),C.times(C).eq(P))){E=C;break}F+=4,O+=4,b=1}else{(!+g||!+g.slice(1)&&g.charAt(0)=="5")&&(_(E,E.e+a+2,1),d=!E.times(E).eq(P));break}}return _(E,E.e+a+1,c,d)},i.toExponential=function(d,g){return d!=null&&(Ue(d,0,st),d++),V(this,d,g,1)},i.toFixed=function(d,g){return d!=null&&(Ue(d,0,st),d=d+this.e+1),V(this,d,g)},i.toFormat=function(d,g,E){var b,C=this;if(E==null)d!=null&&g&&typeof g=="object"?(E=g,g=null):d&&typeof d=="object"?(E=d,d=g=null):E=D;else if(typeof E!="object")throw Error(Pt+"Argument not an object: "+E);if(b=C.toFixed(d,g),C.c){var P,M=b.split("."),O=+E.groupSize,x=+E.secondaryGroupSize,F=E.groupSeparator||"",q=M[0],z=M[1],ee=C.s<0,Z=ee?q.slice(1):q,he=Z.length;if(x&&(P=O,O=x,x=P,he-=P),O>0&&he>0){for(P=he%O||O,q=Z.substr(0,P);P<he;P+=O)q+=F+Z.substr(P,O);x>0&&(q+=F+Z.slice(P)),ee&&(q="-"+q)}b=z?q+(E.decimalSeparator||"")+((x=+E.fractionGroupSize)?z.replace(new RegExp("\\d{"+x+"}\\B","g"),"$&"+(E.fractionGroupSeparator||"")):z):q}return(E.prefix||"")+b+(E.suffix||"")},i.toFraction=function(d){var g,E,b,C,P,M,O,x,F,q,z,ee,Z=this,he=Z.c;if(d!=null&&(O=new k(d),!O.isInteger()&&(O.c||O.s!==1)||O.lt(s)))throw Error(Pt+"Argument "+(O.isInteger()?"out of range: ":"not an integer: ")+A(O));if(!he)return new k(Z);for(g=new k(s),F=E=new k(s),b=x=new k(s),ee=Yt(he),P=g.e=ee.length-Z.e-1,g.c[0]=Jo[(M=P%de)<0?de+M:M],d=!d||O.comparedTo(g)>0?P>0?g:F:O,M=h,h=1/0,O=new k(ee),x.c[0]=0;!(q=e(O,g,0,1),C=E.plus(q.times(b)),C.comparedTo(d)==1);)E=b,b=C,F=x.plus(q.times(C=F)),x=C,g=O.minus(q.times(C=g)),O=C;return C=e(d.minus(E),b,0,1),x=x.plus(C.times(F)),E=E.plus(C.times(b)),x.s=F.s=Z.s,P=P*2,z=e(F,b,P,c).minus(Z).abs().comparedTo(e(x,E,P,c).minus(Z).abs())<1?[F,b]:[x,E],h=M,z},i.toNumber=function(){return+A(this)},i.toPrecision=function(d,g){return d!=null&&Ue(d,1,st),V(this,d,g,2)},i.toString=function(d){var g,E=this,b=E.s,C=E.e;return C===null?b?(g="Infinity",b<0&&(g="-"+g)):g="NaN":(d==null?g=C<=o||C>=l?Ta(Yt(E.c),C):Lr(Yt(E.c),C,"0"):d===10?(E=_(new k(E),a+C+1,c),g=Lr(Yt(E.c),E.e,"0")):(Ue(d,2,I.length,"Base"),g=r(Lr(Yt(E.c),C,"0"),10,d,b,!0)),b<0&&E.c[0]&&(g="-"+g)),g},i.valueOf=i.toJSON=function(){return A(this)},i._isBigNumber=!0,i[Symbol.toStringTag]="BigNumber",i[Symbol.for("nodejs.util.inspect.custom")]=i.valueOf,t!=null&&k.set(t),k}function Qt(t){var e=t|0;return t>0||t===e?e:e-1}function Yt(t){for(var e,r,n=1,i=t.length,s=t[0]+"";n<i;){for(e=t[n++]+"",r=de-e.length;r--;e="0"+e);s+=e}for(i=s.length;s.charCodeAt(--i)===48;);return s.slice(0,i+1||1)}function Ii(t,e){var r,n,i=t.c,s=e.c,a=t.s,c=e.s,o=t.e,l=e.e;if(!a||!c)return null;if(r=i&&!i[0],n=s&&!s[0],r||n)return r?n?0:-c:a;if(a!=c)return a;if(r=a<0,n=o==l,!i||!s)return n?0:!i^r?1:-1;if(!n)return o>l^r?1:-1;for(c=(o=i.length)<(l=s.length)?o:l,a=0;a<c;a++)if(i[a]!=s[a])return i[a]>s[a]^r?1:-1;return o==l?0:o>l^r?1:-1}function Ue(t,e,r,n){if(t<e||t>r||t!==yr(t))throw Error(Pt+(n||"Argument")+(typeof t=="number"?t<e||t>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(t))}function Sa(t){var e=t.c.length-1;return Qt(t.e/de)==e&&t.c[e]%2!=0}function Ta(t,e){return(t.length>1?t.charAt(0)+"."+t.slice(1):t)+(e<0?"e":"e+")+e}function Lr(t,e,r){var n,i;if(e<0){for(i=r+".";++e;i+=r);t=i+t}else if(n=t.length,++e>n){for(i=r,e-=n;--e;i+=r);t+=i}else e<n&&(t=t.slice(0,e)+"."+t.slice(e));return t}var Uu=Bu(),Xb=Object.freeze({__proto__:null,BigNumber:Uu,default:Uu}),Fu=re(function(t,e){const r=Math.exp;e=t.exports=function(i){if(typeof i!="number")throw new Error("must provide a timespan to the moving average constructor");if(i<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let s,a=0,c=0,o=0,l,u={};function h(f,p){return 1-r(-(f-p)/i)}return u.push=function(p,S){if(l){const D=h(p,l),I=S-s,k=D*I;s=D*S+(1-D)*s,a=(1-D)*(a+I*k),c=Math.sqrt(a),o=s+D*I}else s=S;l=p},u.movingAverage=function(){return s},u.variance=function(){return a},u.deviation=function(){return c},u.forecast=function(){return o},u}}),qu=nf(Xb);class Qb extends _t{constructor(t,e){super();this._options=e,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this);const r=this._options.movingAverageIntervals;for(var n=0;n<t.length;n++){var i=t[n];this._stats[i]=qu(0),this._movingAverages[i]={};for(var s=0;s<r.length;s++){var a=r[s],c=this._movingAverages[i][a]=Fu(a);c.push(this._frequencyLastTime,0)}}}start(){this._queue.length&&this._resetComputeTimeout()}stop(){this._timeout&&(this._timeout.clear(),this._timeout=null)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}toJSON(){const t=this.snapshot,e=this.movingAverages,r={dataReceived:t.dataReceived.toString(),dataSent:t.dataSent.toString(),movingAverages:{}},n=Object.keys(e);for(const i of n){r.movingAverages[i]={};for(const s of Object.keys(e[i]))r.movingAverages[i][s]=e[i][s].movingAverage()}return r}push(t,e){this._queue.push([t,e,Date.now()]),this._resetComputeTimeout()}_resetComputeTimeout(){this._timeout=jn(this._update,this._nextTimeout())}_nextTimeout(){const t=this._queue.length/this._options.computeThrottleMaxQueueSize,e=Math.max(this._options.computeThrottleTimeout*(1-t),0);return e}_update(){if(this._timeout=null,this._queue.length){let t;for(t of this._queue)this._applyOp(t);this._queue=[],this._updateFrequency(t[2]),this.emit("update",this._stats)}}_updateFrequency(t){const e=t-this._frequencyLastTime;Object.keys(this._stats).forEach(r=>{this._updateFrequencyFor(r,e,t)}),this._frequencyLastTime=t}_updateFrequencyFor(t,e,r){const n=this._frequencyAccumulators[t]||0;this._frequencyAccumulators[t]=0;const i=e||1,s=n/i*1e3;let a=this._movingAverages[t];a||(a=this._movingAverages[t]={});const c=this._options.movingAverageIntervals;for(var o=0;o<c.length;o++){var l=c[o],u=a[l];u||(u=a[l]=Fu(l)),u.push(r,s)}}_applyOp(t){const e=t[0],r=t[1];if(typeof r!="number")throw new Error("invalid increment number:",r);let n;Object.prototype.hasOwnProperty.call(this._stats,e)?n=this._stats[e]:n=this._stats[e]=qu(0),this._stats[e]=n.plus(r),this._frequencyAccumulators[e]||(this._frequencyAccumulators[e]=0),this._frequencyAccumulators[e]+=r}}var Zo=Qb;const{tap:Gu}=bo,{METRICS:Yb}=Rs,ec=["dataReceived","dataSent"],Jb={in:"dataReceived",out:"dataSent"};class Vu{constructor(t){this._options=ca(Yb,t),this._globalStats=new Zo(ec,this._options),this._peerStats=new Map,this._protocolStats=new Map,this._oldPeers=Kb(this._options.maxOldPeersRetention),this._running=!1,this._onMessage=this._onMessage.bind(this),this._connectionManager=t.connectionManager,this._connectionManager.on("peer:disconnect",e=>{this.onPeerDisconnected(e.remotePeer)})}start(){this._running=!0}stop(){this._running=!1,this._globalStats.stop();for(const t of this._peerStats.values())t.stop();for(const t of this._protocolStats.values())t.stop()}get global(){return this._globalStats}get peers(){return Array.from(this._peerStats.keys())}forPeer(t){const e=t.toB58String();return this._peerStats.get(e)||this._oldPeers.get(e)}get protocols(){return Array.from(this._protocolStats.keys())}forProtocol(t){return this._protocolStats.get(t)}onPeerDisconnected(t){const e=t.toB58String(),r=this._peerStats.get(e);r&&(r.stop(),this._peerStats.delete(e),this._oldPeers.set(e,r))}_onMessage({remotePeer:t,protocol:e,direction:r,dataLength:n}){if(!this._running)return;const i=Jb[r];let s=this.forPeer(t);if(s||(s=new Zo(ec,this._options),this._peerStats.set(t.toB58String(),s)),s.push(i,n),this._globalStats.push(i,n),e){let a=this.forProtocol(e);a||(a=new Zo(ec,this._options),this._protocolStats.set(e,a)),a.push(i,n)}}updatePlaceholder(t,e){if(!this._running)return;const r=this.forPeer(t),n=e.toB58String(),i=this.forPeer(e);let s=r;i&&(s=Vu.mergeStats(i,s),this._oldPeers.delete(n)),this._peerStats.delete(t.toB58String()),this._peerStats.set(n,s),s.start()}trackStream({stream:t,remotePeer:e,protocol:r}){const n=this,i=t.source;t.source=Gu(a=>n._onMessage({remotePeer:e,protocol:r,direction:"in",dataLength:a.length}))(i);const s=t.sink;return t.sink=a=>ft(a,Gu(c=>n._onMessage({remotePeer:e,protocol:r,direction:"out",dataLength:c.length})),s),t}static mergeStats(t,e){return t.stop(),e.stop(),t._queue=[...t._queue,...e._queue],t}}var Zb=Vu,Nt=re(function(t,e){const r=$e(`
`);async function n(i){for await(const s of i)return s}e.encode=i=>Xe.encode.single(new ct([i,r])),e.write=(i,s)=>i.push(e.encode(s)),e.writeAll=(i,s)=>{i.push(s.reduce((a,c)=>a.append(e.encode(c)),new ct))},e.read=async i=>{let s=1;const a={[Symbol.asyncIterator](){return this},next:()=>i.next(s)},c=l=>{s=l},o=await ft(a,Xe.decode({onLength:c}),n);if(o.get(o.length-1)!==r[0])throw U(new Error("missing newline"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return o.shallowSlice(0,-1)}});const Ri=Q("mss:select");var $u=async(t,e,r)=>{e=Array.isArray(e)?[...e]:[e];const{reader:n,writer:i,rest:s,stream:a}=Ds(t),c=e.shift();r?(Ri('select: write ["%s", "%s"]',r,c),Nt.writeAll(i,[r,c])):(Ri('select: write "%s"',c),Nt.write(i,c));let o=(await Nt.read(n)).toString();if(Ri('select: read "%s"',o),o===r&&(o=(await Nt.read(n)).toString(),Ri('select: read "%s"',o)),o===c)return s(),{stream:a,protocol:c};for(const l of e){Ri('select: write "%s"',l),Nt.write(i,l);const u=(await Nt.read(n)).toString();if(Ri('select: read "%s" for "%s"',u,l),u===l)return s(),{stream:a,protocol:l}}throw s(),U(new Error("protocol selection failed"),"ERR_UNSUPPORTED_PROTOCOL")},ey="/multistream/1.0.0",Hu={PROTOCOL_ID:ey};const xs=Q("mss:handle"),{PROTOCOL_ID:tc}=Hu;var ty=async(t,e)=>{e=Array.isArray(e)?e:[e];const{writer:r,reader:n,rest:i,stream:s}=Ds(t);for(;;){const a=(await Nt.read(n)).toString();if(xs('read "%s"',a),a===tc){xs('respond with "%s" for "%s"',tc,a),Nt.write(r,tc);continue}if(e.includes(a))return Nt.write(r,a),xs('respond with "%s" for "%s"',a,a),i(),{stream:s,protocol:a};if(a==="ls"){Nt.write(r,new ct(e.map(c=>Nt.encode(c)))),xs('respond with "%s" for %s',e,a);continue}Nt.write(r,"na"),xs('respond with "na" for "%s"',a)}};const ry=Q("it-multistream-select:ls");var ny=async t=>{const{reader:e,writer:r,rest:n,stream:i}=Ds(t);ry('write "ls"'),Nt.write(r,"ls"),n();const s=await Nt.read(e),a=Iu([s]),c=[];return await ft(a,Xe.decode(),async o=>{for await(const l of o)c.push(l.shallowSlice(0,-1).toString())}),{stream:i,protocols:c}};const{PROTOCOL_ID:rc}=Hu;var iy=rc;class zu{constructor(t){this._stream=t,this._shaken=!1}async _handshake(){if(this._shaken)return;const{stream:t}=await $u(this._stream,rc);this._stream=t,this._shaken=!0}}class sy extends zu{select(t){return $u(this._stream,t,this._shaken?null:rc)}async ls(){await this._handshake();const{stream:t,protocols:e}=await ny(this._stream);return this._stream=t,e}}var ay=sy;class oy extends zu{handle(t){return ty(this._stream,t)}}var cy=oy,ki={PROTOCOL_ID:iy,Dialer:ay,Listener:cy};const ly=gi,nc=gi.v4,Ku=gi.v6,Wu=function(t,e,r){r=~~r;var n;if(nc(t))n=e||new Uint8Array(r+4),t.split(/\./g).map(function(u){n[r++]=parseInt(u,10)&255});else if(Ku(t)){var i=t.split(":",8),s;for(s=0;s<i.length;s++){var a=nc(i[s]),c;a&&(c=Wu(i[s]),i[s]=Ee(c.slice(0,2),"base16")),c&&++s<8&&i.splice(s,0,Ee(c.slice(2,4),"base16"))}if(i[0]==="")for(;i.length<8;)i.unshift("0");else if(i[i.length-1]==="")for(;i.length<8;)i.push("0");else if(i.length<8){for(s=0;s<i.length&&i[s]!=="";s++);var o=[s,"1"];for(s=9-i.length;s>0;s--)o.push("0");i.splice.apply(i,o)}for(n=e||new Uint8Array(r+16),s=0;s<i.length;s++){var l=parseInt(i[s],16);n[r++]=l>>8&255,n[r++]=l&255}}if(!n)throw Error("Invalid ip address: "+t);return n},uy=function(t,e,r){e=~~e,r=r||t.length-e;var n=[],i;const s=new DataView(t.buffer);if(r===4){for(let a=0;a<r;a++)n.push(t[e+a]);i=n.join(".")}else if(r===16){for(let a=0;a<r;a+=2)n.push(s.getUint16(e+a).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i};var Aa={isIP:ly,isV4:nc,isV6:Ku,toBytes:Wu,toString:uy};function Ot(t){if(typeof t=="number"){if(Ot.codes[t])return Ot.codes[t];throw new Error("no protocol with code: "+t)}else if(typeof t=="string"||t instanceof String){if(Ot.names[t])return Ot.names[t];throw new Error("no protocol with name: "+t)}throw new Error("invalid protocol id type: "+t)}const Jt=-1;Ot.lengthPrefixedVarSize=Jt,Ot.V=Jt,Ot.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Jt,"ip6zone"],[53,Jt,"dns","resolvable"],[54,Jt,"dns4","resolvable"],[55,Jt,"dns6","resolvable"],[56,Jt,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Jt,"unix",!1,"path"],[421,Jt,"ipfs"],[421,Jt,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Jt,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Jt,"memory"]],Ot.names={},Ot.codes={},Ot.table.map(t=>{const e=Xu.apply(null,t);Ot.codes[e.code]=e,Ot.names[e.name]=e}),Ot.object=Xu;function Xu(t,e,r,n,i){return{code:t,size:e,name:r,resolvable:Boolean(n),path:Boolean(i)}}var vr=Ot,Qu=Ls;function Ls(t,e){return e instanceof Uint8Array?Ls.toString(t,e):Ls.toBytes(t,e)}Ls.toString=function(e,r){e=vr(e);switch(e.code){case 4:case 41:return dy(r);case 6:case 273:case 33:case 132:return Ju(r);case 53:case 54:case 55:case 56:case 400:case 777:return py(r);case 421:return my(r);case 444:return Zu(r);case 445:return Zu(r);default:return Ee(r,"base16")}},Ls.toBytes=function(e,r){e=vr(e);switch(e.code){case 4:return Yu(r);case 41:return Yu(r);case 6:case 273:case 33:case 132:return ic(parseInt(r,10));case 53:case 54:case 55:case 56:case 400:case 777:return hy(r);case 421:return fy(r);case 444:return gy(r);case 445:return by(r);default:return $e(r,"base16")}};function Yu(t){if(!Aa.isIP(t))throw new Error("invalid ip address");return Aa.toBytes(t)}function dy(t){const e=Aa.toString(t);if(!e||!Aa.isIP(e))throw new Error("invalid ip address");return e}function ic(t){const e=new ArrayBuffer(2),r=new DataView(e);return r.setUint16(0,t),new Uint8Array(e)}function Ju(t){const e=new DataView(t.buffer);return e.getUint16(0)}function hy(t){const e=$e(t),r=Uint8Array.from(ge.encode(e.length));return Ze([r,e],r.length+e.length)}function py(t){const e=ge.decode(t);if(t=t.slice(ge.decode.bytes),t.length!==e)throw new Error("inconsistent lengths");return Ee(t)}function fy(t){const e=new aa(t).multihash,r=Uint8Array.from(ge.encode(e.length));return Ze([r,e],r.length+e.length)}function my(t){const e=ge.decode(t),r=t.slice(ge.decode.bytes);if(r.length!==e)throw new Error("inconsistent lengths");return Ee(r,"base58btc")}function gy(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==16)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion address.");const r=la.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=ic(n);return Ze([r,i],r.length+i.length)}function by(t){const e=t.split(":");if(e.length!==2)throw new Error("failed to parse onion addr: "+e+" does not contain a port number");if(e[0].length!==56)throw new Error("failed to parse onion addr: "+e[0]+" not a Tor onion3 address.");const r=la.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=ic(n);return Ze([r,i],r.length+i.length)}function Zu(t){const e=t.slice(0,t.length-2),r=t.slice(t.length-2),n=Ee(e,"base32"),i=Ju(r);return n+":"+i}var lr={stringToStringTuples:ed,stringTuplesToString:td,tuplesToStringTuples:nd,stringTuplesToTuples:rd,bytesToTuples:sc,tuplesToBytes:id,bytesToString:yy,stringToBytes:ad,fromString:vy,fromBytes:od,validateBytes:ac,isValidBytes:wy,cleanPath:Ca,ParseError:oc,protoFromTuple:js,sizeForAddr:sd};function ed(t){const e=[],r=t.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let n=0;n<r.length;n++){const i=r[n],s=vr(i);if(s.size===0){e.push([i]);continue}if(n++,n>=r.length)throw oc("invalid address: "+t);if(s.path){e.push([i,Ca(r.slice(n).join("/"))]);break}e.push([i,r[n]])}return e}function td(t){const e=[];return t.map(r=>{const n=js(r);e.push(n.name),r.length>1&&e.push(r[1])}),Ca(e.join("/"))}function rd(t){return t.map(e=>{Array.isArray(e)||(e=[e]);const r=js(e);return e.length>1?[r.code,Qu.toBytes(r.code,e[1])]:[r.code]})}function nd(t){return t.map(e=>{const r=js(e);return e.length>1?[r.code,Qu.toString(r.code,e[1])]:[r.code]})}function id(t){return od(Ze(t.map(e=>{const r=js(e);let n=Uint8Array.from(ge.encode(r.code));return e.length>1&&(n=Ze([n,e[1]])),n})))}function sd(t,e){if(t.size>0)return t.size/8;if(t.size===0)return 0;{const r=ge.decode(e);return r+ge.decode.bytes}}function sc(t){const e=[];let r=0;for(;r<t.length;){const n=ge.decode(t,r),i=ge.decode.bytes,s=vr(n),a=sd(s,t.slice(r+i));if(a===0){e.push([n]),r+=i;continue}const c=t.slice(r+i,r+i+a);if(r+=a+i,r>t.length)throw oc("Invalid address Uint8Array: "+Ee(t,"base16"));e.push([n,c])}return e}function yy(t){const e=sc(t),r=nd(e);return td(r)}function ad(t){t=Ca(t);const e=ed(t),r=rd(e);return id(r)}function vy(t){return ad(t)}function od(t){const e=ac(t);if(e)throw e;return Uint8Array.from(t)}function ac(t){try{sc(t)}catch(e){return e}}function wy(t){return ac(t)===void 0}function Ca(t){return"/"+t.trim().split("/").filter(e=>e).join("/")}function oc(t){return new Error("Error parsing address: "+t)}function js(t){const e=vr(t[0]);return e}var _y=re(function(t,e){const r=Symbol.for("nodejs.util.inspect.custom"),n=br.proto(function(i){if(!(this instanceof n))return new n(i);if(i==null&&(i=""),i instanceof Uint8Array)this.bytes=lr.fromBytes(i);else if(typeof i=="string"||i instanceof String){if(i.length>0&&i.charAt(0)!=="/")throw new Error(`multiaddr "${i}" must start with a "/"`);this.bytes=lr.fromString(i)}else if(i.bytes&&i.protos&&i.protoCodes)this.bytes=lr.fromBytes(i.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")},{className:"Multiaddr",symbolName:"@multiformats/js-multiaddr/multiaddr"});n.prototype.toString=function(){return lr.bytesToString(this.bytes)},n.prototype.toJSON=n.prototype.toString,n.prototype.toOptions=function(){const s={},a=this.toString().split("/");return s.family=a[1]==="ip4"?"ipv4":"ipv6",s.host=a[2],s.transport=a[3],s.port=parseInt(a[4]),s},n.prototype[r]=function(){return"<Multiaddr "+Ee(this.bytes,"base16")+" - "+lr.bytesToString(this.bytes)+">"},n.prototype.inspect=function(){return"<Multiaddr "+Ee(this.bytes,"base16")+" - "+lr.bytesToString(this.bytes)+">"},n.prototype.protos=function(){return this.protoCodes().map(s=>Object.assign({},vr(s)))},n.prototype.protoCodes=function(){const s=[],a=this.bytes;let c=0;for(;c<a.length;){const o=ge.decode(a,c),l=ge.decode.bytes,u=vr(o),h=lr.sizeForAddr(u,a.slice(c+l));c+=h+l,s.push(o)}return s},n.prototype.protoNames=function(){return this.protos().map(s=>s.name)},n.prototype.tuples=function(){return lr.bytesToTuples(this.bytes)},n.prototype.stringTuples=function(){const s=lr.bytesToTuples(this.bytes);return lr.tuplesToStringTuples(s)},n.prototype.encapsulate=function(s){return s=n(s),n(this.toString()+s.toString())},n.prototype.decapsulate=function(s){s=s.toString();const a=this.toString(),c=a.lastIndexOf(s);if(c<0)throw new Error("Address "+this+" does not contain subaddress: "+s);return n(a.slice(0,c))},n.prototype.decapsulateCode=function(s){const a=this.tuples();for(let c=a.length-1;c>=0;c--)if(a[c][0]===s)return n(lr.tuplesToBytes(a.slice(0,c)));return this},n.prototype.getPeerId=function(){let s=null;try{const a=this.stringTuples().filter(c=>{if(c[0]===vr.names.ipfs.code)return!0});s=a.pop()[1],s=Ee(new aa(s).multihash,"base58btc")}catch(a){s=null}return s},n.prototype.getPath=function(){let s=null;try{s=this.stringTuples().filter(a=>{const c=vr(a[0]);if(c.path)return!0})[0][1]}catch(a){s=null}return s},n.prototype.equals=function(s){return Nr(this.bytes,s.bytes)},n.prototype.nodeAddress=function(){const s=this.protoCodes(),a=this.protoNames(),c=this.toString().split("/").slice(1);if(c.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(s[0]!==4&&s[0]!==41&&s[0]!==54&&s[0]!==55)throw new Error(`no protocol with name: "'${a[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(c[2]!=="tcp"&&c[2]!=="udp")throw new Error(`no protocol with name: "'${a[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:s[0]===41||s[0]===55?6:4,address:c[1],port:parseInt(c[3])}},n.fromNodeAddress=function(s,a){if(!s)throw new Error("requires node address object");if(!a)throw new Error("requires transport protocol");let c;switch(s.family){case"IPv4":c="ip4";break;case"IPv6":c="ip6";break;default:throw Error(`Invalid addr family. Got '${s.family}' instead of 'IPv4' or 'IPv6'`)}return n("/"+[c,s.address,a,s.port].join("/"))},n.prototype.isThinWaistAddress=function(s){const a=(s||this).protos();return a.length!==2||a[0].code!==4&&a[0].code!==41?!1:!(a[1].code!==6&&a[1].code!==273)},n.protocols=vr,n.isName=function(s){return n.isMultiaddr(s)?s.protos().some(a=>a.resolvable):!1},n.resolve=function(s){return!n.isMultiaddr(s)||!n.isName(s)?Promise.reject(Error("not a valid name")):Promise.reject(new Error("not implemented yet"))},e=t.exports=n}),Gn={OPEN:"open",CLOSING:"closing",CLOSED:"closed"};function Ey(t,e,r,n,i,s,a){if(t&&!_y.isMultiaddr(t))throw U(new Error("localAddr must be an instance of multiaddr"),"ERR_INVALID_PARAMETERS");if(!pe.isPeerId(e))throw U(new Error("localPeer must be an instance of peer-id"),"ERR_INVALID_PARAMETERS");if(!pe.isPeerId(r))throw U(new Error("remotePeer must be an instance of peer-id"),"ERR_INVALID_PARAMETERS");if(typeof n!="function")throw U(new Error("new stream must be a function"),"ERR_INVALID_PARAMETERS");if(typeof i!="function")throw U(new Error("close must be a function"),"ERR_INVALID_PARAMETERS");if(typeof s!="function")throw U(new Error("getStreams must be a function"),"ERR_INVALID_PARAMETERS");if(!a)throw U(new Error("connection metadata object must be provided"),"ERR_INVALID_PARAMETERS");if(a.direction!=="inbound"&&a.direction!=="outbound")throw U(new Error('direction must be "inbound" or "outbound"'),"ERR_INVALID_PARAMETERS");if(!a.timeline)throw U(new Error("connection timeline object must be provided in the stat object"),"ERR_INVALID_PARAMETERS");if(!a.timeline.open)throw U(new Error("connection open timestamp must be provided"),"ERR_INVALID_PARAMETERS");if(!a.timeline.upgraded)throw U(new Error("connection upgraded timestamp must be provided"),"ERR_INVALID_PARAMETERS")}class Sy{constructor({localAddr:t,remoteAddr:e,localPeer:r,remotePeer:n,newStream:i,close:s,getStreams:a,stat:c}){Ey(t,r,n,i,s,a,c),this.id=parseInt(Math.random()*1e9).toString(36)+Date.now(),this.localAddr=t,this.remoteAddr=e,this.localPeer=r,this.remotePeer=n,this._stat={...c,status:Gn.OPEN},this._newStream=i,this._close=s,this._getStreams=a,this.registry=new Map,this.tags=[]}get stat(){return this._stat}get streams(){return this._getStreams()}async newStream(t){if(this.stat.status===Gn.CLOSING)throw U(new Error("the connection is being closed"),"ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===Gn.CLOSED)throw U(new Error("the connection is closed"),"ERR_CONNECTION_CLOSED");Array.isArray(t)||(t=[t]);const{stream:e,protocol:r}=await this._newStream(t);return this.addStream(e,{protocol:r}),{stream:e,protocol:r}}addStream(t,{protocol:e,metadata:r={}}){this.registry.set(t.id,{protocol:e,...r})}removeStream(t){this.registry.delete(t)}async close(){if(this.stat.status===Gn.CLOSED)return;if(this._closing)return this._closing;this.stat.status=Gn.CLOSING,this._closing=await this._close(),this._stat.timeline.close=Date.now(),this.stat.status=Gn.CLOSED}}var Ty=br(Sy,{className:"Connection",symbolName:"@libp2p/interface-connection/connection"}),Ay=Ty,Cy={Connection:Ay};function Iy(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}else return Array.from(t)}var cd=function(e){var r=void 0,n=void 0;function i(c){if(!(c instanceof Object))throw new Error('Target "'+c+'" is not an object');n=c}function s(c){Object.keys(c).forEach(function(o){var l=c[o];if(typeof l!="function")throw new Error('Trap "'+o+": "+l+'" is not a function');if(!Reflect[o])throw new Error('Trap "'+o+": "+l+'" is not a valid trap')}),r=c}i(function(){}),e&&i(e),s(Reflect);var a=new Proxy({},{get:function(o,l){return function(){for(var u=arguments.length,h=Array(u),f=0;f<u;f++)h[f]=arguments[f];return r[l].apply(null,[n].concat(Iy(h.slice(1))))}}});return{setTarget:i,setHandler:s,getTarget:function(){return n},getHandler:function(){return r},proxy:new Proxy(n,a)}};const He=Q("libp2p:upgrader");He.error=Q("libp2p:upgrader:error");const{Connection:Ry}=Cy,{codes:Bs}=lt;class ky{constructor({localPeer:t,metrics:e,cryptos:r,muxers:n,onConnectionEnd:i=()=>{},onConnection:s=()=>{}}){this.localPeer=t,this.metrics=e,this.cryptos=r||new Map,this.muxers=n||new Map,this.protector=null,this.protocols=new Map,this.onConnection=s,this.onConnectionEnd=i}async upgradeInbound(t){let e,r,n,i,s,a,c;if(this.metrics){({setTarget:a,proxy:c}=cd());const l=parseInt(Math.random()*1e9).toString(36)+Date.now();a({toB58String:()=>l}),t=this.metrics.trackStream({stream:t,remotePeer:c})}He("Starting the inbound connection upgrade");let o=t;this.protector&&(o=await this.protector.protect(t));try{({conn:e,remotePeer:r,protocol:s}=await this._encryptInbound(this.localPeer,o,this.cryptos)),this.muxers.size?{stream:n,Muxer:i}=await this._multiplexInbound(e,this.muxers):n=e}catch(l){throw He.error("Failed to upgrade inbound connection",l),await t.close(l),l}return this.metrics&&(this.metrics.updatePlaceholder(c,r),a(r)),He("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:s,direction:"inbound",maConn:t,upgradedConn:n,Muxer:i,remotePeer:r})}async upgradeOutbound(t){let e;try{e=pe.createFromB58String(t.remoteAddr.getPeerId())}catch(u){He.error("multiaddr did not contain a valid peer id",u)}let r,n,i,s,a,c,o;if(this.metrics){({setTarget:c,proxy:o}=cd());const u=parseInt(Math.random()*1e9).toString(36)+Date.now();c({toB58String:()=>u}),t=this.metrics.trackStream({stream:t,remotePeer:o})}He("Starting the outbound connection upgrade");let l=t;this.protector&&(l=await this.protector.protect(t));try{({conn:r,remotePeer:n,protocol:s}=await this._encryptOutbound(this.localPeer,l,e,this.cryptos)),this.muxers.size?{stream:i,Muxer:a}=await this._multiplexOutbound(r,this.muxers):i=r}catch(u){throw He.error("Failed to upgrade outbound connection",u),await t.close(u),u}return this.metrics&&(this.metrics.updatePlaceholder(o,n),c(n)),He("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:s,direction:"outbound",maConn:t,upgradedConn:i,Muxer:a,remotePeer:n})}_createConnection({cryptoProtocol:t,direction:e,maConn:r,upgradedConn:n,Muxer:i,remotePeer:s}){let a,c,o;i&&(a=new i({onStream:async h=>{const f=new ki.Listener(h);try{const{stream:p,protocol:S}=await f.handle(Array.from(this.protocols.keys()));He("%s: incoming stream opened on %s",e,S),this.metrics&&this.metrics.trackStream({stream:p,remotePeer:s,protocol:S}),o.addStream(h,{protocol:S}),this._onStream({connection:o,stream:{...h,...p},protocol:S})}catch(p){He.error(p)}},onStreamEnd:h=>{o.removeStream(h.id)}}),c=async h=>{He("%s: starting new stream on %s",e,h);const f=a.newStream(),p=new ki.Dialer(f);try{const{stream:S,protocol:D}=await p.select(h);return this.metrics&&this.metrics.trackStream({stream:S,remotePeer:s,protocol:D}),{stream:{...f,...S},protocol:D}}catch(S){throw He.error("could not create new stream",S),U(S,Bs.ERR_UNSUPPORTED_PROTOCOL)}},ft(n,a,n).catch(He.error));const l=r.timeline;r.timeline=new Proxy(l,{set:(...h)=>(o&&h[1]==="close"&&h[2]&&!l.close&&(async()=>{try{o.stat.status===Gn.OPEN&&await o.close()}catch(f){He.error(f)}finally{this.onConnectionEnd(o)}})(),Reflect.set(...h))}),r.timeline.upgraded=Date.now();const u=()=>{throw U(new Error("connection is not multiplexed"),"ERR_CONNECTION_NOT_MULTIPLEXED")};return o=new Ry({localAddr:r.localAddr,remoteAddr:r.remoteAddr,localPeer:this.localPeer,remotePeer:s,stat:{direction:e,timeline:r.timeline,multiplexer:i&&i.multicodec,encryption:t},newStream:c||u,getStreams:()=>a?a.streams:u,close:async h=>{await r.close(h),a&&a.streams.map(f=>f.abort(h))}}),this.onConnection(o),o}_onStream({connection:t,stream:e,protocol:r}){const n=this.protocols.get(r);n({connection:t,stream:e,protocol:r})}async _encryptInbound(t,e,r){const n=new ki.Listener(e),i=Array.from(r.keys());He("handling inbound crypto protocol selection",i);try{const{stream:s,protocol:a}=await n.handle(i),c=r.get(a);return He("encrypting inbound connection..."),{...await c.secureInbound(t,s),protocol:a}}catch(s){throw U(s,Bs.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(t,e,r,n){const i=new ki.Dialer(e),s=Array.from(n.keys());He("selecting outbound crypto protocol",s);try{const{stream:a,protocol:c}=await i.select(s),o=n.get(c);return He("encrypting outbound connection to %j",r),{...await o.secureOutbound(t,a,r),protocol:c}}catch(a){throw U(a,Bs.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(t,e){const r=new ki.Dialer(t),n=Array.from(e.keys());He("outbound selecting muxer %s",n);try{const{stream:i,protocol:s}=await r.select(n);He("%s selected as muxer protocol",s);const a=e.get(s);return{stream:i,Muxer:a}}catch(i){throw U(i,Bs.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(t,e){const r=new ki.Listener(t),n=Array.from(e.keys());He("inbound handling muxers %s",n);try{const{stream:i,protocol:s}=await r.handle(n),a=e.get(s);return{stream:i,Muxer:a}}catch(i){throw U(i,Bs.ERR_MUXER_UNAVAILABLE)}}}var Py=ky;const{codes:{ERR_INVALID_PARAMETERS:ld}}=lt,Ny=t=>t;class Oy{constructor({peerStore:t,eventName:e,eventProperty:r,eventTransformer:n=Ny}){this._ps=t,this.eventName=e,this.eventProperty=r,this.eventTransformer=n,this.data=new Map}set(t,e){throw U(new Error("set must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}_setData(t,e,{emit:r=!0}={}){const n=t.toB58String();this.data.set(n,e),r&&this._emit(t,e)}_emit(t,e){this._ps.emit(this.eventName,{peerId:t,[this.eventProperty]:this.eventTransformer(e)})}get(t){if(!pe.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),ld);const e=this.data.get(t.toB58String());return e?[...e]:void 0}delete(t){if(!pe.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),ld);return this.data.delete(t.toB58String())?(this._emit(t,[]),!0):!1}}var Ia=Oy;class Dy{constructor(t,e){this.domain=t,this.codec=e}marshal(){throw U(new Error("marshal must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}equals(t){throw U(new Error("equals must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}}var My=Dy;function xy(t,e){return t.length===e.length&&e.sort()&&t.sort().every((r,n)=>e[n].equals(r))}var Ly=xy;const jy=`
message PeerRecord {
    // AddressInfo is a wrapper around a binary multiaddr. It is defined as a
    // separate message to allow us to add per-address metadata in the future.
    message AddressInfo {
        bytes multiaddr = 1;
    }

    // peer_id contains a libp2p peer id in its binary representation.
    bytes peer_id = 1;

    // seq contains a monotonically-increasing sequence counter to order PeerRecords in time.
    uint64 seq = 2;

    // addresses is a list of public listen addresses for the peer.
    repeated AddressInfo addresses = 3;
}
`;var ud=gr(jy).PeerRecord,By=El.getName(El.LIBP2P_PEER_RECORD),Uy=Uint8Array.from([3,1]),Fy={ENVELOPE_DOMAIN_PEER_RECORD:By,ENVELOPE_PAYLOAD_TYPE_PEER_RECORD:Uy};const{ENVELOPE_DOMAIN_PEER_RECORD:dd,ENVELOPE_PAYLOAD_TYPE_PEER_RECORD:qy}=Fy;class Ra extends My{constructor({peerId:t,multiaddrs:e=[],seqNumber:r=Date.now()}){super(dd,qy);this.peerId=t,this.multiaddrs=e,this.seqNumber=r,this._marshal=void 0}marshal(){return this._marshal?this._marshal:(this._marshal=ud.encode({peer_id:this.peerId.toBytes(),seq:this.seqNumber,addresses:this.multiaddrs.map(t=>({multiaddr:t.bytes}))}),this._marshal)}equals(t){return this.peerId.equals(t.peerId)?this.seqNumber!==t.seqNumber?!1:!!Ly(this.multiaddrs,t.multiaddrs):!1}}Ra.createFromProtobuf=t=>{const e=ud.decode(t),r=pe.createFromBytes(e.peer_id),n=(e.addresses||[]).map(s=>Fe(s.multiaddr)),i=e.seq;return new Ra({peerId:r,multiaddrs:n,seqNumber:i})},Ra.DOMAIN=dd;var ka=Ra;const Gy=`
message Envelope {
  // public_key is the public key of the keypair the enclosed payload was
  // signed with.
  bytes public_key = 1;

  // payload_type encodes the type of payload, so that it can be deserialized
  // deterministically.
  bytes payload_type = 2;

  // payload is the actual payload carried inside this envelope.
  bytes payload = 3;

  // signature is the signature produced by the private key corresponding to
  // the enclosed public key, over the payload, prefixing a domain string for
  // additional security.
  bytes signature = 5;
}
`;var hd=gr(Gy).Envelope;const Vy=Q("libp2p:envelope");Vy.error=Q("libp2p:envelope:error");const{codes:$y}=lt;class Vn{constructor({peerId:t,payloadType:e,payload:r,signature:n}){this.peerId=t,this.payloadType=e,this.payload=r,this.signature=n,this._marshal=void 0}marshal(){if(this._marshal)return this._marshal;const t=tf.marshalPublicKey(this.peerId.pubKey);return this._marshal=hd.encode({public_key:t,payload_type:this.payloadType,payload:this.payload,signature:this.signature}),this._marshal}equals(t){return Nr(this.peerId.pubKey.bytes,t.peerId.pubKey.bytes)&&Nr(this.payloadType,t.payloadType)&&Nr(this.payload,t.payload)&&Nr(this.signature,t.signature)}validate(t){const e=pd(t,this.payloadType,this.payload);return this.peerId.pubKey.verify(e,this.signature)}}const pd=(t,e,r)=>{t=$e(t);const n=ge.encode(t.byteLength),i=ge.encode(e.length),s=ge.encode(r.length);return Ze([new Uint8Array(n),t,new Uint8Array(i),e,new Uint8Array(s),r])};Vn.createFromProtobuf=async t=>{const e=hd.decode(t),r=await pe.createFromPubKey(e.public_key);return new Vn({peerId:r,payloadType:e.payload_type,payload:e.payload,signature:e.signature})},Vn.seal=async(t,e)=>{const r=t.domain,n=t.codec,i=t.marshal(),s=pd(r,n,i),a=await e.privKey.sign(s);return new Vn({peerId:e,payloadType:n,payload:i,signature:a})},Vn.openAndCertify=async(t,e)=>{const r=await Vn.createFromProtobuf(t),n=await r.validate(e);if(!n)throw U(new Error("envelope signature is not valid for the given domain"),$y.ERR_SIGNATURE_NOT_VALID);return r};var Us=Vn;const Zt=Q("libp2p:peer-store:address-book");Zt.error=Q("libp2p:peer-store:address-book:error");const{codes:{ERR_INVALID_PARAMETERS:Pi}}=lt;class Hy extends Ia{constructor(t){super({peerStore:t,eventName:"change:multiaddrs",eventProperty:"multiaddrs",eventTransformer:e=>e.addresses?e.addresses.map(r=>r.multiaddr):[]});this.data=new Map}consumePeerRecord(t){let e;try{e=ka.createFromProtobuf(t.payload)}catch(c){return Zt.error("invalid peer record received"),!1}if(!e.peerId.equals(t.peerId))return Zt("signing key does not match PeerId in the PeerRecord"),!1;if(!e.multiaddrs||!e.multiaddrs.length)return!1;const r=e.peerId,n=r.toB58String(),i=this.data.get(n)||{},s=i.record;if(s&&s.seqNumber>=e.seqNumber)return!1;const a=this._toAddresses(e.multiaddrs,!0);return this._setData(r,{addresses:a,record:{raw:t.marshal(),seqNumber:e.seqNumber}}),Zt(`stored provided peer record for ${n}`),!0}getRawEnvelope(t){const e=this.data.get(t.toB58String());return!e||!e.record||!e.record.raw?void 0:e.record.raw}getPeerRecord(t){const e=this.getRawEnvelope(t);return e?Us.createFromProtobuf(e):void 0}set(t,e){if(!pe.isPeerId(t))throw Zt.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),Pi);const r=this._toAddresses(e),n=t.toB58String(),i=this.data.get(n)||{},s=i.addresses;if(!r.length)return this;if(s&&s.length===r.length){const a=s.filter(c=>r.some(o=>c.multiaddr.equals(o.multiaddr)));if(a.length===s.length)return Zt(`the addresses provided to store are equal to the already stored for ${n}`),this}return this._setData(t,{addresses:r,record:i.record}),Zt(`stored provided multiaddrs for ${n}`),s||this._ps.emit("peer",t),this}add(t,e){if(!pe.isPeerId(t))throw Zt.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),Pi);const r=this._toAddresses(e),n=t.toB58String(),i=this.data.get(n)||{},s=i.addresses||[];return s.forEach(a=>{r.find(c=>c.multiaddr.equals(a.multiaddr))||r.push(a)}),s&&s.length===r.length?(Zt(`the addresses provided to store are already stored for ${n}`),this):(this._setData(t,{addresses:r,record:i.record}),Zt(`added provided multiaddrs for ${n}`),i.addresses||this._ps.emit("peer",t),this)}get(t){if(!pe.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),Pi);const e=this.data.get(t.toB58String());return e&&e.addresses?[...e.addresses]:void 0}_toAddresses(t,e=!1){if(!t)throw Zt.error("multiaddrs must be provided to store data"),U(new Error("multiaddrs must be provided"),Pi);const r=[];return t.forEach(n=>{if(!Fe.isMultiaddr(n))throw Zt.error(`multiaddr ${n} must be an instance of multiaddr`),U(new Error(`multiaddr ${n} must be an instance of multiaddr`),Pi);r.push({multiaddr:n,isCertified:e})}),r}getMultiaddrsForPeer(t){if(!pe.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),Pi);const e=this.data.get(t.toB58String());return!e||!e.addresses?void 0:e.addresses.map(r=>{const n=r.multiaddr,i=n.getPeerId();return i&&i===t.toB58String()?n:n.encapsulate(`/p2p/${t.toB58String()}`)})}}var zy=Hy;const cc=Q("libp2p:peer-store:key-book");cc.error=Q("libp2p:peer-store:key-book:error");const{codes:{ERR_INVALID_PARAMETERS:fd}}=lt;class Ky extends Ia{constructor(t){super({peerStore:t,eventName:"change:pubkey",eventProperty:"pubkey",eventTransformer:e=>e.pubKey});this.data=new Map}set(t,e){if(!pe.isPeerId(t))throw cc.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),fd);const r=t.toB58String(),n=this.data.get(r);return!n&&e&&(t.pubKey=e,this._setData(t,t),cc(`stored provided public key for ${r}`)),this}get(t){if(!pe.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),fd);const e=this.data.get(t.toB58String());return e?e.pubKey:void 0}}var Wy=Ky;const Pa=Q("libp2p:peer-store:proto-book");Pa.error=Q("libp2p:peer-store:proto-book:error");const{codes:{ERR_INVALID_PARAMETERS:Ni}}=lt;class Xy extends Ia{constructor(t){super({peerStore:t,eventName:"change:metadata",eventProperty:"metadata"});this.data=new Map}set(t,e,r){if(!pe.isPeerId(t))throw Pa.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),Ni);if(typeof e!="string"||!(r instanceof Uint8Array))throw Pa.error("valid key and value must be provided to store data"),U(new Error("valid key and value must be provided"),Ni);return this._setValue(t,e,r),this}_setValue(t,e,r,{emit:n=!0}={}){const i=t.toB58String(),s=this.data.get(i)||new Map,a=s.get(e);if(a&&Nr(r,a)){Pa(`the metadata provided to store is equal to the already stored for ${i} on ${e}`);return}s.set(e,r),this.data.set(i,s),n&&this._emit(t,e)}get(t){if(!pe.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),Ni);return this.data.get(t.toB58String())}getValue(t,e){if(!pe.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),Ni);const r=this.data.get(t.toB58String());return r&&r.get(e)}delete(t){if(!pe.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),Ni);return this.data.delete(t.toB58String())?(this._emit(t),!0):!1}deleteValue(t,e){if(!pe.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),Ni);const r=this.data.get(t.toB58String());return!r||!r.delete(e)?!1:(this._emit(t,e),!0)}}var Qy=Xy;const jr=Q("libp2p:peer-store:proto-book");jr.error=Q("libp2p:peer-store:proto-book:error");const{codes:{ERR_INVALID_PARAMETERS:Na}}=lt;class Yy extends Ia{constructor(t){super({peerStore:t,eventName:"change:protocols",eventProperty:"protocols",eventTransformer:e=>Array.from(e)});this.data=new Map}set(t,e){if(!pe.isPeerId(t))throw jr.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),Na);if(!e)throw jr.error("protocols must be provided to store data"),U(new Error("protocols must be provided"),Na);const r=t.toB58String(),n=this.data.get(r),i=new Set(e),s=(a,c)=>a.size===c.size&&[...a].every(o=>c.has(o));return n&&s(n,i)?(jr(`the protocols provided to store are equal to the already stored for ${r}`),this):(this._setData(t,i),jr(`stored provided protocols for ${r}`),this)}add(t,e){if(!pe.isPeerId(t))throw jr.error("peerId must be an instance of peer-id to store data"),U(new Error("peerId must be an instance of peer-id"),Na);if(!e)throw jr.error("protocols must be provided to store data"),U(new Error("protocols must be provided"),Na);const r=t.toB58String(),n=this.data.get(r)||new Set,i=new Set([...n,...e]);return n.size===i.size?(jr(`the protocols provided to store are already stored for ${r}`),this):(e=[...i],this._setData(t,i),jr(`added provided protocols for ${r}`),this)}}var Jy=Yy;const Zy=Q("libp2p:peer-store");Zy.error=Q("libp2p:peer-store:error");const{EventEmitter:ev}=_t,{ERR_INVALID_PARAMETERS:tv}=lt;class rv extends ev{constructor({peerId:t}){super();this._peerId=t,this.addressBook=new zy(this),this.keyBook=new Wy(this),this.metadataBook=new Qy(this),this.protoBook=new Jy(this)}start(){}stop(){}get peers(){const t=new Set([...this.addressBook.data.keys(),...this.keyBook.data.keys(),...this.protoBook.data.keys(),...this.metadataBook.data.keys()]);this._peerId&&t.delete(this._peerId.toB58String());const e=new Map;return t.forEach(r=>{e.set(r,this.get(pe.createFromCID(r)))}),e}delete(t){const e=this.addressBook.delete(t),r=this.keyBook.delete(t),n=this.protoBook.delete(t),i=this.metadataBook.delete(t);return e||r||n||i}get(t){if(!pe.isPeerId(t))throw U(new Error("peerId must be an instance of peer-id"),tv);const e=this.keyBook.data.get(t.toB58String()),r=this.addressBook.get(t),n=this.metadataBook.get(t),i=this.protoBook.get(t);return!e&&!r&&!n&&!i?void 0:{id:e||t,addresses:r||[],protocols:i||[],metadata:n}}}var md=rv,nv=(t,e,r)=>{class n extends t{subscribe(i,s){s&&this.on(i,s),super.subscribe(i)}unsubscribe(i,s){s?this.removeListener(i,s):this.removeAllListeners(i),this.listenerCount(i)===0&&super.unsubscribe(i)}}return new n(e,r)},iv="/peers/",sv="/peers/addrs/",av="/peers/keys/",ov="/peers/metadata/",cv="/peers/protos/",lv={NAMESPACE_COMMON:iv,NAMESPACE_ADDRESS:sv,NAMESPACE_KEYS:av,NAMESPACE_METADATA:ov,NAMESPACE_PROTOCOL:cv};const uv=`
message Addresses {
  // Address represents a single multiaddr.
  message Address {
    required bytes multiaddr = 1;

    // Flag to indicate if the address comes from a certified source.
    optional bool isCertified = 2;
  }

  // CertifiedRecord contains a serialized signed PeerRecord used to
  // populate the signedAddrs list.
  message CertifiedRecord {
    // The Seq counter from the signed PeerRecord envelope
    uint64 seq = 1;

    // The serialized bytes of the SignedEnvelope containing the PeerRecord.
    bytes raw = 2;
  }

  // The known multiaddrs.
  repeated Address addrs = 1;

  // The most recently received signed PeerRecord.
  CertifiedRecord certified_record = 2;
}
`;var gd=gr(uv).Addresses;const dv=`
message Protocols {
  repeated string protocols = 1;
}
`;var bd=gr(dv).Protocols;const tt=Q("libp2p:persistent-peer-store");tt.error=Q("libp2p:persistent-peer-store:error");const{Key:Oa}=mo,{NAMESPACE_ADDRESS:hv,NAMESPACE_COMMON:pv,NAMESPACE_KEYS:fv,NAMESPACE_METADATA:mv,NAMESPACE_PROTOCOL:gv}=lv;class bv extends md{constructor({peerId:t,datastore:e,threshold:r=5}){super({peerId:t});this._datastore=e,this._dirtyPeers=new Set,this._dirtyMetadata=new Map,this.threshold=r,this._addDirtyPeer=this._addDirtyPeer.bind(this)}async start(){tt("PeerStore is starting"),this.on("change:protocols",this._addDirtyPeer),this.on("change:multiaddrs",this._addDirtyPeer),this.on("change:pubkey",this._addDirtyPeerKey),this.on("change:metadata",this._addDirtyPeerMetadata);for await(const t of this._datastore.query({prefix:pv}))await this._processDatastoreEntry(t);tt("PeerStore started")}async stop(){tt("PeerStore is stopping"),this.removeAllListeners(),await this._commitData(),tt("PeerStore stopped")}_addDirtyPeer({peerId:t}){const e=t.toB58String();tt("add dirty peer",e),this._dirtyPeers.add(e),this._dirtyPeers.size>=this.threshold&&this._commitData().catch(r=>{tt.error("error committing data",r)})}_addDirtyPeerKey({peerId:t}){if(t.hasInlinePublicKey())return;const e=t.toB58String();tt("add dirty peer key",e),this._dirtyPeers.add(e),this._dirtyPeers.size>=this.threshold&&this._commitData().catch(r=>{tt.error("error committing data",r)})}_addDirtyPeerMetadata({peerId:t,metadata:e}){const r=t.toB58String();tt("add dirty metadata peer",r),this._dirtyPeers.add(r);const n=this._dirtyMetadata.get(r)||new Set;n.add(e),this._dirtyMetadata.set(r,n),this._dirtyPeers.size>=this.threshold&&this._commitData().catch(i=>{tt.error("error committing data",i)})}async _commitData(){const t=Array.from(this._dirtyPeers);if(!t.length)return;this._dirtyPeers.clear(),tt("create batch commit");const e=this._datastore.batch();for(const r of t){const n=this.keyBook.data.get(r)||pe.createFromCID(r);this._batchAddressBook(n,e),!n.hasInlinePublicKey()&&this._batchKeyBook(n,e),this._batchMetadataBook(n,e),this._batchProtoBook(n,e)}await e.commit(),tt("batch committed")}_batchAddressBook(t,e){const r=t.toString(),n=new Oa(`${hv}${r}`),i=this.addressBook.data.get(t.toB58String());try{if(!i){e.delete(n);return}const s=gd.encode({addrs:i.addresses.map(a=>({multiaddr:a.multiaddr.bytes,isCertified:a.isCertified})),certified_record:i.record?{seq:i.record.seqNumber,raw:i.record.raw}:void 0});e.put(n,s)}catch(s){tt.error(s)}}_batchKeyBook(t,e){const r=t.toString(),n=new Oa(`${fv}${r}`);try{if(!t.pubKey){e.delete(n);return}const i=t.marshalPubKey();e.put(n,i)}catch(i){tt.error(i)}}_batchMetadataBook(t,e){const r=t.toString(),n=this._dirtyMetadata.get(t.toB58String())||[];try{n.forEach(i=>{const s=new Oa(`${mv}${r}/${i}`),a=this.metadataBook.getValue(t,i);a?e.put(s,a):e.delete(s)})}catch(i){tt.error(i)}}_batchProtoBook(t,e){const r=t.toString(),n=new Oa(`${gv}${r}`),i=this.protoBook.get(t);try{if(!i){e.delete(n);return}const s=bd.encode({protocols:i});e.put(n,s)}catch(s){tt.error(s)}}async _processDatastoreEntry({key:t,value:e}){try{const r=t.toString().split("/"),n=pe.createFromCID(r[3]);let i;switch(r[2]){case"addrs":i=gd.decode(e),this.addressBook._setData(n,{addresses:i.addrs.map(s=>({multiaddr:Fe(s.multiaddr),isCertified:Boolean(s.isCertified)})),record:i.certified_record?{raw:i.certified_record.raw,seqNumber:i.certified_record.seq}:void 0},{emit:!1});break;case"keys":i=await pe.createFromPubKey(e),this.keyBook._setData(i,i,{emit:!1});break;case"metadata":this.metadataBook._setValue(n,r[4],e,{emit:!1});break;case"protos":i=bd.decode(e),this.protoBook._setData(n,new Set(i.protocols),{emit:!1});break;default:tt("invalid data persisted for: ",t.toString())}}catch(r){tt.error(r)}}}var yv=bv;const yd=()=>{};class vv{constructor({min:t=0,max:e=Infinity,handlers:r={}}){this.min=t,this.max=e,this._onConnect=r.onConnect||yd,this._onDisconnect=r.onDisconnect||yd,this.peers=new Set}set registrar(t){this._registrar=t}disconnect(t){this._onDisconnect(t)}}var wv=br(vv,{className:"Topology",symbolName:"@libp2p/js-interfaces/topology"});const _v=Q("libp2p:peer-store");_v.error=Q("libp2p:peer-store:error");const{ERR_INVALID_PARAMETERS:Ev}=lt;class Sv{constructor({peerStore:t,connectionManager:e}){this.peerStore=t,this.connectionManager=e,this.topologies=new Map,this._handle=void 0,this._onDisconnect=this._onDisconnect.bind(this),this.connectionManager.on("peer:disconnect",this._onDisconnect)}get handle(){return this._handle}set handle(t){this._handle=t}getConnection(t){return this.connectionManager.get(t)}register(t){if(!wv.isTopology(t))throw U(new Error("topology must be an instance of interfaces/topology"),Ev);const e=parseInt(Math.random()*1e9).toString(36)+Date.now();return this.topologies.set(e,t),t.registrar=this,e}unregister(t){return this.topologies.delete(t)}_onDisconnect(t,e){for(const[,r]of this.topologies)r.disconnect(t.remotePeer,e)}}var Tv=Sv,lc=re(function(t){const{Buffer:e}=Ss;t.exports=async function*(r){for await(const n of r)e.isBuffer(n)?yield n:ct.isBufferList(n)?yield n.slice():yield e.from(n)},t.exports.toBuffer=t.exports,t.exports.toList=async function*(r){for await(const n of r)e.isBuffer(n)?yield new ct().append(n):ct.isBufferList(n)?yield n:yield new ct().append(e.from(n))}}),Av={PROTOCOL:"/ipfs/ping/1.0.0",PING_LENGTH:32},Da=re(function(t,e){const r=Q("libp2p-ping");r.error=Q("libp2p-ping:error");const{toBuffer:n}=lc,{collect:i,take:s}=bo,{PROTOCOL:a,PING_LENGTH:c}=Av;async function o(h,f){r("dialing %s to %s",a,f.toB58String?f.toB58String():f);const{stream:p}=await h.dialProtocol(f,a),S=new Date,D=Kt.randomBytes(c),[I]=await ft([D],p,V=>s(1,V),n,i),k=Date.now();if(!D.equals(I))throw U(new Error("Received wrong ping ack"),"ERR_WRONG_PING_ACK");return k-S}function l(h){h.handle(a,({stream:f})=>ft(f,f))}function u(h){h.unhandle(a)}e=t.exports=o,e.mount=l,e.unmount=u}),Cv=t=>e=>async function*(){for await(const r of e)yield t.encode(r)}(),Iv=t=>e=>async function*(){for await(const r of e)yield t.decode(r)}(),uc={encode:Cv,decode:Iv},Rv=t=>e=>Xe.encode()(uc.encode(t)(e)),kv=t=>e=>uc.decode(t)(lc(Xe.decode()(e))),Pv=uc,Nv={encode:Rv,decode:kv,it:Pv};const Ov=`
message Identify {
  // protocolVersion determines compatibility between peers
  optional string protocolVersion = 5; // e.g. ipfs/1.0.0

  // agentVersion is like a UserAgent string in browsers, or client version in bittorrent
  // includes the client name and client.
  optional string agentVersion = 6; // e.g. go-ipfs/0.1.0

  // publicKey is this node's public key (which also gives its node.ID)
  // - may not need to be sent, as secure channel implies it has been sent.
  // - then again, if we change / disable secure channel, may still want it.
  optional bytes publicKey = 1;

  // listenAddrs are the multiaddrs the sender node listens for open connections on
  repeated bytes listenAddrs = 2;

  // oservedAddr is the multiaddr of the remote endpoint that the sender node perceives
  // this is useful information to convey to the other side, as it helps the remote endpoint
  // determine whether its connection to the local peer goes through NAT.
  optional bytes observedAddr = 4;

  repeated string protocols = 3;

  // signedPeerRecord contains a serialized SignedEnvelope containing a PeerRecord,
  // signed by the sending node. It contains the same addresses as the listenAddrs field, but
  // in a form that lets us share authenticated addrs with other peers.
  optional bytes signedPeerRecord = 8;
}
`;var Fs=gr(Ov).Identify;const er=Q("libp2p:identify");er.error=Q("libp2p:identify:error");const{collect:vd,take:wd,consume:_d}=bo,{toBuffer:Ed}=lc,{MULTICODEC_IDENTIFY:dc,MULTICODEC_IDENTIFY_PUSH:Ma,AGENT_VERSION:Dv,PROTOCOL_VERSION:Mv}=nu,{codes:hc}=lt;class Sd{static getCleanMultiaddr(t){if(t&&t.length>0)try{return Fe(t)}catch(e){return null}return null}constructor({libp2p:t,protocols:e}){this.peerStore=t.peerStore,this.connectionManager=t.connectionManager,this.connectionManager.on("peer:connect",r=>{const n=r.remotePeer;this.identify(r,n).catch(er.error)}),this.peerId=t.peerId,this._libp2p=t,this._protocols=e,this.handleMessage=this.handleMessage.bind(this),this._host={agentVersion:Dv,protocolVersion:Mv,...t._options.host},this.peerStore.metadataBook.set(this.peerId,"AgentVersion",$e(this._host.agentVersion)),this.peerStore.metadataBook.set(this.peerId,"ProtocolVersion",$e(this._host.protocolVersion))}async push(t){const e=await this._getSelfPeerRecord(),r=this._libp2p.multiaddrs.map(s=>s.bytes),n=Array.from(this._protocols.keys()),i=t.map(async s=>{try{const{stream:a}=await s.newStream(Ma);await ft([{listenAddrs:r,signedPeerRecord:e,protocols:n}],Nv.encode(Fs),a,_d)}catch(a){er.error("could not push identify update to peer",a)}});return Promise.all(i)}pushToPeerStore(t){const e=[];let r;for(const n of t.peers.values())n.protocols.includes(Ma)&&(r=this.connectionManager.get(n.id))&&e.push(r);this.push(e)}async identify(t){const{stream:e}=await t.newStream(dc),[r]=await ft([],e,Xe.decode(),wd(1),Ed,vd);if(!r)throw U(new Error("No data could be retrieved"),hc.ERR_CONNECTION_ENDED);let n;try{n=Fs.decode(r)}catch(u){throw U(u,hc.ERR_INVALID_MESSAGE)}let{publicKey:i,listenAddrs:s,protocols:a,observedAddr:c,signedPeerRecord:o}=n;const l=await pe.createFromPubKey(i);if(t.remotePeer.toB58String()!==l.toB58String())throw U(new Error("identified peer does not match the expected peer"),hc.ERR_INVALID_PEER);c=Sd.getCleanMultiaddr(c);try{const u=await Us.openAndCertify(o,ka.DOMAIN);if(this.peerStore.addressBook.consumePeerRecord(u)){this.peerStore.protoBook.set(l,a);return}}catch(u){er("received invalid envelope, discard it and fallback to listenAddrs is available",u)}try{this.peerStore.addressBook.set(l,s.map(u=>Fe(u)))}catch(u){er.error("received invalid addrs",u)}this.peerStore.protoBook.set(l,a),this.peerStore.metadataBook.set(l,"AgentVersion",$e(n.agentVersion)),er("received observed address of %s",c)}handleMessage({connection:t,stream:e,protocol:r}){switch(r){case dc:return this._handleIdentify({connection:t,stream:e});case Ma:return this._handlePush({connection:t,stream:e});default:er.error("cannot handle unknown protocol %s",r)}}async _handleIdentify({connection:t,stream:e}){let r=new Uint8Array(0);this.peerId.pubKey&&(r=this.peerId.pubKey.bytes);const n=await this._getSelfPeerRecord(),i=Fs.encode({protocolVersion:this._host.protocolVersion,agentVersion:this._host.agentVersion,publicKey:r,listenAddrs:this._libp2p.multiaddrs.map(s=>s.bytes),signedPeerRecord:n,observedAddr:t.remoteAddr.bytes,protocols:Array.from(this._protocols.keys())});try{await ft([i],Xe.encode(),e,_d)}catch(s){er.error("could not respond to identify request",s)}}async _handlePush({connection:t,stream:e}){let r;try{const[i]=await ft([],e,Xe.decode(),wd(1),Ed,vd);r=Fs.decode(i)}catch(i){return er.error("received invalid message",i)}const n=t.remotePeer;try{const i=await Us.openAndCertify(r.signedPeerRecord,ka.DOMAIN);if(this.peerStore.addressBook.consumePeerRecord(i)){this.peerStore.protoBook.set(n,r.protocols);return}}catch(i){er("received invalid envelope, discard it and fallback to listenAddrs is available",i)}try{this.peerStore.addressBook.set(n,r.listenAddrs.map(i=>Fe(i)))}catch(i){er.error("received invalid addrs",i)}this.peerStore.protoBook.set(n,r.protocols)}async _getSelfPeerRecord(){const t=this.peerStore.addressBook.getRawEnvelope(this.peerId);if(t)return t;try{const e=new ka({peerId:this.peerId,multiaddrs:this._libp2p.multiaddrs}),r=await Us.seal(e,this.peerId);return this.peerStore.addressBook.consumePeerRecord(r),this.peerStore.addressBook.getRawEnvelope(this.peerId)}catch(e){er.error("failed to get self peer record")}return null}}var xv=Sd,Lv={IDENTIFY:dc,IDENTIFY_PUSH:Ma},jv=Fs,Bv={IdentifyService:xv,multicodecs:Lv,Message:jv};const{EventEmitter:Uv}=_t,Ut=Q("libp2p");Ut.error=Q("libp2p:error");const{validate:Fv}=eg,{codes:pc,messages:qv}=lt,{IdentifyService:Gv,multicodecs:Vv}=Bv;class xa extends Uv{constructor(t){super();if(this._options=Fv(t),this.peerId=this._options.peerId,this.datastore=this._options.datastore,this.peerStore=this.datastore&&this._options.peerStore.persistence?new yv({peerId:this.peerId,datastore:this.datastore,...this._options.peerStore}):new md({peerId:this.peerId}),this.addresses=this._options.addresses,this.addressManager=new ng(this._options.addresses),this._modules=this._options.modules,this._config=this._options.config,this._transport=[],this._discovery=new Map,this._options.connectionManager.minPeers&&(this._options.connectionManager.minConnections=this._options.connectionManager.minPeers),this.connectionManager=new hg(this,{autoDial:this._config.peerDiscovery.autoDial,...this._options.connectionManager}),this._options.metrics.enabled&&(this.metrics=new Zb({...this._options.metrics,connectionManager:this.connectionManager})),this._options.keychain&&this._options.keychain.datastore){Ut("creating keychain");const r=Lu.generateOptions();this.keychain=new Lu(this._options.keychain.datastore,{passPhrase:this._options.keychain.pass,...r,...this._options.keychain}),Ut("keychain constructed")}if(this.upgrader=new Py({localPeer:this.peerId,metrics:this.metrics,onConnection:r=>this.connectionManager.onConnect(r),onConnectionEnd:r=>this.connectionManager.onDisconnect(r)}),this.transportManager=new uu({libp2p:this,upgrader:this.upgrader,faultTolerance:this._options.transportManager.faultTolerance}),this.registrar=new Tv({peerStore:this.peerStore,connectionManager:this.connectionManager}),this.handle=this.handle.bind(this),this.registrar.handle=this.handle,!this._modules.connEncryption||!this._modules.connEncryption.length)throw U(new Error(qv.CONN_ENCRYPTION_REQUIRED),pc.CONN_ENCRYPTION_REQUIRED);const e=this._modules.connEncryption;if(e.forEach(r=>{this.upgrader.cryptos.set(r.protocol,r)}),this.dialer=new Ab({transportManager:this.transportManager,peerStore:this.peerStore,concurrency:this._options.dialer.maxParallelDials,perPeerLimit:this._options.dialer.maxDialsPerPeer,timeout:this._options.dialer.dialTimeout,resolvers:this._options.dialer.resolvers}),this._modules.transport.forEach(r=>{const n=r.prototype[Symbol.toStringTag],i=this._config.transport[n];this.transportManager.add(n,r,i)}),this._config.relay.enabled&&this.transportManager.add(Nu.prototype[Symbol.toStringTag],Nu),this._modules.streamMuxer){const r=this._modules.streamMuxer;r.forEach(n=>{this.upgrader.muxers.set(n.multicodec,n)}),this.identifyService=new Gv({libp2p:this,protocols:this.upgrader.protocols}),this.handle(Object.values(Vv),this.identifyService.handleMessage)}if(this._modules.connProtector)this.upgrader.protector=this._modules.connProtector;else if(Ln.process!==void 0&&Ln.process.env&&Ln.process.env.LIBP2P_FORCE_PNET)throw new Error("Private network is enforced, but no protector was provided");if(this._modules.dht){const r=this._modules.dht;this._dht=new r({libp2p:this,dialer:this.dialer,peerId:this.peerId,peerStore:this.peerStore,registrar:this.registrar,datastore:this.datastore,...this._config.dht})}if(this._modules.pubsub){const r=this._modules.pubsub;this.pubsub=nv(r,this,this._config.pubsub)}this.peerRouting=_f(this),this.contentRouting=Cf(this),Da.mount(this),this._onDiscoveryPeer=this._onDiscoveryPeer.bind(this)}emit(t,...e){t==="error"&&!this._events.error?Ut.error(...e):super.emit(t,...e)}async start(){Ut("libp2p is starting");try{await this._onStarting(),await this._onDidStart(),Ut("libp2p has started")}catch(t){throw this.emit("error",t),Ut.error("An error occurred starting libp2p",t),await this.stop(),t}}async stop(){Ut("libp2p is stopping");try{for(const t of this._discovery.values())t.removeListener("peer",this._onDiscoveryPeer);await Promise.all(Array.from(this._discovery.values(),t=>t.stop())),this._discovery=new Map,await this.peerStore.stop(),await this.connectionManager.stop(),await Promise.all([this.pubsub&&this.pubsub.stop(),this._dht&&this._dht.stop(),this.metrics&&this.metrics.stop()]),await this.transportManager.close(),Da.unmount(this),this.dialer.destroy()}catch(t){t&&(Ut.error(t),this.emit("error",t))}this._isStarted=!1,Ut("libp2p has stopped")}async loadKeychain(){try{await this.keychain.findKeyByName("self")}catch(t){await this.keychain.importPeer("self",this.peerId)}}isStarted(){return this._isStarted}get connections(){return this.connectionManager.connections}dial(t,e){return this.dialProtocol(t,null,e)}async dialProtocol(t,e,r){const{id:n,multiaddrs:i}=fa(t);if(n.equals(this.peerId))throw U(new Error("Cannot dial self"),pc.ERR_DIALED_SELF);let s=this.connectionManager.get(n);return s?i&&this.peerStore.addressBook.add(n,i):s=await this.dialer.connectToPeer(t,r),e?s.newStream(e):s}get multiaddrs(){const t=this.addressManager.getNoAnnounceAddrs();return this.transportManager.getAddrs().concat(this.addressManager.getAnnounceAddrs()).filter((e,r,n)=>n.findIndex(i=>i.equals(e))!==r?!1:!t.find(i=>i.equals(e)))}async hangUp(t){const{id:e}=fa(t),r=this.connectionManager.connections.get(e.toB58String());if(!r)return;await Promise.all(r.map(n=>n.close()))}ping(t){const{id:e,multiaddrs:r}=fa(t);return r?Da(this,r[0]):Da(this,e)}handle(t,e){t=Array.isArray(t)?t:[t],t.forEach(r=>{this.upgrader.protocols.set(r,e)}),this.isStarted()&&this.identifyService&&this.identifyService.pushToPeerStore(this.peerStore)}unhandle(t){t=Array.isArray(t)?t:[t],t.forEach(e=>{this.upgrader.protocols.delete(e)}),this.isStarted()&&this.identifyService&&this.identifyService.pushToPeerStore(this.peerStore)}async _onStarting(){await this.transportManager.listen(),await this.peerStore.start(),this._config.pubsub.enabled&&(this.pubsub&&this.pubsub.start()),this._config.dht.enabled&&(this._dht&&this._dht.start(),this._dht.on("peer",this._onDiscoveryPeer)),this.metrics&&this.metrics.start()}async _onDidStart(){this._isStarted=!0,this.peerStore.on("peer",t=>{this.emit("peer:discovery",t),this._maybeConnect(t)});for(const t of this.peerStore.peers.values())this.emit("peer:discovery",t.id);this.connectionManager.start(),await this._setupPeerDiscovery()}_onDiscoveryPeer(t){if(t.id.toB58String()===this.peerId.toB58String()){Ut.error(new Error(pc.ERR_DISCOVERED_SELF));return}t.multiaddrs&&this.peerStore.addressBook.add(t.id,t.multiaddrs),t.protocols&&this.peerStore.protoBook.set(t.id,t.protocols)}async _maybeConnect(t){if(this._config.peerDiscovery.autoDial===!0&&!this.connectionManager.get(t)){const e=this._options.connectionManager.minConnections||0;if(e>this.connectionManager.size){Ut("connecting to discovered peer %s",t.toB58String());try{await this.dialer.connectToPeer(t)}catch(r){Ut.error("could not connect to discovered peer",r)}}}}async _setupPeerDiscovery(){const t=e=>{let r={enabled:!0};if(e.tag&&this._config.peerDiscovery&&this._config.peerDiscovery[e.tag]&&(r={...r,...this._config.peerDiscovery[e.tag]}),r.enabled&&!this._discovery.has(e.tag)){let n;typeof e=="function"?n=new e(Object.assign({},r,{peerId:this.peerId,libp2p:this})):n=e,n.on("peer",this._onDiscoveryPeer),this._discovery.set(e.tag,n)}};for(const e of this._modules.peerDiscovery||[])t(e);for(const e of this.transportManager.getTransports())e.discovery&&t(e.discovery);await Promise.all(Array.from(this._discovery.values(),e=>e.start()))}}xa.create=async function(e={}){if(e.peerId)return new xa(e);const r=await pe.create();return e.peerId=r,new xa(e)};var $v=xa,Hv=typeof WebSocket=="undefined"?mi:WebSocket,fc=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(i){if(this.isStopped)return;const s={value:i,done:!1};if(this.pullQueue.length){const a=this.pullQueue.shift();a&&a.resolve(s)}else this.pushQueue.push(Promise.resolve(s)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(this.isStopped)return;this.isStopped=!0,this.remove();for(const i of this.pullQueue)i.resolve({value:void 0,done:!0});this.pullQueue.length=0}fail(i){if(this.isStopped)return;if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const s of this.pullQueue)s.reject(i);this.pullQueue.length=0}else{const s=Promise.reject(i);s.catch(()=>{}),this.pushQueue.push(s)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:i=>{const s=this.pushQueue.shift();return s?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),s):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((a,c)=>{this.pullQueue.push({resolve:a,reject:c})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class n{constructor(i,{highWaterMark:s=100,lowWaterMark:a=1}={}){const c=new r;c.highWaterMark=s,c.lowWaterMark=a,c.removeCallback=i({push:o=>c.push(o),stop:()=>c.stop(),fail:o=>c.fail(o),on:(o,l)=>{c.eventHandlers[o]=l}})||(()=>{}),this[Symbol.asyncIterator]=()=>c[Symbol.asyncIterator](),Object.freeze(this)}}e.EventIterator=n,e.default=n}),zv=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.EventIterator=fc.EventIterator;function r(n,i,s){return new fc.EventIterator(({push:a})=>(this.addEventListener(n,a,i),()=>this.removeEventListener(n,a,i)),s)}e.subscribe=r,e.default=fc.EventIterator});const{Buffer:Kv}=Ss,{EventIterator:Wv}=zv;function Xv(t){return t instanceof ArrayBuffer||t!=null&&t.constructor!=null&&t.constructor.name==="ArrayBuffer"&&typeof t.byteLength=="number"}var Td=t=>{const e=t.removeEventListener||t.removeListener,r=async function*(){const s=new Wv(({push:a,stop:c,fail:o})=>(t.addEventListener("message",a),t.addEventListener("error",o),t.addEventListener("close",c),()=>{e.call(t,"message",a),e.call(t,"error",o),e.call(t,"close",c)}),{highWaterMark:Infinity});for await(const{data:a}of s)yield Xv(a)?Kv.from(a):a}();let n=t.readyState===1,i;return t.addEventListener("open",()=>{n=!0,i=null}),t.addEventListener("close",()=>{n=!1,i=null}),t.addEventListener("error",s=>{n||(i=s)}),r.connected=()=>new Promise((s,a)=>{if(n)return s();if(i)return a(i);const c=u=>{e.call(t,"open",o),e.call(t,"error",l),u()},o=()=>c(s),l=u=>c(()=>a(u));t.addEventListener("open",o),t.addEventListener("error",l)}),r},Qv=async t=>{if(t.readyState>=2)throw new Error("socket closed");return t.readyState===1?void 0:new Promise((e,r)=>{const n=t&&(t.removeEventListener||t.removeListener);function i(){typeof n=="function"&&(n.call(t,"open",s),n.call(t,"error",a))}function s(){i(),e()}function a(c){i(),r(c)}t.addEventListener("open",s),t.addEventListener("error",a)})},Ad=(t,e)=>(e=e||{},e.closeOnEnd=e.closeOnEnd!==!1,async r=>{for await(const n of r){try{await Qv(t)}catch(i){if(i.message==="socket closed")break;throw i}t.send(n)}if(e.closeOnEnd&&t.readyState<=1)return new Promise((n,i)=>{t.addEventListener("close",s=>{if(s.wasClean||s.code===1006)n();else{const a=Object.assign(new Error("ws error"),{event:s});i(a)}}),setTimeout(()=>t.close())})}),Cd=(t,e)=>{e=e||{},e.binaryType?t.binaryType=e.binaryType:e.binary&&(t.binaryType="arraybuffer");const r={sink:Ad(t,e),source:Td(t),connected:()=>r.source.connected()};return r},Yv=function(t,e,r,n){r=r||{};var t=Ts.parse(t,!1,!0),i;return t.protocol?i=t.protocol:(i=e.protocol?e.protocol.replace(/:$/,""):"http",i=(r[i]||n||i)+":"),t.host&&t.host[0]===":"&&(t.host=null),t.hostname?Ts.format({protocol:i,slashes:!0,hostname:t.hostname,port:t.port,pathname:t.pathname,search:t.search}):(t.host=e.host,t.port?Ts.format({protocol:i,slashes:!0,host:e.hostname+":"+t.port,port:t.port,pathname:t.pathname,search:t.search}):t.pathname?Ts.format({protocol:i,slashes:!0,host:t.host,pathname:t.pathname,search:t.search}):(t.pathname=e.pathname,t.search?Ts.format({protocol:i,slashes:!0,host:t.host,pathname:t.pathname,search:t.search}):(t.search=e.search,t.format(t))))};const Jv={http:"ws",https:"wss"},Zv="ws";var ew=(t,e)=>Yv(t,e,Jv,Zv),Id=re(function(t){t.exports=function(e,r={}){const n=typeof window=="undefined"?{}:window.location,i=ew(e,n),s=new Hv(i,r.websocket),a=Cd(s,r);return a.remoteAddress=i,a.close=()=>new Promise((c,o)=>{s.addEventListener("close",c),s.close()}),a.destroy=()=>{s.terminate?s.terminate():s.close()},a.socket=s,a},t.exports.connect=t.exports});const La=(t,e)=>e,tw=(t,e,r,n)=>{if(n&&n.assumeHttp===!1)return`tcp://${t}:${e}`;let i="tcp",s=`:${e}`;const a=r[r.length-1];return a.protocol==="tcp"&&(i=e==="443"?"https":"http",s=e==="443"||e==="80"?"":s),`${i}://${t}${s}`},rw={ip4:La,ip6:(t,e,r,n)=>n.length===1&&n[0].protocol==="ip6"?e:`[${e}]`,tcp:(t,e,r,n,i)=>n.some(s=>["http","https","ws","wss"].includes(s.protocol))?`${t}:${e}`:tw(t,e,n,i),udp:(t,e)=>`udp://${t}:${e}`,dnsaddr:La,dns4:La,dns6:La,ipfs:(t,e)=>`${t}/ipfs/${e}`,p2p:(t,e)=>`${t}/p2p/${e}`,http:t=>`http://${t}`,https:t=>`https://${t}`,ws:t=>`ws://${t}`,wss:t=>`wss://${t}`,"p2p-websocket-star":t=>`${t}/p2p-websocket-star`,"p2p-webrtc-star":t=>`${t}/p2p-webrtc-star`,"p2p-webrtc-direct":t=>`${t}/p2p-webrtc-direct`};var nw=(t,e)=>{const r=mt(t),n=t.toString().split("/").slice(1);return r.tuples().map(i=>({protocol:n.shift(),content:i[1]?n.shift():null})).reduce((i,s,a,c)=>{const o=rw[s.protocol];if(!o)throw new Error(`Unsupported protocol ${s.protocol}`);return o(i,s.content,a,c,e)},"")},iw=re(function(t,e){e=t.exports=Cd,e.source=Td,e.sink=Ad,e.createServer=mi,e.connect=Id}),sw=421,aw=290,ow=2e3,Rd={CODE_P2P:sw,CODE_CIRCUIT:aw,CLOSE_TIMEOUT:ow},kd=re(function(t,e){(function(){var r,n=244837814094590,i=(n&16777215)==15715070;function s(m,w,T){m!=null&&(typeof m=="number"?this.fromNumber(m,w,T):w==null&&typeof m!="string"?this.fromString(m,256):this.fromString(m,w))}function a(){return new s(null)}function c(m,w,T,L,K,W){for(;--W>=0;){var Y=w*this[m++]+T[L]+K;K=Math.floor(Y/67108864),T[L++]=Y&67108863}return K}function o(m,w,T,L,K,W){for(var Y=w&32767,J=w>>15;--W>=0;){var Te=this[m]&32767,Be=this[m++]>>15,Ye=J*Te+Be*Y;Te=Y*Te+((Ye&32767)<<15)+T[L]+(K&1073741823),K=(Te>>>30)+(Ye>>>15)+J*Be+(K>>>30),T[L++]=Te&1073741823}return K}function l(m,w,T,L,K,W){for(var Y=w&16383,J=w>>14;--W>=0;){var Te=this[m]&16383,Be=this[m++]>>14,Ye=J*Te+Be*Y;Te=Y*Te+((Ye&16383)<<14)+T[L]+K,K=(Te>>28)+(Ye>>14)+J*Be,T[L++]=Te&268435455}return K}var u=typeof navigator!="undefined";u&&i&&navigator.appName=="Microsoft Internet Explorer"?(s.prototype.am=o,r=30):u&&i&&navigator.appName!="Netscape"?(s.prototype.am=c,r=26):(s.prototype.am=l,r=28),s.prototype.DB=r,s.prototype.DM=(1<<r)-1,s.prototype.DV=1<<r;var h=52;s.prototype.FV=Math.pow(2,h),s.prototype.F1=h-r,s.prototype.F2=2*r-h;var f="0123456789abcdefghijklmnopqrstuvwxyz",p=new Array,S,D;for(S="0".charCodeAt(0),D=0;D<=9;++D)p[S++]=D;for(S="a".charCodeAt(0),D=10;D<36;++D)p[S++]=D;for(S="A".charCodeAt(0),D=10;D<36;++D)p[S++]=D;function I(m){return f.charAt(m)}function k(m,w){var T=p[m.charCodeAt(w)];return T??-1}function V(m){for(var w=this.t-1;w>=0;--w)m[w]=this[w];m.t=this.t,m.s=this.s}function H(m){this.t=1,this.s=m<0?-1:0,m>0?this[0]=m:m<-1?this[0]=m+this.DV:this.t=0}function v(m){var w=a();return w.fromInt(m),w}function _(m,w){var T;if(w==16)T=4;else if(w==8)T=3;else if(w==256)T=8;else if(w==2)T=1;else if(w==32)T=5;else if(w==4)T=2;else{this.fromRadix(m,w);return}this.t=0,this.s=0;for(var L=m.length,K=!1,W=0;--L>=0;){var Y=T==8?m[L]&255:k(m,L);if(Y<0){m.charAt(L)=="-"&&(K=!0);continue}K=!1,W==0?this[this.t++]=Y:W+T>this.DB?(this[this.t-1]|=(Y&(1<<this.DB-W)-1)<<W,this[this.t++]=Y>>this.DB-W):this[this.t-1]|=Y<<W,W+=T,W>=this.DB&&(W-=this.DB)}T==8&&(m[0]&128)!=0&&(this.s=-1,W>0&&(this[this.t-1]|=(1<<this.DB-W)-1<<W)),this.clamp(),K&&s.ZERO.subTo(this,this)}function A(){for(var m=this.s&this.DM;this.t>0&&this[this.t-1]==m;)--this.t}function d(m){if(this.s<0)return"-"+this.negate().toString(m);var w;if(m==16)w=4;else if(m==8)w=3;else if(m==2)w=1;else if(m==32)w=5;else if(m==4)w=2;else return this.toRadix(m);var T=(1<<w)-1,L,K=!1,W="",Y=this.t,J=this.DB-Y*this.DB%w;if(Y-- >0)for(J<this.DB&&(L=this[Y]>>J)>0&&(K=!0,W=I(L));Y>=0;)J<w?(L=(this[Y]&(1<<J)-1)<<w-J,L|=this[--Y]>>(J+=this.DB-w)):(L=this[Y]>>(J-=w)&T,J<=0&&(J+=this.DB,--Y)),L>0&&(K=!0),K&&(W+=I(L));return K?W:"0"}function g(){var m=a();return s.ZERO.subTo(this,m),m}function E(){return this.s<0?this.negate():this}function b(m){var w=this.s-m.s;if(w!=0)return w;var T=this.t;if(w=T-m.t,w!=0)return this.s<0?-w:w;for(;--T>=0;)if((w=this[T]-m[T])!=0)return w;return 0}function C(m){var w=1,T;return(T=m>>>16)!=0&&(m=T,w+=16),(T=m>>8)!=0&&(m=T,w+=8),(T=m>>4)!=0&&(m=T,w+=4),(T=m>>2)!=0&&(m=T,w+=2),(T=m>>1)!=0&&(m=T,w+=1),w}function P(){return this.t<=0?0:this.DB*(this.t-1)+C(this[this.t-1]^this.s&this.DM)}function M(m,w){var T;for(T=this.t-1;T>=0;--T)w[T+m]=this[T];for(T=m-1;T>=0;--T)w[T]=0;w.t=this.t+m,w.s=this.s}function O(m,w){for(var T=m;T<this.t;++T)w[T-m]=this[T];w.t=Math.max(this.t-m,0),w.s=this.s}function x(m,w){var T=m%this.DB,L=this.DB-T,K=(1<<L)-1,W=Math.floor(m/this.DB),Y=this.s<<T&this.DM,J;for(J=this.t-1;J>=0;--J)w[J+W+1]=this[J]>>L|Y,Y=(this[J]&K)<<T;for(J=W-1;J>=0;--J)w[J]=0;w[W]=Y,w.t=this.t+W+1,w.s=this.s,w.clamp()}function F(m,w){w.s=this.s;var T=Math.floor(m/this.DB);if(T>=this.t){w.t=0;return}var L=m%this.DB,K=this.DB-L,W=(1<<L)-1;w[0]=this[T]>>L;for(var Y=T+1;Y<this.t;++Y)w[Y-T-1]|=(this[Y]&W)<<K,w[Y-T]=this[Y]>>L;L>0&&(w[this.t-T-1]|=(this.s&W)<<K),w.t=this.t-T,w.clamp()}function q(m,w){for(var T=0,L=0,K=Math.min(m.t,this.t);T<K;)L+=this[T]-m[T],w[T++]=L&this.DM,L>>=this.DB;if(m.t<this.t){for(L-=m.s;T<this.t;)L+=this[T],w[T++]=L&this.DM,L>>=this.DB;L+=this.s}else{for(L+=this.s;T<m.t;)L-=m[T],w[T++]=L&this.DM,L>>=this.DB;L-=m.s}w.s=L<0?-1:0,L<-1?w[T++]=this.DV+L:L>0&&(w[T++]=L),w.t=T,w.clamp()}function z(m,w){var T=this.abs(),L=m.abs(),K=T.t;for(w.t=K+L.t;--K>=0;)w[K]=0;for(K=0;K<L.t;++K)w[K+T.t]=T.am(0,L[K],w,K,0,T.t);w.s=0,w.clamp(),this.s!=m.s&&s.ZERO.subTo(w,w)}function ee(m){for(var w=this.abs(),T=m.t=2*w.t;--T>=0;)m[T]=0;for(T=0;T<w.t-1;++T){var L=w.am(T,w[T],m,2*T,0,1);(m[T+w.t]+=w.am(T+1,2*w[T],m,2*T+1,L,w.t-T-1))>=w.DV&&(m[T+w.t]-=w.DV,m[T+w.t+1]=1)}m.t>0&&(m[m.t-1]+=w.am(T,w[T],m,2*T,0,1)),m.s=0,m.clamp()}function Z(m,w,T){var L=m.abs();if(L.t<=0)return;var K=this.abs();if(K.t<L.t){w!=null&&w.fromInt(0),T!=null&&this.copyTo(T);return}T==null&&(T=a());var W=a(),Y=this.s,J=m.s,Te=this.DB-C(L[L.t-1]);Te>0?(L.lShiftTo(Te,W),K.lShiftTo(Te,T)):(L.copyTo(W),K.copyTo(T));var Be=W.t,Ye=W[Be-1];if(Ye==0)return;var ot=Ye*(1<<this.F1)+(Be>1?W[Be-2]>>this.F2:0),It=this.FV/ot,Bt=(1<<this.F1)/ot,ht=1<<this.F2,xe=T.t,Je=xe-Be,$t=w??a();for(W.dlShiftTo(Je,$t),T.compareTo($t)>=0&&(T[T.t++]=1,T.subTo($t,T)),s.ONE.dlShiftTo(Be,$t),$t.subTo(W,W);W.t<Be;)W[W.t++]=0;for(;--Je>=0;){var kr=T[--xe]==Ye?this.DM:Math.floor(T[xe]*It+(T[xe-1]+ht)*Bt);if((T[xe]+=W.am(0,kr,T,Je,0,Be))<kr)for(W.dlShiftTo(Je,$t),T.subTo($t,T);T[xe]<--kr;)T.subTo($t,T)}w!=null&&(T.drShiftTo(Be,w),Y!=J&&s.ZERO.subTo(w,w)),T.t=Be,T.clamp(),Te>0&&T.rShiftTo(Te,T),Y<0&&s.ZERO.subTo(T,T)}function he(m){var w=a();return this.abs().divRemTo(m,null,w),this.s<0&&w.compareTo(s.ZERO)>0&&m.subTo(w,w),w}function be(m){this.m=m}function se(m){return m.s<0||m.compareTo(this.m)>=0?m.mod(this.m):m}function ae(m){return m}function _e(m){m.divRemTo(this.m,null,m)}function Me(m,w,T){m.multiplyTo(w,T),this.reduce(T)}function rr(m,w){m.squareTo(w),this.reduce(w)}be.prototype.convert=se,be.prototype.revert=ae,be.prototype.reduce=_e,be.prototype.mulTo=Me,be.prototype.sqrTo=rr;function Mt(){if(this.t<1)return 0;var m=this[0];if((m&1)==0)return 0;var w=m&3;return w=w*(2-(m&15)*w)&15,w=w*(2-(m&255)*w)&255,w=w*(2-((m&65535)*w&65535))&65535,w=w*(2-m*w%this.DV)%this.DV,w>0?this.DV-w:-w}function ut(m){this.m=m,this.mp=m.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<m.DB-15)-1,this.mt2=2*m.t}function rt(m){var w=a();return m.abs().dlShiftTo(this.m.t,w),w.divRemTo(this.m,null,w),m.s<0&&w.compareTo(s.ZERO)>0&&this.m.subTo(w,w),w}function Ft(m){var w=a();return m.copyTo(w),this.reduce(w),w}function Qe(m){for(;m.t<=this.mt2;)m[m.t++]=0;for(var w=0;w<this.m.t;++w){var T=m[w]&32767,L=T*this.mpl+((T*this.mph+(m[w]>>15)*this.mpl&this.um)<<15)&m.DM;for(T=w+this.m.t,m[T]+=this.m.am(0,L,m,w,0,this.m.t);m[T]>=m.DV;)m[T]-=m.DV,m[++T]++}m.clamp(),m.drShiftTo(this.m.t,m),m.compareTo(this.m)>=0&&m.subTo(this.m,m)}function Ve(m,w){m.squareTo(w),this.reduce(w)}function oe(m,w,T){m.multiplyTo(w,T),this.reduce(T)}ut.prototype.convert=rt,ut.prototype.revert=Ft,ut.prototype.reduce=Qe,ut.prototype.mulTo=oe,ut.prototype.sqrTo=Ve;function Xi(){return(this.t>0?this[0]&1:this.s)==0}function ri(m,w){if(m>4294967295||m<1)return s.ONE;var T=a(),L=a(),K=w.convert(this),W=C(m)-1;for(K.copyTo(T);--W>=0;)if(w.sqrTo(T,L),(m&1<<W)>0)w.mulTo(L,K,T);else{var Y=T;T=L,L=Y}return w.revert(T)}function Qi(m,w){var T;return m<256||w.isEven()?T=new be(w):T=new ut(w),this.exp(m,T)}s.prototype.copyTo=V,s.prototype.fromInt=H,s.prototype.fromString=_,s.prototype.clamp=A,s.prototype.dlShiftTo=M,s.prototype.drShiftTo=O,s.prototype.lShiftTo=x,s.prototype.rShiftTo=F,s.prototype.subTo=q,s.prototype.multiplyTo=z,s.prototype.squareTo=ee,s.prototype.divRemTo=Z,s.prototype.invDigit=Mt,s.prototype.isEven=Xi,s.prototype.exp=ri,s.prototype.toString=d,s.prototype.negate=g,s.prototype.abs=E,s.prototype.compareTo=b,s.prototype.bitLength=P,s.prototype.mod=he,s.prototype.modPowInt=Qi,s.ZERO=v(0),s.ONE=v(1);function qt(){var m=a();return this.copyTo(m),m}function ni(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function Tr(){return this.t==0?this.s:this[0]<<24>>24}function _n(){return this.t==0?this.s:this[0]<<16>>16}function Ar(m){return Math.floor(Math.LN2*this.DB/Math.log(m))}function Tt(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function En(m){if(m==null&&(m=10),this.signum()==0||m<2||m>36)return"0";var w=this.chunkSize(m),T=Math.pow(m,w),L=v(T),K=a(),W=a(),Y="";for(this.divRemTo(L,K,W);K.signum()>0;)Y=(T+W.intValue()).toString(m).substr(1)+Y,K.divRemTo(L,K,W);return W.intValue().toString(m)+Y}function ii(m,w){this.fromInt(0),w==null&&(w=10);for(var T=this.chunkSize(w),L=Math.pow(w,T),K=!1,W=0,Y=0,J=0;J<m.length;++J){var Te=k(m,J);if(Te<0){m.charAt(J)=="-"&&this.signum()==0&&(K=!0);continue}Y=w*Y+Te,++W>=T&&(this.dMultiply(L),this.dAddOffset(Y,0),W=0,Y=0)}W>0&&(this.dMultiply(Math.pow(w,W)),this.dAddOffset(Y,0)),K&&s.ZERO.subTo(this,this)}function Yi(m,w,T){if(typeof w=="number")if(m<2)this.fromInt(1);else for(this.fromNumber(m,T),this.testBit(m-1)||this.bitwiseTo(s.ONE.shiftLeft(m-1),Sn,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(w);)this.dAddOffset(2,0),this.bitLength()>m&&this.subTo(s.ONE.shiftLeft(m-1),this);else{var L=new Array,K=m&7;L.length=(m>>3)+1,w.nextBytes(L),K>0?L[0]&=(1<<K)-1:L[0]=0,this.fromString(L,256)}}function Ji(){var m=this.t,w=new Array;w[0]=this.s;var T=this.DB-m*this.DB%8,L,K=0;if(m-- >0)for(T<this.DB&&(L=this[m]>>T)!=(this.s&this.DM)>>T&&(w[K++]=L|this.s<<this.DB-T);m>=0;)T<8?(L=(this[m]&(1<<T)-1)<<8-T,L|=this[--m]>>(T+=this.DB-8)):(L=this[m]>>(T-=8)&255,T<=0&&(T+=this.DB,--m)),(L&128)!=0&&(L|=-256),K==0&&(this.s&128)!=(L&128)&&++K,(K>0||L!=this.s)&&(w[K++]=L);return w}function zr(m){return this.compareTo(m)==0}function si(m){return this.compareTo(m)<0?this:m}function ai(m){return this.compareTo(m)>0?this:m}function Kr(m,w,T){var L,K,W=Math.min(m.t,this.t);for(L=0;L<W;++L)T[L]=w(this[L],m[L]);if(m.t<this.t){for(K=m.s&this.DM,L=W;L<this.t;++L)T[L]=w(this[L],K);T.t=this.t}else{for(K=this.s&this.DM,L=W;L<m.t;++L)T[L]=w(K,m[L]);T.t=m.t}T.s=w(this.s,m.s),T.clamp()}function oi(m,w){return m&w}function ci(m){var w=a();return this.bitwiseTo(m,oi,w),w}function Sn(m,w){return m|w}function Zi(m){var w=a();return this.bitwiseTo(m,Sn,w),w}function Gt(m,w){return m^w}function nr(m){var w=a();return this.bitwiseTo(m,Gt,w),w}function Wr(m,w){return m&~w}function Tn(m){var w=a();return this.bitwiseTo(m,Wr,w),w}function li(){for(var m=a(),w=0;w<this.t;++w)m[w]=this.DM&~this[w];return m.t=this.t,m.s=~this.s,m}function At(m){var w=a();return m<0?this.rShiftTo(-m,w):this.lShiftTo(m,w),w}function Ct(m){var w=a();return m<0?this.lShiftTo(-m,w):this.rShiftTo(m,w),w}function es(m){if(m==0)return-1;var w=0;return(m&65535)==0&&(m>>=16,w+=16),(m&255)==0&&(m>>=8,w+=8),(m&15)==0&&(m>>=4,w+=4),(m&3)==0&&(m>>=2,w+=2),(m&1)==0&&++w,w}function Vt(){for(var m=0;m<this.t;++m)if(this[m]!=0)return m*this.DB+es(this[m]);return this.s<0?this.t*this.DB:-1}function ui(m){for(var w=0;m!=0;)m&=m-1,++w;return w}function ts(){for(var m=0,w=this.s&this.DM,T=0;T<this.t;++T)m+=ui(this[T]^w);return m}function rs(m){var w=Math.floor(m/this.DB);return w>=this.t?this.s!=0:(this[w]&1<<m%this.DB)!=0}function ns(m,w){var T=s.ONE.shiftLeft(m);return this.bitwiseTo(T,w,T),T}function is(m){return this.changeBit(m,Sn)}function bt(m){return this.changeBit(m,Wr)}function Cr(m){return this.changeBit(m,Gt)}function An(m,w){for(var T=0,L=0,K=Math.min(m.t,this.t);T<K;)L+=this[T]+m[T],w[T++]=L&this.DM,L>>=this.DB;if(m.t<this.t){for(L+=m.s;T<this.t;)L+=this[T],w[T++]=L&this.DM,L>>=this.DB;L+=this.s}else{for(L+=this.s;T<m.t;)L+=m[T],w[T++]=L&this.DM,L>>=this.DB;L+=m.s}w.s=L<0?-1:0,L>0?w[T++]=L:L<-1&&(w[T++]=this.DV+L),w.t=T,w.clamp()}function Cn(m){var w=a();return this.addTo(m,w),w}function In(m){var w=a();return this.subTo(m,w),w}function Ir(m){var w=a();return this.multiplyTo(m,w),w}function fr(){var m=a();return this.squareTo(m),m}function ss(m){var w=a();return this.divRemTo(m,w,null),w}function as(m){var w=a();return this.divRemTo(m,null,w),w}function os(m){var w=a(),T=a();return this.divRemTo(m,w,T),new Array(w,T)}function cs(m){this[this.t]=this.am(0,m-1,this,0,0,this.t),++this.t,this.clamp()}function Xr(m,w){if(m==0)return;for(;this.t<=w;)this[this.t++]=0;for(this[w]+=m;this[w]>=this.DV;)this[w]-=this.DV,++w>=this.t&&(this[this.t++]=0),++this[w]}function dt(){}function Rn(m){return m}function ir(m,w,T){m.multiplyTo(w,T)}function ls(m,w){m.squareTo(w)}dt.prototype.convert=Rn,dt.prototype.revert=Rn,dt.prototype.mulTo=ir,dt.prototype.sqrTo=ls;function us(m){return this.exp(m,new dt)}function ds(m,w,T){var L=Math.min(this.t+m.t,w);for(T.s=0,T.t=L;L>0;)T[--L]=0;var K;for(K=T.t-this.t;L<K;++L)T[L+this.t]=this.am(0,m[L],T,L,0,this.t);for(K=Math.min(m.t,w);L<K;++L)this.am(0,m[L],T,L,0,w-L);T.clamp()}function hs(m,w,T){--w;var L=T.t=this.t+m.t-w;for(T.s=0;--L>=0;)T[L]=0;for(L=Math.max(w-this.t,0);L<m.t;++L)T[this.t+L-w]=this.am(w-L,m[L],T,0,0,this.t+L-w);T.clamp(),T.drShiftTo(1,T)}function xt(m){this.r2=a(),this.q3=a(),s.ONE.dlShiftTo(2*m.t,this.r2),this.mu=this.r2.divide(m),this.m=m}function Lt(m){if(m.s<0||m.t>2*this.m.t)return m.mod(this.m);if(m.compareTo(this.m)<0)return m;var w=a();return m.copyTo(w),this.reduce(w),w}function Qr(m){return m}function kn(m){for(m.drShiftTo(this.m.t-1,this.r2),m.t>this.m.t+1&&(m.t=this.m.t+1,m.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);m.compareTo(this.r2)<0;)m.dAddOffset(1,this.m.t+1);for(m.subTo(this.r2,m);m.compareTo(this.m)>=0;)m.subTo(this.m,m)}function ps(m,w){m.squareTo(w),this.reduce(w)}function Yr(m,w,T){m.multiplyTo(w,T),this.reduce(T)}xt.prototype.convert=Lt,xt.prototype.revert=Qr,xt.prototype.reduce=kn,xt.prototype.mulTo=Yr,xt.prototype.sqrTo=ps;function di(m,w){var T=m.bitLength(),L,K=v(1),W;if(T<=0)return K;T<18?L=1:T<48?L=3:T<144?L=4:T<768?L=5:L=6,T<8?W=new be(w):w.isEven()?W=new xt(w):W=new ut(w);var Y=new Array,J=3,Te=L-1,Be=(1<<L)-1;if(Y[1]=W.convert(this),L>1){var Ye=a();for(W.sqrTo(Y[1],Ye);J<=Be;)Y[J]=a(),W.mulTo(Ye,Y[J-2],Y[J]),J+=2}var ot=m.t-1,It,Bt=!0,ht=a(),xe;for(T=C(m[ot])-1;ot>=0;){for(T>=Te?It=m[ot]>>T-Te&Be:(It=(m[ot]&(1<<T+1)-1)<<Te-T,ot>0&&(It|=m[ot-1]>>this.DB+T-Te)),J=L;(It&1)==0;)It>>=1,--J;if((T-=J)<0&&(T+=this.DB,--ot),Bt)Y[It].copyTo(K),Bt=!1;else{for(;J>1;)W.sqrTo(K,ht),W.sqrTo(ht,K),J-=2;J>0?W.sqrTo(K,ht):(xe=K,K=ht,ht=xe),W.mulTo(ht,Y[It],K)}for(;ot>=0&&(m[ot]&1<<T)==0;)W.sqrTo(K,ht),xe=K,K=ht,ht=xe,--T<0&&(T=this.DB-1,--ot)}return W.revert(K)}function jt(m){var w=this.s<0?this.negate():this.clone(),T=m.s<0?m.negate():m.clone();if(w.compareTo(T)<0){var L=w;w=T,T=L}var K=w.getLowestSetBit(),W=T.getLowestSetBit();if(W<0)return w;for(K<W&&(W=K),W>0&&(w.rShiftTo(W,w),T.rShiftTo(W,T));w.signum()>0;)(K=w.getLowestSetBit())>0&&w.rShiftTo(K,w),(K=T.getLowestSetBit())>0&&T.rShiftTo(K,T),w.compareTo(T)>=0?(w.subTo(T,w),w.rShiftTo(1,w)):(T.subTo(w,T),T.rShiftTo(1,T));return W>0&&T.lShiftTo(W,T),T}function fs(m){if(m<=0)return 0;var w=this.DV%m,T=this.s<0?m-1:0;if(this.t>0)if(w==0)T=this[0]%m;else for(var L=this.t-1;L>=0;--L)T=(w*T+this[L])%m;return T}function ms(m){var w=m.isEven();if(this.isEven()&&w||m.signum()==0)return s.ZERO;for(var T=m.clone(),L=this.clone(),K=v(1),W=v(0),Y=v(0),J=v(1);T.signum()!=0;){for(;T.isEven();)T.rShiftTo(1,T),w?((!K.isEven()||!W.isEven())&&(K.addTo(this,K),W.subTo(m,W)),K.rShiftTo(1,K)):W.isEven()||W.subTo(m,W),W.rShiftTo(1,W);for(;L.isEven();)L.rShiftTo(1,L),w?((!Y.isEven()||!J.isEven())&&(Y.addTo(this,Y),J.subTo(m,J)),Y.rShiftTo(1,Y)):J.isEven()||J.subTo(m,J),J.rShiftTo(1,J);T.compareTo(L)>=0?(T.subTo(L,T),w&&K.subTo(Y,K),W.subTo(J,W)):(L.subTo(T,L),w&&Y.subTo(K,Y),J.subTo(W,J))}if(L.compareTo(s.ONE)!=0)return s.ZERO;if(J.compareTo(m)>=0)return J.subtract(m);if(J.signum()<0)J.addTo(m,J);else return J;return J.signum()<0?J.add(m):J}var Ke=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],gs=(1<<26)/Ke[Ke.length-1];function bs(m){var w,T=this.abs();if(T.t==1&&T[0]<=Ke[Ke.length-1]){for(w=0;w<Ke.length;++w)if(T[0]==Ke[w])return!0;return!1}if(T.isEven())return!1;for(w=1;w<Ke.length;){for(var L=Ke[w],K=w+1;K<Ke.length&&L<gs;)L*=Ke[K++];for(L=T.modInt(L);w<K;)if(L%Ke[w++]==0)return!1}return T.millerRabin(m)}function Jr(m){var w=this.subtract(s.ONE),T=w.getLowestSetBit();if(T<=0)return!1;var L=w.shiftRight(T);m=m+1>>1,m>Ke.length&&(m=Ke.length);for(var K=a(),W=0;W<m;++W){K.fromInt(Ke[Math.floor(Math.random()*Ke.length)]);var Y=K.modPow(L,this);if(Y.compareTo(s.ONE)!=0&&Y.compareTo(w)!=0){for(var J=1;J++<T&&Y.compareTo(w)!=0;)if(Y=Y.modPowInt(2,this),Y.compareTo(s.ONE)==0)return!1;if(Y.compareTo(w)!=0)return!1}}return!0}s.prototype.chunkSize=Ar,s.prototype.toRadix=En,s.prototype.fromRadix=ii,s.prototype.fromNumber=Yi,s.prototype.bitwiseTo=Kr,s.prototype.changeBit=ns,s.prototype.addTo=An,s.prototype.dMultiply=cs,s.prototype.dAddOffset=Xr,s.prototype.multiplyLowerTo=ds,s.prototype.multiplyUpperTo=hs,s.prototype.modInt=fs,s.prototype.millerRabin=Jr,s.prototype.clone=qt,s.prototype.intValue=ni,s.prototype.byteValue=Tr,s.prototype.shortValue=_n,s.prototype.signum=Tt,s.prototype.toByteArray=Ji,s.prototype.equals=zr,s.prototype.min=si,s.prototype.max=ai,s.prototype.and=ci,s.prototype.or=Zi,s.prototype.xor=nr,s.prototype.andNot=Tn,s.prototype.not=li,s.prototype.shiftLeft=At,s.prototype.shiftRight=Ct,s.prototype.getLowestSetBit=Vt,s.prototype.bitCount=ts,s.prototype.testBit=rs,s.prototype.setBit=is,s.prototype.clearBit=bt,s.prototype.flipBit=Cr,s.prototype.add=Cn,s.prototype.subtract=In,s.prototype.multiply=Ir,s.prototype.divide=ss,s.prototype.remainder=as,s.prototype.divideAndRemainder=os,s.prototype.modPow=di,s.prototype.modInverse=ms,s.prototype.pow=us,s.prototype.gcd=jt,s.prototype.isProbablePrime=bs,s.prototype.square=fr,s.prototype.Barrett=xt;var Zr,at,ke;function ys(m){at[ke++]^=m&255,at[ke++]^=m>>8&255,at[ke++]^=m>>16&255,at[ke++]^=m>>24&255,ke>=rn&&(ke-=rn)}function hi(){ys(new Date().getTime())}if(at==null){at=new Array,ke=0;var yt;if(typeof window!="undefined"&&window.crypto){if(window.crypto.getRandomValues){var pi=new Uint8Array(32);for(window.crypto.getRandomValues(pi),yt=0;yt<32;++yt)at[ke++]=pi[yt]}else if(navigator.appName=="Netscape"&&navigator.appVersion<"5"){var Rr=window.crypto.random(32);for(yt=0;yt<Rr.length;++yt)at[ke++]=Rr.charCodeAt(yt)&255}}for(;ke<rn;)yt=Math.floor(65536*Math.random()),at[ke++]=yt>>>8,at[ke++]=yt&255;ke=0,hi()}function Pn(){if(Zr==null){for(hi(),Zr=ws(),Zr.init(at),ke=0;ke<at.length;++ke)at[ke]=0;ke=0}return Zr.next()}function en(m){var w;for(w=0;w<m.length;++w)m[w]=Pn()}function Nn(){}Nn.prototype.nextBytes=en;function tn(){this.i=0,this.j=0,this.S=new Array}function vs(m){var w,T,L;for(w=0;w<256;++w)this.S[w]=w;for(T=0,w=0;w<256;++w)T=T+this.S[w]+m[w%m.length]&255,L=this.S[w],this.S[w]=this.S[T],this.S[T]=L;this.i=0,this.j=0}function On(){var m;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,m=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=m,this.S[m+this.S[this.i]&255]}tn.prototype.init=vs,tn.prototype.next=On;function ws(){return new tn}var rn=256;e=t.exports={default:s,BigInteger:s,SecureRandom:Nn}}).call(ie)}),ur=re(function(t,e){var r=e.falseIfInvalid=function(n){return function(){return this.valid?n.apply(this,arguments):!1}};e.isInSubnet=r(function(n){return this.subnetMask<n.subnetMask?!1:this.mask(n.subnetMask)===n.mask()}),e.isCorrect=function(n){return r(function(){return this.addressMinusSuffix!==this.correctForm()?!1:this.subnetMask===n&&!this.parsedSubnet?!0:this.parsedSubnet===String(this.subnetMask)})}}),qs=re(function(t,e){!function(){var r={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function n(o){return s(c(o),arguments)}function i(o,l){return n.apply(null,[o].concat(l||[]))}function s(o,l){var u=1,h=o.length,f,p="",S,D,I,k,V,H,v,_;for(S=0;S<h;S++)if(typeof o[S]=="string")p+=o[S];else if(typeof o[S]=="object"){if(I=o[S],I.keys)for(f=l[u],D=0;D<I.keys.length;D++){if(f==null)throw new Error(n('[sprintf] Cannot access property "%s" of undefined value "%s"',I.keys[D],I.keys[D-1]));f=f[I.keys[D]]}else I.param_no?f=l[I.param_no]:f=l[u++];if(r.not_type.test(I.type)&&r.not_primitive.test(I.type)&&f instanceof Function&&(f=f()),r.numeric_arg.test(I.type)&&typeof f!="number"&&isNaN(f))throw new TypeError(n("[sprintf] expecting number but found %T",f));r.number.test(I.type)&&(v=f>=0);switch(I.type){case"b":f=parseInt(f,10).toString(2);break;case"c":f=String.fromCharCode(parseInt(f,10));break;case"d":case"i":f=parseInt(f,10);break;case"j":f=JSON.stringify(f,null,I.width?parseInt(I.width):0);break;case"e":f=I.precision?parseFloat(f).toExponential(I.precision):parseFloat(f).toExponential();break;case"f":f=I.precision?parseFloat(f).toFixed(I.precision):parseFloat(f);break;case"g":f=I.precision?String(Number(f.toPrecision(I.precision))):parseFloat(f);break;case"o":f=(parseInt(f,10)>>>0).toString(8);break;case"s":f=String(f),f=I.precision?f.substring(0,I.precision):f;break;case"t":f=String(!!f),f=I.precision?f.substring(0,I.precision):f;break;case"T":f=Object.prototype.toString.call(f).slice(8,-1).toLowerCase(),f=I.precision?f.substring(0,I.precision):f;break;case"u":f=parseInt(f,10)>>>0;break;case"v":f=f.valueOf(),f=I.precision?f.substring(0,I.precision):f;break;case"x":f=(parseInt(f,10)>>>0).toString(16);break;case"X":f=(parseInt(f,10)>>>0).toString(16).toUpperCase();break}r.json.test(I.type)?p+=f:(r.number.test(I.type)&&(!v||I.sign)?(_=v?"+":"-",f=f.toString().replace(r.sign,"")):_="",V=I.pad_char?I.pad_char==="0"?"0":I.pad_char.charAt(1):" ",H=I.width-(_+f).length,k=I.width&&H>0?V.repeat(H):"",p+=I.align?_+f+k:V==="0"?_+k+f:k+_+f)}return p}var a=Object.create(null);function c(o){if(a[o])return a[o];for(var l=o,u,h=[],f=0;l;){if((u=r.text.exec(l))!==null)h.push(u[0]);else if((u=r.modulo.exec(l))!==null)h.push("%");else if((u=r.placeholder.exec(l))!==null){if(u[2]){f|=1;var p=[],S=u[2],D=[];if((D=r.key.exec(S))!==null)for(p.push(D[1]);(S=S.substring(D[0].length))!=="";)if((D=r.key_access.exec(S))!==null)p.push(D[1]);else if((D=r.index_access.exec(S))!==null)p.push(D[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");u[2]=p}else f|=2;if(f===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");h.push({placeholder:u[0],param_no:u[1],keys:u[2],sign:u[3],pad_char:u[4],align:u[5],width:u[6],precision:u[7],type:u[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");l=l.substring(u[0].length)}return a[o]=h}e.sprintf=n,e.vsprintf=i,typeof window!="undefined"&&(window.sprintf=n,window.vsprintf=i)}()}),mc=1/0,cw=9007199254740991,lw=17976931348623157e292,Pd=0/0,uw="[object Symbol]",dw=/^\s+|\s+$/g,hw=/^[-+]0x[0-9a-f]+$/i,pw=/^0b[01]+$/i,fw=/^0o[0-7]+$/i,gc="\\ud800-\\udfff",Nd="\\u0300-\\u036f\\ufe20-\\ufe23",Od="\\u20d0-\\u20f0",Dd="\\ufe0e\\ufe0f",mw="["+gc+"]",bc="["+Nd+Od+"]",yc="\\ud83c[\\udffb-\\udfff]",gw="(?:"+bc+"|"+yc+")",Md="[^"+gc+"]",xd="(?:\\ud83c[\\udde6-\\uddff]){2}",Ld="[\\ud800-\\udbff][\\udc00-\\udfff]",jd="\\u200d",Bd=gw+"?",Ud="["+Dd+"]?",bw="(?:"+jd+"(?:"+[Md,xd,Ld].join("|")+")"+Ud+Bd+")*",yw=Ud+Bd+bw,vw="(?:"+[Md+bc+"?",bc,xd,Ld,mw].join("|")+")",vc=RegExp(yc+"(?="+yc+")|"+vw+yw,"g"),ww=RegExp("["+jd+gc+Nd+Od+Dd+"]"),_w=parseInt,Ew=typeof ie=="object"&&ie&&ie.Object===Object&&ie,Sw=typeof self=="object"&&self&&self.Object===Object&&self,Tw=Ew||Sw||Function("return this")(),Aw=Iw("length");function Cw(t){return t.split("")}function Iw(t){return function(e){return e==null?void 0:e[t]}}function wc(t){return ww.test(t)}function Fd(t){return wc(t)?kw(t):Aw(t)}function Rw(t){return wc(t)?Pw(t):Cw(t)}function kw(t){for(var e=vc.lastIndex=0;vc.test(t);)e++;return e}function Pw(t){return t.match(vc)||[]}var Nw=Object.prototype,Ow=Nw.toString,qd=Tw.Symbol,Dw=Math.ceil,Mw=Math.floor,Gd=qd?qd.prototype:void 0,Vd=Gd?Gd.toString:void 0;function $d(t,e){var r="";if(!t||e<1||e>cw)return r;do e%2&&(r+=t),e=Mw(e/2),e&&(t+=t);while(e);return r}function xw(t,e,r){var n=-1,i=t.length;e<0&&(e=-e>i?0:i+e),r=r>i?i:r,r<0&&(r+=i),i=e>r?0:r-e>>>0,e>>>=0;for(var s=Array(i);++n<i;)s[n]=t[n+e];return s}function Hd(t){if(typeof t=="string")return t;if(Kd(t))return Vd?Vd.call(t):"";var e=t+"";return e=="0"&&1/t==-mc?"-0":e}function Lw(t,e,r){var n=t.length;return r=r===void 0?n:r,!e&&r>=n?t:xw(t,e,r)}function jw(t,e){e=e===void 0?" ":Hd(e);var r=e.length;if(r<2)return r?$d(e,t):e;var n=$d(e,Dw(t/Fd(e)));return wc(e)?Lw(Rw(n),0,t).join(""):n.slice(0,t)}function zd(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function Bw(t){return!!t&&typeof t=="object"}function Kd(t){return typeof t=="symbol"||Bw(t)&&Ow.call(t)==uw}function Uw(t){if(!t)return t===0?t:0;if(t=qw(t),t===mc||t===-mc){var e=t<0?-1:1;return e*lw}return t===t?t:0}function Fw(t){var e=Uw(t),r=e%1;return e===e?r?e-r:e:0}function qw(t){if(typeof t=="number")return t;if(Kd(t))return Pd;if(zd(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=zd(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(dw,"");var r=pw.test(t);return r||fw.test(t)?_w(t.slice(2),r?2:8):hw.test(t)?Pd:+t}function Gw(t){return t==null?"":Hd(t)}function Vw(t,e,r){t=Gw(t),e=Fw(e);var n=e?Fd(t):0;return e&&n<e?jw(e-n,r)+t:t}var Gs=Vw,_c=1/0,Ec=9007199254740991,$w=17976931348623157e292,Wd=0/0,Hw="[object Function]",zw="[object GeneratorFunction]",Kw="[object Symbol]",Ww=/^\s+|\s+$/g,Xw=/^[-+]0x[0-9a-f]+$/i,Qw=/^0b[01]+$/i,Yw=/^0o[0-7]+$/i,Jw=/^(?:0|[1-9]\d*)$/,Zw=parseInt,e0=typeof ie=="object"&&ie&&ie.Object===Object&&ie,t0=typeof self=="object"&&self&&self.Object===Object&&self,r0=e0||t0||Function("return this")(),n0=Object.prototype,Xd=n0.toString,Qd=r0.Symbol,i0=Math.floor,Yd=Qd?Qd.prototype:void 0,Jd=Yd?Yd.toString:void 0;function s0(t,e){var r="";if(!t||e<1||e>Ec)return r;do e%2&&(r+=t),e=i0(e/2),e&&(t+=t);while(e);return r}function a0(t){if(typeof t=="string")return t;if(Zd(t))return Jd?Jd.call(t):"";var e=t+"";return e=="0"&&1/t==-_c?"-0":e}function o0(t,e){return e=e??Ec,!!e&&(typeof t=="number"||Jw.test(t))&&(t>-1&&t%1==0)&&t<e}function c0(t,e,r){if(!ja(r))return!1;var n=typeof e;return(n=="number"?u0(r)&&o0(e,r.length):n=="string"&&e in r)?l0(r[e],t):!1}function l0(t,e){return t===e||t!==t&&e!==e}function u0(t){return t!=null&&h0(t.length)&&!d0(t)}function d0(t){var e=ja(t)?Xd.call(t):"";return e==Hw||e==zw}function h0(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Ec}function ja(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function p0(t){return!!t&&typeof t=="object"}function Zd(t){return typeof t=="symbol"||p0(t)&&Xd.call(t)==Kw}function f0(t){if(!t)return t===0?t:0;if(t=g0(t),t===_c||t===-_c){var e=t<0?-1:1;return e*$w}return t===t?t:0}function m0(t){var e=f0(t),r=e%1;return e===e?r?e-r:e:0}function g0(t){if(typeof t=="number")return t;if(Zd(t))return Wd;if(ja(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=ja(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(Ww,"");var r=Qw.test(t);return r||Yw.test(t)?Zw(t.slice(2),r?2:8):Xw.test(t)?Wd:+t}function b0(t){return t==null?"":a0(t)}function y0(t,e,r){return(r?c0(t,e,r):e===void 0)?e=1:e=m0(e),s0(b0(t),e)}var Ba=y0,v0=32,w0=4,_0=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/g,E0=/\/\d{1,2}$/,Et={BITS:v0,GROUPS:w0,RE_ADDRESS:_0,RE_SUBNET_STRING:E0},Vs=kd.BigInteger,Ua=qs.sprintf;function Re(t){this.valid=!1,this.address=t,this.groups=Et.GROUPS,this.v4=!0,this.subnet="/32",this.subnetMask=32;var e=Et.RE_SUBNET_STRING.exec(t);if(e){if(this.parsedSubnet=e[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,this.subnetMask<0||this.subnetMask>Et.BITS){this.valid=!1,this.error="Invalid subnet mask.";return}t=t.replace(Et.RE_SUBNET_STRING,"")}this.addressMinusSuffix=t,this.parsedAddress=this.parse(t)}Re.prototype.parse=function(t){var e=t.split(".");return t.match(Et.RE_ADDRESS)?this.valid=!0:this.error="Invalid IPv4 address.",e},Re.prototype.isValid=function(){return this.valid},Re.prototype.correctForm=function(){return this.parsedAddress.map(function(t){return parseInt(t,10)}).join(".")},Re.prototype.isCorrect=ur.isCorrect(Et.BITS),Re.fromHex=function(t){var e=Gs(t.replace(/:/g,""),8,"0"),r=[],n;for(n=0;n<8;n+=2){var i=e.slice(n,n+2);r.push(parseInt(i,16))}return new Re(r.join("."))},Re.fromInteger=function(t){return Re.fromHex(t.toString(16))},Re.prototype.toHex=function(){return this.parsedAddress.map(function(t){return Ua("%02x",parseInt(t,10))}).join(":")},Re.prototype.toArray=function(){return this.parsedAddress.map(function(t){return parseInt(t,10)})},Re.prototype.toGroup6=function(){var t=[],e;for(e=0;e<Et.GROUPS;e+=2){var r=Ua("%02x%02x",parseInt(this.parsedAddress[e],10),parseInt(this.parsedAddress[e+1],10));t.push(Ua("%x",parseInt(r,16)))}return t.join(":")},Re.prototype.bigInteger=function(){return this.valid?new Vs(this.parsedAddress.map(function(t){return Ua("%02x",parseInt(t,10))}).join(""),16):null},Re.prototype._startAddress=function(){return new Vs(this.mask()+Ba("0",Et.BITS-this.subnetMask),2)},Re.prototype.startAddress=function(){return Re.fromBigInteger(this._startAddress())},Re.prototype.startAddressExclusive=function(){var t=new Vs("1");return Re.fromBigInteger(this._startAddress().add(t))},Re.prototype._endAddress=function(){return new Vs(this.mask()+Ba("1",Et.BITS-this.subnetMask),2)},Re.prototype.endAddress=function(){return Re.fromBigInteger(this._endAddress())},Re.prototype.endAddressExclusive=function(){var t=new Vs("1");return Re.fromBigInteger(this._endAddress().subtract(t))},Re.fromBigInteger=function(t){return Re.fromInteger(parseInt(t.toString(),10))},Re.prototype.mask=function(t){return t===void 0&&(t=this.subnetMask),this.getBitsBase2(0,t)},Re.prototype.getBitsBase2=function(t,e){return this.binaryZeroPad().slice(t,e)},Re.prototype.isInSubnet=ur.isInSubnet,Re.prototype.isMulticast=function(){return this.isInSubnet(new Re("224.0.0.0/4"))},Re.prototype.binaryZeroPad=function(){return Gs(this.bigInteger().toString(2),Et.BITS,"0")};var $n=Re,Sc=re(function(t,e){var r=200,n="__lodash_hash_undefined__",i=800,s=16,a=9007199254740991,c="[object Arguments]",o="[object Array]",l="[object AsyncFunction]",u="[object Boolean]",h="[object Date]",f="[object Error]",p="[object Function]",S="[object GeneratorFunction]",D="[object Map]",I="[object Number]",k="[object Null]",V="[object Object]",H="[object Proxy]",v="[object RegExp]",_="[object Set]",A="[object String]",d="[object Undefined]",g="[object WeakMap]",E="[object ArrayBuffer]",b="[object DataView]",C="[object Float32Array]",P="[object Float64Array]",M="[object Int8Array]",O="[object Int16Array]",x="[object Int32Array]",F="[object Uint8Array]",q="[object Uint8ClampedArray]",z="[object Uint16Array]",ee="[object Uint32Array]",Z=/[\\^$.*+?()[\]{}|]/g,he=/^\[object .+?Constructor\]$/,be=/^(?:0|[1-9]\d*)$/,se={};se[C]=se[P]=se[M]=se[O]=se[x]=se[F]=se[q]=se[z]=se[ee]=!0,se[c]=se[o]=se[E]=se[u]=se[b]=se[h]=se[f]=se[p]=se[D]=se[I]=se[V]=se[v]=se[_]=se[A]=se[g]=!1;var ae=typeof ie=="object"&&ie&&ie.Object===Object&&ie,_e=typeof self=="object"&&self&&self.Object===Object&&self,Me=ae||_e||Function("return this")(),rr=e&&!e.nodeType&&e,Mt=rr&&!0&&t&&!t.nodeType&&t,ut=Mt&&Mt.exports===rr,rt=ut&&ae.process,Ft=function(){try{var R=Mt&&Mt.require&&Mt.require("util").types;return R||rt&&rt.binding&&rt.binding("util")}catch(j){}}(),Qe=Ft&&Ft.isTypedArray;function Ve(R,j,G){switch(G.length){case 0:return R.call(j);case 1:return R.call(j,G[0]);case 2:return R.call(j,G[0],G[1]);case 3:return R.call(j,G[0],G[1],G[2])}return R.apply(j,G)}function oe(R,j){for(var G=-1,te=Array(R);++G<R;)te[G]=j(G);return te}function Xi(R){return function(j){return R(j)}}function ri(R,j){return R==null?void 0:R[j]}function Qi(R,j){return function(G){return R(j(G))}}var qt=Array.prototype,ni=Function.prototype,Tr=Object.prototype,_n=Me["__core-js_shared__"],Ar=ni.toString,Tt=Tr.hasOwnProperty,En=function(){var R=/[^.]+$/.exec(_n&&_n.keys&&_n.keys.IE_PROTO||"");return R?"Symbol(src)_1."+R:""}(),ii=Tr.toString,Yi=Ar.call(Object),Ji=RegExp("^"+Ar.call(Tt).replace(Z,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),zr=ut?Me.Buffer:void 0,si=Me.Symbol,ai=Me.Uint8Array,Kr=zr?zr.allocUnsafe:void 0,oi=Qi(Object.getPrototypeOf,Object),ci=Object.create,Sn=Tr.propertyIsEnumerable,Zi=qt.splice,Gt=si?si.toStringTag:void 0,nr=function(){try{var R=Pn(Object,"defineProperty");return R({},"",{}),R}catch(j){}}(),Wr=zr?zr.isBuffer:void 0,Tn=Math.max,li=Date.now,At=Pn(Me,"Map"),Ct=Pn(Object,"create"),es=function(){function R(){}return function(j){if(!xe(j))return{};if(ci)return ci(j);R.prototype=j;var G=new R;return R.prototype=void 0,G}}();function Vt(R){var j=-1,G=R==null?0:R.length;for(this.clear();++j<G;){var te=R[j];this.set(te[0],te[1])}}function ui(){this.__data__=Ct?Ct(null):{},this.size=0}function ts(R){var j=this.has(R)&&delete this.__data__[R];return this.size-=j?1:0,j}function rs(R){var j=this.__data__;if(Ct){var G=j[R];return G===n?void 0:G}return Tt.call(j,R)?j[R]:void 0}function ns(R){var j=this.__data__;return Ct?j[R]!==void 0:Tt.call(j,R)}function is(R,j){var G=this.__data__;return this.size+=this.has(R)?0:1,G[R]=Ct&&j===void 0?n:j,this}Vt.prototype.clear=ui,Vt.prototype.delete=ts,Vt.prototype.get=rs,Vt.prototype.has=ns,Vt.prototype.set=is;function bt(R){var j=-1,G=R==null?0:R.length;for(this.clear();++j<G;){var te=R[j];this.set(te[0],te[1])}}function Cr(){this.__data__=[],this.size=0}function An(R){var j=this.__data__,G=Qr(j,R);if(G<0)return!1;var te=j.length-1;return G==te?j.pop():Zi.call(j,G,1),--this.size,!0}function Cn(R){var j=this.__data__,G=Qr(j,R);return G<0?void 0:j[G][1]}function In(R){return Qr(this.__data__,R)>-1}function Ir(R,j){var G=this.__data__,te=Qr(G,R);return te<0?(++this.size,G.push([R,j])):G[te][1]=j,this}bt.prototype.clear=Cr,bt.prototype.delete=An,bt.prototype.get=Cn,bt.prototype.has=In,bt.prototype.set=Ir;function fr(R){var j=-1,G=R==null?0:R.length;for(this.clear();++j<G;){var te=R[j];this.set(te[0],te[1])}}function ss(){this.size=0,this.__data__={hash:new Vt,map:new(At||bt),string:new Vt}}function as(R){var j=Rr(this,R).delete(R);return this.size-=j?1:0,j}function os(R){return Rr(this,R).get(R)}function cs(R){return Rr(this,R).has(R)}function Xr(R,j){var G=Rr(this,R),te=G.size;return G.set(R,j),this.size+=G.size==te?0:1,this}fr.prototype.clear=ss,fr.prototype.delete=as,fr.prototype.get=os,fr.prototype.has=cs,fr.prototype.set=Xr;function dt(R){var j=this.__data__=new bt(R);this.size=j.size}function Rn(){this.__data__=new bt,this.size=0}function ir(R){var j=this.__data__,G=j.delete(R);return this.size=j.size,G}function ls(R){return this.__data__.get(R)}function us(R){return this.__data__.has(R)}function ds(R,j){var G=this.__data__;if(G instanceof bt){var te=G.__data__;if(!At||te.length<r-1)return te.push([R,j]),this.size=++G.size,this;G=this.__data__=new fr(te)}return G.set(R,j),this.size=G.size,this}dt.prototype.clear=Rn,dt.prototype.delete=ir,dt.prototype.get=ls,dt.prototype.has=us,dt.prototype.set=ds;function hs(R,j){var G=Be(R),te=!G&&Te(R),ye=!G&&!te&&It(R),Ie=!G&&!te&&!ye&&kr(R),Oe=G||te||ye||Ie,fe=Oe?oe(R.length,String):[],Ae=fe.length;for(var pt in R)(j||Tt.call(R,pt))&&!(Oe&&(pt=="length"||ye&&(pt=="offset"||pt=="parent")||Ie&&(pt=="buffer"||pt=="byteLength"||pt=="byteOffset")||tn(pt,Ae)))&&fe.push(pt);return fe}function xt(R,j,G){(G!==void 0&&!J(R[j],G)||G===void 0&&!(j in R))&&kn(R,j,G)}function Lt(R,j,G){var te=R[j];(!(Tt.call(R,j)&&J(te,G))||G===void 0&&!(j in R))&&kn(R,j,G)}function Qr(R,j){for(var G=R.length;G--;)if(J(R[G][0],j))return G;return-1}function kn(R,j,G){j=="__proto__"&&nr?nr(R,j,{configurable:!0,enumerable:!0,value:G,writable:!0}):R[j]=G}var ps=pi();function Yr(R){return R==null?R===void 0?d:k:Gt&&Gt in Object(R)?en(R):w(R)}function di(R){return Je(R)&&Yr(R)==c}function jt(R){if(!xe(R)||ws(R))return!1;var j=Bt(R)?Ji:he;return j.test(Y(R))}function fs(R){return Je(R)&&ht(R.length)&&!!se[Yr(R)]}function ms(R){if(!xe(R))return m(R);var j=rn(R),G=[];for(var te in R)te=="constructor"&&(j||!Tt.call(R,te))||G.push(te);return G}function Ke(R,j,G,te,ye){if(R===j)return;ps(j,function(Ie,Oe){if(ye||(ye=new dt),xe(Ie))gs(R,j,Oe,G,Ke,te,ye);else{var fe=te?te(L(R,Oe),Ie,Oe+"",R,j,ye):void 0;fe===void 0&&(fe=Ie),xt(R,Oe,fe)}},ea)}function gs(R,j,G,te,ye,Ie,Oe){var fe=L(R,G),Ae=L(j,G),pt=Oe.get(Ae);if(pt){xt(R,G,pt);return}var vt=Ie?Ie(fe,Ae,G+"",R,j,Oe):void 0,nn=vt===void 0;if(nn){var Dn=Be(Ae),mr=!Dn&&It(Ae),Mn=!Dn&&!mr&&kr(Ae);vt=Ae,Dn||mr||Mn?Be(fe)?vt=fe:ot(fe)?vt=ys(fe):mr?(nn=!1,vt=Zr(Ae,!0)):Mn?(nn=!1,vt=ke(Ae,!0)):vt=[]:$t(Ae)||Te(Ae)?(vt=fe,Te(fe)?vt=fi(fe):(!xe(fe)||Bt(fe))&&(vt=Nn(Ae))):nn=!1}nn&&(Oe.set(Ae,vt),ye(vt,Ae,te,Ie,Oe),Oe.delete(Ae)),xt(R,G,vt)}function bs(R,j){return K(T(R,j,_s),R+"")}var Jr=nr?function(R,j){return nr(R,"toString",{configurable:!0,enumerable:!1,value:fo(j),writable:!0})}:_s;function Zr(R,j){if(j)return R.slice();var G=R.length,te=Kr?Kr(G):new R.constructor(G);return R.copy(te),te}function at(R){var j=new R.constructor(R.byteLength);return new ai(j).set(new ai(R)),j}function ke(R,j){var G=j?at(R.buffer):R.buffer;return new R.constructor(G,R.byteOffset,R.length)}function ys(R,j){var G=-1,te=R.length;for(j||(j=Array(te));++G<te;)j[G]=R[G];return j}function hi(R,j,G,te){var ye=!G;G||(G={});for(var Ie=-1,Oe=j.length;++Ie<Oe;){var fe=j[Ie],Ae=te?te(G[fe],R[fe],fe,G,R):void 0;Ae===void 0&&(Ae=R[fe]),ye?kn(G,fe,Ae):Lt(G,fe,Ae)}return G}function yt(R){return bs(function(j,G){var te=-1,ye=G.length,Ie=ye>1?G[ye-1]:void 0,Oe=ye>2?G[2]:void 0;for(Ie=R.length>3&&typeof Ie=="function"?(ye--,Ie):void 0,Oe&&vs(G[0],G[1],Oe)&&(Ie=ye<3?void 0:Ie,ye=1),j=Object(j);++te<ye;){var fe=G[te];fe&&R(j,fe,te,Ie)}return j})}function pi(R){return function(j,G,te){for(var ye=-1,Ie=Object(j),Oe=te(j),fe=Oe.length;fe--;){var Ae=Oe[R?fe:++ye];if(G(Ie[Ae],Ae,Ie)===!1)break}return j}}function Rr(R,j){var G=R.__data__;return On(j)?G[typeof j=="string"?"string":"hash"]:G.map}function Pn(R,j){var G=ri(R,j);return jt(G)?G:void 0}function en(R){var j=Tt.call(R,Gt),G=R[Gt];try{R[Gt]=void 0;var te=!0}catch(Ie){}var ye=ii.call(R);return te&&(j?R[Gt]=G:delete R[Gt]),ye}function Nn(R){return typeof R.constructor=="function"&&!rn(R)?es(oi(R)):{}}function tn(R,j){var G=typeof R;return j=j??a,!!j&&(G=="number"||G!="symbol"&&be.test(R))&&(R>-1&&R%1==0)&&R<j}function vs(R,j,G){if(!xe(G))return!1;var te=typeof j;return(te=="number"?Ye(G)&&tn(j,G.length):te=="string"&&j in G)?J(G[j],R):!1}function On(R){var j=typeof R;return j=="string"||j=="number"||j=="symbol"||j=="boolean"?R!=="__proto__":R===null}function ws(R){return!!En&&En in R}function rn(R){var j=R&&R.constructor,G=typeof j=="function"&&j.prototype||Tr;return R===G}function m(R){var j=[];if(R!=null)for(var G in Object(R))j.push(G);return j}function w(R){return ii.call(R)}function T(R,j,G){return j=Tn(j===void 0?R.length-1:j,0),function(){for(var te=arguments,ye=-1,Ie=Tn(te.length-j,0),Oe=Array(Ie);++ye<Ie;)Oe[ye]=te[j+ye];ye=-1;for(var fe=Array(j+1);++ye<j;)fe[ye]=te[ye];return fe[j]=G(Oe),Ve(R,this,fe)}}function L(R,j){return j==="constructor"&&typeof R[j]=="function"||j=="__proto__"?void 0:R[j]}var K=W(Jr);function W(R){var j=0,G=0;return function(){var te=li(),ye=s-(te-G);if(G=te,ye>0){if(++j>=i)return arguments[0]}else j=0;return R.apply(void 0,arguments)}}function Y(R){if(R!=null){try{return Ar.call(R)}catch(j){}try{return R+""}catch(j){}}return""}function J(R,j){return R===j||R!==R&&j!==j}var Te=di(function(){return arguments}())?di:function(R){return Je(R)&&Tt.call(R,"callee")&&!Sn.call(R,"callee")},Be=Array.isArray;function Ye(R){return R!=null&&ht(R.length)&&!Bt(R)}function ot(R){return Je(R)&&Ye(R)}var It=Wr||ta;function Bt(R){if(!xe(R))return!1;var j=Yr(R);return j==p||j==S||j==l||j==H}function ht(R){return typeof R=="number"&&R>-1&&R%1==0&&R<=a}function xe(R){var j=typeof R;return R!=null&&(j=="object"||j=="function")}function Je(R){return R!=null&&typeof R=="object"}function $t(R){if(!Je(R)||Yr(R)!=V)return!1;var j=oi(R);if(j===null)return!0;var G=Tt.call(j,"constructor")&&j.constructor;return typeof G=="function"&&G instanceof G&&Ar.call(G)==Yi}var kr=Qe?Xi(Qe):fs;function fi(R){return hi(R,ea(R))}function ea(R){return Ye(R)?hs(R,!0):ms(R)}var po=yt(function(R,j,G){Ke(R,j,G)});function fo(R){return function(){return R}}function _s(R){return R}function ta(){return!1}t.exports=po}),S0=re(function(t,e){var r=200,n="Expected a function",i="__lodash_hash_undefined__",s=1,a=2,c=1/0,o=9007199254740991,l=17976931348623157e292,u=0/0,h="[object Arguments]",f="[object Array]",p="[object Boolean]",S="[object Date]",D="[object Error]",I="[object Function]",k="[object GeneratorFunction]",V="[object Map]",H="[object Number]",v="[object Object]",_="[object Promise]",A="[object RegExp]",d="[object Set]",g="[object String]",E="[object Symbol]",b="[object WeakMap]",C="[object ArrayBuffer]",P="[object DataView]",M="[object Float32Array]",O="[object Float64Array]",x="[object Int8Array]",F="[object Int16Array]",q="[object Int32Array]",z="[object Uint8Array]",ee="[object Uint8ClampedArray]",Z="[object Uint16Array]",he="[object Uint32Array]",be=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,se=/^\w*$/,ae=/^\./,_e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Me=/[\\^$.*+?()[\]{}|]/g,rr=/^\s+|\s+$/g,Mt=/\\(\\)?/g,ut=/^[-+]0x[0-9a-f]+$/i,rt=/^0b[01]+$/i,Ft=/^\[object .+?Constructor\]$/,Qe=/^0o[0-7]+$/i,Ve=/^(?:0|[1-9]\d*)$/,oe={};oe[M]=oe[O]=oe[x]=oe[F]=oe[q]=oe[z]=oe[ee]=oe[Z]=oe[he]=!0,oe[h]=oe[f]=oe[C]=oe[p]=oe[P]=oe[S]=oe[D]=oe[I]=oe[V]=oe[H]=oe[v]=oe[A]=oe[d]=oe[g]=oe[b]=!1;var Xi=parseInt,ri=typeof ie=="object"&&ie&&ie.Object===Object&&ie,Qi=typeof self=="object"&&self&&self.Object===Object&&self,qt=ri||Qi||Function("return this")(),ni=e&&!e.nodeType&&e,Tr=ni&&!0&&t&&!t.nodeType&&t,_n=Tr&&Tr.exports===ni,Ar=_n&&ri.process,Tt=function(){try{return Ar&&Ar.binding("util")}catch(y){}}(),En=Tt&&Tt.isTypedArray;function ii(y,N){for(var $=-1,X=y?y.length:0;++$<X;)if(N(y[$],$,y))return!0;return!1}function Yi(y,N,$,X){for(var le=y.length,ne=$+(X?1:-1);X?ne--:++ne<le;)if(N(y[ne],ne,y))return ne;return-1}function Ji(y){return function(N){return N==null?void 0:N[y]}}function zr(y,N){for(var $=-1,X=Array(y);++$<y;)X[$]=N($);return X}function si(y){return function(N){return y(N)}}function ai(y,N){return y==null?void 0:y[N]}function Kr(y){var N=!1;if(y!=null&&typeof y.toString!="function")try{N=!!(y+"")}catch($){}return N}function oi(y){var N=-1,$=Array(y.size);return y.forEach(function(X,le){$[++N]=[le,X]}),$}function ci(y,N){return function($){return y(N($))}}function Sn(y){var N=-1,$=Array(y.size);return y.forEach(function(X){$[++N]=X}),$}var Zi=Array.prototype,Gt=Function.prototype,nr=Object.prototype,Wr=qt["__core-js_shared__"],Tn=function(){var y=/[^.]+$/.exec(Wr&&Wr.keys&&Wr.keys.IE_PROTO||"");return y?"Symbol(src)_1."+y:""}(),li=Gt.toString,At=nr.hasOwnProperty,Ct=nr.toString,es=RegExp("^"+li.call(At).replace(Me,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Vt=qt.Symbol,ui=qt.Uint8Array,ts=nr.propertyIsEnumerable,rs=Zi.splice,ns=ci(Object.keys,Object),is=Math.max,bt=xe(qt,"DataView"),Cr=xe(qt,"Map"),An=xe(qt,"Promise"),Cn=xe(qt,"Set"),In=xe(qt,"WeakMap"),Ir=xe(Object,"create"),fr=G(bt),ss=G(Cr),as=G(An),os=G(Cn),cs=G(In),Xr=Vt?Vt.prototype:void 0,dt=Xr?Xr.valueOf:void 0,Rn=Xr?Xr.toString:void 0;function ir(y){var N=-1,$=y?y.length:0;for(this.clear();++N<$;){var X=y[N];this.set(X[0],X[1])}}function ls(){this.__data__=Ir?Ir(null):{}}function us(y){return this.has(y)&&delete this.__data__[y]}function ds(y){var N=this.__data__;if(Ir){var $=N[y];return $===i?void 0:$}return At.call(N,y)?N[y]:void 0}function hs(y){var N=this.__data__;return Ir?N[y]!==void 0:At.call(N,y)}function xt(y,N){var $=this.__data__;return $[y]=Ir&&N===void 0?i:N,this}ir.prototype.clear=ls,ir.prototype.delete=us,ir.prototype.get=ds,ir.prototype.has=hs,ir.prototype.set=xt;function Lt(y){var N=-1,$=y?y.length:0;for(this.clear();++N<$;){var X=y[N];this.set(X[0],X[1])}}function Qr(){this.__data__=[]}function kn(y){var N=this.__data__,$=en(N,y);if($<0)return!1;var X=N.length-1;return $==X?N.pop():rs.call(N,$,1),!0}function ps(y){var N=this.__data__,$=en(N,y);return $<0?void 0:N[$][1]}function Yr(y){return en(this.__data__,y)>-1}function di(y,N){var $=this.__data__,X=en($,y);return X<0?$.push([y,N]):$[X][1]=N,this}Lt.prototype.clear=Qr,Lt.prototype.delete=kn,Lt.prototype.get=ps,Lt.prototype.has=Yr,Lt.prototype.set=di;function jt(y){var N=-1,$=y?y.length:0;for(this.clear();++N<$;){var X=y[N];this.set(X[0],X[1])}}function fs(){this.__data__={hash:new ir,map:new(Cr||Lt),string:new ir}}function ms(y){return Bt(this,y).delete(y)}function Ke(y){return Bt(this,y).get(y)}function gs(y){return Bt(this,y).has(y)}function bs(y,N){return Bt(this,y).set(y,N),this}jt.prototype.clear=fs,jt.prototype.delete=ms,jt.prototype.get=Ke,jt.prototype.has=gs,jt.prototype.set=bs;function Jr(y){var N=-1,$=y?y.length:0;for(this.__data__=new jt;++N<$;)this.add(y[N])}function Zr(y){return this.__data__.set(y,i),this}function at(y){return this.__data__.has(y)}Jr.prototype.add=Jr.prototype.push=Zr,Jr.prototype.has=at;function ke(y){this.__data__=new Lt(y)}function ys(){this.__data__=new Lt}function hi(y){return this.__data__.delete(y)}function yt(y){return this.__data__.get(y)}function pi(y){return this.__data__.has(y)}function Rr(y,N){var $=this.__data__;if($ instanceof Lt){var X=$.__data__;if(!Cr||X.length<r-1)return X.push([y,N]),this;$=this.__data__=new jt(X)}return $.set(y,N),this}ke.prototype.clear=ys,ke.prototype.delete=hi,ke.prototype.get=yt,ke.prototype.has=pi,ke.prototype.set=Rr;function Pn(y,N){var $=Ae(y)||fe(y)?zr(y.length,String):[],X=$.length,le=!!X;for(var ne in y)(N||At.call(y,ne))&&!(le&&(ne=="length"||kr(ne,X)))&&$.push(ne);return $}function en(y,N){for(var $=y.length;$--;)if(Oe(y[$][0],N))return $;return-1}function Nn(y,N){N=fi(N,y)?[N]:Te(N);for(var $=0,X=N.length;y!=null&&$<X;)y=y[j(N[$++])];return $&&$==X?y:void 0}function tn(y){return Ct.call(y)}function vs(y,N){return y!=null&&N in Object(y)}function On(y,N,$,X,le){return y===N?!0:y==null||N==null||!mr(y)&&!Mn(N)?y!==y&&N!==N:ws(y,N,On,$,X,le)}function ws(y,N,$,X,le,ne){var Pe=Ae(y),Le=Ae(N),We=f,nt=f;Pe||(We=Je(y),We=We==h?v:We),Le||(nt=Je(N),nt=nt==h?v:nt);var wt=We==v&&!Kr(y),Rt=nt==v&&!Kr(N),it=We==nt;if(it&&!wt)return ne||(ne=new ke),Pe||zp(y)?Ye(y,N,$,X,le,ne):ot(y,N,We,$,X,le,ne);if(!(le&a)){var Ht=wt&&At.call(y,"__wrapped__"),zt=Rt&&At.call(N,"__wrapped__");if(Ht||zt){var sn=Ht?y.value():y,Pr=zt?N.value():N;return ne||(ne=new ke),$(sn,Pr,X,le,ne)}}return it?(ne||(ne=new ke),It(y,N,$,X,le,ne)):!1}function rn(y,N,$,X){var le=$.length,ne=le,Pe=!X;if(y==null)return!ne;for(y=Object(y);le--;){var Le=$[le];if(Pe&&Le[2]?Le[1]!==y[Le[0]]:!(Le[0]in y))return!1}for(;++le<ne;){Le=$[le];var We=Le[0],nt=y[We],wt=Le[1];if(Pe&&Le[2]){if(nt===void 0&&!(We in y))return!1}else{var Rt=new ke;if(X)var it=X(nt,wt,We,y,N,Rt);if(!(it===void 0?On(wt,nt,X,s|a,Rt):it))return!1}}return!0}function m(y){if(!mr(y)||po(y))return!1;var N=nn(y)||Kr(y)?es:Ft;return N.test(G(y))}function w(y){return Mn(y)&&Dn(y.length)&&!!oe[Ct.call(y)]}function T(y){return typeof y=="function"?y:y==null?Zp:typeof y=="object"?Ae(y)?W(y[0],y[1]):K(y):ef(y)}function L(y){if(!fo(y))return ns(y);var N=[];for(var $ in Object(y))At.call(y,$)&&$!="constructor"&&N.push($);return N}function K(y){var N=ht(y);return N.length==1&&N[0][2]?ta(N[0][0],N[0][1]):function($){return $===y||rn($,y,N)}}function W(y,N){return fi(y)&&_s(N)?ta(j(y),N):function($){var X=Yp($,y);return X===void 0&&X===N?Jp($,y):On(N,X,void 0,s|a)}}function Y(y){return function(N){return Nn(N,y)}}function J(y){if(typeof y=="string")return y;if(ra(y))return Rn?Rn.call(y):"";var N=y+"";return N=="0"&&1/y==-c?"-0":N}function Te(y){return Ae(y)?y:R(y)}function Be(y){return function(N,$,X){var le=Object(N);if(!pt(N)){var ne=T($);N=na(N),$=function(Le){return ne(le[Le],Le,le)}}var Pe=y(N,$,X);return Pe>-1?le[ne?N[Pe]:Pe]:void 0}}function Ye(y,N,$,X,le,ne){var Pe=le&a,Le=y.length,We=N.length;if(Le!=We&&!(Pe&&We>Le))return!1;var nt=ne.get(y);if(nt&&ne.get(N))return nt==N;var wt=-1,Rt=!0,it=le&s?new Jr:void 0;for(ne.set(y,N),ne.set(N,y);++wt<Le;){var Ht=y[wt],zt=N[wt];if(X)var sn=Pe?X(zt,Ht,wt,N,y,ne):X(Ht,zt,wt,y,N,ne);if(sn!==void 0){if(sn)continue;Rt=!1;break}if(it){if(!ii(N,function(Pr,xn){if(!it.has(xn)&&(Ht===Pr||$(Ht,Pr,X,le,ne)))return it.add(xn)})){Rt=!1;break}}else if(!(Ht===zt||$(Ht,zt,X,le,ne))){Rt=!1;break}}return ne.delete(y),ne.delete(N),Rt}function ot(y,N,$,X,le,ne,Pe){switch($){case P:if(y.byteLength!=N.byteLength||y.byteOffset!=N.byteOffset)return!1;y=y.buffer,N=N.buffer;case C:return!(y.byteLength!=N.byteLength||!X(new ui(y),new ui(N)));case p:case S:case H:return Oe(+y,+N);case D:return y.name==N.name&&y.message==N.message;case A:case g:return y==N+"";case V:var Le=oi;case d:var We=ne&a;if(Le||(Le=Sn),y.size!=N.size&&!We)return!1;var nt=Pe.get(y);if(nt)return nt==N;ne|=s,Pe.set(y,N);var wt=Ye(Le(y),Le(N),X,le,ne,Pe);return Pe.delete(y),wt;case E:if(dt)return dt.call(y)==dt.call(N)}return!1}function It(y,N,$,X,le,ne){var Pe=le&a,Le=na(y),We=Le.length,nt=na(N),wt=nt.length;if(We!=wt&&!Pe)return!1;for(var Rt=We;Rt--;){var it=Le[Rt];if(!(Pe?it in N:At.call(N,it)))return!1}var Ht=ne.get(y);if(Ht&&ne.get(N))return Ht==N;var zt=!0;ne.set(y,N),ne.set(N,y);for(var sn=Pe;++Rt<We;){it=Le[Rt];var Pr=y[it],xn=N[it];if(X)var _l=Pe?X(xn,Pr,it,N,y,ne):X(Pr,xn,it,y,N,ne);if(!(_l===void 0?Pr===xn||$(Pr,xn,X,le,ne):_l)){zt=!1;break}sn||(sn=it=="constructor")}if(zt&&!sn){var ia=y.constructor,sa=N.constructor;ia!=sa&&"constructor"in y&&"constructor"in N&&!(typeof ia=="function"&&ia instanceof ia&&typeof sa=="function"&&sa instanceof sa)&&(zt=!1)}return ne.delete(y),ne.delete(N),zt}function Bt(y,N){var $=y.__data__;return ea(N)?$[typeof N=="string"?"string":"hash"]:$.map}function ht(y){for(var N=na(y),$=N.length;$--;){var X=N[$],le=y[X];N[$]=[X,le,_s(le)]}return N}function xe(y,N){var $=ai(y,N);return m($)?$:void 0}var Je=tn;(bt&&Je(new bt(new ArrayBuffer(1)))!=P||Cr&&Je(new Cr)!=V||An&&Je(An.resolve())!=_||Cn&&Je(new Cn)!=d||In&&Je(new In)!=b)&&(Je=function(y){var N=Ct.call(y),$=N==v?y.constructor:void 0,X=$?G($):void 0;if(X)switch(X){case fr:return P;case ss:return V;case as:return _;case os:return d;case cs:return b}return N});function $t(y,N,$){N=fi(N,y)?[N]:Te(N);for(var X,le=-1,ne=N.length;++le<ne;){var Pe=j(N[le]);if(!(X=y!=null&&$(y,Pe)))break;y=y[Pe]}if(X)return X;var ne=y?y.length:0;return!!ne&&Dn(ne)&&kr(Pe,ne)&&(Ae(y)||fe(y))}function kr(y,N){return N=N??o,!!N&&(typeof y=="number"||Ve.test(y))&&(y>-1&&y%1==0)&&y<N}function fi(y,N){if(Ae(y))return!1;var $=typeof y;return $=="number"||$=="symbol"||$=="boolean"||y==null||ra(y)?!0:se.test(y)||!be.test(y)||N!=null&&y in Object(N)}function ea(y){var N=typeof y;return N=="string"||N=="number"||N=="symbol"||N=="boolean"?y!=="__proto__":y===null}function po(y){return!!Tn&&Tn in y}function fo(y){var N=y&&y.constructor,$=typeof N=="function"&&N.prototype||nr;return y===$}function _s(y){return y===y&&!mr(y)}function ta(y,N){return function($){return $==null?!1:$[y]===N&&(N!==void 0||y in Object($))}}var R=Ie(function(y){y=Qp(y);var N=[];return ae.test(y)&&N.push(""),y.replace(_e,function($,X,le,ne){N.push(le?ne.replace(Mt,"$1"):X||$)}),N});function j(y){if(typeof y=="string"||ra(y))return y;var N=y+"";return N=="0"&&1/y==-c?"-0":N}function G(y){if(y!=null){try{return li.call(y)}catch(N){}try{return y+""}catch(N){}}return""}function te(y,N,$){var X=y?y.length:0;if(!X)return-1;var le=$==null?0:Wp($);return le<0&&(le=is(X+le,0)),Yi(y,T(N),le)}var ye=Be(te);function Ie(y,N){if(typeof y!="function"||N&&typeof N!="function")throw new TypeError(n);var $=function(){var X=arguments,le=N?N.apply(this,X):X[0],ne=$.cache;if(ne.has(le))return ne.get(le);var Pe=y.apply(this,X);return $.cache=ne.set(le,Pe),Pe};return $.cache=new(Ie.Cache||jt),$}Ie.Cache=jt;function Oe(y,N){return y===N||y!==y&&N!==N}function fe(y){return vt(y)&&At.call(y,"callee")&&(!ts.call(y,"callee")||Ct.call(y)==h)}var Ae=Array.isArray;function pt(y){return y!=null&&Dn(y.length)&&!nn(y)}function vt(y){return Mn(y)&&pt(y)}function nn(y){var N=mr(y)?Ct.call(y):"";return N==I||N==k}function Dn(y){return typeof y=="number"&&y>-1&&y%1==0&&y<=o}function mr(y){var N=typeof y;return!!y&&(N=="object"||N=="function")}function Mn(y){return!!y&&typeof y=="object"}function ra(y){return typeof y=="symbol"||Mn(y)&&Ct.call(y)==E}var zp=En?si(En):w;function Kp(y){if(!y)return y===0?y:0;if(y=Xp(y),y===c||y===-c){var N=y<0?-1:1;return N*l}return y===y?y:0}function Wp(y){var N=Kp(y),$=N%1;return N===N?$?N-$:N:0}function Xp(y){if(typeof y=="number")return y;if(ra(y))return u;if(mr(y)){var N=typeof y.valueOf=="function"?y.valueOf():y;y=mr(N)?N+"":N}if(typeof y!="string")return y===0?y:+y;y=y.replace(rr,"");var $=rt.test(y);return $||Qe.test(y)?Xi(y.slice(2),$?2:8):ut.test(y)?u:+y}function Qp(y){return y==null?"":J(y)}function Yp(y,N,$){var X=y==null?void 0:Nn(y,N);return X===void 0?$:X}function Jp(y,N){return y!=null&&$t(y,N,vs)}function na(y){return pt(y)?Pn(y):L(y)}function Zp(y){return y}function ef(y){return fi(y)?Ji(j(y)):Y(y)}t.exports=ye}),T0="[object Symbol]",A0=Object.prototype,C0=A0.toString;function I0(t,e,r){for(var n=-1,i=t.length;++n<i;){var s=t[n],a=e(s);if(a!=null&&(c===void 0?a===a&&!P0(a):r(a,c)))var c=a,o=s}return o}function R0(t,e){return t>e}function k0(t){return!!t&&typeof t=="object"}function P0(t){return typeof t=="symbol"||k0(t)&&C0.call(t)==T0}function N0(t){return t}function O0(t){return t&&t.length?I0(t,N0,R0):void 0}var D0=O0,M0=128,x0=8,L0={0:"Reserved",1:"Interface local",2:"Link local",4:"Admin local",5:"Site local",8:"Organization local",14:"Global",15:"Reserved"},j0={"ff01::1/128":"Multicast (All nodes on this interface)","ff01::2/128":"Multicast (All routers on this interface)","ff02::1/128":"Multicast (All nodes on this link)","ff02::2/128":"Multicast (All routers on this link)","ff05::2/128":"Multicast (All routers in this site)","ff02::5/128":"Multicast (OSPFv3 AllSPF routers)","ff02::6/128":"Multicast (OSPFv3 AllDR routers)","ff02::9/128":"Multicast (RIP routers)","ff02::a/128":"Multicast (EIGRP routers)","ff02::d/128":"Multicast (PIM routers)","ff02::16/128":"Multicast (MLDv2 reports)","ff01::fb/128":"Multicast (mDNSv6)","ff02::fb/128":"Multicast (mDNSv6)","ff05::fb/128":"Multicast (mDNSv6)","ff02::1:2/128":"Multicast (All DHCP servers and relay agents on this link)","ff05::1:2/128":"Multicast (All DHCP servers and relay agents in this site)","ff02::1:3/128":"Multicast (All DHCP servers on this link)","ff05::1:3/128":"Multicast (All DHCP servers in this site)","::/128":"Unspecified","::1/128":"Loopback","ff00::/8":"Multicast","fe80::/10":"Link-local unicast"},B0=/([^0-9a-f:\/%])/ig,U0=/([0-9a-f]{5,}|:{3,}|[^:]:$|^:[^:]|\/$)/ig,F0=/\/\d{1,3}(?=%|$)/,q0=/%.*$/,G0=new RegExp(/^\[{0,1}([0-9a-f:]+)\]{0,1}/),V0=new RegExp(/\[([0-9a-f:]+)\]:([0-9]{1,5})/),je={BITS:M0,GROUPS:x0,SCOPES:L0,TYPES:j0,RE_BAD_CHARACTERS:B0,RE_BAD_ADDRESS:U0,RE_SUBNET_STRING:F0,RE_ZONE_STRING:q0,RE_URL:G0,RE_URL_WITH_PORT:V0},$0=function(){return this.valid},H0=ur.isInSubnet,z0=ur.isCorrect(je.BITS),K0=ur.falseIfInvalid(function(){return this.addressMinusSuffix===this.canonicalForm()}),W0=ur.falseIfInvalid(function(){return this.getBitsBase2(0,64)==="1111111010000000000000000000000000000000000000000000000000000000"}),X0=ur.falseIfInvalid(function(){return this.getType()==="Multicast"}),Q0=ur.falseIfInvalid(function(){return this.v4}),Y0=ur.falseIfInvalid(function(){return this.isInSubnet(new this.constructor("2001::/32"))}),J0=ur.falseIfInvalid(function(){return this.isInSubnet(new this.constructor("2002::/16"))}),Z0=ur.falseIfInvalid(function(){return this.getType()==="Loopback"}),e_={isValid:$0,isInSubnet:H0,isCorrect:z0,isCanonical:K0,isLinkLocal:W0,isMulticast:X0,is4:Q0,isTeredo:Y0,is6to4:J0,isLoopback:Z0},Fa=re(function(t,e){var r=qs.sprintf,n=e.spanAllZeroes=function(s){return s.replace(/(0+)/g,'<span class="zero">$1</span>')};e.spanAll=function(s,a){a===void 0&&(a=0);var c=s.split("");return c.map(function(o,l){return r('<span class="digit value-%s position-%d">%s</span>',o,l+a,n(o))}).join("")};function i(s){return s.replace(/^(0+)/,'<span class="zero">$1</span>')}e.spanLeadingZeroes=function(s){var a=s.split(":");return a.map(function(c){return i(c)}).join(":")},e.simpleGroup=function(s,a){var c=s.split(":");return a||(a=0),c.map(function(o,l){return/group-v4/.test(o)?o:r('<span class="hover-group group-%d">%s</span>',l+a,i(o))}).join(":")}}),Hn=qs.sprintf,t_=function(t){return t===void 0?t="":t=Hn(":%s",t),Hn("http://[%s]%s/",this.correctForm(),t)},r_=function(t){t||(t={}),t.className===void 0&&(t.className=""),t.prefix===void 0&&(t.prefix="/#address="),t.v4===void 0&&(t.v4=!1);var e=this.correctForm;return t.v4&&(e=this.to4in6),t.className?Hn('<a href="%1$s%2$s" class="%3$s">%2$s</a>',t.prefix,e.call(this),t.className):Hn('<a href="%1$s%2$s">%2$s</a>',t.prefix,e.call(this))},n_=function(){var t=this.address.match(Et.RE_ADDRESS),e;if(t){var r=t[0].split(".");this.address=this.address.replace(Et.RE_ADDRESS,Hn('<span class="hover-group group-v4 group-6">%s</span>.<span class="hover-group group-v4 group-7">%s</span>',r.slice(0,2).join("."),r.slice(2,4).join(".")))}if(this.elidedGroups===0)return Fa.simpleGroup(this.address);var n=[],i=this.address.split("::");i[0].length?n.push(Fa.simpleGroup(i[0])):n.push("");var s=["hover-group"];for(e=this.elisionBegin;e<this.elisionBegin+this.elidedGroups;e++)s.push(Hn("group-%d",e));return n.push(Hn('<span class="%s"></span>',s.join(" "))),i[1].length?n.push(Fa.simpleGroup(i[1],this.elisionEnd)):n.push(""),n.join(":")},i_={href:t_,link:r_,group:n_},Oi=qs.sprintf;function Tc(t){return Oi("(%s)",t.join("|"))}function Ac(t){return t.length<4?Oi("0{0,%d}%s",4-t.length,t):t}var eh="[^A-Fa-f0-9:]";function Cc(t){var e=[];t.forEach(function(n,i){var s=parseInt(n,16);s===0&&e.push(i)});var r=e.map(function(n){return t.map(function(i,s){if(s===n){var a=s===0||s===je.GROUPS-1?":":"";return Tc([Ac(i),a])}return Ac(i)}).join(":")});return r.push(t.map(Ac).join(":")),Tc(r)}function th(t,e,r){var n=e?"":":",i=r?"":":",s=[];!e&&!r&&s.push("::"),e&&r&&s.push(""),(r&&!e||!r&&e)&&s.push(":"),s.push(Oi("%s(:0{1,4}){1,%d}",n,t-1)),s.push(Oi("(0{1,4}:){1,%d}%s",t-1,i)),s.push(Oi("(0{1,4}:){%d}0{1,4}",t-1));for(var a=1;a<t-1;a++)for(var c=1;c<t-a;c++)s.push(Oi("(0{1,4}:){%d}:(0{1,4}:){%d}0{1,4}",c,t-c-a-1));return Tc(s)}var s_=function(t){t===void 0&&(t=!1);var e=[],r=new this.constructor(this.correctForm());if(r.elidedGroups===0)e.push(Cc(r.parsedAddress));else if(r.elidedGroups===je.GROUPS)e.push(th(je.GROUPS));else{var n=r.address.split("::");n[0].length&&e.push(Cc(n[0].split(":"))),e.push(th(r.elidedGroups,n[0].length!==0,n[1].length!==0)),n[1].length&&e.push(Cc(n[1].split(":"))),e=[e.join(":")]}return t||(e=[].concat("(?=^|",eh,"|[^\\w\\:])(",e,")(?=[^\\w\\:]|",eh,"|$)")),e.join("")},a_=function(t){return new RegExp(this.regularExpressionString(t),"i")},o_={regularExpressionString:s_,regularExpression:a_},St=kd.BigInteger,Br=qs.sprintf;function c_(t){for(var e=/(\d+)(\d{3})/;e.test(t);)t=t.replace(e,"$1,$2");return t}function l_(t){return t=t.replace(/^(0{1,})([1-9]+)$/,'<span class="parse-error">$1</span>$2'),t=t.replace(/^(0{1,})(0)$/,'<span class="parse-error">$1</span>$2'),t}function ce(t,e){e===void 0?this.groups=je.GROUPS:this.groups=e,this.v4=!1,this.subnet="/128",this.subnetMask=128,this.zone="",this.address=t;var r=je.RE_SUBNET_STRING.exec(t);if(r){if(this.parsedSubnet=r[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,isNaN(this.subnetMask)||this.subnetMask<0||this.subnetMask>je.BITS){this.valid=!1,this.error="Invalid subnet mask.";return}t=t.replace(je.RE_SUBNET_STRING,"")}else if(/\//.test(t)){this.valid=!1,this.error="Invalid subnet mask.";return}var n=je.RE_ZONE_STRING.exec(t);n&&(this.zone=n[0],t=t.replace(je.RE_ZONE_STRING,"")),this.addressMinusSuffix=t,this.parsedAddress=this.parse(this.addressMinusSuffix)}Sc(ce.prototype,e_),Sc(ce.prototype,i_),Sc(ce.prototype,o_),ce.fromBigInteger=function(t){var e=Gs(t.toString(16),32,"0"),r=[],n;for(n=0;n<je.GROUPS;n++)r.push(e.slice(n*4,(n+1)*4));return new ce(r.join(":"))},ce.fromURL=function(t){var e,r,n;if(t.indexOf("[")!==-1&&t.indexOf("]:")!==-1){if(n=je.RE_URL_WITH_PORT.exec(t),n===null)return{error:"failed to parse address with port",address:null,port:null};e=n[1],r=n[2]}else if(t.indexOf("/")!==-1){if(t=t.replace(/^[a-z0-9]+:\/\//,""),n=je.RE_URL.exec(t),n===null)return{error:"failed to parse address from URL",address:null,port:null};e=n[1]}else e=t;return r?(r=parseInt(r,10),(r<0||r>65536)&&(r=null)):r=null,{address:new ce(e),port:r}},ce.fromAddress4=function(t){var t=new $n(t),e=je.BITS-(Et.BITS-t.subnetMask);return new ce("::ffff:"+t.correctForm()+"/"+e)},ce.fromArpa=function(t){var e=t.replace(/(\.ip6\.arpa)?\.$/,""),r=7;if(e.length!==63)return e={error:"Not Valid 'ip6.arpa' form",address:null},e;e=e.split(".").reverse();for(var n=r;n>0;n--){var i=n*4;e.splice(i,0,":")}return e=e.join(""),new ce(e)};function u_(t,e){var r=[],n=[],i;for(i=0;i<t.length;i++)i<e[0]?r.push(t[i]):i>e[1]&&n.push(t[i]);return r.concat(["compact"]).concat(n)}ce.prototype.microsoftTranscription=function(){return Br("%s.ipv6-literal.net",this.correctForm().replace(/:/g,"-"))},ce.prototype.mask=function(t){return t===void 0&&(t=this.subnetMask),this.getBitsBase2(0,t)},ce.prototype.possibleSubnets=function(t){t===void 0&&(t=128);var e=je.BITS-this.subnetMask,r=Math.abs(t-je.BITS),n=e-r;return n<0?"0":c_(new St("2",10).pow(n).toString(10))},ce.prototype._startAddress=function(){return new St(this.mask()+Ba("0",je.BITS-this.subnetMask),2)},ce.prototype.startAddress=function(){return ce.fromBigInteger(this._startAddress())},ce.prototype.startAddressExclusive=function(){var t=new St("1");return ce.fromBigInteger(this._startAddress().add(t))},ce.prototype._endAddress=function(){return new St(this.mask()+Ba("1",je.BITS-this.subnetMask),2)},ce.prototype.endAddress=function(){return ce.fromBigInteger(this._endAddress())},ce.prototype.endAddressExclusive=function(){var t=new St("1");return ce.fromBigInteger(this._endAddress().subtract(t))},ce.prototype.getScope=function(){var t=je.SCOPES[this.getBits(12,16)];return this.getType()==="Global unicast"&&t!=="Link local"&&(t="Global"),t},ce.prototype.getType=function(){var t=this;function e(r,n){return t.isInSubnet(new ce(n))}return S0(je.TYPES,e)||"Global unicast"},ce.prototype.getBits=function(t,e){return new St(this.getBitsBase2(t,e),2)},ce.prototype.getBitsBase2=function(t,e){return this.binaryZeroPad().slice(t,e)},ce.prototype.getBitsBase16=function(t,e){var r=e-t;return r%4!==0?null:Gs(this.getBits(t,e).toString(16),r/4,"0")},ce.prototype.getBitsPastSubnet=function(){return this.getBitsBase2(this.subnetMask,je.BITS)},ce.prototype.reverseForm=function(t){t||(t={});var e=Math.floor(this.subnetMask/4),r=this.canonicalForm().replace(/:/g,"").split("").slice(0,e).reverse().join(".");return e>0?t.omitSuffix?r:Br("%s.ip6.arpa.",r):t.omitSuffix?"":"ip6.arpa."},ce.prototype.correctForm=function(){if(!this.parsedAddress)return null;var t,e=[],r=0,n=[];for(t=0;t<this.parsedAddress.length;t++){var i=parseInt(this.parsedAddress[t],16);i===0&&r++,i!==0&&r>0&&(r>1&&n.push([t-r,t-1]),r=0)}r>1&&n.push([this.parsedAddress.length-r,this.parsedAddress.length-1]);var s=n.map(function(o){return o[1]-o[0]+1});if(n.length>0){var a=s.indexOf(D0(s));e=u_(this.parsedAddress,n[a])}else e=this.parsedAddress;for(t=0;t<e.length;t++)e[t]!=="compact"&&(e[t]=parseInt(e[t],16).toString(16));var c=e.join(":");return c=c.replace(/^compact$/,"::"),c=c.replace(/^compact|compact$/,":"),c=c.replace(/compact/,""),c},ce.prototype.binaryZeroPad=function(){return Gs(this.bigInteger().toString(2),je.BITS,"0")},ce.prototype.parse4in6=function(t){var e=t.split(":"),r=e.slice(-1)[0],n=r.match(Et.RE_ADDRESS);if(n){for(var i=new $n(n[0]),s=0;s<i.groups;s++)if(/^0[0-9]+/.test(i.parsedAddress[s]))return this.valid=!1,this.error="IPv4 addresses can not have leading zeroes.",this.parseError=t.replace(Et.RE_ADDRESS,i.parsedAddress.map(l_).join(".")),null;this.v4=!0,e[e.length-1]=i.toGroup6(),t=e.join(":")}return t},ce.prototype.parse=function(t){if(t=this.parse4in6(t),this.error)return null;var e=t.match(je.RE_BAD_CHARACTERS);if(e)return this.valid=!1,this.error=Br("Bad character%s detected in address: %s",e.length>1?"s":"",e.join("")),this.parseError=t.replace(je.RE_BAD_CHARACTERS,'<span class="parse-error">$1</span>'),null;var r=t.match(je.RE_BAD_ADDRESS);if(r)return this.valid=!1,this.error=Br("Address failed regex: %s",r.join("")),this.parseError=t.replace(je.RE_BAD_ADDRESS,'<span class="parse-error">$1</span>'),null;var n=[],i=t.split("::");if(i.length===2){var s=i[0].split(":"),a=i[1].split(":");s.length===1&&s[0]===""&&(s=[]),a.length===1&&a[0]===""&&(a=[]);var c=this.groups-(s.length+a.length);if(!c)return this.valid=!1,this.error="Error parsing groups",null;this.elidedGroups=c,this.elisionBegin=s.length,this.elisionEnd=s.length+this.elidedGroups,s.forEach(function(l){n.push(l)});for(var o=0;o<c;o++)n.push(0);a.forEach(function(l){n.push(l)})}else if(i.length===1)n=t.split(":"),this.elidedGroups=0;else return this.valid=!1,this.error="Too many :: groups found",null;return n=n.map(function(l){return Br("%x",parseInt(l,16))}),n.length!==this.groups?(this.valid=!1,this.error="Incorrect number of groups found",null):(this.valid=!0,n)};function rh(t){return Br("%04x",parseInt(t,16))}ce.prototype.canonicalForm=function(){return this.valid?this.parsedAddress.map(rh).join(":"):null},ce.prototype.decimal=function(){return this.valid?this.parsedAddress.map(function(t){return Br("%05d",parseInt(t,16))}).join(":"):null},ce.prototype.bigInteger=function(){return this.valid?new St(this.parsedAddress.map(rh).join(""),16):null},ce.prototype.to4=function(){var t=this.binaryZeroPad().split("");return $n.fromHex(new St(t.slice(96,128).join(""),2).toString(16))},ce.prototype.to4in6=function(){var t=this.to4(),e=new ce(this.parsedAddress.slice(0,6).join(":"),6),r=e.correctForm(),n="";return/:$/.test(r)||(n=":"),e.correctForm()+n+t.address},ce.prototype.inspectTeredo=function(){var t=this.getBitsBase16(0,32),e=this.getBits(80,96).xor(new St("ffff",16)).toString(),r=$n.fromHex(this.getBitsBase16(32,64)),n=$n.fromHex(this.getBits(96,128).xor(new St("ffffffff",16)).toString(16)),i=this.getBits(64,80),s=this.getBitsBase2(64,80),a=i.testBit(15),c=i.testBit(14),o=i.testBit(8),l=i.testBit(9),u=new St(s.slice(2,6)+s.slice(8,16),2).toString(10);return{prefix:Br("%s:%s",t.slice(0,4),t.slice(4,8)),server4:r.address,client4:n.address,flags:s,coneNat:a,microsoft:{reserved:c,universalLocal:l,groupIndividual:o,nonce:u},udpPort:e}},ce.prototype.inspect6to4=function(){var t=this.getBitsBase16(0,16),e=$n.fromHex(this.getBitsBase16(16,48));return{prefix:Br("%s",t.slice(0,4)),gateway:e.address}},ce.prototype.to6to4=function(){if(!this.is4())return null;var t=["2002",this.getBitsBase16(96,112),this.getBitsBase16(112,128),"","/16"].join(":");return new ce(t)},ce.prototype.toByteArray=function(){var t=this.bigInteger().toByteArray();return t.length===17&&t[0]===0?t.slice(1):t};function nh(t){return t&255}ce.prototype.toUnsignedByteArray=function(){return this.toByteArray().map(nh)},ce.fromByteArray=function(t){return this.fromUnsignedByteArray(t.map(nh))},ce.fromUnsignedByteArray=function(t){for(var e=new St("256",10),r=new St("0",10),n=new St("1",10),i=t.length-1;i>=0;i--)r=r.add(n.multiply(new St(t[i].toString(10),10))),n=n.multiply(e);return ce.fromBigInteger(r)};var d_=ce,h_=$n,p_=d_,f_={helpers:Fa},ih={Address4:h_,Address6:p_,v6:f_};const{Address4:m_,Address6:g_}=ih,qa={ERR_INVALID_IP_PARAMETER:"ERR_INVALID_IP_PARAMETER",ERR_INVALID_PORT_PARAMETER:"ERR_INVALID_PORT_PARAMETER",ERR_INVALID_IP:"ERR_INVALID_IP"};function b_(t,e){if(typeof t!="string")throw U(new Error(`invalid ip provided: ${t}`),qa.ERR_INVALID_IP_PARAMETER);if(e=parseInt(e),isNaN(e))throw U(new Error(`invalid port provided: ${e}`),qa.ERR_INVALID_PORT_PARAMETER);if(new m_(t).isValid())return mt(`/ip4/${t}/tcp/${e}`);const r=new g_(t);if(r.isValid())return r.is4()?mt(`/ip4/${r.to4().correctForm()}/tcp/${e}`):mt(`/ip6/${t}/tcp/${e}`);throw U(new Error(`invalid ip:port for creating a multiaddr: ${t}:${e}`),qa.ERR_INVALID_IP)}var $s=b_,y_=qa;$s.Errors=y_;const{CLOSE_TIMEOUT:v_}=Rd,Ic=Q("libp2p:websockets:socket");Ic.error=Q("libp2p:websockets:socket:error");var sh=(t,e={})=>{const r={async sink(n){e.signal&&(n=et(n,e.signal));try{await t.sink(async function*(){for await(const i of n)yield i instanceof Uint8Array?i:i.slice()}())}catch(i){i.type!=="aborted"&&Ic.error(i)}},source:e.signal?et(t.source,e.signal):t.source,conn:t,localAddr:e.localAddr||(t.localAddress&&t.localPort?$s(t.localAddress,t.localPort):void 0),remoteAddr:e.remoteAddr||$s(t.remoteAddress,t.remotePort),timeline:{open:Date.now()},async close(){const n=Date.now();try{await pf(t.close(),v_)}catch(i){const{host:s,port:a}=r.remoteAddr.toOptions();Ic("timeout closing stream to %s:%s after %dms, destroying it manually",s,a,Date.now()-n),t.destroy()}finally{r.timeline.close=Date.now()}}};return t.socket.once&&t.socket.once("close",()=>{r.timeline.close||(r.timeline.close=Date.now())}),r};const{createServer:w_}=iw,Ga=Q("libp2p:websockets:listener");Ga.error=Q("libp2p:websockets:listener:error");var __=({handler:t,upgrader:e},r={})=>{const n=new _t,i=w_(r,async a=>{let c,o;try{c=sh(a),Ga("new inbound connection %s",c.remoteAddr),o=await e.upgradeInbound(c)}catch(l){return Ga.error("inbound connection failed to upgrade",l),c&&c.close()}Ga("inbound connection %s upgraded",c.remoteAddr),E_(i,c),t&&t(o),n.emit("connection",o)});i.on("listening",()=>n.emit("listening")).on("error",a=>n.emit("error",a)).on("close",()=>n.emit("close")),i.__connections=[];let s;return n.close=()=>(i.__connections.forEach(a=>a.close()),i.close()),n.listen=a=>(s=a,i.listen(a.toOptions())),n.getAddrs=()=>{const a=[],c=i.address();if(!c)throw new Error("Listener is not ready yet");const o=s.getPeerId();if(s.toString().indexOf("ip4")!==-1){let l=s.decapsulate("tcp");if(l=l.encapsulate("/tcp/"+c.port+"/ws"),s.getPeerId()&&(l=l.encapsulate("/p2p/"+o)),l.toString().indexOf("0.0.0.0")!==-1){const u=Sl.networkInterfaces();Object.keys(u).forEach(h=>{u[h].forEach(f=>{f.family==="IPv4"&&a.push(mt(l.toString().replace("0.0.0.0",f.address)))})})}else a.push(l)}return a},n};function E_(t,e){t.__connections.push(e)}const{AbortError:ah}=et,Di=Q("libp2p:websockets"),{CODE_CIRCUIT:S_,CODE_P2P:oh}=Rd;class T_{constructor({upgrader:t}){if(!t)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=t}async dial(t,e={}){Di("dialing %s",t);const r=await this._connect(t,e),n=sh(r,{remoteAddr:t,signal:e.signal});Di("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return Di("outbound connection %s upgraded",n.remoteAddr),i}async _connect(t,e={}){if(e.signal&&e.signal.aborted)throw new ah;const r=t.toOptions();Di("dialing %s:%s",r.host,r.port);const n=Id(nw(t),Object.assign({binary:!0},e));if(!e.signal)return await n.connected(),Di("connected %s",t),n;let i;const s=new Promise((a,c)=>{if(i=()=>{c(new ah),n.close()},e.signal.aborted)return i();e.signal.addEventListener("abort",i)});try{await Promise.race([s,n.connected()])}finally{e.signal.removeEventListener("abort",i)}return Di("connected %s",t),n}createListener(t={},e){return typeof t=="function"&&(e=t,t={}),__({handler:e,upgrader:this._upgrader},t)}filter(t){return t=Array.isArray(t)?t:[t],t.filter(e=>e.protoCodes().includes(S_)?!1:Ps.WebSockets.matches(e.decapsulateCode(oh))||Ps.WebSocketsSecure.matches(e.decapsulateCode(oh)))}}var A_=br(T_,{className:"WebSockets",symbolName:"@libp2p/js-libp2p-websockets/websockets"}),zn=_t.EventEmitter;function ch(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function C_(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ch(Object(r),!0).forEach(function(n){I_(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ch(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function I_(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function R_(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lh(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function k_(t,e,r){return e&&lh(t.prototype,e),r&&lh(t,r),t}var Va=Ss.Buffer,Rc=mi.inspect,P_=Rc&&Rc.custom||"inspect";function N_(t,e,r){Va.prototype.copy.call(t,e,r)}var O_=function(){function t(){R_(this,t),this.head=null,this.tail=null,this.length=0}return k_(t,[{key:"push",value:function(r){var n={data:r,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}},{key:"unshift",value:function(r){var n={data:r,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length}},{key:"shift",value:function(){if(this.length===0)return;var r=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,r}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(r){if(this.length===0)return"";for(var n=this.head,i=""+n.data;n=n.next;)i+=r+n.data;return i}},{key:"concat",value:function(r){if(this.length===0)return Va.alloc(0);for(var n=Va.allocUnsafe(r>>>0),i=this.head,s=0;i;)N_(i.data,n,s),s+=i.data.length,i=i.next;return n}},{key:"consume",value:function(r,n){var i;return r<this.head.data.length?(i=this.head.data.slice(0,r),this.head.data=this.head.data.slice(r)):r===this.head.data.length?i=this.shift():i=n?this._getString(r):this._getBuffer(r),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(r){var n=this.head,i=1,s=n.data;for(r-=s.length;n=n.next;){var a=n.data,c=r>a.length?a.length:r;if(c===a.length?s+=a:s+=a.slice(0,r),r-=c,r===0){c===a.length?(++i,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=a.slice(c));break}++i}return this.length-=i,s}},{key:"_getBuffer",value:function(r){var n=Va.allocUnsafe(r),i=this.head,s=1;for(i.data.copy(n),r-=i.data.length;i=i.next;){var a=i.data,c=r>a.length?a.length:r;if(a.copy(n,n.length-r,0,c),r-=c,r===0){c===a.length?(++s,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=a.slice(c));break}++s}return this.length-=s,n}},{key:P_,value:function(r,n){return Rc(this,C_({},n,{depth:0,customInspect:!1}))}}]),t}();function D_(t,e){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,ve.nextTick(kc,this,t)):ve.nextTick(kc,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(s){!e&&s?r._writableState?r._writableState.errorEmitted?ve.nextTick($a,r):(r._writableState.errorEmitted=!0,ve.nextTick(uh,r,s)):ve.nextTick(uh,r,s):e?(ve.nextTick($a,r),e(s)):ve.nextTick($a,r)}),this)}function uh(t,e){kc(t,e),$a(t)}function $a(t){if(t._writableState&&!t._writableState.emitClose)return;if(t._readableState&&!t._readableState.emitClose)return;t.emit("close")}function M_(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function kc(t,e){t.emit("error",e)}function x_(t,e){var r=t._readableState,n=t._writableState;r&&r.autoDestroy||n&&n.autoDestroy?t.destroy(e):t.emit("error",e)}var Mi={destroy:D_,undestroy:M_,errorOrDestroy:x_};function L_(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var dh={};function tr(t,e,r){r||(r=Error);function n(s,a,c){return typeof e=="string"?e:e(s,a,c)}var i=function(s){L_(a,s);function a(c,o,l){return s.call(this,n(c,o,l))||this}return a}(r);i.prototype.name=r.name,i.prototype.code=t,dh[t]=i}function hh(t,e){if(Array.isArray(t)){var r=t.length;return t=t.map(function(n){return String(n)}),r>2?"one of ".concat(e," ").concat(t.slice(0,r-1).join(", "),", or ")+t[r-1]:r===2?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}else return"of ".concat(e," ").concat(String(t))}function j_(t,e,r){return t.substr(!r||r<0?0:+r,e.length)===e}function B_(t,e,r){return(r===void 0||r>t.length)&&(r=t.length),t.substring(r-e.length,r)===e}function U_(t,e,r){return typeof r!="number"&&(r=0),r+e.length>t.length?!1:t.indexOf(e,r)!==-1}tr("ERR_INVALID_OPT_VALUE",function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'},TypeError),tr("ERR_INVALID_ARG_TYPE",function(t,e,r){var n;typeof e=="string"&&j_(e,"not ")?(n="must not be",e=e.replace(/^not /,"")):n="must be";var i;if(B_(t," argument"))i="The ".concat(t," ").concat(n," ").concat(hh(e,"type"));else{var s=U_(t,".")?"property":"argument";i='The "'.concat(t,'" ').concat(s," ").concat(n," ").concat(hh(e,"type"))}return i+=". Received type ".concat(typeof r),i},TypeError),tr("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),tr("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"}),tr("ERR_STREAM_PREMATURE_CLOSE","Premature close"),tr("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"}),tr("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),tr("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),tr("ERR_STREAM_WRITE_AFTER_END","write after end"),tr("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),tr("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError),tr("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");var F_=dh,xi={codes:F_},q_=xi.codes.ERR_INVALID_OPT_VALUE;function G_(t,e,r){return t.highWaterMark!=null?t.highWaterMark:e?t[r]:null}function V_(t,e,r,n){var i=G_(e,n,r);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var s=n?r:"highWaterMark";throw new q_(s,i)}return Math.floor(i)}return t.objectMode?16:16*1024}var ph={getHighWaterMark:V_},Ha=qe;function fh(t){var e=this;this.next=null,this.entry=null,this.finish=function(){mE(e,t)}}var Li;qe.WritableState=Hs;var $_={deprecate:lf},za=Ss.Buffer,H_=ie.Uint8Array||function(){};function z_(t){return za.from(t)}function K_(t){return za.isBuffer(t)||t instanceof H_}var W_=ph.getHighWaterMark,dn=xi.codes,X_=dn.ERR_INVALID_ARG_TYPE,Q_=dn.ERR_METHOD_NOT_IMPLEMENTED,Y_=dn.ERR_MULTIPLE_CALLBACK,J_=dn.ERR_STREAM_CANNOT_PIPE,Z_=dn.ERR_STREAM_DESTROYED,eE=dn.ERR_STREAM_NULL_VALUES,tE=dn.ERR_STREAM_WRITE_AFTER_END,rE=dn.ERR_UNKNOWN_ENCODING,ji=Mi.errorOrDestroy;Es(qe,zn);function nE(){}function Hs(t,e,r){Li=Li||Ur,t=t||{},typeof r!="boolean"&&(r=e instanceof Li),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=W_(this,t,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var n=t.decodeStrings===!1;this.decodeStrings=!n,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(i){uE(e,i)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new fh(this)}Hs.prototype.getBuffer=function(){for(var e=this.bufferedRequest,r=[];e;)r.push(e),e=e.next;return r},function(){try{Object.defineProperty(Hs.prototype,"buffer",{get:$_.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}();var Ka;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Ka=Function.prototype[Symbol.hasInstance],Object.defineProperty(qe,Symbol.hasInstance,{value:function(e){return Ka.call(this,e)?!0:this!==qe?!1:e&&e._writableState instanceof Hs}})):Ka=function(e){return e instanceof this};function qe(t){Li=Li||Ur;var e=this instanceof Li;if(!e&&!Ka.call(qe,this))return new qe(t);this._writableState=new Hs(t,this,e),this.writable=!0,t&&(typeof t.write=="function"&&(this._write=t.write),typeof t.writev=="function"&&(this._writev=t.writev),typeof t.destroy=="function"&&(this._destroy=t.destroy),typeof t.final=="function"&&(this._final=t.final)),zn.call(this)}qe.prototype.pipe=function(){ji(this,new J_)};function iE(t,e){var r=new tE;ji(t,r),ve.nextTick(e,r)}function sE(t,e,r,n){var i;return r===null?i=new eE:typeof r!="string"&&!e.objectMode&&(i=new X_("chunk",["string","Buffer"],r)),i?(ji(t,i),ve.nextTick(n,i),!1):!0}qe.prototype.write=function(t,e,r){var n=this._writableState,i=!1,s=!n.objectMode&&K_(t);return s&&!za.isBuffer(t)&&(t=z_(t)),typeof e=="function"&&(r=e,e=null),s?e="buffer":e||(e=n.defaultEncoding),typeof r!="function"&&(r=nE),n.ending?iE(this,r):(s||sE(this,n,t,r))&&(n.pendingcb++,i=oE(this,n,s,t,e,r)),i},qe.prototype.cork=function(){this._writableState.corked++},qe.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,!t.writing&&!t.corked&&!t.bufferProcessing&&t.bufferedRequest&&gh(this,t))},qe.prototype.setDefaultEncoding=function(e){if(typeof e=="string"&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new rE(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(qe.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function aE(t,e,r){return!t.objectMode&&t.decodeStrings!==!1&&typeof e=="string"&&(e=za.from(e,r)),e}Object.defineProperty(qe.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function oE(t,e,r,n,i,s){if(!r){var a=aE(e,n,i);n!==a&&(r=!0,i="buffer",n=a)}var c=e.objectMode?1:n.length;e.length+=c;var o=e.length<e.highWaterMark;if(o||(e.needDrain=!0),e.writing||e.corked){var l=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:s,next:null},l?l.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else Pc(t,e,!1,c,n,i,s);return o}function Pc(t,e,r,n,i,s,a){e.writelen=n,e.writecb=a,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new Z_("write")):r?t._writev(i,e.onwrite):t._write(i,s,e.onwrite),e.sync=!1}function cE(t,e,r,n,i){--e.pendingcb,r?(ve.nextTick(i,n),ve.nextTick(zs,t,e),t._writableState.errorEmitted=!0,ji(t,n)):(i(n),t._writableState.errorEmitted=!0,ji(t,n),zs(t,e))}function lE(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function uE(t,e){var r=t._writableState,n=r.sync,i=r.writecb;if(typeof i!="function")throw new Y_;if(lE(r),e)cE(t,r,n,e,i);else{var s=bh(r)||t.destroyed;!s&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&gh(t,r),n?ve.nextTick(mh,t,r,s,i):mh(t,r,s,i)}}function mh(t,e,r,n){r||dE(t,e),e.pendingcb--,n(),zs(t,e)}function dE(t,e){e.length===0&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function gh(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var n=e.bufferedRequestCount,i=new Array(n),s=e.corkedRequestsFree;s.entry=r;for(var a=0,c=!0;r;)i[a]=r,r.isBuf||(c=!1),r=r.next,a+=1;i.allBuffers=c,Pc(t,e,!0,e.length,i,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new fh(e),e.bufferedRequestCount=0}else{for(;r;){var o=r.chunk,l=r.encoding,u=r.callback,h=e.objectMode?1:o.length;if(Pc(t,e,!1,h,o,l,u),r=r.next,e.bufferedRequestCount--,e.writing)break}r===null&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}qe.prototype._write=function(t,e,r){r(new Q_("_write()"))},qe.prototype._writev=null,qe.prototype.end=function(t,e,r){var n=this._writableState;return typeof t=="function"?(r=t,t=null,e=null):typeof e=="function"&&(r=e,e=null),t!=null&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||fE(this,n,r),this},Object.defineProperty(qe.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function bh(t){return t.ending&&t.length===0&&t.bufferedRequest===null&&!t.finished&&!t.writing}function hE(t,e){t._final(function(r){e.pendingcb--,r&&ji(t,r),e.prefinished=!0,t.emit("prefinish"),zs(t,e)})}function pE(t,e){!e.prefinished&&!e.finalCalled&&(typeof t._final=="function"&&!e.destroyed?(e.pendingcb++,e.finalCalled=!0,ve.nextTick(hE,t,e)):(e.prefinished=!0,t.emit("prefinish")))}function zs(t,e){var r=bh(e);if(r&&(pE(t,e),e.pendingcb===0&&(e.finished=!0,t.emit("finish"),e.autoDestroy))){var n=t._readableState;(!n||n.autoDestroy&&n.endEmitted)&&t.destroy()}return r}function fE(t,e,r){e.ending=!0,zs(t,e),r&&(e.finished?ve.nextTick(r):t.once("finish",r)),e.ended=!0,t.writable=!1}function mE(t,e,r){var n=t.entry;for(t.entry=null;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree.next=t}Object.defineProperty(qe.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(e){if(!this._writableState)return;this._writableState.destroyed=e}}),qe.prototype.destroy=Mi.destroy,qe.prototype._undestroy=Mi.undestroy,qe.prototype._destroy=function(t,e){e(t)};var gE=Object.keys||function(t){var e=[];for(var r in t)e.push(r);return e},Ur=wr;Es(wr,jc);for(var yh=gE(Ha.prototype),Nc=0;Nc<yh.length;Nc++){var Oc=yh[Nc];wr.prototype[Oc]||(wr.prototype[Oc]=Ha.prototype[Oc])}function wr(t){if(!(this instanceof wr))return new wr(t);jc.call(this,t),Ha.call(this,t),this.allowHalfOpen=!0,t&&(t.readable===!1&&(this.readable=!1),t.writable===!1&&(this.writable=!1),t.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",bE)))}Object.defineProperty(wr.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(wr.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(wr.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function bE(){if(this._writableState.ended)return;ve.nextTick(yE,this)}function yE(t){t.end()}Object.defineProperty(wr.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(e){if(this._readableState===void 0||this._writableState===void 0)return;this._readableState.destroyed=e,this._writableState.destroyed=e}});var Dc=uf.Buffer,vh=Dc.isEncoding||function(t){t=""+t;switch(t&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function vE(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}function wE(t){var e=vE(t);if(typeof e!="string"&&(Dc.isEncoding===vh||!vh(t)))throw new Error("Unknown encoding: "+t);return e||t}var _E=Ks;function Ks(t){this.encoding=wE(t);var e;switch(this.encoding){case"utf16le":this.text=IE,this.end=RE,e=4;break;case"utf8":this.fillLast=TE,e=4;break;case"base64":this.text=kE,this.end=PE,e=3;break;default:this.write=NE,this.end=OE;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=Dc.allocUnsafe(e)}Ks.prototype.write=function(t){if(t.length===0)return"";var e,r;if(this.lastNeed){if(e=this.fillLast(t),e===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""},Ks.prototype.end=CE,Ks.prototype.text=AE,Ks.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length};function Mc(t){return t<=127?0:t>>5===6?2:t>>4===14?3:t>>3===30?4:t>>6===2?-1:-2}function EE(t,e,r){var n=e.length-1;if(n<r)return 0;var i=Mc(e[n]);return i>=0?(i>0&&(t.lastNeed=i-1),i):--n<r||i===-2?0:(i=Mc(e[n]),i>=0?(i>0&&(t.lastNeed=i-2),i):--n<r||i===-2?0:(i=Mc(e[n]),i>=0?(i>0&&(i===2?i=0:t.lastNeed=i-3),i):0))}function SE(t,e,r){if((e[0]&192)!==128)return t.lastNeed=0,"\uFFFD";if(t.lastNeed>1&&e.length>1){if((e[1]&192)!==128)return t.lastNeed=1,"\uFFFD";if(t.lastNeed>2&&e.length>2&&(e[2]&192)!==128)return t.lastNeed=2,"\uFFFD"}}function TE(t){var e=this.lastTotal-this.lastNeed,r=SE(this,t);if(r!==void 0)return r;if(this.lastNeed<=t.length)return t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,e,0,t.length),this.lastNeed-=t.length}function AE(t,e){var r=EE(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var n=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)}function CE(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"\uFFFD":e}function IE(t,e){if((t.length-e)%2===0){var r=t.toString("utf16le",e);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function RE(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function kE(t,e){var r=(t.length-e)%3;return r===0?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function PE(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function NE(t){return t.toString(this.encoding)}function OE(t){return t&&t.length?this.write(t):""}var wh={StringDecoder:_E},_h=xi.codes.ERR_STREAM_PREMATURE_CLOSE;function DE(t){var e=!1;return function(){if(e)return;e=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];t.apply(this,n)}}function ME(){}function xE(t){return t.setHeader&&typeof t.abort=="function"}function Eh(t,e,r){if(typeof e=="function")return Eh(t,null,e);e||(e={}),r=DE(r||ME);var n=e.readable||e.readable!==!1&&t.readable,i=e.writable||e.writable!==!1&&t.writable,s=function(){t.writable||c()},a=t._writableState&&t._writableState.finished,c=function(){i=!1,a=!0,n||r.call(t)},o=t._readableState&&t._readableState.endEmitted,l=function(){n=!1,o=!0,i||r.call(t)},u=function(S){r.call(t,S)},h=function(){var S;if(n&&!o)return(!t._readableState||!t._readableState.ended)&&(S=new _h),r.call(t,S);if(i&&!a)return(!t._writableState||!t._writableState.ended)&&(S=new _h),r.call(t,S)},f=function(){t.req.on("finish",c)};return xE(t)?(t.on("complete",c),t.on("abort",h),t.req?f():t.on("request",f)):i&&!t._writableState&&(t.on("end",s),t.on("close",s)),t.on("end",l),t.on("finish",c),e.error!==!1&&t.on("error",u),t.on("close",h),function(){t.removeListener("complete",c),t.removeListener("abort",h),t.removeListener("request",f),t.req&&t.req.removeListener("finish",c),t.removeListener("end",s),t.removeListener("close",s),t.removeListener("finish",c),t.removeListener("end",l),t.removeListener("error",u),t.removeListener("close",h)}}var xc=Eh,Wa;function hn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var pn=Symbol("lastResolve"),Kn=Symbol("lastReject"),Ws=Symbol("error"),Xa=Symbol("ended"),Wn=Symbol("lastPromise"),Lc=Symbol("handlePromise"),Xn=Symbol("stream");function fn(t,e){return{value:t,done:e}}function LE(t){var e=t[pn];if(e!==null){var r=t[Xn].read();r!==null&&(t[Wn]=null,t[pn]=null,t[Kn]=null,e(fn(r,!1)))}}function jE(t){ve.nextTick(LE,t)}function BE(t,e){return function(r,n){t.then(function(){if(e[Xa]){r(fn(void 0,!0));return}e[Lc](r,n)},n)}}var UE=Object.getPrototypeOf(function(){}),FE=Object.setPrototypeOf((Wa={get stream(){return this[Xn]},next:function(){var e=this,r=this[Ws];if(r!==null)return Promise.reject(r);if(this[Xa])return Promise.resolve(fn(void 0,!0));if(this[Xn].destroyed)return new Promise(function(a,c){ve.nextTick(function(){e[Ws]?c(e[Ws]):a(fn(void 0,!0))})});var n=this[Wn],i;if(n)i=new Promise(BE(n,this));else{var s=this[Xn].read();if(s!==null)return Promise.resolve(fn(s,!1));i=new Promise(this[Lc])}return this[Wn]=i,i}},hn(Wa,Symbol.asyncIterator,function(){return this}),hn(Wa,"return",function(){var e=this;return new Promise(function(r,n){e[Xn].destroy(null,function(i){if(i){n(i);return}r(fn(void 0,!0))})})}),Wa),UE),qE=function(e){var r,n=Object.create(FE,(r={},hn(r,Xn,{value:e,writable:!0}),hn(r,pn,{value:null,writable:!0}),hn(r,Kn,{value:null,writable:!0}),hn(r,Ws,{value:null,writable:!0}),hn(r,Xa,{value:e._readableState.endEmitted,writable:!0}),hn(r,Lc,{value:function(s,a){var c=n[Xn].read();c?(n[Wn]=null,n[pn]=null,n[Kn]=null,s(fn(c,!1))):(n[pn]=s,n[Kn]=a)},writable:!0}),r));return n[Wn]=null,xc(e,function(i){if(i&&i.code!=="ERR_STREAM_PREMATURE_CLOSE"){var s=n[Kn];s!==null&&(n[Wn]=null,n[pn]=null,n[Kn]=null,s(i)),n[Ws]=i;return}var a=n[pn];a!==null&&(n[Wn]=null,n[pn]=null,n[Kn]=null,a(fn(void 0,!0))),n[Xa]=!0}),e.on("readable",jE.bind(null,n)),n},GE=qE,VE=function(){throw new Error("Readable.from is not available in the browser")},jc=Se,Bi;Se.ReadableState=Th;var aR=_t.EventEmitter,Sh=function(e,r){return e.listeners(r).length},Qa=Ss.Buffer,$E=ie.Uint8Array||function(){};function HE(t){return Qa.from(t)}function zE(t){return Qa.isBuffer(t)||t instanceof $E}var me;mi&&mi.debuglog?me=mi.debuglog("stream"):me=function(){};var KE=ph.getHighWaterMark,Ya=xi.codes,WE=Ya.ERR_INVALID_ARG_TYPE,XE=Ya.ERR_STREAM_PUSH_AFTER_EOF,QE=Ya.ERR_METHOD_NOT_IMPLEMENTED,YE=Ya.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,Ui,Bc,Uc;Es(Se,zn);var Xs=Mi.errorOrDestroy,Fc=["error","close","destroy","pause","resume"];function JE(t,e,r){if(typeof t.prependListener=="function")return t.prependListener(e,r);!t._events||!t._events[e]?t.on(e,r):Array.isArray(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]}function Th(t,e,r){Bi=Bi||Ur,t=t||{},typeof r!="boolean"&&(r=e instanceof Bi),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=KE(this,t,"readableHighWaterMark",r),this.buffer=new O_,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(Ui||(Ui=wh.StringDecoder),this.decoder=new Ui(t.encoding),this.encoding=t.encoding)}function Se(t){if(Bi=Bi||Ur,!(this instanceof Se))return new Se(t);var e=this instanceof Bi;this._readableState=new Th(t,this,e),this.readable=!0,t&&(typeof t.read=="function"&&(this._read=t.read),typeof t.destroy=="function"&&(this._destroy=t.destroy)),zn.call(this)}Object.defineProperty(Se.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(e){if(!this._readableState)return;this._readableState.destroyed=e}}),Se.prototype.destroy=Mi.destroy,Se.prototype._undestroy=Mi.undestroy,Se.prototype._destroy=function(t,e){e(t)},Se.prototype.push=function(t,e){var r=this._readableState,n;return r.objectMode?n=!0:typeof t=="string"&&(e=e||r.defaultEncoding,e!==r.encoding&&(t=Qa.from(t,e),e=""),n=!0),Ah(this,t,e,!1,n)},Se.prototype.unshift=function(t){return Ah(this,t,null,!0,!1)};function Ah(t,e,r,n,i){me("readableAddChunk",e);var s=t._readableState;if(e===null)s.reading=!1,tS(t,s);else{var a;if(i||(a=ZE(s,e)),a)Xs(t,a);else if(s.objectMode||e&&e.length>0)if(typeof e!="string"&&!s.objectMode&&Object.getPrototypeOf(e)!==Qa.prototype&&(e=HE(e)),n)s.endEmitted?Xs(t,new YE):qc(t,s,e,!0);else if(s.ended)Xs(t,new XE);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!r?(e=s.decoder.write(e),s.objectMode||e.length!==0?qc(t,s,e,!1):Gc(t,s)):qc(t,s,e,!1)}else n||(s.reading=!1,Gc(t,s))}return!s.ended&&(s.length<s.highWaterMark||s.length===0)}function qc(t,e,r,n){e.flowing&&e.length===0&&!e.sync?(e.awaitDrain=0,t.emit("data",r)):(e.length+=e.objectMode?1:r.length,n?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&Ja(t)),Gc(t,e)}function ZE(t,e){var r;return!zE(e)&&typeof e!="string"&&e!==void 0&&!t.objectMode&&(r=new WE("chunk",["string","Buffer","Uint8Array"],e)),r}Se.prototype.isPaused=function(){return this._readableState.flowing===!1},Se.prototype.setEncoding=function(t){Ui||(Ui=wh.StringDecoder);var e=new Ui(t);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";r!==null;)n+=e.write(r.data),r=r.next;return this._readableState.buffer.clear(),n!==""&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var Ch=1073741824;function eS(t){return t>=Ch?t=Ch:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function Ih(t,e){return t<=0||e.length===0&&e.ended?0:e.objectMode?1:t!==t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=eS(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}Se.prototype.read=function(t){me("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(t!==0&&(e.emittedReadable=!1),t===0&&e.needReadable&&((e.highWaterMark!==0?e.length>=e.highWaterMark:e.length>0)||e.ended))return me("read: emitReadable",e.length,e.ended),e.length===0&&e.ended?$c(this):Ja(this),null;if(t=Ih(t,e),t===0&&e.ended)return e.length===0&&$c(this),null;var n=e.needReadable;me("need readable",n),(e.length===0||e.length-t<e.highWaterMark)&&(n=!0,me("length less than watermark",n)),e.ended||e.reading?(n=!1,me("reading or ended",n)):n&&(me("do read"),e.reading=!0,e.sync=!0,e.length===0&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=Ih(r,e)));var i;return t>0?i=Ph(t,e):i=null,i===null?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.awaitDrain=0),e.length===0&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&$c(this)),i!==null&&this.emit("data",i),i};function tS(t,e){if(me("onEofChunk"),e.ended)return;if(e.decoder){var r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,e.sync?Ja(t):(e.needReadable=!1,e.emittedReadable||(e.emittedReadable=!0,Rh(t)))}function Ja(t){var e=t._readableState;me("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(me("emitReadable",e.flowing),e.emittedReadable=!0,ve.nextTick(Rh,t))}function Rh(t){var e=t._readableState;me("emitReadable_",e.destroyed,e.length,e.ended),!e.destroyed&&(e.length||e.ended)&&(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,Vc(t)}function Gc(t,e){e.readingMore||(e.readingMore=!0,ve.nextTick(rS,t,e))}function rS(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&e.length===0);){var r=e.length;if(me("maybeReadMore read 0"),t.read(0),r===e.length)break}e.readingMore=!1}Se.prototype._read=function(t){Xs(this,new QE("_read()"))},Se.prototype.pipe=function(t,e){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=t;break;case 1:n.pipes=[n.pipes,t];break;default:n.pipes.push(t);break}n.pipesCount+=1,me("pipe count=%d opts=%j",n.pipesCount,e);var i=(!e||e.end!==!1)&&t!==ve.stdout&&t!==ve.stderr,s=i?c:D;n.endEmitted?ve.nextTick(s):r.once("end",s),t.on("unpipe",a);function a(I,k){me("onunpipe"),I===r&&(k&&k.hasUnpiped===!1&&(k.hasUnpiped=!0,u()))}function c(){me("onend"),t.end()}var o=nS(r);t.on("drain",o);var l=!1;function u(){me("cleanup"),t.removeListener("close",p),t.removeListener("finish",S),t.removeListener("drain",o),t.removeListener("error",f),t.removeListener("unpipe",a),r.removeListener("end",c),r.removeListener("end",D),r.removeListener("data",h),l=!0,n.awaitDrain&&(!t._writableState||t._writableState.needDrain)&&o()}r.on("data",h);function h(I){me("ondata");var k=t.write(I);me("dest.write",k),k===!1&&((n.pipesCount===1&&n.pipes===t||n.pipesCount>1&&Nh(n.pipes,t)!==-1)&&!l&&(me("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function f(I){me("onerror",I),D(),t.removeListener("error",f),Sh(t,"error")===0&&Xs(t,I)}JE(t,"error",f);function p(){t.removeListener("finish",S),D()}t.once("close",p);function S(){me("onfinish"),t.removeListener("close",p),D()}t.once("finish",S);function D(){me("unpipe"),r.unpipe(t)}return t.emit("pipe",r),n.flowing||(me("pipe resume"),r.resume()),t};function nS(t){return function(){var r=t._readableState;me("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&Sh(t,"data")&&(r.flowing=!0,Vc(t))}}Se.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(e.pipesCount===0)return this;if(e.pipesCount===1)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r),this);if(!t){var n=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<i;s++)n[s].emit("unpipe",this,{hasUnpiped:!1});return this}var a=Nh(e.pipes,t);return a===-1?this:(e.pipes.splice(a,1),e.pipesCount-=1,e.pipesCount===1&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r),this)},Se.prototype.on=function(t,e){var r=zn.prototype.on.call(this,t,e),n=this._readableState;return t==="data"?(n.readableListening=this.listenerCount("readable")>0,n.flowing!==!1&&this.resume()):t==="readable"&&(!n.endEmitted&&!n.readableListening&&(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,me("on readable",n.length,n.reading),n.length?Ja(this):n.reading||ve.nextTick(iS,this))),r},Se.prototype.addListener=Se.prototype.on,Se.prototype.removeListener=function(t,e){var r=zn.prototype.removeListener.call(this,t,e);return t==="readable"&&ve.nextTick(kh,this),r},Se.prototype.removeAllListeners=function(t){var e=zn.prototype.removeAllListeners.apply(this,arguments);return(t==="readable"||t===void 0)&&ve.nextTick(kh,this),e};function kh(t){var e=t._readableState;e.readableListening=t.listenerCount("readable")>0,e.resumeScheduled&&!e.paused?e.flowing=!0:t.listenerCount("data")>0&&t.resume()}function iS(t){me("readable nexttick read 0"),t.read(0)}Se.prototype.resume=function(){var t=this._readableState;return t.flowing||(me("resume"),t.flowing=!t.readableListening,sS(this,t)),t.paused=!1,this};function sS(t,e){e.resumeScheduled||(e.resumeScheduled=!0,ve.nextTick(aS,t,e))}function aS(t,e){me("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),Vc(t),e.flowing&&!e.reading&&t.read(0)}Se.prototype.pause=function(){return me("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(me("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Vc(t){var e=t._readableState;for(me("flow",e.flowing);e.flowing&&t.read()!==null;);}Se.prototype.wrap=function(t){var e=this,r=this._readableState,n=!1;t.on("end",function(){if(me("wrapped end"),r.decoder&&!r.ended){var a=r.decoder.end();a&&a.length&&e.push(a)}e.push(null)}),t.on("data",function(a){if(me("wrapped data"),r.decoder&&(a=r.decoder.write(a)),r.objectMode&&a==null)return;if(!r.objectMode&&(!a||!a.length))return;var c=e.push(a);c||(n=!0,t.pause())});for(var i in t)this[i]===void 0&&typeof t[i]=="function"&&(this[i]=function(c){return function(){return t[c].apply(t,arguments)}}(i));for(var s=0;s<Fc.length;s++)t.on(Fc[s],this.emit.bind(this,Fc[s]));return this._read=function(a){me("wrapped _read",a),n&&(n=!1,t.resume())},this},typeof Symbol=="function"&&(Se.prototype[Symbol.asyncIterator]=function(){return Bc===void 0&&(Bc=GE),Bc(this)}),Object.defineProperty(Se.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(Se.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(Se.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),Se._fromList=Ph,Object.defineProperty(Se.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function Ph(t,e){if(e.length===0)return null;var r;return e.objectMode?r=e.buffer.shift():!t||t>=e.length?(e.decoder?r=e.buffer.join(""):e.buffer.length===1?r=e.buffer.first():r=e.buffer.concat(e.length),e.buffer.clear()):r=e.buffer.consume(t,e.decoder),r}function $c(t){var e=t._readableState;me("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,ve.nextTick(oS,e,t))}function oS(t,e){if(me("endReadableNT",t.endEmitted,t.length),!t.endEmitted&&t.length===0&&(t.endEmitted=!0,e.readable=!1,e.emit("end"),t.autoDestroy)){var r=e._writableState;(!r||r.autoDestroy&&r.finished)&&e.destroy()}}typeof Symbol=="function"&&(Se.from=function(t,e){return Uc===void 0&&(Uc=VE),Uc(Se,t,e)});function Nh(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}var Hc=Fr,Za=xi.codes,cS=Za.ERR_METHOD_NOT_IMPLEMENTED,lS=Za.ERR_MULTIPLE_CALLBACK,uS=Za.ERR_TRANSFORM_ALREADY_TRANSFORMING,dS=Za.ERR_TRANSFORM_WITH_LENGTH_0;Es(Fr,Ur);function hS(t,e){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(n===null)return this.emit("error",new lS);r.writechunk=null,r.writecb=null,e!=null&&this.push(e),n(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function Fr(t){if(!(this instanceof Fr))return new Fr(t);Ur.call(this,t),this._transformState={afterTransform:hS.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",pS)}function pS(){var t=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,r){Oh(t,e,r)}):Oh(this,null,null)}Fr.prototype.push=function(t,e){return this._transformState.needTransform=!1,Ur.prototype.push.call(this,t,e)},Fr.prototype._transform=function(t,e,r){r(new cS("_transform()"))},Fr.prototype._write=function(t,e,r){var n=this._transformState;if(n.writecb=r,n.writechunk=t,n.writeencoding=e,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},Fr.prototype._read=function(t){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},Fr.prototype._destroy=function(t,e){Ur.prototype._destroy.call(this,t,function(r){e(r)})};function Oh(t,e,r){if(e)return t.emit("error",e);if(r!=null&&t.push(r),t._writableState.length)throw new dS;if(t._transformState.transforming)throw new uS;return t.push(null)}var fS=Qs;Es(Qs,Hc);function Qs(t){if(!(this instanceof Qs))return new Qs(t);Hc.call(this,t)}Qs.prototype._transform=function(t,e,r){r(null,t)};var zc;function mS(t){var e=!1;return function(){if(e)return;e=!0,t.apply(void 0,arguments)}}var Dh=xi.codes,gS=Dh.ERR_MISSING_ARGS,bS=Dh.ERR_STREAM_DESTROYED;function Mh(t){if(t)throw t}function yS(t){return t.setHeader&&typeof t.abort=="function"}function vS(t,e,r,n){n=mS(n);var i=!1;t.on("close",function(){i=!0}),zc===void 0&&(zc=xc),zc(t,{readable:e,writable:r},function(a){if(a)return n(a);i=!0,n()});var s=!1;return function(a){if(i)return;if(s)return;if(s=!0,yS(t))return t.abort();if(typeof t.destroy=="function")return t.destroy();n(a||new bS("pipe"))}}function xh(t){t()}function wS(t,e){return t.pipe(e)}function _S(t){return t.length?typeof t[t.length-1]!="function"?Mh:t.pop():Mh}function ES(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=_S(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new gS("streams");var i,s=e.map(function(a,c){var o=c<e.length-1,l=c>0;return vS(a,o,l,function(u){if(i||(i=u),u&&s.forEach(xh),o)return;s.forEach(xh),n(i)})});return e.reduce(wS)}var SS=ES,TS=re(function(t,e){e=t.exports=jc,e.Stream=e,e.Readable=e,e.Writable=Ha,e.Duplex=Ur,e.Transform=Hc,e.PassThrough=fS,e.finished=xc,e.pipeline=SS});/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let Lh;var Kc=typeof queueMicrotask=="function"?queueMicrotask:t=>(Lh||(Lh=Promise.resolve())).then(t).catch(e=>setTimeout(()=>{throw e},0));/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var AS=Q("simple-peer"),Wc=64*1024,CS=5*1e3,IS=5*1e3;function jh(t){return t.replace(/a=ice-options:trickle\s\n/g,"")}function RS(t){console.warn(t)}class Fi extends TS.Duplex{constructor(t){if(t=Object.assign({allowHalfOpen:!1},t),super(t),this._id=Al(4).toString("hex").slice(0,7),this._debug("new peer %o",t),this.channelName=t.initiator?t.channelName||Al(20).toString("hex"):null,this.initiator=t.initiator||!1,this.channelConfig=t.channelConfig||Fi.channelConfig,this.negotiated=this.channelConfig.negotiated,this.config=Object.assign({},Fi.config,t.config),this.offerOptions=t.offerOptions||{},this.answerOptions=t.answerOptions||{},this.sdpTransform=t.sdpTransform||(e=>e),this.streams=t.streams||(t.stream?[t.stream]:[]),this.trickle=t.trickle!==void 0?t.trickle:!0,this.allowHalfTrickle=t.allowHalfTrickle!==void 0?t.allowHalfTrickle:!1,this.iceCompleteTimeout=t.iceCompleteTimeout||CS,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=t.wrtc&&typeof t.wrtc=="object"?t.wrtc:Tl(),!this._wrtc)throw typeof window=="undefined"?U(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):U(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=this.negotiated?!1:!this.initiator,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._firstStable=!0,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(e){Kc(()=>this.destroy(U(e,"ERR_PC_CONSTRUCTOR")));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=e=>{this._onIceCandidate(e)},this.initiator||this.negotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=e=>{this._setupData(e)},this.streams&&this.streams.forEach(e=>{this.addStream(e)}),this._pc.ontrack=e=>{this._onTrack(e)},this.initiator&&this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(t){if(this.destroyed)throw U(new Error("cannot signal after peer is destroyed"),"ERR_SIGNALING");if(typeof t=="string")try{t=JSON.parse(t)}catch(e){t={}}this._debug("signal()"),t.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),t.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(t.transceiverRequest.kind,t.transceiverRequest.init)),t.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(t.candidate):this._pendingCandidates.push(t.candidate)),t.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(t)).then(()=>{if(this.destroyed)return;this._pendingCandidates.forEach(e=>{this._addIceCandidate(e)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer()}).catch(e=>{this.destroy(U(e,"ERR_SET_REMOTE_DESCRIPTION"))}),!t.sdp&&!t.candidate&&!t.renegotiate&&!t.transceiverRequest&&this.destroy(U(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}_addIceCandidate(t){var e=new this._wrtc.RTCIceCandidate(t);this._pc.addIceCandidate(e).catch(r=>{!e.address||e.address.endsWith(".local")?RS("Ignoring unsupported ICE candidate."):this.destroy(U(r,"ERR_ADD_ICE_CANDIDATE"))})}send(t){this._channel.send(t)}addTransceiver(t,e){if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,e),this._needsNegotiation()}catch(r){this.destroy(U(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{transceiverRequest:{kind:t,init:e}})}addStream(t){this._debug("addStream()"),t.getTracks().forEach(e=>{this.addTrack(e,t)})}addTrack(t,e){this._debug("addTrack()");var r=this._senderMap.get(t)||new Map,n=r.get(e);if(!n)n=this._pc.addTrack(t,e),r.set(e,n),this._senderMap.set(t,r),this._needsNegotiation();else throw n.removed?U(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):U(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(t,e,r){this._debug("replaceTrack()");var n=this._senderMap.get(t),i=n?n.get(r):null;if(!i)throw U(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");e&&this._senderMap.set(e,n),i.replaceTrack!=null?i.replaceTrack(e):this.destroy(U(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(t,e){this._debug("removeSender()");var r=this._senderMap.get(t),n=r?r.get(e):null;if(!n)throw U(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{n.removed=!0,this._pc.removeTrack(n)}catch(i){i.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(n):this.destroy(U(i,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){this._debug("removeSenders()"),t.getTracks().forEach(e=>{this.removeTrack(e,t)})}_needsNegotiation(){if(this._debug("_needsNegotiation"),this._batchedNegotiation)return;this._batchedNegotiation=!0,Kc(()=>{this._batchedNegotiation=!1,this._debug("starting batched negotiation"),this.negotiate()})}negotiate(){this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{renegotiate:!0})),this._isNegotiating=!0}_destroy(t,e){if(this._debug("destroy (error: %s)",t&&(t.message||t)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(r){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(r){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e(t)}_setupData(t){if(!t.channel)return this.destroy(U(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=t.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=Wc),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{this.destroy(U(r,"ERR_DATA_CHANNEL"))};var e=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(e&&this._onChannelClose(),e=!0):e=!1},IS)}_read(){}_write(t,e,r){if(this.destroyed)return r(U(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(t)}catch(n){return this.destroy(U(n,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>Wc?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=t,this._cb=r}_onFinish(){if(this.destroyed)return;const t=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?t():this.once("connect",t)}_startIceCompleteTimeout(){if(this.destroyed)return;if(this._iceCompleteTimer)return;this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout)}_createOffer(){if(this.destroyed)return;this._pc.createOffer(this.offerOptions).then(t=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(t.sdp=jh(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const e=()=>{if(this.destroyed)return;var i=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:i.type,sdp:i.sdp})},r=()=>{if(this._debug("createOffer success"),this.destroyed)return;this.trickle||this._iceComplete?e():this.once("_iceComplete",e)},n=i=>{this.destroy(U(i,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(t).then(r).catch(n)}).catch(t=>{this.destroy(U(t,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(t=>{!t.mid&&t.sender.track&&!t.requested&&(t.requested=!0,this.addTransceiver(t.sender.track.kind))})}_createAnswer(){if(this.destroyed)return;this._pc.createAnswer(this.answerOptions).then(t=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(t.sdp=jh(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const e=()=>{if(this.destroyed)return;var i=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:i.type,sdp:i.sdp}),this.initiator||this._requestMissingTransceivers()},r=()=>{if(this.destroyed)return;this.trickle||this._iceComplete?e():this.once("_iceComplete",e)},n=i=>{this.destroy(U(i,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(t).then(r).catch(n)}).catch(t=>{this.destroy(U(t,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){if(this.destroyed)return;this._pc.connectionState==="failed"&&this.destroy(U(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;var t=this._pc.iceConnectionState,e=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",t,e),this.emit("iceStateChange",t,e),(t==="connected"||t==="completed")&&(this._pcReady=!0,this._maybeReady()),t==="failed"&&this.destroy(U(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),t==="closed"&&this.destroy(U(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(t){const e=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(n=>{Object.assign(r,n)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{var n=[];r.forEach(i=>{n.push(e(i))}),t(null,n)},r=>t(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;var n=[];r.result().forEach(i=>{var s={};i.names().forEach(a=>{s[a]=i.stat(a)}),s.id=i.id,s.type=i.type,s.timestamp=i.timestamp,n.push(e(s))}),t(null,n)},r=>t(r)):t(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const t=()=>{if(this.destroyed)return;this.getStats((e,r)=>{if(this.destroyed)return;e&&(r=[]);var n={},i={},s={},a=!1;r.forEach(l=>{(l.type==="remotecandidate"||l.type==="remote-candidate")&&(n[l.id]=l),(l.type==="localcandidate"||l.type==="local-candidate")&&(i[l.id]=l),(l.type==="candidatepair"||l.type==="candidate-pair")&&(s[l.id]=l)});const c=l=>{a=!0;var u=i[l.localCandidateId];u&&(u.ip||u.address)?(this.localAddress=u.ip||u.address,this.localPort=Number(u.port)):u&&u.ipAddress?(this.localAddress=u.ipAddress,this.localPort=Number(u.portNumber)):typeof l.googLocalAddress=="string"&&(u=l.googLocalAddress.split(":"),this.localAddress=u[0],this.localPort=Number(u[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");var h=n[l.remoteCandidateId];h&&(h.ip||h.address)?(this.remoteAddress=h.ip||h.address,this.remotePort=Number(h.port)):h&&h.ipAddress?(this.remoteAddress=h.ipAddress,this.remotePort=Number(h.portNumber)):typeof l.googRemoteAddress=="string"&&(h=l.googRemoteAddress.split(":"),this.remoteAddress=h[0],this.remotePort=Number(h[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(l=>{l.type==="transport"&&l.selectedCandidatePairId&&c(s[l.selectedCandidatePairId]),(l.type==="googCandidatePair"&&l.googActiveConnection==="true"||(l.type==="candidatepair"||l.type==="candidate-pair")&&l.selected)&&c(l)}),!a&&(!Object.keys(s).length||Object.keys(i).length)){setTimeout(t,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(l){return this.destroy(U(l,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');var o=this._cb;this._cb=null,o(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};t()}_onInterval(){if(!this._cb||!this._channel||this._channel.bufferedAmount>Wc)return;this._onChannelBufferedAmountLow()}_onSignalingStateChange(){if(this.destroyed)return;this._pc.signalingState==="stable"&&!this._firstStable&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(t=>{this._pc.removeTrack(t),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation&&(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()),this._debug("negotiate"),this.emit("negotiate")),this._firstStable=!1,this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState)}_onIceCandidate(t){if(this.destroyed)return;t.candidate&&this.trickle?this.emit("signal",{candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}}):!t.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),t.candidate&&this._startIceCompleteTimeout()}_onChannelMessage(t){if(this.destroyed)return;var e=t.data;e instanceof ArrayBuffer&&(e=new Uint8Array(e)),this.push(e)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var t=this._cb;this._cb=null,t(null)}_onChannelOpen(){if(this._connected||this.destroyed)return;this._debug("on channel open"),this._channelReady=!0,this._maybeReady()}_onChannelClose(){if(this.destroyed)return;this._debug("on channel close"),this.destroy()}_onTrack(t){if(this.destroyed)return;t.streams.forEach(e=>{if(this._debug("on track"),this.emit("track",t.track,e),this._remoteTracks.push({track:t.track,stream:e}),this._remoteStreams.some(r=>r.id===e.id))return;this._remoteStreams.push(e),Kc(()=>{this.emit("stream",e)})})}_debug(){var t=[].slice.call(arguments);t[0]="["+this._id+"] "+t[0],AS.apply(null,t)}}Fi.WEBRTC_SUPPORT=!!Tl(),Fi.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},Fi.channelConfig={};var Bh=Fi;(function(){if(typeof globalThis=="object")return;Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__})();var Uh=globalThis,kS={supportsFileReader:typeof self!="undefined"&&"FileReader"in self,supportsWebRTC:"RTCPeerConnection"in Uh&&(typeof navigator!="undefined"&&typeof navigator.mediaDevices!="undefined")&&"getUserMedia"in navigator.mediaDevices,supportsWebRTCDataChannels:"RTCPeerConnection"in Uh},PS=421,NS=290,OS=2e3,Xc={CODE_P2P:PS,CODE_CIRCUIT:NS,CLOSE_TIMEOUT:OS},DS=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,MS=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Qc=function(e){var r=e,n=e.indexOf("["),i=e.indexOf("]");n!=-1&&i!=-1&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));for(var s=DS.exec(e||""),a={},c=14;c--;)a[MS[c]]=s[c]||"";return n!=-1&&i!=-1&&(a.source=r,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=xS(a,a.path),a.queryKey=LS(a,a.query),a};function xS(t,e){var r=/\/{2,9}/g,n=e.replace(r,"/").split("/");return(e.substr(0,1)=="/"||e.length===0)&&n.splice(0,1),e.substr(e.length-1,1)=="/"&&n.splice(n.length-1,1),n}function LS(t,e){var r={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,s){i&&(r[i]=s)}),r}function jS(t){r.debug=r,r.default=r,r.coerce=l,r.disable=a,r.enable=s,r.enabled=c,r.humanize=oa,Object.keys(t).forEach(u=>{r[u]=t[u]}),r.instances=[],r.names=[],r.skips=[],r.formatters={};function e(u){let h=0;for(let f=0;f<u.length;f++)h=(h<<5)-h+u.charCodeAt(f),h|=0;return r.colors[Math.abs(h)%r.colors.length]}r.selectColor=e;function r(u){let h;function f(...p){if(!f.enabled)return;const S=f,D=Number(new Date),I=D-(h||D);S.diff=I,S.prev=h,S.curr=D,h=D,p[0]=r.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let k=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(H,v)=>{if(H==="%%")return H;k++;const _=r.formatters[v];if(typeof _=="function"){const A=p[k];H=_.call(S,A),p.splice(k,1),k--}return H}),r.formatArgs.call(S,p);const V=S.log||r.log;V.apply(S,p)}return f.namespace=u,f.enabled=r.enabled(u),f.useColors=r.useColors(),f.color=e(u),f.destroy=n,f.extend=i,typeof r.init=="function"&&r.init(f),r.instances.push(f),f}function n(){const u=r.instances.indexOf(this);return u!==-1?(r.instances.splice(u,1),!0):!1}function i(u,h){const f=r(this.namespace+(typeof h=="undefined"?":":h)+u);return f.log=this.log,f}function s(u){r.save(u),r.names=[],r.skips=[];let h;const f=(typeof u=="string"?u:"").split(/[\s,]+/),p=f.length;for(h=0;h<p;h++){if(!f[h])continue;u=f[h].replace(/\*/g,".*?"),u[0]==="-"?r.skips.push(new RegExp("^"+u.substr(1)+"$")):r.names.push(new RegExp("^"+u+"$"))}for(h=0;h<r.instances.length;h++){const S=r.instances[h];S.enabled=r.enabled(S.namespace)}}function a(){const u=[...r.names.map(o),...r.skips.map(o).map(h=>"-"+h)].join(",");return r.enable(""),u}function c(u){if(u[u.length-1]==="*")return!0;let h,f;for(h=0,f=r.skips.length;h<f;h++)if(r.skips[h].test(u))return!1;for(h=0,f=r.names.length;h<f;h++)if(r.names[h].test(u))return!0;return!1}function o(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack||u.message:u}return r.enable(r.load()),r}var BS=jS,eo=re(function(t,e){e.log=i,e.formatArgs=n,e.save=s,e.load=a,e.useColors=r,e.storage=c(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let h=0,f=0;l[0].replace(/%[a-zA-Z%]/g,p=>{if(p==="%%")return;h++,p==="%c"&&(f=h)}),l.splice(f,0,u)}function i(...l){return typeof console=="object"&&console.log&&console.log(...l)}function s(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch(u){}}function a(){let l;try{l=e.storage.getItem("debug")}catch(u){}return!l&&typeof ve!="undefined"&&"env"in ve&&(l=ve.env.DEBUG),l}function c(){try{return localStorage}catch(l){}}t.exports=BS(e);const{formatters:o}=t.exports;o.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}}),US=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.url=void 0;const r=eo("socket.io-client:url");function n(i,s){let a=i;s=s||typeof location!="undefined"&&location,i==null&&(i=s.protocol+"//"+s.host),typeof i=="string"&&(i.charAt(0)==="/"&&(i.charAt(1)==="/"?i=s.protocol+i:i=s.host+i),/^(https?|wss?):\/\//.test(i)||(r("protocol-less url %s",i),typeof s!="undefined"?i=s.protocol+"//"+i:i="https://"+i),r("parse %s",i),a=Qc(i)),a.port||(/^(http|ws)$/.test(a.protocol)?a.port="80":/^(http|ws)s$/.test(a.protocol)&&(a.port="443")),a.path=a.path||"/";const c=a.host.indexOf(":")!==-1,o=c?"["+a.host+"]":a.host;return a.id=a.protocol+"://"+o+":"+a.port,a.href=a.protocol+"://"+o+(s&&s.port===a.port?"":":"+a.port),a}e.url=n}),FS=re(function(t){try{t.exports=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}}),qi=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())(),Yc=function(t){const e=t.xdomain,r=t.xscheme,n=t.enablesXDR;try{if(typeof XMLHttpRequest!="undefined"&&(!e||FS))return new XMLHttpRequest}catch(i){}try{if(typeof XDomainRequest!="undefined"&&!r&&n)return new XDomainRequest}catch(i){}if(!e)try{return new qi[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(i){}};const _r=Object.create(null);_r.open="0",_r.close="1",_r.ping="2",_r.pong="3",_r.message="4",_r.upgrade="5",_r.noop="6";const Fh=Object.create(null);Object.keys(_r).forEach(t=>{Fh[_r[t]]=t});const qS={type:"error",data:"parser error"};var qh={PACKET_TYPES:_r,PACKET_TYPES_REVERSE:Fh,ERROR_PACKET:qS};const{PACKET_TYPES:GS}=qh,VS=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",$S=typeof ArrayBuffer=="function",HS=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,zS=({type:t,data:e},r,n)=>VS&&e instanceof Blob?r?n(e):Gh(e,n):$S&&(e instanceof ArrayBuffer||HS(e))?r?n(e instanceof ArrayBuffer?e:e.buffer):Gh(new Blob([e]),n):n(GS[t]+(e||"")),Gh=(t,e)=>{const r=new FileReader;return r.onload=function(){const n=r.result.split(",")[1];e("b"+n)},r.readAsDataURL(t)};var Vh=zS,KS=re(function(t,e){(function(r){e.encode=function(n){var i=new Uint8Array(n),s,a=i.length,c="";for(s=0;s<a;s+=3)c+=r[i[s]>>2],c+=r[(i[s]&3)<<4|i[s+1]>>4],c+=r[(i[s+1]&15)<<2|i[s+2]>>6],c+=r[i[s+2]&63];return a%3===2?c=c.substring(0,c.length-1)+"=":a%3===1&&(c=c.substring(0,c.length-2)+"=="),c},e.decode=function(n){var i=n.length*.75,s=n.length,a,c=0,o,l,u,h;n[n.length-1]==="="&&(i--,n[n.length-2]==="="&&i--);var f=new ArrayBuffer(i),p=new Uint8Array(f);for(a=0;a<s;a+=4)o=r.indexOf(n[a]),l=r.indexOf(n[a+1]),u=r.indexOf(n[a+2]),h=r.indexOf(n[a+3]),p[c++]=o<<2|l>>4,p[c++]=(l&15)<<4|u>>2,p[c++]=(u&3)<<6|h&63;return f}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")});const{PACKET_TYPES_REVERSE:Jc,ERROR_PACKET:WS}=qh,XS=typeof ArrayBuffer=="function";let Zc;XS&&(Zc=KS);const QS=(t,e)=>{if(typeof t!="string")return{type:"message",data:$h(t,e)};const r=t.charAt(0);if(r==="b")return{type:"message",data:YS(t.substring(1),e)};const n=Jc[r];return n?t.length>1?{type:Jc[r],data:t.substring(1)}:{type:Jc[r]}:WS},YS=(t,e)=>{if(Zc){const r=Zc.decode(t);return $h(r,e)}else return{base64:!0,data:t}},$h=(t,e)=>{switch(e){case"blob":return t instanceof ArrayBuffer?new Blob([t]):t;case"arraybuffer":default:return t}};var Hh=QS;const zh=String.fromCharCode(30),JS=(t,e)=>{const r=t.length,n=new Array(r);let i=0;t.forEach((s,a)=>{Vh(s,!1,c=>{n[a]=c,++i===r&&e(n.join(zh))})})},ZS=(t,e)=>{const r=t.split(zh),n=[];for(let i=0;i<r.length;i++){const s=Hh(r[i],e);if(n.push(s),s.type==="error")break}return n};var Qn={protocol:4,encodePacket:Vh,encodePayload:JS,decodePacket:Hh,decodePayload:ZS},Gi=re(function(t){t.exports=e;function e(n){if(n)return r(n)}function r(n){for(var i in e.prototype)n[i]=e.prototype[i];return n}e.prototype.on=e.prototype.addEventListener=function(n,i){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(i),this},e.prototype.once=function(n,i){function s(){this.off(n,s),i.apply(this,arguments)}return s.fn=i,this.on(n,s),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(n,i){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var s=this._callbacks["$"+n];if(!s)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var a,c=0;c<s.length;c++)if(a=s[c],a===i||a.fn===i){s.splice(c,1);break}return s.length===0&&delete this._callbacks["$"+n],this},e.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var i=new Array(arguments.length-1),s=this._callbacks["$"+n],a=1;a<arguments.length;a++)i[a-1]=arguments[a];if(s){s=s.slice(0);for(var a=0,c=s.length;a<c;++a)s[a].apply(this,i)}return this},e.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]},e.prototype.hasListeners=function(n){return!!this.listeners(n).length}});class eT extends Gi{constructor(t){super();this.opts=t,this.query=t.query,this.readyState="",this.socket=t.socket}onError(t,e){const r=new Error(t);return r.type="TransportError",r.description=e,this.emit("error",r),this}open(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){if(this.readyState==="open")this.write(t);else throw new Error("Transport not open")}onOpen(){this.readyState="open",this.writable=!0,this.emit("open")}onData(t){const e=Qn.decodePacket(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){this.emit("packet",t)}onClose(){this.readyState="closed",this.emit("close")}}var to=eT,tT=function(t){var e="";for(var r in t)t.hasOwnProperty(r)&&(e.length&&(e+="&"),e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e},rT=function(t){for(var e={},r=t.split("&"),n=0,i=r.length;n<i;n++){var s=r[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e},el={encode:tT,decode:rT},Kh="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),ro=64,Wh={},Xh=0,mn=0,Qh;function tl(t){var e="";do e=Kh[t%ro]+e,t=Math.floor(t/ro);while(t>0);return e}function nT(t){var e=0;for(mn=0;mn<t.length;mn++)e=e*ro+Wh[t.charAt(mn)];return e}function rl(){var t=tl(+new Date);return t!==Qh?(Xh=0,Qh=t):t+"."+tl(Xh++)}for(;mn<ro;mn++)Wh[Kh[mn]]=mn;rl.encode=tl,rl.decode=nT;var Yh=rl;function iT(t){r.debug=r,r.default=r,r.coerce=l,r.disable=a,r.enable=s,r.enabled=c,r.humanize=oa,Object.keys(t).forEach(u=>{r[u]=t[u]}),r.instances=[],r.names=[],r.skips=[],r.formatters={};function e(u){let h=0;for(let f=0;f<u.length;f++)h=(h<<5)-h+u.charCodeAt(f),h|=0;return r.colors[Math.abs(h)%r.colors.length]}r.selectColor=e;function r(u){let h;function f(...p){if(!f.enabled)return;const S=f,D=Number(new Date),I=D-(h||D);S.diff=I,S.prev=h,S.curr=D,h=D,p[0]=r.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let k=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(H,v)=>{if(H==="%%")return H;k++;const _=r.formatters[v];if(typeof _=="function"){const A=p[k];H=_.call(S,A),p.splice(k,1),k--}return H}),r.formatArgs.call(S,p);const V=S.log||r.log;V.apply(S,p)}return f.namespace=u,f.enabled=r.enabled(u),f.useColors=r.useColors(),f.color=e(u),f.destroy=n,f.extend=i,typeof r.init=="function"&&r.init(f),r.instances.push(f),f}function n(){const u=r.instances.indexOf(this);return u!==-1?(r.instances.splice(u,1),!0):!1}function i(u,h){const f=r(this.namespace+(typeof h=="undefined"?":":h)+u);return f.log=this.log,f}function s(u){r.save(u),r.names=[],r.skips=[];let h;const f=(typeof u=="string"?u:"").split(/[\s,]+/),p=f.length;for(h=0;h<p;h++){if(!f[h])continue;u=f[h].replace(/\*/g,".*?"),u[0]==="-"?r.skips.push(new RegExp("^"+u.substr(1)+"$")):r.names.push(new RegExp("^"+u+"$"))}for(h=0;h<r.instances.length;h++){const S=r.instances[h];S.enabled=r.enabled(S.namespace)}}function a(){const u=[...r.names.map(o),...r.skips.map(o).map(h=>"-"+h)].join(",");return r.enable(""),u}function c(u){if(u[u.length-1]==="*")return!0;let h,f;for(h=0,f=r.skips.length;h<f;h++)if(r.skips[h].test(u))return!1;for(h=0,f=r.names.length;h<f;h++)if(r.names[h].test(u))return!0;return!1}function o(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack||u.message:u}return r.enable(r.load()),r}var sT=iT,no=re(function(t,e){e.log=i,e.formatArgs=n,e.save=s,e.load=a,e.useColors=r,e.storage=c(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let h=0,f=0;l[0].replace(/%[a-zA-Z%]/g,p=>{if(p==="%%")return;h++,p==="%c"&&(f=h)}),l.splice(f,0,u)}function i(...l){return typeof console=="object"&&console.log&&console.log(...l)}function s(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch(u){}}function a(){let l;try{l=e.storage.getItem("debug")}catch(u){}return!l&&typeof ve!="undefined"&&"env"in ve&&(l=ve.env.DEBUG),l}function c(){try{return localStorage}catch(l){}}t.exports=sT(e);const{formatters:o}=t.exports;o.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}});const dr=no("engine.io-client:polling");class aT extends to{get name(){return"polling"}doOpen(){this.poll()}pause(t){const e=this;this.readyState="pausing";function r(){dr("paused"),e.readyState="paused",t()}if(this.polling||!this.writable){let n=0;this.polling&&(dr("we are currently polling - waiting to pause"),n++,this.once("pollComplete",function(){dr("pre-pause polling complete"),--n||r()})),this.writable||(dr("we are currently writing - waiting to pause"),n++,this.once("drain",function(){dr("pre-pause writing complete"),--n||r()}))}else r()}poll(){dr("polling"),this.polling=!0,this.doPoll(),this.emit("poll")}onData(t){const e=this;dr("polling got data %s",t);const r=function(n,i,s){if(e.readyState==="opening"&&n.type==="open"&&e.onOpen(),n.type==="close")return e.onClose(),!1;e.onPacket(n)};Qn.decodePayload(t,this.socket.binaryType).forEach(r),this.readyState!=="closed"&&(this.polling=!1,this.emit("pollComplete"),this.readyState==="open"?this.poll():dr('ignoring poll - transport state "%s"',this.readyState))}doClose(){const t=this;function e(){dr("writing close packet"),t.write([{type:"close"}])}this.readyState==="open"?(dr("transport open - closing"),e()):(dr("transport not open - deferring close"),this.once("open",e))}write(t){this.writable=!1,Qn.encodePayload(t,e=>{this.doWrite(e,()=>{this.writable=!0,this.emit("drain")})})}uri(){let t=this.query||{};const e=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=Yh()),!this.supportsBinary&&!t.sid&&(t.b64=1),t=el.encode(t),this.opts.port&&(e==="https"&&Number(this.opts.port)!==443||e==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),t.length&&(t="?"+t);const n=this.opts.hostname.indexOf(":")!==-1;return e+"://"+(n?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+t}}var Jh=aT,oT=(t,...e)=>e.reduce((r,n)=>(r[n]=t[n],r),{}),Zh={pick:oT};const{pick:cT}=Zh,nl=no("engine.io-client:polling-xhr");function ep(){}const lT=function(){const t=new Yc({xdomain:!1});return t.responseType!=null}();class uT extends Jh{constructor(t){super(t);if(typeof location!="undefined"){const r=location.protocol==="https:";let n=location.port;n||(n=r?443:80),this.xd=typeof location!="undefined"&&t.hostname!==location.hostname||n!==t.port,this.xs=t.secure!==r}const e=t&&t.forceBase64;this.supportsBinary=lT&&!e}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new Er(this.uri(),t)}doWrite(t,e){const r=this.request({method:"POST",data:t}),n=this;r.on("success",e),r.on("error",function(i){n.onError("xhr post error",i)})}doPoll(){nl("xhr poll");const t=this.request(),e=this;t.on("data",function(r){e.onData(r)}),t.on("error",function(r){e.onError("xhr poll error",r)}),this.pollXhr=t}}class Er extends Gi{constructor(t,e){super();this.opts=e,this.method=e.method||"GET",this.uri=t,this.async=e.async!==!1,this.data=e.data!==void 0?e.data:null,this.create()}create(){const t=cT(this.opts,"agent","enablesXDR","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const e=this.xhr=new Yc(t),r=this;try{nl("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(let n in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&e.setRequestHeader(n,this.opts.extraHeaders[n])}}catch(n){}if(this.method==="POST")try{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(n){}try{e.setRequestHeader("Accept","*/*")}catch(n){}"withCredentials"in e&&(e.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(e.timeout=this.opts.requestTimeout),this.hasXDR()?(e.onload=function(){r.onLoad()},e.onerror=function(){r.onError(e.responseText)}):e.onreadystatechange=function(){if(e.readyState!==4)return;e.status===200||e.status===1223?r.onLoad():setTimeout(function(){r.onError(typeof e.status=="number"?e.status:0)},0)},nl("xhr data %s",this.data),e.send(this.data)}catch(n){setTimeout(function(){r.onError(n)},0);return}typeof document!="undefined"&&(this.index=Er.requestsCount++,Er.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(t){this.emit("data",t),this.onSuccess()}onError(t){this.emit("error",t),this.cleanup(!0)}cleanup(t){if(typeof this.xhr=="undefined"||this.xhr===null)return;if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=ep:this.xhr.onreadystatechange=ep,t)try{this.xhr.abort()}catch(e){}typeof document!="undefined"&&delete Er.requests[this.index],this.xhr=null}onLoad(){const t=this.xhr.responseText;t!==null&&this.onData(t)}hasXDR(){return typeof XDomainRequest!="undefined"&&!this.xs&&this.enablesXDR}abort(){this.cleanup()}}if(Er.requestsCount=0,Er.requests={},typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",tp);else if(typeof addEventListener=="function"){const t="onpagehide"in qi?"pagehide":"unload";addEventListener(t,tp,!1)}}function tp(){for(let t in Er.requests)Er.requests.hasOwnProperty(t)&&Er.requests[t].abort()}var rp=uT,dT=Er;rp.Request=dT;const hT=/\n/g,pT=/\\n/g;let io;function fT(){}class mT extends Jh{constructor(t){super(t);this.query=this.query||{},io||(io=qi.___eio=qi.___eio||[]),this.index=io.length;const e=this;io.push(function(r){e.onData(r)}),this.query.j=this.index,typeof addEventListener=="function"&&addEventListener("beforeunload",function(){e.script&&(e.script.onerror=fT)},!1)}get supportsBinary(){return!1}doClose(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),super.doClose()}doPoll(){const t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(i){t.onError("jsonp poll error",i)};const r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(e,r):(document.head||document.body).appendChild(e),this.script=e;const n=typeof navigator!="undefined"&&/gecko/i.test(navigator.userAgent);n&&setTimeout(function(){const i=document.createElement("iframe");document.body.appendChild(i),document.body.removeChild(i)},100)}doWrite(t,e){const r=this;let n;if(!this.form){const a=document.createElement("form"),c=document.createElement("textarea"),o=this.iframeId="eio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=o,a.method="POST",a.setAttribute("accept-charset","utf-8"),c.name="d",a.appendChild(c),document.body.appendChild(a),this.form=a,this.area=c}this.form.action=this.uri();function i(){s(),e()}function s(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(a){r.onError("jsonp polling iframe removal error",a)}try{const a='<iframe src="javascript:0" name="'+r.iframeId+'">';n=document.createElement(a)}catch(a){n=document.createElement("iframe"),n.name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}s(),t=t.replace(pT,`\\
`),this.area.value=t.replace(hT,"\\n");try{this.form.submit()}catch(a){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){r.iframe.readyState==="complete"&&i()}:this.iframe.onload=i}}var gT=mT,bT={WebSocket:qi.WebSocket||qi.MozWebSocket,usingBrowserWebSocket:!0,defaultBinaryType:"arraybuffer"};const{pick:yT}=Zh,{WebSocket:Ys,usingBrowserWebSocket:il,defaultBinaryType:vT}=bT,wT=no("engine.io-client:websocket"),np=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class ip extends to{constructor(t){super(t);this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,r=np?{}:yT(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=il&&!np?e?new Ys(t,e):new Ys(t):new Ys(t,e,r)}catch(n){return this.emit("error",n)}this.ws.binaryType=this.socket.binaryType||vT,this.addEventListeners()}addEventListeners(){const t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}}write(t){const e=this;this.writable=!1;let r=t.length,n=0;const i=r;for(;n<i;n++)(function(a){Qn.encodePacket(a,e.supportsBinary,function(c){const o={};if(!il&&(a.options&&(o.compress=a.options.compress),e.opts.perMessageDeflate)){const l=typeof c=="string"?Buffer.byteLength(c):c.length;l<e.opts.perMessageDeflate.threshold&&(o.compress=!1)}try{il?e.ws.send(c):e.ws.send(c,o)}catch(l){wT("websocket closed before onclose event")}--r||s()})})(t[n]);function s(){e.emit("flush"),setTimeout(function(){e.writable=!0,e.emit("drain")},0)}}onClose(){to.prototype.onClose.call(this)}doClose(){typeof this.ws!="undefined"&&this.ws.close()}uri(){let t=this.query||{};const e=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(e==="wss"&&Number(this.opts.port)!==443||e==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=Yh()),this.supportsBinary||(t.b64=1),t=el.encode(t),t.length&&(t="?"+t);const n=this.opts.hostname.indexOf(":")!==-1;return e+"://"+(n?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+t}check(){return!!Ys&&!("__initialize"in Ys&&this.name===ip.prototype.name)}}var _T=ip,ET=TT,ST=_T;function TT(t){let e,r=!1,n=!1;const i=t.jsonp!==!1;if(typeof location!="undefined"){const s=location.protocol==="https:";let a=location.port;a||(a=s?443:80),r=t.hostname!==location.hostname||a!==t.port,n=t.secure!==s}if(t.xdomain=r,t.xscheme=n,e=new Yc(t),"open"in e&&!t.forceJSONP)return new rp(t);if(!i)throw new Error("JSONP disabled");return new gT(t)}var sp={polling:ET,websocket:ST};const ze=no("engine.io-client:socket");class gn extends Gi{constructor(t,e={}){super();t&&typeof t=="object"&&(e=t,t=null),t?(t=Qc(t),e.hostname=t.host,e.secure=t.protocol==="https"||t.protocol==="wss",e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=Qc(e.host).host),this.secure=e.secure!=null?e.secure:typeof location!="undefined"&&location.protocol==="https:",e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=e.port||(typeof location!="undefined"&&location.port?location.port:this.secure?443:80),this.transports=e.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,jsonp:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{}},e),this.opts.path=this.opts.path.replace(/\/$/,"")+"/",typeof this.opts.query=="string"&&(this.opts.query=el.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,this.open()}createTransport(t){ze('creating transport "%s"',t);const e=AT(this.opts.query);e.EIO=Qn.protocol,e.transport=t,this.id&&(e.sid=this.id);const r=Object.assign({},this.opts.transportOptions[t],this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return ze("options: %j",r),new sp[t](r)}open(){let t;if(this.opts.rememberUpgrade&&gn.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else if(this.transports.length===0){const e=this;setTimeout(function(){e.emit("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch(e){ze("error while creating transport: %s",e),this.transports.shift(),this.open();return}t.open(),this.setTransport(t)}setTransport(t){ze("setting transport %s",t.name);const e=this;this.transport&&(ze("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.onDrain()}).on("packet",function(r){e.onPacket(r)}).on("error",function(r){e.onError(r)}).on("close",function(){e.onClose("transport close")})}probe(t){ze('probing transport "%s"',t);let e=this.createTransport(t,{probe:1}),r=!1;const n=this;gn.priorWebsocketSuccess=!1;function i(){if(n.onlyBinaryUpgrades){const h=!this.supportsBinary&&n.transport.supportsBinary;r=r||h}if(r)return;ze('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",function(h){if(r)return;if(h.type==="pong"&&h.data==="probe"){if(ze('probe transport "%s" pong',t),n.upgrading=!0,n.emit("upgrading",e),!e)return;gn.priorWebsocketSuccess=e.name==="websocket",ze('pausing current transport "%s"',n.transport.name),n.transport.pause(function(){if(r)return;if(n.readyState==="closed")return;ze("changing transport and sending upgrade packet"),u(),n.setTransport(e),e.send([{type:"upgrade"}]),n.emit("upgrade",e),e=null,n.upgrading=!1,n.flush()})}else{ze('probe transport "%s" failed',t);const f=new Error("probe error");f.transport=e.name,n.emit("upgradeError",f)}})}function s(){if(r)return;r=!0,u(),e.close(),e=null}function a(h){const f=new Error("probe error: "+h);f.transport=e.name,s(),ze('probe transport "%s" failed because of error: %s',t,h),n.emit("upgradeError",f)}function c(){a("transport closed")}function o(){a("socket closed")}function l(h){e&&h.name!==e.name&&(ze('"%s" works - aborting "%s"',h.name,e.name),s())}function u(){e.removeListener("open",i),e.removeListener("error",a),e.removeListener("close",c),n.removeListener("close",o),n.removeListener("upgrading",l)}e.once("open",i),e.once("error",a),e.once("close",c),this.once("close",o),this.once("upgrading",l),e.open()}onOpen(){if(ze("socket open"),this.readyState="open",gn.priorWebsocketSuccess=this.transport.name==="websocket",this.emit("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade&&this.transport.pause){ze("starting upgrade probes");let t=0;const e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){ze('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat");switch(t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emit("pong");break;case"error":const e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data);break}}else ze('packet received with socket readyState "%s"',this.readyState)}onHandshake(t){if(this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),this.readyState==="closed")return;this.resetPingTimeout()}resetPingTimeout(){clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=setTimeout(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout)}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emit("drain"):this.flush()}flush(){this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(ze("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))}write(t,e,r){return this.sendPacket("message",t,e,r),this}send(t,e,r){return this.sendPacket("message",t,e,r),this}sendPacket(t,e,r,n){if(typeof e=="function"&&(n=e,e=void 0),typeof r=="function"&&(n=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const i={type:t,data:e,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){const t=this;(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():e()}):this.upgrading?n():e());function e(){t.onClose("forced close"),ze("socket closing - telling transport to close"),t.transport.close()}function r(){t.removeListener("upgrade",r),t.removeListener("upgradeError",r),e()}function n(){t.once("upgrade",r),t.once("upgradeError",r)}return this}onError(t){ze("socket error %j",t),gn.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)}onClose(t,e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){ze('socket close with reason: "%s"',t);const r=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),r.writeBuffer=[],r.prevBufferLen=0}}filterUpgrades(t){const e=[];let r=0;const n=t.length;for(;r<n;r++)~this.transports.indexOf(t[r])&&e.push(t[r]);return e}}gn.priorWebsocketSuccess=!1,gn.protocol=Qn.protocol;function AT(t){const e={};for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}var sl=gn,Vi=(t,e)=>new sl(t,e),CT=sl,IT=sl.protocol,RT=to,kT=sp,PT=Qn;Vi.Socket=CT,Vi.protocol=IT,Vi.Transport=RT,Vi.transports=kT,Vi.parser=PT;var al=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.hasBinary=e.isBinary=void 0;const r=typeof ArrayBuffer=="function",n=l=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(l):l.buffer instanceof ArrayBuffer,i=Object.prototype.toString,s=typeof Blob=="function"||typeof Blob!="undefined"&&i.call(Blob)==="[object BlobConstructor]",a=typeof File=="function"||typeof File!="undefined"&&i.call(File)==="[object FileConstructor]";function c(l){return r&&(l instanceof ArrayBuffer||n(l))||s&&l instanceof Blob||a&&l instanceof File}e.isBinary=c;function o(l,u){if(!l||typeof l!="object")return!1;if(Array.isArray(l)){for(let h=0,f=l.length;h<f;h++)if(o(l[h]))return!0;return!1}if(c(l))return!0;if(l.toJSON&&typeof l.toJSON=="function"&&arguments.length===1)return o(l.toJSON(),!0);for(const h in l)if(Object.prototype.hasOwnProperty.call(l,h)&&o(l[h]))return!0;return!1}e.hasBinary=o}),ap=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.reconstructPacket=e.deconstructPacket=void 0;function r(a){const c=[],o=a.data,l=a;return l.data=n(o,c),l.attachments=c.length,{packet:l,buffers:c}}e.deconstructPacket=r;function n(a,c){if(!a)return a;if(al.isBinary(a)){const o={_placeholder:!0,num:c.length};return c.push(a),o}else if(Array.isArray(a)){const o=new Array(a.length);for(let l=0;l<a.length;l++)o[l]=n(a[l],c);return o}else if(typeof a=="object"&&!(a instanceof Date)){const o={};for(const l in a)a.hasOwnProperty(l)&&(o[l]=n(a[l],c));return o}return a}function i(a,c){return a.data=s(a.data,c),a.attachments=void 0,a}e.reconstructPacket=i;function s(a,c){if(!a)return a;if(a&&a._placeholder)return c[a.num];if(Array.isArray(a))for(let o=0;o<a.length;o++)a[o]=s(a[o],c);else if(typeof a=="object")for(const o in a)a.hasOwnProperty(o)&&(a[o]=s(a[o],c));return a}});function NT(t){r.debug=r,r.default=r,r.coerce=l,r.disable=a,r.enable=s,r.enabled=c,r.humanize=oa,Object.keys(t).forEach(u=>{r[u]=t[u]}),r.instances=[],r.names=[],r.skips=[],r.formatters={};function e(u){let h=0;for(let f=0;f<u.length;f++)h=(h<<5)-h+u.charCodeAt(f),h|=0;return r.colors[Math.abs(h)%r.colors.length]}r.selectColor=e;function r(u){let h;function f(...p){if(!f.enabled)return;const S=f,D=Number(new Date),I=D-(h||D);S.diff=I,S.prev=h,S.curr=D,h=D,p[0]=r.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let k=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(H,v)=>{if(H==="%%")return H;k++;const _=r.formatters[v];if(typeof _=="function"){const A=p[k];H=_.call(S,A),p.splice(k,1),k--}return H}),r.formatArgs.call(S,p);const V=S.log||r.log;V.apply(S,p)}return f.namespace=u,f.enabled=r.enabled(u),f.useColors=r.useColors(),f.color=e(u),f.destroy=n,f.extend=i,typeof r.init=="function"&&r.init(f),r.instances.push(f),f}function n(){const u=r.instances.indexOf(this);return u!==-1?(r.instances.splice(u,1),!0):!1}function i(u,h){const f=r(this.namespace+(typeof h=="undefined"?":":h)+u);return f.log=this.log,f}function s(u){r.save(u),r.names=[],r.skips=[];let h;const f=(typeof u=="string"?u:"").split(/[\s,]+/),p=f.length;for(h=0;h<p;h++){if(!f[h])continue;u=f[h].replace(/\*/g,".*?"),u[0]==="-"?r.skips.push(new RegExp("^"+u.substr(1)+"$")):r.names.push(new RegExp("^"+u+"$"))}for(h=0;h<r.instances.length;h++){const S=r.instances[h];S.enabled=r.enabled(S.namespace)}}function a(){const u=[...r.names.map(o),...r.skips.map(o).map(h=>"-"+h)].join(",");return r.enable(""),u}function c(u){if(u[u.length-1]==="*")return!0;let h,f;for(h=0,f=r.skips.length;h<f;h++)if(r.skips[h].test(u))return!1;for(h=0,f=r.names.length;h<f;h++)if(r.names[h].test(u))return!0;return!1}function o(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack||u.message:u}return r.enable(r.load()),r}var OT=NT,DT=re(function(t,e){e.log=i,e.formatArgs=n,e.save=s,e.load=a,e.useColors=r,e.storage=c(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let h=0,f=0;l[0].replace(/%[a-zA-Z%]/g,p=>{if(p==="%%")return;h++,p==="%c"&&(f=h)}),l.splice(f,0,u)}function i(...l){return typeof console=="object"&&console.log&&console.log(...l)}function s(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch(u){}}function a(){let l;try{l=e.storage.getItem("debug")}catch(u){}return!l&&typeof ve!="undefined"&&"env"in ve&&(l=ve.env.DEBUG),l}function c(){try{return localStorage}catch(l){}}t.exports=OT(e);const{formatters:o}=t.exports;o.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}}),Dt=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Decoder=e.Encoder=e.PacketType=e.protocol=void 0;const r=DT("socket.io-parser");e.protocol=5;var n;(function(o){o[o.CONNECT=0]="CONNECT",o[o.DISCONNECT=1]="DISCONNECT",o[o.EVENT=2]="EVENT",o[o.ACK=3]="ACK",o[o.CONNECT_ERROR=4]="CONNECT_ERROR",o[o.BINARY_EVENT=5]="BINARY_EVENT",o[o.BINARY_ACK=6]="BINARY_ACK"})(n=e.PacketType||(e.PacketType={}));class i{encode(o){return r("encoding packet %j",o),(o.type===n.EVENT||o.type===n.ACK)&&al.hasBinary(o)?(o.type=o.type===n.EVENT?n.BINARY_EVENT:n.BINARY_ACK,this.encodeAsBinary(o)):[this.encodeAsString(o)]}encodeAsString(o){let l=""+o.type;return(o.type===n.BINARY_EVENT||o.type===n.BINARY_ACK)&&(l+=o.attachments+"-"),o.nsp&&o.nsp!=="/"&&(l+=o.nsp+","),o.id!=null&&(l+=o.id),o.data!=null&&(l+=JSON.stringify(o.data)),r("encoded %j as %s",o,l),l}encodeAsBinary(o){const l=ap.deconstructPacket(o),u=this.encodeAsString(l.packet),h=l.buffers;return h.unshift(u),h}}e.Encoder=i;class s extends Gi{constructor(){super()}add(o){let l;if(typeof o=="string")l=this.decodeString(o),l.type===n.BINARY_EVENT||l.type===n.BINARY_ACK?(this.reconstructor=new c(l),l.attachments===0&&super.emit("decoded",l)):super.emit("decoded",l);else if(al.isBinary(o)||o.base64)if(this.reconstructor)l=this.reconstructor.takeBinaryData(o),l&&(this.reconstructor=null,super.emit("decoded",l));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+o)}decodeString(o){let l=0;const u={type:Number(o.charAt(0))};if(n[u.type]===void 0)throw new Error("unknown packet type "+u.type);if(u.type===n.BINARY_EVENT||u.type===n.BINARY_ACK){const f=l+1;for(;o.charAt(++l)!=="-"&&l!=o.length;);const p=o.substring(f,l);if(p!=Number(p)||o.charAt(l)!=="-")throw new Error("Illegal attachments");u.attachments=Number(p)}if(o.charAt(l+1)==="/"){const f=l+1;for(;++l;){const p=o.charAt(l);if(p===",")break;if(l===o.length)break}u.nsp=o.substring(f,l)}else u.nsp="/";const h=o.charAt(l+1);if(h!==""&&Number(h)==h){const f=l+1;for(;++l;){const p=o.charAt(l);if(p==null||Number(p)!=p){--l;break}if(l===o.length)break}u.id=Number(o.substring(f,l+1))}if(o.charAt(++l)){const f=a(o.substr(l));if(s.isPayloadValid(u.type,f))u.data=f;else throw new Error("invalid payload")}return r("decoded %s as %j",o,u),u}static isPayloadValid(o,l){switch(o){case n.CONNECT:return typeof l=="object";case n.DISCONNECT:return l===void 0;case n.CONNECT_ERROR:return typeof l=="string"||typeof l=="object";case n.EVENT:case n.BINARY_EVENT:return Array.isArray(l)&&typeof l[0]=="string";case n.ACK:case n.BINARY_ACK:return Array.isArray(l)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}e.Decoder=s;function a(o){try{return JSON.parse(o)}catch(l){return!1}}class c{constructor(o){this.packet=o,this.buffers=[],this.reconPack=o}takeBinaryData(o){if(this.buffers.push(o),this.buffers.length===this.reconPack.attachments){const l=ap.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),l}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}}),Sr=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.on=void 0;function r(n,i,s){return n.on(i,s),{destroy:function(){n.off(i,s)}}}e.on=r}),op=[].slice,bn=function(t,e){if(typeof e=="string"&&(e=t[e]),typeof e!="function")throw new Error("bind() requires a function");var r=op.call(arguments,2);return function(){return e.apply(t,r.concat(op.call(arguments)))}},cp=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Socket=void 0;const r=eo("socket.io-client:socket"),n=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class i extends Gi{constructor(s,a,c){super();this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.flags={},this.io=s,this.nsp=a,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},c&&c.auth&&(this.auth=c.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;const s=this.io;this.subs=[Sr.on(s,"open",bn(this,"onopen")),Sr.on(s,"packet",bn(this,"onpacket")),Sr.on(s,"close",bn(this,"onclose"))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...s){return s.unshift("message"),this.emit.apply(this,s),this}emit(s,...a){if(n.hasOwnProperty(s))throw new Error('"'+s+'" is a reserved event name');a.unshift(s);const c={type:Dt.PacketType.EVENT,data:a};c.options={},c.options.compress=this.flags.compress!==!1,typeof a[a.length-1]=="function"&&(r("emitting packet with ack id %d",this.ids),this.acks[this.ids]=a.pop(),c.id=this.ids++);const o=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable,l=this.flags.volatile&&(!o||!this.connected);return l?r("discard packet as the transport is not currently writable"):this.connected?this.packet(c):this.sendBuffer.push(c),this.flags={},this}packet(s){s.nsp=this.nsp,this.io._packet(s)}onopen(){r("transport is open - connecting"),typeof this.auth=="function"?this.auth(s=>{this.packet({type:Dt.PacketType.CONNECT,data:s})}):this.packet({type:Dt.PacketType.CONNECT,data:this.auth})}onclose(s){r("close (%s)",s),this.connected=!1,this.disconnected=!0,delete this.id,super.emit("disconnect",s)}onpacket(s){const a=s.nsp===this.nsp;if(!a)return;switch(s.type){case Dt.PacketType.CONNECT:if(s.data&&s.data.sid){const o=s.data.sid;this.onconnect(o)}else super.emit("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Dt.PacketType.EVENT:this.onevent(s);break;case Dt.PacketType.BINARY_EVENT:this.onevent(s);break;case Dt.PacketType.ACK:this.onack(s);break;case Dt.PacketType.BINARY_ACK:this.onack(s);break;case Dt.PacketType.DISCONNECT:this.ondisconnect();break;case Dt.PacketType.CONNECT_ERROR:const c=new Error(s.data.message);c.data=s.data.data,super.emit("connect_error",c);break}}onevent(s){const a=s.data||[];r("emitting event %j",a),s.id!=null&&(r("attaching ack callback to event"),a.push(this.ack(s.id))),this.connected?this.emitEvent(a):this.receiveBuffer.push(Object.freeze(a))}emitEvent(s){if(this._anyListeners&&this._anyListeners.length){const a=this._anyListeners.slice();for(const c of a)c.apply(this,s)}super.emit.apply(this,s)}ack(s){const a=this;let c=!1;return function(...o){if(c)return;c=!0,r("sending ack %j",o),a.packet({type:Dt.PacketType.ACK,id:s,data:o})}}onack(s){const a=this.acks[s.id];typeof a=="function"?(r("calling ack %s with %j",s.id,s.data),a.apply(this,s.data),delete this.acks[s.id]):r("bad ack %s",s.id)}onconnect(s){r("socket connected with id %s",s),this.id=s,this.connected=!0,this.disconnected=!1,super.emit("connect"),this.emitBuffered()}emitBuffered(){this.receiveBuffer.forEach(s=>this.emitEvent(s)),this.receiveBuffer=[],this.sendBuffer.forEach(s=>this.packet(s)),this.sendBuffer=[]}ondisconnect(){r("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){if(this.subs){for(let s=0;s<this.subs.length;s++)this.subs[s].destroy();this.subs=null}this.io._destroy(this)}disconnect(){return this.connected&&(r("performing disconnect (%s)",this.nsp),this.packet({type:Dt.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(s){return this.flags.compress=s,this}get volatile(){return this.flags.volatile=!0,this}onAny(s){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(s),this}prependAny(s){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(s),this}offAny(s){if(!this._anyListeners)return this;if(s){const a=this._anyListeners;for(let c=0;c<a.length;c++)if(s===a[c])return a.splice(c,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}e.Socket=i}),MT=$i;function $i(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}$i.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),r=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-r:t+r}return Math.min(t,this.max)|0},$i.prototype.reset=function(){this.attempts=0},$i.prototype.setMin=function(t){this.ms=t},$i.prototype.setMax=function(t){this.max=t},$i.prototype.setJitter=function(t){this.jitter=t};var ol=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Manager=void 0;const r=eo("socket.io-client:manager");class n extends Gi{constructor(i,s){super();this.nsps={},this.subs=[],i&&typeof i=="object"&&(s=i,i=void 0),s=s||{},s.path=s.path||"/socket.io",this.opts=s,this.reconnection(s.reconnection!==!1),this.reconnectionAttempts(s.reconnectionAttempts||Infinity),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor(s.randomizationFactor||.5),this.backoff=new MT({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(s.timeout==null?2e4:s.timeout),this._readyState="closed",this.uri=i;const a=s.parser||Dt;this.encoder=new a.Encoder,this.decoder=new a.Decoder,this._autoConnect=s.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(i){return arguments.length?(this._reconnection=!!i,this):this._reconnection}reconnectionAttempts(i){return i===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=i,this)}reconnectionDelay(i){var s;return i===void 0?this._reconnectionDelay:(this._reconnectionDelay=i,(s=this.backoff)===null||s===void 0||s.setMin(i),this)}randomizationFactor(i){var s;return i===void 0?this._randomizationFactor:(this._randomizationFactor=i,(s=this.backoff)===null||s===void 0||s.setJitter(i),this)}reconnectionDelayMax(i){var s;return i===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=i,(s=this.backoff)===null||s===void 0||s.setMax(i),this)}timeout(i){return arguments.length?(this._timeout=i,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(i){if(r("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;r("opening %s",this.uri),this.engine=Vi(this.uri,this.opts);const s=this.engine,a=this;this._readyState="opening",this.skipReconnect=!1;const c=Sr.on(s,"open",function(){a.onopen(),i&&i()}),o=Sr.on(s,"error",l=>{r("error"),a.cleanup(),a._readyState="closed",super.emit("error",l),i?i(l):a.maybeReconnectOnOpen()});if(this._timeout!==!1){const l=this._timeout;r("connect attempt will timeout after %d",l),l===0&&c.destroy();const u=setTimeout(()=>{r("connect attempt timed out after %d",l),c.destroy(),s.close(),s.emit("error",new Error("timeout"))},l);this.subs.push({destroy:function(){clearTimeout(u)}})}return this.subs.push(c),this.subs.push(o),this}connect(i){return this.open(i)}onopen(){r("open"),this.cleanup(),this._readyState="open",super.emit("open");const i=this.engine;this.subs.push(Sr.on(i,"data",bn(this,"ondata")),Sr.on(i,"ping",bn(this,"onping")),Sr.on(i,"error",bn(this,"onerror")),Sr.on(i,"close",bn(this,"onclose")),Sr.on(this.decoder,"decoded",bn(this,"ondecoded")))}onping(){super.emit("ping")}ondata(i){this.decoder.add(i)}ondecoded(i){super.emit("packet",i)}onerror(i){r("error",i),super.emit("error",i)}socket(i,s){let a=this.nsps[i];return a||(a=new cp.Socket(this,i,s),this.nsps[i]=a),a}_destroy(i){const s=Object.keys(this.nsps);for(const a of s){const c=this.nsps[a];if(c.active){r("socket %s is still active, skipping close",a);return}}this._close()}_packet(i){r("writing packet %j",i),i.query&&i.type===0&&(i.nsp+="?"+i.query);const s=this.encoder.encode(i);for(let a=0;a<s.length;a++)this.engine.write(s[a],i.options)}cleanup(){r("cleanup");const i=this.subs.length;for(let s=0;s<i;s++){const a=this.subs.shift();a.destroy()}this.decoder.destroy()}_close(){r("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this._readyState==="opening"&&this.cleanup(),this.backoff.reset(),this._readyState="closed",this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(i){r("onclose"),this.cleanup(),this.backoff.reset(),this._readyState="closed",super.emit("close",i),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const i=this;if(this.backoff.attempts>=this._reconnectionAttempts)r("reconnect failed"),this.backoff.reset(),super.emit("reconnect_failed"),this._reconnecting=!1;else{const s=this.backoff.duration();r("will wait %dms before reconnect attempt",s),this._reconnecting=!0;const a=setTimeout(()=>{if(i.skipReconnect)return;if(r("attempting reconnect"),super.emit("reconnect_attempt",i.backoff.attempts),i.skipReconnect)return;i.open(c=>{c?(r("reconnect attempt error"),i._reconnecting=!1,i.reconnect(),super.emit("reconnect_error",c)):(r("reconnect success"),i.onreconnect())})},s);this.subs.push({destroy:function(){clearTimeout(a)}})}}onreconnect(){const i=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),super.emit("reconnect",i)}}e.Manager=n}),xT=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Socket=e.io=e.Manager=e.protocol=void 0,Object.defineProperty(e,"Socket",{enumerable:!0,get:function(){return cp.Socket}});const r=eo("socket.io-client");t.exports=e=i;const n=e.managers={};function i(a,c){typeof a=="object"&&(c=a,a=void 0),c=c||{};const o=US.url(a),l=o.source,u=o.id,h=o.path,f=n[u]&&h in n[u].nsps,p=c.forceNew||c["force new connection"]||c.multiplex===!1||f;let S;return p?(r("ignoring socket cache for %s",l),S=new ol.Manager(l,c)):(n[u]||(r("new io instance for %s",l),n[u]=new ol.Manager(l,c)),S=n[u]),o.query&&!c.query&&(c.query=o.query),S.socket(o.path,c)}e.io=i,Object.defineProperty(e,"protocol",{enumerable:!0,get:function(){return Dt.protocol}}),e.connect=i;var s=ol;Object.defineProperty(e,"Manager",{enumerable:!0,get:function(){return s.Manager}})}),cl=t=>{if(t[Symbol.asyncIterator])return t;if(t.getReader)return async function*(){const e=t.getReader();try{for(;;){const{done:r,value:n}=await e.read();if(r)return;yield n}}finally{e.releaseLock()}}();throw new Error("unknown stream")},lp=t=>async e=>{e=Fo(e);const r=k=>{typeof k.return=="function"&&k.return()};let n=null,i=null;const s=k=>{n=k,i&&i(k),r(e)};let a=null,c=!1;const o=()=>{c=!0,a&&a()};let l=null,u=!1;const h=()=>{u=!0,l&&l()};let f=null;const p=()=>{f&&f()},S=()=>new Promise((k,V)=>{a=f=k,i=V,t.once("drain",p)}),D=()=>(r(e),new Promise((k,V)=>{if(c||u||n)return k();l=a=k,i=V})),I=()=>{t.removeListener("error",s),t.removeListener("close",o),t.removeListener("finish",h),t.removeListener("drain",p)};t.once("error",s),t.once("close",o),t.once("finish",h);try{for await(const k of e){if(!t.writable||t.destroyed||n)break;t.write(k)===!1&&await S()}}catch(k){n||t.destroy(),n=k}try{if(t.writable&&t.end(),await D(),n)throw n}finally{I()}},up=t=>({sink:lp(t),source:cl(t)}),LT=t=>async function*(e){const r=up(t);r.sink(e).catch(n=>{}),yield*r.source},Hi=cl,jT=cl,BT=lp,UT=LT,FT=up;Hi.source=jT,Hi.sink=BT,Hi.transform=UT,Hi.duplex=FT;const{Address4:qT,Address6:GT}=ih,so={ERR_INVALID_IP_PARAMETER:"ERR_INVALID_IP_PARAMETER",ERR_INVALID_PORT_PARAMETER:"ERR_INVALID_PORT_PARAMETER",ERR_INVALID_IP:"ERR_INVALID_IP"};function VT(t,e){if(typeof t!="string")throw U(new Error(`invalid ip provided: ${t}`),so.ERR_INVALID_IP_PARAMETER);if(e=parseInt(e),isNaN(e))throw U(new Error(`invalid port provided: ${e}`),so.ERR_INVALID_PORT_PARAMETER);if(new qT(t).isValid())return mt(`/ip4/${t}/tcp/${e}`);const r=new GT(t);if(r.isValid())return r.is4()?mt(`/ip4/${r.to4().correctForm()}/tcp/${e}`):mt(`/ip6/${t}/tcp/${e}`);throw U(new Error(`invalid ip:port for creating a multiaddr: ${t}:${e}`),so.ERR_INVALID_IP)}var ll=VT,$T=so;ll.Errors=$T;const{CLOSE_TIMEOUT:HT}=Xc,ao=Q("libp2p:webrtc-star:socket");ao.error=Q("libp2p:webrtc-star:socket:error");const dp=(t,e)=>{if(!t||!e)return;try{return ll(t,e)}catch(r){return ao.error(r),ll("0.0.0.0",e)}};var hp=(t,e={})=>{const{sink:r,source:n}=Hi.duplex(t),i=e.remoteAddr||dp(t.remoteAddress,t.remotePort),s=dp(t.localAddress,t.localPort),a={async sink(c){e.signal&&(c=et(c,e.signal));try{await r(async function*(){for await(const o of c)yield o instanceof Uint8Array?o:o.slice()}())}catch(o){o.type!=="aborted"&&ao.error(o)}},source:e.signal?et(n,e.signal):n,conn:t,localAddr:s,remoteAddr:i,timeline:{open:Date.now()},close(){return t.destroyed?void 0:new Promise((c,o)=>{const l=Date.now(),u=setTimeout(()=>{if(a.remoteAddr){const{host:h,port:f}=a.remoteAddr.toOptions();ao("timeout closing socket to %s:%s after %dms, destroying it manually",h,f,Date.now()-l)}t.destroyed||t.destroy()},HT);t.once("close",()=>{c()}),t.end(h=>{if(clearTimeout(u),a.timeline.close=Date.now(),h)return o(h)})})}};return t.once("close",()=>{a.timeline.close||(a.timeline.close=Date.now())}),a},pp=re(function(t,e){function r(i){const s=i.toString().split("/"),a=i.protos()[1].name,c=i.protos()[2].name,o=i.stringTuples()[1][1];if(a!=="tcp"||c!=="ws"&&c!=="wss")throw new Error("invalid multiaddr: "+i.toString());if(!mt.isName(i))return"http://"+s[2]+":"+s[4];if(c==="ws")return"http://"+s[2]+(o===80?"":":"+o);if(c==="wss")return"https://"+s[2]+(o===443?"":":"+o)}function n(i){const s="/libp2p-webrtc-star";if(i.indexOf(s)!==-1){i=i.substring(s.length,i.length);let a=mt(i);const c=a.stringTuples().filter(o=>o[0]===421)[0];a=a.decapsulate("p2p"),a=a.encapsulate("/p2p-webrtc-star"),a=a.encapsulate(`/p2p/${c[1]}`),i=a.toString()}return i}e=t.exports,e.cleanUrlSIO=r,e.cleanMultiaddr=n});const Yn=Q("libp2p:webrtc-star:listener");Yn.error=Q("libp2p:webrtc-star:listener:error");const{cleanUrlSIO:zT}=pp,{CODE_P2P:fp}=Xc,KT={transports:["websocket"],"force new connection":!0};var WT=({handler:t,upgrader:e},r,n={})=>{const i=new _t;let s;return i.__connections=[],i.__spChannels=new Map,i.__pendingIntents=new Map,i.listen=a=>{const c=Ea();s=a,!a.protoCodes().includes(fp)&&e.localPeer?r._signallingAddr=a.encapsulate(`/p2p/${e.localPeer.toB58String()}`):r._signallingAddr=a;const o=zT(a);Yn("Dialing to Signalling Server on: "+o),i.io=xT.connect(o,KT);const l=u=>{if(u.answer||u.err||!u.intentId)return;const h=u.intentId;let f=i.__pendingIntents.get(h);f||(f=[],i.__pendingIntents.set(h,f));let p=i.__spChannels.get(h);if(p){p.signal(u.signal);return}else if(u.signal.type!=="offer"){f.push(u);return}const S={trickle:!1,...n};r.wrtc&&(S.wrtc=r.wrtc),p=new Bh(S);const D=I=>{Yn.error("incoming connectioned errored",I)};p.on("error",D),p.once("close",(...I)=>{p.removeListener("error",D)}),p.on("signal",I=>{u.signal=I,u.answer=!0,i.io.emit("ss-handshake",u)}),p.signal(u.signal);for(const I of f)p.signal(I.signal);i.__pendingIntents.set(h,[]),p.once("connect",async()=>{const I=hp(p);Yn("new inbound connection %s",I.remoteAddr);let k;try{k=await e.upgradeInbound(I)}catch(V){return Yn.error("inbound connection failed to upgrade",V),I.close()}if(!k.remoteAddr)try{k.remoteAddr=a.decapsulateCode(fp).encapsulate(`/p2p/${k.remotePeer.toB58String()}`)}catch(V){Yn.error("could not determine remote address",V)}Yn("inbound connection %s upgraded",I.remoteAddr),XT(i,I,h),i.emit("connection",k),t(k)}),i.__spChannels.set(h,p)};return i.io.once("connect_error",u=>c.reject(u)),i.io.once("error",u=>{i.emit("error",u),i.emit("close")}),i.io.on("ws-handshake",l),i.io.on("ws-peer",r._peerDiscovered),i.io.on("connect",()=>{i.io.emit("ss-join",r._signallingAddr.toString())}),i.io.once("connect",()=>{i.emit("listening"),c.resolve()}),c.promise},i.close=async()=>{i.io&&i.io.emit("ss-leave"),await Promise.all(i.__connections.map(a=>a.close())),i.emit("close")},i.getAddrs=()=>[s],r.listenersRefs[mt.toString()]=i,i};function XT(t,e,r){t.__connections.push(e);const n=()=>{t.__connections=t.__connections.filter(i=>i!==e),t.__spChannels.delete(r),t.__pendingIntents.delete(r)};e.conn.once("close",n)}const qr=Q("libp2p:webrtc-star");qr.error=Q("libp2p:webrtc-star:error");const{EventEmitter:QT}=_t,{AbortError:mp}=et,{supportsWebRTCDataChannels:YT}=kS,{CODE_CIRCUIT:JT}=Xc,{cleanMultiaddr:ZT}=pp;function eA(){}class tA{constructor(t={}){if(!t.upgrader)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=t.upgrader,this._signallingAddr=void 0,this.sioOptions={transports:["websocket"],"force new connection":!0},t.wrtc&&(this.wrtc=t.wrtc),this.listenersRefs={},this.discovery=new QT,this.discovery.tag="webRTCStar",this.discovery._isStarted=!1,this.discovery.start=()=>{this.discovery._isStarted=!0},this.discovery.stop=()=>{this.discovery._isStarted=!1},this._peerDiscovered=this._peerDiscovered.bind(this)}async dial(t,e={}){const r=await this._connect(t,e),n=hp(r,{remoteAddr:t,signal:e.signal});qr("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return qr("outbound connection %s upgraded",n.remoteAddr),i}_connect(t,e={}){if(e.signal&&e.signal.aborted)throw new mp;const r={initiator:!0,trickle:!1,...e.spOptions||{}};this.wrtc&&(r.wrtc=this.wrtc);const n=t.toOptions(),i=(~~(Math.random()*1e9)).toString(36)+Date.now(),s=this.listenersRefs[Object.keys(this.listenersRefs)[0]].io;return new Promise((a,c)=>{const o=Date.now();let l;qr("dialing %s:%s",n.host,n.port);const u=new Bh(r),h=I=>{if(!l){const k=`connection error ${n.host}:${n.port}: ${I.message}`;qr.error(k),D(I)}},f=()=>{qr("connnection timeout %s:%s",n.host,n.port);const I=U(new Error(`connection timeout after ${Date.now()-o}ms`),"ERR_CONNECT_TIMEOUT");u.emit("error",I)},p=()=>{l=!0,qr("connection opened %s:%s",n.host,n.port),D(null)},S=()=>{qr.error("connection aborted %s:%s",n.host,n.port),u.destroy(),D(new mp)},D=I=>{u.removeListener("timeout",f),u.removeListener("connect",p),e.signal&&e.signal.removeEventListener("abort",S),I?c(I):a(u)};u.on("error",h),u.once("timeout",f),u.once("connect",p),u.on("close",()=>{u.removeListener("error",h)}),e.signal&&e.signal.addEventListener("abort",S),u.on("signal",I=>{s.emit("ss-handshake",{intentId:i,srcMultiaddr:this._signallingAddr.toString(),dstMultiaddr:t.toString(),signal:I})}),s.on("ws-handshake",I=>{if(I.intentId===i&&I.err&&c(U(I.err instanceof Error?I.err:new Error(I.err),"ERR_SIGNALLING_FAILED")),I.intentId!==i||!I.answer||u.destroyed)return;u.signal(I.signal)})})}createListener(t={},e){if(!YT&&!this.wrtc)throw U(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");return typeof t=="function"&&(e=t,t={}),e=e||eA,WT({handler:e,upgrader:this._upgrader},this,t)}filter(t){return t=Array.isArray(t)?t:[t],t.filter(e=>e.protoCodes().includes(JT)?!1:Ps.WebRTCStar.matches(e))}_peerDiscovered(t){if(!this.discovery._isStarted)return;qr("Peer Discovered:",t),t=ZT(t);const e=mt(t),r=pe.createFromB58String(e.getPeerId());this.discovery.emit("peer",{id:r,multiaddrs:[e]})}}var gp=br(tA,{className:"WebRTCStar",symbolName:"@libp2p/js-libp2p-webrtc-star/webrtcstar"}),rA=421,nA=290,iA=2e3,ul={CODE_P2P:rA,CODE_CIRCUIT:nA,CLOSE_TIMEOUT:iA};const dl=Q("libp2p:tcp:socket"),{CLOSE_TIMEOUT:sA}=ul;var bp=(t,e)=>{e=e||{},e.listeningAddr&&e.listeningAddr.getPath()&&(e.remoteAddr=e.listeningAddr),e.remoteAddr&&e.remoteAddr.getPath()&&(e.localAddr=e.remoteAddr);const{sink:r,source:n}=Hi.duplex(t),i={async sink(s){e.signal&&(s=et(s,e.signal));try{await r(async function*(){for await(const a of s)yield Buffer.isBuffer(a)?a:a.slice()}())}catch(a){a.type!=="aborted"&&dl(a)}},source:e.signal?et(n,e.signal):n,conn:t,localAddr:e.localAddr||$s(t.localAddress,t.localPort),remoteAddr:e.remoteAddr||$s(t.remoteAddress,t.remotePort),timeline:{open:Date.now()},close(){return t.destroyed?void 0:new Promise((s,a)=>{const c=Date.now(),o=setTimeout(()=>{const{host:l,port:u}=i.remoteAddr.toOptions();dl("timeout closing socket to %s:%s after %dms, destroying it manually",l,u,Date.now()-c),t.destroyed?dl("%s:%s is already destroyed",l,u):t.destroy(),s()},sA);t.once("close",()=>clearTimeout(o)),t.end(l=>{if(i.timeline.close=Date.now(),l)return a(l);s()})})}};return t.once("close",()=>{i.timeline.close||(i.timeline.close=Date.now())}),i};const{resolve:aA}=cf,oA={ip4:"IPv4",ip6:"IPv6"};function cA(t){const e=t.getPath();return e?aA(e):t.toOptions()}function lA(t,e,r){const n=i=>mt(`/${t}/${i}/tcp/${r}`);return(yp(e)?uA(oA[t]):[e]).map(n)}function yp(t){return["0.0.0.0","::"].includes(t)}function uA(t){return Object.values(Sl.networkInterfaces()).reduce((e,r)=>(r.forEach(n=>{n.family===t&&e.push(n.address)}),e),[])}var vp={multiaddrToNetConfig:cA,isAnyAddr:yp,getMultiaddrs:lA};const Jn=Q("libp2p:tcp:listener");Jn.error=Q("libp2p:tcp:listener:error");const{CODE_P2P:dA}=ul,{getMultiaddrs:wp,multiaddrToNetConfig:hA}=vp;async function _p(t){try{t&&await t.close()}catch(e){Jn.error("an error occurred closing the connection",e)}}var pA=({handler:t,upgrader:e},r)=>{const n=new _t,i=go.createServer(async c=>{c.on("error",u=>Jn("socket error",u));let o,l;try{o=bp(c,{listeningAddr:a}),Jn("new inbound connection %s",o.remoteAddr),l=await e.upgradeInbound(o)}catch(u){return Jn.error("inbound connection failed",u),_p(o)}Jn("inbound connection %s upgraded",o.remoteAddr),fA(i,o),t&&t(l),n.emit("connection",l)});i.on("listening",()=>n.emit("listening")).on("error",c=>n.emit("error",c)).on("close",()=>n.emit("close")),i.__connections=[],n.close=()=>i.listening?new Promise((c,o)=>{i.__connections.forEach(l=>_p(l)),i.close(l=>l?o(l):c())}):void 0;let s,a;return n.listen=c=>(a=c,s=c.getPeerId(),s&&(a=c.decapsulateCode(dA)),new Promise((o,l)=>{const u=hA(a);i.listen(u,h=>{if(h)return l(h);Jn("Listening on %s",i.address()),o()})})),n.getAddrs=()=>{let c=[];const o=i.address();if(!o)throw new Error("Listener is not ready yet");return a.toString().startsWith("/ip4")?c=c.concat(wp("ip4",o.address,o.port)):o.family==="IPv6"&&(c=c.concat(wp("ip6",o.address,o.port))),c.map(l=>s?l.encapsulate(`/p2p/${s}`):l)},n};function fA(t,e){t.__connections.push(e);const r=()=>{t.__connections=t.__connections.filter(n=>n!==e)};e.conn.once("close",r)}const zi=Q("libp2p:tcp"),{multiaddrToNetConfig:mA}=vp,{AbortError:Ep}=et,{CODE_CIRCUIT:gA,CODE_P2P:bA}=ul;class yA{constructor({upgrader:t}){if(!t)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=t}async dial(t,e){e=e||{};const r=await this._connect(t,e),n=bp(r,{remoteAddr:t,signal:e.signal});zi("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return zi("outbound connection %s upgraded",n.remoteAddr),i}_connect(t,e={}){if(e.signal&&e.signal.aborted)throw new Ep;return new Promise((r,n)=>{const i=Date.now(),s=mA(t);zi("dialing %j",s);const a=go.connect(s),c=f=>{f.message=`connection error ${s.host}:${s.port}: ${f.message}`,h(f)},o=()=>{zi("connnection timeout %s:%s",s.host,s.port);const f=U(new Error(`connection timeout after ${Date.now()-i}ms`),"ERR_CONNECT_TIMEOUT");a.emit("error",f)},l=()=>{zi("connection opened %j",s),h()},u=()=>{zi("connection aborted %j",s),a.destroy(),h(new Ep)},h=f=>{if(a.removeListener("error",c),a.removeListener("timeout",o),a.removeListener("connect",l),e.signal&&e.signal.removeEventListener("abort",u),f)return n(f);r(a)};a.on("error",c),a.on("timeout",o),a.on("connect",l),e.signal&&e.signal.addEventListener("abort",u)})}createListener(t,e){return typeof t=="function"&&(e=t,t={}),t=t||{},pA({handler:e,upgrader:this._upgrader})}filter(t){return t=Array.isArray(t)?t:[t],t.filter(e=>e.protoCodes().includes(gA)?!1:Ps.TCP.matches(e.decapsulateCode(bA)))}}var vA=br(yA,{className:"TCP",symbolName:"@libp2p/js-libp2p-tcp/tcp"});const hl=10*1024;class wA{constructor(){this._pool=new Uint8Array(hl),this._poolOffset=0}write(t){const e=this._pool;let r=this._poolOffset;ge.encode(t.id<<3|t.type,e,r),r+=ge.encode.bytes,ge.encode(t.data?t.data.length:0,e,r),r+=ge.encode.bytes;const n=e.subarray(this._poolOffset,r);return hl-r<100?(this._pool=new Uint8Array(hl),this._poolOffset=0):this._poolOffset=r,t.data?[n,t.data]:n}}const Sp=new wA;var _A=t=>async function*(){for await(const r of t)Array.isArray(r)?yield new ct(r.map(n=>Sp.write(n))):yield new ct(Sp.write(r))}(),EA=t=>async function*(){const r=new SA;for await(const n of t){const i=r.write(n);i.length&&(yield i)}}();class SA{constructor(){this._buffer=new ct,this._bufferProxy=new Proxy({},{get:(t,e)=>e[0]==="l"?this._buffer[e]:this._buffer.get(parseInt(e))}),this._headerInfo=null}write(t){if(!t||!t.length)return[];this._buffer.append(t);const e=[];for(;;){if(!this._headerInfo)try{this._headerInfo=this._decodeHeader(this._bufferProxy)}catch(c){break}const{id:r,type:n,length:i,offset:s}=this._headerInfo,a=this._buffer.length-s;if(a<i)break;e.push({id:r,type:n,data:this._buffer.shallowSlice(s,s+i)}),this._buffer.consume(s+i),this._headerInfo=null}return e}_decodeHeader(t){const e=ge.decode(t);let r=ge.decode.bytes;const n=ge.decode(t,r);return r+=ge.decode.bytes,{id:e>>3,type:e&7,offset:r,length:n}}}var TA=_A,AA=EA,Tp={encode:TA,decode:AA};const Ap=1<<20;var pl=t=>{t=t||Ap;const e=r=>{if(r.data&&r.data.length>t)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"})};return r=>async function*(){for await(const i of r)Array.isArray(i)?i.forEach(e):e(i),yield i}()},CA=Ap;pl.MAX_MSG_SIZE=CA;const Gr=Object.freeze({NEW_STREAM:0,MESSAGE_RECEIVER:1,MESSAGE_INITIATOR:2,CLOSE_RECEIVER:3,CLOSE_INITIATOR:4,RESET_RECEIVER:5,RESET_INITIATOR:6});var IA=Gr,RA=Object.freeze({NEW_STREAM:Gr.NEW_STREAM,MESSAGE:Gr.MESSAGE_INITIATOR,CLOSE:Gr.CLOSE_INITIATOR,RESET:Gr.RESET_INITIATOR}),kA=Object.freeze({MESSAGE:Gr.MESSAGE_RECEIVER,CLOSE:Gr.CLOSE_RECEIVER,RESET:Gr.RESET_RECEIVER}),PA=Object.freeze(Object.entries(Gr).reduce((t,e)=>(t[e[1]]=e[0],t),{})),Cp={MessageTypes:IA,InitiatorMessageTypes:RA,ReceiverMessageTypes:kA,MessageTypeNames:PA};const Js=Q("libp2p:mplex:stream"),{MAX_MSG_SIZE:NA}=pl,{InitiatorMessageTypes:OA,ReceiverMessageTypes:DA}=Cp,fl="ERR_MPLEX_STREAM_RESET",MA="ERR_MPLEX_STREAM_ABORT";var xA=({id:t,name:e,send:r,onEnd:n=()=>{},type:i="initiator",maxMsgSize:s=NA})=>{const a=new As,c=new As,o=i==="initiator"?OA:DA,l=i==="initiator"?`i${t}`:`r${t}`;e=String(e??t);let u=!1,h=!1,f;const p=I=>{if(u)return;u=!0,Js("%s stream %s source end",i,e,I),I&&!f&&(f=I),h&&(D.timeline.close=Date.now(),n(f))},S=I=>{if(h)return;h=!0,Js("%s stream %s sink end",i,e,I),I&&!f&&(f=I),u&&(D.timeline.close=Date.now(),n(f))},D={close:()=>D.source.end(),abort:I=>{Js("%s stream %s abort",i,e,I),D.source.end(I),a.abort(),S(I)},reset:()=>{const I=U(new Error("stream reset"),fl);c.abort(),D.source.end(I),S(I)},sink:async I=>{I=et(I,[{signal:a.signal,options:{abortMessage:"stream aborted",abortCode:MA}},{signal:c.signal,options:{abortMessage:"stream reset",abortCode:fl}}]),i==="initiator"&&r({id:t,type:o.NEW_STREAM,data:e});try{for await(let k of I)for(;k.length;){if(k.length<=s){r({id:t,type:o.MESSAGE,data:k});break}k=ct.isBufferList(k)?k:new ct(k),r({id:t,type:o.MESSAGE,data:k.shallowSlice(0,s)}),k.consume(s)}}catch(k){return k.code===fl?Js("%s stream %s reset",i,e):(Js("%s stream %s error",i,e,k),r({id:t,type:o.RESET})),D.source.end(k),S(k)}r({id:t,type:o.CLOSE}),S()},source:_a(p),timeline:{open:Date.now(),close:null},id:l};return D};const Vr=Q("libp2p:mplex"),{MessageTypes:Zn,MessageTypeNames:Ip}=Cp;class Rp{constructor(t){t=t||{},t=typeof t=="function"?{onStream:t}:t,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._options=t,this.sink=this._createSink(),this.source=this._createSource(),this.onStream=t.onStream,this.onStreamEnd=t.onStreamEnd}get streams(){const t=[];return this._streams.initiators.forEach(e=>{t.push(e)}),this._streams.receivers.forEach(e=>{t.push(e)}),t}newStream(t){const e=this._streamId++;t=t==null?e.toString():String(t);const r=this._streams.initiators;return this._newStream({id:e,name:t,type:"initiator",registry:r})}_newReceiverStream({id:t,name:e}){const r=this._streams.receivers;return this._newStream({id:t,name:e,type:"receiver",registry:r})}_newStream({id:t,name:e,type:r,registry:n}){if(n.has(t))throw new Error(`${r} stream ${t} already exists!`);Vr("new %s stream %s %s",r,t,e);const i=c=>(Vr.enabled&&Vr("%s stream %s %s send",r,t,e,{...c,type:Ip[c.type],data:c.data&&c.data.slice()}),this.source.push(c)),s=()=>{Vr("%s stream %s %s ended",r,t,e),n.delete(t),this.onStreamEnd&&this.onStreamEnd(a)},a=xA({id:t,name:e,send:i,type:r,onEnd:s,maxMsgSize:this._options.maxMsgSize});return n.set(t,a),a}_createSink(){return async t=>{this._options.signal&&(t=et(t,this._options.signal));try{await ft(t,Tp.decode,pl(this._options.maxMsgSize),async e=>{for await(const r of e)for(const n of r)this._handleIncoming(n)})}catch(e){return Vr("error in sink",e),this.source.end(e)}this.source.end()}}_createSource(){const t=r=>{const{initiators:n,receivers:i}=this._streams;for(const s of n.values())s.abort(r);for(const s of i.values())s.abort(r)},e=_a({onEnd:t,writev:!0});return Object.assign(Tp.encode(e),{push:e.push,end:e.end,return:e.return})}_handleIncoming({id:t,type:e,data:r}){if(Vr.enabled&&Vr("incoming message",{id:t,type:Ip[e],data:r.slice()}),e===Zn.NEW_STREAM&&this.onStream){const s=this._newReceiverStream({id:t,name:r.toString()});return this.onStream(s)}const n=e&1?this._streams.initiators:this._streams.receivers,i=n.get(t);if(!i)return Vr("missing stream %s",t);switch(e){case Zn.MESSAGE_INITIATOR:case Zn.MESSAGE_RECEIVER:i.source.push(r);break;case Zn.CLOSE_INITIATOR:case Zn.CLOSE_RECEIVER:i.close();break;case Zn.RESET_INITIATOR:case Zn.RESET_RECEIVER:i.reset();break;default:Vr("unknown message type %s",e)}}}Rp.multicodec="/mplex/6.7.0";var LA=Rp,jA=LA,oo=gr(`message Propose {
  optional bytes rand = 1;
  optional bytes pubkey = 2;
  optional string exchanges = 3;
  optional string ciphers = 4;
  optional string hashes = 5;
}

message Exchange {
  optional bytes epubkey = 1;
  optional bytes signature = 2;
}`);function BA(t,e){for(let r=0;r<t.byteLength;r++){if(t[r]<e[r])return-1;if(t[r]>e[r])return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0}var UA=BA;class kp extends Error{constructor(t="Unexpected Peer"){super(t);this.code=kp.code}static get code(){return"ERR_UNEXPECTED_PEER"}}class Pp extends Error{constructor(t="Invalid crypto exchange"){super(t);this.code=Pp.code}static get code(){return"ERR_INVALID_CRYPTO_EXCHANGE"}}class Np extends Error{constructor(t="Invalid crypto transmission"){super(t);this.code=Np.code}static get code(){return"ERR_INVALID_CRYPTO_TRANSMISSION"}}var ml={UnexpectedPeerError:kp,InvalidCryptoExchangeError:Pp,InvalidCryptoTransmissionError:Np},yn=re(function(t,e){const{InvalidCryptoExchangeError:r}=ml;e.exchanges=["P-256","P-384","P-521"],e.ciphers=["AES-256","AES-128"],e.hashes=["SHA256","SHA512"],e.theBest=(s,a,c)=>{let o,l;if(s<0)o=c,l=a;else if(s>0)o=a,l=c;else return a[0];for(const u of o)for(const h of l)if(u===h)return u;throw new r("No algorithms in common!")},e.makeMacAndCipher=async s=>{[s.mac,s.cipher]=await Promise.all([n(s.hashT,s.keys.macKey),i(s.cipherT,s.keys.iv,s.keys.cipherKey)])};function n(s,a){return Kt.hmac.create(s,a)}function i(s,a,c){if(s==="AES-128"||s==="AES-256")return Kt.aes.create(c,a);throw new r(`unrecognized cipher type: ${s}`)}e.selectBest=async(s,a)=>{const c=await e.digest(Ze([a.pubKeyBytes,s.nonce])),o=await e.digest(Ze([s.pubKeyBytes,a.nonce])),l=UA(c,o);if(l===0)throw new r("you are trying to talk to yourself");return{curveT:e.theBest(l,s.exchanges,a.exchanges),cipherT:e.theBest(l,s.ciphers,a.ciphers),hashT:e.theBest(l,s.hashes,a.hashes),order:l}},e.digest=s=>af.digest(s,"sha2-256",s.length)});const vn=Q("libp2p:secio");vn.error=Q("libp2p:secio:error");const{UnexpectedPeerError:FA}=ml,qA=16;var GA=t=>(t.proposal.out={rand:Kt.randomBytes(qA),pubkey:t.key.local.public.bytes,exchanges:yn.exchanges.join(","),ciphers:yn.ciphers.join(","),hashes:yn.hashes.join(",")},t.proposalEncoded.out=oo.Propose.encode(t.proposal.out),t.proposalEncoded.out),VA=async t=>{const e=await Kt.keys.generateEphemeralKeyPair(t.protocols.local.curveT);t.ephemeralKey.local=e.key,t.shared.generate=e.genSharedKey;const r=Ze([t.proposalEncoded.out,t.proposalEncoded.in,t.ephemeralKey.local]),n=await t.key.local.sign(r);return t.exchange.out={epubkey:t.ephemeralKey.local,signature:n},oo.Exchange.encode(t.exchange.out)},$A=async(t,e)=>{vn("1.1 identify"),t.proposalEncoded.in=e,t.proposal.in=oo.Propose.decode(e);const r=t.proposal.in.pubkey;t.key.remote=Kt.keys.unmarshalPublicKey(r);const n=await pe.createFromPubKey(Ee(r,"base64pad"));if(t.id.remote){if(t.id.remote.toString()!==n.toString())throw new FA("Dialed to the wrong peer: IDs do not match!");t.id.remote.pubKey=t.key.remote}else t.id.remote=n;vn("1.1 identify - %s - identified remote peer as %s",t.id.local.toB58String(),t.id.remote.toB58String())},HA=async t=>{vn("1.2 selection");const e={pubKeyBytes:t.key.local.public.bytes,exchanges:yn.exchanges,hashes:yn.hashes,ciphers:yn.ciphers,nonce:t.proposal.out.rand},r={pubKeyBytes:t.proposal.in.pubkey,exchanges:t.proposal.in.exchanges.split(","),hashes:t.proposal.in.hashes.split(","),ciphers:t.proposal.in.ciphers.split(","),nonce:t.proposal.in.rand},n=await yn.selectBest(e,r);t.protocols.remote={order:n.order,curveT:n.curveT,cipherT:n.cipherT,hashT:n.hashT},t.protocols.local={order:n.order,curveT:n.curveT,cipherT:n.cipherT,hashT:n.hashT}},zA=async(t,e)=>{vn("2.1. verify"),t.exchange.in=oo.Exchange.decode(e),t.ephemeralKey.remote=t.exchange.in.epubkey;const r=Ze([t.proposalEncoded.in,t.proposalEncoded.out,t.ephemeralKey.remote]),n=await t.key.remote.verify(r,t.exchange.in.signature);if(!n)throw new Error("Bad signature");vn("2.1. verify - signature verified")},KA=async t=>{vn("2.2. keys");const e=await t.shared.generate(t.exchange.in.epubkey);t.shared.secret=e;const r=await Kt.keys.keyStretcher(t.protocols.local.cipherT,t.protocols.local.hashT,t.shared.secret);if(t.protocols.local.order>0)t.protocols.local.keys=r.k1,t.protocols.remote.keys=r.k2;else if(t.protocols.local.order<0)t.protocols.local.keys=r.k2,t.protocols.remote.keys=r.k1;else throw new Error("you are trying to talk to yourself");vn("2.3. mac + cipher"),await Promise.all([t.protocols.local,t.protocols.remote].map(n=>yn.makeMacAndCipher(n)))},WA=(t,e)=>{const r=t.proposal.out.rand;if(Nr(r,e))return;throw new Error(`Failed to read our encrypted nonce: ${Ee(r,"base16")} != ${Ee(e,"base16")}`)},ei={createProposal:GA,createExchange:VA,identify:$A,selectProtocols:HA,verify:zA,generateKeys:KA,verifyNonce:WA};const{int32BEEncode:XA}=Xe,Ki=Q("libp2p:secio");Ki.error=Q("libp2p:secio:error");var QA=async function(e,r){Ki("1. propose - start");const n=ei.createProposal(e);Ki("1. propose - writing proposal",n),await r.write(Xe.encode.single(n,{lengthEncoder:XA})),Ki("1. propose - reading proposal");const i=(await r.readLP()).slice();Ki("1. propose - read proposal",i),await ei.identify(e,i),await ei.selectProtocols(e),Ki("1. propose - finish")};const Zs=Q("libp2p:secio");Zs.error=Q("libp2p:secio:error");var YA=async function(e,r){Zs("2. exchange - start"),Zs("2. exchange - writing exchange");const n=await ei.createExchange(e);await r.writeLP(n);const i=await r.readLP();Zs("2. exchange - reading exchange"),await ei.verify(e,i.slice()),await ei.generateKeys(e),Zs("2. exchange - finish")},Op=function(){let e,r;const n=async s=>{if(e)throw new Error("already piped");e=Fo(s),r&&r(e)},i={[Symbol.asyncIterator](){return this},next(){return e?e.next():new Promise(s=>{r=a=>{r=null,s(a.next())}})}};return{sink:n,source:i}},JA=function(){var t=Op(),e=Op();return[{source:t.source,sink:e.sink},{source:e.source,sink:t.sink}]};/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var ZA=function(e){return e!=null&&e.constructor!=null&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)},Dp=(t,e={})=>{const r=Ds(t),n=Xe.decode.fromReader(r.reader,e),i={read:async s=>{const{value:a,done:c}=await r.reader.next(s);if(c&&a.length<s)throw new Error("Couldn't read enough bytes");if(!a)throw new Error("Value is null");return a},readLP:async()=>{const{value:s,done:a}=await n.next();if(!s)throw new Error("Value is null");return s},readPB:async s=>{const a=await i.readLP();if(!a)throw new Error("Value is null");const c=ZA(a)?a:a.slice();return s.decode(c)},write:s=>{r.writer.push(s)},writeLP:s=>{i.write(Xe.encode.single(s,e))},writePB:(s,a)=>{i.writeLP(a.encode(s))},pb:s=>({read:()=>i.readPB(s),write:a=>i.writePB(a,s)}),unwrap:()=>(r.rest(),r.stream)};return i};const{InvalidCryptoTransmissionError:Mp}=ml;var eC=(t,e)=>async function*(r){for await(const n of r){const i=await t.encrypt(ct.isBufferList(n)?n.slice():n),s=await e.digest(i);yield new ct([i,s])}},tC=(t,e)=>async function*(r){for await(const n of r){const i=n.length,s=e.length;if(i<s)throw new Mp(`buffer (${i}) shorter than MAC size (${s})`);const a=i-s,c=n.slice(0,a),o=n.slice(a),l=await e.digest(c);if(!Nr(o,l))throw new Mp(`MAC Invalid: ${Ee(o,"base16")} != ${Ee(l,"base16")}`);const u=await t.decrypt(c);yield u}},xp={createBoxStream:eC,createUnboxStream:tC};const co=Q("libp2p:secio");co.error=Q("libp2p:secio:error");const{int32BEEncode:rC,int32BEDecode:nC}=Xe,iC=8388608;var sC=async function(e,r){co("3. finish - start");const n=e.protocols,[i,s]=JA(),a=r.unwrap();ft(i,xp.createBoxStream(n.local.cipher,n.local.mac),Xe.encode({lengthEncoder:rC}),a,Xe.decode({lengthDecoder:nC,maxDataLength:iC}),xp.createUnboxStream(n.remote.cipher,n.remote.mac),i).catch(l=>{co.error("an error occurred in the crypto stream",l)});const c=Dp(s);c.write(e.proposal.in.rand);const o=await c.read(e.proposal.in.rand.length);ei.verifyNonce(e,o.slice()),co("3. finish - finish"),e.secure=c.unwrap()},aC=async function(e,r){await QA(e,r),await YA(e,r),await sC(e,r),e.cleanSecrets()};class oC{constructor(t,e){this.setup(),this.id.local=t,this.id.remote=e,this.key.local=t.privKey}setup(){this.id={local:null,remote:null},this.key={local:null,remote:null},this.shake=null,this.cleanSecrets()}cleanSecrets(){this.shared={},this.ephemeralKey={local:null,remote:null},this.proposal={in:null,out:null},this.proposalEncoded={in:null,out:null},this.protocols={local:null,remote:null},this.exchange={in:null,out:null}}}var cC=oC;const lC=Q("libp2p:secio");lC.error=Q("libp2p:secio:error");const{int32BEDecode:uC,int32BEEncode:dC}=Xe;async function Lp(t,e,r){if(!t)throw new Error("no local private key provided");if(!e)throw new Error("no connection for the handshake provided");const n=new cC(t,r),i=Dp(e,{lengthDecoder:uC,lengthEncoder:dC});return await aC(n,i),{conn:n.secure,remotePeer:n.id.remote}}var hC={protocol:"/secio/1.0.0",secureInbound:Lp,secureOutbound:Lp};const jp=()=>{};class pC{constructor({min:t=0,max:e=Infinity,handlers:r={}}){this.min=t,this.max=e,this._onConnect=r.onConnect||jp,this._onDisconnect=r.onDisconnect||jp,this.peers=new Set}set registrar(t){this._registrar=t}disconnect(t){this._onDisconnect(t)}}var fC=br(pC,{className:"Topology",symbolName:"@libp2p/js-interfaces/topology"});class mC extends fC{constructor({min:t,max:e,multicodecs:r,handlers:n}){super({min:t,max:e,handlers:n});if(!r)throw new Error("one or more multicodec should be provided");if(!n)throw new Error("the handlers should be provided");if(typeof n.onConnect!="function")throw new Error("the 'onConnect' handler must be provided");if(typeof n.onDisconnect!="function")throw new Error("the 'onDisconnect' handler must be provided");this.multicodecs=Array.isArray(r)?r:[r],this._registrar=void 0,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerConnect=this._onPeerConnect.bind(this)}set registrar(t){this._registrar=t,this._registrar.peerStore.on("change:protocols",this._onProtocolChange),this._registrar.connectionManager.on("peer:connect",this._onPeerConnect),this._updatePeers(this._registrar.peerStore.peers.values())}_updatePeers(t){for(const{id:e,protocols:r}of t)if(this.multicodecs.filter(n=>r.includes(n)).length){this.peers.add(e.toB58String());const n=this._registrar.getConnection(e);n&&this._onConnect(e,n)}else this.peers.delete(e.toB58String())}_onProtocolChange({peerId:t,protocols:e}){const r=this.peers.has(t.toB58String()),n=e.filter(i=>this.multicodecs.includes(i));r&&n.length===0&&this._onDisconnect(t);for(const i of e)if(this.multicodecs.includes(i)){const s=this._registrar.peerStore.get(t);this._updatePeers([s]);return}}_onPeerConnect(t){const e=t.remotePeer,r=this._registrar.peerStore.protoBook.get(e);if(!r)return;this.multicodecs.find(n=>r.includes(n))&&(this.peers.add(e.toB58String()),this._onConnect(e,t))}}var gC=br(mC,{className:"MulticodecTopology",symbolName:"@libp2p/js-interfaces/topology/multicodec-topology"}),bC={ERR_INVALID_SIGNATURE_POLICY:"ERR_INVALID_SIGNATURE_POLICY",ERR_UNHANDLED_SIGNATURE_POLICY:"ERR_UNHANDLED_SIGNATURE_POLICY",ERR_MISSING_SIGNATURE:"ERR_MISSING_SIGNATURE",ERR_MISSING_SEQNO:"ERR_MISSING_SEQNO",ERR_INVALID_SIGNATURE:"ERR_INVALID_SIGNATURE",ERR_UNEXPECTED_FROM:"ERR_UNEXPECTED_FROM",ERR_UNEXPECTED_SIGNATURE:"ERR_UNEXPECTED_SIGNATURE",ERR_UNEXPECTED_KEY:"ERR_UNEXPECTED_KEY",ERR_UNEXPECTED_SEQNO:"ERR_UNEXPECTED_SEQNO"},gl={codes:bC},yC=`
message RPC {
  repeated SubOpts subscriptions = 1;
  repeated Message msgs = 2;

  message SubOpts {
    optional bool subscribe = 1; // subscribe or unsubcribe
    optional string topicID = 2;
  }

  message Message {
    optional bytes from = 1;
    optional bytes data = 2;
    optional bytes seqno = 3;
    repeated string topicIDs = 4;
    optional bytes signature = 5;
    optional bytes key = 6;
  }
}`,vC=`
// topicCID = cid(merkledag_protobuf(topicDescriptor)); (not the topic.name)
message TopicDescriptor {
  optional string name = 1;
  optional AuthOpts auth = 2;
  optional EncOpts enc = 2;

  message AuthOpts {
    optional AuthMode mode = 1;
    repeated bytes keys = 2; // root keys to trust

    enum AuthMode {
      NONE = 0; // no authentication, anyone can publish
      KEY = 1; // only messages signed by keys in the topic descriptor are accepted
      WOT = 2; // web of trust, certificates can allow publisher set to grow
    }
  }

  message EncOpts {
    optional EncMode mode = 1;
    repeated bytes keyHashes = 2; // the hashes of the shared keys used (salted)

    enum EncMode {
      NONE = 0; // no encryption, anyone can read
      SHAREDKEY = 1; // messages are encrypted with shared key
      WOT = 2; // web of trust, certificates can allow publisher set to grow
    }
  }
}`,lo=re(function(t,e){const r=gr(yC),n=r.RPC,i=gr(vC);e=t.exports,e.rpc=r,e.td=i,e.RPC=n,e.Message=n.Message,e.SubOpts=n.SubOpts});const Bp=Q("libp2p-pubsub:peer-streams");Bp.error=Q("libp2p-pubsub:peer-streams:error");class wC extends _t{constructor({id:t,protocol:e}){super();this.id=t,this.protocol=e,this._rawOutboundStream=null,this._rawInboundStream=null,this._inboundAbortController=null,this.outboundStream=null,this.inboundStream=null}get isReadable(){return Boolean(this.inboundStream)}get isWritable(){return Boolean(this.outboundStream)}write(t){if(!this.isWritable){const e=this.id.toB58String();throw new Error("No writable connection to "+e)}this.outboundStream.push(t)}attachInboundStream(t){this._inboundAbortController=new As,this._rawInboundStream=t,this.inboundStream=et(ft(this._rawInboundStream,Xe.decode()),this._inboundAbortController.signal,{returnOnAbort:!0}),this.emit("stream:inbound")}async attachOutboundStream(t){const e=this.outboundStream;e&&await this.outboundStream.end(!1),this._rawOutboundStream=t,this.outboundStream=_a({onEnd:r=>{this._rawOutboundStream.reset&&this._rawOutboundStream.reset(),this._rawOutboundStream=null,this.outboundStream=null,r!==!1&&this.emit("close")}}),ft(this.outboundStream,Xe.encode(),this._rawOutboundStream).catch(r=>{Bp.error(r)}),e||this.emit("stream:outbound")}close(){this.outboundStream&&this.outboundStream.end(),this.inboundStream&&this._inboundAbortController.abort(),this._rawOutboundStream=null,this.outboundStream=null,this._rawInboundStream=null,this.inboundStream=null,this.emit("close")}}var _C=wC,EC={StrictSign:"StrictSign",StrictNoSign:"StrictNoSign"},SC={SignaturePolicy:EC},$r=re(function(t,e){e=t.exports,e.randomSeqno=()=>rf(8),e.msgId=(r,n)=>{const i=pe.createFromB58String(r).id,s=new Uint8Array(i.length+n.length);return s.set(i,0),s.set(n,i.length),s},e.noSignMsgId=r=>of.encode(r,"sha2-256"),e.anyMatch=(r,n)=>{let i;Array.isArray(n)?i=s=>n.indexOf(s)>-1:i=s=>n.has(s);for(const s of r)if(i(s))return!0;return!1},e.ensureArray=r=>Array.isArray(r)?r:[r],e.normalizeInRpcMessage=(r,n)=>{const i=Object.assign({},r);return r.from instanceof Uint8Array&&(i.from=Ee(r.from,"base58btc")),n&&(i.receivedFrom=n),i},e.normalizeOutRpcMessage=r=>{const n=Object.assign({},r);return(typeof r.from=="string"||r.from instanceof String)&&(n.from=$e(r.from,"base58btc")),(typeof r.data=="string"||r.data instanceof String)&&(n.data=$e(r.data)),n}});const{Message:Up}=lo,bl=$e("libp2p-pubsub:");async function TC(t,e){const r=Ze([bl,Up.encode(e)]),n=await t.privKey.sign(r);return{...e,signature:n,key:t.pubKey.bytes}}async function AC(t){const e={...t};delete e.signature,delete e.key,e.from=pe.createFromCID(e.from).toBytes();const r=Ze([bl,Up.encode(e)]),n=await Fp(t);return n.verify(r,t.signature)}async function Fp(t){const e=pe.createFromCID(t.from);if(t.key){const r=await pe.createFromPubKey(t.key);if(r.isEqual(e))return r.pubKey;throw new Error("Public Key does not match the originator")}else{if(e.pubKey)return e.pubKey;throw new Error("Could not get the public key from the originator id")}}var CC={messagePublicKey:Fp,signMessage:TC,SignPrefix:bl,verifySignature:AC};const{codes:hr}=gl,{SignaturePolicy:Hr}=SC,{signMessage:IC,verifySignature:RC}=CC;class kC extends _t{constructor({debugName:t,multicodecs:e,libp2p:r,globalSignaturePolicy:n=Hr.StrictSign,canRelayMessage:i=!1,emitSelf:s=!1}){if(typeof t!="string")throw new Error("a debugname `string` is required");if(!e)throw new Error("multicodecs are required");if(!r)throw new Error("libp2p is required");super();if(this.log=Q(t),this.log.err=Q(`${t}:error`),this.multicodecs=$r.ensureArray(e),this._libp2p=r,this.registrar=r.registrar,this.peerId=r.peerId,this.started=!1,this.topics=new Map,this.subscriptions=new Set,this.peers=new Map,!Hr[n])throw U(new Error("Invalid global signature policy"),hr.ERR_INVALID_SIGUATURE_POLICY);this.globalSignaturePolicy=n,this.canRelayMessage=i,this.emitSelf=s,this.topicValidators=new Map,this._registrarId=void 0,this._onIncomingStream=this._onIncomingStream.bind(this),this._onPeerConnected=this._onPeerConnected.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this)}start(){if(this.started)return;this.log("starting"),this.registrar.handle(this.multicodecs,this._onIncomingStream);const t=new gC({multicodecs:this.multicodecs,handlers:{onConnect:this._onPeerConnected,onDisconnect:this._onPeerDisconnected}});this._registrarId=this.registrar.register(t),this.log("started"),this.started=!0}stop(){if(!this.started)return;this.registrar.unregister(this._registrarId),this.log("stopping"),this.peers.forEach(t=>t.close()),this.peers=new Map,this.subscriptions=new Set,this.started=!1,this.log("stopped")}_onIncomingStream({protocol:t,stream:e,connection:r}){const n=r.remotePeer,i=n.toB58String(),s=this._addPeer(n,t);s.attachInboundStream(e),this._processMessages(i,s.inboundStream,s)}async _onPeerConnected(t,e){const r=t.toB58String();this.log("connected",r);try{const{stream:n,protocol:i}=await e.newStream(this.multicodecs),s=this._addPeer(t,i);await s.attachOutboundStream(n)}catch(n){this.log.err(n)}this._sendSubscriptions(r,Array.from(this.subscriptions),!0)}_onPeerDisconnected(t,e){const r=t.toB58String();this.log("connection ended",r,e?e.message:""),this._removePeer(t)}_addPeer(t,e){const r=t.toB58String(),n=this.peers.get(r);if(n)return n;this.log("new peer",r);const i=new _C({id:t,protocol:e});return this.peers.set(r,i),i.once("close",()=>this._removePeer(t)),i}_removePeer(t){if(!t)return;const e=t.toB58String(),r=this.peers.get(e);if(!r)return;r.removeAllListeners(),r.close(),this.log("delete peer",e),this.peers.delete(e);for(const n of this.topics.values())n.delete(e);return r}async _processMessages(t,e,r){try{await ft(e,async n=>{for await(const i of n){const s=i instanceof Uint8Array?i:i.slice(),a=this._decodeRpc(s);this._processRpc(t,r,a)}})}catch(n){this._onPeerDisconnected(r.id,n)}}_processRpc(t,e,r){this.log("rpc from",t);const n=r.subscriptions,i=r.msgs;return n.length&&(n.forEach(s=>this._processRpcSubOpt(t,s)),this.emit("pubsub:subscription-change",e.id,n)),this._acceptFrom(t)?(i.length&&i.forEach(s=>{if(!(this.canRelayMessage||s.topicIDs.some(c=>this.subscriptions.has(c)))){this.log("received message we didn't subscribe to. Dropping.");return}const a=$r.normalizeInRpcMessage(s,t);this._processRpcMessage(a)}),!0):(this.log("received message from unacceptable peer %s",t),!1)}_processRpcSubOpt(t,e){const r=e.topicID;let n=this.topics.get(r);n||(n=new Set,this.topics.set(r,n)),e.subscribe?n.add(t):n.delete(t)}async _processRpcMessage(t){if(this.peerId.toB58String()===t.from&&!this.emitSelf)return;try{await this.validate(t)}catch(e){this.log("Message is invalid, dropping it. %O",e);return}this._emitMessage(t),this._publish($r.normalizeOutRpcMessage(t))}_emitMessage(t){t.topicIDs.forEach(e=>{this.subscriptions.has(e)&&this.emit(e,t)})}getMsgId(t){const e=this.globalSignaturePolicy;switch(e){case Hr.StrictSign:return $r.msgId(t.from,t.seqno);case Hr.StrictNoSign:return $r.noSignMsgId(t.data);default:throw U(new Error("Cannot get message id: unhandled signature policy: "+e),hr.ERR_UNHANDLED_SIGNATURE_POLICY)}}_acceptFrom(t){return!0}_decodeRpc(t){return lo.rpc.RPC.decode(t)}_encodeRpc(t){return lo.rpc.RPC.encode(t)}_sendRpc(t,e){const r=this.peers.get(t);if(!r||!r.isWritable){const n=`Cannot send RPC to ${t} as there is no open stream to it available`;this.log.err(n);return}r.write(this._encodeRpc(e))}_sendSubscriptions(t,e,r){return this._sendRpc(t,{subscriptions:e.map(n=>({topicID:n,subscribe:r}))})}async validate(t){const e=this.globalSignaturePolicy;switch(e){case Hr.StrictNoSign:if(t.from)throw U(new Error("StrictNoSigning: from should not be present"),hr.ERR_UNEXPECTED_FROM);if(t.signature)throw U(new Error("StrictNoSigning: signature should not be present"),hr.ERR_UNEXPECTED_SIGNATURE);if(t.key)throw U(new Error("StrictNoSigning: key should not be present"),hr.ERR_UNEXPECTED_KEY);if(t.seqno)throw U(new Error("StrictNoSigning: seqno should not be present"),hr.ERR_UNEXPECTED_SEQNO);break;case Hr.StrictSign:if(!t.signature)throw U(new Error("StrictSigning: Signing required and no signature was present"),hr.ERR_MISSING_SIGNATURE);if(!t.seqno)throw U(new Error("StrictSigning: Signing required and no seqno was present"),hr.ERR_MISSING_SEQNO);if(!await RC(t))throw U(new Error("StrictSigning: Invalid message signature"),hr.ERR_INVALID_SIGNATURE);break;default:throw U(new Error("Cannot validate message: unhandled signature policy: "+e),hr.ERR_UNHANDLED_SIGNATURE_POLICY)}for(const r of t.topicIDs){const n=this.topicValidators.get(r);if(!n)continue;await n(r,t)}}_buildMessage(t){const e=this.globalSignaturePolicy;switch(e){case Hr.StrictSign:return t.from=this.peerId.toB58String(),t.seqno=$r.randomSeqno(),IC(this.peerId,$r.normalizeOutRpcMessage(t));case Hr.StrictNoSign:return t;default:throw U(new Error("Cannot build message: unhandled signature policy: "+e),hr.ERR_UNHANDLED_SIGNATURE_POLICY)}}getSubscribers(t){if(!this.started)throw U(new Error("not started yet"),"ERR_NOT_STARTED_YET");if(!t||typeof t!="string")throw U(new Error("a string topic must be provided"),"ERR_NOT_VALID_TOPIC");const e=this.topics.get(t);return e?Array.from(e):[]}async publish(t,e){if(!this.started)throw new Error("Pubsub has not started");this.log("publish",t,e);const r=this.peerId.toB58String();let n={receivedFrom:r,data:e,topicIDs:[t]};const i=await this._buildMessage(n);n=$r.normalizeInRpcMessage(i),this.emitSelf&&this._emitMessage(n),await this._publish(n)}_publish(t){throw U(new Error("publish must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}subscribe(t){if(!this.started)throw new Error("Pubsub has not started");this.subscriptions.has(t)||(this.subscriptions.add(t),this.peers.forEach((e,r)=>this._sendSubscriptions(r,[t],!0)))}unsubscribe(t){if(!this.started)throw new Error("Pubsub is not started");this.subscriptions.has(t)&&this.listenerCount(t)===0&&(this.subscriptions.delete(t),this.peers.forEach((e,r)=>this._sendSubscriptions(r,[t],!1)))}getTopics(){if(!this.started)throw new Error("Pubsub is not started");return Array.from(this.subscriptions)}}var uo=kC,PC=lo,NC=$r,OC=Hr;uo.message=PC,uo.utils=NC,uo.SignaturePolicy=OC;var DC=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.createGossipRpc=void 0;function r(n=[],i={}){return{subscriptions:[],msgs:n,control:Object.assign({ihave:[],iwant:[],graft:[],prune:[]},i)}}e.createGossipRpc=r}),MC=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.shuffle=void 0;function r(n){if(n.length<=1)return n;const i=()=>Math.floor(Math.random()*Math.floor(n.length));for(let s=0;s<n.length;s++){const a=i(),c=n[s];n[s]=n[a],n[a]=c}return n}e.shuffle=r}),ti=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ERR_TOPIC_VALIDATOR_IGNORE=e.ERR_TOPIC_VALIDATOR_REJECT=e.TimeCacheDuration=e.GossipsubIWantFollowupTime=e.GossipsubMaxIHaveMessages=e.GossipsubMaxIHaveLength=e.GossipsubGraftFloodThreshold=e.GossipsubOpportunisticGraftPeers=e.GossipsubOpportunisticGraftTicks=e.GossipsubDirectConnectInitialDelay=e.GossipsubDirectConnectTicks=e.GossipsubConnectionTimeout=e.GossipsubMaxPendingConnections=e.GossipsubConnectors=e.GossipsubPruneBackoffTicks=e.GossipsubPruneBackoff=e.GossipsubPrunePeers=e.GossipsubFanoutTTL=e.GossipsubHeartbeatInterval=e.GossipsubHeartbeatInitialDelay=e.GossipsubGossipRetransmission=e.GossipsubGossipFactor=e.GossipsubDlazy=e.GossipsubHistoryGossip=e.GossipsubHistoryLength=e.GossipsubDout=e.GossipsubDscore=e.GossipsubDhi=e.GossipsubDlo=e.GossipsubD=e.GossipsubIDv11=e.GossipsubIDv10=e.FloodsubID=e.minute=e.second=void 0,e.second=1e3,e.minute=60*e.second,e.FloodsubID="/floodsub/1.0.0",e.GossipsubIDv10="/meshsub/1.0.0",e.GossipsubIDv11="/meshsub/1.1.0",e.GossipsubD=6,e.GossipsubDlo=4,e.GossipsubDhi=12,e.GossipsubDscore=4,e.GossipsubDout=2,e.GossipsubHistoryLength=5,e.GossipsubHistoryGossip=3,e.GossipsubDlazy=6,e.GossipsubGossipFactor=.25,e.GossipsubGossipRetransmission=3,e.GossipsubHeartbeatInitialDelay=100,e.GossipsubHeartbeatInterval=e.second,e.GossipsubFanoutTTL=e.minute,e.GossipsubPrunePeers=16,e.GossipsubPruneBackoff=e.minute,e.GossipsubPruneBackoffTicks=15,e.GossipsubConnectors=8,e.GossipsubMaxPendingConnections=128,e.GossipsubConnectionTimeout=30*e.second,e.GossipsubDirectConnectTicks=300,e.GossipsubDirectConnectInitialDelay=e.second,e.GossipsubOpportunisticGraftTicks=60,e.GossipsubOpportunisticGraftPeers=2,e.GossipsubGraftFloodThreshold=10*e.second,e.GossipsubMaxIHaveLength=5e3,e.GossipsubMaxIHaveMessages=10,e.GossipsubIWantFollowupTime=3*e.second,e.TimeCacheDuration=120*1e3,e.ERR_TOPIC_VALIDATOR_REJECT="ERR_TOPIC_VALIDATOR_REJECT",e.ERR_TOPIC_VALIDATOR_IGNORE="ERR_TOPIC_VALIDATOR_IGNORE"}),xC=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.hasGossipProtocol=void 0;function r(n){return n===ti.GossipsubIDv10||n===ti.GossipsubIDv11}e.hasGossipProtocol=r}),LC=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.messageIdToString=void 0;function r(n){return Ee(n,"base64")}e.messageIdToString=r}),Ne=re(function(t,e){var r=ie&&ie.__createBinding||(Object.create?function(i,s,a,c){c===void 0&&(c=a),Object.defineProperty(i,c,{enumerable:!0,get:function(){return s[a]}})}:function(i,s,a,c){c===void 0&&(c=a),i[c]=s[a]}),n=ie&&ie.__exportStar||function(i,s){for(var a in i)a!=="default"&&!s.hasOwnProperty(a)&&r(s,i,a)};Object.defineProperty(e,"__esModule",{value:!0}),n(DC,e),n(MC,e),n(xC,e),n(LC,e)}),jC=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.MessageCache=void 0;class r{constructor(n,i,s){this.msgs=new Map,this.peertx=new Map,this.history=[];for(let a=0;a<i;a++)this.history[a]=[];this.gossip=n,this.msgIdFn=s}put(n){const i=this.getMsgId(n),s=Ne.messageIdToString(i);this.msgs.set(s,n),this.history[0].push({msgID:i,topics:n.topicIDs})}getMsgId(n){return this.msgIdFn(n)}get(n){return this.msgs.get(Ne.messageIdToString(n))}getForPeer(n,i){const s=Ne.messageIdToString(n),a=this.msgs.get(s);if(!a)return[void 0,0];let c=this.peertx.get(s);c||(c=new Map,this.peertx.set(s,c));const o=(c.get(i)||0)+1;return c.set(i,o),[a,o]}getGossipIDs(n){const i=[];for(let s=0;s<this.gossip;s++)this.history[s].forEach(a=>{for(const c of a.topics)if(c===n){i.push(a.msgID);break}});return i}shift(){const n=this.history[this.history.length-1];n.forEach(i=>{const s=Ne.messageIdToString(i.msgID);this.msgs.delete(s),this.peertx.delete(s)}),this.history.pop(),this.history.unshift([])}}e.MessageCache=r}),BC=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=`
message RPC {
  repeated SubOpts subscriptions = 1;
  repeated Message msgs = 2;
  optional ControlMessage control = 3;

  message SubOpts {
    optional bool subscribe = 1; // subscribe or unsubcribe
    optional string topicID = 2;
  }

  message Message {
    optional bytes from = 1;
    optional bytes data = 2;
    optional bytes seqno = 3;
    repeated string topicIDs = 4; 
    optional bytes signature = 5;
    optional bytes key = 6;
  }

  message ControlMessage {
    repeated ControlIHave ihave = 1;
    repeated ControlIWant iwant = 2;
    repeated ControlGraft graft = 3;
    repeated ControlPrune prune = 4;
  }

  message ControlIHave {
    optional string topicID = 1;
    repeated bytes messageIDs = 2;
  }

  message ControlIWant {
    repeated bytes messageIDs = 1;  
  }

  message ControlGraft {
    optional string topicID = 1;
  }

  message ControlPrune {
    optional string topicID = 1;
    repeated PeerInfo peers = 2;
    optional uint64 backoff = 3;
  }

  message PeerInfo {
    optional bytes peerID = 1;
    optional bytes signedPeerRecord = 2;
  }
}`}),yl=re(function(t,e){var r=ie&&ie.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(e,"__esModule",{value:!0}),e.RPCCodec=void 0;const n=r(BC),i=gr(n.default);e.RPCCodec=i.RPC}),wn=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getGossipPeers=void 0;function r(n,i,s,a=()=>!0){const c=n.topics.get(i);if(!c)return new Set;let o=[];return c.forEach(l=>{const u=n.peers.get(l);if(!u)return;Ne.hasGossipProtocol(u.protocol)&&a(l)&&o.push(l)}),o=Ne.shuffle(o),s>0&&o.length>s&&(o=o.slice(0,s)),new Set(o)}e.getGossipPeers=r}),UC=re(function(t,e){var r=ie&&ie.__createBinding||(Object.create?function(c,o,l,u){u===void 0&&(u=l),Object.defineProperty(c,u,{enumerable:!0,get:function(){return o[l]}})}:function(c,o,l,u){u===void 0&&(u=l),c[u]=o[l]}),n=ie&&ie.__setModuleDefault||(Object.create?function(c,o){Object.defineProperty(c,"default",{enumerable:!0,value:o})}:function(c,o){c.default=o}),i=ie&&ie.__importStar||function(c){if(c&&c.__esModule)return c;var o={};if(c!=null)for(var l in c)l!=="default"&&Object.hasOwnProperty.call(c,l)&&r(o,c,l);return n(o,c),o};Object.defineProperty(e,"__esModule",{value:!0}),e.Heartbeat=void 0;const s=i(ti);class a{constructor(c){this.gossipsub=c}start(){if(this._heartbeatTimer)return;const c=this._heartbeat.bind(this),o=setTimeout(()=>{c(),this._heartbeatTimer.runPeriodically(c,s.GossipsubHeartbeatInterval)},s.GossipsubHeartbeatInitialDelay);this._heartbeatTimer={_intervalId:void 0,runPeriodically:(l,u)=>{this._heartbeatTimer._intervalId=setInterval(l,u)},cancel:()=>{clearTimeout(o),clearInterval(this._heartbeatTimer._intervalId)}}}stop(){if(!this._heartbeatTimer)return;this._heartbeatTimer.cancel(),this._heartbeatTimer=null}_heartbeat(){const{D:c,Dlo:o,Dhi:l,Dscore:u,Dout:h}=this.gossipsub._options;this.gossipsub.heartbeatTicks++;const f=new Map,p=V=>{let H=f.get(V);return H===void 0&&(H=this.gossipsub.score.score(V),f.set(V,H)),H},S=new Map,D=new Map,I=new Map;this.gossipsub._clearBackoff(),this.gossipsub.peerhave.clear(),this.gossipsub.iasked.clear(),this.gossipsub._applyIwantPenalties(),this.gossipsub._directConnect(),this.gossipsub.mesh.forEach((V,H)=>{const v=A=>{this.gossipsub.log("HEARTBEAT: Remove mesh link to %s in %s",A,H),this.gossipsub.score.prune(A,H),this.gossipsub._addBackoff(A,H),V.delete(A);const d=D.get(A);d?d.push(H):D.set(A,[H])},_=A=>{this.gossipsub.log("HEARTBEAT: Add mesh link to %s in %s",A,H),this.gossipsub.score.graft(A,H),V.add(A);const d=S.get(A);d?d.push(H):S.set(A,[H])};if(V.forEach(A=>{const d=p(A);d<0&&(this.gossipsub.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",A,d,H),v(A),I.set(A,!0))}),V.size<o){const A=this.gossipsub.backoff.get(H),d=c-V.size,g=wn.getGossipPeers(this.gossipsub,H,d,E=>!V.has(E)&&!this.gossipsub.direct.has(E)&&(!A||!A.has(E))&&p(E)>=0);g.forEach(_)}if(V.size>l){let A=Array.from(V);A.sort((g,E)=>p(E)-p(g)),A=A.slice(0,u).concat(Ne.shuffle(A.slice(u)));let d=0;if(A.slice(0,c).forEach(g=>{this.gossipsub.outbound.get(g)&&d++}),d<h){const g=b=>{const C=A[b];for(let P=b;P>0;P--)A[P]=A[P-1];A[0]=C};if(d>0){let b=d;for(let C=1;C<c&&b>0;C++)this.gossipsub.outbound.get(A[C])&&(g(C),b--)}let E=c-d;for(let b=c;b<A.length&&E>0;b++)this.gossipsub.outbound.get(A[b])&&(g(b),E--)}A.slice(c).forEach(v)}if(V.size>=o){let A=0;if(V.forEach(d=>{this.gossipsub.outbound.get(d)&&A++}),A<h){const d=h-A,g=this.gossipsub.backoff.get(H);wn.getGossipPeers(this.gossipsub,H,d,E=>!V.has(E)&&!this.gossipsub.direct.has(E)&&(!g||!g.has(E))&&p(E)>=0).forEach(_)}}if(this.gossipsub.heartbeatTicks%s.GossipsubOpportunisticGraftTicks===0&&V.size>1){const A=Array.from(V).sort((E,b)=>p(E)-p(b)),d=V.size/2,g=p(A[d]);if(g<this.gossipsub._options.scoreThresholds.opportunisticGraftThreshold){const E=this.gossipsub.backoff.get(H),b=wn.getGossipPeers(this.gossipsub,H,s.GossipsubOpportunisticGraftPeers,C=>V.has(C)&&!this.gossipsub.direct.has(C)&&(!E||!E.has(C))&&p(C)>g);b.forEach(C=>{this.gossipsub.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",C,H),_(C)})}}this.gossipsub._emitGossip(H,V)});const k=this.gossipsub._now();this.gossipsub.lastpub.forEach((V,H)=>{V+s.GossipsubFanoutTTL<k&&(this.gossipsub.fanout.delete(H),this.gossipsub.lastpub.delete(H))}),this.gossipsub.fanout.forEach((V,H)=>{const v=this.gossipsub.topics.get(H);if(V.forEach(_=>{(!v.has(_)||p(_)<this.gossipsub._options.scoreThresholds.publishThreshold)&&V.delete(_)}),V.size<c){const _=c-V.size,A=wn.getGossipPeers(this.gossipsub,H,_,d=>!V.has(d)&&!this.gossipsub.direct.has(d)&&p(d)>=this.gossipsub._options.scoreThresholds.publishThreshold);A.forEach(d=>{V.add(d)})}this.gossipsub._emitGossip(H,V)}),this.gossipsub._sendGraftPrune(S,D,I),this.gossipsub._flush(),this.gossipsub.messageCache.shift(),this.gossipsub.emit("gossipsub:heartbeat")}}e.Heartbeat=a}),Ce=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ERR_INVALID_PEER_SCORE_THRESHOLDS=e.ERR_INVALID_PEER_SCORE_PARAMS=void 0,e.ERR_INVALID_PEER_SCORE_PARAMS="ERR_INVALID_PEER_SCORE_PARAMS",e.ERR_INVALID_PEER_SCORE_THRESHOLDS="ERR_INVALID_PEER_SCORE_THRESHOLDS"}),qp=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.validateTopicScoreParams=e.validatePeerScoreParams=e.createTopicScoreParams=e.createPeerScoreParams=e.defaultTopicScoreParams=e.defaultPeerScoreParams=void 0,e.defaultPeerScoreParams={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},e.defaultTopicScoreParams={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function r(a={}){return Object.assign(Object.assign(Object.assign({},e.defaultPeerScoreParams),a),{topics:a.topics?Object.entries(a.topics).reduce((c,[o,l])=>(c[o]=n(l),c),{}):{}})}e.createPeerScoreParams=r;function n(a={}){return Object.assign(Object.assign({},e.defaultTopicScoreParams),a)}e.createTopicScoreParams=n;function i(a){for(const[c,o]of Object.entries(a.topics))try{s(o)}catch(l){throw U(new Error(`invalid score parameters for topic ${c}: ${l.message}`),Ce.ERR_INVALID_PEER_SCORE_PARAMS)}if(a.topicScoreCap<0)throw U(new Error("invalid topic score cap; must be positive (or 0 for no cap)"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.appSpecificScore===null||a.appSpecificScore===void 0)throw U(new Error("missing application specific score function"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.IPColocationFactorWeight>0)throw U(new Error("invalid IPColocationFactorWeight; must be negative (or 0 to disable)"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.IPColocationFactorWeight!==0&&a.IPColocationFactorThreshold<1)throw U(new Error("invalid IPColocationFactorThreshold; must be at least 1"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.behaviourPenaltyWeight>0)throw U(new Error("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.behaviourPenaltyWeight!==0&&(a.behaviourPenaltyDecay<=0||a.behaviourPenaltyDecay>=1))throw U(new Error("invalid BehaviourPenaltyDecay; must be between 0 and 1"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.decayInterval<1e3)throw U(new Error("invalid DecayInterval; must be at least 1s"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.decayToZero<=0||a.decayToZero>=1)throw U(new Error("invalid DecayToZero; must be between 0 and 1"),Ce.ERR_INVALID_PEER_SCORE_PARAMS)}e.validatePeerScoreParams=i;function s(a){if(a.topicWeight<0)throw U(new Error("invalid topic weight; must be >= 0"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.timeInMeshQuantum===0)throw U(new Error("invalid TimeInMeshQuantum; must be non zero"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.timeInMeshWeight<0)throw U(new Error("invalid TimeInMeshWeight; must be positive (or 0 to disable)"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.timeInMeshWeight!==0&&a.timeInMeshQuantum<=0)throw U(new Error("invalid TimeInMeshQuantum; must be positive"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.timeInMeshWeight!==0&&a.timeInMeshCap<=0)throw U(new Error("invalid TimeInMeshCap; must be positive"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.firstMessageDeliveriesWeight<0)throw U(new Error("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.firstMessageDeliveriesWeight!==0&&(a.firstMessageDeliveriesDecay<=0||a.firstMessageDeliveriesDecay>=1))throw U(new Error("invalid FirstMessageDeliveriesDecay; must be between 0 and 1"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.firstMessageDeliveriesWeight!==0&&a.firstMessageDeliveriesCap<=0)throw U(new Error("invalid FirstMessageDeliveriesCap; must be positive"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight>0)throw U(new Error("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight!==0&&(a.meshMessageDeliveriesDecay<=0||a.meshMessageDeliveriesDecay>=1))throw U(new Error("invalid MeshMessageDeliveriesDecay; must be between 0 and 1"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight!==0&&a.meshMessageDeliveriesCap<=0)throw U(new Error("invalid MeshMessageDeliveriesCap; must be positive"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight!==0&&a.meshMessageDeliveriesThreshold<=0)throw U(new Error("invalid MeshMessageDeliveriesThreshold; must be positive"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWindow<0)throw U(new Error("invalid MeshMessageDeliveriesWindow; must be non-negative"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshMessageDeliveriesWeight!==0&&a.meshMessageDeliveriesActivation<1e3)throw U(new Error("invalid MeshMessageDeliveriesActivation; must be at least 1s"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshFailurePenaltyWeight>0)throw U(new Error("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.meshFailurePenaltyWeight!==0&&(a.meshFailurePenaltyDecay<=0||a.meshFailurePenaltyDecay>=1))throw U(new Error("invalid MeshFailurePenaltyDecay; must be between 0 and 1"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.invalidMessageDeliveriesWeight>0)throw U(new Error("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)"),Ce.ERR_INVALID_PEER_SCORE_PARAMS);if(a.invalidMessageDeliveriesDecay<=0||a.invalidMessageDeliveriesDecay>=1)throw U(new Error("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1"),Ce.ERR_INVALID_PEER_SCORE_PARAMS)}e.validateTopicScoreParams=s}),FC=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.validatePeerScoreThresholds=e.createPeerScoreThresholds=e.defaultPeerScoreThresholds=void 0,e.defaultPeerScoreThresholds={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function r(i={}){return Object.assign(Object.assign({},e.defaultPeerScoreThresholds),i)}e.createPeerScoreThresholds=r;function n(i){if(i.gossipThreshold>0)throw U(new Error("invalid gossip threshold; it must be <= 0"),Ce.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.publishThreshold>0||i.publishThreshold>i.gossipThreshold)throw U(new Error("invalid publish threshold; it must be <= 0 and <= gossip threshold"),Ce.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.graylistThreshold>0||i.graylistThreshold>i.publishThreshold)throw U(new Error("invalid graylist threshold; it must be <= 0 and <= publish threshold"),Ce.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.acceptPXThreshold<0)throw U(new Error("invalid accept PX threshold; it must be >= 0"),Ce.ERR_INVALID_PEER_SCORE_THRESHOLDS);if(i.opportunisticGraftThreshold<0)throw U(new Error("invalid opportunistic grafting threshold; it must be >= 0"),Ce.ERR_INVALID_PEER_SCORE_THRESHOLDS)}e.validatePeerScoreThresholds=n}),Wi=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ensureTopicStats=e.createTopicStats=e.createPeerStats=void 0;function r(s={}){return Object.assign(Object.assign({connected:!1,expire:0,ips:[],behaviourPenalty:0},s),{topics:s.topics?Object.entries(s.topics).reduce((a,[c,o])=>(a[c]=n(o),a),{}):{}})}e.createPeerStats=r;function n(s={}){return Object.assign({inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},s)}e.createTopicStats=n;function i(s,a,c){let o=a.topics[s];return o||(c.topics[s]?(a.topics[s]=o=n(),o):void 0)}e.ensureTopicStats=i}),qC=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.computeScore=void 0;function r(n,i,s,a){let c=0;Object.entries(i.topics).forEach(([u,h])=>{const f=s.topics[u];if(!f)return;let p=0;if(h.inMesh){let k=h.meshTime/f.timeInMeshQuantum;k>f.timeInMeshCap&&(k=f.timeInMeshCap),p+=k*f.timeInMeshWeight}const S=h.firstMessageDeliveries;if(p+=S*f.firstMessageDeliveriesWeight,h.meshMessageDeliveriesActive&&h.meshMessageDeliveries<f.meshMessageDeliveriesThreshold){const k=f.meshMessageDeliveriesThreshold-h.meshMessageDeliveries,V=k*k;p+=V*f.meshMessageDeliveriesWeight}const D=h.meshFailurePenalty;p+=D*f.meshFailurePenaltyWeight;const I=h.invalidMessageDeliveries*h.invalidMessageDeliveries;p+=I*f.invalidMessageDeliveriesWeight,c+=p*f.topicWeight}),s.topicScoreCap>0&&c>s.topicScoreCap&&(c=s.topicScoreCap);const o=s.appSpecificScore(n);c+=o*s.appSpecificWeight,i.ips.forEach(u=>{if(s.IPColocationFactorWhitelist.has(u))return;const h=a.get(u),f=h?h.size:0;if(f>s.IPColocationFactorThreshold){const p=f-s.IPColocationFactorThreshold,S=p*p;c+=S*s.IPColocationFactorWeight}});const l=i.behaviourPenalty*i.behaviourPenalty;return c+=l*s.behaviourPenaltyWeight,c}e.computeScore=r});function Ge(t){this._head=0,this._tail=0,this._capacityMask=3,this._list=new Array(4),Array.isArray(t)&&this._fromArray(t)}Ge.prototype.peekAt=function(e){var r=e;if(r!==(r|0))return;var n=this.size();return r>=n||r<-n?void 0:(r<0&&(r+=n),r=this._head+r&this._capacityMask,this._list[r])},Ge.prototype.get=function(e){return this.peekAt(e)},Ge.prototype.peek=function(){return this._head===this._tail?void 0:this._list[this._head]},Ge.prototype.peekFront=function(){return this.peek()},Ge.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(Ge.prototype,"length",{get:function(){return this.size()}}),Ge.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},Ge.prototype.unshift=function(e){if(e===void 0)return this.size();var r=this._list.length;return this._head=this._head-1+r&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},Ge.prototype.shift=function(){var e=this._head;if(e===this._tail)return;var r=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),r},Ge.prototype.push=function(e){if(e===void 0)return this.size();var r=this._tail;return this._list[r]=e,this._tail=r+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},Ge.prototype.pop=function(){var e=this._tail;if(e===this._head)return;var r=this._list.length;this._tail=e-1+r&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=r>>>2&&this._shrinkArray(),n},Ge.prototype.removeOne=function(e){var r=e;if(r!==(r|0))return;if(this._head===this._tail)return;var n=this.size(),i=this._list.length;if(r>=n||r<-n)return;r<0&&(r+=n),r=this._head+r&this._capacityMask;var s=this._list[r],a;if(e<n/2){for(a=e;a>0;a--)this._list[r]=this._list[r=r-1+i&this._capacityMask];this._list[r]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(a=n-1-e;a>0;a--)this._list[r]=this._list[r=r+1+i&this._capacityMask];this._list[r]=void 0,this._tail=this._tail-1+i&this._capacityMask}return s},Ge.prototype.remove=function(e,r){var n=e,i,s=r;if(n!==(n|0))return;if(this._head===this._tail)return;var a=this.size(),c=this._list.length;if(n>=a||n<-a||r<1)return;if(n<0&&(n+=a),r===1||!r)return i=new Array(1),i[0]=this.removeOne(n),i;if(n===0&&n+r>=a)return i=this.toArray(),this.clear(),i;n+r>a&&(r=a-n);var o;for(i=new Array(r),o=0;o<r;o++)i[o]=this._list[this._head+n+o&this._capacityMask];if(n=this._head+n&this._capacityMask,e+r===a){for(this._tail=this._tail-r+c&this._capacityMask,o=r;o>0;o--)this._list[n=n+1+c&this._capacityMask]=void 0;return i}if(e===0){for(this._head=this._head+r+c&this._capacityMask,o=r-1;o>0;o--)this._list[n=n+1+c&this._capacityMask]=void 0;return i}if(n<a/2){for(this._head=this._head+e+r+c&this._capacityMask,o=e;o>0;o--)this.unshift(this._list[n=n-1+c&this._capacityMask]);for(n=this._head-1+c&this._capacityMask;s>0;)this._list[n=n-1+c&this._capacityMask]=void 0,s--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+r+c&this._capacityMask,o=a-(r+e);o>0;o--)this.push(this._list[n++]);for(n=this._tail;s>0;)this._list[n=n+1+c&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=c>>>2&&this._shrinkArray(),i},Ge.prototype.splice=function(e,r){var n=e;if(n!==(n|0))return;var i=this.size();if(n<0&&(n+=i),n>i)return;if(arguments.length>2){var s,a,c,o=arguments.length,l=this._list.length,u=2;if(!i||n<i/2){for(a=new Array(n),s=0;s<n;s++)a[s]=this._list[this._head+s&this._capacityMask];for(r===0?(c=[],n>0&&(this._head=this._head+n+l&this._capacityMask)):(c=this.remove(n,r),this._head=this._head+n+l&this._capacityMask);o>u;)this.unshift(arguments[--o]);for(s=n;s>0;s--)this.unshift(a[s-1])}else{a=new Array(i-(n+r));var h=a.length;for(s=0;s<h;s++)a[s]=this._list[this._head+n+r+s&this._capacityMask];for(r===0?(c=[],n!=i&&(this._tail=this._head+n+l&this._capacityMask)):(c=this.remove(n,r),this._tail=this._tail-h+l&this._capacityMask);u<o;)this.push(arguments[u++]);for(s=0;s<h;s++)this.push(a[s])}return c}else return this.remove(n,r)},Ge.prototype.clear=function(){this._head=0,this._tail=0},Ge.prototype.isEmpty=function(){return this._head===this._tail},Ge.prototype.toArray=function(){return this._copyArray(!1)},Ge.prototype._fromArray=function(e){for(var r=0;r<e.length;r++)this.push(e[r])},Ge.prototype._copyArray=function(e){var r=[],n=this._list,i=n.length,s;if(e||this._head>this._tail){for(s=this._head;s<i;s++)r.push(n[s]);for(s=0;s<this._tail;s++)r.push(n[s])}else for(s=this._head;s<this._tail;s++)r.push(n[s]);return r},Ge.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length*=2,this._capacityMask=this._capacityMask<<1|1},Ge.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};var GC=Ge,pr=re(function(t,e){var r=ie&&ie.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(e,"__esModule",{value:!0}),e.MessageDeliveries=e.DeliveryRecordStatus=void 0;const n=r(GC);var i;(function(a){a[a.unknown=0]="unknown",a[a.valid=1]="valid",a[a.invalid=2]="invalid",a[a.ignored=3]="ignored"})(i=e.DeliveryRecordStatus||(e.DeliveryRecordStatus={}));class s{constructor(){this.records=new Map,this.queue=new n.default}ensureRecord(a){const c=Ne.messageIdToString(a);let o=this.records.get(c);if(o)return o;o={status:i.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(c,o);const l={msgId:c,expire:Date.now()+ti.TimeCacheDuration};return this.queue.push(l),o}gc(){const a=Date.now();let c=this.queue.peekFront();for(;c&&c.expire<a;)this.records.delete(c.msgId),this.queue.shift(),c=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}e.MessageDeliveries=s}),VC=re(function(t,e){var r=ie&&ie.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(e,"__esModule",{value:!0}),e.PeerScore=void 0;const n=r(pe),{ERR_INVALID_SIGNATURE:i,ERR_MISSING_SIGNATURE:s}=gl.codes,a=Q("libp2p:gossipsub:score");class c{constructor(o,l,u){qp.validatePeerScoreParams(o),this.params=o,this._connectionManager=l,this.peerStats=new Map,this.peerIPs=new Map,this.deliveryRecords=new pr.MessageDeliveries,this.msgId=u}start(){if(this._backgroundInterval){a("Peer score already running");return}this._backgroundInterval=setInterval(()=>this.background(),this.params.decayInterval),a("started")}stop(){if(!this._backgroundInterval){a("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),a("stopped")}background(){this._refreshScores(),this._updateIPs(),this.deliveryRecords.gc()}_refreshScores(){const o=Date.now(),l=this.params.decayToZero;this.peerStats.forEach((u,h)=>{if(!u.connected){o>u.expire&&(this._removeIPs(h,u.ips),this.peerStats.delete(h));return}Object.entries(u.topics).forEach(([f,p])=>{const S=this.params.topics[f];if(!S)return;p.firstMessageDeliveries*=S.firstMessageDeliveriesDecay,p.firstMessageDeliveries<l&&(p.firstMessageDeliveries=0),p.meshMessageDeliveries*=S.meshMessageDeliveriesDecay,p.meshMessageDeliveries<l&&(p.meshMessageDeliveries=0),p.meshFailurePenalty*=S.meshFailurePenaltyDecay,p.meshFailurePenalty<l&&(p.meshFailurePenalty=0),p.invalidMessageDeliveries*=S.invalidMessageDeliveriesDecay,p.invalidMessageDeliveries<l&&(p.invalidMessageDeliveries=0),p.inMesh&&(p.meshTime=o-p.graftTime,p.meshTime>S.meshMessageDeliveriesActivation&&(p.meshMessageDeliveriesActive=!0))}),u.behaviourPenalty*=this.params.behaviourPenaltyDecay,u.behaviourPenalty<l&&(u.behaviourPenalty=0)})}score(o){const l=this.peerStats.get(o);return l?qC.computeScore(o,l,this.params,this.peerIPs):0}addPenalty(o,l){const u=this.peerStats.get(o);if(!u)return;u.behaviourPenalty+=l}addPeer(o){const l=Wi.createPeerStats({connected:!0});this.peerStats.set(o,l);const u=this._getIPs(o);this._setIPs(o,u,l.ips),l.ips=u}removePeer(o){const l=this.peerStats.get(o);if(!l)return;if(this.score(o)>0){this._removeIPs(o,l.ips),this.peerStats.delete(o);return}Object.entries(l.topics).forEach(([u,h])=>{h.firstMessageDeliveries=0;const f=this.params.topics[u].meshMessageDeliveriesThreshold;if(h.inMesh&&h.meshMessageDeliveriesActive&&h.meshMessageDeliveries<f){const p=f-h.meshMessageDeliveries;h.meshFailurePenalty+=p*p}h.inMesh=!1}),l.connected=!1,l.expire=Date.now()+this.params.retainScore}graft(o,l){const u=this.peerStats.get(o);if(!u)return;const h=Wi.ensureTopicStats(l,u,this.params);if(!h)return;h.inMesh=!0,h.graftTime=Date.now(),h.meshTime=0,h.meshMessageDeliveriesActive=!1}prune(o,l){const u=this.peerStats.get(o);if(!u)return;const h=Wi.ensureTopicStats(l,u,this.params);if(!h)return;const f=this.params.topics[l].meshMessageDeliveriesThreshold;if(h.meshMessageDeliveriesActive&&h.meshMessageDeliveries<f){const p=f-h.meshMessageDeliveries;h.meshFailurePenalty+=p*p}h.inMesh=!1}validateMessage(o){this.deliveryRecords.ensureRecord(this.msgId(o))}deliverMessage(o){const l=o.receivedFrom;this._markFirstMessageDelivery(l,o);const u=this.deliveryRecords.ensureRecord(this.msgId(o)),h=Date.now();if(u.status!==pr.DeliveryRecordStatus.unknown){a("unexpected delivery: message from %s was first seen %s ago and has delivery status %d",l,h-u.firstSeen,pr.DeliveryRecordStatus[u.status]);return}u.status=pr.DeliveryRecordStatus.valid,u.validated=h,u.peers.forEach(f=>{f!==l&&this._markDuplicateMessageDelivery(f,o)})}rejectMessage(o,l){const u=o.receivedFrom;switch(l){case s:case i:this._markInvalidMessageDelivery(u,o);return}const h=this.deliveryRecords.ensureRecord(this.msgId(o));if(h.status!==pr.DeliveryRecordStatus.unknown){a("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",u,Date.now()-h.firstSeen,pr.DeliveryRecordStatus[h.status]);return}switch(l){case ti.ERR_TOPIC_VALIDATOR_IGNORE:h.status=pr.DeliveryRecordStatus.ignored;return}h.status=pr.DeliveryRecordStatus.invalid,this._markInvalidMessageDelivery(u,o),h.peers.forEach(f=>{this._markInvalidMessageDelivery(f,o)})}duplicateMessage(o){const l=o.receivedFrom,u=this.deliveryRecords.ensureRecord(this.msgId(o));if(u.peers.has(l))return;switch(u.status){case pr.DeliveryRecordStatus.unknown:u.peers.add(l);break;case pr.DeliveryRecordStatus.valid:u.peers.add(l),this._markDuplicateMessageDelivery(l,o,u.validated);break;case pr.DeliveryRecordStatus.invalid:this._markInvalidMessageDelivery(l,o);break}}_markInvalidMessageDelivery(o,l){const u=this.peerStats.get(o);if(!u)return;l.topicIDs.forEach(h=>{const f=Wi.ensureTopicStats(h,u,this.params);if(!f)return;f.invalidMessageDeliveries+=1})}_markFirstMessageDelivery(o,l){const u=this.peerStats.get(o);if(!u)return;l.topicIDs.forEach(h=>{const f=Wi.ensureTopicStats(h,u,this.params);if(!f)return;let p=this.params.topics[h].firstMessageDeliveriesCap;if(f.firstMessageDeliveries+=1,f.firstMessageDeliveries>p&&(f.firstMessageDeliveries=p),!f.inMesh)return;p=this.params.topics[h].meshMessageDeliveriesCap,f.meshMessageDeliveries+=1,f.meshMessageDeliveries>p&&(f.meshMessageDeliveries=p)})}_markDuplicateMessageDelivery(o,l,u=0){const h=this.peerStats.get(o);if(!h)return;const f=u?Date.now():0;l.topicIDs.forEach(p=>{const S=Wi.ensureTopicStats(p,h,this.params);if(!S)return;if(!S.inMesh)return;const D=this.params.topics[p];if(u&&f>u+D.meshMessageDeliveriesWindow)return;const I=D.meshMessageDeliveriesCap;S.meshMessageDeliveries+=1,S.meshMessageDeliveries>I&&(S.meshMessageDeliveries=I)})}_getIPs(o){return this._connectionManager.getAll(n.default.createFromB58String(o)).map(l=>l.remoteAddr.toOptions().host)}_setIPs(o,l,u){e:for(const h of l){for(const p of u)if(h===p)continue e;let f=this.peerIPs.get(h);f||(f=new Set,this.peerIPs.set(h,f)),f.add(o)}e:for(const h of u){for(const p of l)if(h===p)continue e;const f=this.peerIPs.get(h);if(!f)continue;f.delete(o),f.size||this.peerIPs.delete(h)}}_removeIPs(o,l){l.forEach(u=>{const h=this.peerIPs.get(u);if(!h)return;h.delete(o),h.size||this.peerIPs.delete(u)})}_updateIPs(){this.peerStats.forEach((o,l)=>{const u=this._getIPs(l);this._setIPs(l,u,o.ips),o.ips=u})}}e.PeerScore=c}),vl=re(function(t,e){var r=ie&&ie.__createBinding||(Object.create?function(i,s,a,c){c===void 0&&(c=a),Object.defineProperty(i,c,{enumerable:!0,get:function(){return s[a]}})}:function(i,s,a,c){c===void 0&&(c=a),i[c]=s[a]}),n=ie&&ie.__exportStar||function(i,s){for(var a in i)a!=="default"&&!s.hasOwnProperty(a)&&r(s,i,a)};Object.defineProperty(e,"__esModule",{value:!0}),n(qp,e),n(FC,e),n(VC,e)}),$C=re(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.IWantTracer=void 0;const{ERR_INVALID_SIGNATURE:r,ERR_MISSING_SIGNATURE:n}=gl.codes;class i{constructor(s){this.getMsgId=s,this.promises=new Map}addPromise(s,a){const c=Math.floor(Math.random()*a.length),o=a[c],l=Ne.messageIdToString(o);let u=this.promises.get(l);u||(u=new Map,this.promises.set(l,u)),u.has(s)||u.set(s,Date.now()+ti.GossipsubIWantFollowupTime)}getBrokenPromises(){const s=Date.now(),a=new Map;return this.promises.forEach((c,o)=>{c.forEach((l,u)=>{l<s&&(a.set(u,(a.get(u)||0)+1),c.delete(u))}),c.size||this.promises.delete(o)}),a}deliverMessage(s){const a=this.getMsgId(s),c=Ne.messageIdToString(a);this.promises.delete(c)}rejectMessage(s,a){switch(a){case r:case n:return}const c=this.getMsgId(s),o=Ne.messageIdToString(c);this.promises.delete(o)}clear(){this.promises.clear()}}e.IWantTracer=i}),Gp="Expected a function",Vp=0/0,HC="[object Symbol]",zC=/^\s+|\s+$/g,KC=/^[-+]0x[0-9a-f]+$/i,WC=/^0b[01]+$/i,XC=/^0o[0-7]+$/i,QC=parseInt,YC=typeof ie=="object"&&ie&&ie.Object===Object&&ie,JC=typeof self=="object"&&self&&self.Object===Object&&self,ZC=YC||JC||Function("return this")(),eI=Object.prototype,tI=eI.toString,rI=Math.max,nI=Math.min,wl=function(){return ZC.Date.now()};function iI(t,e,r){var n,i,s,a,c,o,l=0,u=!1,h=!1,f=!0;if(typeof t!="function")throw new TypeError(Gp);e=$p(e)||0,ho(r)&&(u=!!r.leading,h="maxWait"in r,s=h?rI($p(r.maxWait)||0,e):s,f="trailing"in r?!!r.trailing:f);function p(A){var d=n,g=i;return n=i=void 0,l=A,a=t.apply(g,d),a}function S(A){return l=A,c=setTimeout(k,e),u?p(A):a}function D(A){var d=A-o,g=A-l,E=e-d;return h?nI(E,s-g):E}function I(A){var d=A-o,g=A-l;return o===void 0||d>=e||d<0||h&&g>=s}function k(){var A=wl();if(I(A))return V(A);c=setTimeout(k,D(A))}function V(A){return c=void 0,f&&n?p(A):(n=i=void 0,a)}function H(){c!==void 0&&clearTimeout(c),l=0,n=o=i=c=void 0}function v(){return c===void 0?a:V(wl())}function _(){var A=wl(),d=I(A);if(n=arguments,i=this,o=A,d){if(c===void 0)return S(o);if(h)return c=setTimeout(k,e),p(o)}return c===void 0&&(c=setTimeout(k,e)),a}return _.cancel=H,_.flush=v,_}function sI(t,e,r){var n=!0,i=!0;if(typeof t!="function")throw new TypeError(Gp);return ho(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),iI(t,e,{leading:n,maxWait:e,trailing:i})}function ho(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function aI(t){return!!t&&typeof t=="object"}function oI(t){return typeof t=="symbol"||aI(t)&&tI.call(t)==HC}function $p(t){if(typeof t=="number")return t;if(oI(t))return Vp;if(ho(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=ho(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(zC,"");var r=WC.test(t);return r||XC.test(t)?QC(t.slice(2),r?2:8):KC.test(t)?Vp:+t}var cI=sI,lI=re(function(t,e){e=t.exports=r;function r(i){if(!(this instanceof r))return new r(i);i=i||{};const s=i.validity||30,a=new Map,c=cI(()=>{a.forEach((o,l)=>{const u=o.validity||s,h=n(o.timestamp);h>u&&a.delete(l)})},200);this.put=(o,l,u)=>{this.has(o)||a.set(o,{value:l,timestamp:new Date,validity:u}),c()},this.get=o=>{if(a.has(o))return a.get(o).value;throw new Error("key does not exist")},this.has=o=>a.has(o)}function n(i){const s=new Date,a=s.getTime()-i.getTime();return Math.floor(a/1e3)}}),uI=re(function(t){var e=ie&&ie.__createBinding||(Object.create?function(o,l,u,h){h===void 0&&(h=u),Object.defineProperty(o,h,{enumerable:!0,get:function(){return l[u]}})}:function(o,l,u,h){h===void 0&&(h=u),o[h]=l[u]}),r=ie&&ie.__setModuleDefault||(Object.create?function(o,l){Object.defineProperty(o,"default",{enumerable:!0,value:l})}:function(o,l){o.default=l}),n=ie&&ie.__importStar||function(o){if(o&&o.__esModule)return o;var l={};if(o!=null)for(var u in o)u!=="default"&&Object.hasOwnProperty.call(o,u)&&e(l,o,u);return r(l,o),l},i=ie&&ie.__awaiter||function(o,l,u,h){function f(p){return p instanceof u?p:new u(function(S){S(p)})}return new(u||(u=Promise))(function(p,S){function D(V){try{k(h.next(V))}catch(H){S(H)}}function I(V){try{k(h.throw(V))}catch(H){S(H)}}function k(V){V.done?p(V.value):f(V.value).then(D,I)}k((h=h.apply(o,l||[])).next())})};const s=n(uo),a=n(ti);class c extends s.default{constructor(o,l={}){const u=[a.GossipsubIDv11,a.GossipsubIDv10],h=Object.assign(Object.assign({gossipIncoming:!0,fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:a.GossipsubD,Dlo:a.GossipsubDlo,Dhi:a.GossipsubDhi,Dscore:a.GossipsubDscore,Dout:a.GossipsubDout,Dlazy:a.GossipsubDlazy},l),{scoreParams:vl.createPeerScoreParams(l.scoreParams),scoreThresholds:vl.createPeerScoreThresholds(l.scoreThresholds)});h.fallbackToFloodsub&&u.push(a.FloodsubID),super(Object.assign({debugName:"libp2p:gossipsub",multicodecs:u,libp2p:o},h)),this._options=h,this.direct=new Set(h.directPeers.map(f=>f.id.toB58String())),h.directPeers.forEach(f=>{o.peerStore.addressBook.add(f.id,f.addrs)}),this.seenCache=new lI,this.mesh=new Map,this.fanout=new Map,this.lastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.messageCache=l.messageCache||new jC.MessageCache(a.GossipsubHistoryGossip,a.GossipsubHistoryLength,this.getMsgId.bind(this)),this.heartbeat=new UC.Heartbeat(this),this.heartbeatTicks=0,this.gossipTracer=new $C.IWantTracer(this.getMsgId.bind(this)),this._libp2p=o,this.score=new vl.PeerScore(this._options.scoreParams,o.connectionManager,this.getMsgId.bind(this))}_decodeRpc(o){return yl.RPCCodec.decode(o)}_encodeRpc(o){return yl.RPCCodec.encode(o)}_addPeer(o,l){const u=super._addPeer(o,l);this.score.addPeer(o.toB58String());let h=!1;for(const f of this._libp2p.connectionManager.getAll(o))if(f.stat.direction==="outbound"&&Array.from(f.registry.values()).some(p=>l===p.protocol)){h=!0;break}return this.outbound.set(u.id.toB58String(),h),u}_removePeer(o){const l=super._removePeer(o),u=o.toB58String();for(const h of this.mesh.values())h.delete(u);for(const h of this.fanout.values())h.delete(u);return this.gossip.delete(u),this.control.delete(u),this.outbound.delete(u),this.score.removePeer(u),l}_processRpc(o,l,u){return super._processRpc(o,l,u)?(u.control&&this._processRpcControlMessage(o,u.control),!0):!1}_processRpcControlMessage(o,l){if(!l)return;const u=this._handleIHave(o,l.ihave),h=this._handleIWant(o,l.iwant),f=this._handleGraft(o,l.graft);if(this._handlePrune(o,l.prune),!u.length&&!h.length&&!f.length)return;const p=Ne.createGossipRpc(h,{iwant:u,prune:f});this._sendRpc(o,p)}_processRpcMessage(o){const l=Object.create(null,{_processRpcMessage:{get:()=>super._processRpcMessage}});return i(this,void 0,void 0,function*(){const u=this.getMsgId(o),h=Ne.messageIdToString(u);if(this.seenCache.has(h)){this.score.duplicateMessage(o);return}this.seenCache.put(h),this.score.validateMessage(o),yield l._processRpcMessage.call(this,o)})}_acceptFrom(o){return this.direct.has(o)||this.score.score(o)>=this._options.scoreThresholds.graylistThreshold}validate(o){const l=Object.create(null,{validate:{get:()=>super.validate}});return i(this,void 0,void 0,function*(){try{yield l.validate.call(this,o)}catch(u){throw this.score.rejectMessage(o,u.code),this.gossipTracer.rejectMessage(o,u.code),u}})}_handleIHave(o,l){if(!l.length)return[];const u=this.score.score(o);if(u<this._options.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",o,u),[];const h=(this.peerhave.get(o)||0)+1;if(this.peerhave.set(o,h),h>a.GossipsubMaxIHaveMessages)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",o,h),[];const f=this.iasked.get(o)||0;if(f>=a.GossipsubMaxIHaveLength)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",o,f),[];const p=new Map;if(l.forEach(({topicID:I,messageIDs:k})=>{if(!I||!this.mesh.has(I))return;k.forEach(V=>{const H=Ne.messageIdToString(V);if(this.seenCache.has(H))return;p.set(H,V)})}),!p.size)return[];let S=p.size;S+f>a.GossipsubMaxIHaveLength&&(S=a.GossipsubMaxIHaveLength-f),this.log("IHAVE: Asking for %d out of %d messages from %s",S,p.size,o);let D=Array.from(p.values());return Ne.shuffle(D),D=D.slice(0,S),this.iasked.set(o,f+S),this.gossipTracer.addPromise(o,D),[{messageIDs:D}]}_handleIWant(o,l){if(!l.length)return[];const u=this.score.score(o);if(u<this._options.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",o,u),[];const h=new Map;return l.forEach(({messageIDs:f})=>{f.forEach(p=>{const[S,D]=this.messageCache.getForPeer(p,o);if(!S)return;if(D>a.GossipsubGossipRetransmission){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",o,p);return}h.set(Ne.messageIdToString(p),S)})}),h.size?(this.log("IWANT: Sending %d messages to %s",h.size,o),Array.from(h.values()).map(s.utils.normalizeOutRpcMessage)):[]}_handleGraft(o,l){const u=[],h=this.score.score(o),f=this._now();let p=this._options.doPX;return l.forEach(({topicID:S})=>{var D;if(!S)return;const I=this.mesh.get(S);if(!I){p=!1;return}if(I.has(o))return;if(this.direct.has(o)){this.log("GRAFT: ignoring request from direct peer %s",o),u.push(S),p=!1;return}const k=(D=this.backoff.get(S))===null||D===void 0?void 0:D.get(o);if(typeof k=="number"&&f<k){this.log("GRAFT: ignoring backed off peer %s",o),this.score.addPenalty(o,1),p=!1;const V=k+a.GossipsubGraftFloodThreshold-a.GossipsubPruneBackoff;f<V&&this.score.addPenalty(o,1),this._addBackoff(o,S),u.push(S);return}if(h<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",o,h,S),u.push(S),p=!1,this._addBackoff(o,S);return}if(I.size>=this._options.Dhi&&!this.outbound.get(o)){u.push(S),this._addBackoff(o,S);return}this.log("GRAFT: Add mesh link from %s in %s",o,S),this.score.graft(o,S),I.add(o)}),u.length?u.map(S=>this._makePrune(o,S,p)):[]}_handlePrune(o,l){const u=this.score.score(o);l.forEach(({topicID:h,backoff:f,peers:p})=>{if(!h)return;const S=this.mesh.get(h);if(!S)return;if(this.log("PRUNE: Remove mesh link to %s in %s",o,h),this.score.prune(o,h),S.delete(o),typeof f=="number"&&f>0?this._doAddBackoff(o,h,f*1e3):this._addBackoff(o,h),p&&p.length){if(u<this._options.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",o,u,h);return}this._pxConnect(p)}})}_addBackoff(o,l){this._doAddBackoff(o,l,a.GossipsubPruneBackoff)}_doAddBackoff(o,l,u){let h=this.backoff.get(l);h||(h=new Map,this.backoff.set(l,h));const f=this._now()+u,p=h.get(o)||0;p<f&&h.set(o,f)}_applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((o,l)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",l,o),this.score.addPenalty(l,o)})}_clearBackoff(){if(this.heartbeatTicks%a.GossipsubPruneBackoffTicks!==0)return;const o=this._now();this.backoff.forEach((l,u)=>{l.forEach((h,f)=>{h<o&&l.delete(f)}),l.size===0&&this.backoff.delete(u)})}_directConnect(){if(this.heartbeatTicks%a.GossipsubDirectConnectTicks!==0)return;const o=[];this.direct.forEach(l=>{const u=this.peers.get(l);(!u||!u.isWritable)&&o.push(l)}),o.length&&o.forEach(l=>{this._connect(l)})}_pxConnect(o){return i(this,void 0,void 0,function*(){o.length>a.GossipsubPrunePeers&&(Ne.shuffle(o),o=o.slice(0,a.GossipsubPrunePeers));const l=[];if(yield Promise.all(o.map(u=>i(this,void 0,void 0,function*(){if(!u.peerID)return;const h=pe.createFromBytes(u.peerID),f=h.toB58String();if(this.peers.has(f))return;if(!u.signedPeerRecord){l.push(f);return}try{const p=yield Us.openAndCertify(u.signedPeerRecord,"libp2p-peer-record"),S=p.peerId.toB58String();if(f!==S){this.log("bogus peer record obtained through px: peer ID %s doesn't match expected peer %s",S,f);return}if(!this._libp2p.peerStore.addressBook.consumePeerRecord(p)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}l.push(f)}catch(p){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}))),!l.length)return;l.forEach(u=>this._connect(u))})}start(){super.start(),this.heartbeat.start(),this.score.start(),this._directPeerInitial=setTimeout(()=>{this.direct.forEach(o=>{this._connect(o)})},a.GossipsubDirectConnectInitialDelay)}stop(){super.stop(),this.heartbeat.stop(),this.score.stop(),this.mesh=new Map,this.fanout=new Map,this.lastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.gossipTracer.clear(),clearTimeout(this._directPeerInitial)}_connect(o){this.log("Initiating connection with %s",o),this._libp2p.dialProtocol(pe.createFromB58String(o),this.multicodecs)}subscribe(o){super.subscribe(o),this.join(o)}unsubscribe(o){super.unsubscribe(o),this.leave(o)}join(o){if(!this.started)throw new Error("Gossipsub has not started");this.log("JOIN %s",o);const l=this.fanout.get(o);if(l)l.forEach(u=>{this.score.score(u)<0&&l.delete(u)}),l.size<this._options.D&&wn.getGossipPeers(this,o,this._options.D-l.size,u=>!l.has(u)&&!this.direct.has(u)&&this.score.score(u)>=0).forEach(u=>l.add(u)),this.mesh.set(o,l),this.fanout.delete(o),this.lastpub.delete(o);else{const u=wn.getGossipPeers(this,o,this._options.D,h=>!this.direct.has(h)&&this.score.score(h)>=0);this.mesh.set(o,u)}this.mesh.get(o).forEach(u=>{this.log("JOIN: Add mesh link to %s in %s",u,o),this._sendGraft(u,o)})}leave(o){if(!this.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",o);const l=this.mesh.get(o);l&&(l.forEach(u=>{this.log("LEAVE: Remove mesh link to %s in %s",u,o),this._sendPrune(u,o)}),this.mesh.delete(o))}_publish(o){return i(this,void 0,void 0,function*(){o.receivedFrom!==this.peerId.toB58String()&&(this.score.deliverMessage(o),this.gossipTracer.deliverMessage(o));const l=this.getMsgId(o),u=Ne.messageIdToString(l);this.seenCache.put(u),this.messageCache.put(o);const h=new Set;o.topicIDs.forEach(p=>{const S=this.topics.get(p);if(!S)return;if(this._options.floodPublish&&o.from===this.peerId.toB58String())S.forEach(D=>{(this.direct.has(D)||this.score.score(D)>=this._options.scoreThresholds.publishThreshold)&&h.add(D)});else{this.direct.forEach(I=>{h.add(I)}),S.forEach(I=>{const k=this.score.score(I),V=this.peers.get(I);if(!V)return;V.protocol===a.FloodsubID&&k>=this._options.scoreThresholds.publishThreshold&&h.add(I)});let D=this.mesh.get(p);if(!D||!D.size){if(D=this.fanout.get(p),!D){const I=wn.getGossipPeers(this,p,this._options.D,k=>this.score.score(k)>=this._options.scoreThresholds.publishThreshold);I.size>0?(D=I,this.fanout.set(p,I)):D=new Set}this.lastpub.set(p,this._now())}D.forEach(I=>{h.add(I)})}});const f=Ne.createGossipRpc([s.utils.normalizeOutRpcMessage(o)]);h.forEach(p=>{if(p===o.from)return;this._sendRpc(p,f)})})}_sendGraft(o,l){const u=[{topicID:l}],h=Ne.createGossipRpc([],{graft:u});this._sendRpc(o,h)}_sendPrune(o,l){const u=[this._makePrune(o,l,this._options.doPX)],h=Ne.createGossipRpc([],{prune:u});this._sendRpc(o,h)}_sendRpc(o,l){const u=this.peers.get(o);if(!u||!u.isWritable)return;const h=this.control.get(o);h&&(this._piggybackControl(o,l,h),this.control.delete(o));const f=this.gossip.get(o);f&&(this._piggybackGossip(o,l,f),this.gossip.delete(o)),u.write(yl.RPCCodec.encode(l))}_piggybackControl(o,l,u){const h=(u.graft||[]).filter(({topicID:p})=>(p&&this.mesh.get(p)||new Set).has(o)),f=(u.prune||[]).filter(({topicID:p})=>!(p&&this.mesh.get(p)||new Set).has(o));if(!h.length&&!f.length)return;l.control?(l.control.graft=l.control.graft.concat(h),l.control.prune=l.control.prune.concat(f)):l.control={ihave:[],iwant:[],graft:h,prune:f}}_piggybackGossip(o,l,u){l.control||(l.control={ihave:[],iwant:[],graft:[],prune:[]}),l.control.ihave=u}_sendGraftPrune(o,l,u){const h=this._options.doPX;for(const[f,p]of o){const S=p.map(V=>({topicID:V}));let D=[];const I=l.get(f);I&&(D=I.map(V=>this._makePrune(f,V,h&&!u.get(f))),l.delete(f));const k=Ne.createGossipRpc([],{graft:S,prune:D});this._sendRpc(f,k)}for(const[f,p]of l){const S=p.map(I=>this._makePrune(f,I,h&&!u.get(f))),D=Ne.createGossipRpc([],{prune:S});this._sendRpc(f,D)}}_emitGossip(o,l){const u=this.messageCache.getGossipIDs(o);if(!u.length)return;Ne.shuffle(u),u.length>a.GossipsubMaxIHaveLength&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",u.length);const h=[],f=this.topics.get(o);if(!f)return;f.forEach(D=>{const I=this.peers.get(D);if(!I)return;!l.has(D)&&!this.direct.has(D)&&Ne.hasGossipProtocol(I.protocol)&&this.score.score(D)>=this._options.scoreThresholds.gossipThreshold&&h.push(D)});let p=this._options.Dlazy;const S=a.GossipsubGossipFactor*h.length;S>p&&(p=S),p>h.length?p=h.length:Ne.shuffle(h),h.slice(0,p).forEach(D=>{let I=u;u.length>a.GossipsubMaxIHaveLength&&(I=Ne.shuffle(I.slice()).slice(0,a.GossipsubMaxIHaveLength)),this._pushGossip(D,{topicID:o,messageIDs:I})})}_flush(){for(const[o,l]of this.gossip.entries()){this.gossip.delete(o);const u=Ne.createGossipRpc([],{ihave:l});this._sendRpc(o,u)}for(const[o,l]of this.control.entries()){this.control.delete(o);const u=Ne.createGossipRpc([],{graft:l.graft,prune:l.prune});this._sendRpc(o,u)}}_pushGossip(o,l){this.log("Add gossip to %s",o);const u=this.gossip.get(o)||[];this.gossip.set(o,u.concat(l))}_now(){return Date.now()}_makePrune(o,l,u){if(this.peers.get(o).protocol===a.GossipsubIDv10)return{topicID:l,peers:[]};const h=a.GossipsubPruneBackoff/1e3,f=[];if(u){const p=wn.getGossipPeers(this,l,a.GossipsubPrunePeers,S=>S!==o&&this.score.score(S)>=0);p.forEach(S=>{const D=pe.createFromB58String(S);f.push({peerID:D.toBytes(),signedPeerRecord:this._libp2p.peerStore.addressBook.getRawEnvelope(D)})})}return{topicID:l,peers:f,backoff:h}}}c.multicodec=a.GossipsubIDv11,t.exports=c}),dI=sf(uI),hI=window.MediaStream,pI=window.MediaStreamTrack,fI=window.RTCDataChannel,mI=window.RTCDataChannelEvent,gI=window.RTCDtlsTransport,bI=window.RTCIceCandidate,yI=window.RTCIceTransport,vI=window.RTCPeerConnection,wI=window.RTCPeerConnectionIceEvent,_I=window.RTCRtpReceiver,EI=window.RTCRtpSender,SI=window.RTCRtpTransceiver,TI=window.RTCSctpTransport,AI=window.RTCSessionDescription,CI=window.getUserMedia,II=navigator.mediaDevices,RI={MediaStream:hI,MediaStreamTrack:pI,RTCDataChannel:fI,RTCDataChannelEvent:mI,RTCDtlsTransport:gI,RTCIceCandidate:bI,RTCIceTransport:yI,RTCPeerConnection:vI,RTCPeerConnectionIceEvent:wI,RTCRtpReceiver:_I,RTCRtpSender:EI,RTCRtpTransceiver:SI,RTCSctpTransport:TI,RTCSessionDescription:AI,getUserMedia:CI,mediaDevices:II};function Hp(){return{addresses:{listen:["/dns4/floating-retreat-57828.herokuapp.com/tcp/443/wss/p2p-webrtc-star/"]},modules:{transport:[vA,A_,gp],streamMuxer:[jA],connEncryption:[hC],dht:ff,pubsub:dI},config:{transport:{[gp.prototype[Symbol.toStringTag]]:{wrtc:RI}},dht:mf}}}async function kI(t){const e=await $v.create(t||Hp());return await e.start(),e}export default kI;export{Hp as defaultNodeConfig};
