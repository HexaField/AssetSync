import*as i from" https://cdn.skypack.dev/pin/three@v0.123.0-STd7XeVUbImsNuMmqKGL/min/three.js";import{CONJURE_MODE as s}from"../Conjure.js";import h from"./hud/HUDGlobal.js";import n from"./hud/HUDExploreMode.js";import c from"./hud/HUDConjureMode.js";import o from"./ScreenHomeMenu.js";import a from"./ScreenRealmSettings.js";import u from"./ScreenObjectCreate.js";import l from"./ScreenObjectEdit.js";import S from"./ScreenProfile.js";import d from"./ScreenSettings.js";import m from"./ScreenRealms.js";import p from"./ScreenAssets.js";import f from"./ScreenAssetSelect.js";import w from"./ScreenTextureEditor.js";import j from"./ScreenUserInteract.js";import g from"./ScreenServices.js";import E from"./ScreenTextEntry.js";import O from"./ScreenFeatures.js";import b from"./ScreenList.js";export default class H{constructor(e){this.conjure=e,this.domElement=e.renderer.domElement,this.world=e.getWorld(),this.camera=e.camera,this.group=new i.Group,this.conjure.scene.add(this.group),this.hideLastOpenScreen=this.hideLastOpenScreen.bind(this),this.hudGlobal=new h(this,{name:"Global",width:2.75,height:1}),this.hudExplore=new n(this,{name:"Explore",width:2.75,height:1}),this.hudBuild=new c(this,{name:"Conjure",width:2.75,height:1}),this.hudGlobal.showScreen(!1),this.hudExplore.showScreen(!1),this.hudBuild.showScreen(!1),this.lastHudOpen=this.hudGlobal,this.screens=[],this.screenHomeMenu=this.createScreen(new o(this,{name:"Home Menu",width:1,height:1,pauses:!0})),this.screenRealmSettings=this.createScreen(new a(this,{name:"Realm Settings",width:1.5,height:1,pauses:!0})),this.screenObjectCreate=this.createScreen(new u(this,{name:"Create Object",width:.8,height:.4})),this.screenObjectEdit=this.createScreen(new l(this,{name:"Object Edit",width:.8,height:1.6,x:.75,anchor:!0})),this.screenSettings=this.createScreen(new d(this,{name:"Settings",width:1.6,height:.8,pauses:!0})),this.screenProfile=this.createScreen(new S(this,{name:"Profile",width:1.6,height:.8,pauses:!0})),this.screenServices=this.createScreen(new g(this,{name:"Services",width:1.6,height:.8,pauses:!0})),this.screenRealms=this.createScreen(new m(this,{name:"Realms",width:1.5,height:1.5,pauses:!0})),this.screenAssets=this.createScreen(new p(this,{name:"Assets",width:2.4,height:1,pauses:!0})),this.screenAssetSelect=this.createScreen(new f(this,{name:"Assets Select",width:.8,height:1.6})),this.screenTextureEditor=this.createScreen(new w(this,{name:"Edit Texture",width:1.6,height:1.6})),this.screenUserInteract=this.createScreen(new j(this,{name:"User Interact",width:1.5,height:1,pauses:!0})),this.screenFeatures=this.createScreen(new O(this,{name:"Features",width:1.6,height:.8,pauses:!0})),this.screenTextEntry=this.createScreen(new E(this,{name:"Enter Value",width:.8,height:.4})),this.screenList=this.createScreen(new b(this,{name:"Select from list",width:.8,height:1.6})),this.openScreens=[],this.mouseOver=!1,this.conjure.on("conjure:mode",t=>{switch(t){default:break;case s.LOADING:this.hideHud();break;case s.EXPLORE:case s.BUILD:this.showHud();break}})}createScreen(e){return this.screens.push(e),e.showScreen(!1),e}getScreenByName(e){for(let t of this.screens)if(t.screenName===e)return t}getScreenOpen(e){if(typeof e=="string"&&(e=this.getScreenByName(e),!e))return!1;for(let t of this.openScreens)if(e===t)return!0;return!1}isHudOpen(){return this.hudExplore.active||this.hudBuild.active}hideHud(){this.hudExplore.showScreen(!1),this.hudBuild.showScreen(!1)}showHud(){if(this.conjure.conjureMode===s.LOADING){this.hudExplore.showScreen(!1),this.hudBuild.showScreen(!1);return}this.hideAllScreens(),this.conjure.conjureMode===s.EXPLORE&&(this.hudExplore.showScreen(!0),this.hudBuild.showScreen(!1),this.lastHudOpen=this.hudGlobal),this.conjure.conjureMode===s.BUILD&&(this.hudExplore.showScreen(!1),this.hudBuild.showScreen(!0),this.lastHudOpen=this.hudBuild)}showScreen(e,t={}){if(!e)return;if(typeof e=="string"&&(e=this.getScreenByName(e),!e))return;if(this.getScreenOpen(e))return;if(e.pauses){for(let r of this.openScreens)r.showScreen(!1);this.openScreens=[],this.hideHud()}e.showScreen(!0,t)==="cancel"?this.hideScreen(e,t):(e.group.position.z=.1*this.openScreens.length,this.conjure.setConjureMode(s.SCREEN),this.openScreens.push(e))}hideAllScreens(){if(this.openScreens.length===0)return;for(let e of this.openScreens)e.showScreen(!1);this.openScreens=[],this.mouseOver=!1,this.showHud(),this.conjure.setConjureMode(this.lastHudOpen===this.hudBuild?s.BUILD:s.EXPLORE)}hideLastOpenScreen(){if(this.openScreens.length===0)return;this.openScreens[this.openScreens.length-1].showScreen(!1),this.openScreens.splice(this.openScreens.length-1,1),this.openScreens.length===0&&(this.mouseOver=!1,this.showHud(),this.conjure.setConjureMode(this.lastHudOpen===this.hudBuild?s.BUILD:s.EXPLORE))}hideScreen(e,t={}){if(typeof e=="string"&&(e=this.getScreenByName(e),!e))return;if(!e)this.hideAllScreens();else for(let r=0;r<this.openScreens.length;r++)this.openScreens[r]===e&&(e.showScreen(!1,t),this.openScreens.splice(r,1));this.screens.length===0&&this.hideAllScreens()}update(e){e.input.isPressed("HOME")&&!this.conjure.getWorld().getScreensDisabled()&&(this.openScreens.length===0?this.showScreen(this.screenHomeMenu):this.hideLastOpenScreen()),e.input.isPressed("P",!0)&&!this.conjure.getWorld().getScreensDisabled()&&(this.openScreens.length===0&&this.conjure.getWorld().realm&&this.showScreen(this.screenRealmSettings)),this.mouseOver=!1;for(let t of this.openScreens)(!t.pauses||t===this.openScreens[this.openScreens.length-1])&&t.update(e),t.mouseOver&&(this.mouseOver=!0);this.openScreens.length===0&&(this.conjure.conjureMode===s.EXPLORE&&this.hudExplore.update(e),this.conjure.conjureMode===s.BUILD&&this.hudBuild.update(e)),this.hudGlobal.update(e)}resizeScreens(e){for(let t of this.screens)t.resizeScreen(e);this.hudExplore.resizeScreen(e),this.hudBuild.resizeScreen(e),this.hudGlobal.resizeScreen(e)}}
