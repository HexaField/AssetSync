import{e as c}from"./index-4f726977.js";function O(e,{className:t,symbolName:r}){const n=Symbol.for(r),s={[t]:class extends e{constructor(...a){super(...a);Object.defineProperty(this,n,{value:!0})}get[Symbol.toStringTag](){return t}}}[t];return s[`is${t}`]=a=>!!(a&&a[n]),s}function T(e,{className:t,symbolName:r,withoutNew:n}){const s=Symbol.for(r),a={[t]:function(...l){if(n&&!(this instanceof a))return new a(...l);const y=e.call(this,...l)||this;return y&&!y[s]&&Object.defineProperty(y,s,{value:!0}),y}}[t];return a.prototype=Object.create(e.prototype),a.prototype.constructor=a,Object.defineProperty(a.prototype,Symbol.toStringTag,{get(){return t}}),a[`is${t}`]=l=>!!(l&&l[s]),a}var h=O,D=T;h.proto=D;let I="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",w=e=>crypto.getRandomValues(new Uint8Array(e)),v=(e,t,r)=>{let n=(2<<Math.log(e.length-1)/Math.LN2)-1,s=-~(1.6*n*t/e.length);return()=>{let a="";for(;;){let l=r(s),y=s;for(;y--;)if(a+=e[l[y]&n]||"",a.length===+t)return a}}},U=(e,t)=>v(e,t,w),F=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let n=r[e]&63;n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n<63?t+="_":t+="-"}return t};var _=Object.freeze({__proto__:null,nanoid:F,customAlphabet:U,customRandom:v,urlAlphabet:I,random:w});const{nanoid:z}=_,J=(e=t=>t)=>e(z());var W=J;(function(){if(typeof globalThis=="object")return;Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__})();var k=globalThis,N=k.TextEncoder,A=k.TextDecoder,L=new N("utf8"),$=new A("utf8"),q=(e,t)=>async function*(){for await(const r of e){const n=await t(r);if(!n)continue;yield r}}(),B=(e,t)=>async function*(){let r=[];for await(const n of e)r.push(n);r=await t(r);for(const n of r)yield n}(),V=(e,t)=>async function*(){if(t<=0)return;let r=0;for await(const n of e)if(yield n,r++,r>=t)return}(),Z=(e,t)=>async function*(){for await(const r of e)yield t(r)}(),G=function(e,t){const r=new RegExp("^"+t);return e.replace(r,"")},Q=W,p={utf8Encoder:L,utf8Decoder:$,filter:q,sortAll:B,take:V,map:Z,replaceStartWith:G,tmpdir:Q};const{nanoid:Y}=_,{utf8Encoder:K,utf8Decoder:H}=p,o="/",C=K.encode(o),u=C[0];class d{constructor(e,t){if(typeof e=="string")this._buf=K.encode(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==u)throw new Error("Invalid key")}toString(e="utf8"){return e==="utf8"||e==="utf-8"?H.decode(this._buf):new A(e).decode(this._buf)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new i(e.join(o))}static random(){return new i(Y().replace(/-/g,""))}clean(){if((!this._buf||this._buf.byteLength===0)&&(this._buf=C),this._buf[0]!==u){const e=new Uint8Array(this._buf.byteLength+1);e.fill(u,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===u;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let n=0;n<t.length;n++){if(r.length<n+1)return!1;const s=t[n],a=r[n];if(s<a)return!0;if(s>a)return!1}return t.length<r.length}reverse(){return d.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(o).slice(1)}type(){return X(this.baseNamespace())}name(){return ee(this.baseNamespace())}instance(e){return new i(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(o)||(e+=o),e+=this.type(),new i(e)}parent(){const e=this.list();return e.length===1?new i(o):new i(e.slice(0,-1).join(o))}child(e){return this.toString()===o?e:e.toString()===o?this:new i(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return d.withNamespaces([...this.namespaces(),...te(e.map(t=>t.namespaces()))])}}function X(e){const t=e.split(":");return t.length<2?"":t.slice(0,-1).join(":")}function ee(e){const t=e.split(":");return t[t.length-1]}function te(e){return[].concat(...e)}const i=h(d,{className:"Key",symbolName:"@ipfs/interface-datastore/key"});var E=i;const re=async e=>{for await(const t of e);};var S=re;const{filter:f,sortAll:ne,take:ae,map:se}=p;class oe{async open(){}async close(){}async put(e,t,r={}){}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield{key:r,value:n}}async get(e,t={}){}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}async has(e){}async delete(e,t={}){}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(r,n){e.push({key:r,value:n})},delete(r){t.push(r)},commit:async r=>{await S(this.putMany(e,r)),e=[],await S(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){}async*query(e,t){let r=this._all(e,t);if(e.prefix!=null&&(r=f(r,n=>n.key.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(r=e.filters.reduce((n,s)=>f(n,s),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((n,s)=>ne(n,s),r)),e.offset!=null){let n=0;r=f(r,()=>n++>=e.offset)}e.limit!=null&&(r=ae(r,e.limit)),e.keysOnly===!0&&(r=se(r,n=>({key:n.key}))),yield*r}}var x=oe,ie=e=>(e=e||new Error("Cannot open database"),c(e,"ERR_DB_OPEN_FAILED")),le=e=>(e=e||new Error("Delete failed"),c(e,"ERR_DB_DELETE_FAILED")),ye=e=>(e=e||new Error("Write failed"),c(e,"ERR_DB_WRITE_FAILED")),ce=e=>(e=e||new Error("Not Found"),c(e,"ERR_NOT_FOUND")),ue=e=>(e=e||new Error("Aborted"),c(e,"ERR_ABORTED")),R={dbOpenFailedError:ie,dbDeleteFailedError:le,dbWriteFailedError:ye,notFoundError:ce,abortedError:ue};class he extends x{constructor(){super();this.data={}}async put(e,t){this.data[e.toString()]=t}async get(e){const t=await this.has(e);if(!t)throw R.notFoundError();return this.data[e.toString()]}async has(e){return this.data[e.toString()]!==void 0}async delete(e){delete this.data[e.toString()]}*_all(){yield*Object.entries(this.data).map(([e,t])=>({key:new E(e),value:t}))}}var pe=he,m=E,b=pe,j=p,M=R,P=x,g={Key:m,MemoryDatastore:b,utils:j,Errors:M,Adapter:P},de=Object.freeze(Object.assign(Object.create(null),g,{default:g,Key:m,MemoryDatastore:b,utils:j,Errors:M,Adapter:P}));export{m as K,b as M,h as c,de as i,g as s};
