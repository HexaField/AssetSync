import*as r from" https://cdn.skypack.dev/pin/three@v0.123.0-STd7XeVUbImsNuMmqKGL/min/three.js";import{easyPlane as s}from"../../util/MeshTemplates.js";import{number as h}from"../../util/number.js";export default class l{constructor(t,e,i={}){this.width=i.width,this.height=i.height,this.innerWidth=this.width,this.innerHeight=this.height,this.scale=h(i.scale)||1,this._x=h(i.x||0),this.x=this._x*t.aspectRatio,this.y=h(i.y||0),this.z=h(i.z||0),this.anchorX=Boolean(i.anchor),this.screen=t,this.parent=e,this.group=new r.Group,this.vec3=new r.Vector3,this.group.position.set(this.x,this.y,this.z),this.parent.group&&this.parent.group.add(this.group),this.defaultColour=2524671,this.defaultColour2=1993420,this.defaultColour3=1594787,this.defaultOpacity=.75,this.targetBounds=s({width:this.width,height:this.height},{color:16777215}),this.targetBounds.material.visible=!1,this.group.add(this.targetBounds),this.name=i.name||"Element "+t.elements.length,this.active=!0,this.mouseOver=!1,this.down=!1,this.disabled=!1,this.elements=[],this.htmlObjects=[],this.selected=!1,this.userData={}}addHTML(t){this.htmlObjects.push(t),t.show(!1)}destroy(){for(let t=0;t<this.elements.length;t++)this.elements[t].destroy();for(let t=0;t<this.htmlObjects.length;t++)this.screen.screenManager.conjure.sceneCSS.remove(this.htmlObjects[t].objectCSS)}setSelected(t){this.selected=t,t?this.addBorder():this.removeBorder()}registerElement(t){this.elements.push(t)}addBorder(t=.01){this.border=new r.Group,this.border.position.setZ(this.z),this.borderTop=s({width:this.width,height:t},{color:16777215}),this.borderTop.position.setY(this.height/2),this.border.add(this.borderTop),this.borderBottom=s({width:this.width,height:t},{color:16777215}),this.borderBottom.position.setY(-this.height/2),this.border.add(this.borderBottom),this.borderLeft=s({width:t,height:this.height},{color:16777215}),this.borderLeft.position.setX(this.width/2),this.border.add(this.borderLeft),this.borderRight=s({width:t,height:this.height},{color:16777215}),this.borderRight.position.setX(-this.width/2),this.border.add(this.borderRight),this.group.add(this.border)}setHTMLActive(t){for(let e=0;e<this.elements.length;e++)this.elements[e].setHTMLActive(t);for(let e=0;e<this.htmlObjects.length;e++)this.htmlObjects[e].show(t)}setHTMLHidden(t){for(let e=0;e<this.elements.length;e++)this.elements[e].setHTMLHidden(t);for(let e=0;e<this.htmlObjects.length;e++)this.htmlObjects[e].show(!t)}setOnClickCallback(t,e){this.onClickCallbackArgs=e,this.onClickCallback=t}removeBorder(){this.border&&this.group.remove(this.border)}setHidden(t){this.hidden=t,this.group.visible=!t;for(let e=0;e<this.elements.length;e++)this.elements[e].setHidden(t);this.setHTMLHidden(t),t||this.setActive(this.parent.active)}setActive(t){this.active=t,this.hidden&&(this.active=!1),this.group.visible=this.active;for(let e=0;e<this.elements.length;e++)this.elements[e].setActive(this.active);this.setHTMLActive(this.active)}setDisabled(t){this.disabled=t}getAllElements(){let t=[];for(let e of this.elements){for(let i of e.getAllElements())t.push(i);t.push(e)}return t}getElementByName(t){for(let e=0;e<this.elements.length;e++)if(this.elements[e].name===t)return this.elements[e]}removeElementByName(t){for(let e=0;e<this.elements.length;e++)this.elements[e].name===t&&this.elements.splice(e,1)}removeElement(t){for(let e=0;e<this.elements.length;e++)this.elements[e]===t&&this.elements.splice(e,1)}update(t){for(let i=0;i<this.elements.length;i++)this.elements[i].update(t);for(let i=0;i<this.htmlObjects.length;i++)this.htmlObjects[i].update(t);if(this.disabled)return;if(!this.active)return;if(this.hidden)return;let e=t.mouseRaycaster.intersectObject(this.targetBounds,!1);this.hover(this,e.length>0),t.input.isPressed("MOUSELEFT",!0,!0)&&this.click(this,!0),t.input.isReleased("MOUSELEFT",!0,!0)&&this.click(this,!1)}onClick(t){if(this.disabled)return;this.onClickCallback&&this.onClickCallback(this.onClickCallbackArgs)}onClickOutside(t){if(this.disabled)return}onUnClick(t){if(this.disabled)return}onMouseOver(t){if(this.disabled)return}onMouseOut(t){if(this.disabled)return}click(t,e){if(this.disabled)return;if(!this.active)return;e?(this.isClicked=!0,this.mouseOver?this.onClick(t):this.onClickOutside(t)):this.isClicked&&(this.isClicked=!1,this.onUnClick(t))}hover(t,e){if(!this.active)return;e?this.mouseOver||(this.mouseOver=!0,this.onMouseOver(t)):(this.mouseOver=!1,this.onMouseOut(t))}resizeAnchor(t){for(let e of this.elements)e.resizeAnchor(t);if(!this.anchorX)return;this.group.position.setX(this._x*t)}}
