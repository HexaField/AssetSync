import{av as C,au as b,aC as w,at as R,L as p,ay as y}from"../../../../common/three.module-36fff313.js";import{C as d}from"../../../../common/CopyShader-431afdd7.js";import{P as l}from"../../../../common/Pass-c5e1ba23.js";var o=function(e,s,t,a){l.call(this),this.scene=e,this.camera=s,this.sampleLevel=4,this.unbiased=!0,this.clearColor=t!==void 0?t:0,this.clearAlpha=a!==void 0?a:0,d===void 0&&console.error("SSAARenderPass relies on CopyShader");var r=d;this.copyUniforms=C.clone(r.uniforms),this.copyMaterial=new b({uniforms:this.copyUniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:w,depthTest:!1,depthWrite:!1}),this.fsQuad=new l.FullScreenQuad(this.copyMaterial)};o.prototype=Object.assign(Object.create(l.prototype),{constructor:o,dispose:function(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)},setSize:function(e,s){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(e,s)},render:function(e,s,t){this.sampleRenderTarget||(this.sampleRenderTarget=new R(t.width,t.height,{minFilter:p,magFilter:p,format:y}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");var a=o.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))],r=e.autoClear;e.autoClear=!1;var f=e.getClearColor().getHex(),u=e.getClearAlpha(),g=1/a.length,v=1/32;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;for(var n=t.width,h=t.height,i=0;i<a.length;i++){var m=a[i];this.camera.setViewOffset&&this.camera.setViewOffset(n,h,m[0]*.0625,m[1]*.0625,n,h);var c=g;if(this.unbiased){var S=-.5+(i+.5)/a.length;c+=v*S}this.copyUniforms.opacity.value=c,e.setClearColor(this.clearColor,this.clearAlpha),e.setRenderTarget(this.sampleRenderTarget),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.renderToScreen?null:s),i===0&&(e.setClearColor(0,0),e.clear()),this.fsQuad.render(e)}this.camera.clearViewOffset&&this.camera.clearViewOffset(),e.autoClear=r,e.setClearColor(f,u)}}),o.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];export{o as SSAARenderPass};
