import{generateUUID as m}from"../../web_modules/@AssetSync/common.js";export class VideoManager{constructor(o){this.worldSync=o}async createVideo(o){const r="videoStream"+m();let e=document.createElement("video");e.crossOrigin="anonymous",e.loop=!0;const t=new XMLHttpRequest;return t.open("GET",o,!0),t.responseType="blob",t.onload=a=>{if(a.target.status===200&&e){let l=a.target.response,i=URL.createObjectURL(l);e.src=i,e.play(),e.volume=0;const n=e.captureStream();console.log(e,n,n.getVideoTracks());const[d]=n.getVideoTracks(),u=new ImageCapture(d);function c(){u.grabFrame().then(s=>{console.log(r,s),this.worldSync._peerSync.sendEvent({type:r,imageBitmap:s},[s])}),e.requestVideoFrameCallback(c)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(c)}},t.onerror=()=>{console.log("Failed to get video at",o)},t.send(),r}createGif(o){}}
