import{u as d,k as u}from"./key-6d7f3d3d.js";import{e as s}from"./index-4f726977.js";const E=async e=>{for await(const a of e);};var c=E;const{filter:n,sortAll:h,take:_,map:k}=d;class A{async open(){}async close(){}async put(e,a,r={}){}async*putMany(e,a={}){for await(const{key:r,value:t}of e)await this.put(r,t,a),yield{key:r,value:t}}async get(e,a={}){}async*getMany(e,a={}){for await(const r of e)yield this.get(r,a)}async has(e){}async delete(e,a={}){}async*deleteMany(e,a={}){for await(const r of e)await this.delete(r,a),yield r}batch(){let e=[],a=[];return{put(r,t){e.push({key:r,value:t})},delete(r){a.push(r)},commit:async r=>{await c(this.putMany(e,r)),e=[],await c(this.deleteMany(a,r)),a=[]}}}async*_all(e,a){}async*query(e,a){let r=this._all(e,a);if(e.prefix!=null&&(r=n(r,t=>t.key.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(r=e.filters.reduce((t,i)=>n(t,i),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((t,i)=>h(t,i),r)),e.offset!=null){let t=0;r=n(r,()=>t++>=e.offset)}e.limit!=null&&(r=_(r,e.limit)),e.keysOnly===!0&&(r=k(r,t=>({key:t.key}))),yield*r}}var p=A,w=e=>(e=e||new Error("Cannot open database"),s(e,"ERR_DB_OPEN_FAILED")),O=e=>(e=e||new Error("Delete failed"),s(e,"ERR_DB_DELETE_FAILED")),D=e=>(e=e||new Error("Write failed"),s(e,"ERR_DB_WRITE_FAILED")),R=e=>(e=e||new Error("Not Found"),s(e,"ERR_NOT_FOUND")),j=e=>(e=e||new Error("Aborted"),s(e,"ERR_ABORTED")),b={dbOpenFailedError:w,dbDeleteFailedError:O,dbWriteFailedError:D,notFoundError:R,abortedError:j};class I extends p{constructor(){super();this.data={}}async put(e,a){this.data[e.toString()]=a}async get(e){const a=await this.has(e);if(!a)throw b.notFoundError();return this.data[e.toString()]}async has(e){return this.data[e.toString()]!==void 0}async delete(e){delete this.data[e.toString()]}*_all(){yield*Object.entries(this.data).map(([e,a])=>({key:new u(e),value:a}))}}var F=I,o=u,l=F,m=d,f=b,v=p,y={Key:o,MemoryDatastore:l,utils:m,Errors:f,Adapter:v},K=Object.freeze(Object.assign(Object.create(null),y,{default:y,Key:o,MemoryDatastore:l,utils:m,Errors:f,Adapter:v}));export{o as K,l as M,K as i,y as s};
