import{c as gr,a as Ze,b as Yv}from"./_commonjsHelpers-c99fd594.js";var Is=gr(function(mr,kt){Object.defineProperty(kt,"__esModule",{value:!0});var ee=function(v){console.error("%c [enable3d] "+v+" ","background: #222; color: #bada55")};kt.default=ee}),ol=gr(function(mr){var kt=Object.prototype.hasOwnProperty,ee="~";function v(){}Object.create&&(v.prototype=Object.create(null),new v().__proto__||(ee=!1));function f(P,w,T){this.fn=P,this.context=w,this.once=T||!1}function p(P,w,T,C,vt){if(typeof T!="function")throw new TypeError("The listener must be a function");var Tt=new f(T,C||P,vt),Pt=ee?ee+w:w;return P._events[Pt]?P._events[Pt].fn?P._events[Pt]=[P._events[Pt],Tt]:P._events[Pt].push(Tt):(P._events[Pt]=Tt,P._eventsCount++),P}function _(P,w){--P._eventsCount===0?P._events=new v:delete P._events[w]}function E(){this._events=new v,this._eventsCount=0}E.prototype.eventNames=function(){var w=[],T,C;if(this._eventsCount===0)return w;for(C in T=this._events)kt.call(T,C)&&w.push(ee?C.slice(1):C);return Object.getOwnPropertySymbols?w.concat(Object.getOwnPropertySymbols(T)):w},E.prototype.listeners=function(w){var T=ee?ee+w:w,C=this._events[T];if(!C)return[];if(C.fn)return[C.fn];for(var vt=0,Tt=C.length,Pt=new Array(Tt);vt<Tt;vt++)Pt[vt]=C[vt].fn;return Pt},E.prototype.listenerCount=function(w){var T=ee?ee+w:w,C=this._events[T];return C?C.fn?1:C.length:0},E.prototype.emit=function(w,T,C,vt,Tt,Pt){var G=ee?ee+w:w;if(!this._events[G])return!1;var Y=this._events[G],at=arguments.length,ut,x;if(Y.fn){Y.once&&this.removeListener(w,Y.fn,void 0,!0);switch(at){case 1:return Y.fn.call(Y.context),!0;case 2:return Y.fn.call(Y.context,T),!0;case 3:return Y.fn.call(Y.context,T,C),!0;case 4:return Y.fn.call(Y.context,T,C,vt),!0;case 5:return Y.fn.call(Y.context,T,C,vt,Tt),!0;case 6:return Y.fn.call(Y.context,T,C,vt,Tt,Pt),!0}for(x=1,ut=new Array(at-1);x<at;x++)ut[x-1]=arguments[x];Y.fn.apply(Y.context,ut)}else{var S=Y.length,U;for(x=0;x<S;x++){Y[x].once&&this.removeListener(w,Y[x].fn,void 0,!0);switch(at){case 1:Y[x].fn.call(Y[x].context);break;case 2:Y[x].fn.call(Y[x].context,T);break;case 3:Y[x].fn.call(Y[x].context,T,C);break;case 4:Y[x].fn.call(Y[x].context,T,C,vt);break;default:if(!ut)for(U=1,ut=new Array(at-1);U<at;U++)ut[U-1]=arguments[U];Y[x].fn.apply(Y[x].context,ut)}}}return!0},E.prototype.on=function(w,T,C){return p(this,w,T,C,!1)},E.prototype.once=function(w,T,C){return p(this,w,T,C,!0)},E.prototype.removeListener=function(w,T,C,vt){var Tt=ee?ee+w:w;if(!this._events[Tt])return this;if(!T)return _(this,Tt),this;var Pt=this._events[Tt];if(Pt.fn)Pt.fn===T&&(!vt||Pt.once)&&(!C||Pt.context===C)&&_(this,Tt);else{for(var G=0,Y=[],at=Pt.length;G<at;G++)(Pt[G].fn!==T||vt&&!Pt[G].once||C&&Pt[G].context!==C)&&Y.push(Pt[G]);Y.length?this._events[Tt]=Y.length===1?Y[0]:Y:_(this,Tt)}return this},E.prototype.removeAllListeners=function(w){var T;return w?(T=ee?ee+w:w,this._events[T]&&_(this,T)):(this._events=new v,this._eventsCount=0),this},E.prototype.off=E.prototype.removeListener,E.prototype.addListener=E.prototype.on,E.prefixed=ee,E.EventEmitter=E,mr.exports=E}),Jt=gr(function(mr,kt){!function(ee,v){for(var f in v)ee[f]=v[f]}(kt,function(ee){var v={};function f(p){if(v[p])return v[p].exports;var _=v[p]={i:p,l:!1,exports:{}};return ee[p].call(_.exports,_,_.exports,f),_.l=!0,_.exports}return f.m=ee,f.c=v,f.d=function(p,_,E){f.o(p,_)||Object.defineProperty(p,_,{enumerable:!0,get:E})},f.r=function(p){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(p,"__esModule",{value:!0})},f.t=function(p,_){if(1&_&&(p=f(p)),8&_)return p;if(4&_&&typeof p=="object"&&p&&p.__esModule)return p;var E=Object.create(null);if(f.r(E),Object.defineProperty(E,"default",{enumerable:!0,value:p}),2&_&&typeof p!="string")for(var P in p)f.d(E,P,function(w){return p[w]}.bind(null,P));return E},f.n=function(p){var _=p&&p.__esModule?function(){return p.default}:function(){return p};return f.d(_,"a",_),_},f.o=function(p,_){return Object.prototype.hasOwnProperty.call(p,_)},f.p="",f(f.s=1)}([function(ee,v,f){f.r(v),f.d(v,"ACESFilmicToneMapping",function(){return Et}),f.d(v,"AddEquation",function(){return At}),f.d(v,"AddOperation",function(){return W}),f.d(v,"AdditiveAnimationBlendMode",function(){return bl}),f.d(v,"AdditiveBlending",function(){return _t}),f.d(v,"AlphaFormat",function(){return ga}),f.d(v,"AlwaysDepth",function(){return ft}),f.d(v,"AlwaysStencilFunc",function(){return zh}),f.d(v,"AmbientLight",function(){return zc}),f.d(v,"AmbientLightProbe",function(){return Mu}),f.d(v,"AnimationClip",function(){return pn}),f.d(v,"AnimationLoader",function(){return su}),f.d(v,"AnimationMixer",function(){return Ru}),f.d(v,"AnimationObjectGroup",function(){return ep}),f.d(v,"AnimationUtils",function(){return _r}),f.d(v,"ArcCurve",function(){return lo}),f.d(v,"ArrayCamera",function(){return ec}),f.d(v,"ArrowHelper",function(){return ui}),f.d(v,"Audio",function(){return ho}),f.d(v,"AudioAnalyser",function(){return Au}),f.d(v,"AudioContext",function(){return wu}),f.d(v,"AudioListener",function(){return Tu}),f.d(v,"AudioLoader",function(){return Xc}),f.d(v,"AxesHelper",function(){return As}),f.d(v,"AxisHelper",function(){return Cv}),f.d(v,"BackSide",function(){return x}),f.d(v,"BasicDepthPacking",function(){return Bh}),f.d(v,"BasicShadowMap",function(){return Pt}),f.d(v,"BinaryTextureLoader",function(){return Bv}),f.d(v,"Bone",function(){return tu}),f.d(v,"BooleanKeyframeTrack",function(){return Tc}),f.d(v,"BoundingBoxHelper",function(){return Ov}),f.d(v,"Box2",function(){return Du}),f.d(v,"Box3",function(){return Mn}),f.d(v,"Box3Helper",function(){return Ts}),f.d(v,"BoxBufferGeometry",function(){return Go}),f.d(v,"BoxGeometry",function(){return Wl}),f.d(v,"BoxHelper",function(){return li}),f.d(v,"BufferAttribute",function(){return Ie}),f.d(v,"BufferGeometry",function(){return _e}),f.d(v,"BufferGeometryLoader",function(){return jc}),f.d(v,"ByteType",function(){return yr}),f.d(v,"Cache",function(){return aa}),f.d(v,"Camera",function(){return Vn}),f.d(v,"CameraHelper",function(){return Ss}),f.d(v,"CanvasRenderer",function(){return zv}),f.d(v,"CanvasTexture",function(){return Ko}),f.d(v,"CatmullRomCurve3",function(){return jr}),f.d(v,"CineonToneMapping",function(){return Mt}),f.d(v,"CircleBufferGeometry",function(){return ao}),f.d(v,"CircleGeometry",function(){return gs}),f.d(v,"ClampToEdgeWrapping",function(){return B}),f.d(v,"Clock",function(){return Su}),f.d(v,"ClosedSplineCurve3",function(){return _p}),f.d(v,"Color",function(){return we}),f.d(v,"ColorKeyframeTrack",function(){return Ec}),f.d(v,"CompressedTexture",function(){return qa}),f.d(v,"CompressedTextureLoader",function(){return cu}),f.d(v,"ConeBufferGeometry",function(){return vs}),f.d(v,"ConeGeometry",function(){return ms}),f.d(v,"CubeCamera",function(){return Ia}),f.d(v,"CubeGeometry",function(){return Wl}),f.d(v,"CubeReflectionMapping",function(){return wt}),f.d(v,"CubeRefractionMapping",function(){return zt}),f.d(v,"CubeTexture",function(){return ni}),f.d(v,"CubeTextureLoader",function(){return Pc}),f.d(v,"CubeUVReflectionMapping",function(){return d}),f.d(v,"CubeUVRefractionMapping",function(){return b}),f.d(v,"CubicBezierCurve",function(){return Rn}),f.d(v,"CubicBezierCurve3",function(){return Wn}),f.d(v,"CubicInterpolant",function(){return Mc}),f.d(v,"CullFaceBack",function(){return w}),f.d(v,"CullFaceFront",function(){return T}),f.d(v,"CullFaceFrontBack",function(){return C}),f.d(v,"CullFaceNone",function(){return P}),f.d(v,"Curve",function(){return Re}),f.d(v,"CurvePath",function(){return ci}),f.d(v,"CustomBlending",function(){return St}),f.d(v,"CylinderBufferGeometry",function(){return oi}),f.d(v,"CylinderGeometry",function(){return Ki}),f.d(v,"Cylindrical",function(){return ap}),f.d(v,"DataTexture",function(){return ki}),f.d(v,"DataTexture2DArray",function(){return Fa}),f.d(v,"DataTexture3D",function(){return Ua}),f.d(v,"DataTextureLoader",function(){return Rc}),f.d(v,"DecrementStencilOp",function(){return Vp}),f.d(v,"DecrementWrapStencilOp",function(){return Hp}),f.d(v,"DefaultLoadingManager",function(){return Wd}),f.d(v,"DepthFormat",function(){return Ri}),f.d(v,"DepthStencilFormat",function(){return ya}),f.d(v,"DepthTexture",function(){return Qo}),f.d(v,"DirectionalLight",function(){return Uc}),f.d(v,"DirectionalLightHelper",function(){return vo}),f.d(v,"DirectionalLightShadow",function(){return Fc}),f.d(v,"DiscreteInterpolant",function(){return Sc}),f.d(v,"DodecahedronBufferGeometry",function(){return Ka}),f.d(v,"DodecahedronGeometry",function(){return is}),f.d(v,"DoubleSide",function(){return S}),f.d(v,"DstAlphaFactor",function(){return Ue}),f.d(v,"DstColorFactor",function(){return he}),f.d(v,"DynamicBufferAttribute",function(){return wv}),f.d(v,"DynamicCopyUsage",function(){return nf}),f.d(v,"DynamicDrawUsage",function(){return Di}),f.d(v,"DynamicReadUsage",function(){return tf}),f.d(v,"EdgesGeometry",function(){return io}),f.d(v,"EdgesHelper",function(){return Dv}),f.d(v,"EllipseCurve",function(){return un}),f.d(v,"EqualDepth",function(){return J}),f.d(v,"EqualStencilFunc",function(){return Xp}),f.d(v,"EquirectangularReflectionMapping",function(){return bt}),f.d(v,"EquirectangularRefractionMapping",function(){return Xt}),f.d(v,"Euler",function(){return Ii}),f.d(v,"EventDispatcher",function(){return Fn}),f.d(v,"ExtrudeBufferGeometry",function(){return Hn}),f.d(v,"ExtrudeGeometry",function(){return Xi}),f.d(v,"Face3",function(){return La}),f.d(v,"Face4",function(){return ov}),f.d(v,"FaceColors",function(){return uv}),f.d(v,"FileLoader",function(){return fn}),f.d(v,"FlatShading",function(){return U}),f.d(v,"Float32Attribute",function(){return Rv}),f.d(v,"Float32BufferAttribute",function(){return pe}),f.d(v,"Float64Attribute",function(){return Pv}),f.d(v,"Float64BufferAttribute",function(){return Fo}),f.d(v,"FloatType",function(){return Xr}),f.d(v,"Fog",function(){return ic}),f.d(v,"FogExp2",function(){return nc}),f.d(v,"Font",function(){return xu}),f.d(v,"FontLoader",function(){return bu}),f.d(v,"FrontFaceDirectionCCW",function(){return Tt}),f.d(v,"FrontFaceDirectionCW",function(){return vt}),f.d(v,"FrontSide",function(){return ut}),f.d(v,"Frustum",function(){return Ba}),f.d(v,"GammaEncoding",function(){return Fs}),f.d(v,"Geometry",function(){return Be}),f.d(v,"GeometryUtils",function(){return Uv}),f.d(v,"GreaterDepth",function(){return I}),f.d(v,"GreaterEqualDepth",function(){return L}),f.d(v,"GreaterEqualStencilFunc",function(){return Kp}),f.d(v,"GreaterStencilFunc",function(){return Zp}),f.d(v,"GridHelper",function(){return Kc}),f.d(v,"Group",function(){return Ga}),f.d(v,"HalfFloatType",function(){return xr}),f.d(v,"HemisphereLight",function(){return Dc}),f.d(v,"HemisphereLightHelper",function(){return mo}),f.d(v,"HemisphereLightProbe",function(){return _u}),f.d(v,"IcosahedronBufferGeometry",function(){return Ja}),f.d(v,"IcosahedronGeometry",function(){return ns}),f.d(v,"ImageBitmapLoader",function(){return gu}),f.d(v,"ImageLoader",function(){return co}),f.d(v,"ImageUtils",function(){return di}),f.d(v,"ImmediateRenderObject",function(){return Ms}),f.d(v,"IncrementStencilOp",function(){return Gp}),f.d(v,"IncrementWrapStencilOp",function(){return kp}),f.d(v,"InstancedBufferAttribute",function(){return Hc}),f.d(v,"InstancedBufferGeometry",function(){return _s}),f.d(v,"InstancedInterleavedBuffer",function(){return Pu}),f.d(v,"InstancedMesh",function(){return dc}),f.d(v,"Int16Attribute",function(){return Tv}),f.d(v,"Int16BufferAttribute",function(){return No}),f.d(v,"Int32Attribute",function(){return Av}),f.d(v,"Int32BufferAttribute",function(){return Bo}),f.d(v,"Int8Attribute",function(){return _v}),f.d(v,"Int8BufferAttribute",function(){return Oo}),f.d(v,"IntType",function(){return xn}),f.d(v,"InterleavedBuffer",function(){return ii}),f.d(v,"InterleavedBufferAttribute",function(){return jo}),f.d(v,"Interpolant",function(){return ln}),f.d(v,"InterpolateDiscrete",function(){return Mo}),f.d(v,"InterpolateLinear",function(){return So}),f.d(v,"InterpolateSmooth",function(){return Ns}),f.d(v,"InvertStencilOp",function(){return jp}),f.d(v,"JSONLoader",function(){return Gv}),f.d(v,"KeepStencilOp",function(){return zs}),f.d(v,"KeyframeTrack",function(){return zr}),f.d(v,"LOD",function(){return Zo}),f.d(v,"LatheBufferGeometry",function(){return no}),f.d(v,"LatheGeometry",function(){return fs}),f.d(v,"Layers",function(){return Vs}),f.d(v,"LensFlare",function(){return kv}),f.d(v,"LessDepth",function(){return tt}),f.d(v,"LessEqualDepth",function(){return $}),f.d(v,"LessEqualStencilFunc",function(){return Yp}),f.d(v,"LessStencilFunc",function(){return qp}),f.d(v,"Light",function(){return vr}),f.d(v,"LightProbe",function(){return mn}),f.d(v,"LightShadow",function(){return Xn}),f.d(v,"Line",function(){return cn}),f.d(v,"Line3",function(){return Iu}),f.d(v,"LineBasicMaterial",function(){return wr}),f.d(v,"LineCurve",function(){return en}),f.d(v,"LineCurve3",function(){return Pn}),f.d(v,"LineDashedMaterial",function(){return ia}),f.d(v,"LineLoop",function(){return gc}),f.d(v,"LinePieces",function(){return cv}),f.d(v,"LineSegments",function(){return Mr}),f.d(v,"LineStrip",function(){return sv}),f.d(v,"LinearEncoding",function(){return Yr}),f.d(v,"LinearFilter",function(){return Lt}),f.d(v,"LinearInterpolant",function(){return ys}),f.d(v,"LinearMipMapLinearFilter",function(){return sr}),f.d(v,"LinearMipMapNearestFilter",function(){return Ae}),f.d(v,"LinearMipmapLinearFilter",function(){return lr}),f.d(v,"LinearMipmapNearestFilter",function(){return Se}),f.d(v,"LinearToneMapping",function(){return H}),f.d(v,"Loader",function(){return rr}),f.d(v,"LoaderUtils",function(){return mu}),f.d(v,"LoadingManager",function(){return ou}),f.d(v,"LogLuvEncoding",function(){return Nh}),f.d(v,"LoopOnce",function(){return Ch}),f.d(v,"LoopPingPong",function(){return Dh}),f.d(v,"LoopRepeat",function(){return Oh}),f.d(v,"LuminanceAlphaFormat",function(){return Xu}),f.d(v,"LuminanceFormat",function(){return qu}),f.d(v,"MOUSE",function(){return _}),f.d(v,"Material",function(){return Ne}),f.d(v,"MaterialLoader",function(){return kc}),f.d(v,"Math",function(){return We}),f.d(v,"MathUtils",function(){return We}),f.d(v,"Matrix3",function(){return kr}),f.d(v,"Matrix4",function(){return Xe}),f.d(v,"MaxEquation",function(){return Ct}),f.d(v,"Mesh",function(){return br}),f.d(v,"MeshBasicMaterial",function(){return hn}),f.d(v,"MeshDepthMaterial",function(){return wi}),f.d(v,"MeshDistanceMaterial",function(){return _i}),f.d(v,"MeshFaceMaterial",function(){return dv}),f.d(v,"MeshLambertMaterial",function(){return ra}),f.d(v,"MeshMatcapMaterial",function(){return na}),f.d(v,"MeshNormalMaterial",function(){return ea}),f.d(v,"MeshPhongMaterial",function(){return Ti}),f.d(v,"MeshPhysicalMaterial",function(){return $i}),f.d(v,"MeshStandardMaterial",function(){return jn}),f.d(v,"MeshToonMaterial",function(){return ta}),f.d(v,"MinEquation",function(){return ie}),f.d(v,"MirroredRepeatWrapping",function(){return V}),f.d(v,"MixOperation",function(){return Z}),f.d(v,"MultiMaterial",function(){return pv}),f.d(v,"MultiplyBlending",function(){return Vt}),f.d(v,"MultiplyOperation",function(){return X}),f.d(v,"NearestFilter",function(){return it}),f.d(v,"NearestMipMapLinearFilter",function(){return ne}),f.d(v,"NearestMipMapNearestFilter",function(){return xt}),f.d(v,"NearestMipmapLinearFilter",function(){return It}),f.d(v,"NearestMipmapNearestFilter",function(){return mt}),f.d(v,"NeverDepth",function(){return je}),f.d(v,"NeverStencilFunc",function(){return Wp}),f.d(v,"NoBlending",function(){return pt}),f.d(v,"NoColors",function(){return lv}),f.d(v,"NoToneMapping",function(){return D}),f.d(v,"NormalAnimationBlendMode",function(){return Bs}),f.d(v,"NormalBlending",function(){return ct}),f.d(v,"NotEqualDepth",function(){return z}),f.d(v,"NotEqualStencilFunc",function(){return Jp}),f.d(v,"NumberKeyframeTrack",function(){return oo}),f.d(v,"Object3D",function(){return ge}),f.d(v,"ObjectLoader",function(){return Wc}),f.d(v,"ObjectSpaceNormalMap",function(){return Uh}),f.d(v,"OctahedronBufferGeometry",function(){return Wi}),f.d(v,"OctahedronGeometry",function(){return rs}),f.d(v,"OneFactor",function(){return ve}),f.d(v,"OneMinusDstAlphaFactor",function(){return ke}),f.d(v,"OneMinusDstColorFactor",function(){return Te}),f.d(v,"OneMinusSrcAlphaFactor",function(){return Ve}),f.d(v,"OneMinusSrcColorFactor",function(){return de}),f.d(v,"OrthographicCamera",function(){return uo}),f.d(v,"PCFShadowMap",function(){return G}),f.d(v,"PCFSoftShadowMap",function(){return Y}),f.d(v,"PMREMGenerator",function(){return zu}),f.d(v,"ParametricBufferGeometry",function(){return Ya}),f.d(v,"ParametricGeometry",function(){return $o}),f.d(v,"Particle",function(){return mv}),f.d(v,"ParticleBasicMaterial",function(){return yv}),f.d(v,"ParticleSystem",function(){return vv}),f.d(v,"ParticleSystemMaterial",function(){return xv}),f.d(v,"Path",function(){return Dn}),f.d(v,"PerspectiveCamera",function(){return Or}),f.d(v,"Plane",function(){return Sn}),f.d(v,"PlaneBufferGeometry",function(){return Hi}),f.d(v,"PlaneGeometry",function(){return Vo}),f.d(v,"PlaneHelper",function(){return Es}),f.d(v,"PointCloud",function(){return fv}),f.d(v,"PointCloudMaterial",function(){return gv}),f.d(v,"PointLight",function(){return Bc}),f.d(v,"PointLightHelper",function(){return fo}),f.d(v,"Points",function(){return Wa}),f.d(v,"PointsMaterial",function(){return An}),f.d(v,"PolarGridHelper",function(){return Qc}),f.d(v,"PolyhedronBufferGeometry",function(){return tn}),f.d(v,"PolyhedronGeometry",function(){return ts}),f.d(v,"PositionalAudio",function(){return Eu}),f.d(v,"PropertyBinding",function(){return Wr}),f.d(v,"PropertyMixer",function(){return Lu}),f.d(v,"QuadraticBezierCurve",function(){return Cn}),f.d(v,"QuadraticBezierCurve3",function(){return qn}),f.d(v,"Quaternion",function(){return Ir}),f.d(v,"QuaternionKeyframeTrack",function(){return xs}),f.d(v,"QuaternionLinearInterpolant",function(){return Ac}),f.d(v,"REVISION",function(){return p}),f.d(v,"RGBADepthPacking",function(){return Fh}),f.d(v,"RGBAFormat",function(){return $r}),f.d(v,"RGBAIntegerFormat",function(){return th}),f.d(v,"RGBA_ASTC_10x10_Format",function(){return ph}),f.d(v,"RGBA_ASTC_10x5_Format",function(){return uh}),f.d(v,"RGBA_ASTC_10x6_Format",function(){return hh}),f.d(v,"RGBA_ASTC_10x8_Format",function(){return dh}),f.d(v,"RGBA_ASTC_12x10_Format",function(){return fh}),f.d(v,"RGBA_ASTC_12x12_Format",function(){return mh}),f.d(v,"RGBA_ASTC_4x4_Format",function(){return rh}),f.d(v,"RGBA_ASTC_5x4_Format",function(){return nh}),f.d(v,"RGBA_ASTC_5x5_Format",function(){return ih}),f.d(v,"RGBA_ASTC_6x5_Format",function(){return ah}),f.d(v,"RGBA_ASTC_6x6_Format",function(){return oh}),f.d(v,"RGBA_ASTC_8x5_Format",function(){return sh}),f.d(v,"RGBA_ASTC_8x6_Format",function(){return ch}),f.d(v,"RGBA_ASTC_8x8_Format",function(){return lh}),f.d(v,"RGBA_BPTC_Format",function(){return vh}),f.d(v,"RGBA_ETC2_EAC_Format",function(){return xl}),f.d(v,"RGBA_PVRTC_2BPPV1_Format",function(){return gl}),f.d(v,"RGBA_PVRTC_4BPPV1_Format",function(){return vl}),f.d(v,"RGBA_S3TC_DXT1_Format",function(){return hl}),f.d(v,"RGBA_S3TC_DXT3_Format",function(){return dl}),f.d(v,"RGBA_S3TC_DXT5_Format",function(){return pl}),f.d(v,"RGBDEncoding",function(){return Ml}),f.d(v,"RGBEEncoding",function(){return Us}),f.d(v,"RGBEFormat",function(){return Yu}),f.d(v,"RGBFormat",function(){return Bn}),f.d(v,"RGBIntegerFormat",function(){return $u}),f.d(v,"RGBM16Encoding",function(){return _l}),f.d(v,"RGBM7Encoding",function(){return wl}),f.d(v,"RGB_ETC1_Format",function(){return eh}),f.d(v,"RGB_ETC2_Format",function(){return yl}),f.d(v,"RGB_PVRTC_2BPPV1_Format",function(){return ml}),f.d(v,"RGB_PVRTC_4BPPV1_Format",function(){return fl}),f.d(v,"RGB_S3TC_DXT1_Format",function(){return ul}),f.d(v,"RGFormat",function(){return Ku}),f.d(v,"RGIntegerFormat",function(){return Qu}),f.d(v,"RawShaderMaterial",function(){return si}),f.d(v,"Ray",function(){return Fi}),f.d(v,"Raycaster",function(){return Cu}),f.d(v,"RectAreaLight",function(){return Gc}),f.d(v,"RedFormat",function(){return Zu}),f.d(v,"RedIntegerFormat",function(){return Ju}),f.d(v,"ReinhardToneMapping",function(){return ht}),f.d(v,"RepeatWrapping",function(){return R}),f.d(v,"ReplaceStencilOp",function(){return zp}),f.d(v,"ReverseSubtractEquation",function(){return re}),f.d(v,"RingBufferGeometry",function(){return ro}),f.d(v,"RingGeometry",function(){return ps}),f.d(v,"SRGB8_ALPHA8_ASTC_10x10_Format",function(){return Lh}),f.d(v,"SRGB8_ALPHA8_ASTC_10x5_Format",function(){return Th}),f.d(v,"SRGB8_ALPHA8_ASTC_10x6_Format",function(){return Eh}),f.d(v,"SRGB8_ALPHA8_ASTC_10x8_Format",function(){return Ah}),f.d(v,"SRGB8_ALPHA8_ASTC_12x10_Format",function(){return Rh}),f.d(v,"SRGB8_ALPHA8_ASTC_12x12_Format",function(){return Ph}),f.d(v,"SRGB8_ALPHA8_ASTC_4x4_Format",function(){return gh}),f.d(v,"SRGB8_ALPHA8_ASTC_5x4_Format",function(){return yh}),f.d(v,"SRGB8_ALPHA8_ASTC_5x5_Format",function(){return xh}),f.d(v,"SRGB8_ALPHA8_ASTC_6x5_Format",function(){return bh}),f.d(v,"SRGB8_ALPHA8_ASTC_6x6_Format",function(){return wh}),f.d(v,"SRGB8_ALPHA8_ASTC_8x5_Format",function(){return _h}),f.d(v,"SRGB8_ALPHA8_ASTC_8x6_Format",function(){return Mh}),f.d(v,"SRGB8_ALPHA8_ASTC_8x8_Format",function(){return Sh}),f.d(v,"Scene",function(){return _a}),f.d(v,"SceneUtils",function(){return Vv}),f.d(v,"ShaderChunk",function(){return Je}),f.d(v,"ShaderLib",function(){return kn}),f.d(v,"ShaderMaterial",function(){return Zr}),f.d(v,"ShadowMaterial",function(){return Qi}),f.d(v,"Shape",function(){return Ei}),f.d(v,"ShapeBufferGeometry",function(){return Ji}),f.d(v,"ShapeGeometry",function(){return Zi}),f.d(v,"ShapePath",function(){return yu}),f.d(v,"ShapeUtils",function(){return ai}),f.d(v,"ShortType",function(){return Br}),f.d(v,"Skeleton",function(){return uc}),f.d(v,"SkeletonHelper",function(){return ua}),f.d(v,"SkinnedMesh",function(){return lc}),f.d(v,"SmoothShading",function(){return O}),f.d(v,"Sphere",function(){return Un}),f.d(v,"SphereBufferGeometry",function(){return Yi}),f.d(v,"SphereGeometry",function(){return ds}),f.d(v,"Spherical",function(){return ip}),f.d(v,"SphericalHarmonics3",function(){return Vc}),f.d(v,"SphericalReflectionMapping",function(){return rt}),f.d(v,"Spline",function(){return Hu}),f.d(v,"SplineCurve",function(){return On}),f.d(v,"SplineCurve3",function(){return Mp}),f.d(v,"SpotLight",function(){return Nc}),f.d(v,"SpotLightHelper",function(){return po}),f.d(v,"SpotLightShadow",function(){return Ic}),f.d(v,"Sprite",function(){return Yo}),f.d(v,"SpriteMaterial",function(){return Mi}),f.d(v,"SrcAlphaFactor",function(){return Pe}),f.d(v,"SrcAlphaSaturateFactor",function(){return Ce}),f.d(v,"SrcColorFactor",function(){return le}),f.d(v,"StaticCopyUsage",function(){return rf}),f.d(v,"StaticDrawUsage",function(){return Ao}),f.d(v,"StaticReadUsage",function(){return $p}),f.d(v,"StereoCamera",function(){return Kd}),f.d(v,"StreamCopyUsage",function(){return af}),f.d(v,"StreamDrawUsage",function(){return Qp}),f.d(v,"StreamReadUsage",function(){return ef}),f.d(v,"StringKeyframeTrack",function(){return Lc}),f.d(v,"SubtractEquation",function(){return Ut}),f.d(v,"SubtractiveBlending",function(){return Ot}),f.d(v,"TOUCH",function(){return E}),f.d(v,"TangentSpaceNormalMap",function(){return Oi}),f.d(v,"TetrahedronBufferGeometry",function(){return Za}),f.d(v,"TetrahedronGeometry",function(){return es}),f.d(v,"TextBufferGeometry",function(){return eo}),f.d(v,"TextGeometry",function(){return hs}),f.d(v,"Texture",function(){return ur}),f.d(v,"TextureLoader",function(){return Cc}),f.d(v,"TorusBufferGeometry",function(){return $a}),f.d(v,"TorusGeometry",function(){return ss}),f.d(v,"TorusKnotBufferGeometry",function(){return Qa}),f.d(v,"TorusKnotGeometry",function(){return os}),f.d(v,"Triangle",function(){return Fr}),f.d(v,"TriangleFanDrawMode",function(){return Fp}),f.d(v,"TriangleStripDrawMode",function(){return Bp}),f.d(v,"TrianglesDrawMode",function(){return Ih}),f.d(v,"TubeBufferGeometry",function(){return qi}),f.d(v,"TubeGeometry",function(){return as}),f.d(v,"UVMapping",function(){return Q}),f.d(v,"Uint16Attribute",function(){return Ev}),f.d(v,"Uint16BufferAttribute",function(){return Ui}),f.d(v,"Uint32Attribute",function(){return Lv}),f.d(v,"Uint32BufferAttribute",function(){return zi}),f.d(v,"Uint8Attribute",function(){return Mv}),f.d(v,"Uint8BufferAttribute",function(){return Do}),f.d(v,"Uint8ClampedAttribute",function(){return Sv}),f.d(v,"Uint8ClampedBufferAttribute",function(){return Io}),f.d(v,"Uncharted2ToneMapping",function(){return F}),f.d(v,"Uniform",function(){return Yc}),f.d(v,"UniformsLib",function(){return fe}),f.d(v,"UniformsUtils",function(){return $h}),f.d(v,"UnsignedByteType",function(){return He}),f.d(v,"UnsignedInt248Type",function(){return Kn}),f.d(v,"UnsignedIntType",function(){return Vr}),f.d(v,"UnsignedShort4444Type",function(){return bn}),f.d(v,"UnsignedShort5551Type",function(){return wn}),f.d(v,"UnsignedShort565Type",function(){return _o}),f.d(v,"UnsignedShortType",function(){return Pr}),f.d(v,"VSMShadowMap",function(){return at}),f.d(v,"Vector2",function(){return Wt}),f.d(v,"Vector3",function(){return q}),f.d(v,"Vector4",function(){return er}),f.d(v,"VectorKeyframeTrack",function(){return so}),f.d(v,"Vertex",function(){return bv}),f.d(v,"VertexColors",function(){return hv}),f.d(v,"VideoTexture",function(){return nu}),f.d(v,"WebGLCubeRenderTarget",function(){return Vi}),f.d(v,"WebGLMultisampleRenderTarget",function(){return Sl}),f.d(v,"WebGLRenderTarget",function(){return nn}),f.d(v,"WebGLRenderTargetCube",function(){return Fv}),f.d(v,"WebGLRenderer",function(){return Yl}),f.d(v,"WebGLUtils",function(){return Md}),f.d(v,"WireframeGeometry",function(){return Xa}),f.d(v,"WireframeHelper",function(){return Iv}),f.d(v,"WrapAroundEnding",function(){return To}),f.d(v,"XHRLoader",function(){return Nv}),f.d(v,"ZeroCurvatureEnding",function(){return Pi}),f.d(v,"ZeroFactor",function(){return se}),f.d(v,"ZeroSlopeEnding",function(){return Ci}),f.d(v,"ZeroStencilOp",function(){return Up}),f.d(v,"sRGBEncoding",function(){return Eo}),Number.EPSILON===void 0&&(Number.EPSILON=Math.pow(2,-52)),Number.isInteger===void 0&&(Number.isInteger=function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t}),Math.sign===void 0&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),Object.assign===void 0&&(Object.assign=function(t){if(t==null)throw new TypeError("Cannot convert undefined or null to object");const e=Object(t);for(let r=1;r<arguments.length;r++){const n=arguments[r];if(n!=null)for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e});const p="117",_={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},E={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},P=0,w=1,T=2,C=3,vt=0,Tt=1,Pt=0,G=1,Y=2,at=3,ut=0,x=1,S=2,U=1,O=2,pt=0,ct=1,_t=2,Ot=3,Vt=4,St=5,At=100,Ut=101,re=102,ie=103,Ct=104,se=200,ve=201,le=202,de=203,Pe=204,Ve=205,Ue=206,ke=207,he=208,Te=209,Ce=210,je=0,ft=1,tt=2,$=3,J=4,L=5,I=6,z=7,X=0,Z=1,W=2,D=0,H=1,ht=2,F=3,Mt=4,Et=5,Q=300,wt=301,zt=302,bt=303,Xt=304,rt=305,d=306,b=307,R=1e3,B=1001,V=1002,it=1003,mt=1004,xt=1004,It=1005,ne=1005,Lt=1006,Se=1007,Ae=1007,lr=1008,sr=1008,He=1009,yr=1010,Br=1011,Pr=1012,xn=1013,Vr=1014,Xr=1015,xr=1016,bn=1017,wn=1018,_o=1019,Kn=1020,ga=1021,Bn=1022,$r=1023,qu=1024,Xu=1025,Yu=$r,Ri=1026,ya=1027,Zu=1028,Ju=1029,Ku=1030,Qu=1031,$u=1032,th=1033,ul=33776,hl=33777,dl=33778,pl=33779,fl=35840,ml=35841,vl=35842,gl=35843,eh=36196,yl=37492,xl=37496,rh=37808,nh=37809,ih=37810,ah=37811,oh=37812,sh=37813,ch=37814,lh=37815,uh=37816,hh=37817,dh=37818,ph=37819,fh=37820,mh=37821,vh=36492,gh=37840,yh=37841,xh=37842,bh=37843,wh=37844,_h=37845,Mh=37846,Sh=37847,Th=37848,Eh=37849,Ah=37850,Lh=37851,Rh=37852,Ph=37853,Ch=2200,Oh=2201,Dh=2202,Mo=2300,So=2301,Ns=2302,Pi=2400,Ci=2401,To=2402,Bs=2500,bl=2501,Ih=0,Bp=1,Fp=2,Yr=3e3,Eo=3001,Fs=3007,Us=3002,Nh=3003,wl=3004,_l=3005,Ml=3006,Bh=3200,Fh=3201,Oi=0,Uh=1,Up=0,zs=7680,zp=7681,Gp=7682,Vp=7683,kp=34055,Hp=34056,jp=5386,Wp=512,qp=513,Xp=514,Yp=515,Zp=516,Jp=517,Kp=518,zh=519,Ao=35044,Di=35048,Qp=35040,$p=35045,tf=35049,ef=35041,rf=35046,nf=35050,af=35042;function Fn(){}Object.assign(Fn.prototype,{addEventListener:function(t,e){this._listeners===void 0&&(this._listeners={});var r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(e)===-1&&r[t].push(e)},hasEventListener:function(t,e){if(this._listeners===void 0)return!1;var r=this._listeners;return r[t]!==void 0&&r[t].indexOf(e)!==-1},removeEventListener:function(t,e){if(this._listeners!==void 0){var r=this._listeners[t];if(r!==void 0){var n=r.indexOf(e);n!==-1&&r.splice(n,1)}}},dispatchEvent:function(t){if(this._listeners!==void 0){var e=this._listeners[t.type];if(e!==void 0){t.target=this;for(var r=e.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,t)}}}});for(var Ur=[],Lo=0;Lo<256;Lo++)Ur[Lo]=(Lo<16?"0":"")+Lo.toString(16);var xa,We={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Ur[255&t]+Ur[t>>8&255]+Ur[t>>16&255]+Ur[t>>24&255]+"-"+Ur[255&e]+Ur[e>>8&255]+"-"+Ur[e>>16&15|64]+Ur[e>>24&255]+"-"+Ur[63&r|128]+Ur[r>>8&255]+"-"+Ur[r>>16&255]+Ur[r>>24&255]+Ur[255&n]+Ur[n>>8&255]+Ur[n>>16&255]+Ur[n>>24&255]).toUpperCase()},clamp:function(t,e,r){return Math.max(e,Math.min(r,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,r,n,i){return n+(t-e)*(i-n)/(r-e)},lerp:function(t,e,r){return(1-r)*t+r*e},smoothstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*(3-2*t)},smootherstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*We.DEG2RAD},radToDeg:function(t){return t*We.RAD2DEG},isPowerOfTwo:function(t){return(t&t-1)==0&&t!==0},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,r,n,i){var a=Math.cos,o=Math.sin,s=a(r/2),c=o(r/2),l=a((e+n)/2),h=o((e+n)/2),m=a((e-n)/2),g=o((e-n)/2),u=a((n-e)/2),y=o((n-e)/2);switch(i){case"XYX":t.set(s*h,c*m,c*g,s*l);break;case"YZY":t.set(c*g,s*h,c*m,s*l);break;case"ZXZ":t.set(c*m,c*g,s*h,s*l);break;case"XZX":t.set(s*h,c*y,c*u,s*l);break;case"YXY":t.set(c*u,s*h,c*y,s*l);break;case"ZYZ":t.set(c*y,c*u,s*h,s*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}};function Wt(t,e){this.x=t||0,this.y=e||0}function kr(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Wt.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(Wt.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return e!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return e!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,r=this.y,n=t.elements;return this.x=n[0]*e+n[3]*r+n[6],this.y=n[1]*e+n[4]*r+n[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,r){return r!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=this.x-t.x,a=this.y-t.y;return this.x=i*r-a*n+t.x,this.y=i*n+a*r+t.y,this},random:function(){return this.x=Math.random(),this.y=Math.random(),this}}),Object.assign(kr.prototype,{isMatrix3:!0,set:function(t,e,r,n,i,a,o,s,c){var l=this.elements;return l[0]=t,l[1]=n,l[2]=o,l[3]=e,l[4]=i,l[5]=s,l[6]=r,l[7]=a,l[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this},extractBasis:function(t,e,r){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,a=r[0],o=r[3],s=r[6],c=r[1],l=r[4],h=r[7],m=r[2],g=r[5],u=r[8],y=n[0],A=n[3],M=n[6],N=n[1],j=n[4],k=n[7],ot=n[2],nt=n[5],gt=n[8];return i[0]=a*y+o*N+s*ot,i[3]=a*A+o*j+s*nt,i[6]=a*M+o*k+s*gt,i[1]=c*y+l*N+h*ot,i[4]=c*A+l*j+h*nt,i[7]=c*M+l*k+h*gt,i[2]=m*y+g*N+u*ot,i[5]=m*A+g*j+u*nt,i[8]=m*M+g*k+u*gt,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],c=t[7],l=t[8];return e*a*l-e*o*c-r*i*l+r*o*s+n*i*c-n*a*s},getInverse:function(t,e){e!==void 0&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var r=t.elements,n=this.elements,i=r[0],a=r[1],o=r[2],s=r[3],c=r[4],l=r[5],h=r[6],m=r[7],g=r[8],u=g*c-l*m,y=l*h-g*s,A=m*s-c*h,M=i*u+a*y+o*A;if(M===0)return this.set(0,0,0,0,0,0,0,0,0);var N=1/M;return n[0]=u*N,n[1]=(o*m-g*a)*N,n[2]=(l*a-o*c)*N,n[3]=y*N,n[4]=(g*i-o*h)*N,n[5]=(o*s-l*i)*N,n[6]=A*N,n[7]=(a*h-m*i)*N,n[8]=(c*i-a*s)*N,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,r,n,i,a,o){var s=Math.cos(i),c=Math.sin(i);this.set(r*s,r*c,-r*(s*a+c*o)+a+t,-n*c,n*s,-n*(-c*a+s*o)+o+e,0,0,1)},scale:function(t,e){var r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this},rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=this.elements,i=n[0],a=n[3],o=n[6],s=n[1],c=n[4],l=n[7];return n[0]=e*i+r*s,n[3]=e*a+r*c,n[6]=e*o+r*l,n[1]=-r*i+e*s,n[4]=-r*a+e*c,n[7]=-r*o+e*l,this},translate:function(t,e){var r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<9;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){e===void 0&&(e=0);for(var r=0;r<9;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}});var di={getDataURL:function(t){var e;if(typeof HTMLCanvasElement=="undefined")return t.src;if(t instanceof HTMLCanvasElement)e=t;else{xa===void 0&&(xa=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),xa.width=t.width,xa.height=t.height;var r=xa.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),e=xa}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},of=0;function ur(t,e,r,n,i,a,o,s,c,l){Object.defineProperty(this,"id",{value:of++}),this.uuid=We.generateUUID(),this.name="",this.image=t!==void 0?t:ur.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=e!==void 0?e:ur.DEFAULT_MAPPING,this.wrapS=r!==void 0?r:B,this.wrapT=n!==void 0?n:B,this.magFilter=i!==void 0?i:Lt,this.minFilter=a!==void 0?a:lr,this.anisotropy=c!==void 0?c:1,this.format=o!==void 0?o:$r,this.internalFormat=null,this.type=s!==void 0?s:He,this.offset=new Wt(0,0),this.repeat=new Wt(1,1),this.center=new Wt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new kr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l!==void 0?l:Yr,this.version=0,this.onUpdate=null}function er(t,e,r,n){this.x=t||0,this.y=e||0,this.z=r||0,this.w=n!==void 0?n:1}function nn(t,e,r){this.width=t,this.height=e,this.scissor=new er(0,0,t,e),this.scissorTest=!1,this.viewport=new er(0,0,t,e),r=r||{},this.texture=new ur(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=r.generateMipmaps!==void 0&&r.generateMipmaps,this.texture.minFilter=r.minFilter!==void 0?r.minFilter:Lt,this.depthBuffer=r.depthBuffer===void 0||r.depthBuffer,this.stencilBuffer=r.stencilBuffer===void 0||r.stencilBuffer,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null}function Sl(t,e,r){nn.call(this,t,e,r),this.samples=4}function Ir(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._w=n!==void 0?n:1}ur.DEFAULT_IMAGE=void 0,ur.DEFAULT_MAPPING=Q,ur.prototype=Object.assign(Object.create(Fn.prototype),{constructor:ur,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){var n=this.image;if(n.uuid===void 0&&(n.uuid=We.generateUUID()),!e&&t.images[n.uuid]===void 0){var i;if(Array.isArray(n)){i=[];for(var a=0,o=n.length;a<o;a++)i.push(di.getDataURL(n[a]))}else i=di.getDataURL(n);t.images[n.uuid]={uuid:n.uuid,url:i}}r.image=n.uuid}return e||(t.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping!==Q)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case R:t.x=t.x-Math.floor(t.x);break;case B:t.x=t.x<0?0:1;break;case V:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case R:t.y=t.y-Math.floor(t.y);break;case B:t.y=t.y<0?0:1;break;case V:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(ur.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}}),Object.defineProperties(er.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(er.prototype,{isVector4:!0,set:function(t,e,r,n){return this.x=t,this.y=e,this.z=r,this.w=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this},add:function(t,e){return e!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return e!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=this.w,a=t.elements;return this.x=a[0]*e+a[4]*r+a[8]*n+a[12]*i,this.y=a[1]*e+a[5]*r+a[9]*n+a[13]*i,this.z=a[2]*e+a[6]*r+a[10]*n+a[14]*i,this.w=a[3]*e+a[7]*r+a[11]*n+a[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,r,n,i,a=t.elements,o=a[0],s=a[4],c=a[8],l=a[1],h=a[5],m=a[9],g=a[2],u=a[6],y=a[10];if(Math.abs(s-l)<.01&&Math.abs(c-g)<.01&&Math.abs(m-u)<.01){if(Math.abs(s+l)<.1&&Math.abs(c+g)<.1&&Math.abs(m+u)<.1&&Math.abs(o+h+y-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var A=(o+1)/2,M=(h+1)/2,N=(y+1)/2,j=(s+l)/4,k=(c+g)/4,ot=(m+u)/4;return A>M&&A>N?A<.01?(r=0,n=.707106781,i=.707106781):(n=j/(r=Math.sqrt(A)),i=k/r):M>N?M<.01?(r=.707106781,n=0,i=.707106781):(r=j/(n=Math.sqrt(M)),i=ot/n):N<.01?(r=.707106781,n=.707106781,i=0):(r=k/(i=Math.sqrt(N)),n=ot/i),this.set(r,n,i,e),this}var nt=Math.sqrt((u-m)*(u-m)+(c-g)*(c-g)+(l-s)*(l-s));return Math.abs(nt)<.001&&(nt=1),this.x=(u-m)/nt,this.y=(c-g)/nt,this.z=(l-s)/nt,this.w=Math.acos((o+h+y-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this.w=t.w+(e.w-t.w)*r,this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,r){return r!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}),nn.prototype=Object.assign(Object.create(Fn.prototype),{constructor:nn,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Sl.prototype=Object.assign(Object.create(nn.prototype),{constructor:Sl,isWebGLMultisampleRenderTarget:!0,copy:function(t){return nn.prototype.copy.call(this,t),this.samples=t.samples,this}}),Object.assign(Ir,{slerp:function(t,e,r,n){return r.copy(t).slerp(e,n)},slerpFlat:function(t,e,r,n,i,a,o){var s=r[n+0],c=r[n+1],l=r[n+2],h=r[n+3],m=i[a+0],g=i[a+1],u=i[a+2],y=i[a+3];if(h!==y||s!==m||c!==g||l!==u){var A=1-o,M=s*m+c*g+l*u+h*y,N=M>=0?1:-1,j=1-M*M;if(j>Number.EPSILON){var k=Math.sqrt(j),ot=Math.atan2(k,M*N);A=Math.sin(A*ot)/k,o=Math.sin(o*ot)/k}var nt=o*N;if(s=s*A+m*nt,c=c*A+g*nt,l=l*A+u*nt,h=h*A+y*nt,A===1-o){var gt=1/Math.sqrt(s*s+c*c+l*l+h*h);s*=gt,c*=gt,l*=gt,h*=gt}}t[e]=s,t[e+1]=c,t[e+2]=l,t[e+3]=h},multiplyQuaternionsFlat:function(t,e,r,n,i,a){var o=r[n],s=r[n+1],c=r[n+2],l=r[n+3],h=i[a],m=i[a+1],g=i[a+2],u=i[a+3];return t[e]=o*u+l*h+s*g-c*m,t[e+1]=s*u+l*m+c*h-o*g,t[e+2]=c*u+l*g+o*m-s*h,t[e+3]=l*u-o*h-s*m-c*g,t}}),Object.defineProperties(Ir.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(Ir.prototype,{isQuaternion:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=t._x,n=t._y,i=t._z,a=t.order,o=Math.cos,s=Math.sin,c=o(r/2),l=o(n/2),h=o(i/2),m=s(r/2),g=s(n/2),u=s(i/2);switch(a){case"XYZ":this._x=m*l*h+c*g*u,this._y=c*g*h-m*l*u,this._z=c*l*u+m*g*h,this._w=c*l*h-m*g*u;break;case"YXZ":this._x=m*l*h+c*g*u,this._y=c*g*h-m*l*u,this._z=c*l*u-m*g*h,this._w=c*l*h+m*g*u;break;case"ZXY":this._x=m*l*h-c*g*u,this._y=c*g*h+m*l*u,this._z=c*l*u+m*g*h,this._w=c*l*h-m*g*u;break;case"ZYX":this._x=m*l*h-c*g*u,this._y=c*g*h+m*l*u,this._z=c*l*u-m*g*h,this._w=c*l*h+m*g*u;break;case"YZX":this._x=m*l*h+c*g*u,this._y=c*g*h+m*l*u,this._z=c*l*u-m*g*h,this._w=c*l*h-m*g*u;break;case"XZY":this._x=m*l*h-c*g*u,this._y=c*g*h-m*l*u,this._z=c*l*u+m*g*h,this._w=c*l*h+m*g*u;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e!==!1&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){var r=e/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var e,r=t.elements,n=r[0],i=r[4],a=r[8],o=r[1],s=r[5],c=r[9],l=r[2],h=r[6],m=r[10],g=n+s+m;return g>0?(e=.5/Math.sqrt(g+1),this._w=.25/e,this._x=(h-c)*e,this._y=(a-l)*e,this._z=(o-i)*e):n>s&&n>m?(e=2*Math.sqrt(1+n-s-m),this._w=(h-c)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(a+l)/e):s>m?(e=2*Math.sqrt(1+s-n-m),this._w=(a-l)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(c+h)/e):(e=2*Math.sqrt(1+m-n-s),this._w=(o-i)/e,this._x=(a+l)/e,this._y=(c+h)/e,this._z=.25*e),this._onChangeCallback(),this},setFromUnitVectors:function(t,e){var r=t.dot(e)+1;return r<1e-6?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(We.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var r=this.angleTo(t);if(r===0)return this;var n=Math.min(1,e/r);return this.slerp(t,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,e){return e!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var r=t._x,n=t._y,i=t._z,a=t._w,o=e._x,s=e._y,c=e._z,l=e._w;return this._x=r*l+a*o+n*c-i*s,this._y=n*l+a*s+i*o-r*c,this._z=i*l+a*c+r*s-n*o,this._w=a*l-r*o-n*s-i*c,this._onChangeCallback(),this},slerp:function(t,e){if(e===0)return this;if(e===1)return this.copy(t);var r=this._x,n=this._y,i=this._z,a=this._w,o=a*t._w+r*t._x+n*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=r,this._y=n,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var c=1-e;return this._w=c*a+e*this._w,this._x=c*r+e*this._x,this._y=c*n+e*this._y,this._z=c*i+e*this._z,this.normalize(),this._onChangeCallback(),this}var l=Math.sqrt(s),h=Math.atan2(l,o),m=Math.sin((1-e)*h)/l,g=Math.sin(e*h)/l;return this._w=a*m+this._w*g,this._x=r*m+this._x*g,this._y=n*m+this._y*g,this._z=i*m+this._z*g,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},fromBufferAttribute:function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});var Tl=new q,Gh=new Ir;function q(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}Object.assign(q.prototype,{isVector3:!0,set:function(t,e,r){return this.x=t,this.y=e,this.z=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Gh.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(Gh.setFromAxisAngle(t,e))},applyMatrix3:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6]*n,this.y=i[1]*e+i[4]*r+i[7]*n,this.z=i[2]*e+i[5]*r+i[8]*n,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements,a=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*a,this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*a,this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*a,this},applyQuaternion:function(t){var e=this.x,r=this.y,n=this.z,i=t.x,a=t.y,o=t.z,s=t.w,c=s*e+a*n-o*r,l=s*r+o*e-i*n,h=s*n+i*r-a*e,m=-i*e-a*r-o*n;return this.x=c*s+m*-i+l*-o-h*-a,this.y=l*s+m*-a+h*-i-c*-o,this.z=h*s+m*-o+c*-a-l*-i,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[4]*r+i[8]*n,this.y=i[1]*e+i[5]*r+i[9]*n,this.z=i[2]*e+i[6]*r+i[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this},cross:function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var r=t.x,n=t.y,i=t.z,a=e.x,o=e.y,s=e.z;return this.x=n*s-i*o,this.y=i*a-r*s,this.z=r*o-n*a,this},projectOnVector:function(t){var e=t.lengthSq();if(e===0)return this.set(0,0,0);var r=t.dot(this)/e;return this.copy(t).multiplyScalar(r)},projectOnPlane:function(t){return Tl.copy(this).projectOnVector(t),this.sub(Tl)},reflect:function(t){return this.sub(Tl.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;var r=this.dot(t)/e;return Math.acos(We.clamp(r,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return e*e+r*r+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,r){var n=Math.sin(e)*t;return this.x=n*Math.sin(r),this.y=Math.cos(e)*t,this.z=n*Math.cos(r),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,r){return this.x=t*Math.sin(e),this.y=r,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=n,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},setFromMatrix3Column:function(t,e){return this.fromArray(t.elements,3*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,r){return r!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}});var ba=new q,_n=new Xe,sf=new q(0,0,0),cf=new q(1,1,1),pi=new q,Gs=new q,an=new q;function Xe(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Xe.prototype,{isMatrix4:!0,set:function(t,e,r,n,i,a,o,s,c,l,h,m,g,u,y,A){var M=this.elements;return M[0]=t,M[4]=e,M[8]=r,M[12]=n,M[1]=i,M[5]=a,M[9]=o,M[13]=s,M[2]=c,M[6]=l,M[10]=h,M[14]=m,M[3]=g,M[7]=u,M[11]=y,M[15]=A,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new Xe().fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this},copyPosition:function(t){var e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this},extractBasis:function(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this},extractRotation:function(t){var e=this.elements,r=t.elements,n=1/ba.setFromMatrixColumn(t,0).length(),i=1/ba.setFromMatrixColumn(t,1).length(),a=1/ba.setFromMatrixColumn(t,2).length();return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=0,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=0,e[8]=r[8]*a,e[9]=r[9]*a,e[10]=r[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,r=t.x,n=t.y,i=t.z,a=Math.cos(r),o=Math.sin(r),s=Math.cos(n),c=Math.sin(n),l=Math.cos(i),h=Math.sin(i);if(t.order==="XYZ"){var m=a*l,g=a*h,u=o*l,y=o*h;e[0]=s*l,e[4]=-s*h,e[8]=c,e[1]=g+u*c,e[5]=m-y*c,e[9]=-o*s,e[2]=y-m*c,e[6]=u+g*c,e[10]=a*s}else if(t.order==="YXZ"){var A=s*l,M=s*h,N=c*l,j=c*h;e[0]=A+j*o,e[4]=N*o-M,e[8]=a*c,e[1]=a*h,e[5]=a*l,e[9]=-o,e[2]=M*o-N,e[6]=j+A*o,e[10]=a*s}else if(t.order==="ZXY")A=s*l,M=s*h,N=c*l,j=c*h,e[0]=A-j*o,e[4]=-a*h,e[8]=N+M*o,e[1]=M+N*o,e[5]=a*l,e[9]=j-A*o,e[2]=-a*c,e[6]=o,e[10]=a*s;else if(t.order==="ZYX")m=a*l,g=a*h,u=o*l,y=o*h,e[0]=s*l,e[4]=u*c-g,e[8]=m*c+y,e[1]=s*h,e[5]=y*c+m,e[9]=g*c-u,e[2]=-c,e[6]=o*s,e[10]=a*s;else if(t.order==="YZX"){var k=a*s,ot=a*c,nt=o*s,gt=o*c;e[0]=s*l,e[4]=gt-k*h,e[8]=nt*h+ot,e[1]=h,e[5]=a*l,e[9]=-o*l,e[2]=-c*l,e[6]=ot*h+nt,e[10]=k-gt*h}else t.order==="XZY"&&(k=a*s,ot=a*c,nt=o*s,gt=o*c,e[0]=s*l,e[4]=-h,e[8]=c*l,e[1]=k*h+gt,e[5]=a*l,e[9]=ot*h-nt,e[2]=nt*h-ot,e[6]=o*l,e[10]=gt*h+k);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(sf,t,cf)},lookAt:function(t,e,r){var n=this.elements;return an.subVectors(t,e),an.lengthSq()===0&&(an.z=1),an.normalize(),pi.crossVectors(r,an),pi.lengthSq()===0&&(Math.abs(r.z)===1?an.x+=1e-4:an.z+=1e-4,an.normalize(),pi.crossVectors(r,an)),pi.normalize(),Gs.crossVectors(an,pi),n[0]=pi.x,n[4]=Gs.x,n[8]=an.x,n[1]=pi.y,n[5]=Gs.y,n[9]=an.y,n[2]=pi.z,n[6]=Gs.z,n[10]=an.z,this},multiply:function(t,e){return e!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,a=r[0],o=r[4],s=r[8],c=r[12],l=r[1],h=r[5],m=r[9],g=r[13],u=r[2],y=r[6],A=r[10],M=r[14],N=r[3],j=r[7],k=r[11],ot=r[15],nt=n[0],gt=n[4],yt=n[8],Gt=n[12],st=n[1],Nt=n[5],Bt=n[9],jt=n[13],xe=n[2],ae=n[6],Rt=n[10],Zt=n[14],qt=n[3],Ht=n[7],Kt=n[11],be=n[15];return i[0]=a*nt+o*st+s*xe+c*qt,i[4]=a*gt+o*Nt+s*ae+c*Ht,i[8]=a*yt+o*Bt+s*Rt+c*Kt,i[12]=a*Gt+o*jt+s*Zt+c*be,i[1]=l*nt+h*st+m*xe+g*qt,i[5]=l*gt+h*Nt+m*ae+g*Ht,i[9]=l*yt+h*Bt+m*Rt+g*Kt,i[13]=l*Gt+h*jt+m*Zt+g*be,i[2]=u*nt+y*st+A*xe+M*qt,i[6]=u*gt+y*Nt+A*ae+M*Ht,i[10]=u*yt+y*Bt+A*Rt+M*Kt,i[14]=u*Gt+y*jt+A*Zt+M*be,i[3]=N*nt+j*st+k*xe+ot*qt,i[7]=N*gt+j*Nt+k*ae+ot*Ht,i[11]=N*yt+j*Bt+k*Rt+ot*Kt,i[15]=N*Gt+j*jt+k*Zt+ot*be,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],a=t[1],o=t[5],s=t[9],c=t[13],l=t[2],h=t[6],m=t[10],g=t[14];return t[3]*(+i*s*h-n*c*h-i*o*m+r*c*m+n*o*g-r*s*g)+t[7]*(+e*s*g-e*c*m+i*a*m-n*a*g+n*c*l-i*s*l)+t[11]*(+e*c*h-e*o*g-i*a*h+r*a*g+i*o*l-r*c*l)+t[15]*(-n*o*l-e*s*h+e*o*m+n*a*h-r*a*m+r*s*l)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t,e,r){var n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=r),this},getInverse:function(t,e){e!==void 0&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var r=this.elements,n=t.elements,i=n[0],a=n[1],o=n[2],s=n[3],c=n[4],l=n[5],h=n[6],m=n[7],g=n[8],u=n[9],y=n[10],A=n[11],M=n[12],N=n[13],j=n[14],k=n[15],ot=u*j*m-N*y*m+N*h*A-l*j*A-u*h*k+l*y*k,nt=M*y*m-g*j*m-M*h*A+c*j*A+g*h*k-c*y*k,gt=g*N*m-M*u*m+M*l*A-c*N*A-g*l*k+c*u*k,yt=M*u*h-g*N*h-M*l*y+c*N*y+g*l*j-c*u*j,Gt=i*ot+a*nt+o*gt+s*yt;if(Gt===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var st=1/Gt;return r[0]=ot*st,r[1]=(N*y*s-u*j*s-N*o*A+a*j*A+u*o*k-a*y*k)*st,r[2]=(l*j*s-N*h*s+N*o*m-a*j*m-l*o*k+a*h*k)*st,r[3]=(u*h*s-l*y*s-u*o*m+a*y*m+l*o*A-a*h*A)*st,r[4]=nt*st,r[5]=(g*j*s-M*y*s+M*o*A-i*j*A-g*o*k+i*y*k)*st,r[6]=(M*h*s-c*j*s-M*o*m+i*j*m+c*o*k-i*h*k)*st,r[7]=(c*y*s-g*h*s+g*o*m-i*y*m-c*o*A+i*h*A)*st,r[8]=gt*st,r[9]=(M*u*s-g*N*s-M*a*A+i*N*A+g*a*k-i*u*k)*st,r[10]=(c*N*s-M*l*s+M*a*m-i*N*m-c*a*k+i*l*k)*st,r[11]=(g*l*s-c*u*s-g*a*m+i*u*m+c*a*A-i*l*A)*st,r[12]=yt*st,r[13]=(g*N*o-M*u*o+M*a*y-i*N*y-g*a*j+i*u*j)*st,r[14]=(M*l*o-c*N*o-M*a*h+i*N*h+c*a*j-i*l*j)*st,r[15]=(c*u*o-g*l*o+g*a*h-i*u*h-c*a*y+i*l*y)*st,this},scale:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z;return e[0]*=r,e[4]*=n,e[8]*=i,e[1]*=r,e[5]*=n,e[9]*=i,e[2]*=r,e[6]*=n,e[10]*=i,e[3]*=r,e[7]*=n,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,n))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=1-r,a=t.x,o=t.y,s=t.z,c=i*a,l=i*o;return this.set(c*a+r,c*o-n*s,c*s+n*o,0,c*o+n*s,l*o+r,l*s-n*a,0,c*s-n*o,l*s+n*a,i*s*s+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(t,e,r){return this.set(1,e,r,0,t,1,r,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,r){var n=this.elements,i=e._x,a=e._y,o=e._z,s=e._w,c=i+i,l=a+a,h=o+o,m=i*c,g=i*l,u=i*h,y=a*l,A=a*h,M=o*h,N=s*c,j=s*l,k=s*h,ot=r.x,nt=r.y,gt=r.z;return n[0]=(1-(y+M))*ot,n[1]=(g+k)*ot,n[2]=(u-j)*ot,n[3]=0,n[4]=(g-k)*nt,n[5]=(1-(m+M))*nt,n[6]=(A+N)*nt,n[7]=0,n[8]=(u+j)*gt,n[9]=(A-N)*gt,n[10]=(1-(m+y))*gt,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this},decompose:function(t,e,r){var n=this.elements,i=ba.set(n[0],n[1],n[2]).length(),a=ba.set(n[4],n[5],n[6]).length(),o=ba.set(n[8],n[9],n[10]).length();this.determinant()<0&&(i=-i),t.x=n[12],t.y=n[13],t.z=n[14],_n.copy(this);var s=1/i,c=1/a,l=1/o;return _n.elements[0]*=s,_n.elements[1]*=s,_n.elements[2]*=s,_n.elements[4]*=c,_n.elements[5]*=c,_n.elements[6]*=c,_n.elements[8]*=l,_n.elements[9]*=l,_n.elements[10]*=l,e.setFromRotationMatrix(_n),r.x=i,r.y=a,r.z=o,this},makePerspective:function(t,e,r,n,i,a){a===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*i/(e-t),c=2*i/(r-n),l=(e+t)/(e-t),h=(r+n)/(r-n),m=-(a+i)/(a-i),g=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=c,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=m,o[14]=g,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(t,e,r,n,i,a){var o=this.elements,s=1/(e-t),c=1/(r-n),l=1/(a-i),h=(e+t)*s,m=(r+n)*c,g=(a+i)*l;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-m,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-g,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<16;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){e===void 0&&(e=0);for(var r=0;r<16;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}});var Vh=new Xe,kh=new Ir;function Ii(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._order=n||Ii.DefaultOrder}function Vs(){this.mask=1}Ii.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Ii.DefaultOrder="XYZ",Object.defineProperties(Ii.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(Ii.prototype,{isEuler:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._order=n||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,r){var n=We.clamp,i=t.elements,a=i[0],o=i[4],s=i[8],c=i[1],l=i[5],h=i[9],m=i[2],g=i[6],u=i[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-h,u),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(g,l),this._z=0);break;case"YXZ":this._x=Math.asin(-n(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(s,u),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-m,a),this._z=0);break;case"ZXY":this._x=Math.asin(n(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-m,u),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(c,a));break;case"ZYX":this._y=Math.asin(-n(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(g,u),this._z=Math.atan2(c,a)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(n(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-m,a)):(this._x=0,this._y=Math.atan2(s,u));break;case"XZY":this._z=Math.asin(-n(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(g,l),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-h,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,r!==!1&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,r){return Vh.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Vh,e,r)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return kh.setFromEuler(this),this.setFromQuaternion(kh,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new q(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(Vs.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return(this.mask&t.mask)!=0}});let lf=0;const Hh=new q,wa=new Ir,Qn=new Xe,ks=new q,Ro=new q,uf=new q,hf=new Ir,jh=new q(1,0,0),Wh=new q(0,1,0),qh=new q(0,0,1),df={type:"added"},pf={type:"removed"};function ge(){Object.defineProperty(this,"id",{value:lf++}),this.uuid=We.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ge.DefaultUp.clone();var t=new q,e=new Ii,r=new Ir,n=new q(1,1,1);e._onChange(function(){r.setFromEuler(e,!1)}),r._onChange(function(){e.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Xe},normalMatrix:{value:new kr}}),this.matrix=new Xe,this.matrixWorld=new Xe,this.matrixAutoUpdate=ge.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Vs,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function _a(){ge.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}ge.DefaultUp=new q(0,1,0),ge.DefaultMatrixAutoUpdate=!0,ge.prototype=Object.assign(Object.create(Fn.prototype),{constructor:ge,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return wa.setFromAxisAngle(t,e),this.quaternion.multiply(wa),this},rotateOnWorldAxis:function(t,e){return wa.setFromAxisAngle(t,e),this.quaternion.premultiply(wa),this},rotateX:function(t){return this.rotateOnAxis(jh,t)},rotateY:function(t){return this.rotateOnAxis(Wh,t)},rotateZ:function(t){return this.rotateOnAxis(qh,t)},translateOnAxis:function(t,e){return Hh.copy(t).applyQuaternion(this.quaternion),this.position.add(Hh.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(jh,t)},translateY:function(t){return this.translateOnAxis(Wh,t)},translateZ:function(t){return this.translateOnAxis(qh,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(Qn.getInverse(this.matrixWorld))},lookAt:function(t,e,r){t.isVector3?ks.copy(t):ks.set(t,e,r);var n=this.parent;this.updateWorldMatrix(!0,!1),Ro.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Qn.lookAt(Ro,ks,this.up):Qn.lookAt(ks,Ro,this.up),this.quaternion.setFromRotationMatrix(Qn),n&&(Qn.extractRotation(n.matrixWorld),wa.setFromRotationMatrix(Qn),this.quaternion.premultiply(wa.inverse()))},add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(df)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var r=this.children.indexOf(t);return r!==-1&&(t.parent=null,this.children.splice(r,1),t.dispatchEvent(pf)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),Qn.getInverse(this.matrixWorld),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Qn.multiply(t.parent.matrixWorld)),t.applyMatrix4(Qn),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(t,e);if(i!==void 0)return i}},getWorldPosition:function(t){return t===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new q),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return t===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Ir),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Ro,t,uf),t},getWorldScale:function(t){return t===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new q),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Ro,hf,t),t},getWorldDirection:function(t){t===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new q),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverse(t)},traverseVisible:function(t){if(this.visible!==!1){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var r=this.parent;if(t===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0)for(var n=this.children,i=0,a=n.length;i<a;i++)n[i].updateWorldMatrix(!1,!0)},toJSON:function(t){var e=t===void 0||typeof t=="string",r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(M,N){return M[N.uuid]===void 0&&(M[N.uuid]=N.toJSON(t)),N.uuid}if(n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){n.geometry=i(t.geometries,this.geometry);var a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){var o=a.shapes;if(Array.isArray(o))for(var s=0,c=o.length;s<c;s++){var l=o[s];i(t.shapes,l)}else i(t.shapes,o)}}if(this.material!==void 0)if(Array.isArray(this.material)){var h=[];for(s=0,c=this.material.length;s<c;s++)h.push(i(t.materials,this.material[s]));n.material=h}else n.material=i(t.materials,this.material);if(this.children.length>0)for(n.children=[],s=0;s<this.children.length;s++)n.children.push(this.children[s].toJSON(t).object);if(e){var m=A(t.geometries),g=A(t.materials),u=A(t.textures),y=A(t.images);o=A(t.shapes),m.length>0&&(r.geometries=m),g.length>0&&(r.materials=g),u.length>0&&(r.textures=u),y.length>0&&(r.images=y),o.length>0&&(r.shapes=o)}return r.object=n,r;function A(M){var N=[];for(var j in M){var k=M[j];delete k.metadata,N.push(k)}return N}},clone:function(t){return new this.constructor().copy(this,t)},copy:function(t,e){if(e===void 0&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(var r=0;r<t.children.length;r++){var n=t.children[r];this.add(n.clone())}return this}}),_a.prototype=Object.assign(Object.create(ge.prototype),{constructor:_a,isScene:!0,copy:function(t,e){return ge.prototype.copy.call(this,t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=ge.prototype.toJSON.call(this,t);return this.background!==null&&(e.object.background=this.background.toJSON(t)),this.environment!==null&&(e.object.environment=this.environment.toJSON(t)),this.fog!==null&&(e.object.fog=this.fog.toJSON()),e},dispose:function(){this.dispatchEvent({type:"dispose"})}});var $n=[new q,new q,new q,new q,new q,new q,new q,new q],Po=new q,El=new Mn,Ma=new q,Sa=new q,Ta=new q,fi=new q,mi=new q,Ni=new q,Co=new q,Hs=new q,js=new q,Bi=new q;function Mn(t,e){this.min=t!==void 0?t:new q(1/0,1/0,1/0),this.max=e!==void 0?e:new q(-1/0,-1/0,-1/0)}function Al(t,e,r,n,i){var a,o;for(a=0,o=t.length-3;a<=o;a+=3){Bi.fromArray(t,a);var s=i.x*Math.abs(Bi.x)+i.y*Math.abs(Bi.y)+i.z*Math.abs(Bi.z),c=e.dot(Bi),l=r.dot(Bi),h=n.dot(Bi);if(Math.max(-Math.max(c,l,h),Math.min(c,l,h))>s)return!1}return!0}Object.assign(Mn.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,c=t.length;s<c;s+=3){var l=t[s],h=t[s+1],m=t[s+2];l<e&&(e=l),h<r&&(r=h),m<n&&(n=m),l>i&&(i=l),h>a&&(a=h),m>o&&(o=m)}return this.min.set(e,r,n),this.max.set(i,a,o),this},setFromBufferAttribute:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,c=t.count;s<c;s++){var l=t.getX(s),h=t.getY(s),m=t.getZ(s);l<e&&(e=l),h<r&&(r=h),m<n&&(n=m),l>i&&(i=l),h>a&&(a=h),m>o&&(o=m)}return this.min.set(e,r,n),this.max.set(i,a,o),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){var r=Po.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return t===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new q),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return t===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new q),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);var e=t.geometry;e!==void 0&&(e.boundingBox===null&&e.computeBoundingBox(),El.copy(e.boundingBox),El.applyMatrix4(t.matrixWorld),this.union(El));for(var r=t.children,n=0,i=r.length;n<i;n++)this.expandByObject(r[n]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return e===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new q),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,Po),Po.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=-t.constant&&r>=-t.constant},intersectsTriangle:function(t){if(this.isEmpty())return!1;this.getCenter(Co),Hs.subVectors(this.max,Co),Ma.subVectors(t.a,Co),Sa.subVectors(t.b,Co),Ta.subVectors(t.c,Co),fi.subVectors(Sa,Ma),mi.subVectors(Ta,Sa),Ni.subVectors(Ma,Ta);var e=[0,-fi.z,fi.y,0,-mi.z,mi.y,0,-Ni.z,Ni.y,fi.z,0,-fi.x,mi.z,0,-mi.x,Ni.z,0,-Ni.x,-fi.y,fi.x,0,-mi.y,mi.x,0,-Ni.y,Ni.x,0];return!!Al(e,Ma,Sa,Ta,Hs)&&!!Al(e=[1,0,0,0,1,0,0,0,1],Ma,Sa,Ta,Hs)&&(js.crossVectors(fi,mi),Al(e=[js.x,js.y,js.z],Ma,Sa,Ta,Hs))},clampPoint:function(t,e){return e===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new q),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return Po.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return t===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(Po).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||($n[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),$n[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),$n[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),$n[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),$n[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),$n[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),$n[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),$n[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints($n)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var ff=new Mn;function Un(t,e){this.center=t!==void 0?t:new q,this.radius=e!==void 0?e:-1}Object.assign(Un.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(t,e){var r=this.center;e!==void 0?r.copy(e):ff.setFromPoints(t).getCenter(r);for(var n=0,i=0,a=t.length;i<a;i++)n=Math.max(n,r.distanceToSquared(t[i]));return this.radius=Math.sqrt(n),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},isEmpty:function(){return this.radius<0},makeEmpty:function(){return this.center.set(0,0,0),this.radius=-1,this},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var r=this.center.distanceToSquared(t);return e===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new q),e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return t===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Mn),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});var ti=new q,Ll=new q,Ws=new q,vi=new q,Rl=new q,qs=new q,Pl=new q;function Fi(t,e){this.origin=t!==void 0?t:new q,this.direction=e!==void 0?e:new q(0,0,-1)}Object.assign(Fi.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return e===void 0&&(console.warn("THREE.Ray: .at() target is now required"),e=new q),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,ti)),this},closestPointToPoint:function(t,e){e===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new q),e.subVectors(t,this.origin);var r=e.dot(this.direction);return r<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var e=ti.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(ti.copy(this.direction).multiplyScalar(e).add(this.origin),ti.distanceToSquared(t))},distanceSqToSegment:function(t,e,r,n){Ll.copy(t).add(e).multiplyScalar(.5),Ws.copy(e).sub(t).normalize(),vi.copy(this.origin).sub(Ll);var i,a,o,s,c=.5*t.distanceTo(e),l=-this.direction.dot(Ws),h=vi.dot(this.direction),m=-vi.dot(Ws),g=vi.lengthSq(),u=Math.abs(1-l*l);if(u>0)if(a=l*h-m,s=c*u,(i=l*m-h)>=0)if(a>=-s)if(a<=s){var y=1/u;o=(i*=y)*(i+l*(a*=y)+2*h)+a*(l*i+a+2*m)+g}else a=c,o=-(i=Math.max(0,-(l*a+h)))*i+a*(a+2*m)+g;else a=-c,o=-(i=Math.max(0,-(l*a+h)))*i+a*(a+2*m)+g;else a<=-s?o=-(i=Math.max(0,-(-l*c+h)))*i+(a=i>0?-c:Math.min(Math.max(-c,-m),c))*(a+2*m)+g:a<=s?(i=0,o=(a=Math.min(Math.max(-c,-m),c))*(a+2*m)+g):o=-(i=Math.max(0,-(l*c+h)))*i+(a=i>0?c:Math.min(Math.max(-c,-m),c))*(a+2*m)+g;else a=l>0?-c:c,o=-(i=Math.max(0,-(l*a+h)))*i+a*(a+2*m)+g;return r&&r.copy(this.direction).multiplyScalar(i).add(this.origin),n&&n.copy(Ws).multiplyScalar(a).add(Ll),o},intersectSphere:function(t,e){ti.subVectors(t.center,this.origin);var r=ti.dot(this.direction),n=ti.dot(ti)-r*r,i=t.radius*t.radius;if(n>i)return null;var a=Math.sqrt(i-n),o=r-a,s=r+a;return o<0&&s<0?null:o<0?this.at(s,e):this.at(o,e)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;var r=-(this.origin.dot(t.normal)+t.constant)/e;return r>=0?r:null},intersectPlane:function(t,e){var r=this.distanceToPlane(t);return r===null?null:this.at(r,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var r,n,i,a,o,s,c=1/this.direction.x,l=1/this.direction.y,h=1/this.direction.z,m=this.origin;return c>=0?(r=(t.min.x-m.x)*c,n=(t.max.x-m.x)*c):(r=(t.max.x-m.x)*c,n=(t.min.x-m.x)*c),l>=0?(i=(t.min.y-m.y)*l,a=(t.max.y-m.y)*l):(i=(t.max.y-m.y)*l,a=(t.min.y-m.y)*l),r>a||i>n?null:((i>r||r!=r)&&(r=i),(a<n||n!=n)&&(n=a),h>=0?(o=(t.min.z-m.z)*h,s=(t.max.z-m.z)*h):(o=(t.max.z-m.z)*h,s=(t.min.z-m.z)*h),r>s||o>n?null:((o>r||r!=r)&&(r=o),(s<n||n!=n)&&(n=s),n<0?null:this.at(r>=0?r:n,e)))},intersectsBox:function(t){return this.intersectBox(t,ti)!==null},intersectTriangle:function(t,e,r,n,i){Rl.subVectors(e,t),qs.subVectors(r,t),Pl.crossVectors(Rl,qs);var a,o=this.direction.dot(Pl);if(o>0){if(n)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}vi.subVectors(this.origin,t);var s=a*this.direction.dot(qs.crossVectors(vi,qs));if(s<0)return null;var c=a*this.direction.dot(Rl.cross(vi));if(c<0)return null;if(s+c>o)return null;var l=-a*vi.dot(Pl);return l<0?null:this.at(l/o,i)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});var Cl=new q,mf=new q,vf=new kr;function Sn(t,e){this.normal=t!==void 0?t:new q(1,0,0),this.constant=e!==void 0?e:0}Object.assign(Sn.prototype,{isPlane:!0,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,r,n){return this.normal.set(t,e,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,r){var n=Cl.subVectors(r,e).cross(mf.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return e===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new q),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,e){e===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new q);var r=t.delta(Cl),n=this.normal.dot(r);if(n===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):void 0;var i=-(t.start.dot(this.normal)+this.constant)/n;return i<0||i>1?void 0:e.copy(r).multiplyScalar(i).add(t.start)},intersectsLine:function(t){var e=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return e<0&&r>0||r<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return t===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new q),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,e){var r=e||vf.getNormalMatrix(t),n=this.coplanarPoint(Cl).applyMatrix4(t),i=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(i),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});var Tn=new q,ei=new q,Ol=new q,ri=new q,Ea=new q,Aa=new q,Xh=new q,Dl=new q,Il=new q,Nl=new q;function Fr(t,e,r){this.a=t!==void 0?t:new q,this.b=e!==void 0?e:new q,this.c=r!==void 0?r:new q}Object.assign(Fr,{getNormal:function(t,e,r,n){n===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new q),n.subVectors(r,e),Tn.subVectors(t,e),n.cross(Tn);var i=n.lengthSq();return i>0?n.multiplyScalar(1/Math.sqrt(i)):n.set(0,0,0)},getBarycoord:function(t,e,r,n,i){Tn.subVectors(n,e),ei.subVectors(r,e),Ol.subVectors(t,e);var a=Tn.dot(Tn),o=Tn.dot(ei),s=Tn.dot(Ol),c=ei.dot(ei),l=ei.dot(Ol),h=a*c-o*o;if(i===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new q),h===0)return i.set(-2,-1,-1);var m=1/h,g=(c*s-o*l)*m,u=(a*l-o*s)*m;return i.set(1-g-u,u,g)},containsPoint:function(t,e,r,n){return Fr.getBarycoord(t,e,r,n,ri),ri.x>=0&&ri.y>=0&&ri.x+ri.y<=1},getUV:function(t,e,r,n,i,a,o,s){return this.getBarycoord(t,e,r,n,ri),s.set(0,0),s.addScaledVector(i,ri.x),s.addScaledVector(a,ri.y),s.addScaledVector(o,ri.z),s},isFrontFacing:function(t,e,r,n){return Tn.subVectors(r,e),ei.subVectors(t,e),Tn.cross(ei).dot(n)<0}}),Object.assign(Fr.prototype,{set:function(t,e,r){return this.a.copy(t),this.b.copy(e),this.c.copy(r),this},setFromPointsAndIndices:function(t,e,r,n){return this.a.copy(t[e]),this.b.copy(t[r]),this.c.copy(t[n]),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return Tn.subVectors(this.c,this.b),ei.subVectors(this.a,this.b),.5*Tn.cross(ei).length()},getMidpoint:function(t){return t===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new q),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return Fr.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return t===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Sn),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return Fr.getBarycoord(t,this.a,this.b,this.c,e)},getUV:function(t,e,r,n,i){return Fr.getUV(t,this.a,this.b,this.c,e,r,n,i)},containsPoint:function(t){return Fr.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return Fr.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,e){e===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new q);var r,n,i=this.a,a=this.b,o=this.c;Ea.subVectors(a,i),Aa.subVectors(o,i),Dl.subVectors(t,i);var s=Ea.dot(Dl),c=Aa.dot(Dl);if(s<=0&&c<=0)return e.copy(i);Il.subVectors(t,a);var l=Ea.dot(Il),h=Aa.dot(Il);if(l>=0&&h<=l)return e.copy(a);var m=s*h-l*c;if(m<=0&&s>=0&&l<=0)return r=s/(s-l),e.copy(i).addScaledVector(Ea,r);Nl.subVectors(t,o);var g=Ea.dot(Nl),u=Aa.dot(Nl);if(u>=0&&g<=u)return e.copy(o);var y=g*c-s*u;if(y<=0&&c>=0&&u<=0)return n=c/(c-u),e.copy(i).addScaledVector(Aa,n);var A=l*u-g*h;if(A<=0&&h-l>=0&&g-u>=0)return Xh.subVectors(o,a),n=(h-l)/(h-l+(g-u)),e.copy(a).addScaledVector(Xh,n);var M=1/(A+y+m);return r=y*M,n=m*M,e.copy(i).addScaledVector(Ea,r).addScaledVector(Aa,n)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});var Yh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},En={h:0,s:0,l:0},Xs={h:0,s:0,l:0};function we(t,e,r){return e===void 0&&r===void 0?this.set(t):this.setRGB(t,e,r)}function Bl(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}function Fl(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Ul(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}function La(t,e,r,n,i,a){this.a=t,this.b=e,this.c=r,this.normal=n&&n.isVector3?n:new q,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new we,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=a!==void 0?a:0}Object.assign(we.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,r){return this.r=t,this.g=e,this.b=r,this},setHSL:function(t,e,r){if(t=We.euclideanModulo(t,1),e=We.clamp(e,0,1),r=We.clamp(r,0,1),e===0)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+e):r+e-r*e,i=2*r-n;this.r=Bl(i,n,t+1/3),this.g=Bl(i,n,t),this.b=Bl(i,n,t-1/3)}return this},setStyle:function(t){function e(m){m!==void 0&&parseFloat(m)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,i=r[1],a=r[2];switch(i){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(n[1])/360,s=parseInt(n[2],10)/100,c=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(o,s,c)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(t)){var l=r[1],h=l.length;if(h===3)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(h===6)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this},setColorName:function(t){var e=Yh[t];return e!==void 0?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return e===void 0&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){e===void 0&&(e=2);var r=e>0?1/e:1;return this.r=Math.pow(t.r,r),this.g=Math.pow(t.g,r),this.b=Math.pow(t.b,r),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=Fl(t.r),this.g=Fl(t.g),this.b=Fl(t.b),this},copyLinearToSRGB:function(t){return this.r=Ul(t.r),this.g=Ul(t.g),this.b=Ul(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){t===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,r,n=this.r,i=this.g,a=this.b,o=Math.max(n,i,a),s=Math.min(n,i,a),c=(s+o)/2;if(s===o)e=0,r=0;else{var l=o-s;switch(r=c<=.5?l/(o+s):l/(2-o-s),o){case n:e=(i-a)/l+(i<a?6:0);break;case i:e=(a-n)/l+2;break;case a:e=(n-i)/l+4}e/=6}return t.h=e,t.s=r,t.l=c,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,r){return this.getHSL(En),En.h+=t,En.s+=e,En.l+=r,this.setHSL(En.h,En.s,En.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:function(t,e){this.getHSL(En),t.getHSL(Xs);var r=We.lerp(En.h,Xs.h,e),n=We.lerp(En.s,Xs.s,e),i=We.lerp(En.l,Xs.l,e);return this.setHSL(r,n,i),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return e===void 0&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}}),we.NAMES=Yh,Object.assign(La.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,r=t.vertexNormals.length;e<r;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,r=t.vertexColors.length;e<r;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var gf=0;function Ne(){Object.defineProperty(this,"id",{value:gf++}),this.uuid=We.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=ct,this.side=ut,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Pe,this.blendDst=Ve,this.blendEquation=At,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=$,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=zh,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=zs,this.stencilZFail=zs,this.stencilZPass=zs,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function hn(t){Ne.call(this),this.type="MeshBasicMaterial",this.color=new we(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}Ne.prototype=Object.assign(Object.create(Fn.prototype),{constructor:Ne,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(t!==void 0)for(var e in t){var r=t[e];if(r!==void 0)if(e!=="shading"){var n=this[e];n!==void 0?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[e]=r:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===U;else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(o){var s=[];for(var c in o){var l=o[c];delete l.metadata,s.push(l)}return s}if(r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(r.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,this.combine!==void 0&&(r.combine=this.combine),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),this.size!==void 0&&(r.size=this.size),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==ct&&(r.blending=this.blending),this.flatShading===!0&&(r.flatShading=this.flatShading),this.side!==ut&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(r.morphTargets=!0),this.morphNormals===!0&&(r.morphNormals=!0),this.skinning===!0&&(r.skinning=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),e){var i=n(t.textures),a=n(t.images);i.length>0&&(r.textures=i),a.length>0&&(r.images=a)}return r},clone:function(){return new this.constructor().copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var e=t.clippingPlanes,r=null;if(e!==null){var n=e.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=e[i].clone()}return this.clippingPlanes=r,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Ne.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}}),hn.prototype=Object.create(Ne.prototype),hn.prototype.constructor=hn,hn.prototype.isMeshBasicMaterial=!0,hn.prototype.copy=function(t){return Ne.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};var hr=new q;function Ie(t,e,r){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=r===!0,this.usage=Ao,this.updateRange={offset:0,count:-1},this.version=0}function Oo(t,e,r){Ie.call(this,new Int8Array(t),e,r)}function Do(t,e,r){Ie.call(this,new Uint8Array(t),e,r)}function Io(t,e,r){Ie.call(this,new Uint8ClampedArray(t),e,r)}function No(t,e,r){Ie.call(this,new Int16Array(t),e,r)}function Ui(t,e,r){Ie.call(this,new Uint16Array(t),e,r)}function Bo(t,e,r){Ie.call(this,new Int32Array(t),e,r)}function zi(t,e,r){Ie.call(this,new Uint32Array(t),e,r)}function pe(t,e,r){Ie.call(this,new Float32Array(t),e,r)}function Fo(t,e,r){Ie.call(this,new Float64Array(t),e,r)}function Zh(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Jh(t){if(t.length===0)return-1/0;let e=t[0];for(let r=1,n=t.length;r<n;++r)t[r]>e&&(e=t[r]);return e}Object.defineProperty(Ie.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}}),Object.assign(Ie.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,r){t*=this.itemSize,r*=e.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[t+n]=e.array[r+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var a=t[n];a===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),a=new we),e[r++]=a.r,e[r++]=a.g,e[r++]=a.b}return this},copyVector2sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var a=t[n];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),a=new Wt),e[r++]=a.x,e[r++]=a.y}return this},copyVector3sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var a=t[n];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),a=new q),e[r++]=a.x,e[r++]=a.y,e[r++]=a.z}return this},copyVector4sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var a=t[n];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),a=new er),e[r++]=a.x,e[r++]=a.y,e[r++]=a.z,e[r++]=a.w}return this},applyMatrix3:function(t){for(var e=0,r=this.count;e<r;e++)hr.x=this.getX(e),hr.y=this.getY(e),hr.z=this.getZ(e),hr.applyMatrix3(t),this.setXYZ(e,hr.x,hr.y,hr.z);return this},applyMatrix4:function(t){for(var e=0,r=this.count;e<r;e++)hr.x=this.getX(e),hr.y=this.getY(e),hr.z=this.getZ(e),hr.applyMatrix4(t),this.setXYZ(e,hr.x,hr.y,hr.z);return this},applyNormalMatrix:function(t){for(var e=0,r=this.count;e<r;e++)hr.x=this.getX(e),hr.y=this.getY(e),hr.z=this.getZ(e),hr.applyNormalMatrix(t),this.setXYZ(e,hr.x,hr.y,hr.z);return this},transformDirection:function(t){for(var e=0,r=this.count;e<r;e++)hr.x=this.getX(e),hr.y=this.getY(e),hr.z=this.getZ(e),hr.transformDirection(t),this.setXYZ(e,hr.x,hr.y,hr.z);return this},set:function(t,e){return e===void 0&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this},setXYZ:function(t,e,r,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Oo.prototype=Object.create(Ie.prototype),Oo.prototype.constructor=Oo,Do.prototype=Object.create(Ie.prototype),Do.prototype.constructor=Do,Io.prototype=Object.create(Ie.prototype),Io.prototype.constructor=Io,No.prototype=Object.create(Ie.prototype),No.prototype.constructor=No,Ui.prototype=Object.create(Ie.prototype),Ui.prototype.constructor=Ui,Bo.prototype=Object.create(Ie.prototype),Bo.prototype.constructor=Bo,zi.prototype=Object.create(Ie.prototype),zi.prototype.constructor=zi,pe.prototype=Object.create(Ie.prototype),pe.prototype.constructor=pe,Fo.prototype=Object.create(Ie.prototype),Fo.prototype.constructor=Fo,Object.assign(Zh.prototype,{computeGroups:function(t){for(var e,r=[],n=void 0,i=t.faces,a=0;a<i.length;a++){var o=i[a];o.materialIndex!==n&&(n=o.materialIndex,e!==void 0&&(e.count=3*a-e.start,r.push(e)),e={start:3*a,materialIndex:n})}e!==void 0&&(e.count=3*a-e.start,r.push(e)),this.groups=r},fromGeometry:function(t){var e,r=t.faces,n=t.vertices,i=t.faceVertexUvs,a=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=t.morphTargets,c=s.length;if(c>0){e=[];for(var l=0;l<c;l++)e[l]={name:s[l].name,data:[]};this.morphTargets.position=e}var h,m=t.morphNormals,g=m.length;if(g>0){for(h=[],l=0;l<g;l++)h[l]={name:m[l].name,data:[]};this.morphTargets.normal=h}var u=t.skinIndices,y=t.skinWeights,A=u.length===n.length,M=y.length===n.length;for(n.length>0&&r.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported."),l=0;l<r.length;l++){var N=r[l];this.vertices.push(n[N.a],n[N.b],n[N.c]);var j=N.vertexNormals;if(j.length===3)this.normals.push(j[0],j[1],j[2]);else{var k=N.normal;this.normals.push(k,k,k)}var ot,nt=N.vertexColors;if(nt.length===3)this.colors.push(nt[0],nt[1],nt[2]);else{var gt=N.color;this.colors.push(gt,gt,gt)}a===!0&&((ot=i[0][l])!==void 0?this.uvs.push(ot[0],ot[1],ot[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",l),this.uvs.push(new Wt,new Wt,new Wt))),o===!0&&((ot=i[1][l])!==void 0?this.uvs2.push(ot[0],ot[1],ot[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",l),this.uvs2.push(new Wt,new Wt,new Wt)));for(var yt=0;yt<c;yt++){var Gt=s[yt].vertices;e[yt].data.push(Gt[N.a],Gt[N.b],Gt[N.c])}for(yt=0;yt<g;yt++){var st=m[yt].vertexNormals[l];h[yt].data.push(st.a,st.b,st.c)}A&&this.skinIndices.push(u[N.a],u[N.b],u[N.c]),M&&this.skinWeights.push(y[N.a],y[N.b],y[N.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),this}});var yf=1,zn=new Xe,zl=new ge,Ra=new q,on=new Mn,Uo=new Mn,Cr=new q;function _e(){Object.defineProperty(this,"id",{value:yf+=2}),this.uuid=We.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}_e.prototype=Object.assign(Object.create(Fn.prototype),{constructor:_e,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(Jh(t)>65535?zi:Ui)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,r){this.groups.push({start:t,count:e,materialIndex:r!==void 0?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){var e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);var r=this.attributes.normal;if(r!==void 0){var n=new kr().getNormalMatrix(t);r.applyNormalMatrix(n),r.needsUpdate=!0}var i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(t),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(t){return zn.makeRotationX(t),this.applyMatrix4(zn),this},rotateY:function(t){return zn.makeRotationY(t),this.applyMatrix4(zn),this},rotateZ:function(t){return zn.makeRotationZ(t),this.applyMatrix4(zn),this},translate:function(t,e,r){return zn.makeTranslation(t,e,r),this.applyMatrix4(zn),this},scale:function(t,e,r){return zn.makeScale(t,e,r),this.applyMatrix4(zn),this},lookAt:function(t){return zl.lookAt(t),zl.updateMatrix(),this.applyMatrix4(zl.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ra).negate(),this.translate(Ra.x,Ra.y,Ra.z),this},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var r=new pe(3*e.vertices.length,3),n=new pe(3*e.colors.length,3);if(this.setAttribute("position",r.copyVector3sArray(e.vertices)),this.setAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var i=new pe(e.lineDistances.length,1);this.setAttribute("lineDistance",i.copyArray(e.lineDistances))}e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new pe(e,3)),this},updateFromObject:function(t){var e,r=t.geometry;if(t.isMesh){var n=r.__directGeometry;if(r.elementsNeedUpdate===!0&&(n=void 0,r.elementsNeedUpdate=!1),n===void 0)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return r.verticesNeedUpdate===!0&&((e=this.attributes.position)!==void 0&&(e.copyVector3sArray(r.vertices),e.needsUpdate=!0),r.verticesNeedUpdate=!1),r.normalsNeedUpdate===!0&&((e=this.attributes.normal)!==void 0&&(e.copyVector3sArray(r.normals),e.needsUpdate=!0),r.normalsNeedUpdate=!1),r.colorsNeedUpdate===!0&&((e=this.attributes.color)!==void 0&&(e.copyColorsArray(r.colors),e.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&((e=this.attributes.uv)!==void 0&&(e.copyVector2sArray(r.uvs),e.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&((e=this.attributes.lineDistance)!==void 0&&(e.copyArray(r.lineDistances),e.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(t.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=new Zh().fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new Ie(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var r=new Float32Array(3*t.normals.length);this.setAttribute("normal",new Ie(r,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var n=new Float32Array(3*t.colors.length);this.setAttribute("color",new Ie(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var i=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new Ie(i,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var a=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new Ie(a,2).copyVector2sArray(t.uvs2))}for(var o in this.groups=t.groups,t.morphTargets){for(var s=[],c=t.morphTargets[o],l=0,h=c.length;l<h;l++){var m=c[l],g=new pe(3*m.data.length,3);g.name=m.name,s.push(g.copyVector3sArray(m.data))}this.morphAttributes[o]=s}if(t.skinIndices.length>0){var u=new pe(4*t.skinIndices.length,4);this.setAttribute("skinIndex",u.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var y=new pe(4*t.skinWeights.length,4);this.setAttribute("skinWeight",y.copyVector4sArray(t.skinWeights))}return t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Mn);var t=this.attributes.position,e=this.morphAttributes.position;if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(var r=0,n=e.length;r<n;r++){var i=e[r];on.setFromBufferAttribute(i),this.morphTargetsRelative?(Cr.addVectors(this.boundingBox.min,on.min),this.boundingBox.expandByPoint(Cr),Cr.addVectors(this.boundingBox.max,on.max),this.boundingBox.expandByPoint(Cr)):(this.boundingBox.expandByPoint(on.min),this.boundingBox.expandByPoint(on.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Un);var t=this.attributes.position,e=this.morphAttributes.position;if(t){var r=this.boundingSphere.center;if(on.setFromBufferAttribute(t),e)for(var n=0,i=e.length;n<i;n++){var a=e[n];Uo.setFromBufferAttribute(a),this.morphTargetsRelative?(Cr.addVectors(on.min,Uo.min),on.expandByPoint(Cr),Cr.addVectors(on.max,Uo.max),on.expandByPoint(Cr)):(on.expandByPoint(Uo.min),on.expandByPoint(Uo.max))}on.getCenter(r);var o=0;for(n=0,i=t.count;n<i;n++)Cr.fromBufferAttribute(t,n),o=Math.max(o,r.distanceToSquared(Cr));if(e)for(n=0,i=e.length;n<i;n++){a=e[n];for(var s=this.morphTargetsRelative,c=0,l=a.count;c<l;c++)Cr.fromBufferAttribute(a,c),s&&(Ra.fromBufferAttribute(t,c),Cr.add(Ra)),o=Math.max(o,r.distanceToSquared(Cr))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes;if(e.position){var r=e.position.array;if(e.normal===void 0)this.setAttribute("normal",new Ie(new Float32Array(r.length),3));else for(var n=e.normal.array,i=0,a=n.length;i<a;i++)n[i]=0;var o,s,c,l=e.normal.array,h=new q,m=new q,g=new q,u=new q,y=new q;if(t){var A=t.array;for(i=0,a=t.count;i<a;i+=3)o=3*A[i+0],s=3*A[i+1],c=3*A[i+2],h.fromArray(r,o),m.fromArray(r,s),g.fromArray(r,c),u.subVectors(g,m),y.subVectors(h,m),u.cross(y),l[o]+=u.x,l[o+1]+=u.y,l[o+2]+=u.z,l[s]+=u.x,l[s+1]+=u.y,l[s+2]+=u.z,l[c]+=u.x,l[c+1]+=u.y,l[c+2]+=u.z}else for(i=0,a=r.length;i<a;i+=9)h.fromArray(r,i),m.fromArray(r,i+3),g.fromArray(r,i+6),u.subVectors(g,m),y.subVectors(h,m),u.cross(y),l[i]=u.x,l[i+1]=u.y,l[i+2]=u.z,l[i+3]=u.x,l[i+4]=u.y,l[i+5]=u.z,l[i+6]=u.x,l[i+7]=u.y,l[i+8]=u.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){e===void 0&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(t.attributes[n]!==void 0)for(var i=r[n].array,a=t.attributes[n],o=a.array,s=a.itemSize*e,c=Math.min(o.length,i.length-s),l=0,h=s;l<c;l++,h++)i[h]=o[l];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){for(var t=this.attributes.normal,e=0,r=t.count;e<r;e++)Cr.x=t.getX(e),Cr.y=t.getY(e),Cr.z=t.getZ(e),Cr.normalize(),t.setXYZ(e,Cr.x,Cr.y,Cr.z)},toNonIndexed:function(){function t(y,A){for(var M=y.array,N=y.itemSize,j=y.normalized,k=new M.constructor(A.length*N),ot=0,nt=0,gt=0,yt=A.length;gt<yt;gt++){ot=A[gt]*N;for(var Gt=0;Gt<N;Gt++)k[nt++]=M[ot++]}return new Ie(k,N,j)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new _e,r=this.index.array,n=this.attributes;for(var i in n){var a=t(n[i],r);e.setAttribute(i,a)}var o=this.morphAttributes;for(i in o){for(var s=[],c=o[i],l=0,h=c.length;l<h;l++)a=t(c[l],r),s.push(a);e.morphAttributes[i]=s}e.morphTargetsRelative=this.morphTargetsRelative;for(var m=this.groups,g=(l=0,m.length);l<g;l++){var u=m[l];e.addGroup(u.start,u.count,u.materialIndex)}return e},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){var e=this.parameters;for(var r in e)e[r]!==void 0&&(t[r]=e[r]);return t}t.data={attributes:{}};var n=this.index;n!==null&&(t.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});var i=this.attributes;for(var r in i){var a=(g=i[r]).toJSON();g.name!==""&&(a.name=g.name),t.data.attributes[r]=a}var o={},s=!1;for(var r in this.morphAttributes){for(var c=this.morphAttributes[r],l=[],h=0,m=c.length;h<m;h++){var g;a=(g=c[h]).toJSON(),g.name!==""&&(a.name=g.name),l.push(a)}l.length>0&&(o[r]=l,s=!0)}s&&(t.data.morphAttributes=o,t.data.morphTargetsRelative=this.morphTargetsRelative);var u=this.groups;u.length>0&&(t.data.groups=JSON.parse(JSON.stringify(u)));var y=this.boundingSphere;return y!==null&&(t.data.boundingSphere={center:y.center.toArray(),radius:y.radius}),t},clone:function(){return new _e().copy(this)},copy:function(t){var e,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var i=t.index;i!==null&&this.setIndex(i.clone());var a=t.attributes;for(e in a){var o=a[e];this.setAttribute(e,o.clone())}var s=t.morphAttributes;for(e in s){var c=[],l=s[e];for(r=0,n=l.length;r<n;r++)c.push(l[r].clone());this.morphAttributes[e]=c}this.morphTargetsRelative=t.morphTargetsRelative;var h=t.groups;for(r=0,n=h.length;r<n;r++){var m=h[r];this.addGroup(m.start,m.count,m.materialIndex)}var g=t.boundingBox;g!==null&&(this.boundingBox=g.clone());var u=t.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Kh=new Xe,Gi=new Fi,Gl=new Un,gi=new q,yi=new q,xi=new q,Vl=new q,kl=new q,Hl=new q,Ys=new q,Zs=new q,Js=new q,Pa=new Wt,Ca=new Wt,Oa=new Wt,zo=new q,Ks=new q;function br(t,e){ge.call(this),this.type="Mesh",this.geometry=t!==void 0?t:new _e,this.material=e!==void 0?e:new hn,this.updateMorphTargets()}function Qh(t,e,r,n,i,a,o,s){if((e.side===x?n.intersectTriangle(o,a,i,!0,s):n.intersectTriangle(i,a,o,e.side!==S,s))===null)return null;Ks.copy(s),Ks.applyMatrix4(t.matrixWorld);var c=r.ray.origin.distanceTo(Ks);return c<r.near||c>r.far?null:{distance:c,point:Ks.clone(),object:t}}function Qs(t,e,r,n,i,a,o,s,c,l,h,m){gi.fromBufferAttribute(i,l),yi.fromBufferAttribute(i,h),xi.fromBufferAttribute(i,m);var g=t.morphTargetInfluences;if(e.morphTargets&&a&&g){Ys.set(0,0,0),Zs.set(0,0,0),Js.set(0,0,0);for(var u=0,y=a.length;u<y;u++){var A=g[u],M=a[u];A!==0&&(Vl.fromBufferAttribute(M,l),kl.fromBufferAttribute(M,h),Hl.fromBufferAttribute(M,m),o?(Ys.addScaledVector(Vl,A),Zs.addScaledVector(kl,A),Js.addScaledVector(Hl,A)):(Ys.addScaledVector(Vl.sub(gi),A),Zs.addScaledVector(kl.sub(yi),A),Js.addScaledVector(Hl.sub(xi),A)))}gi.add(Ys),yi.add(Zs),xi.add(Js)}t.isSkinnedMesh&&(t.boneTransform(l,gi),t.boneTransform(h,yi),t.boneTransform(m,xi));var N=Qh(t,e,r,n,gi,yi,xi,zo);if(N){s&&(Pa.fromBufferAttribute(s,l),Ca.fromBufferAttribute(s,h),Oa.fromBufferAttribute(s,m),N.uv=Fr.getUV(zo,gi,yi,xi,Pa,Ca,Oa,new Wt)),c&&(Pa.fromBufferAttribute(c,l),Ca.fromBufferAttribute(c,h),Oa.fromBufferAttribute(c,m),N.uv2=Fr.getUV(zo,gi,yi,xi,Pa,Ca,Oa,new Wt));var j=new La(l,h,m);Fr.getNormal(gi,yi,xi,j.normal),N.face=j}return N}br.prototype=Object.assign(Object.create(ge.prototype),{constructor:br,isMesh:!0,copy:function(t){return ge.prototype.copy.call(this,t),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,e,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(o!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=o.length;t<e;t++)r=o[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var s=n.morphTargets;s!==void 0&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){var r,n=this.geometry,i=this.material,a=this.matrixWorld;if(i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Gl.copy(n.boundingSphere),Gl.applyMatrix4(a),t.ray.intersectsSphere(Gl)!==!1&&(Kh.getInverse(a),Gi.copy(t.ray).applyMatrix4(Kh),n.boundingBox===null||Gi.intersectsBox(n.boundingBox)!==!1))){if(n.isBufferGeometry){var o,s,c,l,h,m,g,u,y,A=n.index,M=n.attributes.position,N=n.morphAttributes.position,j=n.morphTargetsRelative,k=n.attributes.uv,ot=n.attributes.uv2,nt=n.groups,gt=n.drawRange;if(A!==null)if(Array.isArray(i))for(l=0,m=nt.length;l<m;l++)for(y=i[(u=nt[l]).materialIndex],h=Math.max(u.start,gt.start),g=Math.min(u.start+u.count,gt.start+gt.count);h<g;h+=3)o=A.getX(h),s=A.getX(h+1),c=A.getX(h+2),(r=Qs(this,y,t,Gi,M,N,j,k,ot,o,s,c))&&(r.faceIndex=Math.floor(h/3),r.face.materialIndex=u.materialIndex,e.push(r));else for(l=Math.max(0,gt.start),m=Math.min(A.count,gt.start+gt.count);l<m;l+=3)o=A.getX(l),s=A.getX(l+1),c=A.getX(l+2),(r=Qs(this,i,t,Gi,M,N,j,k,ot,o,s,c))&&(r.faceIndex=Math.floor(l/3),e.push(r));else if(M!==void 0)if(Array.isArray(i))for(l=0,m=nt.length;l<m;l++)for(y=i[(u=nt[l]).materialIndex],h=Math.max(u.start,gt.start),g=Math.min(u.start+u.count,gt.start+gt.count);h<g;h+=3)(r=Qs(this,y,t,Gi,M,N,j,k,ot,o=h,s=h+1,c=h+2))&&(r.faceIndex=Math.floor(h/3),r.face.materialIndex=u.materialIndex,e.push(r));else for(l=Math.max(0,gt.start),m=Math.min(M.count,gt.start+gt.count);l<m;l+=3)(r=Qs(this,i,t,Gi,M,N,j,k,ot,o=l,s=l+1,c=l+2))&&(r.faceIndex=Math.floor(l/3),e.push(r))}else if(n.isGeometry){var yt,Gt,st,Nt,Bt=Array.isArray(i),jt=n.vertices,xe=n.faces,ae=n.faceVertexUvs[0];ae.length>0&&(Nt=ae);for(var Rt=0,Zt=xe.length;Rt<Zt;Rt++){var qt=xe[Rt],Ht=Bt?i[qt.materialIndex]:i;if(Ht!==void 0&&(yt=jt[qt.a],Gt=jt[qt.b],st=jt[qt.c],r=Qh(this,Ht,t,Gi,yt,Gt,st,zo))){if(Nt&&Nt[Rt]){var Kt=Nt[Rt];Pa.copy(Kt[0]),Ca.copy(Kt[1]),Oa.copy(Kt[2]),r.uv=Fr.getUV(zo,yt,Gt,st,Pa,Ca,Oa,new Wt)}r.face=qt,r.faceIndex=Rt,e.push(r)}}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var xf=0,Gn=new Xe,jl=new ge,$s=new q;function Be(){Object.defineProperty(this,"id",{value:xf+=2}),this.uuid=We.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Be.prototype=Object.assign(Object.create(Fn.prototype),{constructor:Be,isGeometry:!0,applyMatrix4:function(t){for(var e=new kr().getNormalMatrix(t),r=0,n=this.vertices.length;r<n;r++)this.vertices[r].applyMatrix4(t);for(r=0,n=this.faces.length;r<n;r++){var i=this.faces[r];i.normal.applyMatrix3(e).normalize();for(var a=0,o=i.vertexNormals.length;a<o;a++)i.vertexNormals[a].applyMatrix3(e).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return Gn.makeRotationX(t),this.applyMatrix4(Gn),this},rotateY:function(t){return Gn.makeRotationY(t),this.applyMatrix4(Gn),this},rotateZ:function(t){return Gn.makeRotationZ(t),this.applyMatrix4(Gn),this},translate:function(t,e,r){return Gn.makeTranslation(t,e,r),this.applyMatrix4(Gn),this},scale:function(t,e,r){return Gn.makeScale(t,e,r),this.applyMatrix4(Gn),this},lookAt:function(t){return jl.lookAt(t),jl.updateMatrix(),this.applyMatrix4(jl.matrix),this},fromBufferGeometry:function(t){var e=this,r=t.index!==null?t.index.array:void 0,n=t.attributes;if(n.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var i=n.position.array,a=n.normal!==void 0?n.normal.array:void 0,o=n.color!==void 0?n.color.array:void 0,s=n.uv!==void 0?n.uv.array:void 0,c=n.uv2!==void 0?n.uv2.array:void 0;c!==void 0&&(this.faceVertexUvs[1]=[]);for(var l=0;l<i.length;l+=3)e.vertices.push(new q().fromArray(i,l)),o!==void 0&&e.colors.push(new we().fromArray(o,l));function h(M,N,j,k){var ot=o===void 0?[]:[e.colors[M].clone(),e.colors[N].clone(),e.colors[j].clone()],nt=new La(M,N,j,a===void 0?[]:[new q().fromArray(a,3*M),new q().fromArray(a,3*N),new q().fromArray(a,3*j)],ot,k);e.faces.push(nt),s!==void 0&&e.faceVertexUvs[0].push([new Wt().fromArray(s,2*M),new Wt().fromArray(s,2*N),new Wt().fromArray(s,2*j)]),c!==void 0&&e.faceVertexUvs[1].push([new Wt().fromArray(c,2*M),new Wt().fromArray(c,2*N),new Wt().fromArray(c,2*j)])}var m=t.groups;if(m.length>0)for(l=0;l<m.length;l++)for(var g=m[l],u=g.start,y=u,A=u+g.count;y<A;y+=3)r!==void 0?h(r[y],r[y+1],r[y+2],g.materialIndex):h(y,y+1,y+2,g.materialIndex);else if(r!==void 0)for(l=0;l<r.length;l+=3)h(r[l],r[l+1],r[l+2]);else for(l=0;l<i.length/3;l+=3)h(l,l+1,l+2);return this.computeFaceNormals(),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter($s).negate(),this.translate($s.x,$s.y,$s.z),this},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,r=e===0?1:1/e,n=new Xe;return n.set(r,0,0,-r*t.x,0,r,0,-r*t.y,0,0,r,-r*t.z,0,0,0,1),this.applyMatrix4(n),this},computeFaceNormals:function(){for(var t=new q,e=new q,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],a=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];t.subVectors(s,o),e.subVectors(a,o),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){var e,r,n,i,a,o;for(t===void 0&&(t=!0),o=new Array(this.vertices.length),e=0,r=this.vertices.length;e<r;e++)o[e]=new q;if(t){var s,c,l,h=new q,m=new q;for(n=0,i=this.faces.length;n<i;n++)a=this.faces[n],s=this.vertices[a.a],c=this.vertices[a.b],l=this.vertices[a.c],h.subVectors(l,c),m.subVectors(s,c),h.cross(m),o[a.a].add(h),o[a.b].add(h),o[a.c].add(h)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)o[(a=this.faces[n]).a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(e=0,r=this.vertices.length;e<r;e++)o[e].normalize();for(n=0,i=this.faces.length;n<i;n++){var g=(a=this.faces[n]).vertexNormals;g.length===3?(g[0].copy(o[a.a]),g[1].copy(o[a.b]),g[2].copy(o[a.c])):(g[0]=o[a.a].clone(),g[1]=o[a.b].clone(),g[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,r;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var n=(r=this.faces[t]).vertexNormals;n.length===3?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),t=0,e=i.vertexNormals.length;t<e;t++)i.__originalVertexNormals[t]?i.__originalVertexNormals[t].copy(i.vertexNormals[t]):i.__originalVertexNormals[t]=i.vertexNormals[t].clone();var a=new Be;for(a.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var o=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)c=new q,l={a:new q,b:new q,c:new q},o.push(c),s.push(l)}var c,l,h=this.morphNormals[t];for(a.vertices=this.morphTargets[t].vertices,a.computeFaceNormals(),a.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)i=this.faces[r],c=h.faceNormals[r],l=h.vertexNormals[r],c.copy(i.normal),l.a.copy(i.vertexNormals[0]),l.b.copy(i.vertexNormals[1]),l.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Mn),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Un),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,r){if(t&&t.isGeometry){var n,i=this.vertices.length,a=this.vertices,o=t.vertices,s=this.faces,c=t.faces,l=this.colors,h=t.colors;r===void 0&&(r=0),e!==void 0&&(n=new kr().getNormalMatrix(e));for(var m=0,g=o.length;m<g;m++){var u=o[m].clone();e!==void 0&&u.applyMatrix4(e),a.push(u)}for(m=0,g=h.length;m<g;m++)l.push(h[m].clone());for(m=0,g=c.length;m<g;m++){var y,A,M,N=c[m],j=N.vertexNormals,k=N.vertexColors;(y=new La(N.a+i,N.b+i,N.c+i)).normal.copy(N.normal),n!==void 0&&y.normal.applyMatrix3(n).normalize();for(var ot=0,nt=j.length;ot<nt;ot++)A=j[ot].clone(),n!==void 0&&A.applyMatrix3(n).normalize(),y.vertexNormals.push(A);for(y.color.copy(N.color),ot=0,nt=k.length;ot<nt;ot++)M=k[ot],y.vertexColors.push(M.clone());y.materialIndex=N.materialIndex+r,s.push(y)}for(m=0,g=t.faceVertexUvs.length;m<g;m++){var gt=t.faceVertexUvs[m];for(this.faceVertexUvs[m]===void 0&&(this.faceVertexUvs[m]=[]),ot=0,nt=gt.length;ot<nt;ot++){for(var yt=gt[ot],Gt=[],st=0,Nt=yt.length;st<Nt;st++)Gt.push(yt[st].clone());this.faceVertexUvs[m].push(Gt)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e,r,n,i,a,o,s,c={},l=[],h=[],m=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)t=this.vertices[r],c[e=Math.round(t.x*m)+"_"+Math.round(t.y*m)+"_"+Math.round(t.z*m)]===void 0?(c[e]=r,l.push(this.vertices[r]),h[r]=l.length-1):h[r]=h[c[e]];var g=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=h[i.a],i.b=h[i.b],i.c=h[i.c],a=[i.a,i.b,i.c];for(var u=0;u<3;u++)if(a[u]===a[(u+1)%3]){g.push(r);break}}for(r=g.length-1;r>=0;r--){var y=g[r];for(this.faces.splice(y,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(y,1)}var A=this.vertices.length-l.length;return this.vertices=l,A},setFromPoints:function(t){this.vertices=[];for(var e=0,r=t.length;e<r;e++){var n=t[e];this.vertices.push(new q(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,r=0;r<e;r++)t[r]._id=r;t.sort(function(c,l){return c.materialIndex-l.materialIndex});var n,i,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];for(a&&a.length===e&&(n=[]),o&&o.length===e&&(i=[]),r=0;r<e;r++){var s=t[r]._id;n&&n.push(a[s]),i&&i.push(o[s])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),this.parameters!==void 0){var e=this.parameters;for(var r in e)e[r]!==void 0&&(t[r]=e[r]);return t}for(var n=[],i=0;i<this.vertices.length;i++){var a=this.vertices[i];n.push(a.x,a.y,a.z)}var o=[],s=[],c={},l=[],h={},m=[],g={};for(i=0;i<this.faces.length;i++){var u=this.faces[i],y=this.faceVertexUvs[0][i]!==void 0,A=u.normal.length()>0,M=u.vertexNormals.length>0,N=u.color.r!==1||u.color.g!==1||u.color.b!==1,j=u.vertexColors.length>0,k=0;if(k=yt(k,0,0),k=yt(k,1,!0),k=yt(k,2,!1),k=yt(k,3,y),k=yt(k,4,A),k=yt(k,5,M),k=yt(k,6,N),k=yt(k,7,j),o.push(k),o.push(u.a,u.b,u.c),o.push(u.materialIndex),y){var ot=this.faceVertexUvs[0][i];o.push(Nt(ot[0]),Nt(ot[1]),Nt(ot[2]))}if(A&&o.push(Gt(u.normal)),M){var nt=u.vertexNormals;o.push(Gt(nt[0]),Gt(nt[1]),Gt(nt[2]))}if(N&&o.push(st(u.color)),j){var gt=u.vertexColors;o.push(st(gt[0]),st(gt[1]),st(gt[2]))}}function yt(Bt,jt,xe){return xe?Bt|1<<jt:Bt&~(1<<jt)}function Gt(Bt){var jt=Bt.x.toString()+Bt.y.toString()+Bt.z.toString();return c[jt]!==void 0||(c[jt]=s.length/3,s.push(Bt.x,Bt.y,Bt.z)),c[jt]}function st(Bt){var jt=Bt.r.toString()+Bt.g.toString()+Bt.b.toString();return h[jt]!==void 0||(h[jt]=l.length,l.push(Bt.getHex())),h[jt]}function Nt(Bt){var jt=Bt.x.toString()+Bt.y.toString();return g[jt]!==void 0||(g[jt]=m.length/2,m.push(Bt.x,Bt.y)),g[jt]}return t.data={},t.data.vertices=n,t.data.normals=s,l.length>0&&(t.data.colors=l),m.length>0&&(t.data.uvs=[m]),t.data.faces=o,t},clone:function(){return new Be().copy(this)},copy:function(t){var e,r,n,i,a,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var s=t.vertices;for(e=0,r=s.length;e<r;e++)this.vertices.push(s[e].clone());var c=t.colors;for(e=0,r=c.length;e<r;e++)this.colors.push(c[e].clone());var l=t.faces;for(e=0,r=l.length;e<r;e++)this.faces.push(l[e].clone());for(e=0,r=t.faceVertexUvs.length;e<r;e++){var h=t.faceVertexUvs[e];for(this.faceVertexUvs[e]===void 0&&(this.faceVertexUvs[e]=[]),n=0,i=h.length;n<i;n++){var m=h[n],g=[];for(a=0,o=m.length;a<o;a++){var u=m[a];g.push(u.clone())}this.faceVertexUvs[e].push(g)}}var y=t.morphTargets;for(e=0,r=y.length;e<r;e++){var A={};if(A.name=y[e].name,y[e].vertices!==void 0)for(A.vertices=[],n=0,i=y[e].vertices.length;n<i;n++)A.vertices.push(y[e].vertices[n].clone());if(y[e].normals!==void 0)for(A.normals=[],n=0,i=y[e].normals.length;n<i;n++)A.normals.push(y[e].normals[n].clone());this.morphTargets.push(A)}var M=t.morphNormals;for(e=0,r=M.length;e<r;e++){var N={};if(M[e].vertexNormals!==void 0)for(N.vertexNormals=[],n=0,i=M[e].vertexNormals.length;n<i;n++){var j=M[e].vertexNormals[n],k={};k.a=j.a.clone(),k.b=j.b.clone(),k.c=j.c.clone(),N.vertexNormals.push(k)}if(M[e].faceNormals!==void 0)for(N.faceNormals=[],n=0,i=M[e].faceNormals.length;n<i;n++)N.faceNormals.push(M[e].faceNormals[n].clone());this.morphNormals.push(N)}var ot=t.skinWeights;for(e=0,r=ot.length;e<r;e++)this.skinWeights.push(ot[e].clone());var nt=t.skinIndices;for(e=0,r=nt.length;e<r;e++)this.skinIndices.push(nt[e].clone());var gt=t.lineDistances;for(e=0,r=gt.length;e<r;e++)this.lineDistances.push(gt[e]);var yt=t.boundingBox;yt!==null&&(this.boundingBox=yt.clone());var Gt=t.boundingSphere;return Gt!==null&&(this.boundingSphere=Gt.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class Wl extends Be{constructor(t,e,r,n,i,a){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:a},this.fromBufferGeometry(new Go(t,e,r,n,i,a)),this.mergeVertices()}}class Go extends _e{constructor(t,e,r,n,i,a){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:a};const o=this;t=t||1,e=e||1,r=r||1,n=Math.floor(n)||1,i=Math.floor(i)||1,a=Math.floor(a)||1;const s=[],c=[],l=[],h=[];let m=0,g=0;function u(y,A,M,N,j,k,ot,nt,gt,yt,Gt){const st=k/gt,Nt=ot/yt,Bt=k/2,jt=ot/2,xe=nt/2,ae=gt+1,Rt=yt+1;let Zt=0,qt=0;const Ht=new q;for(let Kt=0;Kt<Rt;Kt++){const be=Kt*Nt-jt;for(let Oe=0;Oe<ae;Oe++){const Ge=Oe*st-Bt;Ht[y]=Ge*N,Ht[A]=be*j,Ht[M]=xe,c.push(Ht.x,Ht.y,Ht.z),Ht[y]=0,Ht[A]=0,Ht[M]=nt>0?1:-1,l.push(Ht.x,Ht.y,Ht.z),h.push(Oe/gt),h.push(1-Kt/yt),Zt+=1}}for(let Kt=0;Kt<yt;Kt++)for(let be=0;be<gt;be++){const Oe=m+be+ae*Kt,Ge=m+be+ae*(Kt+1),K=m+(be+1)+ae*(Kt+1),lt=m+(be+1)+ae*Kt;s.push(Oe,Ge,lt),s.push(Ge,K,lt),qt+=6}o.addGroup(g,qt,Gt),g+=qt,m+=Zt}u("z","y","x",-1,-1,r,e,t,a,i,0),u("z","y","x",1,-1,r,e,-t,a,i,1),u("x","z","y",1,1,t,r,e,n,a,2),u("x","z","y",1,-1,t,r,-e,n,a,3),u("x","y","z",1,-1,t,e,r,n,i,4),u("x","y","z",-1,-1,t,e,-r,n,i,5),this.setIndex(s),this.setAttribute("position",new pe(c,3)),this.setAttribute("normal",new pe(l,3)),this.setAttribute("uv",new pe(h,2))}}function Da(t){var e={};for(var r in t)for(var n in e[r]={},t[r]){var i=t[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?e[r][n]=i.clone():Array.isArray(i)?e[r][n]=i.slice():e[r][n]=i}return e}function Hr(t){for(var e={},r=0;r<t.length;r++){var n=Da(t[r]);for(var i in n)e[i]=n[i]}return e}var $h={clone:Da,merge:Hr};function Zr(t){Ne.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,t!==void 0&&(t.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function Vn(){ge.call(this),this.type="Camera",this.matrixWorldInverse=new Xe,this.projectionMatrix=new Xe,this.projectionMatrixInverse=new Xe}function Or(t,e,r,n){Vn.call(this),this.type="PerspectiveCamera",this.fov=t!==void 0?t:50,this.zoom=1,this.near=r!==void 0?r:.1,this.far=n!==void 0?n:2e3,this.focus=10,this.aspect=e!==void 0?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Zr.prototype=Object.create(Ne.prototype),Zr.prototype.constructor=Zr,Zr.prototype.isShaderMaterial=!0,Zr.prototype.copy=function(t){return Ne.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Da(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this},Zr.prototype.toJSON=function(t){var e=Ne.prototype.toJSON.call(this,t);for(var r in e.uniforms={},this.uniforms){var n=this.uniforms[r].value;n&&n.isTexture?e.uniforms[r]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[r]={type:"m4",value:n.toArray()}:e.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;var i={};for(var a in this.extensions)this.extensions[a]===!0&&(i[a]=!0);return Object.keys(i).length>0&&(e.extensions=i),e},Vn.prototype=Object.assign(Object.create(ge.prototype),{constructor:Vn,isCamera:!0,copy:function(t,e){return ge.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){t===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new q),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){ge.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,e){ge.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}}),Or.prototype=Object.assign(Object.create(Vn.prototype),{constructor:Or,isPerspectiveCamera:!0,copy:function(t,e){return Vn.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*We.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*We.DEG2RAD*this.fov);return .5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*We.RAD2DEG*Math.atan(Math.tan(.5*We.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,r,n,i,a){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*We.DEG2RAD*this.fov)/this.zoom,r=2*e,n=this.aspect*r,i=-.5*n,a=this.view;if(this.view!==null&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;i+=a.offsetX*n/o,e-=a.offsetY*r/s,n*=a.width/o,r*=a.height/s}var c=this.filmOffset;c!==0&&(i+=t*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,e,e-r,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=ge.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});function Ia(t,e,r){if(ge.call(this),this.type="CubeCamera",r.isWebGLCubeRenderTarget===!0){this.renderTarget=r;var n=new Or(90,1,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new q(1,0,0)),this.add(n);var i=new Or(90,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new q(-1,0,0)),this.add(i);var a=new Or(90,1,t,e);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new q(0,1,0)),this.add(a);var o=new Or(90,1,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new q(0,-1,0)),this.add(o);var s=new Or(90,1,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new q(0,0,1)),this.add(s);var c=new Or(90,1,t,e);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new q(0,0,-1)),this.add(c),this.update=function(l,h){this.parent===null&&this.updateMatrixWorld();var m=l.xr.enabled,g=l.getRenderTarget();l.xr.enabled=!1;var u=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,l.setRenderTarget(r,0),l.render(h,n),l.setRenderTarget(r,1),l.render(h,i),l.setRenderTarget(r,2),l.render(h,a),l.setRenderTarget(r,3),l.render(h,o),l.setRenderTarget(r,4),l.render(h,s),r.texture.generateMipmaps=u,l.setRenderTarget(r,5),l.render(h,c),l.setRenderTarget(g),l.xr.enabled=m},this.clear=function(l,h,m,g){for(var u=l.getRenderTarget(),y=0;y<6;y++)l.setRenderTarget(r,y),l.clear(h,m,g);l.setRenderTarget(u)}}else console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.")}function Vi(t,e,r){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=r),nn.call(this,t,t,e)}function ki(t,e,r,n,i,a,o,s,c,l,h,m){ur.call(this,null,a,o,s,c,l,n,i,h,m),this.image={data:t||null,width:e||1,height:r||1},this.magFilter=c!==void 0?c:it,this.minFilter=l!==void 0?l:it,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}Ia.prototype=Object.create(ge.prototype),Ia.prototype.constructor=Ia,Vi.prototype=Object.create(nn.prototype),Vi.prototype.constructor=Vi,Vi.prototype.isWebGLCubeRenderTarget=!0,Vi.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=e.format,this.texture.encoding=e.encoding;var r=new _a,n={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","	vWorldDirection = transformDirection( position, modelMatrix );","	#include <begin_vertex>","	#include <project_vertex>","}"].join(`
`),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#include <common>","void main() {","	vec3 direction = normalize( vWorldDirection );","	vec2 sampleUV = equirectUv( direction );","	gl_FragColor = texture2D( tEquirect, sampleUV );","}"].join(`
`)},i=new Zr({type:"CubemapFromEquirect",uniforms:Da(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:x,blending:pt});i.uniforms.tEquirect.value=e;var a=new br(new Go(5,5,5),i);return r.add(a),new Ia(1,10,this).update(t,r),a.geometry.dispose(),a.material.dispose(),this},ki.prototype=Object.create(ur.prototype),ki.prototype.constructor=ki,ki.prototype.isDataTexture=!0;var Na=new Un,tc=new q;function Ba(t,e,r,n,i,a){this.planes=[t!==void 0?t:new Sn,e!==void 0?e:new Sn,r!==void 0?r:new Sn,n!==void 0?n:new Sn,i!==void 0?i:new Sn,a!==void 0?a:new Sn]}Object.assign(Ba.prototype,{set:function(t,e,r,n,i,a){var o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(r),o[3].copy(n),o[4].copy(i),o[5].copy(a),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){for(var e=this.planes,r=0;r<6;r++)e[r].copy(t.planes[r]);return this},setFromProjectionMatrix:function(t){var e=this.planes,r=t.elements,n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],c=r[5],l=r[6],h=r[7],m=r[8],g=r[9],u=r[10],y=r[11],A=r[12],M=r[13],N=r[14],j=r[15];return e[0].setComponents(o-n,h-s,y-m,j-A).normalize(),e[1].setComponents(o+n,h+s,y+m,j+A).normalize(),e[2].setComponents(o+i,h+c,y+g,j+M).normalize(),e[3].setComponents(o-i,h-c,y-g,j-M).normalize(),e[4].setComponents(o-a,h-l,y-u,j-N).normalize(),e[5].setComponents(o+a,h+l,y+u,j+N).normalize(),this},intersectsObject:function(t){var e=t.geometry;return e.boundingSphere===null&&e.computeBoundingSphere(),Na.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Na)},intersectsSprite:function(t){return Na.center.set(0,0,0),Na.radius=.7071067811865476,Na.applyMatrix4(t.matrixWorld),this.intersectsSphere(Na)},intersectsSphere:function(t){for(var e=this.planes,r=t.center,n=-t.radius,i=0;i<6;i++)if(e[i].distanceToPoint(r)<n)return!1;return!0},intersectsBox:function(t){for(var e=this.planes,r=0;r<6;r++){var n=e[r];if(tc.x=n.normal.x>0?t.max.x:t.min.x,tc.y=n.normal.y>0?t.max.y:t.min.y,tc.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(tc)<0)return!1}return!0},containsPoint:function(t){for(var e=this.planes,r=0;r<6;r++)if(e[r].distanceToPoint(t)<0)return!1;return!0}});var fe={common:{diffuse:{value:new we(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new kr},uv2Transform:{value:new kr},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Wt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new we(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new we(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new kr}},sprite:{diffuse:{value:new we(15658734)},opacity:{value:1},center:{value:new Wt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new kr}}};function td(){var t=null,e=!1,r=null;function n(i,a){e!==!1&&(r(i,a),t.requestAnimationFrame(n))}return{start:function(){e!==!0&&r!==null&&(t.requestAnimationFrame(n),e=!0)},stop:function(){e=!1},setAnimationLoop:function(i){r=i},setContext:function(i){t=i}}}function bf(t,e){var r=e.isWebGL2,n=new WeakMap;return{get:function(i){return i.isInterleavedBufferAttribute&&(i=i.data),n.get(i)},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);var a=n.get(i);a&&(t.deleteBuffer(a.buffer),n.delete(i))},update:function(i,a){i.isInterleavedBufferAttribute&&(i=i.data);var o=n.get(i);o===void 0?n.set(i,function(s,c){var l=s.array,h=s.usage,m=t.createBuffer();t.bindBuffer(c,m),t.bufferData(c,l,h),s.onUploadCallback();var g=5126;return l instanceof Float32Array?g=5126:l instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):l instanceof Uint16Array?g=5123:l instanceof Int16Array?g=5122:l instanceof Uint32Array?g=5125:l instanceof Int32Array?g=5124:l instanceof Int8Array?g=5120:l instanceof Uint8Array&&(g=5121),{buffer:m,type:g,bytesPerElement:l.BYTES_PER_ELEMENT,version:s.version}}(i,a)):o.version<i.version&&(!function(s,c,l){var h=c.array,m=c.updateRange;t.bindBuffer(l,s),m.count===-1?t.bufferSubData(l,0,h):(r?t.bufferSubData(l,m.offset*h.BYTES_PER_ELEMENT,h,m.offset,m.count):t.bufferSubData(l,m.offset*h.BYTES_PER_ELEMENT,h.subarray(m.offset,m.offset+m.count)),m.count=-1)}(o.buffer,i,a),o.version=i.version)}}}function Vo(t,e,r,n){Be.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new Hi(t,e,r,n)),this.mergeVertices()}function Hi(t,e,r,n){_e.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n};var i,a,o=(t=t||1)/2,s=(e=e||1)/2,c=Math.floor(r)||1,l=Math.floor(n)||1,h=c+1,m=l+1,g=t/c,u=e/l,y=[],A=[],M=[],N=[];for(a=0;a<m;a++){var j=a*u-s;for(i=0;i<h;i++){var k=i*g-o;A.push(k,-j,0),M.push(0,0,1),N.push(i/c),N.push(1-a/l)}}for(a=0;a<l;a++)for(i=0;i<c;i++){var ot=i+h*a,nt=i+h*(a+1),gt=i+1+h*(a+1),yt=i+1+h*a;y.push(ot,nt,yt),y.push(nt,gt,yt)}this.setIndex(y),this.setAttribute("position",new pe(A,3)),this.setAttribute("normal",new pe(M,3)),this.setAttribute("uv",new pe(N,2))}Vo.prototype=Object.create(Be.prototype),Vo.prototype.constructor=Vo,Hi.prototype=Object.create(_e.prototype),Hi.prototype.constructor=Hi;var Je={alphamap_fragment:`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE  = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS  = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha  = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 );
		fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,color_pars_vertex:`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,color_vertex:`#ifdef USE_COLOR
	vColor.xyz = color.xyz;
#endif`,common:`#define PI 3.14159265359
#define PI2 6.28318530718
#define PI_HALF 1.5707963267949
#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494
#define LOG2 1.442695
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
  return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
#define cubeUV_maxMipLevel 8.0
#define cubeUV_minMipLevel 4.0
#define cubeUV_maxTileSize 256.0
#define cubeUV_minTileSize 16.0
float getFace(vec3 direction) {
    vec3 absDirection = abs(direction);
    float face = -1.0;
    if (absDirection.x > absDirection.z) {
      if (absDirection.x > absDirection.y)
        face = direction.x > 0.0 ? 0.0 : 3.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    } else {
      if (absDirection.z > absDirection.y)
        face = direction.z > 0.0 ? 2.0 : 5.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    }
    return face;
}
vec2 getUV(vec3 direction, float face) {
    vec2 uv;
    if (face == 0.0) {
      uv = vec2(direction.z, direction.y) / abs(direction.x);    } else if (face == 1.0) {
      uv = vec2(-direction.x, -direction.z) / abs(direction.y);    } else if (face == 2.0) {
      uv = vec2(-direction.x, direction.y) / abs(direction.z);    } else if (face == 3.0) {
      uv = vec2(-direction.z, direction.y) / abs(direction.x);    } else if (face == 4.0) {
      uv = vec2(-direction.x, direction.z) / abs(direction.y);    } else {
      uv = vec2(direction.x, direction.y) / abs(direction.z);    }
    return 0.5 * (uv + 1.0);
}
vec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
  float face = getFace(direction);
  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
  mipInt = max(mipInt, cubeUV_minMipLevel);
  float faceSize = exp2(mipInt);
  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
  vec2 uv = getUV(direction, face) * (faceSize - 1.0);
  vec2 f = fract(uv);
  uv += 0.5 - f;
  if (face > 2.0) {
    uv.y += faceSize;
    face -= 3.0;
  }
  uv.x += face * faceSize;
  if(mipInt < cubeUV_maxMipLevel){
    uv.y += 2.0 * cubeUV_maxTileSize;
  }
  uv.y += filterInt * 2.0 * cubeUV_minTileSize;
  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
  uv *= texelSize;
  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x += texelSize;
  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.y += texelSize;
  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x -= texelSize;
  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  vec3 tm = mix(tl, tr, f.x);
  vec3 bm = mix(bl, br, f.x);
  return mix(tm, bm, f.y);
}
#define r0 1.0
#define v0 0.339
#define m0 -2.0
#define r1 0.8
#define v1 0.276
#define m1 -1.0
#define r4 0.4
#define v4 0.046
#define m4 2.0
#define r5 0.305
#define v5 0.016
#define m5 3.0
#define r6 0.21
#define v6 0.0038
#define m6 4.0
float roughnessToMip(float roughness) {
  float mip = 0.0;
  if (roughness >= r1) {
    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
  } else if (roughness >= r4) {
    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
  } else if (roughness >= r5) {
    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
  } else if (roughness >= r6) {
    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
  } else {
    mip = -2.0 * log2(1.16 * roughness);  }
  return mip;
}
vec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {
  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);
  float mipF = fract(mip);
  float mipInt = floor(mip);
  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);
  if (mipF == 0.0) {
    return vec4(color0, 1.0);
  } else {
    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);
    return vec4(mix(color0, color1, mipF), 1.0);
  }
}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value )  {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		}  else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#elif defined( ENVMAP_TYPE_EQUIREC )
		reflectVec = normalize( reflectVec );
		vec2 sampleUV = equirectUv( reflectVec );
		vec4 envColor = texture2D( envMap, sampleUV );
	#elif defined( ENVMAP_TYPE_SPHERE )
		reflectVec = normalize( reflectVec );
		vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );
		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
		  vec3 reflectVec = reflect( -viewDir, normal );
		  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
		  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#elif defined( ENVMAP_TYPE_EQUIREC )
			vec2 sampleUV = equirectUv( reflectVec );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_SPHERE )
			vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) { 
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	fogDepth = -mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float fogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_vertex:`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
		struct PointLightShadow {
			float shadowBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3	diffuseColor;
	float	specularRoughness;
	vec3	specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
	uniform float morphTargetInfluences[ 8 ];
	#else
	uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
	transformed += morphTarget4 * morphTargetInfluences[ 4 ];
	transformed += morphTarget5 * morphTargetInfluences[ 5 ];
	transformed += morphTarget6 * morphTargetInfluences[ 6 ];
	transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,normal_fragment_begin:`#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			bitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		float scale = sign( st1.t * st0.s - st0.t * st1.s );
		vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
		vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
		vec3 N = normalize( surf_norm );
		mat3 tsn = mat3( S, T, N );
		mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		return normalize( tsn * mapN );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );
	#endif
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
uniform float toneMappingWhitePoint;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );
}`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSPARENCY
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSPARENCY
	uniform float transparency;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSPARENCY
		diffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,normal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,normal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,shadow_vert:`#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`},kn={basic:{uniforms:Hr([fe.common,fe.specularmap,fe.envmap,fe.aomap,fe.lightmap,fe.fog]),vertexShader:Je.meshbasic_vert,fragmentShader:Je.meshbasic_frag},lambert:{uniforms:Hr([fe.common,fe.specularmap,fe.envmap,fe.aomap,fe.lightmap,fe.emissivemap,fe.fog,fe.lights,{emissive:{value:new we(0)}}]),vertexShader:Je.meshlambert_vert,fragmentShader:Je.meshlambert_frag},phong:{uniforms:Hr([fe.common,fe.specularmap,fe.envmap,fe.aomap,fe.lightmap,fe.emissivemap,fe.bumpmap,fe.normalmap,fe.displacementmap,fe.fog,fe.lights,{emissive:{value:new we(0)},specular:{value:new we(1118481)},shininess:{value:30}}]),vertexShader:Je.meshphong_vert,fragmentShader:Je.meshphong_frag},standard:{uniforms:Hr([fe.common,fe.envmap,fe.aomap,fe.lightmap,fe.emissivemap,fe.bumpmap,fe.normalmap,fe.displacementmap,fe.roughnessmap,fe.metalnessmap,fe.fog,fe.lights,{emissive:{value:new we(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Je.meshphysical_vert,fragmentShader:Je.meshphysical_frag},toon:{uniforms:Hr([fe.common,fe.specularmap,fe.aomap,fe.lightmap,fe.emissivemap,fe.bumpmap,fe.normalmap,fe.displacementmap,fe.gradientmap,fe.fog,fe.lights,{emissive:{value:new we(0)},specular:{value:new we(1118481)},shininess:{value:30}}]),vertexShader:Je.meshtoon_vert,fragmentShader:Je.meshtoon_frag},matcap:{uniforms:Hr([fe.common,fe.bumpmap,fe.normalmap,fe.displacementmap,fe.fog,{matcap:{value:null}}]),vertexShader:Je.meshmatcap_vert,fragmentShader:Je.meshmatcap_frag},points:{uniforms:Hr([fe.points,fe.fog]),vertexShader:Je.points_vert,fragmentShader:Je.points_frag},dashed:{uniforms:Hr([fe.common,fe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Je.linedashed_vert,fragmentShader:Je.linedashed_frag},depth:{uniforms:Hr([fe.common,fe.displacementmap]),vertexShader:Je.depth_vert,fragmentShader:Je.depth_frag},normal:{uniforms:Hr([fe.common,fe.bumpmap,fe.normalmap,fe.displacementmap,{opacity:{value:1}}]),vertexShader:Je.normal_vert,fragmentShader:Je.normal_frag},sprite:{uniforms:Hr([fe.sprite,fe.fog]),vertexShader:Je.sprite_vert,fragmentShader:Je.sprite_frag},background:{uniforms:{uvTransform:{value:new kr},t2D:{value:null}},vertexShader:Je.background_vert,fragmentShader:Je.background_frag},cube:{uniforms:Hr([fe.envmap,{opacity:{value:1}}]),vertexShader:Je.cube_vert,fragmentShader:Je.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Je.equirect_vert,fragmentShader:Je.equirect_frag},distanceRGBA:{uniforms:Hr([fe.common,fe.displacementmap,{referencePosition:{value:new q},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Je.distanceRGBA_vert,fragmentShader:Je.distanceRGBA_frag},shadow:{uniforms:Hr([fe.lights,fe.fog,{color:{value:new we(0)},opacity:{value:1}}]),vertexShader:Je.shadow_vert,fragmentShader:Je.shadow_frag}};function wf(t,e,r,n){var i,a,o=new we(0),s=0,c=null,l=0,h=null;function m(g,u){e.buffers.color.setClear(g.r,g.g,g.b,u,n)}return{getClearColor:function(){return o},setClearColor:function(g,u){o.set(g),m(o,s=u!==void 0?u:1)},getClearAlpha:function(){return s},setClearAlpha:function(g){m(o,s=g)},render:function(g,u,y,A){var M=u.background,N=t.xr,j=N.getSession&&N.getSession();if(j&&j.environmentBlendMode==="additive"&&(M=null),M===null?m(o,s):M&&M.isColor&&(m(M,1),A=!0),(t.autoClear||A)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),M&&(M.isCubeTexture||M.isWebGLCubeRenderTarget||M.mapping===d)){a===void 0&&((a=new br(new Go(1,1,1),new Zr({type:"BackgroundCubeMaterial",uniforms:Da(kn.cube.uniforms),vertexShader:kn.cube.vertexShader,fragmentShader:kn.cube.fragmentShader,side:x,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(ot,nt,gt){this.matrixWorld.copyPosition(gt.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a));var k=M.isWebGLCubeRenderTarget?M.texture:M;a.material.uniforms.envMap.value=k,a.material.uniforms.flipEnvMap.value=k.isCubeTexture?-1:1,c===M&&l===k.version&&h===t.toneMapping||(a.material.needsUpdate=!0,c=M,l=k.version,h=t.toneMapping),g.unshift(a,a.geometry,a.material,0,0,null)}else M&&M.isTexture&&(i===void 0&&((i=new br(new Hi(2,2),new Zr({type:"BackgroundMaterial",uniforms:Da(kn.background.uniforms),vertexShader:kn.background.vertexShader,fragmentShader:kn.background.fragmentShader,side:ut,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(i)),i.material.uniforms.t2D.value=M,M.matrixAutoUpdate===!0&&M.updateMatrix(),i.material.uniforms.uvTransform.value.copy(M.matrix),c===M&&l===M.version&&h===t.toneMapping||(i.material.needsUpdate=!0,c=M,l=M.version,h=t.toneMapping),g.unshift(i,i.geometry,i.material,0,0,null))}}}function _f(t,e,r,n){var i,a=n.isWebGL2;this.setMode=function(o){i=o},this.render=function(o,s){t.drawArrays(i,o,s),r.update(s,i)},this.renderInstances=function(o,s,c,l){if(l!==0){var h,m;if(a)h=t,m="drawArraysInstanced";else if(m="drawArraysInstancedANGLE",(h=e.get("ANGLE_instanced_arrays"))===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[m](i,s,c,l),r.update(c,i,l)}}}function Mf(t,e,r){var n;function i(k){if(k==="highp"){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";k="mediump"}return k==="mediump"&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a=typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&t instanceof WebGL2ComputeRenderingContext,o=r.precision!==void 0?r.precision:"highp",s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var c=r.logarithmicDepthBuffer===!0,l=t.getParameter(34930),h=t.getParameter(35660),m=t.getParameter(3379),g=t.getParameter(34076),u=t.getParameter(34921),y=t.getParameter(36347),A=t.getParameter(36348),M=t.getParameter(36349),N=h>0,j=a||!!e.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(n!==void 0)return n;var k=e.get("EXT_texture_filter_anisotropic");return n=k!==null?t.getParameter(k.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:c,maxTextures:l,maxVertexTextures:h,maxTextureSize:m,maxCubemapSize:g,maxAttributes:u,maxVertexUniforms:y,maxVaryings:A,maxFragmentUniforms:M,vertexTextures:N,floatFragmentTextures:j,floatVertexTextures:N&&j,maxSamples:a?t.getParameter(36183):0}}function Sf(){var t=this,e=null,r=0,n=!1,i=!1,a=new Sn,o=new kr,s={value:null,needsUpdate:!1};function c(){s.value!==e&&(s.value=e,s.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function l(h,m,g,u){var y=h!==null?h.length:0,A=null;if(y!==0){if(A=s.value,u!==!0||A===null){var M=g+4*y,N=m.matrixWorldInverse;o.getNormalMatrix(N),(A===null||A.length<M)&&(A=new Float32Array(M));for(var j=0,k=g;j!==y;++j,k+=4)a.copy(h[j]).applyMatrix4(N,o),a.normal.toArray(A,k),A[k+3]=a.constant}s.value=A,s.needsUpdate=!0}return t.numPlanes=y,t.numIntersection=0,A}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(h,m,g){var u=h.length!==0||m||r!==0||n;return n=m,e=l(h,g,0),r=h.length,u},this.beginShadows=function(){i=!0,l(null)},this.endShadows=function(){i=!1,c()},this.setState=function(h,m,g,u,y,A){if(!n||h===null||h.length===0||i&&!g)i?l(null):c();else{var M=i?0:r,N=4*M,j=y.clippingState||null;s.value=j,j=l(h,u,N,A);for(var k=0;k!==N;++k)j[k]=e[k];y.clippingState=j,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=M}}}function Tf(t){var e={};return{get:function(r){if(e[r]!==void 0)return e[r];var n;switch(r){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(r)}return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),e[r]=n,n}}}function Ef(t,e,r){var n=new WeakMap,i=new WeakMap;function a(s){var c=s.target,l=n.get(c);for(var h in l.index!==null&&e.remove(l.index),l.attributes)e.remove(l.attributes[h]);c.removeEventListener("dispose",a),n.delete(c);var m=i.get(l);m&&(e.remove(m),i.delete(l)),r.memory.geometries--}function o(s){var c=[],l=s.index,h=s.attributes.position,m=0;if(l!==null){var g=l.array;m=l.version;for(var u=0,y=g.length;u<y;u+=3){var A=g[u+0],M=g[u+1],N=g[u+2];c.push(A,M,M,N,N,A)}}else for(g=h.array,m=h.version,u=0,y=g.length/3-1;u<y;u+=3)A=u+0,M=u+1,N=u+2,c.push(A,M,M,N,N,A);var j=new(Jh(c)>65535?zi:Ui)(c,1);j.version=m,e.update(j,34963);var k=i.get(s);k&&e.remove(k),i.set(s,j)}return{get:function(s,c){var l=n.get(c);return l||(c.addEventListener("dispose",a),c.isBufferGeometry?l=c:c.isGeometry&&(c._bufferGeometry===void 0&&(c._bufferGeometry=new _e().setFromObject(s)),l=c._bufferGeometry),n.set(c,l),r.memory.geometries++,l)},update:function(s){var c=s.index,l=s.attributes;for(var h in c!==null&&e.update(c,34963),l)e.update(l[h],34962);var m=s.morphAttributes;for(var h in m)for(var g=m[h],u=0,y=g.length;u<y;u++)e.update(g[u],34962)},getWireframeAttribute:function(s){var c=i.get(s);if(c){var l=s.index;l!==null&&c.version<l.version&&o(s)}else o(s);return i.get(s)}}}function Af(t,e,r,n){var i,a,o,s=n.isWebGL2;this.setMode=function(c){i=c},this.setIndex=function(c){a=c.type,o=c.bytesPerElement},this.render=function(c,l){t.drawElements(i,l,a,c*o),r.update(l,i)},this.renderInstances=function(c,l,h,m){if(m!==0){var g,u;if(s)g=t,u="drawElementsInstanced";else if(u="drawElementsInstancedANGLE",(g=e.get("ANGLE_instanced_arrays"))===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");g[u](i,h,a,l*o,m),r.update(h,i,m)}}}function Lf(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(r,n,i){switch(i=i||1,e.calls++,n){case 4:e.triangles+=i*(r/3);break;case 1:e.lines+=i*(r/2);break;case 3:e.lines+=i*(r-1);break;case 2:e.lines+=i*r;break;case 0:e.points+=i*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Rf(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Pf(t){var e={},r=new Float32Array(8);return{update:function(n,i,a,o){var s=n.morphTargetInfluences,c=s===void 0?0:s.length,l=e[i.id];if(l===void 0){l=[];for(var h=0;h<c;h++)l[h]=[h,0];e[i.id]=l}var m=a.morphTargets&&i.morphAttributes.position,g=a.morphNormals&&i.morphAttributes.normal;for(h=0;h<c;h++)(y=l[h])[1]!==0&&(m&&i.deleteAttribute("morphTarget"+h),g&&i.deleteAttribute("morphNormal"+h));for(h=0;h<c;h++)(y=l[h])[0]=h,y[1]=s[h];l.sort(Rf);var u=0;for(h=0;h<8;h++){var y;if(y=l[h]){var A=y[0],M=y[1];if(M){m&&i.setAttribute("morphTarget"+h,m[A]),g&&i.setAttribute("morphNormal"+h,g[A]),r[h]=M,u+=M;continue}}r[h]=0}var N=i.morphTargetsRelative?1:1-u;o.getUniforms().setValue(t,"morphTargetBaseInfluence",N),o.getUniforms().setValue(t,"morphTargetInfluences",r)}}}function Cf(t,e,r,n){var i=new WeakMap;return{update:function(a){var o=n.render.frame,s=a.geometry,c=e.get(a,s);return i.get(c)!==o&&(s.isGeometry&&c.updateFromObject(a),e.update(c),i.set(c,o)),a.isInstancedMesh&&r.update(a.instanceMatrix,34962),c},dispose:function(){i=new WeakMap}}}function ni(t,e,r,n,i,a,o,s,c,l){t=t!==void 0?t:[],e=e!==void 0?e:wt,o=o!==void 0?o:Bn,ur.call(this,t,e,r,n,i,a,o,s,c,l),this.flipY=!1}function Fa(t,e,r,n){ur.call(this,null),this.image={data:t||null,width:e||1,height:r||1,depth:n||1},this.magFilter=it,this.minFilter=it,this.wrapR=B,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function Ua(t,e,r,n){ur.call(this,null),this.image={data:t||null,width:e||1,height:r||1,depth:n||1},this.magFilter=it,this.minFilter=it,this.wrapR=B,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}kn.physical={uniforms:Hr([kn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Wt(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new we(0)},transparency:{value:0}}]),vertexShader:Je.meshphysical_vert,fragmentShader:Je.meshphysical_frag},ni.prototype=Object.create(ur.prototype),ni.prototype.constructor=ni,ni.prototype.isCubeTexture=!0,Object.defineProperty(ni.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),Fa.prototype=Object.create(ur.prototype),Fa.prototype.constructor=Fa,Fa.prototype.isDataTexture2DArray=!0,Ua.prototype=Object.create(ur.prototype),Ua.prototype.constructor=Ua,Ua.prototype.isDataTexture3D=!0;var ed=new ur,Of=new Fa,Df=new Ua,rd=new ni,nd=[],id=[],ad=new Float32Array(16),od=new Float32Array(9),sd=new Float32Array(4);function za(t,e,r){var n=t[0];if(n<=0||n>0)return t;var i=e*r,a=nd[i];if(a===void 0&&(a=new Float32Array(i),nd[i]=a),e!==0){n.toArray(a,0);for(var o=1,s=0;o!==e;++o)s+=r,t[o].toArray(a,s)}return a}function dn(t,e){if(t.length!==e.length)return!1;for(var r=0,n=t.length;r<n;r++)if(t[r]!==e[r])return!1;return!0}function sn(t,e){for(var r=0,n=e.length;r<n;r++)t[r]=e[r]}function cd(t,e){var r=id[e];r===void 0&&(r=new Int32Array(e),id[e]=r);for(var n=0;n!==e;++n)r[n]=t.allocateTextureUnit();return r}function If(t,e){var r=this.cache;r[0]!==e&&(t.uniform1f(this.addr,e),r[0]=e)}function Nf(t,e){var r=this.cache;if(e.x!==void 0)r[0]===e.x&&r[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),r[0]=e.x,r[1]=e.y);else{if(dn(r,e))return;t.uniform2fv(this.addr,e),sn(r,e)}}function Bf(t,e){var r=this.cache;if(e.x!==void 0)r[0]===e.x&&r[1]===e.y&&r[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),r[0]=e.x,r[1]=e.y,r[2]=e.z);else if(e.r!==void 0)r[0]===e.r&&r[1]===e.g&&r[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),r[0]=e.r,r[1]=e.g,r[2]=e.b);else{if(dn(r,e))return;t.uniform3fv(this.addr,e),sn(r,e)}}function Ff(t,e){var r=this.cache;if(e.x!==void 0)r[0]===e.x&&r[1]===e.y&&r[2]===e.z&&r[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=e.w);else{if(dn(r,e))return;t.uniform4fv(this.addr,e),sn(r,e)}}function Uf(t,e){var r=this.cache,n=e.elements;if(n===void 0){if(dn(r,e))return;t.uniformMatrix2fv(this.addr,!1,e),sn(r,e)}else{if(dn(r,n))return;sd.set(n),t.uniformMatrix2fv(this.addr,!1,sd),sn(r,n)}}function zf(t,e){var r=this.cache,n=e.elements;if(n===void 0){if(dn(r,e))return;t.uniformMatrix3fv(this.addr,!1,e),sn(r,e)}else{if(dn(r,n))return;od.set(n),t.uniformMatrix3fv(this.addr,!1,od),sn(r,n)}}function Gf(t,e){var r=this.cache,n=e.elements;if(n===void 0){if(dn(r,e))return;t.uniformMatrix4fv(this.addr,!1,e),sn(r,e)}else{if(dn(r,n))return;ad.set(n),t.uniformMatrix4fv(this.addr,!1,ad),sn(r,n)}}function Vf(t,e,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.safeSetTexture2D(e||ed,i)}function kf(t,e,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.setTexture2DArray(e||Of,i)}function Hf(t,e,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.setTexture3D(e||Df,i)}function jf(t,e,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.safeSetTextureCube(e||rd,i)}function Wf(t,e){var r=this.cache;r[0]!==e&&(t.uniform1i(this.addr,e),r[0]=e)}function qf(t,e){var r=this.cache;dn(r,e)||(t.uniform2iv(this.addr,e),sn(r,e))}function Xf(t,e){var r=this.cache;dn(r,e)||(t.uniform3iv(this.addr,e),sn(r,e))}function Yf(t,e){var r=this.cache;dn(r,e)||(t.uniform4iv(this.addr,e),sn(r,e))}function Zf(t,e){var r=this.cache;r[0]!==e&&(t.uniform1ui(this.addr,e),r[0]=e)}function Jf(t,e){t.uniform1fv(this.addr,e)}function Kf(t,e){t.uniform1iv(this.addr,e)}function Qf(t,e){t.uniform2iv(this.addr,e)}function $f(t,e){t.uniform3iv(this.addr,e)}function tm(t,e){t.uniform4iv(this.addr,e)}function em(t,e){var r=za(e,this.size,2);t.uniform2fv(this.addr,r)}function rm(t,e){var r=za(e,this.size,3);t.uniform3fv(this.addr,r)}function nm(t,e){var r=za(e,this.size,4);t.uniform4fv(this.addr,r)}function im(t,e){var r=za(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,r)}function am(t,e){var r=za(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,r)}function om(t,e){var r=za(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,r)}function sm(t,e,r){var n=e.length,i=cd(r,n);t.uniform1iv(this.addr,i);for(var a=0;a!==n;++a)r.safeSetTexture2D(e[a]||ed,i[a])}function cm(t,e,r){var n=e.length,i=cd(r,n);t.uniform1iv(this.addr,i);for(var a=0;a!==n;++a)r.safeSetTextureCube(e[a]||rd,i[a])}function lm(t,e,r){this.id=t,this.addr=r,this.cache=[],this.setValue=function(n){switch(n){case 5126:return If;case 35664:return Nf;case 35665:return Bf;case 35666:return Ff;case 35674:return Uf;case 35675:return zf;case 35676:return Gf;case 5124:case 35670:return Wf;case 35667:case 35671:return qf;case 35668:case 35672:return Xf;case 35669:case 35673:return Yf;case 5125:return Zf;case 35678:case 36198:case 36298:case 36306:case 35682:return Vf;case 35679:case 36299:case 36307:return Hf;case 35680:case 36300:case 36308:case 36293:return jf;case 36289:case 36303:case 36311:case 36292:return kf}}(e.type)}function ld(t,e,r){this.id=t,this.addr=r,this.cache=[],this.size=e.size,this.setValue=function(n){switch(n){case 5126:return Jf;case 35664:return em;case 35665:return rm;case 35666:return nm;case 35674:return im;case 35675:return am;case 35676:return om;case 5124:case 35670:return Kf;case 35667:case 35671:return Qf;case 35668:case 35672:return $f;case 35669:case 35673:return tm;case 35678:case 36198:case 36298:case 36306:case 35682:return sm;case 35680:case 36300:case 36308:case 36293:return cm}}(e.type)}function ud(t){this.id=t,this.seq=[],this.map={}}ld.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),sn(e,t)},ud.prototype.setValue=function(t,e,r){for(var n=this.seq,i=0,a=n.length;i!==a;++i){var o=n[i];o.setValue(t,e[o.id],r)}};var ql=/([\w\d_]+)(\])?(\[|\.)?/g;function hd(t,e){t.seq.push(e),t.map[e.id]=e}function um(t,e,r){var n=t.name,i=n.length;for(ql.lastIndex=0;;){var a=ql.exec(n),o=ql.lastIndex,s=a[1],c=a[2]==="]",l=a[3];if(c&&(s|=0),l===void 0||l==="["&&o+2===i){hd(r,l===void 0?new lm(s,t,e):new ld(s,t,e));break}var h=r.map[s];h===void 0&&hd(r,h=new ud(s)),r=h}}function bi(t,e){this.seq=[],this.map={};for(var r=t.getProgramParameter(e,35718),n=0;n<r;++n){var i=t.getActiveUniform(e,n);um(i,t.getUniformLocation(e,i.name),this)}}function dd(t,e,r){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),n}bi.prototype.setValue=function(t,e,r,n){var i=this.map[e];i!==void 0&&i.setValue(t,r,n)},bi.prototype.setOptional=function(t,e,r){var n=e[r];n!==void 0&&this.setValue(t,r,n)},bi.upload=function(t,e,r,n){for(var i=0,a=e.length;i!==a;++i){var o=e[i],s=r[o.id];s.needsUpdate!==!1&&o.setValue(t,s.value,n)}},bi.seqWithValue=function(t,e){for(var r=[],n=0,i=t.length;n!==i;++n){var a=t[n];a.id in e&&r.push(a)}return r};var hm=0;function pd(t){switch(t){case Yr:return["Linear","( value )"];case Eo:return["sRGB","( value )"];case Us:return["RGBE","( value )"];case wl:return["RGBM","( value, 7.0 )"];case _l:return["RGBM","( value, 16.0 )"];case Ml:return["RGBD","( value, 256.0 )"];case Fs:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Nh:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+t)}}function fd(t,e,r){var n=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();return n&&i===""?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+r+`
`+i+function(a){for(var o=a.split(`
`),s=0;s<o.length;s++)o[s]=s+1+": "+o[s];return o.join(`
`)}(t.getShaderSource(e))}function ko(t,e){var r=pd(e);return"vec4 "+t+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function dm(t,e){var r;switch(e){case H:r="Linear";break;case ht:r="Reinhard";break;case F:r="Uncharted2";break;case Mt:r="OptimizedCineon";break;case Et:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function Ho(t){return t!==""}function md(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function vd(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var pm=/^[ \t]*#include +<([\w\d./]+)>/gm;function Xl(t){return t.replace(pm,fm)}function fm(t,e){var r=Je[e];if(r===void 0)throw new Error("Can not resolve #include <"+e+">");return Xl(r)}var mm=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,vm=/#pragma unroll_loop_start[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g;function gd(t){return t.replace(vm,yd).replace(mm,gm)}function gm(t,e,r,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),yd(t,e,r,n)}function yd(t,e,r,n){for(var i="",a=parseInt(e);a<parseInt(r);a++)i+=n.replace(/\[ i \]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function xd(t){var e="precision "+t.precision+` float;
precision `+t.precision+" int;";return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function ym(t,e,r){var n,i,a,o,s,c=t.getContext(),l=r.defines,h=r.vertexShader,m=r.fragmentShader,g=function(Ht){var Kt="SHADOWMAP_TYPE_BASIC";return Ht.shadowMapType===G?Kt="SHADOWMAP_TYPE_PCF":Ht.shadowMapType===Y?Kt="SHADOWMAP_TYPE_PCF_SOFT":Ht.shadowMapType===at&&(Kt="SHADOWMAP_TYPE_VSM"),Kt}(r),u=function(Ht){var Kt="ENVMAP_TYPE_CUBE";if(Ht.envMap)switch(Ht.envMapMode){case wt:case zt:Kt="ENVMAP_TYPE_CUBE";break;case d:case b:Kt="ENVMAP_TYPE_CUBE_UV";break;case bt:case Xt:Kt="ENVMAP_TYPE_EQUIREC";break;case rt:Kt="ENVMAP_TYPE_SPHERE"}return Kt}(r),y=function(Ht){var Kt="ENVMAP_MODE_REFLECTION";if(Ht.envMap)switch(Ht.envMapMode){case zt:case Xt:Kt="ENVMAP_MODE_REFRACTION"}return Kt}(r),A=function(Ht){var Kt="ENVMAP_BLENDING_NONE";if(Ht.envMap)switch(Ht.combine){case X:Kt="ENVMAP_BLENDING_MULTIPLY";break;case Z:Kt="ENVMAP_BLENDING_MIX";break;case W:Kt="ENVMAP_BLENDING_ADD"}return Kt}(r),M=t.gammaFactor>0?t.gammaFactor:1,N=r.isWebGL2?"":function(Ht){return[Ht.extensionDerivatives||Ht.envMapCubeUV||Ht.bumpMap||Ht.tangentSpaceNormalMap||Ht.clearcoatNormalMap||Ht.flatShading||Ht.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(Ht.extensionFragDepth||Ht.logarithmicDepthBuffer)&&Ht.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",Ht.extensionDrawBuffers&&Ht.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(Ht.extensionShaderTextureLOD||Ht.envMap)&&Ht.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ho).join(`
`)}(r),j=function(Ht){var Kt=[];for(var be in Ht){var Oe=Ht[be];Oe!==!1&&Kt.push("#define "+be+" "+Oe)}return Kt.join(`
`)}(l),k=c.createProgram();if(r.isRawShaderMaterial?((n=[j].filter(Ho).join(`
`)).length>0&&(n+=`
`),(i=[N,j].filter(Ho).join(`
`)).length>0&&(i+=`
`)):(n=[xd(r),"#define SHADER_NAME "+r.shaderName,j,r.instancing?"#define USE_INSTANCING":"",r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+M,"#define MAX_BONES "+r.maxBones,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+y:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&r.flatShading===!1?"#define USE_MORPHNORMALS":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+g:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Ho).join(`
`),i=[N,xd(r),"#define SHADER_NAME "+r.shaderName,j,r.alphaTest?"#define ALPHATEST "+r.alphaTest+(r.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+M,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+u:"",r.envMap?"#define "+y:"",r.envMap?"#define "+A:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.sheen?"#define USE_SHEEN":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+g:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensionShaderTextureLOD||r.envMap)&&r.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==D?"#define TONE_MAPPING":"",r.toneMapping!==D?Je.tonemapping_pars_fragment:"",r.toneMapping!==D?dm("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.outputEncoding||r.mapEncoding||r.matcapEncoding||r.envMapEncoding||r.emissiveMapEncoding||r.lightMapEncoding?Je.encodings_pars_fragment:"",r.mapEncoding?ko("mapTexelToLinear",r.mapEncoding):"",r.matcapEncoding?ko("matcapTexelToLinear",r.matcapEncoding):"",r.envMapEncoding?ko("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMapEncoding?ko("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.lightMapEncoding?ko("lightMapTexelToLinear",r.lightMapEncoding):"",r.outputEncoding?(a="linearToOutputTexel",o=r.outputEncoding,s=pd(o),"vec4 "+a+"( vec4 value ) { return LinearTo"+s[0]+s[1]+"; }"):"",r.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"",`
`].filter(Ho).join(`
`)),h=vd(h=md(h=Xl(h),r),r),m=vd(m=md(m=Xl(m),r),r),h=gd(h),m=gd(m),r.isWebGL2&&!r.isRawShaderMaterial){var ot=!1,nt=/^\s*#version\s+300\s+es\s*\n/;r.isShaderMaterial&&h.match(nt)!==null&&m.match(nt)!==null&&(ot=!0,h=h.replace(nt,""),m=m.replace(nt,"")),n=[`#version 300 es
`,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+n,i=[`#version 300 es
`,"#define varying in",ot?"":"out highp vec4 pc_fragColor;",ot?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+i}var gt,yt,Gt=i+m,st=dd(c,35633,n+h),Nt=dd(c,35632,Gt);if(c.attachShader(k,st),c.attachShader(k,Nt),r.index0AttributeName!==void 0?c.bindAttribLocation(k,0,r.index0AttributeName):r.morphTargets===!0&&c.bindAttribLocation(k,0,"position"),c.linkProgram(k),t.debug.checkShaderErrors){var Bt=c.getProgramInfoLog(k).trim(),jt=c.getShaderInfoLog(st).trim(),xe=c.getShaderInfoLog(Nt).trim(),ae=!0,Rt=!0;if(c.getProgramParameter(k,35714)===!1){ae=!1;var Zt=fd(c,st,"vertex"),qt=fd(c,Nt,"fragment");console.error("THREE.WebGLProgram: shader error: ",c.getError(),"35715",c.getProgramParameter(k,35715),"gl.getProgramInfoLog",Bt,Zt,qt)}else Bt!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",Bt):jt!==""&&xe!==""||(Rt=!1);Rt&&(this.diagnostics={runnable:ae,programLog:Bt,vertexShader:{log:jt,prefix:n},fragmentShader:{log:xe,prefix:i}})}return c.deleteShader(st),c.deleteShader(Nt),this.getUniforms=function(){return gt===void 0&&(gt=new bi(c,k)),gt},this.getAttributes=function(){return yt===void 0&&(yt=function(Ht,Kt){for(var be={},Oe=Ht.getProgramParameter(Kt,35721),Ge=0;Ge<Oe;Ge++){var K=Ht.getActiveAttrib(Kt,Ge).name;be[K]=Ht.getAttribLocation(Kt,K)}return be}(c,k)),yt},this.destroy=function(){c.deleteProgram(k),this.program=void 0},this.name=r.shaderName,this.id=hm++,this.cacheKey=e,this.usedTimes=1,this.program=k,this.vertexShader=st,this.fragmentShader=Nt,this}function xm(t,e,r){var n=[],i=r.isWebGL2,a=r.logarithmicDepthBuffer,o=r.floatVertexTextures,s=r.precision,c=r.maxVertexUniforms,l=r.vertexTextures,h={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},m=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function g(u){var y;return u?u.isTexture?y=u.encoding:u.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),y=u.texture.encoding):y=Yr,y}this.getParameters=function(u,y,A,M,N,j,k){var ot=M.fog,nt=u.isMeshStandardMaterial?M.environment:null,gt=u.envMap||nt,yt=h[u.type],Gt=k.isSkinnedMesh?function(Bt){var jt=Bt.skeleton.bones;if(o)return 1024;var xe=c,ae=Math.floor((xe-20)/4),Rt=Math.min(ae,jt.length);return Rt<jt.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+jt.length+" bones. This GPU supports "+Rt+"."),0):Rt}(k):0;u.precision!==null&&(s=r.getMaxPrecision(u.precision))!==u.precision&&console.warn("THREE.WebGLProgram.getParameters:",u.precision,"not supported, using",s,"instead.");var st=function(Bt,jt){var xe;if(jt){var ae=kn[jt];xe={name:Bt.type,uniforms:$h.clone(ae.uniforms),vertexShader:ae.vertexShader,fragmentShader:ae.fragmentShader}}else xe={name:Bt.type,uniforms:Bt.uniforms,vertexShader:Bt.vertexShader,fragmentShader:Bt.fragmentShader};return xe}(u,yt);u.onBeforeCompile(st,t);var Nt=t.getRenderTarget();return{isWebGL2:i,shaderID:yt,shaderName:st.name,uniforms:st.uniforms,vertexShader:st.vertexShader,fragmentShader:st.fragmentShader,defines:u.defines,isRawShaderMaterial:u.isRawShaderMaterial,isShaderMaterial:u.isShaderMaterial,precision:s,instancing:k.isInstancedMesh===!0,supportsVertexTextures:l,outputEncoding:Nt!==null?g(Nt.texture):t.outputEncoding,map:!!u.map,mapEncoding:g(u.map),matcap:!!u.matcap,matcapEncoding:g(u.matcap),envMap:!!gt,envMapMode:gt&&gt.mapping,envMapEncoding:g(gt),envMapCubeUV:!!gt&&(gt.mapping===d||gt.mapping===b),lightMap:!!u.lightMap,lightMapEncoding:g(u.lightMap),aoMap:!!u.aoMap,emissiveMap:!!u.emissiveMap,emissiveMapEncoding:g(u.emissiveMap),bumpMap:!!u.bumpMap,normalMap:!!u.normalMap,objectSpaceNormalMap:u.normalMapType===Uh,tangentSpaceNormalMap:u.normalMapType===Oi,clearcoatMap:!!u.clearcoatMap,clearcoatRoughnessMap:!!u.clearcoatRoughnessMap,clearcoatNormalMap:!!u.clearcoatNormalMap,displacementMap:!!u.displacementMap,roughnessMap:!!u.roughnessMap,metalnessMap:!!u.metalnessMap,specularMap:!!u.specularMap,alphaMap:!!u.alphaMap,gradientMap:!!u.gradientMap,sheen:!!u.sheen,combine:u.combine,vertexTangents:u.normalMap&&u.vertexTangents,vertexColors:u.vertexColors,vertexUvs:!!(u.map||u.bumpMap||u.normalMap||u.specularMap||u.alphaMap||u.emissiveMap||u.roughnessMap||u.metalnessMap||u.clearcoatMap||u.clearcoatRoughnessMap||u.clearcoatNormalMap||u.displacementMap),uvsVertexOnly:!(u.map||u.bumpMap||u.normalMap||u.specularMap||u.alphaMap||u.emissiveMap||u.roughnessMap||u.metalnessMap||u.clearcoatNormalMap||!u.displacementMap),fog:!!ot,useFog:u.fog,fogExp2:ot&&ot.isFogExp2,flatShading:u.flatShading,sizeAttenuation:u.sizeAttenuation,logarithmicDepthBuffer:a,skinning:u.skinning&&Gt>0,maxBones:Gt,useVertexTexture:o,morphTargets:u.morphTargets,morphNormals:u.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:y.directional.length,numPointLights:y.point.length,numSpotLights:y.spot.length,numRectAreaLights:y.rectArea.length,numHemiLights:y.hemi.length,numDirLightShadows:y.directionalShadowMap.length,numPointLightShadows:y.pointShadowMap.length,numSpotLightShadows:y.spotShadowMap.length,numClippingPlanes:N,numClipIntersection:j,dithering:u.dithering,shadowMapEnabled:t.shadowMap.enabled&&A.length>0,shadowMapType:t.shadowMap.type,toneMapping:u.toneMapped?t.toneMapping:D,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:u.premultipliedAlpha,alphaTest:u.alphaTest,doubleSided:u.side===S,flipSided:u.side===x,depthPacking:u.depthPacking!==void 0&&u.depthPacking,index0AttributeName:u.index0AttributeName,extensionDerivatives:u.extensions&&u.extensions.derivatives,extensionFragDepth:u.extensions&&u.extensions.fragDepth,extensionDrawBuffers:u.extensions&&u.extensions.drawBuffers,extensionShaderTextureLOD:u.extensions&&u.extensions.shaderTextureLOD,rendererExtensionFragDepth:i||e.get("EXT_frag_depth")!==null,rendererExtensionDrawBuffers:i||e.get("WEBGL_draw_buffers")!==null,rendererExtensionShaderTextureLod:i||e.get("EXT_shader_texture_lod")!==null,onBeforeCompile:u.onBeforeCompile}},this.getProgramCacheKey=function(u){var y=[];if(u.shaderID?y.push(u.shaderID):(y.push(u.fragmentShader),y.push(u.vertexShader)),u.defines!==void 0)for(var A in u.defines)y.push(A),y.push(u.defines[A]);if(u.isRawShaderMaterial===void 0){for(var M=0;M<m.length;M++)y.push(u[m[M]]);y.push(t.outputEncoding),y.push(t.gammaFactor)}return y.push(u.onBeforeCompile.toString()),y.join()},this.acquireProgram=function(u,y){for(var A,M=0,N=n.length;M<N;M++){var j=n[M];if(j.cacheKey===y){++(A=j).usedTimes;break}}return A===void 0&&(A=new ym(t,y,u),n.push(A)),A},this.releaseProgram=function(u){if(--u.usedTimes==0){var y=n.indexOf(u);n[y]=n[n.length-1],n.pop(),u.destroy()}},this.programs=n}function bm(){var t=new WeakMap;return{get:function(e){var r=t.get(e);return r===void 0&&(r={},t.set(e,r)),r},remove:function(e){t.delete(e)},update:function(e,r,n){t.get(e)[r]=n},dispose:function(){t=new WeakMap}}}function wm(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function _m(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function bd(){var t=[],e=0,r=[],n=[],i={id:-1};function a(o,s,c,l,h,m){var g=t[e];return g===void 0?(g={id:o.id,object:o,geometry:s,material:c,program:c.program||i,groupOrder:l,renderOrder:o.renderOrder,z:h,group:m},t[e]=g):(g.id=o.id,g.object=o,g.geometry=s,g.material=c,g.program=c.program||i,g.groupOrder=l,g.renderOrder=o.renderOrder,g.z=h,g.group=m),e++,g}return{opaque:r,transparent:n,init:function(){e=0,r.length=0,n.length=0},push:function(o,s,c,l,h,m){var g=a(o,s,c,l,h,m);(c.transparent===!0?n:r).push(g)},unshift:function(o,s,c,l,h,m){var g=a(o,s,c,l,h,m);(c.transparent===!0?n:r).unshift(g)},finish:function(){for(var o=e,s=t.length;o<s;o++){var c=t[o];if(c.id===null)break;c.id=null,c.object=null,c.geometry=null,c.material=null,c.program=null,c.group=null}},sort:function(o,s){r.length>1&&r.sort(o||wm),n.length>1&&n.sort(s||_m)}}}function Mm(){var t=new WeakMap;function e(r){var n=r.target;n.removeEventListener("dispose",e),t.delete(n)}return{get:function(r,n){var i,a=t.get(r);return a===void 0?(i=new bd,t.set(r,new WeakMap),t.get(r).set(n,i),r.addEventListener("dispose",e)):(i=a.get(n))===void 0&&(i=new bd,a.set(n,i)),i},dispose:function(){t=new WeakMap}}}function Sm(){var t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];var r;switch(e.type){case"DirectionalLight":r={direction:new q,color:new we};break;case"SpotLight":r={position:new q,direction:new q,color:new we,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":r={position:new q,color:new we,distance:0,decay:0};break;case"HemisphereLight":r={direction:new q,skyColor:new we,groundColor:new we};break;case"RectAreaLight":r={color:new we,position:new q,halfWidth:new q,halfHeight:new q}}return t[e.id]=r,r}}}var Tm=0;function Em(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Am(){for(var t,e=new Sm,r=(t={},{get:function(c){if(t[c.id]!==void 0)return t[c.id];var l;switch(c.type){case"DirectionalLight":case"SpotLight":l={shadowBias:0,shadowRadius:1,shadowMapSize:new Wt};break;case"PointLight":l={shadowBias:0,shadowRadius:1,shadowMapSize:new Wt,shadowCameraNear:1,shadowCameraFar:1e3}}return t[c.id]=l,l}}),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},i=0;i<9;i++)n.probe.push(new q);var a=new q,o=new Xe,s=new Xe;return{setup:function(c,l,h){for(var m=0,g=0,u=0,y=0;y<9;y++)n.probe[y].set(0,0,0);var A=0,M=0,N=0,j=0,k=0,ot=0,nt=0,gt=0,yt=h.matrixWorldInverse;c.sort(Em),y=0;for(var Gt=c.length;y<Gt;y++){var st=c[y],Nt=st.color,Bt=st.intensity,jt=st.distance,xe=st.shadow&&st.shadow.map?st.shadow.map.texture:null;if(st.isAmbientLight)m+=Nt.r*Bt,g+=Nt.g*Bt,u+=Nt.b*Bt;else if(st.isLightProbe)for(var ae=0;ae<9;ae++)n.probe[ae].addScaledVector(st.sh.coefficients[ae],Bt);else if(st.isDirectionalLight){if((qt=e.get(st)).color.copy(st.color).multiplyScalar(st.intensity),qt.direction.setFromMatrixPosition(st.matrixWorld),a.setFromMatrixPosition(st.target.matrixWorld),qt.direction.sub(a),qt.direction.transformDirection(yt),st.castShadow){var Rt=st.shadow;(Zt=r.get(st)).shadowBias=Rt.bias,Zt.shadowRadius=Rt.radius,Zt.shadowMapSize=Rt.mapSize,n.directionalShadow[A]=Zt,n.directionalShadowMap[A]=xe,n.directionalShadowMatrix[A]=st.shadow.matrix,ot++}n.directional[A]=qt,A++}else if(st.isSpotLight)((qt=e.get(st)).position.setFromMatrixPosition(st.matrixWorld),qt.position.applyMatrix4(yt),qt.color.copy(Nt).multiplyScalar(Bt),qt.distance=jt,qt.direction.setFromMatrixPosition(st.matrixWorld),a.setFromMatrixPosition(st.target.matrixWorld),qt.direction.sub(a),qt.direction.transformDirection(yt),qt.coneCos=Math.cos(st.angle),qt.penumbraCos=Math.cos(st.angle*(1-st.penumbra)),qt.decay=st.decay,st.castShadow)&&(Rt=st.shadow,(Zt=r.get(st)).shadowBias=Rt.bias,Zt.shadowRadius=Rt.radius,Zt.shadowMapSize=Rt.mapSize,n.spotShadow[N]=Zt,n.spotShadowMap[N]=xe,n.spotShadowMatrix[N]=st.shadow.matrix,gt++),n.spot[N]=qt,N++;else if(st.isRectAreaLight)(qt=e.get(st)).color.copy(Nt).multiplyScalar(Bt),qt.position.setFromMatrixPosition(st.matrixWorld),qt.position.applyMatrix4(yt),s.identity(),o.copy(st.matrixWorld),o.premultiply(yt),s.extractRotation(o),qt.halfWidth.set(.5*st.width,0,0),qt.halfHeight.set(0,.5*st.height,0),qt.halfWidth.applyMatrix4(s),qt.halfHeight.applyMatrix4(s),n.rectArea[j]=qt,j++;else if(st.isPointLight){if((qt=e.get(st)).position.setFromMatrixPosition(st.matrixWorld),qt.position.applyMatrix4(yt),qt.color.copy(st.color).multiplyScalar(st.intensity),qt.distance=st.distance,qt.decay=st.decay,st.castShadow){var Zt;Rt=st.shadow,(Zt=r.get(st)).shadowBias=Rt.bias,Zt.shadowRadius=Rt.radius,Zt.shadowMapSize=Rt.mapSize,Zt.shadowCameraNear=Rt.camera.near,Zt.shadowCameraFar=Rt.camera.far,n.pointShadow[M]=Zt,n.pointShadowMap[M]=xe,n.pointShadowMatrix[M]=st.shadow.matrix,nt++}n.point[M]=qt,M++}else if(st.isHemisphereLight){var qt;(qt=e.get(st)).direction.setFromMatrixPosition(st.matrixWorld),qt.direction.transformDirection(yt),qt.direction.normalize(),qt.skyColor.copy(st.color).multiplyScalar(Bt),qt.groundColor.copy(st.groundColor).multiplyScalar(Bt),n.hemi[k]=qt,k++}}n.ambient[0]=m,n.ambient[1]=g,n.ambient[2]=u;var Ht=n.hash;Ht.directionalLength===A&&Ht.pointLength===M&&Ht.spotLength===N&&Ht.rectAreaLength===j&&Ht.hemiLength===k&&Ht.numDirectionalShadows===ot&&Ht.numPointShadows===nt&&Ht.numSpotShadows===gt||(n.directional.length=A,n.spot.length=N,n.rectArea.length=j,n.point.length=M,n.hemi.length=k,n.directionalShadow.length=ot,n.directionalShadowMap.length=ot,n.pointShadow.length=nt,n.pointShadowMap.length=nt,n.spotShadow.length=gt,n.spotShadowMap.length=gt,n.directionalShadowMatrix.length=ot,n.pointShadowMatrix.length=nt,n.spotShadowMatrix.length=gt,Ht.directionalLength=A,Ht.pointLength=M,Ht.spotLength=N,Ht.rectAreaLength=j,Ht.hemiLength=k,Ht.numDirectionalShadows=ot,Ht.numPointShadows=nt,Ht.numSpotShadows=gt,n.version=Tm++)},state:n}}function wd(){var t=new Am,e=[],r=[];return{init:function(){e.length=0,r.length=0},state:{lightsArray:e,shadowsArray:r,lights:t},setupLights:function(n){t.setup(e,r,n)},pushLight:function(n){e.push(n)},pushShadow:function(n){r.push(n)}}}function Lm(){var t=new WeakMap;function e(r){var n=r.target;n.removeEventListener("dispose",e),t.delete(n)}return{get:function(r,n){var i;return t.has(r)===!1?(i=new wd,t.set(r,new WeakMap),t.get(r).set(n,i),r.addEventListener("dispose",e)):t.get(r).has(n)===!1?(i=new wd,t.get(r).set(n,i)):i=t.get(r).get(n),i},dispose:function(){t=new WeakMap}}}function wi(t){Ne.call(this),this.type="MeshDepthMaterial",this.depthPacking=Bh,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function _i(t){Ne.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new q,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}wi.prototype=Object.create(Ne.prototype),wi.prototype.constructor=wi,wi.prototype.isMeshDepthMaterial=!0,wi.prototype.copy=function(t){return Ne.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},_i.prototype=Object.create(Ne.prototype),_i.prototype.constructor=_i,_i.prototype.isMeshDistanceMaterial=!0,_i.prototype.copy=function(t){return Ne.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};function _d(t,e,r){var n=new Ba,i=new Wt,a=new Wt,o=new er,s=[],c=[],l={},h={0:x,1:ut,2:S},m=new Zr({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Wt},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
  float mean = 0.0;
  float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );
  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
    #ifdef HORIZONAL_PASS
      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
      mean += distribution.x;
      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
    #else
      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );
      mean += depth;
      squared_mean += depth * depth;
    #endif
  }
  mean = mean * HALF_SAMPLE_RATE;
  squared_mean = squared_mean * HALF_SAMPLE_RATE;
  float std_dev = sqrt( squared_mean - mean * mean );
  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),g=m.clone();g.defines.HORIZONAL_PASS=1;var u=new _e;u.setAttribute("position",new Ie(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var y=new br(u,m),A=this;function M(nt,gt){var yt=e.update(y);m.uniforms.shadow_pass.value=nt.map.texture,m.uniforms.resolution.value=nt.mapSize,m.uniforms.radius.value=nt.radius,t.setRenderTarget(nt.mapPass),t.clear(),t.renderBufferDirect(gt,null,yt,m,y,null),g.uniforms.shadow_pass.value=nt.mapPass.texture,g.uniforms.resolution.value=nt.mapSize,g.uniforms.radius.value=nt.radius,t.setRenderTarget(nt.map),t.clear(),t.renderBufferDirect(gt,null,yt,g,y,null)}function N(nt,gt,yt){var Gt=nt<<0|gt<<1|yt<<2,st=s[Gt];return st===void 0&&(st=new wi({depthPacking:Fh,morphTargets:nt,skinning:gt}),s[Gt]=st),st}function j(nt,gt,yt){var Gt=nt<<0|gt<<1|yt<<2,st=c[Gt];return st===void 0&&(st=new _i({morphTargets:nt,skinning:gt}),c[Gt]=st),st}function k(nt,gt,yt,Gt,st,Nt,Bt){var jt=null,xe=N,ae=nt.customDepthMaterial;if(Gt.isPointLight===!0&&(xe=j,ae=nt.customDistanceMaterial),ae===void 0){var Rt=!1;yt.morphTargets===!0&&(Rt=gt.morphAttributes&&gt.morphAttributes.position&&gt.morphAttributes.position.length>0);var Zt=!1;nt.isSkinnedMesh===!0&&(yt.skinning===!0?Zt=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",nt)),jt=xe(Rt,Zt,nt.isInstancedMesh===!0)}else jt=ae;if(t.localClippingEnabled&&yt.clipShadows===!0&&yt.clippingPlanes.length!==0){var qt=jt.uuid,Ht=yt.uuid,Kt=l[qt];Kt===void 0&&(Kt={},l[qt]=Kt);var be=Kt[Ht];be===void 0&&(be=jt.clone(),Kt[Ht]=be),jt=be}return jt.visible=yt.visible,jt.wireframe=yt.wireframe,jt.side=Bt===at?yt.shadowSide!==null?yt.shadowSide:yt.side:yt.shadowSide!==null?yt.shadowSide:h[yt.side],jt.clipShadows=yt.clipShadows,jt.clippingPlanes=yt.clippingPlanes,jt.clipIntersection=yt.clipIntersection,jt.wireframeLinewidth=yt.wireframeLinewidth,jt.linewidth=yt.linewidth,Gt.isPointLight===!0&&jt.isMeshDistanceMaterial===!0&&(jt.referencePosition.setFromMatrixPosition(Gt.matrixWorld),jt.nearDistance=st,jt.farDistance=Nt),jt}function ot(nt,gt,yt,Gt,st){if(nt.visible!==!1){if(nt.layers.test(gt.layers)&&(nt.isMesh||nt.isLine||nt.isPoints)&&(nt.castShadow||nt.receiveShadow&&st===at)&&(!nt.frustumCulled||n.intersectsObject(nt))){nt.modelViewMatrix.multiplyMatrices(yt.matrixWorldInverse,nt.matrixWorld);var Nt=e.update(nt),Bt=nt.material;if(Array.isArray(Bt))for(var jt=Nt.groups,xe=0,ae=jt.length;xe<ae;xe++){var Rt=jt[xe],Zt=Bt[Rt.materialIndex];if(Zt&&Zt.visible){var qt=k(nt,Nt,Zt,Gt,yt.near,yt.far,st);t.renderBufferDirect(yt,null,Nt,qt,nt,Rt)}}else Bt.visible&&(qt=k(nt,Nt,Bt,Gt,yt.near,yt.far,st),t.renderBufferDirect(yt,null,Nt,qt,nt,null))}for(var Ht=nt.children,Kt=0,be=Ht.length;Kt<be;Kt++)ot(Ht[Kt],gt,yt,Gt,st)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=G,this.render=function(nt,gt,yt){if(A.enabled!==!1&&(A.autoUpdate!==!1||A.needsUpdate!==!1)&&nt.length!==0){var Gt=t.getRenderTarget(),st=t.getActiveCubeFace(),Nt=t.getActiveMipmapLevel(),Bt=t.state;Bt.setBlending(pt),Bt.buffers.color.setClear(1,1,1,1),Bt.buffers.depth.setTest(!0),Bt.setScissorTest(!1);for(var jt=0,xe=nt.length;jt<xe;jt++){var ae=nt[jt],Rt=ae.shadow;if(Rt!==void 0){i.copy(Rt.mapSize);var Zt=Rt.getFrameExtents();if(i.multiply(Zt),a.copy(Rt.mapSize),(i.x>r||i.y>r)&&(i.x>r&&(a.x=Math.floor(r/Zt.x),i.x=a.x*Zt.x,Rt.mapSize.x=a.x),i.y>r&&(a.y=Math.floor(r/Zt.y),i.y=a.y*Zt.y,Rt.mapSize.y=a.y)),Rt.map===null&&!Rt.isPointLightShadow&&this.type===at){var qt={minFilter:Lt,magFilter:Lt,format:$r};Rt.map=new nn(i.x,i.y,qt),Rt.map.texture.name=ae.name+".shadowMap",Rt.mapPass=new nn(i.x,i.y,qt),Rt.camera.updateProjectionMatrix()}Rt.map===null&&(qt={minFilter:it,magFilter:it,format:$r},Rt.map=new nn(i.x,i.y,qt),Rt.map.texture.name=ae.name+".shadowMap",Rt.camera.updateProjectionMatrix()),t.setRenderTarget(Rt.map),t.clear();for(var Ht=Rt.getViewportCount(),Kt=0;Kt<Ht;Kt++){var be=Rt.getViewport(Kt);o.set(a.x*be.x,a.y*be.y,a.x*be.z,a.y*be.w),Bt.viewport(o),Rt.updateMatrices(ae,Kt),n=Rt.getFrustum(),ot(gt,yt,Rt.camera,ae,this.type)}Rt.isPointLightShadow||this.type!==at||M(Rt,yt)}else console.warn("THREE.WebGLShadowMap:",ae,"has no shadow.")}A.needsUpdate=!1,t.setRenderTarget(Gt,st,Nt)}}}function Rm(t,e,r){var n=r.isWebGL2,i=new function(){var dt=!1,ue=new er,ye=null,Ee=new er(0,0,0,0);return{setMask:function(ce){ye===ce||dt||(t.colorMask(ce,ce,ce,ce),ye=ce)},setLocked:function(ce){dt=ce},setClear:function(ce,qe,tr,nr,vn){vn===!0&&(ce*=nr,qe*=nr,tr*=nr),ue.set(ce,qe,tr,nr),Ee.equals(ue)===!1&&(t.clearColor(ce,qe,tr,nr),Ee.copy(ue))},reset:function(){dt=!1,ye=null,Ee.set(-1,0,0,0)}}},a=new function(){var dt=!1,ue=null,ye=null,Ee=null;return{setTest:function(ce){ce?Ge(2929):K(2929)},setMask:function(ce){ue===ce||dt||(t.depthMask(ce),ue=ce)},setFunc:function(ce){if(ye!==ce){if(ce)switch(ce){case je:t.depthFunc(512);break;case ft:t.depthFunc(519);break;case tt:t.depthFunc(513);break;case $:t.depthFunc(515);break;case J:t.depthFunc(514);break;case L:t.depthFunc(518);break;case I:t.depthFunc(516);break;case z:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);ye=ce}},setLocked:function(ce){dt=ce},setClear:function(ce){Ee!==ce&&(t.clearDepth(ce),Ee=ce)},reset:function(){dt=!1,ue=null,ye=null,Ee=null}}},o=new function(){var dt=!1,ue=null,ye=null,Ee=null,ce=null,qe=null,tr=null,nr=null,vn=null;return{setTest:function($e){dt||($e?Ge(2960):K(2960))},setMask:function($e){ue===$e||dt||(t.stencilMask($e),ue=$e)},setFunc:function($e,Tr,ze){ye===$e&&Ee===Tr&&ce===ze||(t.stencilFunc($e,Tr,ze),ye=$e,Ee=Tr,ce=ze)},setOp:function($e,Tr,ze){qe===$e&&tr===Tr&&nr===ze||(t.stencilOp($e,Tr,ze),qe=$e,tr=Tr,nr=ze)},setLocked:function($e){dt=$e},setClear:function($e){vn!==$e&&(t.clearStencil($e),vn=$e)},reset:function(){dt=!1,ue=null,ye=null,Ee=null,ce=null,qe=null,tr=null,nr=null,vn=null}}},s=t.getParameter(34921),c=new Uint8Array(s),l=new Uint8Array(s),h=new Uint8Array(s),m={},g=null,u=null,y=null,A=null,M=null,N=null,j=null,k=null,ot=null,nt=!1,gt=null,yt=null,Gt=null,st=null,Nt=null,Bt=t.getParameter(35661),jt=!1,xe=0,ae=t.getParameter(7938);ae.indexOf("WebGL")!==-1?(xe=parseFloat(/^WebGL\ ([0-9])/.exec(ae)[1]),jt=xe>=1):ae.indexOf("OpenGL ES")!==-1&&(xe=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(ae)[1]),jt=xe>=2);var Rt=null,Zt={},qt=new er,Ht=new er;function Kt(dt,ue,ye){var Ee=new Uint8Array(4),ce=t.createTexture();t.bindTexture(dt,ce),t.texParameteri(dt,10241,9728),t.texParameteri(dt,10240,9728);for(var qe=0;qe<ye;qe++)t.texImage2D(ue+qe,0,6408,1,1,0,6408,5121,Ee);return ce}var be={};function Oe(dt,ue){(c[dt]=1,l[dt]===0&&(t.enableVertexAttribArray(dt),l[dt]=1),h[dt]!==ue)&&((n?t:e.get("ANGLE_instanced_arrays"))[n?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](dt,ue),h[dt]=ue)}function Ge(dt){m[dt]!==!0&&(t.enable(dt),m[dt]=!0)}function K(dt){m[dt]!==!1&&(t.disable(dt),m[dt]=!1)}be[3553]=Kt(3553,3553,1),be[34067]=Kt(34067,34069,6),i.setClear(0,0,0,1),a.setClear(1),o.setClear(0),Ge(2929),a.setFunc($),oe(!1),Ft(w),Ge(2884),De(pt);var lt={[At]:32774,[Ut]:32778,[re]:32779};if(n)lt[ie]=32775,lt[Ct]=32776;else{var $t=e.get("EXT_blend_minmax");$t!==null&&(lt[ie]=$t.MIN_EXT,lt[Ct]=$t.MAX_EXT)}var te={[se]:0,[ve]:1,[le]:768,[Pe]:770,[Ce]:776,[he]:774,[Ue]:772,[de]:769,[Ve]:771,[Te]:775,[ke]:773};function De(dt,ue,ye,Ee,ce,qe,tr,nr){if(dt!==pt){if(u||(Ge(3042),u=!0),dt===St)ce=ce||ue,qe=qe||ye,tr=tr||Ee,ue===A&&ce===j||(t.blendEquationSeparate(lt[ue],lt[ce]),A=ue,j=ce),ye===M&&Ee===N&&qe===k&&tr===ot||(t.blendFuncSeparate(te[ye],te[Ee],te[qe],te[tr]),M=ye,N=Ee,k=qe,ot=tr),y=dt,nt=null;else if(dt!==y||nr!==nt){if(A===At&&j===At||(t.blendEquation(32774),A=At,j=At),nr)switch(dt){case ct:t.blendFuncSeparate(1,771,1,771);break;case _t:t.blendFunc(1,1);break;case Ot:t.blendFuncSeparate(0,0,769,771);break;case Vt:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",dt)}else switch(dt){case ct:t.blendFuncSeparate(770,771,1,771);break;case _t:t.blendFunc(770,1);break;case Ot:t.blendFunc(0,769);break;case Vt:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",dt)}M=null,N=null,k=null,ot=null,y=dt,nt=nr}}else u&&(K(3042),u=!1)}function oe(dt){gt!==dt&&(dt?t.frontFace(2304):t.frontFace(2305),gt=dt)}function Ft(dt){dt!==P?(Ge(2884),dt!==yt&&(dt===w?t.cullFace(1029):dt===T?t.cullFace(1028):t.cullFace(1032))):K(2884),yt=dt}function Me(dt,ue,ye){dt?(Ge(32823),st===ue&&Nt===ye||(t.polygonOffset(ue,ye),st=ue,Nt=ye)):K(32823)}function Fe(dt){dt===void 0&&(dt=33984+Bt-1),Rt!==dt&&(t.activeTexture(dt),Rt=dt)}return{buffers:{color:i,depth:a,stencil:o},initAttributes:function(){for(var dt=0,ue=c.length;dt<ue;dt++)c[dt]=0},enableAttribute:function(dt){Oe(dt,0)},enableAttributeAndDivisor:Oe,disableUnusedAttributes:function(){for(var dt=0,ue=l.length;dt!==ue;++dt)l[dt]!==c[dt]&&(t.disableVertexAttribArray(dt),l[dt]=0)},vertexAttribPointer:function(dt,ue,ye,Ee,ce,qe){n!==!0||ye!==5124&&ye!==5125?t.vertexAttribPointer(dt,ue,ye,Ee,ce,qe):t.vertexAttribIPointer(dt,ue,ye,Ee,ce,qe)},enable:Ge,disable:K,useProgram:function(dt){return g!==dt&&(t.useProgram(dt),g=dt,!0)},setBlending:De,setMaterial:function(dt,ue){dt.side===S?K(2884):Ge(2884);var ye=dt.side===x;ue&&(ye=!ye),oe(ye),dt.blending===ct&&dt.transparent===!1?De(pt):De(dt.blending,dt.blendEquation,dt.blendSrc,dt.blendDst,dt.blendEquationAlpha,dt.blendSrcAlpha,dt.blendDstAlpha,dt.premultipliedAlpha),a.setFunc(dt.depthFunc),a.setTest(dt.depthTest),a.setMask(dt.depthWrite),i.setMask(dt.colorWrite);var Ee=dt.stencilWrite;o.setTest(Ee),Ee&&(o.setMask(dt.stencilWriteMask),o.setFunc(dt.stencilFunc,dt.stencilRef,dt.stencilFuncMask),o.setOp(dt.stencilFail,dt.stencilZFail,dt.stencilZPass)),Me(dt.polygonOffset,dt.polygonOffsetFactor,dt.polygonOffsetUnits)},setFlipSided:oe,setCullFace:Ft,setLineWidth:function(dt){dt!==Gt&&(jt&&t.lineWidth(dt),Gt=dt)},setPolygonOffset:Me,setScissorTest:function(dt){dt?Ge(3089):K(3089)},activeTexture:Fe,bindTexture:function(dt,ue){Rt===null&&Fe();var ye=Zt[Rt];ye===void 0&&(ye={type:void 0,texture:void 0},Zt[Rt]=ye),ye.type===dt&&ye.texture===ue||(t.bindTexture(dt,ue||be[dt]),ye.type=dt,ye.texture=ue)},unbindTexture:function(){var dt=Zt[Rt];dt!==void 0&&dt.type!==void 0&&(t.bindTexture(dt.type,null),dt.type=void 0,dt.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(dt){console.error("THREE.WebGLState:",dt)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(dt){console.error("THREE.WebGLState:",dt)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(dt){console.error("THREE.WebGLState:",dt)}},scissor:function(dt){qt.equals(dt)===!1&&(t.scissor(dt.x,dt.y,dt.z,dt.w),qt.copy(dt))},viewport:function(dt){Ht.equals(dt)===!1&&(t.viewport(dt.x,dt.y,dt.z,dt.w),Ht.copy(dt))},reset:function(){for(var dt=0;dt<l.length;dt++)l[dt]===1&&(t.disableVertexAttribArray(dt),l[dt]=0);m={},Rt=null,Zt={},g=null,y=null,gt=null,yt=null,i.reset(),a.reset(),o.reset()}}}function Pm(t,e,r,n,i,a,o){var s,c=i.isWebGL2,l=i.maxTextures,h=i.maxCubemapSize,m=i.maxTextureSize,g=i.maxSamples,u=new WeakMap,y=!1;try{y=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(K){}function A(K,lt){return y?new OffscreenCanvas(K,lt):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function M(K,lt,$t,te){var De=1;if((K.width>te||K.height>te)&&(De=te/Math.max(K.width,K.height)),De<1||lt===!0){if(typeof HTMLImageElement!="undefined"&&K instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&K instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&K instanceof ImageBitmap){var oe=lt?We.floorPowerOfTwo:Math.floor,Ft=oe(De*K.width),Me=oe(De*K.height);s===void 0&&(s=A(Ft,Me));var Fe=$t?A(Ft,Me):s;return Fe.width=Ft,Fe.height=Me,Fe.getContext("2d").drawImage(K,0,0,Ft,Me),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+K.width+"x"+K.height+") to ("+Ft+"x"+Me+")."),Fe}return"data"in K&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+K.width+"x"+K.height+")."),K}return K}function N(K){return We.isPowerOfTwo(K.width)&&We.isPowerOfTwo(K.height)}function j(K,lt){return K.generateMipmaps&&lt&&K.minFilter!==it&&K.minFilter!==Lt}function k(K,lt,$t,te){t.generateMipmap(K),n.get(lt).__maxMipLevel=Math.log(Math.max($t,te))*Math.LOG2E}function ot(K,lt,$t){if(c===!1)return lt;if(K!==null){if(t[K]!==void 0)return t[K];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+K+"'")}var te=lt;return lt===6403&&($t===5126&&(te=33326),$t===5131&&(te=33325),$t===5121&&(te=33321)),lt===6407&&($t===5126&&(te=34837),$t===5131&&(te=34843),$t===5121&&(te=32849)),lt===6408&&($t===5126&&(te=34836),$t===5131&&(te=34842),$t===5121&&(te=32856)),te!==33325&&te!==33326&&te!==34842&&te!==34836||e.get("EXT_color_buffer_float"),te}function nt(K){return K===it||K===mt||K===It?9728:9729}function gt(K){var lt=K.target;lt.removeEventListener("dispose",gt),function($t){var te=n.get($t);if(te.__webglInit===void 0)return;t.deleteTexture(te.__webglTexture),n.remove($t)}(lt),lt.isVideoTexture&&u.delete(lt),o.memory.textures--}function yt(K){var lt=K.target;lt.removeEventListener("dispose",yt),function($t){var te=n.get($t),De=n.get($t.texture);if(!$t)return;if(De.__webglTexture!==void 0&&t.deleteTexture(De.__webglTexture),$t.depthTexture&&$t.depthTexture.dispose(),$t.isWebGLCubeRenderTarget)for(var oe=0;oe<6;oe++)t.deleteFramebuffer(te.__webglFramebuffer[oe]),te.__webglDepthbuffer&&t.deleteRenderbuffer(te.__webglDepthbuffer[oe]);else t.deleteFramebuffer(te.__webglFramebuffer),te.__webglDepthbuffer&&t.deleteRenderbuffer(te.__webglDepthbuffer),te.__webglMultisampledFramebuffer&&t.deleteFramebuffer(te.__webglMultisampledFramebuffer),te.__webglColorRenderbuffer&&t.deleteRenderbuffer(te.__webglColorRenderbuffer),te.__webglDepthRenderbuffer&&t.deleteRenderbuffer(te.__webglDepthRenderbuffer);n.remove($t.texture),n.remove($t)}(lt),o.memory.textures--}var Gt=0;function st(K,lt){var $t=n.get(K);if(K.isVideoTexture&&function(De){var oe=o.render.frame;u.get(De)!==oe&&(u.set(De,oe),De.update())}(K),K.version>0&&$t.__version!==K.version){var te=K.image;if(te===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(te.complete!==!1)return void Zt($t,K,lt);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(33984+lt),r.bindTexture(3553,$t.__webglTexture)}function Nt(K,lt){if(K.image.length===6){var $t=n.get(K);if(K.version>0&&$t.__version!==K.version){Rt($t,K),r.activeTexture(33984+lt),r.bindTexture(34067,$t.__webglTexture),t.pixelStorei(37440,K.flipY);for(var te=K&&(K.isCompressedTexture||K.image[0].isCompressedTexture),De=K.image[0]&&K.image[0].isDataTexture,oe=[],Ft=0;Ft<6;Ft++)oe[Ft]=te||De?De?K.image[Ft].image:K.image[Ft]:M(K.image[Ft],!1,!0,h);var Me,Fe=oe[0],dt=N(Fe)||c,ue=a.convert(K.format),ye=a.convert(K.type),Ee=ot(K.internalFormat,ue,ye);if(ae(34067,K,dt),te){for(Ft=0;Ft<6;Ft++){Me=oe[Ft].mipmaps;for(var ce=0;ce<Me.length;ce++){var qe=Me[ce];K.format!==$r&&K.format!==Bn?ue!==null?r.compressedTexImage2D(34069+Ft,ce,Ee,qe.width,qe.height,0,qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+Ft,ce,Ee,qe.width,qe.height,0,ue,ye,qe.data)}}$t.__maxMipLevel=Me.length-1}else{for(Me=K.mipmaps,Ft=0;Ft<6;Ft++)if(De)for(r.texImage2D(34069+Ft,0,Ee,oe[Ft].width,oe[Ft].height,0,ue,ye,oe[Ft].data),ce=0;ce<Me.length;ce++){var tr=(qe=Me[ce]).image[Ft].image;r.texImage2D(34069+Ft,ce+1,Ee,tr.width,tr.height,0,ue,ye,tr.data)}else for(r.texImage2D(34069+Ft,0,Ee,ue,ye,oe[Ft]),ce=0;ce<Me.length;ce++)qe=Me[ce],r.texImage2D(34069+Ft,ce+1,Ee,ue,ye,qe.image[Ft]);$t.__maxMipLevel=Me.length}j(K,dt)&&k(34067,K,Fe.width,Fe.height),$t.__version=K.version,K.onUpdate&&K.onUpdate(K)}else r.activeTexture(33984+lt),r.bindTexture(34067,$t.__webglTexture)}}function Bt(K,lt){r.activeTexture(33984+lt),r.bindTexture(34067,n.get(K).__webglTexture)}var jt={[R]:10497,[B]:33071,[V]:33648},xe={[it]:9728,[mt]:9984,[It]:9986,[Lt]:9729,[Se]:9985,[lr]:9987};function ae(K,lt,$t){$t?(t.texParameteri(K,10242,jt[lt.wrapS]),t.texParameteri(K,10243,jt[lt.wrapT]),K!==32879&&K!==35866||t.texParameteri(K,32882,jt[lt.wrapR]),t.texParameteri(K,10240,xe[lt.magFilter]),t.texParameteri(K,10241,xe[lt.minFilter])):(t.texParameteri(K,10242,33071),t.texParameteri(K,10243,33071),K!==32879&&K!==35866||t.texParameteri(K,32882,33071),lt.wrapS===B&&lt.wrapT===B||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(K,10240,nt(lt.magFilter)),t.texParameteri(K,10241,nt(lt.minFilter)),lt.minFilter!==it&&lt.minFilter!==Lt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var te=e.get("EXT_texture_filter_anisotropic");if(te){if(lt.type===Xr&&e.get("OES_texture_float_linear")===null)return;if(lt.type===xr&&(c||e.get("OES_texture_half_float_linear"))===null)return;(lt.anisotropy>1||n.get(lt).__currentAnisotropy)&&(t.texParameterf(K,te.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(lt.anisotropy,i.getMaxAnisotropy())),n.get(lt).__currentAnisotropy=lt.anisotropy)}}function Rt(K,lt){K.__webglInit===void 0&&(K.__webglInit=!0,lt.addEventListener("dispose",gt),K.__webglTexture=t.createTexture(),o.memory.textures++)}function Zt(K,lt,$t){var te=3553;lt.isDataTexture2DArray&&(te=35866),lt.isDataTexture3D&&(te=32879),Rt(K,lt),r.activeTexture(33984+$t),r.bindTexture(te,K.__webglTexture),t.pixelStorei(37440,lt.flipY),t.pixelStorei(37441,lt.premultiplyAlpha),t.pixelStorei(3317,lt.unpackAlignment);var De=function(qe){return!c&&(qe.wrapS!==B||qe.wrapT!==B||qe.minFilter!==it&&qe.minFilter!==Lt)}(lt)&&N(lt.image)===!1,oe=M(lt.image,De,!1,m),Ft=N(oe)||c,Me=a.convert(lt.format),Fe=a.convert(lt.type),dt=ot(lt.internalFormat,Me,Fe);ae(te,lt,Ft);var ue,ye=lt.mipmaps;if(lt.isDepthTexture)dt=6402,c?dt=lt.type===Xr?36012:lt.type===Vr?33190:lt.type===Kn?35056:33189:lt.type===Xr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),lt.format===Ri&&dt===6402&&lt.type!==Pr&&lt.type!==Vr&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),lt.type=Pr,Fe=a.convert(lt.type)),lt.format===ya&&dt===6402&&(dt=34041,lt.type!==Kn&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),lt.type=Kn,Fe=a.convert(lt.type))),r.texImage2D(3553,0,dt,oe.width,oe.height,0,Me,Fe,null);else if(lt.isDataTexture)if(ye.length>0&&Ft){for(var Ee=0,ce=ye.length;Ee<ce;Ee++)ue=ye[Ee],r.texImage2D(3553,Ee,dt,ue.width,ue.height,0,Me,Fe,ue.data);lt.generateMipmaps=!1,K.__maxMipLevel=ye.length-1}else r.texImage2D(3553,0,dt,oe.width,oe.height,0,Me,Fe,oe.data),K.__maxMipLevel=0;else if(lt.isCompressedTexture){for(Ee=0,ce=ye.length;Ee<ce;Ee++)ue=ye[Ee],lt.format!==$r&&lt.format!==Bn?Me!==null?r.compressedTexImage2D(3553,Ee,dt,ue.width,ue.height,0,ue.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,Ee,dt,ue.width,ue.height,0,Me,Fe,ue.data);K.__maxMipLevel=ye.length-1}else if(lt.isDataTexture2DArray)r.texImage3D(35866,0,dt,oe.width,oe.height,oe.depth,0,Me,Fe,oe.data),K.__maxMipLevel=0;else if(lt.isDataTexture3D)r.texImage3D(32879,0,dt,oe.width,oe.height,oe.depth,0,Me,Fe,oe.data),K.__maxMipLevel=0;else if(ye.length>0&&Ft){for(Ee=0,ce=ye.length;Ee<ce;Ee++)ue=ye[Ee],r.texImage2D(3553,Ee,dt,Me,Fe,ue);lt.generateMipmaps=!1,K.__maxMipLevel=ye.length-1}else r.texImage2D(3553,0,dt,Me,Fe,oe),K.__maxMipLevel=0;j(lt,Ft)&&k(te,lt,oe.width,oe.height),K.__version=lt.version,lt.onUpdate&&lt.onUpdate(lt)}function qt(K,lt,$t,te){var De=a.convert(lt.texture.format),oe=a.convert(lt.texture.type),Ft=ot(lt.texture.internalFormat,De,oe);r.texImage2D(te,0,Ft,lt.width,lt.height,0,De,oe,null),t.bindFramebuffer(36160,K),t.framebufferTexture2D(36160,$t,te,n.get(lt.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function Ht(K,lt,$t){if(t.bindRenderbuffer(36161,K),lt.depthBuffer&&!lt.stencilBuffer){var te=33189;if($t){var De=lt.depthTexture;De&&De.isDepthTexture&&(De.type===Xr?te=36012:De.type===Vr&&(te=33190));var oe=be(lt);t.renderbufferStorageMultisample(36161,oe,te,lt.width,lt.height)}else t.renderbufferStorage(36161,te,lt.width,lt.height);t.framebufferRenderbuffer(36160,36096,36161,K)}else if(lt.depthBuffer&&lt.stencilBuffer)$t?(oe=be(lt),t.renderbufferStorageMultisample(36161,oe,35056,lt.width,lt.height)):t.renderbufferStorage(36161,34041,lt.width,lt.height),t.framebufferRenderbuffer(36160,33306,36161,K);else{var Ft=a.convert(lt.texture.format),Me=a.convert(lt.texture.type);te=ot(lt.texture.internalFormat,Ft,Me),$t?(oe=be(lt),t.renderbufferStorageMultisample(36161,oe,te,lt.width,lt.height)):t.renderbufferStorage(36161,te,lt.width,lt.height)}t.bindRenderbuffer(36161,null)}function Kt(K){var lt=n.get(K),$t=K.isWebGLCubeRenderTarget===!0;if(K.depthTexture){if($t)throw new Error("target.depthTexture not supported in Cube render targets");!function(De,oe){if(oe&&oe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,De),!oe.depthTexture||!oe.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(oe.depthTexture).__webglTexture&&oe.depthTexture.image.width===oe.width&&oe.depthTexture.image.height===oe.height||(oe.depthTexture.image.width=oe.width,oe.depthTexture.image.height=oe.height,oe.depthTexture.needsUpdate=!0),st(oe.depthTexture,0);var Ft=n.get(oe.depthTexture).__webglTexture;if(oe.depthTexture.format===Ri)t.framebufferTexture2D(36160,36096,3553,Ft,0);else{if(oe.depthTexture.format!==ya)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,Ft,0)}}(lt.__webglFramebuffer,K)}else if($t){lt.__webglDepthbuffer=[];for(var te=0;te<6;te++)t.bindFramebuffer(36160,lt.__webglFramebuffer[te]),lt.__webglDepthbuffer[te]=t.createRenderbuffer(),Ht(lt.__webglDepthbuffer[te],K,!1)}else t.bindFramebuffer(36160,lt.__webglFramebuffer),lt.__webglDepthbuffer=t.createRenderbuffer(),Ht(lt.__webglDepthbuffer,K,!1);t.bindFramebuffer(36160,null)}function be(K){return c&&K.isWebGLMultisampleRenderTarget?Math.min(g,K.samples):0}var Oe=!1,Ge=!1;this.allocateTextureUnit=function(){var K=Gt;return K>=l&&console.warn("THREE.WebGLTextures: Trying to use "+K+" texture units while this GPU supports only "+l),Gt+=1,K},this.resetTextureUnits=function(){Gt=0},this.setTexture2D=st,this.setTexture2DArray=function(K,lt){var $t=n.get(K);K.version>0&&$t.__version!==K.version?Zt($t,K,lt):(r.activeTexture(33984+lt),r.bindTexture(35866,$t.__webglTexture))},this.setTexture3D=function(K,lt){var $t=n.get(K);K.version>0&&$t.__version!==K.version?Zt($t,K,lt):(r.activeTexture(33984+lt),r.bindTexture(32879,$t.__webglTexture))},this.setTextureCube=Nt,this.setTextureCubeDynamic=Bt,this.setupRenderTarget=function(K){var lt=n.get(K),$t=n.get(K.texture);K.addEventListener("dispose",yt),$t.__webglTexture=t.createTexture(),o.memory.textures++;var te=K.isWebGLCubeRenderTarget===!0,De=K.isWebGLMultisampleRenderTarget===!0,oe=N(K)||c;if(!c||K.texture.format!==Bn||K.texture.type!==Xr&&K.texture.type!==xr||(K.texture.format=$r,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),te){lt.__webglFramebuffer=[];for(var Ft=0;Ft<6;Ft++)lt.__webglFramebuffer[Ft]=t.createFramebuffer()}else if(lt.__webglFramebuffer=t.createFramebuffer(),De)if(c){lt.__webglMultisampledFramebuffer=t.createFramebuffer(),lt.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,lt.__webglColorRenderbuffer);var Me=a.convert(K.texture.format),Fe=a.convert(K.texture.type),dt=ot(K.texture.internalFormat,Me,Fe),ue=be(K);t.renderbufferStorageMultisample(36161,ue,dt,K.width,K.height),t.bindFramebuffer(36160,lt.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,lt.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),K.depthBuffer&&(lt.__webglDepthRenderbuffer=t.createRenderbuffer(),Ht(lt.__webglDepthRenderbuffer,K,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(te){for(r.bindTexture(34067,$t.__webglTexture),ae(34067,K.texture,oe),Ft=0;Ft<6;Ft++)qt(lt.__webglFramebuffer[Ft],K,36064,34069+Ft);j(K.texture,oe)&&k(34067,K.texture,K.width,K.height),r.bindTexture(34067,null)}else r.bindTexture(3553,$t.__webglTexture),ae(3553,K.texture,oe),qt(lt.__webglFramebuffer,K,36064,3553),j(K.texture,oe)&&k(3553,K.texture,K.width,K.height),r.bindTexture(3553,null);K.depthBuffer&&Kt(K)},this.updateRenderTargetMipmap=function(K){var lt=K.texture;if(j(lt,N(K)||c)){var $t=K.isWebGLCubeRenderTarget?34067:3553,te=n.get(lt).__webglTexture;r.bindTexture($t,te),k($t,lt,K.width,K.height),r.bindTexture($t,null)}},this.updateMultisampleRenderTarget=function(K){if(K.isWebGLMultisampleRenderTarget)if(c){var lt=n.get(K);t.bindFramebuffer(36008,lt.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,lt.__webglFramebuffer);var $t=K.width,te=K.height,De=16384;K.depthBuffer&&(De|=256),K.stencilBuffer&&(De|=1024),t.blitFramebuffer(0,0,$t,te,0,0,$t,te,De,9728),t.bindFramebuffer(36160,lt.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(K,lt){K&&K.isWebGLRenderTarget&&(Oe===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),Oe=!0),K=K.texture),st(K,lt)},this.safeSetTextureCube=function(K,lt){K&&K.isWebGLCubeRenderTarget&&(Ge===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Ge=!0),K=K.texture),K&&K.isCubeTexture||Array.isArray(K.image)&&K.image.length===6?Nt(K,lt):Bt(K,lt)}}function Md(t,e,r){var n=r.isWebGL2;return{convert:function(i){var a;if(i===He)return 5121;if(i===bn)return 32819;if(i===wn)return 32820;if(i===_o)return 33635;if(i===yr)return 5120;if(i===Br)return 5122;if(i===Pr)return 5123;if(i===xn)return 5124;if(i===Vr)return 5125;if(i===Xr)return 5126;if(i===xr)return n?5131:(a=e.get("OES_texture_half_float"))!==null?a.HALF_FLOAT_OES:null;if(i===ga)return 6406;if(i===Bn)return 6407;if(i===$r)return 6408;if(i===qu)return 6409;if(i===Xu)return 6410;if(i===Ri)return 6402;if(i===ya)return 34041;if(i===Zu)return 6403;if(i===Ju)return 36244;if(i===Ku)return 33319;if(i===Qu)return 33320;if(i===$u)return 36248;if(i===th)return 36249;if(i===ul||i===hl||i===dl||i===pl){if((a=e.get("WEBGL_compressed_texture_s3tc"))===null)return null;if(i===ul)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===hl)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===dl)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===pl)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===fl||i===ml||i===vl||i===gl){if((a=e.get("WEBGL_compressed_texture_pvrtc"))===null)return null;if(i===fl)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===ml)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===vl)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===gl)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===eh)return(a=e.get("WEBGL_compressed_texture_etc1"))!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if((i===yl||i===xl)&&(a=e.get("WEBGL_compressed_texture_etc"))!==null){if(i===yl)return a.COMPRESSED_RGB8_ETC2;if(i===xl)return a.COMPRESSED_RGBA8_ETC2_EAC}return i===rh||i===nh||i===ih||i===ah||i===oh||i===sh||i===ch||i===lh||i===uh||i===hh||i===dh||i===ph||i===fh||i===mh||i===gh||i===yh||i===xh||i===bh||i===wh||i===_h||i===Mh||i===Sh||i===Th||i===Eh||i===Ah||i===Lh||i===Rh||i===Ph?(a=e.get("WEBGL_compressed_texture_astc"))!==null?i:null:i===vh?(a=e.get("EXT_texture_compression_bptc"))!==null?i:null:i===Kn?n?34042:(a=e.get("WEBGL_depth_texture"))!==null?a.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function ec(t){Or.call(this),this.cameras=t||[]}function Ga(){ge.call(this),this.type="Group"}function rc(){this._targetRay=null,this._grip=null}function Sd(t,e){var r=this,n=null,i=1,a=null,o="local-floor",s=null,c=[],l=new Map,h=new Or;h.layers.enable(1),h.viewport=new er;var m=new Or;m.layers.enable(2),m.viewport=new er;var g=[h,m],u=new ec;u.layers.enable(1),u.layers.enable(2);var y=null,A=null;function M(st){var Nt=l.get(st.inputSource);Nt&&Nt.dispatchEvent({type:st.type})}function N(){l.forEach(function(st,Nt){st.disconnect(Nt)}),l.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),Gt.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function j(st){a=st,Gt.setContext(n),Gt.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}function k(st){for(var Nt=n.inputSources,Bt=0;Bt<c.length;Bt++)l.set(Nt[Bt],c[Bt]);for(Bt=0;Bt<st.removed.length;Bt++){var jt=st.removed[Bt];(xe=l.get(jt))&&(xe.dispatchEvent({type:"disconnected",data:jt}),l.delete(jt))}for(Bt=0;Bt<st.added.length;Bt++){var xe;jt=st.added[Bt],(xe=l.get(jt))&&xe.dispatchEvent({type:"connected",data:jt})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(st){var Nt=c[st];return Nt===void 0&&(Nt=new rc,c[st]=Nt),Nt.getTargetRaySpace()},this.getControllerGrip=function(st){var Nt=c[st];return Nt===void 0&&(Nt=new rc,c[st]=Nt),Nt.getGripSpace()},this.setFramebufferScaleFactor=function(st){i=st,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(st){o=st,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getSession=function(){return n},this.setSession=function(st){if((n=st)!==null){n.addEventListener("select",M),n.addEventListener("selectstart",M),n.addEventListener("selectend",M),n.addEventListener("squeeze",M),n.addEventListener("squeezestart",M),n.addEventListener("squeezeend",M),n.addEventListener("end",N);var Nt=e.getContextAttributes();Nt.xrCompatible!==!0&&e.makeXRCompatible();var Bt={antialias:Nt.antialias,alpha:Nt.alpha,depth:Nt.depth,stencil:Nt.stencil,framebufferScaleFactor:i},jt=new XRWebGLLayer(n,e,Bt);n.updateRenderState({baseLayer:jt}),n.requestReferenceSpace(o).then(j),n.addEventListener("inputsourceschange",k)}};var ot=new q,nt=new q;function gt(st,Nt){Nt===null?st.matrixWorld.copy(st.matrix):st.matrixWorld.multiplyMatrices(Nt.matrixWorld,st.matrix),st.matrixWorldInverse.getInverse(st.matrixWorld)}this.getCamera=function(st){u.near=m.near=h.near=st.near,u.far=m.far=h.far=st.far,y===u.near&&A===u.far||(n.updateRenderState({depthNear:u.near,depthFar:u.far}),y=u.near,A=u.far);var Nt=st.parent,Bt=u.cameras;gt(u,Nt);for(var jt=0;jt<Bt.length;jt++)gt(Bt[jt],Nt);st.matrixWorld.copy(u.matrixWorld);for(var xe=st.children,ae=(jt=0,xe.length);jt<ae;jt++)xe[jt].updateMatrixWorld(!0);return Bt.length===2?function(Rt,Zt,qt){ot.setFromMatrixPosition(Zt.matrixWorld),nt.setFromMatrixPosition(qt.matrixWorld);var Ht=ot.distanceTo(nt),Kt=Zt.projectionMatrix.elements,be=qt.projectionMatrix.elements,Oe=Kt[14]/(Kt[10]-1),Ge=Kt[14]/(Kt[10]+1),K=(Kt[9]+1)/Kt[5],lt=(Kt[9]-1)/Kt[5],$t=(Kt[8]-1)/Kt[0],te=(be[8]+1)/be[0],De=Oe*$t,oe=Oe*te,Ft=Ht/(-$t+te),Me=Ft*-$t;Zt.matrixWorld.decompose(Rt.position,Rt.quaternion,Rt.scale),Rt.translateX(Me),Rt.translateZ(Ft),Rt.matrixWorld.compose(Rt.position,Rt.quaternion,Rt.scale),Rt.matrixWorldInverse.getInverse(Rt.matrixWorld);var Fe=Oe+Ft,dt=Ge+Ft,ue=De-Me,ye=oe+(Ht-Me),Ee=K*Ge/dt*Fe,ce=lt*Ge/dt*Fe;Rt.projectionMatrix.makePerspective(ue,ye,Ee,ce,Fe,dt)}(u,h,m):u.projectionMatrix.copy(h.projectionMatrix),u};var yt=null,Gt=new td;Gt.setAnimationLoop(function(st,Nt){if((s=Nt.getViewerPose(a))!==null){var Bt=s.views,jt=n.renderState.baseLayer;t.setFramebuffer(jt.framebuffer);var xe=!1;Bt.length!==u.cameras.length&&(u.cameras.length=0,xe=!0);for(var ae=0;ae<Bt.length;ae++){var Rt=Bt[ae],Zt=jt.getViewport(Rt),qt=g[ae];qt.matrix.fromArray(Rt.transform.matrix),qt.projectionMatrix.fromArray(Rt.projectionMatrix),qt.viewport.set(Zt.x,Zt.y,Zt.width,Zt.height),ae===0&&u.matrix.copy(qt.matrix),xe===!0&&u.cameras.push(qt)}}var Ht=n.inputSources;for(ae=0;ae<c.length;ae++){var Kt=c[ae],be=Ht[ae];Kt.update(be,Nt,a)}yt&&yt(st,Nt)}),this.setAnimationLoop=function(st){yt=st},this.dispose=function(){}}function Cm(t){function e(n,i,a){n.opacity.value=i.opacity,i.color&&n.diffuse.value.copy(i.color),i.emissive&&n.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(n.map.value=i.map),i.alphaMap&&(n.alphaMap.value=i.alphaMap),i.specularMap&&(n.specularMap.value=i.specularMap);var o,s,c=i.envMap||a;c&&(n.envMap.value=c,n.flipEnvMap.value=c.isCubeTexture?-1:1,n.reflectivity.value=i.reflectivity,n.refractionRatio.value=i.refractionRatio,n.maxMipLevel.value=t.get(c).__maxMipLevel),i.lightMap&&(n.lightMap.value=i.lightMap,n.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(n.aoMap.value=i.aoMap,n.aoMapIntensity.value=i.aoMapIntensity),i.map?o=i.map:i.specularMap?o=i.specularMap:i.displacementMap?o=i.displacementMap:i.normalMap?o=i.normalMap:i.bumpMap?o=i.bumpMap:i.roughnessMap?o=i.roughnessMap:i.metalnessMap?o=i.metalnessMap:i.alphaMap?o=i.alphaMap:i.emissiveMap&&(o=i.emissiveMap),o!==void 0&&(o.isWebGLRenderTarget&&(o=o.texture),o.matrixAutoUpdate===!0&&o.updateMatrix(),n.uvTransform.value.copy(o.matrix)),i.aoMap?s=i.aoMap:i.lightMap&&(s=i.lightMap),s!==void 0&&(s.isWebGLRenderTarget&&(s=s.texture),s.matrixAutoUpdate===!0&&s.updateMatrix(),n.uv2Transform.value.copy(s.matrix))}function r(n,i,a){n.roughness.value=i.roughness,n.metalness.value=i.metalness,i.roughnessMap&&(n.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(n.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(n.emissiveMap.value=i.emissiveMap),i.bumpMap&&(n.bumpMap.value=i.bumpMap,n.bumpScale.value=i.bumpScale,i.side===x&&(n.bumpScale.value*=-1)),i.normalMap&&(n.normalMap.value=i.normalMap,n.normalScale.value.copy(i.normalScale),i.side===x&&n.normalScale.value.negate()),i.displacementMap&&(n.displacementMap.value=i.displacementMap,n.displacementScale.value=i.displacementScale,n.displacementBias.value=i.displacementBias),(i.envMap||a)&&(n.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(n,i){n.fogColor.value.copy(i.color),i.isFog?(n.fogNear.value=i.near,n.fogFar.value=i.far):i.isFogExp2&&(n.fogDensity.value=i.density)},refreshMaterialUniforms:function(n,i,a,o,s){i.isMeshBasicMaterial?e(n,i):i.isMeshLambertMaterial?(e(n,i),function(c,l){l.emissiveMap&&(c.emissiveMap.value=l.emissiveMap)}(n,i)):i.isMeshToonMaterial?(e(n,i),function(c,l){c.specular.value.copy(l.specular),c.shininess.value=Math.max(l.shininess,1e-4),l.gradientMap&&(c.gradientMap.value=l.gradientMap),l.emissiveMap&&(c.emissiveMap.value=l.emissiveMap),l.bumpMap&&(c.bumpMap.value=l.bumpMap,c.bumpScale.value=l.bumpScale,l.side===x&&(c.bumpScale.value*=-1)),l.normalMap&&(c.normalMap.value=l.normalMap,c.normalScale.value.copy(l.normalScale),l.side===x&&c.normalScale.value.negate()),l.displacementMap&&(c.displacementMap.value=l.displacementMap,c.displacementScale.value=l.displacementScale,c.displacementBias.value=l.displacementBias)}(n,i)):i.isMeshPhongMaterial?(e(n,i),function(c,l){c.specular.value.copy(l.specular),c.shininess.value=Math.max(l.shininess,1e-4),l.emissiveMap&&(c.emissiveMap.value=l.emissiveMap),l.bumpMap&&(c.bumpMap.value=l.bumpMap,c.bumpScale.value=l.bumpScale,l.side===x&&(c.bumpScale.value*=-1)),l.normalMap&&(c.normalMap.value=l.normalMap,c.normalScale.value.copy(l.normalScale),l.side===x&&c.normalScale.value.negate()),l.displacementMap&&(c.displacementMap.value=l.displacementMap,c.displacementScale.value=l.displacementScale,c.displacementBias.value=l.displacementBias)}(n,i)):i.isMeshStandardMaterial?(e(n,i,a),i.isMeshPhysicalMaterial?function(c,l,h){r(c,l,h),c.reflectivity.value=l.reflectivity,c.clearcoat.value=l.clearcoat,c.clearcoatRoughness.value=l.clearcoatRoughness,l.sheen&&c.sheen.value.copy(l.sheen),l.clearcoatMap&&(c.clearcoatMap.value=l.clearcoatMap),l.clearcoatRoughnessMap&&(c.clearcoatRoughnessMap.value=l.clearcoatRoughnessMap),l.clearcoatNormalMap&&(c.clearcoatNormalScale.value.copy(l.clearcoatNormalScale),c.clearcoatNormalMap.value=l.clearcoatNormalMap,l.side===x&&c.clearcoatNormalScale.value.negate()),c.transparency.value=l.transparency}(n,i,a):r(n,i,a)):i.isMeshMatcapMaterial?(e(n,i),function(c,l){l.matcap&&(c.matcap.value=l.matcap),l.bumpMap&&(c.bumpMap.value=l.bumpMap,c.bumpScale.value=l.bumpScale,l.side===x&&(c.bumpScale.value*=-1)),l.normalMap&&(c.normalMap.value=l.normalMap,c.normalScale.value.copy(l.normalScale),l.side===x&&c.normalScale.value.negate()),l.displacementMap&&(c.displacementMap.value=l.displacementMap,c.displacementScale.value=l.displacementScale,c.displacementBias.value=l.displacementBias)}(n,i)):i.isMeshDepthMaterial?(e(n,i),function(c,l){l.displacementMap&&(c.displacementMap.value=l.displacementMap,c.displacementScale.value=l.displacementScale,c.displacementBias.value=l.displacementBias)}(n,i)):i.isMeshDistanceMaterial?(e(n,i),function(c,l){l.displacementMap&&(c.displacementMap.value=l.displacementMap,c.displacementScale.value=l.displacementScale,c.displacementBias.value=l.displacementBias),c.referencePosition.value.copy(l.referencePosition),c.nearDistance.value=l.nearDistance,c.farDistance.value=l.farDistance}(n,i)):i.isMeshNormalMaterial?(e(n,i),function(c,l){l.bumpMap&&(c.bumpMap.value=l.bumpMap,c.bumpScale.value=l.bumpScale,l.side===x&&(c.bumpScale.value*=-1)),l.normalMap&&(c.normalMap.value=l.normalMap,c.normalScale.value.copy(l.normalScale),l.side===x&&c.normalScale.value.negate()),l.displacementMap&&(c.displacementMap.value=l.displacementMap,c.displacementScale.value=l.displacementScale,c.displacementBias.value=l.displacementBias)}(n,i)):i.isLineBasicMaterial?(function(c,l){c.diffuse.value.copy(l.color),c.opacity.value=l.opacity}(n,i),i.isLineDashedMaterial&&function(c,l){c.dashSize.value=l.dashSize,c.totalSize.value=l.dashSize+l.gapSize,c.scale.value=l.scale}(n,i)):i.isPointsMaterial?function(c,l,h,m){c.diffuse.value.copy(l.color),c.opacity.value=l.opacity,c.size.value=l.size*h,c.scale.value=.5*m,l.map&&(c.map.value=l.map),l.alphaMap&&(c.alphaMap.value=l.alphaMap);var g;l.map?g=l.map:l.alphaMap&&(g=l.alphaMap),g!==void 0&&(g.matrixAutoUpdate===!0&&g.updateMatrix(),c.uvTransform.value.copy(g.matrix))}(n,i,o,s):i.isSpriteMaterial?function(c,l){c.diffuse.value.copy(l.color),c.opacity.value=l.opacity,c.rotation.value=l.rotation,l.map&&(c.map.value=l.map),l.alphaMap&&(c.alphaMap.value=l.alphaMap);var h;l.map?h=l.map:l.alphaMap&&(h=l.alphaMap),h!==void 0&&(h.matrixAutoUpdate===!0&&h.updateMatrix(),c.uvTransform.value.copy(h.matrix))}(n,i):i.isShadowMaterial?(n.color.value.copy(i.color),n.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Yl(t){var e=(t=t||{}).canvas!==void 0?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=t.context!==void 0?t.context:null,n=t.alpha!==void 0&&t.alpha,i=t.depth===void 0||t.depth,a=t.stencil===void 0||t.stencil,o=t.antialias!==void 0&&t.antialias,s=t.premultipliedAlpha===void 0||t.premultipliedAlpha,c=t.preserveDrawingBuffer!==void 0&&t.preserveDrawingBuffer,l=t.powerPreference!==void 0?t.powerPreference:"default",h=t.failIfMajorPerformanceCaveat!==void 0&&t.failIfMajorPerformanceCaveat,m=null,g=null;this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Yr,this.physicallyCorrectLights=!1,this.toneMapping=D,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var u,y,A,M,N,j,k,ot,nt,gt,yt,Gt,st,Nt,Bt,jt,xe,ae,Rt,Zt=this,qt=!1,Ht=null,Kt=0,be=0,Oe=null,Ge=null,K=-1,lt={geometry:null,program:null,wireframe:!1},$t=null,te=null,De=new er,oe=new er,Ft=null,Me=e.width,Fe=e.height,dt=1,ue=null,ye=null,Ee=new er(0,0,Me,Fe),ce=new er(0,0,Me,Fe),qe=!1,tr=new Ba,nr=new Sf,vn=!1,$e=!1,Tr=new Xe,ze=new q;function ir(){return Oe===null?dt:1}try{var pr={alpha:n,depth:i,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:c,powerPreference:l,failIfMajorPerformanceCaveat:h};if(e.addEventListener("webglcontextlost",qr,!1),e.addEventListener("webglcontextrestored",Kr,!1),(u=r||e.getContext("webgl",pr)||e.getContext("experimental-webgl",pr))===null)throw e.getContext("webgl")!==null?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");u.getShaderPrecisionFormat===void 0&&(u.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(et){throw console.error("THREE.WebGLRenderer: "+et.message),et}function Lr(){y=new Tf(u),(A=new Mf(u,y,t)).isWebGL2===!1&&(y.get("WEBGL_depth_texture"),y.get("OES_texture_float"),y.get("OES_texture_half_float"),y.get("OES_texture_half_float_linear"),y.get("OES_standard_derivatives"),y.get("OES_element_index_uint"),y.get("ANGLE_instanced_arrays")),y.get("OES_texture_float_linear"),Rt=new Md(u,y,A),(M=new Rm(u,y,A)).scissor(oe.copy(ce).multiplyScalar(dt).floor()),M.viewport(De.copy(Ee).multiplyScalar(dt).floor()),N=new Lf(u),j=new bm,k=new Pm(u,y,M,j,A,Rt,N),ot=new bf(u,A),nt=new Ef(u,ot,N),gt=new Cf(u,nt,ot,N),jt=new Pf(u),yt=new xm(Zt,y,A),Gt=new Cm(j),st=new Mm,Nt=new Lm,Bt=new wf(Zt,M,gt,s),xe=new _f(u,y,N,A),ae=new Af(u,y,N,A),N.programs=yt.programs,Zt.capabilities=A,Zt.extensions=y,Zt.properties=j,Zt.renderLists=st,Zt.state=M,Zt.info=N}Lr();var ar=new Sd(Zt,u);this.xr=ar;var Gr=new _d(Zt,gt,A.maxTextureSize);function qr(et){et.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),qt=!0}function Kr(){console.log("THREE.WebGLRenderer: Context Restored."),qt=!1,Lr()}function In(et){var Qt=et.target;Qt.removeEventListener("dispose",In),function(Dt){Jn(Dt),j.remove(Dt)}(Qt)}function Jn(et){var Qt=j.get(et).program;et.program=void 0,Qt!==void 0&&yt.releaseProgram(Qt)}this.shadowMap=Gr,this.getContext=function(){return u},this.getContextAttributes=function(){return u.getContextAttributes()},this.forceContextLoss=function(){var et=y.get("WEBGL_lose_context");et&&et.loseContext()},this.forceContextRestore=function(){var et=y.get("WEBGL_lose_context");et&&et.restoreContext()},this.getPixelRatio=function(){return dt},this.setPixelRatio=function(et){et!==void 0&&(dt=et,this.setSize(Me,Fe,!1))},this.getSize=function(et){return et===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),et=new Wt),et.set(Me,Fe)},this.setSize=function(et,Qt,Dt){ar.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Me=et,Fe=Qt,e.width=Math.floor(et*dt),e.height=Math.floor(Qt*dt),Dt!==!1&&(e.style.width=et+"px",e.style.height=Qt+"px"),this.setViewport(0,0,et,Qt))},this.getDrawingBufferSize=function(et){return et===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),et=new Wt),et.set(Me*dt,Fe*dt).floor()},this.setDrawingBufferSize=function(et,Qt,Dt){Me=et,Fe=Qt,dt=Dt,e.width=Math.floor(et*Dt),e.height=Math.floor(Qt*Dt),this.setViewport(0,0,et,Qt)},this.getCurrentViewport=function(et){return et===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),et=new er),et.copy(De)},this.getViewport=function(et){return et.copy(Ee)},this.setViewport=function(et,Qt,Dt,Yt){et.isVector4?Ee.set(et.x,et.y,et.z,et.w):Ee.set(et,Qt,Dt,Yt),M.viewport(De.copy(Ee).multiplyScalar(dt).floor())},this.getScissor=function(et){return et.copy(ce)},this.setScissor=function(et,Qt,Dt,Yt){et.isVector4?ce.set(et.x,et.y,et.z,et.w):ce.set(et,Qt,Dt,Yt),M.scissor(oe.copy(ce).multiplyScalar(dt).floor())},this.getScissorTest=function(){return qe},this.setScissorTest=function(et){M.setScissorTest(qe=et)},this.setOpaqueSort=function(et){ue=et},this.setTransparentSort=function(et){ye=et},this.getClearColor=function(){return Bt.getClearColor()},this.setClearColor=function(){Bt.setClearColor.apply(Bt,arguments)},this.getClearAlpha=function(){return Bt.getClearAlpha()},this.setClearAlpha=function(){Bt.setClearAlpha.apply(Bt,arguments)},this.clear=function(et,Qt,Dt){var Yt=0;(et===void 0||et)&&(Yt|=16384),(Qt===void 0||Qt)&&(Yt|=256),(Dt===void 0||Dt)&&(Yt|=1024),u.clear(Yt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",qr,!1),e.removeEventListener("webglcontextrestored",Kr,!1),st.dispose(),Nt.dispose(),j.dispose(),gt.dispose(),ar.dispose(),da.stop()},this.renderBufferImmediate=function(et,Qt){M.initAttributes();var Dt=j.get(et);et.hasPositions&&!Dt.position&&(Dt.position=u.createBuffer()),et.hasNormals&&!Dt.normal&&(Dt.normal=u.createBuffer()),et.hasUvs&&!Dt.uv&&(Dt.uv=u.createBuffer()),et.hasColors&&!Dt.color&&(Dt.color=u.createBuffer());var Yt=Qt.getAttributes();et.hasPositions&&(u.bindBuffer(34962,Dt.position),u.bufferData(34962,et.positionArray,35048),M.enableAttribute(Yt.position),u.vertexAttribPointer(Yt.position,3,5126,!1,0,0)),et.hasNormals&&(u.bindBuffer(34962,Dt.normal),u.bufferData(34962,et.normalArray,35048),M.enableAttribute(Yt.normal),u.vertexAttribPointer(Yt.normal,3,5126,!1,0,0)),et.hasUvs&&(u.bindBuffer(34962,Dt.uv),u.bufferData(34962,et.uvArray,35048),M.enableAttribute(Yt.uv),u.vertexAttribPointer(Yt.uv,2,5126,!1,0,0)),et.hasColors&&(u.bindBuffer(34962,Dt.color),u.bufferData(34962,et.colorArray,35048),M.enableAttribute(Yt.color),u.vertexAttribPointer(Yt.color,3,5126,!1,0,0)),M.disableUnusedAttributes(),u.drawArrays(4,0,et.count),et.count=0};var Rs=new _a;this.renderBufferDirect=function(et,Qt,Dt,Yt,me,Ye){Qt===null&&(Qt=Rs);var Qe=me.isMesh&&me.matrixWorld.determinant()<0,Le=Ds(et,Qt,Yt,me);M.setMaterial(Yt,Qe);var Rr=!1;lt.geometry===Dt.id&&lt.program===Le.id&&lt.wireframe===(Yt.wireframe===!0)||(lt.geometry=Dt.id,lt.program=Le.id,lt.wireframe=Yt.wireframe===!0,Rr=!0),(Yt.morphTargets||Yt.morphNormals)&&(jt.update(me,Dt,Yt,Le),Rr=!0),me.isInstancedMesh===!0&&(Rr=!0);var dr=Dt.index,cr=Dt.attributes.position;if(dr===null){if(cr===void 0||cr.count===0)return}else if(dr.count===0)return;var or,Dr=1;Yt.wireframe===!0&&(dr=nt.getWireframeAttribute(Dt),Dr=2);var Ke=xe;dr!==null&&(or=ot.get(dr),(Ke=ae).setIndex(or)),Rr&&(!function(Sp,yo,Hv,jv){if(A.isWebGL2===!1&&(Sp.isInstancedMesh||yo.isInstancedBufferGeometry)&&y.get("ANGLE_instanced_arrays")===null)return;M.initAttributes();var Wv=yo.attributes,Tp=jv.getAttributes(),Ep=Hv.defaultAttributeValues;for(var il in Tp){var Nr=Tp[il];if(Nr>=0){var Nn=Wv[il];if(Nn!==void 0){var Ap=Nn.normalized,Lp=Nn.itemSize;if((va=ot.get(Nn))===void 0)continue;var al=va.buffer,ma=va.type,Rp=va.bytesPerElement;if(Nn.isInterleavedBufferAttribute){var xo=Nn.data,qv=xo.stride,Xv=Nn.offset;xo&&xo.isInstancedInterleavedBuffer?(M.enableAttributeAndDivisor(Nr,xo.meshPerAttribute),yo._maxInstanceCount===void 0&&(yo._maxInstanceCount=xo.meshPerAttribute*xo.count)):M.enableAttribute(Nr),u.bindBuffer(34962,al),M.vertexAttribPointer(Nr,Lp,ma,Ap,qv*Rp,Xv*Rp)}else Nn.isInstancedBufferAttribute?(M.enableAttributeAndDivisor(Nr,Nn.meshPerAttribute),yo._maxInstanceCount===void 0&&(yo._maxInstanceCount=Nn.meshPerAttribute*Nn.count)):M.enableAttribute(Nr),u.bindBuffer(34962,al),M.vertexAttribPointer(Nr,Lp,ma,Ap,0,0)}else if(il==="instanceMatrix"){var va;if((va=ot.get(Sp.instanceMatrix))===void 0)continue;al=va.buffer,ma=va.type,M.enableAttributeAndDivisor(Nr+0,1),M.enableAttributeAndDivisor(Nr+1,1),M.enableAttributeAndDivisor(Nr+2,1),M.enableAttributeAndDivisor(Nr+3,1),u.bindBuffer(34962,al),u.vertexAttribPointer(Nr+0,4,ma,!1,64,0),u.vertexAttribPointer(Nr+1,4,ma,!1,64,16),u.vertexAttribPointer(Nr+2,4,ma,!1,64,32),u.vertexAttribPointer(Nr+3,4,ma,!1,64,48)}else if(Ep!==void 0){var bo=Ep[il];if(bo!==void 0)switch(bo.length){case 2:u.vertexAttrib2fv(Nr,bo);break;case 3:u.vertexAttrib3fv(Nr,bo);break;case 4:u.vertexAttrib4fv(Nr,bo);break;default:u.vertexAttrib1fv(Nr,bo)}}}}M.disableUnusedAttributes()}(me,Dt,Yt,Le),dr!==null&&u.bindBuffer(34963,or.buffer));var gn=dr!==null?dr.count:cr.count,Li=Dt.drawRange.start*Dr,fr=Dt.drawRange.count*Dr,yn=Ye!==null?Ye.start*Dr:0,nl=Ye!==null?Ye.count*Dr:1/0,Qr=Math.max(Li,yn),ju=Math.min(gn,Li+fr,yn+nl)-1,rn=Math.max(0,ju-Qr+1);if(rn!==0){if(me.isMesh)Yt.wireframe===!0?(M.setLineWidth(Yt.wireframeLinewidth*ir()),Ke.setMode(1)):Ke.setMode(4);else if(me.isLine){var fa=Yt.linewidth;fa===void 0&&(fa=1),M.setLineWidth(fa*ir()),me.isLineSegments?Ke.setMode(1):me.isLineLoop?Ke.setMode(2):Ke.setMode(3)}else me.isPoints?Ke.setMode(0):me.isSprite&&Ke.setMode(4);if(me.isInstancedMesh)Ke.renderInstances(Dt,Qr,rn,me.count);else if(Dt.isInstancedBufferGeometry){var Wu=Math.min(Dt.instanceCount,Dt._maxInstanceCount);Ke.renderInstances(Dt,Qr,rn,Wu)}else Ke.render(Qr,rn)}},this.compile=function(et,Qt){(g=Nt.get(et,Qt)).init(),et.traverse(function(Yt){Yt.isLight&&(g.pushLight(Yt),Yt.castShadow&&g.pushShadow(Yt))}),g.setupLights(Qt);const Dt={};et.traverse(function(Yt){let me=Yt.material;if(me)if(Array.isArray(me))for(let Ye=0;Ye<me.length;Ye++){let Qe=me[Ye];Qe.uuid in Dt==!1&&(hi(Qe,et,Yt),Dt[Qe.uuid]=!0)}else me.uuid in Dt==!1&&(hi(me,et,Yt),Dt[me.uuid]=!0)})};var Ps=null,da=new td;function Cs(et,Qt,Dt,Yt){if(et.visible!==!1){if(et.layers.test(Qt.layers)){if(et.isGroup)Dt=et.renderOrder;else if(et.isLOD)et.autoUpdate===!0&&et.update(Qt);else if(et.isLight)g.pushLight(et),et.castShadow&&g.pushShadow(et);else if(et.isSprite){if(!et.frustumCulled||tr.intersectsSprite(et)){Yt&&ze.setFromMatrixPosition(et.matrixWorld).applyMatrix4(Tr);var me=gt.update(et);(Ye=et.material).visible&&m.push(et,me,Ye,Dt,ze.z,null)}}else if(et.isImmediateRenderObject)Yt&&ze.setFromMatrixPosition(et.matrixWorld).applyMatrix4(Tr),m.push(et,null,et.material,Dt,ze.z,null);else if((et.isMesh||et.isLine||et.isPoints)&&(et.isSkinnedMesh&&et.skeleton.frame!==N.render.frame&&(et.skeleton.update(),et.skeleton.frame=N.render.frame),!et.frustumCulled||tr.intersectsObject(et))){Yt&&ze.setFromMatrixPosition(et.matrixWorld).applyMatrix4(Tr),me=gt.update(et);var Ye=et.material;if(Array.isArray(Ye))for(var Qe=me.groups,Le=0,Rr=Qe.length;Le<Rr;Le++){var dr=Qe[Le],cr=Ye[dr.materialIndex];cr&&cr.visible&&m.push(et,me,cr,Dt,ze.z,dr)}else Ye.visible&&m.push(et,me,Ye,Dt,ze.z,null)}}var or=et.children;for(Le=0,Rr=or.length;Le<Rr;Le++)Cs(or[Le],Qt,Dt,Yt)}}function pa(et,Qt,Dt,Yt){for(var me=0,Ye=et.length;me<Ye;me++){var Qe=et[me],Le=Qe.object,Rr=Qe.geometry,dr=Yt===void 0?Qe.material:Yt,cr=Qe.group;if(Dt.isArrayCamera){te=Dt;for(var or=Dt.cameras,Dr=0,Ke=or.length;Dr<Ke;Dr++){var gn=or[Dr];Le.layers.test(gn.layers)&&(M.viewport(De.copy(gn.viewport)),g.setupLights(gn),Os(Le,Qt,gn,Rr,dr,cr))}}else te=null,Os(Le,Qt,Dt,Rr,dr,cr)}}function Os(et,Qt,Dt,Yt,me,Ye){if(et.onBeforeRender(Zt,Qt,Dt,Yt,me,Ye),g=Nt.get(Qt,te||Dt),et.modelViewMatrix.multiplyMatrices(Dt.matrixWorldInverse,et.matrixWorld),et.normalMatrix.getNormalMatrix(et.modelViewMatrix),et.isImmediateRenderObject){var Qe=Ds(Dt,Qt,me,et);M.setMaterial(me),lt.geometry=null,lt.program=null,lt.wireframe=!1,function(Le,Rr){Le.render(function(dr){Zt.renderBufferImmediate(dr,Rr)})}(et,Qe)}else Zt.renderBufferDirect(Dt,Qt,Yt,me,et,Ye);et.onAfterRender(Zt,Qt,Dt,Yt,me,Ye),g=Nt.get(Qt,te||Dt)}function hi(et,Qt,Dt){var Yt=j.get(et),me=g.state.lights,Ye=g.state.shadowsArray,Qe=me.state.version,Le=yt.getParameters(et,me.state,Ye,Qt,nr.numPlanes,nr.numIntersection,Dt),Rr=yt.getProgramCacheKey(Le),dr=Yt.program,cr=!0;if(dr===void 0)et.addEventListener("dispose",In);else if(dr.cacheKey!==Rr)Jn(et);else if(Yt.lightsStateVersion!==Qe)Yt.lightsStateVersion=Qe,cr=!1;else{if(Le.shaderID!==void 0)return;cr=!1}cr&&(dr=yt.acquireProgram(Le,Rr),Yt.program=dr,Yt.uniforms=Le.uniforms,Yt.outputEncoding=Le.outputEncoding,et.program=dr);var or=dr.getAttributes();if(et.morphTargets){et.numSupportedMorphTargets=0;for(var Dr=0;Dr<Zt.maxMorphTargets;Dr++)or["morphTarget"+Dr]>=0&&et.numSupportedMorphTargets++}if(et.morphNormals)for(et.numSupportedMorphNormals=0,Dr=0;Dr<Zt.maxMorphNormals;Dr++)or["morphNormal"+Dr]>=0&&et.numSupportedMorphNormals++;var Ke=Yt.uniforms;(et.isShaderMaterial||et.isRawShaderMaterial)&&et.clipping!==!0||(Yt.numClippingPlanes=nr.numPlanes,Yt.numIntersection=nr.numIntersection,Ke.clippingPlanes=nr.uniform),Yt.environment=et.isMeshStandardMaterial?Qt.environment:null,Yt.fog=Qt.fog,Yt.needsLights=function(fr){return fr.isMeshLambertMaterial||fr.isMeshToonMaterial||fr.isMeshPhongMaterial||fr.isMeshStandardMaterial||fr.isShadowMaterial||fr.isShaderMaterial&&fr.lights===!0}(et),Yt.lightsStateVersion=Qe,Yt.needsLights&&(Ke.ambientLightColor.value=me.state.ambient,Ke.lightProbe.value=me.state.probe,Ke.directionalLights.value=me.state.directional,Ke.directionalLightShadows.value=me.state.directionalShadow,Ke.spotLights.value=me.state.spot,Ke.spotLightShadows.value=me.state.spotShadow,Ke.rectAreaLights.value=me.state.rectArea,Ke.pointLights.value=me.state.point,Ke.pointLightShadows.value=me.state.pointShadow,Ke.hemisphereLights.value=me.state.hemi,Ke.directionalShadowMap.value=me.state.directionalShadowMap,Ke.directionalShadowMatrix.value=me.state.directionalShadowMatrix,Ke.spotShadowMap.value=me.state.spotShadowMap,Ke.spotShadowMatrix.value=me.state.spotShadowMatrix,Ke.pointShadowMap.value=me.state.pointShadowMap,Ke.pointShadowMatrix.value=me.state.pointShadowMatrix);var gn=Yt.program.getUniforms(),Li=bi.seqWithValue(gn.seq,Ke);Yt.uniformsList=Li}function Ds(et,Qt,Dt,Yt){k.resetTextureUnits();var me=Qt.fog,Ye=Dt.isMeshStandardMaterial?Qt.environment:null,Qe=Oe===null?Zt.outputEncoding:Oe.texture.encoding,Le=j.get(Dt),Rr=g.state.lights;if(vn&&($e||et!==$t)){var dr=et===$t&&Dt.id===K;nr.setState(Dt.clippingPlanes,Dt.clipIntersection,Dt.clipShadows,et,Le,dr)}Dt.version===Le.__version?Le.program===void 0||Dt.fog&&Le.fog!==me||Le.environment!==Ye||Le.needsLights&&Le.lightsStateVersion!==Rr.state.version?hi(Dt,Qt,Yt):Le.numClippingPlanes===void 0||Le.numClippingPlanes===nr.numPlanes&&Le.numIntersection===nr.numIntersection?Le.outputEncoding!==Qe&&hi(Dt,Qt,Yt):hi(Dt,Qt,Yt):(hi(Dt,Qt,Yt),Le.__version=Dt.version);var cr,or,Dr=!1,Ke=!1,gn=!1,Li=Le.program,fr=Li.getUniforms(),yn=Le.uniforms;if(M.useProgram(Li.program)&&(Dr=!0,Ke=!0,gn=!0),Dt.id!==K&&(K=Dt.id,Ke=!0),Dr||$t!==et){if(fr.setValue(u,"projectionMatrix",et.projectionMatrix),A.logarithmicDepthBuffer&&fr.setValue(u,"logDepthBufFC",2/(Math.log(et.far+1)/Math.LN2)),$t!==et&&($t=et,Ke=!0,gn=!0),Dt.isShaderMaterial||Dt.isMeshPhongMaterial||Dt.isMeshToonMaterial||Dt.isMeshStandardMaterial||Dt.envMap){var nl=fr.map.cameraPosition;nl!==void 0&&nl.setValue(u,ze.setFromMatrixPosition(et.matrixWorld))}(Dt.isMeshPhongMaterial||Dt.isMeshToonMaterial||Dt.isMeshLambertMaterial||Dt.isMeshBasicMaterial||Dt.isMeshStandardMaterial||Dt.isShaderMaterial)&&fr.setValue(u,"isOrthographic",et.isOrthographicCamera===!0),(Dt.isMeshPhongMaterial||Dt.isMeshToonMaterial||Dt.isMeshLambertMaterial||Dt.isMeshBasicMaterial||Dt.isMeshStandardMaterial||Dt.isShaderMaterial||Dt.skinning)&&fr.setValue(u,"viewMatrix",et.matrixWorldInverse)}if(Dt.skinning){fr.setOptional(u,Yt,"bindMatrix"),fr.setOptional(u,Yt,"bindMatrixInverse");var Qr=Yt.skeleton;if(Qr){var ju=Qr.bones;if(A.floatVertexTextures){if(Qr.boneTexture===void 0){var rn=Math.sqrt(4*ju.length);rn=We.ceilPowerOfTwo(rn),rn=Math.max(rn,4);var fa=new Float32Array(rn*rn*4);fa.set(Qr.boneMatrices);var Wu=new ki(fa,rn,rn,$r,Xr);Qr.boneMatrices=fa,Qr.boneTexture=Wu,Qr.boneTextureSize=rn}fr.setValue(u,"boneTexture",Qr.boneTexture,k),fr.setValue(u,"boneTextureSize",Qr.boneTextureSize)}else fr.setOptional(u,Qr,"boneMatrices")}}return(Ke||Le.receiveShadow!==Yt.receiveShadow)&&(Le.receiveShadow=Yt.receiveShadow,fr.setValue(u,"receiveShadow",Yt.receiveShadow)),Ke&&(fr.setValue(u,"toneMappingExposure",Zt.toneMappingExposure),fr.setValue(u,"toneMappingWhitePoint",Zt.toneMappingWhitePoint),Le.needsLights&&(or=gn,(cr=yn).ambientLightColor.needsUpdate=or,cr.lightProbe.needsUpdate=or,cr.directionalLights.needsUpdate=or,cr.directionalLightShadows.needsUpdate=or,cr.pointLights.needsUpdate=or,cr.pointLightShadows.needsUpdate=or,cr.spotLights.needsUpdate=or,cr.spotLightShadows.needsUpdate=or,cr.rectAreaLights.needsUpdate=or,cr.hemisphereLights.needsUpdate=or),me&&Dt.fog&&Gt.refreshFogUniforms(yn,me),Gt.refreshMaterialUniforms(yn,Dt,Ye,dt,Fe),yn.ltc_1!==void 0&&(yn.ltc_1.value=fe.LTC_1),yn.ltc_2!==void 0&&(yn.ltc_2.value=fe.LTC_2),bi.upload(u,Le.uniformsList,yn,k)),Dt.isShaderMaterial&&Dt.uniformsNeedUpdate===!0&&(bi.upload(u,Le.uniformsList,yn,k),Dt.uniformsNeedUpdate=!1),Dt.isSpriteMaterial&&fr.setValue(u,"center",Yt.center),fr.setValue(u,"modelViewMatrix",Yt.modelViewMatrix),fr.setValue(u,"normalMatrix",Yt.normalMatrix),fr.setValue(u,"modelMatrix",Yt.matrixWorld),Li}da.setAnimationLoop(function(et){ar.isPresenting||Ps&&Ps(et)}),typeof window!="undefined"&&da.setContext(window),this.setAnimationLoop=function(et){Ps=et,ar.setAnimationLoop(et),da.start()},this.render=function(et,Qt){var Dt,Yt;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),Dt=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),Yt=arguments[3]),Qt&&Qt.isCamera){if(!qt){lt.geometry=null,lt.program=null,lt.wireframe=!1,K=-1,$t=null,et.autoUpdate===!0&&et.updateMatrixWorld(),Qt.parent===null&&Qt.updateMatrixWorld(),ar.enabled&&ar.isPresenting&&(Qt=ar.getCamera(Qt)),et.onBeforeRender(Zt,et,Qt,Dt||Oe),(g=Nt.get(et,Qt)).init(),Tr.multiplyMatrices(Qt.projectionMatrix,Qt.matrixWorldInverse),tr.setFromProjectionMatrix(Tr),$e=this.localClippingEnabled,vn=nr.init(this.clippingPlanes,$e,Qt),(m=st.get(et,Qt)).init(),Cs(et,Qt,0,Zt.sortObjects),m.finish(),Zt.sortObjects===!0&&m.sort(ue,ye),vn&&nr.beginShadows();var me=g.state.shadowsArray;Gr.render(me,et,Qt),g.setupLights(Qt),vn&&nr.endShadows(),this.info.autoReset&&this.info.reset(),Dt!==void 0&&this.setRenderTarget(Dt),Bt.render(m,et,Qt,Yt);var Ye=m.opaque,Qe=m.transparent;if(et.overrideMaterial){var Le=et.overrideMaterial;Ye.length&&pa(Ye,et,Qt,Le),Qe.length&&pa(Qe,et,Qt,Le)}else Ye.length&&pa(Ye,et,Qt),Qe.length&&pa(Qe,et,Qt);et.onAfterRender(Zt,et,Qt),Oe!==null&&(k.updateRenderTargetMipmap(Oe),k.updateMultisampleRenderTarget(Oe)),M.buffers.depth.setTest(!0),M.buffers.depth.setMask(!0),M.buffers.color.setMask(!0),M.setPolygonOffset(!1),m=null,g=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(et){Ht!==et&&Oe===null&&u.bindFramebuffer(36160,et),Ht=et},this.getActiveCubeFace=function(){return Kt},this.getActiveMipmapLevel=function(){return be},this.getRenderTarget=function(){return Oe},this.setRenderTarget=function(et,Qt,Dt){Oe=et,Kt=Qt,be=Dt,et&&j.get(et).__webglFramebuffer===void 0&&k.setupRenderTarget(et);var Yt=Ht,me=!1;if(et){var Ye=j.get(et).__webglFramebuffer;et.isWebGLCubeRenderTarget?(Yt=Ye[Qt||0],me=!0):Yt=et.isWebGLMultisampleRenderTarget?j.get(et).__webglMultisampledFramebuffer:Ye,De.copy(et.viewport),oe.copy(et.scissor),Ft=et.scissorTest}else De.copy(Ee).multiplyScalar(dt).floor(),oe.copy(ce).multiplyScalar(dt).floor(),Ft=qe;if(Ge!==Yt&&(u.bindFramebuffer(36160,Yt),Ge=Yt),M.viewport(De),M.scissor(oe),M.setScissorTest(Ft),me){var Qe=j.get(et.texture);u.framebufferTexture2D(36160,36064,34069+(Qt||0),Qe.__webglTexture,Dt||0)}},this.readRenderTargetPixels=function(et,Qt,Dt,Yt,me,Ye,Qe){if(et&&et.isWebGLRenderTarget){var Le=j.get(et).__webglFramebuffer;if(et.isWebGLCubeRenderTarget&&Qe!==void 0&&(Le=Le[Qe]),Le){var Rr=!1;Le!==Ge&&(u.bindFramebuffer(36160,Le),Rr=!0);try{var dr=et.texture,cr=dr.format,or=dr.type;if(cr!==$r&&Rt.convert(cr)!==u.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(or===He||Rt.convert(or)===u.getParameter(35738)||or===Xr&&(A.isWebGL2||y.get("OES_texture_float")||y.get("WEBGL_color_buffer_float"))||or===xr&&(A.isWebGL2?y.get("EXT_color_buffer_float"):y.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");u.checkFramebufferStatus(36160)===36053?Qt>=0&&Qt<=et.width-Yt&&Dt>=0&&Dt<=et.height-me&&u.readPixels(Qt,Dt,Yt,me,Rt.convert(cr),Rt.convert(or),Ye):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{Rr&&u.bindFramebuffer(36160,Ge)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(et,Qt,Dt){Dt===void 0&&(Dt=0);var Yt=Math.pow(2,-Dt),me=Math.floor(Qt.image.width*Yt),Ye=Math.floor(Qt.image.height*Yt),Qe=Rt.convert(Qt.format);k.setTexture2D(Qt,0),u.copyTexImage2D(3553,Dt,Qe,et.x,et.y,me,Ye,0),M.unbindTexture()},this.copyTextureToTexture=function(et,Qt,Dt,Yt){Yt===void 0&&(Yt=0);var me=Qt.image.width,Ye=Qt.image.height,Qe=Rt.convert(Dt.format),Le=Rt.convert(Dt.type);k.setTexture2D(Dt,0),Qt.isDataTexture?u.texSubImage2D(3553,Yt,et.x,et.y,me,Ye,Qe,Le,Qt.image.data):Qt.isCompressedTexture?u.compressedTexSubImage2D(3553,Yt,et.x,et.y,Qt.mipmaps[0].width,Qt.mipmaps[0].height,Qe,Qt.mipmaps[0].data):u.texSubImage2D(3553,Yt,et.x,et.y,Qe,Le,Qt.image),Yt===0&&Dt.generateMipmaps&&u.generateMipmap(3553),M.unbindTexture()},this.initTexture=function(et){k.setTexture2D(et,0),M.unbindTexture()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function nc(t,e){this.name="",this.color=new we(t),this.density=e!==void 0?e:25e-5}function ic(t,e,r){this.name="",this.color=new we(t),this.near=e!==void 0?e:1,this.far=r!==void 0?r:1e3}function ii(t,e){this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=Ao,this.updateRange={offset:0,count:-1},this.version=0}ec.prototype=Object.assign(Object.create(Or.prototype),{constructor:ec,isArrayCamera:!0}),Ga.prototype=Object.assign(Object.create(ge.prototype),{constructor:Ga,isGroup:!0}),Object.assign(rc.prototype,{constructor:rc,getTargetRaySpace:function(){return this._targetRay===null&&(this._targetRay=new Ga,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return this._grip===null&&(this._grip=new Ga,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this},update:function(t,e,r){var n=null,i=null,a=this._targetRay,o=this._grip;return t&&(a!==null&&(n=e.getPose(t.targetRaySpace,r))!==null&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)),o!==null&&t.gripSpace&&(i=e.getPose(t.gripSpace,r))!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale))),a!==null&&(a.visible=n!==null),o!==null&&(o.visible=i!==null),this}}),Object.assign(Sd.prototype,Fn.prototype),Object.assign(nc.prototype,{isFogExp2:!0,clone:function(){return new nc(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(ic.prototype,{isFog:!0,clone:function(){return new ic(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(ii.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}}),Object.assign(ii.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,r){t*=this.stride,r*=e.stride;for(var n=0,i=this.stride;n<i;n++)this.array[t+n]=e.array[r+n];return this},set:function(t,e){return e===void 0&&(e=0),this.array.set(t,e),this},clone:function(){return new this.constructor().copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}});var Va,ji=new q;function jo(t,e,r,n){this.name="",this.data=t,this.itemSize=e,this.offset=r,this.normalized=n===!0}function Mi(t){Ne.call(this),this.type="SpriteMaterial",this.color=new we(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}Object.defineProperties(jo.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(jo.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(var e=0,r=this.data.count;e<r;e++)ji.x=this.getX(e),ji.y=this.getY(e),ji.z=this.getZ(e),ji.applyMatrix4(t),this.setXYZ(e,ji.x,ji.y,ji.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this},setXYZ:function(t,e,r,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=i,this},clone:function(){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],e=0;e<this.count;e++)for(var r=e*this.data.stride+this.offset,n=0;n<this.itemSize;n++)t.push(this.data.array[r+n]);return new Ie(new this.array.constructor(t),this.itemSize,this.normalized)},toJSON:function(){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],e=0;e<this.count;e++)for(var r=e*this.data.stride+this.offset,n=0;n<this.itemSize;n++)t.push(this.data.array[r+n]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}}),Mi.prototype=Object.create(Ne.prototype),Mi.prototype.constructor=Mi,Mi.prototype.isSpriteMaterial=!0,Mi.prototype.copy=function(t){return Ne.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};var Wo=new q,ka=new q,Ha=new q,ja=new Wt,qo=new Wt,Td=new Xe,ac=new q,Xo=new q,oc=new q,Ed=new Wt,Zl=new Wt,Ad=new Wt;function Yo(t){if(ge.call(this),this.type="Sprite",Va===void 0){Va=new _e;var e=new ii(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Va.setIndex([0,1,2,0,2,3]),Va.setAttribute("position",new jo(e,3,0,!1)),Va.setAttribute("uv",new jo(e,2,3,!1))}this.geometry=Va,this.material=t!==void 0?t:new Mi,this.center=new Wt(.5,.5)}function sc(t,e,r,n,i,a){ja.subVectors(t,r).addScalar(.5).multiply(n),i!==void 0?(qo.x=a*ja.x-i*ja.y,qo.y=i*ja.x+a*ja.y):qo.copy(ja),t.copy(e),t.x+=qo.x,t.y+=qo.y,t.applyMatrix4(Td)}Yo.prototype=Object.assign(Object.create(ge.prototype),{constructor:Yo,isSprite:!0,raycast:function(t,e){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ka.setFromMatrixScale(this.matrixWorld),Td.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Ha.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&ka.multiplyScalar(-Ha.z);var r,n,i=this.material.rotation;i!==0&&(n=Math.cos(i),r=Math.sin(i));var a=this.center;sc(ac.set(-.5,-.5,0),Ha,a,ka,r,n),sc(Xo.set(.5,-.5,0),Ha,a,ka,r,n),sc(oc.set(.5,.5,0),Ha,a,ka,r,n),Ed.set(0,0),Zl.set(1,0),Ad.set(1,1);var o=t.ray.intersectTriangle(ac,Xo,oc,!1,Wo);if(o!==null||(sc(Xo.set(-.5,.5,0),Ha,a,ka,r,n),Zl.set(0,1),(o=t.ray.intersectTriangle(ac,oc,Xo,!1,Wo))!==null)){var s=t.ray.origin.distanceTo(Wo);s<t.near||s>t.far||e.push({distance:s,point:Wo.clone(),uv:Fr.getUV(Wo,ac,Xo,oc,Ed,Zl,Ad,new Wt),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return ge.prototype.copy.call(this,t),t.center!==void 0&&this.center.copy(t.center),this}});var Jl,Kl,Ql,Ld,$l,cc=new q,Rd=new q;function Zo(){ge.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function lc(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),br.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Xe,this.bindMatrixInverse=new Xe}Zo.prototype=Object.assign(Object.create(ge.prototype),{constructor:Zo,isLOD:!0,copy:function(t){ge.prototype.copy.call(this,t,!1);for(var e=t.levels,r=0,n=e.length;r<n;r++){var i=e[r];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e){e===void 0&&(e=0),e=Math.abs(e);for(var r=this.levels,n=0;n<r.length&&!(e<r[n].distance);n++);return r.splice(n,0,{distance:e,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){var e=this.levels;if(e.length>0){for(var r=1,n=e.length;r<n&&!(t<e[r].distance);r++);return e[r-1].object}return null},raycast:function(t,e){if(this.levels.length>0){cc.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(cc);this.getObjectForDistance(r).raycast(t,e)}},update:function(t){var e=this.levels;if(e.length>1){cc.setFromMatrixPosition(t.matrixWorld),Rd.setFromMatrixPosition(this.matrixWorld);var r=cc.distanceTo(Rd)/t.zoom;e[0].object.visible=!0;for(var n=1,i=e.length;n<i&&r>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(this._currentLevel=n-1;n<i;n++)e[n].object.visible=!1}},toJSON:function(t){var e=ge.prototype.toJSON.call(this,t);this.autoUpdate===!1&&(e.object.autoUpdate=!1),e.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var a=r[n];e.object.levels.push({object:a.object.uuid,distance:a.distance})}return e}}),lc.prototype=Object.assign(Object.create(br.prototype),{constructor:lc,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new er,e=this.geometry.attributes.skinWeight,r=0,n=e.count;r<n;r++){t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.w=e.getW(r);var i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(r,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){br.prototype.updateMatrixWorld.call(this,t),this.bindMode==="attached"?this.bindMatrixInverse.getInverse(this.matrixWorld):this.bindMode==="detached"?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)},boneTransform:(Jl=new q,Kl=new er,Ql=new er,Ld=new q,$l=new Xe,function(t,e){var r=this.skeleton,n=this.geometry;Kl.fromBufferAttribute(n.attributes.skinIndex,t),Ql.fromBufferAttribute(n.attributes.skinWeight,t),Jl.fromBufferAttribute(n.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(var i=0;i<4;i++){var a=Ql.getComponent(i);if(a!==0){var o=Kl.getComponent(i);$l.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),e.addScaledVector(Ld.copy(Jl).applyMatrix4($l),a)}}return e.applyMatrix4(this.bindMatrixInverse)})});var Pd=new Xe,Om=new Xe;function uc(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,e===void 0)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new Xe)}}function tu(){ge.call(this),this.type="Bone"}Object.assign(uc.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var r=new Xe;this.bones[t]&&r.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(r)}},pose:function(){var t,e,r;for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,e=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,i=0,a=t.length;i<a;i++){var o=t[i]?t[i].matrixWorld:Om;Pd.multiplyMatrices(o,e[i]),Pd.toArray(r,16*i)}n!==void 0&&(n.needsUpdate=!0)},clone:function(){return new uc(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,r=this.bones.length;e<r;e++){var n=this.bones[e];if(n.name===t)return n}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),tu.prototype=Object.assign(Object.create(ge.prototype),{constructor:tu,isBone:!0});var Cd=new Xe,Od=new Xe,hc=[],Jo=new br;function dc(t,e,r){br.call(this,t,e),this.instanceMatrix=new Ie(new Float32Array(16*r),16),this.count=r,this.frustumCulled=!1}function wr(t){Ne.call(this),this.type="LineBasicMaterial",this.color=new we(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}dc.prototype=Object.assign(Object.create(br.prototype),{constructor:dc,isInstancedMesh:!0,getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){var r=this.matrixWorld,n=this.count;if(Jo.geometry=this.geometry,Jo.material=this.material,Jo.material!==void 0)for(var i=0;i<n;i++){this.getMatrixAt(i,Cd),Od.multiplyMatrices(r,Cd),Jo.matrixWorld=Od,Jo.raycast(t,hc);for(var a=0,o=hc.length;a<o;a++){var s=hc[a];s.instanceId=i,s.object=this,e.push(s)}hc.length=0}},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),wr.prototype=Object.create(Ne.prototype),wr.prototype.constructor=wr,wr.prototype.isLineBasicMaterial=!0,wr.prototype.copy=function(t){return Ne.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};var Dd=new q,Id=new q,Nd=new Xe,pc=new Fi,fc=new Un;function cn(t,e,r){r===1&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),ge.call(this),this.type="Line",this.geometry=t!==void 0?t:new _e,this.material=e!==void 0?e:new wr,this.updateMorphTargets()}cn.prototype=Object.assign(Object.create(ge.prototype),{constructor:cn,isLine:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(t.index===null){for(var e=t.attributes.position,r=[0],n=1,i=e.count;n<i;n++)Dd.fromBufferAttribute(e,n-1),Id.fromBufferAttribute(e,n),r[n]=r[n-1],r[n]+=Dd.distanceTo(Id);t.setAttribute("lineDistance",new pe(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var a=t.vertices;for((r=t.lineDistances)[0]=0,n=1,i=a.length;n<i;n++)r[n]=r[n-1],r[n]+=a[n-1].distanceTo(a[n])}return this},raycast:function(t,e){var r=this.geometry,n=this.matrixWorld,i=t.params.Line.threshold;if(r.boundingSphere===null&&r.computeBoundingSphere(),fc.copy(r.boundingSphere),fc.applyMatrix4(n),fc.radius+=i,t.ray.intersectsSphere(fc)!==!1){Nd.getInverse(n),pc.copy(t.ray).applyMatrix4(Nd);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,s=new q,c=new q,l=new q,h=new q,m=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var g=r.index,u=r.attributes.position.array;if(g!==null)for(var y=g.array,A=0,M=y.length-1;A<M;A+=m){var N=y[A],j=y[A+1];(s.fromArray(u,3*N),c.fromArray(u,3*j),!(pc.distanceSqToSegment(s,c,h,l)>o))&&(h.applyMatrix4(this.matrixWorld),(nt=t.ray.origin.distanceTo(h))<t.near||nt>t.far||e.push({distance:nt,point:l.clone().applyMatrix4(this.matrixWorld),index:A,face:null,faceIndex:null,object:this}))}else for(A=0,M=u.length/3-1;A<M;A+=m)(s.fromArray(u,3*A),c.fromArray(u,3*A+3),!(pc.distanceSqToSegment(s,c,h,l)>o))&&(h.applyMatrix4(this.matrixWorld),(nt=t.ray.origin.distanceTo(h))<t.near||nt>t.far||e.push({distance:nt,point:l.clone().applyMatrix4(this.matrixWorld),index:A,face:null,faceIndex:null,object:this}))}else if(r.isGeometry){var k=r.vertices,ot=k.length;for(A=0;A<ot-1;A+=m){var nt;pc.distanceSqToSegment(k[A],k[A+1],h,l)>o||(h.applyMatrix4(this.matrixWorld),(nt=t.ray.origin.distanceTo(h))<t.near||nt>t.far||e.push({distance:nt,point:l.clone().applyMatrix4(this.matrixWorld),index:A,face:null,faceIndex:null,object:this}))}}}},updateMorphTargets:function(){var t,e,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(o!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=o.length;t<e;t++)r=o[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var s=n.morphTargets;s!==void 0&&s.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var mc=new q,vc=new q;function Mr(t,e){cn.call(this,t,e),this.type="LineSegments"}function gc(t,e){cn.call(this,t,e),this.type="LineLoop"}function An(t){Ne.call(this),this.type="PointsMaterial",this.color=new we(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}Mr.prototype=Object.assign(Object.create(cn.prototype),{constructor:Mr,isLineSegments:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(t.index===null){for(var e=t.attributes.position,r=[],n=0,i=e.count;n<i;n+=2)mc.fromBufferAttribute(e,n),vc.fromBufferAttribute(e,n+1),r[n]=n===0?0:r[n-1],r[n+1]=r[n]+mc.distanceTo(vc);t.setAttribute("lineDistance",new pe(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var a=t.vertices;for(r=t.lineDistances,n=0,i=a.length;n<i;n+=2)mc.copy(a[n]),vc.copy(a[n+1]),r[n]=n===0?0:r[n-1],r[n+1]=r[n]+mc.distanceTo(vc)}return this}}),gc.prototype=Object.assign(Object.create(cn.prototype),{constructor:gc,isLineLoop:!0}),An.prototype=Object.create(Ne.prototype),An.prototype.constructor=An,An.prototype.isPointsMaterial=!0,An.prototype.copy=function(t){return Ne.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};var Bd=new Xe,eu=new Fi,yc=new Un,xc=new q;function Wa(t,e){ge.call(this),this.type="Points",this.geometry=t!==void 0?t:new _e,this.material=e!==void 0?e:new An,this.updateMorphTargets()}function ru(t,e,r,n,i,a,o){var s=eu.distanceSqToPoint(t);if(s<r){var c=new q;eu.closestPointToPoint(t,c),c.applyMatrix4(n);var l=i.ray.origin.distanceTo(c);if(l<i.near||l>i.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:c,index:e,face:null,object:o})}}function nu(t,e,r,n,i,a,o,s,c){ur.call(this,t,e,r,n,i,a,o,s,c),this.format=o!==void 0?o:Bn,this.minFilter=a!==void 0?a:Lt,this.magFilter=i!==void 0?i:Lt,this.generateMipmaps=!1}function qa(t,e,r,n,i,a,o,s,c,l,h,m){ur.call(this,null,a,o,s,c,l,n,i,h,m),this.image={width:e,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function Ko(t,e,r,n,i,a,o,s,c){ur.call(this,t,e,r,n,i,a,o,s,c),this.needsUpdate=!0}function Qo(t,e,r,n,i,a,o,s,c,l){if((l=l!==void 0?l:Ri)!==Ri&&l!==ya)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&l===Ri&&(r=Pr),r===void 0&&l===ya&&(r=Kn),ur.call(this,null,n,i,a,o,s,l,r,c),this.image={width:t,height:e},this.magFilter=o!==void 0?o:it,this.minFilter=s!==void 0?s:it,this.flipY=!1,this.generateMipmaps=!1}function Xa(t){_e.call(this),this.type="WireframeGeometry";var e,r,n,i,a,o,s,c,l,h,m=[],g=[0,0],u={},y=["a","b","c"];if(t&&t.isGeometry){var A=t.faces;for(e=0,n=A.length;e<n;e++){var M=A[e];for(r=0;r<3;r++)s=M[y[r]],c=M[y[(r+1)%3]],g[0]=Math.min(s,c),g[1]=Math.max(s,c),u[l=g[0]+","+g[1]]===void 0&&(u[l]={index1:g[0],index2:g[1]})}for(l in u)o=u[l],h=t.vertices[o.index1],m.push(h.x,h.y,h.z),h=t.vertices[o.index2],m.push(h.x,h.y,h.z)}else if(t&&t.isBufferGeometry){var N,j,k,ot,nt,gt,yt;if(h=new q,t.index!==null){for(N=t.attributes.position,j=t.index,(k=t.groups).length===0&&(k=[{start:0,count:j.count,materialIndex:0}]),i=0,a=k.length;i<a;++i)for(e=nt=(ot=k[i]).start,n=nt+ot.count;e<n;e+=3)for(r=0;r<3;r++)s=j.getX(e+r),c=j.getX(e+(r+1)%3),g[0]=Math.min(s,c),g[1]=Math.max(s,c),u[l=g[0]+","+g[1]]===void 0&&(u[l]={index1:g[0],index2:g[1]});for(l in u)o=u[l],h.fromBufferAttribute(N,o.index1),m.push(h.x,h.y,h.z),h.fromBufferAttribute(N,o.index2),m.push(h.x,h.y,h.z)}else for(e=0,n=(N=t.attributes.position).count/3;e<n;e++)for(r=0;r<3;r++)gt=3*e+r,h.fromBufferAttribute(N,gt),m.push(h.x,h.y,h.z),yt=3*e+(r+1)%3,h.fromBufferAttribute(N,yt),m.push(h.x,h.y,h.z)}this.setAttribute("position",new pe(m,3))}function $o(t,e,r){Be.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:r},this.fromBufferGeometry(new Ya(t,e,r)),this.mergeVertices()}function Ya(t,e,r){_e.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:r};var n,i,a=[],o=[],s=[],c=[],l=1e-5,h=new q,m=new q,g=new q,u=new q,y=new q;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var A=e+1;for(n=0;n<=r;n++){var M=n/r;for(i=0;i<=e;i++){var N=i/e;t(N,M,m),o.push(m.x,m.y,m.z),N-l>=0?(t(N-l,M,g),u.subVectors(m,g)):(t(N+l,M,g),u.subVectors(g,m)),M-l>=0?(t(N,M-l,g),y.subVectors(m,g)):(t(N,M+l,g),y.subVectors(g,m)),h.crossVectors(u,y).normalize(),s.push(h.x,h.y,h.z),c.push(N,M)}}for(n=0;n<r;n++)for(i=0;i<e;i++){var j=n*A+i,k=n*A+i+1,ot=(n+1)*A+i+1,nt=(n+1)*A+i;a.push(j,k,nt),a.push(k,ot,nt)}this.setIndex(a),this.setAttribute("position",new pe(o,3)),this.setAttribute("normal",new pe(s,3)),this.setAttribute("uv",new pe(c,2))}function ts(t,e,r,n){Be.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},this.fromBufferGeometry(new tn(t,e,r,n)),this.mergeVertices()}function tn(t,e,r,n){_e.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},r=r||1;var i=[],a=[];function o(g,u,y,A){var M,N,j=Math.pow(2,A),k=[];for(M=0;M<=j;M++){k[M]=[];var ot=g.clone().lerp(y,M/j),nt=u.clone().lerp(y,M/j),gt=j-M;for(N=0;N<=gt;N++)k[M][N]=N===0&&M===j?ot:ot.clone().lerp(nt,N/gt)}for(M=0;M<j;M++)for(N=0;N<2*(j-M)-1;N++){var yt=Math.floor(N/2);N%2==0?(s(k[M][yt+1]),s(k[M+1][yt]),s(k[M][yt])):(s(k[M][yt+1]),s(k[M+1][yt+1]),s(k[M+1][yt]))}}function s(g){i.push(g.x,g.y,g.z)}function c(g,u){var y=3*g;u.x=t[y+0],u.y=t[y+1],u.z=t[y+2]}function l(g,u,y,A){A<0&&g.x===1&&(a[u]=g.x-1),y.x===0&&y.z===0&&(a[u]=A/2/Math.PI+.5)}function h(g){return Math.atan2(g.z,-g.x)}function m(g){return Math.atan2(-g.y,Math.sqrt(g.x*g.x+g.z*g.z))}!function(g){for(var u=new q,y=new q,A=new q,M=0;M<e.length;M+=3)c(e[M+0],u),c(e[M+1],y),c(e[M+2],A),o(u,y,A,g)}(n=n||0),function(g){for(var u=new q,y=0;y<i.length;y+=3)u.x=i[y+0],u.y=i[y+1],u.z=i[y+2],u.normalize().multiplyScalar(g),i[y+0]=u.x,i[y+1]=u.y,i[y+2]=u.z}(r),function(){for(var g=new q,u=0;u<i.length;u+=3){g.x=i[u+0],g.y=i[u+1],g.z=i[u+2];var y=h(g)/2/Math.PI+.5,A=m(g)/Math.PI+.5;a.push(y,1-A)}(function(){for(var M=new q,N=new q,j=new q,k=new q,ot=new Wt,nt=new Wt,gt=new Wt,yt=0,Gt=0;yt<i.length;yt+=9,Gt+=6){M.set(i[yt+0],i[yt+1],i[yt+2]),N.set(i[yt+3],i[yt+4],i[yt+5]),j.set(i[yt+6],i[yt+7],i[yt+8]),ot.set(a[Gt+0],a[Gt+1]),nt.set(a[Gt+2],a[Gt+3]),gt.set(a[Gt+4],a[Gt+5]),k.copy(M).add(N).add(j).divideScalar(3);var st=h(k);l(ot,Gt+0,M,st),l(nt,Gt+2,N,st),l(gt,Gt+4,j,st)}})(),function(){for(var M=0;M<a.length;M+=6){var N=a[M+0],j=a[M+2],k=a[M+4],ot=Math.max(N,j,k),nt=Math.min(N,j,k);ot>.9&&nt<.1&&(N<.2&&(a[M+0]+=1),j<.2&&(a[M+2]+=1),k<.2&&(a[M+4]+=1))}}()}(),this.setAttribute("position",new pe(i,3)),this.setAttribute("normal",new pe(i.slice(),3)),this.setAttribute("uv",new pe(a,2)),n===0?this.computeVertexNormals():this.normalizeNormals()}function es(t,e){Be.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Za(t,e)),this.mergeVertices()}function Za(t,e){tn.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function rs(t,e){Be.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Wi(t,e)),this.mergeVertices()}function Wi(t,e){tn.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function ns(t,e){Be.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ja(t,e)),this.mergeVertices()}function Ja(t,e){var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];tn.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function is(t,e){Be.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ka(t,e)),this.mergeVertices()}function Ka(t,e){var r=(1+Math.sqrt(5))/2,n=1/r,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];tn.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function as(t,e,r,n,i,a){Be.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},a!==void 0&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new qi(t,e,r,n,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}function qi(t,e,r,n,i){_e.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},e=e||64,r=r||1,n=n||8,i=i||!1;var a=t.computeFrenetFrames(e,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var o,s,c=new q,l=new q,h=new Wt,m=new q,g=[],u=[],y=[],A=[];function M(N){m=t.getPointAt(N/e,m);var j=a.normals[N],k=a.binormals[N];for(s=0;s<=n;s++){var ot=s/n*Math.PI*2,nt=Math.sin(ot),gt=-Math.cos(ot);l.x=gt*j.x+nt*k.x,l.y=gt*j.y+nt*k.y,l.z=gt*j.z+nt*k.z,l.normalize(),u.push(l.x,l.y,l.z),c.x=m.x+r*l.x,c.y=m.y+r*l.y,c.z=m.z+r*l.z,g.push(c.x,c.y,c.z)}}!function(){for(o=0;o<e;o++)M(o);M(i===!1?e:0),function(){for(o=0;o<=e;o++)for(s=0;s<=n;s++)h.x=o/e,h.y=s/n,y.push(h.x,h.y)}(),function(){for(s=1;s<=e;s++)for(o=1;o<=n;o++){var N=(n+1)*(s-1)+(o-1),j=(n+1)*s+(o-1),k=(n+1)*s+o,ot=(n+1)*(s-1)+o;A.push(N,j,ot),A.push(j,k,ot)}}()}(),this.setIndex(A),this.setAttribute("position",new pe(g,3)),this.setAttribute("normal",new pe(u,3)),this.setAttribute("uv",new pe(y,2))}function os(t,e,r,n,i,a,o){Be.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:a},o!==void 0&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Qa(t,e,r,n,i,a)),this.mergeVertices()}function Qa(t,e,r,n,i,a){_e.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:a},t=t||1,e=e||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,a=a||3;var o,s,c=[],l=[],h=[],m=[],g=new q,u=new q,y=new q,A=new q,M=new q,N=new q,j=new q;for(o=0;o<=r;++o){var k=o/r*i*Math.PI*2;for(Bt(k,i,a,t,y),Bt(k+.01,i,a,t,A),N.subVectors(A,y),j.addVectors(A,y),M.crossVectors(N,j),j.crossVectors(M,N),M.normalize(),j.normalize(),s=0;s<=n;++s){var ot=s/n*Math.PI*2,nt=-e*Math.cos(ot),gt=e*Math.sin(ot);g.x=y.x+(nt*j.x+gt*M.x),g.y=y.y+(nt*j.y+gt*M.y),g.z=y.z+(nt*j.z+gt*M.z),l.push(g.x,g.y,g.z),u.subVectors(g,y).normalize(),h.push(u.x,u.y,u.z),m.push(o/r),m.push(s/n)}}for(s=1;s<=r;s++)for(o=1;o<=n;o++){var yt=(n+1)*(s-1)+(o-1),Gt=(n+1)*s+(o-1),st=(n+1)*s+o,Nt=(n+1)*(s-1)+o;c.push(yt,Gt,Nt),c.push(Gt,st,Nt)}function Bt(jt,xe,ae,Rt,Zt){var qt=Math.cos(jt),Ht=Math.sin(jt),Kt=ae/xe*jt,be=Math.cos(Kt);Zt.x=Rt*(2+be)*.5*qt,Zt.y=Rt*(2+be)*Ht*.5,Zt.z=Rt*Math.sin(Kt)*.5}this.setIndex(c),this.setAttribute("position",new pe(l,3)),this.setAttribute("normal",new pe(h,3)),this.setAttribute("uv",new pe(m,2))}function ss(t,e,r,n,i){Be.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new $a(t,e,r,n,i)),this.mergeVertices()}function $a(t,e,r,n,i){_e.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},t=t||1,e=e||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var a,o,s=[],c=[],l=[],h=[],m=new q,g=new q,u=new q;for(a=0;a<=r;a++)for(o=0;o<=n;o++){var y=o/n*i,A=a/r*Math.PI*2;g.x=(t+e*Math.cos(A))*Math.cos(y),g.y=(t+e*Math.cos(A))*Math.sin(y),g.z=e*Math.sin(A),c.push(g.x,g.y,g.z),m.x=t*Math.cos(y),m.y=t*Math.sin(y),u.subVectors(g,m).normalize(),l.push(u.x,u.y,u.z),h.push(o/n),h.push(a/r)}for(a=1;a<=r;a++)for(o=1;o<=n;o++){var M=(n+1)*a+o-1,N=(n+1)*(a-1)+o-1,j=(n+1)*(a-1)+o,k=(n+1)*a+o;s.push(M,N,k),s.push(N,j,k)}this.setIndex(s),this.setAttribute("position",new pe(c,3)),this.setAttribute("normal",new pe(l,3)),this.setAttribute("uv",new pe(h,2))}Wa.prototype=Object.assign(Object.create(ge.prototype),{constructor:Wa,isPoints:!0,raycast:function(t,e){var r=this.geometry,n=this.matrixWorld,i=t.params.Points.threshold;if(r.boundingSphere===null&&r.computeBoundingSphere(),yc.copy(r.boundingSphere),yc.applyMatrix4(n),yc.radius+=i,t.ray.intersectsSphere(yc)!==!1){Bd.getInverse(n),eu.copy(t.ray).applyMatrix4(Bd);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(r.isBufferGeometry){var s=r.index,c=r.attributes.position.array;if(s!==null)for(var l=s.array,h=0,m=l.length;h<m;h++){var g=l[h];xc.fromArray(c,3*g),ru(xc,g,o,n,t,e,this)}else{h=0;for(var u=c.length/3;h<u;h++)xc.fromArray(c,3*h),ru(xc,h,o,n,t,e,this)}}else{var y=r.vertices;for(h=0,u=y.length;h<u;h++)ru(y[h],h,o,n,t,e,this)}}},updateMorphTargets:function(){var t,e,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(o!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=o.length;t<e;t++)r=o[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var s=n.morphTargets;s!==void 0&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),nu.prototype=Object.assign(Object.create(ur.prototype),{constructor:nu,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),qa.prototype=Object.create(ur.prototype),qa.prototype.constructor=qa,qa.prototype.isCompressedTexture=!0,Ko.prototype=Object.create(ur.prototype),Ko.prototype.constructor=Ko,Ko.prototype.isCanvasTexture=!0,Qo.prototype=Object.create(ur.prototype),Qo.prototype.constructor=Qo,Qo.prototype.isDepthTexture=!0,Xa.prototype=Object.create(_e.prototype),Xa.prototype.constructor=Xa,$o.prototype=Object.create(Be.prototype),$o.prototype.constructor=$o,Ya.prototype=Object.create(_e.prototype),Ya.prototype.constructor=Ya,ts.prototype=Object.create(Be.prototype),ts.prototype.constructor=ts,tn.prototype=Object.create(_e.prototype),tn.prototype.constructor=tn,es.prototype=Object.create(Be.prototype),es.prototype.constructor=es,Za.prototype=Object.create(tn.prototype),Za.prototype.constructor=Za,rs.prototype=Object.create(Be.prototype),rs.prototype.constructor=rs,Wi.prototype=Object.create(tn.prototype),Wi.prototype.constructor=Wi,ns.prototype=Object.create(Be.prototype),ns.prototype.constructor=ns,Ja.prototype=Object.create(tn.prototype),Ja.prototype.constructor=Ja,is.prototype=Object.create(Be.prototype),is.prototype.constructor=is,Ka.prototype=Object.create(tn.prototype),Ka.prototype.constructor=Ka,as.prototype=Object.create(Be.prototype),as.prototype.constructor=as,qi.prototype=Object.create(_e.prototype),qi.prototype.constructor=qi,qi.prototype.toJSON=function(){var t=_e.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},os.prototype=Object.create(Be.prototype),os.prototype.constructor=os,Qa.prototype=Object.create(_e.prototype),Qa.prototype.constructor=Qa,ss.prototype=Object.create(Be.prototype),ss.prototype.constructor=ss,$a.prototype=Object.create(_e.prototype),$a.prototype.constructor=$a;var Dm=function(t,e,r){r=r||2;var n,i,a,o,s,c,l,h=e&&e.length,m=h?e[0]*r:t.length,g=Fd(t,0,m,r,!0),u=[];if(!g||g.next===g.prev)return u;if(h&&(g=function(A,M,N,j){var k,ot,nt,gt,yt,Gt=[];for(k=0,ot=M.length;k<ot;k++)nt=M[k]*j,gt=k<ot-1?M[k+1]*j:A.length,(yt=Fd(A,nt,gt,j,!1))===yt.next&&(yt.steiner=!0),Gt.push(Vm(yt));for(Gt.sort(Um),k=0;k<Gt.length;k++)zm(Gt[k],N),N=Si(N,N.next);return N}(t,e,g,r)),t.length>80*r){n=a=t[0],i=o=t[1];for(var y=r;y<m;y+=r)(s=t[y])<n&&(n=s),(c=t[y+1])<i&&(i=c),s>a&&(a=s),c>o&&(o=c);l=(l=Math.max(a-n,o-i))!==0?1/l:0}return cs(g,u,r,n,i,l),u};function Fd(t,e,r,n,i){var a,o;if(i===function(s,c,l,h){for(var m=0,g=c,u=l-h;g<l;g+=h)m+=(s[u]-s[g])*(s[g+1]+s[u+1]),u=g;return m}(t,e,r,n)>0)for(a=e;a<r;a+=n)o=Gd(a,t[a],t[a+1],o);else for(a=r-n;a>=e;a-=n)o=Gd(a,t[a],t[a+1],o);return o&&bc(o,o.next)&&(us(o),o=o.next),o}function Si(t,e){if(!t)return t;e||(e=t);var r,n=t;do if(r=!1,n.steiner||!bc(n,n.next)&&Sr(n.prev,n,n.next)!==0)n=n.next;else{if(us(n),(n=e=n.prev)===n.next)break;r=!0}while(r||n!==e);return e}function cs(t,e,r,n,i,a,o){if(t){!o&&a&&function(h,m,g,u){var y=h;do y.z===null&&(y.z=iu(y.x,y.y,m,g,u)),y.prevZ=y.prev,y.nextZ=y.next,y=y.next;while(y!==h);y.prevZ.nextZ=null,y.prevZ=null,function(A){var M,N,j,k,ot,nt,gt,yt,Gt=1;do{for(N=A,A=null,ot=null,nt=0;N;){for(nt++,j=N,gt=0,M=0;M<Gt&&(gt++,j=j.nextZ);M++);for(yt=Gt;gt>0||yt>0&&j;)gt!==0&&(yt===0||!j||N.z<=j.z)?(k=N,N=N.nextZ,gt--):(k=j,j=j.nextZ,yt--),ot?ot.nextZ=k:A=k,k.prevZ=ot,ot=k;N=j}ot.nextZ=null,Gt*=2}while(nt>1)}(y)}(t,n,i,a);for(var s,c,l=t;t.prev!==t.next;)if(s=t.prev,c=t.next,a?Nm(t,n,i,a):Im(t))e.push(s.i/r),e.push(t.i/r),e.push(c.i/r),us(t),t=c.next,l=c.next;else if((t=c)===l){o?o===1?cs(t=Bm(Si(t),e,r),e,r,n,i,a,2):o===2&&Fm(t,e,r,n,i,a):cs(Si(t),e,r,n,i,a,1);break}}}function Im(t){var e=t.prev,r=t,n=t.next;if(Sr(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(to(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&Sr(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Nm(t,e,r,n){var i=t.prev,a=t,o=t.next;if(Sr(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,c=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,l=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,h=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,m=iu(s,c,e,r,n),g=iu(l,h,e,r,n),u=t.prevZ,y=t.nextZ;u&&u.z>=m&&y&&y.z<=g;){if(u!==t.prev&&u!==t.next&&to(i.x,i.y,a.x,a.y,o.x,o.y,u.x,u.y)&&Sr(u.prev,u,u.next)>=0)return!1;if(u=u.prevZ,y!==t.prev&&y!==t.next&&to(i.x,i.y,a.x,a.y,o.x,o.y,y.x,y.y)&&Sr(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;u&&u.z>=m;){if(u!==t.prev&&u!==t.next&&to(i.x,i.y,a.x,a.y,o.x,o.y,u.x,u.y)&&Sr(u.prev,u,u.next)>=0)return!1;u=u.prevZ}for(;y&&y.z<=g;){if(y!==t.prev&&y!==t.next&&to(i.x,i.y,a.x,a.y,o.x,o.y,y.x,y.y)&&Sr(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function Bm(t,e,r){var n=t;do{var i=n.prev,a=n.next.next;!bc(i,a)&&Ud(i,n,n.next,a)&&ls(i,a)&&ls(a,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(a.i/r),us(n),us(n.next),n=t=a),n=n.next}while(n!==t);return Si(n)}function Fm(t,e,r,n,i,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&km(o,s)){var c=zd(o,s);return o=Si(o,o.next),c=Si(c,c.next),cs(o,e,r,n,i,a),void cs(c,e,r,n,i,a)}s=s.next}o=o.next}while(o!==t)}function Um(t,e){return t.x-e.x}function zm(t,e){if(e=function(n,i){var a,o=i,s=n.x,c=n.y,l=-1/0;do{if(c<=o.y&&c>=o.next.y&&o.next.y!==o.y){var h=o.x+(c-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(h<=s&&h>l){if(l=h,h===s){if(c===o.y)return o;if(c===o.next.y)return o.next}a=o.x<o.next.x?o:o.next}}o=o.next}while(o!==i);if(!a)return null;if(s===l)return a;var m,g=a,u=a.x,y=a.y,A=1/0;o=a;do s>=o.x&&o.x>=u&&s!==o.x&&to(c<y?s:l,c,u,y,c<y?l:s,c,o.x,o.y)&&(m=Math.abs(c-o.y)/(s-o.x),ls(o,n)&&(m<A||m===A&&(o.x>a.x||o.x===a.x&&Gm(a,o)))&&(a=o,A=m)),o=o.next;while(o!==g);return a}(t,e)){var r=zd(e,t);Si(e,e.next),Si(r,r.next)}}function Gm(t,e){return Sr(t.prev,t,e.prev)<0&&Sr(e.next,t,t.next)<0}function iu(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Vm(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function to(t,e,r,n,i,a,o,s){return(i-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(n-s)-(r-o)*(e-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function km(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(r,n){var i=r;do{if(i.i!==r.i&&i.next.i!==r.i&&i.i!==n.i&&i.next.i!==n.i&&Ud(i,i.next,r,n))return!0;i=i.next}while(i!==r);return!1}(t,e)&&(ls(t,e)&&ls(e,t)&&function(r,n){var i=r,a=!1,o=(r.x+n.x)/2,s=(r.y+n.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&o<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(a=!a),i=i.next;while(i!==r);return a}(t,e)&&(Sr(t.prev,t,e.prev)||Sr(t,e.prev,e))||bc(t,e)&&Sr(t.prev,t,t.next)>0&&Sr(e.prev,e,e.next)>0)}function Sr(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function bc(t,e){return t.x===e.x&&t.y===e.y}function Ud(t,e,r,n){var i=_c(Sr(t,e,r)),a=_c(Sr(t,e,n)),o=_c(Sr(r,n,t)),s=_c(Sr(r,n,e));return i!==a&&o!==s||(!(i!==0||!wc(t,r,e))||(!(a!==0||!wc(t,n,e))||!(o!==0||!wc(r,t,n))))||!(s!==0||!wc(r,e,n))}function wc(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function _c(t){return t>0?1:t<0?-1:0}function ls(t,e){return Sr(t.prev,t,t.next)<0?Sr(t,e,t.next)>=0&&Sr(t,t.prev,e)>=0:Sr(t,e,t.prev)<0||Sr(t,t.next,e)<0}function zd(t,e){var r=new au(t.i,t.x,t.y),n=new au(e.i,e.x,e.y),i=t.next,a=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function Gd(t,e,r,n){var i=new au(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function us(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function au(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var ai={area:function(t){for(var e=t.length,r=0,n=e-1,i=0;i<e;n=i++)r+=t[n].x*t[i].y-t[i].x*t[n].y;return .5*r},isClockWise:function(t){return ai.area(t)<0},triangulateShape:function(t,e){var r=[],n=[],i=[];Vd(t),kd(r,t);var a=t.length;e.forEach(Vd);for(var o=0;o<e.length;o++)n.push(a),a+=e[o].length,kd(r,e[o]);var s=Dm(r,n);for(o=0;o<s.length;o+=3)i.push(s.slice(o,o+3));return i}};function Vd(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function kd(t,e){for(var r=0;r<e.length;r++)t.push(e[r].x),t.push(e[r].y)}function Xi(t,e){Be.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new Hn(t,e)),this.mergeVertices()}function Hn(t,e){_e.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];for(var r=this,n=[],i=[],a=0,o=t.length;a<o;a++)s(t[a]);function s(c){var l=[],h=e.curveSegments!==void 0?e.curveSegments:12,m=e.steps!==void 0?e.steps:1,g=e.depth!==void 0?e.depth:100,u=e.bevelEnabled===void 0||e.bevelEnabled,y=e.bevelThickness!==void 0?e.bevelThickness:6,A=e.bevelSize!==void 0?e.bevelSize:y-2,M=e.bevelOffset!==void 0?e.bevelOffset:0,N=e.bevelSegments!==void 0?e.bevelSegments:3,j=e.extrudePath,k=e.UVGenerator!==void 0?e.UVGenerator:Hm;e.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),g=e.amount);var ot,nt,gt,yt,Gt,st,Nt,Bt,jt=!1;j&&(ot=j.getSpacedPoints(m),jt=!0,u=!1,nt=j.computeFrenetFrames(m,!1),gt=new q,yt=new q,Gt=new q),u||(N=0,y=0,A=0,M=0);var xe=c.extractPoints(h),ae=xe.shape,Rt=xe.holes;if(!ai.isClockWise(ae))for(ae=ae.reverse(),Nt=0,Bt=Rt.length;Nt<Bt;Nt++)st=Rt[Nt],ai.isClockWise(st)&&(Rt[Nt]=st.reverse());var Zt=ai.triangulateShape(ae,Rt),qt=ae;for(Nt=0,Bt=Rt.length;Nt<Bt;Nt++)st=Rt[Nt],ae=ae.concat(st);function Ht(ze,ir,pr){return ir||console.error("THREE.ExtrudeGeometry: vec does not exist"),ir.clone().multiplyScalar(pr).add(ze)}var Kt,be,Oe,Ge,K,lt,$t=ae.length,te=Zt.length;function De(ze,ir,pr){var Lr,ar,Gr,qr=ze.x-ir.x,Kr=ze.y-ir.y,In=pr.x-ze.x,Jn=pr.y-ze.y,Rs=qr*qr+Kr*Kr,Ps=qr*Jn-Kr*In;if(Math.abs(Ps)>Number.EPSILON){var da=Math.sqrt(Rs),Cs=Math.sqrt(In*In+Jn*Jn),pa=ir.x-Kr/da,Os=ir.y+qr/da,hi=((pr.x-Jn/Cs-pa)*Jn-(pr.y+In/Cs-Os)*In)/(qr*Jn-Kr*In),Ds=(Lr=pa+qr*hi-ze.x)*Lr+(ar=Os+Kr*hi-ze.y)*ar;if(Ds<=2)return new Wt(Lr,ar);Gr=Math.sqrt(Ds/2)}else{var et=!1;qr>Number.EPSILON?In>Number.EPSILON&&(et=!0):qr<-Number.EPSILON?In<-Number.EPSILON&&(et=!0):Math.sign(Kr)===Math.sign(Jn)&&(et=!0),et?(Lr=-Kr,ar=qr,Gr=Math.sqrt(Rs)):(Lr=qr,ar=Kr,Gr=Math.sqrt(Rs/2))}return new Wt(Lr/Gr,ar/Gr)}for(var oe=[],Ft=0,Me=qt.length,Fe=Me-1,dt=Ft+1;Ft<Me;Ft++,Fe++,dt++)Fe===Me&&(Fe=0),dt===Me&&(dt=0),oe[Ft]=De(qt[Ft],qt[Fe],qt[dt]);var ue,ye,Ee=[],ce=oe.concat();for(Nt=0,Bt=Rt.length;Nt<Bt;Nt++){for(st=Rt[Nt],ue=[],Ft=0,Fe=(Me=st.length)-1,dt=Ft+1;Ft<Me;Ft++,Fe++,dt++)Fe===Me&&(Fe=0),dt===Me&&(dt=0),ue[Ft]=De(st[Ft],st[Fe],st[dt]);Ee.push(ue),ce=ce.concat(ue)}for(Kt=0;Kt<N;Kt++){for(Oe=Kt/N,Ge=y*Math.cos(Oe*Math.PI/2),be=A*Math.sin(Oe*Math.PI/2)+M,Ft=0,Me=qt.length;Ft<Me;Ft++)tr((K=Ht(qt[Ft],oe[Ft],be)).x,K.y,-Ge);for(Nt=0,Bt=Rt.length;Nt<Bt;Nt++)for(st=Rt[Nt],ue=Ee[Nt],Ft=0,Me=st.length;Ft<Me;Ft++)tr((K=Ht(st[Ft],ue[Ft],be)).x,K.y,-Ge)}for(be=A+M,Ft=0;Ft<$t;Ft++)K=u?Ht(ae[Ft],ce[Ft],be):ae[Ft],jt?(yt.copy(nt.normals[0]).multiplyScalar(K.x),gt.copy(nt.binormals[0]).multiplyScalar(K.y),Gt.copy(ot[0]).add(yt).add(gt),tr(Gt.x,Gt.y,Gt.z)):tr(K.x,K.y,0);for(ye=1;ye<=m;ye++)for(Ft=0;Ft<$t;Ft++)K=u?Ht(ae[Ft],ce[Ft],be):ae[Ft],jt?(yt.copy(nt.normals[ye]).multiplyScalar(K.x),gt.copy(nt.binormals[ye]).multiplyScalar(K.y),Gt.copy(ot[ye]).add(yt).add(gt),tr(Gt.x,Gt.y,Gt.z)):tr(K.x,K.y,g/m*ye);for(Kt=N-1;Kt>=0;Kt--){for(Oe=Kt/N,Ge=y*Math.cos(Oe*Math.PI/2),be=A*Math.sin(Oe*Math.PI/2)+M,Ft=0,Me=qt.length;Ft<Me;Ft++)tr((K=Ht(qt[Ft],oe[Ft],be)).x,K.y,g+Ge);for(Nt=0,Bt=Rt.length;Nt<Bt;Nt++)for(st=Rt[Nt],ue=Ee[Nt],Ft=0,Me=st.length;Ft<Me;Ft++)K=Ht(st[Ft],ue[Ft],be),jt?tr(K.x,K.y+ot[m-1].y,ot[m-1].x+Ge):tr(K.x,K.y,g+Ge)}function qe(ze,ir){var pr,Lr;for(Ft=ze.length;--Ft>=0;){pr=Ft,(Lr=Ft-1)<0&&(Lr=ze.length-1);var ar=0,Gr=m+2*N;for(ar=0;ar<Gr;ar++){var qr=$t*ar,Kr=$t*(ar+1);vn(ir+pr+qr,ir+Lr+qr,ir+Lr+Kr,ir+pr+Kr)}}}function tr(ze,ir,pr){l.push(ze),l.push(ir),l.push(pr)}function nr(ze,ir,pr){$e(ze),$e(ir),$e(pr);var Lr=n.length/3,ar=k.generateTopUV(r,n,Lr-3,Lr-2,Lr-1);Tr(ar[0]),Tr(ar[1]),Tr(ar[2])}function vn(ze,ir,pr,Lr){$e(ze),$e(ir),$e(Lr),$e(ir),$e(pr),$e(Lr);var ar=n.length/3,Gr=k.generateSideWallUV(r,n,ar-6,ar-3,ar-2,ar-1);Tr(Gr[0]),Tr(Gr[1]),Tr(Gr[3]),Tr(Gr[1]),Tr(Gr[2]),Tr(Gr[3])}function $e(ze){n.push(l[3*ze+0]),n.push(l[3*ze+1]),n.push(l[3*ze+2])}function Tr(ze){i.push(ze.x),i.push(ze.y)}!function(){var ze=n.length/3;if(u){var ir=0,pr=$t*ir;for(Ft=0;Ft<te;Ft++)nr((lt=Zt[Ft])[2]+pr,lt[1]+pr,lt[0]+pr);for(pr=$t*(ir=m+2*N),Ft=0;Ft<te;Ft++)nr((lt=Zt[Ft])[0]+pr,lt[1]+pr,lt[2]+pr)}else{for(Ft=0;Ft<te;Ft++)nr((lt=Zt[Ft])[2],lt[1],lt[0]);for(Ft=0;Ft<te;Ft++)nr((lt=Zt[Ft])[0]+$t*m,lt[1]+$t*m,lt[2]+$t*m)}r.addGroup(ze,n.length/3-ze,0)}(),function(){var ze=n.length/3,ir=0;for(qe(qt,ir),ir+=qt.length,Nt=0,Bt=Rt.length;Nt<Bt;Nt++)qe(st=Rt[Nt],ir),ir+=st.length;r.addGroup(ze,n.length/3-ze,1)}()}this.setAttribute("position",new pe(n,3)),this.setAttribute("uv",new pe(i,2)),this.computeVertexNormals()}Xi.prototype=Object.create(Be.prototype),Xi.prototype.constructor=Xi,Xi.prototype.toJSON=function(){var t=Be.prototype.toJSON.call(this);return Hd(this.parameters.shapes,this.parameters.options,t)},Hn.prototype=Object.create(_e.prototype),Hn.prototype.constructor=Hn,Hn.prototype.toJSON=function(){var t=_e.prototype.toJSON.call(this);return Hd(this.parameters.shapes,this.parameters.options,t)};var Hm={generateTopUV:function(t,e,r,n,i){var a=e[3*r],o=e[3*r+1],s=e[3*n],c=e[3*n+1],l=e[3*i],h=e[3*i+1];return[new Wt(a,o),new Wt(s,c),new Wt(l,h)]},generateSideWallUV:function(t,e,r,n,i,a){var o=e[3*r],s=e[3*r+1],c=e[3*r+2],l=e[3*n],h=e[3*n+1],m=e[3*n+2],g=e[3*i],u=e[3*i+1],y=e[3*i+2],A=e[3*a],M=e[3*a+1],N=e[3*a+2];return Math.abs(s-h)<.01?[new Wt(o,1-c),new Wt(l,1-m),new Wt(g,1-y),new Wt(A,1-N)]:[new Wt(s,1-c),new Wt(h,1-m),new Wt(u,1-y),new Wt(M,1-N)]}};function Hd(t,e,r){if(r.shapes=[],Array.isArray(t))for(var n=0,i=t.length;n<i;n++){var a=t[n];r.shapes.push(a.uuid)}else r.shapes.push(t.uuid);return e.extrudePath!==void 0&&(r.options.extrudePath=e.extrudePath.toJSON()),r}function hs(t,e){Be.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new eo(t,e)),this.mergeVertices()}function eo(t,e){var r=(e=e||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Be;var n=r.generateShapes(t,e.size);e.depth=e.height!==void 0?e.height:50,e.bevelThickness===void 0&&(e.bevelThickness=10),e.bevelSize===void 0&&(e.bevelSize=8),e.bevelEnabled===void 0&&(e.bevelEnabled=!1),Hn.call(this,n,e),this.type="TextBufferGeometry"}function ds(t,e,r,n,i,a,o){Be.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new Yi(t,e,r,n,i,a,o)),this.mergeVertices()}function Yi(t,e,r,n,i,a,o){_e.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:a,thetaLength:o},t=t||1,e=Math.max(3,Math.floor(e)||8),r=Math.max(2,Math.floor(r)||6),n=n!==void 0?n:0,i=i!==void 0?i:2*Math.PI,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI;var s,c,l=Math.min(a+o,Math.PI),h=0,m=[],g=new q,u=new q,y=[],A=[],M=[],N=[];for(c=0;c<=r;c++){var j=[],k=c/r,ot=0;for(c==0&&a==0?ot=.5/e:c==r&&l==Math.PI&&(ot=-.5/e),s=0;s<=e;s++){var nt=s/e;g.x=-t*Math.cos(n+nt*i)*Math.sin(a+k*o),g.y=t*Math.cos(a+k*o),g.z=t*Math.sin(n+nt*i)*Math.sin(a+k*o),A.push(g.x,g.y,g.z),u.copy(g).normalize(),M.push(u.x,u.y,u.z),N.push(nt+ot,1-k),j.push(h++)}m.push(j)}for(c=0;c<r;c++)for(s=0;s<e;s++){var gt=m[c][s+1],yt=m[c][s],Gt=m[c+1][s],st=m[c+1][s+1];(c!==0||a>0)&&y.push(gt,yt,st),(c!==r-1||l<Math.PI)&&y.push(yt,Gt,st)}this.setIndex(y),this.setAttribute("position",new pe(A,3)),this.setAttribute("normal",new pe(M,3)),this.setAttribute("uv",new pe(N,2))}function ps(t,e,r,n,i,a){Be.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},this.fromBufferGeometry(new ro(t,e,r,n,i,a)),this.mergeVertices()}function ro(t,e,r,n,i,a){_e.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},t=t||.5,e=e||1,i=i!==void 0?i:0,a=a!==void 0?a:2*Math.PI,r=r!==void 0?Math.max(3,r):8;var o,s,c,l=[],h=[],m=[],g=[],u=t,y=(e-t)/(n=n!==void 0?Math.max(1,n):1),A=new q,M=new Wt;for(s=0;s<=n;s++){for(c=0;c<=r;c++)o=i+c/r*a,A.x=u*Math.cos(o),A.y=u*Math.sin(o),h.push(A.x,A.y,A.z),m.push(0,0,1),M.x=(A.x/e+1)/2,M.y=(A.y/e+1)/2,g.push(M.x,M.y);u+=y}for(s=0;s<n;s++){var N=s*(r+1);for(c=0;c<r;c++){var j=o=c+N,k=o+r+1,ot=o+r+2,nt=o+1;l.push(j,k,nt),l.push(k,ot,nt)}}this.setIndex(l),this.setAttribute("position",new pe(h,3)),this.setAttribute("normal",new pe(m,3)),this.setAttribute("uv",new pe(g,2))}function fs(t,e,r,n){Be.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},this.fromBufferGeometry(new no(t,e,r,n)),this.mergeVertices()}function no(t,e,r,n){_e.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},e=Math.floor(e)||12,r=r||0,n=n||2*Math.PI,n=We.clamp(n,0,2*Math.PI);var i,a,o,s=[],c=[],l=[],h=1/e,m=new q,g=new Wt;for(a=0;a<=e;a++){var u=r+a*h*n,y=Math.sin(u),A=Math.cos(u);for(o=0;o<=t.length-1;o++)m.x=t[o].x*y,m.y=t[o].y,m.z=t[o].x*A,c.push(m.x,m.y,m.z),g.x=a/e,g.y=o/(t.length-1),l.push(g.x,g.y)}for(a=0;a<e;a++)for(o=0;o<t.length-1;o++){var M=i=o+a*t.length,N=i+t.length,j=i+t.length+1,k=i+1;s.push(M,N,k),s.push(N,j,k)}if(this.setIndex(s),this.setAttribute("position",new pe(c,3)),this.setAttribute("uv",new pe(l,2)),this.computeVertexNormals(),n===2*Math.PI){var ot=this.attributes.normal.array,nt=new q,gt=new q,yt=new q;for(i=e*t.length*3,a=0,o=0;a<t.length;a++,o+=3)nt.x=ot[o+0],nt.y=ot[o+1],nt.z=ot[o+2],gt.x=ot[i+o+0],gt.y=ot[i+o+1],gt.z=ot[i+o+2],yt.addVectors(nt,gt).normalize(),ot[o+0]=ot[i+o+0]=yt.x,ot[o+1]=ot[i+o+1]=yt.y,ot[o+2]=ot[i+o+2]=yt.z}}function Zi(t,e){Be.call(this),this.type="ShapeGeometry",typeof e=="object"&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Ji(t,e)),this.mergeVertices()}function Ji(t,e){_e.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var r=[],n=[],i=[],a=[],o=0,s=0;if(Array.isArray(t)===!1)l(t);else for(var c=0;c<t.length;c++)l(t[c]),this.addGroup(o,s,c),o+=s,s=0;function l(h){var m,g,u,y=n.length/3,A=h.extractPoints(e),M=A.shape,N=A.holes;for(ai.isClockWise(M)===!1&&(M=M.reverse()),m=0,g=N.length;m<g;m++)u=N[m],ai.isClockWise(u)===!0&&(N[m]=u.reverse());var j=ai.triangulateShape(M,N);for(m=0,g=N.length;m<g;m++)u=N[m],M=M.concat(u);for(m=0,g=M.length;m<g;m++){var k=M[m];n.push(k.x,k.y,0),i.push(0,0,1),a.push(k.x,k.y)}for(m=0,g=j.length;m<g;m++){var ot=j[m],nt=ot[0]+y,gt=ot[1]+y,yt=ot[2]+y;r.push(nt,gt,yt),s+=3}}this.setIndex(r),this.setAttribute("position",new pe(n,3)),this.setAttribute("normal",new pe(i,3)),this.setAttribute("uv",new pe(a,2))}function jd(t,e){if(e.shapes=[],Array.isArray(t))for(var r=0,n=t.length;r<n;r++){var i=t[r];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}function io(t,e){_e.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=e!==void 0?e:1;var r,n,i,a,o=[],s=Math.cos(We.DEG2RAD*e),c=[0,0],l={},h=["a","b","c"];t.isBufferGeometry?(a=new Be).fromBufferGeometry(t):a=t.clone(),a.mergeVertices(),a.computeFaceNormals();for(var m=a.vertices,g=a.faces,u=0,y=g.length;u<y;u++)for(var A=g[u],M=0;M<3;M++)r=A[h[M]],n=A[h[(M+1)%3]],c[0]=Math.min(r,n),c[1]=Math.max(r,n),l[i=c[0]+","+c[1]]===void 0?l[i]={index1:c[0],index2:c[1],face1:u,face2:void 0}:l[i].face2=u;for(i in l){var N=l[i];if(N.face2===void 0||g[N.face1].normal.dot(g[N.face2].normal)<=s){var j=m[N.index1];o.push(j.x,j.y,j.z),j=m[N.index2],o.push(j.x,j.y,j.z)}}this.setAttribute("position",new pe(o,3))}function Ki(t,e,r,n,i,a,o,s){Be.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new oi(t,e,r,n,i,a,o,s)),this.mergeVertices()}function oi(t,e,r,n,i,a,o,s){_e.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s};var c=this;t=t!==void 0?t:1,e=e!==void 0?e:1,r=r||1,n=Math.floor(n)||8,i=Math.floor(i)||1,a=a!==void 0&&a,o=o!==void 0?o:0,s=s!==void 0?s:2*Math.PI;var l=[],h=[],m=[],g=[],u=0,y=[],A=r/2,M=0;function N(j){var k,ot,nt,gt=new Wt,yt=new q,Gt=0,st=j===!0?t:e,Nt=j===!0?1:-1;for(ot=u,k=1;k<=n;k++)h.push(0,A*Nt,0),m.push(0,Nt,0),g.push(.5,.5),u++;for(nt=u,k=0;k<=n;k++){var Bt=k/n*s+o,jt=Math.cos(Bt),xe=Math.sin(Bt);yt.x=st*xe,yt.y=A*Nt,yt.z=st*jt,h.push(yt.x,yt.y,yt.z),m.push(0,Nt,0),gt.x=.5*jt+.5,gt.y=.5*xe*Nt+.5,g.push(gt.x,gt.y),u++}for(k=0;k<n;k++){var ae=ot+k,Rt=nt+k;j===!0?l.push(Rt,Rt+1,ae):l.push(Rt+1,Rt,ae),Gt+=3}c.addGroup(M,Gt,j===!0?1:2),M+=Gt}!function(){var j,k,ot=new q,nt=new q,gt=0,yt=(e-t)/r;for(k=0;k<=i;k++){var Gt=[],st=k/i,Nt=st*(e-t)+t;for(j=0;j<=n;j++){var Bt=j/n,jt=Bt*s+o,xe=Math.sin(jt),ae=Math.cos(jt);nt.x=Nt*xe,nt.y=-st*r+A,nt.z=Nt*ae,h.push(nt.x,nt.y,nt.z),ot.set(xe,yt,ae).normalize(),m.push(ot.x,ot.y,ot.z),g.push(Bt,1-st),Gt.push(u++)}y.push(Gt)}for(j=0;j<n;j++)for(k=0;k<i;k++){var Rt=y[k][j],Zt=y[k+1][j],qt=y[k+1][j+1],Ht=y[k][j+1];l.push(Rt,Zt,Ht),l.push(Zt,qt,Ht),gt+=6}c.addGroup(M,gt,0),M+=gt}(),a===!1&&(t>0&&N(!0),e>0&&N(!1)),this.setIndex(l),this.setAttribute("position",new pe(h,3)),this.setAttribute("normal",new pe(m,3)),this.setAttribute("uv",new pe(g,2))}function ms(t,e,r,n,i,a,o){Ki.call(this,0,t,e,r,n,i,a,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:a,thetaLength:o}}function vs(t,e,r,n,i,a,o){oi.call(this,0,t,e,r,n,i,a,o),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:a,thetaLength:o}}function gs(t,e,r,n){Be.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new ao(t,e,r,n)),this.mergeVertices()}function ao(t,e,r,n){_e.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},t=t||1,e=e!==void 0?Math.max(3,e):8,r=r!==void 0?r:0,n=n!==void 0?n:2*Math.PI;var i,a,o=[],s=[],c=[],l=[],h=new q,m=new Wt;for(s.push(0,0,0),c.push(0,0,1),l.push(.5,.5),a=0,i=3;a<=e;a++,i+=3){var g=r+a/e*n;h.x=t*Math.cos(g),h.y=t*Math.sin(g),s.push(h.x,h.y,h.z),c.push(0,0,1),m.x=(s[i]/t+1)/2,m.y=(s[i+1]/t+1)/2,l.push(m.x,m.y)}for(i=1;i<=e;i++)o.push(i,i+1,0);this.setIndex(o),this.setAttribute("position",new pe(s,3)),this.setAttribute("normal",new pe(c,3)),this.setAttribute("uv",new pe(l,2))}hs.prototype=Object.create(Be.prototype),hs.prototype.constructor=hs,eo.prototype=Object.create(Hn.prototype),eo.prototype.constructor=eo,ds.prototype=Object.create(Be.prototype),ds.prototype.constructor=ds,Yi.prototype=Object.create(_e.prototype),Yi.prototype.constructor=Yi,ps.prototype=Object.create(Be.prototype),ps.prototype.constructor=ps,ro.prototype=Object.create(_e.prototype),ro.prototype.constructor=ro,fs.prototype=Object.create(Be.prototype),fs.prototype.constructor=fs,no.prototype=Object.create(_e.prototype),no.prototype.constructor=no,Zi.prototype=Object.create(Be.prototype),Zi.prototype.constructor=Zi,Zi.prototype.toJSON=function(){var t=Be.prototype.toJSON.call(this);return jd(this.parameters.shapes,t)},Ji.prototype=Object.create(_e.prototype),Ji.prototype.constructor=Ji,Ji.prototype.toJSON=function(){var t=_e.prototype.toJSON.call(this);return jd(this.parameters.shapes,t)},io.prototype=Object.create(_e.prototype),io.prototype.constructor=io,Ki.prototype=Object.create(Be.prototype),Ki.prototype.constructor=Ki,oi.prototype=Object.create(_e.prototype),oi.prototype.constructor=oi,ms.prototype=Object.create(Ki.prototype),ms.prototype.constructor=ms,vs.prototype=Object.create(oi.prototype),vs.prototype.constructor=vs,gs.prototype=Object.create(Be.prototype),gs.prototype.constructor=gs,ao.prototype=Object.create(_e.prototype),ao.prototype.constructor=ao;var Jr=Object.freeze({__proto__:null,WireframeGeometry:Xa,ParametricGeometry:$o,ParametricBufferGeometry:Ya,TetrahedronGeometry:es,TetrahedronBufferGeometry:Za,OctahedronGeometry:rs,OctahedronBufferGeometry:Wi,IcosahedronGeometry:ns,IcosahedronBufferGeometry:Ja,DodecahedronGeometry:is,DodecahedronBufferGeometry:Ka,PolyhedronGeometry:ts,PolyhedronBufferGeometry:tn,TubeGeometry:as,TubeBufferGeometry:qi,TorusKnotGeometry:os,TorusKnotBufferGeometry:Qa,TorusGeometry:ss,TorusBufferGeometry:$a,TextGeometry:hs,TextBufferGeometry:eo,SphereGeometry:ds,SphereBufferGeometry:Yi,RingGeometry:ps,RingBufferGeometry:ro,PlaneGeometry:Vo,PlaneBufferGeometry:Hi,LatheGeometry:fs,LatheBufferGeometry:no,ShapeGeometry:Zi,ShapeBufferGeometry:Ji,ExtrudeGeometry:Xi,ExtrudeBufferGeometry:Hn,EdgesGeometry:io,ConeGeometry:ms,ConeBufferGeometry:vs,CylinderGeometry:Ki,CylinderBufferGeometry:oi,CircleGeometry:gs,CircleBufferGeometry:ao,BoxGeometry:Wl,BoxBufferGeometry:Go});function Qi(t){Ne.call(this),this.type="ShadowMaterial",this.color=new we(0),this.transparent=!0,this.setValues(t)}function si(t){Zr.call(this,t),this.type="RawShaderMaterial"}function jn(t){Ne.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new we(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new we(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Oi,this.normalScale=new Wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function $i(t){jn.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Wt(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transparency=0,this.setValues(t)}function Ti(t){Ne.call(this),this.type="MeshPhongMaterial",this.color=new we(16777215),this.specular=new we(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new we(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Oi,this.normalScale=new Wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function ta(t){Ne.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new we(16777215),this.specular=new we(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new we(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Oi,this.normalScale=new Wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function ea(t){Ne.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Oi,this.normalScale=new Wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function ra(t){Ne.call(this),this.type="MeshLambertMaterial",this.color=new we(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new we(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function na(t){Ne.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new we(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Oi,this.normalScale=new Wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function ia(t){wr.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}Qi.prototype=Object.create(Ne.prototype),Qi.prototype.constructor=Qi,Qi.prototype.isShadowMaterial=!0,Qi.prototype.copy=function(t){return Ne.prototype.copy.call(this,t),this.color.copy(t.color),this},si.prototype=Object.create(Zr.prototype),si.prototype.constructor=si,si.prototype.isRawShaderMaterial=!0,jn.prototype=Object.create(Ne.prototype),jn.prototype.constructor=jn,jn.prototype.isMeshStandardMaterial=!0,jn.prototype.copy=function(t){return Ne.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},$i.prototype=Object.create(jn.prototype),$i.prototype.constructor=$i,$i.prototype.isMeshPhysicalMaterial=!0,$i.prototype.copy=function(t){return jn.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new we).copy(t.sheen):this.sheen=null,this.transparency=t.transparency,this},Ti.prototype=Object.create(Ne.prototype),Ti.prototype.constructor=Ti,Ti.prototype.isMeshPhongMaterial=!0,Ti.prototype.copy=function(t){return Ne.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},ta.prototype=Object.create(Ne.prototype),ta.prototype.constructor=ta,ta.prototype.isMeshToonMaterial=!0,ta.prototype.copy=function(t){return Ne.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},ea.prototype=Object.create(Ne.prototype),ea.prototype.constructor=ea,ea.prototype.isMeshNormalMaterial=!0,ea.prototype.copy=function(t){return Ne.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},ra.prototype=Object.create(Ne.prototype),ra.prototype.constructor=ra,ra.prototype.isMeshLambertMaterial=!0,ra.prototype.copy=function(t){return Ne.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},na.prototype=Object.create(Ne.prototype),na.prototype.constructor=na,na.prototype.isMeshMatcapMaterial=!0,na.prototype.copy=function(t){return Ne.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},ia.prototype=Object.create(wr.prototype),ia.prototype.constructor=ia,ia.prototype.isLineDashedMaterial=!0,ia.prototype.copy=function(t){return wr.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var jm=Object.freeze({__proto__:null,ShadowMaterial:Qi,SpriteMaterial:Mi,RawShaderMaterial:si,ShaderMaterial:Zr,PointsMaterial:An,MeshPhysicalMaterial:$i,MeshStandardMaterial:jn,MeshPhongMaterial:Ti,MeshToonMaterial:ta,MeshNormalMaterial:ea,MeshLambertMaterial:ra,MeshDepthMaterial:wi,MeshDistanceMaterial:_i,MeshBasicMaterial:hn,MeshMatcapMaterial:na,LineDashedMaterial:ia,LineBasicMaterial:wr,Material:Ne}),_r={arraySlice:function(t,e,r){return _r.isTypedArray(t)?new t.constructor(t.subarray(e,r!==void 0?r:t.length)):t.slice(e,r)},convertArray:function(t,e,r){return!t||!r&&t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,r=new Array(e),n=0;n!==e;++n)r[n]=n;return r.sort(function(i,a){return t[i]-t[a]}),r},sortedArray:function(t,e,r){for(var n=t.length,i=new t.constructor(n),a=0,o=0;o!==n;++a)for(var s=r[a]*e,c=0;c!==e;++c)i[o++]=t[s+c];return i},flattenJSON:function(t,e,r,n){for(var i=1,a=t[0];a!==void 0&&a[n]===void 0;)a=t[i++];if(a!==void 0){var o=a[n];if(o!==void 0)if(Array.isArray(o))do(o=a[n])!==void 0&&(e.push(a.time),r.push.apply(r,o)),a=t[i++];while(a!==void 0);else if(o.toArray!==void 0)do(o=a[n])!==void 0&&(e.push(a.time),o.toArray(r,r.length)),a=t[i++];while(a!==void 0);else do(o=a[n])!==void 0&&(e.push(a.time),r.push(o)),a=t[i++];while(a!==void 0)}},subclip:function(t,e,r,n,i){i=i||30;var a=t.clone();a.name=e;for(var o=[],s=0;s<a.tracks.length;++s){for(var c=a.tracks[s],l=c.getValueSize(),h=[],m=[],g=0;g<c.times.length;++g){var u=c.times[g]*i;if(!(u<r||u>=n)){h.push(c.times[g]);for(var y=0;y<l;++y)m.push(c.values[g*l+y])}}h.length!==0&&(c.times=_r.convertArray(h,c.times.constructor),c.values=_r.convertArray(m,c.values.constructor),o.push(c))}a.tracks=o;var A=1/0;for(s=0;s<a.tracks.length;++s)A>a.tracks[s].times[0]&&(A=a.tracks[s].times[0]);for(s=0;s<a.tracks.length;++s)a.tracks[s].shift(-1*A);return a.resetDuration(),a},makeClipAdditive:function(t,e,r,n){e===void 0&&(e=0),r===void 0&&(r=t),(n===void 0||n<=0)&&(n=30);for(var i=t.tracks.length,a=e/n,o=0;o<i;++o){var s=r.tracks[o],c=s.ValueTypeName;if(c!=="bool"&&c!=="string"){var l=t.tracks.find(function(k){return k.name===s.name&&k.ValueTypeName===c});if(l!==void 0){var h,m=s.getValueSize(),g=s.times.length-1;if(a<=s.times[0])h=_r.arraySlice(s.values,0,s.valueSize);else if(a>=s.times[g]){var u=g*m;h=_r.arraySlice(s.values,u)}else{var y=s.createInterpolant();y.evaluate(a),h=y.resultBuffer}c==="quaternion"&&new Ir(h[0],h[1],h[2],h[3]).normalize().conjugate().toArray(h);for(var A=l.times.length,M=0;M<A;++M){var N=M*m;if(c==="quaternion")Ir.multiplyQuaternionsFlat(l.values,N,h,0,l.values,N);else for(var j=0;j<m;++j)l.values[N+j]-=h[j]}}}}return t.blendMode=bl,t}};function ln(t,e,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new e.constructor(r),this.sampleValues=e,this.valueSize=r}function Mc(t,e,r,n){ln.call(this,t,e,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function ys(t,e,r,n){ln.call(this,t,e,r,n)}function Sc(t,e,r,n){ln.call(this,t,e,r,n)}function zr(t,e,r,n){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=_r.convertArray(e,this.TimeBufferType),this.values=_r.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function Tc(t,e,r){zr.call(this,t,e,r)}function Ec(t,e,r,n){zr.call(this,t,e,r,n)}function oo(t,e,r,n){zr.call(this,t,e,r,n)}function Ac(t,e,r,n){ln.call(this,t,e,r,n)}function xs(t,e,r,n){zr.call(this,t,e,r,n)}function Lc(t,e,r,n){zr.call(this,t,e,r,n)}function so(t,e,r,n){zr.call(this,t,e,r,n)}function pn(t,e,r,n){this.name=t,this.tracks=r,this.duration=e!==void 0?e:-1,this.blendMode=n!==void 0?n:Bs,this.uuid=We.generateUUID(),this.duration<0&&this.resetDuration()}function Wm(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=function(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return oo;case"vector":case"vector2":case"vector3":case"vector4":return so;case"color":return Ec;case"quaternion":return xs;case"bool":case"boolean":return Tc;case"string":return Lc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}(t.type);if(t.times===void 0){var r=[],n=[];_r.flattenJSON(t.keys,r,n,"value"),t.times=r,t.values=n}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(ln.prototype,{evaluate:function(t){var e=this.parameterPositions,r=this._cachedIndex,n=e[r],i=e[r-1];t:{e:{var a;r:{n:if(!(t<n)){for(var o=r+2;;){if(n===void 0){if(t<i)break n;return r=e.length,this._cachedIndex=r,this.afterEnd_(r-1,t,i)}if(r===o)break;if(i=n,t<(n=e[++r]))break e}a=e.length;break r}if(t>=i)break t;var s=e[1];for(t<s&&(r=2,i=s),o=r-2;;){if(i===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(r===o)break;if(n=i,t>=(i=e[--r-1]))break e}a=r,r=0}for(;r<a;){var c=r+a>>>1;t<e[c]?a=c:r=c+1}if(n=e[r],(i=e[r-1])===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(n===void 0)return r=e.length,this._cachedIndex=r,this.afterEnd_(r-1,i,t)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n,a=0;a!==n;++a)e[a]=r[i+a];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(ln.prototype,{beforeStart_:ln.prototype.copySampleValue_,afterEnd_:ln.prototype.copySampleValue_}),Mc.prototype=Object.assign(Object.create(ln.prototype),{constructor:Mc,DefaultSettings_:{endingStart:Pi,endingEnd:Pi},intervalChanged_:function(t,e,r){var n=this.parameterPositions,i=t-2,a=t+1,o=n[i],s=n[a];if(o===void 0)switch(this.getSettings_().endingStart){case Ci:i=t,o=2*e-r;break;case To:o=e+n[i=n.length-2]-n[i+1];break;default:i=t,o=r}if(s===void 0)switch(this.getSettings_().endingEnd){case Ci:a=t,s=2*r-e;break;case To:a=1,s=r+n[1]-n[0];break;default:a=t-1,s=e}var c=.5*(r-e),l=this.valueSize;this._weightPrev=c/(e-o),this._weightNext=c/(s-r),this._offsetPrev=i*l,this._offsetNext=a*l},interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,c=s-o,l=this._offsetPrev,h=this._offsetNext,m=this._weightPrev,g=this._weightNext,u=(r-e)/(n-e),y=u*u,A=y*u,M=-m*A+2*m*y-m*u,N=(1+m)*A+(-1.5-2*m)*y+(-.5+m)*u+1,j=(-1-g)*A+(1.5+g)*y+.5*u,k=g*A-g*y,ot=0;ot!==o;++ot)i[ot]=M*a[l+ot]+N*a[c+ot]+j*a[s+ot]+k*a[h+ot];return i}}),ys.prototype=Object.assign(Object.create(ln.prototype),{constructor:ys,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,c=s-o,l=(r-e)/(n-e),h=1-l,m=0;m!==o;++m)i[m]=a[c+m]*h+a[s+m]*l;return i}}),Sc.prototype=Object.assign(Object.create(ln.prototype),{constructor:Sc,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(zr,{toJSON:function(t){var e,r=t.constructor;if(r.toJSON!==void 0)e=r.toJSON(t);else{e={name:t.name,times:_r.convertArray(t.times,Array),values:_r.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e}}),Object.assign(zr.prototype,{constructor:zr,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:So,InterpolantFactoryMethodDiscrete:function(t){return new Sc(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new ys(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Mc(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case Mo:e=this.InterpolantFactoryMethodDiscrete;break;case So:e=this.InterpolantFactoryMethodLinear;break;case Ns:e=this.InterpolantFactoryMethodSmooth}if(e===void 0){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(t===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Mo;case this.InterpolantFactoryMethodLinear:return So;case this.InterpolantFactoryMethodSmooth:return Ns}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(t!==0)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]+=t;return this},scale:function(t){if(t!==1)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]*=t;return this},trim:function(t,e){for(var r=this.times,n=r.length,i=0,a=n-1;i!==n&&r[i]<t;)++i;for(;a!==-1&&r[a]>e;)--a;if(++a,i!==0||a!==n){i>=a&&(i=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=_r.arraySlice(r,i,a),this.values=_r.arraySlice(this.values,i*o,a*o)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var r=this.times,n=this.values,i=r.length;i===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var a=null,o=0;o!==i;o++){var s=r[o];if(typeof s=="number"&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),t=!1;break}if(a!==null&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),t=!1;break}a=s}if(n!==void 0&&_r.isTypedArray(n)){o=0;for(var c=n.length;o!==c;++o){var l=n[o];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,l),t=!1;break}}}return t},optimize:function(){for(var t=_r.arraySlice(this.times),e=_r.arraySlice(this.values),r=this.getValueSize(),n=this.getInterpolation()===Ns,i=1,a=t.length-1,o=1;o<a;++o){var s=!1,c=t[o];if(c!==t[o+1]&&(o!==1||c!==c[0]))if(n)s=!0;else for(var l=o*r,h=l-r,m=l+r,g=0;g!==r;++g){var u=e[l+g];if(u!==e[h+g]||u!==e[m+g]){s=!0;break}}if(s){if(o!==i){t[i]=t[o];var y=o*r,A=i*r;for(g=0;g!==r;++g)e[A+g]=e[y+g]}++i}}if(a>0){for(t[i]=t[a],y=a*r,A=i*r,g=0;g!==r;++g)e[A+g]=e[y+g];++i}return i!==t.length?(this.times=_r.arraySlice(t,0,i),this.values=_r.arraySlice(e,0,i*r)):(this.times=t,this.values=e),this},clone:function(){var t=_r.arraySlice(this.times,0),e=_r.arraySlice(this.values,0),r=new this.constructor(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}}),Tc.prototype=Object.assign(Object.create(zr.prototype),{constructor:Tc,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Mo,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ec.prototype=Object.assign(Object.create(zr.prototype),{constructor:Ec,ValueTypeName:"color"}),oo.prototype=Object.assign(Object.create(zr.prototype),{constructor:oo,ValueTypeName:"number"}),Ac.prototype=Object.assign(Object.create(ln.prototype),{constructor:Ac,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,c=(r-e)/(n-e),l=s+o;s!==l;s+=4)Ir.slerpFlat(i,0,a,s-o,a,s,c);return i}}),xs.prototype=Object.assign(Object.create(zr.prototype),{constructor:xs,ValueTypeName:"quaternion",DefaultInterpolation:So,InterpolantFactoryMethodLinear:function(t){return new Ac(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Lc.prototype=Object.assign(Object.create(zr.prototype),{constructor:Lc,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Mo,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),so.prototype=Object.assign(Object.create(zr.prototype),{constructor:so,ValueTypeName:"vector"}),Object.assign(pn,{parse:function(t){for(var e=[],r=t.tracks,n=1/(t.fps||1),i=0,a=r.length;i!==a;++i)e.push(Wm(r[i]).scale(n));return new pn(t.name,t.duration,e,t.blendMode)},toJSON:function(t){for(var e=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode},i=0,a=r.length;i!==a;++i)e.push(zr.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(t,e,r,n){for(var i=e.length,a=[],o=0;o<i;o++){var s=[],c=[];s.push((o+i-1)%i,o,(o+1)%i),c.push(0,1,0);var l=_r.getKeyframeOrder(s);s=_r.sortedArray(s,1,l),c=_r.sortedArray(c,1,l),n||s[0]!==0||(s.push(i),c.push(c[0])),a.push(new oo(".morphTargetInfluences["+e[o].name+"]",s,c).scale(1/r))}return new pn(t,-1,a)},findByName:function(t,e){var r=t;if(!Array.isArray(t)){var n=t;r=n.geometry&&n.geometry.animations||n.animations}for(var i=0;i<r.length;i++)if(r[i].name===e)return r[i];return null},CreateClipsFromMorphTargetSequences:function(t,e,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,a=0,o=t.length;a<o;a++){var s=t[a],c=s.name.match(i);if(c&&c.length>1){var l=n[m=c[1]];l||(n[m]=l=[]),l.push(s)}}var h=[];for(var m in n)h.push(pn.CreateFromMorphTargetSequence(m,n[m],e,r));return h},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(k,ot,nt,gt,yt){if(nt.length!==0){var Gt=[],st=[];_r.flattenJSON(nt,Gt,st,gt),Gt.length!==0&&yt.push(new k(ot,Gt,st))}},n=[],i=t.name||"default",a=t.length||-1,o=t.fps||30,s=t.blendMode,c=t.hierarchy||[],l=0;l<c.length;l++){var h=c[l].keys;if(h&&h.length!==0)if(h[0].morphTargets){for(var m={},g=0;g<h.length;g++)if(h[g].morphTargets)for(var u=0;u<h[g].morphTargets.length;u++)m[h[g].morphTargets[u]]=-1;for(var y in m){var A=[],M=[];for(u=0;u!==h[g].morphTargets.length;++u){var N=h[g];A.push(N.time),M.push(N.morphTarget===y?1:0)}n.push(new oo(".morphTargetInfluence["+y+"]",A,M))}a=m.length*(o||1)}else{var j=".bones["+e[l].name+"]";r(so,j+".position",h,"pos",n),r(xs,j+".quaternion",h,"rot",n),r(so,j+".scale",h,"scl",n)}}return n.length===0?null:new pn(i,a,n,s)}}),Object.assign(pn.prototype,{resetDuration:function(){for(var t=0,e=0,r=this.tracks.length;e!==r;++e){var n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new pn(this.name,this.duration,t,this.blendMode)}});var aa={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function ou(t,e,r){var n=this,i=!1,a=0,o=0,s=void 0,c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r,this.itemStart=function(l){o++,i===!1&&n.onStart!==void 0&&n.onStart(l,a,o),i=!0},this.itemEnd=function(l){a++,n.onProgress!==void 0&&n.onProgress(l,a,o),a===o&&(i=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(l){n.onError!==void 0&&n.onError(l)},this.resolveURL=function(l){return s?s(l):l},this.setURLModifier=function(l){return s=l,this},this.addHandler=function(l,h){return c.push(l,h),this},this.removeHandler=function(l){var h=c.indexOf(l);return h!==-1&&c.splice(h,2),this},this.getHandler=function(l){for(var h=0,m=c.length;h<m;h+=2){var g=c[h],u=c[h+1];if(g.global&&(g.lastIndex=0),g.test(l))return u}return null}}var Wd=new ou;function rr(t){this.manager=t!==void 0?t:Wd,this.crossOrigin="anonymous",this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(rr.prototype,{load:function(){},loadAsync:function(t,e){var r=this;return new Promise(function(n,i){r.load(t,n,e,i)})},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});var Ln={};function fn(t){rr.call(this,t)}function su(t){rr.call(this,t)}function cu(t){rr.call(this,t)}function Rc(t){rr.call(this,t)}function co(t){rr.call(this,t)}function Pc(t){rr.call(this,t)}function Cc(t){rr.call(this,t)}function Re(){this.type="Curve",this.arcLengthDivisions=200}function un(t,e,r,n,i,a,o,s){Re.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function lo(t,e,r,n,i,a){un.call(this,t,e,r,r,n,i,a),this.type="ArcCurve"}function lu(){var t=0,e=0,r=0,n=0;function i(a,o,s,c){t=a,e=s,r=-3*a+3*o-2*s-c,n=2*a-2*o+s+c}return{initCatmullRom:function(a,o,s,c,l){i(o,s,l*(s-a),l*(c-o))},initNonuniformCatmullRom:function(a,o,s,c,l,h,m){var g=(o-a)/l-(s-a)/(l+h)+(s-o)/h,u=(s-o)/h-(c-o)/(h+m)+(c-s)/m;i(o,s,g*=h,u*=h)},calc:function(a){var o=a*a;return t+e*a+r*o+n*(o*a)}}}fn.prototype=Object.assign(Object.create(rr.prototype),{constructor:fn,load:function(t,e,r,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,a=aa.get(t);if(a!==void 0)return i.manager.itemStart(t),setTimeout(function(){e&&e(a),i.manager.itemEnd(t)},0),a;if(Ln[t]===void 0){var o=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){var s=o[1],c=!!o[2],l=o[3];l=decodeURIComponent(l),c&&(l=atob(l));try{var h,m=(this.responseType||"").toLowerCase();switch(m){case"arraybuffer":case"blob":for(var g=new Uint8Array(l.length),u=0;u<l.length;u++)g[u]=l.charCodeAt(u);h=m==="blob"?new Blob([g.buffer],{type:s}):g.buffer;break;case"document":var y=new DOMParser;h=y.parseFromString(l,s);break;case"json":h=JSON.parse(l);break;default:h=l}setTimeout(function(){e&&e(h),i.manager.itemEnd(t)},0)}catch(N){setTimeout(function(){n&&n(N),i.manager.itemError(t),i.manager.itemEnd(t)},0)}}else{Ln[t]=[],Ln[t].push({onLoad:e,onProgress:r,onError:n});var A=new XMLHttpRequest;for(var M in A.open("GET",t,!0),A.addEventListener("load",function(N){var j=this.response,k=Ln[t];if(delete Ln[t],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),aa.add(t,j);for(var ot=0,nt=k.length;ot<nt;ot++)(gt=k[ot]).onLoad&&gt.onLoad(j);i.manager.itemEnd(t)}else{for(ot=0,nt=k.length;ot<nt;ot++){var gt;(gt=k[ot]).onError&&gt.onError(N)}i.manager.itemError(t),i.manager.itemEnd(t)}},!1),A.addEventListener("progress",function(N){for(var j=Ln[t],k=0,ot=j.length;k<ot;k++){var nt=j[k];nt.onProgress&&nt.onProgress(N)}},!1),A.addEventListener("error",function(N){var j=Ln[t];delete Ln[t];for(var k=0,ot=j.length;k<ot;k++){var nt=j[k];nt.onError&&nt.onError(N)}i.manager.itemError(t),i.manager.itemEnd(t)},!1),A.addEventListener("abort",function(N){var j=Ln[t];delete Ln[t];for(var k=0,ot=j.length;k<ot;k++){var nt=j[k];nt.onError&&nt.onError(N)}i.manager.itemError(t),i.manager.itemEnd(t)},!1),this.responseType!==void 0&&(A.responseType=this.responseType),this.withCredentials!==void 0&&(A.withCredentials=this.withCredentials),A.overrideMimeType&&A.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain"),this.requestHeader)A.setRequestHeader(M,this.requestHeader[M]);A.send(null)}return i.manager.itemStart(t),A}Ln[t].push({onLoad:e,onProgress:r,onError:n})},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this}}),su.prototype=Object.assign(Object.create(rr.prototype),{constructor:su,load:function(t,e,r,n){var i=this,a=new fn(i.manager);a.setPath(i.path),a.load(t,function(o){try{e(i.parse(JSON.parse(o)))}catch(s){n?n(s):console.error(s),i.manager.itemError(t)}},r,n)},parse:function(t){for(var e=[],r=0;r<t.length;r++){var n=pn.parse(t[r]);e.push(n)}return e}}),cu.prototype=Object.assign(Object.create(rr.prototype),{constructor:cu,load:function(t,e,r,n){var i=this,a=[],o=new qa;o.image=a;var s=new fn(this.manager);function c(g){s.load(t[g],function(u){var y=i.parse(u,!0);a[g]={width:y.width,height:y.height,format:y.format,mipmaps:y.mipmaps},(l+=1)===6&&(y.mipmapCount===1&&(o.minFilter=Lt),o.format=y.format,o.needsUpdate=!0,e&&e(o))},r,n)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(t))for(var l=0,h=0,m=t.length;h<m;++h)c(h);else s.load(t,function(g){var u=i.parse(g,!0);if(u.isCubemap)for(var y=u.mipmaps.length/u.mipmapCount,A=0;A<y;A++){a[A]={mipmaps:[]};for(var M=0;M<u.mipmapCount;M++)a[A].mipmaps.push(u.mipmaps[A*u.mipmapCount+M]),a[A].format=u.format,a[A].width=u.width,a[A].height=u.height}else o.image.width=u.width,o.image.height=u.height,o.mipmaps=u.mipmaps;u.mipmapCount===1&&(o.minFilter=Lt),o.format=u.format,o.needsUpdate=!0,e&&e(o)},r,n);return o}}),Rc.prototype=Object.assign(Object.create(rr.prototype),{constructor:Rc,load:function(t,e,r,n){var i=this,a=new ki,o=new fn(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(t,function(s){var c=i.parse(s);c&&(c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:B,a.wrapT=c.wrapT!==void 0?c.wrapT:B,a.magFilter=c.magFilter!==void 0?c.magFilter:Lt,a.minFilter=c.minFilter!==void 0?c.minFilter:Lt,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=lr),c.mipmapCount===1&&(a.minFilter=Lt),a.needsUpdate=!0,e&&e(a,c))},r,n),a}}),co.prototype=Object.assign(Object.create(rr.prototype),{constructor:co,load:function(t,e,r,n){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,a=aa.get(t);if(a!==void 0)return i.manager.itemStart(t),setTimeout(function(){e&&e(a),i.manager.itemEnd(t)},0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",c,!1),aa.add(t,this),e&&e(this),i.manager.itemEnd(t)}function c(l){o.removeEventListener("load",s,!1),o.removeEventListener("error",c,!1),n&&n(l),i.manager.itemError(t),i.manager.itemEnd(t)}return o.addEventListener("load",s,!1),o.addEventListener("error",c,!1),t.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(t),o.src=t,o}}),Pc.prototype=Object.assign(Object.create(rr.prototype),{constructor:Pc,load:function(t,e,r,n){var i=new ni,a=new co(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(l){a.load(t[l],function(h){i.images[l]=h,++o===6&&(i.needsUpdate=!0,e&&e(i))},void 0,n)}for(var c=0;c<t.length;++c)s(c);return i}}),Cc.prototype=Object.assign(Object.create(rr.prototype),{constructor:Cc,load:function(t,e,r,n){var i=new ur,a=new co(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(o){i.image=o;var s=t.search(/\.jpe?g($|\?)/i)>0||t.search(/^data\:image\/jpeg/)===0;i.format=s?Bn:$r,i.needsUpdate=!0,e!==void 0&&e(i)},r,n),i}}),Object.assign(Re.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var r=this.getUtoTmapping(t);return this.getPoint(r,e)},getPoints:function(t){t===void 0&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return e},getSpacedPoints:function(t){t===void 0&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPointAt(r/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(t===void 0&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,r,n=[],i=this.getPoint(0),a=0;for(n.push(0),r=1;r<=t;r++)a+=(e=this.getPoint(r/t)).distanceTo(i),n.push(a),i=e;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var r,n=this.getLengths(),i=0,a=n.length;r=e||t*n[a-1];for(var o,s=0,c=a-1;s<=c;)if((o=n[i=Math.floor(s+(c-s)/2)]-r)<0)s=i+1;else{if(!(o>0)){c=i;break}c=i-1}if(n[i=c]===r)return i/(a-1);var l=n[i];return(i+(r-l)/(n[i+1]-l))/(a-1)},getTangent:function(t,e){var r=t-1e-4,n=t+1e-4;r<0&&(r=0),n>1&&(n=1);var i=this.getPoint(r),a=this.getPoint(n),o=e||(i.isVector2?new Wt:new q);return o.copy(a).sub(i).normalize(),o},getTangentAt:function(t,e){var r=this.getUtoTmapping(t);return this.getTangent(r,e)},computeFrenetFrames:function(t,e){var r,n,i,a=new q,o=[],s=[],c=[],l=new q,h=new Xe;for(r=0;r<=t;r++)n=r/t,o[r]=this.getTangentAt(n,new q),o[r].normalize();s[0]=new q,c[0]=new q;var m=Number.MAX_VALUE,g=Math.abs(o[0].x),u=Math.abs(o[0].y),y=Math.abs(o[0].z);for(g<=m&&(m=g,a.set(1,0,0)),u<=m&&(m=u,a.set(0,1,0)),y<=m&&a.set(0,0,1),l.crossVectors(o[0],a).normalize(),s[0].crossVectors(o[0],l),c[0].crossVectors(o[0],s[0]),r=1;r<=t;r++)s[r]=s[r-1].clone(),c[r]=c[r-1].clone(),l.crossVectors(o[r-1],o[r]),l.length()>Number.EPSILON&&(l.normalize(),i=Math.acos(We.clamp(o[r-1].dot(o[r]),-1,1)),s[r].applyMatrix4(h.makeRotationAxis(l,i))),c[r].crossVectors(o[r],s[r]);if(e===!0)for(i=Math.acos(We.clamp(s[0].dot(s[t]),-1,1)),i/=t,o[0].dot(l.crossVectors(s[0],s[t]))>0&&(i=-i),r=1;r<=t;r++)s[r].applyMatrix4(h.makeRotationAxis(o[r],i*r)),c[r].crossVectors(o[r],s[r]);return{tangents:o,normals:s,binormals:c}},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),un.prototype=Object.create(Re.prototype),un.prototype.constructor=un,un.prototype.isEllipseCurve=!0,un.prototype.getPoint=function(t,e){for(var r=e||new Wt,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,a=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=a?0:n),this.aClockwise!==!0||a||(i===n?i=-n:i-=n);var o=this.aStartAngle+t*i,s=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){var l=Math.cos(this.aRotation),h=Math.sin(this.aRotation),m=s-this.aX,g=c-this.aY;s=m*l-g*h+this.aX,c=m*h+g*l+this.aY}return r.set(s,c)},un.prototype.copy=function(t){return Re.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},un.prototype.toJSON=function(){var t=Re.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},un.prototype.fromJSON=function(t){return Re.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},lo.prototype=Object.create(un.prototype),lo.prototype.constructor=lo,lo.prototype.isArcCurve=!0;var Oc=new q,uu=new lu,hu=new lu,du=new lu;function jr(t,e,r,n){Re.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=r||"centripetal",this.tension=n||.5}function qd(t,e,r,n,i){var a=.5*(n-e),o=.5*(i-r),s=t*t;return(2*r-2*n+a+o)*(t*s)+(-3*r+3*n-2*a-o)*s+a*t+r}function bs(t,e,r,n){return function(i,a){var o=1-i;return o*o*a}(t,e)+function(i,a){return 2*(1-i)*i*a}(t,r)+function(i,a){return i*i*a}(t,n)}function ws(t,e,r,n,i){return function(a,o){var s=1-a;return s*s*s*o}(t,e)+function(a,o){var s=1-a;return 3*s*s*a*o}(t,r)+function(a,o){return 3*(1-a)*a*a*o}(t,n)+function(a,o){return a*a*a*o}(t,i)}function Rn(t,e,r,n){Re.call(this),this.type="CubicBezierCurve",this.v0=t||new Wt,this.v1=e||new Wt,this.v2=r||new Wt,this.v3=n||new Wt}function Wn(t,e,r,n){Re.call(this),this.type="CubicBezierCurve3",this.v0=t||new q,this.v1=e||new q,this.v2=r||new q,this.v3=n||new q}function en(t,e){Re.call(this),this.type="LineCurve",this.v1=t||new Wt,this.v2=e||new Wt}function Pn(t,e){Re.call(this),this.type="LineCurve3",this.v1=t||new q,this.v2=e||new q}function Cn(t,e,r){Re.call(this),this.type="QuadraticBezierCurve",this.v0=t||new Wt,this.v1=e||new Wt,this.v2=r||new Wt}function qn(t,e,r){Re.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new q,this.v1=e||new q,this.v2=r||new q}function On(t){Re.call(this),this.type="SplineCurve",this.points=t||[]}jr.prototype=Object.create(Re.prototype),jr.prototype.constructor=jr,jr.prototype.isCatmullRomCurve3=!0,jr.prototype.getPoint=function(t,e){var r,n,i,a,o=e||new q,s=this.points,c=s.length,l=(c-(this.closed?0:1))*t,h=Math.floor(l),m=l-h;if(this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/c)+1)*c:m===0&&h===c-1&&(h=c-2,m=1),this.closed||h>0?r=s[(h-1)%c]:(Oc.subVectors(s[0],s[1]).add(s[0]),r=Oc),n=s[h%c],i=s[(h+1)%c],this.closed||h+2<c?a=s[(h+2)%c]:(Oc.subVectors(s[c-1],s[c-2]).add(s[c-1]),a=Oc),this.curveType==="centripetal"||this.curveType==="chordal"){var g=this.curveType==="chordal"?.5:.25,u=Math.pow(r.distanceToSquared(n),g),y=Math.pow(n.distanceToSquared(i),g),A=Math.pow(i.distanceToSquared(a),g);y<1e-4&&(y=1),u<1e-4&&(u=y),A<1e-4&&(A=y),uu.initNonuniformCatmullRom(r.x,n.x,i.x,a.x,u,y,A),hu.initNonuniformCatmullRom(r.y,n.y,i.y,a.y,u,y,A),du.initNonuniformCatmullRom(r.z,n.z,i.z,a.z,u,y,A)}else this.curveType==="catmullrom"&&(uu.initCatmullRom(r.x,n.x,i.x,a.x,this.tension),hu.initCatmullRom(r.y,n.y,i.y,a.y,this.tension),du.initCatmullRom(r.z,n.z,i.z,a.z,this.tension));return o.set(uu.calc(m),hu.calc(m),du.calc(m)),o},jr.prototype.copy=function(t){Re.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},jr.prototype.toJSON=function(){var t=Re.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++){var n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},jr.prototype.fromJSON=function(t){Re.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push(new q().fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Rn.prototype=Object.create(Re.prototype),Rn.prototype.constructor=Rn,Rn.prototype.isCubicBezierCurve=!0,Rn.prototype.getPoint=function(t,e){var r=e||new Wt,n=this.v0,i=this.v1,a=this.v2,o=this.v3;return r.set(ws(t,n.x,i.x,a.x,o.x),ws(t,n.y,i.y,a.y,o.y)),r},Rn.prototype.copy=function(t){return Re.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Rn.prototype.toJSON=function(){var t=Re.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Rn.prototype.fromJSON=function(t){return Re.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Wn.prototype=Object.create(Re.prototype),Wn.prototype.constructor=Wn,Wn.prototype.isCubicBezierCurve3=!0,Wn.prototype.getPoint=function(t,e){var r=e||new q,n=this.v0,i=this.v1,a=this.v2,o=this.v3;return r.set(ws(t,n.x,i.x,a.x,o.x),ws(t,n.y,i.y,a.y,o.y),ws(t,n.z,i.z,a.z,o.z)),r},Wn.prototype.copy=function(t){return Re.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Wn.prototype.toJSON=function(){var t=Re.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Wn.prototype.fromJSON=function(t){return Re.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},en.prototype=Object.create(Re.prototype),en.prototype.constructor=en,en.prototype.isLineCurve=!0,en.prototype.getPoint=function(t,e){var r=e||new Wt;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},en.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},en.prototype.getTangent=function(t,e){return(e||new Wt).copy(this.v2).sub(this.v1).normalize()},en.prototype.copy=function(t){return Re.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},en.prototype.toJSON=function(){var t=Re.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},en.prototype.fromJSON=function(t){return Re.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Pn.prototype=Object.create(Re.prototype),Pn.prototype.constructor=Pn,Pn.prototype.isLineCurve3=!0,Pn.prototype.getPoint=function(t,e){var r=e||new q;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},Pn.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Pn.prototype.copy=function(t){return Re.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Pn.prototype.toJSON=function(){var t=Re.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Pn.prototype.fromJSON=function(t){return Re.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Cn.prototype=Object.create(Re.prototype),Cn.prototype.constructor=Cn,Cn.prototype.isQuadraticBezierCurve=!0,Cn.prototype.getPoint=function(t,e){var r=e||new Wt,n=this.v0,i=this.v1,a=this.v2;return r.set(bs(t,n.x,i.x,a.x),bs(t,n.y,i.y,a.y)),r},Cn.prototype.copy=function(t){return Re.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Cn.prototype.toJSON=function(){var t=Re.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Cn.prototype.fromJSON=function(t){return Re.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},qn.prototype=Object.create(Re.prototype),qn.prototype.constructor=qn,qn.prototype.isQuadraticBezierCurve3=!0,qn.prototype.getPoint=function(t,e){var r=e||new q,n=this.v0,i=this.v1,a=this.v2;return r.set(bs(t,n.x,i.x,a.x),bs(t,n.y,i.y,a.y),bs(t,n.z,i.z,a.z)),r},qn.prototype.copy=function(t){return Re.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},qn.prototype.toJSON=function(){var t=Re.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},qn.prototype.fromJSON=function(t){return Re.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},On.prototype=Object.create(Re.prototype),On.prototype.constructor=On,On.prototype.isSplineCurve=!0,On.prototype.getPoint=function(t,e){var r=e||new Wt,n=this.points,i=(n.length-1)*t,a=Math.floor(i),o=i-a,s=n[a===0?a:a-1],c=n[a],l=n[a>n.length-2?n.length-1:a+1],h=n[a>n.length-3?n.length-1:a+2];return r.set(qd(o,s.x,c.x,l.x,h.x),qd(o,s.y,c.y,l.y,h.y)),r},On.prototype.copy=function(t){Re.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push(n.clone())}return this},On.prototype.toJSON=function(){var t=Re.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++){var n=this.points[e];t.points.push(n.toArray())}return t},On.prototype.fromJSON=function(t){Re.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push(new Wt().fromArray(n))}return this};var pu=Object.freeze({__proto__:null,ArcCurve:lo,CatmullRomCurve3:jr,CubicBezierCurve:Rn,CubicBezierCurve3:Wn,EllipseCurve:un,LineCurve:en,LineCurve3:Pn,QuadraticBezierCurve:Cn,QuadraticBezierCurve3:qn,SplineCurve:On});function ci(){Re.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Dn(t){ci.call(this),this.type="Path",this.currentPoint=new Wt,t&&this.setFromPoints(t)}function Ei(t){Dn.call(this,t),this.uuid=We.generateUUID(),this.type="Shape",this.holes=[]}function vr(t,e){ge.call(this),this.type="Light",this.color=new we(t),this.intensity=e!==void 0?e:1,this.receiveShadow=void 0}function Dc(t,e,r){vr.call(this,t,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(ge.DefaultUp),this.updateMatrix(),this.groundColor=new we(e)}function Xn(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new Wt(512,512),this.map=null,this.mapPass=null,this.matrix=new Xe,this._frustum=new Ba,this._frameExtents=new Wt(1,1),this._viewportCount=1,this._viewports=[new er(0,0,1,1)]}function Ic(){Xn.call(this,new Or(50,1,.5,500))}function Nc(t,e,r,n,i,a){vr.call(this,t,e),this.type="SpotLight",this.position.copy(ge.DefaultUp),this.updateMatrix(),this.target=new ge,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(o){this.intensity=o/Math.PI}}),this.distance=r!==void 0?r:0,this.angle=n!==void 0?n:Math.PI/3,this.penumbra=i!==void 0?i:0,this.decay=a!==void 0?a:1,this.shadow=new Ic}function fu(){Xn.call(this,new Or(90,1,.5,500)),this._frameExtents=new Wt(4,2),this._viewportCount=6,this._viewports=[new er(2,1,1,1),new er(0,1,1,1),new er(3,1,1,1),new er(1,1,1,1),new er(3,0,1,1),new er(1,0,1,1)],this._cubeDirections=[new q(1,0,0),new q(-1,0,0),new q(0,0,1),new q(0,0,-1),new q(0,1,0),new q(0,-1,0)],this._cubeUps=[new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,0,1),new q(0,0,-1)]}function Bc(t,e,r,n){vr.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(i){this.intensity=i/(4*Math.PI)}}),this.distance=r!==void 0?r:0,this.decay=n!==void 0?n:1,this.shadow=new fu}function uo(t,e,r,n,i,a){Vn.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t!==void 0?t:-1,this.right=e!==void 0?e:1,this.top=r!==void 0?r:1,this.bottom=n!==void 0?n:-1,this.near=i!==void 0?i:.1,this.far=a!==void 0?a:2e3,this.updateProjectionMatrix()}function Fc(){Xn.call(this,new uo(-5,5,5,-5,.5,500))}function Uc(t,e){vr.call(this,t,e),this.type="DirectionalLight",this.position.copy(ge.DefaultUp),this.updateMatrix(),this.target=new ge,this.shadow=new Fc}function zc(t,e){vr.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function Gc(t,e,r,n){vr.call(this,t,e),this.type="RectAreaLight",this.width=r!==void 0?r:10,this.height=n!==void 0?n:10}function Vc(){this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new q)}function mn(t,e){vr.call(this,void 0,e),this.type="LightProbe",this.sh=t!==void 0?t:new Vc}function kc(t){rr.call(this,t),this.textures={}}ci.prototype=Object.assign(Object.create(Re.prototype),{constructor:ci,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new en(e,t))},getPoint:function(t){for(var e=t*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=e){var i=r[n]-e,a=this.curves[n],o=a.getLength(),s=o===0?0:1-i/o;return a.getPointAt(s)}n++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,r=0,n=this.curves.length;r<n;r++)e+=this.curves[r].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){t===void 0&&(t=40);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,r=[],n=0,i=this.curves;n<i.length;n++)for(var a=i[n],o=a&&a.isEllipseCurve?2*t:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o),c=0;c<s.length;c++){var l=s[c];e&&e.equals(l)||(r.push(l),e=l)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(t){Re.prototype.copy.call(this,t),this.curves=[];for(var e=0,r=t.curves.length;e<r;e++){var n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){var t=Re.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,r=this.curves.length;e<r;e++){var n=this.curves[e];t.curves.push(n.toJSON())}return t},fromJSON:function(t){Re.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,r=t.curves.length;e<r;e++){var n=t.curves[e];this.curves.push(new pu[n.type]().fromJSON(n))}return this}}),Dn.prototype=Object.assign(Object.create(ci.prototype),{constructor:Dn,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,r=t.length;e<r;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){var r=new en(this.currentPoint.clone(),new Wt(t,e));return this.curves.push(r),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,r,n){var i=new Cn(this.currentPoint.clone(),new Wt(t,e),new Wt(r,n));return this.curves.push(i),this.currentPoint.set(r,n),this},bezierCurveTo:function(t,e,r,n,i,a){var o=new Rn(this.currentPoint.clone(),new Wt(t,e),new Wt(r,n),new Wt(i,a));return this.curves.push(o),this.currentPoint.set(i,a),this},splineThru:function(t){var e=new On([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,r,n,i,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+o,e+s,r,n,i,a),this},absarc:function(t,e,r,n,i,a){return this.absellipse(t,e,r,r,n,i,a),this},ellipse:function(t,e,r,n,i,a,o,s){var c=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+c,e+l,r,n,i,a,o,s),this},absellipse:function(t,e,r,n,i,a,o,s){var c=new un(t,e,r,n,i,a,o,s);if(this.curves.length>0){var l=c.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(c);var h=c.getPoint(1);return this.currentPoint.copy(h),this},copy:function(t){return ci.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=ci.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return ci.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),Ei.prototype=Object.assign(Object.create(Dn.prototype),{constructor:Ei,getPointsHoles:function(t){for(var e=[],r=0,n=this.holes.length;r<n;r++)e[r]=this.holes[r].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){Dn.prototype.copy.call(this,t),this.holes=[];for(var e=0,r=t.holes.length;e<r;e++){var n=t.holes[e];this.holes.push(n.clone())}return this},toJSON:function(){var t=Dn.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,r=this.holes.length;e<r;e++){var n=this.holes[e];t.holes.push(n.toJSON())}return t},fromJSON:function(t){Dn.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,r=t.holes.length;e<r;e++){var n=t.holes[e];this.holes.push(new Dn().fromJSON(n))}return this}}),vr.prototype=Object.assign(Object.create(ge.prototype),{constructor:vr,isLight:!0,copy:function(t){return ge.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=ge.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}}),Dc.prototype=Object.assign(Object.create(vr.prototype),{constructor:Dc,isHemisphereLight:!0,copy:function(t){return vr.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(Xn.prototype,{_projScreenMatrix:new Xe,_lightPositionWorld:new q,_lookTarget:new q,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){var e=this.camera,r=this.matrix,n=this._projScreenMatrix,i=this._lookTarget,a=this._lightPositionWorld;a.setFromMatrixPosition(t.matrixWorld),e.position.copy(a),i.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(i),e.updateMatrixWorld(),n.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(n),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(e.projectionMatrix),r.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var t={};return this.bias!==0&&(t.bias=this.bias),this.radius!==1&&(t.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Ic.prototype=Object.assign(Object.create(Xn.prototype),{constructor:Ic,isSpotLightShadow:!0,updateMatrices:function(t){var e=this.camera,r=2*We.RAD2DEG*t.angle,n=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;r===e.fov&&n===e.aspect&&i===e.far||(e.fov=r,e.aspect=n,e.far=i,e.updateProjectionMatrix()),Xn.prototype.updateMatrices.call(this,t)}}),Nc.prototype=Object.assign(Object.create(vr.prototype),{constructor:Nc,isSpotLight:!0,copy:function(t){return vr.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),fu.prototype=Object.assign(Object.create(Xn.prototype),{constructor:fu,isPointLightShadow:!0,updateMatrices:function(t,e){e===void 0&&(e=0);var r=this.camera,n=this.matrix,i=this._lightPositionWorld,a=this._lookTarget,o=this._projScreenMatrix;i.setFromMatrixPosition(t.matrixWorld),r.position.copy(i),a.copy(r.position),a.add(this._cubeDirections[e]),r.up.copy(this._cubeUps[e]),r.lookAt(a),r.updateMatrixWorld(),n.makeTranslation(-i.x,-i.y,-i.z),o.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o)}}),Bc.prototype=Object.assign(Object.create(vr.prototype),{constructor:Bc,isPointLight:!0,copy:function(t){return vr.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),uo.prototype=Object.assign(Object.create(Vn.prototype),{constructor:uo,isOrthographicCamera:!0,copy:function(t,e){return Vn.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this},setViewOffset:function(t,e,r,n,i,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-t,a=r+t,o=n+e,s=n-e;if(this.view!==null&&this.view.enabled){var c=(this.right-this.left)/this.view.fullWidth/this.zoom,l=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(i+=c*this.view.offsetX)+c*this.view.width,s=(o-=l*this.view.offsetY)-l*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=ge.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}),Fc.prototype=Object.assign(Object.create(Xn.prototype),{constructor:Fc,isDirectionalLightShadow:!0,updateMatrices:function(t){Xn.prototype.updateMatrices.call(this,t)}}),Uc.prototype=Object.assign(Object.create(vr.prototype),{constructor:Uc,isDirectionalLight:!0,copy:function(t){return vr.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),zc.prototype=Object.assign(Object.create(vr.prototype),{constructor:zc,isAmbientLight:!0}),Gc.prototype=Object.assign(Object.create(vr.prototype),{constructor:Gc,isRectAreaLight:!0,copy:function(t){return vr.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=vr.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),Object.assign(Vc.prototype,{isSphericalHarmonics3:!0,set:function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},zero:function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,e){var r=t.x,n=t.y,i=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.282095),e.addScaledVector(a[1],.488603*n),e.addScaledVector(a[2],.488603*i),e.addScaledVector(a[3],.488603*r),e.addScaledVector(a[4],r*n*1.092548),e.addScaledVector(a[5],n*i*1.092548),e.addScaledVector(a[6],.315392*(3*i*i-1)),e.addScaledVector(a[7],r*i*1.092548),e.addScaledVector(a[8],.546274*(r*r-n*n)),e},getIrradianceAt:function(t,e){var r=t.x,n=t.y,i=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.886227),e.addScaledVector(a[1],1.023328*n),e.addScaledVector(a[2],1.023328*i),e.addScaledVector(a[3],1.023328*r),e.addScaledVector(a[4],.858086*r*n),e.addScaledVector(a[5],.858086*n*i),e.addScaledVector(a[6],.743125*i*i-.247708),e.addScaledVector(a[7],.858086*r*i),e.addScaledVector(a[8],.429043*(r*r-n*n)),e},add:function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},addScaledSH:function(t,e){for(var r=0;r<9;r++)this.coefficients[r].addScaledVector(t.coefficients[r],e);return this},scale:function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},lerp:function(t,e){for(var r=0;r<9;r++)this.coefficients[r].lerp(t.coefficients[r],e);return this},equals:function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return new this.constructor().copy(this)},fromArray:function(t,e){e===void 0&&(e=0);for(var r=this.coefficients,n=0;n<9;n++)r[n].fromArray(t,e+3*n);return this},toArray:function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);for(var r=this.coefficients,n=0;n<9;n++)r[n].toArray(t,e+3*n);return t}}),Object.assign(Vc,{getBasisAt:function(t,e){var r=t.x,n=t.y,i=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*i,e[3]=.488603*r,e[4]=1.092548*r*n,e[5]=1.092548*n*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*r*i,e[8]=.546274*(r*r-n*n)}}),mn.prototype=Object.assign(Object.create(vr.prototype),{constructor:mn,isLightProbe:!0,copy:function(t){return vr.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){var e=vr.prototype.toJSON.call(this,t);return e.object.sh=this.sh.toArray(),e}}),kc.prototype=Object.assign(Object.create(rr.prototype),{constructor:kc,load:function(t,e,r,n){var i=this,a=new fn(i.manager);a.setPath(i.path),a.load(t,function(o){try{e(i.parse(JSON.parse(o)))}catch(s){n?n(s):console.error(s),i.manager.itemError(t)}},r,n)},parse:function(t){var e=this.textures;function r(c){return e[c]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",c),e[c]}var n=new jm[t.type];if(t.uuid!==void 0&&(n.uuid=t.uuid),t.name!==void 0&&(n.name=t.name),t.color!==void 0&&n.color.setHex(t.color),t.roughness!==void 0&&(n.roughness=t.roughness),t.metalness!==void 0&&(n.metalness=t.metalness),t.sheen!==void 0&&(n.sheen=new we().setHex(t.sheen)),t.emissive!==void 0&&n.emissive.setHex(t.emissive),t.specular!==void 0&&n.specular.setHex(t.specular),t.shininess!==void 0&&(n.shininess=t.shininess),t.clearcoat!==void 0&&(n.clearcoat=t.clearcoat),t.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=t.clearcoatRoughness),t.fog!==void 0&&(n.fog=t.fog),t.flatShading!==void 0&&(n.flatShading=t.flatShading),t.blending!==void 0&&(n.blending=t.blending),t.combine!==void 0&&(n.combine=t.combine),t.side!==void 0&&(n.side=t.side),t.opacity!==void 0&&(n.opacity=t.opacity),t.transparent!==void 0&&(n.transparent=t.transparent),t.alphaTest!==void 0&&(n.alphaTest=t.alphaTest),t.depthTest!==void 0&&(n.depthTest=t.depthTest),t.depthWrite!==void 0&&(n.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(n.colorWrite=t.colorWrite),t.stencilWrite!==void 0&&(n.stencilWrite=t.stencilWrite),t.stencilWriteMask!==void 0&&(n.stencilWriteMask=t.stencilWriteMask),t.stencilFunc!==void 0&&(n.stencilFunc=t.stencilFunc),t.stencilRef!==void 0&&(n.stencilRef=t.stencilRef),t.stencilFuncMask!==void 0&&(n.stencilFuncMask=t.stencilFuncMask),t.stencilFail!==void 0&&(n.stencilFail=t.stencilFail),t.stencilZFail!==void 0&&(n.stencilZFail=t.stencilZFail),t.stencilZPass!==void 0&&(n.stencilZPass=t.stencilZPass),t.wireframe!==void 0&&(n.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(n.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(n.rotation=t.rotation),t.linewidth!==1&&(n.linewidth=t.linewidth),t.dashSize!==void 0&&(n.dashSize=t.dashSize),t.gapSize!==void 0&&(n.gapSize=t.gapSize),t.scale!==void 0&&(n.scale=t.scale),t.polygonOffset!==void 0&&(n.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=t.polygonOffsetUnits),t.skinning!==void 0&&(n.skinning=t.skinning),t.morphTargets!==void 0&&(n.morphTargets=t.morphTargets),t.morphNormals!==void 0&&(n.morphNormals=t.morphNormals),t.dithering!==void 0&&(n.dithering=t.dithering),t.vertexTangents!==void 0&&(n.vertexTangents=t.vertexTangents),t.visible!==void 0&&(n.visible=t.visible),t.toneMapped!==void 0&&(n.toneMapped=t.toneMapped),t.userData!==void 0&&(n.userData=t.userData),t.vertexColors!==void 0&&(typeof t.vertexColors=="number"?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),t.uniforms!==void 0)for(var i in t.uniforms){var a=t.uniforms[i];switch(n.uniforms[i]={},a.type){case"t":n.uniforms[i].value=r(a.value);break;case"c":n.uniforms[i].value=new we().setHex(a.value);break;case"v2":n.uniforms[i].value=new Wt().fromArray(a.value);break;case"v3":n.uniforms[i].value=new q().fromArray(a.value);break;case"v4":n.uniforms[i].value=new er().fromArray(a.value);break;case"m3":n.uniforms[i].value=new kr().fromArray(a.value);case"m4":n.uniforms[i].value=new Xe().fromArray(a.value);break;default:n.uniforms[i].value=a.value}}if(t.defines!==void 0&&(n.defines=t.defines),t.vertexShader!==void 0&&(n.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(n.fragmentShader=t.fragmentShader),t.extensions!==void 0)for(var o in t.extensions)n.extensions[o]=t.extensions[o];if(t.shading!==void 0&&(n.flatShading=t.shading===1),t.size!==void 0&&(n.size=t.size),t.sizeAttenuation!==void 0&&(n.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(n.map=r(t.map)),t.matcap!==void 0&&(n.matcap=r(t.matcap)),t.alphaMap!==void 0&&(n.alphaMap=r(t.alphaMap)),t.bumpMap!==void 0&&(n.bumpMap=r(t.bumpMap)),t.bumpScale!==void 0&&(n.bumpScale=t.bumpScale),t.normalMap!==void 0&&(n.normalMap=r(t.normalMap)),t.normalMapType!==void 0&&(n.normalMapType=t.normalMapType),t.normalScale!==void 0){var s=t.normalScale;Array.isArray(s)===!1&&(s=[s,s]),n.normalScale=new Wt().fromArray(s)}return t.displacementMap!==void 0&&(n.displacementMap=r(t.displacementMap)),t.displacementScale!==void 0&&(n.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(n.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(n.roughnessMap=r(t.roughnessMap)),t.metalnessMap!==void 0&&(n.metalnessMap=r(t.metalnessMap)),t.emissiveMap!==void 0&&(n.emissiveMap=r(t.emissiveMap)),t.emissiveIntensity!==void 0&&(n.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(n.specularMap=r(t.specularMap)),t.envMap!==void 0&&(n.envMap=r(t.envMap)),t.envMapIntensity!==void 0&&(n.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(n.reflectivity=t.reflectivity),t.refractionRatio!==void 0&&(n.refractionRatio=t.refractionRatio),t.lightMap!==void 0&&(n.lightMap=r(t.lightMap)),t.lightMapIntensity!==void 0&&(n.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(n.aoMap=r(t.aoMap)),t.aoMapIntensity!==void 0&&(n.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(n.gradientMap=r(t.gradientMap)),t.clearcoatMap!==void 0&&(n.clearcoatMap=r(t.clearcoatMap)),t.clearcoatRoughnessMap!==void 0&&(n.clearcoatRoughnessMap=r(t.clearcoatRoughnessMap)),t.clearcoatNormalMap!==void 0&&(n.clearcoatNormalMap=r(t.clearcoatNormalMap)),t.clearcoatNormalScale!==void 0&&(n.clearcoatNormalScale=new Wt().fromArray(t.clearcoatNormalScale)),n},setTextures:function(t){return this.textures=t,this}});var mu={decodeText:function(t){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(t);for(var e="",r=0,n=t.length;r<n;r++)e+=String.fromCharCode(t[r]);try{return decodeURIComponent(escape(e))}catch(i){return e}},extractUrlBase:function(t){var e=t.lastIndexOf("/");return e===-1?"./":t.substr(0,e+1)}};function _s(){_e.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function Hc(t,e,r,n){typeof r=="number"&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Ie.call(this,t,e,r),this.meshPerAttribute=n||1}function jc(t){rr.call(this,t)}_s.prototype=Object.assign(Object.create(_e.prototype),{constructor:_s,isInstancedBufferGeometry:!0,copy:function(t){return _e.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var t=_e.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),Hc.prototype=Object.assign(Object.create(Ie.prototype),{constructor:Hc,isInstancedBufferAttribute:!0,copy:function(t){return Ie.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){var t=Ie.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),jc.prototype=Object.assign(Object.create(rr.prototype),{constructor:jc,load:function(t,e,r,n){var i=this,a=new fn(i.manager);a.setPath(i.path),a.load(t,function(o){try{e(i.parse(JSON.parse(o)))}catch(s){n?n(s):console.error(s),i.manager.itemError(t)}},r,n)},parse:function(t){var e=t.isInstancedBufferGeometry?new _s:new _e,r=t.data.index;if(r!==void 0){var n=new vu[r.type](r.array);e.setIndex(new Ie(n,1))}var i=t.data.attributes;for(var a in i){var o=i[a],s=(n=new vu[o.type](o.array),new(o.isInstancedBufferAttribute?Hc:Ie)(n,o.itemSize,o.normalized));o.name!==void 0&&(s.name=o.name),e.setAttribute(a,s)}var c=t.data.morphAttributes;if(c)for(var a in c){for(var l=c[a],h=[],m=0,g=l.length;m<g;m++)o=l[m],s=new Ie(n=new vu[o.type](o.array),o.itemSize,o.normalized),o.name!==void 0&&(s.name=o.name),h.push(s);e.morphAttributes[a]=h}t.data.morphTargetsRelative&&(e.morphTargetsRelative=!0);var u=t.data.groups||t.data.drawcalls||t.data.offsets;if(u!==void 0){m=0;for(var y=u.length;m!==y;++m){var A=u[m];e.addGroup(A.start,A.count,A.materialIndex)}}var M=t.data.boundingSphere;if(M!==void 0){var N=new q;M.center!==void 0&&N.fromArray(M.center),e.boundingSphere=new Un(N,M.radius)}return t.name&&(e.name=t.name),t.userData&&(e.userData=t.userData),e}});var vu={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray!="undefined"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Wc(t){rr.call(this,t)}Wc.prototype=Object.assign(Object.create(rr.prototype),{constructor:Wc,load:function(t,e,r,n){var i=this,a=this.path===""?mu.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||a;var o=new fn(i.manager);o.setPath(this.path),o.load(t,function(s){var c=null;try{c=JSON.parse(s)}catch(h){return n!==void 0&&n(h),void console.error("THREE:ObjectLoader: Can't parse "+t+".",h.message)}var l=c.metadata;l!==void 0&&l.type!==void 0&&l.type.toLowerCase()!=="geometry"?i.parse(c,e):console.error("THREE.ObjectLoader: Can't load "+t)},r,n)},parse:function(t,e){var r=this.parseShape(t.shapes),n=this.parseGeometries(t.geometries,r),i=this.parseImages(t.images,function(){e!==void 0&&e(s)}),a=this.parseTextures(t.textures,i),o=this.parseMaterials(t.materials,a),s=this.parseObject(t.object,n,o);return t.animations&&(s.animations=this.parseAnimations(t.animations)),t.images!==void 0&&t.images.length!==0||e!==void 0&&e(s),s},parseShape:function(t){var e={};if(t!==void 0)for(var r=0,n=t.length;r<n;r++){var i=new Ei().fromJSON(t[r]);e[i.uuid]=i}return e},parseGeometries:function(t,e){var r={};if(t!==void 0)for(var n=new jc,i=0,a=t.length;i<a;i++){var o,s=t[i];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new Jr[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new Jr[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new Jr[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new Jr[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new Jr[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new Jr[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new Jr[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new Jr[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new Jr[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new Jr[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new Jr[s.type](new pu[s.path.type]().fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new Jr[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new Jr[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var c=[],l=0,h=s.shapes.length;l<h;l++){var m=e[s.shapes[l]];c.push(m)}o=new Jr[s.type](c,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(c=[],l=0,h=s.shapes.length;l<h;l++)m=e[s.shapes[l]],c.push(m);var g=s.options.extrudePath;g!==void 0&&(s.options.extrudePath=new pu[g.type]().fromJSON(g)),o=new Jr[s.type](c,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(s);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid,s.name!==void 0&&(o.name=s.name),o.isBufferGeometry===!0&&s.userData!==void 0&&(o.userData=s.userData),r[s.uuid]=o}return r},parseMaterials:function(t,e){var r={},n={};if(t!==void 0){var i=new kc;i.setTextures(e);for(var a=0,o=t.length;a<o;a++){var s=t[a];if(s.type==="MultiMaterial"){for(var c=[],l=0;l<s.materials.length;l++){var h=s.materials[l];r[h.uuid]===void 0&&(r[h.uuid]=i.parse(h)),c.push(r[h.uuid])}n[s.uuid]=c}else r[s.uuid]===void 0&&(r[s.uuid]=i.parse(s)),n[s.uuid]=r[s.uuid]}}return n},parseAnimations:function(t){for(var e=[],r=0;r<t.length;r++){var n=t[r],i=pn.parse(n);n.uuid!==void 0&&(i.uuid=n.uuid),e.push(i)}return e},parseImages:function(t,e){var r=this,n={};function i(y){return r.manager.itemStart(y),a.load(y,function(){r.manager.itemEnd(y)},void 0,function(){r.manager.itemError(y),r.manager.itemEnd(y)})}if(t!==void 0&&t.length>0){var a=new co(new ou(e));a.setCrossOrigin(this.crossOrigin);for(var o=0,s=t.length;o<s;o++){var c=t[o],l=c.url;if(Array.isArray(l)){n[c.uuid]=[];for(var h=0,m=l.length;h<m;h++){var g=l[h],u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(g)?g:r.resourcePath+g;n[c.uuid].push(i(u))}}else u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:r.resourcePath+c.url,n[c.uuid]=i(u)}}return n},parseTextures:function(t,e){function r(c,l){return typeof c=="number"?c:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",c),l[c])}var n={};if(t!==void 0)for(var i=0,a=t.length;i<a;i++){var o,s=t[i];s.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),e[s.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(o=Array.isArray(e[s.image])?new ni(e[s.image]):new ur(e[s.image])).needsUpdate=!0,o.uuid=s.uuid,s.name!==void 0&&(o.name=s.name),s.mapping!==void 0&&(o.mapping=r(s.mapping,qm)),s.offset!==void 0&&o.offset.fromArray(s.offset),s.repeat!==void 0&&o.repeat.fromArray(s.repeat),s.center!==void 0&&o.center.fromArray(s.center),s.rotation!==void 0&&(o.rotation=s.rotation),s.wrap!==void 0&&(o.wrapS=r(s.wrap[0],Xd),o.wrapT=r(s.wrap[1],Xd)),s.format!==void 0&&(o.format=s.format),s.type!==void 0&&(o.type=s.type),s.encoding!==void 0&&(o.encoding=s.encoding),s.minFilter!==void 0&&(o.minFilter=r(s.minFilter,Yd)),s.magFilter!==void 0&&(o.magFilter=r(s.magFilter,Yd)),s.anisotropy!==void 0&&(o.anisotropy=s.anisotropy),s.flipY!==void 0&&(o.flipY=s.flipY),s.premultiplyAlpha!==void 0&&(o.premultiplyAlpha=s.premultiplyAlpha),s.unpackAlignment!==void 0&&(o.unpackAlignment=s.unpackAlignment),n[s.uuid]=o}return n},parseObject:function(t,e,r){var n;function i(M){return e[M]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",M),e[M]}function a(M){if(M!==void 0){if(Array.isArray(M)){for(var N=[],j=0,k=M.length;j<k;j++){var ot=M[j];r[ot]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",ot),N.push(r[ot])}return N}return r[M]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",M),r[M]}}switch(t.type){case"Scene":n=new _a,t.background!==void 0&&Number.isInteger(t.background)&&(n.background=new we(t.background)),t.fog!==void 0&&(t.fog.type==="Fog"?n.fog=new ic(t.fog.color,t.fog.near,t.fog.far):t.fog.type==="FogExp2"&&(n.fog=new nc(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":n=new Or(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(n.focus=t.focus),t.zoom!==void 0&&(n.zoom=t.zoom),t.filmGauge!==void 0&&(n.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(n.filmOffset=t.filmOffset),t.view!==void 0&&(n.view=Object.assign({},t.view));break;case"OrthographicCamera":n=new uo(t.left,t.right,t.top,t.bottom,t.near,t.far),t.zoom!==void 0&&(n.zoom=t.zoom),t.view!==void 0&&(n.view=Object.assign({},t.view));break;case"AmbientLight":n=new zc(t.color,t.intensity);break;case"DirectionalLight":n=new Uc(t.color,t.intensity);break;case"PointLight":n=new Bc(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":n=new Gc(t.color,t.intensity,t.width,t.height);break;case"SpotLight":n=new Nc(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":n=new Dc(t.color,t.groundColor,t.intensity);break;case"LightProbe":n=new mn().fromJSON(t);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":n=new br(o=i(t.geometry),s=a(t.material));break;case"InstancedMesh":var o=i(t.geometry),s=a(t.material),c=t.count,l=t.instanceMatrix;(n=new dc(o,s,c)).instanceMatrix=new Ie(new Float32Array(l.array),16);break;case"LOD":n=new Zo;break;case"Line":n=new cn(i(t.geometry),a(t.material),t.mode);break;case"LineLoop":n=new gc(i(t.geometry),a(t.material));break;case"LineSegments":n=new Mr(i(t.geometry),a(t.material));break;case"PointCloud":case"Points":n=new Wa(i(t.geometry),a(t.material));break;case"Sprite":n=new Yo(a(t.material));break;case"Group":n=new Ga;break;default:n=new ge}if(n.uuid=t.uuid,t.name!==void 0&&(n.name=t.name),t.matrix!==void 0?(n.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(n.matrixAutoUpdate=t.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(t.position!==void 0&&n.position.fromArray(t.position),t.rotation!==void 0&&n.rotation.fromArray(t.rotation),t.quaternion!==void 0&&n.quaternion.fromArray(t.quaternion),t.scale!==void 0&&n.scale.fromArray(t.scale)),t.castShadow!==void 0&&(n.castShadow=t.castShadow),t.receiveShadow!==void 0&&(n.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.bias!==void 0&&(n.shadow.bias=t.shadow.bias),t.shadow.radius!==void 0&&(n.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&n.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(n.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(n.visible=t.visible),t.frustumCulled!==void 0&&(n.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(n.renderOrder=t.renderOrder),t.userData!==void 0&&(n.userData=t.userData),t.layers!==void 0&&(n.layers.mask=t.layers),t.children!==void 0)for(var h=t.children,m=0;m<h.length;m++)n.add(this.parseObject(h[m],e,r));if(t.type==="LOD"){t.autoUpdate!==void 0&&(n.autoUpdate=t.autoUpdate);for(var g=t.levels,u=0;u<g.length;u++){var y=g[u],A=n.getObjectByProperty("uuid",y.object);A!==void 0&&n.addLevel(A,y.distance)}}return n}});var qc,qm={UVMapping:Q,CubeReflectionMapping:wt,CubeRefractionMapping:zt,EquirectangularReflectionMapping:bt,EquirectangularRefractionMapping:Xt,SphericalReflectionMapping:rt,CubeUVReflectionMapping:d,CubeUVRefractionMapping:b},Xd={RepeatWrapping:R,ClampToEdgeWrapping:B,MirroredRepeatWrapping:V},Yd={NearestFilter:it,NearestMipmapNearestFilter:mt,NearestMipmapLinearFilter:It,LinearFilter:Lt,LinearMipmapNearestFilter:Se,LinearMipmapLinearFilter:lr};function gu(t){typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),rr.call(this,t),this.options=void 0}function yu(){this.type="ShapePath",this.color=new we,this.subPaths=[],this.currentPath=null}function xu(t){this.type="Font",this.data=t}function Xm(t,e,r,n,i){var a=i.glyphs[t]||i.glyphs["?"];if(a){var o,s,c,l,h,m,g,u,y=new yu;if(a.o)for(var A=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),M=0,N=A.length;M<N;)switch(A[M++]){case"m":o=A[M++]*e+r,s=A[M++]*e+n,y.moveTo(o,s);break;case"l":o=A[M++]*e+r,s=A[M++]*e+n,y.lineTo(o,s);break;case"q":c=A[M++]*e+r,l=A[M++]*e+n,h=A[M++]*e+r,m=A[M++]*e+n,y.quadraticCurveTo(h,m,c,l);break;case"b":c=A[M++]*e+r,l=A[M++]*e+n,h=A[M++]*e+r,m=A[M++]*e+n,g=A[M++]*e+r,u=A[M++]*e+n,y.bezierCurveTo(h,m,g,u,c,l)}return{offsetX:a.ha*e,path:y}}console.error('THREE.Font: character "'+t+'" does not exists in font family '+i.familyName+".")}function bu(t){rr.call(this,t)}gu.prototype=Object.assign(Object.create(rr.prototype),{constructor:gu,setOptions:function(t){return this.options=t,this},load:function(t,e,r,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,a=aa.get(t);if(a!==void 0)return i.manager.itemStart(t),setTimeout(function(){e&&e(a),i.manager.itemEnd(t)},0),a;fetch(t).then(function(o){return o.blob()}).then(function(o){return i.options===void 0?createImageBitmap(o):createImageBitmap(o,i.options)}).then(function(o){aa.add(t,o),e&&e(o),i.manager.itemEnd(t)}).catch(function(o){n&&n(o),i.manager.itemError(t),i.manager.itemEnd(t)}),i.manager.itemStart(t)}}),Object.assign(yu.prototype,{moveTo:function(t,e){return this.currentPath=new Dn,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,r,n){return this.currentPath.quadraticCurveTo(t,e,r,n),this},bezierCurveTo:function(t,e,r,n,i,a){return this.currentPath.bezierCurveTo(t,e,r,n,i,a),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function r(Rt){for(var Zt=[],qt=0,Ht=Rt.length;qt<Ht;qt++){var Kt=Rt[qt],be=new Ei;be.curves=Kt.curves,Zt.push(be)}return Zt}function n(Rt,Zt){for(var qt=Zt.length,Ht=!1,Kt=qt-1,be=0;be<qt;Kt=be++){var Oe=Zt[Kt],Ge=Zt[be],K=Ge.x-Oe.x,lt=Ge.y-Oe.y;if(Math.abs(lt)>Number.EPSILON){if(lt<0&&(Oe=Zt[be],K=-K,Ge=Zt[Kt],lt=-lt),Rt.y<Oe.y||Rt.y>Ge.y)continue;if(Rt.y===Oe.y){if(Rt.x===Oe.x)return!0}else{var $t=lt*(Rt.x-Oe.x)-K*(Rt.y-Oe.y);if($t===0)return!0;if($t<0)continue;Ht=!Ht}}else{if(Rt.y!==Oe.y)continue;if(Ge.x<=Rt.x&&Rt.x<=Oe.x||Oe.x<=Rt.x&&Rt.x<=Ge.x)return!0}}return Ht}var i=ai.isClockWise,a=this.subPaths;if(a.length===0)return[];if(e===!0)return r(a);var o,s,c,l=[];if(a.length===1)return s=a[0],(c=new Ei).curves=s.curves,l.push(c),l;var h=!i(a[0].getPoints());h=t?!h:h;var m,g,u=[],y=[],A=[],M=0;y[M]=void 0,A[M]=[];for(var N=0,j=a.length;N<j;N++)o=i(m=(s=a[N]).getPoints()),(o=t?!o:o)?(!h&&y[M]&&M++,y[M]={s:new Ei,p:m},y[M].s.curves=s.curves,h&&M++,A[M]=[]):A[M].push({h:s,p:m[0]});if(!y[0])return r(a);if(y.length>1){for(var k=!1,ot=[],nt=0,gt=y.length;nt<gt;nt++)u[nt]=[];for(nt=0,gt=y.length;nt<gt;nt++)for(var yt=A[nt],Gt=0;Gt<yt.length;Gt++){for(var st=yt[Gt],Nt=!0,Bt=0;Bt<y.length;Bt++)n(st.p,y[Bt].p)&&(nt!==Bt&&ot.push({froms:nt,tos:Bt,hole:Gt}),Nt?(Nt=!1,u[Bt].push(st)):k=!0);Nt&&u[nt].push(st)}ot.length>0&&(k||(A=u))}N=0;for(var jt=y.length;N<jt;N++){c=y[N].s,l.push(c);for(var xe=0,ae=(g=A[N]).length;xe<ae;xe++)c.holes.push(g[xe].h)}return l}}),Object.assign(xu.prototype,{isFont:!0,generateShapes:function(t,e){e===void 0&&(e=100);for(var r=[],n=function(o,s,c){for(var l=Array.from?Array.from(o):String(o).split(""),h=s/c.resolution,m=(c.boundingBox.yMax-c.boundingBox.yMin+c.underlineThickness)*h,g=[],u=0,y=0,A=0;A<l.length;A++){var M=l[A];if(M===`
`)u=0,y-=m;else{var N=Xm(M,h,u,y,c);u+=N.offsetX,g.push(N.path)}}return g}(t,e,this.data),i=0,a=n.length;i<a;i++)Array.prototype.push.apply(r,n[i].toShapes());return r}}),bu.prototype=Object.assign(Object.create(rr.prototype),{constructor:bu,load:function(t,e,r,n){var i=this,a=new fn(this.manager);a.setPath(this.path),a.load(t,function(o){var s;try{s=JSON.parse(o)}catch(l){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),s=JSON.parse(o.substring(65,o.length-2))}var c=i.parse(s);e&&e(c)},r,n)},parse:function(t){return new xu(t)}});var wu={getContext:function(){return qc===void 0&&(qc=new(window.AudioContext||window.webkitAudioContext)),qc},setContext:function(t){qc=t}};function Xc(t){rr.call(this,t)}function _u(t,e,r){mn.call(this,void 0,r);var n=new we().set(t),i=new we().set(e),a=new q(n.r,n.g,n.b),o=new q(i.r,i.g,i.b),s=Math.sqrt(Math.PI),c=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(c)}function Mu(t,e){mn.call(this,void 0,e);var r=new we().set(t);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}Xc.prototype=Object.assign(Object.create(rr.prototype),{constructor:Xc,load:function(t,e,r,n){var i=this,a=new fn(i.manager);a.setResponseType("arraybuffer"),a.setPath(i.path),a.load(t,function(o){try{var s=o.slice(0);wu.getContext().decodeAudioData(s,function(c){e(c)})}catch(c){n?n(c):console.error(c),i.manager.itemError(t)}},r,n)}}),_u.prototype=Object.assign(Object.create(mn.prototype),{constructor:_u,isHemisphereLightProbe:!0,copy:function(t){return mn.prototype.copy.call(this,t),this},toJSON:function(t){return mn.prototype.toJSON.call(this,t)}}),Mu.prototype=Object.assign(Object.create(mn.prototype),{constructor:Mu,isAmbientLightProbe:!0,copy:function(t){return mn.prototype.copy.call(this,t),this},toJSON:function(t){return mn.prototype.toJSON.call(this,t)}});var Zd=new Xe,Jd=new Xe;function Kd(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Or,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Or,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Su(t){this.autoStart=t===void 0||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(Kd.prototype,{update:function(t){var e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;var r,n,i=t.projectionMatrix.clone(),a=e.eyeSep/2,o=a*e.near/e.focus,s=e.near*Math.tan(We.DEG2RAD*e.fov*.5)/e.zoom;Jd.elements[12]=-a,Zd.elements[12]=a,r=-s*e.aspect+o,n=s*e.aspect+o,i.elements[0]=2*e.near/(n-r),i.elements[8]=(n+r)/(n-r),this.cameraL.projectionMatrix.copy(i),r=-s*e.aspect-o,n=s*e.aspect-o,i.elements[0]=2*e.near/(n-r),i.elements[8]=(n+r)/(n-r),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Jd),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Zd)}}),Object.assign(Su.prototype,{start:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=(typeof performance=="undefined"?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}});var oa=new q,Qd=new Ir,Ym=new q,sa=new q;function Tu(){ge.call(this),this.type="AudioListener",this.context=wu.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Su}function ho(t){ge.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._progress=0,this.filters=[]}Tu.prototype=Object.assign(Object.create(ge.prototype),{constructor:Tu,getInput:function(){return this.gain},removeFilter:function(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(t){ge.prototype.updateMatrixWorld.call(this,t);var e=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(oa,Qd,Ym),sa.set(0,0,-1).applyQuaternion(Qd),e.positionX){var n=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(oa.x,n),e.positionY.linearRampToValueAtTime(oa.y,n),e.positionZ.linearRampToValueAtTime(oa.z,n),e.forwardX.linearRampToValueAtTime(sa.x,n),e.forwardY.linearRampToValueAtTime(sa.y,n),e.forwardZ.linearRampToValueAtTime(sa.z,n),e.upX.linearRampToValueAtTime(r.x,n),e.upY.linearRampToValueAtTime(r.y,n),e.upZ.linearRampToValueAtTime(r.z,n)}else e.setPosition(oa.x,oa.y,oa.z),e.setOrientation(sa.x,sa.y,sa.z,r.x,r.y,r.z)}}),ho.prototype=Object.assign(Object.create(ge.prototype),{constructor:ho,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setMediaStreamSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(t){if(t===void 0&&(t=0),this.isPlaying!==!0){if(this.hasPlaybackControl!==!1){this._startedAt=this.context.currentTime+t;var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),this.isPlaying===!0?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(this.hasPlaybackControl!==!1)return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(this.hasPlaybackControl!==!1)return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}});var ca=new q,$d=new Ir,Zm=new q,la=new q;function Eu(t){ho.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Au(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e!==void 0?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function Lu(t,e,r){var n,i,a;switch(this.binding=t,this.valueSize=r,e){case"quaternion":n=this._slerp,i=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":n=this._select,i=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:n=this._lerp,i=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=i,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Eu.prototype=Object.assign(Object.create(ho.prototype),{constructor:Eu,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,r){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(t){if(ge.prototype.updateMatrixWorld.call(this,t),this.hasPlaybackControl!==!0||this.isPlaying!==!1){this.matrixWorld.decompose(ca,$d,Zm),la.set(0,0,1).applyQuaternion($d);var e=this.panner;if(e.positionX){var r=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(ca.x,r),e.positionY.linearRampToValueAtTime(ca.y,r),e.positionZ.linearRampToValueAtTime(ca.z,r),e.orientationX.linearRampToValueAtTime(la.x,r),e.orientationY.linearRampToValueAtTime(la.y,r),e.orientationZ.linearRampToValueAtTime(la.z,r)}else e.setPosition(ca.x,ca.y,ca.z),e.setOrientation(la.x,la.y,la.z)}}}),Object.assign(Au.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),r=0;r<e.length;r++)t+=e[r];return t/e.length}}),Object.assign(Lu.prototype,{accumulate:function(t,e){var r=this.buffer,n=this.valueSize,i=t*n+n,a=this.cumulativeWeight;if(a===0){for(var o=0;o!==n;++o)r[i+o]=r[o];a=e}else{var s=e/(a+=e);this._mixBufferRegion(r,i,0,s,n)}this.cumulativeWeight=a},accumulateAdditive:function(t){var e=this.buffer,r=this.valueSize,n=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,r),this.cumulativeWeightAdditive+=t},apply:function(t){var e=this.valueSize,r=this.buffer,n=t*e+e,i=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){var s=e*this._origIndex;this._mixBufferRegion(r,n,s,1-i,e)}a>0&&this._mixBufferRegionAdditive(r,n,this._addIndex*e,1,e);for(var c=e,l=e+e;c!==l;++c)if(r[c]!==r[c+e]){o.setValue(r,n);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,r=this.valueSize,n=r*this._origIndex;t.getValue(e,n);for(var i=r,a=n;i!==a;++i)e[i]=e[n+i%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){for(var t=this._addIndex*this.valueSize,e=t+this.valueSize,r=t;r<e;r++)this.buffer[r]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[4*this._addIndex+3]=1},_setAdditiveIdentityOther:function(){for(var t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize,r=0;r<this.valueSize;r++)this.buffer[e+r]=this.buffer[t+r]},_select:function(t,e,r,n,i){if(n>=.5)for(var a=0;a!==i;++a)t[e+a]=t[r+a]},_slerp:function(t,e,r,n){Ir.slerpFlat(t,e,t,e,t,r,n)},_slerpAdditive:function(t,e,r,n,i){var a=this._workIndex*i;Ir.multiplyQuaternionsFlat(t,a,t,e,t,r),Ir.slerpFlat(t,e,t,e,t,a,n)},_lerp:function(t,e,r,n,i){for(var a=1-n,o=0;o!==i;++o){var s=e+o;t[s]=t[s]*a+t[r+o]*n}},_lerpAdditive:function(t,e,r,n,i){for(var a=0;a!==i;++a){var o=e+a;t[o]=t[o]+t[r+a]*n}}});var Jm=new RegExp("[\\[\\]\\.:\\/]","g"),Km="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Qm=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),$m=/(WCOD+)?/.source.replace("WCOD",Km),tv=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),ev=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),rv=new RegExp("^"+Qm+$m+tv+ev+"$"),nv=["material","materials","bones"];function tp(t,e,r){var n=r||Wr.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}function Wr(t,e,r){this.path=e,this.parsedPath=r||Wr.parseTrackName(e),this.node=Wr.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function ep(){this.uuid=We.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,r=arguments.length;e!==r;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function rp(t,e,r,n){this._mixer=t,this._clip=e,this._localRoot=r||null,this.blendMode=n||e.blendMode;for(var i=e.tracks,a=i.length,o=new Array(a),s={endingStart:Pi,endingEnd:Pi},c=0;c!==a;++c){var l=i[c].createInterpolant(null);o[c]=l,l.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Oh,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Ru(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Yc(t){typeof t=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function Pu(t,e,r){ii.call(this,t,e),this.meshPerAttribute=r||1}function Cu(t,e,r,n){this.ray=new Fi(t,e),this.near=r||0,this.far=n||1/0,this.camera=null,this.layers=new Vs,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function np(t,e){return t.distance-e.distance}function Ou(t,e,r,n){if(t.layers.test(e.layers)&&t.raycast(e,r),n===!0)for(var i=t.children,a=0,o=i.length;a<o;a++)Ou(i[a],e,r,!0)}function ip(t,e,r){return this.radius=t!==void 0?t:1,this.phi=e!==void 0?e:0,this.theta=r!==void 0?r:0,this}function ap(t,e,r){return this.radius=t!==void 0?t:1,this.theta=e!==void 0?e:0,this.y=r!==void 0?r:0,this}Object.assign(tp.prototype,{getValue:function(t,e){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];n!==void 0&&n.getValue(t,e)},setValue:function(t,e){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].unbind()}}),Object.assign(Wr,{Composite:tp,create:function(t,e,r){return t&&t.isAnimationObjectGroup?new Wr.Composite(t,e,r):new Wr(t,e,r)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(Jm,"")},parseTrackName:function(t){var e=rv.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var r={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){var i=r.nodeName.substring(n+1);nv.indexOf(i)!==-1&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r},findNode:function(t,e){if(!e||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){var r=t.skeleton.getBoneByName(e);if(r!==void 0)return r}if(t.children){var n=function(a){for(var o=0;o<a.length;o++){var s=a[o];if(s.name===e||s.uuid===e)return s;var c=n(s.children);if(c)return c}return null},i=n(t.children);if(i)return i}return null}}),Object.assign(Wr.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)t[e++]=r[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,r=e.objectName,n=e.propertyName,i=e.propertyIndex;if(t||(t=Wr.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var a=e.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var o=0;o<t.length;o++)if(t[o].name===a){a=o;break}break;default:if(t[r]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(a!==void 0){if(t[a]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[a]}}var s=t[n];if(s!==void 0){var c=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?c=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(c=this.Versioning.MatrixWorldNeedsUpdate);var l=this.BindingType.Direct;if(i!==void 0){if(n==="morphTargetInfluences"){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);t.morphTargetDictionary[i]!==void 0&&(i=t.morphTargetDictionary[i])}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else s.fromArray!==void 0&&s.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][c]}else{var h=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+n+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Wr.prototype,{_getValue_unbound:Wr.prototype.getValue,_setValue_unbound:Wr.prototype.setValue}),Object.assign(ep.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,c=void 0,l=0,h=arguments.length;l!==h;++l){var m=arguments[l],g=m.uuid,u=n[g];if(u===void 0){u=e++,n[g]=u,t.push(m);for(var y=0,A=s;y!==A;++y)o[y].push(new Wr(m,i[y],a[y]))}else if(u<r){c=t[u];var M=--r,N=t[M];for(n[N.uuid]=u,t[u]=N,n[g]=M,t[M]=m,y=0,A=s;y!==A;++y){var j=o[y],k=j[M],ot=j[u];j[u]=k,ot===void 0&&(ot=new Wr(m,i[y],a[y])),j[M]=ot}}else t[u]!==c&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,i=n.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],c=s.uuid,l=r[c];if(l!==void 0&&l>=e){var h=e++,m=t[h];r[m.uuid]=l,t[l]=m,r[c]=h,t[h]=s;for(var g=0,u=i;g!==u;++g){var y=n[g],A=y[h],M=y[l];y[l]=A,y[h]=M}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,a=i.length,o=0,s=arguments.length;o!==s;++o){var c=arguments[o],l=c.uuid,h=n[l];if(h!==void 0)if(delete n[l],h<r){var m=--r,g=t[m],u=t[j=--e];n[g.uuid]=h,t[h]=g,n[u.uuid]=m,t[m]=u,t.pop();for(var y=0,A=a;y!==A;++y){var M=(k=i[y])[m],N=k[j];k[h]=M,k[m]=N,k.pop()}}else{var j;for(n[(u=t[j=--e]).uuid]=h,t[h]=u,t.pop(),y=0,A=a;y!==A;++y){var k;(k=i[y])[h]=k[j],k.pop()}}}this.nCachedObjects_=r},subscribe_:function(t,e){var r=this._bindingsIndicesByPath,n=r[t],i=this._bindings;if(n!==void 0)return i[n];var a=this._paths,o=this._parsedPaths,s=this._objects,c=s.length,l=this.nCachedObjects_,h=new Array(c);n=i.length,r[t]=n,a.push(t),o.push(e),i.push(h);for(var m=l,g=s.length;m!==g;++m){var u=s[m];h[m]=new Wr(u,t,e)}return h},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,r=e[t];if(r!==void 0){var n=this._paths,i=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];e[t[o]]=r,a[r]=s,a.pop(),i[r]=i[o],i.pop(),n[r]=n[o],n.pop()}}}),Object.assign(rp.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,r){if(t.fadeOut(e),this.fadeIn(e),r){var n=this._clip.duration,i=t._clip.duration,a=i/n,o=n/i;t.warp(1,a,e),this.warp(o,1,e)}return this},crossFadeTo:function(t,e,r){return t.crossFadeFrom(this,e,r)},stopFading:function(){var t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,r){var n=this._mixer,i=n.time,a=this._timeScaleInterpolant,o=this.timeScale;a===null&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,c=a.sampleValues;return s[0]=i,s[1]=i+r,c[0]=t/o,c[1]=e/o,this},stopWarping:function(){var t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,r,n){if(this.enabled){var i=this._startTime;if(i!==null){var a=(t-i)*r;if(a<0||r===0)return;this._startTime=null,e=r*a}e*=this._updateTimeScale(t);var o=this._updateTime(e),s=this._updateWeight(t);if(s>0){var c=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case bl:for(var h=0,m=c.length;h!==m;++h)c[h].evaluate(o),l[h].accumulateAdditive(s);break;case Bs:default:for(h=0,m=c.length;h!==m;++h)c[h].evaluate(o),l[h].accumulate(n,s)}}}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var r=this._weightInterpolant;if(r!==null){var n=r.evaluate(t)[0];e*=n,t>r.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var r=this._timeScaleInterpolant;r!==null&&(e*=r.evaluate(t)[0],t>r.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t,r=this._clip.duration,n=this.loop,i=this._loopCount,a=n===Dh;if(t===0)return i===-1?e:a&&(1&i)==1?r-e:e;if(n===Ch){i===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=r)e=r;else{if(!(e<0)){this.time=e;break t}e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(i===-1&&(t>=0?(i=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),e>=r||e<0){var o=Math.floor(e/r);e-=r*o,i+=Math.abs(o);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?r:0,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(s===1){var c=t<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this.time=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=e;if(a&&(1&i)==1)return r-e}return e},_setEndings:function(t,e,r){var n=this._interpolantSettings;r?(n.endingStart=Ci,n.endingEnd=Ci):(n.endingStart=t?this.zeroSlopeAtStart?Ci:Pi:To,n.endingEnd=e?this.zeroSlopeAtEnd?Ci:Pi:To)},_scheduleFading:function(t,e,r){var n=this._mixer,i=n.time,a=this._weightInterpolant;a===null&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=i,s[0]=e,o[1]=i+t,s[1]=r,this}}),Ru.prototype=Object.assign(Object.create(Fn.prototype),{constructor:Ru,_bindAction:function(t,e){var r=t._localRoot||this._root,n=t._clip.tracks,i=n.length,a=t._propertyBindings,o=t._interpolants,s=r.uuid,c=this._bindingsByRootAndName,l=c[s];l===void 0&&(l={},c[s]=l);for(var h=0;h!==i;++h){var m=n[h],g=m.name,u=l[g];if(u!==void 0)a[h]=u;else{if((u=a[h])!==void 0){u._cacheIndex===null&&(++u.referenceCount,this._addInactiveBinding(u,s,g));continue}var y=e&&e._propertyBindings[h].binding.parsedPath;++(u=new Lu(Wr.create(r,g,y),m.ValueTypeName,m.getValueSize())).referenceCount,this._addInactiveBinding(u,s,g),a[h]=u}o[h].resultBuffer=u.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){var e=(t._localRoot||this._root).uuid,r=t._clip.uuid,n=this._actionsByClip[r];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,r,e)}for(var i=t._propertyBindings,a=0,o=i.length;a!==o;++a){var s=i[a];s.useCount++==0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];--i.useCount==0&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return e!==null&&e<this._nActiveActions},_addInactiveAction:function(t,e,r){var n=this._actions,i=this._actionsByClip,a=i[e];if(a===void 0)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=a;else{var o=a.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=n.length,n.push(t),a.actionByRoot[r]=t},_removeInactiveAction:function(t){var e=this._actions,r=e[e.length-1],n=t._cacheIndex;r._cacheIndex=n,e[n]=r,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,a=this._actionsByClip,o=a[i],s=o.knownActions,c=s[s.length-1],l=t._byClipCacheIndex;c._byClipCacheIndex=l,s[l]=c,s.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],s.length===0&&delete a[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];--i.referenceCount==0&&this._removeInactiveBinding(i)}},_lendAction:function(t){var e=this._actions,r=t._cacheIndex,n=this._nActiveActions++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackAction:function(t){var e=this._actions,r=t._cacheIndex,n=--this._nActiveActions,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_addInactiveBinding:function(t,e,r){var n=this._bindingsByRootAndName,i=n[e],a=this._bindings;i===void 0&&(i={},n[e]=i),i[r]=t,t._cacheIndex=a.length,a.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,r=t.binding,n=r.rootNode.uuid,i=r.path,a=this._bindingsByRootAndName,o=a[n],s=e[e.length-1],c=t._cacheIndex;s._cacheIndex=c,e[c]=s,e.pop(),delete o[i],Object.keys(o).length===0&&delete a[n]},_lendBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,r=t[e];return r===void 0&&((r=new ys(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=r),r},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,i=e[n];t.__cacheIndex=n,e[n]=t,i.__cacheIndex=r,e[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,r){var n=e||this._root,i=n.uuid,a=typeof t=="string"?pn.findByName(n,t):t,o=a!==null?a.uuid:t,s=this._actionsByClip[o],c=null;if(r===void 0&&(r=a!==null?a.blendMode:Bs),s!==void 0){var l=s.actionByRoot[i];if(l!==void 0&&l.blendMode===r)return l;c=s.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;var h=new rp(this,a,e,r);return this._bindAction(h,c),this._addInactiveAction(h,o,i),h},existingAction:function(t,e){var r=e||this._root,n=r.uuid,i=typeof t=="string"?pn.findByName(r,t):t,a=i?i.uuid:t,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[n]||null},stopAllAction:function(){for(var t=this._actions,e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this},update:function(t){t*=this.timeScale;for(var e=this._actions,r=this._nActiveActions,n=this.time+=t,i=Math.sign(t),a=this._accuIndex^=1,o=0;o!==r;++o)e[o]._update(n,t,i,a);var s=this._bindings,c=this._nActiveBindings;for(o=0;o!==c;++o)s[o].apply(a);return this},setTime:function(t){this.time=0;for(var e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,r=t.uuid,n=this._actionsByClip,i=n[r];if(i!==void 0){for(var a=i.knownActions,o=0,s=a.length;o!==s;++o){var c=a[o];this._deactivateAction(c);var l=c._cacheIndex,h=e[e.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=l,e[l]=h,e.pop(),this._removeInactiveBindingsForAction(c)}delete n[r]}},uncacheRoot:function(t){var e=t.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot[e];i!==void 0&&(this._deactivateAction(i),this._removeInactiveAction(i))}var a=this._bindingsByRootAndName[e];if(a!==void 0)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(t,e){var r=this.existingAction(t,e);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),Yc.prototype.clone=function(){return new Yc(this.value.clone===void 0?this.value:this.value.clone())},Pu.prototype=Object.assign(Object.create(ii.prototype),{constructor:Pu,isInstancedInterleavedBuffer:!0,copy:function(t){return ii.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(Cu.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,r){var n=r||[];return Ou(t,this,n,e),n.sort(np),n},intersectObjects:function(t,e,r){var n=r||[];if(Array.isArray(t)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,a=t.length;i<a;i++)Ou(t[i],this,n,e);return n.sort(np),n}}),Object.assign(ip.prototype,{set:function(t,e,r){return this.radius=t,this.phi=e,this.theta=r,this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,r){return this.radius=Math.sqrt(t*t+e*e+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,r),this.phi=Math.acos(We.clamp(e/this.radius,-1,1))),this}}),Object.assign(ap.prototype,{set:function(t,e,r){return this.radius=t,this.theta=e,this.y=r,this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,r){return this.radius=Math.sqrt(t*t+r*r),this.theta=Math.atan2(t,r),this.y=e,this}});var op=new Wt;function Du(t,e){this.min=t!==void 0?t:new Wt(1/0,1/0),this.max=e!==void 0?e:new Wt(-1/0,-1/0)}Object.assign(Du.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){var r=op.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return t===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Wt),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return t===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Wt),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return e===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Wt),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return e===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Wt),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return op.copy(t).clamp(this.min,this.max).sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var sp=new q,Zc=new q;function Iu(t,e){this.start=t!==void 0?t:new q,this.end=e!==void 0?e:new q}function Ms(t){ge.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}Object.assign(Iu.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return t===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new q),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return t===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),t=new q),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return e===void 0&&(console.warn("THREE.Line3: .at() target is now required"),e=new q),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,e){sp.subVectors(t,this.start),Zc.subVectors(this.end,this.start);var r=Zc.dot(Zc),n=Zc.dot(sp)/r;return e&&(n=We.clamp(n,0,1)),n},closestPointToPoint:function(t,e,r){var n=this.closestPointToPointParameter(t,e);return r===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new q),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),Ms.prototype=Object.create(ge.prototype),Ms.prototype.constructor=Ms,Ms.prototype.isImmediateRenderObject=!0;var cp=new q;function po(t,e){ge.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var r=new _e,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,a=1;i<32;i++,a++){var o=i/32*Math.PI*2,s=a/32*Math.PI*2;n.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}r.setAttribute("position",new pe(n,3));var c=new wr({fog:!1,toneMapped:!1});this.cone=new Mr(r,c),this.add(this.cone),this.update()}po.prototype=Object.create(ge.prototype),po.prototype.constructor=po,po.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},po.prototype.update=function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),cp.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(cp),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var Ai=new q,Jc=new Xe,Nu=new Xe;function ua(t){for(var e=function h(m){var g=[];m&&m.isBone&&g.push(m);for(var u=0;u<m.children.length;u++)g.push.apply(g,h(m.children[u]));return g}(t),r=new _e,n=[],i=[],a=new we(0,0,1),o=new we(0,1,0),s=0;s<e.length;s++){var c=e[s];c.parent&&c.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(a.r,a.g,a.b),i.push(o.r,o.g,o.b))}r.setAttribute("position",new pe(n,3)),r.setAttribute("color",new pe(i,3));var l=new wr({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});Mr.call(this,r,l),this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function fo(t,e,r){this.light=t,this.light.updateMatrixWorld(),this.color=r;var n=new Yi(e,4,2),i=new hn({wireframe:!0,fog:!1,toneMapped:!1});br.call(this,n,i),this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}ua.prototype=Object.create(Mr.prototype),ua.prototype.constructor=ua,ua.prototype.isSkeletonHelper=!0,ua.prototype.updateMatrixWorld=function(t){var e=this.bones,r=this.geometry,n=r.getAttribute("position");Nu.getInverse(this.root.matrixWorld);for(var i=0,a=0;i<e.length;i++){var o=e[i];o.parent&&o.parent.isBone&&(Jc.multiplyMatrices(Nu,o.matrixWorld),Ai.setFromMatrixPosition(Jc),n.setXYZ(a,Ai.x,Ai.y,Ai.z),Jc.multiplyMatrices(Nu,o.parent.matrixWorld),Ai.setFromMatrixPosition(Jc),n.setXYZ(a+1,Ai.x,Ai.y,Ai.z),a+=2)}r.getAttribute("position").needsUpdate=!0,ge.prototype.updateMatrixWorld.call(this,t)},fo.prototype=Object.create(br.prototype),fo.prototype.constructor=fo,fo.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},fo.prototype.update=function(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var iv=new q,lp=new we,up=new we;function mo(t,e,r){ge.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new Wi(e);n.rotateY(.5*Math.PI),this.material=new hn({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);var i=n.getAttribute("position"),a=new Float32Array(3*i.count);n.setAttribute("color",new Ie(a,3)),this.add(new br(n,this.material)),this.update()}function Kc(t,e,r,n){t=t||10,e=e||10,r=new we(r!==void 0?r:4473924),n=new we(n!==void 0?n:8947848);for(var i=e/2,a=t/e,o=t/2,s=[],c=[],l=0,h=0,m=-o;l<=e;l++,m+=a){s.push(-o,0,m,o,0,m),s.push(m,0,-o,m,0,o);var g=l===i?r:n;g.toArray(c,h),h+=3,g.toArray(c,h),h+=3,g.toArray(c,h),h+=3,g.toArray(c,h),h+=3}var u=new _e;u.setAttribute("position",new pe(s,3)),u.setAttribute("color",new pe(c,3));var y=new wr({vertexColors:!0,toneMapped:!1});Mr.call(this,u,y),this.type="GridHelper"}function Qc(t,e,r,n,i,a){t=t||10,e=e||16,r=r||8,n=n||64,i=new we(i!==void 0?i:4473924),a=new we(a!==void 0?a:8947848);var o,s,c,l,h,m,g,u=[],y=[];for(l=0;l<=e;l++)c=l/e*(2*Math.PI),o=Math.sin(c)*t,s=Math.cos(c)*t,u.push(0,0,0),u.push(o,0,s),g=1&l?i:a,y.push(g.r,g.g,g.b),y.push(g.r,g.g,g.b);for(l=0;l<=r;l++)for(g=1&l?i:a,m=t-t/r*l,h=0;h<n;h++)c=h/n*(2*Math.PI),o=Math.sin(c)*m,s=Math.cos(c)*m,u.push(o,0,s),y.push(g.r,g.g,g.b),c=(h+1)/n*(2*Math.PI),o=Math.sin(c)*m,s=Math.cos(c)*m,u.push(o,0,s),y.push(g.r,g.g,g.b);var A=new _e;A.setAttribute("position",new pe(u,3)),A.setAttribute("color",new pe(y,3));var M=new wr({vertexColors:!0,toneMapped:!1});Mr.call(this,A,M),this.type="PolarGridHelper"}mo.prototype=Object.create(ge.prototype),mo.prototype.constructor=mo,mo.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},mo.prototype.update=function(){var t=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{var e=t.geometry.getAttribute("color");lp.copy(this.light.color),up.copy(this.light.groundColor);for(var r=0,n=e.count;r<n;r++){var i=r<n/2?lp:up;e.setXYZ(r,i.r,i.g,i.b)}e.needsUpdate=!0}t.lookAt(iv.setFromMatrixPosition(this.light.matrixWorld).negate())},Kc.prototype=Object.assign(Object.create(Mr.prototype),{constructor:Kc,copy:function(t){return Mr.prototype.copy.call(this,t),this.geometry.copy(t.geometry),this.material.copy(t.material),this},clone:function(){return new this.constructor().copy(this)}}),Qc.prototype=Object.create(Mr.prototype),Qc.prototype.constructor=Qc;var hp=new q,$c=new q,dp=new q;function vo(t,e,r){ge.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,e===void 0&&(e=1);var n=new _e;n.setAttribute("position",new pe([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var i=new wr({fog:!1,toneMapped:!1});this.lightPlane=new cn(n,i),this.add(this.lightPlane),(n=new _e).setAttribute("position",new pe([0,0,0,0,0,1],3)),this.targetLine=new cn(n,i),this.add(this.targetLine),this.update()}vo.prototype=Object.create(ge.prototype),vo.prototype.constructor=vo,vo.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},vo.prototype.update=function(){hp.setFromMatrixPosition(this.light.matrixWorld),$c.setFromMatrixPosition(this.light.target.matrixWorld),dp.subVectors($c,hp),this.lightPlane.lookAt($c),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt($c),this.targetLine.scale.z=dp.length()};var tl=new q,Er=new Vn;function Ss(t){var e=new _e,r=new wr({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],i=[],a={},o=new we(16755200),s=new we(16711680),c=new we(43775),l=new we(16777215),h=new we(3355443);function m(u,y,A){g(u,A),g(y,A)}function g(u,y){n.push(0,0,0),i.push(y.r,y.g,y.b),a[u]===void 0&&(a[u]=[]),a[u].push(n.length/3-1)}m("n1","n2",o),m("n2","n4",o),m("n4","n3",o),m("n3","n1",o),m("f1","f2",o),m("f2","f4",o),m("f4","f3",o),m("f3","f1",o),m("n1","f1",o),m("n2","f2",o),m("n3","f3",o),m("n4","f4",o),m("p","n1",s),m("p","n2",s),m("p","n3",s),m("p","n4",s),m("u1","u2",c),m("u2","u3",c),m("u3","u1",c),m("c","t",l),m("p","c",h),m("cn1","cn2",h),m("cn3","cn4",h),m("cf1","cf2",h),m("cf3","cf4",h),e.setAttribute("position",new pe(n,3)),e.setAttribute("color",new pe(i,3)),Mr.call(this,e,r),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function Ar(t,e,r,n,i,a,o){tl.set(i,a,o).unproject(n);var s=e[t];if(s!==void 0)for(var c=r.getAttribute("position"),l=0,h=s.length;l<h;l++)c.setXYZ(s[l],tl.x,tl.y,tl.z)}Ss.prototype=Object.create(Mr.prototype),Ss.prototype.constructor=Ss,Ss.prototype.update=function(){var t=this.geometry,e=this.pointMap;Er.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ar("c",e,t,Er,0,0,-1),Ar("t",e,t,Er,0,0,1),Ar("n1",e,t,Er,-1,-1,-1),Ar("n2",e,t,Er,1,-1,-1),Ar("n3",e,t,Er,-1,1,-1),Ar("n4",e,t,Er,1,1,-1),Ar("f1",e,t,Er,-1,-1,1),Ar("f2",e,t,Er,1,-1,1),Ar("f3",e,t,Er,-1,1,1),Ar("f4",e,t,Er,1,1,1),Ar("u1",e,t,Er,.7,1.1,-1),Ar("u2",e,t,Er,-.7,1.1,-1),Ar("u3",e,t,Er,0,2,-1),Ar("cf1",e,t,Er,-1,0,1),Ar("cf2",e,t,Er,1,0,1),Ar("cf3",e,t,Er,0,-1,1),Ar("cf4",e,t,Er,0,1,1),Ar("cn1",e,t,Er,-1,0,-1),Ar("cn2",e,t,Er,1,0,-1),Ar("cn3",e,t,Er,0,-1,-1),Ar("cn4",e,t,Er,0,1,-1),t.getAttribute("position").needsUpdate=!0};var el=new Mn;function li(t,e){this.object=t,e===void 0&&(e=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new _e;i.setIndex(new Ie(r,1)),i.setAttribute("position",new Ie(n,3)),Mr.call(this,i,new wr({color:e,toneMapped:!1})),this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}function Ts(t,e){this.type="Box3Helper",this.box=t,e=e||16776960;var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new _e;n.setIndex(new Ie(r,1)),n.setAttribute("position",new pe([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Mr.call(this,n,new wr({color:e,toneMapped:!1})),this.type="Box3Helper",this.geometry.computeBoundingSphere()}function Es(t,e,r){this.plane=t,this.size=e===void 0?1:e;var n=r!==void 0?r:16776960,i=new _e;i.setAttribute("position",new pe([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),cn.call(this,i,new wr({color:n,toneMapped:!1})),this.type="PlaneHelper";var a=new _e;a.setAttribute("position",new pe([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new br(a,new hn({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}li.prototype=Object.create(Mr.prototype),li.prototype.constructor=li,li.prototype.update=function(t){if(t!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&el.setFromObject(this.object),!el.isEmpty()){var e=el.min,r=el.max,n=this.geometry.attributes.position,i=n.array;i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=e.x,i[4]=r.y,i[5]=r.z,i[6]=e.x,i[7]=e.y,i[8]=r.z,i[9]=r.x,i[10]=e.y,i[11]=r.z,i[12]=r.x,i[13]=r.y,i[14]=e.z,i[15]=e.x,i[16]=r.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=r.x,i[22]=e.y,i[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}},li.prototype.setFromObject=function(t){return this.object=t,this.update(),this},li.prototype.copy=function(t){return Mr.prototype.copy.call(this,t),this.object=t.object,this},li.prototype.clone=function(){return new this.constructor().copy(this)},Ts.prototype=Object.create(Mr.prototype),Ts.prototype.constructor=Ts,Ts.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),ge.prototype.updateMatrixWorld.call(this,t))},Es.prototype=Object.create(cn.prototype),Es.prototype.constructor=Es,Es.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?x:ut,this.lookAt(this.plane.normal),ge.prototype.updateMatrixWorld.call(this,t)};var Bu,pp,fp=new q;function ui(t,e,r,n,i,a){ge.call(this),this.type="ArrowHelper",t===void 0&&(t=new q(0,0,1)),e===void 0&&(e=new q(0,0,0)),r===void 0&&(r=1),n===void 0&&(n=16776960),i===void 0&&(i=.2*r),a===void 0&&(a=.2*i),Bu===void 0&&((Bu=new _e).setAttribute("position",new pe([0,0,0,0,1,0],3)),(pp=new oi(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new cn(Bu,new wr({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new br(pp,new hn({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,i,a)}function As(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=new _e;r.setAttribute("position",new pe(e,3)),r.setAttribute("color",new pe([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new wr({vertexColors:!0,toneMapped:!1});Mr.call(this,r,n),this.type="AxesHelper"}ui.prototype=Object.create(ge.prototype),ui.prototype.constructor=ui,ui.prototype.setDirection=function(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{fp.set(t.z,0,-t.x).normalize();var e=Math.acos(t.y);this.quaternion.setFromAxisAngle(fp,e)}},ui.prototype.setLength=function(t,e,r){e===void 0&&(e=.2*t),r===void 0&&(r=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(r,e,r),this.cone.position.y=t,this.cone.updateMatrix()},ui.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},ui.prototype.copy=function(t){return ge.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},ui.prototype.clone=function(){return new this.constructor().copy(this)},As.prototype=Object.create(Mr.prototype),As.prototype.constructor=As;var Yn=Math.pow(2,8),mp=[.125,.215,.35,.446,.526,.582],vp=5+mp.length,Zn={[Yr]:0,[Eo]:1,[Us]:2,[wl]:3,[_l]:4,[Ml]:5,[Fs]:6},Fu=new uo,{_lodPlanes:Ls,_sizeLods:gp,_sigmas:rl}=function(){for(var t=[],e=[],r=[],n=8,i=0;i<vp;i++){var a=Math.pow(2,n);e.push(a);var o=1/a;i>4?o=mp[i-8+4-1]:i==0&&(o=0),r.push(o);for(var s=1/(a-1),c=-s/2,l=1+s/2,h=[c,c,l,c,l,l,c,c,l,l,c,l],m=new Float32Array(108),g=new Float32Array(72),u=new Float32Array(36),y=0;y<6;y++){var A=y%3*2/3-1,M=y>2?0:-1,N=[A,M,0,A+2/3,M,0,A+2/3,M+1,0,A,M,0,A+2/3,M+1,0,A,M+1,0];m.set(N,18*y),g.set(h,12*y);var j=[y,y,y,y,y,y];u.set(j,6*y)}var k=new _e;k.setAttribute("position",new Ie(m,3)),k.setAttribute("uv",new Ie(g,2)),k.setAttribute("faceIndex",new Ie(u,1)),t.push(k),n>4&&n--}return{_lodPlanes:t,_sizeLods:e,_sigmas:r}}(),Uu=null,ha=(1+Math.sqrt(5))/2,go=1/ha,yp=[new q(1,1,1),new q(-1,1,1),new q(1,1,-1),new q(-1,1,-1),new q(0,ha,go),new q(0,ha,-go),new q(go,0,ha),new q(-go,0,ha),new q(ha,go,0),new q(-ha,go,0)];function zu(t){var e,r,n,i;this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=(e=20,r=new Float32Array(e),n=new q(0,1,0),(i=new si({defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:Zn[Yr]},outputEncoding:{value:Zn[Yr]}},vertexShader:Vu(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform int samples;
uniform float weights[n];
uniform bool latitudinal;
uniform float dTheta;
uniform float mipInt;
uniform vec3 poleAxis;

${ku()}

#define ENVMAP_TYPE_CUBE_UV
#include <cube_uv_reflection_fragment>

vec3 getSample(float theta, vec3 axis) {
	float cosTheta = cos(theta);
	// Rodrigues' axis-angle rotation
	vec3 sampleDirection = vOutputDirection * cosTheta
		+ cross(axis, vOutputDirection) * sin(theta)
		+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);
	return bilinearCubeUV(envMap, sampleDirection, mipInt);
}

void main() {
	vec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);
	if (all(equal(axis, vec3(0.0))))
		axis = vec3(vOutputDirection.z, 0.0, - vOutputDirection.x);
	axis = normalize(axis);
	gl_FragColor = vec4(0.0);
	gl_FragColor.rgb += weights[0] * getSample(0.0, axis);
	for (int i = 1; i < n; i++) {
		if (i >= samples)
			break;
		float theta = dTheta * float(i);
		gl_FragColor.rgb += weights[i] * getSample(-1.0 * theta, axis);
		gl_FragColor.rgb += weights[i] * getSample(theta, axis);
	}
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:pt,depthTest:!1,depthWrite:!1})).type="SphericalGaussianBlur",i),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}function av(t){return t!==void 0&&t.type===He&&(t.encoding===Yr||t.encoding===Eo||t.encoding===Fs)}function xp(t){var e=new nn(3*Yn,3*Yn,t);return e.texture.mapping=d,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Gu(t,e,r,n,i){t.viewport.set(e,r,n,i),t.scissor.set(e,r,n,i)}function bp(){var t=new si({uniforms:{envMap:{value:null},texelSize:{value:new Wt(1,1)},inputEncoding:{value:Zn[Yr]},outputEncoding:{value:Zn[Yr]}},vertexShader:Vu(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform vec2 texelSize;

${ku()}

#include <common>

void main() {
	gl_FragColor = vec4(0.0);
	vec3 outputDirection = normalize(vOutputDirection);
	vec2 uv = equirectUv( outputDirection );
	vec2 f = fract(uv / texelSize - 0.5);
	uv -= f * texelSize;
	vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x += texelSize.x;
	vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.y += texelSize.y;
	vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x -= texelSize.x;
	vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	vec3 tm = mix(tl, tr, f.x);
	vec3 bm = mix(bl, br, f.x);
	gl_FragColor.rgb = mix(tm, bm, f.y);
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:pt,depthTest:!1,depthWrite:!1});return t.type="EquirectangularToCubeUV",t}function wp(){var t=new si({uniforms:{envMap:{value:null},inputEncoding:{value:Zn[Yr]},outputEncoding:{value:Zn[Yr]}},vertexShader:Vu(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform samplerCube envMap;

${ku()}

void main() {
	gl_FragColor = vec4(0.0);
	gl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:pt,depthTest:!1,depthWrite:!1});return t.type="CubemapToCubeUV",t}function Vu(){return`
precision mediump float;
precision mediump int;
attribute vec3 position;
attribute vec2 uv;
attribute float faceIndex;
varying vec3 vOutputDirection;

// RH coordinate system; PMREM face-indexing convention
vec3 getDirection(vec2 uv, float face) {
	uv = 2.0 * uv - 1.0;
	vec3 direction = vec3(uv, 1.0);
	if (face == 0.0) {
		direction = direction.zyx; // ( 1, v, u ) pos x
	} else if (face == 1.0) {
		direction = direction.xzy;
		direction.xz *= -1.0; // ( -u, 1, -v ) pos y
	} else if (face == 2.0) {
		direction.x *= -1.0; // ( -u, v, 1 ) pos z
	} else if (face == 3.0) {
		direction = direction.zyx;
		direction.xz *= -1.0; // ( -1, v, -u ) neg x
	} else if (face == 4.0) {
		direction = direction.xzy;
		direction.xy *= -1.0; // ( -u, -1, v ) neg y
	} else if (face == 5.0) {
		direction.z *= -1.0; // ( u, v, -1 ) neg z
	}
	return direction;
}

void main() {
	vOutputDirection = getDirection(uv, faceIndex);
	gl_Position = vec4( position, 1.0 );
}
	`}function ku(){return`
uniform int inputEncoding;
uniform int outputEncoding;

#include <encodings_pars_fragment>

vec4 inputTexelToLinear(vec4 value){
	if(inputEncoding == 0){
		return value;
	}else if(inputEncoding == 1){
		return sRGBToLinear(value);
	}else if(inputEncoding == 2){
		return RGBEToLinear(value);
	}else if(inputEncoding == 3){
		return RGBMToLinear(value, 7.0);
	}else if(inputEncoding == 4){
		return RGBMToLinear(value, 16.0);
	}else if(inputEncoding == 5){
		return RGBDToLinear(value, 256.0);
	}else{
		return GammaToLinear(value, 2.2);
	}
}

vec4 linearToOutputTexel(vec4 value){
	if(outputEncoding == 0){
		return value;
	}else if(outputEncoding == 1){
		return LinearTosRGB(value);
	}else if(outputEncoding == 2){
		return LinearToRGBE(value);
	}else if(outputEncoding == 3){
		return LinearToRGBM(value, 7.0);
	}else if(outputEncoding == 4){
		return LinearToRGBM(value, 16.0);
	}else if(outputEncoding == 5){
		return LinearToRGBD(value, 256.0);
	}else{
		return LinearToGamma(value, 2.2);
	}
}

vec4 envMapTexelToLinear(vec4 color) {
	return inputTexelToLinear(color);
}
	`}function ov(t,e,r,n,i,a,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new La(t,e,r,i,a,o)}zu.prototype={constructor:zu,fromScene:function(t,e=0,r=.1,n=100){Uu=this._renderer.getRenderTarget();var i=this._allocateTargets();return this._sceneToCubeUV(t,r,n,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i},fromEquirectangular:function(t){return t.magFilter=it,t.minFilter=it,t.generateMipmaps=!1,this.fromCubemap(t)},fromCubemap:function(t){Uu=this._renderer.getRenderTarget();var e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e},compileCubemapShader:function(){this._cubemapShader===null&&(this._cubemapShader=wp(),this._compileMaterial(this._cubemapShader))},compileEquirectangularShader:function(){this._equirectShader===null&&(this._equirectShader=bp(),this._compileMaterial(this._equirectShader))},dispose:function(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(var t=0;t<Ls.length;t++)Ls[t].dispose()},_cleanup:function(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Uu),t.scissorTest=!1,t.setSize(t.width,t.height)},_allocateTargets:function(t){var e={magFilter:it,minFilter:it,generateMipmaps:!1,type:He,format:Yu,encoding:av(t)?t.encoding:Us,depthBuffer:!1,stencilBuffer:!1},r=xp(e);return r.depthBuffer=!t,this._pingPongRenderTarget=xp(e),r},_compileMaterial:function(t){var e=new br(Ls[0],t);this._renderer.compile(e,Fu)},_sceneToCubeUV:function(t,e,r,n){var i=new Or(90,1,e,r),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,c=s.outputEncoding,l=s.toneMapping,h=s.toneMappingExposure,m=s.getClearColor(),g=s.getClearAlpha();s.toneMapping=H,s.toneMappingExposure=1,s.outputEncoding=Yr;var u=t.background;if(u&&u.isColor){u.convertSRGBToLinear();var y=Math.max(u.r,u.g,u.b),A=Math.min(Math.max(Math.ceil(Math.log2(y)),-128),127);u=u.multiplyScalar(Math.pow(2,-A));var M=(A+128)/255;s.setClearColor(u,M),t.background=null}for(var N=0;N<6;N++){var j=N%3;j==0?(i.up.set(0,a[N],0),i.lookAt(o[N],0,0)):j==1?(i.up.set(0,0,a[N]),i.lookAt(0,o[N],0)):(i.up.set(0,a[N],0),i.lookAt(0,0,o[N])),Gu(n,j*Yn,N>2?Yn:0,Yn,Yn),s.setRenderTarget(n),s.render(t,i)}s.toneMapping=l,s.toneMappingExposure=h,s.outputEncoding=c,s.setClearColor(m,g)},_textureToCubeUV:function(t,e){var r=this._renderer;t.isCubeTexture?this._cubemapShader==null&&(this._cubemapShader=wp()):this._equirectShader==null&&(this._equirectShader=bp());var n=t.isCubeTexture?this._cubemapShader:this._equirectShader,i=new br(Ls[0],n),a=n.uniforms;a.envMap.value=t,t.isCubeTexture||a.texelSize.value.set(1/t.image.width,1/t.image.height),a.inputEncoding.value=Zn[t.encoding],a.outputEncoding.value=Zn[e.texture.encoding],Gu(e,0,0,3*Yn,2*Yn),r.setRenderTarget(e),r.render(i,Fu)},_applyPMREM:function(t){var e=this._renderer,r=e.autoClear;e.autoClear=!1;for(var n=1;n<vp;n++){var i=Math.sqrt(rl[n]*rl[n]-rl[n-1]*rl[n-1]),a=yp[(n-1)%yp.length];this._blur(t,n-1,n,i,a)}e.autoClear=r},_blur:function(t,e,r,n,i){var a=this._pingPongRenderTarget;this._halfBlur(t,a,e,r,n,"latitudinal",i),this._halfBlur(a,t,r,r,n,"longitudinal",i)},_halfBlur:function(t,e,r,n,i,a,o){var s=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");var l=new br(Ls[n],c),h=c.uniforms,m=gp[r]-1,g=isFinite(i)?Math.PI/(2*m):2*Math.PI/39,u=i/g,y=isFinite(i)?1+Math.floor(3*u):20;y>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${y} samples when the maximum is set to 20`);for(var A=[],M=0,N=0;N<20;++N){var j=N/u,k=Math.exp(-j*j/2);A.push(k),N==0?M+=k:N<y&&(M+=2*k)}for(N=0;N<A.length;N++)A[N]=A[N]/M;h.envMap.value=t.texture,h.samples.value=y,h.weights.value=A,h.latitudinal.value=a==="latitudinal",o&&(h.poleAxis.value=o),h.dTheta.value=g,h.mipInt.value=8-r,h.inputEncoding.value=Zn[t.texture.encoding],h.outputEncoding.value=Zn[t.texture.encoding];var ot=gp[n];Gu(e,j=3*Math.max(0,Yn-2*ot),(n===0?0:2*Yn)+2*ot*(n>4?n-8+4:0),3*ot,2*ot),s.setRenderTarget(e),s.render(l,Fu)}};var sv=0,cv=1,lv=0,uv=1,hv=2;function dv(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function pv(t){return t===void 0&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function fv(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Wa(t,e)}function mv(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Yo(t)}function vv(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Wa(t,e)}function gv(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new An(t)}function yv(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new An(t)}function xv(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new An(t)}function bv(t,e,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new q(t,e,r)}function wv(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Ie(t,e).setUsage(Di)}function _v(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Oo(t,e)}function Mv(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Do(t,e)}function Sv(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Io(t,e)}function Tv(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new No(t,e)}function Ev(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Ui(t,e)}function Av(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Bo(t,e)}function Lv(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new zi(t,e)}function Rv(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new pe(t,e)}function Pv(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Fo(t,e)}function _p(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),jr.call(this,t),this.type="catmullrom",this.closed=!0}function Mp(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),jr.call(this,t),this.type="catmullrom"}function Hu(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),jr.call(this,t),this.type="catmullrom"}function Cv(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new As(t)}function Ov(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new li(t,e)}function Dv(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Mr(new io(t.geometry),new wr({color:e!==void 0?e:16777215}))}function Iv(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Mr(new Xa(t.geometry),new wr({color:e!==void 0?e:16777215}))}function Nv(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new fn(t)}function Bv(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Rc(t)}function Fv(t,e,r){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Vi(t,r)}Re.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Re.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(ci.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var e=new Be,r=0,n=t.length;r<n;r++){var i=t[r];e.vertices.push(new q(i.x,i.y,i.z||0))}return e}}),Object.assign(Dn.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),_p.prototype=Object.create(jr.prototype),Mp.prototype=Object.create(jr.prototype),Hu.prototype=Object.create(jr.prototype),Object.assign(Hu.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Kc.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},ua.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(rr.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),mu.extractUrlBase(t)}}),rr.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Wc.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}),Object.assign(Du.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Mn.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Un.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Ba.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Iu.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(We,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),We.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),We.ceilPowerOfTwo(t)}}),Object.assign(kr.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Xe.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new q().setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,r,n,i,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,r,i,a)}}),Sn.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Ir.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(Fi.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(Fr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(Fr,{barycoordFromPoint:function(t,e,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Fr.getBarycoord(t,e,r,n,i)},normal:function(t,e,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Fr.getNormal(t,e,r,n)}}),Object.assign(Ei.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Xi(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Zi(this,t)}}),Object.assign(Wt.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(q.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(er.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Be.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(ge.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(ge.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(br.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(br.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Ih},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Zo.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(uc.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),lc.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Re.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),Or.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(vr.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(Ie.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Di},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Di)}}}),Object.assign(Ie.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(t===!0?Di:Ao),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(_e.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?t==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new Ie(arguments[1],arguments[2])))},addDrawCall:function(t,e,r){r!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(_e.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(_s.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(Cu.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(ii.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Di},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(ii.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(t===!0?Di:Ao),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Hn.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Yc.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Ne.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new we}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===U}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(Ti.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Zr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(Yl.prototype,{clearTarget:function(t,e,r,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,r,n)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Yl.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=t===!0?Eo:Yr}}}),Object.defineProperties(_d.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(nn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(ho.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return new Xc().load(t,function(r){e.setBuffer(r)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Au.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Ia.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};var Uv={merge:function(t,e,r){var n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),n=e.matrix,e=e.geometry),t.merge(e,n,r)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};function zv(){console.error("THREE.CanvasRenderer has been removed")}function Gv(){console.error("THREE.JSONLoader has been removed.")}di.crossOrigin=void 0,di.loadTexture=function(t,e,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new Cc;i.setCrossOrigin(this.crossOrigin);var a=i.load(t,r,void 0,n);return e&&(a.mapping=e),a},di.loadTextureCube=function(t,e,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new Pc;i.setCrossOrigin(this.crossOrigin);var a=i.load(t,r,void 0,n);return e&&(a.mapping=e),a},di.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},di.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var Vv={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function kv(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:p}}))},function(ee,v,f){Object.defineProperty(v,"__esModule",{value:!0}),function(G){for(var Y in G)v.hasOwnProperty(Y)||(v[Y]=G[Y])}(f(0));var p=f(10);v.ConvexBufferGeometry=p.ConvexBufferGeometry;var _=f(8);v.FBXLoader=_.FBXLoader;var E=f(2);v.GLTFLoader=E.GLTFLoader;var P=f(3);v.SVGLoader=P.SVGLoader;var w=f(4);v.VRButton=w.VRButton;var T=f(11);v.AnimationAction=T.AnimationAction;var C=f(5);v.Sky=C.Sky;var vt=f(9);v.Water=vt.Water;var Tt=f(6);v.OrbitControls=Tt.OrbitControls;var Pt=f(7);v.WEBGL=Pt.WEBGL},function(ee,v,f){f.r(v),f.d(v,"GLTFLoader",function(){return _});var p=f(0),_=function(){function E(L){p.Loader.call(this,L),this.dracoLoader=null,this.ddsLoader=null}function P(){var L={};return{get:function(I){return L[I]},add:function(I,z){L[I]=z},remove:function(I){delete L[I]},removeAll:function(){L={}}}}E.prototype=Object.assign(Object.create(p.Loader.prototype),{constructor:E,load:function(L,I,z,X){var Z,W=this;Z=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:p.LoaderUtils.extractUrlBase(L),W.manager.itemStart(L);var D=function(ht){X?X(ht):console.error(ht),W.manager.itemError(L),W.manager.itemEnd(L)},H=new p.FileLoader(W.manager);H.setPath(this.path),H.setResponseType("arraybuffer"),H.setRequestHeader(this.requestHeader),W.crossOrigin==="use-credentials"&&H.setWithCredentials(!0),H.load(L,function(ht){try{W.parse(ht,Z,function(F){I(F),W.manager.itemEnd(L)},D)}catch(F){D(F)}},z,D)},setDRACOLoader:function(L){return this.dracoLoader=L,this},setDDSLoader:function(L){return this.ddsLoader=L,this},parse:function(L,I,z,X){var Z,W={};if(typeof L=="string")Z=L;else if(p.LoaderUtils.decodeText(new Uint8Array(L,0,4))===Pt){try{W[w.KHR_BINARY_GLTF]=new at(L)}catch(Et){return void(X&&X(Et))}Z=W[w.KHR_BINARY_GLTF].content}else Z=p.LoaderUtils.decodeText(new Uint8Array(L));var D=JSON.parse(Z);if(D.asset===void 0||D.asset.version[0]<2)X&&X(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{if(D.extensionsUsed)for(var H=0;H<D.extensionsUsed.length;++H){var ht=D.extensionsUsed[H],F=D.extensionsRequired||[];switch(ht){case w.KHR_LIGHTS_PUNCTUAL:W[ht]=new C(D);break;case w.KHR_MATERIALS_CLEARCOAT:W[ht]=new Tt;break;case w.KHR_MATERIALS_UNLIT:W[ht]=new vt;break;case w.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:W[ht]=new U;break;case w.KHR_DRACO_MESH_COMPRESSION:W[ht]=new ut(D,this.dracoLoader);break;case w.MSFT_TEXTURE_DDS:W[ht]=new T(this.ddsLoader);break;case w.KHR_TEXTURE_TRANSFORM:W[ht]=new x;break;case w.KHR_MESH_QUANTIZATION:W[ht]=new O;break;default:F.indexOf(ht)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+ht+'".')}}var Mt=new tt(D,W,{path:I||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});Mt.fileLoader.setRequestHeader(this.requestHeader),Mt.parse(z,X)}}});var w={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function T(L){if(!L)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=w.MSFT_TEXTURE_DDS,this.ddsLoader=L}function C(L){this.name=w.KHR_LIGHTS_PUNCTUAL;var I=L.extensions&&L.extensions[w.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=I.lights||[]}function vt(){this.name=w.KHR_MATERIALS_UNLIT}function Tt(){this.name=w.KHR_MATERIALS_CLEARCOAT}C.prototype.loadLight=function(L){var I,z=this.lightDefs[L],X=new p.Color(16777215);z.color!==void 0&&X.fromArray(z.color);var Z=z.range!==void 0?z.range:0;switch(z.type){case"directional":(I=new p.DirectionalLight(X)).target.position.set(0,0,-1),I.add(I.target);break;case"point":(I=new p.PointLight(X)).distance=Z;break;case"spot":(I=new p.SpotLight(X)).distance=Z,z.spot=z.spot||{},z.spot.innerConeAngle=z.spot.innerConeAngle!==void 0?z.spot.innerConeAngle:0,z.spot.outerConeAngle=z.spot.outerConeAngle!==void 0?z.spot.outerConeAngle:Math.PI/4,I.angle=z.spot.outerConeAngle,I.penumbra=1-z.spot.innerConeAngle/z.spot.outerConeAngle,I.target.position.set(0,0,-1),I.add(I.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+z.type+'".')}return I.position.set(0,0,0),I.decay=2,z.intensity!==void 0&&(I.intensity=z.intensity),I.name=z.name||"light_"+L,Promise.resolve(I)},vt.prototype.getMaterialType=function(){return p.MeshBasicMaterial},vt.prototype.extendParams=function(L,I,z){var X=[];L.color=new p.Color(1,1,1),L.opacity=1;var Z=I.pbrMetallicRoughness;if(Z){if(Array.isArray(Z.baseColorFactor)){var W=Z.baseColorFactor;L.color.fromArray(W),L.opacity=W[3]}Z.baseColorTexture!==void 0&&X.push(z.assignTexture(L,"map",Z.baseColorTexture))}return Promise.all(X)},Tt.prototype.getMaterialType=function(){return p.MeshPhysicalMaterial},Tt.prototype.extendParams=function(L,I,z){var X=[],Z=I.extensions[this.name];if(Z.clearcoatFactor!==void 0&&(L.clearcoat=Z.clearcoatFactor),Z.clearcoatTexture!==void 0&&X.push(z.assignTexture(L,"clearcoatMap",Z.clearcoatTexture)),Z.clearcoatRoughnessFactor!==void 0&&(L.clearcoatRoughness=Z.clearcoatRoughnessFactor),Z.clearcoatRoughnessTexture!==void 0&&X.push(z.assignTexture(L,"clearcoatRoughnessMap",Z.clearcoatRoughnessTexture)),Z.clearcoatNormalTexture!==void 0&&(X.push(z.assignTexture(L,"clearcoatNormalMap",Z.clearcoatNormalTexture)),Z.clearcoatNormalTexture.scale!==void 0)){var W=Z.clearcoatNormalTexture.scale;L.clearcoatNormalScale=new p.Vector2(W,W)}return Promise.all(X)};var Pt="glTF",G=1313821514,Y=5130562;function at(L){this.name=w.KHR_BINARY_GLTF,this.content=null,this.body=null;var I=new DataView(L,0,12);if(this.header={magic:p.LoaderUtils.decodeText(new Uint8Array(L.slice(0,4))),version:I.getUint32(4,!0),length:I.getUint32(8,!0)},this.header.magic!==Pt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var z=new DataView(L,12),X=0;X<z.byteLength;){var Z=z.getUint32(X,!0);X+=4;var W=z.getUint32(X,!0);if(X+=4,W===G){var D=new Uint8Array(L,12+X,Z);this.content=p.LoaderUtils.decodeText(D)}else if(W===Y){var H=12+X;this.body=L.slice(H,H+Z)}X+=Z}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}function ut(L,I){if(!I)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=w.KHR_DRACO_MESH_COMPRESSION,this.json=L,this.dracoLoader=I,this.dracoLoader.preload()}function x(){this.name=w.KHR_TEXTURE_TRANSFORM}function S(L){p.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var I=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),z=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),X=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),Z=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),W=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join(`
`),D={specular:{value:new p.Color().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=D,this.onBeforeCompile=function(H){for(var ht in D)H.uniforms[ht]=D[ht];H.fragmentShader=H.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),H.fragmentShader=H.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),H.fragmentShader=H.fragmentShader.replace("#include <roughnessmap_pars_fragment>",I),H.fragmentShader=H.fragmentShader.replace("#include <metalnessmap_pars_fragment>",z),H.fragmentShader=H.fragmentShader.replace("#include <roughnessmap_fragment>",X),H.fragmentShader=H.fragmentShader.replace("#include <metalnessmap_fragment>",Z),H.fragmentShader=H.fragmentShader.replace("#include <lights_physical_fragment>",W)},Object.defineProperties(this,{specular:{get:function(){return D.specular.value},set:function(H){D.specular.value=H}},specularMap:{get:function(){return D.specularMap.value},set:function(H){D.specularMap.value=H}},glossiness:{get:function(){return D.glossiness.value},set:function(H){D.glossiness.value=H}},glossinessMap:{get:function(){return D.glossinessMap.value},set:function(H){D.glossinessMap.value=H,H?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(L)}function U(){return{name:w.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return S},extendParams:function(L,I,z){var X=I.extensions[this.name];L.color=new p.Color(1,1,1),L.opacity=1;var Z=[];if(Array.isArray(X.diffuseFactor)){var W=X.diffuseFactor;L.color.fromArray(W),L.opacity=W[3]}if(X.diffuseTexture!==void 0&&Z.push(z.assignTexture(L,"map",X.diffuseTexture)),L.emissive=new p.Color(0,0,0),L.glossiness=X.glossinessFactor!==void 0?X.glossinessFactor:1,L.specular=new p.Color(1,1,1),Array.isArray(X.specularFactor)&&L.specular.fromArray(X.specularFactor),X.specularGlossinessTexture!==void 0){var D=X.specularGlossinessTexture;Z.push(z.assignTexture(L,"glossinessMap",D)),Z.push(z.assignTexture(L,"specularMap",D))}return Promise.all(Z)},createMaterial:function(L){var I=new S(L);return I.fog=!0,I.color=L.color,I.map=L.map===void 0?null:L.map,I.lightMap=null,I.lightMapIntensity=1,I.aoMap=L.aoMap===void 0?null:L.aoMap,I.aoMapIntensity=1,I.emissive=L.emissive,I.emissiveIntensity=1,I.emissiveMap=L.emissiveMap===void 0?null:L.emissiveMap,I.bumpMap=L.bumpMap===void 0?null:L.bumpMap,I.bumpScale=1,I.normalMap=L.normalMap===void 0?null:L.normalMap,I.normalMapType=p.TangentSpaceNormalMap,L.normalScale&&(I.normalScale=L.normalScale),I.displacementMap=null,I.displacementScale=1,I.displacementBias=0,I.specularMap=L.specularMap===void 0?null:L.specularMap,I.specular=L.specular,I.glossinessMap=L.glossinessMap===void 0?null:L.glossinessMap,I.glossiness=L.glossiness,I.alphaMap=null,I.envMap=L.envMap===void 0?null:L.envMap,I.envMapIntensity=1,I.refractionRatio=.98,I}}}function O(){this.name=w.KHR_MESH_QUANTIZATION}function pt(L,I,z,X){p.Interpolant.call(this,L,I,z,X)}ut.prototype.decodePrimitive=function(L,I){var z=this.json,X=this.dracoLoader,Z=L.extensions[this.name].bufferView,W=L.extensions[this.name].attributes,D={},H={},ht={};for(var F in W){var Mt=ve[F]||F.toLowerCase();D[Mt]=W[F]}for(F in L.attributes)if(Mt=ve[F]||F.toLowerCase(),W[F]!==void 0){var Et=z.accessors[L.attributes[F]],Q=re[Et.componentType];ht[Mt]=Q,H[Mt]=Et.normalized===!0}return I.getDependency("bufferView",Z).then(function(wt){return new Promise(function(zt){X.decodeDracoFile(wt,function(bt){for(var Xt in bt.attributes){var rt=bt.attributes[Xt],d=H[Xt];d!==void 0&&(rt.normalized=d)}zt(bt)},D,ht)})})},x.prototype.extendTexture=function(L,I){return L=L.clone(),I.offset!==void 0&&L.offset.fromArray(I.offset),I.rotation!==void 0&&(L.rotation=I.rotation),I.scale!==void 0&&L.repeat.fromArray(I.scale),I.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),L.needsUpdate=!0,L},S.prototype=Object.create(p.MeshStandardMaterial.prototype),S.prototype.constructor=S,S.prototype.copy=function(L){return p.MeshStandardMaterial.prototype.copy.call(this,L),this.specularMap=L.specularMap,this.specular.copy(L.specular),this.glossinessMap=L.glossinessMap,this.glossiness=L.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},pt.prototype=Object.create(p.Interpolant.prototype),pt.prototype.constructor=pt,pt.prototype.copySampleValue_=function(L){for(var I=this.resultBuffer,z=this.sampleValues,X=this.valueSize,Z=L*X*3+X,W=0;W!==X;W++)I[W]=z[Z+W];return I},pt.prototype.beforeStart_=pt.prototype.copySampleValue_,pt.prototype.afterEnd_=pt.prototype.copySampleValue_,pt.prototype.interpolate_=function(L,I,z,X){for(var Z=this.resultBuffer,W=this.sampleValues,D=this.valueSize,H=2*D,ht=3*D,F=X-I,Mt=(z-I)/F,Et=Mt*Mt,Q=Et*Mt,wt=L*ht,zt=wt-ht,bt=-2*Q+3*Et,Xt=Q-Et,rt=1-bt,d=Xt-Et+Mt,b=0;b!==D;b++){var R=W[zt+b+D],B=W[zt+b+H]*F,V=W[wt+b+D],it=W[wt+b]*F;Z[b]=rt*R+d*B+bt*V+Xt*it}return Z};var ct=0,_t=1,Ot=2,Vt=3,St=4,At=5,Ut=6,re={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ie={9728:p.NearestFilter,9729:p.LinearFilter,9984:p.NearestMipmapNearestFilter,9985:p.LinearMipmapNearestFilter,9986:p.NearestMipmapLinearFilter,9987:p.LinearMipmapLinearFilter},Ct={33071:p.ClampToEdgeWrapping,33648:p.MirroredRepeatWrapping,10497:p.RepeatWrapping},se={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ve={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},le={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},de={CUBICSPLINE:void 0,LINEAR:p.InterpolateLinear,STEP:p.InterpolateDiscrete},Pe="OPAQUE",Ve="MASK",Ue="BLEND",ke={"image/png":p.RGBAFormat,"image/jpeg":p.RGBFormat};function he(L,I){return typeof L!="string"||L===""?"":(/^https?:\/\//i.test(I)&&/^\//.test(L)&&(I=I.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(L)||/^data:.*,.*$/i.test(L)||/^blob:.*$/i.test(L)?L:I+L)}function Te(L,I,z){for(var X in z.extensions)L[X]===void 0&&(I.userData.gltfExtensions=I.userData.gltfExtensions||{},I.userData.gltfExtensions[X]=z.extensions[X])}function Ce(L,I){I.extras!==void 0&&(typeof I.extras=="object"?Object.assign(L.userData,I.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+I.extras))}function je(L,I){if(L.updateMorphTargets(),I.weights!==void 0)for(var z=0,X=I.weights.length;z<X;z++)L.morphTargetInfluences[z]=I.weights[z];if(I.extras&&Array.isArray(I.extras.targetNames)){var Z=I.extras.targetNames;if(L.morphTargetInfluences.length===Z.length)for(L.morphTargetDictionary={},z=0,X=Z.length;z<X;z++)L.morphTargetDictionary[Z[z]]=z;else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ft(L){for(var I="",z=Object.keys(L).sort(),X=0,Z=z.length;X<Z;X++)I+=z[X]+":"+L[z[X]]+";";return I}function tt(L,I,z){this.json=L||{},this.extensions=I||{},this.options=z||{},this.cache=new P,this.associations=new Map,this.primitiveCache={},this.textureLoader=new p.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new p.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}function $(L,I,z){var X=I.attributes,Z=[];function W(F,Mt){return z.getDependency("accessor",F).then(function(Et){L.setAttribute(Mt,Et)})}for(var D in X){var H=ve[D]||D.toLowerCase();H in L.attributes||Z.push(W(X[D],H))}if(I.indices!==void 0&&!L.index){var ht=z.getDependency("accessor",I.indices).then(function(F){L.setIndex(F)});Z.push(ht)}return Ce(L,I),function(F,Mt,Et){var Q=Mt.attributes,wt=new p.Box3;if(Q.POSITION!==void 0){var zt=(V=Et.json.accessors[Q.POSITION]).min,bt=V.max;if(zt!==void 0&&bt!==void 0){wt.set(new p.Vector3(zt[0],zt[1],zt[2]),new p.Vector3(bt[0],bt[1],bt[2]));var Xt=Mt.targets;if(Xt!==void 0){for(var rt=new p.Vector3,d=new p.Vector3,b=0,R=Xt.length;b<R;b++){var B=Xt[b];if(B.POSITION!==void 0){var V;zt=(V=Et.json.accessors[B.POSITION]).min,bt=V.max,zt!==void 0&&bt!==void 0?(d.setX(Math.max(Math.abs(zt[0]),Math.abs(bt[0]))),d.setY(Math.max(Math.abs(zt[1]),Math.abs(bt[1]))),d.setZ(Math.max(Math.abs(zt[2]),Math.abs(bt[2]))),rt.max(d)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}wt.expandByVector(rt)}F.boundingBox=wt;var it=new p.Sphere;wt.getCenter(it.center),it.radius=wt.min.distanceTo(wt.max)/2,F.boundingSphere=it}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(L,I,z),Promise.all(Z).then(function(){return I.targets!==void 0?function(F,Mt,Et){for(var Q=!1,wt=!1,zt=0,bt=Mt.length;zt<bt&&!((d=Mt[zt]).POSITION!==void 0&&(Q=!0),d.NORMAL!==void 0&&(wt=!0),Q&&wt);zt++);if(!Q&&!wt)return Promise.resolve(F);var Xt=[],rt=[];for(zt=0,bt=Mt.length;zt<bt;zt++){var d=Mt[zt];if(Q){var b=d.POSITION!==void 0?Et.getDependency("accessor",d.POSITION):F.attributes.position;Xt.push(b)}wt&&(b=d.NORMAL!==void 0?Et.getDependency("accessor",d.NORMAL):F.attributes.normal,rt.push(b))}return Promise.all([Promise.all(Xt),Promise.all(rt)]).then(function(R){var B=R[0],V=R[1];return Q&&(F.morphAttributes.position=B),wt&&(F.morphAttributes.normal=V),F.morphTargetsRelative=!0,F})}(L,I.targets,z):L})}function J(L,I){var z=L.getIndex();if(z===null){var X=[],Z=L.getAttribute("position");if(Z===void 0)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),L;for(var W=0;W<Z.count;W++)X.push(W);L.setIndex(X),z=L.getIndex()}var D=z.count-2,H=[];if(I===p.TriangleFanDrawMode)for(W=1;W<=D;W++)H.push(z.getX(0)),H.push(z.getX(W)),H.push(z.getX(W+1));else for(W=0;W<D;W++)W%2==0?(H.push(z.getX(W)),H.push(z.getX(W+1)),H.push(z.getX(W+2))):(H.push(z.getX(W+2)),H.push(z.getX(W+1)),H.push(z.getX(W)));H.length/3!==D&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var ht=L.clone();return ht.setIndex(H),ht}return tt.prototype.parse=function(L,I){var z=this,X=this.json,Z=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(W){var D={scene:W[0][X.scene||0],scenes:W[0],animations:W[1],cameras:W[2],asset:X.asset,parser:z,userData:{}};Te(Z,D,X),Ce(D,X),L(D)}).catch(I)},tt.prototype.markDefs=function(){for(var L=this.json.nodes||[],I=this.json.skins||[],z=this.json.meshes||[],X={},Z={},W=0,D=I.length;W<D;W++)for(var H=I[W].joints,ht=0,F=H.length;ht<F;ht++)L[H[ht]].isBone=!0;for(var Mt=0,Et=L.length;Mt<Et;Mt++){var Q=L[Mt];Q.mesh!==void 0&&(X[Q.mesh]===void 0&&(X[Q.mesh]=Z[Q.mesh]=0),X[Q.mesh]++,Q.skin!==void 0&&(z[Q.mesh].isSkinnedMesh=!0))}this.json.meshReferences=X,this.json.meshUses=Z},tt.prototype.getDependency=function(L,I){var z=L+":"+I,X=this.cache.get(z);if(!X){switch(L){case"scene":X=this.loadScene(I);break;case"node":X=this.loadNode(I);break;case"mesh":X=this.loadMesh(I);break;case"accessor":X=this.loadAccessor(I);break;case"bufferView":X=this.loadBufferView(I);break;case"buffer":X=this.loadBuffer(I);break;case"material":X=this.loadMaterial(I);break;case"texture":X=this.loadTexture(I);break;case"skin":X=this.loadSkin(I);break;case"animation":X=this.loadAnimation(I);break;case"camera":X=this.loadCamera(I);break;case"light":X=this.extensions[w.KHR_LIGHTS_PUNCTUAL].loadLight(I);break;default:throw new Error("Unknown type: "+L)}this.cache.add(z,X)}return X},tt.prototype.getDependencies=function(L){var I=this.cache.get(L);if(!I){var z=this,X=this.json[L+(L==="mesh"?"es":"s")]||[];I=Promise.all(X.map(function(Z,W){return z.getDependency(L,W)})),this.cache.add(L,I)}return I},tt.prototype.loadBuffer=function(L){var I=this.json.buffers[L],z=this.fileLoader;if(I.type&&I.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+I.type+" buffer type is not supported.");if(I.uri===void 0&&L===0)return Promise.resolve(this.extensions[w.KHR_BINARY_GLTF].body);var X=this.options;return new Promise(function(Z,W){z.load(he(I.uri,X.path),Z,void 0,function(){W(new Error('THREE.GLTFLoader: Failed to load buffer "'+I.uri+'".'))})})},tt.prototype.loadBufferView=function(L){var I=this.json.bufferViews[L];return this.getDependency("buffer",I.buffer).then(function(z){var X=I.byteLength||0,Z=I.byteOffset||0;return z.slice(Z,Z+X)})},tt.prototype.loadAccessor=function(L){var I=this,z=this.json,X=this.json.accessors[L];if(X.bufferView===void 0&&X.sparse===void 0)return Promise.resolve(null);var Z=[];return X.bufferView!==void 0?Z.push(this.getDependency("bufferView",X.bufferView)):Z.push(null),X.sparse!==void 0&&(Z.push(this.getDependency("bufferView",X.sparse.indices.bufferView)),Z.push(this.getDependency("bufferView",X.sparse.values.bufferView))),Promise.all(Z).then(function(W){var D,H,ht=W[0],F=se[X.type],Mt=re[X.componentType],Et=Mt.BYTES_PER_ELEMENT,Q=Et*F,wt=X.byteOffset||0,zt=X.bufferView!==void 0?z.bufferViews[X.bufferView].byteStride:void 0,bt=X.normalized===!0;if(zt&&zt!==Q){var Xt=Math.floor(wt/zt),rt="InterleavedBuffer:"+X.bufferView+":"+X.componentType+":"+Xt+":"+X.count,d=I.cache.get(rt);d||(D=new Mt(ht,Xt*zt,X.count*zt/Et),d=new p.InterleavedBuffer(D,zt/Et),I.cache.add(rt,d)),H=new p.InterleavedBufferAttribute(d,F,wt%zt/Et,bt)}else D=ht===null?new Mt(X.count*F):new Mt(ht,wt,X.count*F),H=new p.BufferAttribute(D,F,bt);if(X.sparse!==void 0){var b=se.SCALAR,R=re[X.sparse.indices.componentType],B=X.sparse.indices.byteOffset||0,V=X.sparse.values.byteOffset||0,it=new R(W[1],B,X.sparse.count*b),mt=new Mt(W[2],V,X.sparse.count*F);ht!==null&&(H=new p.BufferAttribute(H.array.slice(),H.itemSize,H.normalized));for(var xt=0,It=it.length;xt<It;xt++){var ne=it[xt];if(H.setX(ne,mt[xt*F]),F>=2&&H.setY(ne,mt[xt*F+1]),F>=3&&H.setZ(ne,mt[xt*F+2]),F>=4&&H.setW(ne,mt[xt*F+3]),F>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return H})},tt.prototype.loadTexture=function(L){var I,z=this,X=this.json,Z=this.options,W=this.textureLoader,D=self.URL||self.webkitURL,H=X.textures[L],ht=H.extensions||{},F=(I=ht[w.MSFT_TEXTURE_DDS]?X.images[ht[w.MSFT_TEXTURE_DDS].source]:X.images[H.source]).uri,Mt=!1;return I.bufferView!==void 0&&(F=z.getDependency("bufferView",I.bufferView).then(function(Et){Mt=!0;var Q=new Blob([Et],{type:I.mimeType});return F=D.createObjectURL(Q)})),Promise.resolve(F).then(function(Et){var Q=Z.manager.getHandler(Et);return Q||(Q=ht[w.MSFT_TEXTURE_DDS]?z.extensions[w.MSFT_TEXTURE_DDS].ddsLoader:W),new Promise(function(wt,zt){Q.load(he(Et,Z.path),wt,void 0,zt)})}).then(function(Et){Mt===!0&&D.revokeObjectURL(F),Et.flipY=!1,H.name&&(Et.name=H.name),I.mimeType in ke&&(Et.format=ke[I.mimeType]);var Q=(X.samplers||{})[H.sampler]||{};return Et.magFilter=ie[Q.magFilter]||p.LinearFilter,Et.minFilter=ie[Q.minFilter]||p.LinearMipmapLinearFilter,Et.wrapS=Ct[Q.wrapS]||p.RepeatWrapping,Et.wrapT=Ct[Q.wrapT]||p.RepeatWrapping,z.associations.set(Et,{type:"textures",index:L}),Et})},tt.prototype.assignTexture=function(L,I,z){var X=this;return this.getDependency("texture",z.index).then(function(Z){if(!Z.isCompressedTexture)switch(I){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":Z.format=p.RGBFormat}if(z.texCoord===void 0||z.texCoord==0||I==="aoMap"&&z.texCoord==1||console.warn("THREE.GLTFLoader: Custom UV set "+z.texCoord+" for texture "+I+" not yet supported."),X.extensions[w.KHR_TEXTURE_TRANSFORM]){var W=z.extensions!==void 0?z.extensions[w.KHR_TEXTURE_TRANSFORM]:void 0;if(W){var D=X.associations.get(Z);Z=X.extensions[w.KHR_TEXTURE_TRANSFORM].extendTexture(Z,W),X.associations.set(Z,D)}}L[I]=Z})},tt.prototype.assignFinalMaterial=function(L){var I=L.geometry,z=L.material,X=I.attributes.tangent!==void 0,Z=I.attributes.color!==void 0,W=I.attributes.normal===void 0,D=L.isSkinnedMesh===!0,H=Object.keys(I.morphAttributes).length>0,ht=H&&I.morphAttributes.normal!==void 0;if(L.isPoints){var F="PointsMaterial:"+z.uuid,Mt=this.cache.get(F);Mt||(Mt=new p.PointsMaterial,p.Material.prototype.copy.call(Mt,z),Mt.color.copy(z.color),Mt.map=z.map,Mt.sizeAttenuation=!1,this.cache.add(F,Mt)),z=Mt}else if(L.isLine){F="LineBasicMaterial:"+z.uuid;var Et=this.cache.get(F);Et||(Et=new p.LineBasicMaterial,p.Material.prototype.copy.call(Et,z),Et.color.copy(z.color),this.cache.add(F,Et)),z=Et}if(X||Z||W||D||H){F="ClonedMaterial:"+z.uuid+":",z.isGLTFSpecularGlossinessMaterial&&(F+="specular-glossiness:"),D&&(F+="skinning:"),X&&(F+="vertex-tangents:"),Z&&(F+="vertex-colors:"),W&&(F+="flat-shading:"),H&&(F+="morph-targets:"),ht&&(F+="morph-normals:");var Q=this.cache.get(F);Q||(Q=z.clone(),D&&(Q.skinning=!0),X&&(Q.vertexTangents=!0),Z&&(Q.vertexColors=!0),W&&(Q.flatShading=!0),H&&(Q.morphTargets=!0),ht&&(Q.morphNormals=!0),this.cache.add(F,Q),this.associations.set(Q,this.associations.get(z))),z=Q}z.aoMap&&I.attributes.uv2===void 0&&I.attributes.uv!==void 0&&I.setAttribute("uv2",I.attributes.uv),z.normalScale&&!X&&(z.normalScale.y=-z.normalScale.y),z.clearcoatNormalScale&&!X&&(z.clearcoatNormalScale.y=-z.clearcoatNormalScale.y),L.material=z},tt.prototype.loadMaterial=function(L){var I,z=this,X=this.json,Z=this.extensions,W=X.materials[L],D={},H=W.extensions||{},ht=[];if(H[w.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var F=Z[w.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];I=F.getMaterialType(),ht.push(F.extendParams(D,W,z))}else if(H[w.KHR_MATERIALS_UNLIT]){var Mt=Z[w.KHR_MATERIALS_UNLIT];I=Mt.getMaterialType(),ht.push(Mt.extendParams(D,W,z))}else{I=p.MeshStandardMaterial;var Et=W.pbrMetallicRoughness||{};if(D.color=new p.Color(1,1,1),D.opacity=1,Array.isArray(Et.baseColorFactor)){var Q=Et.baseColorFactor;D.color.fromArray(Q),D.opacity=Q[3]}Et.baseColorTexture!==void 0&&ht.push(z.assignTexture(D,"map",Et.baseColorTexture)),D.metalness=Et.metallicFactor!==void 0?Et.metallicFactor:1,D.roughness=Et.roughnessFactor!==void 0?Et.roughnessFactor:1,Et.metallicRoughnessTexture!==void 0&&(ht.push(z.assignTexture(D,"metalnessMap",Et.metallicRoughnessTexture)),ht.push(z.assignTexture(D,"roughnessMap",Et.metallicRoughnessTexture)))}W.doubleSided===!0&&(D.side=p.DoubleSide);var wt=W.alphaMode||Pe;if(wt===Ue?(D.transparent=!0,D.depthWrite=!1):(D.transparent=!1,wt===Ve&&(D.alphaTest=W.alphaCutoff!==void 0?W.alphaCutoff:.5)),W.normalTexture!==void 0&&I!==p.MeshBasicMaterial&&(ht.push(z.assignTexture(D,"normalMap",W.normalTexture)),D.normalScale=new p.Vector2(1,1),W.normalTexture.scale!==void 0&&D.normalScale.set(W.normalTexture.scale,W.normalTexture.scale)),W.occlusionTexture!==void 0&&I!==p.MeshBasicMaterial&&(ht.push(z.assignTexture(D,"aoMap",W.occlusionTexture)),W.occlusionTexture.strength!==void 0&&(D.aoMapIntensity=W.occlusionTexture.strength)),W.emissiveFactor!==void 0&&I!==p.MeshBasicMaterial&&(D.emissive=new p.Color().fromArray(W.emissiveFactor)),W.emissiveTexture!==void 0&&I!==p.MeshBasicMaterial&&ht.push(z.assignTexture(D,"emissiveMap",W.emissiveTexture)),H[w.KHR_MATERIALS_CLEARCOAT]){var zt=Z[w.KHR_MATERIALS_CLEARCOAT];I=zt.getMaterialType(),ht.push(zt.extendParams(D,{extensions:H},z))}return Promise.all(ht).then(function(){var bt;return bt=I===S?Z[w.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(D):new I(D),W.name&&(bt.name=W.name),bt.map&&(bt.map.encoding=p.sRGBEncoding),bt.emissiveMap&&(bt.emissiveMap.encoding=p.sRGBEncoding),Ce(bt,W),z.associations.set(bt,{type:"materials",index:L}),W.extensions&&Te(Z,bt,W),bt})},tt.prototype.loadGeometries=function(L){var I=this,z=this.extensions,X=this.primitiveCache;function Z(zt){return z[w.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(zt,I).then(function(bt){return $(bt,zt,I)})}for(var W,D,H=[],ht=0,F=L.length;ht<F;ht++){var Mt,Et=L[ht],Q=(D=void 0,(D=(W=Et).extensions&&W.extensions[w.KHR_DRACO_MESH_COMPRESSION])?"draco:"+D.bufferView+":"+D.indices+":"+ft(D.attributes):W.indices+":"+ft(W.attributes)+":"+W.mode),wt=X[Q];wt?H.push(wt.promise):(Mt=Et.extensions&&Et.extensions[w.KHR_DRACO_MESH_COMPRESSION]?Z(Et):$(new p.BufferGeometry,Et,I),X[Q]={primitive:Et,promise:Mt},H.push(Mt))}return Promise.all(H)},tt.prototype.loadMesh=function(L){for(var I,z=this,X=this.json.meshes[L],Z=X.primitives,W=[],D=0,H=Z.length;D<H;D++){var ht=Z[D].material===void 0?((I=this.cache).DefaultMaterial===void 0&&(I.DefaultMaterial=new p.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:p.FrontSide})),I.DefaultMaterial):this.getDependency("material",Z[D].material);W.push(ht)}return W.push(z.loadGeometries(Z)),Promise.all(W).then(function(F){for(var Mt=F.slice(0,F.length-1),Et=F[F.length-1],Q=[],wt=0,zt=Et.length;wt<zt;wt++){var bt,Xt=Et[wt],rt=Z[wt],d=Mt[wt];if(rt.mode===St||rt.mode===At||rt.mode===Ut||rt.mode===void 0)(bt=X.isSkinnedMesh===!0?new p.SkinnedMesh(Xt,d):new p.Mesh(Xt,d)).isSkinnedMesh!==!0||bt.geometry.attributes.skinWeight.normalized||bt.normalizeSkinWeights(),rt.mode===At?bt.geometry=J(bt.geometry,p.TriangleStripDrawMode):rt.mode===Ut&&(bt.geometry=J(bt.geometry,p.TriangleFanDrawMode));else if(rt.mode===_t)bt=new p.LineSegments(Xt,d);else if(rt.mode===Vt)bt=new p.Line(Xt,d);else if(rt.mode===Ot)bt=new p.LineLoop(Xt,d);else{if(rt.mode!==ct)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+rt.mode);bt=new p.Points(Xt,d)}Object.keys(bt.geometry.morphAttributes).length>0&&je(bt,X),bt.name=X.name||"mesh_"+L,Et.length>1&&(bt.name+="_"+wt),Ce(bt,X),z.assignFinalMaterial(bt),Q.push(bt)}if(Q.length===1)return Q[0];var b=new p.Group;for(wt=0,zt=Q.length;wt<zt;wt++)b.add(Q[wt]);return b})},tt.prototype.loadCamera=function(L){var I,z=this.json.cameras[L],X=z[z.type];if(X)return z.type==="perspective"?I=new p.PerspectiveCamera(p.MathUtils.radToDeg(X.yfov),X.aspectRatio||1,X.znear||1,X.zfar||2e6):z.type==="orthographic"&&(I=new p.OrthographicCamera(-X.xmag,X.xmag,X.ymag,-X.ymag,X.znear,X.zfar)),z.name&&(I.name=z.name),Ce(I,z),Promise.resolve(I);console.warn("THREE.GLTFLoader: Missing camera parameters.")},tt.prototype.loadSkin=function(L){var I=this.json.skins[L],z={joints:I.joints};return I.inverseBindMatrices===void 0?Promise.resolve(z):this.getDependency("accessor",I.inverseBindMatrices).then(function(X){return z.inverseBindMatrices=X,z})},tt.prototype.loadAnimation=function(L){for(var I=this.json.animations[L],z=[],X=[],Z=[],W=[],D=[],H=0,ht=I.channels.length;H<ht;H++){var F=I.channels[H],Mt=I.samplers[F.sampler],Et=F.target,Q=Et.node!==void 0?Et.node:Et.id,wt=I.parameters!==void 0?I.parameters[Mt.input]:Mt.input,zt=I.parameters!==void 0?I.parameters[Mt.output]:Mt.output;z.push(this.getDependency("node",Q)),X.push(this.getDependency("accessor",wt)),Z.push(this.getDependency("accessor",zt)),W.push(Mt),D.push(Et)}return Promise.all([Promise.all(z),Promise.all(X),Promise.all(Z),Promise.all(W),Promise.all(D)]).then(function(bt){for(var Xt=bt[0],rt=bt[1],d=bt[2],b=bt[3],R=bt[4],B=[],V=0,it=Xt.length;V<it;V++){var mt=Xt[V],xt=rt[V],It=d[V],ne=b[V],Lt=R[V];if(mt!==void 0){var Se;switch(mt.updateMatrix(),mt.matrixAutoUpdate=!0,le[Lt.path]){case le.weights:Se=p.NumberKeyframeTrack;break;case le.rotation:Se=p.QuaternionKeyframeTrack;break;case le.position:case le.scale:default:Se=p.VectorKeyframeTrack}var Ae=mt.name?mt.name:mt.uuid,lr=ne.interpolation!==void 0?de[ne.interpolation]:p.InterpolateLinear,sr=[];le[Lt.path]===le.weights?mt.traverse(function(xr){xr.isMesh===!0&&xr.morphTargetInfluences&&sr.push(xr.name?xr.name:xr.uuid)}):sr.push(Ae);var He=It.array;if(It.normalized){var yr;if(He.constructor===Int8Array)yr=1/127;else if(He.constructor===Uint8Array)yr=1/255;else if(He.constructor==Int16Array)yr=1/32767;else{if(He.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");yr=1/65535}for(var Br=new Float32Array(He.length),Pr=0,xn=He.length;Pr<xn;Pr++)Br[Pr]=He[Pr]*yr;He=Br}for(Pr=0,xn=sr.length;Pr<xn;Pr++){var Vr=new Se(sr[Pr]+"."+le[Lt.path],xt.array,He,lr);ne.interpolation==="CUBICSPLINE"&&(Vr.createInterpolant=function(xr){return new pt(this.times,this.values,this.getValueSize()/3,xr)},Vr.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),B.push(Vr)}}}var Xr=I.name?I.name:"animation_"+L;return new p.AnimationClip(Xr,void 0,B)})},tt.prototype.loadNode=function(L){var I,z=this.json,X=this.extensions,Z=this,W=z.meshReferences,D=z.meshUses,H=z.nodes[L];return(I=[],H.mesh!==void 0&&I.push(Z.getDependency("mesh",H.mesh).then(function(ht){var F;if(W[H.mesh]>1){var Mt=D[H.mesh]++;(F=ht.clone()).name+="_instance_"+Mt}else F=ht;return H.weights!==void 0&&F.traverse(function(Et){if(Et.isMesh)for(var Q=0,wt=H.weights.length;Q<wt;Q++)Et.morphTargetInfluences[Q]=H.weights[Q]}),F})),H.camera!==void 0&&I.push(Z.getDependency("camera",H.camera)),H.extensions&&H.extensions[w.KHR_LIGHTS_PUNCTUAL]&&H.extensions[w.KHR_LIGHTS_PUNCTUAL].light!==void 0&&I.push(Z.getDependency("light",H.extensions[w.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(I)).then(function(ht){var F;if((F=H.isBone===!0?new p.Bone:ht.length>1?new p.Group:ht.length===1?ht[0]:new p.Object3D)!==ht[0])for(var Mt=0,Et=ht.length;Mt<Et;Mt++)F.add(ht[Mt]);if(H.name&&(F.userData.name=H.name,F.name=p.PropertyBinding.sanitizeNodeName(H.name)),Ce(F,H),H.extensions&&Te(X,F,H),H.matrix!==void 0){var Q=new p.Matrix4;Q.fromArray(H.matrix),F.applyMatrix4(Q)}else H.translation!==void 0&&F.position.fromArray(H.translation),H.rotation!==void 0&&F.quaternion.fromArray(H.rotation),H.scale!==void 0&&F.scale.fromArray(H.scale);return Z.associations.set(F,{type:"nodes",index:L}),F})},tt.prototype.loadScene=function(){function L(I,z,X,Z){var W=X.nodes[I];return Z.getDependency("node",I).then(function(D){return W.skin===void 0?D:Z.getDependency("skin",W.skin).then(function(ht){for(var F=[],Mt=0,Et=(H=ht).joints.length;Mt<Et;Mt++)F.push(Z.getDependency("node",H.joints[Mt]));return Promise.all(F)}).then(function(ht){return D.traverse(function(F){if(F.isMesh){for(var Mt=[],Et=[],Q=0,wt=ht.length;Q<wt;Q++){var zt=ht[Q];if(zt){Mt.push(zt);var bt=new p.Matrix4;H.inverseBindMatrices!==void 0&&bt.fromArray(H.inverseBindMatrices.array,16*Q),Et.push(bt)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',H.joints[Q])}F.bind(new p.Skeleton(Mt,Et),F.matrixWorld)}}),D});var H}).then(function(D){z.add(D);var H=[];if(W.children)for(var ht=W.children,F=0,Mt=ht.length;F<Mt;F++){var Et=ht[F];H.push(L(Et,D,X,Z))}return Promise.all(H)})}return function(I){var z=this.json,X=this.extensions,Z=this.json.scenes[I],W=new p.Group;Z.name&&(W.name=Z.name),Ce(W,Z),Z.extensions&&Te(X,W,Z);for(var D=Z.nodes||[],H=[],ht=0,F=D.length;ht<F;ht++)H.push(L(D[ht],W,z,this));return Promise.all(H).then(function(){return W})}}(),E}()},function(ee,v,f){f.r(v),f.d(v,"SVGLoader",function(){return pt});var p,_,E,P,w,T,C,vt,Tt,Pt,G,Y,at,ut,x,S,U,O=f(0),pt=function(ct){O.Loader.call(this,ct),this.defaultDPI=90,this.defaultUnit="px"};pt.prototype=Object.assign(Object.create(O.Loader.prototype),{constructor:pt,load:function(ct,_t,Ot,Vt){var St=this,At=new O.FileLoader(St.manager);At.setPath(St.path),At.load(ct,function(Ut){try{_t(St.parse(Ut))}catch(re){Vt?Vt(re):console.error(re),St.manager.itemError(ct)}},Ot,Vt)},parse:function(ct){var _t=this;function Ot(tt,$,J,L,I,z,X,Z){L=L*Math.PI/180,$=Math.abs($),J=Math.abs(J);var W=(X.x-Z.x)/2,D=(X.y-Z.y)/2,H=Math.cos(L)*W+Math.sin(L)*D,ht=-Math.sin(L)*W+Math.cos(L)*D,F=$*$,Mt=J*J,Et=H*H,Q=ht*ht,wt=Et/F+Q/Mt;if(wt>1){var zt=Math.sqrt(wt);F=($*=zt)*$,Mt=(J*=zt)*J}var bt=F*Q+Mt*Et,Xt=(F*Mt-bt)/bt,rt=Math.sqrt(Math.max(0,Xt));I===z&&(rt=-rt);var d=rt*$*ht/J,b=-rt*J*H/$,R=Math.cos(L)*d-Math.sin(L)*b+(X.x+Z.x)/2,B=Math.sin(L)*d+Math.cos(L)*b+(X.y+Z.y)/2,V=Vt(1,0,(H-d)/$,(ht-b)/J),it=Vt((H-d)/$,(ht-b)/J,(-H-d)/$,(-ht-b)/J)%(2*Math.PI);tt.currentPath.absellipse(R,B,$,J,V,V+it,z===0,L)}function Vt(tt,$,J,L){var I=tt*J+$*L,z=Math.sqrt(tt*tt+$*$)*Math.sqrt(J*J+L*L),X=Math.acos(Math.max(-1,Math.min(1,I/z)));return tt*L-$*J<0&&(X=-X),X}function St(tt,$){$=Object.assign({},$);var J={};if(tt.hasAttribute("class"))for(var L=tt.getAttribute("class").split(/\s/).filter(Boolean).map(W=>W.trim()),I=0;I<L.length;I++)J=Object.assign(J,de["."+L[I]]);function z(W,D,H){H===void 0&&(H=function(ht){return ht}),tt.hasAttribute(W)&&($[D]=H(tt.getAttribute(W))),J[W]&&($[D]=H(J[W])),tt.style&&tt.style[W]!==""&&($[D]=H(tt.style[W]))}function X(W){return Math.max(0,Math.min(1,Ct(W)))}function Z(W){return Math.max(0,Ct(W))}return tt.hasAttribute("id")&&(J=Object.assign(J,de["#"+tt.getAttribute("id")])),z("fill","fill"),z("fill-opacity","fillOpacity",X),z("opacity","opacity",X),z("stroke","stroke"),z("stroke-opacity","strokeOpacity",X),z("stroke-width","strokeWidth",Z),z("stroke-linejoin","strokeLineJoin"),z("stroke-linecap","strokeLineCap"),z("stroke-miterlimit","strokeMiterLimit",Z),z("visibility","visibility"),$}function At(tt,$){return tt-($-tt)}function Ut(tt){for(var $=tt.split(/[\s,]+|(?=\s?[+\-])/),J=0;J<$.length;J++){var L=$[J];if(L.indexOf(".")!==L.lastIndexOf("."))for(var I=L.split("."),z=2;z<I.length;z++)$.splice(J+z-1,0,"0."+I[z]);$[J]=Ct(L)}return $}var re=["mm","cm","in","pt","pc","px"],ie={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function Ct(tt){var $="px";if(typeof tt=="string"||tt instanceof String)for(var J=0,L=re.length;J<L;J++){var I=re[J];if(tt.endsWith(I)){$=I,tt=tt.substring(0,tt.length-I.length);break}}var z=void 0;return $==="px"&&_t.defaultUnit!=="px"?z=ie.in[_t.defaultUnit]/_t.defaultDPI:(z=ie[$][_t.defaultUnit])<0&&(z=ie[$].in*_t.defaultDPI),z*parseFloat(tt)}function se(tt){var $=tt.elements;return Math.sqrt($[0]*$[0]+$[1]*$[1])}function ve(tt){var $=tt.elements;return Math.sqrt($[3]*$[3]+$[4]*$[4])}var le=[],de={},Pe=[],Ve=new O.Matrix3,Ue=new O.Matrix3,ke=new O.Matrix3,he=new O.Matrix3,Te=new O.Vector2,Ce=new O.Vector3,je=new O.Matrix3,ft=new DOMParser().parseFromString(ct,"image/svg+xml");return function tt($,J){if($.nodeType===1){var L=function(Z){if(!Z.hasAttribute("transform"))return null;var W=function(D){for(var H=new O.Matrix3,ht=Ve,F=D.getAttribute("transform").split(")"),Mt=F.length-1;Mt>=0;Mt--){var Et=F[Mt].trim();if(Et!==""){var Q=Et.indexOf("("),wt=Et.length;if(Q>0&&Q<wt){var zt=Et.substr(0,Q),bt=Ut(Et.substr(Q+1,wt-Q-1));switch(ht.identity(),zt){case"translate":if(bt.length>=1){var Xt=bt[0],rt=Xt;bt.length>=2&&(rt=bt[1]),ht.translate(Xt,rt)}break;case"rotate":if(bt.length>=1){var d,b=0,R=0;d=-bt[0]*Math.PI/180,bt.length>=3&&(b=bt[1],R=bt[2]),Ue.identity().translate(-b,-R),ke.identity().rotate(d),he.multiplyMatrices(ke,Ue),Ue.identity().translate(b,R),ht.multiplyMatrices(Ue,he)}break;case"scale":if(bt.length>=1){var B=bt[0],V=B;bt.length>=2&&(V=bt[1]),ht.scale(B,V)}break;case"skewX":bt.length===1&&ht.set(1,Math.tan(bt[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":bt.length===1&&ht.set(1,0,0,Math.tan(bt[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":bt.length===6&&ht.set(bt[0],bt[2],bt[4],bt[1],bt[3],bt[5],0,0,1)}}H.premultiply(ht)}}return H}(Z);return Pe.length>0&&W.premultiply(Pe[Pe.length-1]),je.copy(W),Pe.push(W),W}($),I=null;switch($.nodeName){case"svg":break;case"style":!function(Z){if(!Z.sheet||!Z.sheet.cssRules||!Z.sheet.cssRules.length)return;for(var W=0;W<Z.sheet.cssRules.length;W++){var D=Z.sheet.cssRules[W];if(D.type===1)for(var H=D.selectorText.split(/,/gm).filter(Boolean).map(F=>F.trim()),ht=0;ht<H.length;ht++)de[H[ht]]=Object.assign(de[H[ht]]||{},D.style)}}($);break;case"g":J=St($,J);break;case"path":J=St($,J),$.hasAttribute("d")&&(I=function(Z){for(var W=new O.ShapePath,D=new O.Vector2,H=new O.Vector2,ht=new O.Vector2,F=!0,Mt=!1,Et=Z.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi),Q=0,wt=Et.length;Q<wt;Q++){var zt=Et[Q],bt=zt.charAt(0),Xt=zt.substr(1).trim();switch(F===!0&&(Mt=!0,F=!1),bt){case"M":for(var rt=Ut(Xt),d=0,b=rt.length;d<b;d+=2)D.x=rt[d+0],D.y=rt[d+1],H.x=D.x,H.y=D.y,d===0?W.moveTo(D.x,D.y):W.lineTo(D.x,D.y),d===0&&Mt===!0&&ht.copy(D);break;case"H":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d++)D.x=rt[d],H.x=D.x,H.y=D.y,W.lineTo(D.x,D.y),d===0&&Mt===!0&&ht.copy(D);break;case"V":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d++)D.y=rt[d],H.x=D.x,H.y=D.y,W.lineTo(D.x,D.y),d===0&&Mt===!0&&ht.copy(D);break;case"L":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d+=2)D.x=rt[d+0],D.y=rt[d+1],H.x=D.x,H.y=D.y,W.lineTo(D.x,D.y),d===0&&Mt===!0&&ht.copy(D);break;case"C":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d+=6)W.bezierCurveTo(rt[d+0],rt[d+1],rt[d+2],rt[d+3],rt[d+4],rt[d+5]),H.x=rt[d+2],H.y=rt[d+3],D.x=rt[d+4],D.y=rt[d+5],d===0&&Mt===!0&&ht.copy(D);break;case"S":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d+=4)W.bezierCurveTo(At(D.x,H.x),At(D.y,H.y),rt[d+0],rt[d+1],rt[d+2],rt[d+3]),H.x=rt[d+0],H.y=rt[d+1],D.x=rt[d+2],D.y=rt[d+3],d===0&&Mt===!0&&ht.copy(D);break;case"Q":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d+=4)W.quadraticCurveTo(rt[d+0],rt[d+1],rt[d+2],rt[d+3]),H.x=rt[d+0],H.y=rt[d+1],D.x=rt[d+2],D.y=rt[d+3],d===0&&Mt===!0&&ht.copy(D);break;case"T":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d+=2){var R=At(D.x,H.x),B=At(D.y,H.y);W.quadraticCurveTo(R,B,rt[d+0],rt[d+1]),H.x=R,H.y=B,D.x=rt[d+0],D.y=rt[d+1],d===0&&Mt===!0&&ht.copy(D)}break;case"A":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d+=7){var V=D.clone();D.x=rt[d+5],D.y=rt[d+6],H.x=D.x,H.y=D.y,Ot(W,rt[d],rt[d+1],rt[d+2],rt[d+3],rt[d+4],V,D),d===0&&Mt===!0&&ht.copy(D)}break;case"m":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d+=2)D.x+=rt[d+0],D.y+=rt[d+1],H.x=D.x,H.y=D.y,d===0?W.moveTo(D.x,D.y):W.lineTo(D.x,D.y),d===0&&Mt===!0&&ht.copy(D);break;case"h":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d++)D.x+=rt[d],H.x=D.x,H.y=D.y,W.lineTo(D.x,D.y),d===0&&Mt===!0&&ht.copy(D);break;case"v":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d++)D.y+=rt[d],H.x=D.x,H.y=D.y,W.lineTo(D.x,D.y),d===0&&Mt===!0&&ht.copy(D);break;case"l":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d+=2)D.x+=rt[d+0],D.y+=rt[d+1],H.x=D.x,H.y=D.y,W.lineTo(D.x,D.y),d===0&&Mt===!0&&ht.copy(D);break;case"c":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d+=6)W.bezierCurveTo(D.x+rt[d+0],D.y+rt[d+1],D.x+rt[d+2],D.y+rt[d+3],D.x+rt[d+4],D.y+rt[d+5]),H.x=D.x+rt[d+2],H.y=D.y+rt[d+3],D.x+=rt[d+4],D.y+=rt[d+5],d===0&&Mt===!0&&ht.copy(D);break;case"s":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d+=4)W.bezierCurveTo(At(D.x,H.x),At(D.y,H.y),D.x+rt[d+0],D.y+rt[d+1],D.x+rt[d+2],D.y+rt[d+3]),H.x=D.x+rt[d+0],H.y=D.y+rt[d+1],D.x+=rt[d+2],D.y+=rt[d+3],d===0&&Mt===!0&&ht.copy(D);break;case"q":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d+=4)W.quadraticCurveTo(D.x+rt[d+0],D.y+rt[d+1],D.x+rt[d+2],D.y+rt[d+3]),H.x=D.x+rt[d+0],H.y=D.y+rt[d+1],D.x+=rt[d+2],D.y+=rt[d+3],d===0&&Mt===!0&&ht.copy(D);break;case"t":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d+=2)R=At(D.x,H.x),B=At(D.y,H.y),W.quadraticCurveTo(R,B,D.x+rt[d+0],D.y+rt[d+1]),H.x=R,H.y=B,D.x=D.x+rt[d+0],D.y=D.y+rt[d+1],d===0&&Mt===!0&&ht.copy(D);break;case"a":for(rt=Ut(Xt),d=0,b=rt.length;d<b;d+=7)V=D.clone(),D.x+=rt[d+5],D.y+=rt[d+6],H.x=D.x,H.y=D.y,Ot(W,rt[d],rt[d+1],rt[d+2],rt[d+3],rt[d+4],V,D),d===0&&Mt===!0&&ht.copy(D);break;case"Z":case"z":W.currentPath.autoClose=!0,W.currentPath.curves.length>0&&(D.copy(ht),W.currentPath.currentPoint.copy(D),F=!0);break;default:console.warn(zt)}Mt=!1}return W}($));break;case"rect":J=St($,J),I=function(Z){var W=Ct(Z.getAttribute("x")||0),D=Ct(Z.getAttribute("y")||0),H=Ct(Z.getAttribute("rx")||0),ht=Ct(Z.getAttribute("ry")||0),F=Ct(Z.getAttribute("width")),Mt=Ct(Z.getAttribute("height")),Et=new O.ShapePath;return Et.moveTo(W+2*H,D),Et.lineTo(W+F-2*H,D),(H!==0||ht!==0)&&Et.bezierCurveTo(W+F,D,W+F,D,W+F,D+2*ht),Et.lineTo(W+F,D+Mt-2*ht),(H!==0||ht!==0)&&Et.bezierCurveTo(W+F,D+Mt,W+F,D+Mt,W+F-2*H,D+Mt),Et.lineTo(W+2*H,D+Mt),(H!==0||ht!==0)&&Et.bezierCurveTo(W,D+Mt,W,D+Mt,W,D+Mt-2*ht),Et.lineTo(W,D+2*ht),(H!==0||ht!==0)&&Et.bezierCurveTo(W,D,W,D,W+2*H,D),Et}($);break;case"polygon":J=St($,J),I=function(Z){function W(ht,F,Mt){var Et=Ct(F),Q=Ct(Mt);H===0?D.moveTo(Et,Q):D.lineTo(Et,Q),H++}var D=new O.ShapePath,H=0;return Z.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,W),D.currentPath.autoClose=!0,D}($);break;case"polyline":J=St($,J),I=function(Z){function W(ht,F,Mt){var Et=Ct(F),Q=Ct(Mt);H===0?D.moveTo(Et,Q):D.lineTo(Et,Q),H++}var D=new O.ShapePath,H=0;return Z.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,W),D.currentPath.autoClose=!1,D}($);break;case"circle":J=St($,J),I=function(Z){var W=Ct(Z.getAttribute("cx")),D=Ct(Z.getAttribute("cy")),H=Ct(Z.getAttribute("r")),ht=new O.Path;ht.absarc(W,D,H,0,2*Math.PI);var F=new O.ShapePath;return F.subPaths.push(ht),F}($);break;case"ellipse":J=St($,J),I=function(Z){var W=Ct(Z.getAttribute("cx")),D=Ct(Z.getAttribute("cy")),H=Ct(Z.getAttribute("rx")),ht=Ct(Z.getAttribute("ry")),F=new O.Path;F.absellipse(W,D,H,ht,0,2*Math.PI);var Mt=new O.ShapePath;return Mt.subPaths.push(F),Mt}($);break;case"line":J=St($,J),I=function(Z){var W=Ct(Z.getAttribute("x1")),D=Ct(Z.getAttribute("y1")),H=Ct(Z.getAttribute("x2")),ht=Ct(Z.getAttribute("y2")),F=new O.ShapePath;return F.moveTo(W,D),F.lineTo(H,ht),F.currentPath.autoClose=!1,F}($)}I&&(J.fill!==void 0&&J.fill!=="none"&&I.color.setStyle(J.fill),function(Z,W){function D(zt){Ce.set(zt.x,zt.y,1).applyMatrix3(W),zt.set(Ce.x,Ce.y)}for(var H=function(zt){return zt.elements[1]!==0||zt.elements[3]!==0}(W),ht=Z.subPaths,F=0,Mt=ht.length;F<Mt;F++)for(var Et=ht[F].curves,Q=0;Q<Et.length;Q++){var wt=Et[Q];wt.isLineCurve?(D(wt.v1),D(wt.v2)):wt.isCubicBezierCurve?(D(wt.v0),D(wt.v1),D(wt.v2),D(wt.v3)):wt.isQuadraticBezierCurve?(D(wt.v0),D(wt.v1),D(wt.v2)):wt.isEllipseCurve&&(H&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),Te.set(wt.aX,wt.aY),D(Te),wt.aX=Te.x,wt.aY=Te.y,wt.xRadius*=se(W),wt.yRadius*=ve(W))}}(I,je),le.push(I),I.userData={node:$,style:J});for(var z=$.childNodes,X=0;X<z.length;X++)tt(z[X],J);L&&(Pe.pop(),Pe.length>0?je.copy(Pe[Pe.length-1]):je.identity())}}(ft.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:le,xml:ft.documentElement}}}),pt.getStrokeStyle=function(ct,_t,Ot,Vt,St){return{strokeColor:_t=_t!==void 0?_t:"#000",strokeWidth:ct=ct!==void 0?ct:1,strokeLineJoin:Ot=Ot!==void 0?Ot:"miter",strokeLineCap:Vt=Vt!==void 0?Vt:"butt",strokeMiterLimit:St=St!==void 0?St:4}},pt.pointsToStroke=function(ct,_t,Ot,Vt){var St=[],At=[],Ut=[];if(pt.pointsToStrokeWithBuffers(ct,_t,Ot,Vt,St,At,Ut)===0)return null;var re=new O.BufferGeometry;return re.setAttribute("position",new O.Float32BufferAttribute(St,3)),re.setAttribute("normal",new O.Float32BufferAttribute(At,3)),re.setAttribute("uv",new O.Float32BufferAttribute(Ut,2)),re},pt.pointsToStrokeWithBuffers=(p=new O.Vector2,_=new O.Vector2,E=new O.Vector2,P=new O.Vector2,w=new O.Vector2,T=new O.Vector2,C=new O.Vector2,vt=new O.Vector2,Tt=new O.Vector2,Pt=new O.Vector2,G=new O.Vector2,Y=new O.Vector2,at=new O.Vector2,ut=new O.Vector2,x=new O.Vector2,S=new O.Vector2,U=new O.Vector2,function(ct,_t,Ot,Vt,St,At,Ut,re){Ot=Ot!==void 0?Ot:12,Vt=Vt!==void 0?Vt:.001,re=re!==void 0?re:0;var ie=(ct=function(bt){for(var Xt=!1,rt=1,d=bt.length-1;rt<d;rt++)if(bt[rt].distanceTo(bt[rt+1])<Vt){Xt=!0;break}if(!Xt)return bt;var b=[];for(b.push(bt[0]),rt=1,d=bt.length-1;rt<d;rt++)bt[rt].distanceTo(bt[rt+1])>=Vt&&b.push(bt[rt]);return b.push(bt[bt.length-1]),b}(ct)).length;if(ie<2)return 0;var Ct,se,ve,le,de,Pe=ct[0].equals(ct[ie-1]),Ve=ct[0],Ue=_t.strokeWidth/2,ke=1/(ie-1),he=0,Te=!1,Ce=0,je=3*re,ft=2*re;ht(ct[0],ct[1],p).multiplyScalar(Ue),vt.copy(ct[0]).sub(p),Tt.copy(ct[0]).add(p),Pt.copy(vt),G.copy(Tt);for(var tt=1;tt<ie;tt++){Ct=ct[tt],se=tt===ie-1?Pe?ct[1]:void 0:ct[tt+1];var $=p;ht(Ve,Ct,$),E.copy($).multiplyScalar(Ue),Y.copy(Ct).sub(E),at.copy(Ct).add(E);var J=he+ke;if(ve=!1,se!==void 0){ht(Ct,se,_),E.copy(_).multiplyScalar(Ue),ut.copy(Ct).sub(E),x.copy(Ct).add(E),le=!0,E.subVectors(se,Ve),$.dot(E)<0&&(le=!1),tt===1&&(Te=le),E.subVectors(se,Ct),E.normalize();var L=Math.abs($.dot(E));if(L!==0){var I=Ue/L;E.multiplyScalar(-I),P.subVectors(Ct,Ve),w.copy(P).setLength(I).add(E),S.copy(w).negate();var z=w.length(),X=P.length();P.divideScalar(X),T.subVectors(se,Ct);var Z=T.length();switch(T.divideScalar(Z),P.dot(S)<X&&T.dot(S)<Z&&(ve=!0),U.copy(w).add(Ct),S.add(Ct),de=!1,ve?le?(x.copy(S),at.copy(S)):(ut.copy(S),Y.copy(S)):Et(),_t.strokeLineJoin){case"bevel":Q(le,ve,J);break;case"round":wt(le,ve),le?Mt(Ct,Y,ut,J,0):Mt(Ct,x,at,J,1);break;case"miter":case"miter-clip":default:var W=Ue*_t.strokeMiterLimit/z;if(W<1){if(_t.strokeLineJoin!=="miter-clip"){Q(le,ve,J);break}wt(le,ve),le?(T.subVectors(U,Y).multiplyScalar(W).add(Y),C.subVectors(U,ut).multiplyScalar(W).add(ut),F(Y,J,0),F(T,J,0),F(Ct,J,.5),F(Ct,J,.5),F(T,J,0),F(C,J,0),F(Ct,J,.5),F(C,J,0),F(ut,J,0)):(T.subVectors(U,at).multiplyScalar(W).add(at),C.subVectors(U,x).multiplyScalar(W).add(x),F(at,J,1),F(T,J,1),F(Ct,J,.5),F(Ct,J,.5),F(T,J,1),F(C,J,1),F(Ct,J,.5),F(C,J,1),F(x,J,1))}else ve?(le?(F(Tt,he,1),F(vt,he,0),F(U,J,0),F(Tt,he,1),F(U,J,0),F(S,J,1)):(F(Tt,he,1),F(vt,he,0),F(U,J,1),F(vt,he,0),F(S,J,0),F(U,J,1)),le?ut.copy(U):x.copy(U)):le?(F(Y,J,0),F(U,J,0),F(Ct,J,.5),F(Ct,J,.5),F(U,J,0),F(ut,J,0)):(F(at,J,1),F(U,J,1),F(Ct,J,.5),F(Ct,J,.5),F(U,J,1),F(x,J,1)),de=!0}}else Et()}else Et();Pe||tt!==ie-1||zt(ct[0],Pt,G,le,!0,he),he=J,Ve=Ct,vt.copy(ut),Tt.copy(x)}if(Pe){if(ve&&St){var D=U,H=S;Te!==le&&(D=S,H=U),le?(de||Te)&&(H.toArray(St,0),H.toArray(St,9),de&&D.toArray(St,3)):!de&&Te||(H.toArray(St,3),H.toArray(St,9),de&&D.toArray(St,0))}}else zt(Ct,Y,at,le,!1,J);return Ce;function ht(bt,Xt,rt){return rt.subVectors(Xt,bt),rt.set(-rt.y,rt.x).normalize()}function F(bt,Xt,rt){St&&(St[je]=bt.x,St[je+1]=bt.y,St[je+2]=0,At&&(At[je]=0,At[je+1]=0,At[je+2]=1),je+=3,Ut&&(Ut[ft]=Xt,Ut[ft+1]=rt,ft+=2)),Ce+=3}function Mt(bt,Xt,rt,d,b){p.copy(Xt).sub(bt).normalize(),_.copy(rt).sub(bt).normalize();var R=Math.PI,B=p.dot(_);Math.abs(B)<1&&(R=Math.abs(Math.acos(B))),R/=Ot,E.copy(Xt);for(var V=0,it=Ot-1;V<it;V++)P.copy(E).rotateAround(bt,R),F(E,d,b),F(P,d,b),F(bt,d,.5),E.copy(P);F(P,d,b),F(rt,d,b),F(bt,d,.5)}function Et(){F(Tt,he,1),F(vt,he,0),F(Y,J,0),F(Tt,he,1),F(Y,J,1),F(at,J,0)}function Q(bt,Xt,rt){Xt?bt?(F(Tt,he,1),F(vt,he,0),F(Y,J,0),F(Tt,he,1),F(Y,J,0),F(S,J,1),F(Y,rt,0),F(ut,rt,0),F(S,rt,.5)):(F(Tt,he,1),F(vt,he,0),F(at,J,1),F(vt,he,0),F(S,J,0),F(at,J,1),F(at,rt,1),F(x,rt,0),F(S,rt,.5)):bt?(F(Y,rt,0),F(ut,rt,0),F(Ct,rt,.5)):(F(at,rt,1),F(x,rt,0),F(Ct,rt,.5))}function wt(bt,Xt){Xt&&(bt?(F(Tt,he,1),F(vt,he,0),F(Y,J,0),F(Tt,he,1),F(Y,J,0),F(S,J,1),F(Y,he,0),F(Ct,J,.5),F(S,J,1),F(Ct,J,.5),F(ut,he,0),F(S,J,1)):(F(Tt,he,1),F(vt,he,0),F(at,J,1),F(vt,he,0),F(S,J,0),F(at,J,1),F(at,he,1),F(S,J,0),F(Ct,J,.5),F(Ct,J,.5),F(S,J,0),F(x,he,1)))}function zt(bt,Xt,rt,d,b,R){switch(_t.strokeLineCap){case"round":b?Mt(bt,rt,Xt,R,.5):Mt(bt,Xt,rt,R,.5);break;case"square":if(b)p.subVectors(Xt,bt),_.set(p.y,-p.x),E.addVectors(p,_).add(bt),P.subVectors(_,p).add(bt),d?(E.toArray(St,3),P.toArray(St,0),P.toArray(St,9)):(E.toArray(St,3),E.toArray(St,9),P.toArray(St,0));else{p.subVectors(rt,bt),_.set(p.y,-p.x),E.addVectors(p,_).add(bt),P.subVectors(_,p).add(bt);var B=St.length;d?(E.toArray(St,B-3),P.toArray(St,B-6),P.toArray(St,B-12)):(E.toArray(St,B-6),P.toArray(St,B-3),P.toArray(St,B-12))}}}})},function(ee,v,f){f.r(v),f.d(v,"VRButton",function(){return p});var p={createButton:function(_,E){function P(){T.style.display="",T.style.cursor="auto",T.style.left="calc(50% - 75px)",T.style.width="150px",T.onmouseenter=null,T.onmouseleave=null,T.onclick=null,T.textContent="VR NOT SUPPORTED"}function w(vt){vt.style.position="absolute",vt.style.bottom="20px",vt.style.padding="12px 6px",vt.style.border="1px solid #fff",vt.style.borderRadius="4px",vt.style.background="rgba(0,0,0,0.1)",vt.style.color="#fff",vt.style.font="normal 13px sans-serif",vt.style.textAlign="center",vt.style.opacity="0.5",vt.style.outline="none",vt.style.zIndex="999"}if(E&&console.error('THREE.VRButton: The "options" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.'),"xr"in navigator){var T=document.createElement("button");return T.style.display="none",w(T),navigator.xr.isSessionSupported("immersive-vr").then(function(vt){vt?function(){var Tt=null;function Pt(Y){Y.addEventListener("end",G),_.xr.setSession(Y),T.textContent="EXIT VR",Tt=Y}function G(){Tt.removeEventListener("end",G),T.textContent="ENTER VR",Tt=null}T.style.display="",T.style.cursor="pointer",T.style.left="calc(50% - 50px)",T.style.width="100px",T.textContent="ENTER VR",T.onmouseenter=function(){T.style.opacity="1.0"},T.onmouseleave=function(){T.style.opacity="0.5"},T.onclick=function(){Tt===null?navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor"]}).then(Pt):Tt.end()}}():P()}),T}var C=document.createElement("a");return window.isSecureContext===!1?(C.href=document.location.href.replace(/^http:/,"https:"),C.innerHTML="WEBXR NEEDS HTTPS"):(C.href="https://immersiveweb.dev/",C.innerHTML="WEBXR NOT AVAILABLE"),C.style.left="calc(50% - 90px)",C.style.width="180px",C.style.textDecoration="none",w(C),C}}},function(ee,v,f){f.r(v),f.d(v,"Sky",function(){return _});var p=f(0),_=function(){var E=_.SkyShader,P=new p.ShaderMaterial({fragmentShader:E.fragmentShader,vertexShader:E.vertexShader,uniforms:p.UniformsUtils.clone(E.uniforms),side:p.BackSide,depthWrite:!1});p.Mesh.call(this,new p.BoxBufferGeometry(1,1,1),P)};_.prototype=Object.create(p.Mesh.prototype),_.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new p.Vector3},up:{value:new p.Vector3(0,1,0)}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","uniform vec3 up;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","	zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","	return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","	float c = ( 0.2 * T ) * 10E-18;","	return 0.434 * c * MieConst;","}","void main() {","	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","	vWorldPosition = worldPosition.xyz;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","	gl_Position.z = gl_Position.w;","	vSunDirection = normalize( sunPosition );","	vSunE = sunIntensity( dot( vSunDirection, up ) );","	vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","	float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","	vBetaR = totalRayleigh * rayleighCoefficient;","	vBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join(`
`),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","uniform vec3 up;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","	return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","	float g2 = pow( g, 2.0 );","	float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","	return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","	return ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","	vec3 direction = normalize( vWorldPosition - cameraPos );","	float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );","	float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","	float sR = rayleighZenithLength * inverse;","	float sM = mieZenithLength * inverse;","	vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","	float cosTheta = dot( direction, vSunDirection );","	float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","	vec3 betaRTheta = vBetaR * rPhase;","	float mPhase = hgPhase( cosTheta, mieDirectionalG );","	vec3 betaMTheta = vBetaM * mPhase;","	vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","	Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","	float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]","	float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]","	vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","	vec3 L0 = vec3( 0.1 ) * Fex;","	float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","	L0 += ( vSunE * 19000.0 * Fex ) * sundisk;","	vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","	vec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","	vec3 color = curr * whiteScale;","	vec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","	gl_FragColor = vec4( retColor, 1.0 );","}"].join(`
`)}},function(ee,v,f){f.r(v),f.d(v,"OrbitControls",function(){return _}),f.d(v,"MapControls",function(){return E});var p=f(0),_=function(P,w){var T,C,vt,Tt,Pt;w===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),w===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=P,this.domElement=w,this.enabled=!0,this.target=new p.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:p.MOUSE.ROTATE,MIDDLE:p.MOUSE.DOLLY,RIGHT:p.MOUSE.PAN},this.touches={ONE:p.TOUCH.ROTATE,TWO:p.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return O.phi},this.getAzimuthalAngle=function(){return O.theta},this.saveState=function(){G.target0.copy(G.target),G.position0.copy(G.object.position),G.zoom0=G.object.zoom},this.reset=function(){G.target.copy(G.target0),G.object.position.copy(G.position0),G.object.zoom=G.zoom0,G.object.updateProjectionMatrix(),G.dispatchEvent(Y),G.update(),S=x.NONE},this.update=(T=new p.Vector3,C=new p.Quaternion().setFromUnitVectors(P.up,new p.Vector3(0,1,0)),vt=C.clone().inverse(),Tt=new p.Vector3,Pt=new p.Quaternion,function(){var Q=G.object.position;return T.copy(Q).sub(G.target),T.applyQuaternion(C),O.setFromVector3(T),G.autoRotate&&S===x.NONE&&de(2*Math.PI/60/60*G.autoRotateSpeed),G.enableDamping?(O.theta+=pt.theta*G.dampingFactor,O.phi+=pt.phi*G.dampingFactor):(O.theta+=pt.theta,O.phi+=pt.phi),O.theta=Math.max(G.minAzimuthAngle,Math.min(G.maxAzimuthAngle,O.theta)),O.phi=Math.max(G.minPolarAngle,Math.min(G.maxPolarAngle,O.phi)),O.makeSafe(),O.radius*=ct,O.radius=Math.max(G.minDistance,Math.min(G.maxDistance,O.radius)),G.enableDamping===!0?G.target.addScaledVector(_t,G.dampingFactor):G.target.add(_t),T.setFromSpherical(O),T.applyQuaternion(vt),Q.copy(G.target).add(T),G.object.lookAt(G.target),G.enableDamping===!0?(pt.theta*=1-G.dampingFactor,pt.phi*=1-G.dampingFactor,_t.multiplyScalar(1-G.dampingFactor)):(pt.set(0,0,0),_t.set(0,0,0)),ct=1,!!(Ot||Tt.distanceToSquared(G.object.position)>U||8*(1-Pt.dot(G.object.quaternion))>U)&&(G.dispatchEvent(Y),Tt.copy(G.object.position),Pt.copy(G.object.quaternion),Ot=!1,!0)}),this.dispose=function(){G.domElement.removeEventListener("contextmenu",Et,!1),G.domElement.removeEventListener("mousedown",X,!1),G.domElement.removeEventListener("wheel",D,!1),G.domElement.removeEventListener("touchstart",ht,!1),G.domElement.removeEventListener("touchend",Mt,!1),G.domElement.removeEventListener("touchmove",F,!1),document.removeEventListener("mousemove",Z,!1),document.removeEventListener("mouseup",W,!1),G.domElement.removeEventListener("keydown",H,!1)};var G=this,Y={type:"change"},at={type:"start"},ut={type:"end"},x={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},S=x.NONE,U=1e-6,O=new p.Spherical,pt=new p.Spherical,ct=1,_t=new p.Vector3,Ot=!1,Vt=new p.Vector2,St=new p.Vector2,At=new p.Vector2,Ut=new p.Vector2,re=new p.Vector2,ie=new p.Vector2,Ct=new p.Vector2,se=new p.Vector2,ve=new p.Vector2;function le(){return Math.pow(.95,G.zoomSpeed)}function de(Q){pt.theta-=Q}function Pe(Q){pt.phi-=Q}var Ve,Ue=(Ve=new p.Vector3,function(Q,wt){Ve.setFromMatrixColumn(wt,0),Ve.multiplyScalar(-Q),_t.add(Ve)}),ke=function(){var Q=new p.Vector3;return function(wt,zt){G.screenSpacePanning===!0?Q.setFromMatrixColumn(zt,1):(Q.setFromMatrixColumn(zt,0),Q.crossVectors(G.object.up,Q)),Q.multiplyScalar(wt),_t.add(Q)}}(),he=function(){var Q=new p.Vector3;return function(wt,zt){var bt=G.domElement;if(G.object.isPerspectiveCamera){var Xt=G.object.position;Q.copy(Xt).sub(G.target);var rt=Q.length();rt*=Math.tan(G.object.fov/2*Math.PI/180),Ue(2*wt*rt/bt.clientHeight,G.object.matrix),ke(2*zt*rt/bt.clientHeight,G.object.matrix)}else G.object.isOrthographicCamera?(Ue(wt*(G.object.right-G.object.left)/G.object.zoom/bt.clientWidth,G.object.matrix),ke(zt*(G.object.top-G.object.bottom)/G.object.zoom/bt.clientHeight,G.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),G.enablePan=!1)}}();function Te(Q){G.object.isPerspectiveCamera?ct/=Q:G.object.isOrthographicCamera?(G.object.zoom=Math.max(G.minZoom,Math.min(G.maxZoom,G.object.zoom*Q)),G.object.updateProjectionMatrix(),Ot=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),G.enableZoom=!1)}function Ce(Q){G.object.isPerspectiveCamera?ct*=Q:G.object.isOrthographicCamera?(G.object.zoom=Math.max(G.minZoom,Math.min(G.maxZoom,G.object.zoom/Q)),G.object.updateProjectionMatrix(),Ot=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),G.enableZoom=!1)}function je(Q){Vt.set(Q.clientX,Q.clientY)}function ft(Q){Ut.set(Q.clientX,Q.clientY)}function tt(Q){if(Q.touches.length==1)Vt.set(Q.touches[0].pageX,Q.touches[0].pageY);else{var wt=.5*(Q.touches[0].pageX+Q.touches[1].pageX),zt=.5*(Q.touches[0].pageY+Q.touches[1].pageY);Vt.set(wt,zt)}}function $(Q){if(Q.touches.length==1)Ut.set(Q.touches[0].pageX,Q.touches[0].pageY);else{var wt=.5*(Q.touches[0].pageX+Q.touches[1].pageX),zt=.5*(Q.touches[0].pageY+Q.touches[1].pageY);Ut.set(wt,zt)}}function J(Q){var wt=Q.touches[0].pageX-Q.touches[1].pageX,zt=Q.touches[0].pageY-Q.touches[1].pageY,bt=Math.sqrt(wt*wt+zt*zt);Ct.set(0,bt)}function L(Q){if(Q.touches.length==1)St.set(Q.touches[0].pageX,Q.touches[0].pageY);else{var wt=.5*(Q.touches[0].pageX+Q.touches[1].pageX),zt=.5*(Q.touches[0].pageY+Q.touches[1].pageY);St.set(wt,zt)}At.subVectors(St,Vt).multiplyScalar(G.rotateSpeed);var bt=G.domElement;de(2*Math.PI*At.x/bt.clientHeight),Pe(2*Math.PI*At.y/bt.clientHeight),Vt.copy(St)}function I(Q){if(Q.touches.length==1)re.set(Q.touches[0].pageX,Q.touches[0].pageY);else{var wt=.5*(Q.touches[0].pageX+Q.touches[1].pageX),zt=.5*(Q.touches[0].pageY+Q.touches[1].pageY);re.set(wt,zt)}ie.subVectors(re,Ut).multiplyScalar(G.panSpeed),he(ie.x,ie.y),Ut.copy(re)}function z(Q){var wt=Q.touches[0].pageX-Q.touches[1].pageX,zt=Q.touches[0].pageY-Q.touches[1].pageY,bt=Math.sqrt(wt*wt+zt*zt);se.set(0,bt),ve.set(0,Math.pow(se.y/Ct.y,G.zoomSpeed)),Te(ve.y),Ct.copy(se)}function X(Q){if(G.enabled!==!1){var wt;switch(Q.preventDefault(),G.domElement.focus?G.domElement.focus():window.focus(),Q.button){case 0:wt=G.mouseButtons.LEFT;break;case 1:wt=G.mouseButtons.MIDDLE;break;case 2:wt=G.mouseButtons.RIGHT;break;default:wt=-1}switch(wt){case p.MOUSE.DOLLY:if(G.enableZoom===!1)return;!function(zt){Ct.set(zt.clientX,zt.clientY)}(Q),S=x.DOLLY;break;case p.MOUSE.ROTATE:if(Q.ctrlKey||Q.metaKey||Q.shiftKey){if(G.enablePan===!1)return;ft(Q),S=x.PAN}else{if(G.enableRotate===!1)return;je(Q),S=x.ROTATE}break;case p.MOUSE.PAN:if(Q.ctrlKey||Q.metaKey||Q.shiftKey){if(G.enableRotate===!1)return;je(Q),S=x.ROTATE}else{if(G.enablePan===!1)return;ft(Q),S=x.PAN}break;default:S=x.NONE}S!==x.NONE&&(document.addEventListener("mousemove",Z,!1),document.addEventListener("mouseup",W,!1),G.dispatchEvent(at))}}function Z(Q){if(G.enabled!==!1)switch(Q.preventDefault(),S){case x.ROTATE:if(G.enableRotate===!1)return;!function(wt){St.set(wt.clientX,wt.clientY),At.subVectors(St,Vt).multiplyScalar(G.rotateSpeed);var zt=G.domElement;de(2*Math.PI*At.x/zt.clientHeight),Pe(2*Math.PI*At.y/zt.clientHeight),Vt.copy(St),G.update()}(Q);break;case x.DOLLY:if(G.enableZoom===!1)return;!function(wt){se.set(wt.clientX,wt.clientY),ve.subVectors(se,Ct),ve.y>0?Te(le()):ve.y<0&&Ce(le()),Ct.copy(se),G.update()}(Q);break;case x.PAN:if(G.enablePan===!1)return;!function(wt){re.set(wt.clientX,wt.clientY),ie.subVectors(re,Ut).multiplyScalar(G.panSpeed),he(ie.x,ie.y),Ut.copy(re),G.update()}(Q)}}function W(Q){G.enabled!==!1&&(document.removeEventListener("mousemove",Z,!1),document.removeEventListener("mouseup",W,!1),G.dispatchEvent(ut),S=x.NONE)}function D(Q){G.enabled===!1||G.enableZoom===!1||S!==x.NONE&&S!==x.ROTATE||(Q.preventDefault(),Q.stopPropagation(),G.dispatchEvent(at),function(wt){wt.deltaY<0?Ce(le()):wt.deltaY>0&&Te(le()),G.update()}(Q),G.dispatchEvent(ut))}function H(Q){G.enabled!==!1&&G.enableKeys!==!1&&G.enablePan!==!1&&function(wt){var zt=!1;switch(wt.keyCode){case G.keys.UP:he(0,G.keyPanSpeed),zt=!0;break;case G.keys.BOTTOM:he(0,-G.keyPanSpeed),zt=!0;break;case G.keys.LEFT:he(G.keyPanSpeed,0),zt=!0;break;case G.keys.RIGHT:he(-G.keyPanSpeed,0),zt=!0}zt&&(wt.preventDefault(),G.update())}(Q)}function ht(Q){if(G.enabled!==!1){switch(Q.preventDefault(),Q.touches.length){case 1:switch(G.touches.ONE){case p.TOUCH.ROTATE:if(G.enableRotate===!1)return;tt(Q),S=x.TOUCH_ROTATE;break;case p.TOUCH.PAN:if(G.enablePan===!1)return;$(Q),S=x.TOUCH_PAN;break;default:S=x.NONE}break;case 2:switch(G.touches.TWO){case p.TOUCH.DOLLY_PAN:if(G.enableZoom===!1&&G.enablePan===!1)return;!function(wt){G.enableZoom&&J(wt),G.enablePan&&$(wt)}(Q),S=x.TOUCH_DOLLY_PAN;break;case p.TOUCH.DOLLY_ROTATE:if(G.enableZoom===!1&&G.enableRotate===!1)return;!function(wt){G.enableZoom&&J(wt),G.enableRotate&&tt(wt)}(Q),S=x.TOUCH_DOLLY_ROTATE;break;default:S=x.NONE}break;default:S=x.NONE}S!==x.NONE&&G.dispatchEvent(at)}}function F(Q){if(G.enabled!==!1)switch(Q.preventDefault(),Q.stopPropagation(),S){case x.TOUCH_ROTATE:if(G.enableRotate===!1)return;L(Q),G.update();break;case x.TOUCH_PAN:if(G.enablePan===!1)return;I(Q),G.update();break;case x.TOUCH_DOLLY_PAN:if(G.enableZoom===!1&&G.enablePan===!1)return;!function(wt){G.enableZoom&&z(wt),G.enablePan&&I(wt)}(Q),G.update();break;case x.TOUCH_DOLLY_ROTATE:if(G.enableZoom===!1&&G.enableRotate===!1)return;!function(wt){G.enableZoom&&z(wt),G.enableRotate&&L(wt)}(Q),G.update();break;default:S=x.NONE}}function Mt(Q){G.enabled!==!1&&(G.dispatchEvent(ut),S=x.NONE)}function Et(Q){G.enabled!==!1&&Q.preventDefault()}G.domElement.addEventListener("contextmenu",Et,!1),G.domElement.addEventListener("mousedown",X,!1),G.domElement.addEventListener("wheel",D,!1),G.domElement.addEventListener("touchstart",ht,!1),G.domElement.addEventListener("touchend",Mt,!1),G.domElement.addEventListener("touchmove",F,!1),G.domElement.addEventListener("keydown",H,!1),G.domElement.tabIndex===-1&&(G.domElement.tabIndex=0),this.update()};_.prototype=Object.create(p.EventDispatcher.prototype),_.prototype.constructor=_;var E=function(P,w){_.call(this,P,w),this.mouseButtons.LEFT=p.MOUSE.PAN,this.mouseButtons.RIGHT=p.MOUSE.ROTATE,this.touches.ONE=p.TOUCH.PAN,this.touches.TWO=p.TOUCH.DOLLY_ROTATE};E.prototype=Object.create(p.EventDispatcher.prototype),E.prototype.constructor=E},function(ee,v,f){f.r(v),f.d(v,"WEBGL",function(){return p});var p={isWebGLAvailable:function(){try{var _=document.createElement("canvas");return!(!window.WebGLRenderingContext||!_.getContext("webgl")&&!_.getContext("experimental-webgl"))}catch(E){return!1}},isWebGL2Available:function(){try{var _=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!_.getContext("webgl2"))}catch(E){return!1}},getWebGLErrorMessage:function(){return this.getErrorMessage(1)},getWebGL2ErrorMessage:function(){return this.getErrorMessage(2)},getErrorMessage:function(_){var E={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext},P='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>',w=document.createElement("div");return w.id="webglmessage",w.style.fontFamily="monospace",w.style.fontSize="13px",w.style.fontWeight="normal",w.style.textAlign="center",w.style.background="#fff",w.style.color="#000",w.style.padding="1.5em",w.style.width="400px",w.style.margin="5em auto 0",P=(P=E[_]?P.replace("$0","graphics card"):P.replace("$0","browser")).replace("$1",{1:"WebGL",2:"WebGL 2"}[_]),w.innerHTML=P,w}}},function(ee,v,f){f.r(v),f.d(v,"FBXLoader",function(){return je});var p=f(0),_={},E=_;/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */function P(ft,tt){var $,J=ft.split("."),L=E;for(!(J[0]in L)&&L.execScript&&L.execScript("var "+J[0]);J.length&&($=J.shift());)J.length||tt===void 0?L=L[$]?L[$]:L[$]={}:L[$]=tt}var w=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined"&&typeof DataView!="undefined";function T(ft){var tt,$,J,L,I,z,X,Z,W,D,H=ft.length,ht=0,F=Number.POSITIVE_INFINITY;for(Z=0;Z<H;++Z)ft[Z]>ht&&(ht=ft[Z]),ft[Z]<F&&(F=ft[Z]);for(tt=1<<ht,$=new(w?Uint32Array:Array)(tt),J=1,L=0,I=2;J<=ht;){for(Z=0;Z<H;++Z)if(ft[Z]===J){for(z=0,X=L,W=0;W<J;++W)z=z<<1|1&X,X>>=1;for(D=J<<16|Z,W=z;W<tt;W+=I)$[W]=D;++L}++J,L<<=1,I<<=1}return[$,ht,F]}function C(ft,tt){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=w?new Uint8Array(ft):ft,this.m=!1,this.i=Tt,this.r=!1,!tt&&(tt={})||(tt.index&&(this.a=tt.index),tt.bufferSize&&(this.h=tt.bufferSize),tt.bufferType&&(this.i=tt.bufferType),tt.resize&&(this.r=tt.resize)),this.i){case vt:this.b=32768,this.c=new(w?Uint8Array:Array)(32768+this.h+258);break;case Tt:this.b=0,this.c=new(w?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var vt=0,Tt=1,Pt={t:vt,s:Tt};C.prototype.k=function(){for(;!this.m;){var ft=Ct(this,3);switch(1&ft&&(this.m=!0),ft>>>=1){case 0:var tt=this.input,$=this.a,J=this.c,L=this.b,I=tt.length,z=void 0,X=J.length,Z=void 0;if(this.d=this.f=0,$+1>=I)throw Error("invalid uncompressed block header: LEN");if(z=tt[$++]|tt[$++]<<8,$+1>=I)throw Error("invalid uncompressed block header: NLEN");if(z===~(tt[$++]|tt[$++]<<8))throw Error("invalid uncompressed block header: length verify");if($+z>tt.length)throw Error("input buffer is broken");switch(this.i){case vt:for(;L+z>J.length;){if(z-=Z=X-L,w)J.set(tt.subarray($,$+Z),L),L+=Z,$+=Z;else for(;Z--;)J[L++]=tt[$++];this.b=L,J=this.e(),L=this.b}break;case Tt:for(;L+z>J.length;)J=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(w)J.set(tt.subarray($,$+z),L),L+=z,$+=z;else for(;z--;)J[L++]=tt[$++];this.a=$,this.b=L,this.c=J;break;case 1:this.j(Ut,ie);break;case 2:var W,D,H,ht,F=Ct(this,5)+257,Mt=Ct(this,5)+1,Et=Ct(this,4)+4,Q=new(w?Uint8Array:Array)(ut.length),wt=void 0,zt=void 0,bt=void 0,Xt=void 0,rt=void 0;for(rt=0;rt<Et;++rt)Q[ut[rt]]=Ct(this,3);if(!w)for(rt=Et,Et=Q.length;rt<Et;++rt)Q[ut[rt]]=0;for(W=T(Q),wt=new(w?Uint8Array:Array)(F+Mt),rt=0,ht=F+Mt;rt<ht;)switch(zt=se(this,W),zt){case 16:for(Xt=3+Ct(this,2);Xt--;)wt[rt++]=bt;break;case 17:for(Xt=3+Ct(this,3);Xt--;)wt[rt++]=0;bt=0;break;case 18:for(Xt=11+Ct(this,7);Xt--;)wt[rt++]=0;bt=0;break;default:bt=wt[rt++]=zt}D=T(w?wt.subarray(0,F):wt.slice(0,F)),H=T(w?wt.subarray(F):wt.slice(F)),this.j(D,H);break;default:throw Error("unknown BTYPE: "+ft)}}return this.n()};var G,Y,at=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ut=w?new Uint16Array(at):at,x=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],S=w?new Uint16Array(x):x,U=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],O=w?new Uint8Array(U):U,pt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],ct=w?new Uint16Array(pt):pt,_t=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ot=w?new Uint8Array(_t):_t,Vt=new(w?Uint8Array:Array)(288);for(G=0,Y=Vt.length;G<Y;++G)Vt[G]=143>=G?8:255>=G?9:279>=G?7:8;var St,At,Ut=T(Vt),re=new(w?Uint8Array:Array)(30);for(St=0,At=re.length;St<At;++St)re[St]=5;var ie=T(re);function Ct(ft,tt){for(var $,J=ft.f,L=ft.d,I=ft.input,z=ft.a,X=I.length;L<tt;){if(z>=X)throw Error("input buffer is broken");J|=I[z++]<<L,L+=8}return $=J&(1<<tt)-1,ft.f=J>>>tt,ft.d=L-tt,ft.a=z,$}function se(ft,tt){for(var $,J,L=ft.f,I=ft.d,z=ft.input,X=ft.a,Z=z.length,W=tt[0],D=tt[1];I<D&&!(X>=Z);)L|=z[X++]<<I,I+=8;if((J=($=W[L&(1<<D)-1])>>>16)>I)throw Error("invalid code length: "+J);return ft.f=L>>J,ft.d=I-J,ft.a=X,65535&$}function ve(ft,tt){var $,J;switch(this.input=ft,this.a=0,!tt&&(tt={})||(tt.index&&(this.a=tt.index),tt.verify&&(this.A=tt.verify)),$=ft[this.a++],J=ft[this.a++],15&$){case le:this.method=le;break;default:throw Error("unsupported compression method")}if((($<<8)+J)%31!=0)throw Error("invalid fcheck flag:"+(($<<8)+J)%31);if(32&J)throw Error("fdict flag is not supported");this.q=new C(ft,{index:this.a,bufferSize:tt.bufferSize,bufferType:tt.bufferType,resize:tt.resize})}C.prototype.j=function(ft,tt){var $=this.c,J=this.b;this.o=ft;for(var L,I,z,X,Z=$.length-258;(L=se(this,ft))!==256;)if(256>L)J>=Z&&(this.b=J,$=this.e(),J=this.b),$[J++]=L;else for(X=S[I=L-257],0<O[I]&&(X+=Ct(this,O[I])),L=se(this,tt),z=ct[L],0<Ot[L]&&(z+=Ct(this,Ot[L])),J>=Z&&(this.b=J,$=this.e(),J=this.b);X--;)$[J]=$[J++-z];for(;8<=this.d;)this.d-=8,this.a--;this.b=J},C.prototype.w=function(ft,tt){var $=this.c,J=this.b;this.o=ft;for(var L,I,z,X,Z=$.length;(L=se(this,ft))!==256;)if(256>L)J>=Z&&(Z=($=this.e()).length),$[J++]=L;else for(X=S[I=L-257],0<O[I]&&(X+=Ct(this,O[I])),L=se(this,tt),z=ct[L],0<Ot[L]&&(z+=Ct(this,Ot[L])),J+X>Z&&(Z=($=this.e()).length);X--;)$[J]=$[J++-z];for(;8<=this.d;)this.d-=8,this.a--;this.b=J},C.prototype.e=function(){var ft,tt,$=new(w?Uint8Array:Array)(this.b-32768),J=this.b-32768,L=this.c;if(w)$.set(L.subarray(32768,$.length));else for(ft=0,tt=$.length;ft<tt;++ft)$[ft]=L[ft+32768];if(this.g.push($),this.l+=$.length,w)L.set(L.subarray(J,J+32768));else for(ft=0;32768>ft;++ft)L[ft]=L[J+ft];return this.b=32768,L},C.prototype.z=function(ft){var tt,$,J,L=this.input.length/this.a+1|0,I=this.input,z=this.c;return ft&&(typeof ft.p=="number"&&(L=ft.p),typeof ft.u=="number"&&(L+=ft.u)),2>L?$=(J=(I.length-this.a)/this.o[2]/2*258|0)<z.length?z.length+J:z.length<<1:$=z.length*L,w?(tt=new Uint8Array($)).set(z):tt=z,this.c=tt},C.prototype.n=function(){var ft,tt,$,J,L,I=0,z=this.c,X=this.g,Z=new(w?Uint8Array:Array)(this.l+(this.b-32768));if(X.length===0)return w?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(tt=0,$=X.length;tt<$;++tt)for(J=0,L=(ft=X[tt]).length;J<L;++J)Z[I++]=ft[J];for(tt=32768,$=this.b;tt<$;++tt)Z[I++]=z[tt];return this.g=[],this.buffer=Z},C.prototype.v=function(){var ft,tt=this.b;return w?this.r?(ft=new Uint8Array(tt)).set(this.c.subarray(0,tt)):ft=this.c.subarray(0,tt):(this.c.length>tt&&(this.c.length=tt),ft=this.c),this.buffer=ft},ve.prototype.k=function(){var ft,tt,$=this.input;if(ft=this.q.k(),this.a=this.q.a,this.A){tt=($[this.a++]<<24|$[this.a++]<<16|$[this.a++]<<8|$[this.a++])>>>0;var J=ft;if(typeof J=="string"){var L,I,z=J.split("");for(L=0,I=z.length;L<I;L++)z[L]=(255&z[L].charCodeAt(0))>>>0;J=z}for(var X,Z=1,W=0,D=J.length,H=0;0<D;){D-=X=1024<D?1024:D;do W+=Z+=J[H++];while(--X);Z%=65521,W%=65521}if(tt!==(W<<16|Z)>>>0)throw Error("invalid adler-32 checksum")}return ft};var le=8;P("Zlib.Inflate",ve),P("Zlib.Inflate.prototype.decompress",ve.prototype.k);var de,Pe,Ve,Ue,ke={ADAPTIVE:Pt.s,BLOCK:Pt.t};if(Object.keys)de=Object.keys(ke);else for(Pe in de=[],Ve=0,ke)de[Ve++]=Pe;for(Ve=0,Ue=de.length;Ve<Ue;++Ve)P("Zlib.Inflate.BufferType."+(Pe=de[Ve]),ke[Pe]);var he=_.Zlib,Te={findSpan:function(ft,tt,$){var J=$.length-ft-1;if(tt>=$[J])return J-1;if(tt<=$[ft])return ft;for(var L=ft,I=J,z=Math.floor((L+I)/2);tt<$[z]||tt>=$[z+1];)tt<$[z]?I=z:L=z,z=Math.floor((L+I)/2);return z},calcBasisFunctions:function(ft,tt,$,J){var L=[],I=[],z=[];L[0]=1;for(var X=1;X<=$;++X){I[X]=tt-J[ft+1-X],z[X]=J[ft+X]-tt;for(var Z=0,W=0;W<X;++W){var D=z[W+1],H=I[X-W],ht=L[W]/(D+H);L[W]=Z+D*ht,Z=H*ht}L[X]=Z}return L},calcBSplinePoint:function(ft,tt,$,J){for(var L=this.findSpan(ft,J,tt),I=this.calcBasisFunctions(L,J,ft,tt),z=new p.Vector4(0,0,0,0),X=0;X<=ft;++X){var Z=$[L-ft+X],W=I[X],D=Z.w*W;z.x+=Z.x*D,z.y+=Z.y*D,z.z+=Z.z*D,z.w+=Z.w*W}return z},calcBasisFunctionDerivatives:function(ft,tt,$,J,L){for(var I=[],z=0;z<=$;++z)I[z]=0;var X=[];for(z=0;z<=J;++z)X[z]=I.slice(0);var Z=[];for(z=0;z<=$;++z)Z[z]=I.slice(0);Z[0][0]=1;for(var W=I.slice(0),D=I.slice(0),H=1;H<=$;++H){W[H]=tt-L[ft+1-H],D[H]=L[ft+H]-tt;for(var ht=0,F=0;F<H;++F){var Mt=D[F+1],Et=W[H-F];Z[H][F]=Mt+Et;var Q=Z[F][H-1]/Z[H][F];Z[F][H]=ht+Mt*Q,ht=Et*Q}Z[H][H]=ht}for(H=0;H<=$;++H)X[0][H]=Z[H][$];for(F=0;F<=$;++F){var wt=0,zt=1,bt=[];for(z=0;z<=$;++z)bt[z]=I.slice(0);bt[0][0]=1;for(var Xt=1;Xt<=J;++Xt){var rt=0,d=F-Xt,b=$-Xt;F>=Xt&&(bt[zt][0]=bt[wt][0]/Z[b+1][d],rt=bt[zt][0]*Z[d][b]);var R=F-1<=b?Xt-1:$-F;for(H=d>=-1?1:-d;H<=R;++H)bt[zt][H]=(bt[wt][H]-bt[wt][H-1])/Z[b+1][d+H],rt+=bt[zt][H]*Z[d+H][b];F<=b&&(bt[zt][Xt]=-bt[wt][Xt-1]/Z[b+1][F],rt+=bt[zt][Xt]*Z[F][b]),X[Xt][F]=rt,H=wt,wt=zt,zt=H}}for(F=$,Xt=1;Xt<=J;++Xt){for(H=0;H<=$;++H)X[Xt][H]*=F;F*=$-Xt}return X},calcBSplineDerivatives:function(ft,tt,$,J,L){for(var I=L<ft?L:ft,z=[],X=this.findSpan(ft,J,tt),Z=this.calcBasisFunctionDerivatives(X,J,ft,I,tt),W=[],D=0;D<$.length;++D){var H=(F=$[D].clone()).w;F.x*=H,F.y*=H,F.z*=H,W[D]=F}for(var ht=0;ht<=I;++ht){for(var F=W[X-ft].clone().multiplyScalar(Z[ht][0]),Mt=1;Mt<=ft;++Mt)F.add(W[X-ft+Mt].clone().multiplyScalar(Z[ht][Mt]));z[ht]=F}for(ht=I+1;ht<=L+1;++ht)z[ht]=new p.Vector4(0,0,0);return z},calcKoverI:function(ft,tt){for(var $=1,J=2;J<=ft;++J)$*=J;var L=1;for(J=2;J<=tt;++J)L*=J;for(J=2;J<=ft-tt;++J)L*=J;return $/L},calcRationalCurveDerivatives:function(ft){for(var tt=ft.length,$=[],J=[],L=0;L<tt;++L){var I=ft[L];$[L]=new p.Vector3(I.x,I.y,I.z),J[L]=I.w}for(var z=[],X=0;X<tt;++X){var Z=$[X].clone();for(L=1;L<=X;++L)Z.sub(z[X-L].clone().multiplyScalar(this.calcKoverI(X,L)*J[L]));z[X]=Z.divideScalar(J[0])}return z},calcNURBSDerivatives:function(ft,tt,$,J,L){var I=this.calcBSplineDerivatives(ft,tt,$,J,L);return this.calcRationalCurveDerivatives(I)},calcSurfacePoint:function(ft,tt,$,J,L,I,z,X){for(var Z=this.findSpan(ft,I,$),W=this.findSpan(tt,z,J),D=this.calcBasisFunctions(Z,I,ft,$),H=this.calcBasisFunctions(W,z,tt,J),ht=[],F=0;F<=tt;++F){ht[F]=new p.Vector4(0,0,0,0);for(var Mt=0;Mt<=ft;++Mt){var Et=L[Z-ft+Mt][W-tt+F].clone(),Q=Et.w;Et.x*=Q,Et.y*=Q,Et.z*=Q,ht[F].add(Et.multiplyScalar(D[Mt]))}}var wt=new p.Vector4(0,0,0,0);for(F=0;F<=tt;++F)wt.add(ht[F].multiplyScalar(H[F]));wt.divideScalar(wt.w),X.set(wt.x,wt.y,wt.z)}},Ce=function(ft,tt,$,J,L){p.Curve.call(this),this.degree=ft,this.knots=tt,this.controlPoints=[],this.startKnot=J||0,this.endKnot=L||this.knots.length-1;for(var I=0;I<$.length;++I){var z=$[I];this.controlPoints[I]=new p.Vector4(z.x,z.y,z.z,z.w)}};(Ce.prototype=Object.create(p.Curve.prototype)).constructor=Ce,Ce.prototype.getPoint=function(ft,tt){var $=tt||new p.Vector3,J=this.knots[this.startKnot]+ft*(this.knots[this.endKnot]-this.knots[this.startKnot]),L=Te.calcBSplinePoint(this.degree,this.knots,this.controlPoints,J);return L.w!=1&&L.divideScalar(L.w),$.set(L.x,L.y,L.z)},Ce.prototype.getTangent=function(ft,tt){var $=tt||new p.Vector3,J=this.knots[0]+ft*(this.knots[this.knots.length-1]-this.knots[0]),L=Te.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,J,1);return $.copy(L[1]).normalize(),$};var je=function(){var ft,tt,$;function J(d){p.Loader.call(this,d)}function L(d,b){this.textureLoader=d,this.manager=b}function I(){}function z(){}function X(){}function Z(){}function W(d,b){this.dv=new DataView(d),this.offset=0,this.littleEndian=b===void 0||b}function D(){}function H(d){var b=d.match(/FBXVersion: (\d+)/);if(b)return parseInt(b[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function ht(d){return d/46186158e3}J.prototype=Object.assign(Object.create(p.Loader.prototype),{constructor:J,load:function(d,b,R,B){var V=this,it=V.path===""?p.LoaderUtils.extractUrlBase(d):V.path,mt=new p.FileLoader(this.manager);mt.setPath(V.path),mt.setResponseType("arraybuffer"),mt.load(d,function(xt){try{b(V.parse(xt,it))}catch(It){B?B(It):console.error(It),V.manager.itemError(d)}},R,B)},parse:function(d,b){if(V="Kaydara FBX Binary  \0",(B=d).byteLength>=V.length&&V===Xt(B,0,V.length))ft=new Z().parse(d);else{var R=Xt(d);if(!function(it){for(var mt=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],xt=0,It=0;It<mt.length;++It)if((Lt=void 0,Lt=it[(ne=1)-1],it=it.slice(xt+ne),xt++,Lt)===mt[It])return!1;var ne,Lt;return!0}(R))throw new Error("THREE.FBXLoader: Unknown format.");if(H(R)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+H(R));ft=new X().parse(R)}var B,V;return new L(new p.TextureLoader(this.manager).setPath(this.resourcePath||b).setCrossOrigin(this.crossOrigin),this.manager).parse(ft)}}),L.prototype={constructor:L,parse:function(){tt=this.parseConnections();var d=this.parseImages(),b=this.parseTextures(d),R=this.parseMaterials(b),B=this.parseDeformers(),V=new I().parse(B);return this.parseScene(B,V,R),$},parseConnections:function(){var d=new Map;return"Connections"in ft&&ft.Connections.connections.forEach(function(b){var R=b[0],B=b[1],V=b[2];d.has(R)||d.set(R,{parents:[],children:[]});var it={ID:B,relationship:V};d.get(R).parents.push(it),d.has(B)||d.set(B,{parents:[],children:[]});var mt={ID:R,relationship:V};d.get(B).children.push(mt)}),d},parseImages:function(){var d={},b={};if("Video"in ft.Objects){var R=ft.Objects.Video;for(var B in R){var V=R[B];if(d[It=parseInt(B)]=V.RelativeFilename||V.Filename,"Content"in V){var it=V.Content instanceof ArrayBuffer&&V.Content.byteLength>0,mt=typeof V.Content=="string"&&V.Content!=="";if(it||mt){var xt=this.parseImage(R[B]);b[V.RelativeFilename||V.Filename]=xt}}}}for(var It in d){var ne=d[It];b[ne]!==void 0?d[It]=b[ne]:d[It]=d[It].split("\\").pop()}return d},parseImage:function(d){var b,R=d.Content,B=d.RelativeFilename||d.Filename,V=B.slice(B.lastIndexOf(".")+1).toLowerCase();switch(V){case"bmp":b="image/bmp";break;case"jpg":case"jpeg":b="image/jpeg";break;case"png":b="image/png";break;case"tif":b="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",B),b="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+V+'" is not supported.')}if(typeof R=="string")return"data:"+b+";base64,"+R;var it=new Uint8Array(R);return window.URL.createObjectURL(new Blob([it],{type:b}))},parseTextures:function(d){var b=new Map;if("Texture"in ft.Objects){var R=ft.Objects.Texture;for(var B in R){var V=this.parseTexture(R[B],d);b.set(parseInt(B),V)}}return b},parseTexture:function(d,b){var R=this.loadTexture(d,b);R.ID=d.id,R.name=d.attrName;var B=d.WrapModeU,V=d.WrapModeV,it=B!==void 0?B.value:0,mt=V!==void 0?V.value:0;if(R.wrapS=it===0?p.RepeatWrapping:p.ClampToEdgeWrapping,R.wrapT=mt===0?p.RepeatWrapping:p.ClampToEdgeWrapping,"Scaling"in d){var xt=d.Scaling.value;R.repeat.x=xt[0],R.repeat.y=xt[1]}return R},loadTexture:function(d,b){var R,B,V=this.textureLoader.path,it=tt.get(d.id).children;it!==void 0&&it.length>0&&b[it[0].ID]!==void 0&&((R=b[it[0].ID]).indexOf("blob:")!==0&&R.indexOf("data:")!==0||this.textureLoader.setPath(void 0));var mt=d.FileName.slice(-3).toLowerCase();if(mt==="tga"){var xt=this.manager.getHandler(".tga");xt===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",d.RelativeFilename),B=new p.Texture):B=xt.load(R)}else mt==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",d.RelativeFilename),B=new p.Texture):B=this.textureLoader.load(R);return this.textureLoader.setPath(V),B},parseMaterials:function(d){var b=new Map;if("Material"in ft.Objects){var R=ft.Objects.Material;for(var B in R){var V=this.parseMaterial(R[B],d);V!==null&&b.set(parseInt(B),V)}}return b},parseMaterial:function(d,b){var R=d.id,B=d.attrName,V=d.ShadingModel;if(typeof V=="object"&&(V=V.value),!tt.has(R))return null;var it,mt=this.parseParameters(d,b,R);switch(V.toLowerCase()){case"phong":it=new p.MeshPhongMaterial;break;case"lambert":it=new p.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',V),it=new p.MeshPhongMaterial}return it.setValues(mt),it.name=B,it},parseParameters:function(d,b,R){var B={};d.BumpFactor&&(B.bumpScale=d.BumpFactor.value),d.Diffuse?B.color=new p.Color().fromArray(d.Diffuse.value):d.DiffuseColor&&d.DiffuseColor.type==="Color"&&(B.color=new p.Color().fromArray(d.DiffuseColor.value)),d.DisplacementFactor&&(B.displacementScale=d.DisplacementFactor.value),d.Emissive?B.emissive=new p.Color().fromArray(d.Emissive.value):d.EmissiveColor&&d.EmissiveColor.type==="Color"&&(B.emissive=new p.Color().fromArray(d.EmissiveColor.value)),d.EmissiveFactor&&(B.emissiveIntensity=parseFloat(d.EmissiveFactor.value)),d.Opacity&&(B.opacity=parseFloat(d.Opacity.value)),B.opacity<1&&(B.transparent=!0),d.ReflectionFactor&&(B.reflectivity=d.ReflectionFactor.value),d.Shininess&&(B.shininess=d.Shininess.value),d.Specular?B.specular=new p.Color().fromArray(d.Specular.value):d.SpecularColor&&d.SpecularColor.type==="Color"&&(B.specular=new p.Color().fromArray(d.SpecularColor.value));var V=this;return tt.get(R).children.forEach(function(it){var mt=it.relationship;switch(mt){case"Bump":B.bumpMap=V.getTexture(b,it.ID);break;case"Maya|TEX_ao_map":B.aoMap=V.getTexture(b,it.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":B.map=V.getTexture(b,it.ID),B.map.encoding=p.sRGBEncoding;break;case"DisplacementColor":B.displacementMap=V.getTexture(b,it.ID);break;case"EmissiveColor":B.emissiveMap=V.getTexture(b,it.ID),B.emissiveMap.encoding=p.sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":B.normalMap=V.getTexture(b,it.ID);break;case"ReflectionColor":B.envMap=V.getTexture(b,it.ID),B.envMap.mapping=p.EquirectangularReflectionMapping,B.envMap.encoding=p.sRGBEncoding;break;case"SpecularColor":B.specularMap=V.getTexture(b,it.ID),B.specularMap.encoding=p.sRGBEncoding;break;case"TransparentColor":case"TransparencyFactor":B.alphaMap=V.getTexture(b,it.ID),B.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",mt)}}),B},getTexture:function(d,b){return"LayeredTexture"in ft.Objects&&b in ft.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),b=tt.get(b).children[0].ID),d.get(b)},parseDeformers:function(){var d={},b={};if("Deformer"in ft.Objects){var R=ft.Objects.Deformer;for(var B in R){var V=R[B],it=tt.get(parseInt(B));if(V.attrType==="Skin"){var mt=this.parseSkeleton(it,R);mt.ID=B,it.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),mt.geometryID=it.parents[0].ID,d[B]=mt}else if(V.attrType==="BlendShape"){var xt={id:B};xt.rawTargets=this.parseMorphTargets(it,R),xt.id=B,it.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),b[B]=xt}}}return{skeletons:d,morphTargets:b}},parseSkeleton:function(d,b){var R=[];return d.children.forEach(function(B){var V=b[B.ID];if(V.attrType==="Cluster"){var it={ID:B.ID,indices:[],weights:[],transformLink:new p.Matrix4().fromArray(V.TransformLink.a)};"Indexes"in V&&(it.indices=V.Indexes.a,it.weights=V.Weights.a),R.push(it)}}),{rawBones:R,bones:[]}},parseMorphTargets:function(d,b){for(var R=[],B=0;B<d.children.length;B++){var V=d.children[B],it=b[V.ID],mt={name:it.attrName,initialWeight:it.DeformPercent,id:it.id,fullWeights:it.FullWeights.a};if(it.attrType!=="BlendShapeChannel")return;mt.geoID=tt.get(parseInt(V.ID)).children.filter(function(xt){return xt.relationship===void 0})[0].ID,R.push(mt)}return R},parseScene:function(d,b,R){$=new p.Group;var B=this.parseModels(d.skeletons,b,R),V=ft.Objects.Model,it=this;B.forEach(function(xt){var It=V[xt.ID];it.setLookAtProperties(xt,It),tt.get(xt.ID).parents.forEach(function(ne){var Lt=B.get(ne.ID);Lt!==void 0&&Lt.add(xt)}),xt.parent===null&&$.add(xt)}),this.bindSkeleton(d.skeletons,b,B),this.createAmbientLight(),this.setupMorphMaterials(),$.traverse(function(xt){if(xt.userData.transformData){xt.parent&&(xt.userData.transformData.parentMatrixWorld=xt.parent.matrix);var It=wt(xt.userData.transformData);xt.applyMatrix4(It)}});var mt=new z().parse();$.children.length===1&&$.children[0].isGroup&&($.children[0].animations=mt,$=$.children[0]),$.animations=mt},parseModels:function(d,b,R){var B=new Map,V=ft.Objects.Model;for(var it in V){var mt=parseInt(it),xt=V[it],It=tt.get(mt),ne=this.buildSkeleton(It,d,mt,xt.attrName);if(!ne){switch(xt.attrType){case"Camera":ne=this.createCamera(It);break;case"Light":ne=this.createLight(It);break;case"Mesh":ne=this.createMesh(It,b,R);break;case"NurbsCurve":ne=this.createCurve(It,b);break;case"LimbNode":case"Root":ne=new p.Bone;break;case"Null":default:ne=new p.Group}ne.name=xt.attrName?p.PropertyBinding.sanitizeNodeName(xt.attrName):"",ne.ID=mt}this.getTransformData(ne,xt),B.set(mt,ne)}return B},buildSkeleton:function(d,b,R,B){var V=null;return d.parents.forEach(function(it){for(var mt in b){var xt=b[mt];xt.rawBones.forEach(function(It,ne){if(It.ID===it.ID){var Lt=V;(V=new p.Bone).matrixWorld.copy(It.transformLink),V.name=B?p.PropertyBinding.sanitizeNodeName(B):"",V.ID=R,xt.bones[ne]=V,Lt!==null&&V.add(Lt)}})}}),V},createCamera:function(d){var b,R;if(d.children.forEach(function(Se){var Ae=ft.Objects.NodeAttribute[Se.ID];Ae!==void 0&&(R=Ae)}),R===void 0)b=new p.Object3D;else{var B=0;R.CameraProjectionType!==void 0&&R.CameraProjectionType.value===1&&(B=1);var V=1;R.NearPlane!==void 0&&(V=R.NearPlane.value/1e3);var it=1e3;R.FarPlane!==void 0&&(it=R.FarPlane.value/1e3);var mt=window.innerWidth,xt=window.innerHeight;R.AspectWidth!==void 0&&R.AspectHeight!==void 0&&(mt=R.AspectWidth.value,xt=R.AspectHeight.value);var It=mt/xt,ne=45;R.FieldOfView!==void 0&&(ne=R.FieldOfView.value);var Lt=R.FocalLength?R.FocalLength.value:null;switch(B){case 0:b=new p.PerspectiveCamera(ne,It,V,it),Lt!==null&&b.setFocalLength(Lt);break;case 1:b=new p.OrthographicCamera(-mt/2,mt/2,xt/2,-xt/2,V,it);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+B+"."),b=new p.Object3D}}return b},createLight:function(d){var b,R;if(d.children.forEach(function(ne){var Lt=ft.Objects.NodeAttribute[ne.ID];Lt!==void 0&&(R=Lt)}),R===void 0)b=new p.Object3D;else{var B;B=R.LightType===void 0?0:R.LightType.value;var V=16777215;R.Color!==void 0&&(V=new p.Color().fromArray(R.Color.value));var it=R.Intensity===void 0?1:R.Intensity.value/100;R.CastLightOnObject!==void 0&&R.CastLightOnObject.value===0&&(it=0);var mt=0;R.FarAttenuationEnd!==void 0&&(mt=R.EnableFarAttenuation!==void 0&&R.EnableFarAttenuation.value===0?0:R.FarAttenuationEnd.value);switch(B){case 0:b=new p.PointLight(V,it,mt,1);break;case 1:b=new p.DirectionalLight(V,it);break;case 2:var xt=Math.PI/3;R.InnerAngle!==void 0&&(xt=p.MathUtils.degToRad(R.InnerAngle.value));var It=0;R.OuterAngle!==void 0&&(It=p.MathUtils.degToRad(R.OuterAngle.value),It=Math.max(It,1)),b=new p.SpotLight(V,it,mt,xt,It,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+R.LightType.value+", defaulting to a PointLight."),b=new p.PointLight(V,it)}R.CastShadows!==void 0&&R.CastShadows.value===1&&(b.castShadow=!0)}return b},createMesh:function(d,b,R){var B,V=null,it=null,mt=[];return d.children.forEach(function(xt){b.has(xt.ID)&&(V=b.get(xt.ID)),R.has(xt.ID)&&mt.push(R.get(xt.ID))}),mt.length>1?it=mt:mt.length>0?it=mt[0]:(it=new p.MeshPhongMaterial({color:13421772}),mt.push(it)),"color"in V.attributes&&mt.forEach(function(xt){xt.vertexColors=!0}),V.FBX_Deformer?(mt.forEach(function(xt){xt.skinning=!0}),(B=new p.SkinnedMesh(V,it)).normalizeSkinWeights()):B=new p.Mesh(V,it),B},createCurve:function(d,b){var R=d.children.reduce(function(V,it){return b.has(it.ID)&&(V=b.get(it.ID)),V},null),B=new p.LineBasicMaterial({color:3342591,linewidth:1});return new p.Line(R,B)},getTransformData:function(d,b){var R={};"InheritType"in b&&(R.inheritType=parseInt(b.InheritType.value)),R.eulerOrder="RotationOrder"in b?zt(b.RotationOrder.value):"ZYX","Lcl_Translation"in b&&(R.translation=b.Lcl_Translation.value),"PreRotation"in b&&(R.preRotation=b.PreRotation.value),"Lcl_Rotation"in b&&(R.rotation=b.Lcl_Rotation.value),"PostRotation"in b&&(R.postRotation=b.PostRotation.value),"Lcl_Scaling"in b&&(R.scale=b.Lcl_Scaling.value),"ScalingOffset"in b&&(R.scalingOffset=b.ScalingOffset.value),"ScalingPivot"in b&&(R.scalingPivot=b.ScalingPivot.value),"RotationOffset"in b&&(R.rotationOffset=b.RotationOffset.value),"RotationPivot"in b&&(R.rotationPivot=b.RotationPivot.value),d.userData.transformData=R},setLookAtProperties:function(d,b){"LookAtProperty"in b&&tt.get(d.ID).children.forEach(function(R){if(R.relationship==="LookAtProperty"){var B=ft.Objects.Model[R.ID];if("Lcl_Translation"in B){var V=B.Lcl_Translation.value;d.target!==void 0?(d.target.position.fromArray(V),$.add(d.target)):d.lookAt(new p.Vector3().fromArray(V))}}})},bindSkeleton:function(d,b,R){var B=this.parsePoseNodes();for(var V in d){var it=d[V];tt.get(parseInt(it.ID)).parents.forEach(function(mt){if(b.has(mt.ID)){var xt=mt.ID;tt.get(xt).parents.forEach(function(It){R.has(It.ID)&&R.get(It.ID).bind(new p.Skeleton(it.bones),B[It.ID])})}})}},parsePoseNodes:function(){var d={};if("Pose"in ft.Objects){var b=ft.Objects.Pose;for(var R in b)if(b[R].attrType==="BindPose"){var B=b[R].PoseNode;Array.isArray(B)?B.forEach(function(V){d[V.Node]=new p.Matrix4().fromArray(V.Matrix.a)}):d[B.Node]=new p.Matrix4().fromArray(B.Matrix.a)}}return d},createAmbientLight:function(){if("GlobalSettings"in ft&&"AmbientColor"in ft.GlobalSettings){var d=ft.GlobalSettings.AmbientColor.value,b=d[0],R=d[1],B=d[2];if(b!==0||R!==0||B!==0){var V=new p.Color(b,R,B);$.add(new p.AmbientLight(V,1))}}},setupMorphMaterials:function(){var d=this;$.traverse(function(b){b.isMesh&&b.geometry.morphAttributes.position&&b.geometry.morphAttributes.position.length&&(Array.isArray(b.material)?b.material.forEach(function(R,B){d.setupMorphMaterial(b,R,B)}):d.setupMorphMaterial(b,b.material))})},setupMorphMaterial:function(d,b,R){var B=d.uuid,V=b.uuid,it=!1;if($.traverse(function(xt){xt.isMesh&&(Array.isArray(xt.material)?xt.material.forEach(function(It){It.uuid===V&&xt.uuid!==B&&(it=!0)}):xt.material.uuid===V&&xt.uuid!==B&&(it=!0))}),it===!0){var mt=b.clone();mt.morphTargets=!0,R===void 0?d.material=mt:d.material[R]=mt}else b.morphTargets=!0}},I.prototype={constructor:I,parse:function(d){var b=new Map;if("Geometry"in ft.Objects){var R=ft.Objects.Geometry;for(var B in R){var V=tt.get(parseInt(B)),it=this.parseGeometry(V,R[B],d);b.set(parseInt(B),it)}}return b},parseGeometry:function(d,b,R){switch(b.attrType){case"Mesh":return this.parseMeshGeometry(d,b,R);case"NurbsCurve":return this.parseNurbsGeometry(b)}},parseMeshGeometry:function(d,b,R){var B=R.skeletons,V=[],it=d.parents.map(function(Lt){return ft.Objects.Model[Lt.ID]});if(it.length!==0){var mt=d.children.reduce(function(Lt,Se){return B[Se.ID]!==void 0&&(Lt=B[Se.ID]),Lt},null);d.children.forEach(function(Lt){R.morphTargets[Lt.ID]!==void 0&&V.push(R.morphTargets[Lt.ID])});var xt=it[0],It={};"RotationOrder"in xt&&(It.eulerOrder=zt(xt.RotationOrder.value)),"InheritType"in xt&&(It.inheritType=parseInt(xt.InheritType.value)),"GeometricTranslation"in xt&&(It.translation=xt.GeometricTranslation.value),"GeometricRotation"in xt&&(It.rotation=xt.GeometricRotation.value),"GeometricScaling"in xt&&(It.scale=xt.GeometricScaling.value);var ne=wt(It);return this.genGeometry(b,mt,V,ne)}},genGeometry:function(d,b,R,B){var V=new p.BufferGeometry;d.attrName&&(V.name=d.attrName);var it=this.parseGeoNode(d,b),mt=this.genBuffers(it),xt=new p.Float32BufferAttribute(mt.vertex,3);if(xt.applyMatrix4(B),V.setAttribute("position",xt),mt.colors.length>0&&V.setAttribute("color",new p.Float32BufferAttribute(mt.colors,3)),b&&(V.setAttribute("skinIndex",new p.Uint16BufferAttribute(mt.weightsIndices,4)),V.setAttribute("skinWeight",new p.Float32BufferAttribute(mt.vertexWeights,4)),V.FBX_Deformer=b),mt.normal.length>0){var It=new p.Matrix3().getNormalMatrix(B),ne=new p.Float32BufferAttribute(mt.normal,3);ne.applyNormalMatrix(It),V.setAttribute("normal",ne)}if(mt.uvs.forEach(function(sr,He){var yr="uv"+(He+1).toString();He===0&&(yr="uv"),V.setAttribute(yr,new p.Float32BufferAttribute(mt.uvs[He],2))}),it.material&&it.material.mappingType!=="AllSame"){var Lt=mt.materialIndex[0],Se=0;if(mt.materialIndex.forEach(function(sr,He){sr!==Lt&&(V.addGroup(Se,He-Se,Lt),Lt=sr,Se=He)}),V.groups.length>0){var Ae=V.groups[V.groups.length-1],lr=Ae.start+Ae.count;lr!==mt.materialIndex.length&&V.addGroup(lr,mt.materialIndex.length-lr,Lt)}V.groups.length===0&&V.addGroup(0,mt.materialIndex.length,mt.materialIndex[0])}return this.addMorphTargets(V,d,R,B),V},parseGeoNode:function(d,b){var R={};if(R.vertexPositions=d.Vertices!==void 0?d.Vertices.a:[],R.vertexIndices=d.PolygonVertexIndex!==void 0?d.PolygonVertexIndex.a:[],d.LayerElementColor&&(R.color=this.parseVertexColors(d.LayerElementColor[0])),d.LayerElementMaterial&&(R.material=this.parseMaterialIndices(d.LayerElementMaterial[0])),d.LayerElementNormal&&(R.normal=this.parseNormals(d.LayerElementNormal[0])),d.LayerElementUV){R.uv=[];for(var B=0;d.LayerElementUV[B];)R.uv.push(this.parseUVs(d.LayerElementUV[B])),B++}return R.weightTable={},b!==null&&(R.skeleton=b,b.rawBones.forEach(function(V,it){V.indices.forEach(function(mt,xt){R.weightTable[mt]===void 0&&(R.weightTable[mt]=[]),R.weightTable[mt].push({id:it,weight:V.weights[xt]})})})),R},genBuffers:function(d){var b={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},R=0,B=0,V=!1,it=[],mt=[],xt=[],It=[],ne=[],Lt=[],Se=this;return d.vertexIndices.forEach(function(Ae,lr){var sr=!1;Ae<0&&(Ae^=-1,sr=!0);var He=[],yr=[];if(it.push(3*Ae,3*Ae+1,3*Ae+2),d.color){var Br=Mt(lr,R,Ae,d.color);xt.push(Br[0],Br[1],Br[2])}if(d.skeleton){if(d.weightTable[Ae]!==void 0&&d.weightTable[Ae].forEach(function(xr){yr.push(xr.weight),He.push(xr.id)}),yr.length>4){V||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),V=!0);var Pr=[0,0,0,0],xn=[0,0,0,0];yr.forEach(function(xr,bn){var wn=xr,_o=He[bn];xn.forEach(function(Kn,ga,Bn){if(wn>Kn){Bn[ga]=wn,wn=Kn;var $r=Pr[ga];Pr[ga]=_o,_o=$r}})}),He=Pr,yr=xn}for(;yr.length<4;)yr.push(0),He.push(0);for(var Vr=0;Vr<4;++Vr)ne.push(yr[Vr]),Lt.push(He[Vr])}if(d.normal&&(Br=Mt(lr,R,Ae,d.normal),mt.push(Br[0],Br[1],Br[2])),d.material&&d.material.mappingType!=="AllSame")var Xr=Mt(lr,R,Ae,d.material)[0];d.uv&&d.uv.forEach(function(xr,bn){var wn=Mt(lr,R,Ae,xr);It[bn]===void 0&&(It[bn]=[]),It[bn].push(wn[0]),It[bn].push(wn[1])}),B++,sr&&(Se.genFace(b,d,it,Xr,mt,xt,It,ne,Lt,B),R++,B=0,it=[],mt=[],xt=[],It=[],ne=[],Lt=[])}),b},genFace:function(d,b,R,B,V,it,mt,xt,It,ne){for(var Lt=2;Lt<ne;Lt++)d.vertex.push(b.vertexPositions[R[0]]),d.vertex.push(b.vertexPositions[R[1]]),d.vertex.push(b.vertexPositions[R[2]]),d.vertex.push(b.vertexPositions[R[3*(Lt-1)]]),d.vertex.push(b.vertexPositions[R[3*(Lt-1)+1]]),d.vertex.push(b.vertexPositions[R[3*(Lt-1)+2]]),d.vertex.push(b.vertexPositions[R[3*Lt]]),d.vertex.push(b.vertexPositions[R[3*Lt+1]]),d.vertex.push(b.vertexPositions[R[3*Lt+2]]),b.skeleton&&(d.vertexWeights.push(xt[0]),d.vertexWeights.push(xt[1]),d.vertexWeights.push(xt[2]),d.vertexWeights.push(xt[3]),d.vertexWeights.push(xt[4*(Lt-1)]),d.vertexWeights.push(xt[4*(Lt-1)+1]),d.vertexWeights.push(xt[4*(Lt-1)+2]),d.vertexWeights.push(xt[4*(Lt-1)+3]),d.vertexWeights.push(xt[4*Lt]),d.vertexWeights.push(xt[4*Lt+1]),d.vertexWeights.push(xt[4*Lt+2]),d.vertexWeights.push(xt[4*Lt+3]),d.weightsIndices.push(It[0]),d.weightsIndices.push(It[1]),d.weightsIndices.push(It[2]),d.weightsIndices.push(It[3]),d.weightsIndices.push(It[4*(Lt-1)]),d.weightsIndices.push(It[4*(Lt-1)+1]),d.weightsIndices.push(It[4*(Lt-1)+2]),d.weightsIndices.push(It[4*(Lt-1)+3]),d.weightsIndices.push(It[4*Lt]),d.weightsIndices.push(It[4*Lt+1]),d.weightsIndices.push(It[4*Lt+2]),d.weightsIndices.push(It[4*Lt+3])),b.color&&(d.colors.push(it[0]),d.colors.push(it[1]),d.colors.push(it[2]),d.colors.push(it[3*(Lt-1)]),d.colors.push(it[3*(Lt-1)+1]),d.colors.push(it[3*(Lt-1)+2]),d.colors.push(it[3*Lt]),d.colors.push(it[3*Lt+1]),d.colors.push(it[3*Lt+2])),b.material&&b.material.mappingType!=="AllSame"&&(d.materialIndex.push(B),d.materialIndex.push(B),d.materialIndex.push(B)),b.normal&&(d.normal.push(V[0]),d.normal.push(V[1]),d.normal.push(V[2]),d.normal.push(V[3*(Lt-1)]),d.normal.push(V[3*(Lt-1)+1]),d.normal.push(V[3*(Lt-1)+2]),d.normal.push(V[3*Lt]),d.normal.push(V[3*Lt+1]),d.normal.push(V[3*Lt+2])),b.uv&&b.uv.forEach(function(Se,Ae){d.uvs[Ae]===void 0&&(d.uvs[Ae]=[]),d.uvs[Ae].push(mt[Ae][0]),d.uvs[Ae].push(mt[Ae][1]),d.uvs[Ae].push(mt[Ae][2*(Lt-1)]),d.uvs[Ae].push(mt[Ae][2*(Lt-1)+1]),d.uvs[Ae].push(mt[Ae][2*Lt]),d.uvs[Ae].push(mt[Ae][2*Lt+1])})},addMorphTargets:function(d,b,R,B){if(R.length!==0){d.morphTargetsRelative=!0,d.morphAttributes.position=[];var V=this;R.forEach(function(it){it.rawTargets.forEach(function(mt){var xt=ft.Objects.Geometry[mt.geoID];xt!==void 0&&V.genMorphGeometry(d,b,xt,B,mt.name)})})}},genMorphGeometry:function(d,b,R,B,V){for(var it=b.PolygonVertexIndex!==void 0?b.PolygonVertexIndex.a:[],mt=R.Vertices!==void 0?R.Vertices.a:[],xt=R.Indexes!==void 0?R.Indexes.a:[],It=3*d.attributes.position.count,ne=new Float32Array(It),Lt=0;Lt<xt.length;Lt++){var Se=3*xt[Lt];ne[Se]=mt[3*Lt],ne[Se+1]=mt[3*Lt+1],ne[Se+2]=mt[3*Lt+2]}var Ae={vertexIndices:it,vertexPositions:ne},lr=this.genBuffers(Ae),sr=new p.Float32BufferAttribute(lr.vertex,3);sr.name=V||R.attrName,sr.applyMatrix4(B),d.morphAttributes.position.push(sr)},parseNormals:function(d){var b=d.MappingInformationType,R=d.ReferenceInformationType,B=d.Normals.a,V=[];return R==="IndexToDirect"&&("NormalIndex"in d?V=d.NormalIndex.a:"NormalsIndex"in d&&(V=d.NormalsIndex.a)),{dataSize:3,buffer:B,indices:V,mappingType:b,referenceType:R}},parseUVs:function(d){var b=d.MappingInformationType,R=d.ReferenceInformationType,B=d.UV.a,V=[];return R==="IndexToDirect"&&(V=d.UVIndex.a),{dataSize:2,buffer:B,indices:V,mappingType:b,referenceType:R}},parseVertexColors:function(d){var b=d.MappingInformationType,R=d.ReferenceInformationType,B=d.Colors.a,V=[];return R==="IndexToDirect"&&(V=d.ColorIndex.a),{dataSize:4,buffer:B,indices:V,mappingType:b,referenceType:R}},parseMaterialIndices:function(d){var b=d.MappingInformationType,R=d.ReferenceInformationType;if(b==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:R};for(var B=d.Materials.a,V=[],it=0;it<B.length;++it)V.push(it);return{dataSize:1,buffer:B,indices:V,mappingType:b,referenceType:R}},parseNurbsGeometry:function(d){if(Ce===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new p.BufferGeometry;var b=parseInt(d.Order);if(isNaN(b))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",d.Order,d.id),new p.BufferGeometry;for(var R,B,V=b-1,it=d.KnotVector.a,mt=[],xt=d.Points.a,It=0,ne=xt.length;It<ne;It+=4)mt.push(new p.Vector4().fromArray(xt,It));if(d.Form==="Closed")mt.push(mt[0]);else if(d.Form==="Periodic")for(R=V,B=it.length-1-R,It=0;It<V;++It)mt.push(mt[It]);var Lt=new Ce(V,it,mt,R,B).getPoints(7*mt.length),Se=new Float32Array(3*Lt.length);Lt.forEach(function(lr,sr){lr.toArray(Se,3*sr)});var Ae=new p.BufferGeometry;return Ae.setAttribute("position",new p.BufferAttribute(Se,3)),Ae}},z.prototype={constructor:z,parse:function(){var d=[],b=this.parseClips();if(b!==void 0)for(var R in b){var B=b[R],V=this.addClip(B);d.push(V)}return d},parseClips:function(){if(ft.Objects.AnimationCurve!==void 0){var d=this.parseAnimationCurveNodes();this.parseAnimationCurves(d);var b=this.parseAnimationLayers(d);return this.parseAnimStacks(b)}},parseAnimationCurveNodes:function(){var d=ft.Objects.AnimationCurveNode,b=new Map;for(var R in d){var B=d[R];if(B.attrName.match(/S|R|T|DeformPercent/)!==null){var V={id:B.id,attr:B.attrName,curves:{}};b.set(V.id,V)}}return b},parseAnimationCurves:function(d){var b=ft.Objects.AnimationCurve;for(var R in b){var B={id:b[R].id,times:b[R].KeyTime.a.map(ht),values:b[R].KeyValueFloat.a},V=tt.get(B.id);if(V!==void 0){var it=V.parents[0].ID,mt=V.parents[0].relationship;mt.match(/X/)?d.get(it).curves.x=B:mt.match(/Y/)?d.get(it).curves.y=B:mt.match(/Z/)?d.get(it).curves.z=B:mt.match(/d|DeformPercent/)&&d.has(it)&&(d.get(it).curves.morph=B)}}},parseAnimationLayers:function(d){var b=ft.Objects.AnimationLayer,R=new Map;for(var B in b){var V=[],it=tt.get(parseInt(B));it!==void 0&&(it.children.forEach(function(mt,xt){if(d.has(mt.ID)){var It=d.get(mt.ID);if(It.curves.x!==void 0||It.curves.y!==void 0||It.curves.z!==void 0){if(V[xt]===void 0&&(sr=tt.get(mt.ID).parents.filter(function(He){return He.relationship!==void 0})[0].ID)!==void 0){if((Lt=ft.Objects.Model[sr.toString()])===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",mt);var ne={modelName:Lt.attrName?p.PropertyBinding.sanitizeNodeName(Lt.attrName):"",ID:Lt.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};$.traverse(function(He){He.ID===Lt.id&&(ne.transform=He.matrix,He.userData.transformData&&(ne.eulerOrder=He.userData.transformData.eulerOrder))}),ne.transform||(ne.transform=new p.Matrix4),"PreRotation"in Lt&&(ne.preRotation=Lt.PreRotation.value),"PostRotation"in Lt&&(ne.postRotation=Lt.PostRotation.value),V[xt]=ne}V[xt]&&(V[xt][It.attr]=It)}else if(It.curves.morph!==void 0){if(V[xt]===void 0){var Lt,Se=tt.get(mt.ID).parents.filter(function(He){return He.relationship!==void 0})[0].ID,Ae=tt.get(Se).parents[0].ID,lr=tt.get(Ae).parents[0].ID,sr=tt.get(lr).parents[0].ID;ne={modelName:(Lt=ft.Objects.Model[sr]).attrName?p.PropertyBinding.sanitizeNodeName(Lt.attrName):"",morphName:ft.Objects.Deformer[Se].attrName},V[xt]=ne}V[xt][It.attr]=It}}}),R.set(parseInt(B),V))}return R},parseAnimStacks:function(d){var b=ft.Objects.AnimationStack,R={};for(var B in b){var V=tt.get(parseInt(B)).children;V.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var it=d.get(V[0].ID);R[B]={name:b[B].attrName,layer:it}}return R},addClip:function(d){var b=[],R=this;return d.layer.forEach(function(B){b=b.concat(R.generateTracks(B))}),new p.AnimationClip(d.name,-1,b)},generateTracks:function(d){var b=[],R=new p.Vector3,B=new p.Quaternion,V=new p.Vector3;if(d.transform&&d.transform.decompose(R,B,V),R=R.toArray(),B=new p.Euler().setFromQuaternion(B,d.eulerOrder).toArray(),V=V.toArray(),d.T!==void 0&&Object.keys(d.T.curves).length>0){var it=this.generateVectorTrack(d.modelName,d.T.curves,R,"position");it!==void 0&&b.push(it)}if(d.R!==void 0&&Object.keys(d.R.curves).length>0){var mt=this.generateRotationTrack(d.modelName,d.R.curves,B,d.preRotation,d.postRotation,d.eulerOrder);mt!==void 0&&b.push(mt)}if(d.S!==void 0&&Object.keys(d.S.curves).length>0){var xt=this.generateVectorTrack(d.modelName,d.S.curves,V,"scale");xt!==void 0&&b.push(xt)}if(d.DeformPercent!==void 0){var It=this.generateMorphTrack(d);It!==void 0&&b.push(It)}return b},generateVectorTrack:function(d,b,R,B){var V=this.getTimesForAllAxes(b),it=this.getKeyframeTrackValues(V,b,R);return new p.VectorKeyframeTrack(d+"."+B,V,it)},generateRotationTrack:function(d,b,R,B,V,it){b.x!==void 0&&(this.interpolateRotations(b.x),b.x.values=b.x.values.map(p.MathUtils.degToRad)),b.y!==void 0&&(this.interpolateRotations(b.y),b.y.values=b.y.values.map(p.MathUtils.degToRad)),b.z!==void 0&&(this.interpolateRotations(b.z),b.z.values=b.z.values.map(p.MathUtils.degToRad));var mt=this.getTimesForAllAxes(b),xt=this.getKeyframeTrackValues(mt,b,R);B!==void 0&&((B=B.map(p.MathUtils.degToRad)).push(it),B=new p.Euler().fromArray(B),B=new p.Quaternion().setFromEuler(B)),V!==void 0&&((V=V.map(p.MathUtils.degToRad)).push(it),V=new p.Euler().fromArray(V),V=new p.Quaternion().setFromEuler(V).inverse());for(var It=new p.Quaternion,ne=new p.Euler,Lt=[],Se=0;Se<xt.length;Se+=3)ne.set(xt[Se],xt[Se+1],xt[Se+2],it),It.setFromEuler(ne),B!==void 0&&It.premultiply(B),V!==void 0&&It.multiply(V),It.toArray(Lt,Se/3*4);return new p.QuaternionKeyframeTrack(d+".quaternion",mt,Lt)},generateMorphTrack:function(d){var b=d.DeformPercent.curves.morph,R=b.values.map(function(V){return V/100}),B=$.getObjectByName(d.modelName).morphTargetDictionary[d.morphName];return new p.NumberKeyframeTrack(d.modelName+".morphTargetInfluences["+B+"]",b.times,R)},getTimesForAllAxes:function(d){var b=[];return d.x!==void 0&&(b=b.concat(d.x.times)),d.y!==void 0&&(b=b.concat(d.y.times)),d.z!==void 0&&(b=b.concat(d.z.times)),b=b.sort(function(R,B){return R-B}).filter(function(R,B,V){return V.indexOf(R)==B})},getKeyframeTrackValues:function(d,b,R){var B=R,V=[],it=-1,mt=-1,xt=-1;return d.forEach(function(It){if(b.x&&(it=b.x.times.indexOf(It)),b.y&&(mt=b.y.times.indexOf(It)),b.z&&(xt=b.z.times.indexOf(It)),it!==-1){var ne=b.x.values[it];V.push(ne),B[0]=ne}else V.push(B[0]);if(mt!==-1){var Lt=b.y.values[mt];V.push(Lt),B[1]=Lt}else V.push(B[1]);if(xt!==-1){var Se=b.z.values[xt];V.push(Se),B[2]=Se}else V.push(B[2])}),V},interpolateRotations:function(d){for(var b=1;b<d.values.length;b++){var R=d.values[b-1],B=d.values[b]-R,V=Math.abs(B);if(V>=180){for(var it=V/180,mt=B/it,xt=R+mt,It=d.times[b-1],ne=(d.times[b]-It)/it,Lt=It+ne,Se=[],Ae=[];Lt<d.times[b];)Se.push(Lt),Lt+=ne,Ae.push(xt),xt+=mt;d.times=rt(d.times,b,Se),d.values=rt(d.values,b,Ae)}}}},X.prototype={constructor:X,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(d){this.nodeStack.push(d),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(d,b){this.currentProp=d,this.currentPropName=b},parse:function(d){this.currentIndent=0,this.allNodes=new D,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var b=this,R=d.split(/[\r\n]+/);return R.forEach(function(B,V){var it=B.match(/^[\s\t]*;/),mt=B.match(/^[\s\t]*$/);if(!it&&!mt){var xt=B.match("^\\t{"+b.currentIndent+"}(\\w+):(.*){",""),It=B.match("^\\t{"+b.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),ne=B.match("^\\t{"+(b.currentIndent-1)+"}}");xt?b.parseNodeBegin(B,xt):It?b.parseNodeProperty(B,It,R[++V]):ne?b.popStack():B.match(/^[^\s\t}]/)&&b.parseNodePropertyContinued(B)}}),this.allNodes},parseNodeBegin:function(d,b){var R=b[1].trim().replace(/^"/,"").replace(/"$/,""),B=b[2].split(",").map(function(xt){return xt.trim().replace(/^"/,"").replace(/"$/,"")}),V={name:R},it=this.parseNodeAttr(B),mt=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(R,V):R in mt?(R==="PoseNode"?mt.PoseNode.push(V):mt[R].id!==void 0&&(mt[R]={},mt[R][mt[R].id]=mt[R]),it.id!==""&&(mt[R][it.id]=V)):typeof it.id=="number"?(mt[R]={},mt[R][it.id]=V):R!=="Properties70"&&(mt[R]=R==="PoseNode"?[V]:V),typeof it.id=="number"&&(V.id=it.id),it.name!==""&&(V.attrName=it.name),it.type!==""&&(V.attrType=it.type),this.pushStack(V)},parseNodeAttr:function(d){var b=d[0];d[0]!==""&&(b=parseInt(d[0]),isNaN(b)&&(b=d[0]));var R="",B="";return d.length>1&&(R=d[1].replace(/^(\w+)::/,""),B=d[2]),{id:b,name:R,type:B}},parseNodeProperty:function(d,b,R){var B=b[1].replace(/^"/,"").replace(/"$/,"").trim(),V=b[2].replace(/^"/,"").replace(/"$/,"").trim();B==="Content"&&V===","&&(V=R.replace(/"/g,"").replace(/,$/,"").trim());var it=this.getCurrentNode();if(it.name!=="Properties70"){if(B==="C"){var mt=V.split(",").slice(1),xt=parseInt(mt[0]),It=parseInt(mt[1]),ne=V.split(",").slice(3);B="connections",function(Lt,Se){for(var Ae=0,lr=Lt.length,sr=Se.length;Ae<sr;Ae++,lr++)Lt[lr]=Se[Ae]}(V=[xt,It],ne=ne.map(function(Lt){return Lt.trim().replace(/^"/,"")})),it[B]===void 0&&(it[B]=[])}B==="Node"&&(it.id=V),B in it&&Array.isArray(it[B])?it[B].push(V):B!=="a"?it[B]=V:it.a=V,this.setCurrentProp(it,B),B==="a"&&V.slice(-1)!==","&&(it.a=bt(V))}else this.parseNodeSpecialProperty(d,B,V)},parseNodePropertyContinued:function(d){var b=this.getCurrentNode();b.a+=d,d.slice(-1)!==","&&(b.a=bt(b.a))},parseNodeSpecialProperty:function(d,b,R){var B=R.split('",').map(function(ne){return ne.trim().replace(/^\"/,"").replace(/\s/,"_")}),V=B[0],it=B[1],mt=B[2],xt=B[3],It=B[4];switch(it){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":It=parseFloat(It);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":It=bt(It)}this.getPrevNode()[V]={type:it,type2:mt,flag:xt,value:It},this.setCurrentProp(this.getPrevNode(),V)}},Z.prototype={constructor:Z,parse:function(d){var b=new W(d);b.skip(23);var R=b.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+R);for(var B=new D;!this.endOfContent(b);){var V=this.parseNode(b,R);V!==null&&B.add(V.name,V)}return B},endOfContent:function(d){return d.size()%16==0?(d.getOffset()+160+16&-16)>=d.size():d.getOffset()+160+16>=d.size()},parseNode:function(d,b){var R={},B=b>=7500?d.getUint64():d.getUint32(),V=b>=7500?d.getUint64():d.getUint32();b>=7500?d.getUint64():d.getUint32();var it=d.getUint8(),mt=d.getString(it);if(B===0)return null;for(var xt=[],It=0;It<V;It++)xt.push(this.parseProperty(d));var ne=xt.length>0?xt[0]:"",Lt=xt.length>1?xt[1]:"",Se=xt.length>2?xt[2]:"";for(R.singleProperty=V===1&&d.getOffset()===B;B>d.getOffset();){var Ae=this.parseNode(d,b);Ae!==null&&this.parseSubNode(mt,R,Ae)}return R.propertyList=xt,typeof ne=="number"&&(R.id=ne),Lt!==""&&(R.attrName=Lt),Se!==""&&(R.attrType=Se),mt!==""&&(R.name=mt),R},parseSubNode:function(d,b,R){if(R.singleProperty===!0){var B=R.propertyList[0];Array.isArray(B)?(b[R.name]=R,R.a=B):b[R.name]=B}else if(d==="Connections"&&R.name==="C"){var V=[];R.propertyList.forEach(function(Lt,Se){Se!==0&&V.push(Lt)}),b.connections===void 0&&(b.connections=[]),b.connections.push(V)}else if(R.name==="Properties70")Object.keys(R).forEach(function(Lt){b[Lt]=R[Lt]});else if(d==="Properties70"&&R.name==="P"){var it,mt=R.propertyList[0],xt=R.propertyList[1],It=R.propertyList[2],ne=R.propertyList[3];mt.indexOf("Lcl ")===0&&(mt=mt.replace("Lcl ","Lcl_")),xt.indexOf("Lcl ")===0&&(xt=xt.replace("Lcl ","Lcl_")),it=xt==="Color"||xt==="ColorRGB"||xt==="Vector"||xt==="Vector3D"||xt.indexOf("Lcl_")===0?[R.propertyList[4],R.propertyList[5],R.propertyList[6]]:R.propertyList[4],b[mt]={type:xt,type2:It,flag:ne,value:it}}else b[R.name]===void 0?typeof R.id=="number"?(b[R.name]={},b[R.name][R.id]=R):b[R.name]=R:R.name==="PoseNode"?(Array.isArray(b[R.name])||(b[R.name]=[b[R.name]]),b[R.name].push(R)):b[R.name][R.id]===void 0&&(b[R.name][R.id]=R)},parseProperty:function(d){var b=d.getString(1);switch(b){case"C":return d.getBoolean();case"D":return d.getFloat64();case"F":return d.getFloat32();case"I":return d.getInt32();case"L":return d.getInt64();case"R":var R=d.getUint32();return d.getArrayBuffer(R);case"S":return R=d.getUint32(),d.getString(R);case"Y":return d.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var B=d.getUint32(),V=d.getUint32(),it=d.getUint32();if(V===0)switch(b){case"b":case"c":return d.getBooleanArray(B);case"d":return d.getFloat64Array(B);case"f":return d.getFloat32Array(B);case"i":return d.getInt32Array(B);case"l":return d.getInt64Array(B)}he===void 0&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var mt=new W(new he.Inflate(new Uint8Array(d.getArrayBuffer(it))).decompress().buffer);switch(b){case"b":case"c":return mt.getBooleanArray(B);case"d":return mt.getFloat64Array(B);case"f":return mt.getFloat32Array(B);case"i":return mt.getInt32Array(B);case"l":return mt.getInt64Array(B)}default:throw new Error("THREE.FBXLoader: Unknown property type "+b)}}},W.prototype={constructor:W,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(d){this.offset+=d},getBoolean:function(){return(1&this.getUint8())==1},getBooleanArray:function(d){for(var b=[],R=0;R<d;R++)b.push(this.getBoolean());return b},getUint8:function(){var d=this.dv.getUint8(this.offset);return this.offset+=1,d},getInt16:function(){var d=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,d},getInt32:function(){var d=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,d},getInt32Array:function(d){for(var b=[],R=0;R<d;R++)b.push(this.getInt32());return b},getUint32:function(){var d=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,d},getInt64:function(){var d,b;return this.littleEndian?(d=this.getUint32(),b=this.getUint32()):(b=this.getUint32(),d=this.getUint32()),2147483648&b?(b=4294967295&~b,(d=4294967295&~d)===4294967295&&(b=b+1&4294967295),-(4294967296*b+(d=d+1&4294967295))):4294967296*b+d},getInt64Array:function(d){for(var b=[],R=0;R<d;R++)b.push(this.getInt64());return b},getUint64:function(){var d,b;return this.littleEndian?(d=this.getUint32(),b=this.getUint32()):(b=this.getUint32(),d=this.getUint32()),4294967296*b+d},getFloat32:function(){var d=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,d},getFloat32Array:function(d){for(var b=[],R=0;R<d;R++)b.push(this.getFloat32());return b},getFloat64:function(){var d=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,d},getFloat64Array:function(d){for(var b=[],R=0;R<d;R++)b.push(this.getFloat64());return b},getArrayBuffer:function(d){var b=this.dv.buffer.slice(this.offset,this.offset+d);return this.offset+=d,b},getString:function(d){for(var b=[],R=0;R<d;R++)b[R]=this.getUint8();var B=b.indexOf(0);return B>=0&&(b=b.slice(0,B)),p.LoaderUtils.decodeText(new Uint8Array(b))}},D.prototype={constructor:D,add:function(d,b){this[d]=b}};var F=[];function Mt(d,b,R,B){var V;switch(B.mappingType){case"ByPolygonVertex":V=d;break;case"ByPolygon":V=b;break;case"ByVertice":V=R;break;case"AllSame":V=B.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+B.mappingType)}B.referenceType==="IndexToDirect"&&(V=B.indices[V]);var it=V*B.dataSize,mt=it+B.dataSize;return function(xt,It,ne,Lt){for(var Se=ne,Ae=0;Se<Lt;Se++,Ae++)xt[Ae]=It[Se];return xt}(F,B.buffer,it,mt)}var Et=new p.Euler,Q=new p.Vector3;function wt(d){var b,R=new p.Matrix4,B=new p.Matrix4,V=new p.Matrix4,it=new p.Matrix4,mt=new p.Matrix4,xt=new p.Matrix4,It=new p.Matrix4,ne=new p.Matrix4,Lt=new p.Matrix4,Se=new p.Matrix4,Ae=new p.Matrix4,lr=d.inheritType?d.inheritType:0;(d.translation&&R.setPosition(Q.fromArray(d.translation)),d.preRotation)&&((b=d.preRotation.map(p.MathUtils.degToRad)).push(d.eulerOrder),B.makeRotationFromEuler(Et.fromArray(b))),d.rotation&&((b=d.rotation.map(p.MathUtils.degToRad)).push(d.eulerOrder),V.makeRotationFromEuler(Et.fromArray(b))),d.postRotation&&((b=d.postRotation.map(p.MathUtils.degToRad)).push(d.eulerOrder),it.makeRotationFromEuler(Et.fromArray(b))),d.scale&&mt.scale(Q.fromArray(d.scale)),d.scalingOffset&&It.setPosition(Q.fromArray(d.scalingOffset)),d.scalingPivot&&xt.setPosition(Q.fromArray(d.scalingPivot)),d.rotationOffset&&ne.setPosition(Q.fromArray(d.rotationOffset)),d.rotationPivot&&Lt.setPosition(Q.fromArray(d.rotationPivot)),d.parentMatrixWorld&&(Se=d.parentMatrixWorld);var sr=B.multiply(V).multiply(it),He=new p.Matrix4;Se.extractRotation(He),new p.Matrix4().copyPosition(Se);var yr=new p.Matrix4;yr.getInverse(He).multiply(Se);var Br=new p.Matrix4;if(lr===0)Br.copy(He).multiply(sr).multiply(yr).multiply(mt);else if(lr===1)Br.copy(He).multiply(yr).multiply(sr).multiply(mt);else{var Pr=new p.Matrix4().getInverse(mt),xn=new p.Matrix4().multiply(yr).multiply(Pr);Br.copy(He).multiply(sr).multiply(xn).multiply(mt)}var Vr=new p.Matrix4().getInverse(Lt),Xr=new p.Matrix4().getInverse(xt),xr=new p.Matrix4;xr.copy(R).multiply(ne).multiply(Lt).multiply(B).multiply(V).multiply(it).multiply(Vr).multiply(It).multiply(xt).multiply(mt).multiply(Xr);var bn=new p.Matrix4().copyPosition(xr),wn=new p.Matrix4().copy(Se).multiply(bn);return Ae.copyPosition(wn),xr=new p.Matrix4().multiply(Ae).multiply(Br)}function zt(d){var b=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(d=d||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),b[0]):b[d]}function bt(d){return d.split(",").map(function(b){return parseFloat(b)})}function Xt(d,b,R){return b===void 0&&(b=0),R===void 0&&(R=d.byteLength),p.LoaderUtils.decodeText(new Uint8Array(d,b,R))}function rt(d,b,R){return d.slice(0,b).concat(R).concat(d.slice(b))}return J}()},function(ee,v,f){f.r(v),f.d(v,"Water",function(){return P});var p=f(0),_=function(w,T){p.Mesh.call(this,w),this.type="Reflector";var C=this,vt=(T=T||{}).color!==void 0?new p.Color(T.color):new p.Color(8355711),Tt=T.textureWidth||512,Pt=T.textureHeight||512,G=T.clipBias||0,Y=T.shader||_.ReflectorShader,at=T.encoding!==void 0?T.encoding:p.LinearEncoding,ut=new p.Plane,x=new p.Vector3,S=new p.Vector3,U=new p.Vector3,O=new p.Matrix4,pt=new p.Vector3(0,0,-1),ct=new p.Vector4,_t=new p.Vector3,Ot=new p.Vector3,Vt=new p.Vector4,St=new p.Matrix4,At=new p.PerspectiveCamera,Ut={minFilter:p.LinearFilter,magFilter:p.LinearFilter,format:p.RGBFormat,stencilBuffer:!1,encoding:at},re=new p.WebGLRenderTarget(Tt,Pt,Ut);p.MathUtils.isPowerOfTwo(Tt)&&p.MathUtils.isPowerOfTwo(Pt)||(re.texture.generateMipmaps=!1);var ie=new p.ShaderMaterial({uniforms:p.UniformsUtils.clone(Y.uniforms),fragmentShader:Y.fragmentShader,vertexShader:Y.vertexShader});ie.uniforms.tDiffuse.value=re.texture,ie.uniforms.color.value=vt,ie.uniforms.textureMatrix.value=St,this.material=ie,this.onBeforeRender=function(Ct,se,ve){if(S.setFromMatrixPosition(C.matrixWorld),U.setFromMatrixPosition(ve.matrixWorld),O.extractRotation(C.matrixWorld),x.set(0,0,1),x.applyMatrix4(O),_t.subVectors(S,U),!(_t.dot(x)>0)){_t.reflect(x).negate(),_t.add(S),O.extractRotation(ve.matrixWorld),pt.set(0,0,-1),pt.applyMatrix4(O),pt.add(U),Ot.subVectors(S,pt),Ot.reflect(x).negate(),Ot.add(S),At.position.copy(_t),At.up.set(0,1,0),At.up.applyMatrix4(O),At.up.reflect(x),At.lookAt(Ot),At.far=ve.far,At.updateMatrixWorld(),At.projectionMatrix.copy(ve.projectionMatrix),St.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),St.multiply(At.projectionMatrix),St.multiply(At.matrixWorldInverse),St.multiply(C.matrixWorld),ut.setFromNormalAndCoplanarPoint(x,S),ut.applyMatrix4(At.matrixWorldInverse),ct.set(ut.normal.x,ut.normal.y,ut.normal.z,ut.constant);var le=At.projectionMatrix;Vt.x=(Math.sign(ct.x)+le.elements[8])/le.elements[0],Vt.y=(Math.sign(ct.y)+le.elements[9])/le.elements[5],Vt.z=-1,Vt.w=(1+le.elements[10])/le.elements[14],ct.multiplyScalar(2/ct.dot(Vt)),le.elements[2]=ct.x,le.elements[6]=ct.y,le.elements[10]=ct.z+1-G,le.elements[14]=ct.w,C.visible=!1;var de=Ct.getRenderTarget(),Pe=Ct.xr.enabled,Ve=Ct.shadowMap.autoUpdate;Ct.xr.enabled=!1,Ct.shadowMap.autoUpdate=!1,Ct.setRenderTarget(re),Ct.state.buffers.depth.setMask(!0),Ct.autoClear===!1&&Ct.clear(),Ct.render(se,At),Ct.xr.enabled=Pe,Ct.shadowMap.autoUpdate=Ve,Ct.setRenderTarget(de);var Ue=ve.viewport;Ue!==void 0&&Ct.state.viewport(Ue),C.visible=!0}},this.getRenderTarget=function(){return re}};_.prototype=Object.create(p.Mesh.prototype),_.prototype.constructor=_,_.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","	vUv = textureMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","	return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","	return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","	vec4 base = texture2DProj( tDiffuse, vUv );","	gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join(`
`)};var E=function(w,T){p.Mesh.call(this,w),this.type="Refractor";var C=this,vt=(T=T||{}).color!==void 0?new p.Color(T.color):new p.Color(8355711),Tt=T.textureWidth||512,Pt=T.textureHeight||512,G=T.clipBias||0,Y=T.shader||E.RefractorShader,at=T.encoding!==void 0?T.encoding:p.LinearEncoding,ut=new p.PerspectiveCamera;ut.matrixAutoUpdate=!1,ut.userData.refractor=!0;var x=new p.Plane,S=new p.Matrix4,U={minFilter:p.LinearFilter,magFilter:p.LinearFilter,format:p.RGBFormat,stencilBuffer:!1,encoding:at},O=new p.WebGLRenderTarget(Tt,Pt,U);p.MathUtils.isPowerOfTwo(Tt)&&p.MathUtils.isPowerOfTwo(Pt)||(O.texture.generateMipmaps=!1),this.material=new p.ShaderMaterial({uniforms:p.UniformsUtils.clone(Y.uniforms),vertexShader:Y.vertexShader,fragmentShader:Y.fragmentShader,transparent:!0}),this.material.uniforms.color.value=vt,this.material.uniforms.tDiffuse.value=O.texture,this.material.uniforms.textureMatrix.value=S;var pt,ct,_t,Ot,Vt,St,At,Ut,re=(pt=new p.Vector3,ct=new p.Vector3,_t=new p.Matrix4,Ot=new p.Vector3,Vt=new p.Vector3,function(se){return pt.setFromMatrixPosition(C.matrixWorld),ct.setFromMatrixPosition(se.matrixWorld),Ot.subVectors(pt,ct),_t.extractRotation(C.matrixWorld),Vt.set(0,0,1),Vt.applyMatrix4(_t),Ot.dot(Vt)<0}),ie=function(){var se=new p.Vector3,ve=new p.Vector3,le=new p.Quaternion,de=new p.Vector3;return function(){C.matrixWorld.decompose(ve,le,de),se.set(0,0,1).applyQuaternion(le).normalize(),se.negate(),x.setFromNormalAndCoplanarPoint(se,ve)}}(),Ct=(St=new p.Plane,At=new p.Vector4,Ut=new p.Vector4,function(se){ut.matrixWorld.copy(se.matrixWorld),ut.matrixWorldInverse.getInverse(ut.matrixWorld),ut.projectionMatrix.copy(se.projectionMatrix),ut.far=se.far,St.copy(x),St.applyMatrix4(ut.matrixWorldInverse),At.set(St.normal.x,St.normal.y,St.normal.z,St.constant);var ve=ut.projectionMatrix;Ut.x=(Math.sign(At.x)+ve.elements[8])/ve.elements[0],Ut.y=(Math.sign(At.y)+ve.elements[9])/ve.elements[5],Ut.z=-1,Ut.w=(1+ve.elements[10])/ve.elements[14],At.multiplyScalar(2/At.dot(Ut)),ve.elements[2]=At.x,ve.elements[6]=At.y,ve.elements[10]=At.z+1-G,ve.elements[14]=At.w});this.onBeforeRender=function(se,ve,le){le.userData.refractor!==!0&&!re(le)!=!0&&(ie(),function(de){S.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),S.multiply(de.projectionMatrix),S.multiply(de.matrixWorldInverse),S.multiply(C.matrixWorld)}(le),Ct(le),function(de,Pe,Ve){C.visible=!1;var Ue=de.getRenderTarget(),ke=de.xr.enabled,he=de.shadowMap.autoUpdate;de.xr.enabled=!1,de.shadowMap.autoUpdate=!1,de.setRenderTarget(O),de.autoClear===!1&&de.clear(),de.render(Pe,ut),de.xr.enabled=ke,de.shadowMap.autoUpdate=he,de.setRenderTarget(Ue);var Te=Ve.viewport;Te!==void 0&&de.state.viewport(Te),C.visible=!0}(se,ve,le))},this.getRenderTarget=function(){return O}};E.prototype=Object.create(p.Mesh.prototype),E.prototype.constructor=E,E.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","	vUv = textureMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","	return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","	return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","	vec4 base = texture2DProj( tDiffuse, vUv );","	gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join(`
`)};var P=function(w,T){p.Mesh.call(this,w),this.type="Water";var C=this,vt=(T=T||{}).color!==void 0?new p.Color(T.color):new p.Color(16777215),Tt=T.textureWidth||512,Pt=T.textureHeight||512,G=T.clipBias||0,Y=T.flowDirection||new p.Vector2(1,0),at=T.flowSpeed||.03,ut=T.reflectivity||.02,x=T.scale||1,S=T.shader||P.WaterShader,U=T.encoding!==void 0?T.encoding:p.LinearEncoding,O=new p.TextureLoader,pt=T.flowMap||void 0,ct=T.normalMap0||O.load("textures/water/Water_1_M_Normal.jpg"),_t=T.normalMap1||O.load("textures/water/Water_2_M_Normal.jpg"),Ot=new p.Matrix4,Vt=new p.Clock;if(_!==void 0)if(E!==void 0){var St=new _(w,{textureWidth:Tt,textureHeight:Pt,clipBias:G,encoding:U}),At=new E(w,{textureWidth:Tt,textureHeight:Pt,clipBias:G,encoding:U});St.matrixAutoUpdate=!1,At.matrixAutoUpdate=!1,this.material=new p.ShaderMaterial({uniforms:p.UniformsUtils.merge([p.UniformsLib.fog,S.uniforms]),vertexShader:S.vertexShader,fragmentShader:S.fragmentShader,transparent:!0,fog:!0}),pt!==void 0?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:pt}):this.material.uniforms.flowDirection={type:"v2",value:Y},ct.wrapS=ct.wrapT=p.RepeatWrapping,_t.wrapS=_t.wrapT=p.RepeatWrapping,this.material.uniforms.tReflectionMap.value=St.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=At.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=ct,this.material.uniforms.tNormalMap1.value=_t,this.material.uniforms.color.value=vt,this.material.uniforms.reflectivity.value=ut,this.material.uniforms.textureMatrix.value=Ot,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=.075,this.material.uniforms.config.value.z=.075,this.material.uniforms.config.value.w=x,this.onBeforeRender=function(Ut,re,ie){var Ct,se;!function(ve){Ot.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),Ot.multiply(ve.projectionMatrix),Ot.multiply(ve.matrixWorldInverse),Ot.multiply(C.matrixWorld)}(ie),Ct=Vt.getDelta(),(se=C.material.uniforms.config).value.x+=at*Ct,se.value.y=se.value.x+.075,se.value.x>=.15?(se.value.x=0,se.value.y=.075):se.value.y>=.15&&(se.value.y=se.value.y-.15),C.visible=!1,St.matrixWorld.copy(C.matrixWorld),At.matrixWorld.copy(C.matrixWorld),St.onBeforeRender(Ut,re,ie),At.onBeforeRender(Ut,re,ie),C.visible=!0}}else console.error("THREE.Water: Required component Refractor not found.");else console.error("THREE.Water: Required component Reflector not found.")};P.prototype=Object.create(p.Mesh.prototype),P.prototype.constructor=P,P.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new p.Vector4}},vertexShader:["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","uniform mat4 textureMatrix;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","	vUv = uv;","	vCoord = textureMatrix * vec4( position, 1.0 );","	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","	vToEye = cameraPosition - worldPosition.xyz;","	vec4 mvPosition =  viewMatrix * worldPosition;","	gl_Position = projectionMatrix * mvPosition;","	#include <logdepthbuf_vertex>","	#include <fog_vertex>","}"].join(`
`),fragmentShader:["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform sampler2D tReflectionMap;","uniform sampler2D tRefractionMap;","uniform sampler2D tNormalMap0;","uniform sampler2D tNormalMap1;","#ifdef USE_FLOWMAP","	uniform sampler2D tFlowMap;","#else","	uniform vec2 flowDirection;","#endif","uniform vec3 color;","uniform float reflectivity;","uniform vec4 config;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","	#include <logdepthbuf_fragment>","	float flowMapOffset0 = config.x;","	float flowMapOffset1 = config.y;","	float halfCycle = config.z;","	float scale = config.w;","	vec3 toEye = normalize( vToEye );","	vec2 flow;","	#ifdef USE_FLOWMAP","		flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;","	#else","		flow = flowDirection;","	#endif","	flow.x *= - 1.0;","	vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );","	vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );","	float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;","	vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );","	vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );","	float theta = max( dot( toEye, normal ), 0.0 );","	float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );","	vec3 coord = vCoord.xyz / vCoord.w;","	vec2 uv = coord.xy + coord.z * normal.xz * 0.05;","	vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );","	vec4 refractColor = texture2D( tRefractionMap, uv );","	gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );","	#include <tonemapping_fragment>","	#include <encodings_fragment>","	#include <fog_fragment>","}"].join(`
`)}},function(ee,v,f){f.r(v),f.d(v,"ConvexGeometry",function(){return E}),f.d(v,"ConvexBufferGeometry",function(){return P});var p=f(0),_=function(){var w,T,C,vt,Tt=new p.Vector3;function Pt(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new ut,this.unassigned=new ut,this.vertices=[]}function G(){this.normal=new p.Vector3,this.midpoint=new p.Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}function Y(x,S){this.vertex=x,this.prev=null,this.next=null,this.twin=null,this.face=S}function at(x){this.point=x,this.prev=null,this.next=null,this.face=null}function ut(){this.head=null,this.tail=null}return Object.assign(Pt.prototype,{setFromPoints:function(x){Array.isArray(x)!==!0&&console.error("THREE.ConvexHull: Points parameter is not an array."),x.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var S=0,U=x.length;S<U;S++)this.vertices.push(new at(x[S]));return this.compute(),this},setFromObject:function(x){var S=[];return x.updateMatrixWorld(!0),x.traverse(function(U){var O,pt,ct,_t=U.geometry;if(_t!==void 0){if(_t.isGeometry){var Ot=_t.vertices;for(O=0,pt=Ot.length;O<pt;O++)(ct=Ot[O].clone()).applyMatrix4(U.matrixWorld),S.push(ct)}else if(_t.isBufferGeometry){var Vt=_t.attributes.position;if(Vt!==void 0)for(O=0,pt=Vt.count;O<pt;O++)(ct=new p.Vector3).fromBufferAttribute(Vt,O).applyMatrix4(U.matrixWorld),S.push(ct)}}}),this.setFromPoints(S)},containsPoint:function(x){for(var S=this.faces,U=0,O=S.length;U<O;U++)if(S[U].distanceToPoint(x)>this.tolerance)return!1;return!0},intersectRay:function(x,S){for(var U=this.faces,O=-1/0,pt=1/0,ct=0,_t=U.length;ct<_t;ct++){var Ot=U[ct],Vt=Ot.distanceToPoint(x.origin),St=Ot.normal.dot(x.direction);if(Vt>0&&St>=0)return null;var At=St!==0?-Vt/St:0;if(!(At<=0)&&(St>0?pt=Math.min(At,pt):O=Math.max(At,O),O>pt))return null}return O!==-1/0?x.at(O,S):x.at(pt,S),S},intersectsRay:function(x){return this.intersectRay(x,Tt)!==null},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(x,S){return x.face=S,S.outside===null?this.assigned.append(x):this.assigned.insertBefore(S.outside,x),S.outside=x,this},removeVertexFromFace:function(x,S){return x===S.outside&&(x.next!==null&&x.next.face===S?S.outside=x.next:S.outside=null),this.assigned.remove(x),this},removeAllVerticesFromFace:function(x){if(x.outside!==null){for(var S=x.outside,U=x.outside;U.next!==null&&U.next.face===x;)U=U.next;return this.assigned.removeSubList(S,U),S.prev=U.next=null,x.outside=null,S}},deleteFaceVertices:function(x,S){var U=this.removeAllVerticesFromFace(x);if(U!==void 0)if(S===void 0)this.unassigned.appendChain(U);else{var O=U;do{var pt=O.next;S.distanceToPoint(O.point)>this.tolerance?this.addVertexToFace(O,S):this.unassigned.append(O),O=pt}while(O!==null)}return this},resolveUnassignedPoints:function(x){if(this.unassigned.isEmpty()===!1){var S=this.unassigned.first();do{for(var U=S.next,O=this.tolerance,pt=null,ct=0;ct<x.length;ct++){var _t=x[ct];if(_t.mark===0){var Ot=_t.distanceToPoint(S.point);if(Ot>O&&(O=Ot,pt=_t),O>1e3*this.tolerance)break}}pt!==null&&this.addVertexToFace(S,pt),S=U}while(S!==null)}return this},computeExtremes:function(){var x,S,U,O=new p.Vector3,pt=new p.Vector3,ct=[],_t=[];for(x=0;x<3;x++)ct[x]=_t[x]=this.vertices[0];for(O.copy(this.vertices[0].point),pt.copy(this.vertices[0].point),x=0,S=this.vertices.length;x<S;x++){var Ot=this.vertices[x],Vt=Ot.point;for(U=0;U<3;U++)Vt.getComponent(U)<O.getComponent(U)&&(O.setComponent(U,Vt.getComponent(U)),ct[U]=Ot);for(U=0;U<3;U++)Vt.getComponent(U)>pt.getComponent(U)&&(pt.setComponent(U,Vt.getComponent(U)),_t[U]=Ot)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(O.x),Math.abs(pt.x))+Math.max(Math.abs(O.y),Math.abs(pt.y))+Math.max(Math.abs(O.z),Math.abs(pt.z))),{min:ct,max:_t}},computeInitialHull:function(){w===void 0&&(w=new p.Line3,T=new p.Plane,C=new p.Vector3);var x,S,U,O,pt,ct,_t,Ot,Vt,St=this.vertices,At=this.computeExtremes(),Ut=At.min,re=At.max,ie=0,Ct=0;for(ct=0;ct<3;ct++)(Vt=re[ct].point.getComponent(ct)-Ut[ct].point.getComponent(ct))>ie&&(ie=Vt,Ct=ct);for(S=Ut[Ct],U=re[Ct],ie=0,w.set(S.point,U.point),ct=0,_t=this.vertices.length;ct<_t;ct++)(x=St[ct])!==S&&x!==U&&(w.closestPointToPoint(x.point,!0,C),(Vt=C.distanceToSquared(x.point))>ie&&(ie=Vt,O=x));for(ie=-1,T.setFromCoplanarPoints(S.point,U.point,O.point),ct=0,_t=this.vertices.length;ct<_t;ct++)(x=St[ct])!==S&&x!==U&&x!==O&&(Vt=Math.abs(T.distanceToPoint(x.point)))>ie&&(ie=Vt,pt=x);var se=[];if(T.distanceToPoint(pt.point)<0)for(se.push(G.create(S,U,O),G.create(pt,U,S),G.create(pt,O,U),G.create(pt,S,O)),ct=0;ct<3;ct++)Ot=(ct+1)%3,se[ct+1].getEdge(2).setTwin(se[0].getEdge(Ot)),se[ct+1].getEdge(1).setTwin(se[Ot+1].getEdge(0));else for(se.push(G.create(S,O,U),G.create(pt,S,U),G.create(pt,U,O),G.create(pt,O,S)),ct=0;ct<3;ct++)Ot=(ct+1)%3,se[ct+1].getEdge(2).setTwin(se[0].getEdge((3-ct)%3)),se[ct+1].getEdge(0).setTwin(se[Ot+1].getEdge(1));for(ct=0;ct<4;ct++)this.faces.push(se[ct]);for(ct=0,_t=St.length;ct<_t;ct++)if((x=St[ct])!==S&&x!==U&&x!==O&&x!==pt){ie=this.tolerance;var ve=null;for(Ot=0;Ot<4;Ot++)(Vt=this.faces[Ot].distanceToPoint(x.point))>ie&&(ie=Vt,ve=this.faces[Ot]);ve!==null&&this.addVertexToFace(x,ve)}return this},reindexFaces:function(){for(var x=[],S=0;S<this.faces.length;S++){var U=this.faces[S];U.mark===0&&x.push(U)}return this.faces=x,this},nextVertexToAdd:function(){if(this.assigned.isEmpty()===!1){var x,S=0,U=this.assigned.first().face,O=U.outside;do{var pt=U.distanceToPoint(O.point);pt>S&&(S=pt,x=O),O=O.next}while(O!==null&&O.face===U);return x}},computeHorizon:function(x,S,U,O){var pt;this.deleteFaceVertices(U),U.mark=1,pt=S===null?S=U.getEdge(0):S.next;do{var ct=pt.twin,_t=ct.face;_t.mark===0&&(_t.distanceToPoint(x)>this.tolerance?this.computeHorizon(x,ct,_t,O):O.push(pt)),pt=pt.next}while(pt!==S);return this},addAdjoiningFace:function(x,S){var U=G.create(x,S.tail(),S.head());return this.faces.push(U),U.getEdge(-1).setTwin(S.twin),U.getEdge(0)},addNewFaces:function(x,S){this.newFaces=[];for(var U=null,O=null,pt=0;pt<S.length;pt++){var ct=S[pt],_t=this.addAdjoiningFace(x,ct);U===null?U=_t:_t.next.setTwin(O),this.newFaces.push(_t.face),O=_t}return U.next.setTwin(O),this},addVertexToHull:function(x){var S=[];return this.unassigned.clear(),this.removeVertexFromFace(x,x.face),this.computeHorizon(x.point,null,x.face,S),this.addNewFaces(x,S),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var x;for(this.computeInitialHull();(x=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(x);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(G,{create:function(x,S,U){var O=new G,pt=new Y(x,O),ct=new Y(S,O),_t=new Y(U,O);return pt.next=_t.prev=ct,ct.next=pt.prev=_t,_t.next=ct.prev=pt,O.edge=pt,O.compute()}}),Object.assign(G.prototype,{getEdge:function(x){for(var S=this.edge;x>0;)S=S.next,x--;for(;x<0;)S=S.prev,x++;return S},compute:function(){vt===void 0&&(vt=new p.Triangle);var x=this.edge.tail(),S=this.edge.head(),U=this.edge.next.head();return vt.set(x.point,S.point,U.point),vt.getNormal(this.normal),vt.getMidpoint(this.midpoint),this.area=vt.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(x){return this.normal.dot(x)-this.constant}}),Object.assign(Y.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var x=this.head(),S=this.tail();return S!==null?S.point.distanceTo(x.point):-1},lengthSquared:function(){var x=this.head(),S=this.tail();return S!==null?S.point.distanceToSquared(x.point):-1},setTwin:function(x){return this.twin=x,x.twin=this,this}}),Object.assign(ut.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(x,S){return S.prev=x.prev,S.next=x,S.prev===null?this.head=S:S.prev.next=S,x.prev=S,this},insertAfter:function(x,S){return S.prev=x,S.next=x.next,S.next===null?this.tail=S:S.next.prev=S,x.next=S,this},append:function(x){return this.head===null?this.head=x:this.tail.next=x,x.prev=this.tail,x.next=null,this.tail=x,this},appendChain:function(x){for(this.head===null?this.head=x:this.tail.next=x,x.prev=this.tail;x.next!==null;)x=x.next;return this.tail=x,this},remove:function(x){return x.prev===null?this.head=x.next:x.prev.next=x.next,x.next===null?this.tail=x.prev:x.next.prev=x.prev,this},removeSubList:function(x,S){return x.prev===null?this.head=S.next:x.prev.next=S.next,S.next===null?this.tail=x.prev:S.next.prev=x.prev,this},isEmpty:function(){return this.head===null}}),Pt}(),E=function(w){p.Geometry.call(this),this.fromBufferGeometry(new P(w)),this.mergeVertices()};E.prototype=Object.create(p.Geometry.prototype),E.prototype.constructor=E;var P=function(w){p.BufferGeometry.call(this);var T=[],C=[];_===void 0&&console.error("THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on ConvexHull");for(var vt=new _().setFromPoints(w).faces,Tt=0;Tt<vt.length;Tt++){var Pt=vt[Tt],G=Pt.edge;do{var Y=G.head().point;T.push(Y.x,Y.y,Y.z),C.push(Pt.normal.x,Pt.normal.y,Pt.normal.z),G=G.next}while(G!==Pt.edge)}this.setAttribute("position",new p.Float32BufferAttribute(T,3)),this.setAttribute("normal",new p.Float32BufferAttribute(C,3))};P.prototype=Object.create(p.BufferGeometry.prototype),P.prototype.constructor=P},function(ee,v,f){f.r(v),f.d(v,"AnimationAction",function(){return p});function p(_,E,P,w){this._mixer=_,this._clip=E,this._localRoot=P||null,this.blendMode=w||E.blendMode;for(var T=E.tracks,C=T.length,vt=new Array(C),Tt={endingStart:2400,endingEnd:2400},Pt=0;Pt!==C;++Pt){var G=T[Pt].createInterpolant(null);vt[Pt]=G,G.settings=Tt}this._interpolantSettings=Tt,this._interpolants=vt,this._propertyBindings=new Array(C),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}Object.assign(p.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(_){return this._startTime=_,this},setLoop:function(_,E){return this.loop=_,this.repetitions=E,this},setEffectiveWeight:function(_){return this.weight=_,this._effectiveWeight=this.enabled?_:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(_){return this._scheduleFading(_,0,1)},fadeOut:function(_){return this._scheduleFading(_,1,0)},crossFadeFrom:function(_,E,P){if(_.fadeOut(E),this.fadeIn(E),P){var w=this._clip.duration,T=_._clip.duration,C=T/w,vt=w/T;_.warp(1,C,E),this.warp(vt,1,E)}return this},crossFadeTo:function(_,E,P){return _.crossFadeFrom(this,E,P)},stopFading:function(){var _=this._weightInterpolant;return _!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(_)),this},setEffectiveTimeScale:function(_){return this.timeScale=_,this._effectiveTimeScale=this.paused?0:_,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(_){return this.timeScale=this._clip.duration/_,this.stopWarping()},syncWith:function(_){return this.time=_.time,this.timeScale=_.timeScale,this.stopWarping()},halt:function(_){return this.warp(this._effectiveTimeScale,0,_)},warp:function(_,E,P){var w=this._mixer,T=w.time,C=this._timeScaleInterpolant,vt=this.timeScale;C===null&&(C=w._lendControlInterpolant(),this._timeScaleInterpolant=C);var Tt=C.parameterPositions,Pt=C.sampleValues;return Tt[0]=T,Tt[1]=T+P,Pt[0]=_/vt,Pt[1]=E/vt,this},stopWarping:function(){var _=this._timeScaleInterpolant;return _!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(_)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(_,E,P,w){if(this.enabled){var T=this._startTime;if(T!==null){var C=(_-T)*P;if(C<0||P===0)return;this._startTime=null,E=P*C}E*=this._updateTimeScale(_);var vt=this._updateTime(E),Tt=this._updateWeight(_);if(Tt>0){var Pt=this._interpolants,G=this._propertyBindings;switch(this.blendMode){case 2501:for(var Y=0,at=Pt.length;Y!==at;++Y)Pt[Y].evaluate(vt),G[Y].accumulateAdditive(Tt);break;case 2500:default:for(Y=0,at=Pt.length;Y!==at;++Y)Pt[Y].evaluate(vt),G[Y].accumulate(w,Tt)}}}else this._updateWeight(_)},_updateWeight:function(_){var E=0;if(this.enabled){E=this.weight;var P=this._weightInterpolant;if(P!==null){var w=P.evaluate(_)[0];E*=w,_>P.parameterPositions[1]&&(this.stopFading(),w===0&&(this.enabled=!1))}}return this._effectiveWeight=E,E},_updateTimeScale:function(_){var E=0;if(!this.paused){E=this.timeScale;var P=this._timeScaleInterpolant;P!==null&&(E*=P.evaluate(_)[0],_>P.parameterPositions[1]&&(this.stopWarping(),E===0?this.paused=!0:this.timeScale=E))}return this._effectiveTimeScale=E,E},_updateTime:function(_){var E=this.time+_,P=this._clip.duration,w=this.loop,T=this._loopCount,C=w===2202;if(_===0)return T===-1?E:C&&(1&T)==1?P-E:E;if(w===2200){T===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(E>=P)E=P;else{if(!(E<0)){this.time=E;break t}E=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=E,this._mixer.dispatchEvent({type:"finished",action:this,direction:_<0?-1:1})}}else{if(T===-1&&(_>=0?(T=0,this._setEndings(!0,this.repetitions===0,C)):this._setEndings(this.repetitions===0,!0,C)),E>=P||E<0){var vt=Math.floor(E/P);E-=P*vt,T+=Math.abs(vt);var Tt=this.repetitions-T;if(Tt<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,E=_>0?P:0,this.time=E,this._mixer.dispatchEvent({type:"finished",action:this,direction:_>0?1:-1});else{if(Tt===1){var Pt=_<0;this._setEndings(Pt,!Pt,C)}else this._setEndings(!1,!1,C);this._loopCount=T,this.time=E,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:vt})}}else this.time=E;if(C&&(1&T)==1)return P-E}return E},_setEndings:function(_,E,P){var w=this._interpolantSettings;P?(w.endingStart=2401,w.endingEnd=2401):(w.endingStart=_?this.zeroSlopeAtStart?2401:2400:2402,w.endingEnd=E?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(_,E,P){var w=this._mixer,T=w.time,C=this._weightInterpolant;C===null&&(C=w._lendControlInterpolant(),this._weightInterpolant=C);var vt=C.parameterPositions,Tt=C.sampleValues;return vt[0]=T,Tt[0]=E,vt[1]=T+_,Tt[1]=P,this}})}]))}),Zv=gr(function(mr,kt){/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */var ee=Ze&&Ze.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(kt,"__esModule",{value:!0});var v=ee(ol),f=function(){function p(_,E){this.physics=_,this.ammo=E,this.offset={x:0,y:0,z:0},this.errors=[],this.checkCollisions=!1,this.breakable=!1,this.didUpdate=!1,this._emitUpdateEvents=!1,this._needUpdate=!1,this.tmpEuler=new Jt.Euler,this.tmpQuaternion=new Jt.Quaternion,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtVector3_1=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.name=E.name}return p.prototype.destructor=function(){this.eventEmitter&&this.eventEmitter.removeAllListeners(),Ammo.destroy(this.tmpBtVector3),Ammo.destroy(this.tmpBtVector3_1),Ammo.destroy(this.tmpBtQuaternion)},p.prototype.setupEventEmitter=function(){typeof this.eventEmitter=="undefined"&&(this.eventEmitter=new v.default)},Object.defineProperty(p.prototype,"needUpdate",{get:function(){return this._needUpdate},set:function(_){!_&&this._needUpdate&&(this.didUpdate=!0),this._needUpdate=_},enumerable:!0,configurable:!0}),p.prototype.onUpdateEvent=function(_,E){E===void 0&&(E=!1),this.setupEventEmitter(),this._emitUpdateEvents=!0,E?this.eventEmitter.once("update",function(){_()}):this.eventEmitter.on("update",function(){_()})},Object.defineProperty(p.prototype,"on",{get:function(){var _=this;return{update:function(E){return _.onUpdateEvent(E)},collision:function(E){return _.onCollision(E)}}},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"once",{get:function(){var _=this;return{update:function(E){return _.onUpdateEvent(E,!0)}}},enumerable:!0,configurable:!0}),p.prototype.onCollision=function(_){var E=this;this.checkCollisions=!0,this.physics.collisionEvents.on("collision",function(P){var w=P.bodies,T=P.event;w[0].name===E.name?_(w[1],T):w[1].name===E.name&&_(w[0],T)})},p.prototype.transform=function(){var _=this.physics.tmpTrans;this.ammo.getMotionState().getWorldTransform(_)},p.prototype.refresh=function(){var _=this.physics.tmpTrans;this.ammo.getMotionState().setWorldTransform(_)},p.prototype.setRotation=function(_,E,P){var w=this.tmpEuler.set(_,E,P),T=this.tmpQuaternion.set(0,0,0,1);T.setFromEuler(w),this.tmpBtQuaternion.setValue(0,0,0,1);var C=this.tmpBtQuaternion;C.setValue(T.x,T.y,T.z,T.w);var vt=this.physics.tmpTrans;vt.setRotation(C)},Object.defineProperty(p.prototype,"rotation",{get:function(){var _=this.physics.tmpTrans,E=_.getRotation(),P=this.tmpQuaternion.set(E.x(),E.y(),E.z(),E.w()),w=P.x,T=P.y,C=P.z,vt=P.w,Tt=2*Math.acos(vt),Pt=w/Math.sqrt(1-vt*vt),G=T/Math.sqrt(1-vt*vt),Y=C/Math.sqrt(1-vt*vt);return{x:Pt*Tt||0,y:G*Tt||0,z:Y*Tt||0}},enumerable:!0,configurable:!0}),p.prototype.setPosition=function(_,E,P){var w=this.physics.tmpTrans;w.getOrigin().setValue(_,E,P)},Object.defineProperty(p.prototype,"position",{get:function(){var _=this.physics.tmpTrans;return{x:_.getOrigin().x(),y:_.getOrigin().y(),z:_.getOrigin().z()}},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"velocity",{get:function(){return{x:this.ammo.getLinearVelocity().x(),y:this.ammo.getLinearVelocity().y(),z:this.ammo.getLinearVelocity().z()}},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"angularVelocity",{get:function(){return{x:this.ammo.getAngularVelocity().x(),y:this.ammo.getAngularVelocity().y(),z:this.ammo.getAngularVelocity().z()}},enumerable:!0,configurable:!0}),p.prototype.setVelocity=function(_,E,P){this.tmpBtVector3.setValue(_,E,P),this.ammo.setLinearVelocity(this.tmpBtVector3)},p.prototype.setVelocityX=function(_){this.tmpBtVector3.setValue(_,this.velocity.y,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)},p.prototype.setVelocityY=function(_){this.tmpBtVector3.setValue(this.velocity.x,_,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)},p.prototype.setVelocityZ=function(_){this.tmpBtVector3.setValue(this.velocity.x,this.velocity.y,_),this.ammo.setLinearVelocity(this.tmpBtVector3)},p.prototype.setAngularVelocity=function(_,E,P){this.tmpBtVector3.setValue(_,E,P),this.ammo.setAngularVelocity(this.tmpBtVector3)},p.prototype.setAngularVelocityX=function(_){this.tmpBtVector3.setValue(_,this.angularVelocity.y,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)},p.prototype.setAngularVelocityY=function(_){this.tmpBtVector3.setValue(this.angularVelocity.x,_,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)},p.prototype.setAngularVelocityZ=function(_){this.tmpBtVector3.setValue(this.angularVelocity.x,this.angularVelocity.y,_),this.ammo.setAngularVelocity(this.tmpBtVector3)},p.prototype.applyForce=function(_,E,P){this.tmpBtVector3.setValue(_,E,P),this.ammo.applyCentralImpulse(this.tmpBtVector3)},p.prototype.applyForceX=function(_){this.tmpBtVector3.setValue(_,0,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)},p.prototype.applyForceY=function(_){this.tmpBtVector3.setValue(0,_,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)},p.prototype.applyForceZ=function(_){this.tmpBtVector3.setValue(0,0,_),this.ammo.applyCentralImpulse(this.tmpBtVector3)},p.prototype.applyCentralForce=function(_,E,P){this.tmpBtVector3.setValue(_,E,P),this.ammo.applyCentralForce(this.tmpBtVector3)},p.prototype.applyCentralImpulse=function(_,E,P){this.tmpBtVector3.setValue(_,E,P),this.ammo.applyCentralImpulse(this.tmpBtVector3)},p.prototype.applyCentralLocalForce=function(_,E,P){this.tmpBtVector3.setValue(_,E,P),this.ammo.applyCentralLocalForce(this.tmpBtVector3)},p.prototype.applyImpulse=function(_,E){this.tmpBtVector3.setValue(_.x||0,_.y||0,_.z||0),this.tmpBtVector3_1.setValue(E.x||0,E.y||0,E.z||0),this.ammo.applyImpulse(this.tmpBtVector3,this.tmpBtVector3_1)},p.prototype.applyLocalTorque=function(_,E,P){this.tmpBtVector3.setValue(_,E,P),this.ammo.applyLocalTorque(this.tmpBtVector3)},p.prototype.applyTorque=function(_,E,P){this.tmpBtVector3.setValue(_,E,P),this.ammo.applyTorque(this.tmpBtVector3)},p.prototype.applyTorqueImpulse=function(_,E,P){this.tmpBtVector3.setValue(_,E,P),this.ammo.applyTorqueImpulse(this.tmpBtVector3)},p.prototype.setCollisionFlags=function(_){this.ammo.setCollisionFlags(_)},p.prototype.getCollisionFlags=function(){return this.ammo.getCollisionFlags()},p.prototype.setRestitution=function(_){this.ammo.setRestitution(_)},p.prototype.setBounciness=function(_){this.setRestitution(_)},p.prototype.setFriction=function(_){this.ammo.setFriction(_)},p.prototype.setGravity=function(_,E,P){this.tmpBtVector3.setValue(_,E,P),this.ammo.setGravity(this.tmpBtVector3)},p.prototype.setLinearFactor=function(_,E,P){this.tmpBtVector3.setValue(_,E,P),this.ammo.setLinearFactor(this.tmpBtVector3)},p.prototype.setAngularFactor=function(_,E,P){this.tmpBtVector3.setValue(_,E,P),this.ammo.setAngularFactor(this.tmpBtVector3)},p.prototype.setCcdMotionThreshold=function(_){this.ammo.setCcdMotionThreshold(_)},p.prototype.setCcdSweptSphereRadius=function(_){this.ammo.setCcdSweptSphereRadius(_)},p}();kt.default=f}),sl=gr(function(mr,kt){/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */var ee=Ze&&Ze.__extends||function(){var f=function(p,_){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,P){E.__proto__=P}||function(E,P){for(var w in P)P.hasOwnProperty(w)&&(E[w]=P[w])},f(p,_)};return function(p,_){f(p,_);function E(){this.constructor=p}p.prototype=_===null?Object.create(_):(E.prototype=_.prototype,new E)}}();Object.defineProperty(kt,"__esModule",{value:!0});var v=function(f){ee(p,f);function p(){var _=f.call(this)||this;return _.vector3=new Jt.Vector3,_.isGroup=!1,_.hasBody=!1,_.anims={},_._currentAnimation="",_._animationActions=new Map,_.name="object-"+_.id,_}return p.prototype.setAction=function(_){console.warn("[enable3d] setAction(name) is deprecated. Use animation.play(name) instead!"),this.animationPlay(_)},Object.defineProperty(p.prototype,"world",{get:function(){return{theta:this.worldTheta,phi:this.worldPhi}},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"worldTheta",{get:function(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"worldPhi",{get:function(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"animation",{get:function(){var _=this;return{current:this._currentAnimation,add:function(E,P){return _.animationAdd(E,P)},play:function(E,P,w){return P===void 0&&(P=500),w===void 0&&(w=!0),_.animationPlay(E,P,w)},mixer:this.animationMixer}},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"animationMixer",{get:function(){return this._animationMixer||(this._animationMixer=new Jt.AnimationMixer(this)),this._animationMixer},set:function(_){this._animationMixer=_},enumerable:!0,configurable:!0}),p.prototype.animationAdd=function(_,E){this._animationActions.set(_,this.animationMixer.clipAction(E))},p.prototype.animationPlay=function(_,E,P){E===void 0&&(E=500),P===void 0&&(P=!0);var w=this._animationActions.get(_),T=this._animationActions.get(this._currentAnimation);w&&(w.reset(),T&&(w.crossFadeFrom(T,E/1e3,!0),w.clampWhenFinished=!0),P||w.setLoop(Jt.LoopOnce,0),w.play()),this._currentAnimation=_},p}(Jt.Object3D);kt.ExtendedObject3D=v,kt.default=v}),cl=gr(function(mr,kt){/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */var ee=Ze&&Ze.__extends||function(){var f=function(p,_){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,P){E.__proto__=P}||function(E,P){for(var w in P)P.hasOwnProperty(w)&&(E[w]=P[w])},f(p,_)};return function(p,_){f(p,_);function E(){this.constructor=p}p.prototype=_===null?Object.create(_):(E.prototype=_.prototype,new E)}}();Object.defineProperty(kt,"__esModule",{value:!0});var v=function(f){ee(p,f);function p(_,E){var P=f.call(this,_,E)||this;return P.vector3=new Jt.Vector3,P.isGroup=!1,P.hasBody=!1,P.name="object-"+P.id,P}return Object.defineProperty(p.prototype,"world",{get:function(){return{theta:this.worldTheta,phi:this.worldPhi}},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"worldTheta",{get:function(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"worldPhi",{get:function(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)},enumerable:!0,configurable:!0}),p}(Jt.Mesh);kt.ExtendedMesh=v}),Pp=gr(function(mr,kt){/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */var ee=Ze&&Ze.__extends||function(){var f=function(p,_){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,P){E.__proto__=P}||function(E,P){for(var w in P)P.hasOwnProperty(w)&&(E[w]=P[w])},f(p,_)};return function(p,_){f(p,_);function E(){this.constructor=p}p.prototype=_===null?Object.create(_):(E.prototype=_.prototype,new E)}}();Object.defineProperty(kt,"__esModule",{value:!0});var v=function(f){ee(p,f);function p(){var _=f.call(this)||this;return _.isMesh=!1,_.hasBody=!1,_.name="object-"+_.id,_}return p}(Jt.Group);kt.ExtendedGroup=v}),Jv=gr(function(mr,kt){/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */var ee=Ze&&Ze.__assign||function(){return ee=Object.assign||function(f){for(var p,_=1,E=arguments.length;_<E;_++){p=arguments[_];for(var P in p)Object.prototype.hasOwnProperty.call(p,P)&&(f[P]=p[P])}return f},ee.apply(this,arguments)};Object.defineProperty(kt,"__esModule",{value:!0});var v=function(){function f(p,_){this.factory=p,this.addExisting=_}return f.prototype.addPlane=function(p,_){p===void 0&&(p={}),_===void 0&&(_={});var E=this.factory.add.plane(p,_);return this.addExisting(E,p),E},f.prototype.addSphere=function(p,_){p===void 0&&(p={}),_===void 0&&(_={});var E=this.factory.add.sphere(p,_);return this.addExisting(E,p),E},f.prototype.addBox=function(p,_){p===void 0&&(p={}),_===void 0&&(_={});var E=this.factory.add.box(p,_);return this.addExisting(E,p),E},f.prototype.addGround=function(p,_){_===void 0&&(_={});var E=this.factory.add.ground(p,_),P=ee(ee({},p),{mass:0,collisionFlags:1});return this.addExisting(E,P),E},f.prototype.addCylinder=function(p,_){p===void 0&&(p={}),_===void 0&&(_={});var E=this.factory.add.cylinder(p,_);return this.addExisting(E,p),E},f.prototype.addCone=function(p,_){p===void 0&&(p={}),_===void 0&&(_={});var E=this.factory.add.cone(p,_);return this.addExisting(E,p),E},f.prototype.addTorus=function(p,_){p===void 0&&(p={}),_===void 0&&(_={});var E=this.factory.add.torus(p,_);return this.addExisting(E,p),E},f.prototype.addExtrude=function(p,_){_===void 0&&(_={});var E=this.factory.add.extrude(p,_);return E.translateX(1),this.addExisting(E),E},f}();kt.default=v}),Kv=gr(function(mr,kt){/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */var ee=Ze&&Ze.__assign||function(){return ee=Object.assign||function(f){for(var p,_=1,E=arguments.length;_<E;_++){p=arguments[_];for(var P in p)Object.prototype.hasOwnProperty.call(p,P)&&(f[P]=p[P])}return f},ee.apply(this,arguments)};Object.defineProperty(kt,"__esModule",{value:!0});var v=function(){function f(p,_){this.tmpTrans=p,this.physicsWorld=_,this.tmpBtVector3=new Ammo.btVector3}return f.prototype.toAmmoV3=function(p,_){return _===void 0&&(_=0),new Ammo.btVector3(typeof(p==null?void 0:p.x)!="undefined"?p.x:_,typeof(p==null?void 0:p.y)!="undefined"?p.y:_,typeof(p==null?void 0:p.z)!="undefined"?p.z:_)},Object.defineProperty(f.prototype,"addConstraints",{get:function(){var p=this;return{lock:function(_,E){return p.lock(_,E)},fixed:function(_,E){return p.fixed(_,E)},pointToPoint:function(_,E,P){return p.pointToPoint(_,E,P)},hinge:function(_,E,P){return p.hinge(_,E,P)},slider:function(_,E,P){return P===void 0&&(P={}),p.slider(_,E,P)},spring:function(_,E,P){return P===void 0&&(P={}),p.spring(_,E,P)},coneTwist:function(_,E,P,w){return P===void 0&&(P={}),w===void 0&&(w={}),p.coneTwist(_,E,P,w)},dof:function(_,E,P){return p.dof(_,E,P)}}},enumerable:!0,configurable:!0}),f.prototype.getTransform=function(p,_,E,P){E===void 0&&(E={x:0,y:0,z:0}),P===void 0&&(P=!1),E=ee({x:0,y:0,z:0},E);var w=function(Pt,G){var Y=(Pt.x()-G.x())/2+E.x,at=(Pt.y()-G.y())/2+E.y,ut=(Pt.z()-G.z())/2+E.z;return new Ammo.btVector3(Y,at,ut)},T=new Ammo.btTransform;if(T.setIdentity(),P){var vt=w(p.getWorldTransform().getOrigin(),_.getWorldTransform().getOrigin()),Tt=new Ammo.btTransform;Tt.setIdentity(),Tt.setOrigin(vt);var C=p.getCenterOfMassTransform().inverse().op_mul(_.getWorldTransform());return C.op_mul(Tt),{transformA:C,transformB:Tt}}else{T.setOrigin(new Ammo.btVector3(E.x,E.y,E.z));var C=p.getCenterOfMassTransform().inverse().op_mul(_.getWorldTransform()).op_mul(T);return{transformA:C,transformB:T}}},f.prototype.lock=function(p,_){var E={x:0,y:0,z:0};return this.dof(p,_,{angularLowerLimit:E,angularUpperLimit:E})},f.prototype.fixed=function(p,_){var E=this.getTransform(p.ammo,_.ammo);E.transformA.setRotation(p.ammo.getWorldTransform().getRotation()),E.transformB.setRotation(_.ammo.getWorldTransform().getRotation());var P=new Ammo.btFixedConstraint(p.ammo,_.ammo,E.transformA,E.transformB);return this.physicsWorld.addConstraint(P),P},f.prototype.pointToPoint=function(p,_,E){E===void 0&&(E={});var P=E.pivotA,w=E.pivotB,T=new Ammo.btVector3((P==null?void 0:P.x)||0,(P==null?void 0:P.y)||0,(P==null?void 0:P.z)||0),C=new Ammo.btVector3((w==null?void 0:w.x)||0,(w==null?void 0:w.y)||0,(w==null?void 0:w.z)||0),vt=new Ammo.btPoint2PointConstraint(p.ammo,_.ammo,T,C);return this.physicsWorld.addConstraint(vt),vt},f.prototype.hinge=function(p,_,E){E===void 0&&(E={});var P=E.pivotA,w=E.pivotB,T=E.axisA,C=E.axisB,vt=new Ammo.btVector3((P==null?void 0:P.x)||0,(P==null?void 0:P.y)||0,(P==null?void 0:P.z)||0),Tt=new Ammo.btVector3((w==null?void 0:w.x)||0,(w==null?void 0:w.y)||0,(w==null?void 0:w.z)||0),Pt=new Ammo.btVector3((T==null?void 0:T.x)||0,(T==null?void 0:T.y)||0,(T==null?void 0:T.z)||0),G=new Ammo.btVector3((C==null?void 0:C.x)||0,(C==null?void 0:C.y)||0,(C==null?void 0:C.z)||0),Y=new Ammo.btHingeConstraint(p.ammo,_.ammo,vt,Tt,Pt,G,!0);return this.physicsWorld.addConstraint(Y),Y},f.prototype.slider=function(p,_,E){E===void 0&&(E={});var P=this.getTransform(p.ammo,_.ammo),w=E.frameA,T=w===void 0?{}:w,C=E.frameB,vt=C===void 0?{}:C,Tt=E.linearLowerLimit,Pt=Tt===void 0?0:Tt,G=E.linearUpperLimit,Y=G===void 0?0:G,at=E.angularLowerLimit,ut=at===void 0?0:at,x=E.angularUpperLimit,S=x===void 0?0:x,U=P.transformA.getRotation();U.setEulerZYX(T.x||0,T.y||0,T.z||0),P.transformA.setRotation(U);var O=P.transformB.getRotation();O.setEulerZYX(vt.x||0,vt.y||0,vt.z||0),P.transformB.setRotation(O);var pt=new Ammo.btSliderConstraint(p.ammo,_.ammo,P.transformA,P.transformB,!0);return pt.setLowerLinLimit(Pt),pt.setUpperLinLimit(Y),pt.setLowerAngLimit(ut),pt.setUpperAngLimit(S),this.physicsWorld.addConstraint(pt),pt},f.prototype.spring=function(p,_,E){E===void 0&&(E={});var P=E.stiffness,w=P===void 0?50:P,T=E.damping,C=T===void 0?.01:T,vt=E.angularLock,Tt=vt===void 0?!1:vt,Pt=E.linearLowerLimit,G=Pt===void 0?{}:Pt,Y=E.linearUpperLimit,at=Y===void 0?{}:Y,ut=this.getTransform(p.ammo,_.ammo),x=new Ammo.btGeneric6DofSpringConstraint(p.ammo,_.ammo,ut.transformA,ut.transformB,!0);this.tmpBtVector3.setValue(G.x||0,G.y||0,G.z||0),x.setLinearLowerLimit(this.tmpBtVector3),this.tmpBtVector3.setValue(at.x||0,at.y||0,at.z||0),x.setLinearUpperLimit(this.tmpBtVector3),Tt&&(this.tmpBtVector3.setValue(0,0,0),x.setAngularLowerLimit(this.tmpBtVector3),x.setAngularUpperLimit(this.tmpBtVector3));for(var S=0;S<3;S++)x.enableSpring(S,!0),x.setStiffness(S,w),x.setDamping(S,C);return this.physicsWorld.addConstraint(x),x},f.prototype.coneTwist=function(p,_,E,P){E===void 0&&(E={}),P===void 0&&(P={});var w=new Ammo.btTransform;w.setIdentity(),w.getOrigin().setValue((E==null?void 0:E.x)||0,(E==null?void 0:E.y)||0,(E==null?void 0:E.z)||0);var T=new Ammo.btTransform;T.setIdentity(),T.getOrigin().setValue((P==null?void 0:P.x)||0,(P==null?void 0:P.y)||0,(P==null?void 0:P.z)||0);var C=this.getTransform(p.ammo,_.ammo),vt=new Ammo.btConeTwistConstraint(_.ammo,p.ammo,w,T);return vt.setAngularOnly(!0),this.physicsWorld.addConstraint(vt),vt},f.prototype.dof=function(p,_,E){E===void 0&&(E={});var P=E.offset,w=E.center,T=w===void 0?!1:w,C=ee({x:0,y:0,z:0},P),vt=this.getTransform(p.ammo,_.ammo,C,T),Tt=new Ammo.btGeneric6DofConstraint(p.ammo,_.ammo,vt.transformA,vt.transformB,!0),Pt=E.linearLowerLimit,G=E.linearUpperLimit,Y=E.angularLowerLimit,at=E.angularUpperLimit,ut=this.toAmmoV3(Pt),x=this.toAmmoV3(G),S=this.toAmmoV3(Y,-Math.PI),U=this.toAmmoV3(at,Math.PI);return Tt.setLinearLowerLimit(ut),Tt.setLinearUpperLimit(x),Tt.setAngularLowerLimit(S),Tt.setAngularUpperLimit(U),Ammo.destroy(ut),Ammo.destroy(x),Ammo.destroy(S),Ammo.destroy(U),this.physicsWorld.addConstraint(Tt,!1),Tt},f}();kt.default=v}),wo=gr(function(mr,kt){var ee=Ze&&Ze.__importDefault||function(Y){return Y&&Y.__esModule?Y:{default:Y}};Object.defineProperty(kt,"__esModule",{value:!0});var v={BOX:"box",CYLINDER:"cylinder",SPHERE:"sphere",CAPSULE:"capsule",CONE:"cone",HULL:"hull",HACD:"hacd",VHACD:"vhacd",MESH:"mesh",HEIGHTFIELD:"heightfield"},f={ALL:"all",MANUAL:"manual"},p=ee(sl),_=ee(Is),E=p.default.prototype.hasOwnProperty("updateMatrices");kt.createCollisionShapes=function(Y,at){switch(at.type){case v.BOX:return kt.createBoxShape(Y,at);case v.CYLINDER:return kt.createCylinderShape(Y,at);case v.CAPSULE:return kt.createCapsuleShape(Y,at);case v.CONE:return kt.createConeShape(Y,at);case v.SPHERE:return kt.createSphereShape(Y,at);case v.HULL:return kt.createHullShape(Y,at);case v.HACD:return kt.createHACDShapes(Y,at);case v.VHACD:return kt.createVHACDShapes(Y,at);case v.MESH:return kt.createTriMeshShape(Y,at);case v.HEIGHTFIELD:return kt.createHeightfieldTerrainShape(Y,at);default:return _.default(at.type+" is not currently supported"),[]}},kt.createBoxShape=function(Y,at){at.type=v.BOX,P(at),at.fit===f.ALL&&(at.halfExtents=Tt(Y,Pt(Y,at),at.minHalfExtent,at.maxHalfExtent));var ut=new Ammo.btVector3(at.halfExtents.x,at.halfExtents.y,at.halfExtents.z),x=new Ammo.btBoxShape(ut);return Ammo.destroy(ut),w(x,at,C(Y)),x},kt.createCylinderShape=function(Y,at){at.type=v.CYLINDER,P(at),at.fit===f.ALL&&(at.halfExtents=Tt(Y,Pt(Y,at),at.minHalfExtent,at.maxHalfExtent));var ut=new Ammo.btVector3(at.halfExtents.x,at.halfExtents.y,at.halfExtents.z),x=function(){switch(at.cylinderAxis){case"y":return new Ammo.btCylinderShape(ut);case"x":return new Ammo.btCylinderShapeX(ut);case"z":return new Ammo.btCylinderShapeZ(ut)}return null}();return Ammo.destroy(ut),w(x,at,C(Y)),x},kt.createCapsuleShape=function(Y,at){at.type=v.CAPSULE,P(at),at.fit===f.ALL&&(at.halfExtents=Tt(Y,Pt(Y,at),at.minHalfExtent,at.maxHalfExtent));var ut=at.halfExtents,x=ut.x,S=ut.y,U=ut.z,O=function(){switch(at.cylinderAxis){case"y":return new Ammo.btCapsuleShape(Math.max(x,U),S*2);case"x":return new Ammo.btCapsuleShapeX(Math.max(S,U),x*2);case"z":return new Ammo.btCapsuleShapeZ(Math.max(x,S),U*2)}return null}();return w(O,at,C(Y)),O},kt.createConeShape=function(Y,at){at.type=v.CONE,P(at),at.fit===f.ALL&&(at.halfExtents=Tt(Y,Pt(Y,at),at.minHalfExtent,at.maxHalfExtent));var ut=at.halfExtents,x=ut.x,S=ut.y,U=ut.z,O=function(){switch(at.cylinderAxis){case"y":return new Ammo.btConeShape(Math.max(x,U),S*2);case"x":return new Ammo.btConeShapeX(Math.max(S,U),x*2);case"z":return new Ammo.btConeShapeZ(Math.max(x,S),U*2)}return null}();return w(O,at,C(Y)),O},kt.createSphereShape=function(Y,at){at.type=v.SPHERE,P(at);var ut;at.fit===f.MANUAL&&!isNaN(at.sphereRadius)?ut=at.sphereRadius:ut=vt(Y,at,Pt(Y,at));var x=new Ammo.btSphereShape(ut);return w(x,at,C(Y)),x},kt.createHullShape=function(){var Y=new Jt.Vector3,at=new Jt.Vector3;return function(ut,x){if(x.type=v.HULL,P(x),x.fit===f.MANUAL)return console.warn("cannot use fit: manual with type: hull"),null;var S=Pt(ut,x),U=new Ammo.btVector3,O=new Ammo.btConvexHullShape;O.setMargin(x.margin),at.addVectors(S.max,S.min).multiplyScalar(.5);var pt=0;T(ut,x,function(St){pt+=St.attributes.position.array.length/3});var ct=x.hullMaxVertices||1e5;pt>ct&&console.warn("too many vertices for hull shape; sampling ~"+ct+" from ~"+pt+" vertices");var _t=Math.min(1,ct/pt);T(ut,x,function(St,At){G(St,At);for(var Ut=St.attributes.position.array,re=0;re<Ut.length;re+=3)Math.random()<=_t&&(Y.set(Ut[re],Ut[re+1],Ut[re+2]).applyMatrix4(At).sub(at),U.setValue(Y.x,Y.y,Y.z),O.addPoint(U,re===Ut.length-3))});var Ot=O;if(O.getNumVertices()>=100){var Vt=new Ammo.btShapeHull(O);Vt.buildHull(x.margin),Ammo.destroy(O),Ot=new Ammo.btConvexHullShape(Ammo.getPointer(Vt.getVertexPointer()),Vt.numVertices()),Ammo.destroy(Vt)}return Ammo.destroy(U),w(Ot,x,C(ut)),Ot}}(),kt.createHACDShapes=function(){var Y=new Jt.Vector3,at=new Jt.Vector3;return function(ut,x){if(x.type=v.HACD,P(x),x.fit===f.MANUAL)return console.warn("cannot use fit: manual with type: hacd"),[];if(!Ammo.hasOwnProperty("HACD"))return console.warn("HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];var S=Pt(ut),U=C(ut),O=0,pt=0;at.addVectors(S.max,S.min).multiplyScalar(.5),T(ut,x,function(Te){O+=Te.attributes.position.array.length/3,Te.index?pt+=Te.index.array.length/3:pt+=Te.attributes.position.array.length/9});var ct=new Ammo.HACD;x.hasOwnProperty("compacityWeight")&&ct.SetCompacityWeight(x.compacityWeight),x.hasOwnProperty("volumeWeight")&&ct.SetVolumeWeight(x.volumeWeight),x.hasOwnProperty("nClusters")&&ct.SetNClusters(x.nClusters),x.hasOwnProperty("nVerticesPerCH")&&ct.SetNVerticesPerCH(x.nVerticesPerCH),x.hasOwnProperty("concavity")&&ct.SetConcavity(x.concavity);var _t=Ammo._malloc(O*3*8),Ot=Ammo._malloc(pt*3*4);ct.SetPoints(_t),ct.SetTriangles(Ot),ct.SetNPoints(O),ct.SetNTriangles(pt);var Vt=_t/8,St=Ot/4;T(ut,x,function(Te,Ce){G(Te,Ce);for(var je=Te.attributes.position.array,ft=Te.index?Te.index.array:null,tt=0;tt<je.length;tt+=3)Y.set(je[tt+0],je[tt+1],je[tt+2]).applyMatrix4(Ce).sub(at),Ammo.HEAPF64[Vt+tt+0]=Y.x,Ammo.HEAPF64[Vt+tt+1]=Y.y,Ammo.HEAPF64[Vt+tt+2]=Y.z;if(ft)for(var tt=0;tt<ft.length;tt++)Ammo.HEAP32[St+tt]=ft[tt];else for(var tt=0;tt<je.length/3;tt++)Ammo.HEAP32[St+tt]=tt}),ct.Compute(),Ammo._free(_t),Ammo._free(Ot);for(var At=ct.GetNClusters(),Ut=[],re=0;re<At;re++){var ie=new Ammo.btConvexHullShape;ie.setMargin(x.margin);var Ct=ct.GetNPointsCH(re),se=ct.GetNTrianglesCH(re),ve=Ammo._malloc(Ct*3*8),le=Ammo._malloc(se*3*4);ct.GetCH(re,ve,le);for(var de=ve/8,Pe=0;Pe<Ct;Pe++){var Ve=new Ammo.btVector3,Ue=Ammo.HEAPF64[de+Pe*3+0],ke=Ammo.HEAPF64[de+Pe*3+1],he=Ammo.HEAPF64[de+Pe*3+2];Ve.setValue(Ue,ke,he),ie.addPoint(Ve,Pe===Ct-1),Ammo.destroy(Ve)}w(ie,x,U),Ut.push(ie)}return Ut}}(),kt.createVHACDShapes=function(){var Y=new Jt.Vector3,at=new Jt.Vector3;return function(ut,x){if(x.type=v.VHACD,P(x),x.fit===f.MANUAL)return console.warn("cannot use fit: manual with type: vhacd"),[];if(!Ammo.hasOwnProperty("VHACD"))return console.warn("VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];var S=Pt(ut,x),U=C(ut),O=0,pt=0;at.addVectors(S.max,S.min).multiplyScalar(.5),T(ut,x,function(he){O+=he.attributes.position.count,he.index?pt+=he.index.count/3:pt+=he.attributes.position.count/3});var ct=new Ammo.VHACD,_t=new Ammo.Parameters;x.hasOwnProperty("resolution")&&_t.set_m_resolution(x.resolution),x.hasOwnProperty("depth")&&_t.set_m_depth(x.depth),x.hasOwnProperty("concavity")&&_t.set_m_concavity(x.concavity),x.hasOwnProperty("planeDownsampling")&&_t.set_m_planeDownsampling(x.planeDownsampling),x.hasOwnProperty("convexhullDownsampling")&&_t.set_m_convexhullDownsampling(x.convexhullDownsampling),x.hasOwnProperty("alpha")&&_t.set_m_alpha(x.alpha),x.hasOwnProperty("beta")&&_t.set_m_beta(x.beta),x.hasOwnProperty("gamma")&&_t.set_m_gamma(x.gamma),x.hasOwnProperty("pca")&&_t.set_m_pca(x.pca),x.hasOwnProperty("mode")&&_t.set_m_mode(x.mode),x.hasOwnProperty("maxNumVerticesPerCH")&&_t.set_m_maxNumVerticesPerCH(x.maxNumVerticesPerCH),x.hasOwnProperty("minVolumePerCH")&&_t.set_m_minVolumePerCH(x.minVolumePerCH),x.hasOwnProperty("convexhullApproximation")&&_t.set_m_convexhullApproximation(x.convexhullApproximation),x.hasOwnProperty("oclAcceleration")&&_t.set_m_oclAcceleration(x.oclAcceleration);var Ot=Ammo._malloc(O*3*8),Vt=Ammo._malloc(pt*3*4),St=Ot/8,At=Vt/4;T(ut,x,function(he,Te){G(he,Te);for(var Ce=he.attributes.position.array,je=he.index?he.index.array:null,ft=0;ft<Ce.length;ft+=3)Y.set(Ce[ft+0],Ce[ft+1],Ce[ft+2]).applyMatrix4(Te).sub(at),Ammo.HEAPF64[St+0]=Y.x,Ammo.HEAPF64[St+1]=Y.y,Ammo.HEAPF64[St+2]=Y.z,St+=3;if(je)for(var ft=0;ft<je.length;ft++)Ammo.HEAP32[At]=je[ft],At++;else for(var ft=0;ft<Ce.length/3;ft++)Ammo.HEAP32[At]=ft,At++}),ct.Compute(Ot,3,O,Vt,3,pt,_t),Ammo._free(Ot),Ammo._free(Vt);for(var Ut=ct.GetNConvexHulls(),re=[],ie=new Ammo.ConvexHull,Ct=0;Ct<Ut;Ct++){ct.GetConvexHull(Ct,ie);var se=ie.get_m_nPoints(),ve=ie.get_m_points(),le=new Ammo.btConvexHullShape;le.setMargin(x.margin);for(var de=0;de<se;de++){var Pe=new Ammo.btVector3,Ve=ie.get_m_points(de*3+0),Ue=ie.get_m_points(de*3+1),ke=ie.get_m_points(de*3+2);Pe.setValue(Ve,Ue,ke),le.addPoint(Pe,de===se-1),Ammo.destroy(Pe)}w(le,x,U),re.push(le)}return Ammo.destroy(ie),Ammo.destroy(ct),re}}(),kt.createTriMeshShape=function(){var Y=new Jt.Vector3,at=new Jt.Vector3,ut=new Jt.Vector3;return function(x,S){if(S.type=v.MESH,P(S),S.fit===f.MANUAL)return console.warn("cannot use fit: manual with type: mesh"),null;var U=C(x),O=new Ammo.btVector3,pt=new Ammo.btVector3,ct=new Ammo.btVector3,_t=new Ammo.btTriangleMesh(!0,!1);T(x,S,function(Vt,St){var At=Vt.attributes.position.array;if(Vt.index)for(var Ut=0;Ut<Vt.index.count;Ut+=3){var re=Vt.index.array[Ut]*3,ie=Vt.index.array[Ut+1]*3,Ct=Vt.index.array[Ut+2]*3;Y.set(At[re],At[re+1],At[re+2]).applyMatrix4(St),at.set(At[ie],At[ie+1],At[ie+2]).applyMatrix4(St),ut.set(At[Ct],At[Ct+1],At[Ct+2]).applyMatrix4(St),O.setValue(Y.x,Y.y,Y.z),pt.setValue(at.x,at.y,at.z),ct.setValue(ut.x,ut.y,ut.z),_t.addTriangle(O,pt,ct,!1)}else for(var Ut=0;Ut<At.length;Ut+=9)Y.set(At[Ut+0],At[Ut+1],At[Ut+2]).applyMatrix4(St),at.set(At[Ut+3],At[Ut+4],At[Ut+5]).applyMatrix4(St),ut.set(At[Ut+6],At[Ut+7],At[Ut+8]).applyMatrix4(St),O.setValue(Y.x,Y.y,Y.z),pt.setValue(at.x,at.y,at.z),ct.setValue(ut.x,ut.y,ut.z),_t.addTriangle(O,pt,ct,!1)});var Ot;return S.concave?Ot=new Ammo.btBvhTriangleMeshShape(_t,!0,!0):Ot=new Ammo.btConvexTriangleMeshShape(_t,!0),Ot.resources=[_t],Ammo.destroy(O),Ammo.destroy(pt),Ammo.destroy(ct),w(Ot,S,U),Ot}}(),kt.createHeightfieldTerrainShape=function(Y,at){if(P(at),at.fit===f.ALL)return console.warn("cannot use fit: all with type: heightfield"),null;for(var ut=at.heightfieldDistance||1,x=at.heightfieldData||[],S=at.heightScale||0,U=at.hasOwnProperty("upAxis")?at.upAxis:1,O=function(){switch(at.heightDataType){case"short":return Ammo.PHY_SHORT;case"float":return Ammo.PHY_FLOAT;default:return Ammo.PHY_FLOAT}}(),pt=at.hasOwnProperty("flipQuadEdges")?at.flipQuadEdges:!0,ct=x.length,_t=ct>0?x[0].length:0,Ot=Ammo._malloc(ct*_t*4),Vt=Ot/4,St=Number.POSITIVE_INFINITY,At=Number.NEGATIVE_INFINITY,Ut=0,re=0;re<ct;re++)for(var ie=0;ie<_t;ie++){var Ct=x[re][ie];Ammo.HEAPF32[Vt+Ut]=Ct,Ut++,St=Math.min(St,Ct),At=Math.max(At,Ct)}var se=new Ammo.btHeightfieldTerrainShape(_t,ct,Ot,S,St,At,U,O,pt),ve=new Ammo.btVector3(ut,1,ut);return se.setLocalScaling(ve),Ammo.destroy(ve),se.heightfieldData=Ot,w(se,at),se};function P(Y){Y.fit=Y.hasOwnProperty("fit")?Y.fit:f.ALL,Y.type=Y.type||v.HULL,Y.minHalfExtent=Y.hasOwnProperty("minHalfExtent")?Y.minHalfExtent:0,Y.maxHalfExtent=Y.hasOwnProperty("maxHalfExtent")?Y.maxHalfExtent:Number.POSITIVE_INFINITY,Y.cylinderAxis=Y.cylinderAxis||"y",Y.margin=Y.hasOwnProperty("margin")?Y.margin:.05,Y.includeInvisible=Y.hasOwnProperty("includeInvisible")?Y.includeInvisible:!1,Y.offset||(Y.offset=new Jt.Vector3),Y.orientation||(Y.orientation=new Jt.Quaternion)}var w=function(Y,at,ut){if(Y.type=at.type,Y.setMargin(at.margin),Y.destroy=function(){for(var S=0,U=Y.resources||[];S<U.length;S++){var O=U[S];Ammo.destroy(O)}Y.heightfieldData&&Ammo._free(Y.heightfieldData),Ammo.destroy(Y)},ut){var x=new Ammo.btVector3(ut.x,ut.y,ut.z);Y.setLocalScaling(x),Ammo.destroy(x)}},T=function(){var Y=new Jt.Matrix4,at=new Jt.Matrix4,ut=new Jt.BufferGeometry;return function(x,S,U){at.getInverse(x.matrixWorld),x.traverse(function(O){O.isMesh&&(O===x?Y.identity():(E&&O.updateMatrices(),Y.multiplyMatrices(at,O.matrixWorld)),U(O.geometry.isBufferGeometry?O.geometry:ut.fromGeometry(O.geometry),Y))})}}(),C=function(Y,at){var ut=Y.scale;return ut},vt=function(){var Y=new Jt.Vector3,at=new Jt.Vector3;return function(ut,x,S){var U=0,O=S.getCenter(at),pt=O.x,ct=O.y,_t=O.z;return T(ut,x,function(Ot,Vt){for(var St=Ot.attributes.position.array,At=0;At<St.length;At+=3){Y.set(St[At],St[At+1],St[At+2]).applyMatrix4(Vt);var Ut=pt-Y.x,re=ct-Y.y,ie=_t-Y.z;U=Math.max(U,Ut*Ut+re*re+ie*ie)}}),Math.sqrt(U)}}(),Tt=function(Y,at,ut,x){var S=new Jt.Vector3;return S.subVectors(at.max,at.min).multiplyScalar(.5).clampScalar(ut,x)},Pt=function(){var Y=new Jt.Vector3;return function(at,ut){var x=new Jt.Box3,S=Infinity,U=Infinity,O=Infinity,pt=-Infinity,ct=-Infinity,_t=-Infinity;return x.min.set(0,0,0),x.max.set(0,0,0),T(at,ut,function(Ot,Vt){for(var St=Ot.attributes.position.array,At=0;At<St.length;At+=3)Y.set(St[At],St[At+1],St[At+2]).applyMatrix4(Vt),Y.x<S&&(S=Y.x),Y.y<U&&(U=Y.y),Y.z<O&&(O=Y.z),Y.x>pt&&(pt=Y.x),Y.y>ct&&(ct=Y.y),Y.z>_t&&(_t=Y.z)}),x.min.set(S,U,O),x.max.set(pt,ct,_t),x}}(),G=function(Y,at){Y.computeBoundingBox();var ut=new Jt.Vector3;Y.boundingBox.getCenter(ut),at.makeTranslation(ut.x,ut.y,ut.z)}}),Qv=gr(function(mr,kt){/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */Object.defineProperty(kt,"__esModule",{value:!0}),kt.addTorusShape=function(ee,v){var f=ee.radius,p=f===void 0?1:f,_=ee.tube,E=_===void 0?.4:_,P=ee.tubularSegments,w=P===void 0?8:P,T=Math.PI,C=w,vt=Math.sqrt(2*E*E-2*E*E*Math.cos(2*T/C)),Tt=new Ammo.btVector3(E,T/C+.5*vt,E),Pt=new Ammo.btCylinderShape(Tt);Pt.setMargin(.05);for(var G=new Ammo.btCompoundShape,Y=new Ammo.btVector3(0,0,1),at=new Ammo.btVector3(0,p,0),ut=new Ammo.btQuaternion(v.x,v.y,v.z,v.w),x=0;x<C;x++){var S=x*2*T/C,U=at.rotate(Y,S),O=new Ammo.btTransform;ut.setRotation(Y,S+Math.PI/2),O.setIdentity(),O.setOrigin(U),O.setRotation(ut),G.addChildShape(O,Pt)}return G}}),Cp=gr(function(mr,kt){Object.defineProperty(kt,"__esModule",{value:!0});var ee=function(){function v(){this._defaultMaterial=new Jt.MeshLambertMaterial({color:13421772})}return v.prototype.get=function(){return this._defaultMaterial},v}();kt.default=ee}),Op=gr(function(mr,kt){/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */var ee=Ze&&Ze.__assign||function(){return ee=Object.assign||function(P){for(var w,T=1,C=arguments.length;T<C;T++){w=arguments[T];for(var vt in w)Object.prototype.hasOwnProperty.call(w,vt)&&(P[vt]=w[vt])}return P},ee.apply(this,arguments)},v=Ze&&Ze.__rest||function(P,w){var T={};for(var C in P)Object.prototype.hasOwnProperty.call(P,C)&&w.indexOf(C)<0&&(T[C]=P[C]);if(P!=null&&typeof Object.getOwnPropertySymbols=="function")for(var vt=0,C=Object.getOwnPropertySymbols(P);vt<C.length;vt++)w.indexOf(C[vt])<0&&Object.prototype.propertyIsEnumerable.call(P,C[vt])&&(T[C[vt]]=P[C[vt]]);return T},f=Ze&&Ze.__importDefault||function(P){return P&&P.__esModule?P:{default:P}};Object.defineProperty(kt,"__esModule",{value:!0});var p=f(Is),_=f(Cp),E=function(){function P(w){this.scene=w,this.isHeadless=w==="headless",this.defaultMaterial=new _.default}return Object.defineProperty(P.prototype,"make",{get:function(){var w=this;return{plane:function(T,C){return T===void 0&&(T={}),C===void 0&&(C={}),w.makePlane(T,C)},box:function(T,C){return T===void 0&&(T={}),C===void 0&&(C={}),w.makeBox(T,C)},sphere:function(T,C){return T===void 0&&(T={}),C===void 0&&(C={}),w.makeSphere(T,C)},cylinder:function(T,C){return T===void 0&&(T={}),C===void 0&&(C={}),w.makeCylinder(T,C)},cone:function(T,C){return T===void 0&&(T={}),C===void 0&&(C={}),w.makeCone(T,C)},torus:function(T,C){return T===void 0&&(T={}),C===void 0&&(C={}),w.makeTorus(T,C)},extrude:function(T,C){return C===void 0&&(C={}),w.makeExtrude(T,C)}}},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"add",{get:function(){var w=this;return{mesh:function(T){return w.addMesh(T)},existing:function(T){return w.addExisting(T)},plane:function(T,C){return T===void 0&&(T={}),C===void 0&&(C={}),w.addPlane(T,C)},box:function(T,C){return T===void 0&&(T={}),C===void 0&&(C={}),w.addBox(T,C)},ground:function(T,C){return C===void 0&&(C={}),w.addGround(T,C)},sphere:function(T,C){return T===void 0&&(T={}),C===void 0&&(C={}),w.addSphere(T,C)},cylinder:function(T,C){return T===void 0&&(T={}),C===void 0&&(C={}),w.addCylinder(T,C)},cone:function(T,C){return T===void 0&&(T={}),C===void 0&&(C={}),w.addCone(T,C)},torus:function(T,C){return T===void 0&&(T={}),C===void 0&&(C={}),w.addTorus(T,C)},extrude:function(T,C){return C===void 0&&(C={}),w.addExtrude(T,C)},material:function(T){return T===void 0&&(T={}),w.addMaterial(T)}}},enumerable:!0,configurable:!0}),P.prototype.addExisting=function(){for(var w,T=[],C=0;C<arguments.length;C++)T[C]=arguments[C];if(this.scene==="headless")return;(w=this.scene).add.apply(w,T)},P.prototype.addMesh=function(w){if(Array.isArray(w))for(var T=0;T<w.length;T++)this.addExisting(w[T]);else this.addExisting(w);return this},P.prototype.createMesh=function(w,T,C){var vt=C.x,Tt=vt===void 0?0:vt,Pt=C.y,G=Pt===void 0?0:Pt,Y=C.z,at=Y===void 0?0:Y,ut;switch(!Array.isArray(T)&&T.type){case"LineBasicMaterial":ut=new Jt.Line(w,T);break;case"PointsMaterial":ut=new Jt.Points(w,T);break;default:ut=new cl.ExtendedMesh(w,T);break}return ut.position.set(Tt,G,at),ut.castShadow=ut.receiveShadow=!0,ut},P.prototype.makeExtrude=function(w,T){var C=w.x,vt=w.y,Tt=w.z,Pt=w.name,G=w.shape,Y=w.autoCenter,at=Y===void 0?!0:Y,ut=w.breakable,x=ut===void 0?!1:ut,S=w.bufferGeometry,U=S===void 0?!0:S,O=v(w,["x","y","z","name","shape","autoCenter","breakable","bufferGeometry"]),pt=O.depth,ct=pt===void 0?1:pt,_t=O.bevelEnabled,Ot=_t===void 0?!1:_t,Vt=U||x||this.isHeadless?new Jt.ExtrudeBufferGeometry(G,ee({depth:ct,bevelEnabled:Ot},O)):new Jt.ExtrudeGeometry(G,ee({depth:ct,bevelEnabled:Ot},O)),St=this.addMaterial(T),At=this.createMesh(Vt,St,{x:C,y:vt,z:Tt});return at&&At.geometry.center(),At.name=Pt||"body_id_"+At.id,At.shape="extrude",At},P.prototype.addExtrude=function(w,T){T===void 0&&(T={});var C=this.makeExtrude(w,T);return this.addExisting(C),C},P.prototype.makePlane=function(w,T){var C=w.x,vt=w.y,Tt=w.z,Pt=w.name,G=w.breakable,Y=G===void 0?!1:G,at=w.bufferGeometry,ut=at===void 0?!0:at,x=v(w,["x","y","z","name","breakable","bufferGeometry"]),S=ut||Y||this.isHeadless?new Jt.PlaneBufferGeometry(x.width||1,x.height||1,x.widthSegments||1,x.heightSegments||1):new Jt.PlaneGeometry(x.width||1,x.height||1,x.widthSegments||1,x.heightSegments||1),U=this.addMaterial(T);U.side=Jt.DoubleSide;var O=this.createMesh(S,U,{x:C,y:vt,z:Tt});return O.name=Pt||"body_id_"+O.id,O.shape="plane",O},P.prototype.addPlane=function(w,T){var C=this.makePlane(w,T);return this.addExisting(C),C},P.prototype.makeSphere=function(w,T){var C=w.x,vt=w.y,Tt=w.z,Pt=w.name,G=w.breakable,Y=G===void 0?!1:G,at=w.bufferGeometry,ut=at===void 0?!0:at,x=v(w,["x","y","z","name","breakable","bufferGeometry"]),S=ut||Y||this.isHeadless?new Jt.SphereBufferGeometry(x.radius||1,x.widthSegments||16,x.heightSegments||12,x.phiStart||void 0,x.phiLength||void 0,x.thetaStart||void 0,x.thetaLength||void 0):new Jt.SphereGeometry(x.radius||1,x.widthSegments||16,x.heightSegments||12,x.phiStart||void 0,x.phiLength||void 0,x.thetaStart||void 0,x.thetaLength||void 0),U=this.addMaterial(T),O=this.createMesh(S,U,{x:C,y:vt,z:Tt});return O.name=Pt||"body_id_"+O.id,O.shape="sphere",O},P.prototype.addSphere=function(w,T){w===void 0&&(w={}),T===void 0&&(T={});var C=this.makeSphere(w,T);return this.addExisting(C),C},P.prototype.makeBox=function(w,T){var C=w.x,vt=w.y,Tt=w.z,Pt=w.name,G=w.breakable,Y=G===void 0?!1:G,at=w.bufferGeometry,ut=at===void 0?!0:at,x=v(w,["x","y","z","name","breakable","bufferGeometry"]),S=ut||Y||this.isHeadless?new Jt.BoxBufferGeometry(x.width||1,x.height||1,x.depth||1,x.widthSegments||void 0,x.heightSegments||void 0,x.depthSegments||void 0):new Jt.BoxGeometry(x.width||1,x.height||1,x.depth||1,x.widthSegments||void 0,x.heightSegments||void 0,x.depthSegments||void 0),U=this.addMaterial(T),O=this.createMesh(S,U,{x:C,y:vt,z:Tt});return O.name=Pt||"body_id_"+O.id,O.shape="box",O},P.prototype.addBox=function(w,T){w===void 0&&(w={}),T===void 0&&(T={});var C=this.makeBox(w,T);return this.addExisting(C),C},P.prototype.addGround=function(w,T){T===void 0&&(T={});var C=this.makeBox(w,T);return C.rotateX(Jt.MathUtils.degToRad(90)),this.addExisting(C),C},P.prototype.makeCylinder=function(w,T){w===void 0&&(w={}),T===void 0&&(T={});var C=w.x,vt=w.y,Tt=w.z,Pt=w.name,G=w.breakable,Y=G===void 0?!1:G,at=w.bufferGeometry,ut=at===void 0?!0:at,x=v(w,["x","y","z","name","breakable","bufferGeometry"]),S=ut||Y||this.isHeadless?new Jt.CylinderBufferGeometry(x.radiusTop||1,x.radiusBottom||1,x.height||1,x.radiusSegments||void 0,x.heightSegments||void 0,x.openEnded||void 0,x.thetaStart||void 0,x.thetaLength||void 0):new Jt.CylinderGeometry(x.radiusTop||1,x.radiusBottom||1,x.height||1,x.radiusSegments||void 0,x.heightSegments||void 0,x.openEnded||void 0,x.thetaStart||void 0,x.thetaLength||void 0),U=this.addMaterial(T),O=this.createMesh(S,U,{x:C,y:vt,z:Tt});return O.name=Pt||"body_id_"+O.id,O.shape="cylinder",O},P.prototype.addCylinder=function(w,T){w===void 0&&(w={}),T===void 0&&(T={});var C=this.makeCylinder(w,T);return this.addExisting(C),C},P.prototype.makeCone=function(w,T){w===void 0&&(w={}),T===void 0&&(T={});var C=w.x,vt=w.y,Tt=w.z,Pt=w.name,G=w.breakable,Y=G===void 0?!1:G,at=w.bufferGeometry,ut=at===void 0?!0:at,x=v(w,["x","y","z","name","breakable","bufferGeometry"]),S=ut||Y||this.isHeadless?new Jt.ConeBufferGeometry(x.radius||1,x.height||1,x.radiusSegments||8,x.heightSegments||1,x.openEnded||!1,x.thetaStart||0,x.thetaLength||2*Math.PI):new Jt.ConeBufferGeometry(x.radius||1,x.height||1,x.radiusSegments||8,x.heightSegments||1,x.openEnded||!1,x.thetaStart||0,x.thetaLength||2*Math.PI),U=this.addMaterial(T),O=this.createMesh(S,U,{x:C,y:vt,z:Tt});return O.name=Pt||"body_id_"+O.id,O.shape="cone",O},P.prototype.addCone=function(w,T){w===void 0&&(w={}),T===void 0&&(T={});var C=this.makeCone(w,T);return this.addExisting(C),C},P.prototype.makeTorus=function(w,T){w===void 0&&(w={}),T===void 0&&(T={});var C=w.x,vt=w.y,Tt=w.z,Pt=w.name,G=w.breakable,Y=G===void 0?!1:G,at=w.bufferGeometry,ut=at===void 0?!0:at,x=v(w,["x","y","z","name","breakable","bufferGeometry"]),S=ut||Y||this.isHeadless?new Jt.TorusBufferGeometry(x.radius||void 0,x.tube||void 0,x.radialSegments||void 0,x.tubularSegments||void 0,x.arc||void 0):new Jt.TorusGeometry(x.radius||void 0,x.tube||void 0,x.radialSegments||void 0,x.tubularSegments||void 0,x.arc||void 0),U=this.addMaterial(T),O=this.createMesh(S,U,{x:C,y:vt,z:Tt});return O.name=Pt||"body_id_"+O.id,O.shape="torus",O},P.prototype.addTorus=function(w,T){w===void 0&&(w={}),T===void 0&&(T={});var C=this.makeTorus(w,T);return this.addExisting(C),C},P.prototype.addMaterial=function(w){w===void 0&&(w={});var T=Object.keys(w)[0],C;if(this.scene==="headless")return this.defaultMaterial.get();switch(T){case"basic":C=new Jt.MeshBasicMaterial(w.basic);break;case"normal":C=new Jt.MeshNormalMaterial(w.normal);break;case"standard":C=new Jt.MeshStandardMaterial(w.standard);break;case"lambert":C=new Jt.MeshLambertMaterial(w.lambert);break;case"phong":C=new Jt.MeshPhongMaterial(w.phong);break;case"physical":typeof w.physical!="undefined"?C=new Jt.MeshPhysicalMaterial(w.physical):(p.default("You need to pass parameters to the physical material. (Fallback to default material)"),C=this.defaultMaterial.get());break;case"toon":C=new Jt.MeshToonMaterial(w.toon);break;case"line":C=new Jt.LineBasicMaterial(w.line);break;case"points":C=new Jt.PointsMaterial(w.points);break;case"custom":C=w.custom||this.defaultMaterial.get();break;default:C=this.defaultMaterial.get();break}return C},P}();kt.default=E}),$v=gr(function(mr,kt){/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */var ee=Ze&&Ze.__extends||function(){var _=function(E,P){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,T){w.__proto__=T}||function(w,T){for(var C in T)T.hasOwnProperty(C)&&(w[C]=T[C])},_(E,P)};return function(E,P){_(E,P);function w(){this.constructor=E}E.prototype=P===null?Object.create(P):(w.prototype=P.prototype,new w)}}(),v=Ze&&Ze.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(kt,"__esModule",{value:!0});var f=v(ol),p=function(_){ee(E,_);function E(){return _!==null&&_.apply(this,arguments)||this}return E.prototype.addCollider=function(P,w,T){if(!P.body||!w.body)return;P.body.checkCollisions=!0,w.body.checkCollisions=!0,this.on("collision",function(C){var vt,Tt,Pt=C.bodies,G=C.event;((vt=Pt[0])===null||vt===void 0?void 0:vt.name)&&((Tt=Pt[1])===null||Tt===void 0?void 0:Tt.name)&&(P==null?void 0:P.name)&&(w==null?void 0:w.name)&&((Pt[0].name===P.name&&Pt[1].name===w.name||Pt[1].name===P.name&&Pt[0].name===w.name)&&T(G))})},E}(f.default);kt.CollisionEvents=p}),tg=gr(function(mr,kt){Object.defineProperty(kt,"__esModule",{value:!0});/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/ammo-debug-drawer
 * @license      {@link https://github.com/InfiniteLee/ammo-debug-drawer/blob/master/LICENSE|MPL-2.0}
 */var ee={NoDebug:0,DrawWireframe:1,DrawAabb:2,DrawFeaturesText:4,DrawContactPoints:8,NoDeactivation:16,NoHelpText:32,DrawText:64,ProfileTimings:128,EnableSatComparison:256,DisableBulletLCP:512,EnableCCD:1024,DrawConstraints:1<<11,DrawConstraintLimits:1<<12,FastWireframe:1<<13,DrawNormals:1<<14,DrawOnTop:1<<15,MAX_DEBUG_DRAW_MODE:4294967295},v=function(){function f(p,_,E){E===void 0&&(E={}),this.scene=p,this.world=_,this.options=E,this.debugDrawMode=E.debugDrawMode||ee.DrawWireframe;var P=this.debugDrawMode&ee.DrawOnTop||!1,w=E.maxBufferSize||1e6;this.geometry=new Jt.BufferGeometry;var T=new Float32Array(w*3),C=new Float32Array(w*3);this.geometry.setAttribute("position",new Jt.BufferAttribute(T,3).setUsage(Jt.StaticDrawUsage)),this.geometry.setAttribute("color",new Jt.BufferAttribute(C,3).setUsage(Jt.StaticDrawUsage)),this.index=0;var vt=new Jt.LineBasicMaterial({vertexColors:!0,depthTest:!P});this.mesh=new Jt.LineSegments(this.geometry,vt),P&&(this.mesh.renderOrder=999),this.mesh.frustumCulled=!1,this.enabled=!1,this.debugDrawer=new Ammo.DebugDrawer,this.debugDrawer.drawLine=this.drawLine.bind(this),this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this),this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this),this.debugDrawer.draw3dText=this.draw3dText.bind(this),this.debugDrawer.setDebugMode=this.setDebugMode.bind(this),this.debugDrawer.getDebugMode=this.getDebugMode.bind(this),this.world.setDebugDrawer(this.debugDrawer)}return f.prototype.enable=function(){this.enabled=!0,this.scene.add(this.mesh)},f.prototype.disable=function(){this.enabled=!1,this.scene.remove(this.mesh)},f.prototype.update=function(){if(!this.enabled)return;this.index!=0&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index)},f.prototype.drawLine=function(p,_,E){var P=Ammo.HEAPF32,w=P[(E+0)/4],T=P[(E+4)/4],C=P[(E+8)/4],vt=P[(p+0)/4],Tt=P[(p+4)/4],Pt=P[(p+8)/4];this.geometry.attributes.position.setXYZ(this.index,vt,Tt,Pt),this.geometry.attributes.color.setXYZ(this.index++,w,T,C);var G=P[(_+0)/4],Y=P[(_+4)/4],at=P[(_+8)/4];this.geometry.attributes.position.setXYZ(this.index,G,Y,at),this.geometry.attributes.color.setXYZ(this.index++,w,T,C)},f.prototype.drawContactPoint=function(p,_,E,P,w){var T=Ammo.HEAPF32,C=T[(w+0)/4],vt=T[(w+4)/4],Tt=T[(w+8)/4],Pt=T[(p+0)/4],G=T[(p+4)/4],Y=T[(p+8)/4];this.geometry.attributes.position.setXYZ(this.index,Pt,G,Y),this.geometry.attributes.color.setXYZ(this.index++,C,vt,Tt);var at=T[(_+0)/4]*E,ut=T[(_+4)/4]*E,x=T[(_+8)/4]*E;this.geometry.attributes.position.setXYZ(this.index,Pt+at,G+ut,Y+x),this.geometry.attributes.color.setXYZ(this.index++,C,vt,Tt)},f.prototype.reportErrorWarning=function(p){Ammo.hasOwnProperty("Pointer_stringify")?console.warn(Ammo.Pointer_stringify(p)):this.warnedOnce||(this.warnedOnce=!0,console.warn("Cannot print warningString, please rebuild Ammo.js using 'debug' flag"))},f.prototype.draw3dText=function(p,_){console.warn("TODO: draw3dText")},f.prototype.setDebugMode=function(p){this.debugDrawMode=p},f.prototype.getDebugMode=function(){return this.debugDrawMode},f}();kt.default=v}),eg=gr(function(mr,kt){var ee=Ze&&Ze.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(kt,"__esModule",{value:!0});var v=Jt,f=ee(Is),p=function(_,E){this.minSizeForBreak=_||1.4,this.smallDelta=E||1e-4,this.tempLine1=new Jt.Line3,this.tempPlane1=new Jt.Plane,this.tempPlane2=new Jt.Plane,this.tempPlane_Cut=new Jt.Plane,this.tempCM1=new Jt.Vector3,this.tempCM2=new Jt.Vector3,this.tempVector3=new Jt.Vector3,this.tempVector3_2=new Jt.Vector3,this.tempVector3_3=new Jt.Vector3,this.tempVector3_P0=new Jt.Vector3,this.tempVector3_P1=new Jt.Vector3,this.tempVector3_P2=new Jt.Vector3,this.tempVector3_N0=new Jt.Vector3,this.tempVector3_N1=new Jt.Vector3,this.tempVector3_AB=new Jt.Vector3,this.tempVector3_CB=new Jt.Vector3,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var P=30*30,w=0;w<P;w++)this.segments[w]=!1};kt.ConvexObjectBreaker=p,p.prototype={constructor:p,prepareBreakableObject:function(_,E,P,w,T){_.geometry.isBufferGeometry||console.error("THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry.");var C=_.userData;C.mass=E,C.velocity=P.clone(),C.angularVelocity=w.clone(),C.breakable=T},subdivideByImpact:function(_,E,P,w,T){var C=[],vt=this.tempPlane1,Tt=this.tempPlane2;this.tempVector3.addVectors(E,P),vt.setFromCoplanarPoints(E,_.position,this.tempVector3);var Pt=T+w,G=this;function Y(at,ut,x,S){if(Math.random()<S*.05||S>Pt){C.push(at);return}var U=Math.PI;S===0?(Tt.normal.copy(vt.normal),Tt.constant=vt.constant):S<=w?(U=(x-ut)*(.2+.6*Math.random())+ut,G.tempVector3_2.copy(_.position).sub(E).applyAxisAngle(P,U).add(E),Tt.setFromCoplanarPoints(E,G.tempVector3,G.tempVector3_2)):(U=(.5*(S&1)+.2*(2-Math.random()))*Math.PI,G.tempVector3_2.copy(E).sub(at.position).applyAxisAngle(P,U).add(at.position),G.tempVector3_3.copy(P).add(at.position),Tt.setFromCoplanarPoints(at.position,G.tempVector3_3,G.tempVector3_2)),G.cutByPlane(at,Tt,G.tempResultObjects);var O=G.tempResultObjects.object1,pt=G.tempResultObjects.object2;O&&Y(O,ut,U,S+1),pt&&Y(pt,U,x,S+1)}return Y(_,0,2*Math.PI,0),C},cutByPlane:function(_,E,P){var w=_.geometry,T=w.attributes.position.array,C=w.attributes.normal.array,vt=T.length/3,Tt=vt/3,Pt=w.getIndex();Pt&&(Pt=Pt.array,Tt=Pt.length/3);function G(Z,W){var D=Z*3+W;return Pt?Pt[D]:D}for(var Y=[],at=[],ut=this.smallDelta,x=vt*vt,S=0;S<x;S++)this.segments[S]=!1;for(var U=this.tempVector3_P0,O=this.tempVector3_P1,pt=this.tempVector3_N0,ct=this.tempVector3_N1,S=0;S<Tt-1;S++){var _t=G(S,0),Ot=G(S,1),Vt=G(S,2);pt.set(C[_t],C[_t]+1,C[_t]+2);for(var St=S+1;St<Tt;St++){var At=G(St,0),Ut=G(St,1),re=G(St,2);ct.set(C[At],C[At]+1,C[At]+2);var ie=1-pt.dot(ct)<ut;ie&&(_t===At||_t===Ut||_t===re?Ot===At||Ot===Ut||Ot===re?(this.segments[_t*vt+Ot]=!0,this.segments[Ot*vt+_t]=!0):(this.segments[Vt*vt+_t]=!0,this.segments[_t*vt+Vt]=!0):(Ot===At||Ot===Ut||Ot===re)&&(this.segments[Vt*vt+Ot]=!0,this.segments[Ot*vt+Vt]=!0))}}var Ct=this.tempPlane_Cut;_.updateMatrix(),p.transformPlaneToLocalSpace(E,_.matrix,Ct);for(var S=0;S<Tt;S++)for(var se=G(S,0),ve=G(S,1),le=G(S,2),de=0;de<3;de++){var Pe=de===0?se:de===1?ve:le,Ve=de===0?ve:de===1?le:se,Ue=this.segments[Pe*vt+Ve];if(Ue)continue;this.segments[Pe*vt+Ve]=!0,this.segments[Ve*vt+Pe]=!0,U.set(T[3*Pe],T[3*Pe+1],T[3*Pe+2]),O.set(T[3*Ve],T[3*Ve+1],T[3*Ve+2]);var ke=0,he=Ct.distanceToPoint(U);he>ut?(ke=2,at.push(U.clone())):he<-ut?(ke=1,Y.push(U.clone())):(ke=3,Y.push(U.clone()),at.push(U.clone()));var Te=0,he=Ct.distanceToPoint(O);if(he>ut?(Te=2,at.push(O.clone())):he<-ut?(Te=1,Y.push(O.clone())):(Te=3,Y.push(O.clone()),at.push(O.clone())),ke===1&&Te===2||ke===2&&Te===1){this.tempLine1.start.copy(U),this.tempLine1.end.copy(O);var Ce=new Jt.Vector3;if(Ce=Ct.intersectLine(this.tempLine1,Ce),Ce===void 0)return console.error("Internal error: segment does not intersect plane."),P.segmentedObject1=null,P.segmentedObject2=null,0;Y.push(Ce),at.push(Ce.clone())}}var je=_.userData.mass*.5;this.tempCM1.set(0,0,0);var ft=0,tt=Y.length;if(tt>0){for(var S=0;S<tt;S++)this.tempCM1.add(Y[S]);this.tempCM1.divideScalar(tt);for(var S=0;S<tt;S++){var $=Y[S];$.sub(this.tempCM1),ft=Math.max(ft,$.x,$.y,$.z)}this.tempCM1.add(_.position)}this.tempCM2.set(0,0,0);var J=0,L=at.length;if(L>0){for(var S=0;S<L;S++)this.tempCM2.add(at[S]);this.tempCM2.divideScalar(L);for(var S=0;S<L;S++){var $=at[S];$.sub(this.tempCM2),J=Math.max(J,$.x,$.y,$.z)}this.tempCM2.add(_.position)}var I=null,z=null,X=0;if(tt>4)try{I=new Jt.Mesh(new v.ConvexBufferGeometry(Y),_.material),I.position.copy(this.tempCM1),I.quaternion.copy(_.quaternion),this.prepareBreakableObject(I,je,_.userData.velocity,_.userData.angularVelocity,2*ft>this.minSizeForBreak),X++}catch(Z){f.default("Error in ConvexObjectBreaker.ts")}if(L>4)try{z=new Jt.Mesh(new v.ConvexBufferGeometry(at),_.material),z.position.copy(this.tempCM2),z.quaternion.copy(_.quaternion),this.prepareBreakableObject(z,je,_.userData.velocity,_.userData.angularVelocity,2*J>this.minSizeForBreak),X++}catch(Z){f.default("Error in ConvexObjectBreaker.ts")}return P.object1=I,P.object2=z,X}},p.transformFreeVector=function(_,E){var P=_.x,w=_.y,T=_.z,C=E.elements;return _.x=C[0]*P+C[4]*w+C[8]*T,_.y=C[1]*P+C[5]*w+C[9]*T,_.z=C[2]*P+C[6]*w+C[10]*T,_},p.transformFreeVectorInverse=function(_,E){var P=_.x,w=_.y,T=_.z,C=E.elements;return _.x=C[0]*P+C[1]*w+C[2]*T,_.y=C[4]*P+C[5]*w+C[6]*T,_.z=C[8]*P+C[9]*w+C[10]*T,_},p.transformTiedVectorInverse=function(_,E){var P=_.x,w=_.y,T=_.z,C=E.elements;return _.x=C[0]*P+C[1]*w+C[2]*T-C[12],_.y=C[4]*P+C[5]*w+C[6]*T-C[13],_.z=C[8]*P+C[9]*w+C[10]*T-C[14],_},p.transformPlaneToLocalSpace=function(){var _=new Jt.Vector3;return function(P,w,T){T.normal.copy(P.normal),T.constant=P.constant;var C=p.transformTiedVectorInverse(P.coplanarPoint(_),w);p.transformFreeVectorInverse(T.normal,w),T.constant=-C.dot(T.normal)}}()}),rg=gr(function(mr,kt){Object.defineProperty(kt,"__esModule",{value:!0});var ee=function(){try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){var p=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(p instanceof WebAssembly.Module)return new WebAssembly.Instance(p)instanceof WebAssembly.Instance}}catch(_){}return!1}(),v=function(p,_){var E=document.createElement("script");E.onload=function(){_()},E.onerror=function(){throw new Error("failed to load "+p)},E.async=!0,E.src=p,document.head.appendChild(E)},f=function(p,_){ee?v(p+"/ammo.wasm.js",function(){return _()}):v(p+"/ammo.js",function(){return _()})};kt.default=f}),Dp=gr(function(mr,kt){var ee=Ze&&Ze.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(kt,"__esModule",{value:!0});var v=ee(rg),f=function(p,_){typeof window!="undefined"&&(window.__loadPhysics=!0),v.default(p,function(){Ammo().then(function(){_()})})};kt.PhysicsLoader=f}),Ip=gr(function(mr,kt){/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */Object.defineProperty(kt,"__esModule",{value:!0}),kt.ExtendedObject3D=sl.ExtendedObject3D,kt.ExtendedMesh=cl.ExtendedMesh,kt.AnimationMixer=Jt.AnimationMixer,kt.AnimationClip=Jt.AnimationClip,kt.AnimationAction=Jt.AnimationAction,kt.Object3D=Jt.Object3D,kt.Mesh=Jt.Mesh,kt.Material=Jt.Material,kt.Line=Jt.Line,kt.Points=Jt.Points,kt.Group=Jt.Group}),ng=gr(function(mr,kt){Object.defineProperty(kt,"__esModule",{value:!0});var ee=function(v,f){f.forEach(function(p){Object.getOwnPropertyNames(p.prototype).forEach(function(_){Object.defineProperty(v.prototype,_,Object.getOwnPropertyDescriptor(p.prototype,_))})})};kt.default=ee}),ig=gr(function(mr,kt){/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */Object.defineProperty(kt,"__esModule",{value:!0});var ee=function(){function v(f){this.physics=f}return v.prototype.getHitPointWorld=function(){var f=this._btRayCallback.get_m_hitPointWorld(),p={x:f.x(),y:f.y(),z:f.z()};return p},v.prototype.getHitNormalWorld=function(){var f=this._btRayCallback.get_m_hitNormalWorld(),p={x:f.x(),y:f.y(),z:f.z()};return p},v.prototype.getCollisionObject=function(){var f=function(_){return Object.values(_)[0]},p=f(this._btRayCallback.get_m_collisionObject());return this.physics.objectsAmmo[p]},v}();kt.default=ee}),ag=gr(function(mr,kt){/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */Object.defineProperty(kt,"__esModule",{value:!0});var ee=function(){function v(f){this.physics=f}return v.prototype.getHitPointsWorld=function(){for(var f=this._btRayCallback.get_m_hitPointWorld(),p=[],_=f.size()-1;_>=0;_--){var E=f.at(_);p.push({x:E.x(),y:E.y(),z:E.z()})}return p},v.prototype.getHitPointWorld=function(){return console.warn("[enable3d] Use getHitPointsWorld() instead of getHitPointWorld() for the AllHitsRayCaster!"),this.getHitPointsWorld()},v.prototype.getHitNormalsWorld=function(){for(var f=this._btRayCallback.get_m_hitNormalWorld(),p=[],_=f.size()-1;_>=0;_--){var E=f.at(_);p.push({x:E.x(),y:E.y(),z:E.z()})}return p},v.prototype.getCollisionObjects=function(){for(var f=function(w){return Object.values(w)[0]},p=[],_=this._btRayCallback.get_m_collisionObjects(),E=_.size()-1;E>=0;E--){var P=f(_.at(E));p.push(this.physics.objectsAmmo[P])}return p},v}();kt.default=ee}),ll=gr(function(mr,kt){/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */var ee=Ze&&Ze.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(kt,"__esModule",{value:!0});var v=ee(ng),f=ee(ig),p=ee(ag),_=function(){function w(T){this.physics=T}return w.prototype.setRayFromWorld=function(T,C,vt){T===void 0&&(T=0),C===void 0&&(C=0),vt===void 0&&(vt=0),this._btRayFrom.setValue(T,C,vt)},w.prototype.setRayToWorld=function(T,C,vt){T===void 0&&(T=0),C===void 0&&(C=0),vt===void 0&&(vt=0),this._btRayTo.setValue(T,C,vt)},w.prototype.hasHit=function(){return this._btRayCallback.hasHit()},w.prototype.rayTest=function(){typeof this._btRayCallback!="undefined"&&Ammo.destroy(this._btRayCallback),this._btRayCallback=this.type==="closest"?new Ammo.ClosestRayResultCallback(this._btRayFrom,this._btRayTo):new Ammo.AllHitsRayResultCallback(this._btRayFrom,this._btRayTo),this.physics.physicsWorld.rayTest(this._btRayFrom,this._btRayTo,this._btRayCallback)},w.prototype.destroy=function(){typeof this._btRayFrom!="undefined"&&Ammo.destroy(this._btRayFrom),typeof this._btRayTo!="undefined"&&Ammo.destroy(this._btRayTo),typeof this._btRayCallback!="undefined"&&Ammo.destroy(this._btRayCallback)},w}(),E=function(){function w(T){this.physics=T,this.type="closest",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}return w}();kt.ClosestRaycaster=E;var P=function(){function w(T){this.physics=T,this.type="allHits",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}return w}();kt.AllHitsRaycaster=P,v.default(E,[_,f.default]),v.default(P,[_,p.default])}),og=gr(function(mr,kt){Object.defineProperty(kt,"__esModule",{value:!0});var ee=function(){function v(f){f===void 0&&(f=!0),this.autoStart=f!==void 0?f:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return v.prototype.start=function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},v.prototype.stop=function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},v.prototype.getElapsedTime=function(){return this.getDelta(),this.elapsedTime},v.prototype.getDelta=function(){var f=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var p=(typeof performance=="undefined"?Date:performance).now();f=(p-this.oldTime)/1e3,this.oldTime=p,this.elapsedTime+=f}return f},v}();kt.Clock=ee}),sg=gr(function(mr,kt){/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */var ee=Ze&&Ze.__extends||function(){var ut=function(x,S){return ut=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(U,O){U.__proto__=O}||function(U,O){for(var pt in O)O.hasOwnProperty(pt)&&(U[pt]=O[pt])},ut(x,S)};return function(x,S){ut(x,S);function U(){this.constructor=x}x.prototype=S===null?Object.create(S):(U.prototype=S.prototype,new U)}}(),v=Ze&&Ze.__assign||function(){return v=Object.assign||function(ut){for(var x,S=1,U=arguments.length;S<U;S++){x=arguments[S];for(var O in x)Object.prototype.hasOwnProperty.call(x,O)&&(ut[O]=x[O])}return ut},v.apply(this,arguments)},f=Ze&&Ze.__spreadArrays||function(){for(var ut=0,x=0,S=arguments.length;x<S;x++)ut+=arguments[x].length;for(var U=Array(ut),O=0,x=0;x<S;x++)for(var pt=arguments[x],ct=0,_t=pt.length;ct<_t;ct++,O++)U[O]=pt[ct];return U},p=Ze&&Ze.__importDefault||function(ut){return ut&&ut.__esModule?ut:{default:ut}},_=Ze&&Ze.__importStar||function(ut){if(ut&&ut.__esModule)return ut;var x={};if(ut!=null)for(var S in ut)Object.hasOwnProperty.call(ut,S)&&(x[S]=ut[S]);return x.default=ut,x};Object.defineProperty(kt,"__esModule",{value:!0});var E=p(Is),P=p(Zv);kt.ExtendedObject3D=sl.ExtendedObject3D,kt.ExtendedMesh=cl.ExtendedMesh,kt.ExtendedGroup=Pp.ExtendedGroup;var w=p(Jv),T=p(Kv),C=p(ol),vt=p(Op),Tt=Jt,Pt=p(tg);kt.PhysicsLoader=Dp.PhysicsLoader;var G=p(Cp),Y=_(Ip);kt.Types=Y,kt.ClosestRaycaster=ll.ClosestRaycaster,kt.AllHitsRaycaster=ll.AllHitsRaycaster,kt.Clock=og.Clock;var at=function(ut){ee(x,ut);function x(S,U){U===void 0&&(U={});var O=ut.call(this)||this;if(O.scene=S,O.config=U,O.rigidBodies=[],O.objectsAmmo={},O.earlierDetectedCollisions=[],O.gravity=U.gravity||{x:0,y:-9.81,z:0},O.isHeadless=S==="headless",O.tmpEuler=new Jt.Euler,O.tmpQuaternion=new Jt.Quaternion,O.tmpVector3=new Jt.Vector3,O.tmpBtVector3=new Ammo.btVector3,O.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),O.emptyV3=new Jt.Vector3,O.impactPoint=new Jt.Vector3,O.impactNormal=new Jt.Vector3,S!=="headless"){O.defaultMaterial=new G.default;var pt="three.js version "+Tt.REVISION;console.log("%c %c %c %c %c "+pt+" %c https://threejs.org/","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}return O.start(),O}return x.prototype.destroy=function(S){var U,O=Object.keys(S).includes("body")?S.body:S;if(typeof(O==null?void 0:O.ammo)=="undefined")return;var pt=Object.values(O.ammo)[0],ct=Object.values(O.ammo)[1],_t=this.objectsAmmo[pt];if(pt&&ct&&_t&&((U=_t==null?void 0:_t.body)===null||U===void 0?void 0:U.ammo)){this.physicsWorld.removeRigidBody(_t.body.ammo),_t.body.destructor(),_t.body=void 0,_t.hasBody=!1,delete this.objectsAmmo[pt];for(var Ot=0;Ot<this.rigidBodies.length;Ot++)this.rigidBodies[Ot].name===ct&&(this.rigidBodies.splice(Ot,1),Ot--)}this.scene==="headless"&&_t&&(_t=null)},x.prototype.setup=function(){var S=this;if(this.setupPhysicsWorld(),this.scene!=="headless"){this.convexBreaker=new eg.ConvexObjectBreaker,this.objectsToRemove=[],this.numObjectsToRemove=0;for(var U=0;U<500;U++)this.objectsToRemove[U]=null}this.collisionEvents=new $v.CollisionEvents,this.factory=new vt.default(this.scene),this.shapes=new w.default(this.factory,function(O,pt){return S.addExisting(O,pt)}),this.constraints=new T.default(this.tmpTrans,this.physicsWorld),this.scene!=="headless"&&(this.debugDrawer=new Pt.default(this.scene,this.physicsWorld,{}))},x.prototype.updateDebugger=function(){if(this.scene==="headless")return;this.debugDrawer&&this.debugDrawer.enabled&&this.debugDrawer.update()},x.prototype.setupPhysicsWorld=function(){var S=this.gravity,U=new Ammo.btDefaultCollisionConfiguration,O=new Ammo.btCollisionDispatcher(U),pt=new Ammo.btDbvtBroadphase,ct=new Ammo.btSequentialImpulseConstraintSolver;this.physicsWorld=new Ammo.btDiscreteDynamicsWorld(O,pt,ct,U),this.physicsWorld.setGravity(new Ammo.btVector3(S.x,S.y,S.z)),this.dispatcher=O,this.tmpTrans=new Ammo.btTransform},x.prototype.createDebrisFromBreakableObject=function(S,U){if(this.scene==="headless")return;S.material=this.defaultMaterial.get(),S.shape="hull",S.fragmentDepth=U.fragmentDepth+1,this.scene.add(S),this.addExisting(S),S.body.breakable=!1,setTimeout(function(){S.body.breakable=!0},2500)},x.prototype.removeDebris=function(S){if(this.scene==="headless")return;this.scene.remove(S),this.physicsWorld.removeRigidBody(S.body.ammo),delete this.objectsAmmo[S.ptr]},x.prototype.update=function(S){var U=this,O,pt;this.impactPoint.set(0,0,0),this.impactNormal.set(0,0,0);var ct=[],_t=S/1e3;this.physicsWorld.stepSimulation(_t,this.config.maxSubSteps||4,this.config.fixedTimeStep||1/60);for(var Ot=0,Vt=this.rigidBodies.length;Ot<Vt;Ot++){var St=this.rigidBodies[Ot],At=St.body.ammo,Ut=At.getMotionState();if(Ut)if(Ut.getWorldTransform(this.tmpTrans),St.body.didUpdate&&(St.body._emitUpdateEvents&&St.body.eventEmitter.emit("update"),St.body.didUpdate=!1),St.body.ammo.isKinematicObject()&&St.body.needUpdate)St.getWorldQuaternion(this.tmpQuaternion),St.getWorldPosition(this.tmpVector3),this.tmpBtVector3.setValue(this.tmpVector3.x,this.tmpVector3.y,this.tmpVector3.z),this.tmpBtQuaternion.setValue(this.tmpQuaternion.x,this.tmpQuaternion.y,this.tmpQuaternion.z,this.tmpQuaternion.w),this.tmpTrans.setOrigin(this.tmpBtVector3),this.tmpTrans.setRotation(this.tmpBtQuaternion),Ut.setWorldTransform(this.tmpTrans),St.body.needUpdate=!1;else{var re=this.tmpTrans.getOrigin(),ie=this.tmpTrans.getRotation(),Ct=St.body.offset;St.position.set(re.x()+Ct.x,re.y()+Ct.y,re.z()+Ct.z),St.quaternion.set(ie.x(),ie.y(),ie.z(),ie.w())}}for(var Ot=0,Vt=this.dispatcher.getNumManifolds();Ot<Vt;Ot++){var se=this.dispatcher.getManifoldByIndexInternal(Ot),ve=Object.keys(se.getBody0())[0],le=Ammo.castObject(se.getBody0(),Ammo.btRigidBody),de=Ammo.castObject(se.getBody1(),Ammo.btRigidBody);if(le.name===""&&de.name==="")continue;var Pe=le[ve],Ve=de[ve],Ue=this.objectsAmmo[Pe],ke=this.objectsAmmo[Ve];if(!Ue||!ke)continue;var he=Ue.body.breakable,Te=ke.body.breakable,Ce=(O=Ue.body)===null||O===void 0?void 0:O.checkCollisions,je=(pt=ke.body)===null||pt===void 0?void 0:pt.checkCollisions;if(!Ce&&!je&&!he&&!Te)continue;for(var ft=!1,tt=0,$="start",J=function(wt,zt){var bt=se.getContactPoint(wt);if(bt.getDistance()<=0){ft=!0;var Xt=bt.getAppliedImpulse(),rt=bt.get_m_positionWorldOnB(),d=bt.get_m_normalWorldOnB();if(Ce||je){var b=[Ue.name,ke.name].sort(),R=b[0]+"__"+b[1];L.earlierDetectedCollisions.find(function(B){return B.combinedName===R})&&($="collision"),ct.find(function(B){return B.combinedName===R})||(ct.push({combinedName:R,collision:!0}),L.collisionEvents.emit("collision",{bodies:[Ue,ke],event:$}))}return Xt>=tt&&(tt=Xt,(he||Te)&&(L.impactPoint.set(rt.x(),rt.y(),rt.z()),L.impactNormal.set(d.x(),d.y(),d.z()))),"break"}},L=this,I=0,z=se.getNumContacts();I<z;I++){var X=J(I,z);if(X==="break")break}if(!ft)continue;if(!he&&!Te)continue;var Z=5,W=2;if(this.emptyV3.set(0,0,0),Ue.userData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:he,physicsBody:le},ke.userData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:Te,physicsBody:de},typeof Ue.fragmentDepth=="undefined"&&(Ue.fragmentDepth=0),typeof ke.fragmentDepth=="undefined"&&(ke.fragmentDepth=0),he&&tt>Z&&Ue.fragmentDepth<W){for(var D=this.convexBreaker.subdivideByImpact(Ue,this.impactPoint,this.impactNormal,1,2),H=D.length,I=0;I<H;I++){var ht=le.getLinearVelocity(),F=le.getAngularVelocity(),Mt=D[I];Mt.userData.velocity.set(ht.x(),ht.y(),ht.z()),Mt.userData.angularVelocity.set(F.x(),F.y(),F.z()),this.createDebrisFromBreakableObject(Mt,Ue)}this.objectsToRemove[this.numObjectsToRemove++]=Ue}if(Te&&tt>Z&&ke.fragmentDepth<W){for(var D=this.convexBreaker.subdivideByImpact(ke,this.impactPoint,this.impactNormal,1,2),H=D.length,I=0;I<H;I++){var ht=de.getLinearVelocity(),F=de.getAngularVelocity(),Mt=D[I];Mt.userData.velocity.set(ht.x(),ht.y(),ht.z()),Mt.userData.angularVelocity.set(F.x(),F.y(),F.z()),this.createDebrisFromBreakableObject(Mt,ke)}this.objectsToRemove[this.numObjectsToRemove++]=ke}}for(var Ot=0;Ot<this.numObjectsToRemove;Ot++)this.removeDebris(this.objectsToRemove[Ot]);this.numObjectsToRemove=0,this.earlierDetectedCollisions.forEach(function(Et){var Q=Et.combinedName;if(!ct.find(function(rt){return rt.combinedName===Q})){var wt=Q.split("__"),zt=U.rigidBodies.find(function(rt){return rt.name===wt[0]}),bt=U.rigidBodies.find(function(rt){return rt.name===wt[1]}),Xt="end";zt&&bt&&U.collisionEvents.emit("collision",{bodies:[zt,bt],event:Xt})}}),this.earlierDetectedCollisions=f(ct)},x.prototype.setGravity=function(S,U,O){S===void 0&&(S=0),U===void 0&&(U=-9.8),O===void 0&&(O=0),this.tmpBtVector3.setValue(S,U,O),this.physicsWorld.setGravity(this.tmpBtVector3)},Object.defineProperty(x.prototype,"debug",{get:function(){var S=this;return this.isHeadless?null:{enable:function(){S.debugDrawer.enable()},mode:function(U){U===void 0&&(U=1),S.debugDrawer.setDebugMode(U)},disable:function(){S.debugDrawer.disable()}}},enumerable:!0,configurable:!0}),x.prototype.start=function(){var S=this;if(typeof Ammo=="undefined"){E.default("Are you sure you included ammo.js?");return}typeof Ammo=="function"?Ammo().then(function(){S.setup()}):this.setup()},Object.defineProperty(x.prototype,"add",{get:function(){var S=this;return{collider:function(U,O,pt){return S.collisionEvents.addCollider(U,O,pt)},constraints:this.constraints.addConstraints,existing:function(U,O){return S.addExisting(U,O)},plane:function(U,O){return U===void 0&&(U={}),O===void 0&&(O={}),S.shapes.addPlane(U,O)},sphere:function(U,O){return U===void 0&&(U={}),O===void 0&&(O={}),S.shapes.addSphere(U,O)},ground:function(U,O){return U===void 0&&(U={}),O===void 0&&(O={}),S.shapes.addGround(U,O)},box:function(U,O){return U===void 0&&(U={}),O===void 0&&(O={}),S.shapes.addBox(U,O)},cylinder:function(U,O){return U===void 0&&(U={}),O===void 0&&(O={}),S.shapes.addCylinder(U,O)},cone:function(U,O){return U===void 0&&(U={}),O===void 0&&(O={}),S.shapes.addCone(U,O)},torus:function(U,O){return U===void 0&&(U={}),O===void 0&&(O={}),S.shapes.addTorus(U,O)},extrude:function(U,O){return O===void 0&&(O={}),S.shapes.addExtrude(U,O)},raycaster:function(U){return U===void 0&&(U="closest"),U==="closest"?new ll.ClosestRaycaster(S):new ll.AllHitsRaycaster(S)}}},enumerable:!0,configurable:!0}),x.prototype.prepareThreeObjectForCollisionShape=function(S,U){U===void 0&&(U={});var O,pt,ct=S.position,_t=S.quaternion,Ot=S.hasBody,Vt=U.autoCenter,St=Vt===void 0?!1:Vt,At={width:1,height:1,depth:1,radius:1,radiusTop:1,radiusBottom:1,tube:.4,tubularSegments:6},Ut="unknown",re=((O=S.geometry)===null||O===void 0?void 0:O.type)||"unknown";/box/i.test(re)?Ut="box":/cone/i.test(re)?Ut="cone":/cylinder/i.test(re)?Ut="cylinder":/extrude/i.test(re)?Ut="extrude":/plane/i.test(re)?Ut="plane":/sphere/i.test(re)?Ut="sphere":/torus/i.test(re)&&(Ut="torus");var ie=v(v({},At),(pt=S==null?void 0:S.geometry)===null||pt===void 0?void 0:pt.parameters);return U.shape?(ie=v(v({},At),U),Ut=U.shape):S.shape&&(Ut=S.shape),Object.keys(ie).forEach(function(Ct){typeof ie[Ct]=="undefined"&&At[Ct]&&(ie[Ct]=At[Ct])}),St&&S.geometry.center(),Ut==="extrude"&&(Ut="hacd"),(Ut==="mesh"||Ut==="convex")&&(Ut="convexMesh"),Ut==="concave"&&(Ut="concaveMesh"),Ut==="unknown"&&(E.default("Shape for "+(S==null?void 0:S.name)+" not recognized! Will fallback to box."),Ut="box"),{shape:Ut,params:ie,object:S}},x.prototype.createCollisionShape=function(S,U,O){var pt=(O==null?void 0:O.quaternion)?O==null?void 0:O.quaternion:new Jt.Quaternion(0,0,0,1),ct;switch(S){case"box":ct=new Ammo.btBoxShape(new Ammo.btVector3(U.width/2,U.height/2,U.depth/2));break;case"sphere":ct=new Ammo.btSphereShape(U.radius);break;case"cylinder":ct=new Ammo.btCylinderShape(new Ammo.btVector3(U.radiusTop,U.height/2,0));break;case"cone":ct=new Ammo.btConeShape(U.radius,U.height);break;case"torus":ct=Qv.addTorusShape(U,pt);break;case"capsule":ct=new Ammo.btCapsuleShape(U.radius,U.height);break;case"plane":ct=wo.createCollisionShapes(O,{type:"mesh",concave:!1});break;case"hull":ct=wo.createCollisionShapes(O,{type:"hull"});break;case"hacd":ct=wo.createCollisionShapes(O,{type:"hacd"});break;case"vhacd":ct=wo.createCollisionShapes(O,{type:"vhacd"});break;case"convexMesh":ct=wo.createCollisionShapes(O,{type:"mesh",concave:!1});break;case"concaveMesh":ct=wo.createCollisionShapes(O,{type:"mesh",concave:!0});break}var _t=U.x,Ot=U.y,Vt=U.z;return(_t||Ot||Vt)&&(ct.offset={x:_t||0,y:Ot||0,z:Vt||0}),Array.isArray(ct)&&(ct=this.mergeCollisionShapesToCompoundShape(ct)),ct},x.prototype.mergeCollisionShapesToCompoundShape=function(S){var U=new Ammo.btCompoundShape;return S.forEach(function(O){var pt=O.offset,ct=new Ammo.btTransform;ct.setIdentity(),pt&&ct.setOrigin(new Ammo.btVector3(pt.x||0,pt.y||0,pt.z||0)),U.addChildShape(ct,O)}),U},x.prototype.addExisting=function(S,U){var O=this;U===void 0&&(U={});var pt=S.hasBody;if(pt){console.warn('[Enable3d]: Object "'+S.name+'" already has a physical body!');return}var ct=S.position,_t=S.quaternion,Ot=U.shape,Vt=Ot===void 0?"unknown":Ot,St=U.compound,At=St===void 0?[]:St,Ut=U.mass,re=Ut===void 0?1:Ut,ie=U.collisionFlags,Ct=ie===void 0?0:ie,se=U.offset,ve=se===void 0?void 0:se,le=U.breakable,de=le===void 0?!1:le,Pe=U.addChildren,Ve=Pe===void 0?!0:Pe;if(At.length>=1){var Ue=At.map(function($){return O.createCollisionShape($.shape,$)}),ke=this.mergeCollisionShapesToCompoundShape(Ue),he=this.collisionShapeToRigidBody(ke,S.position,S.quaternion,1);this.addRigidBodyToWorld(S,he);return}var Te=[];if(Vt!=="unknown"||S.isMesh){var Ce=this.prepareThreeObjectForCollisionShape(S,U),je=this.createCollisionShape(Ce.shape,Ce.params,Ce.object);Te.push(je)}if(Vt==="unknown"&&Ve&&S.children.length>=1&&S.children.forEach(function($){if($.isMesh){var J=O.prepareThreeObjectForCollisionShape($),L=O.createCollisionShape(J.shape,J.params,J.object);L.offset=$.position.clone(),Te.push(L)}}),Te.length===0){var Ce=this.prepareThreeObjectForCollisionShape(S,U),je=this.createCollisionShape(Ce.shape,Ce.params,Ce.object);Te.push(je)}var ft=Te.length===1?Te[0]:this.mergeCollisionShapesToCompoundShape(Te),tt=this.collisionShapeToRigidBody(ft,ct,_t,re);this.addRigidBodyToWorld(S,tt,Ct,de,ve)},x.prototype.addRigidBodyToWorld=function(S,U,O,pt,ct){O===void 0&&(O=0),this.rigidBodies.push(S),this.physicsWorld.addRigidBody(U);var _t=Object.values(U)[0];U.name=S.name,S.body=new P.default(this,U),S.hasBody=!0,S.ptr=_t,this.objectsAmmo[_t]=S,pt&&(S.body.breakable=!0),ct&&(S.body.offset=v({x:0,y:0,z:0},ct)),S.body.setCollisionFlags(O)},x.prototype.collisionShapeToRigidBody=function(S,U,O,pt){pt===void 0&&(pt=1);var ct=new Ammo.btTransform;ct.setIdentity(),ct.setOrigin(new Ammo.btVector3(U.x,U.y,U.z)),ct.setRotation(new Ammo.btQuaternion(O.x,O.y,O.z,O.w));var _t=new Ammo.btDefaultMotionState(ct),Ot=new Ammo.btVector3(0,0,0);pt>0&&S.calculateLocalInertia(pt,Ot);var Vt=new Ammo.btRigidBodyConstructionInfo(pt,_t,S,Ot),St=new Ammo.btRigidBody(Vt);return pt>0&&St.setActivationState(4),St},x}(C.default);kt.AmmoPhysics=at}),Np=gr(function(mr,kt){function ee(v){for(var f in v)kt.hasOwnProperty(f)||(kt[f]=v[f])}Object.defineProperty(kt,"__esModule",{value:!0}),ee(sg)}),cg=Yv(Np);export{cg as _,Jt as a,cl as b,sl as c,Np as d,ol as e,Op as f,Pp as g,Is as l,Dp as p,Ip as t};
