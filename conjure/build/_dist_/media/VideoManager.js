import{generateUUID as u}from"../../web_modules/@AssetSync/common.js";export class VideoManager{constructor(o){this.worldSync=o}async createVideo(o){const r="videoStream"+u();let e=document.createElement("video");e.crossOrigin="anonymous",e.loop=!0;const t=new XMLHttpRequest;return t.open("GET",o,!0),t.responseType="blob",t.onload=n=>{if(n.target.status===200&&e){let l=n.target.response,i=URL.createObjectURL(l);e.src=i,e.play(),e.volume=0;const a=e.captureStream();console.log(e,a,a.getVideoTracks());const[d]=a.getVideoTracks(),m=new ImageCapture(d);function c(){m.grabFrame().then(s=>{console.log(r,s),this.worldSync._peerSync.sendEvent({type:r,imageBitmap:s},[s])}),e.requestVideoFrameCallback(c)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(c)}},t.onerror=()=>{console.log("Failed to get video at",o)},t.send(),r}createGif(o){}}
